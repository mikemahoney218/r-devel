From jago at mclink.it  Fri Dec  1 01:43:15 2006
From: jago at mclink.it (stefano iacus)
Date: Fri, 1 Dec 2006 09:43:15 +0900
Subject: [Rd] Magic Menu library loading error (PR#9405)
In-Reply-To: <20061130205148.C242C48E79@slim.kubism.ku.dk>
References: <20061130205148.C242C48E79@slim.kubism.ku.dk>
Message-ID: <6E6191C7-C936-4ED2-B5C6-9AD24A92BC0C@mclink.it>

Jeff,
this is not a bug report for R, and you already posted to R-Sig-mac  
(and get answered)
Maybe you want to contact the author of MagicMenu (or what ever is  
the software you use) to understand why such bad interaction with  
R.app takes place.
stefano


On 01/dic/06, at 05:51, jleecbd at gmail.com wrote:

> Full_Name: Jeff Lee
> Version: 2.4.0
> OS: Mac OS X 10.4 (Tiger)
> Submission from: (NULL) (12.150.164.100)
>
>
> Just upgraded to an Intel based Mac.  Upon launch, I receive the  
> following
> error:
>
> 2006-11-30 12:39:36.870 R[407] *** -[NSBundle load]: Error loading  
> code
> /Library/InputManagers/MagicMenuEnabler/MagicMenuEnabler.bundle/ 
> Contents/MacOS/MagicMenuEnabler
> for bundle /Library/InputManagers/MagicMenuEnabler/ 
> MagicMenuEnabler.bundle,
> error code 2 (link edit error code 0, error number 0 ())
>
> Functioning of the system seems okay, however.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From jago at mclink.it  Fri Dec  1 04:21:24 2006
From: jago at mclink.it (stefano iacus)
Date: Fri, 1 Dec 2006 12:21:24 +0900
Subject: [Rd] Magic Menu library loading error (PR#9405)
In-Reply-To: <D0E02E8B-B240-46BF-85E8-7227CF1E411F@gmail.com>
References: <20061130205148.C242C48E79@slim.kubism.ku.dk>
	<6E6191C7-C936-4ED2-B5C6-9AD24A92BC0C@mclink.it>
	<D0E02E8B-B240-46BF-85E8-7227CF1E411F@gmail.com>
Message-ID: <8E0A4D0D-E522-4100-A1BF-BEF7C01FAC24@mclink.it>

Jeff,
maybe I confused your mail with a similar report. Apologizes.
Anyway, this is not a proper R bug report. Next time, please, use (or  
search) R-Sig-Mac.
Googling around, it seems that there is a MagicMenu which is  
installed by Stuffit. We don't load it in R.app at any time.

stefano




On 01/dic/06, at 12:04, Jeffrey Lee wrote:

> I'm not sure what you mean that I already posted to R-Sig-mac.  I  
> haven't done that.  I only observe this error with R, which appears  
> to be attempting to load this code.
>
>
> On Nov 30, 2006, at 4:43 PM, stefano iacus wrote:
>
>> Jeff,
>> this is not a bug report for R, and you already posted to R-Sig- 
>> mac (and get answered)
>> Maybe you want to contact the author of MagicMenu (or what ever is  
>> the software you use) to understand why such bad interaction with  
>> R.app takes place.
>> stefano
>>
>>
>> On 01/dic/06, at 05:51, jleecbd at gmail.com wrote:
>>
>>> Full_Name: Jeff Lee
>>> Version: 2.4.0
>>> OS: Mac OS X 10.4 (Tiger)
>>> Submission from: (NULL) (12.150.164.100)
>>>
>>>
>>> Just upgraded to an Intel based Mac.  Upon launch, I receive the  
>>> following
>>> error:
>>>
>>> 2006-11-30 12:39:36.870 R[407] *** -[NSBundle load]: Error  
>>> loading code
>>> /Library/InputManagers/MagicMenuEnabler/MagicMenuEnabler.bundle/ 
>>> Contents/MacOS/MagicMenuEnabler
>>> for bundle /Library/InputManagers/MagicMenuEnabler/ 
>>> MagicMenuEnabler.bundle,
>>> error code 2 (link edit error code 0, error number 0 ())
>>>
>>> Functioning of the system seems okay, however.
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>
>
>


From natherhe at kiron-espace.com  Fri Dec  1 06:25:17 2006
From: natherhe at kiron-espace.com (tasia gilbert)
Date: Fri, 01 Dec 2006 03:25:17 -0200
Subject: [Rd] Totally OutOfDebt Overnight
Message-ID: <79F6C872.2928D3E9@kiron-espace.com>

0ur Attorneys have discovered a loophole in the banking laws. With this
discovery, we've been successfu1 at eliminating people's creditcarddebt with
out them paying one more cent. WeGuarantee that we can help you with this.

C0ntact us at
1--3 1 3--263--2706


The judgment of the jury was received with great applause, although Dorothy
was sobbing miserably at the fate of her pet. So, while he hesitated, he
attached the machine to his wrist and leaned over the bulwarks to watch the
progress of the storm


From ross at biostat.ucsf.edu  Fri Dec  1 07:29:06 2006
From: ross at biostat.ucsf.edu (Ross Boylan)
Date: Thu, 30 Nov 2006 22:29:06 -0800
Subject: [Rd] promptClass misses methods
Message-ID: <20061201062906.GB8201@wheat.betterworld.us>

I've had repeated problems with promptClass missing methods, usually
telling me a class has no methods when it does.

In my current case, I've defined an S4 class "mspathCoefficients" with
a print method
setMethod("print", signature(x="mspathCoefficients"), function(x, ...)
{ # etc

The file promptClass creates has no methods in it.
> showMethods(classes="mspathCoefficients")
Function: initialize (package methods)
.Object="mspathCoefficients"
    (inherited from: .Object="ANY")

Function: print (package base)
x="mspathCoefficients"

Function: show (package methods)
object="mspathCoefficients"
    (inherited from: object="ANY")

> getGeneric("print")
standardGeneric for "print" defined from package "base"

function (x, ...) 
standardGeneric("print")
<environment: 0x84f2d88>
Methods may be defined for arguments: x 


I've looked through the code for promptClass, but nothing popped out
at me.

It may be relevant that I'm running under ESS in emacs.  However, I
get the same results running R from the command line.

Can anyone tell me what's going on here?  This is with R 2.4, and I'm
not currently using any namespace for my definitions.

Thanks.
Ross Boylan


From ross at biostat.ucsf.edu  Fri Dec  1 07:40:05 2006
From: ross at biostat.ucsf.edu (Ross Boylan)
Date: Thu, 30 Nov 2006 22:40:05 -0800
Subject: [Rd] promptClass misses methods (addendum)
In-Reply-To: <20061201062906.GB8201@wheat.betterworld.us>
References: <20061201062906.GB8201@wheat.betterworld.us>
Message-ID: <20061201064005.GU4431@wheat.betterworld.us>

On Thu, Nov 30, 2006 at 10:29:06PM -0800, Ross Boylan wrote:
> I've had repeated problems with promptClass missing methods, usually
> telling me a class has no methods when it does.
> 
> In my current case, I've defined an S4 class "mspathCoefficients" with
> a print method
> setMethod("print", signature(x="mspathCoefficients"), function(x, ...)
> { # etc

It may also be relevant that  there is a mspathCoefficients function,
which constructs a member of the class.

Ross


From Rainer.Hurling at nw-fva.de  Fri Dec  1 09:10:48 2006
From: Rainer.Hurling at nw-fva.de (Rainer Hurling)
Date: Fri, 01 Dec 2006 09:10:48 +0100
Subject: [Rd] R-devel does not compile under FreeBSD-7.0 CURRENT [SOLVED]
In-Reply-To: <Pine.LNX.4.64.0611300809430.8049@gannet.stats.ox.ac.uk>
References: <456DF604.1000306@gwdg.de>
	<Pine.LNX.4.64.0611300809430.8049@gannet.stats.ox.ac.uk>
Message-ID: <456FE388.1010506@nw-fva.de>

I tried todays R-devel (2006-11-30) with FreeBSD-7.0 CURRENT and it 
seems, that compiling with 'make && make install' is ok again.

Thank you very much,
Rainer Hurling


Prof Brian Ripley wrote:
> As I said to you privately, I believe this to be a make issue: does GNU 
> make work?  We don't guarantee R to work with other makes (although it 
> usually does).
> 
> My guess is that the problem is the missing .m in the .SUFFIXES list
> in Makeconf.in, but Solaris make and GNU make see no problem and it 
> looks like a make bug to me.  I've added the suffix, so please try the 
> current version.
> 
> (This seems to be related to adding ObjC support which is apparently 
> currently incomplete.)
> 
> On Wed, 29 Nov 2006, Rainer Hurling wrote:
> 
>> I am not able to compile R-devel 2006-11-28 under FreeBSD-7.0 CURRENT. 
>> After running ./configure script 'make' stops with the following error 
>> message:
>>
>> --------------------------
>> #make
>> gcc -I. -I./src/include -I./src/include -I/usr/local/include
>> -DHAVE_CONFIG_H -g -O2 -c  -o .m.o
>> gcc: No input files specified
>> *** Error code 1
>>
>> Stop in /usr/local/R-devel.
>> #
>> --------------------------
>>
>> I attached configure messages. If wanted I can send complete 
>> config.log (460 kByte).
>>
>> Are their any ideas about what is going wrong? If I could help with 
>> more information or with testing, please let me know.


From topher29932 at basf.com  Fri Dec  1 09:29:24 2006
From: topher29932 at basf.com (=?windows-1251?B?y+Xu7ejkIMHl6+jq7uI=?=)
Date: Fri, 01 Dec 2006 11:29:24 +0300
Subject: [Rd] =?windows-1251?b?xMvfINHPxdbIwMvI0dLOwiDCINHUxdDFIMzA0MrF?=
 =?windows-1251?b?0sjNw8AgyCDMxc3FxMbMxc3SwA==?=
Message-ID: <327301c71522$d9910ee2$d9de77d6@basf.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20061201/ab87dffa/attachment.pl 

From thomson2019 at bar-plate.com  Fri Dec  1 09:32:19 2006
From: thomson2019 at bar-plate.com (=?windows-1251?B?wC7SIM/l8vDu7+Di6+7i8ero6Q==?=)
Date: Fri, 01 Dec 2006 11:32:19 +0300
Subject: [Rd] =?windows-1251?b?wiDO0sTFy9sgzMDQysXSyM3DwCDIIMzFzcXExszF?=
	=?windows-1251?b?zdLA?=
Message-ID: <b35301c71523$9a528284$0305af4e@bar-plate.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20061201/aca4f3e0/attachment.pl 

From maechler at stat.math.ethz.ch  Fri Dec  1 10:34:45 2006
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Fri, 1 Dec 2006 10:34:45 +0100
Subject: [Rd] printing coefficients with text
In-Reply-To: <20061130201755.GA8201@wheat.betterworld.us>
References: <20061130201755.GA8201@wheat.betterworld.us>
Message-ID: <17775.63285.29855.903217@stat.math.ethz.ch>

>>>>> "RossB" == Ross Boylan <ross at biostat.ucsf.edu>
>>>>>     on Thu, 30 Nov 2006 12:17:55 -0800 writes:

    RossB> I want to print the coefficient estimates of a model
    RossB> in a way as consistent with other output in R as
    RossB> possible. stats provides the printCoefmat function
    RossB> for doing this, but there is one problem.  I have an
    RossB> additional piece of textual information I want to put
    RossB> on the line with the other info on each coefficient.

that's not a real problem, see below

    RossB> The documentation for printCoefmat says the first
    RossB> argument must be numeric, which seems to rule this out.

it does say that (it says "x: a numeric matrix like object"
		  which includes data frames with factors)
but you are right that it does preclude a column of "character".

    RossB> I just realized I might be able to cheat by inserting
    RossB> the text into the name of the variable (fortunately
    RossB> there is just one item of text).  I think that's in
    RossB> the names of the matrix given as the first argument
    RossB> to the function.

yes; it's the rownames();
i.e., you'd do something like
      rownames(myx) <- paste(rownames(myx), format(mytext_var)))

which seems simple enough to me,
but it only works when the "text" is the first column

    RossB> Are there any better solutions?  Obviously I could
    RossB> just copy the method and modify it, but that creates
    RossB> duplicate code and loses the ability to track future
    RossB> changes to printCoefmat.

As original author of printCoefmat(), I'm quite willing to
accept and incorporate a patch to the current function
definition (in https://svn.r-project.org/R/trunk/src/library/R/anova.R),
if it's well written.

As a matter of fact, I think already see how to generalize printCoefmat()
to work for the case of data frame with character columns
[I would not want a character matrix however; since that would mean
 going numeric -> character -> numeric -> formatting (i.e character)
 for the 'coefficients' themselves].

Can you send me a reproducible example?
or at least an *.Rda file of a save()d such data frame?

    RossB> Thanks.  Ross Boylan

You're welcome,
Martin Maechler, ETH Zurich


From maechler at stat.math.ethz.ch  Fri Dec  1 10:45:15 2006
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Fri, 1 Dec 2006 10:45:15 +0100
Subject: [Rd] order of levels in interaction()
In-Reply-To: <Pine.LNX.4.64.0611302146210.19267@gannet.stats.ox.ac.uk>
References: <eb555e660611301325o3f255372t4bced4bd0c51e52d@mail.gmail.com>
	<Pine.LNX.4.64.0611302146210.19267@gannet.stats.ox.ac.uk>
Message-ID: <17775.63915.927274.797937@stat.math.ethz.ch>

>>>>> "BDR" == Prof Brian Ripley <ripley at stats.ox.ac.uk>
>>>>>     on Thu, 30 Nov 2006 21:48:35 +0000 (GMT) writes:

    BDR> On Thu, 30 Nov 2006, Deepayan Sarkar wrote:
    >> Hi,
    >> 
    >> ?interaction says:
    >> 
    >> See Also:
    >> 
    >> 'factor'; ':' where 'f:g' is the similar to
    >> 'interaction(f, g, sep=":")' when 'f' and 'g' are
    >> factors.
    >> 
    >> This is not quite true (or maybe 'similar' is the
    >> operative word), since:
    >> 
    >>> f <- factor(1:3); g <- factor(letters[1:3])
    >>> levels(f:g)
    >>   [1] "1:a" "1:b" "1:c" "2:a" "2:b" "2:c" "3:a" "3:b" "3:c"
    >>> levels(interaction(f, g, sep = ":"))
    >>   [1] "1:a" "2:a" "3:a" "1:b" "2:b" "3:b" "1:c" "2:c" "3:c"
    >> 
    >> Note the different order of the levels. I like the order
    >> in f:g better (and at least one other person agrees [1]
    >> ), but I also want the flexibility of having a 'sep'
    >> argument. Would it be possible to change interaction to
    >> allow this? A simple fix that makes interaction behave
    >> like ":" is to replace

    BDR> No, for it also says

    BDR>       The levels are ordered so the level of the first
    BDR> factor varies fastest, then the second and so on.  This
    BDR> is the reverse of lexicographic ordering, and differs
    BDR> from ':'.  (It is done this way for compatibility with S.)

    BDR> and reversing it would break things.  (It does, I tried
    BDR> it a while back.)

yes, indeed  {{ and Deepayan should have ... :-) .. }}

But instead of having Deepayan and other users write their own
customized version of interaction() and having interaction2()
end up in one of those CRAN packages ( ;-} ), we could add a new
argument to interaction()  which allows the new behavior - not
active by default, of course.

I'm happy to do this; the only question remaining is how the
argument should be called, and if it's sufficient to have it
logical, or if there are more variations that should be
considered (I think not).

My quick proposals (name and default):

    reverse = FALSE
    orderFirst = FALSE


    >> as.vector(outer(l, lvs, paste, sep = sep))
    >> 
    >> with
    >> 
    >> as.vector(t(outer(l, lvs, paste, sep = sep)))
    >> 
    >> in interaction.
    >> 
    >> -Deepayan
    >> 
    >> [1]
    >> http://tolstoy.newcastle.edu.au/R/help/06/08/32638.html

Martin


From maechler at stat.math.ethz.ch  Fri Dec  1 11:37:46 2006
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Fri, 1 Dec 2006 11:37:46 +0100
Subject: [Rd] promptClass misses methods
In-Reply-To: <20061201062906.GB8201@wheat.betterworld.us>
References: <20061201062906.GB8201@wheat.betterworld.us>
Message-ID: <17776.1530.328130.767021@stat.math.ethz.ch>

>>>>> "RossB" == Ross Boylan <ross at biostat.ucsf.edu>
>>>>>     on Thu, 30 Nov 2006 22:29:06 -0800 writes:

    RossB> I've had repeated problems with promptClass missing
    RossB> methods, usually telling me a class has no methods
    RossB> when it does.

    RossB> In my current case, I've defined an S4 class
    RossB> "mspathCoefficients" with a print method
    RossB> setMethod("print", signature(x="mspathCoefficients"),
    RossB> function(x, ...)  { # etc

You should *not* define "print" methods for S4 classes;
rather you should define "show" methods.

    RossB> The file promptClass creates has no methods in it.
    >> showMethods(classes="mspathCoefficients")
    RossB> Function: initialize (package methods)
    RossB> .Object="mspathCoefficients" (inherited from:
    RossB> .Object="ANY")

so it's just inherited from "ANY"

    RossB> Function: print (package base) 
    RossB> x="mspathCoefficients"

that's the one

    RossB> Function: show (package methods)
    RossB> object="mspathCoefficients"
    RossB>  (inherited from: object="ANY")
so it's just inherited from "ANY"

Ross, it would really be more polite to your readers if you
followed the posting guide and posted complete
fully-reproducible code...

    >> getGeneric("print")
    RossB> standardGeneric for "print" defined from package
    RossB> "base"

    RossB> function (x, ...)  standardGeneric("print")
    RossB> <environment: 0x84f2d88> Methods may be defined for
    RossB> arguments: x


    RossB> I've looked through the code for promptClass, but
    RossB> nothing popped out at me.

    RossB> It may be relevant that I'm running under ESS in
    RossB> emacs.  However, I get the same results running R
    RossB> from the command line.

    RossB> Can anyone tell me what's going on here?  This is
    RossB> with R 2.4, and I'm not currently using any namespace
    RossB> for my definitions.

[and not a package either?]

I'm very willing to look at this, once
you've provided what the posting guide asks for, see above.

Regards,
Martin


From alan.bain at gmail.com  Fri Dec  1 11:44:34 2006
From: alan.bain at gmail.com (alan.bain at gmail.com)
Date: Fri,  1 Dec 2006 11:44:34 +0100 (CET)
Subject: [Rd] Non central chi squared bug (PR#9406)
Message-ID: <20061201104434.3B2B9572A4@slim.kubism.ku.dk>

Full_Name: Alan Bain 
Version: 2.4.0
OS: XP
Submission from: (NULL) (155.140.122.227)



Code for pnchisq contains following

if (tSml) {

if (x> f+ theta+ 5*sqrt(2*(f+2*theta) ))){
     return 1.; /* better than 0 --- but definately FIXME */
}

}

This needs to check which tail has been requested; it is only correct if the
default lower_tail=1 has been requested; for upper tail should return 0 if more
than 5 std devs away from mean under these circumstances.


From maechler at stat.math.ethz.ch  Fri Dec  1 11:51:59 2006
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Fri, 1 Dec 2006 11:51:59 +0100
Subject: [Rd] R CMD check warning about boot ?
In-Reply-To: <17774.58742.482456.68184@basebud.nulle.part>
References: <17774.1882.621732.219274@basebud.nulle.part>
	<456EA128.6050805@statistik.uni-dortmund.de>
	<17774.49793.503972.781158@mithrandir.hornik.net>
	<17774.58742.482456.68184@basebud.nulle.part>
Message-ID: <17776.2383.700920.192129@stat.math.ethz.ch>

>>>>> "Dirk" == Dirk Eddelbuettel <edd at debian.org>
>>>>>     on Thu, 30 Nov 2006 08:06:46 -0600 writes:

	  [.............]

    Dirk> The boot package loads fine, and is current.  Why does
    Dirk> R CMD check think it is an error that boot happens to
    Dirk> live in a particular directory, for as long as that
    Dirk> directory is known to .libPaths() ?

There's quite a difference between 
.libPaths()  in interactive and in "R CMD check" use :

'R CMD check' does not use your R_ENVIRON where you probably set
your R_LIBS .
I vaguely remember that there a good reasons for this behavior,
but I don't recall them at the moment.

My solution (or "workaround the design bug"?) has been - for
packages I develop - to have small helper scripts that basically do

  R_LIBS=<the_non_standard_libs_I_need>  R CMD check <options>  <mypackage>

Martin


From murdoch at stats.uwo.ca  Fri Dec  1 12:21:42 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Fri, 01 Dec 2006 06:21:42 -0500
Subject: [Rd] Non central chi squared bug (PR#9406)
In-Reply-To: <20061201104434.3B2B9572A4@slim.kubism.ku.dk>
References: <20061201104434.3B2B9572A4@slim.kubism.ku.dk>
Message-ID: <45701046.2050703@stats.uwo.ca>

On 12/1/2006 5:44 AM, alan.bain at gmail.com wrote:
> Full_Name: Alan Bain 
> Version: 2.4.0
> OS: XP
> Submission from: (NULL) (155.140.122.227)
> 
> 
> 
> Code for pnchisq contains following
> 
> if (tSml) {
> 
> if (x> f+ theta+ 5*sqrt(2*(f+2*theta) ))){
>      return 1.; /* better than 0 --- but definately FIXME */
> }
> 
> }
> 
> This needs to check which tail has been requested; it is only correct if the
> default lower_tail=1 has been requested; for upper tail should return 0 if more
> than 5 std devs away from mean under these circumstances.

Could you post a test case to demonstrate this?  I don't see it:

 > pchisq(1000, 2, 1, FALSE)
[1] 1.720202e-205
 > pchisq(10000, 2, 1, FALSE)
[1] 0
 > pchisq(100000, 2, 1, FALSE)
[1] 0
 > pchisq(1000000, 2, 1, FALSE)
[1] 0


Duncan Murdoch


From ripley at stats.ox.ac.uk  Fri Dec  1 12:27:28 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 1 Dec 2006 11:27:28 +0000 (GMT)
Subject: [Rd] R CMD check warning about boot ?
In-Reply-To: <17776.2383.700920.192129@stat.math.ethz.ch>
References: <17774.1882.621732.219274@basebud.nulle.part>
	<456EA128.6050805@statistik.uni-dortmund.de>
	<17774.49793.503972.781158@mithrandir.hornik.net>
	<17774.58742.482456.68184@basebud.nulle.part>
	<17776.2383.700920.192129@stat.math.ethz.ch>
Message-ID: <Pine.LNX.4.64.0612011105540.12054@gannet.stats.ox.ac.uk>

On Fri, 1 Dec 2006, Martin Maechler wrote:

>>>>>> "Dirk" == Dirk Eddelbuettel <edd at debian.org>
>>>>>>     on Thu, 30 Nov 2006 08:06:46 -0600 writes:
>
> 	  [.............]
>
>    Dirk> The boot package loads fine, and is current.  Why does
>    Dirk> R CMD check think it is an error that boot happens to
>    Dirk> live in a particular directory, for as long as that
>    Dirk> directory is known to .libPaths() ?
>
> There's quite a difference between
> .libPaths()  in interactive and in "R CMD check" use :
>
> 'R CMD check' does not use your R_ENVIRON where you probably set
> your R_LIBS .

That's not the issue here.  Even if R_LIBS is set, R CMD check looks for 
the copies of the standard and recommended packages in .Library 
(specifically .check_Rd_xrefs does): that is a safety measure as those are 
the ones against which the checks should be done even if you have 
development versions elsewhere in R_LIBS.  (Not my design, but one that 
seems highly defensible.)

There is no provision in the R scripts to install the recommended 
packages elsewhere than .Library, but I believe Dirk has a post-install 
script that breaks the assumptions so this is a Debian-packaging-specific 
issue.

> I vaguely remember that there a good reasons for this behavior,
> but I don't recall them at the moment.

R CMD does not make use of ~/.Renviron nor R_HOME/etc/Renviron.site:
it is like R --vanilla, which is what is used for a lot of batch testing 
code.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From P.Dalgaard at biostat.ku.dk  Fri Dec  1 14:00:17 2006
From: P.Dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Fri, 01 Dec 2006 14:00:17 +0100
Subject: [Rd] R 2.4.1 scheduled for December 18
Message-ID: <45702761.4010806@biostat.ku.dk>

The R Core Team has decided to aim for the release of 2.4.1 on Monday
December 18. This involves a feature freeze on Monday the 4th and code
freeze on Monday 11th. Automated builds of beta release and release
candidate tarballs will be available from the 5th and the 12th,
respectively.

It is not expected that many changes will occur relative to the current
R-patched version, but as always:

--->  Bugs reported before the release have a better chance of getting
fixed soon. <---

For this reason, and because of the risk of accidentally putting
"infelicities" into the final release, please do try out the
prereleases. Particularly so if your setup is not mainstream OS-wise or
configuration-wise.

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From edd at debian.org  Fri Dec  1 14:42:49 2006
From: edd at debian.org (Dirk Eddelbuettel)
Date: Fri, 1 Dec 2006 07:42:49 -0600
Subject: [Rd] R CMD check warning about boot ?
In-Reply-To: <Pine.LNX.4.64.0612011105540.12054@gannet.stats.ox.ac.uk>
References: <17774.1882.621732.219274@basebud.nulle.part>
	<456EA128.6050805@statistik.uni-dortmund.de>
	<17774.49793.503972.781158@mithrandir.hornik.net>
	<17774.58742.482456.68184@basebud.nulle.part>
	<17776.2383.700920.192129@stat.math.ethz.ch>
	<Pine.LNX.4.64.0612011105540.12054@gannet.stats.ox.ac.uk>
Message-ID: <17776.12633.949651.289404@basebud.nulle.part>


( I added Kurt + Uwe back here again, they had replied earlier in the thread.)

On 1 December 2006 at 11:27, Prof Brian Ripley wrote:
| On Fri, 1 Dec 2006, Martin Maechler wrote:
| 
| >>>>>> "Dirk" == Dirk Eddelbuettel <edd at debian.org>
| >>>>>>     on Thu, 30 Nov 2006 08:06:46 -0600 writes:
| >
| > 	  [.............]
| >
| >    Dirk> The boot package loads fine, and is current.  Why does
| >    Dirk> R CMD check think it is an error that boot happens to
| >    Dirk> live in a particular directory, for as long as that
| >    Dirk> directory is known to .libPaths() ?
| >
| > There's quite a difference between
| > .libPaths()  in interactive and in "R CMD check" use :
| >
| > 'R CMD check' does not use your R_ENVIRON where you probably set
| > your R_LIBS .
| 
| That's not the issue here.  Even if R_LIBS is set, R CMD check looks for 
| the copies of the standard and recommended packages in .Library 
| (specifically .check_Rd_xrefs does): that is a safety measure as those are 
| the ones against which the checks should be done even if you have 
| development versions elsewhere in R_LIBS.  (Not my design, but one that 
| seems highly defensible.)

Recall that on Debian (and hence Ubuntu etc), and based on a suggestion by
KH+FL made during DSC2003, we set R_LIBS in the _global_ Renviron file:

edd at basebud:~> grep R_LIBS /usr/lib/R/etc/Renviron
R_LIBS=${R_LIBS-'/usr/local/lib/R/site-library:/usr/lib/R/site-library:/usr/lib/R/library'}

So Martin's point about a 'your R_LIBS' does not really hold. It's not via
~/.Renviron that this is governed.

Moreover, I have for several years now configured R itself (aka "r-base-core"
in Debian package space) to build  --without-recommended-packages  so if we put
the two together then a) R knows it cannot assume recommended packages, and
b) every function call using .libPaths() always saw the three values set in
R_LIBS --- which is why on the particular setup I use at work,

	/usr/local/lib/R/site-library	holds "everything", incl rec'd pkgs

	/usr/lib/R/site-library		is empty, no r-cran-* packages here

	/usr/lib/R/library		has what r-base-core installs
					but no recommended pkgs either

This has the advantage that the 'littler' shell wrapper update.r will update
everything (in /usr/local/lib/R/site-library) with one simple call; apt-get
and Debian take care of /usr/lib/R/library, and there is no overlap between
R's update.packages() and Debian.  It's more radical than what I tried
before, but it works *great*.

Apart from the R CMD check whine. I think I should patch that, but I'd need a
hint to where I should start looking. 

Or else I have to cave in and put the recommended packages back into
/usr/lib/R/library --- and violate in spirit the implicit contract of leaving
/usr et al to the package management system, and /usr/local to the user. I
don't like breaking that contract.

| There is no provision in the R scripts to install the recommended 
| packages elsewhere than .Library, but I believe Dirk has a post-install 
| script that breaks the assumptions so this is a Debian-packaging-specific 
| issue.

Nothing post-install.  For normal Debian packages, we have 

	r-base-core	
	+ recommended pkgs	using		/usr/lib/R/library

	r-cran-* from Debian	using		/usr/lib/R/site-library

	R/user installed pkgs	using		/usr/local/lib/R/site-library

where the last one is the default by virtue of its first place in R_LIBS.
 
| > I vaguely remember that there a good reasons for this behavior,
| > but I don't recall them at the moment.
| 
| R CMD does not make use of ~/.Renviron nor R_HOME/etc/Renviron.site:
| it is like R --vanilla, which is what is used for a lot of batch testing 
| code.

Right, but I had used R_HOME/etc/Renviron, not $R_HOME/etc/Renviron.site
(though arguably "Renviron.site in spirit").

Sorry for the long post, but this question of how to "best" manage R and
Debian packages on Debian/Ubuntu also pops up frequently on the r-sig-debian
list (or, as seen this week, in Doug and my mail box, even from a formerly
prominent CRAN author).

Comments highly welcome!

Cheers from snowy Chicago,  Dirk

-- 
Hell, there are no rules here - we're trying to accomplish something. 
                                                  -- Thomas A. Edison


From simon.urbanek at r-project.org  Fri Dec  1 14:59:00 2006
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Fri, 1 Dec 2006 08:59:00 -0500
Subject: [Rd] Magic Menu library loading error (PR#9405)
In-Reply-To: <6E6191C7-C936-4ED2-B5C6-9AD24A92BC0C@mclink.it>
References: <20061130205148.C242C48E79@slim.kubism.ku.dk>
	<6E6191C7-C936-4ED2-B5C6-9AD24A92BC0C@mclink.it>
Message-ID: <23B7458A-8EC1-410E-AC2C-35145BC5965D@r-project.org>

I'd like to add that the most common mistake is to upgrade to  
IntelMac and forget to delete old plugins that were PowerPC-only or  
don't work with your new system. Remember - Mac OS X upgrade will  
keep all your settings and files intact regardless whether they work  
on your new machine or not.

Cheers,
Simon

On Nov 30, 2006, at 7:43 PM, stefano iacus wrote:

> Jeff,
> this is not a bug report for R, and you already posted to R-Sig-mac
> (and get answered)
> Maybe you want to contact the author of MagicMenu (or what ever is
> the software you use) to understand why such bad interaction with
> R.app takes place.
> stefano
>
>
> On 01/dic/06, at 05:51, jleecbd at gmail.com wrote:
>
>> Full_Name: Jeff Lee
>> Version: 2.4.0
>> OS: Mac OS X 10.4 (Tiger)
>> Submission from: (NULL) (12.150.164.100)
>>
>>
>> Just upgraded to an Intel based Mac.  Upon launch, I receive the
>> following
>> error:
>>
>> 2006-11-30 12:39:36.870 R[407] *** -[NSBundle load]: Error loading
>> code
>> /Library/InputManagers/MagicMenuEnabler/MagicMenuEnabler.bundle/
>> Contents/MacOS/MagicMenuEnabler
>> for bundle /Library/InputManagers/MagicMenuEnabler/
>> MagicMenuEnabler.bundle,
>> error code 2 (link edit error code 0, error number 0 ())
>>
>> Functioning of the system seems okay, however.
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From Lukas.Indermaur at eawag.ch  Fri Dec  1 15:28:45 2006
From: Lukas.Indermaur at eawag.ch (Indermaur Lukas)
Date: Fri, 1 Dec 2006 15:28:45 +0100
Subject: [Rd] mixed effects model and r-squared
Message-ID: <FE8C160D1505B24497FA7C78D4DADACA047879@EA-MAIL.eawag.wroot.emp-eaw.ch>

Heya 

I am fitting linear mixed effects model in R and want to assess the model fit (with Animal number as random factor;  repeated measures for Animals):   
 
ts.model <- lme(LOG_FOC_MW ~ R_DN_SUM + ANIMAL + SEX+ YY, data = t.data, random = ~ 1 | ANIMAL,  correlation=corCAR1(0.2, form = ~1 | ANIMAL ), method='ML', na.action=na.omit)). 
 
Is there a possability to easly compute an R-square from the output of the model summary?
 
I would appreciate any hint.
Best regards
 
Lukas
 
 
 
 
??? 
Lukas Indermaur, PhD student 
eawag / Swiss Federal Institute of Aquatic Science and Technology 
ECO - Department of Aquatic Ecology
?berlandstrasse 133
CH-8600 D?bendorf
Switzerland
 
Phone: +41 (0) 71 220 38 25
Fax    : +41 (0) 44 823 53 15 
Email: lukas.indermaur at eawag.ch
www.lukasindermaur.ch


From cliftonuirz at billpoint.com  Fri Dec  1 17:06:58 2006
From: cliftonuirz at billpoint.com (nathaniel rodriguez)
Date: Sat, 02 Dec 2006 00:06:58 +0800
Subject: [Rd] DebtFree Immediately
Message-ID: <26DC0614.99491C25@billpoint.com>

Select legal counsel just found a mistake in the bank laws. Using waht we
found we were successfu1 at entirely eliminating peop1es creditcarddebt with
out them having to pay one more dime. We know that our firm can do this for
you also.

Please contact us-
1-313-263-2706


But why didn't you tell us at first? she asked. The Cannibal Island
Doubtless the adventures of the day had tired Rob, for he slept throughout
the night as comfortably as if he had been within his own room, lying upon
his own bed


From ross at biostat.ucsf.edu  Fri Dec  1 20:33:21 2006
From: ross at biostat.ucsf.edu (Ross Boylan)
Date: Fri, 1 Dec 2006 11:33:21 -0800
Subject: [Rd] promptClass misses methods
In-Reply-To: <17776.1530.328130.767021@stat.math.ethz.ch>
References: <20061201062906.GB8201@wheat.betterworld.us>
	<17776.1530.328130.767021@stat.math.ethz.ch>
Message-ID: <20061201193320.GY4431@wheat.betterworld.us>

On Fri, Dec 01, 2006 at 11:37:46AM +0100, Martin Maechler wrote:
> >>>>> "RossB" == Ross Boylan <ross at biostat.ucsf.edu>
> >>>>>     on Thu, 30 Nov 2006 22:29:06 -0800 writes:
> 
>     RossB> I've had repeated problems with promptClass missing
>     RossB> methods, usually telling me a class has no methods
>     RossB> when it does.
> 
>     RossB> In my current case, I've defined an S4 class
>     RossB> "mspathCoefficients" with a print method
>     RossB> setMethod("print", signature(x="mspathCoefficients"),
>     RossB> function(x, ...)  { # etc
> 
> You should *not* define "print" methods for S4 classes;
> rather you should define "show" methods.

Is that because print is used by the S3 system?  And is the general
rule to avoid using S3 methods for S4 classes?  For example,
http://www.omegahat.org/RSMethods/Intro.pdf, which is referenced in
the package help for methods, discusses show, print and plot as 3
alternatives in S4 (p. 9, though a footnote says that at that
time--2001--R didn't recognize formal methods for printing objects.)

I've been unable to locate much information about combining S3 and S4
methods, though I recall seeing a note saying this issue was still to
be addressed in R.  Perhaps it has been now, with setOldClass?  At any
rate, the help for that method addresses classes rather than methods,
and I didn't see anything in ?Methods, ?setMethod, or ?setGeneric.

show() raises two additional issues for me.  First, it takes a single
argument, and I want to be able to pass in additional arguments via
... .  Second, I read some advice somewhere, that I no longer can find,
that show methods should return an object and that object in turn
should be the thing that is printed.  I don't understand the
motivation for that rule, at least in this case, because my object is
already a results object.

> 
>     RossB> The file promptClass creates has no methods in it.
>     >> showMethods(classes="mspathCoefficients")
>     RossB> Function: initialize (package methods)
>     RossB> .Object="mspathCoefficients" (inherited from:
>     RossB> .Object="ANY")
> 
> so it's just inherited from "ANY"
> 
>     RossB> Function: print (package base) 
>     RossB> x="mspathCoefficients"
> 
> that's the one

So why isn't promptClass picking it up?

> 
>     RossB> Function: show (package methods)
>     RossB> object="mspathCoefficients"
>     RossB>  (inherited from: object="ANY")
> so it's just inherited from "ANY"
> 
> Ross, it would really be more polite to your readers if you
> followed the posting guide and posted complete
> fully-reproducible code...

I thought it might be overkill in this case.  At any rate, it sounds
as if I may be trying to do the wrong thing, so I'd appreciate
guidance on what the right thing to do is.

Here's a toy example:
setClass("A", representation(x="numeric"))
setMethod("print", signature(x="A"), function(x, ...) print(x at x, ...) )
promptClass("A")

The generated file has no print method.
 
> 
>     >> getGeneric("print")
>     RossB> standardGeneric for "print" defined from package
>     RossB> "base"
> 
>     RossB> function (x, ...)  standardGeneric("print")
>     RossB> <environment: 0x84f2d88> Methods may be defined for
>     RossB> arguments: x
> 
> 
>     RossB> I've looked through the code for promptClass, but
>     RossB> nothing popped out at me.
> 
>     RossB> It may be relevant that I'm running under ESS in
>     RossB> emacs.  However, I get the same results running R
>     RossB> from the command line.
> 
>     RossB> Can anyone tell me what's going on here?  This is
>     RossB> with R 2.4, and I'm not currently using any namespace
>     RossB> for my definitions.
> 
> [and not a package either?]
The code is part of  a package, but I'm developing code snippets in
ESS without loading the whole package.
> 
> I'm very willing to look at this, once
> you've provided what the posting guide asks for, see above.
> 
> Regards,
> Martin

Thank you.  For completeness, here's some system info:

> sessionInfo()
R version 2.4.0 (2006-10-03) 
i486-pc-linux-gnu 

locale:
LC_CTYPE=en_US;LC_NUMERIC=C;LC_TIME=en_US;LC_COLLATE=en_US;LC_MONETARY=en_US;LC_MESSAGES=en_US;LC_PAPER=en_US;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US;LC_IDENTIFICATION=C

attached base packages:
[1] "methods"   "stats"     "graphics"  "grDevices" "utils"     "datasets" 
[7] "base"     

The Debian package is r-base-core 2.4.0.20061103-1.

Ross


From ross at biostat.ucsf.edu  Fri Dec  1 20:40:27 2006
From: ross at biostat.ucsf.edu (Ross Boylan)
Date: Fri, 1 Dec 2006 11:40:27 -0800
Subject: [Rd] printing coefficients with text
In-Reply-To: <17775.63285.29855.903217@stat.math.ethz.ch>
References: <20061130201755.GA8201@wheat.betterworld.us>
	<17775.63285.29855.903217@stat.math.ethz.ch>
Message-ID: <20061201194027.GZ4431@wheat.betterworld.us>

On Fri, Dec 01, 2006 at 10:34:45AM +0100, Martin Maechler wrote:
> >>>>> "RossB" == Ross Boylan <ross at biostat.ucsf.edu>
> >>>>>     on Thu, 30 Nov 2006 12:17:55 -0800 writes:
> 
>     RossB> I want to print the coefficient estimates of a model
>     RossB> in a way as consistent with other output in R as
>     RossB> possible. stats provides the printCoefmat function
>     RossB> for doing this, but there is one problem.  I have an
>     RossB> additional piece of textual information I want to put
>     RossB> on the line with the other info on each coefficient.
> 
> that's not a real problem, see below
> 
>     RossB> The documentation for printCoefmat says the first
>     RossB> argument must be numeric, which seems to rule this out.
> 
> it does say that (it says "x: a numeric matrix like object"
> 		  which includes data frames with factors)
> but you are right that it does preclude a column of "character".

Having gone through the code, it's clear the code itself requires all
numerics.

> 
>     RossB> I just realized I might be able to cheat by inserting
>     RossB> the text into the name of the variable (fortunately
>     RossB> there is just one item of text).  I think that's in
>     RossB> the names of the matrix given as the first argument
>     RossB> to the function.
> 
> yes; it's the rownames();
> i.e., you'd do something like
>       rownames(myx) <- paste(rownames(myx), format(mytext_var)))
> 
> which seems simple enough to me,
> but it only works when the "text" is the first column

This actually worked out great for me.

> 
>     RossB> Are there any better solutions?  Obviously I could
>     RossB> just copy the method and modify it, but that creates
>     RossB> duplicate code and loses the ability to track future
>     RossB> changes to printCoefmat.
> 
> As original author of printCoefmat(), I'm quite willing to
> accept and incorporate a patch to the current function
> definition (in https://svn.r-project.org/R/trunk/src/library/R/anova.R),
> if it's well written.
> 
> As a matter of fact, I think already see how to generalize printCoefmat()
> to work for the case of data frame with character columns

Yes, that seems as if it would be a good generalization.  However,
there is code that makes inferences based on the number of columns of
data, and I'm not sure how that should work.  Probably it should
ignore the non-numeric data.

> [I would not want a character matrix however; since that would mean
>  going numeric -> character -> numeric -> formatting (i.e character)
>  for the 'coefficients' themselves].
> 
> Can you send me a reproducible example?
You mean of an input data frame?  Or something else?  The input isn't
currently a data frame, but I could certainly make one.

Do you think generalizing to other types (factor, logical) would make
sense too?

> or at least an *.Rda file of a save()d such data frame?
> 
>     RossB> Thanks.  Ross Boylan
> 
> You're welcome,
> Martin Maechler, ETH Zurich


From maechler at stat.math.ethz.ch  Sat Dec  2 17:11:22 2006
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Sat, 2 Dec 2006 17:11:22 +0100
Subject: [Rd] promptClass misses methods
In-Reply-To: <20061201193320.GY4431@wheat.betterworld.us>
References: <20061201062906.GB8201@wheat.betterworld.us>
	<17776.1530.328130.767021@stat.math.ethz.ch>
	<20061201193320.GY4431@wheat.betterworld.us>
Message-ID: <17777.42410.517603.635881@stat.math.ethz.ch>

>>>>> "RossB" == Ross Boylan <ross at biostat.ucsf.edu>
>>>>>     on Fri, 1 Dec 2006 11:33:21 -0800 writes:

    RossB> On Fri, Dec 01, 2006 at 11:37:46AM +0100, Martin
    RossB> Maechler wrote:
    >> >>>>> "RossB" == Ross Boylan <ross at biostat.ucsf.edu>
    >> >>>>> on Thu, 30 Nov 2006 22:29:06 -0800 writes:
    >> 
    RossB> I've had repeated problems with promptClass missing
    RossB> methods, usually telling me a class has no methods
    RossB> when it does.
    >>
    RossB> In my current case, I've defined an S4 class
    RossB> "mspathCoefficients" with a print method
    RossB> setMethod("print", signature(x="mspathCoefficients"),
    RossB> function(x, ...)  { # etc
    >>  You should *not* define "print" methods for S4 classes;
    >> rather you should define "show" methods.

    RossB> Is that because print is used by the S3 system?  

no, not really.
    RossB> And is the general rule to avoid using S3 methods for S4
    RossB> classes?

Well your wording is murky, but no, you *should* define (S4) methods 
for S3 generics very well.  The S3 generics are automagically
promoted to S4 generics as soon as you define an S4 method for it.

print() is just a big exception.

    RossB>   For example, http://www.omegahat.org/RSMethods/Intro.pdf, which is
    RossB> referenced in the package help for methods, discusses
    RossB> show, print and plot as 3 alternatives in S4 (p. 9,
    RossB> though a footnote says that at that time--2001--R
    RossB> didn't recognize formal methods for printing
    RossB> objects.)

2001 is way in the past concerning S4 implementation in R.
Specifically, using S4 in R; we'd   **very strongly** recommend
R 2.4.0 (and ideally even R-patched) because of several recent
good developments.

    RossB> I've been unable to locate much information about
    RossB> combining S3 and S4 methods, though I recall seeing a
    RossB> note saying this issue was still to be addressed in
    RossB> R.  Perhaps it has been now, with setOldClass?  At
    RossB> any rate, the help for that method addresses classes
    RossB> rather than methods, and I didn't see anything in
    RossB> ?Methods, ?setMethod, or ?setGeneric.

    RossB> show() raises two additional issues for me.  First,
    RossB> it takes a single argument, and I want to be able to
    RossB> pass in additional arguments via ... .  

That's not possible currently.

And I agree that in certain cases, I would want to have the
flexibility of print(..) there;
One case is for printing/showing fitted LMER objects; the
following code is used :

  ## This is modeled a bit after  print.summary.lm :
  printMer <- function(x, digits = max(3, getOption("digits") - 3),
		       correlation = TRUE, symbolic.cor = x$symbolic.cor,
		       signif.stars = getOption("show.signif.stars"), ...)
  {
	  ...............
	  ...............
      invisible(x)
  }

  setMethod("print", "mer", printMer)
  setMethod("show", "mer", function(object) printMer(object))


    RossB> Second, I read some advice somewhere, that I no
    RossB> longer can find, that show methods should return an
    RossB> object and that object in turn should be the thing
    RossB> that is printed.  I don't understand the motivation
    RossB> for that rule, at least in this case, because my
    RossB> object is already a results object.

I  think you're confusing show() with summary(): The latter is
should typically compute an object which then has a print/show method.


    RossB> The file promptClass creates has no methods in it.
    >> >> showMethods(classes="mspathCoefficients")
    RossB> Function: initialize (package methods)
    RossB> .Object="mspathCoefficients" (inherited from:
    RossB> .Object="ANY")
    >>  so it's just inherited from "ANY"
    >> 
    RossB> Function: print (package base) x="mspathCoefficients"
    >>  that's the one

    RossB> So why isn't promptClass picking it up?

    >>
    RossB> Function: show (package methods)
    RossB> object="mspathCoefficients" (inherited from:
    RossB> object="ANY")
    >> so it's just inherited from "ANY"
    >> 
    >> Ross, it would really be more polite to your readers if
    >> you followed the posting guide and posted complete
    >> fully-reproducible code...

    RossB> I thought it might be overkill in this case.  

It never is. We do want self-contained executable code..
In your case, I assumed it might have been things in a namespace
in a package, ...

    RossB> At any rate, it sounds as if I may be trying to do the wrong
    RossB> thing, so I'd appreciate guidance on what the right
    RossB> thing to do is.

    RossB> Here's a toy example:

    RossB> setClass("A", representation(x="numeric"))
    RossB> setMethod("print", signature(x="A"), function(x, ...) print(x at x, ...) )
    RossB> promptClass("A")

    RossB> The generated file has no print method.
 
Indeed, I can confirm that.

    >> >> getGeneric("print")
    RossB> standardGeneric for "print" defined from package
    RossB> "base"
    >> 
    RossB> function (x, ...)  standardGeneric("print")
    RossB> <environment: 0x84f2d88> Methods may be defined for
    RossB> arguments: x
    >> 
    >> 
    RossB> I've looked through the code for promptClass, but
    RossB> nothing popped out at me.
    >> 
    RossB> It may be relevant that I'm running under ESS in
    RossB> emacs.  However, I get the same results running R
    RossB> from the command line.
    >> 
    RossB> Can anyone tell me what's going on here?  This is
    RossB> with R 2.4, and I'm not currently using any namespace
    RossB> for my definitions.

    >> [and not a package either?]
    RossB> The code is part of  a package, but I'm developing code snippets in
    RossB> ESS without loading the whole package.
    >> 
    >> I'm very willing to look at this, once
    >> you've provided what the posting guide asks for, see above.

so now that I've promissed it; I'll have to look at it ;-)
Probably too late to get a fix into R 2.4.1 though.

Martin

    RossB> Thank you.  For completeness, here's some system info:

    >> sessionInfo()
    RossB> R version 2.4.0 (2006-10-03) 
    RossB> i486-pc-linux-gnu 

    RossB> locale:
    RossB> LC_CTYPE=en_US;LC_NUMERIC=C;LC_TIME=en_US;LC_COLLATE=en_US;LC_MONETARY=en_US;LC_MESSAGES=en_US;LC_PAPER=en_US;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US;LC_IDENTIFICATION=C

    RossB> attached base packages:
    RossB> [1] "methods"   "stats"     "graphics"  "grDevices" "utils"     "datasets" 
    RossB> [7] "base"     

    RossB> The Debian package is r-base-core 2.4.0.20061103-1.

    RossB> Ross


From ross at biostat.ucsf.edu  Sat Dec  2 18:05:33 2006
From: ross at biostat.ucsf.edu (Ross Boylan)
Date: Sat, 2 Dec 2006 09:05:33 -0800
Subject: [Rd] promptClass misses methods
In-Reply-To: <17777.42410.517603.635881@stat.math.ethz.ch>
References: <20061201062906.GB8201@wheat.betterworld.us>
	<17776.1530.328130.767021@stat.math.ethz.ch>
	<20061201193320.GY4431@wheat.betterworld.us>
	<17777.42410.517603.635881@stat.math.ethz.ch>
Message-ID: <20061202170533.GA4431@wheat.betterworld.us>

On Sat, Dec 02, 2006 at 05:11:22PM +0100, Martin Maechler wrote:
> >>>>> "RossB" == Ross Boylan <ross at biostat.ucsf.edu>
> >>>>>     on Fri, 1 Dec 2006 11:33:21 -0800 writes:
> 
>     RossB> On Fri, Dec 01, 2006 at 11:37:46AM +0100, Martin
>     RossB> Maechler wrote:
>     >> >>>>> "RossB" == Ross Boylan <ross at biostat.ucsf.edu>
>     >> >>>>> on Thu, 30 Nov 2006 22:29:06 -0800 writes:
>     >> 
>     RossB> I've had repeated problems with promptClass missing
>     RossB> methods, usually telling me a class has no methods
>     RossB> when it does.
>     >>
>     RossB> In my current case, I've defined an S4 class
>     RossB> "mspathCoefficients" with a print method
>     RossB> setMethod("print", signature(x="mspathCoefficients"),
>     RossB> function(x, ...)  { # etc
>     >>  You should *not* define "print" methods for S4 classes;
>     >> rather you should define "show" methods.
> 
>     RossB> Is that because print is used by the S3 system?  
> 
> no, not really.
>     RossB> And is the general rule to avoid using S3 methods for S4
>     RossB> classes?
> 
> Well your wording is murky, but no, you *should* define (S4) methods 
> for S3 generics very well.  The S3 generics are automagically
> promoted to S4 generics as soon as you define an S4 method for it.

That answers my question.  The meaning was if "foo" is an S3 method,
should one avoid defining "foo" as an S4 method.  And the answer is
no, it's OK.  I assume one should strive to use the same argument
names, although since S3 methods don't need to use the same argument
names I'm not sure how that works (e.g. for S3
  foo.class1 <- function(x, a, b) but
  foo.class2 <- function(x, c)
). 

> 
> print() is just a big exception.
> 

How come?  

Is it an exception in the sense that it is not automatically used to
display the object, or in the sense that one should never define S4
print methods at all?  (Looks like the first alternative based on the
example later.)  The print methods I have seem to work OK, provided I
don't expect them to be called automatically and provided I don't
expect promptClass to pick them up.


>     RossB>   For example, http://www.omegahat.org/RSMethods/Intro.pdf, which is
>     RossB> referenced in the package help for methods, discusses
>     RossB> show, print and plot as 3 alternatives in S4 (p. 9,
>     RossB> though a footnote says that at that time--2001--R
>     RossB> didn't recognize formal methods for printing
>     RossB> objects.)
> 
> 2001 is way in the past concerning S4 implementation in R.

Perhaps the reference should be removed then.  Maybe the newer
http://developer.r-project.org/howMethodsWork.pdf would be better?
However, that is pitched more toward the internals, and is already
referenced in ?Methods.

> Specifically, using S4 in R; we'd   **very strongly** recommend
> R 2.4.0 (and ideally even R-patched) because of several recent
> good developments.

Fortunately that's what I'm using.  I wonder if this is so important I
should require R >= 2.4 for my package.  It was working fine in
earlier versions.  The main user visible changes I'm aware of are
those in the object forms (i.e., binary incompatibility) and some
improvements in the algorithm for choosing which method to dispatch to
(semantically, sometimes a different method gets called; it sounds
faster too).  I'm not distributing any data files with S4 class
objects, and don't have any corner cases on method dispatch.

> 
>     RossB> I've been unable to locate much information about
>     RossB> combining S3 and S4 methods, though I recall seeing a
>     RossB> note saying this issue was still to be addressed in
>     RossB> R.  Perhaps it has been now, with setOldClass?  At
>     RossB> any rate, the help for that method addresses classes
>     RossB> rather than methods, and I didn't see anything in
>     RossB> ?Methods, ?setMethod, or ?setGeneric.
> 
>     RossB> show() raises two additional issues for me.  First,
>     RossB> it takes a single argument, and I want to be able to
>     RossB> pass in additional arguments via ... .  
> 
> That's not possible currently.

In the expected use of show(), namely automatically showing an object,
additional arguments don't make sense (since there's no chance to
provide them).

If the only problem in my use of print is that it's not called
automatically, then perhaps I should leave it as is and define a show
method that invokes print().  That seems to be the pattern in the
example you provided below.

> 
> And I agree that in certain cases, I would want to have the
> flexibility of print(..) there;
> One case is for printing/showing fitted LMER objects; the
> following code is used :
> 
>   ## This is modeled a bit after  print.summary.lm :
>   printMer <- function(x, digits = max(3, getOption("digits") - 3),
> 		       correlation = TRUE, symbolic.cor = x$symbolic.cor,
> 		       signif.stars = getOption("show.signif.stars"), ...)
>   {
> 	  ...............
> 	  ...............
>       invisible(x)
>   }
> 
>   setMethod("print", "mer", printMer)
>   setMethod("show", "mer", function(object) printMer(object))
> 
> 
>     RossB> Second, I read some advice somewhere, that I no
>     RossB> longer can find, that show methods should return an
>     RossB> object and that object in turn should be the thing
>     RossB> that is printed.  I don't understand the motivation
>     RossB> for that rule, at least in this case, because my
>     RossB> object is already a results object.
> 
> I  think you're confusing show() with summary(): The latter is
> should typically compute an object which then has a print/show
> method.
Yes, that's it.  And that all makes sense.
> 
> 
>     RossB> The file promptClass creates has no methods in it.
>     >> >> showMethods(classes="mspathCoefficients")
>     RossB> Function: initialize (package methods)
>     RossB> .Object="mspathCoefficients" (inherited from:
>     RossB> .Object="ANY")
>     >>  so it's just inherited from "ANY"
>     >> 
>     RossB> Function: print (package base) x="mspathCoefficients"
>     >>  that's the one
> 
>     RossB> So why isn't promptClass picking it up?
> 
>     >>
>     RossB> Function: show (package methods)
>     RossB> object="mspathCoefficients" (inherited from:
>     RossB> object="ANY")
>     >> so it's just inherited from "ANY"
>     >> 
>     >> Ross, it would really be more polite to your readers if
>     >> you followed the posting guide and posted complete
>     >> fully-reproducible code...
> 
>     RossB> I thought it might be overkill in this case.  
> 
> It never is. We do want self-contained executable code..
> In your case, I assumed it might have been things in a namespace
> in a package, ...
> 
>     RossB> At any rate, it sounds as if I may be trying to do the wrong
>     RossB> thing, so I'd appreciate guidance on what the right
>     RossB> thing to do is.
> 
>     RossB> Here's a toy example:
> 
>     RossB> setClass("A", representation(x="numeric"))
>     RossB> setMethod("print", signature(x="A"), function(x, ...) print(x at x, ...) )
>     RossB> promptClass("A")
> 
>     RossB> The generated file has no print method.
>  
> Indeed, I can confirm that.
> 
>     >> >> getGeneric("print")
>     RossB> standardGeneric for "print" defined from package
>     RossB> "base"
>     >> 
>     RossB> function (x, ...)  standardGeneric("print")
>     RossB> <environment: 0x84f2d88> Methods may be defined for
>     RossB> arguments: x
>     >> 
>     >> 
>     RossB> I've looked through the code for promptClass, but
>     RossB> nothing popped out at me.
>     >> 
>     RossB> It may be relevant that I'm running under ESS in
>     RossB> emacs.  However, I get the same results running R
>     RossB> from the command line.
>     >> 
>     RossB> Can anyone tell me what's going on here?  This is
>     RossB> with R 2.4, and I'm not currently using any namespace
>     RossB> for my definitions.
> 
>     >> [and not a package either?]
>     RossB> The code is part of  a package, but I'm developing code snippets in
>     RossB> ESS without loading the whole package.
>     >> 
>     >> I'm very willing to look at this, once
>     >> you've provided what the posting guide asks for, see above.
> 
> so now that I've promissed it; I'll have to look at it ;-)
> Probably too late to get a fix into R 2.4.1 though.

Ah, so the lack of a print method in the promptClass output is a bug?

Ross


From 505bucky at luxig.de  Sat Dec  2 17:57:52 2006
From: 505bucky at luxig.de ((270) 818-7244 Leanne )
Date: Sat, 2 Dec 2006 18:57:52 +0200
Subject: [Rd] You Need a Better Degree,{} and we can Hlep!
Message-ID: <75356017576178.46EB9ED506@OB2J>

Hey R-devel!!!
Absolutley are no set tests, classes, books, or interviews !



Gain a_Bachelors, Masters., MB,A and Doctorate (PhD) diploma.



Masetr the rewards an drespect_that comes with a.diploma !


Nobody is turend away





Anonymity nesured

Receive Whenever +1    (270) 818-7244
Operators Online Now

-----------------------------














his family. "Don't drink, fools! Not that muck." The centurion orderedseductive  of  all  and  the most mad, Live. He still wore his child'sof their leaders. And messengers are coming-bringing terms and, for us


From sfalcon at fhcrc.org  Sat Dec  2 20:03:51 2006
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Sat, 02 Dec 2006 11:03:51 -0800
Subject: [Rd] promptClass misses methods
In-Reply-To: <20061202170533.GA4431@wheat.betterworld.us> (Ross Boylan's
	message of "Sat, 2 Dec 2006 09:05:33 -0800")
References: <20061201062906.GB8201@wheat.betterworld.us>
	<17776.1530.328130.767021@stat.math.ethz.ch>
	<20061201193320.GY4431@wheat.betterworld.us>
	<17777.42410.517603.635881@stat.math.ethz.ch>
	<20061202170533.GA4431@wheat.betterworld.us>
Message-ID: <m2mz666rxk.fsf@ziti.fhcrc.org>

Ross Boylan <ross at biostat.ucsf.edu> writes:
> That answers my question.  The meaning was if "foo" is an S3 method,
> should one avoid defining "foo" as an S4 method.  And the answer is
> no, it's OK.  I assume one should strive to use the same argument
> names, although since S3 methods don't need to use the same argument
> names I'm not sure how that works (e.g. for S3
>   foo.class1 <- function(x, a, b) but
>   foo.class2 <- function(x, c)
> ). 

I believe you _must_ use the same arguments.  When calling
setMethod("foo", ...) where foo is a function, but not a
standardGeneric, the function foo becomes the default for a newly
created generic and the signature for the new generic is taken from
the formal arguments of the original function foo.  Clear as mud?

If you want to use different argument names, then you want your own
generic.  That is ok, IMO.  That is why we have name spaces.  It only
makes sense to set a method on an existing function (plain function,
S3, or S4 generic) if it "means" the same thing [this is obviously
fuzzy].  IMO, there is no benefit of sharing a generic or having a
default function on a generic that doesn't make sense.

Here's an example of creating a generic out of the head function:

    > setClass("FOO", representation(x="character"))
    [1] "FOO"
    > getGeneric("head")
    NULL
    > args(head)
    function (x, ...) 
    NULL
    > setMethod("head", "FOO", function(x, ...) x at x[1:10])
    Creating a new generic function for "head" in ".GlobalEnv"
    [1] "head"
    > getGeneric("head")
    standardGeneric for "head" defined from package "utils"
    
    function (x, ...) 
    standardGeneric("head")
    <environment: 0x1d56600>
    Methods may be defined for arguments: x 

Now head() is a good example because it means something like "show me
the first part of something".  But your application might want a
function named head that meant "what's attached to the neck of an
animal".  In that case, a new generic within your package's name space
seems advisable.

+ seth


From murdoch at stats.uwo.ca  Sat Dec  2 21:14:53 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Sat, 02 Dec 2006 15:14:53 -0500
Subject: [Rd] Non central chi squared bug (PR#9406)
In-Reply-To: <45701046.2050703@stats.uwo.ca>
References: <20061201104434.3B2B9572A4@slim.kubism.ku.dk>
	<45701046.2050703@stats.uwo.ca>
Message-ID: <4571DEBD.2040402@stats.uwo.ca>

On 12/1/2006 6:21 AM, Duncan Murdoch wrote:
> On 12/1/2006 5:44 AM, alan.bain at gmail.com wrote:
>> Full_Name: Alan Bain 
>> Version: 2.4.0
>> OS: XP
>> Submission from: (NULL) (155.140.122.227)
>>
>>
>>
>> Code for pnchisq contains following
>>
>> if (tSml) {
>>
>> if (x> f+ theta+ 5*sqrt(2*(f+2*theta) ))){
>>      return 1.; /* better than 0 --- but definately FIXME */
>> }
>>
>> }
>>
>> This needs to check which tail has been requested; it is only correct if the
>> default lower_tail=1 has been requested; for upper tail should return 0 if more
>> than 5 std devs away from mean under these circumstances.
> 
> Could you post a test case to demonstrate this?  I don't see it:
> 
>  > pchisq(1000, 2, 1, FALSE)
> [1] 1.720202e-205
>  > pchisq(10000, 2, 1, FALSE)
> [1] 0
>  > pchisq(100000, 2, 1, FALSE)
> [1] 0
>  > pchisq(1000000, 2, 1, FALSE)
> [1] 0

Offline Alan told me that this only affects ncp > 80; I've fixed it (and 
a couple of other extreme cases) and will commit once testing is done.

Duncan Murdoch


From murdoch at stats.uwo.ca  Sat Dec  2 21:15:42 2006
From: murdoch at stats.uwo.ca (murdoch at stats.uwo.ca)
Date: Sat,  2 Dec 2006 21:15:42 +0100 (CET)
Subject: [Rd] Non central chi squared bug (PR#9406)
Message-ID: <20061202201542.A0E9C572AE@slim.kubism.ku.dk>

On 12/1/2006 6:21 AM, Duncan Murdoch wrote:
> On 12/1/2006 5:44 AM, alan.bain at gmail.com wrote:
>> Full_Name: Alan Bain 
>> Version: 2.4.0
>> OS: XP
>> Submission from: (NULL) (155.140.122.227)
>>
>>
>>
>> Code for pnchisq contains following
>>
>> if (tSml) {
>>
>> if (x> f+ theta+ 5*sqrt(2*(f+2*theta) ))){
>>      return 1.; /* better than 0 --- but definately FIXME */
>> }
>>
>> }
>>
>> This needs to check which tail has been requested; it is only correct if the
>> default lower_tail=1 has been requested; for upper tail should return 0 if more
>> than 5 std devs away from mean under these circumstances.
> 
> Could you post a test case to demonstrate this?  I don't see it:
> 
>  > pchisq(1000, 2, 1, FALSE)
> [1] 1.720202e-205
>  > pchisq(10000, 2, 1, FALSE)
> [1] 0
>  > pchisq(100000, 2, 1, FALSE)
> [1] 0
>  > pchisq(1000000, 2, 1, FALSE)
> [1] 0

Offline Alan told me that this only affects ncp > 80; I've fixed it (and 
a couple of other extreme cases) and will commit once testing is done.

Duncan Murdoch


From edd at debian.org  Sun Dec  3 02:24:19 2006
From: edd at debian.org (Dirk Eddelbuettel)
Date: Sat, 2 Dec 2006 19:24:19 -0600
Subject: [Rd] R 2.4.1 scheduled for December 18
In-Reply-To: <45702761.4010806@biostat.ku.dk>
References: <45702761.4010806@biostat.ku.dk>
Message-ID: <17778.10051.777697.529733@basebud.nulle.part>


On 1 December 2006 at 14:00, Peter Dalgaard wrote:
| The R Core Team has decided to aim for the release of 2.4.1 on Monday
| December 18. This involves a feature freeze on Monday the 4th and code
| freeze on Monday 11th. Automated builds of beta release and release
| candidate tarballs will be available from the 5th and the 12th,
| respectively.
| 
| It is not expected that many changes will occur relative to the current
| R-patched version, but as always:
| 
| --->  Bugs reported before the release have a better chance of getting
| fixed soon. <---
 
FWIW, a R-patched snapshot (of Nov 25) is also in Debian unstable and
provides an easy one-shot 'apt-get install' way to test a new-ish R.
Following past practice, I also intend to release one or two release
candidates for 2.4.1 prior to its release.

Regards, Dirk

-- 
I am sorry if I replied later than usually to your email, but for the last
few days Comcast acted as an Internet NON-Service provider. -- Dirk


From christos at nuverabio.com  Sun Dec  3 07:17:29 2006
From: christos at nuverabio.com (Christos Hatzis)
Date: Sun, 3 Dec 2006 01:17:29 -0500
Subject: [Rd] passing matrix as argument to a C function
Message-ID: <003a01c716a2$b6828ab0$0202a8c0@headquarters.silicoinsights>

Hi,
 
Although this is not directly an R-related question, it is relevant as I am
trying to port some R code to C to speed things up in a computation.

I am working through my first attempts to generate and link compiled C code
in R.  I could make the 'convolve' function to work and similar functions
that take vectors as arguments.  In my application I need to pass a couple
of matrices to the C function and could not figure out how to make it work
in C.
 
As an example, I tried to code first a simple matrix-vector product
function.  Here is my code:

void matrix_mult( double **A, double *b, double *ab, int *nrow, int *ncol )
{
    int i, j, nr = *nrow, nc = *ncol;
    for( i = 0; i < nr; i++ )
    {
        ab[i] = 0.0;
        for( j = 0; j < nc; j++ )
            ab[i] += A[i][j] * b[j];
    }
} 
 
As I understand, passing the matrix A as (double **) is not standard C and
does not compile (to try things out I am using Microsoft Visual C++ compiler
in Windows XP).  I tried to find the C code for crossprod for some hints,
but could not locate it in the R source.  But probably this does not use the
.C interface.

Is there a way this can be done with .C?  I suspect it will use in some way
the "vector of pointers to row vectors" concept, but I am not familiar
enough in C yet to figure it out.  Any hints on how in can be done with
.Call if easier?

Thank you.
-Christos  

Christos Hatzis, Ph.D.
Nuvera Biosciences, Inc.
400 West Cummings Park
Suite 5350
Woburn, MA 01801
Tel: 781-938-3830
www.nuverabio.com <http://www.nuverabio.com/>


From ripley at stats.ox.ac.uk  Sun Dec  3 09:25:09 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sun, 3 Dec 2006 08:25:09 +0000 (GMT)
Subject: [Rd] passing matrix as argument to a C function
In-Reply-To: <003a01c716a2$b6828ab0$0202a8c0@headquarters.silicoinsights>
References: <003a01c716a2$b6828ab0$0202a8c0@headquarters.silicoinsights>
Message-ID: <Pine.LNX.4.64.0612030815290.3004@gannet.stats.ox.ac.uk>

The data in an R matrix is not stored as double **A, but as double *A: it 
is just a vector in R, with attributes.

There are lots of examples of manipulating R matrixes via .C: one is 
src/library/stats/src/kmeans.c.

The code for crossprod is not at all hard to find: it is in 
src/main/array.c.  However, is just a call to an LAPACK function.
The code there for matprod would be more informative.

On Sun, 3 Dec 2006, Christos Hatzis wrote:

> Hi,
>
> Although this is not directly an R-related question, it is relevant as I am
> trying to port some R code to C to speed things up in a computation.
>
> I am working through my first attempts to generate and link compiled C code
> in R.  I could make the 'convolve' function to work and similar functions
> that take vectors as arguments.  In my application I need to pass a couple
> of matrices to the C function and could not figure out how to make it work
> in C.
>
> As an example, I tried to code first a simple matrix-vector product
> function.  Here is my code:
>
> void matrix_mult( double **A, double *b, double *ab, int *nrow, int *ncol )
> {
>    int i, j, nr = *nrow, nc = *ncol;
>    for( i = 0; i < nr; i++ )
>    {
>        ab[i] = 0.0;
>        for( j = 0; j < nc; j++ )
>            ab[i] += A[i][j] * b[j];
>    }
> }
>
> As I understand, passing the matrix A as (double **) is not standard C and
> does not compile (to try things out I am using Microsoft Visual C++ compiler
> in Windows XP).  I tried to find the C code for crossprod for some hints,
> but could not locate it in the R source.  But probably this does not use the
> .C interface.
>
> Is there a way this can be done with .C?  I suspect it will use in some way
> the "vector of pointers to row vectors" concept, but I am not familiar
> enough in C yet to figure it out.  Any hints on how in can be done with
> .Call if easier?
>
> Thank you.
> -Christos
>
> Christos Hatzis, Ph.D.
> Nuvera Biosciences, Inc.
> 400 West Cummings Park
> Suite 5350
> Woburn, MA 01801
> Tel: 781-938-3830
> www.nuverabio.com <http://www.nuverabio.com/>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Sun Dec  3 15:27:23 2006
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Sun,  3 Dec 2006 15:27:23 +0100 (CET)
Subject: [Rd] bug in acosh (win32) (PR#9403)
Message-ID: <20061203142723.DF37B572B3@slim.kubism.ku.dk>

This is a bug in the mingw runtime, and not in R.  So the difference is 
between OSes, not between R versions.  Note that

> acosh(2)
[1] 1.316958
> acosh(2+0i)
[1] 0+NaNi
> acosh(2+1e-10i)
[1] 1.316958+0i

so it seems to be happening only for exactly real complex numbers.
I think there are also problems with branch cuts.


On Thu, 30 Nov 2006, tshort at eprisolutions.com wrote:

> Full_Name: Tom Short
> Version: 2.4.0
> OS: Windows XP
> Submission from: (NULL) (68.236.159.227)
>
>
> It looks like there's a bug in acosh with complex number in windows:
>
>> acosh(2)
> [1] 1.316958
>> acosh(2+0i)
> [1] 0+NaNi
>
> This happens for me on Windows XP with the following versions:
> R version 2.2.0, 2005-10-06, i386-pc-mingw32
> R version 2.4.0 (2006-10-03) i386-pc-mingw32
>
> It works fine with the following:
> R version 2.4.0 (2006-10-03) i386-pc-linux-gnu (debian)
> R version 2.1.0, 2005-04-18, i386-pc-linux-gnu (debian)
>
>> acosh(2+0i)
> [1] 1.316958+0i
>
> I didn't find any problem with asinh or atanh taking complex numbers. In
> src/main/complex.c, there are some #ifdef Win32's in z_asin and z_acos, so it
> may be related to that.

acosh is unrelated to those.

> - Tom
>
> Tom Short
> EPRI Solutions, Inc.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From christos at nuverabio.com  Sun Dec  3 17:47:45 2006
From: christos at nuverabio.com (Christos Hatzis)
Date: Sun, 3 Dec 2006 11:47:45 -0500
Subject: [Rd] passing matrix as argument to a C function
In-Reply-To: <Pine.LNX.4.64.0612030815290.3004@gannet.stats.ox.ac.uk>
Message-ID: <000f01c716fa$c26ee0f0$0202a8c0@headquarters.silicoinsights>

Thank you.  The code in kmeans.c is indeed informative.  One needs to
remember that an R matrix is a vector with attributes.

-Christos 

-----Original Message-----
From: Prof Brian Ripley [mailto:ripley at stats.ox.ac.uk] 
Sent: Sunday, December 03, 2006 3:25 AM
To: Christos Hatzis
Cc: r-devel at r-project.org
Subject: Re: [Rd] passing matrix as argument to a C function

The data in an R matrix is not stored as double **A, but as double *A: it is
just a vector in R, with attributes.

There are lots of examples of manipulating R matrixes via .C: one is
src/library/stats/src/kmeans.c.

The code for crossprod is not at all hard to find: it is in
src/main/array.c.  However, is just a call to an LAPACK function.
The code there for matprod would be more informative.

On Sun, 3 Dec 2006, Christos Hatzis wrote:

> Hi,
>
> Although this is not directly an R-related question, it is relevant as 
> I am trying to port some R code to C to speed things up in a computation.
>
> I am working through my first attempts to generate and link compiled C 
> code in R.  I could make the 'convolve' function to work and similar 
> functions that take vectors as arguments.  In my application I need to 
> pass a couple of matrices to the C function and could not figure out 
> how to make it work in C.
>
> As an example, I tried to code first a simple matrix-vector product 
> function.  Here is my code:
>
> void matrix_mult( double **A, double *b, double *ab, int *nrow, int 
> *ncol ) {
>    int i, j, nr = *nrow, nc = *ncol;
>    for( i = 0; i < nr; i++ )
>    {
>        ab[i] = 0.0;
>        for( j = 0; j < nc; j++ )
>            ab[i] += A[i][j] * b[j];
>    }
> }
>
> As I understand, passing the matrix A as (double **) is not standard C 
> and does not compile (to try things out I am using Microsoft Visual 
> C++ compiler in Windows XP).  I tried to find the C code for crossprod 
> for some hints, but could not locate it in the R source.  But probably 
> this does not use the .C interface.
>
> Is there a way this can be done with .C?  I suspect it will use in 
> some way the "vector of pointers to row vectors" concept, but I am not 
> familiar enough in C yet to figure it out.  Any hints on how in can be 
> done with .Call if easier?
>
> Thank you.
> -Christos
>
> Christos Hatzis, Ph.D.
> Nuvera Biosciences, Inc.
> 400 West Cummings Park
> Suite 5350
> Woburn, MA 01801
> Tel: 781-938-3830
> www.nuverabio.com <http://www.nuverabio.com/>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From edd at debian.org  Sun Dec  3 18:47:21 2006
From: edd at debian.org (Dirk Eddelbuettel)
Date: Sun, 3 Dec 2006 11:47:21 -0600
Subject: [Rd] passing matrix as argument to a C function
In-Reply-To: <000f01c716fa$c26ee0f0$0202a8c0@headquarters.silicoinsights>
References: <Pine.LNX.4.64.0612030815290.3004@gannet.stats.ox.ac.uk>
	<000f01c716fa$c26ee0f0$0202a8c0@headquarters.silicoinsights>
Message-ID: <17779.3497.873303.970110@basebud.nulle.part>


On 3 December 2006 at 11:47, Christos Hatzis wrote:
| Thank you.  The code in kmeans.c is indeed informative.  One needs to
| remember that an R matrix is a vector with attributes.

In case there is any chance that you could turn your part of the source from
C into C++, try RcppTemplate from CRAN --- it makes interfacing R and C++ a
whole lot easier.  I cannot recommend it highly enough. 

But if you don't yet know C++ it provides yet another learning curve so you
may not want to go there quite yet...

Dirk

-- 
Hell, there are no rules here - we're trying to accomplish something. 
                                                  -- Thomas A. Edison


From gregor.gorjanc at bfro.uni-lj.si  Sun Dec  3 20:52:45 2006
From: gregor.gorjanc at bfro.uni-lj.si (Gregor Gorjanc)
Date: Sun, 3 Dec 2006 19:52:45 +0000 (UTC)
Subject: [Rd] R 2.4.1 scheduled for December 18
References: <45702761.4010806@biostat.ku.dk>
Message-ID: <loom.20061203T202732-76@post.gmane.org>

Hi!

If I am not wrong issue described at

http://thread.gmane.org/gmane.comp.lang.r.devel/9667/focus=9667

did not get any attention. Thought it is true that using names() instead of
colnames() does not change mode of data.frame rownames.

This issues are also "alive": 

http://thread.gmane.org/gmane.comp.lang.r.devel/9837/focus=9837
http://thread.gmane.org/gmane.comp.lang.r.devel/7540/focus=7540
http://thread.gmane.org/gmane.comp.lang.r.devel/8513/focus=8518

Thanks, Gregor


From christos at nuverabio.com  Sun Dec  3 22:17:36 2006
From: christos at nuverabio.com (Christos Hatzis)
Date: Sun, 3 Dec 2006 16:17:36 -0500
Subject: [Rd] passing matrix as argument to a C function
In-Reply-To: <17779.3497.873303.970110@basebud.nulle.part>
Message-ID: <001101c71720$7576a2d0$0202a8c0@headquarters.silicoinsights>

Thank you, Dirk.  I'll keep this in mind.

-Christos 

-----Original Message-----
From: Dirk Eddelbuettel [mailto:edd at debian.org] 
Sent: Sunday, December 03, 2006 12:47 PM
To: christos at nuverabio.com
Cc: 'Prof Brian Ripley'; r-devel at r-project.org
Subject: Re: [Rd] passing matrix as argument to a C function


On 3 December 2006 at 11:47, Christos Hatzis wrote:
| Thank you.  The code in kmeans.c is indeed informative.  One needs to 
| remember that an R matrix is a vector with attributes.

In case there is any chance that you could turn your part of the source from
C into C++, try RcppTemplate from CRAN --- it makes interfacing R and C++ a
whole lot easier.  I cannot recommend it highly enough. 

But if you don't yet know C++ it provides yet another learning curve so you
may not want to go there quite yet...

Dirk

--
Hell, there are no rules here - we're trying to accomplish something. 
                                                  -- Thomas A. Edison


From tshort at eprisolutions.com  Mon Dec  4 04:12:19 2006
From: tshort at eprisolutions.com (tshort)
Date: Sun, 3 Dec 2006 19:12:19 -0800 (PST)
Subject: [Rd] bug in acosh (win32) (PR#9403)
In-Reply-To: <20061203142723.DF37B572B3@slim.kubism.ku.dk>
References: <20061130140947.48027103EA@slim.kubism.ku.dk>
	<20061203142723.DF37B572B3@slim.kubism.ku.dk>
Message-ID: <7670239.post@talk.nabble.com>


> This is a bug in the mingw runtime, and not in R.  So the difference is 
> between OSes, not between R versions.  Note that
> 
> > acosh(2)
> [1] 1.316958
> > acosh(2+0i)
> [1] 0+NaNi
> > acosh(2+1e-10i)
> [1] 1.316958+0i
> 
> so it seems to be happening only for exactly real complex numbers.
> I think there are also problems with branch cuts.
> 

Interesting. Unfortunately, that's a common scenerio to convert to
complex numbers to ensure complex output if appropriate:
acosh(as.complex(-2))

I guess acosh(as.complex(x) + 1e-10i) is a bit better than my current
workaround of:

myacosh <- function(x) log(x + sqrt(x^2 - 1))

> 
> On Thu, 30 Nov 2006, tshort at eprisolutions.com wrote:
> 
> > Full_Name: Tom Short
> > Version: 2.4.0
> > OS: Windows XP
> > Submission from: (NULL) (68.236.159.227)
> >
> >
> > It looks like there's a bug in acosh with complex number in windows:
> >
> >> acosh(2)
> > [1] 1.316958
> >> acosh(2+0i)
> > [1] 0+NaNi
> >
> > This happens for me on Windows XP with the following versions:
> > R version 2.2.0, 2005-10-06, i386-pc-mingw32
> > R version 2.4.0 (2006-10-03) i386-pc-mingw32
> >
> > It works fine with the following:
> > R version 2.4.0 (2006-10-03) i386-pc-linux-gnu (debian)
> > R version 2.1.0, 2005-04-18, i386-pc-linux-gnu (debian)
> >
> >> acosh(2+0i)
> > [1] 1.316958+0i
> >
> > I didn't find any problem with asinh or atanh taking complex numbers. In
> > src/main/complex.c, there are some #ifdef Win32's in z_asin and z_acos,
> so it
> > may be related to that.
> 
> acosh is unrelated to those.

According to this:
http://mingw.cvs.sourceforge.net/mingw/runtime/mingwex/complex/cacosh.c?view=markup
cacosh uses either casin or cacos, so it looks like they are
related. And, the ifdef's for z_acos and z_asin both say "broken for
cabs(*z) >= 1", matching this:

> acosh(.99+0i)
[1] 0+0.1415395i
> acosh(1.01+0i)
[1] 0+NaNi

That also turned up a similar bug in mingw's asinh, this time with
real and imaginary components swapped:

> asinh(2i)
[1] 0+NaNi
> asinh(1e-10 + 2i)
[1] 1.316958+1.570796i

- Tom
Tom Short
EPRI Solutions, Inc.

> > - Tom
> >
> > Tom Short
> > EPRI Solutions, Inc.
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >
> 
> -- 
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 

-- 
View this message in context: http://www.nabble.com/bug-in-acosh-%28win32%29-%28PR-9403%29-tf2731987.html#a7670239
Sent from the R devel mailing list archive at Nabble.com.


From alex.deckmyn$oma.be at pubhealth.ku.dk  Mon Dec  4 11:21:44 2006
From: alex.deckmyn$oma.be at pubhealth.ku.dk (alex.deckmyn$oma.be at pubhealth.ku.dk)
Date: Mon,  4 Dec 2006 11:21:44 +0100 (CET)
Subject: [Rd] erroneous warning in hist (PR#9408)
Message-ID: <20061204102144.B2CC3572FE@slim.kubism.ku.dk>

Full_Name: Alex Deckmyn
Version: 2.4.0
OS: linux
Submission from: (NULL) (193.190.63.62)


specifying the "right" option in hist results in a warning when plot=F. The
option is taken into account correctly, but a warning is issued anyway. When
plot=T there is no warning.

> hist(c(1,1.5),breaks=0:4)$counts
[1] 1 1 0 0
> hist(c(1,1.5),breaks=0:4,right=T)$counts
[1] 1 1 0 0
> hist(c(1,1.5),breaks=0:4,plot=F)$counts
[1] 1 1 0 0
> hist(c(1,1.5),breaks=0:4,right=T,plot=F)$counts
[1] 1 1 0 0
Warning message:
argument 'right' is not made use of in: hist.default(c(1, 1.5), breaks = 0:4,
right = T, plot = F) 
> hist(c(1,1.5),breaks=0:4,right=F,plot=F)$counts
[1] 0 2 0 0
Warning message:
argument 'right' is not made use of in: hist.default(c(1, 1.5), breaks = 0:4,
right = F, plot = F) 
>


From ripley at stats.ox.ac.uk  Mon Dec  4 14:41:28 2006
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Mon,  4 Dec 2006 14:41:28 +0100 (CET)
Subject: [Rd] erroneous warning in hist (PR#9408)
Message-ID: <20061204134128.8543E57313@slim.kubism.ku.dk>

This seems to be the same as

     o   hist(*, include.lowest=., right=., plot=FALSE) does not warn
         anymore, (PR#9356) and more.

already fixed in R-patched.

On Mon, 4 Dec 2006, alex.deckmyn$oma.be at pubhealth.ku.dk wrote:

> Full_Name: Alex Deckmyn
> Version: 2.4.0
> OS: linux
> Submission from: (NULL) (193.190.63.62)
>
>
> specifying the "right" option in hist results in a warning when plot=F. The
> option is taken into account correctly, but a warning is issued anyway. When
> plot=T there is no warning.
>
>> hist(c(1,1.5),breaks=0:4)$counts
> [1] 1 1 0 0
>> hist(c(1,1.5),breaks=0:4,right=T)$counts
> [1] 1 1 0 0
>> hist(c(1,1.5),breaks=0:4,plot=F)$counts
> [1] 1 1 0 0
>> hist(c(1,1.5),breaks=0:4,right=T,plot=F)$counts
> [1] 1 1 0 0
> Warning message:
> argument 'right' is not made use of in: hist.default(c(1, 1.5), breaks = 0:4,
> right = T, plot = F)
>> hist(c(1,1.5),breaks=0:4,right=F,plot=F)$counts
> [1] 0 2 0 0
> Warning message:
> argument 'right' is not made use of in: hist.default(c(1, 1.5), breaks = 0:4,
> right = F, plot = F)
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From maechler at stat.math.ethz.ch  Mon Dec  4 15:23:02 2006
From: maechler at stat.math.ethz.ch (maechler at stat.math.ethz.ch)
Date: Mon,  4 Dec 2006 15:23:02 +0100 (CET)
Subject: [Rd] erroneous warning in hist (PR#9408)
Message-ID: <20061204142302.3B6165730D@slim.kubism.ku.dk>

>>>>> "AlexD" == oma be <alex.deckmyn>
>>>>>     on Mon,  4 Dec 2006 11:21:44 +0100 (CET) writes:

    AlexD> Full_Name: Alex Deckmyn Version: 2.4.0 OS: linux
    AlexD> Submission from: (NULL) (193.190.63.62)


    AlexD> specifying the "right" option in hist results in a
    AlexD> warning when plot=F. The option is taken into account
    AlexD> correctly, but a warning is issued anyway. When
    AlexD> plot=T there is no warning.

    >> hist(c(1,1.5),breaks=0:4)$counts
    AlexD> [1] 1 1 0 0
    >> hist(c(1,1.5),breaks=0:4,right=T)$counts
    AlexD> [1] 1 1 0 0
    >> hist(c(1,1.5),breaks=0:4,plot=F)$counts
    AlexD> [1] 1 1 0 0
    >> hist(c(1,1.5),breaks=0:4,right=T,plot=F)$counts
    AlexD> [1] 1 1 0 0 Warning message: argument 'right' is not
    AlexD> made use of in: hist.default(c(1, 1.5), breaks = 0:4,
    AlexD> right = T, plot = F)
    >> hist(c(1,1.5),breaks=0:4,right=F,plot=F)$counts
    AlexD> [1] 0 2 0 0 Warning message: argument 'right' is not
    AlexD> made use of in: hist.default(c(1, 1.5), breaks = 0:4,
    AlexD> right = F, plot = F)

You are right that this happens with R 2.4.0 
and you are right that this is a buglet.

However you are wrong reporting this as a bug, since it has
been fixed quite a while ago; and we would like you to try
things in R-patched or R-devel before reporting as bug;
If you cannot use such "cutting edge" versions of R,
then please just ``report'' such things  on R-devel (but not
R-bugs) or R-help.

All this has been in the R-FAQ for many years.

Regards,
Martin


From tpapp at Princeton.EDU  Mon Dec  4 18:10:42 2006
From: tpapp at Princeton.EDU (Tamas K Papp)
Date: Mon, 4 Dec 2006 12:10:42 -0500
Subject: [Rd] book for the reluctant C programmer
Message-ID: <20061204171042.GA2570@pu100877.student.princeton.edu>

Dear R experts,

I have started recoding bottlenecks of my R program in C.  When doing
so, I realized that my C knowledge is a bit rusty: the last time I
used (or dabbled in) this language was 12 years ago, and I seem to
have forgotten quite a bit, and the language also evolved since.

Please recommend books for brushing up on my C knowledge, if possible,
ones that are clear and use recent C like C99 (if you think that makes
sense).  I only expect to write 10-20 line routines to be called from
R, but I think that having clear concepts and foundations would help
me do it better.

Thanks,

Tamas


From christos at nuverabio.com  Mon Dec  4 22:42:48 2006
From: christos at nuverabio.com (Christos Hatzis)
Date: Mon, 4 Dec 2006 16:42:48 -0500
Subject: [Rd] Library file for the R engine in Windows?
Message-ID: <004601c717ed$24e90f10$0e010a0a@headquarters.silicoinsights>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20061204/88c401a9/attachment.pl 

From neoscopio at gmail.com  Tue Dec  5 00:51:19 2006
From: neoscopio at gmail.com (neoscopio at gmail.com)
Date: Tue,  5 Dec 2006 00:51:19 +0100 (CET)
Subject: [Rd] Error importing data (PR#9409)
Message-ID: <20061204235119.3BE955733D@slim.kubism.ku.dk>

Full_Name: Miguel Andrade
Version: 2.3.1
OS: Linux
Submission from: (NULL) (213.63.192.244)


$platform
[1] "i486-pc-linux-gnu"
$arch
[1] "i486"
$os
[1] "linux-gnu"
$system
[1] "i486, linux-gnu"
$status
[1] ""
$major
[1] "2"
$minor
[1] "3.1"
$year
[1] "2006"
$month
[1] "06"
$day
[1] "01"
$`svn rev`
[1] "38247"
$language
[1] "R"
$version.string
[1] "Version 2.3.1 (2006-06-01)"


Description:

When importing data with like read.table("data.csv",blank.lines.skip = FALSE)
Gives an error if first line is blank: "Empty beginning of file"

This is not wanted, as the case someone needs to fill a blank value as a first
case. This is useful to import data to a variable in a dataset. If first line is
not blank, then it behaves normally.


From christos at nuverabio.com  Tue Dec  5 07:38:19 2006
From: christos at nuverabio.com (Christos Hatzis)
Date: Tue, 5 Dec 2006 01:38:19 -0500
Subject: [Rd] Library file for the R engine in Windows?
Message-ID: <000b01c71837$f4d95460$0202a8c0@headquarters.silicoinsights>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20061205/2572157b/attachment.pl 

From ripley at stats.ox.ac.uk  Tue Dec  5 07:42:10 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 5 Dec 2006 06:42:10 +0000 (GMT)
Subject: [Rd] Library file for the R engine in Windows?
In-Reply-To: <004601c717ed$24e90f10$0e010a0a@headquarters.silicoinsights>
References: <004601c717ed$24e90f10$0e010a0a@headquarters.silicoinsights>
Message-ID: <Pine.LNX.4.64.0612050638370.7721@gannet.stats.ox.ac.uk>

This is discussed in README.packages: yes you do need to build an import 
library for VC++6 (don't know for sure about later versions).  The 
recommended route is to build it from the sources, but pexports.exe from 
mingw-utils can usually be used.

On Mon, 4 Dec 2006, Christos Hatzis wrote:

> Hi,
>
> I am trying to use dynamic memory allocation in the C code to be called by R
> through the .C interface.
> I have used R_alloc as explained in the Writing R Extensions and included
> the R.h header.
> The program compiles fine but fails when linking.  Obviously it needs a
> library file where R_alloc is found.
> I have tried to link by adding R.dll to list of files at the end of the link
> command but that did not work either.
>
> The S Programming book mentions that a library Rdll.lib needs to be built
> from source, but I am not sure
> if this is still the recommended route.
>
> I am using Microsoft Visual C++ Toolkit in Windows XP Pro.
> Thank you for any advice.
>
> Christos Hatzis, Ph.D.
> Nuvera Biosciences, Inc.
> 400 West Cummings Park
> Suite 5350
> Woburn, MA 01801
> Tel: 781-938-3830
> www.nuverabio.com <http://www.nuverabio.com/>
>
>
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ligges at statistik.uni-dortmund.de  Tue Dec  5 10:44:22 2006
From: ligges at statistik.uni-dortmund.de (Uwe Ligges)
Date: Tue, 05 Dec 2006 10:44:22 +0100
Subject: [Rd] Error importing data (PR#9409)
In-Reply-To: <20061204235119.3BE955733D@slim.kubism.ku.dk>
References: <20061204235119.3BE955733D@slim.kubism.ku.dk>
Message-ID: <45753F76.2010409@statistik.uni-dortmund.de>

Please, how do you define a "blank" value?

The following works perfectly for me:

File looks like:

SpaceTabSpace
1Tab2


R> read.table(file, sep="\t")
   V1 V2
1 NA NA
2  1  2


Uwe Ligges


neoscopio at gmail.com wrote:
> Full_Name: Miguel Andrade
> Version: 2.3.1
> OS: Linux
> Submission from: (NULL) (213.63.192.244)
> 
> 
> $platform
> [1] "i486-pc-linux-gnu"
> $arch
> [1] "i486"
> $os
> [1] "linux-gnu"
> $system
> [1] "i486, linux-gnu"
> $status
> [1] ""
> $major
> [1] "2"
> $minor
> [1] "3.1"
> $year
> [1] "2006"
> $month
> [1] "06"
> $day
> [1] "01"
> $`svn rev`
> [1] "38247"
> $language
> [1] "R"
> $version.string
> [1] "Version 2.3.1 (2006-06-01)"
> 
> 
> Description:
> 
> When importing data with like read.table("data.csv",blank.lines.skip = FALSE)
> Gives an error if first line is blank: "Empty beginning of file"
> 
> This is not wanted, as the case someone needs to fill a blank value as a first
> case. This is useful to import data to a variable in a dataset. If first line is
> not blank, then it behaves normally.
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From gregor.gorjanc at bfro.uni-lj.si  Tue Dec  5 11:49:02 2006
From: gregor.gorjanc at bfro.uni-lj.si (Gregor Gorjanc)
Date: Tue, 5 Dec 2006 10:49:02 +0000 (UTC)
Subject: [Rd] R 2.4.1 scheduled for December 18
References: <45702761.4010806@biostat.ku.dk>
	<loom.20061203T202732-76@post.gmane.org>
Message-ID: <loom.20061205T114733-906@post.gmane.org>

Gregor Gorjanc <gregor.gorjanc <at> bfro.uni-lj.si> writes:
> 
> Hi!
> 
> If I am not wrong issue described at
> 
> http://thread.gmane.org/gmane.comp.lang.r.devel/9667/focus=9667
> 
> did not get any attention. Thought it is true that using names() instead of
> colnames() does not change mode of data.frame rownames.
> 
> This issues are also "alive": 
> 
> http://thread.gmane.org/gmane.comp.lang.r.devel/9837/focus=9837
> http://thread.gmane.org/gmane.comp.lang.r.devel/7540/focus=7540
> http://thread.gmane.org/gmane.comp.lang.r.devel/8513/focus=8518

This one also:

http://thread.gmane.org/gmane.comp.lang.r.devel/10723/focus=10723

Thanks!

Gregor


From gregor.gorjanc at bfro.uni-lj.si  Tue Dec  5 12:01:11 2006
From: gregor.gorjanc at bfro.uni-lj.si (Gregor Gorjanc)
Date: Tue, 5 Dec 2006 11:01:11 +0000 (UTC)
Subject: [Rd] R 2.4.1 scheduled for December 18
References: <45702761.4010806@biostat.ku.dk>
	<loom.20061203T202732-76@post.gmane.org>
	<loom.20061205T114733-906@post.gmane.org>
Message-ID: <loom.20061205T120006-49@post.gmane.org>

And small typo in postscript man page

Index: src/library/grDevices/man/postscript.Rd
===================================================================
--- src/library/grDevices/man/postscript.Rd     (revision 40125)
+++ src/library/grDevices/man/postscript.Rd     (working copy)
@@ -195,7 +195,7 @@
   using the \code{encoding} argument the glyphs can be matched to
   encoding in use.  This suffices for European and Cyrillic languages,
   but not for CJK languages.  For the latter, composite CID fonts are
-  used.  These fonts are be useful for other languages: for example they
+  used.  These fonts are useful for other languages: for example they
   may contain Greek glyphs. (The rest of this section applies only when CID
   fonts are not used.)

I will stop now;)

Gregor


From christos at nuverabio.com  Tue Dec  5 16:28:40 2006
From: christos at nuverabio.com (Christos Hatzis)
Date: Tue, 5 Dec 2006 10:28:40 -0500
Subject: [Rd] Library file for the R engine in Windows?
In-Reply-To: <Pine.LNX.4.64.0612050638370.7721@gannet.stats.ox.ac.uk>
Message-ID: <000801c71882$0b6e46a0$0e010a0a@headquarters.silicoinsights>

Thank you.

I am using the **free** Microsoft Visual C++ Toolkit 2003.  The Rdll.lib
library builds successfully following the instructions in README.packages.
One potential caveat is that lib.exe that is needed to build the library
from R.exp is not part of the free toolkit.  However, a workaround is
possible as 'lib' is equivalent to 'link /lib':

pexports R.dll > R.exp
link /lib /def:R.exp /machine:x86 /out:Rdll.lib

-Christos

Christos Hatzis, Ph.D.
Nuvera Biosciences, Inc.
400 West Cummings Park
Suite 5350
Woburn, MA 01801
Tel: 781-938-3830
www.nuverabio.com
 


-----Original Message-----
From: Prof Brian Ripley [mailto:ripley at stats.ox.ac.uk] 
Sent: Tuesday, December 05, 2006 1:42 AM
To: Christos Hatzis
Cc: r-devel at r-project.org
Subject: Re: [Rd] Library file for the R engine in Windows?

This is discussed in README.packages: yes you do need to build an import
library for VC++6 (don't know for sure about later versions).  The
recommended route is to build it from the sources, but pexports.exe from
mingw-utils can usually be used.

On Mon, 4 Dec 2006, Christos Hatzis wrote:

> Hi,
>
> I am trying to use dynamic memory allocation in the C code to be 
> called by R through the .C interface.
> I have used R_alloc as explained in the Writing R Extensions and 
> included the R.h header.
> The program compiles fine but fails when linking.  Obviously it needs 
> a library file where R_alloc is found.
> I have tried to link by adding R.dll to list of files at the end of 
> the link command but that did not work either.
>
> The S Programming book mentions that a library Rdll.lib needs to be 
> built from source, but I am not sure if this is still the recommended 
> route.
>
> I am using Microsoft Visual C++ Toolkit in Windows XP Pro.
> Thank you for any advice.
>
> Christos Hatzis, Ph.D.
> Nuvera Biosciences, Inc.
> 400 West Cummings Park
> Suite 5350
> Woburn, MA 01801
> Tel: 781-938-3830
> www.nuverabio.com <http://www.nuverabio.com/>
>
>
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From 559wilbert at keithbiz.com  Tue Dec  5 20:55:49 2006
From: 559wilbert at keithbiz.com ((270) 818-7244 Chuck )
Date: Wed, 6 Dec 2006 04:55:49 +0900
Subject: [Rd] Fw: Get a Diplom awithout the hassle!
Message-ID: <11857307684979.75B3D9C178@NYA4K6>

Yo R-devel!.
Absolutley are no prerequsiite tests, classes, books, or interviews !



Take aB_achelors, Masters., MBA, and Doctorate (PhD) diploma.

Recevie the perks and high regard_that comes with a.idploma !



N oone is pushed away

Prviacy secure

Begin Right Away +1       (270) 818-7244
Live 7d 24 hour

*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*
















then  that  his  life was beginning. But that was the evening he firsthand  on  his  shoulder  brought  him  back to the stinks of marsh and


From mike.prager at noaa.gov  Tue Dec  5 21:09:53 2006
From: mike.prager at noaa.gov (Mike Prager)
Date: Tue, 05 Dec 2006 15:09:53 -0500
Subject: [Rd] Entry for "sub"
Message-ID: <0tjbn29lo58lf3ecbdn916vtltein6hti6@4ax.com>

R Core Team--

Would it be reasonably easy for the function "sub" be given its
own bookmark in the next edition of the R Reference Manual?  I
could not remember the name of any R function to do substring
substitution, and it was not easy to find.  It does appear in
the index, but not in the bookmarks, nor under "*Topic
character".

By the way, let me express my appreciation for the *Topic
entries in the RRM index.  They are the closest I've found to
any taxonomic listing of R functions and have saved me a lot of
looking around.

Not to be churlish, but rather for the record, the major R
reference books I have (Verani, V&R 4, Maindonald & Braun, S
Prog) are rather thin on index entries under "character" or
"string". 

I realize that if I already knew the answer, I could have found
it, easily, but I didn't, and it was not easy.

THANKS for considering it.

-- 
Mike Prager, NOAA, Beaufort, NC
* Opinions expressed are personal and not represented otherwise.
* Any use of tradenames does not constitute a NOAA endorsement.


From maechler at r-project.org  Tue Dec  5 18:20:12 2006
From: maechler at r-project.org (Martin Maechler)
Date: Tue, 5 Dec 2006 17:20:12 +0000 (UTC)
Subject: [Rd] R-devel: rownames of a data.frame
References: <4508EE12.7030004@bfro.uni-lj.si>
Message-ID: <loom.20061205T100716-59@post.gmane.org>

Gregor Gorjanc <gregor.gorjanc <at> bfro.uni-lj.si> writes:

> 
> Hello!
> 
> Data.frames have new rownames funcionality, however in use of colnames<-
> in R-devel "changes" this. Here is the example:
> 
> > df1 <- data.frame(letters[1:5])
> > attributes(df1)
> $names
> [1] "letters.1.5."
> 
> $row.names
> [1] 1 2 3 4 5
> 
> $class
> [1] "data.frame"
> 
> > colnames(df1) <- "bla"
> > attributes(df1)
> $names
> [1] "bla"
> 
> $row.names
> [1] "1" "2" "3" "4" "5"
> 
> $class
> [1] "data.frame"
> 
> ?rownames/colnames help page (R-devel) says that value is coerced to
> character, but why are rownames coerced to character if I assign
> colnames to a data.frame?
> 

because  colnames() and rownames() work via dimnames(), and so do
 "colnames<-" and "rownames<-" ---  
I think it would be unwise to change this, since it's well documented property
of these functions.

As you noted yourself,  using  names() and "names<-"
i.e.,
  names(df1) <- "bla"
in the example above, is the recommended way for data frames and does not change
the rownames to character.


From gregor.gorjanc at bfro.uni-lj.si  Wed Dec  6 11:08:22 2006
From: gregor.gorjanc at bfro.uni-lj.si (Gregor Gorjanc)
Date: Wed, 6 Dec 2006 10:08:22 +0000 (UTC)
Subject: [Rd] R-devel: rownames of a data.frame
References: <4508EE12.7030004@bfro.uni-lj.si>
	<loom.20061205T100716-59@post.gmane.org>
Message-ID: <loom.20061206T103459-539@post.gmane.org>

Martin Maechler <maechler <at> r-project.org> writes:
...
> because  colnames() and rownames() work via dimnames(), and so do
>  "colnames<-" and "rownames<-" ---  
> I think it would be unwise to change this, since it's well documented 
> property of these functions.
> 
> As you noted yourself,  using  names() and "names<-"
> i.e.,
>   names(df1) <- "bla"
> in the example above, is the recommended way for data frames and does not 
> change the rownames to character.

Thank you for this followup! It seems that I should have read the 
documentation more carefully. May I just suggest to add names in see also 
for row.names help page.

Regards, Gregor


From tplate at acm.org  Wed Dec  6 18:23:18 2006
From: tplate at acm.org (Tony Plate)
Date: Wed, 06 Dec 2006 10:23:18 -0700
Subject: [Rd] R-devel: rownames of a data.frame
In-Reply-To: <loom.20061205T100716-59@post.gmane.org>
References: <4508EE12.7030004@bfro.uni-lj.si>
	<loom.20061205T100716-59@post.gmane.org>
Message-ID: <4576FC86.9080900@acm.org>

Martin Maechler wrote:
> Gregor Gorjanc <gregor.gorjanc <at> bfro.uni-lj.si> writes:
> 
> 
>>Hello!
>>
>>Data.frames have new rownames funcionality, however in use of colnames<-
>>in R-devel "changes" this. Here is the example:
>>
>>
>>>df1 <- data.frame(letters[1:5])
>>>attributes(df1)
>>
>>$names
>>[1] "letters.1.5."
>>
>>$row.names
>>[1] 1 2 3 4 5
>>
>>$class
>>[1] "data.frame"
>>
>>
>>>colnames(df1) <- "bla"
>>>attributes(df1)
>>
>>$names
>>[1] "bla"
>>
>>$row.names
>>[1] "1" "2" "3" "4" "5"
>>
>>$class
>>[1] "data.frame"
>>
>>?rownames/colnames help page (R-devel) says that value is coerced to
>>character, but why are rownames coerced to character if I assign
>>colnames to a data.frame?
>>
> 
> 
> because  colnames() and rownames() work via dimnames(), and so do
>  "colnames<-" and "rownames<-" ---  
> I think it would be unwise to change this, since it's well documented property
> of these functions.

Where? -- the documentation for "colnames<-" on data frames doesn't seem 
particularly specific about exactly how the replacement will be done. 
And I don't see any mention of "colnames" in "An Introduction to R".

Not changing attr(,"row.names") when colnames are set seems a desirable 
property.  Allowing colnames<- to change attr(,"row.names") damages the 
nice new feature of data frames that allows them to avoid using a lot of 
storage on row names.  It doesn't look like making "colnames<-" work via 
"names<-" for dataframes would be particularly contradictory to the 
documentation.

(Also, the documentation is no longer correct for rownames<- for data 
frames -- it says the value must be character data.)

For reference, here's the Details section of ?colnames as it relates to 
replacement "methods" (these functions don't appear to be generics...?):

> The replacement methods for arrays/matrices coerce vector
> and factor values of value to character, but do not dispatch
> methods for as.character.
> 
> For a data frame, value for rownames should be a character
> vector of non-duplicated and non-missing names (this is
> enforced), and for colnames a character vector of
> (preferably) unique syntactically-valid names. In both
> cases, value will be coerced by as.character.

(taken from 
https://svn.r-project.org/R/trunk/src/library/base/man/colnames.Rd)

-- Tony Plate

> 
> As you noted yourself,  using  names() and "names<-"
> i.e.,
>   names(df1) <- "bla"
> in the example above, is the recommended way for data frames and does not change
> the rownames to character.
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From jhallman at frb.gov  Wed Dec  6 19:22:41 2006
From: jhallman at frb.gov (jhallman at frb.gov)
Date: Wed,  6 Dec 2006 19:22:41 +0100 (CET)
Subject: [Rd] tcltk::tk_select.list has bad width (PR#9410)
Message-ID: <20061206182241.2256056243@slim.kubism.ku.dk>

Full_Name: Jeff Hallman
Version: 2.4.0
OS: Linux
Submission from: (NULL) (132.200.32.34)


The window put up by tcltk::tk_select.list appears to be of fixed width (20
chars), and is not wide enough to accomodate strings longer than 20 characters
long.  This can be easily fixed by setting the option "width = 0" in the calls
to tklistbox().  Width = 0 tells tk to make the listbox just wide enough to
accomodate the items contained in the list.


From vdergachev at rcgardis.com  Wed Dec  6 19:33:08 2006
From: vdergachev at rcgardis.com (Vladimir Dergachev)
Date: Wed, 6 Dec 2006 13:33:08 -0500
Subject: [Rd] data frame subset patch, take 2
Message-ID: <200612061333.09050.vdergachev@rcgardis.com>

Hi Robert,

Here is the second iteration of data frame subset patch.
It now passes make check on both 2.4.0 and 2.5.0 (svn as of a few days ago).
Same speedup as before.

Changes:

	* Introduced two new functions .subassign2 and .subassign that are 
complimentary to .subset2 and .subset.

	* Changed x[[j]]<- assignment to x<-.subassign2(x, j, ..) to fix the problem 
with the previous patch.

                               thank you !

                                    Vladimir Dergachev

From p.dalgaard at biostat.ku.dk  Wed Dec  6 20:11:21 2006
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Wed, 06 Dec 2006 20:11:21 +0100
Subject: [Rd] tcltk::tk_select.list has bad width (PR#9410)
In-Reply-To: <20061206182241.2256056243@slim.kubism.ku.dk>
References: <20061206182241.2256056243@slim.kubism.ku.dk>
Message-ID: <457715D9.7010406@biostat.ku.dk>

jhallman at frb.gov wrote:
> Full_Name: Jeff Hallman
> Version: 2.4.0
> OS: Linux
> Submission from: (NULL) (132.200.32.34)
>
>
> The window put up by tcltk::tk_select.list appears to be of fixed width (20
> chars), and is not wide enough to accomodate strings longer than 20 characters
> long.  This can be easily fixed by setting the option "width = 0" in the calls
> to tklistbox().  Width = 0 tells tk to make the listbox just wide enough to
> accomodate the items contained in the list.
>
>   
Hmm, maybe, but probably not unconditionally: What if someone puts in an 
item that is supercalifragilisticexpialidosiously long?

You can already scroll sideways using the arrow keys.


From jfu at science.uva.nl  Wed Dec  6 20:39:39 2006
From: jfu at science.uva.nl (jfu at science.uva.nl)
Date: Wed,  6 Dec 2006 20:39:39 +0100 (CET)
Subject: [Rd] Cannot run R (PR#9411)
Message-ID: <20061206193939.E44995734D@slim.kubism.ku.dk>

Full_Name: J
Version: R-2.4.0-win32
OS: windows xp SP1
Submission from: (NULL) (145.116.239.53)


I have just downloaded and installed R. The installation is successful. There's
no error hint during the process. However, after the installation, I try to run
R, but an error message occured and I can not run the programme. I don't know
what is the problem.


From m1jjh00 at frb.gov  Wed Dec  6 21:15:14 2006
From: m1jjh00 at frb.gov (Jeffrey J. Hallman)
Date: Wed, 06 Dec 2006 15:15:14 -0500
Subject: [Rd] tcltk::tk_select.list has bad width (PR#9410)
In-Reply-To: Message from Peter Dalgaard <p.dalgaard@biostat.ku.dk> 
	of "Wed, 06 Dec 2006 20:11:21 +0100." <457715D9.7010406@biostat.ku.dk> 
Message-ID: <20061206201514.496AD5362E@mail.rsma.frb.gov>

Peter Dalgaard <p.dalgaard at biostat.ku.dk> wrote:

  pd> jhallman at frb.gov wrote:
  >> The window put up by tcltk::tk_select.list appears to be of fixed width (20
  >> chars), and is not wide enough to accomodate strings longer than 20 characters
  >> long.  This can be easily fixed by setting the option "width = 0" in the calls
  >> to tklistbox().  Width = 0 tells tk to make the listbox just wide enough to
  >> accomodate the items contained in the list.
  >> 
  >> 

  pd> Hmm, maybe, but probably not unconditionally: What if someone puts in an item
  pd> that is supercalifragilisticexpialidosiously long?

The listbox comes up as wide as my screen, but no wider. Seems like
acceptable behavior to me.  

  pd> You can already scroll sideways using the arrow keys.

Yes, but the width of 20 is still a pain.  I grew annoyed enough to
track this down and fix it when I had a help document for 'lag()' in my
local package as well as the one in the 'stats' package.  When I entered 

?lag

at the R prompt, I'd get a menu offering me a choice of which document
to show, but the strings identifying the choices were so truncated that
it was difficult to know which one was which.  20 characters is just too
few.

Do you not agree that sending "width = 0" and letting Tk handle it
automagically is better than what's in there now? 

Jeff


From gregor.gorjanc at bfro.uni-lj.si  Thu Dec  7 01:38:04 2006
From: gregor.gorjanc at bfro.uni-lj.si (Gregor Gorjanc)
Date: Thu, 07 Dec 2006 01:38:04 +0100
Subject: [Rd] Enhances, require() and quality control
Message-ID: <4577626C.7020504@bfro.uni-lj.si>

Hello!

I am working on a package where Enhances field seems to be a plausible
option. When I add package, say coda, to this field, I get the following
warning with recent R-devel:

----

* checking for working latex ... OK
* using log directory '/home/ggorjan/programs/R/devel/test.Rcheck'
* using R version 2.5.0 Under development (unstable) (2006-12-06 r40129)
* checking for file 'test/DESCRIPTION' ... OK
* this is package 'test' version '0.1'
* checking package dependencies ... WARNING
'library' or 'require' calls not declared from:
  coda

See the information on DESCRIPTION files in the chapter 'Creating R
packages' of the 'Writing R Extensions' manual.

----

I have require(code) somewhere in the code. Is this OK or is R CMD check
to stringent in case of enhances field - I get no warning if that
package is in depends or suggests fields?

After a short look into src/library/tools/R/QC.R I think that the
following might be the solution. I did not do any other testing than
with my package, where R CMD check (R with proposed change) passed
without warnings.

Index: src/library/tools/R/QC.R
===================================================================
--- src/library/tools/R/QC.R    (revision 40129)
+++ src/library/tools/R/QC.R    (working copy)
@@ -3659,8 +3659,8 @@
     standard_package_names <-
         .get_standard_package_names()$base %w/o% c("methods", "stats4")
     depends_suggests <- c(depends, suggests, pkg_name, contains,
-                          standard_package_names)
-    imports <- c(imports, depends_suggests, enhances)
+                          standard_package_names, enhances)
+    imports <- c(imports, depends_suggests)
     ## the first argument could be named, or could be a variable name.
     ## we just have a stop list here.
     common_names <- c("pkg", "pkgName", "package", "pos")

-- 
Lep pozdrav / With regards,
    Gregor Gorjanc
----------------------------------------------------------------------
University of Ljubljana     PhD student
Biotechnical Faculty
Zootechnical Department     URI: http://www.bfro.uni-lj.si/MR/ggorjan
Groblje 3                   mail: gregor.gorjanc <at> bfro.uni-lj.si

SI-1230 Domzale             tel: +386 (0)1 72 17 861
Slovenia, Europe            fax: +386 (0)1 72 17 888

----------------------------------------------------------------------
"One must learn by doing the thing; for though you think you know it,
 you have no certainty until you try." Sophocles ~ 450 B.C.


From p.dalgaard at biostat.ku.dk  Thu Dec  7 11:27:43 2006
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Thu, 07 Dec 2006 11:27:43 +0100
Subject: [Rd] Prerelease tarballs of R 2.4.1
Message-ID: <4577EC9F.30601@biostat.ku.dk>

...are being built every morning (CET time) and made available at

http://cran.r-project.org/src/base-prerelease/

    -peter


From ligges at statistik.uni-dortmund.de  Thu Dec  7 12:02:15 2006
From: ligges at statistik.uni-dortmund.de (Uwe Ligges)
Date: Thu, 07 Dec 2006 12:02:15 +0100
Subject: [Rd] Cannot run R (PR#9411)
In-Reply-To: <20061206193939.E44995734D@slim.kubism.ku.dk>
References: <20061206193939.E44995734D@slim.kubism.ku.dk>
Message-ID: <4577F4B7.3010304@statistik.uni-dortmund.de>

That it does not run does not mean there is a bug in R, so why do you 
submit a bug report that must be handled manually by some R Core member?

Please tell us the error message, we cannot help  you unless you provide 
us with the relevant details.

Uwe Ligges

jfu at science.uva.nl wrote:
> Full_Name: J
> Version: R-2.4.0-win32
> OS: windows xp SP1
> Submission from: (NULL) (145.116.239.53)
> 
> 
> I have just downloaded and installed R. The installation is successful. There's
> no error hint during the process. However, after the installation, I try to run
> R, but an error message occured and I can not run the programme. I don't know
> what is the problem.
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From gregor.gorjanc at bfro.uni-lj.si  Thu Dec  7 13:56:01 2006
From: gregor.gorjanc at bfro.uni-lj.si (gregor.gorjanc at bfro.uni-lj.si)
Date: Thu,  7 Dec 2006 13:56:01 +0100 (CET)
Subject: [Rd] Matplot does not work with x being POSIXt class (PR#9412)
Message-ID: <20061207125601.00D2257349@slim.kubism.ku.dk>

Hi,

Matplot works with x being Date class but not POSIXt. Here is the
example with R version 2.5.0 Under development (unstable) (2006-12-06
r40129)

Example:

x <- Sys.Date() - c(1:10)
y <- cbind(1:10, 10:1)
class(x)
## [1] "Date"
matplot(x, y)

x <- strptime(as.character(x), format="%Y-%m-%d")
## [1] "POSIXt"  "POSIXlt"
matplot(x, y)
Error in matplot(x, y) : 'x' and 'y' must have only 1 or the same number
of columns

Additionally, matplot with x being Date class does not use apropriate
annotation for x axis.

Thank you!

Gregor


From p.dalgaard at biostat.ku.dk  Thu Dec  7 14:52:12 2006
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Thu, 07 Dec 2006 14:52:12 +0100
Subject: [Rd] Matplot does not work with x being POSIXt class (PR#9412)
In-Reply-To: <20061207125601.00D2257349@slim.kubism.ku.dk>
References: <20061207125601.00D2257349@slim.kubism.ku.dk>
Message-ID: <45781C8C.7010406@biostat.ku.dk>

gregor.gorjanc at bfro.uni-lj.si wrote:
> Hi,
>
> Matplot works with x being Date class but not POSIXt. Here is the
> example with R version 2.5.0 Under development (unstable) (2006-12-06
> r40129)
>
> Example:
>
> x <- Sys.Date() - c(1:10)
> y <- cbind(1:10, 10:1)
> class(x)
> ## [1] "Date"
> matplot(x, y)
>
> x <- strptime(as.character(x), format="%Y-%m-%d")
> ## [1] "POSIXt"  "POSIXlt"
> matplot(x, y)
> Error in matplot(x, y) : 'x' and 'y' must have only 1 or the same number
> of columns
>
> Additionally, matplot with x being Date class does not use apropriate
> annotation for x axis.
>   
Matplot plots matrices, it is not a bug that it doesn't work with other 
objects. Rather, it is  a coincidence that it works with dates when 
their internal representation is as numbers. 

It might be a useful enhancement, but things are not so easy: The root 
of the issue is that matrices of time/date objects don't behave nicely. 
Try, e.g.

structure(matrix(1:10, 2), class = "Date")
matrix(structure(1:10, class = "Date"), 2)

The former will actually work in the sense that it allows indexing, it 
just forgets about dimensions when printing. The latter throws away the 
class of x, and is used inside matplot() hence the annotation will not 
be that for a Date object.

Also, as.matrix.POSIXlt() does something completely different, so things 
get a bit tricky...


From macq at llnl.gov  Thu Dec  7 22:02:11 2006
From: macq at llnl.gov (Don MacQueen)
Date: Thu, 7 Dec 2006 13:02:11 -0800
Subject: [Rd] Matplot does not work with x being POSIXt class (PR#9412)
In-Reply-To: <20061207125601.00D2257349@slim.kubism.ku.dk>
References: <20061207125601.00D2257349@slim.kubism.ku.dk>
Message-ID: <p06230913c19e2e5798f1@[128.115.153.6]>

As Peter said, matplot plots matrices. The columns of a matrix are 
vectors of numbers. A POSIXlt object is not a vector of numbers, it 
is a list. So it shouldn't work. And should not be expected to work.

But with a POSIXct object it will work.

x <- strptime(as.character(x), format="%Y-%m-%d")
## [1] "POSIXt"  "POSIXlt"
matplot( as.POSIXct(x), y)


At 1:56 PM +0100 12/7/06, gregor.gorjanc at bfro.uni-lj.si wrote:
>Hi,
>
>Matplot works with x being Date class but not POSIXt. Here is the
>example with R version 2.5.0 Under development (unstable) (2006-12-06
>r40129)
>
>Example:
>
>x <- Sys.Date() - c(1:10)
>y <- cbind(1:10, 10:1)
>class(x)
>## [1] "Date"
>matplot(x, y)
>
>x <- strptime(as.character(x), format="%Y-%m-%d")
>## [1] "POSIXt"  "POSIXlt"
>matplot(x, y)
>Error in matplot(x, y) : 'x' and 'y' must have only 1 or the same number
>of columns
>
>Additionally, matplot with x being Date class does not use apropriate
>annotation for x axis.

This is very easy to obtain:

# x is a Date object
matplot(x,y,xaxt='n')
axis.Date(1,x)

or

# x is a POSIXlt object
matplot( as.POSIXct(x), y,xaxt='n')
axis.POSIXct(1,x)

So easy, in fact, that I personally would not expect R core to spend 
time on it. One of the virtues of R is that the language is so rich 
that little tweaks like this are often very easy.

>
>Thank you!
>
>Gregor
>

-Don
-- 
--------------------------------------
Don MacQueen
Environmental Protection Department
Lawrence Livermore National Laboratory
Livermore, CA, USA


From gregor.gorjanc at bfro.uni-lj.si  Thu Dec  7 22:19:11 2006
From: gregor.gorjanc at bfro.uni-lj.si (Gregor Gorjanc)
Date: Thu, 07 Dec 2006 22:19:11 +0100
Subject: [Rd] Matplot does not work with x being POSIXt class (PR#9412)
In-Reply-To: <p06230913c19e2e5798f1@[128.115.153.6]>
References: <20061207125601.00D2257349@slim.kubism.ku.dk>
	<p06230913c19e2e5798f1@[128.115.153.6]>
Message-ID: <4578854F.7010708@bfro.uni-lj.si>

Hi,

Don MacQueen wrote:
...
> At 1:56 PM +0100 12/7/06, gregor.gorjanc at bfro.uni-lj.si wrote:
>> Hi,
>>
>> Matplot works with x being Date class but not POSIXt. Here is the
>> example with R version 2.5.0 Under development (unstable) (2006-12-06
>> r40129)
>>
>> Example:
>>
>> x <- Sys.Date() - c(1:10)
>> y <- cbind(1:10, 10:1)
>> class(x)
>> ## [1] "Date"
>> matplot(x, y)
>>
>> x <- strptime(as.character(x), format="%Y-%m-%d")
>> ## [1] "POSIXt"  "POSIXlt"
>> matplot(x, y)
>> Error in matplot(x, y) : 'x' and 'y' must have only 1 or the same number
>> of columns
>>
>> Additionally, matplot with x being Date class does not use apropriate
>> annotation for x axis.
> 
> This is very easy to obtain:
> 
> # x is a Date object
> matplot(x,y,xaxt='n')
> axis.Date(1,x)
> 
> or
> 
> # x is a POSIXlt object
> matplot( as.POSIXct(x), y,xaxt='n')
> axis.POSIXct(1,x)
> 
> So easy, in fact, that I personally would not expect R core to spend
> time on it. One of the virtues of R is that the language is so rich that
> little tweaks like this are often very easy.

Thank you Peter and Don for these insights. I see that changes would be
far from trivial/tricky and as Don pointed out simple tweaks by the user
can solve this.

Thank you and sorry for inconvenience!

Best wishes, Gregor


From weigand.stephen at charter.net  Fri Dec  8 05:29:33 2006
From: weigand.stephen at charter.net (Stephen D. Weigand)
Date: Thu, 7 Dec 2006 22:29:33 -0600
Subject: [Rd] Wishlist: abs method for difftime
Message-ID: <82f0767b3e86190f628bc5facfcee096@charter.net>

I am often taking the absolute value of a difftime object (after
coercing it to numeric) in order to see how far apart in time
two events are. For example, I might want to know if two events
occurred within 100 days of each other using something like

abs(difftime(Date1, Date2)) < 100

Below is a suggestion for an abs.difftime:

abs.difftime <- function(x)
{
     structure(abs(as.numeric(x)),
               class = class(x),
               units = attr(x, "units"))
}

I think these changes to difftime.Rd would document this:

1) Add \alias{abs.difftime}

2) In the first paragraph of \details change

"There is a \code{\link{round}} method for objects of this class,
as well as..."

to

"There are \code{\link{round}} and \code{\link{abs}} methods for
objects of this class, as well as..."

Thanks for considering this,

Stephen
Rochester, Minnesota, USA


From jhallman at frb.gov  Fri Dec  8 15:35:24 2006
From: jhallman at frb.gov (jhallman at frb.gov)
Date: Fri, 08 Dec 2006 09:35:24 -0500
Subject: [Rd] How to get DLL paths in a package?
Message-ID: <20061208143524.2CCA15362E@mail.rsma.frb.gov>

I'm writing a package that I hope to make available on CRAN.  The
package interfaces to the FAME database via a .so file supplied by FAME,
which should be loaded in the package .onLoad() function.
Unfortunately, so far as I know, there is no standard location where
this .so file can always be found.  So I need to have some way for the
package installer to indicate where the file can be found. Also, FAME
needs stuff from either the Motif or LessTif library, so I have to make
sure that one of them can be found via the LD_LIBRARY_PATH. (Just why
FAME needs this stuff when there's no user interface involved is a question
to be pondered for the ages.)

So I need a way for the package installer to supply the locations of the
FAME hli library (the .so file) and the location of the Motif/LessTif
library directory.  How should I do this?  I'd rather not assume that
either the installer or the package writer (me) know much about
autoconf.  Can I get away with a simple text file in the 'inst'
directory, or will CRAN reject my package if I do it that way?  

Jeff


From bolker at zoo.ufl.edu  Fri Dec  8 15:34:47 2006
From: bolker at zoo.ufl.edu (Ben Bolker)
Date: Fri, 8 Dec 2006 14:34:47 +0000 (UTC)
Subject: [Rd] mixed effects model and r-squared
References: <FE8C160D1505B24497FA7C78D4DADACA047879@EA-MAIL.eawag.wroot.emp-eaw.ch>
Message-ID: <loom.20061208T152822-279@post.gmane.org>

Indermaur Lukas <Lukas.Indermaur <at> eawag.ch> writes:

> 
> Heya 
> 
> I am fitting linear mixed effects model in R [snip]
> 
> ts.model <- lme(LOG_FOC_MW ~ R_DN_SUM + ANIMAL + SEX+ YY, data = t.data,
random = ~ 1 | ANIMAL, 
> correlation=corCAR1(0.2, form = ~1 | ANIMAL ), 
method='ML', na.action=na.omit)). 
> 
> Is there a possability to easly compute an R-square 
from the output of the
model summary?
> 
> I would appreciate any hint.
> Best regards
> 
> Lukas
> 

  You probably need to repost this on r-help instead of r-devel;
it's not a "development" question.
   The other bad news for you is that I suspect it may be 
difficult to define r-squared uniquely for a mixed model.  
The resid() command  will give you
residuals, and you could take (1-resid()^2)/var(x) -- 
but how do you decide which var(x) to put in 
the denominator ... ?

  Ben Bolker


From m1jjh00 at frb.gov  Fri Dec  8 15:36:14 2006
From: m1jjh00 at frb.gov (Jeffrey J. Hallman)
Date: Fri, 08 Dec 2006 09:36:14 -0500
Subject: [Rd] jhallman@frb.gov: dyn.load and function calls without
	'PACKAGE' argument
Message-ID: <20061208143614.5AA415362E@mail.rsma.frb.gov>

An embedded message was scrubbed...
From: jhallman at frb.gov
Subject: dyn.load and function calls without 'PACKAGE' argument
Date: Fri, 08 Dec 2006 08:59:33 -0500
Size: 2217
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20061208/f09430aa/attachment.mht 

From jhallman at frb.gov  Fri Dec  8 15:40:14 2006
From: jhallman at frb.gov (jhallman at frb.gov)
Date: Fri, 08 Dec 2006 09:40:14 -0500
Subject: [Rd] dyn.load and function calls without 'PACKAGE' argument
Message-ID: <20061208144014.9517A5362E@mail.rsma.frb.gov>

I'm writing a package that interfaces to the FAME database, via a
library of compiled C routines accessible through a Linux .so file.  My
.onLoad() function loads the .so like this:

dyn.load("/opt/fame/timeiq/lib/linux_x86/libjchli.so", local = F)

and after that I also load my own fame.so via

library.dynam("fame", package = "fame")

The code in fame.so uses functions found in libjchli.so, making the
'local = F' argument in dyn.load() necessary.  But since Fame symbols
are found in libjchli.so, which is NOT part of my package, I can't, for
example, do this:

.C("cfmfin", status = integer(1), PACKAGE = "fame")

since the PACKAGE argument tells R to look only in fame.so for symbols.
Instead, I have to do it without specifying 'PACKAGE', i.e., 

.C("cfmfin", status = integer(1))

This works, but 'R CMD check' complains: 

"Foreign function calls without 'PACKAGE' argument:"

followed by a list of the functions called from libjchli.so.

Is there a way to make R CMD check happy here?

Jeff


From r at erik.prutser.cx  Fri Dec  8 15:51:39 2006
From: r at erik.prutser.cx (Erik van Zijst)
Date: Fri, 08 Dec 2006 15:51:39 +0100
Subject: [Rd] Pre-compilation and server-side parallel execution
Message-ID: <45797BFB.3090302@erik.prutser.cx>

Folks,

My company operates a platform that distributes real-time financial data 
from exchanges to users. To extend our services I want to allow users to 
write and submit custom R scripts to our platform that operate on our 
streaming data to do real-time analysis.

We have thousands of users deploying scripts and each script is 
evaluated repeatedly when certain conditions in the stream apply. For 
example, a script could compute the NASDAQ100 index value each time one 
of its 100 constituents trade.

Scripts are typically small and execute quickly. Each script is 
registered once and then repeatedly evaluated with different parameters 
(possibly several times per second per script). In this context my 
biggest concern is scalability.

The evaluation engine is a pure server-side component without display 
abilities. An R-script is invoked with parameters and whatever it 
returns is sent to the user.

Ideally I'd need a C api to interact with the interpreter. I've looked 
at projects like R/Apache, RServe and RSJava for inspiration and came to 
the conclusion that all these projects work by forking multiple 
instances of the R-engine where each instance evaluates one script at a 
time.

As our service must evaluate many different scripts concurrently 
(isolated from one another), I have the following concerns:

1. Spawning a pool of engine instances for massive parallel execution is 
expensive, but might work with lots of memory.
2. R's native C-api 
[http://cran.r-project.org/doc/manuals/R-exts.html#The-R-API] does not 
separate parsing from evaluation. When the same script is evaluated 10 
times, it is also parsed 10 times.

I'm mostly concerned about the second issue. Our scripts are registered 
once and continuously evaluated. I want to avoid parsing the same script 
again each time it is evaluated. Does the engine recognize previously 
parsed scripts (like oracle does for SQL queries)?

I interested to hear your thoughts on my concerns and whether you think 
R would work in this architecture.

kind regards,
Erik van Zijst
-- 
And on the seventh day, He exited from append mode.


From duncan at wald.ucdavis.edu  Fri Dec  8 18:15:48 2006
From: duncan at wald.ucdavis.edu (Duncan Temple Lang)
Date: Fri, 08 Dec 2006 09:15:48 -0800
Subject: [Rd] dyn.load and function calls without 'PACKAGE' argument
In-Reply-To: <20061208144014.9517A5362E@mail.rsma.frb.gov>
References: <20061208144014.9517A5362E@mail.rsma.frb.gov>
Message-ID: <45799DC4.9070809@wald.ucdavis.edu>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1



jhallman at frb.gov wrote:
> I'm writing a package that interfaces to the FAME database, via a
> library of compiled C routines accessible through a Linux .so file.  My
> .onLoad() function loads the .so like this:
> 
> dyn.load("/opt/fame/timeiq/lib/linux_x86/libjchli.so", local = F)
> 
> and after that I also load my own fame.so via
> 
> library.dynam("fame", package = "fame")
> 
> The code in fame.so uses functions found in libjchli.so, making the
> 'local = F' argument in dyn.load() necessary. 

Well, that is one approach.
A more  regular and in most senses "better" approach is to
have your fame.so link against libjchli.so when creating
the fame.so DLL/SO.  Then you don't have to pollute the
global symbol table for the process with libjchli.so
and you can use the PACKAGE argument.

That said, the PACKAGE argument is not necessary if you use
a NAMESPACE file for the package.
Load the fame.so with useDynLib() in the NAMESPACE file
and not library.dynam()

And if you explicitly list the routines you want to use
in the useDynLib() call, you can refer to them as
  .Call(foo, ...)

with no quotes, no PACKAGE and you will be able to handle
multiple versions and provide aliases for the routine names.


> But since Fame symbols
> are found in libjchli.so, which is NOT part of my package, I can't, for
> example, do this:
> 
> .C("cfmfin", status = integer(1), PACKAGE = "fame")
> 
> since the PACKAGE argument tells R to look only in fame.so for symbols.
> Instead, I have to do it without specifying 'PACKAGE', i.e., 
> 
> .C("cfmfin", status = integer(1))
> 
> This works, but 'R CMD check' complains: 
> 
> "Foreign function calls without 'PACKAGE' argument:"
> 
> followed by a list of the functions called from libjchli.so.
> 
> Is there a way to make R CMD check happy here?
> 
> Jeff
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

- --
Duncan Temple Lang                    duncan at wald.ucdavis.edu
Department of Statistics              work:  (530) 752-4782
4210 Mathematical Sciences Building   fax:   (530) 752-7099
One Shields Ave.
University of California at Davis
Davis,
CA 95616,
USA
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.3 (Darwin)

iD8DBQFFeZ3E9p/Jzwa2QP4RAoJ5AJsFZAFVuvmoEWhKFWxmncbHTLtpgwCfT84w
eN2RaXPav1/8erL08urKxT0=
=NksI
-----END PGP SIGNATURE-----


From deepayan.sarkar at gmail.com  Fri Dec  8 19:24:28 2006
From: deepayan.sarkar at gmail.com (Deepayan Sarkar)
Date: Fri, 8 Dec 2006 10:24:28 -0800
Subject: [Rd] empty pages in xyplot (2.4.0)
In-Reply-To: <200612081155.54639.vdergachev@rcgardis.com>
References: <200612081155.54639.vdergachev@rcgardis.com>
Message-ID: <eb555e660612081024l1788c86fk327f1b00a0fb87d4@mail.gmail.com>

On 12/8/06, Vladimir Dergachev <vdergachev at rcgardis.com> wrote:
>
> In 2.4.0 (and SVN) I am seeing xyplot creating empty pages for high page
> counts in layout - contrary to the manual which says high page counts should
> not matter. Everything works fine in 2.3.1.
>
> library("lattice")
> A<-data.frame(x=1:10, y=sin(1:10), z=round(1:10/3))
> xyplot(x~y|z, A, layout=c(1,1,10))
>
> The snippet above produces a valid plot in R 2.3.1, while in 2.4.0 and later I
> see a blank page with "x" and "y" letters on it.
>
> Can anyone else reproduce this ?

Yes. I will update the manual (but probably not in 2.4.1 as this
doesn't seem very critical) and in the longer run, perhaps add some
settings to control what should happen.

-Deepayan


From vdergachev at rcgardis.com  Fri Dec  8 17:55:54 2006
From: vdergachev at rcgardis.com (Vladimir Dergachev)
Date: Fri, 8 Dec 2006 11:55:54 -0500
Subject: [Rd] empty pages in xyplot (2.4.0)
Message-ID: <200612081155.54639.vdergachev@rcgardis.com>


In 2.4.0 (and SVN) I am seeing xyplot creating empty pages for high page 
counts in layout - contrary to the manual which says high page counts should 
not matter. Everything works fine in 2.3.1.

library("lattice")
A<-data.frame(x=1:10, y=sin(1:10), z=round(1:10/3))
xyplot(x~y|z, A, layout=c(1,1,10))

The snippet above produces a valid plot in R 2.3.1, while in 2.4.0 and later I 
see a blank page with "x" and "y" letters on it.

Can anyone else reproduce this ?

                     thank you very much !

                                  Vladimir Dergachev


From m1jjh00 at frb.gov  Fri Dec  8 21:40:41 2006
From: m1jjh00 at frb.gov (Jeffrey J. Hallman)
Date: Fri, 08 Dec 2006 15:40:41 -0500
Subject: [Rd] dyn.load and function calls without 'PACKAGE' argument
In-Reply-To: Message from Duncan Temple Lang <duncan@wald.ucdavis.edu> 
	of "Fri, 08 Dec 2006 09:15:48 PST." <45799DC4.9070809@wald.ucdavis.edu> 
Message-ID: <20061208204041.E119A5364A@mail.rsma.frb.gov>

Duncan Temple Lang <duncan at wald.ucdavis.edu> wrote:

  dtl> jhallman at frb.gov wrote:
  >> dyn.load("/opt/fame/timeiq/lib/linux_x86/libjchli.so", local = F)
  >> library.dynam("fame", package = "fame")
  >> The code in fame.so uses functions found in libjchli.so, making the
  >> 'local = F' argument in dyn.load() necessary. 

  dtl> Well, that is one approach.
  dtl> A more  regular and in most senses "better" approach is to
  dtl> have your fame.so link against libjchli.so when creating
  dtl> the fame.so DLL/SO.  Then you don't have to pollute the
  dtl> global symbol table for the process with libjchli.so
  dtl> and you can use the PACKAGE argument.

Will that work?  Some of the functions in libjchli.so get called
directly via .C().  How would linking fame.so against libjchli.so help
when fame.so doesn't know what functions in libjchli.so I am going to
call?  Perhaps I don't understand how linking works. Please feel free to
enlighten me.

  dtl> That said, the PACKAGE argument is not necessary if you use
  dtl> a NAMESPACE file for the package.
  dtl> Load the fame.so with useDynLib() in the NAMESPACE file
  dtl> and not library.dynam()

As I understand it, useDynLib(fame) is actually a directive that results
in fame.so being loaded via library.dynam(). I am using a NAMESPACE, so
I will try your advice and thank you for it. 

  dtl> And if you explicitly list the routines you want to use
  dtl> in the useDynLib() call, you can refer to them as
  dtl>   .Call(foo, ...)

  dtl> with no quotes, no PACKAGE and you will be able to handle
  dtl> multiple versions and provide aliases for the routine names.

What if I don't explicitly list the routines?  Many of the routines are
only compiled in for Unix, not Windows.  Is there a way to use a
different useDynLib() directive depending on the operating system?

Jeff


From simon.urbanek at r-project.org  Fri Dec  8 23:28:07 2006
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Fri, 8 Dec 2006 17:28:07 -0500
Subject: [Rd] Pre-compilation and server-side parallel execution
In-Reply-To: <45797BFB.3090302@erik.prutser.cx>
References: <45797BFB.3090302@erik.prutser.cx>
Message-ID: <79ACB4C7-436F-414A-AAE5-07C04B6FE5EF@r-project.org>


On Dec 8, 2006, at 9:51 AM, Erik van Zijst wrote:

> 2. R's native C-api
> [http://cran.r-project.org/doc/manuals/R-exts.html#The-R-API] does  
> not separate parsing from evaluation.

Actually it does - see "R_ParseVector" and "eval". You're free to run  
the parser once (or even construct the expression directly) and  
evaluate it many times. (Also note that you can serialize the parsed  
expression if desired).

If your worries are really at this level, then you will have to  
create entirely your own solution, because the overhead of IPC will  
be way more that the time spent in the parser. Actually I'm wondering  
whether you checked it at all, because I'd almost certainly expect  
the evaluation to take way more time than the parsing step. If it  
does, I'd be inclined to think that you have rather a design problem.

Cheers,
Simon


From pgilbert at bank-banque-canada.ca  Fri Dec  8 23:31:49 2006
From: pgilbert at bank-banque-canada.ca (Paul Gilbert)
Date: Fri, 08 Dec 2006 17:31:49 -0500
Subject: [Rd] dyn.load and function calls without 'PACKAGE' argument
In-Reply-To: <20061208144014.9517A5362E@mail.rsma.frb.gov>
References: <20061208144014.9517A5362E@mail.rsma.frb.gov>
Message-ID: <4579E7D5.4030908@bank-banque-canada.ca>

Jeff

You might look at the package padi (and also dsepadi) in the dseplus 
bundle in the devel area of CRAN. This provides an R to Fame link, and I 
have tried to do it in a generic way that can potentially interface to 
other time series data bases. It also handles endian issues, if your 
servers do not have the same architecture as the clients. Padi does not 
link the Fame stuff directly into R. Instead, it links a client side rpc 
program that talks to a server side that is linked to the Fame hli. This 
means the client is independent of the server side database, which has 
some advantages. Compiling is handled by a Makefile in the src directory 
and the location of run time code is handled by environment variables. 
It is a bit more complicated than this, because of the server and client 
modes. You may actually want something simpler, but the packages builds 
without errors (at least the client mode part of it). I have left it in 
the devel area mainly because the documentation is incomplete.

The package is very stable. I have been using it for fifteen years 
(first on Splus and now in R). It has a few shortcomings, but they are 
not things I need much. There are lots of improvements I could suggest.

Paul Gilbert

jhallman at frb.gov wrote:
> I'm writing a package that interfaces to the FAME database, via a
> library of compiled C routines accessible through a Linux .so file.  My
> .onLoad() function loads the .so like this:
> 
> dyn.load("/opt/fame/timeiq/lib/linux_x86/libjchli.so", local = F)
> 
> and after that I also load my own fame.so via
> 
> library.dynam("fame", package = "fame")
> 
> The code in fame.so uses functions found in libjchli.so, making the
> 'local = F' argument in dyn.load() necessary.  But since Fame symbols
> are found in libjchli.so, which is NOT part of my package, I can't, for
> example, do this:
> 
> .C("cfmfin", status = integer(1), PACKAGE = "fame")
> 
> since the PACKAGE argument tells R to look only in fame.so for symbols.
> Instead, I have to do it without specifying 'PACKAGE', i.e., 
> 
> .C("cfmfin", status = integer(1))
> 
> This works, but 'R CMD check' complains: 
> 
> "Foreign function calls without 'PACKAGE' argument:"
> 
> followed by a list of the functions called from libjchli.so.
> 
> Is there a way to make R CMD check happy here?
> 
> Jeff
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
====================================================================================

La version fran?aise suit le texte anglais.

------------------------------------------------------------------------------------

This email may contain privileged and/or confidential inform...{{dropped}}


From tom.mccallum at levelelimited.com  Sat Dec  9 14:29:01 2006
From: tom.mccallum at levelelimited.com (Tom McCallum)
Date: Sat, 09 Dec 2006 13:29:01 -0000
Subject: [Rd] Floating point maths in R
Message-ID: <op.tkanqnenffxks9@norisk>

Hi,

I am not sure if this is just me using R (R-2.3.1 and R-2.4.0) in the  
wrong way or if there is a more serious bug.  I was having problems  
getting some calculations to add up so I ran the following tests:

> (2.34567 - 2.00000) == 0.34567 <------- should be true
[1] FALSE
> (2.23-2.00) == 0.23 <------- should be true
[1] FALSE
> 4-2==2
[1] TRUE
> (4-2)==2
[1] TRUE
> (4.0-2)==2
[1] TRUE
> (4.0-2.0)==2
[1] TRUE
> (4.0-2.0)==2.0
[1] TRUE
> (4.2-2.2)==2.0
[1] TRUE
> (4.20-2.20)==2.00
[1] TRUE
> (4.23-2.23)==2.00  <------- should be true
[1] FALSE
> (4.230-2.230)==2.000 <------- should be true
[1] FALSE
> (4.230-2.230)==2.00 <------- should be true
[1] FALSE
> (4.230-2.23)==2.00 <------- should be true
[1] FALSE

I have tried these on both 64 and 32-bit machines.  Surely R should be  
able to do maths to 2 decimal places and be able to test these simple  
expressions?  The problem occurs as in the 16th decimal place junk is  
being placed by the FPU it seems.  I have also tried:

> (4.2300000000000000-2.230000000000000) == 2
[1] FALSE
> a <- (4.2300000000000000-2.230000000000000)
> a == 2
[1] FALSE
> (4.2300000000000000-2.230000000000000) == 2.0000000000000000
[1] FALSE
> (4.2300000000000000-2.230000000000000) == 2.0000000000000004 <-- correct  
> when add 16th decimal place to 4
[1] TRUE
> (4.2300000000000000-2.230000000000000) == 2.00000000000000043  <-- any  
> values after the 16th decimal place mean that the expression is true
[1] TRUE
> (4.2300000000000000-2.230000000000000) == 2.000000000000000435
[1] TRUE

Also :

> (4.2300000000000000-2.230000000000000) == 2.0000000000000001
[1] FALSE
> (4.2300000000000000-2.230000000000000) == 2.0000000000000003
[1] TRUE
> (4.2300000000000000-2.230000000000000) == 2.0000000000000004
[1] TRUE
> (4.2300000000000000-2.230000000000000) == 2.0000000000000005
[1] TRUE
> (4.2300000000000000-2.230000000000000) == 2.0000000000000006 <-- 3,5 I  
> can understand being true if rounding occurring, but 6?
[1] TRUE
> (4.2300000000000000-2.230000000000000) == 2.0000000000000007
[1] FALSE
> (4.2300000000000000-2.230000000000000) == 2.0000000000000008
[1] FALSE
> (4.2300000000000000-2.230000000000000) == 2.0000000000000009
[1] FALSE
> (4.2300000000000000-2.230000000000000) == 2.0000000000000010


This is an example of junk being added in the FPU
> formatC(a, digits=20)
[1] "2.0000000000000004441"

I don't know if this is just a formatC error when using more than 16  
decimal places or if this junk is what is stopping the equality from being  
true:

> formatC(a, digits=16)
[1] "                2"
> formatC(a, digits=17)  <-- 16 decimal places, 17 significant figures  
> shown
[1] "2.0000000000000004" <-- the problem is the 4 at the end

Obviously the bytes are divided between the exponent and mantissa in  
16-16bit share it seems, but this doesn't account for the 16th decimal  
place behaviour does it?

If any one has a work around or reason why this should occur it would be  
useful to know.

what I would like is to be able to do sums such as (2.3456 - 2 ) == 0.3456  
and get a sensible answer - any suggestions?  Currently the only way is  
for formatC the expression to a known number of decimal places - is there  
a better way?

Many thanks

Tom


-- 
Dr. Thomas McCallum
Systems Architect,
Level E Limited
ETTC, The King's Buildings
Mayfield Road,
Edinburgh EH9 3JL, UK
Work  +44 (0) 131 472 4813
Fax:  +44 (0) 131 472 4719
http://www.levelelimited.com
Email: tom at levelelimited.com

Level E is a limited company incorporated in Scotland. The c...{{dropped}}


From r at erik.prutser.cx  Sat Dec  9 14:35:19 2006
From: r at erik.prutser.cx (Erik van Zijst)
Date: Sat, 09 Dec 2006 14:35:19 +0100
Subject: [Rd] Pre-compilation and server-side parallel execution
In-Reply-To: <79ACB4C7-436F-414A-AAE5-07C04B6FE5EF@r-project.org>
References: <45797BFB.3090302@erik.prutser.cx>
	<79ACB4C7-436F-414A-AAE5-07C04B6FE5EF@r-project.org>
Message-ID: <457ABB97.1000905@erik.prutser.cx>

Simon Urbanek wrote:
> 
> On Dec 8, 2006, at 9:51 AM, Erik van Zijst wrote:
> 
>> 2. R's native C-api
>> [http://cran.r-project.org/doc/manuals/R-exts.html#The-R-API] does not 
>> separate parsing from evaluation.

N.B. above I mistakenly referred to chapter "The R API", but instead I 
was referring to what I read in "Linking GUIs and other front-ends to R".


> Actually it does - see "R_ParseVector" and "eval". You're free to run 
> the parser once (or even construct the expression directly) and evaluate 
> it many times. (Also note that you can serialize the parsed expression 
> if desired).

I think I saw that code fragment, but was under the impression that it 
illustrated how to interact with the R runtime from within a C function 
that is invoked from R (R -> C -> R), rather than directly from C. I'll 
certainly explore this further, thanks for pointing this out.


> If your worries are really at this level, then you will have to create 
> entirely your own solution, because the overhead of IPC will be way more 
> that the time spent in the parser. Actually I'm wondering whether you 
> checked it at all, because I'd almost certainly expect the evaluation to 
> take way more time than the parsing step. If it does, I'd be inclined to 
> think that you have rather a design problem.

Your suspicion is correct Simon, I'm afraid I have not tested anything 
yet, so I'm not sure my worries are justified at all. I'm also entirely 
new to R and I'm not a statistician. I'm involved in this project as a 
systems architect and responsible for choosing a dynamic, programmable 
evaluation environment. Since it'll be all about financial data analysis 
(with analysts currently using matlab and stata on the desktop) I 
studied the area and R surfaced as the most interesting candidate. But 
as you suggest, before we embark on actual development, I need to verify 
that integration of R is feasible in this design. I apologize if this 
yields somewhat elementary questions.

What is your opinion on parallel evaluation of expressions? Is that 
possible in a single R engine instance, or would I need to create a pool 
of instances with IPC like R/Apache does?

cheers,
Erik
-- 
QOTD:
	"I ain't broke, but I'm badly bent."


From p.dalgaard at biostat.ku.dk  Sat Dec  9 14:48:06 2006
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Sat, 09 Dec 2006 14:48:06 +0100
Subject: [Rd] Floating point maths in R
In-Reply-To: <op.tkanqnenffxks9@norisk>
References: <op.tkanqnenffxks9@norisk>
Message-ID: <457ABE96.6000802@biostat.ku.dk>

Tom McCallum wrote:
> Hi,
>
> I am not sure if this is just me using R (R-2.3.1 and R-2.4.0) in the  
> wrong way or if there is a more serious bug.  I was having problems  
> getting some calculations to add up so I ran the following tests:
>
>   
Please read  FAQ 7.31 and the reference therein.

http://cran.r-project.org/doc/FAQ/R-FAQ.html#Why-doesn_0027t-R-think-these-numbers-are-equal_003f

(short answer: You can not represent thirds exactly in decimal nor 
tenths in binary.)
>> (2.34567 - 2.00000) == 0.34567 <------- should be true
>>     
> [1] FALSE
>   
>> (2.23-2.00) == 0.23 <------- should be true
>>     
> [1] FALSE
>   
>> 4-2==2
>>     
> [1] TRUE
>   
>> (4-2)==2
>>     
> [1] TRUE
>   
>> (4.0-2)==2
>>     
> [1] TRUE
>   
>> (4.0-2.0)==2
>>     
> [1] TRUE
>   
>> (4.0-2.0)==2.0
>>     
> [1] TRUE
>   
>> (4.2-2.2)==2.0
>>     
> [1] TRUE
>   
>> (4.20-2.20)==2.00
>>     
> [1] TRUE
>   
>> (4.23-2.23)==2.00  <------- should be true
>>     
> [1] FALSE
>   
>> (4.230-2.230)==2.000 <------- should be true
>>     
> [1] FALSE
>   
>> (4.230-2.230)==2.00 <------- should be true
>>     
> [1] FALSE
>   
>> (4.230-2.23)==2.00 <------- should be true
>>     
> [1] FALSE
>
> I have tried these on both 64 and 32-bit machines.  Surely R should be  
> able to do maths to 2 decimal places and be able to test these simple  
> expressions?  The problem occurs as in the 16th decimal place junk is  
> being placed by the FPU it seems.  I have also tried:
>
>   
>> (4.2300000000000000-2.230000000000000) == 2
>>     
> [1] FALSE
>   
>> a <- (4.2300000000000000-2.230000000000000)
>> a == 2
>>     
> [1] FALSE
>   
>> (4.2300000000000000-2.230000000000000) == 2.0000000000000000
>>     
> [1] FALSE
>   
>> (4.2300000000000000-2.230000000000000) == 2.0000000000000004 <-- correct  
>> when add 16th decimal place to 4
>>     
> [1] TRUE
>   
>> (4.2300000000000000-2.230000000000000) == 2.00000000000000043  <-- any  
>> values after the 16th decimal place mean that the expression is true
>>     
> [1] TRUE
>   
>> (4.2300000000000000-2.230000000000000) == 2.000000000000000435
>>     
> [1] TRUE
>
> Also :
>
>   
>> (4.2300000000000000-2.230000000000000) == 2.0000000000000001
>>     
> [1] FALSE
>   
>> (4.2300000000000000-2.230000000000000) == 2.0000000000000003
>>     
> [1] TRUE
>   
>> (4.2300000000000000-2.230000000000000) == 2.0000000000000004
>>     
> [1] TRUE
>   
>> (4.2300000000000000-2.230000000000000) == 2.0000000000000005
>>     
> [1] TRUE
>   
>> (4.2300000000000000-2.230000000000000) == 2.0000000000000006 <-- 3,5 I  
>> can understand being true if rounding occurring, but 6?
>>     
> [1] TRUE
>   
>> (4.2300000000000000-2.230000000000000) == 2.0000000000000007
>>     
> [1] FALSE
>   
>> (4.2300000000000000-2.230000000000000) == 2.0000000000000008
>>     
> [1] FALSE
>   
>> (4.2300000000000000-2.230000000000000) == 2.0000000000000009
>>     
> [1] FALSE
>   
>> (4.2300000000000000-2.230000000000000) == 2.0000000000000010
>>     
>
>
> This is an example of junk being added in the FPU
>   
>> formatC(a, digits=20)
>>     
> [1] "2.0000000000000004441"
>
> I don't know if this is just a formatC error when using more than 16  
> decimal places or if this junk is what is stopping the equality from being  
> true:
>
>   
>> formatC(a, digits=16)
>>     
> [1] "                2"
>   
>> formatC(a, digits=17)  <-- 16 decimal places, 17 significant figures  
>> shown
>>     
> [1] "2.0000000000000004" <-- the problem is the 4 at the end
>
> Obviously the bytes are divided between the exponent and mantissa in  
> 16-16bit share it seems, but this doesn't account for the 16th decimal  
> place behaviour does it?
>
> If any one has a work around or reason why this should occur it would be  
> useful to know.
>
> what I would like is to be able to do sums such as (2.3456 - 2 ) == 0.3456  
> and get a sensible answer - any suggestions?  Currently the only way is  
> for formatC the expression to a known number of decimal places - is there  
> a better way?
>
> Many thanks
>
> Tom
>
>
>


From murdoch at stats.uwo.ca  Sat Dec  9 14:49:40 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Sat, 09 Dec 2006 08:49:40 -0500
Subject: [Rd] Floating point maths in R
In-Reply-To: <op.tkanqnenffxks9@norisk>
References: <op.tkanqnenffxks9@norisk>
Message-ID: <457ABEF4.2080808@stats.uwo.ca>

On 12/9/2006 8:29 AM, Tom McCallum wrote:
> Hi,
> 
> I am not sure if this is just me using R (R-2.3.1 and R-2.4.0) in the  
> wrong way or if there is a more serious bug.  I was having problems  
> getting some calculations to add up so I ran the following tests:

You should read the FAQ item "Why doesn't R think these numbers are 
equal?" at


http://cran.r-project.org/doc/FAQ/R-FAQ.html#Why-doesn_0027t-R-think-these-numbers-are-equal_003f

Duncan Murdoch

> 
>> (2.34567 - 2.00000) == 0.34567 <------- should be true
> [1] FALSE
>> (2.23-2.00) == 0.23 <------- should be true
> [1] FALSE
>> 4-2==2
> [1] TRUE
>> (4-2)==2
> [1] TRUE
>> (4.0-2)==2
> [1] TRUE
>> (4.0-2.0)==2
> [1] TRUE
>> (4.0-2.0)==2.0
> [1] TRUE
>> (4.2-2.2)==2.0
> [1] TRUE
>> (4.20-2.20)==2.00
> [1] TRUE
>> (4.23-2.23)==2.00  <------- should be true
> [1] FALSE
>> (4.230-2.230)==2.000 <------- should be true
> [1] FALSE
>> (4.230-2.230)==2.00 <------- should be true
> [1] FALSE
>> (4.230-2.23)==2.00 <------- should be true
> [1] FALSE
> 
> I have tried these on both 64 and 32-bit machines.  Surely R should be  
> able to do maths to 2 decimal places and be able to test these simple  
> expressions?  The problem occurs as in the 16th decimal place junk is  
> being placed by the FPU it seems.  I have also tried:
> 
>> (4.2300000000000000-2.230000000000000) == 2
> [1] FALSE
>> a <- (4.2300000000000000-2.230000000000000)
>> a == 2
> [1] FALSE
>> (4.2300000000000000-2.230000000000000) == 2.0000000000000000
> [1] FALSE
>> (4.2300000000000000-2.230000000000000) == 2.0000000000000004 <-- correct  
>> when add 16th decimal place to 4
> [1] TRUE
>> (4.2300000000000000-2.230000000000000) == 2.00000000000000043  <-- any  
>> values after the 16th decimal place mean that the expression is true
> [1] TRUE
>> (4.2300000000000000-2.230000000000000) == 2.000000000000000435
> [1] TRUE
> 
> Also :
> 
>> (4.2300000000000000-2.230000000000000) == 2.0000000000000001
> [1] FALSE
>> (4.2300000000000000-2.230000000000000) == 2.0000000000000003
> [1] TRUE
>> (4.2300000000000000-2.230000000000000) == 2.0000000000000004
> [1] TRUE
>> (4.2300000000000000-2.230000000000000) == 2.0000000000000005
> [1] TRUE
>> (4.2300000000000000-2.230000000000000) == 2.0000000000000006 <-- 3,5 I  
>> can understand being true if rounding occurring, but 6?
> [1] TRUE
>> (4.2300000000000000-2.230000000000000) == 2.0000000000000007
> [1] FALSE
>> (4.2300000000000000-2.230000000000000) == 2.0000000000000008
> [1] FALSE
>> (4.2300000000000000-2.230000000000000) == 2.0000000000000009
> [1] FALSE
>> (4.2300000000000000-2.230000000000000) == 2.0000000000000010
> 
> 
> This is an example of junk being added in the FPU
>> formatC(a, digits=20)
> [1] "2.0000000000000004441"
> 
> I don't know if this is just a formatC error when using more than 16  
> decimal places or if this junk is what is stopping the equality from being  
> true:
> 
>> formatC(a, digits=16)
> [1] "                2"
>> formatC(a, digits=17)  <-- 16 decimal places, 17 significant figures  
>> shown
> [1] "2.0000000000000004" <-- the problem is the 4 at the end
> 
> Obviously the bytes are divided between the exponent and mantissa in  
> 16-16bit share it seems, but this doesn't account for the 16th decimal  
> place behaviour does it?
> 
> If any one has a work around or reason why this should occur it would be  
> useful to know.
> 
> what I would like is to be able to do sums such as (2.3456 - 2 ) == 0.3456  
> and get a sensible answer - any suggestions?  Currently the only way is  
> for formatC the expression to a known number of decimal places - is there  
> a better way?
> 
> Many thanks
> 
> Tom
> 
>


From tom.mccallum at levelelimited.com  Sat Dec  9 14:50:09 2006
From: tom.mccallum at levelelimited.com (Tom McCallum)
Date: Sat, 09 Dec 2006 13:50:09 -0000
Subject: [Rd] Floating point maths in R
In-Reply-To: <457ABE96.6000802@biostat.ku.dk>
References: <op.tkanqnenffxks9@norisk> <457ABE96.6000802@biostat.ku.dk>
Message-ID: <op.tkaopvkcffxks9@norisk>

Many thanks for pointing that out.

Tom


On Sat, 09 Dec 2006 13:48:06 -0000, Peter Dalgaard  
<p.dalgaard at biostat.ku.dk> wrote:

> Tom McCallum wrote:
>> Hi,
>>
>> I am not sure if this is just me using R (R-2.3.1 and R-2.4.0) in the   
>> wrong way or if there is a more serious bug.  I was having problems   
>> getting some calculations to add up so I ran the following tests:
>>
>>
> Please read  FAQ 7.31 and the reference therein.
>
> http://cran.r-project.org/doc/FAQ/R-FAQ.html#Why-doesn_0027t-R-think-these-numbers-are-equal_003f
>
> (short answer: You can not represent thirds exactly in decimal nor  
> tenths in binary.)
>>> (2.34567 - 2.00000) == 0.34567 <------- should be true
>>>
>> [1] FALSE
>>
>>> (2.23-2.00) == 0.23 <------- should be true
>>>
>> [1] FALSE
>>
>>> 4-2==2
>>>
>> [1] TRUE
>>
>>> (4-2)==2
>>>
>> [1] TRUE
>>
>>> (4.0-2)==2
>>>
>> [1] TRUE
>>
>>> (4.0-2.0)==2
>>>
>> [1] TRUE
>>
>>> (4.0-2.0)==2.0
>>>
>> [1] TRUE
>>
>>> (4.2-2.2)==2.0
>>>
>> [1] TRUE
>>
>>> (4.20-2.20)==2.00
>>>
>> [1] TRUE
>>
>>> (4.23-2.23)==2.00  <------- should be true
>>>
>> [1] FALSE
>>
>>> (4.230-2.230)==2.000 <------- should be true
>>>
>> [1] FALSE
>>
>>> (4.230-2.230)==2.00 <------- should be true
>>>
>> [1] FALSE
>>
>>> (4.230-2.23)==2.00 <------- should be true
>>>
>> [1] FALSE
>>
>> I have tried these on both 64 and 32-bit machines.  Surely R should be   
>> able to do maths to 2 decimal places and be able to test these simple   
>> expressions?  The problem occurs as in the 16th decimal place junk is   
>> being placed by the FPU it seems.  I have also tried:
>>
>>
>>> (4.2300000000000000-2.230000000000000) == 2
>>>
>> [1] FALSE
>>
>>> a <- (4.2300000000000000-2.230000000000000)
>>> a == 2
>>>
>> [1] FALSE
>>
>>> (4.2300000000000000-2.230000000000000) == 2.0000000000000000
>>>
>> [1] FALSE
>>
>>> (4.2300000000000000-2.230000000000000) == 2.0000000000000004 <--  
>>> correct  when add 16th decimal place to 4
>>>
>> [1] TRUE
>>
>>> (4.2300000000000000-2.230000000000000) == 2.00000000000000043  <--  
>>> any  values after the 16th decimal place mean that the expression is  
>>> true
>>>
>> [1] TRUE
>>
>>> (4.2300000000000000-2.230000000000000) == 2.000000000000000435
>>>
>> [1] TRUE
>>
>> Also :
>>
>>
>>> (4.2300000000000000-2.230000000000000) == 2.0000000000000001
>>>
>> [1] FALSE
>>
>>> (4.2300000000000000-2.230000000000000) == 2.0000000000000003
>>>
>> [1] TRUE
>>
>>> (4.2300000000000000-2.230000000000000) == 2.0000000000000004
>>>
>> [1] TRUE
>>
>>> (4.2300000000000000-2.230000000000000) == 2.0000000000000005
>>>
>> [1] TRUE
>>
>>> (4.2300000000000000-2.230000000000000) == 2.0000000000000006 <-- 3,5  
>>> I  can understand being true if rounding occurring, but 6?
>>>
>> [1] TRUE
>>
>>> (4.2300000000000000-2.230000000000000) == 2.0000000000000007
>>>
>> [1] FALSE
>>
>>> (4.2300000000000000-2.230000000000000) == 2.0000000000000008
>>>
>> [1] FALSE
>>
>>> (4.2300000000000000-2.230000000000000) == 2.0000000000000009
>>>
>> [1] FALSE
>>
>>> (4.2300000000000000-2.230000000000000) == 2.0000000000000010
>>>
>>
>>
>> This is an example of junk being added in the FPU
>>
>>> formatC(a, digits=20)
>>>
>> [1] "2.0000000000000004441"
>>
>> I don't know if this is just a formatC error when using more than 16   
>> decimal places or if this junk is what is stopping the equality from  
>> being  true:
>>
>>
>>> formatC(a, digits=16)
>>>
>> [1] "                2"
>>
>>> formatC(a, digits=17)  <-- 16 decimal places, 17 significant figures   
>>> shown
>>>
>> [1] "2.0000000000000004" <-- the problem is the 4 at the end
>>
>> Obviously the bytes are divided between the exponent and mantissa in   
>> 16-16bit share it seems, but this doesn't account for the 16th decimal   
>> place behaviour does it?
>>
>> If any one has a work around or reason why this should occur it would  
>> be  useful to know.
>>
>> what I would like is to be able to do sums such as (2.3456 - 2 ) ==  
>> 0.3456  and get a sensible answer - any suggestions?  Currently the  
>> only way is  for formatC the expression to a known number of decimal  
>> places - is there  a better way?
>>
>> Many thanks
>>
>> Tom
>>
>>
>>
>



-- 
Dr. Thomas McCallum
Systems Architect,
Level E Limited
ETTC, The King's Buildings
Mayfield Road,
Edinburgh EH9 3JL, UK
Work  +44 (0) 131 472 4813
Fax:  +44 (0) 131 472 4719
http://www.levelelimited.com
Email: tom at levelelimited.com

Level E is a limited company incorporated in Scotland. The c...{{dropped}}


From tobias.verbeke at telenet.be  Sat Dec  9 22:42:38 2006
From: tobias.verbeke at telenet.be (Tobias Verbeke)
Date: Sat, 09 Dec 2006 22:42:38 +0100
Subject: [Rd] abline for intercept-only simple lm models (with and without
	offset)
Message-ID: <457B2DCE.8030807@telenet.be>

The abline function can be used to draw the
regression line when one passes the lm object
as an argument.

However, if it's an intercept-only model,
it appears to use the intercept
as the slope of the abline:

mod <- lm(dist ~ 1, data = cars)
plot(dist ~ speed, data = cars)
abline(reg = mod) # nothing appears

This behaves as documented, but might catch
someone. Would it be an improvement
if this situation was detected so as to plot
the appropriate horizontal line, i.e.

abline(a = coef(mod), b = 0) ?

Would it also be an improvement if for
a model like

mod2 <- lm(dist ~ 1 + offset(speed), data = cars)

abline(reg = mod2) would be equivalent to

abline(a = coef(mod2), b = 1) ?

For models through the origin, the current
function works fine, but one might even
consider models through the origin and
having the independent variable in an offset()
to be fully fool-proof, i.e.

abline(a = 0, b = 1)

Kind regards,
Tobias


From maechler at stat.math.ethz.ch  Mon Dec 11 14:17:48 2006
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Mon, 11 Dec 2006 14:17:48 +0100
Subject: [Rd] abline for intercept-only simple lm models (with and
	without offset)
In-Reply-To: <457B2DCE.8030807@telenet.be>
References: <457B2DCE.8030807@telenet.be>
Message-ID: <17789.23164.990822.30599@stat.math.ethz.ch>

Yes, I think  all your propositions would be improvements.
OTOH, I don't think the improvements warrant a big increase in
code (complexity), nor do I think the improvements are crucial
for R's integrity.

So...
If you (our someone else) provides a patch {against
R-devel, as always} which keeps the code simple,
I'd strongly consider adding that to R.

Regards,
Martin Maechler

>>>>> "Tobias" == Tobias Verbeke <tobias.verbeke at telenet.be>
>>>>>     on Sat, 09 Dec 2006 22:42:38 +0100 writes:

    Tobias> The abline function can be used to draw the
    Tobias> regression line when one passes the lm object as an
    Tobias> argument.

    Tobias> However, if it's an intercept-only model, it appears
    Tobias> to use the intercept as the slope of the abline:

    Tobias> mod <- lm(dist ~ 1, data = cars) plot(dist ~ speed,
    Tobias> data = cars) abline(reg = mod) # nothing appears

    Tobias> This behaves as documented, but might catch
    Tobias> someone. Would it be an improvement if this
    Tobias> situation was detected so as to plot the appropriate
    Tobias> horizontal line, i.e.

    Tobias> abline(a = coef(mod), b = 0) ?

    Tobias> Would it also be an improvement if for a model like

    Tobias> mod2 <- lm(dist ~ 1 + offset(speed), data = cars)

    Tobias> abline(reg = mod2) would be equivalent to

    Tobias> abline(a = coef(mod2), b = 1) ?

    Tobias> For models through the origin, the current function
    Tobias> works fine, but one might even consider models
    Tobias> through the origin and having the independent
    Tobias> variable in an offset() to be fully fool-proof, i.e.

    Tobias> abline(a = 0, b = 1)

    Tobias> Kind regards, Tobias

    Tobias> ______________________________________________
    Tobias> R-devel at r-project.org mailing list
    Tobias> https://stat.ethz.ch/mailman/listinfo/r-devel


From ellis at stat.harvard.edu  Mon Dec 11 20:55:23 2006
From: ellis at stat.harvard.edu (Byron Ellis)
Date: Mon, 11 Dec 2006 11:55:23 -0800
Subject: [Rd] Wondering about methods (selecting a less specialized method)
Message-ID: <7098abec0612111155lc493c2fj93cd48bad735b7df@mail.gmail.com>

Hi All,

I find myself wondering if there is a canonical means of achieving the
multiple-dispatch version of 'super'? Specifically, I have a set of
classes

A, B, X and Y where B extends A

and a method Foo with the signature (X,A,Y) and I'd like to implement
Foo with the signature (X,B,Y) such that it calls Foo_(X,A,Y) and then
does "other stuff." This gets a bit complicated with multiple
inheritance but at the moment the best I can think to do is an
explicit call to selectMethod.


From sfalcon at fhcrc.org  Mon Dec 11 23:38:30 2006
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Mon, 11 Dec 2006 14:38:30 -0800
Subject: [Rd] Wondering about methods (selecting a less specialized
	method)
In-Reply-To: <7098abec0612111155lc493c2fj93cd48bad735b7df@mail.gmail.com>
	(Byron Ellis's message of "Mon, 11 Dec 2006 11:55:23 -0800")
References: <7098abec0612111155lc493c2fj93cd48bad735b7df@mail.gmail.com>
Message-ID: <m2vekicb2x.fsf@ziti.local>

"Byron Ellis" <ellis at stat.harvard.edu> writes:

> Hi All,
>
> I find myself wondering if there is a canonical means of achieving the
> multiple-dispatch version of 'super'? Specifically, I have a set of
> classes
>
> A, B, X and Y where B extends A
>
> and a method Foo with the signature (X,A,Y) and I'd like to implement
> Foo with the signature (X,B,Y) such that it calls Foo_(X,A,Y) and then
> does "other stuff." This gets a bit complicated with multiple
> inheritance but at the moment the best I can think to do is an
> explicit call to selectMethod.

I would expect callNextMethod to work in most cases.  Have you tried
that?

setMethod("Foo", c("X", "B", "Y"),
          function(x, b, y) {
              ans <- callNextMethod()
              ## more
          })

+ seth


From ellis at stat.harvard.edu  Tue Dec 12 00:55:42 2006
From: ellis at stat.harvard.edu (Byron Ellis)
Date: Mon, 11 Dec 2006 15:55:42 -0800
Subject: [Rd] Wondering about methods (selecting a less specialized
	method)
In-Reply-To: <m2vekicb2x.fsf@ziti.local>
References: <7098abec0612111155lc493c2fj93cd48bad735b7df@mail.gmail.com>
	<m2vekicb2x.fsf@ziti.local>
Message-ID: <7098abec0612111555w3e4edb26l2d3554765c09cff9@mail.gmail.com>

Yup, that does it---I knew there was something but couldn't remember
what it was :-)

On 12/11/06, Seth Falcon <sfalcon at fhcrc.org> wrote:
> "Byron Ellis" <ellis at stat.harvard.edu> writes:
>
> > Hi All,
> >
> > I find myself wondering if there is a canonical means of achieving the
> > multiple-dispatch version of 'super'? Specifically, I have a set of
> > classes
> >
> > A, B, X and Y where B extends A
> >
> > and a method Foo with the signature (X,A,Y) and I'd like to implement
> > Foo with the signature (X,B,Y) such that it calls Foo_(X,A,Y) and then
> > does "other stuff." This gets a bit complicated with multiple
> > inheritance but at the moment the best I can think to do is an
> > explicit call to selectMethod.
>
> I would expect callNextMethod to work in most cases.  Have you tried
> that?
>
> setMethod("Foo", c("X", "B", "Y"),
>           function(x, b, y) {
>               ans <- callNextMethod()
>               ## more
>           })
>
> + seth
>
>


-- 
Byron Ellis (byron.ellis at gmail.com)
"Oook" -- The Librarian


From gregor.gorjanc at bfro.uni-lj.si  Tue Dec 12 09:19:41 2006
From: gregor.gorjanc at bfro.uni-lj.si (Gregor Gorjanc)
Date: Tue, 12 Dec 2006 09:19:41 +0100
Subject: [Rd] Enhances, require() and quality control
In-Reply-To: <17785.51000.419093.552316@mithrandir.hornik.net>
References: <4577626C.7020504@bfro.uni-lj.si>
	<17785.51000.419093.552316@mithrandir.hornik.net>
Message-ID: <457E661D.5070009@bfro.uni-lj.si>

Kurt Hornik wrote:
>>>>>> Gregor Gorjanc writes:
> 
>> Hello!
> 
>> I am working on a package where Enhances field seems to be a plausible
>> option. When I add package, say coda, to this field, I get the
>> following warning with recent R-devel:
> 
>> ----
> 
>> * checking for working latex ... OK
>> * using log directory '/home/ggorjan/programs/R/devel/test.Rcheck'
>> * using R version 2.5.0 Under development (unstable) (2006-12-06 r40129)
>> * checking for file 'test/DESCRIPTION' ... OK
>> * this is package 'test' version '0.1'
>> * checking package dependencies ... WARNING
>> 'library' or 'require' calls not declared from:
>>   coda
> 
>> See the information on DESCRIPTION files in the chapter 'Creating R
>> packages' of the 'Writing R Extensions' manual.
> 
> Why would you think that Enhances: is right here?
> 
> If you use library or require on a package, you do more than enhance it,
> and the package should be listed in Depends or Suggests.

I might have understood Enhances field wrongly but imagine this
situation. I have a package A and if I can use package B I would like to
use it otherwise try with "my own" solution. I thought that Enhances
fields is exactly for such situation. How should I check if package B is
available? I used

if(require(B)) {
  someSuperDuperFuncFromPkgB()
} else {
  myOwnStuff()
}

But R CMD check complains.

I have encountered this with R2WinBUGS. This package helps calling
WinBUGS from R. It can also use OpenBUGS via BRugs, but BRugs is
available only for Windows. Therefore, one can not do any QC under
Linux. I thought to provide ability to call OpenBUGS via the same way
WinBUGS is called and then to put BRugs in Enhances field. But R CMD
check complained about use of require() for a package that is in
Enhanced field.

Thanks!

Gregor


From jhallman at frb.gov  Tue Dec 12 16:51:43 2006
From: jhallman at frb.gov (jhallman at frb.gov)
Date: Tue, 12 Dec 2006 10:51:43 -0500
Subject: [Rd] Documenting revised functions
Message-ID: <20061212155143.99F845362D@mail.rsma.frb.gov>

I am running into some problems with the way R CMD check looks at
documentation. 

The stats::filter function returns a time series with class "ts" or
c("mts", "ts") if it is multivariate.  I have created a more capable
time series class called "tis" as part of my fame package.  My package
redefines filter() as a generic function, and has filter.default() call
the stats::filter function.  The filter.tis() function calls
filter.default() and turns the result into a tis series. 

My problem is how to document this.  Since my package exports filter(),
it needs an \alias{filter} in an Rd document, otherwise R CMD check
complains about an undocumented object.  However, when I fix that by
having an Rd document with \alias{filter} in it, help(filter) puts up
the too-small tk_select.list() menu I've complained about before to ask
me which help document I want, the package::fame one or the
package::stats one.  And because the generic filter() is now

filter <- function (x, ...) UseMethod("filter")

the filter.default() function also has to have a useless ... argument in
it to avoid this warning from R CMD check:

* checking S3 generic/method consistency ... WARNING
filter:
  function(x, ...)
filter.default:
  function(x, filter, method, sides, circular, init)

Of course, if I add the ... argument to filter.default(), I then have to
add an \item{\dots} to its help document, wherein I get to explain to
the mystified reader that the argument is ignored.

Am I missing something here?  How should I go about documenting my
generic filter() and its methods?

Jeff


From mgd at santafe.edu  Tue Dec 12 17:05:15 2006
From: mgd at santafe.edu (Marcus G. Daniels)
Date: Tue, 12 Dec 2006 09:05:15 -0700
Subject: [Rd] data frame subset patch, take 2
In-Reply-To: <200612061333.09050.vdergachev@rcgardis.com>
References: <200612061333.09050.vdergachev@rcgardis.com>
Message-ID: <457ED33B.9040204@santafe.edu>

Vladimir Dergachev wrote:
> Here is the second iteration of data frame subset patch.
> It now passes make check on both 2.4.0 and 2.5.0 (svn as of a few days ago).
> Same speedup as before.
>   
Hi,

I was wondering if this patch would make it into the next release.  I 
don't see it in SVN, but it's hard to be sure because the mailing list 
apparently strips attachments.  If it isn't in, or going to be in, is 
this patch available somewhere else?

Thanks,

Marcus


From maechler at stat.math.ethz.ch  Tue Dec 12 18:08:01 2006
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Tue, 12 Dec 2006 18:08:01 +0100
Subject: [Rd] data frame subset patch, take 2
In-Reply-To: <457ED33B.9040204@santafe.edu>
References: <200612061333.09050.vdergachev@rcgardis.com>
	<457ED33B.9040204@santafe.edu>
Message-ID: <17790.57841.903638.110900@stat.math.ethz.ch>

>>>>> "Marcus" == Marcus G Daniels <mgd at santafe.edu>
>>>>>     on Tue, 12 Dec 2006 09:05:15 -0700 writes:

    Marcus> Vladimir Dergachev wrote:
    >> Here is the second iteration of data frame subset patch.
    >> It now passes make check on both 2.4.0 and 2.5.0 (svn as
    >> of a few days ago).  Same speedup as before.
    >> 
    Marcus> Hi,

    Marcus> I was wondering if this patch would make it into the
    Marcus> next release.  I don't see it in SVN, but it's hard
    Marcus> to be sure because the mailing list apparently
    Marcus> strips attachments.  If it isn't in, or going to be
    Marcus> in, is this patch available somewhere else?

I was wondering too.
      http://www.r-project.org/mail.html
explains what kind of attachments are allowed on R-devel.

I'm particularly interested, since during the last several days
I've made (somewhat experimental) changes to R-devel,
which makes some dealings with large data frames that have
"trivial rownames" (those represented as  1:nrow(.))
much more efficient.

Notably, as.matrix() of such data frames now no longer produces
huge row names, and e.g.  dim(.) of such data frames has become
lightning fast [compared to what it was].

Some measurements:

N <- 1e6
set.seed(1)
## we round (for later dump().. reasons)
x <- round(rnorm(N),2)
y <- round(rnorm(N),2)
mOrig <- cbind(x = x, y = y)
df <- data.frame(x = x, y = y)
mNew <- as.matrix(df)
(sizes <- sapply(list(mOrig=mOrig, df=df, mNew=mNew), object.size))
## R-2.4.0 (64-bit):
##    mOrig       df     mNew
## 16000520 16000776 72000560

## R-2.4.1 beta (32-bit):
##    mOrig       df     mNew
## 16000296 16000448 52000320

## R-pre-2.5.0 (32-bit):
##    mOrig       df     mNew
## 16000296 16000448 16000296

##------------------------------------

N <- 1e6
df <- data.frame(x = 0+ 1:N, y = 1+ 1:N)
system.time(for(i in 1:1000) d <- dim(df))

## R-2.4.1 beta (32-bit) [deb1]:
## [1] 1.920 3.748 7.810 0.000 0.000

## R-pre-2.5.0 (32-bit) [deb1]:
##    user  system elapsed
##   0.012   0.000   0.011


--- --- --- --- --- --- --- --- --- --- 

However, currently

  df[2,] ## still internally produces the  character(1e6)  row names!

something I think we should eliminate as well,
i.e., at least make sure that only  seq_len(1e6) is internally
produced and not the character vector.

Note however that some of these changes are backward
incompatible. I do hope that the changes gaining efficiency
for such large data frames are worth some adaption of
current/old R source code..

Feedback on this topic is very welcome!

Martin


From mgd at santafe.edu  Tue Dec 12 18:32:14 2006
From: mgd at santafe.edu (Marcus G. Daniels)
Date: Tue, 12 Dec 2006 10:32:14 -0700
Subject: [Rd] data frame subset patch, take 2
In-Reply-To: <17790.57841.903638.110900@stat.math.ethz.ch>
References: <200612061333.09050.vdergachev@rcgardis.com>	<457ED33B.9040204@santafe.edu>
	<17790.57841.903638.110900@stat.math.ethz.ch>
Message-ID: <457EE79E.4030003@santafe.edu>

Hi Martin,

Conventions for optimizing away long, useless row name vector sound very 
useful. Nice timings too!
I've noticed that before, and not been sure quite what to do.   e.g. the 
hdf5 module just gives up past a certain threshold as the long vectors 
cause performance problems and HDF5 doesn't allow giant attributes 
anyway.  The common case for me, is no row names except numbers.
> Note however that some of these changes are backward
> incompatible. I do hope that the changes gaining efficiency
> for such large data frames are worth some adaption of
> current/old R source code..
>   
On numerous occasions I've used 64 bit Altix systems, e.g. having a 
terabyte of RAM, for loading and preprocessing data, just so I can zip 
around in the image once it is done (either on that system or 
another).    R works great for big datasets, even though it has a few of 
these rough edges..

Marcus


From rgentlem at fhcrc.org  Tue Dec 12 18:41:50 2006
From: rgentlem at fhcrc.org (Robert Gentleman)
Date: Tue, 12 Dec 2006 09:41:50 -0800
Subject: [Rd] data frame subset patch, take 2
In-Reply-To: <17790.57841.903638.110900@stat.math.ethz.ch>
References: <200612061333.09050.vdergachev@rcgardis.com>	<457ED33B.9040204@santafe.edu>
	<17790.57841.903638.110900@stat.math.ethz.ch>
Message-ID: <457EE9DE.7050001@fhcrc.org>

Hi,
  I tried take 1, and it failed. I have been traveling (and with 
Martin's changes also waiting for things to stabilize) before trying 
take 2, probably later this week and I will send an email if it goes in. 
Anyone wanting to try it and run R through check and check-all is 
welcome to do so and report success or failure.

  best wishes
    Robert


Martin Maechler wrote:
>>>>>> "Marcus" == Marcus G Daniels <mgd at santafe.edu>
>>>>>>     on Tue, 12 Dec 2006 09:05:15 -0700 writes:
> 
>     Marcus> Vladimir Dergachev wrote:
>     >> Here is the second iteration of data frame subset patch.
>     >> It now passes make check on both 2.4.0 and 2.5.0 (svn as
>     >> of a few days ago).  Same speedup as before.
>     >> 
>     Marcus> Hi,
> 
>     Marcus> I was wondering if this patch would make it into the
>     Marcus> next release.  I don't see it in SVN, but it's hard
>     Marcus> to be sure because the mailing list apparently
>     Marcus> strips attachments.  If it isn't in, or going to be
>     Marcus> in, is this patch available somewhere else?
> 
> I was wondering too.
>       http://www.r-project.org/mail.html
> explains what kind of attachments are allowed on R-devel.
> 
> I'm particularly interested, since during the last several days
> I've made (somewhat experimental) changes to R-devel,
> which makes some dealings with large data frames that have
> "trivial rownames" (those represented as  1:nrow(.))
> much more efficient.
> 
> Notably, as.matrix() of such data frames now no longer produces
> huge row names, and e.g.  dim(.) of such data frames has become
> lightning fast [compared to what it was].
> 
> Some measurements:
> 
> N <- 1e6
> set.seed(1)
> ## we round (for later dump().. reasons)
> x <- round(rnorm(N),2)
> y <- round(rnorm(N),2)
> mOrig <- cbind(x = x, y = y)
> df <- data.frame(x = x, y = y)
> mNew <- as.matrix(df)
> (sizes <- sapply(list(mOrig=mOrig, df=df, mNew=mNew), object.size))
> ## R-2.4.0 (64-bit):
> ##    mOrig       df     mNew
> ## 16000520 16000776 72000560
> 
> ## R-2.4.1 beta (32-bit):
> ##    mOrig       df     mNew
> ## 16000296 16000448 52000320
> 
> ## R-pre-2.5.0 (32-bit):
> ##    mOrig       df     mNew
> ## 16000296 16000448 16000296
> 
> ##------------------------------------
> 
> N <- 1e6
> df <- data.frame(x = 0+ 1:N, y = 1+ 1:N)
> system.time(for(i in 1:1000) d <- dim(df))
> 
> ## R-2.4.1 beta (32-bit) [deb1]:
> ## [1] 1.920 3.748 7.810 0.000 0.000
> 
> ## R-pre-2.5.0 (32-bit) [deb1]:
> ##    user  system elapsed
> ##   0.012   0.000   0.011
> 
> 
> --- --- --- --- --- --- --- --- --- --- 
> 
> However, currently
> 
>   df[2,] ## still internally produces the  character(1e6)  row names!
> 
> something I think we should eliminate as well,
> i.e., at least make sure that only  seq_len(1e6) is internally
> produced and not the character vector.
> 
> Note however that some of these changes are backward
> incompatible. I do hope that the changes gaining efficiency
> for such large data frames are worth some adaption of
> current/old R source code..
> 
> Feedback on this topic is very welcome!
> 
> Martin
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 

-- 
Robert Gentleman, PhD
Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M2-B876
PO Box 19024
Seattle, Washington 98109-1024
206-667-7700
rgentlem at fhcrc.org


From gregor.gorjanc at bfro.uni-lj.si  Tue Dec 12 21:50:41 2006
From: gregor.gorjanc at bfro.uni-lj.si (Gregor Gorjanc)
Date: Tue, 12 Dec 2006 21:50:41 +0100
Subject: [Rd] Conditional suggest (was Re:  Enhances,
 require() and quality control)
In-Reply-To: <17791.3473.773533.683137@mithrandir.hornik.net>
References: <4577626C.7020504@bfro.uni-lj.si>	<17785.51000.419093.552316@mithrandir.hornik.net>	<457E661D.5070009@bfro.uni-lj.si>
	<17791.3473.773533.683137@mithrandir.hornik.net>
Message-ID: <457F1621.2080304@bfro.uni-lj.si>

Kurt Hornik wrote:
>>>>>> Gregor Gorjanc writes:
...
>> I might have understood Enhances field wrongly but imagine this
>> situation. I have a package A and if I can use package B I would like to
>> use it otherwise try with "my own" solution. I thought that Enhances
>> fields is exactly for such situation. How should I check if package B is
>> available? I used
> 
>> if(require(B)) {
>>   someSuperDuperFuncFromPkgB()
>> } else {
>>   myOwnStuff()
>> }
> 
>> But R CMD check complains.
> 
>> I have encountered this with R2WinBUGS. This package helps calling
>> WinBUGS from R. It can also use OpenBUGS via BRugs, but BRugs is
>> available only for Windows. Therefore, one can not do any QC under
>> Linux. I thought to provide ability to call OpenBUGS via the same way
>> WinBUGS is called and then to put BRugs in Enhances field. But R CMD
>> check complained about use of require() for a package that is in
>> Enhanced field.
> 
> This is not "enhancing" the way it is currently implemented, which is
> allowing for the possibility to provide S3 or S4 methods for classes
> from another package without actively suggesting it (thus enhancing
> it).  What you describe seems to be a need for conditionally suggesting
> packages, e.g. if it is known that these are only available on certain
> platforms.  I don't think this is currently possible.

OK. Is there some way to test which package is being used i.e. the
"standard" or enhanced one? Or to paraphrase this differently. Are there
any proposals how "conditional suggest" could be done?

Thanks!

Gregor


From braunm at MIT.EDU  Tue Dec 12 21:50:50 2006
From: braunm at MIT.EDU (braunm at MIT.EDU)
Date: Tue, 12 Dec 2006 15:50:50 -0500
Subject: [Rd] include libraries for C code called from R
Message-ID: <20061212155050.umhvo2m41gggcgo4@webmail.mit.edu>

I hope that someone on this list can help me with this issue.  I have searched
through all of the documentation and mail archives for a solution, but have
been unable to find an answer that addresses my particular problem directly.

Suppose I am writing some C code that I want to access from R through the .C
function.  As part of the C function, I want to include an external C library,
such as the GNU gsl library.  So, if I want to compute the value of a Gaussian
hypergeometric function, my C code would be:

#include </usr/include/gsl/gsl_sf_hyperg.h>
void gslTestHG (double *a, double *b, double *c, double *x, double *val ) {

	*val = gsl_sf_hyperg_2F1(*a,*b,*c,*x);
}

I then compile this file (successfully, on a Linux machine with gcc installed)
using R CMD SHLIB gslTest.c.  The message from the complier is:

gcc -I/usr/lib64/R/include -I/usr/lib64/R/include  -I/usr/local/include   -fpic
-O2 -g -c RgslTest.c -o RgslTest.o
gcc -shared -L/usr/local/lib64 -o RgslTest.so RgslTest.o -L/usr/lib64/R/lib -lR


When I go into R and enter the command dyn.load("gslTestHG.so"), I get the
following error:

Error in dyn.load(x, as.logical(local), as.logical(now)) : unable to load shared
library '/mnt/san2/braunm/winshare/braunm/Cpractice/RgslTest.so':
  /mnt/san2/braunm/winshare/braunm/Cpractice/RgslTest.so: undefined symbol:
gsl_sf_hyperg_2F1

So, it looks like R is not recognizing the function call within my own C
function, even though the library was included.

Note that this is a simpler example of my "real" problem, the details of which
would bog down discussion.  I know that I could use the gsl package, or include
the Rmath.h library, to perform this particular task.  My primary need is the
ability to call C libraries from wtihin my own C code.

But I would greatly appreciate any advice or suggestions on how to solve this
problem.  I am a novice C programmer and Linux user, but it seems like this
should be a simple fix.

Many thanks in advance,

Michael Braun
MIT Sloan School of Management
braunm at mit.edu


From braunm at MIT.EDU  Tue Dec 12 22:03:35 2006
From: braunm at MIT.EDU (Michael Braun)
Date: Tue, 12 Dec 2006 16:03:35 -0500
Subject: [Rd] Undefined symbol when trying to dyn.load a shared object
Message-ID: <20061212160335156.00000003624@braunm1>

I hope that someone reading this list can offer some suggestions on how I can incorporate external C libraries in C functions that I want to call from R.  I have gone through all of the documentation, help files and mailing list archives and have not been able to find a satisfactory solution.

I have constructed a simple example of the problem, since my "real" program is much more complex and would bog down discussion.  Suppose I want to compute the value of a Gaussian hypergeometric function using the function in the GSL library.  My C code is:

	#include </usr/include/gsl/gsl_sf_hyperg.h>

	void gslTestHG (double *a, double *b, double *c, double *x, double *val ) {
		*val = gsl_sf_hyperg_2F1(*a,*b,*c,*x); 
	}

I compile this code (successfully) using R CMD SHLIB gslTest.c and get the following result

	-bash-3.00$ R CMD SHLIB RgslTest.c
	gcc -I/usr/lib64/R/include -I/usr/lib64/R/include  -I/usr/local/include   -fpic  -O2 -g -c RgslTest.c -o RgslTest.o
	gcc -shared -L/usr/local/lib64 -o RgslTest.so RgslTest.o   -L/usr/lib64/R/lib -lR

Next, I try to load the shared object into R using dyn.load("RgslTest.so") and get the following error in R:

	> dyn.load("RgslTest.so")
	Error in dyn.load(x, as.logical(local), as.logical(now)) : 
        unable to load shared library '/mnt/san2/braunm/winshare/braunm/Cpractice/RgslTest.so':
 	 /mnt/san2/braunm/winshare/braunm/Cpractice/RgslTest.so: undefined symbol: gsl_sf_hyperg_2F1

I am certain that the file path in the #include statement is correct.  It looks like R can't find the gsl function in the C program, even though the compiler did.

I would greatly appreciate any help you can provide.  Many thanks in advance.

Best wishes,

Michael

------------------------------------------
Michael Braun
Assistant Professor of Marketing
MIT Sloan School of Management
38 Memorial Drive, E56-329
Cambridge, MA 02139
braunm at mit.edu
(617) 253-3436


From sfalcon at fhcrc.org  Tue Dec 12 22:39:53 2006
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Tue, 12 Dec 2006 13:39:53 -0800
Subject: [Rd] Conditional suggest
In-Reply-To: <457F1621.2080304@bfro.uni-lj.si> (Gregor Gorjanc's message of
	"Tue, 12 Dec 2006 21:50:41 +0100")
References: <4577626C.7020504@bfro.uni-lj.si>
	<17785.51000.419093.552316@mithrandir.hornik.net>
	<457E661D.5070009@bfro.uni-lj.si>
	<17791.3473.773533.683137@mithrandir.hornik.net>
	<457F1621.2080304@bfro.uni-lj.si>
Message-ID: <m21wn423py.fsf@ziti.local>

Kurt wrote:
>> This is not "enhancing" the way it is currently implemented, which is
>> allowing for the possibility to provide S3 or S4 methods for classes
>> from another package without actively suggesting it (thus enhancing
>> it).  

By provide an S4 method for a class, I guess you mean define a method
that includes one of the classes in its signature.  In any case, I'm
pretty sure that one must have the class definition available to
define such a method -- I think this means that to define such a
method, one must have the package defining the class loaded.  

So doesn't "enhancing" imply code like:

   if (require("Fruit"))
       setMethod("grow", "Apple", ...)

Maybe I'm missing something about how enhances is intended to work.  I
admit to being a bit oversensitive on the issue.  I find the current
warning about calls to require to be a bit overzelous.  We have a
number of packages in Bioconductor that contain functions which
attempt to load annotation data packages, for example, and these
trigger the warning.

While in general, I think it should be possible for package authors to
say "this is a package I might load if it is available, but please do
R CMD check anyway if it is not available", it doesn't even help with
packages that want to load a data package since it is not possible to
list all possible data packages ahead of time.

I don't want to start seeing spam in package code like:

   ploader <- get(paste("r", "e", "q", "u", "i", "r", "e", sep=""))
   ploader("somePkg")

just to avoid a warning message.  But warnings from R CMD check, for
our project, have substantially less value as more of them become "oh,
that is an OK warning message".

Maybe I've strayed too far off topic here.  Sorry.

+ seth


From murdoch at stats.uwo.ca  Tue Dec 12 22:46:02 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Tue, 12 Dec 2006 16:46:02 -0500
Subject: [Rd] Undefined symbol when trying to dyn.load a shared object
In-Reply-To: <20061212160335156.00000003624@braunm1>
References: <20061212160335156.00000003624@braunm1>
Message-ID: <457F231A.8050304@stats.uwo.ca>

On 12/12/2006 4:03 PM, Michael Braun wrote:
> I hope that someone reading this list can offer some suggestions on how I can incorporate external C libraries in C functions that I want to call from R.  I have gone through all of the documentation, help files and mailing list archives and have not been able to find a satisfactory solution.
> 
> I have constructed a simple example of the problem, since my "real" program is much more complex and would bog down discussion.  Suppose I want to compute the value of a Gaussian hypergeometric function using the function in the GSL library.  My C code is:
> 
> 	#include </usr/include/gsl/gsl_sf_hyperg.h>
> 
> 	void gslTestHG (double *a, double *b, double *c, double *x, double *val ) {
> 		*val = gsl_sf_hyperg_2F1(*a,*b,*c,*x); 
> 	}
> 
> I compile this code (successfully) using R CMD SHLIB gslTest.c and get the following result
> 
> 	-bash-3.00$ R CMD SHLIB RgslTest.c
> 	gcc -I/usr/lib64/R/include -I/usr/lib64/R/include  -I/usr/local/include   -fpic  -O2 -g -c RgslTest.c -o RgslTest.o
> 	gcc -shared -L/usr/local/lib64 -o RgslTest.so RgslTest.o   -L/usr/lib64/R/lib -lR
> 
> Next, I try to load the shared object into R using dyn.load("RgslTest.so") and get the following error in R:
> 
> 	> dyn.load("RgslTest.so")
> 	Error in dyn.load(x, as.logical(local), as.logical(now)) : 
>         unable to load shared library '/mnt/san2/braunm/winshare/braunm/Cpractice/RgslTest.so':
>  	 /mnt/san2/braunm/winshare/braunm/Cpractice/RgslTest.so: undefined symbol: gsl_sf_hyperg_2F1
> 
> I am certain that the file path in the #include statement is correct.  It looks like R can't find the gsl function in the C program, even though the compiler did.

The #include statement just includes the headers, so that calls to the 
functions are constructed properly by the compiler.  It doesn't pull in 
the library.  That's done at link time.

You need at least a Makevars file which defines PKG_LIBS to tell the 
linker where to find the external library.  That macro should contain 
linker options -l and -L that point out the need for gsl, and where to 
find it. If you want to distribute this package to others, you'll 
probably need a configure script too, in order to construct those values.

Duncan Murdoch

> I would greatly appreciate any help you can provide.  Many thanks in advance.
> 
> Best wishes,
> 
> Michael
> 
> ------------------------------------------
> Michael Braun
> Assistant Professor of Marketing
> MIT Sloan School of Management
> 38 Memorial Drive, E56-329
> Cambridge, MA 02139
> braunm at mit.edu
> (617) 253-3436
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From duncan at wald.ucdavis.edu  Tue Dec 12 22:51:13 2006
From: duncan at wald.ucdavis.edu (Duncan Temple Lang)
Date: Tue, 12 Dec 2006 13:51:13 -0800
Subject: [Rd] include libraries for C code called from R
In-Reply-To: <20061212155050.umhvo2m41gggcgo4@webmail.mit.edu>
References: <20061212155050.umhvo2m41gggcgo4@webmail.mit.edu>
Message-ID: <457F2451.4090508@wald.ucdavis.edu>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hi Michael.

 [There's no need to send two pieces of mail that are essentially the
same issue.]

 The problem is that when you are creating the shared object
gslTestHG.so, you are not telling the linker to combine information
from the libgsl.so or libgsl.a file.  The linker needs that to resolve
the symbols that were referenced in your RgslTest.c code.
Without this, the linker then assumes that these missing symbols will be
found when the .so is loaded, i.e. in the host application, namely R.
Compiling, linking and loading are three different steps in this
process. It helps to diagnose problems if one has an understanding
of what each does (approximately). Otherwise, the error messages
can be cryptic.

 One way to fix the problem is to create a file names Makevars in the
same directory as  RgslTest.c and add to it

  PKG_CPPFLAGS=-I/usr/include
  PKG_LIBS=-L/usr/lib -lgsl

The second of these lines tells the linker to include the symbols in
libgsl.so or libgsl.a  and that it should look for this in /usr/lib/
(You may have to change this, but it looks like that is where you have
gsl installed juding from the #include).
The -I/usr/include and -L/usr/lib  are likely to be unnecessary
but illustrate the idea that one adds library-specific include
and library directories to allow the compiler and linker
respectively find files it needs for that library's code.

And change your RgslTest.c code to have
   #include <gsl/gsl_sf_hyperg.h>
not the full path name to the .h file.


D.


braunm at MIT.EDU wrote:
> I hope that someone on this list can help me with this issue.  I have searched
> through all of the documentation and mail archives for a solution, but have
> been unable to find an answer that addresses my particular problem directly.
> 
> Suppose I am writing some C code that I want to access from R through the .C
> function.  As part of the C function, I want to include an external C library,
> such as the GNU gsl library.  So, if I want to compute the value of a Gaussian
> hypergeometric function, my C code would be:
> 
> #include </usr/include/gsl/gsl_sf_hyperg.h>
> void gslTestHG (double *a, double *b, double *c, double *x, double *val ) {
> 
> 	*val = gsl_sf_hyperg_2F1(*a,*b,*c,*x);
> }
> 
> I then compile this file (successfully, on a Linux machine with gcc installed)
> using R CMD SHLIB gslTest.c.  The message from the complier is:
> 
> gcc -I/usr/lib64/R/include -I/usr/lib64/R/include  -I/usr/local/include   -fpic
> -O2 -g -c RgslTest.c -o RgslTest.o
> gcc -shared -L/usr/local/lib64 -o RgslTest.so RgslTest.o -L/usr/lib64/R/lib -lR
> 
> 
> When I go into R and enter the command dyn.load("gslTestHG.so"), I get the
> following error:
> 
> Error in dyn.load(x, as.logical(local), as.logical(now)) : unable to load shared
> library '/mnt/san2/braunm/winshare/braunm/Cpractice/RgslTest.so':
>   /mnt/san2/braunm/winshare/braunm/Cpractice/RgslTest.so: undefined symbol:
> gsl_sf_hyperg_2F1
> 
> So, it looks like R is not recognizing the function call within my own C
> function, even though the library was included.
> 
> Note that this is a simpler example of my "real" problem, the details of which
> would bog down discussion.  I know that I could use the gsl package, or include
> the Rmath.h library, to perform this particular task.  My primary need is the
> ability to call C libraries from wtihin my own C code.
> 
> But I would greatly appreciate any advice or suggestions on how to solve this
> problem.  I am a novice C programmer and Linux user, but it seems like this
> should be a simple fix.
> 
> Many thanks in advance,
> 
> Michael Braun
> MIT Sloan School of Management
> braunm at mit.edu
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

- --
Duncan Temple Lang                    duncan at wald.ucdavis.edu
Department of Statistics              work:  (530) 752-4782
4210 Mathematical Sciences Building   fax:   (530) 752-7099
One Shields Ave.
University of California at Davis
Davis,
CA 95616,
USA
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.3 (Darwin)

iD8DBQFFfyRR9p/Jzwa2QP4RAvBBAJ9nNDK4kWNt2fpCv9pw/r3XPpq6VQCfU9CL
ziDU+0OcPTEJgVV1RR/OFvA=
=oMxN
-----END PGP SIGNATURE-----


From goran.brostrom at gmail.com  Tue Dec 12 23:33:35 2006
From: goran.brostrom at gmail.com (=?UTF-8?Q?G=C3=B6ran_Brostr=C3=B6m?=)
Date: Tue, 12 Dec 2006 23:33:35 +0100
Subject: [Rd] [R] Segfault in pure R code
In-Reply-To: <148ed8180612121414x5763a5f1k4c802976fe9c85fe@mail.gmail.com>
References: <148ed8180612121218pea45e0agcdb39a8b9fe9ff43@mail.gmail.com>
	<457F18AB.4020109@biostat.ku.dk>
	<148ed8180612121414x5763a5f1k4c802976fe9c85fe@mail.gmail.com>
Message-ID: <148ed8180612121433n1287d12al6fdc622722d0b3ef@mail.gmail.com>

I tried once more under the debugger, and

++++++++++++++++++++++++++++++++++++++++++
gb at kasparov:~/R/BEMANNING/Doc$ R -d gdb
GNU gdb 6.5-debian
Copyright (C) 2006 Free Software Foundation, Inc.
GDB is free software, covered by the GNU General Public License, and you are
welcome to change it and/or distribute copies of it under certain conditions.
Type "show copying" to see the conditions.
There is absolutely no warranty for GDB.  Type "show warranty" for details.
This GDB was configured as "i486-linux-gnu"...Using host libthread_db
library "/lib/tls/i686/cmov/libthread_db.so.1".

(gdb) run
Starting program: /usr/local/lib/R/bin/exec/R
Failed to read a valid object file image from memory.

R version 2.4.0 Patched (2006-10-29 r39744)
Copyright (C) 2006 The R Foundation for Statistical Computing
ISBN 3-900051-07-0

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

[Previously saved workspace restored]

> library(xtable)
> ?xtable)
Error: syntax error in "?xtable)"
> ?xtable
> help.start()
Making links in per-session dir ...
If '/usr/bin/firefox' is already running, it is *not* restarted, and
    you must switch to its window.
Otherwise, be patient ...
> library(bemanning)
> load("bemanning07-32.rda")
> courses("Ingrid")

Program received signal SIGSEGV, Segmentation fault.
0x080f5026 in R_gc_internal (size_needed=17588127) at memory.c:1313
1313        PROCESS_NODES();
(gdb)
++++++++++++++++++++++++++++++++++++++++++++

How do I continue?

G?ran

On 12/12/06, G?ran Brostr?m <goran.brostrom at gmail.com> wrote:
> On 12/12/06, Peter Dalgaard <p.dalgaard at biostat.ku.dk> wrote:
> > G?ran Brostr?m wrote:
> > > I just caught a segfault:
> > >
> > >
> > >> courses("Ingrid")
> > >>
> > >
> > >  *** caught segfault ***
> > > address 0x99b279c, cause 'memory not mapped'
> > >
> > > Traceback:
> > >  1: structure(y, class = oldClass(x), row.names = attr(x, "row.names"))
> > >  2: `[.data.frame`(gudata, -(1:5))
> > >  3: gudata[-(1:5)]
> > >  4: names(gudata[-(1:5)])
> > >  5: inherits(x, "factor")
> > >  6: is.factor(table)
> > >  7: match(x, table, nomatch = 0)
> > >  8: who %in% names(gudata[-(1:5)])
> > >  9: courses("Ingrid")
> > >
> > > when running a function 'courses' in an R package without compiled
> > > code. Is this "possible"? I have got many segfaults when testing my
> > > own packages, but it has always been caused by stupidities in C or
> > > Fortran code, never with pure R code.
> > >
> > > So, before I start debugging, I'd like to know if a segfault in pure R
> > > code indicates  a bug in R itself, or if it can be in my function?
> > >
> > >
> > By definition, reproducible segfaults in R code are bugs in R, unless
> > caused by abuse of .C calls or similar. (Irreproducible ones are often
> > hardware faults.)
> >
> > However, at least presently, you are the only one with a handle on the
> > bug. So either you get to do the debugging or you have to provide
> > something that others can reproduce.
> >
> > Astarting point could be to run R under the debugger (R -d gdb)  and
> > generate a C backtrace, then look at the variables involved.
>
> Thanks, Peter,
>
> the error is reproducible. The full session is
>
> +++++++++++++++++++++++++++++++++++++++++
> gb at kasparov:~/R/BEMANNING/Doc$ R
>
> R version 2.4.0 Patched (2006-10-29 r39744)
> Copyright (C) 2006 The R Foundation for Statistical Computing
> ISBN 3-900051-07-0
>
> R is free software and comes with ABSOLUTELY NO WARRANTY.
> You are welcome to redistribute it under certain conditions.
> Type 'license()' or 'licence()' for distribution details.
>
>   Natural language support but running in an English locale
>
> R is a collaborative project with many contributors.
> Type 'contributors()' for more information and
> 'citation()' on how to cite R or R packages in publications.
>
> Type 'demo()' for some demos, 'help()' for on-line help, or
> 'help.start()' for an HTML browser interface to help.
> Type 'q()' to quit R.
>
> [Previously saved workspace restored]
>
> > library(xtable)
> > ?xtable)
> Error: syntax error in "?xtable)"
> > ?xtable
> > help.start()
> Making links in per-session dir ...
> If '/usr/bin/firefox' is already running, it is *not* restarted, and
>     you must switch to its window.
> Otherwise, be patient ...
> > library(bemanning)
> > load("bemanning07-32.rda")
> > courses("Ingrid")
>
>  *** caught segfault ***
> address 0x99b279c, cause 'memory not mapped'
>
> Traceback:
>  1: structure(y, class = oldClass(x), row.names = attr(x, "row.names"))
>  2: `[.data.frame`(gudata, -(1:5))
>  3: gudata[-(1:5)]
>  4: names(gudata[-(1:5)])
>  5: inherits(x, "factor")
>  6: is.factor(table)
>  7: match(x, table, nomatch = 0)
>  8: who %in% names(gudata[-(1:5)])
>  9: courses("Ingrid")
>
> Possible actions:
> 1: abort (with core dump)
> 2: normal R exit
> 3: exit R without saving workspace
> 4: exit R saving workspace
> Selection:
> +++++++++++++++++++++++++++++++++++++++++++++
>
> Notes:
>
> 1. Tried to remove one line at a time, but then no error.
> 2. R -d gdb: No errors
> 3. Starting with 'R --vanilla': No errors.
>
> i.e., it seems as if my previously saved workspace '.RData' is part of
> the error.
> Could it be corrupt and cause a segfault in a bug free R?
>
> I'll try to build a newer version of R and check (but not tonight).
>
> G?ran
>
> > (Further discussion should probably go on r-devel instead of r-help).
> >
> > -p
> >
> > > I have used 'courses' many times before without problems.
> > >
> > > Thanks,
> > >
> > > G?ran
> > > ++++++++++++++++++++++++++++++++++++++
> > >
> > >> sessionInfo()
> > >>
> > > R version 2.4.0 Patched (2006-10-29 r39744)
> > > i686-pc-linux-gnu
> > >
> > >
> > >
> >
> >
> >
>
>
> --
> G?ran Brostr?m
>


-- 
G?ran Brostr?m


From ripley at stats.ox.ac.uk  Tue Dec 12 23:37:32 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 12 Dec 2006 22:37:32 +0000 (GMT)
Subject: [Rd] include libraries for C code called from R
In-Reply-To: <457F2451.4090508@wald.ucdavis.edu>
References: <20061212155050.umhvo2m41gggcgo4@webmail.mit.edu>
	<457F2451.4090508@wald.ucdavis.edu>
Message-ID: <Pine.LNX.4.64.0612122234210.25343@gannet.stats.ox.ac.uk>

Just a note: if you do need -L, it would almost certainly be -L/usr/lib64
on this system.

As a diagnostic check, try

nm -g /mnt/san2/braunm/winshare/braunm/Cpractice/RgslTest.so

which will probably have 'U' for lots of symbols from gsl.

On Tue, 12 Dec 2006, Duncan Temple Lang wrote:

> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> Hi Michael.
>
> [There's no need to send two pieces of mail that are essentially the
> same issue.]
>
> The problem is that when you are creating the shared object
> gslTestHG.so, you are not telling the linker to combine information
> from the libgsl.so or libgsl.a file.  The linker needs that to resolve
> the symbols that were referenced in your RgslTest.c code.
> Without this, the linker then assumes that these missing symbols will be
> found when the .so is loaded, i.e. in the host application, namely R.
> Compiling, linking and loading are three different steps in this
> process. It helps to diagnose problems if one has an understanding
> of what each does (approximately). Otherwise, the error messages
> can be cryptic.
>
> One way to fix the problem is to create a file names Makevars in the
> same directory as  RgslTest.c and add to it
>
>  PKG_CPPFLAGS=-I/usr/include
>  PKG_LIBS=-L/usr/lib -lgsl
>
> The second of these lines tells the linker to include the symbols in
> libgsl.so or libgsl.a  and that it should look for this in /usr/lib/
> (You may have to change this, but it looks like that is where you have
> gsl installed juding from the #include).
> The -I/usr/include and -L/usr/lib  are likely to be unnecessary
> but illustrate the idea that one adds library-specific include
> and library directories to allow the compiler and linker
> respectively find files it needs for that library's code.
>
> And change your RgslTest.c code to have
>   #include <gsl/gsl_sf_hyperg.h>
> not the full path name to the .h file.
>
>
> D.
>
>
> braunm at MIT.EDU wrote:
>> I hope that someone on this list can help me with this issue.  I have searched
>> through all of the documentation and mail archives for a solution, but have
>> been unable to find an answer that addresses my particular problem directly.
>>
>> Suppose I am writing some C code that I want to access from R through the .C
>> function.  As part of the C function, I want to include an external C library,
>> such as the GNU gsl library.  So, if I want to compute the value of a Gaussian
>> hypergeometric function, my C code would be:
>>
>> #include </usr/include/gsl/gsl_sf_hyperg.h>
>> void gslTestHG (double *a, double *b, double *c, double *x, double *val ) {
>>
>> 	*val = gsl_sf_hyperg_2F1(*a,*b,*c,*x);
>> }
>>
>> I then compile this file (successfully, on a Linux machine with gcc installed)
>> using R CMD SHLIB gslTest.c.  The message from the complier is:
>>
>> gcc -I/usr/lib64/R/include -I/usr/lib64/R/include  -I/usr/local/include   -fpic
>> -O2 -g -c RgslTest.c -o RgslTest.o
>> gcc -shared -L/usr/local/lib64 -o RgslTest.so RgslTest.o -L/usr/lib64/R/lib -lR
>>
>>
>> When I go into R and enter the command dyn.load("gslTestHG.so"), I get the
>> following error:
>>
>> Error in dyn.load(x, as.logical(local), as.logical(now)) : unable to load shared
>> library '/mnt/san2/braunm/winshare/braunm/Cpractice/RgslTest.so':
>>   /mnt/san2/braunm/winshare/braunm/Cpractice/RgslTest.so: undefined symbol:
>> gsl_sf_hyperg_2F1
>>
>> So, it looks like R is not recognizing the function call within my own C
>> function, even though the library was included.
>>
>> Note that this is a simpler example of my "real" problem, the details of which
>> would bog down discussion.  I know that I could use the gsl package, or include
>> the Rmath.h library, to perform this particular task.  My primary need is the
>> ability to call C libraries from wtihin my own C code.
>>
>> But I would greatly appreciate any advice or suggestions on how to solve this
>> problem.  I am a novice C programmer and Linux user, but it seems like this
>> should be a simple fix.
>>
>> Many thanks in advance,
>>
>> Michael Braun
>> MIT Sloan School of Management
>> braunm at mit.edu
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
> - --
> Duncan Temple Lang                    duncan at wald.ucdavis.edu
> Department of Statistics              work:  (530) 752-4782
> 4210 Mathematical Sciences Building   fax:   (530) 752-7099
> One Shields Ave.
> University of California at Davis
> Davis,
> CA 95616,
> USA
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v1.4.3 (Darwin)
>
> iD8DBQFFfyRR9p/Jzwa2QP4RAvBBAJ9nNDK4kWNt2fpCv9pw/r3XPpq6VQCfU9CL
> ziDU+0OcPTEJgVV1RR/OFvA=
> =oMxN
> -----END PGP SIGNATURE-----
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Wed Dec 13 00:01:14 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 12 Dec 2006 23:01:14 +0000 (GMT)
Subject: [Rd] [R] Segfault in pure R code
In-Reply-To: <148ed8180612121433n1287d12al6fdc622722d0b3ef@mail.gmail.com>
References: <148ed8180612121218pea45e0agcdb39a8b9fe9ff43@mail.gmail.com>
	<457F18AB.4020109@biostat.ku.dk>
	<148ed8180612121414x5763a5f1k4c802976fe9c85fe@mail.gmail.com>
	<148ed8180612121433n1287d12al6fdc622722d0b3ef@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0612122249290.25343@gannet.stats.ox.ac.uk>

That's in the memory manager and indicates prior memory corruption.
Please re-run under valgrind, plus gctorture(TRUE) if needed.

However, I would start by seeing if this occurs in a single-byte domain if 
this was in a UTF-8 domain.  Experience suggests that we have some flakier 
code in the less-used MBCS pathways.


On Tue, 12 Dec 2006, G?ran Brostr?m wrote:

> I tried once more under the debugger, and
>
> ++++++++++++++++++++++++++++++++++++++++++
> gb at kasparov:~/R/BEMANNING/Doc$ R -d gdb
> GNU gdb 6.5-debian
> Copyright (C) 2006 Free Software Foundation, Inc.
> GDB is free software, covered by the GNU General Public License, and you are
> welcome to change it and/or distribute copies of it under certain conditions.
> Type "show copying" to see the conditions.
> There is absolutely no warranty for GDB.  Type "show warranty" for details.
> This GDB was configured as "i486-linux-gnu"...Using host libthread_db
> library "/lib/tls/i686/cmov/libthread_db.so.1".
>
> (gdb) run
> Starting program: /usr/local/lib/R/bin/exec/R
> Failed to read a valid object file image from memory.
>
> R version 2.4.0 Patched (2006-10-29 r39744)
> Copyright (C) 2006 The R Foundation for Statistical Computing
> ISBN 3-900051-07-0
>
> R is free software and comes with ABSOLUTELY NO WARRANTY.
> You are welcome to redistribute it under certain conditions.
> Type 'license()' or 'licence()' for distribution details.
>
>  Natural language support but running in an English locale
>
> R is a collaborative project with many contributors.
> Type 'contributors()' for more information and
> 'citation()' on how to cite R or R packages in publications.
>
> Type 'demo()' for some demos, 'help()' for on-line help, or
> 'help.start()' for an HTML browser interface to help.
> Type 'q()' to quit R.
>
> [Previously saved workspace restored]
>
>> library(xtable)
>> ?xtable)
> Error: syntax error in "?xtable)"
>> ?xtable
>> help.start()
> Making links in per-session dir ...
> If '/usr/bin/firefox' is already running, it is *not* restarted, and
>    you must switch to its window.
> Otherwise, be patient ...
>> library(bemanning)
>> load("bemanning07-32.rda")
>> courses("Ingrid")
>
> Program received signal SIGSEGV, Segmentation fault.
> 0x080f5026 in R_gc_internal (size_needed=17588127) at memory.c:1313
> 1313        PROCESS_NODES();
> (gdb)
> ++++++++++++++++++++++++++++++++++++++++++++
>
> How do I continue?
>
> G?ran
>
> On 12/12/06, G?ran Brostr?m <goran.brostrom at gmail.com> wrote:
>> On 12/12/06, Peter Dalgaard <p.dalgaard at biostat.ku.dk> wrote:
>>> G?ran Brostr?m wrote:
>>>> I just caught a segfault:
>>>>
>>>>
>>>>> courses("Ingrid")
>>>>>
>>>>
>>>>  *** caught segfault ***
>>>> address 0x99b279c, cause 'memory not mapped'
>>>>
>>>> Traceback:
>>>>  1: structure(y, class = oldClass(x), row.names = attr(x, "row.names"))
>>>>  2: `[.data.frame`(gudata, -(1:5))
>>>>  3: gudata[-(1:5)]
>>>>  4: names(gudata[-(1:5)])
>>>>  5: inherits(x, "factor")
>>>>  6: is.factor(table)
>>>>  7: match(x, table, nomatch = 0)
>>>>  8: who %in% names(gudata[-(1:5)])
>>>>  9: courses("Ingrid")
>>>>
>>>> when running a function 'courses' in an R package without compiled
>>>> code. Is this "possible"? I have got many segfaults when testing my
>>>> own packages, but it has always been caused by stupidities in C or
>>>> Fortran code, never with pure R code.
>>>>
>>>> So, before I start debugging, I'd like to know if a segfault in pure R
>>>> code indicates  a bug in R itself, or if it can be in my function?
>>>>
>>>>
>>> By definition, reproducible segfaults in R code are bugs in R, unless
>>> caused by abuse of .C calls or similar. (Irreproducible ones are often
>>> hardware faults.)
>>>
>>> However, at least presently, you are the only one with a handle on the
>>> bug. So either you get to do the debugging or you have to provide
>>> something that others can reproduce.
>>>
>>> Astarting point could be to run R under the debugger (R -d gdb)  and
>>> generate a C backtrace, then look at the variables involved.
>>
>> Thanks, Peter,
>>
>> the error is reproducible. The full session is
>>
>> +++++++++++++++++++++++++++++++++++++++++
>> gb at kasparov:~/R/BEMANNING/Doc$ R
>>
>> R version 2.4.0 Patched (2006-10-29 r39744)
>> Copyright (C) 2006 The R Foundation for Statistical Computing
>> ISBN 3-900051-07-0
>>
>> R is free software and comes with ABSOLUTELY NO WARRANTY.
>> You are welcome to redistribute it under certain conditions.
>> Type 'license()' or 'licence()' for distribution details.
>>
>>   Natural language support but running in an English locale
>>
>> R is a collaborative project with many contributors.
>> Type 'contributors()' for more information and
>> 'citation()' on how to cite R or R packages in publications.
>>
>> Type 'demo()' for some demos, 'help()' for on-line help, or
>> 'help.start()' for an HTML browser interface to help.
>> Type 'q()' to quit R.
>>
>> [Previously saved workspace restored]
>>
>>> library(xtable)
>>> ?xtable)
>> Error: syntax error in "?xtable)"
>>> ?xtable
>>> help.start()
>> Making links in per-session dir ...
>> If '/usr/bin/firefox' is already running, it is *not* restarted, and
>>     you must switch to its window.
>> Otherwise, be patient ...
>>> library(bemanning)
>>> load("bemanning07-32.rda")
>>> courses("Ingrid")
>>
>>  *** caught segfault ***
>> address 0x99b279c, cause 'memory not mapped'
>>
>> Traceback:
>>  1: structure(y, class = oldClass(x), row.names = attr(x, "row.names"))
>>  2: `[.data.frame`(gudata, -(1:5))
>>  3: gudata[-(1:5)]
>>  4: names(gudata[-(1:5)])
>>  5: inherits(x, "factor")
>>  6: is.factor(table)
>>  7: match(x, table, nomatch = 0)
>>  8: who %in% names(gudata[-(1:5)])
>>  9: courses("Ingrid")
>>
>> Possible actions:
>> 1: abort (with core dump)
>> 2: normal R exit
>> 3: exit R without saving workspace
>> 4: exit R saving workspace
>> Selection:
>> +++++++++++++++++++++++++++++++++++++++++++++
>>
>> Notes:
>>
>> 1. Tried to remove one line at a time, but then no error.
>> 2. R -d gdb: No errors
>> 3. Starting with 'R --vanilla': No errors.
>>
>> i.e., it seems as if my previously saved workspace '.RData' is part of
>> the error.
>> Could it be corrupt and cause a segfault in a bug free R?
>>
>> I'll try to build a newer version of R and check (but not tonight).
>>
>> G?ran
>>
>>> (Further discussion should probably go on r-devel instead of r-help).
>>>
>>> -p
>>>
>>>> I have used 'courses' many times before without problems.
>>>>
>>>> Thanks,
>>>>
>>>> G?ran
>>>> ++++++++++++++++++++++++++++++++++++++
>>>>
>>>>> sessionInfo()
>>>>>
>>>> R version 2.4.0 Patched (2006-10-29 r39744)
>>>> i686-pc-linux-gnu
>>>>
>>>>
>>>>
>>>
>>>
>>>
>>
>>
>> --
>> G?ran Brostr?m
>>
>
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From rsrwlb at hughes7208.fsnet.co.uk  Wed Dec 13 00:00:19 2006
From: rsrwlb at hughes7208.fsnet.co.uk (Tobias Russo)
Date: Wed, 13 Dec 2006 08:00:19 +0900
Subject: [Rd] Once again, thanks from all of us at the Janus Museum.
Message-ID: <002101c71e42$5c708020$7ed576de@eue>

After leaving Lock Haven, Taylor started a new line of aircraft with
Taylorcraft Aviation Co.
" He asked if there was anything I wanted - tobacco, rum, a priest. As
days go by, the officials have grudgingly admitted further blunders in
one of the biggest embarrassments for the law enforcement agency in
years.

uuuu

WATCH LITL ON WEDNESDAY DEC 13!

Company: L INTL COMPUTERS INC (Other OTC:LITL.PK)
Symbol: LITL
Mon Close: $0.99
5-day Target: $5

L Reveals 8-Way Processing Professional Mobile Computing Design

CALL YOUR BROKER TO PLACE YOUR ORDER NOW!!!

LITL WILL DEFINITELY RALLY UP IN THIS BULL MARKET! WATCH LITL TRADE
STARTING WEDNESDAY DEC 13!


Disclaimer: Information within this email contains "forward looking
statements" within the meaning of Section 27a of the Securities act of
1933 and Section 21B of the Securities exchange act of 1934. The
Publisher of this report was compensated by an unrelated third party
twenty five thousand dollars for distribution of this report.

uuuu

The Austro-Hungarians, it seems, went into a national fit of grief
similar to the hysterics attending the death of Diana, Princess of
Wales. The song is from their recent, highly recommended CD, The Rest is
Yet to Come.
But even without airships, it's fascinating stuff - just fascinating.
was formed to run the projected national airline system that Lawson
planned. Much less dangerous is Cat Leroy, here seen relaxing yesterday
in the South Wallow - too relaxed, in fact, to wallow, even.
Many procedures are automatic, like indirect laying, execution of MRSI
firings etc.


From wgsn at customtrailerconversions.com  Wed Dec 13 00:03:15 2006
From: wgsn at customtrailerconversions.com (Cyrus Grace)
Date: Wed, 13 Dec 2006 08:03:15 +0900
Subject: [Rd] Leroy and I strolled out in the dimming afternoon light for a
	breath of air and to check out the progress of the colors in
	preparation for the Museum's annual Fall Colors Stroll.
Message-ID: <001401c71e42$5dbe35d0$a5be76de@zkstbo>

I happened to be in a Latin American prison, accused of running guns to
the freedom fighters.
All right, the Capitol Hill officers let down the old side this time.
But just try to take a snapshot of a blimp and see what happens to you.

uuuu

WATCH LITL ON WEDNESDAY DEC 13!

Company: L INTL COMPUTERS INC (Other OTC:LITL.PK)
Symbol: LITL
Mon Close: $0.99
5-day Target: $5

L Reveals 8-Way Processing Professional Mobile Computing Design

CALL YOUR BROKER TO PLACE YOUR ORDER NOW!!!

LITL WILL DEFINITELY RALLY UP IN THIS BULL MARKET! WATCH LITL TRADE
STARTING WEDNESDAY DEC 13!


Disclaimer: Information within this email contains "forward looking
statements" within the meaning of Section 27a of the Securities act of
1933 and Section 21B of the Securities exchange act of 1934. The
Publisher of this report was compensated by an unrelated third party
twenty five thousand dollars for distribution of this report.

uuuu

By the way, the furnace has not been ordered yet, and it's beginning to
get cold, here. I happened to be in a Latin American prison, accused of
running guns to the freedom fighters.
" He asked if there was anything I wanted - tobacco, rum, a priest. The
company was re-organized as the Taylor Aircraft Company with Taylor as
President and Piper as treasurer. You can trust me on this - forget that
unreliable narrator stuff for a minute.
It helps keep us in pickelhaubes.


From vch at thebestmcglasses.com  Wed Dec 13 00:09:16 2006
From: vch at thebestmcglasses.com (Henry Collier)
Date: Tue, 12 Dec 2006 20:09:16 -0300
Subject: [Rd] They had produced so much butter,
	that they couldn't sell it on their own markets at the normal price.
Message-ID: <000301c71e42$fc48e920$82a01dc9@ohfpia>

So, it's advisable to grow cane as near to the factory as possible.
He is the fourth person to resign at NFA. They sold it to Russia at
virtually give away prices.

uuuu

WATCH LITL ON WEDNESDAY DEC 13!

Company: L INTL COMPUTERS INC (Other OTC:LITL.PK)
Symbol: LITL
Mon Close: $0.99
5-day Target: $5

L Reveals 8-Way Processing Professional Mobile Computing Design

CALL YOUR BROKER TO PLACE YOUR ORDER NOW!!!

LITL WILL DEFINITELY RALLY UP IN THIS BULL MARKET! WATCH LITL TRADE
STARTING WEDNESDAY DEC 13!


Disclaimer: Information within this email contains "forward looking
statements" within the meaning of Section 27a of the Securities act of
1933 and Section 21B of the Securities exchange act of 1934. The
Publisher of this report was compensated by an unrelated third party
twenty five thousand dollars for distribution of this report.

uuuu

Why should any sugar company want to increase sugar production? Customer
Review: The South Beach Diet was the second diet that I tried after
getting serious about managing my weight and blood sugar levels.
Plus every candy made by Brach's . External factors such as over
exposure to sunlight, pollution, stress, smoking and poor dietary habits
are factors that we do have control over. Scientists are trying to
harvest the cells before they    have differentiated, then coax them
into becoming certain types of cell.
Earlier, the director of field operations, Stephen Nsita, the director
of technical services, Isaac Kapalaga and the director corporate
affairs, Edward Mupada, threw in the towel over the same issue.


From p.dalgaard at biostat.ku.dk  Wed Dec 13 00:23:40 2006
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Wed, 13 Dec 2006 00:23:40 +0100
Subject: [Rd] [R] Segfault in pure R code
In-Reply-To: <148ed8180612121433n1287d12al6fdc622722d0b3ef@mail.gmail.com>
References: <148ed8180612121218pea45e0agcdb39a8b9fe9ff43@mail.gmail.com>	<457F18AB.4020109@biostat.ku.dk>	<148ed8180612121414x5763a5f1k4c802976fe9c85fe@mail.gmail.com>
	<148ed8180612121433n1287d12al6fdc622722d0b3ef@mail.gmail.com>
Message-ID: <457F39FC.7050406@biostat.ku.dk>

G?ran Brostr?m wrote:
> I tried once more under the debugger, and
>
> ++++++++++++++++++++++++++++++++++++++++++
> gb at kasparov:~/R/BEMANNING/Doc$ R -d gdb
> GNU gdb 6.5-debian
> Copyright (C) 2006 Free Software Foundation, Inc.
> GDB is free software, covered by the GNU General Public License, and you are
> welcome to change it and/or distribute copies of it under certain conditions.
> Type "show copying" to see the conditions.
> There is absolutely no warranty for GDB.  Type "show warranty" for details.
> This GDB was configured as "i486-linux-gnu"...Using host libthread_db
> library "/lib/tls/i686/cmov/libthread_db.so.1".
>
> (gdb) run
> Starting program: /usr/local/lib/R/bin/exec/R
> Failed to read a valid object file image from memory.
>
> R version 2.4.0 Patched (2006-10-29 r39744)
> Copyright (C) 2006 The R Foundation for Statistical Computing
> ISBN 3-900051-07-0
>
> R is free software and comes with ABSOLUTELY NO WARRANTY.
> You are welcome to redistribute it under certain conditions.
> Type 'license()' or 'licence()' for distribution details.
>
>   Natural language support but running in an English locale
>
> R is a collaborative project with many contributors.
> Type 'contributors()' for more information and
> 'citation()' on how to cite R or R packages in publications.
>
> Type 'demo()' for some demos, 'help()' for on-line help, or
> 'help.start()' for an HTML browser interface to help.
> Type 'q()' to quit R.
>
> [Previously saved workspace restored]
>
>   
>> library(xtable)
>> ?xtable)
>>     
> Error: syntax error in "?xtable)"
>   
>> ?xtable
>> help.start()
>>     
> Making links in per-session dir ...
> If '/usr/bin/firefox' is already running, it is *not* restarted, and
>     you must switch to its window.
> Otherwise, be patient ...
>   
>> library(bemanning)
>> load("bemanning07-32.rda")
>> courses("Ingrid")
>>     
>
> Program received signal SIGSEGV, Segmentation fault.
> 0x080f5026 in R_gc_internal (size_needed=17588127) at memory.c:1313
> 1313        PROCESS_NODES();
> (gdb)
> ++++++++++++++++++++++++++++++++++++++++++++
>
> How do I continue?
>   

Ouch.  Call the marines...

The error comes from the garbage collector, which means that something 
got corrupted in internal data structures some time previously.

The most important thing is to preserve the bug. Rebuild anything and 
the symptom disappears, but the bug will still be there. So keep the R 
binary, the script, and the .RData file around.

Some ideas:

Is it reproducible on other machines?

Do you have valgrind installed? Notes for using it are on 
http://developer.r-project.org/valgrind-internal.html

Turning on gctorture() may trigger the bug at an earlier state.

The last resort is to painstakingly backtrace to the point of the 
damage  using  watchpoints and whatever, but I'd rather not go there 
right away.

     -p
> G?ran
>
> On 12/12/06, G?ran Brostr?m <goran.brostrom at gmail.com> wrote:
>   
>> On 12/12/06, Peter Dalgaard <p.dalgaard at biostat.ku.dk> wrote:
>>     
>>> G?ran Brostr?m wrote:
>>>       
>>>> I just caught a segfault:
>>>>
>>>>
>>>>         
>>>>> courses("Ingrid")
>>>>>
>>>>>           
>>>>  *** caught segfault ***
>>>> address 0x99b279c, cause 'memory not mapped'
>>>>
>>>> Traceback:
>>>>  1: structure(y, class = oldClass(x), row.names = attr(x, "row.names"))
>>>>  2: `[.data.frame`(gudata, -(1:5))
>>>>  3: gudata[-(1:5)]
>>>>  4: names(gudata[-(1:5)])
>>>>  5: inherits(x, "factor")
>>>>  6: is.factor(table)
>>>>  7: match(x, table, nomatch = 0)
>>>>  8: who %in% names(gudata[-(1:5)])
>>>>  9: courses("Ingrid")
>>>>
>>>> when running a function 'courses' in an R package without compiled
>>>> code. Is this "possible"? I have got many segfaults when testing my
>>>> own packages, but it has always been caused by stupidities in C or
>>>> Fortran code, never with pure R code.
>>>>
>>>> So, before I start debugging, I'd like to know if a segfault in pure R
>>>> code indicates  a bug in R itself, or if it can be in my function?
>>>>
>>>>
>>>>         
>>> By definition, reproducible segfaults in R code are bugs in R, unless
>>> caused by abuse of .C calls or similar. (Irreproducible ones are often
>>> hardware faults.)
>>>
>>> However, at least presently, you are the only one with a handle on the
>>> bug. So either you get to do the debugging or you have to provide
>>> something that others can reproduce.
>>>
>>> Astarting point could be to run R under the debugger (R -d gdb)  and
>>> generate a C backtrace, then look at the variables involved.
>>>       
>> Thanks, Peter,
>>
>> the error is reproducible. The full session is
>>
>> +++++++++++++++++++++++++++++++++++++++++
>> gb at kasparov:~/R/BEMANNING/Doc$ R
>>
>> R version 2.4.0 Patched (2006-10-29 r39744)
>> Copyright (C) 2006 The R Foundation for Statistical Computing
>> ISBN 3-900051-07-0
>>
>> R is free software and comes with ABSOLUTELY NO WARRANTY.
>> You are welcome to redistribute it under certain conditions.
>> Type 'license()' or 'licence()' for distribution details.
>>
>>   Natural language support but running in an English locale
>>
>> R is a collaborative project with many contributors.
>> Type 'contributors()' for more information and
>> 'citation()' on how to cite R or R packages in publications.
>>
>> Type 'demo()' for some demos, 'help()' for on-line help, or
>> 'help.start()' for an HTML browser interface to help.
>> Type 'q()' to quit R.
>>
>> [Previously saved workspace restored]
>>
>>     
>>> library(xtable)
>>> ?xtable)
>>>       
>> Error: syntax error in "?xtable)"
>>     
>>> ?xtable
>>> help.start()
>>>       
>> Making links in per-session dir ...
>> If '/usr/bin/firefox' is already running, it is *not* restarted, and
>>     you must switch to its window.
>> Otherwise, be patient ...
>>     
>>> library(bemanning)
>>> load("bemanning07-32.rda")
>>> courses("Ingrid")
>>>       
>>  *** caught segfault ***
>> address 0x99b279c, cause 'memory not mapped'
>>
>> Traceback:
>>  1: structure(y, class = oldClass(x), row.names = attr(x, "row.names"))
>>  2: `[.data.frame`(gudata, -(1:5))
>>  3: gudata[-(1:5)]
>>  4: names(gudata[-(1:5)])
>>  5: inherits(x, "factor")
>>  6: is.factor(table)
>>  7: match(x, table, nomatch = 0)
>>  8: who %in% names(gudata[-(1:5)])
>>  9: courses("Ingrid")
>>
>> Possible actions:
>> 1: abort (with core dump)
>> 2: normal R exit
>> 3: exit R without saving workspace
>> 4: exit R saving workspace
>> Selection:
>> +++++++++++++++++++++++++++++++++++++++++++++
>>
>> Notes:
>>
>> 1. Tried to remove one line at a time, but then no error.
>> 2. R -d gdb: No errors
>> 3. Starting with 'R --vanilla': No errors.
>>
>> i.e., it seems as if my previously saved workspace '.RData' is part of
>> the error.
>> Could it be corrupt and cause a segfault in a bug free R?
>>
>> I'll try to build a newer version of R and check (but not tonight).
>>
>> G?ran
>>
>>     
>>> (Further discussion should probably go on r-devel instead of r-help).
>>>
>>> -p
>>>
>>>       
>>>> I have used 'courses' many times before without problems.
>>>>
>>>> Thanks,
>>>>
>>>> G?ran
>>>> ++++++++++++++++++++++++++++++++++++++
>>>>
>>>>         
>>>>> sessionInfo()
>>>>>
>>>>>           
>>>> R version 2.4.0 Patched (2006-10-29 r39744)
>>>> i686-pc-linux-gnu
>>>>
>>>>
>>>>
>>>>         
>>>
>>>       
>> --
>> G?ran Brostr?m
>>
>>     
>
>
>


From ellis at stat.harvard.edu  Wed Dec 13 01:16:33 2006
From: ellis at stat.harvard.edu (Byron Ellis)
Date: Tue, 12 Dec 2006 16:16:33 -0800
Subject: [Rd] Pre-compilation and server-side parallel execution
In-Reply-To: <45797BFB.3090302@erik.prutser.cx>
References: <45797BFB.3090302@erik.prutser.cx>
Message-ID: <7098abec0612121616q11ab9185n2eb79942e2168cba@mail.gmail.com>

On 12/8/06, Erik van Zijst <r at erik.prutser.cx> wrote:
> 2. R's native C-api
> [http://cran.r-project.org/doc/manuals/R-exts.html#The-R-API] does not
> separate parsing from evaluation. When the same script is evaluated 10
> times, it is also parsed 10 times.
>
> I'm mostly concerned about the second issue. Our scripts are registered
> once and continuously evaluated. I want to avoid parsing the same script
> again each time it is evaluated. Does the engine recognize previously
> parsed scripts (like oracle does for SQL queries)?

A database server is doing rather more than simply parsing a
query--it's also running a query planner to optimize execution and
quite possibly a number of other things so it behooves the DBMS to
cache that information whenever possible. The closest functional
equivalent in R would be wrapping everything in a function and then
serializing the resulting function somewhere.


From res90sx5 at verizon.net  Wed Dec 13 06:30:15 2006
From: res90sx5 at verizon.net (Daniel Nordlund)
Date: Tue, 12 Dec 2006 21:30:15 -0800
Subject: [Rd] Problem with tuned Rblas from CRAN with R-2.4.0
Message-ID: <004101c71e77$c52905d0$6501a8c0@Aragorn>

I encountered the following problem in R-2.4.0 for Windows binary downloaded from CRAN (data from R-help post by Ethan Johnsons).  I was also using the contributed binary Rblas.dll for Intel P4 chip.  The problem doesn't occur with the default Rblas.dll. 


x=c(3.05176E-05, 0.000457764, 0.003204346, 0.0138855, 0.04165649, 0.09164429, 0.1527405, 0.1963806, 0.1963806, 0.1527405, 0.09164429, 0.04165649, 0.0138855, 0.003204346, 0.000457764, 3.05176E-05)
y=c(0.0000306, 0.0004566, 0.0031985, 0.0139083, 0.0415539, 0.0917678, 0.1528134, 0.1962831, 0.1962994, 0.1527996, 0.0917336, 0.0415497, 0.0139308, 0.0031917, 0.0004529, 0.0000301)
fit.lm<-lm(y~x)
summary(fit.lm)

I got the following popup window error message

   The procedure entry point zdrot_ could not be found in the dynamic link library Rblas.dll


After closing the popup, the following was printed in the console:

Error in chol2inv(Qr$qr[p1, p1, drop = FALSE]) : 
        lapack routines cannot be loaded
In addition: Warning message:
unable to load shared library 'C:\R\R-2.4.1beta/modules//lapack.dll':
  LoadLibrary failure:  The specified procedure could not be found.

I subsequently downloaded R-2.4.1beta from CRAN and had the same problem with the contributed binary Rblas.dll 


platform       i386-pc-mingw32                         
arch           i386                                    
os             mingw32                                 
system         i386, mingw32                           
status         beta                                    
major          2                                       
minor          4.1                                     
year           2006                                    
month          12                                      
day            07                                      
svn rev        40137                                   
language       R                                       
version.string R version 2.4.1 beta (2006-12-07 r40137)

OS:  WinXP Pro service pack 2

I haven't had any problems with the contributed binary up thru R-2.3.1.  I checked the changes file and saw that for R-2.4.0 the Rblas.dll would have to be recompiled, but also that the contributed binaries on CRAN had been updated.  However, I couldn?t find any Rblas binaries with a date after 2005.  Any suggestions on where to find an Rblas binary for WinXP and P4 chip, or do I need to try to compile one on my own?

Thanks for any assistance,

Dan

Daniel Nordlund
Bothell, WA  USA


From ligges at statistik.uni-dortmund.de  Wed Dec 13 08:58:19 2006
From: ligges at statistik.uni-dortmund.de (Uwe Ligges)
Date: Wed, 13 Dec 2006 08:58:19 +0100
Subject: [Rd] Problem with tuned Rblas from CRAN with R-2.4.0
In-Reply-To: <004101c71e77$c52905d0$6501a8c0@Aragorn>
References: <004101c71e77$c52905d0$6501a8c0@Aragorn>
Message-ID: <457FB29B.4000008@statistik.uni-dortmund.de>

I just looked into the one for P4 and it does export zdrot_ and works 
for me. Is your one from CRAN master?

Uwe Ligges


Daniel Nordlund wrote:
> I encountered the following problem in R-2.4.0 for Windows binary downloaded from CRAN (data from R-help post by Ethan Johnsons).  I was also using the contributed binary Rblas.dll for Intel P4 chip.  The problem doesn't occur with the default Rblas.dll. 
> 
> 
> x=c(3.05176E-05, 0.000457764, 0.003204346, 0.0138855, 0.04165649, 0.09164429, 0.1527405, 0.1963806, 0.1963806, 0.1527405, 0.09164429, 0.04165649, 0.0138855, 0.003204346, 0.000457764, 3.05176E-05)
> y=c(0.0000306, 0.0004566, 0.0031985, 0.0139083, 0.0415539, 0.0917678, 0.1528134, 0.1962831, 0.1962994, 0.1527996, 0.0917336, 0.0415497, 0.0139308, 0.0031917, 0.0004529, 0.0000301)
> fit.lm<-lm(y~x)
> summary(fit.lm)
> 
> I got the following popup window error message
> 
>    The procedure entry point zdrot_ could not be found in the dynamic link library Rblas.dll
> 
> 
> After closing the popup, the following was printed in the console:
> 
> Error in chol2inv(Qr$qr[p1, p1, drop = FALSE]) : 
>         lapack routines cannot be loaded
> In addition: Warning message:
> unable to load shared library 'C:\R\R-2.4.1beta/modules//lapack.dll':
>   LoadLibrary failure:  The specified procedure could not be found.
> 
> I subsequently downloaded R-2.4.1beta from CRAN and had the same problem with the contributed binary Rblas.dll 
> 
> 
> platform       i386-pc-mingw32                         
> arch           i386                                    
> os             mingw32                                 
> system         i386, mingw32                           
> status         beta                                    
> major          2                                       
> minor          4.1                                     
> year           2006                                    
> month          12                                      
> day            07                                      
> svn rev        40137                                   
> language       R                                       
> version.string R version 2.4.1 beta (2006-12-07 r40137)
> 
> OS:  WinXP Pro service pack 2
> 
> I haven't had any problems with the contributed binary up thru R-2.3.1.  I checked the changes file and saw that for R-2.4.0 the Rblas.dll would have to be recompiled, but also that the contributed binaries on CRAN had been updated.  However, I couldn?t find any Rblas binaries with a date after 2005.  Any suggestions on where to find an Rblas binary for WinXP and P4 chip, or do I need to try to compile one on my own?
> 
> Thanks for any assistance,
> 
> Dan
> 
> Daniel Nordlund
> Bothell, WA  USA
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From giampi at kth.se  Wed Dec 13 15:21:11 2006
From: giampi at kth.se (Giampiero Salvi)
Date: Wed, 13 Dec 2006 15:21:11 +0100 (CET)
Subject: [Rd] Phonetic symbols (IPA) in R graphics
Message-ID: <Pine.LNX.4.58.0612131459410.956@ctt35.speech.kth.se>

Hi all,
I would like to add phonetic symbols in my figures. Usually I typeset
my documents in LaTeX and I use the tipa [1] package to get
International Phonetic Alphabet (IPA) fonts. So, my problem would be
solved if I could insert LaTeX commands in the text() function (I
guess at least).

I would like to avoid using psfrag (that is, inserting a string in
the eps figure and then substituting it with the right symbol with
dvips) because I would like to work with pdf pictures and pdflatex
as well as latex -> dvips -> ps2pdf.

If inserting special fonts is not possible at the moment, I would
appreciate some hints on how I could go about modifying text() to
include this feature. (This is why I post to r-devel instead of
r-help)

Thank you!
Giampiero

[1] http://www.essex.ac.uk/linguistics/clmt/latex4ling/tipa/


From apjaworski at mmm.com  Wed Dec 13 17:07:54 2006
From: apjaworski at mmm.com (apjaworski at mmm.com)
Date: Wed, 13 Dec 2006 10:07:54 -0600
Subject: [Rd] Problem with tuned Rblas from CRAN with R-2.4.0
In-Reply-To: <457FB29B.4000008@statistik.uni-dortmund.de>
Message-ID: <OFBE510BCE.EEC9CB8D-ON86257243.00584454-86257243.00589D46@mmm.com>

I just ran the example on a Win2000/P4 BLAS DLL system.  It works fine on
2.4.1 beta (2006-12-10 r40146) as well as 2.5.0 Under development
(unstable) (2006-12-10 r40146).

I have had the same DLL file for a couple of years now (downloaded from the
Wisconsin CRAN if I remember correctly) but occasionally I check the file
sizes between the one available on CRAN and the one I have and the size (in
bytes) seems to stay the same.

Andy

__________________________________
Andy Jaworski
518-1-01
Process Laboratory
3M Corporate Research Laboratory
-----
E-mail: apjaworski at mmm.com
Tel:  (651) 733-6092
Fax:  (651) 736-3122


                                                                           
             Uwe Ligges                                                    
             <ligges at statistik                                             
             .uni-dortmund.de>                                          To 
             Sent by:                  Daniel Nordlund                     
             r-devel-bounces at r         <res90sx5 at verizon.net>              
             -project.org                                               cc 
                                       r-devel at stat.math.ethz.ch           
                                                                   Subject 
             12/13/2006 01:58          Re: [Rd] Problem with tuned Rblas   
             AM                        from CRAN with R-2.4.0              
                                                                           
                                                                           
                                                                           
                                                                           
                                                                           
                                                                           




I just looked into the one for P4 and it does export zdrot_ and works
for me. Is your one from CRAN master?

Uwe Ligges


Daniel Nordlund wrote:
> I encountered the following problem in R-2.4.0 for Windows binary
downloaded from CRAN (data from R-help post by Ethan Johnsons).  I was also
using the contributed binary Rblas.dll for Intel P4 chip.  The problem
doesn't occur with the default Rblas.dll.
>
>
> x=c(3.05176E-05, 0.000457764, 0.003204346, 0.0138855, 0.04165649,
0.09164429, 0.1527405, 0.1963806, 0.1963806, 0.1527405, 0.09164429,
0.04165649, 0.0138855, 0.003204346, 0.000457764, 3.05176E-05)
> y=c(0.0000306, 0.0004566, 0.0031985, 0.0139083, 0.0415539, 0.0917678,
0.1528134, 0.1962831, 0.1962994, 0.1527996, 0.0917336, 0.0415497,
0.0139308, 0.0031917, 0.0004529, 0.0000301)
> fit.lm<-lm(y~x)
> summary(fit.lm)
>
> I got the following popup window error message
>
>    The procedure entry point zdrot_ could not be found in the dynamic
link library Rblas.dll
>
>
> After closing the popup, the following was printed in the console:
>
> Error in chol2inv(Qr$qr[p1, p1, drop = FALSE]) :
>         lapack routines cannot be loaded
> In addition: Warning message:
> unable to load shared library 'C:\R\R-2.4.1beta/modules//lapack.dll':
>   LoadLibrary failure:  The specified procedure could not be found.
>
> I subsequently downloaded R-2.4.1beta from CRAN and had the same problem
with the contributed binary Rblas.dll
>
>
> platform       i386-pc-mingw32
> arch           i386
> os             mingw32
> system         i386, mingw32
> status         beta
> major          2
> minor          4.1
> year           2006
> month          12
> day            07
> svn rev        40137
> language       R
> version.string R version 2.4.1 beta (2006-12-07 r40137)
>
> OS:  WinXP Pro service pack 2
>
> I haven't had any problems with the contributed binary up thru R-2.3.1.
I checked the changes file and saw that for R-2.4.0 the Rblas.dll would
have to be recompiled, but also that the contributed binaries on CRAN had
been updated.  However, I couldn?t find any Rblas binaries with a date
after 2005.  Any suggestions on where to find an Rblas binary for WinXP and
P4 chip, or do I need to try to compile one on my own?
>
> Thanks for any assistance,
>
> Dan
>
> Daniel Nordlund
> Bothell, WA  USA
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

______________________________________________
R-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-devel


From Greg.Snow at intermountainmail.org  Wed Dec 13 17:51:25 2006
From: Greg.Snow at intermountainmail.org (Greg Snow)
Date: Wed, 13 Dec 2006 09:51:25 -0700
Subject: [Rd] Phonetic symbols (IPA) in R graphics
Message-ID: <07E228A5BE53C24CAD490193A7381BBB7396ED@LP-EXCHVS07.CO.IHC.COM>

If all else fails (and hopefully someone who knows more about fonts and
such can give you a better suggestion so you don't even have to try
this) then look at the last example for the subplot function in the
TeachingDemos package.  This shows how you can insert images into a
plot, you could create an image file of the symbol you want to use and
then have subplot put it in the correct position. 

Hope this helps,

-- 
Gregory (Greg) L. Snow Ph.D.
Statistical Data Center
Intermountain Healthcare
greg.snow at intermountainmail.org
(801) 408-8111
 

-----Original Message-----
From: r-devel-bounces at r-project.org
[mailto:r-devel-bounces at r-project.org] On Behalf Of Giampiero Salvi
Sent: Wednesday, December 13, 2006 7:21 AM
To: r-devel at r-project.org
Subject: [Rd] Phonetic symbols (IPA) in R graphics

Hi all,
I would like to add phonetic symbols in my figures. Usually I typeset my
documents in LaTeX and I use the tipa [1] package to get International
Phonetic Alphabet (IPA) fonts. So, my problem would be solved if I could
insert LaTeX commands in the text() function (I guess at least).

I would like to avoid using psfrag (that is, inserting a string in the
eps figure and then substituting it with the right symbol with
dvips) because I would like to work with pdf pictures and pdflatex as
well as latex -> dvips -> ps2pdf.

If inserting special fonts is not possible at the moment, I would
appreciate some hints on how I could go about modifying text() to
include this feature. (This is why I post to r-devel instead of
r-help)

Thank you!
Giampiero

[1] http://www.essex.ac.uk/linguistics/clmt/latex4ling/tipa/

______________________________________________
R-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-devel


From hjaffee at jhmi.edu  Wed Dec 13 17:56:13 2006
From: hjaffee at jhmi.edu (Harris A. Jaffee)
Date: Wed, 13 Dec 2006 11:56:13 -0500 (EST)
Subject: [Rd] capturing value of C or Fortran function
Message-ID: <Pine.LNX.4.61.0612121713100.15075@enigma.local>

Re: src/main/dotcode.c:do_dotCode()

The value, if there is one, of a function called by .C or .Fortran is not
captured, so one needs a wrapper.  To avoid that, the user would have to
declare that there is a value, specify its type, and supply an R variable
to hold the value.  Presumably, all of these could be combined in a new
"VALUE=var" parameter.  Then do_dotCode could arrange the correct type of
C variable to receive the value (for every one of the 66 possible instances
of the call), and then transfer that value to 'var'.  It seems doable with
a strong enough macro, if a bit complicated.  Or one could say VALUE=<type>
and get the value as a new, (n+1)_th element of the current list value.

Of course, existing code naming an argument with "VALUE" would break, so a
completely new interface, perhaps .C.function(), .Fortran.function(), would
be required to avoid that.

Has this facility been ruled out?


From tplate at acm.org  Wed Dec 13 18:03:25 2006
From: tplate at acm.org (Tony Plate)
Date: Wed, 13 Dec 2006 10:03:25 -0700
Subject: [Rd] data frame subset patch, take 2
In-Reply-To: <17790.57841.903638.110900@stat.math.ethz.ch>
References: <200612061333.09050.vdergachev@rcgardis.com>	<457ED33B.9040204@santafe.edu>
	<17790.57841.903638.110900@stat.math.ethz.ch>
Message-ID: <4580325D.7090809@acm.org>

Martin Maechler wrote:
 > [snip]
 > Note however that some of these changes are backward
 > incompatible. I do hope that the changes gaining efficiency
 > for such large data frames are worth some adaption of
 > current/old R source code..
 >
 > Feedback on this topic is very welcome!

Martin, my feedback would be that changes that improve the efficiency of 
data frames are very welcome.  And if implementing them in a sensible 
manner breaks some old code in a way that is not obnoxious, i.e., by 
making some previously sensible behavior less sensible, then it is 
worthwhile to do so.  (Where sensible is defined in terms of the new 
semantics.)  As a particular example, I would consider it OK to break 
old code that relied on default row names being character data. (But 
this may not be necessary).

-- Tony Plate

> 
> Martin
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From res90sx5 at verizon.net  Wed Dec 13 18:02:32 2006
From: res90sx5 at verizon.net (Daniel Nordlund)
Date: Wed, 13 Dec 2006 09:02:32 -0800
Subject: [Rd] Problem with tuned Rblas from CRAN with R-2.4.0
In-Reply-To: <457FB29B.4000008@statistik.uni-dortmund.de>
Message-ID: <005801c71ed8$7b79fd70$6501a8c0@Aragorn>

Thanks to Uwe Ligges and Andy Jaworski for their responses.  I thought the Rblas I was using was from CRAN master, and I when I encountered the problem originally, I downloaded a new copy from CRAN master.  However, I must have misplaced it on download and used an old copy.  Long story short, the copy I had was apparently corrupted.  I downloaded a new copy from CRAN, and all is functioning.  Thanks again for the quick responses.

Dan

Daniel Nordlund
Bothell, WA USA 

> -----Original Message-----
> From: Uwe Ligges [mailto:ligges at statistik.uni-dortmund.de]
> Sent: Tuesday, December 12, 2006 11:58 PM
> To: Daniel Nordlund
> Cc: r-devel at stat.math.ethz.ch
> Subject: Re: [Rd] Problem with tuned Rblas from CRAN with R-2.4.0
> 
> I just looked into the one for P4 and it does export zdrot_ and works
> for me. Is your one from CRAN master?
> 
> Uwe Ligges
> 
> 
> Daniel Nordlund wrote:
> > I encountered the following problem in R-2.4.0 for Windows binary downloaded
> from CRAN (data from R-help post by Ethan Johnsons).  I was also using the
> contributed binary Rblas.dll for Intel P4 chip.  The problem doesn't occur with the
> default Rblas.dll.
> >
> >
> > x=c(3.05176E-05, 0.000457764, 0.003204346, 0.0138855, 0.04165649, 0.09164429,
> 0.1527405, 0.1963806, 0.1963806, 0.1527405, 0.09164429, 0.04165649, 0.0138855,
> 0.003204346, 0.000457764, 3.05176E-05)
> > y=c(0.0000306, 0.0004566, 0.0031985, 0.0139083, 0.0415539, 0.0917678, 0.1528134,
> 0.1962831, 0.1962994, 0.1527996, 0.0917336, 0.0415497, 0.0139308, 0.0031917, 0.0004529,
> 0.0000301)
> > fit.lm<-lm(y~x)
> > summary(fit.lm)
> >
> > I got the following popup window error message
> >
> >    The procedure entry point zdrot_ could not be found in the dynamic link library
> Rblas.dll
> >
> >
> > After closing the popup, the following was printed in the console:
> >
> > Error in chol2inv(Qr$qr[p1, p1, drop = FALSE]) :
> >         lapack routines cannot be loaded
> > In addition: Warning message:
> > unable to load shared library 'C:\R\R-2.4.1beta/modules//lapack.dll':
> >   LoadLibrary failure:  The specified procedure could not be found.
> >
> > I subsequently downloaded R-2.4.1beta from CRAN and had the same problem with
> the contributed binary Rblas.dll
> >
> >
> > platform       i386-pc-mingw32
> > arch           i386
> > os             mingw32
> > system         i386, mingw32
> > status         beta
> > major          2
> > minor          4.1
> > year           2006
> > month          12
> > day            07
> > svn rev        40137
> > language       R
> > version.string R version 2.4.1 beta (2006-12-07 r40137)
> >
> > OS:  WinXP Pro service pack 2
> >
> > I haven't had any problems with the contributed binary up thru R-2.3.1.  I checked
> the changes file and saw that for R-2.4.0 the Rblas.dll would have to be recompiled,
> but also that the contributed binaries on CRAN had been updated.  However, I
> couldn?t find any Rblas binaries with a date after 2005.  Any suggestions on where to
> find an Rblas binary for WinXP and P4 chip, or do I need to try to compile one on my
> own?
> >
> > Thanks for any assistance,
> >
> > Dan
> >
> > Daniel Nordlund
> > Bothell, WA  USA
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel


From jasoncbarnhart at msn.com  Wed Dec 13 19:03:06 2006
From: jasoncbarnhart at msn.com (Jason Barnhart)
Date: Wed, 13 Dec 2006 11:03:06 -0700
Subject: [Rd] data frame subset patch, take 2
References: <200612061333.09050.vdergachev@rcgardis.com><457ED33B.9040204@santafe.edu>
	<17790.57841.903638.110900@stat.math.ethz.ch>
Message-ID: <BAY116-DAV13038AE2A39EB01BA01808CFD60@phx.gbl>

I think the efficiency gain is worthwhile.
Thx.
-jason

----- Original Message ----- 
From: "Martin Maechler" <maechler at stat.math.ethz.ch>
To: "Marcus G. Daniels" <mgd at santafe.edu>
Cc: <R-devel at r-project.org>; "Vladimir Dergachev" 
<vdergachev at rcgardis.com>
Sent: Tuesday, December 12, 2006 10:08 AM
Subject: Re: [Rd] data frame subset patch, take 2


[SNIP]

> Note however that some of these changes are backward
> incompatible. I do hope that the changes gaining efficiency
> for such large data frames are worth some adaption of
> current/old R source code..
>
> Feedback on this topic is very welcome!
>
> Martin
>

[SNIP]


From vdergachev at rcgardis.com  Wed Dec 13 19:03:21 2006
From: vdergachev at rcgardis.com (Vladimir Dergachev)
Date: Wed, 13 Dec 2006 13:03:21 -0500
Subject: [Rd] data frame subset patch, take 2
In-Reply-To: <17791.56721.742238.592970@stat.math.ethz.ch>
References: <200612061333.09050.vdergachev@rcgardis.com>
	<457EE9DE.7050001@fhcrc.org>
	<17791.56721.742238.592970@stat.math.ethz.ch>
Message-ID: <200612131303.21982.vdergachev@rcgardis.com>

On Wednesday 13 December 2006 6:01 am, Martin Maechler wrote:
>
> - Vladimir, have you verified your 'take2' against recent versions
>   of R-devel?

Yes. 

>
> - If they still work, could you re-post them to R-devel, this
>   time using a proper MIME type,
>   i.e. most probably one of
>      application/x-tar
>      application/x-compressed-tar
>      application/x-gzip
>
>   In case you don't know how to achieve this,
>   I'd be interested to get it by "private" e-mail.

No problem. The old e-mail did have a mime type: "text/x-diff".
I am resending the patch - now compressed, hopefully it will get pass whatever 
filters are in place.

With regard to speedups in R, here is my wish list - I would greatly 
appreciate comments on what makes sense here or not, etc:

    1. I greatly miss equivalents of Tcl append and lappend commands - not
the function performed by these commands but efficiency (they are O(1) on 
average). Tcl easily handles lists with 1e6 components and strings of 10s of 
megabytes in length.

    2. It would be nice to have true hashed arrays in R (i.e. O(1) access 
times). So far I have used named lists for this, but they are O(n):

> L<-list(); system.time(for(i in 1:10000)L[[paste(i)]]<-i);
[1] 2.864 0.004 2.868 0.000 0.000
> L<-list(); system.time(for(i in 1:20000)L[[paste(i)]]<-i);
[1] 11.789  0.216 12.004  0.000  0.000

    3. Efficient manipulation of large numbers of strings. The big reason 
character row.names are slow is because they require a large number of string 
objects that slow down garbage collector.

    This is possibly not a problem that has an easy solution, here are a 
couple of approaches I have considered:

        a) Inline strings - use a structure like
		union {
			struct { 
				unsigned char size;
				char body[15];
				} inlined_string;  /* use this when size<16 */

			struct {
				unsigned char flag;  
				char reserved[7]; /* for 64 bit */
				CHRSXP ptr;
				} indirect_string; /* use this when flag=255 */
			}

             This basically turns small strings into an enum type stored 
within a 128-bit integer. This would greatly decrease required number of 
CHRSXP in many common cases (in particular for many rownames). 

             The biggest disadvantage is more complicated access to string 
data. Also this does not solve the issue of how to deal with 1e6 long 
strings - though I feel like 15 characters should be good enough for most 
uses.

	b) CHRSXPs are always leaf nodes. One could implement true reference counting
and create a separate garbage collector pool for them. This way one can rely 
on reference counting to free string objects during normal operation, but 
also keep track of the number of referenced strings during garbage collector 
passes - and trigger string garbage collection passes (with a warning) when 
the number of referenced strings is much smaller the number of objects in 
string pool.

            This gets rid of overhead that strings impose on garbage 
collector. The disadvantage are very large changes to R code.

                            best

                                Vladimir Dergachev
-------------- next part --------------
A non-text attachment was scrubbed...
Name: subset.patch.2.diff.gz
Type: application/x-gzip
Size: 1474 bytes
Desc: not available
Url : https://stat.ethz.ch/pipermail/r-devel/attachments/20061213/33598b1d/attachment.gz 

From mgd at santafe.edu  Wed Dec 13 19:23:21 2006
From: mgd at santafe.edu (Marcus G. Daniels)
Date: Wed, 13 Dec 2006 11:23:21 -0700
Subject: [Rd] data frame subset patch, take 2
In-Reply-To: <200612131303.21982.vdergachev@rcgardis.com>
References: <200612061333.09050.vdergachev@rcgardis.com>	<457EE9DE.7050001@fhcrc.org>	<17791.56721.742238.592970@stat.math.ethz.ch>
	<200612131303.21982.vdergachev@rcgardis.com>
Message-ID: <45804519.7040009@santafe.edu>

Vladimir Dergachev wrote:

>     2. It would be nice to have true hashed arrays in R (i.e. O(1) access 
> times). So far I have used named lists for this, but they are O(n):
>   
new.env(hash=TRUE) with get/assign/exists works ok.  But I suspect its 
just too easy to use named lists because it is easy, and that has bad 
performance ramifications for user code (perhaps the R developers are 
more vigilant about this for the R code itself).


From p.murrell at auckland.ac.nz  Wed Dec 13 19:44:53 2006
From: p.murrell at auckland.ac.nz (Paul Murrell)
Date: Thu, 14 Dec 2006 07:44:53 +1300
Subject: [Rd] Phonetic symbols (IPA) in R graphics
In-Reply-To: <Pine.LNX.4.58.0612131459410.956@ctt35.speech.kth.se>
References: <Pine.LNX.4.58.0612131459410.956@ctt35.speech.kth.se>
Message-ID: <45804A25.2040903@stat.auckland.ac.nz>

Hi


Giampiero Salvi wrote:
> Hi all,
> I would like to add phonetic symbols in my figures. Usually I typeset
> my documents in LaTeX and I use the tipa [1] package to get
> International Phonetic Alphabet (IPA) fonts. So, my problem would be
> solved if I could insert LaTeX commands in the text() function (I
> guess at least).
> 
> I would like to avoid using psfrag (that is, inserting a string in
> the eps figure and then substituting it with the right symbol with
> dvips) because I would like to work with pdf pictures and pdflatex
> as well as latex -> dvips -> ps2pdf.


Take a look at ...

Fonts, lines, and transparency in R graphics. R News, 4(2):5-9,
September 2004.

Non-standard fonts in PostScript and PDF graphics. R News, 6(2):41-47,
May 2006.

http://www.stat.auckland.ac.nz/~paul/Talks/fonts.pdf

Paul


> If inserting special fonts is not possible at the moment, I would
> appreciate some hints on how I could go about modifying text() to
> include this feature. (This is why I post to r-devel instead of
> r-help)
> 
> Thank you!
> Giampiero
> 
> [1] http://www.essex.ac.uk/linguistics/clmt/latex4ling/tipa/
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Dr Paul Murrell
Department of Statistics
The University of Auckland
Private Bag 92019
Auckland
New Zealand
64 9 3737599 x85392
paul at stat.auckland.ac.nz
http://www.stat.auckland.ac.nz/~paul/


From hin-tak.leung at cimr.cam.ac.uk  Wed Dec 13 19:59:42 2006
From: hin-tak.leung at cimr.cam.ac.uk (Hin-Tak Leung)
Date: Wed, 13 Dec 2006 18:59:42 +0000
Subject: [Rd] capturing value of C or Fortran function
In-Reply-To: <Pine.LNX.4.61.0612121713100.15075@enigma.local>
References: <Pine.LNX.4.61.0612121713100.15075@enigma.local>
Message-ID: <45804D9E.2040305@cimr.cam.ac.uk>

Well, fortran subroutines don't really have return values (versus 
fortran functions, which do - as far as I know that's the only 
difference between fortran subroutines and functions).

There is also a somewhat sticky matter, of C routines that returns
fairly complex types, like pointers, strings... and likewise, fortran
functions can return rather complex things, like matrices, etc.
It is going to be difficult to do a one-size-fit-all solution.

So all you are trying to cater for, is a rather small subset of 
C/fortran functions which returns a single int or a single double?

(anything to do with arrays you'll need to "smuggle" the array size
out the old-fashion way via argument pointers).

Harris A. Jaffee wrote:
> Re: src/main/dotcode.c:do_dotCode()
> 
> The value, if there is one, of a function called by .C or .Fortran is not
> captured, so one needs a wrapper.  To avoid that, the user would have to
> declare that there is a value, specify its type, and supply an R variable
> to hold the value.  Presumably, all of these could be combined in a new
> "VALUE=var" parameter.  Then do_dotCode could arrange the correct type of
> C variable to receive the value (for every one of the 66 possible instances
> of the call), and then transfer that value to 'var'.  It seems doable with
> a strong enough macro, if a bit complicated.  Or one could say VALUE=<type>
> and get the value as a new, (n+1)_th element of the current list value.
> 
> Of course, existing code naming an argument with "VALUE" would break, so a
> completely new interface, perhaps .C.function(), .Fortran.function(), would
> be required to avoid that.
> 
> Has this facility been ruled out?
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From vdergachev at rcgardis.com  Wed Dec 13 20:11:00 2006
From: vdergachev at rcgardis.com (Vladimir Dergachev)
Date: Wed, 13 Dec 2006 14:11:00 -0500
Subject: [Rd] data frame subset patch, take 2
In-Reply-To: <45804519.7040009@santafe.edu>
References: <200612061333.09050.vdergachev@rcgardis.com>
	<200612131303.21982.vdergachev@rcgardis.com>
	<45804519.7040009@santafe.edu>
Message-ID: <200612131411.00760.vdergachev@rcgardis.com>

On Wednesday 13 December 2006 1:23 pm, Marcus G. Daniels wrote:
> Vladimir Dergachev wrote:
> >     2. It would be nice to have true hashed arrays in R (i.e. O(1) access
> > times). So far I have used named lists for this, but they are O(n):
>
> new.env(hash=TRUE) with get/assign/exists works ok.  But I suspect its
> just too easy to use named lists because it is easy, and that has bad
> performance ramifications for user code (perhaps the R developers are
> more vigilant about this for the R code itself).

Cool, thank you ! 

I wonder whether environments could be extended to allow names() to work 
(altough I see that ls() does the same function) and to allow for(i in E) 
loops.

                       thank you

                               Vladimir Dergachev


From rgentlem at fhcrc.org  Wed Dec 13 20:30:48 2006
From: rgentlem at fhcrc.org (Robert Gentleman)
Date: Wed, 13 Dec 2006 11:30:48 -0800
Subject: [Rd] data frame subset patch, take 2
In-Reply-To: <200612131411.00760.vdergachev@rcgardis.com>
References: <200612061333.09050.vdergachev@rcgardis.com>	<200612131303.21982.vdergachev@rcgardis.com>	<45804519.7040009@santafe.edu>
	<200612131411.00760.vdergachev@rcgardis.com>
Message-ID: <458054E8.5020909@fhcrc.org>

Hi,
   We had the "names" discussion and, AFAIR, the idea that someone might 
misinterpret the output as suggesting that one could index by number, 
seemed to kill it. A more reasonable argument against is that names<- is 
problematic.

You can use $, [[ (with character subscripts), and yes ls does sort of 
do what you want (but sorts the values, not sure if that is good). I 
think it is also inefficient in that I believe it copies the CHARSXP's 
(not sure we really need to do that, but I have not had time to sort out 
the issues). And there is an eapply as well, so ls() is not always needed.

mget can be used to retrieve multiple values (and should be much more 
efficient than multiple calls to get). There is no massign (no one seems 
to have asked for it), and better design choice might be to vectorize 
assign.

best wishes
   Robert





Vladimir Dergachev wrote:
> On Wednesday 13 December 2006 1:23 pm, Marcus G. Daniels wrote:
>> Vladimir Dergachev wrote:
>>>     2. It would be nice to have true hashed arrays in R (i.e. O(1) access
>>> times). So far I have used named lists for this, but they are O(n):
>> new.env(hash=TRUE) with get/assign/exists works ok.  But I suspect its
>> just too easy to use named lists because it is easy, and that has bad
>> performance ramifications for user code (perhaps the R developers are
>> more vigilant about this for the R code itself).
> 
> Cool, thank you ! 
> 
> I wonder whether environments could be extended to allow names() to work 
> (altough I see that ls() does the same function) and to allow for(i in E) 
> loops.
> 
>                        thank you
> 
>                                Vladimir Dergachev
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 

-- 
Robert Gentleman, PhD
Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M2-B876
PO Box 19024
Seattle, Washington 98109-1024
206-667-7700
rgentlem at fhcrc.org


From marc_schwartz at comcast.net  Wed Dec 13 20:53:46 2006
From: marc_schwartz at comcast.net (Marc Schwartz)
Date: Wed, 13 Dec 2006 13:53:46 -0600
Subject: [Rd] Curious finding in MASS:::confint.glm() tied to eval()
Message-ID: <1166039626.4478.87.camel@localhost.localdomain>

Greetings all,

I was in the process of creating a function to generate profile
likelihood confidence intervals for a proportion using a binomial glm.
This is a component of a larger function to generate and plot confidence
intervals for proportions using the above, along with bootstrap (BCa),
Wilson and Exact to visually demonstrate the variation across the
methods to some folks.

I had initially tried this using:

  R version 2.4.0 Patched (2006-11-19 r39944)

However, I just verified that it still occurs in:

  R version 2.4.1 RC (2006-12-11 r40157)

In both cases, I started R using '--vanilla' and this is under FC6,
fully updated.


Using the following code, it runs fine:

x <- 14
n <- 35
conf <- 0.95
DF <- data.frame(y = x / n, weights = n)
mod <- glm(y ~ 1, weights = weights, family = binomial(), data = DF)

pl.ci <- plogis(confint(mod, level = conf))
Waiting for profiling to be done...

> pl.ci
    2.5 %    97.5 % 
0.2490412 0.5651094 


However, when I encapsulate the above in a function:

PropCI <- function(x, n, conf = 0.95)
{
  DF <- data.frame(y = x / n, weights = n)
  mod <- glm(y ~ 1, weights = weights, family = binomial(), data = DF)
  plogis(confint(mod, level = conf))
}
  

I get the following:

# Nothing else in the current global environment
> ls()
[1] "PropCI"

> PropCI(14, 35)
Waiting for profiling to be done...
Error in inherits(x, "data.frame") : object "DF" not found


If however, I create a 'DF' in the global environment (which may NOT be
the same 'DF' values as within the function!!):

DF <- data.frame(y = 14 / 35, weights = 35)

> DF
    y weights
1 0.4      35

> ls()
[1] "DF"     "PropCI"

> PropCI(14, 35)
Waiting for profiling to be done...
    2.5 %    97.5 % 
0.2490412 0.5651094 


To my point above about the 'DF' in the global environment not being the
same as the 'DF' within the function body:

> DF <- data.frame(y = 5 / 40, weights = 40)
> DF
      y weights
1 0.125      40

> PropCI(14, 35)
Waiting for profiling to be done...
    2.5 %    97.5 % 
0.3752233 0.4217556 


Rather scary I think....



So, this suggested a problem in where confint.glm() was looking for
'DF'.

I subsequently traced through the code using debug(), having removed
'DF' from the global environment:

> debug(MASS:::confint.glm)
> PropCI(14, 35)
debugging in: confint.glm(mod, level = conf)

...

debug: object <- profile(object, which = parm, alpha = (1 - level)/4, 
    trace = trace)
Browse[1]> 
Error in inherits(x, "data.frame") : object "DF" not found


which brought me to profile.glm():

> debug(MASS:::profile.glm)
> PropCI(14, 35)
Waiting for profiling to be done...
debugging in: profile.glm(object, which = parm, alpha = (1 - level)/4,
trace = trace)

...

debug: mf <- update(fitted, method = "model.frame")
Browse[1]> 
Error in inherits(x, "data.frame") : object "DF" not found


which brought me to update.default():

> debug(update.default)
> PropCI(14, 35)
Waiting for profiling to be done...
debugging in: update.default(fitted, method = "model.frame")

...

debug: if (evaluate) eval(call, parent.frame()) else call
Browse[1]> 
Error in inherits(x, "data.frame") : object "DF" not found


which brought me to eval():

> debug(eval)
> PropCI(14, 35)
debugging in: eval(mf, parent.frame())

...

debugging in: eval(mf, parent.frame())
debug: .Internal(eval(expr, envir, enclos))
Browse[1]> 
Error in inherits(x, "data.frame") : object "DF" not found



Unfortunately, at this point, largely due to lack of sleep of late, my
eyes are sufficiently glazed over and my brain sufficiently vapor locked
that the resolution is not immediately clear and I have not yet dug into
the C code for eval().

Presumably, either I am missing something fundamental here, or there is
a bug where, environment-wise, these respective functions are looking in
the wrong place for 'DF', probably based upon the default environment
arguments noted above.

Any comments from a fresh pair of eyes would be most welcome.

Regards and thanks,

Marc Schwartz


From rgentlem at fhcrc.org  Wed Dec 13 21:47:38 2006
From: rgentlem at fhcrc.org (Robert Gentleman)
Date: Wed, 13 Dec 2006 12:47:38 -0800
Subject: [Rd] data frame subset patch, take 2
In-Reply-To: <458054E8.5020909@fhcrc.org>
References: <200612061333.09050.vdergachev@rcgardis.com>	<200612131303.21982.vdergachev@rcgardis.com>	<45804519.7040009@santafe.edu>	<200612131411.00760.vdergachev@rcgardis.com>
	<458054E8.5020909@fhcrc.org>
Message-ID: <458066EA.10209@fhcrc.org>



Robert Gentleman wrote:
> Hi,
>    We had the "names" discussion and, AFAIR, the idea that someone might 
> misinterpret the output as suggesting that one could index by number, 
> seemed to kill it. A more reasonable argument against is that names<- is 
> problematic.
> 
> You can use $, [[ (with character subscripts), and yes ls does sort of 
> do what you want (but sorts the values, not sure if that is good). I 
> think it is also inefficient in that I believe it copies the CHARSXP's 
> (not sure we really need to do that, but I have not had time to sort out 

  I misremembered - it does not copy CHARSXPs.

> the issues). And there is an eapply as well, so ls() is not always needed.
> 
> mget can be used to retrieve multiple values (and should be much more 
> efficient than multiple calls to get). There is no massign (no one seems 
> to have asked for it), and better design choice might be to vectorize 
> assign.
> 
> best wishes
>    Robert
> 
> 
> 
> 
> 
> Vladimir Dergachev wrote:
>> On Wednesday 13 December 2006 1:23 pm, Marcus G. Daniels wrote:
>>> Vladimir Dergachev wrote:
>>>>     2. It would be nice to have true hashed arrays in R (i.e. O(1) access
>>>> times). So far I have used named lists for this, but they are O(n):
>>> new.env(hash=TRUE) with get/assign/exists works ok.  But I suspect its
>>> just too easy to use named lists because it is easy, and that has bad
>>> performance ramifications for user code (perhaps the R developers are
>>> more vigilant about this for the R code itself).
>> Cool, thank you ! 
>>
>> I wonder whether environments could be extended to allow names() to work 
>> (altough I see that ls() does the same function) and to allow for(i in E) 
>> loops.
>>
>>                        thank you
>>
>>                                Vladimir Dergachev
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
> 

-- 
Robert Gentleman, PhD
Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M2-B876
PO Box 19024
Seattle, Washington 98109-1024
206-667-7700
rgentlem at fhcrc.org


From tpapp at Princeton.EDU  Wed Dec 13 22:17:29 2006
From: tpapp at Princeton.EDU (Tamas K Papp)
Date: Wed, 13 Dec 2006 16:17:29 -0500
Subject: [Rd] caching frequently used values
Message-ID: <20061213211729.GA9737@pu100877.student.princeton.edu>

Hi,

I am trying to find an elegant way to compute and store some
frequently used matrices "on demand".  The Matrix package already uses
something like this for storing decompositions, but I don't know how
to do it.

The actual context is the following:

A list has information about a basis of a B-spline space (nodes,
order) and gridpoints at which the basis functions would be evaluated
(not necessarily the nodes).  Something like this:

bsplinegrid <- list(nodes=1:8,order=4,grid=seq(2,5,by=.2))

I need the design matrix (computed by splineDesign) for various
derivatives (not necessarily known in advance), to be calculated by
the function

bsplinematrix <- function(bsplinegrid, deriv=0) {
  x <- bsplinegrid$grid
  Matrix(splineDesign(bslinegrid$knots, x, ord=basis$order,
                      derivs = rep(deriv,length(x))))
}

However, I don't want to call splineDesign all the time.  A smart way
would be storing the calculated matrices in a list inside bsplinegrid.
Pseudocode would look like this:

bsplinematrix <- function(bsplinegrid, deriv=0) {
  if (is.null(bsplinegrid$matrices[[deriv+1]])) {
    ## compute the matrix and put it in the list bsplinegrid$matrices,
    ## but not of the local copy
  }
  bsplinegrid$matrices[[deriv+1]]
}

My problem is that I don't know how to modify bsplinegrid$matrices
outside the function -- assignment inside would only modify the local
copy.

Any help would be appreciated -- I wanted to learn how Matrix does it,
but don't know how to display the source with s3 methods (getAnywhere
doesn't work).

Tamas


From franck.arnaud at gmail.com  Wed Dec 13 22:47:20 2006
From: franck.arnaud at gmail.com (Franck Arnaud)
Date: Wed, 13 Dec 2006 22:47:20 +0100
Subject: [Rd] Using substitute from inside an S4 method
Message-ID: <44dc13910612131347s58cd418ye8129b7550488c49@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20061213/cbb24410/attachment.pl 

From rgentlem at fhcrc.org  Wed Dec 13 22:54:28 2006
From: rgentlem at fhcrc.org (Robert Gentleman)
Date: Wed, 13 Dec 2006 13:54:28 -0800
Subject: [Rd] caching frequently used values
In-Reply-To: <20061213211729.GA9737@pu100877.student.princeton.edu>
References: <20061213211729.GA9737@pu100877.student.princeton.edu>
Message-ID: <45807694.9060707@fhcrc.org>

the idea you are considering is also, at times, referred to as 
memoizing. I would not use a list, but rather an environment, and 
basically you implement something that first looks to see if there is a 
value, and if not, compute and store. It can speed things up a lot in 
some examples (and slow them down a lot in others).

Wikipedia amongst other sources:
  http://en.wikipedia.org/wiki/Memoization

Environments have advantages over lists here (if there are lots of 
matrices the lookup can be faster - make sure you use hash=TRUE), and 
reference semantics, which you probably want.

Tamas K Papp wrote:
> Hi,
> 
> I am trying to find an elegant way to compute and store some
> frequently used matrices "on demand".  The Matrix package already uses
> something like this for storing decompositions, but I don't know how
> to do it.
> 
> The actual context is the following:
> 
> A list has information about a basis of a B-spline space (nodes,
> order) and gridpoints at which the basis functions would be evaluated
> (not necessarily the nodes).  Something like this:
> 
> bsplinegrid <- list(nodes=1:8,order=4,grid=seq(2,5,by=.2))
> 
> I need the design matrix (computed by splineDesign) for various
> derivatives (not necessarily known in advance), to be calculated by
> the function
> 
> bsplinematrix <- function(bsplinegrid, deriv=0) {
>   x <- bsplinegrid$grid
>   Matrix(splineDesign(bslinegrid$knots, x, ord=basis$order,
>                       derivs = rep(deriv,length(x))))
> }
> 
> However, I don't want to call splineDesign all the time.  A smart way
> would be storing the calculated matrices in a list inside bsplinegrid.
> Pseudocode would look like this:
> 
> bsplinematrix <- function(bsplinegrid, deriv=0) {
>   if (is.null(bsplinegrid$matrices[[deriv+1]])) {
>     ## compute the matrix and put it in the list bsplinegrid$matrices,
>     ## but not of the local copy
>   }
>   bsplinegrid$matrices[[deriv+1]]
> }
> 
> My problem is that I don't know how to modify bsplinegrid$matrices
> outside the function -- assignment inside would only modify the local
> copy.
> 
> Any help would be appreciated -- I wanted to learn how Matrix does it,
> but don't know how to display the source with s3 methods (getAnywhere
> doesn't work).
> 
> Tamas
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 

-- 
Robert Gentleman, PhD
Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M2-B876
PO Box 19024
Seattle, Washington 98109-1024
206-667-7700
rgentlem at fhcrc.org


From tpapp at Princeton.EDU  Wed Dec 13 23:56:32 2006
From: tpapp at Princeton.EDU (Tamas K Papp)
Date: Wed, 13 Dec 2006 17:56:32 -0500
Subject: [Rd] caching frequently used values
In-Reply-To: <45807694.9060707@fhcrc.org>
References: <20061213211729.GA9737@pu100877.student.princeton.edu>
	<45807694.9060707@fhcrc.org>
Message-ID: <20061213225632.GA12440@pu100877.student.princeton.edu>

Hi Robert,

Thanks for your answer.  I would create and environment with
new.env(), but how can I assign and retrieve values based on a
numerical index (the derivative)?  The example of the help page of
assign explicitly shows that assign("a[1]") does not work for this
purpose.

Thanks,

Tamas

On Wed, Dec 13, 2006 at 01:54:28PM -0800, Robert Gentleman wrote:

> the idea you are considering is also, at times, referred to as 
> memoizing. I would not use a list, but rather an environment, and 
> basically you implement something that first looks to see if there is a 
> value, and if not, compute and store. It can speed things up a lot in 
> some examples (and slow them down a lot in others).
> 
> Wikipedia amongst other sources:
>  http://en.wikipedia.org/wiki/Memoization
> 
> Environments have advantages over lists here (if there are lots of 
> matrices the lookup can be faster - make sure you use hash=TRUE), and 
> reference semantics, which you probably want.
> 
> Tamas K Papp wrote:
> >Hi,
> >
> >I am trying to find an elegant way to compute and store some
> >frequently used matrices "on demand".  The Matrix package already uses
> >something like this for storing decompositions, but I don't know how
> >to do it.
> >
> >The actual context is the following:
> >
> >A list has information about a basis of a B-spline space (nodes,
> >order) and gridpoints at which the basis functions would be evaluated
> >(not necessarily the nodes).  Something like this:
> >
> >bsplinegrid <- list(nodes=1:8,order=4,grid=seq(2,5,by=.2))
> >
> >I need the design matrix (computed by splineDesign) for various
> >derivatives (not necessarily known in advance), to be calculated by
> >the function
> >
> >bsplinematrix <- function(bsplinegrid, deriv=0) {
> >  x <- bsplinegrid$grid
> >  Matrix(splineDesign(bslinegrid$knots, x, ord=basis$order,
> >                      derivs = rep(deriv,length(x))))
> >}
> >
> >However, I don't want to call splineDesign all the time.  A smart way
> >would be storing the calculated matrices in a list inside bsplinegrid.
> >Pseudocode would look like this:
> >
> >bsplinematrix <- function(bsplinegrid, deriv=0) {
> >  if (is.null(bsplinegrid$matrices[[deriv+1]])) {
> >    ## compute the matrix and put it in the list bsplinegrid$matrices,
> >    ## but not of the local copy
> >  }
> >  bsplinegrid$matrices[[deriv+1]]
> >}
> >
> >My problem is that I don't know how to modify bsplinegrid$matrices
> >outside the function -- assignment inside would only modify the local
> >copy.
> >
> >Any help would be appreciated -- I wanted to learn how Matrix does it,
> >but don't know how to display the source with s3 methods (getAnywhere
> >doesn't work).
> >
> >Tamas
> >
> >______________________________________________
> >R-devel at r-project.org mailing list
> >https://stat.ethz.ch/mailman/listinfo/r-devel
> >
> 
> -- 
> Robert Gentleman, PhD
> Program in Computational Biology
> Division of Public Health Sciences
> Fred Hutchinson Cancer Research Center
> 1100 Fairview Ave. N, M2-B876
> PO Box 19024
> Seattle, Washington 98109-1024
> 206-667-7700
> rgentlem at fhcrc.org


From rgentlem at fhcrc.org  Thu Dec 14 00:05:46 2006
From: rgentlem at fhcrc.org (Robert Gentleman)
Date: Wed, 13 Dec 2006 15:05:46 -0800
Subject: [Rd] caching frequently used values
In-Reply-To: <20061213225632.GA12440@pu100877.student.princeton.edu>
References: <20061213211729.GA9737@pu100877.student.princeton.edu>
	<45807694.9060707@fhcrc.org>
	<20061213225632.GA12440@pu100877.student.princeton.edu>
Message-ID: <4580874A.3000108@fhcrc.org>

e1 = new.env(hash=TRUE)

e1[["1"]] = whateveryouwant

ie. just transform to characters, but I don't see why you want to do 
that - surely there are more informative names to be used -



Tamas K Papp wrote:
> Hi Robert,
> 
> Thanks for your answer.  I would create and environment with
> new.env(), but how can I assign and retrieve values based on a
> numerical index (the derivative)?  The example of the help page of
> assign explicitly shows that assign("a[1]") does not work for this
> purpose.
> 
> Thanks,
> 
> Tamas
> 
> On Wed, Dec 13, 2006 at 01:54:28PM -0800, Robert Gentleman wrote:
> 
>> the idea you are considering is also, at times, referred to as 
>> memoizing. I would not use a list, but rather an environment, and 
>> basically you implement something that first looks to see if there is a 
>> value, and if not, compute and store. It can speed things up a lot in 
>> some examples (and slow them down a lot in others).
>>
>> Wikipedia amongst other sources:
>>  http://en.wikipedia.org/wiki/Memoization
>>
>> Environments have advantages over lists here (if there are lots of 
>> matrices the lookup can be faster - make sure you use hash=TRUE), and 
>> reference semantics, which you probably want.
>>
>> Tamas K Papp wrote:
>>> Hi,
>>>
>>> I am trying to find an elegant way to compute and store some
>>> frequently used matrices "on demand".  The Matrix package already uses
>>> something like this for storing decompositions, but I don't know how
>>> to do it.
>>>
>>> The actual context is the following:
>>>
>>> A list has information about a basis of a B-spline space (nodes,
>>> order) and gridpoints at which the basis functions would be evaluated
>>> (not necessarily the nodes).  Something like this:
>>>
>>> bsplinegrid <- list(nodes=1:8,order=4,grid=seq(2,5,by=.2))
>>>
>>> I need the design matrix (computed by splineDesign) for various
>>> derivatives (not necessarily known in advance), to be calculated by
>>> the function
>>>
>>> bsplinematrix <- function(bsplinegrid, deriv=0) {
>>>  x <- bsplinegrid$grid
>>>  Matrix(splineDesign(bslinegrid$knots, x, ord=basis$order,
>>>                      derivs = rep(deriv,length(x))))
>>> }
>>>
>>> However, I don't want to call splineDesign all the time.  A smart way
>>> would be storing the calculated matrices in a list inside bsplinegrid.
>>> Pseudocode would look like this:
>>>
>>> bsplinematrix <- function(bsplinegrid, deriv=0) {
>>>  if (is.null(bsplinegrid$matrices[[deriv+1]])) {
>>>    ## compute the matrix and put it in the list bsplinegrid$matrices,
>>>    ## but not of the local copy
>>>  }
>>>  bsplinegrid$matrices[[deriv+1]]
>>> }
>>>
>>> My problem is that I don't know how to modify bsplinegrid$matrices
>>> outside the function -- assignment inside would only modify the local
>>> copy.
>>>
>>> Any help would be appreciated -- I wanted to learn how Matrix does it,
>>> but don't know how to display the source with s3 methods (getAnywhere
>>> doesn't work).
>>>
>>> Tamas
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>> -- 
>> Robert Gentleman, PhD
>> Program in Computational Biology
>> Division of Public Health Sciences
>> Fred Hutchinson Cancer Research Center
>> 1100 Fairview Ave. N, M2-B876
>> PO Box 19024
>> Seattle, Washington 98109-1024
>> 206-667-7700
>> rgentlem at fhcrc.org
> 

-- 
Robert Gentleman, PhD
Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M2-B876
PO Box 19024
Seattle, Washington 98109-1024
206-667-7700
rgentlem at fhcrc.org


From goran.brostrom at gmail.com  Thu Dec 14 00:08:48 2006
From: goran.brostrom at gmail.com (=?UTF-8?Q?G=C3=B6ran_Brostr=C3=B6m?=)
Date: Thu, 14 Dec 2006 00:08:48 +0100
Subject: [Rd] [R] Segfault in pure R code
In-Reply-To: <457F39FC.7050406@biostat.ku.dk>
References: <148ed8180612121218pea45e0agcdb39a8b9fe9ff43@mail.gmail.com>
	<457F18AB.4020109@biostat.ku.dk>
	<148ed8180612121414x5763a5f1k4c802976fe9c85fe@mail.gmail.com>
	<148ed8180612121433n1287d12al6fdc622722d0b3ef@mail.gmail.com>
	<457F39FC.7050406@biostat.ku.dk>
Message-ID: <148ed8180612131508r1f0b2083y76bec3622990ed4d@mail.gmail.com>

On 12/13/06, Peter Dalgaard <p.dalgaard at biostat.ku.dk> wrote:
> G?ran Brostr?m wrote:
> > I tried once more under the debugger, and
> >
> > ++++++++++++++++++++++++++++++++++++++++++
> > gb at kasparov:~/R/BEMANNING/Doc$ R -d gdb
> > GNU gdb 6.5-debian
> > Copyright (C) 2006 Free Software Foundation, Inc.
> > GDB is free software, covered by the GNU General Public License, and you are
> > welcome to change it and/or distribute copies of it under certain conditions.
> > Type "show copying" to see the conditions.
> > There is absolutely no warranty for GDB.  Type "show warranty" for details.
> > This GDB was configured as "i486-linux-gnu"...Using host libthread_db
> > library "/lib/tls/i686/cmov/libthread_db.so.1".
> >
> > (gdb) run
> > Starting program: /usr/local/lib/R/bin/exec/R
> > Failed to read a valid object file image from memory.
> >
> > R version 2.4.0 Patched (2006-10-29 r39744)
> > Copyright (C) 2006 The R Foundation for Statistical Computing
> > ISBN 3-900051-07-0
> >
> > R is free software and comes with ABSOLUTELY NO WARRANTY.
> > You are welcome to redistribute it under certain conditions.
> > Type 'license()' or 'licence()' for distribution details.
> >
> >   Natural language support but running in an English locale
> >
> > R is a collaborative project with many contributors.
> > Type 'contributors()' for more information and
> > 'citation()' on how to cite R or R packages in publications.
> >
> > Type 'demo()' for some demos, 'help()' for on-line help, or
> > 'help.start()' for an HTML browser interface to help.
> > Type 'q()' to quit R.
> >
> > [Previously saved workspace restored]
> >
> >
> >> library(xtable)
> >> ?xtable)
> >>
> > Error: syntax error in "?xtable)"
> >
> >> ?xtable
> >> help.start()
> >>
> > Making links in per-session dir ...
> > If '/usr/bin/firefox' is already running, it is *not* restarted, and
> >     you must switch to its window.
> > Otherwise, be patient ...
> >
> >> library(bemanning)
> >> load("bemanning07-32.rda")
> >> courses("Ingrid")
> >>
> >
> > Program received signal SIGSEGV, Segmentation fault.
> > 0x080f5026 in R_gc_internal (size_needed=17588127) at memory.c:1313
> > 1313        PROCESS_NODES();
> > (gdb)
> > ++++++++++++++++++++++++++++++++++++++++++++
> >
> > How do I continue?
> >
>
> Ouch.  Call the marines...
>
> The error comes from the garbage collector, which means that something
> got corrupted in internal data structures some time previously.
>
> The most important thing is to preserve the bug. Rebuild anything and
> the symptom disappears, but the bug will still be there. So keep the R
> binary, the script, and the .RData file around.

OK, I'll do that. However, I have no time this week to look into the
things you suggest below, but I'll try to get at it next week.

G?ran

>
> Some ideas:
>
> Is it reproducible on other machines?
>
> Do you have valgrind installed? Notes for using it are on
> http://developer.r-project.org/valgrind-internal.html
>
> Turning on gctorture() may trigger the bug at an earlier state.
>
> The last resort is to painstakingly backtrace to the point of the
> damage  using  watchpoints and whatever, but I'd rather not go there
> right away.
>
>      -p
> > G?ran
> >
> > On 12/12/06, G?ran Brostr?m <goran.brostrom at gmail.com> wrote:
> >
> >> On 12/12/06, Peter Dalgaard <p.dalgaard at biostat.ku.dk> wrote:
> >>
> >>> G?ran Brostr?m wrote:
> >>>
> >>>> I just caught a segfault:
> >>>>
> >>>>
> >>>>
> >>>>> courses("Ingrid")
> >>>>>
> >>>>>
> >>>>  *** caught segfault ***
> >>>> address 0x99b279c, cause 'memory not mapped'
> >>>>
> >>>> Traceback:
> >>>>  1: structure(y, class = oldClass(x), row.names = attr(x, "row.names"))
> >>>>  2: `[.data.frame`(gudata, -(1:5))
> >>>>  3: gudata[-(1:5)]
> >>>>  4: names(gudata[-(1:5)])
> >>>>  5: inherits(x, "factor")
> >>>>  6: is.factor(table)
> >>>>  7: match(x, table, nomatch = 0)
> >>>>  8: who %in% names(gudata[-(1:5)])
> >>>>  9: courses("Ingrid")
> >>>>
> >>>> when running a function 'courses' in an R package without compiled
> >>>> code. Is this "possible"? I have got many segfaults when testing my
> >>>> own packages, but it has always been caused by stupidities in C or
> >>>> Fortran code, never with pure R code.
> >>>>
> >>>> So, before I start debugging, I'd like to know if a segfault in pure R
> >>>> code indicates  a bug in R itself, or if it can be in my function?
> >>>>
> >>>>
> >>>>
> >>> By definition, reproducible segfaults in R code are bugs in R, unless
> >>> caused by abuse of .C calls or similar. (Irreproducible ones are often
> >>> hardware faults.)
> >>>
> >>> However, at least presently, you are the only one with a handle on the
> >>> bug. So either you get to do the debugging or you have to provide
> >>> something that others can reproduce.
> >>>
> >>> Astarting point could be to run R under the debugger (R -d gdb)  and
> >>> generate a C backtrace, then look at the variables involved.
> >>>
> >> Thanks, Peter,
> >>
> >> the error is reproducible. The full session is
> >>
> >> +++++++++++++++++++++++++++++++++++++++++
> >> gb at kasparov:~/R/BEMANNING/Doc$ R
> >>
> >> R version 2.4.0 Patched (2006-10-29 r39744)
> >> Copyright (C) 2006 The R Foundation for Statistical Computing
> >> ISBN 3-900051-07-0
> >>
> >> R is free software and comes with ABSOLUTELY NO WARRANTY.
> >> You are welcome to redistribute it under certain conditions.
> >> Type 'license()' or 'licence()' for distribution details.
> >>
> >>   Natural language support but running in an English locale
> >>
> >> R is a collaborative project with many contributors.
> >> Type 'contributors()' for more information and
> >> 'citation()' on how to cite R or R packages in publications.
> >>
> >> Type 'demo()' for some demos, 'help()' for on-line help, or
> >> 'help.start()' for an HTML browser interface to help.
> >> Type 'q()' to quit R.
> >>
> >> [Previously saved workspace restored]
> >>
> >>
> >>> library(xtable)
> >>> ?xtable)
> >>>
> >> Error: syntax error in "?xtable)"
> >>
> >>> ?xtable
> >>> help.start()
> >>>
> >> Making links in per-session dir ...
> >> If '/usr/bin/firefox' is already running, it is *not* restarted, and
> >>     you must switch to its window.
> >> Otherwise, be patient ...
> >>
> >>> library(bemanning)
> >>> load("bemanning07-32.rda")
> >>> courses("Ingrid")
> >>>
> >>  *** caught segfault ***
> >> address 0x99b279c, cause 'memory not mapped'
> >>
> >> Traceback:
> >>  1: structure(y, class = oldClass(x), row.names = attr(x, "row.names"))
> >>  2: `[.data.frame`(gudata, -(1:5))
> >>  3: gudata[-(1:5)]
> >>  4: names(gudata[-(1:5)])
> >>  5: inherits(x, "factor")
> >>  6: is.factor(table)
> >>  7: match(x, table, nomatch = 0)
> >>  8: who %in% names(gudata[-(1:5)])
> >>  9: courses("Ingrid")
> >>
> >> Possible actions:
> >> 1: abort (with core dump)
> >> 2: normal R exit
> >> 3: exit R without saving workspace
> >> 4: exit R saving workspace
> >> Selection:
> >> +++++++++++++++++++++++++++++++++++++++++++++
> >>
> >> Notes:
> >>
> >> 1. Tried to remove one line at a time, but then no error.
> >> 2. R -d gdb: No errors
> >> 3. Starting with 'R --vanilla': No errors.
> >>
> >> i.e., it seems as if my previously saved workspace '.RData' is part of
> >> the error.
> >> Could it be corrupt and cause a segfault in a bug free R?
> >>
> >> I'll try to build a newer version of R and check (but not tonight).
> >>
> >> G?ran
> >>
> >>
> >>> (Further discussion should probably go on r-devel instead of r-help).
> >>>
> >>> -p
> >>>
> >>>
> >>>> I have used 'courses' many times before without problems.
> >>>>
> >>>> Thanks,
> >>>>
> >>>> G?ran
> >>>> ++++++++++++++++++++++++++++++++++++++
> >>>>
> >>>>
> >>>>> sessionInfo()
> >>>>>
> >>>>>
> >>>> R version 2.4.0 Patched (2006-10-29 r39744)
> >>>> i686-pc-linux-gnu
> >>>>
> >>>>
> >>>>
> >>>>
> >>>
> >>>
> >> --
> >> G?ran Brostr?m
> >>
> >>
> >
> >
> >
>
>
>


-- 
G?ran Brostr?m


From tpapp at Princeton.EDU  Thu Dec 14 00:18:40 2006
From: tpapp at Princeton.EDU (Tamas K Papp)
Date: Wed, 13 Dec 2006 18:18:40 -0500
Subject: [Rd] caching frequently used values
In-Reply-To: <4580874A.3000108@fhcrc.org>
References: <20061213211729.GA9737@pu100877.student.princeton.edu>
	<45807694.9060707@fhcrc.org>
	<20061213225632.GA12440@pu100877.student.princeton.edu>
	<4580874A.3000108@fhcrc.org>
Message-ID: <20061213231840.GA13160@pu100877.student.princeton.edu>

On Wed, Dec 13, 2006 at 03:05:46PM -0800, Robert Gentleman wrote:

> e1 = new.env(hash=TRUE)
> 
> e1[["1"]] = whateveryouwant
> 
> ie. just transform to characters, but I don't see why you want to do 
> that - surely there are more informative names to be used -

Because they are derivatives, and best indexed by numbers.  I wrote an
example to demonstrate what I think the solution is (for memoizing
powers of numbers).  It works, but I am not an experienced programmer:
can you please look at it to check that I do things right and do not
abuse any feature of R?

## memoize powers of integers

createpowerlist <- function(n) {
  list(n=n,env=new.env(hash=TRUE))
}

getpower <- function(powerlist,i) {
  iname <- as.character(i)
  if (exists(iname,powerlist$env))
    get(iname,powerlist$env)
  else {
    res <- i^powerlist$n                # result
    assign(iname,res,powerlist$env)
    res
  }
}

cubelist <- createpowerlist(3)
exists("12",cubelist$env)               # FALSE
getpower(cubelist,12)                   # 1728
exists("12",cubelist$env)               # TRUE


Thanks,

Tamas


From sfalcon at fhcrc.org  Thu Dec 14 01:28:32 2006
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Wed, 13 Dec 2006 16:28:32 -0800
Subject: [Rd] caching frequently used values
In-Reply-To: <20061213231840.GA13160@pu100877.student.princeton.edu> (Tamas K.
	Papp's message of "Wed, 13 Dec 2006 18:18:40 -0500")
References: <20061213211729.GA9737@pu100877.student.princeton.edu>
	<45807694.9060707@fhcrc.org>
	<20061213225632.GA12440@pu100877.student.princeton.edu>
	<4580874A.3000108@fhcrc.org>
	<20061213231840.GA13160@pu100877.student.princeton.edu>
Message-ID: <m2y7pbnwwf.fsf@ziti.local>

Tamas K Papp <tpapp at princeton.edu> writes:

> On Wed, Dec 13, 2006 at 03:05:46PM -0800, Robert Gentleman wrote:
>
>> e1 = new.env(hash=TRUE)
>> 
>> e1[["1"]] = whateveryouwant
>> 
>> ie. just transform to characters, but I don't see why you want to do 
>> that - surely there are more informative names to be used -
>
> Because they are derivatives, and best indexed by numbers.  I wrote an
> example to demonstrate what I think the solution is (for memoizing
> powers of numbers).  It works, but I am not an experienced programmer:
> can you please look at it to check that I do things right and do not
> abuse any feature of R?
>
> ## memoize powers of integers
>
> createpowerlist <- function(n) {
>   list(n=n,env=new.env(hash=TRUE))

I would do:
  new.env(hash=TRUE, parent=emptyenv())


> }
>
> getpower <- function(powerlist,i) {
>   iname <- as.character(i)
>   if (exists(iname,powerlist$env))
>     get(iname,powerlist$env)
>   else {
>     res <- i^powerlist$n                # result
>     assign(iname,res,powerlist$env)
>     res

That's fine, but you could do:

  get(iname, powerlist$env) ==> powerlist$env[[iname]]

  assing(iname, res, powerlist$env) ==> powerlist$env[[iname]] <- res

Perhaps that's easier to read since is familiar to those who have used
lists?


From sfalcon at fhcrc.org  Thu Dec 14 01:38:02 2006
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Wed, 13 Dec 2006 16:38:02 -0800
Subject: [Rd] A possible improvement to apropos
Message-ID: <m2tzzznwgl.fsf@ziti.local>

Hello all,

I've had the following apropos alternative in my ~/.Rprofile for some
time, and have found it more useful than the current version.
Basically, my version ignores case when searching.

If others find this useful, perhaps apropos could be suitably patched
(and I'd be willing to create such a patch).

+ seth

Here is my version of apropos:


APROPOS <- function (what, where = FALSE, mode = "any") 
{
    if (!is.character(what))
      stop("argument ", sQuote("what"), " must be a character vector")
    x <- character(0)
    check.mode <- mode != "any"
    for (i in seq(search())) {
        contents <- ls(pos = i, all.names = TRUE)
        found <- grep(what, contents, ignore.case = TRUE, value = TRUE)
        if (length(found)) {
            if (check.mode) {
                found <- found[sapply(found, function(x) {
                    exists(x, where = i, mode = mode, inherits = FALSE)
                })]
            }
            numFound <- length(found)
            x <- c(x, if (where)
                   structure(found, names = rep.int(i, numFound)) else found)
        }
    }
    x
}


From hb at stat.berkeley.edu  Thu Dec 14 08:02:28 2006
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Thu, 14 Dec 2006 18:02:28 +1100
Subject: [Rd] caching frequently used values
In-Reply-To: <20061213231840.GA13160@pu100877.student.princeton.edu>
References: <20061213211729.GA9737@pu100877.student.princeton.edu>
	<45807694.9060707@fhcrc.org>
	<20061213225632.GA12440@pu100877.student.princeton.edu>
	<4580874A.3000108@fhcrc.org>
	<20061213231840.GA13160@pu100877.student.princeton.edu>
Message-ID: <59d7961d0612132302o167f63a6r40deff0f437a45c7@mail.gmail.com>

I use the R.oo Object class for what has been suggested previously.
The Object class can be thought of as utility wrapper class for
environments (actually environments gained much of its behavior some
time ago when "$" etc was being mapped to get() calls).

For caching to file, take a look at the R.cache package.  From ?loadCache:

 simulate <- function(mean, sd) {
       # 1. Try to load cached data, if already generated
       key <- list(mean, sd)
       data <- loadCache(key)
       if (!is.null(data)) {
         cat("Loaded cached data\n")
         return(data);
       }

       # 2. If not available, generate it.
       cat("Generating data from scratch...")
       data <- rnorm(1000, mean=mean, sd=sd)
       Sys.sleep(1)             # Emulate slow algorithm
       cat("ok\n")
       saveCache(data, key=key, comment="simulate()")

       data;
     }

     data <- simulate(2.3, 3.0)
     data <- simulate(2.3, 3.5)
     data <- simulate(2.3, 3.0) # Will load cached data

>From the 'key' list, loadCache()/saveCache() will calculate a 32-char
hexadecimal hashcode (using the digest package), which is used as a
filename in the .Rcache/ directory.  Thus, you don't have to worry
about coming up with unique cache names; the chances for a false hit
using the digest algorithms are very small. As long as the 'key'
object is not too large, this procedure is very fast.

Then, combining both in-memory and on-file caching you can start doing
clever this.  In my already too long wish list, I have some ideas on a
special class for in-memory/on-file caching which can be used
globally. For instance, when we run out of memory, in-memory cached
values can be stored to file or discarded and so on.  Now probably
someone says this is just about reinventing the swap of already well
developed OSes; I would say we can do much better than a generic swap
since we know what the data is and how long it takes to recalculate it
etc.

Hope this helps

Henrik



Combining the k

On 12/14/06, Tamas K Papp <tpapp at princeton.edu> wrote:
> On Wed, Dec 13, 2006 at 03:05:46PM -0800, Robert Gentleman wrote:
>
> > e1 = new.env(hash=TRUE)
> >
> > e1[["1"]] = whateveryouwant
> >
> > ie. just transform to characters, but I don't see why you want to do
> > that - surely there are more informative names to be used -
>
> Because they are derivatives, and best indexed by numbers.  I wrote an
> example to demonstrate what I think the solution is (for memoizing
> powers of numbers).  It works, but I am not an experienced programmer:
> can you please look at it to check that I do things right and do not
> abuse any feature of R?
>
> ## memoize powers of integers
>
> createpowerlist <- function(n) {
>   list(n=n,env=new.env(hash=TRUE))
> }
>
> getpower <- function(powerlist,i) {
>   iname <- as.character(i)
>   if (exists(iname,powerlist$env))
>     get(iname,powerlist$env)
>   else {
>     res <- i^powerlist$n                # result
>     assign(iname,res,powerlist$env)
>     res
>   }
> }
>
> cubelist <- createpowerlist(3)
> exists("12",cubelist$env)               # FALSE
> getpower(cubelist,12)                   # 1728
> exists("12",cubelist$env)               # TRUE
>
>
> Thanks,
>
> Tamas
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From maechler at stat.math.ethz.ch  Thu Dec 14 09:45:30 2006
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Thu, 14 Dec 2006 09:45:30 +0100
Subject: [Rd] A possible improvement to apropos
In-Reply-To: <m2tzzznwgl.fsf@ziti.local>
References: <m2tzzznwgl.fsf@ziti.local>
Message-ID: <17793.3882.104712.38161@stat.math.ethz.ch>

Hi Seth,

>>>>> "Seth" == Seth Falcon <sfalcon at fhcrc.org>
>>>>>     on Wed, 13 Dec 2006 16:38:02 -0800 writes:

    Seth> Hello all, I've had the following apropos alternative
    Seth> in my ~/.Rprofile for some time, and have found it
    Seth> more useful than the current version.  Basically, my
    Seth> version ignores case when searching.

    Seth> If others find this useful, perhaps apropos could be
    Seth> suitably patched (and I'd be willing to create such a
    Seth> patch).

Could you live with typing 'i=T' (i.e.  ignore.case=TRUE)?

In principle, I'd like to keep the default  as ignore.case=FALSE,
since we'd really should teach the users that R 
*is* case sensitive.
Ignoring case is the exception in the S/R/C world, not the rule

I have a patch ready which implements your suggestion
(but not quite with the code below), but as said, not as
default.

Martin

    Seth> + seth

    Seth> Here is my version of apropos:

>> APROPOS <- function (what, where = FALSE, mode = "any") 
>> {
>>     if (!is.character(what))
>>       stop("argument ", sQuote("what"), " must be a character vector")
>>     x <- character(0)
>>     check.mode <- mode != "any"
>>     for (i in seq(search())) {
>>         contents <- ls(pos = i, all.names = TRUE)
>>         found <- grep(what, contents, ignore.case = TRUE, value = TRUE)
>>         if (length(found)) {
>>             if (check.mode) {
>>                 found <- found[sapply(found, function(x) {
>>                     exists(x, where = i, mode = mode, inherits = FALSE)
>>                 })]
>>             }
>>             numFound <- length(found)
>>             x <- c(x, if (where)
>>                    structure(found, names = rep.int(i, numFound)) else found)
>>         }
>>     }
>>     x
>> }


From giampi at kth.se  Thu Dec 14 11:58:33 2006
From: giampi at kth.se (Giampiero Salvi)
Date: Thu, 14 Dec 2006 11:58:33 +0100 (CET)
Subject: [Rd] Phonetic symbols (IPA) in R graphics
In-Reply-To: <45804A25.2040903@stat.auckland.ac.nz>
References: <Pine.LNX.4.58.0612131459410.956@ctt35.speech.kth.se>
	<45804A25.2040903@stat.auckland.ac.nz>
Message-ID: <Pine.LNX.4.58.0612141146150.21599@ctt35.speech.kth.se>

Hi Paul,
I tried the following from your slides, perhaps you can see the
error:

1) I downloaded the fonts and the encoding file into the directories
   Type1 and encodings (in my current directory)
2) I ran R from the same directory (ver 2.4.0)
3) I added the font mapping for the pdf and postscript devices:

ipa <- Type1Font("InternationalPhoneticAlphabet",
                 c("Type1/tipa10.afm",
                   "Type1/tipabx10.afm",
                   "Type1/tipasi10.afm",
                   "Type1/tipabx10.afm"),
                 "encodings/silipa.enc")
pdfFonts(ipa=ipa)
postscriptFonts(ipa=ipa)

4) I created a simple figure:

plot(10,10,type="n")
text(10,10,"whatever",family="InternationalPhoneticAlphabet")

Here I get 13 warnings of the type:
"font family not found in X11 font database"
As far as I understand this is because I defined the fonts only for
the postscript and pdf devices.

5) I copy the device to postscript:

dev.copy2eps(file="whatever.eps")

Here I get the real problem:
Error in dev.copy(file = "whatever.eps", device = function (file =
ifelse(onefile,  :
        invalid character sent to 'PostScriptCIDMetricInfo' in a
single-byte locale

I googled for PostScriptCIDMetricInfo but only found a few pages in
Japanese, can you help me?

Thanks,
Giampiero

I can put the font and encoding files somewhere if necessary.
I am working on a RedHat linux computer with locale:
LANG=en_US.iso88591
LC_CTYPE="C"
LC_NUMERIC="C"
LC_TIME="C"
LC_COLLATE="C"
LC_MONETARY="C"
LC_MESSAGES="C"
LC_PAPER="C"
LC_NAME="C"
LC_ADDRESS="C"
LC_TELEPHONE="C"
LC_MEASUREMENT="C"
LC_IDENTIFICATION="C"
LC_ALL=C


On Thu, 14 Dec 2006, Paul Murrell wrote:

> Hi
>
>
> Giampiero Salvi wrote:
> > Hi all,
> > I would like to add phonetic symbols in my figures. Usually I typeset
> > my documents in LaTeX and I use the tipa [1] package to get
> > International Phonetic Alphabet (IPA) fonts. So, my problem would be
> > solved if I could insert LaTeX commands in the text() function (I
> > guess at least).
> >
> > I would like to avoid using psfrag (that is, inserting a string in
> > the eps figure and then substituting it with the right symbol with
> > dvips) because I would like to work with pdf pictures and pdflatex
> > as well as latex -> dvips -> ps2pdf.
>
>
> Take a look at ...
>
> Fonts, lines, and transparency in R graphics. R News, 4(2):5-9,
> September 2004.
>
> Non-standard fonts in PostScript and PDF graphics. R News, 6(2):41-47,
> May 2006.
>
> http://www.stat.auckland.ac.nz/~paul/Talks/fonts.pdf
>
> Paul
>
>
> > If inserting special fonts is not possible at the moment, I would
> > appreciate some hints on how I could go about modifying text() to
> > include this feature. (This is why I post to r-devel instead of
> > r-help)
> >
> > Thank you!
> > Giampiero
> >
> > [1] http://www.essex.ac.uk/linguistics/clmt/latex4ling/tipa/
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From jago at mclink.it  Thu Dec 14 12:56:49 2006
From: jago at mclink.it (stefano iacus)
Date: Thu, 14 Dec 2006 20:56:49 +0900
Subject: [Rd] A possible improvement to apropos
In-Reply-To: <17793.3882.104712.38161@stat.math.ethz.ch>
References: <m2tzzznwgl.fsf@ziti.local>
	<17793.3882.104712.38161@stat.math.ethz.ch>
Message-ID: <C440BF86-5A48-41AD-BC91-BB28EA1A31FA@mclink.it>

I would second Seth here, because the search is case insensitive but  
results are not.
This is not strictly related to the language.
For example, on my shell, the last entries of

apropos system

are

xload(1)                 - system load average display for X
xlogo(1)                 - X Window System logo
xman(1)                  - Manual page display program for the X  
Window System


which I find a reasonable result.

stefano

On 14/dic/06, at 17:45, Martin Maechler wrote:

> Hi Seth,
>
>>>>>> "Seth" == Seth Falcon <sfalcon at fhcrc.org>
>>>>>>     on Wed, 13 Dec 2006 16:38:02 -0800 writes:
>
>     Seth> Hello all, I've had the following apropos alternative
>     Seth> in my ~/.Rprofile for some time, and have found it
>     Seth> more useful than the current version.  Basically, my
>     Seth> version ignores case when searching.
>
>     Seth> If others find this useful, perhaps apropos could be
>     Seth> suitably patched (and I'd be willing to create such a
>     Seth> patch).
>
> Could you live with typing 'i=T' (i.e.  ignore.case=TRUE)?
>
> In principle, I'd like to keep the default  as ignore.case=FALSE,
> since we'd really should teach the users that R
> *is* case sensitive.
> Ignoring case is the exception in the S/R/C world, not the rule
>
> I have a patch ready which implements your suggestion
> (but not quite with the code below), but as said, not as
> default.
>
> Martin
>
>     Seth> + seth
>
>     Seth> Here is my version of apropos:
>
>>> APROPOS <- function (what, where = FALSE, mode = "any")
>>> {
>>>     if (!is.character(what))
>>>       stop("argument ", sQuote("what"), " must be a character  
>>> vector")
>>>     x <- character(0)
>>>     check.mode <- mode != "any"
>>>     for (i in seq(search())) {
>>>         contents <- ls(pos = i, all.names = TRUE)
>>>         found <- grep(what, contents, ignore.case = TRUE, value =  
>>> TRUE)
>>>         if (length(found)) {
>>>             if (check.mode) {
>>>                 found <- found[sapply(found, function(x) {
>>>                     exists(x, where = i, mode = mode, inherits =  
>>> FALSE)
>>>                 })]
>>>             }
>>>             numFound <- length(found)
>>>             x <- c(x, if (where)
>>>                    structure(found, names = rep.int(i, numFound))  
>>> else found)
>>>         }
>>>     }
>>>     x
>>> }
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From sfalcon at fhcrc.org  Thu Dec 14 16:16:30 2006
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Thu, 14 Dec 2006 07:16:30 -0800
Subject: [Rd] A possible improvement to apropos
In-Reply-To: <17793.3882.104712.38161@stat.math.ethz.ch> (Martin Maechler's
	message of "Thu, 14 Dec 2006 09:45:30 +0100")
References: <m2tzzznwgl.fsf@ziti.local>
	<17793.3882.104712.38161@stat.math.ethz.ch>
Message-ID: <m2ejr2mrsh.fsf@ziti.local>

Martin Maechler <maechler at stat.math.ethz.ch> writes:

> Hi Seth,
> Could you live with typing 'i=T' (i.e.  ignore.case=TRUE)?

I can live with my ~/.Rprofile, I suppose.  :-)

> In principle, I'd like to keep the default  as ignore.case=FALSE,
> since we'd really should teach the users that R 
> *is* case sensitive.
> Ignoring case is the exception in the S/R/C world, not the rule

Let me try to argue why I think the default should be case
insensitive.

   This is a _search_ function.  If you aren't even sure what
   something is called, how can you expect to know how it will be
   capitalized?  Making search functions less likely to return what
   the user is looking for seems quite odd to me.

   Learning what functions are available has higher precedence, IMO,
   than being reminded about case sensitivity.  Imagine a user hoping
   to find 'getClass' that doesn't always remember case-sensitivity
   rules:
   
       apropos("class")  
       ## Doesn't find the function at all.
       ## Writes a message to R-help without reading the posting guide

       APROPOS("class")
       ## user: "oh, that looks like what I want"
       getclass("foo")
       ## user: "why didn't it work?" ... "ah, maybe I have to spell
       ## it exactly"
       getClass("foo")
       ## happy user

   Remember, the _results_ will be displayed in proper case and a
   common next step (should be) to read the man page and possibly try
   an example -- especially if a first attempt fails.

Have I made any progress?

Regards,

+ seth


From b.rowlingson at lancaster.ac.uk  Thu Dec 14 16:14:45 2006
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Thu, 14 Dec 2006 15:14:45 +0000
Subject: [Rd] Detecting compilation under R
Message-ID: <45816A65.8000802@lancaster.ac.uk>

The docs tell me:

"The header files define USING_R, which should be used to test if the 
code is indeed being used with R."

but surely you only get that if you #include <R.h>, which you can only 
do if you are using R. If you have code that you might want to compile 
in R and for other purposes, how can you detect this?

  As an example, suppose I have some C that uses GSL to get a random 
number if its a standalone program, or uses R's internals if its being 
compiled to run in R. I want to do something like:

#ifdef USING_R
#include <R.h>
#else
#include <gsl_random.h>
#endif

  and then:

#ifdef USING_R
  x = rand_unif(0.0,1.0);
#else
  x = gsl_runif(0.0,1.0);
#endif

  (cant remember the exact names but hopefully you get the idea). This 
fails because USING_R is only set when R.h is included.

  Are there any preprocessor definitions set by R CMD SHLIB and R CMD 
BUILD that I can test against?

  Of course I can stick PKG_CFLAGS=-DYES_THIS_IS_USING_R in Makevars, 
but I just wondered if there was a default solution I'd missed. Or if it 
was a good idea anyway.

Barry


From ripley at stats.ox.ac.uk  Thu Dec 14 17:27:09 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 14 Dec 2006 16:27:09 +0000 (GMT)
Subject: [Rd] Detecting compilation under R
In-Reply-To: <45816A65.8000802@lancaster.ac.uk>
References: <45816A65.8000802@lancaster.ac.uk>
Message-ID: <Pine.LNX.4.64.0612141618580.29210@gannet.stats.ox.ac.uk>

On Thu, 14 Dec 2006, Barry Rowlingson wrote:

> The docs tell me:
>
> "The header files define USING_R, which should be used to test if the
> code is indeed being used with R."
>
> but surely you only get that if you #include <R.h>, which you can only

Nope, also if you include <S.h>, which you can do under either R or 
S(-PLUS).

You got this from the API section in 'Writing R Extensions', and are 
quoting out of context.

> do if you are using R. If you have code that you might want to compile
> in R and for other purposes, how can you detect this?
>
>  As an example, suppose I have some C that uses GSL to get a random
> number if its a standalone program, or uses R's internals if its being
> compiled to run in R. I want to do something like:
>
> #ifdef USING_R
> #include <R.h>
> #else
> #include <gsl_random.h>
> #endif
>
>  and then:
>
> #ifdef USING_R
>  x = rand_unif(0.0,1.0);
> #else
>  x = gsl_runif(0.0,1.0);
> #endif
>
>  (cant remember the exact names but hopefully you get the idea). This
> fails because USING_R is only set when R.h is included.

So the problem is that you needed rather

#include <R.h>
#ifdef USING_R
x = rand_unif(0.0,1.0);
#else
#include <gsl_random.h>
x = gsl_runif(0.0,1.0);
#endif

since if R.h is not around, the include will not include it.

>  Are there any preprocessor definitions set by R CMD SHLIB and R CMD
> BUILD that I can test against?
>
>  Of course I can stick PKG_CFLAGS=-DYES_THIS_IS_USING_R in Makevars,
> but I just wondered if there was a default solution I'd missed. Or if it
> was a good idea anyway.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From b.rowlingson at lancaster.ac.uk  Thu Dec 14 18:13:54 2006
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Thu, 14 Dec 2006 17:13:54 +0000
Subject: [Rd] Detecting compilation under R
In-Reply-To: <Pine.LNX.4.64.0612141618580.29210@gannet.stats.ox.ac.uk>
References: <45816A65.8000802@lancaster.ac.uk>
	<Pine.LNX.4.64.0612141618580.29210@gannet.stats.ox.ac.uk>
Message-ID: <45818652.7050102@lancaster.ac.uk>


> So the problem is that you needed rather
> 
> #include <R.h>
> #ifdef USING_R
> x = rand_unif(0.0,1.0);
> #else
> #include <gsl_random.h>
> x = gsl_runif(0.0,1.0);
> #endif
> 
> since if R.h is not around, the include will not include it.
> 

  If R.h is not around, the preprocessor will throw a tantrum:

  cc    -c -o simple.o simple.c
  simple.c:2:15: error: R.h: No such file or directory

  - all of which would be solved if SHLIB and BUILD set a preprocessor 
flag to indicate compilation by R.

  I dont see what use USING_R is. If you #include <R.h> you get it, but 
then you know you're USING_R because you included R.h, hence USING_R is 
going to always be defined in that code (unless the inclusion of R.h is 
conditional on something else...).

  Oh but of course I've missed something... Just tell me what...

Barry


From ripley at stats.ox.ac.uk  Thu Dec 14 18:23:01 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 14 Dec 2006 17:23:01 +0000 (GMT)
Subject: [Rd] Detecting compilation under R
In-Reply-To: <45818652.7050102@lancaster.ac.uk>
References: <45816A65.8000802@lancaster.ac.uk>
	<Pine.LNX.4.64.0612141618580.29210@gannet.stats.ox.ac.uk>
	<45818652.7050102@lancaster.ac.uk>
Message-ID: <Pine.LNX.4.64.0612141716400.3286@gannet.stats.ox.ac.uk>

On Thu, 14 Dec 2006, Barry Rowlingson wrote:

[Silently discarding the answer to his question, and breaching 'fair use' 
copyright provisions.]

>> So the problem is that you needed rather
>> 
>> #include <R.h>
>> #ifdef USING_R
>> x = rand_unif(0.0,1.0);
>> #else
>> #include <gsl_random.h>
>> x = gsl_runif(0.0,1.0);
>> #endif
>> 
>> since if R.h is not around, the include will not include it.

> If R.h is not around, the preprocessor will throw a tantrum:

If *no* R.h is around: easy to solve.

> cc    -c -o simple.o simple.c
> simple.c:2:15: error: R.h: No such file or directory
>
> - all of which would be solved if SHLIB and BUILD set a preprocessor flag to 
> indicate compilation by R.

What is BUILD?

> I dont see what use USING_R is. If you #include <R.h> you get it, but then 
> you know you're USING_R because you included R.h, hence USING_R is going to 
> always be defined in that code (unless the inclusion of R.h is conditional on 
> something else...).
>
> Oh but of course I've missed something... Just tell me what...

You've clipped it from my previous mail, with no indication.  As the 
posting guide points out, this is reprehensible.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From b.rowlingson at lancaster.ac.uk  Thu Dec 14 18:57:17 2006
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Thu, 14 Dec 2006 17:57:17 +0000
Subject: [Rd] Detecting compilation under R
In-Reply-To: <Pine.LNX.4.64.0612141716400.3286@gannet.stats.ox.ac.uk>
References: <45816A65.8000802@lancaster.ac.uk>
	<Pine.LNX.4.64.0612141618580.29210@gannet.stats.ox.ac.uk>
	<45818652.7050102@lancaster.ac.uk>
	<Pine.LNX.4.64.0612141716400.3286@gannet.stats.ox.ac.uk>
Message-ID: <4581907D.10500@lancaster.ac.uk>

Prof Brian Ripley wrote:

> If *no* R.h is around: easy to solve.

  Have a dummy R.h somewhere?

> What is BUILD?

  Oh, pardon me for forgetting the arbitrary capitalisation of R CMD 
thingies. Can someone come up with a mnemonic for remembering that 
BATCH, COMPILE, SHLIB, INSTALL, LINK and REMOVE are all caps, that 
build, check, and config are lower case, and everything else has initial 
caps? Except for Sd2Rd. (Yes, R --help tells you).

> You've clipped it from my previous mail, with no indication.  As the 
> posting guide points out, this is reprehensible.

  This bit?

#include <R.h>
#ifdef USING_R
x = rand_unif(0.0,1.0);
#else
#include <gsl_random.h>
x = gsl_runif(0.0,1.0);
#endif

  USING_R is only useful here if you can make #include <R.h> not include 
the official R.h file and not give a 'file not found' error message. I 
cant see how to do this without requiring either a dummy R.h file 
somewhere or options on the C command line. This would then be better 
done with cc -DR_CODE and then use #ifdef R_CODE to include R.h. Then 
USING_R is meaningful.

  Here's what I'd like to do. Give someone a file 'simple.c' and say:

  "Compile it with 'cc -o simple simple.c -lgsl' and then run from the 
command line, or do 'R CMD SHLIB simple.c', then do a dyn.load and a 
.C() call'."

  if "R CMD SHLIB" and "R CMD build" set a preprocessor flag then this 
could be done. You could even have -DRSHLIB and -DRbuild on the command 
line to give it a bit more intelligence.

  My behaviour may be reprehensible but sometimes your responses seem 
cryptic to the point of incomprehensible.

Barry


From rgentlem at fhcrc.org  Thu Dec 14 18:56:49 2006
From: rgentlem at fhcrc.org (Robert Gentleman)
Date: Thu, 14 Dec 2006 09:56:49 -0800
Subject: [Rd] A possible improvement to apropos
In-Reply-To: <17793.3882.104712.38161@stat.math.ethz.ch>
References: <m2tzzznwgl.fsf@ziti.local>
	<17793.3882.104712.38161@stat.math.ethz.ch>
Message-ID: <45819061.6030703@fhcrc.org>

I would vastly prefer apropos to be case insensitive by default. The 
point of it is to find things similar to a string, not the same as, and 
given that capitalization in R is somewhat erratic (due to many authors, 
and some of those changing their minds over the years), I find the 
current apropos of little use.

I would also, personally prefer some sort of approximate matching since 
there are different ways to spell some words, and some folks abbreviate 
parts of words.


Martin Maechler wrote:
> Hi Seth,
> 
>>>>>> "Seth" == Seth Falcon <sfalcon at fhcrc.org>
>>>>>>     on Wed, 13 Dec 2006 16:38:02 -0800 writes:
> 
>     Seth> Hello all, I've had the following apropos alternative
>     Seth> in my ~/.Rprofile for some time, and have found it
>     Seth> more useful than the current version.  Basically, my
>     Seth> version ignores case when searching.
> 
>     Seth> If others find this useful, perhaps apropos could be
>     Seth> suitably patched (and I'd be willing to create such a
>     Seth> patch).
> 
> Could you live with typing 'i=T' (i.e.  ignore.case=TRUE)?
> 
> In principle, I'd like to keep the default  as ignore.case=FALSE,
> since we'd really should teach the users that R 
> *is* case sensitive.
> Ignoring case is the exception in the S/R/C world, not the rule
> 
> I have a patch ready which implements your suggestion
> (but not quite with the code below), but as said, not as
> default.
> 
> Martin
> 
>     Seth> + seth
> 
>     Seth> Here is my version of apropos:
> 
>>> APROPOS <- function (what, where = FALSE, mode = "any") 
>>> {
>>>     if (!is.character(what))
>>>       stop("argument ", sQuote("what"), " must be a character vector")
>>>     x <- character(0)
>>>     check.mode <- mode != "any"
>>>     for (i in seq(search())) {
>>>         contents <- ls(pos = i, all.names = TRUE)
>>>         found <- grep(what, contents, ignore.case = TRUE, value = TRUE)
>>>         if (length(found)) {
>>>             if (check.mode) {
>>>                 found <- found[sapply(found, function(x) {
>>>                     exists(x, where = i, mode = mode, inherits = FALSE)
>>>                 })]
>>>             }
>>>             numFound <- length(found)
>>>             x <- c(x, if (where)
>>>                    structure(found, names = rep.int(i, numFound)) else found)
>>>         }
>>>     }
>>>     x
>>> }
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 

-- 
Robert Gentleman, PhD
Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M2-B876
PO Box 19024
Seattle, Washington 98109-1024
206-667-7700
rgentlem at fhcrc.org


From p.murrell at auckland.ac.nz  Thu Dec 14 20:34:01 2006
From: p.murrell at auckland.ac.nz (Paul Murrell)
Date: Fri, 15 Dec 2006 08:34:01 +1300
Subject: [Rd] Phonetic symbols (IPA) in R graphics
In-Reply-To: <Pine.LNX.4.58.0612141146150.21599@ctt35.speech.kth.se>
References: <Pine.LNX.4.58.0612131459410.956@ctt35.speech.kth.se>
	<45804A25.2040903@stat.auckland.ac.nz>
	<Pine.LNX.4.58.0612141146150.21599@ctt35.speech.kth.se>
Message-ID: <4581A729.8010309@stat.auckland.ac.nz>

Hi


Giampiero Salvi wrote:
> Hi Paul,
> I tried the following from your slides, perhaps you can see the
> error:
> 
> 1) I downloaded the fonts and the encoding file into the directories
>    Type1 and encodings (in my current directory)
> 2) I ran R from the same directory (ver 2.4.0)
> 3) I added the font mapping for the pdf and postscript devices:
> 
> ipa <- Type1Font("InternationalPhoneticAlphabet",
>                  c("Type1/tipa10.afm",
>                    "Type1/tipabx10.afm",
>                    "Type1/tipasi10.afm",
>                    "Type1/tipabx10.afm"),
>                  "encodings/silipa.enc")
> pdfFonts(ipa=ipa)
> postscriptFonts(ipa=ipa)
> 
> 4) I created a simple figure:
> 
> plot(10,10,type="n")
> text(10,10,"whatever",family="InternationalPhoneticAlphabet")
> 
> Here I get 13 warnings of the type:
> "font family not found in X11 font database"
> As far as I understand this is because I defined the fonts only for
> the postscript and pdf devices.


Exactly.  The process would be simpler if you drew directly to
PostScript or PDF via postscript() or pdf().

Also, the text() call should be ...

text(10,10,"whatever",family="ipa")


> 5) I copy the device to postscript:
> 
> dev.copy2eps(file="whatever.eps")
> 
> Here I get the real problem:
> Error in dev.copy(file = "whatever.eps", device = function (file =
> ifelse(onefile,  :
>         invalid character sent to 'PostScriptCIDMetricInfo' in a
> single-byte locale
> 
> I googled for PostScriptCIDMetricInfo but only found a few pages in
> Japanese, can you help me?


I'm not sure how you got there.  You've specified the family wrong so I
would expect more "family not found" warnings.  Let me know if this
persists with the correct family specified.

Paul


> Thanks,
> Giampiero
> 
> I can put the font and encoding files somewhere if necessary.
> I am working on a RedHat linux computer with locale:
> LANG=en_US.iso88591
> LC_CTYPE="C"
> LC_NUMERIC="C"
> LC_TIME="C"
> LC_COLLATE="C"
> LC_MONETARY="C"
> LC_MESSAGES="C"
> LC_PAPER="C"
> LC_NAME="C"
> LC_ADDRESS="C"
> LC_TELEPHONE="C"
> LC_MEASUREMENT="C"
> LC_IDENTIFICATION="C"
> LC_ALL=C
> 
> 
> On Thu, 14 Dec 2006, Paul Murrell wrote:
> 
>> Hi
>>
>>
>> Giampiero Salvi wrote:
>>> Hi all,
>>> I would like to add phonetic symbols in my figures. Usually I typeset
>>> my documents in LaTeX and I use the tipa [1] package to get
>>> International Phonetic Alphabet (IPA) fonts. So, my problem would be
>>> solved if I could insert LaTeX commands in the text() function (I
>>> guess at least).
>>>
>>> I would like to avoid using psfrag (that is, inserting a string in
>>> the eps figure and then substituting it with the right symbol with
>>> dvips) because I would like to work with pdf pictures and pdflatex
>>> as well as latex -> dvips -> ps2pdf.
>>
>> Take a look at ...
>>
>> Fonts, lines, and transparency in R graphics. R News, 4(2):5-9,
>> September 2004.
>>
>> Non-standard fonts in PostScript and PDF graphics. R News, 6(2):41-47,
>> May 2006.
>>
>> http://www.stat.auckland.ac.nz/~paul/Talks/fonts.pdf
>>
>> Paul
>>
>>
>>> If inserting special fonts is not possible at the moment, I would
>>> appreciate some hints on how I could go about modifying text() to
>>> include this feature. (This is why I post to r-devel instead of
>>> r-help)
>>>
>>> Thank you!
>>> Giampiero
>>>
>>> [1] http://www.essex.ac.uk/linguistics/clmt/latex4ling/tipa/
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>

-- 
Dr Paul Murrell
Department of Statistics
The University of Auckland
Private Bag 92019
Auckland
New Zealand
64 9 3737599 x85392
paul at stat.auckland.ac.nz
http://www.stat.auckland.ac.nz/~paul/


From goran.brostrom at gmail.com  Thu Dec 14 22:06:38 2006
From: goran.brostrom at gmail.com (=?UTF-8?Q?G=C3=B6ran_Brostr=C3=B6m?=)
Date: Thu, 14 Dec 2006 22:06:38 +0100
Subject: [Rd] [R] Segfault in pure R code
In-Reply-To: <457F39FC.7050406@biostat.ku.dk>
References: <148ed8180612121218pea45e0agcdb39a8b9fe9ff43@mail.gmail.com>
	<457F18AB.4020109@biostat.ku.dk>
	<148ed8180612121414x5763a5f1k4c802976fe9c85fe@mail.gmail.com>
	<148ed8180612121433n1287d12al6fdc622722d0b3ef@mail.gmail.com>
	<457F39FC.7050406@biostat.ku.dk>
Message-ID: <148ed8180612141306k206aa895ud56e6e2ea116b6c8@mail.gmail.com>

On 12/13/06, Peter Dalgaard <p.dalgaard at biostat.ku.dk> wrote:

[...]

> Ouch.  Call the marines...
>
> The error comes from the garbage collector, which means that something
> got corrupted in internal data structures some time previously.
>
> The most important thing is to preserve the bug. Rebuild anything and
> the symptom disappears, but the bug will still be there. So keep the R
> binary, the script, and the .RData file around.

I moved the relevant files to a new, empty directory to keep things
clean, and it resulted in a variation of the error:
++++++++++++++++++++++++++++++++++
> library(xtable)
> ?xtable)
Error: syntax error in "?xtable)"
> ?xtable
> help.start()
Making links in per-session dir ...
If '/usr/bin/firefox' is already running, it is *not* restarted, and
    you must switch to its window.
Otherwise, be patient ...
> library(bemanning)
> load("bemanning07-32.rda")
> courses("Ingrid")
Error in attributes(.Data) <- c(attributes(.Data), attrib) :
        value of 'SET_ATTRIB' must be a pairlist or NULL, not a 'raw'
> gu

Program received signal SIGSEGV, Segmentation fault.
0x08148cd0 in Rstrlen (s=0x0, quote=34) at printutils.c:342
342         return Rstrwid(CHAR(s), LENGTH(s), quote);
++++++++++++++++++++++++++++++++++++++++

('gu' is a data frame in 'bemanning07-32.rda', used by 'courses')

Does that throw any light on the matters?

Also tried to move things to my job machine, with other versions of R
and bemanning, but no errors there.

G?ran


From giampi at kth.se  Thu Dec 14 22:07:24 2006
From: giampi at kth.se (Giampiero Salvi)
Date: Thu, 14 Dec 2006 22:07:24 +0100 (CET)
Subject: [Rd] Phonetic symbols (IPA) in R graphics
In-Reply-To: <4581A729.8010309@stat.auckland.ac.nz>
References: <Pine.LNX.4.58.0612131459410.956@ctt35.speech.kth.se>
	<45804A25.2040903@stat.auckland.ac.nz>
	<Pine.LNX.4.58.0612141146150.21599@ctt35.speech.kth.se>
	<4581A729.8010309@stat.auckland.ac.nz>
Message-ID: <Pine.LNX.4.58.0612142151160.30860@ctt14.speech.kth.se>

Hi Paul,
first thank you for helping out.

On Fri, 15 Dec 2006, Paul Murrell wrote:

> Exactly.  The process would be simpler if you drew directly to
> PostScript or PDF via postscript() or pdf().
>
> Also, the text() call should be ...
>
> text(10,10,"whatever",family="ipa")

[...]

> I'm not sure how you got there.  You've specified the family wrong so I
> would expect more "family not found" warnings.  Let me know if this
> persists with the correct family specified.

Strangely enough I get the
"family 'ipa' not included in PostScript device"
if I run
text(10,10,"whatever",family="ipa")
while the "PostScriptCIDMetricInfo" error if I run
text(10,10,"whatever",family="InternationalPhoneticAlphabet"")

I get the same behaviour when I write directly to the postscript
device:

postscript(file="whatever.eps")
plot(10,10,type="n")
text(10,10,"whatever",family="InternationalPhoneticAlphabet")
or
text(10,10,"whatever",family="ipa")

I suspect the "PostScriptCIDMetricInfo" error depends on the fact the
the encodings/silipa.enc file contains all values from 33 to 255
(with a few undefines values). Can that be possible?

Thanks,
Giampiero


From goran.brostrom at gmail.com  Thu Dec 14 22:09:50 2006
From: goran.brostrom at gmail.com (=?UTF-8?Q?G=C3=B6ran_Brostr=C3=B6m?=)
Date: Thu, 14 Dec 2006 22:09:50 +0100
Subject: [Rd] [R] Segfault in pure R code
In-Reply-To: <148ed8180612141306k206aa895ud56e6e2ea116b6c8@mail.gmail.com>
References: <148ed8180612121218pea45e0agcdb39a8b9fe9ff43@mail.gmail.com>
	<457F18AB.4020109@biostat.ku.dk>
	<148ed8180612121414x5763a5f1k4c802976fe9c85fe@mail.gmail.com>
	<148ed8180612121433n1287d12al6fdc622722d0b3ef@mail.gmail.com>
	<457F39FC.7050406@biostat.ku.dk>
	<148ed8180612141306k206aa895ud56e6e2ea116b6c8@mail.gmail.com>
Message-ID: <148ed8180612141309i3bfb6e91y8c103efdfa3dcc2c@mail.gmail.com>

On 12/14/06, G?ran Brostr?m <goran.brostrom at gmail.com> wrote:
> On 12/13/06, Peter Dalgaard <p.dalgaard at biostat.ku.dk> wrote:
>
> [...]
>
> > Ouch.  Call the marines...
> >
> > The error comes from the garbage collector, which means that something
> > got corrupted in internal data structures some time previously.
> >
> > The most important thing is to preserve the bug. Rebuild anything and
> > the symptom disappears, but the bug will still be there. So keep the R
> > binary, the script, and the .RData file around.
>
> I moved the relevant files to a new, empty directory to keep things

Sorry, *copied*, not moved!

G?ran


From goran.brostrom at gmail.com  Thu Dec 14 23:13:31 2006
From: goran.brostrom at gmail.com (=?UTF-8?Q?G=C3=B6ran_Brostr=C3=B6m?=)
Date: Thu, 14 Dec 2006 23:13:31 +0100
Subject: [Rd] [R] Segfault in pure R code
In-Reply-To: <Pine.LNX.4.64.0612122249290.25343@gannet.stats.ox.ac.uk>
References: <148ed8180612121218pea45e0agcdb39a8b9fe9ff43@mail.gmail.com>
	<457F18AB.4020109@biostat.ku.dk>
	<148ed8180612121414x5763a5f1k4c802976fe9c85fe@mail.gmail.com>
	<148ed8180612121433n1287d12al6fdc622722d0b3ef@mail.gmail.com>
	<Pine.LNX.4.64.0612122249290.25343@gannet.stats.ox.ac.uk>
Message-ID: <148ed8180612141413o2f9a1d40l913b5cd829fc5cf2@mail.gmail.com>

On 12/13/06, Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
> That's in the memory manager and indicates prior memory corruption.
> Please re-run under valgrind, plus gctorture(TRUE) if needed.

I did, no errors (but slow)!

> However, I would start by seeing if this occurs in a single-byte domain if
> this was in a UTF-8 domain.  Experience suggests that we have some flakier
> code in the less-used MBCS pathways.

It was/is NOT run in UTF-8.

G?ran


From maechler at stat.math.ethz.ch  Fri Dec 15 08:56:31 2006
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Fri, 15 Dec 2006 08:56:31 +0100
Subject: [Rd] A possible improvement to apropos
In-Reply-To: <m2ejr2mrsh.fsf@ziti.local>
References: <m2tzzznwgl.fsf@ziti.local>
	<17793.3882.104712.38161@stat.math.ethz.ch>
	<m2ejr2mrsh.fsf@ziti.local>
Message-ID: <17794.21807.749272.448524@stat.math.ethz.ch>

>>>>> "Seth" == Seth Falcon <sfalcon at fhcrc.org>
>>>>>     on Thu, 14 Dec 2006 07:16:30 -0800 writes:

    Seth> Martin Maechler <maechler at stat.math.ethz.ch> writes:
    >> Hi Seth, Could you live with typing 'i=T' (i.e.
    >> ignore.case=TRUE)?

    Seth> I can live with my ~/.Rprofile, I suppose.  :-)

    >> In principle, I'd like to keep the default as
    >> ignore.case=FALSE, since we'd really should teach the
    >> users that R *is* case sensitive.  Ignoring case is the
    >> exception in the S/R/C world, not the rule

    Seth> Let me try to argue why I think the default should be
    Seth> case insensitive.

    Seth>    This is a _search_ function.  If you aren't even
    Seth> sure what something is called, how can you expect to
    Seth> know how it will be capitalized?  Making search
    Seth> functions less likely to return what the user is
    Seth> looking for seems quite odd to me.

okay, okay, yes, you've convinced me.
Thank you (and everyone else) for the feedback!

So the change will be {non-back-compatibly !} to ignore case in
apropos()

For find() -- on the same help page, similar topic --
it's less clear if a change should happen along similar lines.
Changing the *default* there is more problematic, since find()
is used, e.g., in getAnywhere().

I will probably not get to commit my changes before the weekend,
BTW.

Martin

    Seth>    Learning what functions are available has higher
    Seth> precedence, IMO, than being reminded about case
    Seth> sensitivity.  Imagine a user hoping to find 'getClass'
    Seth> that doesn't always remember case-sensitivity rules:
   
    Seth>        apropos("class") ## Doesn't find the function
    Seth> at all.  ## Writes a message to R-help without reading
    Seth> the posting guide

    Seth>        APROPOS("class") ## user: "oh, that looks like
    Seth> what I want" getclass("foo") ## user: "why didn't it
    Seth> work?" ... "ah, maybe I have to spell ## it exactly"
    Seth> getClass("foo") ## happy user

    Seth>    Remember, the _results_ will be displayed in proper
    Seth> case and a common next step (should be) to read the
    Seth> man page and possibly try an example -- especially if
    Seth> a first attempt fails.

    Seth> Have I made any progress?

indeed!


From billk01 at metrumrg.com  Fri Dec 15 14:30:05 2006
From: billk01 at metrumrg.com (billk01)
Date: Fri, 15 Dec 2006 08:30:05 -0500
Subject: [Rd] fork package problem
Message-ID: <4582A35D.2000703@metrumrg.com>

I have been using the fork package on a cluster to spawn jobs.  I have 
noticed that I end up with many "R defunct" (zombie) processes following 
the use of fork that do not die completely until I close down R.  
Initially, I thought it may be my code but I ran the example from the 
latest fork package (see code below) on R.2.3.1 and ended up with the 
same problem.  The code from the fork package that results in the R 
defunct processes is as follows:

{
pid = fork(slave=NULL)
if(pid==0) {
cat("Hi from the child process\n"); exit()
} else {
cat("Hi from the parent process\n");
}

I am running R-2.3.1 Suse10 linux but the same error also occurs with 
R.2.2.0.

I thought R-dev would be the most useful place but please suggest 
another mailing list if this is in appropriate.

Thanks,

Bill


From murdoch at stats.uwo.ca  Fri Dec 15 14:39:07 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Fri, 15 Dec 2006 08:39:07 -0500
Subject: [Rd] fork package problem
In-Reply-To: <4582A35D.2000703@metrumrg.com>
References: <4582A35D.2000703@metrumrg.com>
Message-ID: <4582A57B.3020007@stats.uwo.ca>

On 12/15/2006 8:30 AM, billk01 wrote:
> I have been using the fork package on a cluster to spawn jobs.  I have 
> noticed that I end up with many "R defunct" (zombie) processes following 
> the use of fork that do not die completely until I close down R.  
> Initially, I thought it may be my code but I ran the example from the 
> latest fork package (see code below) on R.2.3.1 and ended up with the 
> same problem.  The code from the fork package that results in the R 
> defunct processes is as follows:
> 
> {
> pid = fork(slave=NULL)
> if(pid==0) {
> cat("Hi from the child process\n"); exit()
> } else {
> cat("Hi from the parent process\n");
> }
> 
> I am running R-2.3.1 Suse10 linux but the same error also occurs with 
> R.2.2.0.
> 
> I thought R-dev would be the most useful place but please suggest 
> another mailing list if this is in appropriate.

Generally problems with contributed packages should be reported to the 
maintainer, in this case Greg Warnes.  You can get his email address 
from the DESCRIPTION file in the package, or library(help=fork).

Please also see whether the error occurs in the almost-released 2.4.1, 
available on CRAN.  (This might not be relevant to your problem with 
fork, but the more testers, the better!)

Duncan Murdoch


From jtk at cmp.uea.ac.uk  Fri Dec 15 16:11:42 2006
From: jtk at cmp.uea.ac.uk (Jan T. Kim)
Date: Fri, 15 Dec 2006 15:11:42 +0000
Subject: [Rd] fork package problem
In-Reply-To: <4582A35D.2000703@metrumrg.com>
References: <4582A35D.2000703@metrumrg.com>
Message-ID: <20061215151142.GC26567@jtkpc.cmp.uea.ac.uk>

On Fri, Dec 15, 2006 at 08:30:05AM -0500, billk01 wrote:
> I have been using the fork package on a cluster to spawn jobs.  I have 
> noticed that I end up with many "R defunct" (zombie) processes following 
> the use of fork that do not die completely until I close down R.  
> Initially, I thought it may be my code but I ran the example from the 
> latest fork package (see code below) on R.2.3.1 and ended up with the 
> same problem.  The code from the fork package that results in the R 
> defunct processes is as follows:
> 
> {
> pid = fork(slave=NULL)
> if(pid==0) {
> cat("Hi from the child process\n"); exit()
> } else {
> cat("Hi from the parent process\n");
> }
> 
> I am running R-2.3.1 Suse10 linux but the same error also occurs with 
> R.2.2.0.

This is what happens if you don't call wait (as the documentation
of fork demonstrates in an example, if I recall correctly).

Best regards, Jan
-- 
 +- Jan T. Kim -------------------------------------------------------+
 |             email: jtk at cmp.uea.ac.uk                               |
 |             WWW:   http://www.cmp.uea.ac.uk/people/jtk             |
 *-----=<  hierarchical systems are for files, not for humans  >=-----*


From Kurt.Hornik at wu-wien.ac.at  Fri Dec 15 18:08:09 2006
From: Kurt.Hornik at wu-wien.ac.at (Kurt Hornik)
Date: Fri, 15 Dec 2006 18:08:09 +0100
Subject: [Rd] A possible improvement to apropos
In-Reply-To: <45819061.6030703@fhcrc.org>
References: <m2tzzznwgl.fsf@ziti.local>
	<17793.3882.104712.38161@stat.math.ethz.ch>
	<45819061.6030703@fhcrc.org>
Message-ID: <17794.54905.373085.78347@mithrandir.hornik.net>

>>>>> Robert Gentleman writes:

> I would vastly prefer apropos to be case insensitive by default. The 
> point of it is to find things similar to a string, not the same as, and 
> given that capitalization in R is somewhat erratic (due to many authors, 
> and some of those changing their minds over the years), I find the 
> current apropos of little use.

> I would also, personally prefer some sort of approximate matching since 
> there are different ways to spell some words, and some folks abbreviate 
> parts of words.

The same design has been employed by help.search for a long time, for
exactly the same reasons (albeit with slightly different agrep
defaults).

-k


From sfalcon at fhcrc.org  Fri Dec 15 18:38:37 2006
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Fri, 15 Dec 2006 09:38:37 -0800
Subject: [Rd] A possible improvement to apropos
In-Reply-To: <17794.54905.373085.78347@mithrandir.hornik.net> (Kurt Hornik's
	message of "Fri, 15 Dec 2006 18:08:09 +0100")
References: <m2tzzznwgl.fsf@ziti.local>
	<17793.3882.104712.38161@stat.math.ethz.ch>
	<45819061.6030703@fhcrc.org>
	<17794.54905.373085.78347@mithrandir.hornik.net>
Message-ID: <m2bqm5cb4y.fsf@ziti.local>

Kurt Hornik <Kurt.Hornik at wu-wien.ac.at> writes:

>>>>>> Robert Gentleman writes:
>
>> I would also, personally prefer some sort of approximate matching since 
>> there are different ways to spell some words, and some folks abbreviate 
>> parts of words.
>
> The same design has been employed by help.search for a long time, for
> exactly the same reasons (albeit with slightly different agrep
> defaults).

I may not have spent enough time adjusting the behavior, but when I
tried agrep for apropos, I found that I almost always got way too many
hits and found the case-insensitive grep the right balance.

+ seth


From Kurt.Hornik at wu-wien.ac.at  Fri Dec 15 18:51:11 2006
From: Kurt.Hornik at wu-wien.ac.at (Kurt Hornik)
Date: Fri, 15 Dec 2006 18:51:11 +0100
Subject: [Rd] A possible improvement to apropos
In-Reply-To: <m2bqm5cb4y.fsf@ziti.local>
References: <m2tzzznwgl.fsf@ziti.local>
	<17793.3882.104712.38161@stat.math.ethz.ch>
	<45819061.6030703@fhcrc.org>
	<17794.54905.373085.78347@mithrandir.hornik.net>
	<m2bqm5cb4y.fsf@ziti.local>
Message-ID: <17794.57487.766310.587998@mithrandir.hornik.net>

>>>>> Seth Falcon writes:

> Kurt Hornik <Kurt.Hornik at wu-wien.ac.at> writes:
>>>>>>> Robert Gentleman writes:
>> 
>>> I would also, personally prefer some sort of approximate matching since 
>>> there are different ways to spell some words, and some folks abbreviate 
>>> parts of words.
>> 
>> The same design has been employed by help.search for a long time, for
>> exactly the same reasons (albeit with slightly different agrep
>> defaults).

> I may not have spent enough time adjusting the behavior, but when I
> tried agrep for apropos, I found that I almost always got way too many
> hits and found the case-insensitive grep the right balance.

Have you tried the help.search design?  It uses approximate matching
only if the match string is long enough (no less than 5 characters,
something slightly larger may be useful for apropos()).

-k


From btyner at stat.purdue.edu  Sat Dec 16 00:34:57 2006
From: btyner at stat.purdue.edu (Benjamin Tyner)
Date: Fri, 15 Dec 2006 18:34:57 -0500
Subject: [Rd] possible bug in co.intervals when overlap=0
Message-ID: <45833121.4080701@stat.purdue.edu>

I apologize if this is just a misunderstanding on my part, but I was 
under the impression that the intervals returned by co.intervals should 
cover all the observations. Yet

x<-1:10
z<-co.intervals(x,overlap=0)

In R, z equals
      [,1] [,2]
[1,]  0.5  1.5
[2,]  2.5  3.5
[3,]  3.5  4.5
[4,]  5.5  6.5
[5,]  7.5  8.5
[6,]  8.5  9.5

Note in particular the second and last element of x are not covered by 
any of the intervals. In fact S-PLUS gives
     [,1] [,2]
[1,]    1    2
[2,]    3    3
[3,]    4    5
[4,]    6    7
[5,]    8    8
[6,]    9   10


Ben


From jzedlewski at hbs.edu  Sat Dec 16 01:09:42 2006
From: jzedlewski at hbs.edu (John Zedlewski)
Date: Fri, 15 Dec 2006 19:09:42 -0500
Subject: [Rd] max.col oddity
Message-ID: <5918c61f0612151609v5beb89c1ub02e40b2c7691bf0@mail.gmail.com>

I've noticed that the max.col function with the default "random"
option often gives unexpected results. For instance, in this test, it
seems clear what the answer should be:

> # second col should always be max
> x1 = cbind(1:10, 2:11, -Inf)
>
> # this works fine
> max.col(x1, "first")
 [1] 2 2 2 2 2 2 2 2 2 2
>
> # this gives random answers
> max.col(x1)
> [1] 3 1 1 2 3 3 1 3 1 1

Ouch! max.col is randomizing across all values.
Even without infinite values, something similar can happen:

> # test 2 --- tolerance problems
>
> # clearly column 3 is the max
> x1 = cbind(-1e9 * 1:10, 1:10, 2:11)
>
> # again, first method works:
> max.col(x1, "first")
 [1] 3 3 3 3 3 3 3 3 3 3
>
> # but random doesn't
> max.col(x1)
 [1] 2 3 2 3 3 2 2 2 3 2
>

The max.col docs say " there is a relative tolerance of 1e-5, relative
to the largest entry in the row", but it's really using the maximum
absolute value entry in the row (appl/maxcol.c, line 35 in R 2.4.0).
Is this necessary for some sort of S-plus compatibility? If so, I
think it would be good to make this absolute value property very clear
in the docs, since it can cause subtle bugs (and did for me).

Personally, I think the behavior is much nicer with the following patch:

--- rplain/R-2.4.0/src/appl/maxcol.c    2006-04-09 18:19:58.000000000 -0400
+++ R-2.4.0/src/appl/maxcol.c   2006-12-14 15:30:56.000000000 -0500
@@ -26,13 +26,14 @@
       do_rand = *ties_meth == 1;

    for (r = 0; r < n_r; r++) {
-       /* first check row for any NAs and find the largest abs(entry) */
+       /* first check row for any NAs and find the largest entry */
       large = 0.0;
       isna = FALSE;
       for (c = 0; c < *nc; c++) {
           a = matrix[r + c * n_r];
           if (ISNAN(a)) { isna = TRUE; break; }
-           if (do_rand) large = fmax2(large, fabs(a));
+           if (!R_FINITE(a)) continue;
+           if (do_rand) large = fmax2(large, a);
       }
       if (isna) { maxes[r] = NA_INTEGER; continue; }

---------------- END   ----------------------

This gives the expected behavior in the two examples above.

(Sorry to crosspost to both this list and R-help, but it was suggested
that R-devel would be a more appropriate forum for this.)


From ripley at stats.ox.ac.uk  Sat Dec 16 08:01:51 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sat, 16 Dec 2006 07:01:51 +0000 (GMT)
Subject: [Rd] possible bug in co.intervals when overlap=0
In-Reply-To: <45833121.4080701@stat.purdue.edu>
References: <45833121.4080701@stat.purdue.edu>
Message-ID: <Pine.LNX.4.64.0612160656080.32578@gannet.stats.ox.ac.uk>

This happens equally when overlap = 0.5 (the default).

Yes, it is a bug.  R does xr <- x[r + ii] with fractional r.

On Fri, 15 Dec 2006, Benjamin Tyner wrote:

> I apologize if this is just a misunderstanding on my part, but I was
> under the impression that the intervals returned by co.intervals should
> cover all the observations. Yet
>
> x<-1:10
> z<-co.intervals(x,overlap=0)
>
> In R, z equals
>      [,1] [,2]
> [1,]  0.5  1.5
> [2,]  2.5  3.5
> [3,]  3.5  4.5
> [4,]  5.5  6.5
> [5,]  7.5  8.5
> [6,]  8.5  9.5
>
> Note in particular the second and last element of x are not covered by
> any of the intervals. In fact S-PLUS gives
>     [,1] [,2]
> [1,]    1    2
> [2,]    3    3
> [3,]    4    5
> [4,]    6    7
> [5,]    8    8
> [6,]    9   10


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From murdoch at stats.uwo.ca  Sat Dec 16 12:37:26 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Sat, 16 Dec 2006 06:37:26 -0500
Subject: [Rd] max.col oddity
In-Reply-To: <5918c61f0612151609v5beb89c1ub02e40b2c7691bf0@mail.gmail.com>
References: <5918c61f0612151609v5beb89c1ub02e40b2c7691bf0@mail.gmail.com>
Message-ID: <4583DA76.6010701@stats.uwo.ca>

On 12/15/2006 7:09 PM, John Zedlewski wrote:
> I've noticed that the max.col function with the default "random"
> option often gives unexpected results. For instance, in this test, it
> seems clear what the answer should be:
> 
>> # second col should always be max
>> x1 = cbind(1:10, 2:11, -Inf)
>>
>> # this works fine
>> max.col(x1, "first")
>  [1] 2 2 2 2 2 2 2 2 2 2
>> # this gives random answers
>> max.col(x1)
>> [1] 3 1 1 2 3 3 1 3 1 1
> 
> Ouch! max.col is randomizing across all values.
> Even without infinite values, something similar can happen:
> 
>> # test 2 --- tolerance problems
>>
>> # clearly column 3 is the max
>> x1 = cbind(-1e9 * 1:10, 1:10, 2:11)
>>
>> # again, first method works:
>> max.col(x1, "first")
>  [1] 3 3 3 3 3 3 3 3 3 3
>> # but random doesn't
>> max.col(x1)
>  [1] 2 3 2 3 3 2 2 2 3 2
> 
> The max.col docs say " there is a relative tolerance of 1e-5, relative
> to the largest entry in the row", but it's really using the maximum
> absolute value entry in the row (appl/maxcol.c, line 35 in R 2.4.0).
> Is this necessary for some sort of S-plus compatibility? If so, I
> think it would be good to make this absolute value property very clear
> in the docs, since it can cause subtle bugs (and did for me).
> 
> Personally, I think the behavior is much nicer with the following patch:
> 
> --- rplain/R-2.4.0/src/appl/maxcol.c    2006-04-09 18:19:58.000000000 -0400
> +++ R-2.4.0/src/appl/maxcol.c   2006-12-14 15:30:56.000000000 -0500
> @@ -26,13 +26,14 @@
>        do_rand = *ties_meth == 1;
> 
>     for (r = 0; r < n_r; r++) {
> -       /* first check row for any NAs and find the largest abs(entry) */
> +       /* first check row for any NAs and find the largest entry */
>        large = 0.0;
>        isna = FALSE;
>        for (c = 0; c < *nc; c++) {
>            a = matrix[r + c * n_r];
>            if (ISNAN(a)) { isna = TRUE; break; }
> -           if (do_rand) large = fmax2(large, fabs(a));
> +           if (!R_FINITE(a)) continue;
> +           if (do_rand) large = fmax2(large, a);
>        }
>        if (isna) { maxes[r] = NA_INTEGER; continue; }
> 
> ---------------- END   ----------------------
> 
> This gives the expected behavior in the two examples above.

I think I'd prefer to be clear about what "largest" means in the docs 
rather than dropping the absolute value, because if all entries are 
negative, your version sets the tolerance to 0.

But ignoring infinite values when calculating the largest absolute value 
might be a good idea:  I can't see why someone would want an infinite 
tolerance.

So I'd propose to add your R_FINITE check, and make this change to the docs:

" there is a relative tolerance of 1e-5, relative
   to the largest finite absolute value in the row"

The copyright notice in the file says this function is from MASS/MASS.c 
by W. N. Venables and B. D. Ripley, so I'd like to hear from at least 
one of them before making a change.

Duncan Murdoch

> 
> (Sorry to crosspost to both this list and R-help, but it was suggested
> that R-devel would be a more appropriate forum for this.)
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From btyner at stat.purdue.edu  Sat Dec 16 15:49:46 2006
From: btyner at stat.purdue.edu (btyner at stat.purdue.edu)
Date: Sat, 16 Dec 2006 15:49:46 +0100 (CET)
Subject: [Rd] co.intervals when overlap=0 or 0.5 (PR#9419)
Message-ID: <20061216144946.02ED24421C@slim.kubism.ku.dk>

Full_Name: Benjamin Tyner
Version: 2.4.0
OS: linux-gnu
Submission from: (NULL) (71.98.75.54)


As pointed out by Brian Ripley on R-devel, co.intervals does xr <- x[r + ii]
with a fractional r, leading to intervals that don't match the ones returned by
S-PLUS when overlap=0 or 0.5. For example,

x<-1:10
z<-co.intervals(x,overlap=0) 

As I had already peaked at co.intervals in S-PLUS, I probably shouldn't be the
one to contribute a fix.


From ripley at stats.ox.ac.uk  Sat Dec 16 16:50:21 2006
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Sat, 16 Dec 2006 16:50:21 +0100 (CET)
Subject: [Rd] co.intervals when overlap=0 or 0.5 (PR#9419)
Message-ID: <20061216155021.0CDBB4C9E5@slim.kubism.ku.dk>

Please don't report bugs that are already fixed in R-devel.

On Sat, 16 Dec 2006, btyner at stat.purdue.edu wrote:

> Full_Name: Benjamin Tyner
> Version: 2.4.0
> OS: linux-gnu
> Submission from: (NULL) (71.98.75.54)
>
>
> As pointed out by Brian Ripley on R-devel, co.intervals does xr <- x[r + ii]
> with a fractional r, leading to intervals that don't match the ones returned by
> S-PLUS when overlap=0 or 0.5. For example,
>
> x<-1:10
> z<-co.intervals(x,overlap=0)
>
> As I had already peaked at co.intervals in S-PLUS, I probably shouldn't be the
> one to contribute a fix.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From jzedlewski at hbs.edu  Sat Dec 16 18:25:14 2006
From: jzedlewski at hbs.edu (John Zedlewski)
Date: Sat, 16 Dec 2006 12:25:14 -0500
Subject: [Rd] max.col oddity
In-Reply-To: <4583DA76.6010701@stats.uwo.ca>
References: <5918c61f0612151609v5beb89c1ub02e40b2c7691bf0@mail.gmail.com>
	<4583DA76.6010701@stats.uwo.ca>
Message-ID: <5918c61f0612160925q3ab5b17cw6dadaaf0e033abfc@mail.gmail.com>

Duncan--
 Ah, good point, clearly setting the tolerance to 0 is bad in that
case. Also, my code has another problem when the max is negative -- it
will set a negative tolerance! One good fix for both problems is the
following: set the initial value of "large" to the first value in the
row instead of 0.0, then keep the "fmax2(a,large)" approach from my
patch, but at the end, take the absolute value of large. That will
always follow the current docs -- using the largest value, not the
largest absolute value in the row, for comparison.

  You proposal of changing the docs and just fixing the infinite
problem sounds like a reasonable approach too, especially if people
are already depending on this behavior (??), although I still think
it's s a little weird that comparing "(-1e10, 2, 3)" will say that 2
or 3 could be the max.
 Thanks,
--JRZ

> I think I'd prefer to be clear about what "largest" means in the docs
> rather than dropping the absolute value, because if all entries are
> negative, your version sets the tolerance to 0.


On 12/16/06, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
> On 12/15/2006 7:09 PM, John Zedlewski wrote:
> > I've noticed that the max.col function with the default "random"
> > option often gives unexpected results. For instance, in this test, it
> > seems clear what the answer should be:
> >
> >> # second col should always be max
> >> x1 = cbind(1:10, 2:11, -Inf)
> >>
> >> # this works fine
> >> max.col(x1, "first")
> >  [1] 2 2 2 2 2 2 2 2 2 2
> >> # this gives random answers
> >> max.col(x1)
> >> [1] 3 1 1 2 3 3 1 3 1 1
> >
> > Ouch! max.col is randomizing across all values.
> > Even without infinite values, something similar can happen:
> >
> >> # test 2 --- tolerance problems
> >>
> >> # clearly column 3 is the max
> >> x1 = cbind(-1e9 * 1:10, 1:10, 2:11)
> >>
> >> # again, first method works:
> >> max.col(x1, "first")
> >  [1] 3 3 3 3 3 3 3 3 3 3
> >> # but random doesn't
> >> max.col(x1)
> >  [1] 2 3 2 3 3 2 2 2 3 2
> >
> > The max.col docs say " there is a relative tolerance of 1e-5, relative
> > to the largest entry in the row", but it's really using the maximum
> > absolute value entry in the row (appl/maxcol.c, line 35 in R 2.4.0).
> > Is this necessary for some sort of S-plus compatibility? If so, I
> > think it would be good to make this absolute value property very clear
> > in the docs, since it can cause subtle bugs (and did for me).
> >
> > Personally, I think the behavior is much nicer with the following patch:
> >
> > --- rplain/R-2.4.0/src/appl/maxcol.c    2006-04-09 18:19:58.000000000 -0400
> > +++ R-2.4.0/src/appl/maxcol.c   2006-12-14 15:30:56.000000000 -0500
> > @@ -26,13 +26,14 @@
> >        do_rand = *ties_meth == 1;
> >
> >     for (r = 0; r < n_r; r++) {
> > -       /* first check row for any NAs and find the largest abs(entry) */
> > +       /* first check row for any NAs and find the largest entry */
> >        large = 0.0;
> >        isna = FALSE;
> >        for (c = 0; c < *nc; c++) {
> >            a = matrix[r + c * n_r];
> >            if (ISNAN(a)) { isna = TRUE; break; }
> > -           if (do_rand) large = fmax2(large, fabs(a));
> > +           if (!R_FINITE(a)) continue;
> > +           if (do_rand) large = fmax2(large, a);
> >        }
> >        if (isna) { maxes[r] = NA_INTEGER; continue; }
> >
> > ---------------- END   ----------------------
> >
> > This gives the expected behavior in the two examples above.
>
> I think I'd prefer to be clear about what "largest" means in the docs
> rather than dropping the absolute value, because if all entries are
> negative, your version sets the tolerance to 0.
>
> But ignoring infinite values when calculating the largest absolute value
> might be a good idea:  I can't see why someone would want an infinite
> tolerance.
>
> So I'd propose to add your R_FINITE check, and make this change to the docs:
>
> " there is a relative tolerance of 1e-5, relative
>    to the largest finite absolute value in the row"
>
> The copyright notice in the file says this function is from MASS/MASS.c
> by W. N. Venables and B. D. Ripley, so I'd like to hear from at least
> one of them before making a change.
>
> Duncan Murdoch
>
> >
> > (Sorry to crosspost to both this list and R-help, but it was suggested
> > that R-devel would be a more appropriate forum for this.)
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From murdoch at stats.uwo.ca  Sat Dec 16 18:45:40 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Sat, 16 Dec 2006 12:45:40 -0500
Subject: [Rd] max.col oddity
In-Reply-To: <5918c61f0612160925q3ab5b17cw6dadaaf0e033abfc@mail.gmail.com>
References: <5918c61f0612151609v5beb89c1ub02e40b2c7691bf0@mail.gmail.com>	<4583DA76.6010701@stats.uwo.ca>
	<5918c61f0612160925q3ab5b17cw6dadaaf0e033abfc@mail.gmail.com>
Message-ID: <458430C4.3050704@stats.uwo.ca>

On 12/16/2006 12:25 PM, John Zedlewski wrote:
> Duncan--
>  Ah, good point, clearly setting the tolerance to 0 is bad in that
> case. Also, my code has another problem when the max is negative -- it
> will set a negative tolerance! One good fix for both problems is the
> following: set the initial value of "large" to the first value in the
> row instead of 0.0, then keep the "fmax2(a,large)" approach from my
> patch, but at the end, take the absolute value of large. That will
> always follow the current docs -- using the largest value, not the
> largest absolute value in the row, for comparison.
> 
>   You proposal of changing the docs and just fixing the infinite
> problem sounds like a reasonable approach too, especially if people
> are already depending on this behavior (??), although I still think
> it's s a little weird that comparing "(-1e10, 2, 3)" will say that 2
> or 3 could be the max.

I think the explanation for this is in the man page:  "In this case, the 
determination of "tie" assumes that the entries are probabilities..." 
If you transform that vector linearly to force it into the [0,1] range 
of probabilities, the behaviour is clear:

 > x <- c(-1e10, 2, 3)
 > (x - min(x))/diff(range(x))
[1] 0 1 1

Duncan Murdoch

>  Thanks,
> --JRZ
> 
>> I think I'd prefer to be clear about what "largest" means in the docs
>> rather than dropping the absolute value, because if all entries are
>> negative, your version sets the tolerance to 0.
> 
> 
> On 12/16/06, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
>> On 12/15/2006 7:09 PM, John Zedlewski wrote:
>>> I've noticed that the max.col function with the default "random"
>>> option often gives unexpected results. For instance, in this test, it
>>> seems clear what the answer should be:
>>>
>>>> # second col should always be max
>>>> x1 = cbind(1:10, 2:11, -Inf)
>>>>
>>>> # this works fine
>>>> max.col(x1, "first")
>>>  [1] 2 2 2 2 2 2 2 2 2 2
>>>> # this gives random answers
>>>> max.col(x1)
>>>> [1] 3 1 1 2 3 3 1 3 1 1
>>> Ouch! max.col is randomizing across all values.
>>> Even without infinite values, something similar can happen:
>>>
>>>> # test 2 --- tolerance problems
>>>>
>>>> # clearly column 3 is the max
>>>> x1 = cbind(-1e9 * 1:10, 1:10, 2:11)
>>>>
>>>> # again, first method works:
>>>> max.col(x1, "first")
>>>  [1] 3 3 3 3 3 3 3 3 3 3
>>>> # but random doesn't
>>>> max.col(x1)
>>>  [1] 2 3 2 3 3 2 2 2 3 2
>>>
>>> The max.col docs say " there is a relative tolerance of 1e-5, relative
>>> to the largest entry in the row", but it's really using the maximum
>>> absolute value entry in the row (appl/maxcol.c, line 35 in R 2.4.0).
>>> Is this necessary for some sort of S-plus compatibility? If so, I
>>> think it would be good to make this absolute value property very clear
>>> in the docs, since it can cause subtle bugs (and did for me).
>>>
>>> Personally, I think the behavior is much nicer with the following patch:
>>>
>>> --- rplain/R-2.4.0/src/appl/maxcol.c    2006-04-09 18:19:58.000000000 -0400
>>> +++ R-2.4.0/src/appl/maxcol.c   2006-12-14 15:30:56.000000000 -0500
>>> @@ -26,13 +26,14 @@
>>>        do_rand = *ties_meth == 1;
>>>
>>>     for (r = 0; r < n_r; r++) {
>>> -       /* first check row for any NAs and find the largest abs(entry) */
>>> +       /* first check row for any NAs and find the largest entry */
>>>        large = 0.0;
>>>        isna = FALSE;
>>>        for (c = 0; c < *nc; c++) {
>>>            a = matrix[r + c * n_r];
>>>            if (ISNAN(a)) { isna = TRUE; break; }
>>> -           if (do_rand) large = fmax2(large, fabs(a));
>>> +           if (!R_FINITE(a)) continue;
>>> +           if (do_rand) large = fmax2(large, a);
>>>        }
>>>        if (isna) { maxes[r] = NA_INTEGER; continue; }
>>>
>>> ---------------- END   ----------------------
>>>
>>> This gives the expected behavior in the two examples above.
>> I think I'd prefer to be clear about what "largest" means in the docs
>> rather than dropping the absolute value, because if all entries are
>> negative, your version sets the tolerance to 0.
>>
>> But ignoring infinite values when calculating the largest absolute value
>> might be a good idea:  I can't see why someone would want an infinite
>> tolerance.
>>
>> So I'd propose to add your R_FINITE check, and make this change to the docs:
>>
>> " there is a relative tolerance of 1e-5, relative
>>    to the largest finite absolute value in the row"
>>
>> The copyright notice in the file says this function is from MASS/MASS.c
>> by W. N. Venables and B. D. Ripley, so I'd like to hear from at least
>> one of them before making a change.
>>
>> Duncan Murdoch
>>
>>> (Sorry to crosspost to both this list and R-help, but it was suggested
>>> that R-devel would be a more appropriate forum for this.)
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From marc_schwartz at comcast.net  Sat Dec 16 18:51:58 2006
From: marc_schwartz at comcast.net (Marc Schwartz)
Date: Sat, 16 Dec 2006 11:51:58 -0600
Subject: [Rd] Curious finding in MASS:::confint.glm() tied to eval()
In-Reply-To: <1166039626.4478.87.camel@localhost.localdomain>
References: <1166039626.4478.87.camel@localhost.localdomain>
Message-ID: <1166291518.6042.9.camel@localhost.localdomain>

Hi all,

Has anyone had a chance to look at this and either validate my finding
or tell me that my brain has turned to mush?

Either would be welcome...  :-)

Thanks,

Marc


On Wed, 2006-12-13 at 13:53 -0600, Marc Schwartz wrote:
> Greetings all,
> 
> I was in the process of creating a function to generate profile
> likelihood confidence intervals for a proportion using a binomial glm.
> This is a component of a larger function to generate and plot confidence
> intervals for proportions using the above, along with bootstrap (BCa),
> Wilson and Exact to visually demonstrate the variation across the
> methods to some folks.
> 
> I had initially tried this using:
> 
>   R version 2.4.0 Patched (2006-11-19 r39944)
> 
> However, I just verified that it still occurs in:
> 
>   R version 2.4.1 RC (2006-12-11 r40157)
> 
> In both cases, I started R using '--vanilla' and this is under FC6,
> fully updated.
> 
> 
> Using the following code, it runs fine:
> 
> x <- 14
> n <- 35
> conf <- 0.95
> DF <- data.frame(y = x / n, weights = n)
> mod <- glm(y ~ 1, weights = weights, family = binomial(), data = DF)
> 
> pl.ci <- plogis(confint(mod, level = conf))
> Waiting for profiling to be done...
> 
> > pl.ci
>     2.5 %    97.5 % 
> 0.2490412 0.5651094 
> 
> 
> However, when I encapsulate the above in a function:
> 
> PropCI <- function(x, n, conf = 0.95)
> {
>   DF <- data.frame(y = x / n, weights = n)
>   mod <- glm(y ~ 1, weights = weights, family = binomial(), data = DF)
>   plogis(confint(mod, level = conf))
> }
>   
> 
> I get the following:
> 
> # Nothing else in the current global environment
> > ls()
> [1] "PropCI"
> 
> > PropCI(14, 35)
> Waiting for profiling to be done...
> Error in inherits(x, "data.frame") : object "DF" not found
> 
> 
> If however, I create a 'DF' in the global environment (which may NOT be
> the same 'DF' values as within the function!!):
> 
> DF <- data.frame(y = 14 / 35, weights = 35)
> 
> > DF
>     y weights
> 1 0.4      35
> 
> > ls()
> [1] "DF"     "PropCI"
> 
> > PropCI(14, 35)
> Waiting for profiling to be done...
>     2.5 %    97.5 % 
> 0.2490412 0.5651094 
> 
> 
> To my point above about the 'DF' in the global environment not being the
> same as the 'DF' within the function body:
> 
> > DF <- data.frame(y = 5 / 40, weights = 40)
> > DF
>       y weights
> 1 0.125      40
> 
> > PropCI(14, 35)
> Waiting for profiling to be done...
>     2.5 %    97.5 % 
> 0.3752233 0.4217556 
> 
> 
> Rather scary I think....
> 
> 
> 
> So, this suggested a problem in where confint.glm() was looking for
> 'DF'.
> 
> I subsequently traced through the code using debug(), having removed
> 'DF' from the global environment:
> 
> > debug(MASS:::confint.glm)
> > PropCI(14, 35)
> debugging in: confint.glm(mod, level = conf)
> 
> ...
> 
> debug: object <- profile(object, which = parm, alpha = (1 - level)/4, 
>     trace = trace)
> Browse[1]> 
> Error in inherits(x, "data.frame") : object "DF" not found
> 
> 
> which brought me to profile.glm():
> 
> > debug(MASS:::profile.glm)
> > PropCI(14, 35)
> Waiting for profiling to be done...
> debugging in: profile.glm(object, which = parm, alpha = (1 - level)/4,
> trace = trace)
> 
> ...
> 
> debug: mf <- update(fitted, method = "model.frame")
> Browse[1]> 
> Error in inherits(x, "data.frame") : object "DF" not found
> 
> 
> which brought me to update.default():
> 
> > debug(update.default)
> > PropCI(14, 35)
> Waiting for profiling to be done...
> debugging in: update.default(fitted, method = "model.frame")
> 
> ...
> 
> debug: if (evaluate) eval(call, parent.frame()) else call
> Browse[1]> 
> Error in inherits(x, "data.frame") : object "DF" not found
> 
> 
> which brought me to eval():
> 
> > debug(eval)
> > PropCI(14, 35)
> debugging in: eval(mf, parent.frame())
> 
> ...
> 
> debugging in: eval(mf, parent.frame())
> debug: .Internal(eval(expr, envir, enclos))
> Browse[1]> 
> Error in inherits(x, "data.frame") : object "DF" not found
> 
> 
> 
> Unfortunately, at this point, largely due to lack of sleep of late, my
> eyes are sufficiently glazed over and my brain sufficiently vapor locked
> that the resolution is not immediately clear and I have not yet dug into
> the C code for eval().
> 
> Presumably, either I am missing something fundamental here, or there is
> a bug where, environment-wise, these respective functions are looking in
> the wrong place for 'DF', probably based upon the default environment
> arguments noted above.
> 
> Any comments from a fresh pair of eyes would be most welcome.
> 
> Regards and thanks,
> 
> Marc Schwartz


From bolker at zoo.ufl.edu  Sat Dec 16 20:20:17 2006
From: bolker at zoo.ufl.edu (Ben Bolker)
Date: Sat, 16 Dec 2006 14:20:17 -0500
Subject: [Rd] question about trailing arguments in an S4 method
Message-ID: <458446F1.40403@zoo.ufl.edu>


  I'm trying to add arguments to the AIC method
for some classes -- things like
  weights=TRUE to calculate AIC weights
  corr=TRUE, nobs to calculate AICc
  delta=TRUE  to put a delta-AIC column in the output.

 The problem is that AIC is defined as
AIC(object, ..., k=2)  where k is the constant associated
with the penalty term and ... is a list of objects
that will have their AICs calculated and listed.
Thus I'm not allowed (I think) to extend the definition to

AIC(object, ..., nobs, corr=FALSE, delta=FALSE, weights=FALSE, k=2)

  An ugly solution to this is to go through the ... list and
pull out the values of any of the other arguments I want, and
then set them to NULL, leaving the list composed only of
additional objects to calculate the AIC for.  But it seems
really ugly ...

   Any ideas for a better way to do this would be
appreciated.  (Please be gentle if possible, I'm a bit out
of my depth with S4 ...)

  cheers
    Ben Bolker


-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 254 bytes
Desc: OpenPGP digital signature
Url : https://stat.ethz.ch/pipermail/r-devel/attachments/20061216/4cd5425d/attachment.bin 

From p.dalgaard at biostat.ku.dk  Sat Dec 16 20:35:39 2006
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Sat, 16 Dec 2006 20:35:39 +0100
Subject: [Rd] Curious finding in MASS:::confint.glm() tied to eval()
In-Reply-To: <1166291518.6042.9.camel@localhost.localdomain>
References: <1166039626.4478.87.camel@localhost.localdomain>
	<1166291518.6042.9.camel@localhost.localdomain>
Message-ID: <45844A8B.60606@biostat.ku.dk>

Marc Schwartz wrote:
> Hi all,
>
> Has anyone had a chance to look at this and either validate my finding
> or tell me that my brain has turned to mush?
>
> Either would be welcome...  :-)
>
>   
Scoping issues can turn anyones brain to mush! This sort of thing easily 
happens with code ported from S-PLUS which has different scoping rules.

Inside MASS:::confint.glm we have a call to profile which has a call to 
update. I think one or both of these need to be evaluated in the parent 
environment.

> Thanks,
>
> Marc
>
>
> On Wed, 2006-12-13 at 13:53 -0600, Marc Schwartz wrote:
>   
>> Greetings all,
>>
>> I was in the process of creating a function to generate profile
>> likelihood confidence intervals for a proportion using a binomial glm.
>> This is a component of a larger function to generate and plot confidence
>> intervals for proportions using the above, along with bootstrap (BCa),
>> Wilson and Exact to visually demonstrate the variation across the
>> methods to some folks.
>>
>> I had initially tried this using:
>>
>>   R version 2.4.0 Patched (2006-11-19 r39944)
>>
>> However, I just verified that it still occurs in:
>>
>>   R version 2.4.1 RC (2006-12-11 r40157)
>>
>> In both cases, I started R using '--vanilla' and this is under FC6,
>> fully updated.
>>
>>
>> Using the following code, it runs fine:
>>
>> x <- 14
>> n <- 35
>> conf <- 0.95
>> DF <- data.frame(y = x / n, weights = n)
>> mod <- glm(y ~ 1, weights = weights, family = binomial(), data = DF)
>>
>> pl.ci <- plogis(confint(mod, level = conf))
>> Waiting for profiling to be done...
>>
>>     
>>> pl.ci
>>>       
>>     2.5 %    97.5 % 
>> 0.2490412 0.5651094 
>>
>>
>> However, when I encapsulate the above in a function:
>>
>> PropCI <- function(x, n, conf = 0.95)
>> {
>>   DF <- data.frame(y = x / n, weights = n)
>>   mod <- glm(y ~ 1, weights = weights, family = binomial(), data = DF)
>>   plogis(confint(mod, level = conf))
>> }
>>   
>>
>> I get the following:
>>
>> # Nothing else in the current global environment
>>     
>>> ls()
>>>       
>> [1] "PropCI"
>>
>>     
>>> PropCI(14, 35)
>>>       
>> Waiting for profiling to be done...
>> Error in inherits(x, "data.frame") : object "DF" not found
>>
>>
>> If however, I create a 'DF' in the global environment (which may NOT be
>> the same 'DF' values as within the function!!):
>>
>> DF <- data.frame(y = 14 / 35, weights = 35)
>>
>>     
>>> DF
>>>       
>>     y weights
>> 1 0.4      35
>>
>>     
>>> ls()
>>>       
>> [1] "DF"     "PropCI"
>>
>>     
>>> PropCI(14, 35)
>>>       
>> Waiting for profiling to be done...
>>     2.5 %    97.5 % 
>> 0.2490412 0.5651094 
>>
>>
>> To my point above about the 'DF' in the global environment not being the
>> same as the 'DF' within the function body:
>>
>>     
>>> DF <- data.frame(y = 5 / 40, weights = 40)
>>> DF
>>>       
>>       y weights
>> 1 0.125      40
>>
>>     
>>> PropCI(14, 35)
>>>       
>> Waiting for profiling to be done...
>>     2.5 %    97.5 % 
>> 0.3752233 0.4217556 
>>
>>
>> Rather scary I think....
>>
>>
>>
>> So, this suggested a problem in where confint.glm() was looking for
>> 'DF'.
>>
>> I subsequently traced through the code using debug(), having removed
>> 'DF' from the global environment:
>>
>>     
>>> debug(MASS:::confint.glm)
>>> PropCI(14, 35)
>>>       
>> debugging in: confint.glm(mod, level = conf)
>>
>> ...
>>
>> debug: object <- profile(object, which = parm, alpha = (1 - level)/4, 
>>     trace = trace)
>> Browse[1]> 
>> Error in inherits(x, "data.frame") : object "DF" not found
>>
>>
>> which brought me to profile.glm():
>>
>>     
>>> debug(MASS:::profile.glm)
>>> PropCI(14, 35)
>>>       
>> Waiting for profiling to be done...
>> debugging in: profile.glm(object, which = parm, alpha = (1 - level)/4,
>> trace = trace)
>>
>> ...
>>
>> debug: mf <- update(fitted, method = "model.frame")
>> Browse[1]> 
>> Error in inherits(x, "data.frame") : object "DF" not found
>>
>>
>> which brought me to update.default():
>>
>>     
>>> debug(update.default)
>>> PropCI(14, 35)
>>>       
>> Waiting for profiling to be done...
>> debugging in: update.default(fitted, method = "model.frame")
>>
>> ...
>>
>> debug: if (evaluate) eval(call, parent.frame()) else call
>> Browse[1]> 
>> Error in inherits(x, "data.frame") : object "DF" not found
>>
>>
>> which brought me to eval():
>>
>>     
>>> debug(eval)
>>> PropCI(14, 35)
>>>       
>> debugging in: eval(mf, parent.frame())
>>
>> ...
>>
>> debugging in: eval(mf, parent.frame())
>> debug: .Internal(eval(expr, envir, enclos))
>> Browse[1]> 
>> Error in inherits(x, "data.frame") : object "DF" not found
>>
>>
>>
>> Unfortunately, at this point, largely due to lack of sleep of late, my
>> eyes are sufficiently glazed over and my brain sufficiently vapor locked
>> that the resolution is not immediately clear and I have not yet dug into
>> the C code for eval().
>>
>> Presumably, either I am missing something fundamental here, or there is
>> a bug where, environment-wise, these respective functions are looking in
>> the wrong place for 'DF', probably based upon the default environment
>> arguments noted above.
>>
>> Any comments from a fresh pair of eyes would be most welcome.
>>
>> Regards and thanks,
>>
>> Marc Schwartz
>>     
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From ripley at stats.ox.ac.uk  Sat Dec 16 21:31:50 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sat, 16 Dec 2006 20:31:50 +0000 (GMT)
Subject: [Rd] question about trailing arguments in an S4 method
In-Reply-To: <458446F1.40403@zoo.ufl.edu>
References: <458446F1.40403@zoo.ufl.edu>
Message-ID: <Pine.LNX.4.64.0612161926540.31704@gannet.stats.ox.ac.uk>

I don't see how this can work, in S3 or S4.  Callers of AIC are entitied 
to expect it to behave as described on the help page, and so to be able to 
pass objects called (e.g.) 'delta' and get back exactly the value 
mentioned.

For what you seem to want to do, I think you need your own generic.


On Sat, 16 Dec 2006, Ben Bolker wrote:

>
>  I'm trying to add arguments to the AIC method
> for some classes -- things like
>  weights=TRUE to calculate AIC weights
>  corr=TRUE, nobs to calculate AICc
>  delta=TRUE  to put a delta-AIC column in the output.
>
> The problem is that AIC is defined as
> AIC(object, ..., k=2)  where k is the constant associated
> with the penalty term and ... is a list of objects
> that will have their AICs calculated and listed.
> Thus I'm not allowed (I think) to extend the definition to
>
> AIC(object, ..., nobs, corr=FALSE, delta=FALSE, weights=FALSE, k=2)
>
>  An ugly solution to this is to go through the ... list and
> pull out the values of any of the other arguments I want, and
> then set them to NULL, leaving the list composed only of
> additional objects to calculate the AIC for.  But it seems
> really ugly ...
>
>   Any ideas for a better way to do this would be
> appreciated.  (Please be gentle if possible, I'm a bit out
> of my depth with S4 ...)
>
>  cheers
>    Ben Bolker
>
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From maechler at stat.math.ethz.ch  Sat Dec 16 22:31:21 2006
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Sat, 16 Dec 2006 22:31:21 +0100
Subject: [Rd] data frame subset patch, take 2
In-Reply-To: <200612131303.21982.vdergachev@rcgardis.com>
References: <200612061333.09050.vdergachev@rcgardis.com>
	<457EE9DE.7050001@fhcrc.org>
	<17791.56721.742238.592970@stat.math.ethz.ch>
	<200612131303.21982.vdergachev@rcgardis.com>
Message-ID: <17796.26025.698050.64495@cmath-3.math.ethz.ch>

>>>>> "Vladimir" == Vladimir Dergachev <vdergachev at rcgardis.com>
>>>>>     on Wed, 13 Dec 2006 13:03:21 -0500 writes:

    Vladimir> On Wednesday 13 December 2006 6:01 am, Martin Maechler wrote:
    >> 
    >> - Vladimir, have you verified your 'take2' against recent versions
    >> of R-devel?

    Vladimir> Yes. 

indeed it applies cleanly

    >> - If they still work, could you re-post them to R-devel, this
    >> time using a proper MIME type,
    >> i.e. most probably one of
    >> application/x-tar
    >> application/x-compressed-tar
    >> application/x-gzip
    >> 
    >> In case you don't know how to achieve this,
    >> I'd be interested to get it by "private" e-mail.

    Vladimir> No problem. The old e-mail did have a mime type: "text/x-diff".
    Vladimir> I am resending the patch - now compressed, hopefully it will get pass whatever 
    Vladimir> filters are in place.

It did pass --- and  "text/x-diff" should pass through too from
now on.

However, even though the patch looks quite ok
{apart from one border case:  swiss[2, , drop = TRUE]  should give a list;
 and that was easy to fix; see the attached dataframe.R-diff
 file which incorporates that fix (and my other cosmetic changes)}

but running 'make check-all' then shows segmentation faults --- only on one platform of the
two I've tested {in mgcv's gam() example, boot's  boot()
		 example, and I think one other place}
My guess: typically when dealing with model.frames (which
   internally are "just" data frames with a particular "terms" attribute)
but the problems are not reproducible when run interactively.
It may really be that .subset() and .subset2() are sometimes
used in cases they should not be in your new code; or they even have a bug that
is not triggered unless by using them in the new context of [.data.frame

So I'm sorry, but we might have to wait for a "take 3"
or rather try to find the problem with your patch. 
Maybe you can try yourself?

-------------- next part --------------
A non-text attachment was scrubbed...
Name: dataframe.R-diff
Type: text/x-diff
Size: 2299 bytes
Desc: not available
Url : https://stat.ethz.ch/pipermail/r-devel/attachments/20061216/81fc1bc6/attachment.bin 
-------------- next part --------------

Thanks anyway, Vladimir!

Regards,
Martin Maechler, ETH Zurich

From maechler at stat.math.ethz.ch  Sat Dec 16 22:41:26 2006
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Sat, 16 Dec 2006 22:41:26 +0100
Subject: [Rd] data frame subset patch, take 2
In-Reply-To: <17796.26025.698050.64495@cmath-3.math.ethz.ch>
References: <200612061333.09050.vdergachev@rcgardis.com>
	<457EE9DE.7050001@fhcrc.org>
	<17791.56721.742238.592970@stat.math.ethz.ch>
	<200612131303.21982.vdergachev@rcgardis.com>
	<17796.26025.698050.64495@cmath-3.math.ethz.ch>
Message-ID: <17796.26630.481777.933234@cmath-3.math.ethz.ch>

>>>>> "MM" == Martin Maechler <maechler at stat.math.ethz.ch>
>>>>>     on Sat, 16 Dec 2006 22:31:21 +0100 writes:

>>>>> "Vladimir" == Vladimir Dergachev <vdergachev at rcgardis.com>
>>>>>     on Wed, 13 Dec 2006 13:03:21 -0500 writes:

    Vladimir> On Wednesday 13 December 2006 6:01 am, Martin Maechler wrote:
    >>> 
    >>> - Vladimir, have you verified your 'take2' against recent versions
    >>> of R-devel?

    Vladimir> Yes. 

    MM> indeed it applies cleanly

    >>> - If they still work, could you re-post them to R-devel, this
    >>> time using a proper MIME type,
    >>> i.e. most probably one of
    >>> application/x-tar
    >>> application/x-compressed-tar
    >>> application/x-gzip
    >>> 
    >>> In case you don't know how to achieve this,
    >>> I'd be interested to get it by "private" e-mail.

    Vladimir> No problem. The old e-mail did have a mime type: "text/x-diff".
    Vladimir> I am resending the patch - now compressed, hopefully it will get pass whatever 
    Vladimir> filters are in place.

    MM> It did pass --- and  "text/x-diff" should pass through too from
    MM> now on.

    MM> However, even though the patch looks quite ok
    MM> {apart from one border case:  swiss[2, , drop = TRUE]  should give a list;
    MM> and that was easy to fix; see the attached dataframe.R-diff
    MM> file which incorporates that fix (and my other cosmetic changes)}

    MM> but running 'make check-all' then shows segmentation faults --- only on one platform of the
    MM> two I've tested {in mgcv's gam() example, boot's  boot()
    MM> example, and I think one other place}

Correction: the problems show on both platforms;

one is in mgcv, gam(), an error in [[ <-  -- pretty clearly linked to your
changes but not reproducible when tried isolatedly
interactively,

the other one is a seg.fault "memory not mapped" when running
the  example
   > nuke.boot <- boot(nuke.data, nuke.fun, R=999, m=1, 
   +      fit.pred=new.fit, x.pred=new.data)


    MM> My guess: typically when dealing with model.frames (which
    MM> internally are "just" data frames with a particular "terms" attribute)
    MM> but the problems are not reproducible when run interactively.
    MM> It may really be that .subset() and .subset2() are sometimes
    MM> used in cases they should not be in your new code; or they even have a bug that
    MM> is not triggered unless by using them in the new context of [.data.frame

    MM> So I'm sorry, but we might have to wait for a "take 3"
    MM> or rather try to find the problem with your patch. 
    MM> Maybe you can try yourself?

    [my diff for dataframe.R]

    MM> Thanks anyway, Vladimir!

    MM> Regards,
    MM> Martin Maechler, ETH Zurich


From sfalcon at fhcrc.org  Sun Dec 17 01:06:57 2006
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Sat, 16 Dec 2006 16:06:57 -0800
Subject: [Rd] question about trailing arguments in an S4 method
In-Reply-To: <458446F1.40403@zoo.ufl.edu> (Ben Bolker's message of "Sat,
	16 Dec 2006 14:20:17 -0500")
References: <458446F1.40403@zoo.ufl.edu>
Message-ID: <m2mz5n5qse.fsf@ziti.local>

Ben Bolker <bolker at zoo.ufl.edu> writes:

>   I'm trying to add arguments to the AIC method
> for some classes -- things like
>   weights=TRUE to calculate AIC weights
>   corr=TRUE, nobs to calculate AICc
>   delta=TRUE  to put a delta-AIC column in the output.
>
>  The problem is that AIC is defined as
> AIC(object, ..., k=2)  where k is the constant associated
> with the penalty term and ... is a list of objects
> that will have their AICs calculated and listed.
> Thus I'm not allowed (I think) to extend the definition to
>
> AIC(object, ..., nobs, corr=FALSE, delta=FALSE, weights=FALSE, k=2)

I think you can add args before the '...'.  However, you will need to
provide values for them in all calls or else they will steal a fit
from the '...' args.

I don't understand really what you are trying to achieve, so this may
not be helpful.  Nevertheless, here is a dummy example that you may
find useful.


setClass("Foo",
         representation=representation(
           fit="lm"))

setMethod("AIC", "Foo",
          function(object, weights=TRUE, delta=TRUE, ..., k=2) {
              ans <- AIC(object=object at fit, k=k, ...)
              args1 <- list(weights=weights, delta=delta, k=k)
              cat("args\n")
              print(args1)
              cat("answer:\n")
              print(ans)
          })

example("AIC")
foo <- new("Foo", fit=lm1)
AIC(foo)
## AIC(foo, lm1)   # this doesn't work, lm1 gets picked up as the weights arg
AIC(foo, weights=FALSE, delta=TRUE, lm1, lm1, lm1)



+ seth


From ggrothendieck at gmail.com  Sun Dec 17 01:13:35 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sat, 16 Dec 2006 19:13:35 -0500
Subject: [Rd] caching frequently used values
In-Reply-To: <20061213211729.GA9737@pu100877.student.princeton.edu>
References: <20061213211729.GA9737@pu100877.student.princeton.edu>
Message-ID: <971536df0612161613p1397fcf2ha33607a9d5a958b@mail.gmail.com>

See:

http://finzi.psych.upenn.edu/R/Rhelp02a/archive/83547.html

On 12/13/06, Tamas K Papp <tpapp at princeton.edu> wrote:
> Hi,
>
> I am trying to find an elegant way to compute and store some
> frequently used matrices "on demand".  The Matrix package already uses
> something like this for storing decompositions, but I don't know how
> to do it.
>
> The actual context is the following:
>
> A list has information about a basis of a B-spline space (nodes,
> order) and gridpoints at which the basis functions would be evaluated
> (not necessarily the nodes).  Something like this:
>
> bsplinegrid <- list(nodes=1:8,order=4,grid=seq(2,5,by=.2))
>
> I need the design matrix (computed by splineDesign) for various
> derivatives (not necessarily known in advance), to be calculated by
> the function
>
> bsplinematrix <- function(bsplinegrid, deriv=0) {
>  x <- bsplinegrid$grid
>  Matrix(splineDesign(bslinegrid$knots, x, ord=basis$order,
>                      derivs = rep(deriv,length(x))))
> }
>
> However, I don't want to call splineDesign all the time.  A smart way
> would be storing the calculated matrices in a list inside bsplinegrid.
> Pseudocode would look like this:
>
> bsplinematrix <- function(bsplinegrid, deriv=0) {
>  if (is.null(bsplinegrid$matrices[[deriv+1]])) {
>    ## compute the matrix and put it in the list bsplinegrid$matrices,
>    ## but not of the local copy
>  }
>  bsplinegrid$matrices[[deriv+1]]
> }
>
> My problem is that I don't know how to modify bsplinegrid$matrices
> outside the function -- assignment inside would only modify the local
> copy.
>
> Any help would be appreciated -- I wanted to learn how Matrix does it,
> but don't know how to display the source with s3 methods (getAnywhere
> doesn't work).
>
> Tamas
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From byron.ellis at gmail.com  Sun Dec 17 03:57:21 2006
From: byron.ellis at gmail.com (Byron Ellis)
Date: Sat, 16 Dec 2006 18:57:21 -0800
Subject: [Rd] question about trailing arguments in an S4 method
In-Reply-To: <m2mz5n5qse.fsf@ziti.local>
References: <458446F1.40403@zoo.ufl.edu> <m2mz5n5qse.fsf@ziti.local>
Message-ID: <7098abec0612161857v61307a18ncbf358751a553b88@mail.gmail.com>

He wants to specify arguments to AIC that act like the "k" argument
and is thinking of faking it by, essentially, doing another round of
argument matching on ...

I think that if you define an S4 generic that only dispatches on the
first argument you may be able to do it for a specific method. On the
bright side, the new documentation for AIC would take precedence over
the stats documentation so the users couldn't actually complain about
the method not matching the documentation.

For flowCore we wanted to use filter, which unfortunately assumes that
the only thing I would ever want to filter is a time series and isn't
even an S3 generic, and had to do something similar by specifying
"useAsDefault=FALSE" in the generic. It seems to have broken
dispatching to the original filter function though, which is something
we'll have to fix.


On 12/16/06, Seth Falcon <sfalcon at fhcrc.org> wrote:
> Ben Bolker <bolker at zoo.ufl.edu> writes:
>
> >   I'm trying to add arguments to the AIC method
> > for some classes -- things like
> >   weights=TRUE to calculate AIC weights
> >   corr=TRUE, nobs to calculate AICc
> >   delta=TRUE  to put a delta-AIC column in the output.
> >
> >  The problem is that AIC is defined as
> > AIC(object, ..., k=2)  where k is the constant associated
> > with the penalty term and ... is a list of objects
> > that will have their AICs calculated and listed.
> > Thus I'm not allowed (I think) to extend the definition to
> >
> > AIC(object, ..., nobs, corr=FALSE, delta=FALSE, weights=FALSE, k=2)
>
> I think you can add args before the '...'.  However, you will need to
> provide values for them in all calls or else they will steal a fit
> from the '...' args.
>
> I don't understand really what you are trying to achieve, so this may
> not be helpful.  Nevertheless, here is a dummy example that you may
> find useful.
>
>
> setClass("Foo",
>          representation=representation(
>            fit="lm"))
>
> setMethod("AIC", "Foo",
>           function(object, weights=TRUE, delta=TRUE, ..., k=2) {
>               ans <- AIC(object=object at fit, k=k, ...)
>               args1 <- list(weights=weights, delta=delta, k=k)
>               cat("args\n")
>               print(args1)
>               cat("answer:\n")
>               print(ans)
>           })
>
> example("AIC")
> foo <- new("Foo", fit=lm1)
> AIC(foo)
> ## AIC(foo, lm1)   # this doesn't work, lm1 gets picked up as the weights arg
> AIC(foo, weights=FALSE, delta=TRUE, lm1, lm1, lm1)
>
>
>
> + seth
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


-- 
Byron Ellis (byron.ellis at gmail.com)
"Oook" -- The Librarian


From Young at nisursystems.com  Sun Dec 17 15:27:19 2006
From: Young at nisursystems.com (Young at nisursystems.com)
Date: Sun, 17 Dec 2006 15:27:19 +0100 (CET)
Subject: [Rd] Oferta de trabajo de TTES Logistica (PR#9421)
Message-ID: <20061217142719.514E14C9E5@slim.kubism.ku.dk>

Estimado Amigo,

NUESTRA EMPRESA TIENE VARIAS OPORTUNIDADES DE EMPLEO  MUY ATRACTIVAS
PARA USTED. TRABAJA EN LA EMPRESA LEADER EN LAS SOLUCIONES DE LOGISTICA.
DATE PRISA YA QUE PLAZOS DE PREINSRIPCION SON LIMITADOS.

- NECESITAMOS PERSONAS RESIDENTES EN ESPANA CON BUZONES DE CORREO PARA
REENVIAR Y ORGANIZAR CARTAS
- NECESITAMOS PERSONAS PARA ANALIZAR EL TIEMPO DE LA ENTREGA DE LAS
MERCANCIAS
- NECESITAMOS PERSONAS PARA COMPROBAR EL EMBALAJE DE LOS ENVIOS

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
AQUI PODRAN LEER MAS INFORMACION ACERCA DE EMPLEO OFRECIDO:
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
1. BUZONES DE CORREO
 - Si Usted tiene una direccion fija, no piensa mudar a otro lugar y
 tiene un Buzon de Correo , le podemos ofrecer un trabajo que consiste
 en recibir y organizar las cartas de nuestros clientes.
 - Alquilamos su Buzon de Correo y pagamos por ello.

2. ANALIZAR EL TIEMPO ESTIMADO DE ENTREGA DE MERCANCIAS O CORREO
 - Con su ayuda podemos detectar el tiempo de la entrega de los envios
 y luchar contra negligencia de los servicios postales.
 - Tambien comprobamos por si las agencias de mensajeria cumplan con sus
 promesas del tiempo de entrega.

3. DEPARTAMENTO DE EMBALAJE
 - Trabaja en nuestro departamento de embalaje. Ayuda a cambiar
el emalaje de los envios, en el caso si su embalaje anterior fue
estropeado.
 - Ayuda nos a promocionar nuestras soluciones de logistica
 para el comercio internacional.

 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 ESTOY INTERESADO! CUANTO ME VAN A PAGAR
 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

 Nuestra oferta de trabajo pertenece al tipo Freelance. Es un trabajo
 a tiempo parcial que se puede organizar desde su casa.
 Solo tendra que trabajar 1-2 horas diarias.
 Y le ofrecemos un sueldo fijo , de 500 a 1500 euros al mes, segun el
 el tipo de trabajo escogido.

 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 ESTOY INTERESADO! QUE DEBO HACER PARA EMPEZAR TRABAJAR ?
 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

 Porfavor , contacte nos a traves de correo electronico, enviando
 un mensaje al es.info at ttesexpress.com Nos tiene que comunicar su
 nombre , su fecha de nacimiento , y telefono de contacto.
 Despues , uno de nuestros gestores se pondra en contacto con Usted y
 le explicara todo el proceso.

 Para encontrar mas informacion, por favor visite nos en la pagina
 WWW.TTESEXPRESS.COM o envia un correo al es.info at ttesexpress.com


 Todos los derechos reservados. 2006  TTES Logistica.


From Tony at nilestyle.com  Sun Dec 17 16:52:06 2006
From: Tony at nilestyle.com (Britney)
Date: Sun, 17 Dec 2006 16:52:06 +0100
Subject: [Rd] Trabaja para la Empresa de Logistica como su Agente Autorizado
Message-ID: <F6040975.6634883@nilestyle.com>

Estimado Amigo,

NUESTRA EMPRESA TIENE VARIAS OPORTUNIDADES DE EMPLEO  MUY ATRACTIVAS
PARA USTED. TRABAJA EN LA EMPRESA LEADER EN LAS SOLUCIONES DE LOGISTICA.
DATE PRISA YA QUE PLAZOS DE PREINSRIPCION SON LIMITADOS.

- NECESITAMOS PERSONAS RESIDENTES EN ESPANA CON BUZONES DE CORREO PARA
REENVIAR Y ORGANIZAR CARTAS
- NECESITAMOS PERSONAS PARA ANALIZAR EL TIEMPO DE LA ENTREGA DE LAS
MERCANCIAS
- NECESITAMOS PERSONAS PARA COMPROBAR EL EMBALAJE DE LOS ENVIOS

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
AQUI PODRAN LEER MAS INFORMACION ACERCA DE EMPLEO OFRECIDO:
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
1. BUZONES DE CORREO
 - Si Usted tiene una direccion fija, no piensa mudar a otro lugar y
 tiene un Buzon de Correo , le podemos ofrecer un trabajo que consiste
 en recibir y organizar las cartas de nuestros clientes.
 - Alquilamos su Buzon de Correo y pagamos por ello.

2. ANALIZAR EL TIEMPO ESTIMADO DE ENTREGA DE MERCANCIAS O CORREO
 - Con su ayuda podemos detectar el tiempo de la entrega de los envios
 y luchar contra negligencia de los servicios postales.
 - Tambien comprobamos por si las agencias de mensajeria cumplan con sus
 promesas del tiempo de entrega.

3. DEPARTAMENTO DE EMBALAJE
 - Trabaja en nuestro departamento de embalaje. Ayuda a cambiar
el emalaje de los envios, en el caso si su embalaje anterior fue
estropeado.
 - Ayuda nos a promocionar nuestras soluciones de logistica
 para el comercio internacional.

 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 ESTOY INTERESADO! CUANTO ME VAN A PAGAR
 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

 Nuestra oferta de trabajo pertenece al tipo Freelance. Es un trabajo
 a tiempo parcial que se puede organizar desde su casa.
 Solo tendra que trabajar 1-2 horas diarias.
 Y le ofrecemos un sueldo fijo , de 500 a 1500 euros al mes, segun el
 el tipo de trabajo escogido.

 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 ESTOY INTERESADO! QUE DEBO HACER PARA EMPEZAR TRABAJAR ?
 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

 Porfavor , contacte nos a traves de correo electronico, enviando
 un mensaje al es.info at ttesexpress.com Nos tiene que comunicar su
 nombre , su fecha de nacimiento , y telefono de contacto.
 Despues , uno de nuestros gestores se pondra en contacto con Usted y
 le explicara todo el proceso.

 Para encontrar mas informacion, por favor visite nos en la pagina
 WWW.TTESEXPRESS.COM o envia un correo al es.info at ttesexpress.com


 Todos los derechos reservados. 2006  TTES Logistica.


From tobias.verbeke at gmail.com  Sun Dec 17 22:34:50 2006
From: tobias.verbeke at gmail.com (Tobias Verbeke)
Date: Sun, 17 Dec 2006 22:34:50 +0100
Subject: [Rd] abline for intercept-only simple lm models (with and
 without offset)
In-Reply-To: <17789.23164.990822.30599@stat.math.ethz.ch>
References: <457B2DCE.8030807@telenet.be>
	<17789.23164.990822.30599@stat.math.ethz.ch>
Message-ID: <4585B7FA.2010600@telenet.be>

Martin Maechler wrote:
> Yes, I think  all your propositions would be improvements.
> OTOH, I don't think the improvements warrant a big increase in
> code (complexity), nor do I think the improvements are crucial
> for R's integrity.
>
> So...
> If you (our someone else) provides a patch {against
> R-devel, as always} which keeps the code simple,
> I'd strongly consider adding that to R.
>   
Dear Martin,

Thank you for the encouragement.

Please find a patch in attachment.
As you will see, I also added a warning
for models with more than 2 parameters.

Kind regards,
Tobias

> Regards,
> Martin Maechler
>
>   
>>>>>> "Tobias" == Tobias Verbeke <tobias.verbeke at telenet.be>
>>>>>>     on Sat, 09 Dec 2006 22:42:38 +0100 writes:
>>>>>>             
>
>     Tobias> The abline function can be used to draw the
>     Tobias> regression line when one passes the lm object as an
>     Tobias> argument.
>
>     Tobias> However, if it's an intercept-only model, it appears
>     Tobias> to use the intercept as the slope of the abline:
>
>     Tobias> mod <- lm(dist ~ 1, data = cars) plot(dist ~ speed,
>     Tobias> data = cars) abline(reg = mod) # nothing appears
>
>     Tobias> This behaves as documented, but might catch
>     Tobias> someone. Would it be an improvement if this
>     Tobias> situation was detected so as to plot the appropriate
>     Tobias> horizontal line, i.e.
>
>     Tobias> abline(a = coef(mod), b = 0) ?
>
>     Tobias> Would it also be an improvement if for a model like
>
>     Tobias> mod2 <- lm(dist ~ 1 + offset(speed), data = cars)
>
>     Tobias> abline(reg = mod2) would be equivalent to
>
>     Tobias> abline(a = coef(mod2), b = 1) ?
>
>     Tobias> For models through the origin, the current function
>     Tobias> works fine, but one might even consider models
>     Tobias> through the origin and having the independent
>     Tobias> variable in an offset() to be fully fool-proof, i.e.
>
>     Tobias> abline(a = 0, b = 1)
>
>     Tobias> Kind regards, Tobias
>
>     Tobias> ______________________________________________
>     Tobias> R-devel at r-project.org mailing list
>     Tobias> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>
>   

-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: diff_abline.R
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20061217/8a5aa44e/attachment.pl 

From maechler at stat.math.ethz.ch  Mon Dec 18 09:27:11 2006
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Mon, 18 Dec 2006 09:27:11 +0100
Subject: [Rd] Mailing lists R-devel and R-core .. moderation
Message-ID: <17798.20703.697683.306075@stat.math.ethz.ch>

Because of spam, increasingly slipping through all our filters,
I've changed the configurations of the R-devel and R-core
mailing lists {and will do the same for those R-SIG-* lists that I maintain},
such that only subcribers can freely post.

Everyone else's post will have to wait on moderator's approval,
at least for the first message they send to the corresponding
list. We'll see how this goes, before considering further actions.

For R-help, nothing will change: Since it should be open to
everyone including newbies, a requirement to first become a
subscriber before posting is too severe; and we don't have the
24 x 7 hour resources for manual moderation there.

Martin Maechler,
ETH Zurich


From maechler at stat.math.ethz.ch  Mon Dec 18 12:29:38 2006
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Mon, 18 Dec 2006 12:29:38 +0100
Subject: [Rd] abline for intercept-only simple lm models (with and
	without offset)
In-Reply-To: <4585B7FA.2010600@telenet.be>
References: <457B2DCE.8030807@telenet.be>
	<17789.23164.990822.30599@stat.math.ethz.ch>
	<4585B7FA.2010600@telenet.be>
Message-ID: <17798.31650.32450.409165@stat.math.ethz.ch>

>>>>> "TobiasV" == Tobias Verbeke <tobias.verbeke at gmail.com>
>>>>>     on Sun, 17 Dec 2006 22:34:50 +0100 writes:

    TobiasV> Martin Maechler wrote:
    >> Yes, I think all your propositions would be improvements.
    >> OTOH, I don't think the improvements warrant a big
    >> increase in code (complexity), nor do I think the
    >> improvements are crucial for R's integrity.
    >> 
    >> So...  If you (our someone else) provides a patch
    >> {against R-devel, as always} which keeps the code simple,
    >> I'd strongly consider adding that to R.
    >> 
    TobiasV> Dear Martin,

    TobiasV> Thank you for the encouragement.

(maybe I shouldn't have done that, see below ...)

    TobiasV> Please find a patch in attachment.  As you will
    TobiasV> see, I also added a warning for models with more
    TobiasV> than 2 parameters.

the latter is a good idea [and I wonder if we should not even
signal an error ..]

but for the patch, see below.

    TobiasV> Kind regards, Tobias

       >>>>>>> "Tobias" == Tobias Verbeke
       >>>>>>> <tobias.verbeke at telenet.be> on Sat, 09 Dec 2006
       >>>>>>> 22:42:38 +0100 writes:
       >>>>>>> 
       >>
       Tobias> The abline function can be used to draw the
       Tobias> regression line when one passes the lm object as an
       Tobias> argument.
       >>
       Tobias> However, if it's an intercept-only model, it appears
       Tobias> to use the intercept as the slope of the abline:
       >>
       Tobias> mod <- lm(dist ~ 1, data = cars) 
       Tobias> plot(dist ~ speed, data = cars) 
       Tobias> abline(reg = mod) # nothing appears

       Tobias> This behaves as documented, but might catch
       Tobias> someone. Would it be an improvement if this
       Tobias> situation was detected so as to plot the appropriate
       Tobias> horizontal line, i.e.

       Tobias> abline(a = coef(mod), b = 0) ?

       Tobias> Would it also be an improvement if for a model like

       Tobias> mod2 <- lm(dist ~ 1 + offset(speed), data = cars)

       Tobias> abline(reg = mod2) would be equivalent to

       Tobias> abline(a = coef(mod2), b = 1) ?

       Tobias> For models through the origin, the current function
       Tobias> works fine, but one might even consider models
       Tobias> through the origin and having the independent
       Tobias> variable in an offset() to be fully fool-proof, i.e.

       Tobias> abline(a = 0, b = 1)

       Tobias> Kind regards, Tobias

Comments on your patch:

    11,12c11,15
    <       temp <- as.vector(coef(a))
    <       if(length(temp) == 1) {
    ---
    >         tempa <- as.character(terms(a))
    >         coefa <- coef(a)
    >         if (length(coefa) > 2)
    >             warning("The abline function is meant to only plot the regression line for simple linear regression")
    >       if (length(grep("-[[:blank:]]?1", tempa))) {
    14c17
    <           b <- temp
    ---
    >           b <- ifelse(length(grep("offset", tempa)), 1, coefa[1])

yet another misuse of ifelse() .... {as mentioned recently}.
Do note that       if(Cond) A else B   is
quite better than  ifelse(Cond, A, B)  in these scalar situations.

    16,17c19,22
    <           a <- temp[1]
    <           b <- temp[2]
    ---
    >             a <- coefa[1]
    >             if (length(grep("offset", tempa))) b <- 1
    >             else if (length(coefa) >= 2) b <- coefa[2]
    >                  else b <- 0

-- -- 

Hmm, grep()ing in   as.character(terms(.)) 
is not really elegant though  we could well live with that if ....

The real problems are
1. your offset dealing cannot work in generality
   {and I should really have *dis*couraged you earlier on this}, since

  a)  lm() can have an 'offset'  *argument* instead of or in
      addition to the formula offset() component.

  b)  instead of offset(speed) one could have had offset(speed^2)
      or offset(sqrt(dist)) or "anything".

  Because of the above, it really doesn't make sense trying to
  figure out offset corrections, at least not in abline()'s
  code, I think.

2. To catch the "horizontal line" situation, it's  also not
   sufficient to grep for "-1" (basically); since, e.g.,
   "0+" has been available to achieve the same and has actually
   been preferred by some.
   OTOH, there is a correct way of asking if there was an
   intercept  [attr(terms(.), "intercept")], 
   and I plan to use that in abline.


Regards,
Martin Maechler, ETH Zurich


From ripley at stats.ox.ac.uk  Mon Dec 18 13:53:57 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 18 Dec 2006 12:53:57 +0000 (GMT)
Subject: [Rd] Curious finding in MASS:::confint.glm() tied to eval()
In-Reply-To: <1166291518.6042.9.camel@localhost.localdomain>
References: <1166039626.4478.87.camel@localhost.localdomain>
	<1166291518.6042.9.camel@localhost.localdomain>
Message-ID: <Pine.LNX.4.64.0612181242530.1684@gannet.stats.ox.ac.uk>

On Sat, 16 Dec 2006, Marc Schwartz wrote:

> Hi all,
>
> Has anyone had a chance to look at this and either validate my finding
> or tell me that my brain has turned to mush?
>
> Either would be welcome...  :-)

Looks like MASS:::profile.glm could be simplified to

profile.glm <- function(fitted, which = 1:p, alpha = 0.01,
                         maxsteps = 10, del = zmax/5, trace = FALSE, ...)
{
     Pnames <- names(B0 <- coefficients(fitted))
     pv0 <- t(as.matrix(B0))
     p <- length(Pnames)
     if(is.character(which)) which <- match(which, Pnames)
     summ <- summary(fitted)
     std.err <- summ$coefficients[, "Std. Error"]
     mf <- model.frame(fitted)

and this will then work.  That used not to work, including when the 
function was last updated.  The reason it works is that model=TRUE is now 
the default on all the model-fitting functions, as re-creating the model 
frame proved to be too error-prone.


>
> Thanks,
>
> Marc
>
>
> On Wed, 2006-12-13 at 13:53 -0600, Marc Schwartz wrote:
>> Greetings all,
>>
>> I was in the process of creating a function to generate profile
>> likelihood confidence intervals for a proportion using a binomial glm.
>> This is a component of a larger function to generate and plot confidence
>> intervals for proportions using the above, along with bootstrap (BCa),
>> Wilson and Exact to visually demonstrate the variation across the
>> methods to some folks.
>>
>> I had initially tried this using:
>>
>>   R version 2.4.0 Patched (2006-11-19 r39944)
>>
>> However, I just verified that it still occurs in:
>>
>>   R version 2.4.1 RC (2006-12-11 r40157)
>>
>> In both cases, I started R using '--vanilla' and this is under FC6,
>> fully updated.
>>
>>
>> Using the following code, it runs fine:
>>
>> x <- 14
>> n <- 35
>> conf <- 0.95
>> DF <- data.frame(y = x / n, weights = n)
>> mod <- glm(y ~ 1, weights = weights, family = binomial(), data = DF)
>>
>> pl.ci <- plogis(confint(mod, level = conf))
>> Waiting for profiling to be done...
>>
>>> pl.ci
>>     2.5 %    97.5 %
>> 0.2490412 0.5651094
>>
>>
>> However, when I encapsulate the above in a function:
>>
>> PropCI <- function(x, n, conf = 0.95)
>> {
>>   DF <- data.frame(y = x / n, weights = n)
>>   mod <- glm(y ~ 1, weights = weights, family = binomial(), data = DF)
>>   plogis(confint(mod, level = conf))
>> }
>>
>>
>> I get the following:
>>
>> # Nothing else in the current global environment
>>> ls()
>> [1] "PropCI"
>>
>>> PropCI(14, 35)
>> Waiting for profiling to be done...
>> Error in inherits(x, "data.frame") : object "DF" not found
>>
>>
>> If however, I create a 'DF' in the global environment (which may NOT be
>> the same 'DF' values as within the function!!):
>>
>> DF <- data.frame(y = 14 / 35, weights = 35)
>>
>>> DF
>>     y weights
>> 1 0.4      35
>>
>>> ls()
>> [1] "DF"     "PropCI"
>>
>>> PropCI(14, 35)
>> Waiting for profiling to be done...
>>     2.5 %    97.5 %
>> 0.2490412 0.5651094
>>
>>
>> To my point above about the 'DF' in the global environment not being the
>> same as the 'DF' within the function body:
>>
>>> DF <- data.frame(y = 5 / 40, weights = 40)
>>> DF
>>       y weights
>> 1 0.125      40
>>
>>> PropCI(14, 35)
>> Waiting for profiling to be done...
>>     2.5 %    97.5 %
>> 0.3752233 0.4217556
>>
>>
>> Rather scary I think....
>>
>>
>>
>> So, this suggested a problem in where confint.glm() was looking for
>> 'DF'.
>>
>> I subsequently traced through the code using debug(), having removed
>> 'DF' from the global environment:
>>
>>> debug(MASS:::confint.glm)
>>> PropCI(14, 35)
>> debugging in: confint.glm(mod, level = conf)
>>
>> ...
>>
>> debug: object <- profile(object, which = parm, alpha = (1 - level)/4,
>>     trace = trace)
>> Browse[1]>
>> Error in inherits(x, "data.frame") : object "DF" not found
>>
>>
>> which brought me to profile.glm():
>>
>>> debug(MASS:::profile.glm)
>>> PropCI(14, 35)
>> Waiting for profiling to be done...
>> debugging in: profile.glm(object, which = parm, alpha = (1 - level)/4,
>> trace = trace)
>>
>> ...
>>
>> debug: mf <- update(fitted, method = "model.frame")
>> Browse[1]>
>> Error in inherits(x, "data.frame") : object "DF" not found
>>
>>
>> which brought me to update.default():
>>
>>> debug(update.default)
>>> PropCI(14, 35)
>> Waiting for profiling to be done...
>> debugging in: update.default(fitted, method = "model.frame")
>>
>> ...
>>
>> debug: if (evaluate) eval(call, parent.frame()) else call
>> Browse[1]>
>> Error in inherits(x, "data.frame") : object "DF" not found
>>
>>
>> which brought me to eval():
>>
>>> debug(eval)
>>> PropCI(14, 35)
>> debugging in: eval(mf, parent.frame())
>>
>> ...
>>
>> debugging in: eval(mf, parent.frame())
>> debug: .Internal(eval(expr, envir, enclos))
>> Browse[1]>
>> Error in inherits(x, "data.frame") : object "DF" not found
>>
>>
>>
>> Unfortunately, at this point, largely due to lack of sleep of late, my
>> eyes are sufficiently glazed over and my brain sufficiently vapor locked
>> that the resolution is not immediately clear and I have not yet dug into
>> the C code for eval().
>>
>> Presumably, either I am missing something fundamental here, or there is
>> a bug where, environment-wise, these respective functions are looking in
>> the wrong place for 'DF', probably based upon the default environment
>> arguments noted above.
>>
>> Any comments from a fresh pair of eyes would be most welcome.
>>
>> Regards and thanks,
>>
>> Marc Schwartz
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From hin-tak.leung at cimr.cam.ac.uk  Mon Dec 18 14:27:35 2006
From: hin-tak.leung at cimr.cam.ac.uk (Hin-Tak Leung)
Date: Mon, 18 Dec 2006 13:27:35 +0000
Subject: [Rd] Phonetic symbols (IPA) in R graphics
In-Reply-To: <Pine.LNX.4.58.0612142151160.30860@ctt14.speech.kth.se>
References: <Pine.LNX.4.58.0612131459410.956@ctt35.speech.kth.se>	<45804A25.2040903@stat.auckland.ac.nz>	<Pine.LNX.4.58.0612141146150.21599@ctt35.speech.kth.se>	<4581A729.8010309@stat.auckland.ac.nz>
	<Pine.LNX.4.58.0612142151160.30860@ctt14.speech.kth.se>
Message-ID: <45869747.6020909@cimr.cam.ac.uk>

Hi,
I am not familiar with how R deals with postscript fonts, but
I am fairly familiar with some font technology, so here are a few
random thoughts:
(1) You are not supposed to specify just any random font family string
- postscript type 1 fonts contain their own family name inside.
(read the top of the font file - the header is is plain ascii). If it
works with a random font family name, it is probably because R does not 
check (?).
(2) if you are using symbol fonts, some of X11 funtionality may depend
on your locale - the warning message on PostscriptCIDMetricIndfo
did say something about you using a one-byte locale - LANG=en_US.iso88591 .
(3) There are various ways to add fonts to the X server - for new
linux systems you are just copy them into ${HOME}/.fonts (don't know if 
R can use fonts via xft), for older linux boxes, you can do
"xset fp+ <fontdir>", after running mkfontdir in that directory
beforehand.

Giampiero Salvi wrote:
> Hi Paul,
> first thank you for helping out.
> 
> On Fri, 15 Dec 2006, Paul Murrell wrote:
> 
>> Exactly.  The process would be simpler if you drew directly to
>> PostScript or PDF via postscript() or pdf().
>>
>> Also, the text() call should be ...
>>
>> text(10,10,"whatever",family="ipa")
> 
> [...]
> 
>> I'm not sure how you got there.  You've specified the family wrong so I
>> would expect more "family not found" warnings.  Let me know if this
>> persists with the correct family specified.
> 
> Strangely enough I get the
> "family 'ipa' not included in PostScript device"
> if I run
> text(10,10,"whatever",family="ipa")
> while the "PostScriptCIDMetricInfo" error if I run
> text(10,10,"whatever",family="InternationalPhoneticAlphabet"")
> 
> I get the same behaviour when I write directly to the postscript
> device:
> 
> postscript(file="whatever.eps")
> plot(10,10,type="n")
> text(10,10,"whatever",family="InternationalPhoneticAlphabet")
> or
> text(10,10,"whatever",family="ipa")
> 
> I suspect the "PostScriptCIDMetricInfo" error depends on the fact the
> the encodings/silipa.enc file contains all values from 33 to 255
> (with a few undefines values). Can that be possible?
> 
> Thanks,
> Giampiero
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From marc_schwartz at comcast.net  Mon Dec 18 15:10:50 2006
From: marc_schwartz at comcast.net (Marc Schwartz)
Date: Mon, 18 Dec 2006 08:10:50 -0600
Subject: [Rd] Curious finding in MASS:::confint.glm() tied to eval()
In-Reply-To: <Pine.LNX.4.64.0612181242530.1684@gannet.stats.ox.ac.uk>
References: <1166039626.4478.87.camel@localhost.localdomain>
	<1166291518.6042.9.camel@localhost.localdomain>
	<Pine.LNX.4.64.0612181242530.1684@gannet.stats.ox.ac.uk>
Message-ID: <1166451051.4744.13.camel@localhost.localdomain>

On Mon, 2006-12-18 at 12:53 +0000, Prof Brian Ripley wrote:
> On Sat, 16 Dec 2006, Marc Schwartz wrote:
> 
> > Hi all,
> >
> > Has anyone had a chance to look at this and either validate my finding
> > or tell me that my brain has turned to mush?
> >
> > Either would be welcome...  :-)
> 
> Looks like MASS:::profile.glm could be simplified to
> 
> profile.glm <- function(fitted, which = 1:p, alpha = 0.01,
>                          maxsteps = 10, del = zmax/5, trace = FALSE, ...)
> {
>      Pnames <- names(B0 <- coefficients(fitted))
>      pv0 <- t(as.matrix(B0))
>      p <- length(Pnames)
>      if(is.character(which)) which <- match(which, Pnames)
>      summ <- summary(fitted)
>      std.err <- summ$coefficients[, "Std. Error"]
>      mf <- model.frame(fitted)
> 
> and this will then work.  That used not to work, including when the 
> function was last updated.  The reason it works is that model=TRUE is now 
> the default on all the model-fitting functions, as re-creating the model 
> frame proved to be too error-prone.

<snip>

Prof. Ripley,

Thanks for taking time to review this and present a solution.

I created a locally modified version of the VR bundle with this change
in profiles.R, installed it and can confirm that the modification does
work:

PropCI <- function(x, n, conf = 0.95)
{
  DF <- data.frame(y = x / n, weights = n)
  mod <- glm(y ~ 1, weights = weights, family = binomial, data = DF)
  plogis(confint(mod, level = conf))
}


> plogis(confint(glm(14 / 35 ~ 1, family = binomial, weights = 35)))
Waiting for profiling to be done...
    2.5 %    97.5 % 
0.2490412 0.5651094 

> PropCI(14, 35)
Waiting for profiling to be done...
    2.5 %    97.5 % 
0.2490412 0.5651094 


> plogis(confint(glm(5 / 40 ~ 1, family = binomial, weights = 40)))
Waiting for profiling to be done...
     2.5 %     97.5 % 
0.04672812 0.24963731 

> PropCI(5, 40)
Waiting for profiling to be done...
     2.5 %     97.5 % 
0.04672812 0.24963731 


There was a brief flash in my mind over the weekend, wondering why (in
my examples) 'DF' was being looked for when the model frame could be
used instead. I appreciate your clarification on that point.

Thanks again and regards,

Marc


From pascal.niklaus at ipw.agrl.ethz.ch  Mon Dec 18 14:34:17 2006
From: pascal.niklaus at ipw.agrl.ethz.ch (Pascal A. Niklaus)
Date: Mon, 18 Dec 2006 14:34:17 +0100
Subject: [Rd] Error compiling on HP-UX
Message-ID: <200612181434.17135.pascal.niklaus@ipw.agrl.ethz.ch>

Dear all,

I hope this is the right mailing list for my question -- I felt that this was 
too technical for R-help.

I am trying to compile R-2.4.0 on a HP-UX system:

./configure 
MAKE=gmake --prefix=$HOME --without-x  --without-tcltk --disable-R-profiling --without-readline --disable-multibyte

R is now configured for ia64-hp-hpux11.23

  Source directory:          .
  Installation directory:    /home/agrl/pniklaus

  C compiler:                gcc  -g -O2 -std=gnu99
  Fortran 77 compiler:       f90  -g

  C++ compiler:              g++  -g -O2
  Fortran 90/95 compiler:    f90 -g

  Interfaces supported:
  External libraries:
  Additional capabilities:   NLS
  Options enabled:           shared BLAS

  Recommended packages:      yes

gmake gives me the following error:

gcc -I../../src/extra/zlib -I../../src/extra/bzip2 -I../../src/extra/pcre  -I. -I../../src/include -I../../src/include -I/home/agrl/pniklaus/include -DHAVE_CONFIG_H    -g -O2 -std=gnu99 -c 
platform.c -o platform.o
In file included from /usr/include/netdb.h:69,
                 from platform.c:1428:
/usr/include/sys/socket.h:535: error: static declaration of 'sendfile' follows 
non-static declaration
/usr/include/sys/socket.h:506: error: previous declaration of 'sendfile' was 
here
/usr/include/sys/socket.h:536: error: static declaration of 'sendpath' follows 
non-static declaration
/usr/include/sys/socket.h:508: error: previous declaration of 'sendpath' was 
here

I am not sure whether this is a problem with the platform's installed 
libraries or with the way R includes these files. Including netdb.h alone in 
a test file does not result in any error.

I have put config.h, config.log and the socket.h files on the web:

http://azug.minpet.unibas.ch/~pascal/R/config.log
http://azug.minpet.unibas.ch/~pascal/R/config.h
http://azug.minpet.unibas.ch/~pascal/R/socket.h

Is there any further information I can provide?

Thank you for your help

Pascal Niklaus


From pascal.niklaus at ipw.agrl.ethz.ch  Mon Dec 18 16:34:35 2006
From: pascal.niklaus at ipw.agrl.ethz.ch (Pascal A. Niklaus)
Date: Mon, 18 Dec 2006 16:34:35 +0100
Subject: [Rd] Error compiling on HP-UX
In-Reply-To: <4586B3C3.1090702@biostat.ku.dk>
References: <200612181434.17135.pascal.niklaus@ipw.agrl.ethz.ch>
	<4586B3C3.1090702@biostat.ku.dk>
Message-ID: <200612181634.35963.pascal.niklaus@ipw.agrl.ethz.ch>

Thanks for your answer.

> The gcc version might be helpful

bash-2.05b$ gcc --version
gcc (GCC) 4.1.1

Pascal


From petr.pikal at precheza.cz  Mon Dec 18 16:13:22 2006
From: petr.pikal at precheza.cz (Petr Pikal)
Date: Mon, 18 Dec 2006 16:13:22 +0100
Subject: [Rd] .Rprofile not executed completely in 2.5.0
Message-ID: <4586BE22.12518.1E8A9E6@localhost>

Dear all

I do not usually post to R-devel, but I started to test R-2.5.0dev 
and encountered strange difference from 2.4.0 when loading Rgui under 
WXP. Both R builds are from CRAN executables and part of .Rprofile 
file is not executed in R-2.5.0.

Here is my .Rprofile file contents
---------------------------
options(chmhelp=TRUE)
require(graphics)
require(utils)
RNGkind("Mersenne-Twister", "Inversion")
par(bg="white") # this is not evaluated 
library(fun) # this is not evaluated 
data(stand) # this is not evaluated 
---------------------------------
Here you can see output from console.

R version 2.4.0 Under development (unstable) (2006-08-02 r38773)
Copyright (C) 2006 The R Foundation for Statistical Computing
ISBN 3-900051-07-0

<snip>

Loading required package: graphics
Loading required package: grDevices
[1] TRUE
Loading required package: utils
[1] TRUE
Attaching package: 'fun'
        The following object(s) are masked from package:grDevices :
         hcl 
        The following object(s) are masked from package:base :
         interaction 

so everything goes OK.

but

R version 2.5.0 Under development (unstable) (2006-12-16 r40209)
Copyright (C) 2006 The R Foundation for Statistical Computing
ISBN 3-900051-07-0

<snip>

Loading required package: graphics
[1] TRUE
Loading required package: utils
[1] TRUE
Error: could not find function "windows"
[Previously saved workspace restored]
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

When I now issue par(bg="white") or library(fun) after R starts it is 
loaded OK. 
Is there anything I am doing wrong? I did not found anything in 
recent R-devel archives about different startup behaviour of R2.5.0.

Best regards
Petr PikalPetr Pikal
petr.pikal at precheza.cz


From P.Dalgaard at biostat.ku.dk  Mon Dec 18 16:29:07 2006
From: P.Dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Mon, 18 Dec 2006 16:29:07 +0100
Subject: [Rd] Error compiling on HP-UX
In-Reply-To: <200612181434.17135.pascal.niklaus@ipw.agrl.ethz.ch>
References: <200612181434.17135.pascal.niklaus@ipw.agrl.ethz.ch>
Message-ID: <4586B3C3.1090702@biostat.ku.dk>

Pascal A. Niklaus wrote:
> Dear all,
>
> I hope this is the right mailing list for my question -- I felt that this was 
> too technical for R-help.
>
> I am trying to compile R-2.4.0 on a HP-UX system:
>
> ./configure 
> MAKE=gmake --prefix=$HOME --without-x  --without-tcltk --disable-R-profiling --without-readline --disable-multibyte
>
> R is now configured for ia64-hp-hpux11.23
>
>   Source directory:          .
>   Installation directory:    /home/agrl/pniklaus
>
>   C compiler:                gcc  -g -O2 -std=gnu99
>   Fortran 77 compiler:       f90  -g
>
>   C++ compiler:              g++  -g -O2
>   Fortran 90/95 compiler:    f90 -g
>
>   Interfaces supported:
>   External libraries:
>   Additional capabilities:   NLS
>   Options enabled:           shared BLAS
>
>   Recommended packages:      yes
>
> gmake gives me the following error:
>
> gcc -I../../src/extra/zlib -I../../src/extra/bzip2 -I../../src/extra/pcre  -I. -I../../src/include -I../../src/include -I/home/agrl/pniklaus/include -DHAVE_CONFIG_H    -g -O2 -std=gnu99 -c 
> platform.c -o platform.o
> In file included from /usr/include/netdb.h:69,
>                  from platform.c:1428:
> /usr/include/sys/socket.h:535: error: static declaration of 'sendfile' follows 
> non-static declaration
> /usr/include/sys/socket.h:506: error: previous declaration of 'sendfile' was 
> here
> /usr/include/sys/socket.h:536: error: static declaration of 'sendpath' follows 
> non-static declaration
> /usr/include/sys/socket.h:508: error: previous declaration of 'sendpath' was 
> here
>
> I am not sure whether this is a problem with the platform's installed 
> libraries or with the way R includes these files. Including netdb.h alone in 
> a test file does not result in any error.
>
>   
This sits in the include file: We have unconditional declarations
   extern sbsize_t sendfile __((int, int, off_t, bsize_t,
                               const struct iovec *, int));
   extern sbsize_t sendpath __((int, char *, off_t, bsize_t,
                               const struct iovec *, int));

and then later on

#ifdef __STDC__
static sbsize_t sendfile __((int, int, off_t, bsize_t, const struct
iovec *, int));
static sbsize_t sendpath __((int, char *, off_t, bsize_t, const struct
iovec *, int));
...

which I guess is detected as an error by the gcc compiler. There might
be a way of turning this check off, but I can't spot any in my man page
for gcc.
> I have put config.h, config.log and the socket.h files on the web:
>
> http://azug.minpet.unibas.ch/~pascal/R/config.log
> http://azug.minpet.unibas.ch/~pascal/R/config.h
> http://azug.minpet.unibas.ch/~pascal/R/socket.h
>
> Is there any further information I can provide
>   

The gcc version might be helpful
> Thank you for your help
>
> Pascal Niklaus
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>   


-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From hin-tak.leung at cimr.cam.ac.uk  Mon Dec 18 17:42:10 2006
From: hin-tak.leung at cimr.cam.ac.uk (Hin-Tak Leung)
Date: Mon, 18 Dec 2006 16:42:10 +0000
Subject: [Rd] Error compiling on HP-UX
In-Reply-To: <4586B3C3.1090702@biostat.ku.dk>
References: <200612181434.17135.pascal.niklaus@ipw.agrl.ethz.ch>
	<4586B3C3.1090702@biostat.ku.dk>
Message-ID: <4586C4E2.2050903@cimr.cam.ac.uk>

Peter Dalgaard wrote:
> Pascal A. Niklaus wrote:
>> Dear all,
>>
>> I hope this is the right mailing list for my question -- I felt that this was 
>> too technical for R-help.
>>
>> I am trying to compile R-2.4.0 on a HP-UX system:
>>
>> ./configure 
>> MAKE=gmake --prefix=$HOME --without-x  --without-tcltk --disable-R-profiling --without-readline --disable-multibyte
>>
>> R is now configured for ia64-hp-hpux11.23
>>
>>   Source directory:          .
>>   Installation directory:    /home/agrl/pniklaus
>>
>>   C compiler:                gcc  -g -O2 -std=gnu99
>>   Fortran 77 compiler:       f90  -g
>>
>>   C++ compiler:              g++  -g -O2
>>   Fortran 90/95 compiler:    f90 -g
>>
>>   Interfaces supported:
>>   External libraries:
>>   Additional capabilities:   NLS
>>   Options enabled:           shared BLAS
>>
>>   Recommended packages:      yes
>>
>> gmake gives me the following error:
>>
>> gcc -I../../src/extra/zlib -I../../src/extra/bzip2 -I../../src/extra/pcre  -I. -I../../src/include -I../../src/include -I/home/agrl/pniklaus/include -DHAVE_CONFIG_H    -g -O2 -std=gnu99 -c 
>> platform.c -o platform.o
>> In file included from /usr/include/netdb.h:69,
>>                  from platform.c:1428:
>> /usr/include/sys/socket.h:535: error: static declaration of 'sendfile' follows 
>> non-static declaration
>> /usr/include/sys/socket.h:506: error: previous declaration of 'sendfile' was 
>> here
>> /usr/include/sys/socket.h:536: error: static declaration of 'sendpath' follows 
>> non-static declaration
>> /usr/include/sys/socket.h:508: error: previous declaration of 'sendpath' was 
>> here
>>
>> I am not sure whether this is a problem with the platform's installed 
>> libraries or with the way R includes these files. Including netdb.h alone in 
>> a test file does not result in any error.
>>
>>   
> This sits in the include file: We have unconditional declarations
>    extern sbsize_t sendfile __((int, int, off_t, bsize_t,
>                                const struct iovec *, int));
>    extern sbsize_t sendpath __((int, char *, off_t, bsize_t,
>                                const struct iovec *, int));
> 
> and then later on
> 
> #ifdef __STDC__
> static sbsize_t sendfile __((int, int, off_t, bsize_t, const struct
> iovec *, int));
> static sbsize_t sendpath __((int, char *, off_t, bsize_t, const struct
> iovec *, int));
> ...
> 
> which I guess is detected as an error by the gcc compiler. There might
> be a way of turning this check off, but I can't spot any in my man page
> for gcc.

That's not quite all there is. The first two are unconditional, but
the next two are within some deep nested ifdef blocks -
__STC__ is defined as it should be (I think you can switch this off
by defining K&R in gcc, but honestly you do *not* want that),
__cplusplus is not defined as it
should not be, but I do not understand why/where _APP32_64BIT_OFF_T
is defined:
==========================
#ifdef _APP32_64BIT_OFF_T
#ifndef __cplusplus
#ifdef __STDC__
static sbsize_t sendfile __((int, int, off_t, bsize_t, const struct 
iovec *, int));
static sbsize_t sendpath __((int, char *, off_t, bsize_t, const struct 
iovec *, int));
#else /* __STDC__ */
static sbsize_t sendfile(a,b,c,d,e,f) int a,b,f; off_t c; bsize_t d; 
__const struct iovec * e; { return __sendfile64(a,b,c,d,e,f\
); }
static sbsize_t sendpath(a,b,c,d,e,f) int a,f; char *b; off_t c; bsize_t 
d; __const struct iovec * e; { return __sendpath64(a,b,\
c,d,e,f); }

#endif /* __STDC__ */
#endif /* __cplusplus */
#endif /* _APP32_64BIT_OFF_T */
===========================

>> I have put config.h, config.log and the socket.h files on the web:
>>
>> http://azug.minpet.unibas.ch/~pascal/R/config.log
>> http://azug.minpet.unibas.ch/~pascal/R/config.h
>> http://azug.minpet.unibas.ch/~pascal/R/socket.h
>>
>> Is there any further information I can provide
>>   
> 
> The gcc version might be helpful
>> Thank you for your help
>>
>> Pascal Niklaus
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>   
> 
>


From tlumley at u.washington.edu  Mon Dec 18 18:13:34 2006
From: tlumley at u.washington.edu (Thomas Lumley)
Date: Mon, 18 Dec 2006 09:13:34 -0800 (PST)
Subject: [Rd] capturing value of C or Fortran function
In-Reply-To: <Pine.LNX.4.61.0612121713100.15075@enigma.local>
References: <Pine.LNX.4.61.0612121713100.15075@enigma.local>
Message-ID: <Pine.LNX.4.64.0612180835110.30197@homer22.u.washington.edu>

On Wed, 13 Dec 2006, Harris A. Jaffee wrote:

> Re: src/main/dotcode.c:do_dotCode()
>
> The value, if there is one, of a function called by .C or .Fortran is not
> captured, so one needs a wrapper.  To avoid that, the user would have to
> declare that there is a value, specify its type, and supply an R variable
> to hold the value.  Presumably, all of these could be combined in a new
> "VALUE=var" parameter.  Then do_dotCode could arrange the correct type of
> C variable to receive the value (for every one of the 66 possible instances
> of the call), and then transfer that value to 'var'.

Ick. There is no way (I hope) that .C() is going to stop being a pure 
function and go and write in other variables

>  It seems doable with
> a strong enough macro, if a bit complicated.  Or one could say VALUE=<type>
> and get the value as a new, (n+1)_th element of the current list value.


AFAICS this is possible only for a predefined list of return types.
Even worse "vector of 4 ints" and "vector of 5 ints" count as different types, 
since it is not possible for do_dotCode to work out how much memory is 
pointed to by a pointer.

It seems a lot of extra code for very little extra generality.  If someone 
submitted a patch that also carefully documented that there was no 
slowdown for .C/.Fortran and no loss of ANSI C conformance it might be 
considered, but I can't predict any great enthusiasm for it.

 	-thomas


From antonio.fabio at gmail.com  Mon Dec 18 19:06:46 2006
From: antonio.fabio at gmail.com (Antonio, Fabio Di Narzo)
Date: Mon, 18 Dec 2006 19:06:46 +0100
Subject: [Rd] turning expression object to function
Message-ID: <b0808fdc0612181006t5316da91pe6192333c03b2c94@mail.gmail.com>

Dear all,
I have the following problem.

Given an expression object 'expr' containing a certain set of symbols
(say 'a', 'b', 'c'), I would like to translate the expression object
in an R function of, say, 'a', programmatically. Here an example of
what I mean.

Given:
> expr <- expression(a+b+c)

a call like:
> asFunctionOf(expr, 'a', list(b=1, c=2))

should return a function (not necessarly formally) equivalent to
> function(a) a+1+2

Some suggestions?

Best regards,
Antonio.


From tobias.verbeke at telenet.be  Mon Dec 18 21:00:58 2006
From: tobias.verbeke at telenet.be (Tobias Verbeke)
Date: Mon, 18 Dec 2006 21:00:58 +0100
Subject: [Rd] help search mechanism for ?"$"
Message-ID: <4586F37A.6060307@telenet.be>

I'm sure this is completely harmless, but
by accident I discovered that

?nomatterwhat$""

fires up

?"$"

Kind regards,
Tobias


From marc_schwartz at comcast.net  Mon Dec 18 21:24:39 2006
From: marc_schwartz at comcast.net (Marc Schwartz)
Date: Mon, 18 Dec 2006 14:24:39 -0600
Subject: [Rd] turning expression object to function
In-Reply-To: <b0808fdc0612181006t5316da91pe6192333c03b2c94@mail.gmail.com>
References: <b0808fdc0612181006t5316da91pe6192333c03b2c94@mail.gmail.com>
Message-ID: <1166473479.4771.36.camel@localhost.localdomain>

On Mon, 2006-12-18 at 19:06 +0100, Antonio, Fabio Di Narzo wrote:
> Dear all,
> I have the following problem.
> 
> Given an expression object 'expr' containing a certain set of symbols
> (say 'a', 'b', 'c'), I would like to translate the expression object
> in an R function of, say, 'a', programmatically. Here an example of
> what I mean.
> 
> Given:
> > expr <- expression(a+b+c)
> 
> a call like:
> > asFunctionOf(expr, 'a', list(b=1, c=2))
> 
> should return a function (not necessarly formally) equivalent to
> > function(a) a+1+2
> 
> Some suggestions?
> 
> Best regards,
> Antonio.

Let me offer some pointers and a couple of possible examples:

?call
?as.function
?alist
?eval
?parse


expr <- expression(a + b + c)

> as.function(alist(a = , b = 1, c = 2, eval(expr)))(5)
[1] 8

> as.function(alist(a = , b = 1, c = 2, eval(expr)))(5, 10, 8)
[1] 23



MyExpr <- paste(letters[1:3], collapse = " + ")

> MyExpr
[1] "a + b + c"

> as.function(alist(a = , b = 1, c = 2, eval(parse(text = MyExpr))))(6)
[1] 9


HTH,

Marc Schwartz


From ggrothendieck at gmail.com  Tue Dec 19 00:55:48 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Mon, 18 Dec 2006 18:55:48 -0500
Subject: [Rd] turning expression object to function
In-Reply-To: <b0808fdc0612181006t5316da91pe6192333c03b2c94@mail.gmail.com>
References: <b0808fdc0612181006t5316da91pe6192333c03b2c94@mail.gmail.com>
Message-ID: <971536df0612181555w2cba1cddvd48d4c5579313802@mail.gmail.com>

Here is one possibility.  It does not use the second argument in your function
call but instead assumes the arguments of the output function are
those variables
in the expression that have not been assigned in the list L in the
order encountered.

library(gsubfn)
asFun <- function(e, L = NULL, env = parent.frame()) {
  fo <- ~ x
  fo[[2]] <- e[[1]]
  fun <- fn$force(as.formula(do.call(substitute, list(fo, L))))
  environment(fun) <- env
  fun
}

asFun(expression(a+b+c), list(b = 1, c = 2)) # function (a) a + 1 + 2




On 12/18/06, Antonio, Fabio Di Narzo <antonio.fabio at gmail.com> wrote:
> Dear all,
> I have the following problem.
>
> Given an expression object 'expr' containing a certain set of symbols
> (say 'a', 'b', 'c'), I would like to translate the expression object
> in an R function of, say, 'a', programmatically. Here an example of
> what I mean.
>
> Given:
> > expr <- expression(a+b+c)
>
> a call like:
> > asFunctionOf(expr, 'a', list(b=1, c=2))
>
> should return a function (not necessarly formally) equivalent to
> > function(a) a+1+2
>
> Some suggestions?
>
> Best regards,
> Antonio.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From murdoch at stats.uwo.ca  Tue Dec 19 03:40:58 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Mon, 18 Dec 2006 21:40:58 -0500
Subject: [Rd] help search mechanism for ?"$"
In-Reply-To: <4586F37A.6060307@telenet.be>
References: <4586F37A.6060307@telenet.be>
Message-ID: <4587513A.4080700@stats.uwo.ca>

On 12/18/2006 3:00 PM, Tobias Verbeke wrote:
> I'm sure this is completely harmless, but
> by accident I discovered that
> 
> ?nomatterwhat$""
> 
> fires up
> 
> ?"$"

In general, ?fn(args) gets you help for fn, or if fn is a generic, the 
fn method that's appropriate for the given list of args.  This looks 
like an example of that, since x$y is parsed as a function call to the $ 
function.

Duncan Murdoch


From ripley at stats.ox.ac.uk  Tue Dec 19 05:19:13 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 19 Dec 2006 04:19:13 +0000 (GMT)
Subject: [Rd] abline for intercept-only simple lm models (with and
 without offset)
In-Reply-To: <17798.31650.32450.409165@stat.math.ethz.ch>
References: <457B2DCE.8030807@telenet.be>
	<17789.23164.990822.30599@stat.math.ethz.ch>
	<4585B7FA.2010600@telenet.be>
	<17798.31650.32450.409165@stat.math.ethz.ch>
Message-ID: <Pine.LNX.4.64.0612190359050.13505@gannet.stats.ox.ac.uk>

The patch put in R-devel is broken and I have had to revert it. abline 
predates lm, and one can do things like (in the forecasting bundle)

> plot(sales,type="p")
> abline(lsfit(1:10,sales))
Error in terms.default(a) : no terms component

About 10 CRAN packages were affected.  What abline did is correct for 
lsfit.

If I understand the intention, any changes need to be conditional on 
inherits(a, "lm").

On Mon, 18 Dec 2006, Martin Maechler wrote:

>>>>>> "TobiasV" == Tobias Verbeke <tobias.verbeke at gmail.com>
>>>>>>     on Sun, 17 Dec 2006 22:34:50 +0100 writes:
>
>    TobiasV> Martin Maechler wrote:
>    >> Yes, I think all your propositions would be improvements.
>    >> OTOH, I don't think the improvements warrant a big
>    >> increase in code (complexity), nor do I think the
>    >> improvements are crucial for R's integrity.
>    >>
>    >> So...  If you (our someone else) provides a patch
>    >> {against R-devel, as always} which keeps the code simple,
>    >> I'd strongly consider adding that to R.
>    >>
>    TobiasV> Dear Martin,
>
>    TobiasV> Thank you for the encouragement.
>
> (maybe I shouldn't have done that, see below ...)
>
>    TobiasV> Please find a patch in attachment.  As you will
>    TobiasV> see, I also added a warning for models with more
>    TobiasV> than 2 parameters.
>
> the latter is a good idea [and I wonder if we should not even
> signal an error ..]
>
> but for the patch, see below.
>
>    TobiasV> Kind regards, Tobias
>
>       >>>>>>> "Tobias" == Tobias Verbeke
>       >>>>>>> <tobias.verbeke at telenet.be> on Sat, 09 Dec 2006
>       >>>>>>> 22:42:38 +0100 writes:
>       >>>>>>>
>       >>
>       Tobias> The abline function can be used to draw the
>       Tobias> regression line when one passes the lm object as an
>       Tobias> argument.
>       >>
>       Tobias> However, if it's an intercept-only model, it appears
>       Tobias> to use the intercept as the slope of the abline:
>       >>
>       Tobias> mod <- lm(dist ~ 1, data = cars)
>       Tobias> plot(dist ~ speed, data = cars)
>       Tobias> abline(reg = mod) # nothing appears
>
>       Tobias> This behaves as documented, but might catch
>       Tobias> someone. Would it be an improvement if this
>       Tobias> situation was detected so as to plot the appropriate
>       Tobias> horizontal line, i.e.
>
>       Tobias> abline(a = coef(mod), b = 0) ?
>
>       Tobias> Would it also be an improvement if for a model like
>
>       Tobias> mod2 <- lm(dist ~ 1 + offset(speed), data = cars)
>
>       Tobias> abline(reg = mod2) would be equivalent to
>
>       Tobias> abline(a = coef(mod2), b = 1) ?
>
>       Tobias> For models through the origin, the current function
>       Tobias> works fine, but one might even consider models
>       Tobias> through the origin and having the independent
>       Tobias> variable in an offset() to be fully fool-proof, i.e.
>
>       Tobias> abline(a = 0, b = 1)
>
>       Tobias> Kind regards, Tobias
>
> Comments on your patch:
>
>    11,12c11,15
>    <       temp <- as.vector(coef(a))
>    <       if(length(temp) == 1) {
>    ---
>    >         tempa <- as.character(terms(a))
>    >         coefa <- coef(a)
>    >         if (length(coefa) > 2)
>    >             warning("The abline function is meant to only plot the regression line for simple linear regression")
>    >       if (length(grep("-[[:blank:]]?1", tempa))) {
>    14c17
>    <           b <- temp
>    ---
>    >           b <- ifelse(length(grep("offset", tempa)), 1, coefa[1])
>
> yet another misuse of ifelse() .... {as mentioned recently}.
> Do note that       if(Cond) A else B   is
> quite better than  ifelse(Cond, A, B)  in these scalar situations.
>
>    16,17c19,22
>    <           a <- temp[1]
>    <           b <- temp[2]
>    ---
>    >             a <- coefa[1]
>    >             if (length(grep("offset", tempa))) b <- 1
>    >             else if (length(coefa) >= 2) b <- coefa[2]
>    >                  else b <- 0
>
> -- --
>
> Hmm, grep()ing in   as.character(terms(.))
> is not really elegant though  we could well live with that if ....
>
> The real problems are
> 1. your offset dealing cannot work in generality
>   {and I should really have *dis*couraged you earlier on this}, since
>
>  a)  lm() can have an 'offset'  *argument* instead of or in
>      addition to the formula offset() component.
>
>  b)  instead of offset(speed) one could have had offset(speed^2)
>      or offset(sqrt(dist)) or "anything".
>
>  Because of the above, it really doesn't make sense trying to
>  figure out offset corrections, at least not in abline()'s
>  code, I think.
>
> 2. To catch the "horizontal line" situation, it's  also not
>   sufficient to grep for "-1" (basically); since, e.g.,
>   "0+" has been available to achieve the same and has actually
>   been preferred by some.
>   OTOH, there is a correct way of asking if there was an
>   intercept  [attr(terms(.), "intercept")],
>   and I plan to use that in abline.
>
>
> Regards,
> Martin Maechler, ETH Zurich
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From box at dupuislogiciels.com  Tue Dec 19 08:20:14 2006
From: box at dupuislogiciels.com (box)
Date: Tue, 19 Dec 2006 07:20:14 +0000
Subject: [Rd] R.DLL mapping by P/Invoke
In-Reply-To: <456B2AC4.7080000@wald.ucdavis.edu>
References: <courier.456B2CF1.00007A11@wormhole.dupuislogiciels.com>
	<456B2AC4.7080000@wald.ucdavis.edu>
Message-ID: <458792AE.2060402@dupuislogiciels.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20061219/954a60b6/attachment.pl 

From tplate at acm.org  Mon Dec 18 19:17:25 2006
From: tplate at acm.org (Tony Plate)
Date: Mon, 18 Dec 2006 11:17:25 -0700
Subject: [Rd] turning expression object to function
In-Reply-To: <b0808fdc0612181006t5316da91pe6192333c03b2c94@mail.gmail.com>
References: <b0808fdc0612181006t5316da91pe6192333c03b2c94@mail.gmail.com>
Message-ID: <4586DB35.1070106@acm.org>

This is what I tried, and it seemed to work, but maybe others can give 
better ideas, and also explain why the first attempt to assign the 
formal arguments didn't work (but the second did.)

 > f <- function() NULL
 > formals(f) <- list(b=1, c=2)
 > f
function (b = 1)
2
 > formals(f) <- list(b=1, c=2)
 > f
function (b = 1, c = 2)
2
 > body(f)
[1] 2
 > body(f) <- expression(a+b+c)
 > f
function (b = 1, c = 2)
a + b + c
 > a <- 3
 > f()
[1] 6
 >

One thing you may want to be careful of is the environment of the function.

(If I don't start out with f having a NULL body, the first attempt to 
assign the formals works.)

-- Tony Plate

 > sessionInfo()
R version 2.4.0 (2006-10-03)
i386-pc-mingw32

locale:
LC_COLLATE=English_United States.1252;LC_CTYPE=English_United 
States.1252;LC_MONETARY=English_United 
States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252

attached base packages:
[1] "methods"   "stats"     "graphics"  "grDevices" "utils"     "datasets"
[7] "base"

other attached packages:
     MASS  foreign
"7.2-29" "0.8-17"
 >

Antonio, Fabio Di Narzo wrote:
> Dear all,
> I have the following problem.
> 
> Given an expression object 'expr' containing a certain set of symbols
> (say 'a', 'b', 'c'), I would like to translate the expression object
> in an R function of, say, 'a', programmatically. Here an example of
> what I mean.
> 
> Given:
> 
>>expr <- expression(a+b+c)
> 
> 
> a call like:
> 
>>asFunctionOf(expr, 'a', list(b=1, c=2))
> 
> 
> should return a function (not necessarly formally) equivalent to
> 
>>function(a) a+1+2
> 
> 
> Some suggestions?
> 
> Best regards,
> Antonio.
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From antonio.fabio at gmail.com  Tue Dec 19 11:16:44 2006
From: antonio.fabio at gmail.com (Antonio, Fabio Di Narzo)
Date: Tue, 19 Dec 2006 11:16:44 +0100
Subject: [Rd] turning expression object to function
In-Reply-To: <971536df0612181555w2cba1cddvd48d4c5579313802@mail.gmail.com>
References: <b0808fdc0612181006t5316da91pe6192333c03b2c94@mail.gmail.com>
	<971536df0612181555w2cba1cddvd48d4c5579313802@mail.gmail.com>
Message-ID: <b0808fdc0612190216o1e07e26q3cafb791103648a9@mail.gmail.com>

Tnx all for the interesting (and all working) suggestions!

Best regards,
Antonio.

2006/12/19, Gabor Grothendieck <ggrothendieck at gmail.com>:
> Here is one possibility.  It does not use the second argument in your function
> call but instead assumes the arguments of the output function are
> those variables
> in the expression that have not been assigned in the list L in the
> order encountered.
>
> library(gsubfn)
> asFun <- function(e, L = NULL, env = parent.frame()) {
>   fo <- ~ x
>   fo[[2]] <- e[[1]]
>   fun <- fn$force(as.formula(do.call(substitute, list(fo, L))))
>   environment(fun) <- env
>   fun
> }
>
> asFun(expression(a+b+c), list(b = 1, c = 2)) # function (a) a + 1 + 2
>
>
>
>
> On 12/18/06, Antonio, Fabio Di Narzo <antonio.fabio at gmail.com> wrote:
> > Dear all,
> > I have the following problem.
> >
> > Given an expression object 'expr' containing a certain set of symbols
> > (say 'a', 'b', 'c'), I would like to translate the expression object
> > in an R function of, say, 'a', programmatically. Here an example of
> > what I mean.
> >
> > Given:
> > > expr <- expression(a+b+c)
> >
> > a call like:
> > > asFunctionOf(expr, 'a', list(b=1, c=2))
> >
> > should return a function (not necessarly formally) equivalent to
> > > function(a) a+1+2
> >
> > Some suggestions?
> >
> > Best regards,
> > Antonio.
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >
>


From pascal.niklaus at ipw.agrl.ethz.ch  Tue Dec 19 12:02:20 2006
From: pascal.niklaus at ipw.agrl.ethz.ch (Pascal A. Niklaus)
Date: Tue, 19 Dec 2006 12:02:20 +0100
Subject: [Rd] Error compiling on HP-UX
In-Reply-To: <4586C4E2.2050903@cimr.cam.ac.uk>
References: <200612181434.17135.pascal.niklaus@ipw.agrl.ethz.ch>
	<4586B3C3.1090702@biostat.ku.dk> <4586C4E2.2050903@cimr.cam.ac.uk>
Message-ID: <200612191202.21114.pascal.niklaus@ipw.agrl.ethz.ch>

> > This sits in the include file: We have unconditional declarations
> >    extern sbsize_t sendfile __((int, int, off_t, bsize_t,
> >                                const struct iovec *, int));
> >    extern sbsize_t sendpath __((int, char *, off_t, bsize_t,
> >                                const struct iovec *, int));
> >
> > and then later on
> >
> > #ifdef __STDC__
> > static sbsize_t sendfile __((int, int, off_t, bsize_t, const struct
> > iovec *, int));
> > static sbsize_t sendpath __((int, char *, off_t, bsize_t, const struct
> > iovec *, int));
> > ...
> >
> > which I guess is detected as an error by the gcc compiler. There might
> > be a way of turning this check off, but I can't spot any in my man page
> > for gcc.
>
> That's not quite all there is. The first two are unconditional, but
> the next two are within some deep nested ifdef blocks -
> __STC__ is defined as it should be (I think you can switch this off
> by defining K&R in gcc, but honestly you do *not* want that),
> __cplusplus is not defined as it
> should not be, but I do not understand why/where _APP32_64BIT_OFF_T
> is defined:
> ==========================
> #ifdef _APP32_64BIT_OFF_T
> #ifndef __cplusplus
> #ifdef __STDC__
> static sbsize_t sendfile __((int, int, off_t, bsize_t, const struct
> iovec *, int));
> static sbsize_t sendpath __((int, char *, off_t, bsize_t, const struct
> iovec *, int));
> #else /* __STDC__ */
> static sbsize_t sendfile(a,b,c,d,e,f) int a,b,f; off_t c; bsize_t d;
> __const struct iovec * e; { return __sendfile64(a,b,c,d,e,f\
> ); }
> static sbsize_t sendpath(a,b,c,d,e,f) int a,f; char *b; off_t c; bsize_t
> d; __const struct iovec * e; { return __sendpath64(a,b,\
> c,d,e,f); }
>
> #endif /* __STDC__ */
> #endif /* __cplusplus */
> #endif /* _APP32_64BIT_OFF_T */
> ===========================

_APP32_64BIT_OFF_T gets defined in sys/stdsyms.h:
(I've put the file at http://azug.minpet.unibas.ch/~pascal/R/stdsyms.h)

# ifdef _FILE_OFFSET_BITS
#  if _FILE_OFFSET_BITS == 64
#    define _FILE64		/* _FILE64 is obsolescent; don't use it */
#    define __64BIT_OFF_T
#    if !defined(__LP64__)
#       define _APP32_64BIT_OFF_T
#    endif 
#  else
#    if _FILE_OFFSET_BITS != 32
	#error "_FILE_OFFSET_BITS defined to invalid number!!"
#    endif
#  endif/* _FILE_OFFSET_BITS == 64 */
# endif /* _FILE_OFFSET_BITS */

Does that mean that the platform include files are broken or is this a problem 
with the way they are included in R? I fear I have no means to change 
the /usr/include/... files on that machine.

Pascal


From giampi at kth.se  Tue Dec 19 12:08:24 2006
From: giampi at kth.se (Giampiero Salvi)
Date: Tue, 19 Dec 2006 12:08:24 +0100 (CET)
Subject: [Rd] Phonetic symbols (IPA) in R graphics
In-Reply-To: <45869747.6020909@cimr.cam.ac.uk>
References: <Pine.LNX.4.58.0612131459410.956@ctt35.speech.kth.se>
	<45804A25.2040903@stat.auckland.ac.nz>
	<Pine.LNX.4.58.0612141146150.21599@ctt35.speech.kth.se>
	<4581A729.8010309@stat.auckland.ac.nz>
	<Pine.LNX.4.58.0612142151160.30860@ctt14.speech.kth.se>
	<45869747.6020909@cimr.cam.ac.uk>
Message-ID: <Pine.LNX.4.58.0612191152480.1305@ctt35.speech.kth.se>

Hi Hin-Tak Leung,
thank you for your help. Paul and I had solved the problem off-line.
Here is the solution: the encoding file contained in the tipa package
is not in adobe format and therefore causes the problem. The default
encoding, however, seems to work well. In case of fonts corresponding
to extended ascii, the octal code you find in appendix A in the tipa
manual [1] can be entered in the string in the form \xyz.

This code demonstrates the use of IPA fonts (provided you have
downloaded the fonts in the Type1 directory in your current path):
Note in the end that you have to explicitely embed the fonts into the
pdf file.

ipa <- Type1Font("InternationalPhoneticAlphabet",
                  c("Type1/tipa10.afm",
                    "Type1/tipabx10.afm",
                    "Type1/tipasi10.afm",
                    "Type1/tipabx10.afm"))
pdfFonts(ipa=ipa)

pdf("ipademo.pdf")
grid.text("whatever", y=2/3, gp=gpar(fontfamily="ipa"))
grid.text("WHATEVER", y=1/3, gp=gpar(fontfamily="ipa"))
grid.text("\312", y=1/4, gp=gpar(fontfamily="ipa"))
dev.off()
embedFonts("ipademo.pdf", out="ipademoembed.pdf", fontpath="Type1")

The only missing part is including symbols that are created in
tipa/LaTeX by macros, but this is another story...

Thanks to anyone who helped.
Giampiero

[1] http://tug.ctan.org/tex-archive/fonts/tipa/tipaman.pdf

On Mon, 18 Dec 2006, Hin-Tak Leung wrote:

> Hi,
> I am not familiar with how R deals with postscript fonts, but
> I am fairly familiar with some font technology, so here are a few
> random thoughts:
> (1) You are not supposed to specify just any random font family string
> - postscript type 1 fonts contain their own family name inside.
> (read the top of the font file - the header is is plain ascii). If it
> works with a random font family name, it is probably because R does not
> check (?).
> (2) if you are using symbol fonts, some of X11 funtionality may depend
> on your locale - the warning message on PostscriptCIDMetricIndfo
> did say something about you using a one-byte locale - LANG=en_US.iso88591 .
> (3) There are various ways to add fonts to the X server - for new
> linux systems you are just copy them into ${HOME}/.fonts (don't know if
> R can use fonts via xft), for older linux boxes, you can do
> "xset fp+ <fontdir>", after running mkfontdir in that directory
> beforehand.
>
> Giampiero Salvi wrote:
> > Hi Paul,
> > first thank you for helping out.
> >
> > On Fri, 15 Dec 2006, Paul Murrell wrote:
> >
> >> Exactly.  The process would be simpler if you drew directly to
> >> PostScript or PDF via postscript() or pdf().
> >>
> >> Also, the text() call should be ...
> >>
> >> text(10,10,"whatever",family="ipa")
> >
> > [...]
> >
> >> I'm not sure how you got there.  You've specified the family wrong so I
> >> would expect more "family not found" warnings.  Let me know if this
> >> persists with the correct family specified.
> >
> > Strangely enough I get the
> > "family 'ipa' not included in PostScript device"
> > if I run
> > text(10,10,"whatever",family="ipa")
> > while the "PostScriptCIDMetricInfo" error if I run
> > text(10,10,"whatever",family="InternationalPhoneticAlphabet"")
> >
> > I get the same behaviour when I write directly to the postscript
> > device:
> >
> > postscript(file="whatever.eps")
> > plot(10,10,type="n")
> > text(10,10,"whatever",family="InternationalPhoneticAlphabet")
> > or
> > text(10,10,"whatever",family="ipa")
> >
> > I suspect the "PostScriptCIDMetricInfo" error depends on the fact the
> > the encodings/silipa.enc file contains all values from 33 to 255
> > (with a few undefines values). Can that be possible?
> >
> > Thanks,
> > Giampiero
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From pascal.niklaus at ipw.agrl.ethz.ch  Tue Dec 19 12:13:30 2006
From: pascal.niklaus at ipw.agrl.ethz.ch (Pascal A. Niklaus)
Date: Tue, 19 Dec 2006 12:13:30 +0100
Subject: [Rd] Error compiling on HP-UX
In-Reply-To: <200612191202.21114.pascal.niklaus@ipw.agrl.ethz.ch>
References: <200612181434.17135.pascal.niklaus@ipw.agrl.ethz.ch>
	<4586C4E2.2050903@cimr.cam.ac.uk>
	<200612191202.21114.pascal.niklaus@ipw.agrl.ethz.ch>
Message-ID: <200612191213.30590.pascal.niklaus@ipw.agrl.ethz.ch>

> _APP32_64BIT_OFF_T gets defined in sys/stdsyms.h:
> (I've put the file at http://azug.minpet.unibas.ch/~pascal/R/stdsyms.h)
>
> # ifdef _FILE_OFFSET_BITS
> #  if _FILE_OFFSET_BITS == 64
> #    define _FILE64		/* _FILE64 is obsolescent; don't use it */
> #    define __64BIT_OFF_T
> #    if !defined(__LP64__)
> #       define _APP32_64BIT_OFF_T
> #    endif
> #  else
> #    if _FILE_OFFSET_BITS != 32
> 	#error "_FILE_OFFSET_BITS defined to invalid number!!"
> #    endif
> #  endif/* _FILE_OFFSET_BITS == 64 */
> # endif /* _FILE_OFFSET_BITS */
>
> Does that mean that the platform include files are broken or is this a
> problem with the way they are included in R? I fear I have no means to
> change the /usr/include/... files on that machine.

Hmm, I probably did not show the relevant #ifdef into which this is nested:

/* Large (64-bit) Files symbols */

#if defined(__STDC_EXT__) || !defined(__STDC__) || defined(__LP64__)

# ifdef __LP64__
#   ifndef _FILE_OFFSET_BITS
#     define _FILE_OFFSET_BITS 64 
#   else
#    if _FILE_OFFSET_BITS != 64
      #error "_FILE_OFFSET_BITS definition incompatible with __LP64__."
#    endif
#   endif /* _FILE_OFFSET_BITS */

#   ifndef _PSTAT64
#     define _PSTAT64 
#   endif /* _PSTAT64 */

#   ifndef _KI64
#     define _KI64
#   endif /* _KI64 */

# endif /* __LP64__ */

# ifdef _FILE_OFFSET_BITS
#  if _FILE_OFFSET_BITS == 64
#    define _FILE64		/* _FILE64 is obsolescent; don't use it */
#    define __64BIT_OFF_T
#    if !defined(__LP64__)
#       define _APP32_64BIT_OFF_T
#    endif 
#  else
#    if _FILE_OFFSET_BITS != 32
	#error "_FILE_OFFSET_BITS defined to invalid number!!"
#    endif
#  endif/* _FILE_OFFSET_BITS == 64 */
# endif /* _FILE_OFFSET_BITS */

# define _LFS_LARGEFILE   1
# define _LFS64_LARGEFILE 1

# ifdef _LARGEFILE64_SOURCE
#  ifndef _LARGEFILE_SOURCE
#    define _LARGEFILE_SOURCE
#  endif
# endif

#else  /* strict ANSI */

# ifdef  _FILE_OFFSET_BITS
#  if !defined(__LP64__) && _FILE_OFFSET_BITS == 64
    #error "Large Files (ILP32) not supported in strict ANSI mode."
#  endif
# endif

# ifdef _LARGEFILE64_SOURCE
    #error "Large File interfaces not supported in strict ANSI mode."
# endif

# ifdef _PSTAT64
    #error "wide mode pstat interfaces not supported in strict ANSI mode."
# endif

#endif /* __STDC_EXT__ || ! __STDC__  || __LP64__ */


From hin-tak.leung at cimr.cam.ac.uk  Tue Dec 19 12:35:51 2006
From: hin-tak.leung at cimr.cam.ac.uk (Hin-Tak Leung)
Date: Tue, 19 Dec 2006 11:35:51 +0000
Subject: [Rd] Error compiling on HP-UX
In-Reply-To: <200612191213.30590.pascal.niklaus@ipw.agrl.ethz.ch>
References: <200612181434.17135.pascal.niklaus@ipw.agrl.ethz.ch>
	<4586C4E2.2050903@cimr.cam.ac.uk>
	<200612191202.21114.pascal.niklaus@ipw.agrl.ethz.ch>
	<200612191213.30590.pascal.niklaus@ipw.agrl.ethz.ch>
Message-ID: <4587CE97.3040109@cimr.cam.ac.uk>

Hmm, HP-UX on IA64 is 64-bit or not? It looks as if it can operate
in 32-bit mode or run 32-bit binaries. It would be useful if you run
this:

gcc -E -dM - < /dev/null > /tmp/macrolist

and post the compiler's internal macro list.

Pascal A. Niklaus wrote:
>> _APP32_64BIT_OFF_T gets defined in sys/stdsyms.h:
>> (I've put the file at http://azug.minpet.unibas.ch/~pascal/R/stdsyms.h)
>>
>> # ifdef _FILE_OFFSET_BITS
>> #  if _FILE_OFFSET_BITS == 64
>> #    define _FILE64		/* _FILE64 is obsolescent; don't use it */
>> #    define __64BIT_OFF_T
>> #    if !defined(__LP64__)
>> #       define _APP32_64BIT_OFF_T
>> #    endif
>> #  else
>> #    if _FILE_OFFSET_BITS != 32
>> 	#error "_FILE_OFFSET_BITS defined to invalid number!!"
>> #    endif
>> #  endif/* _FILE_OFFSET_BITS == 64 */
>> # endif /* _FILE_OFFSET_BITS */
>>
>> Does that mean that the platform include files are broken or is this a
>> problem with the way they are included in R? I fear I have no means to
>> change the /usr/include/... files on that machine.
> 
> Hmm, I probably did not show the relevant #ifdef into which this is nested:
> 
> /* Large (64-bit) Files symbols */
> 
> #if defined(__STDC_EXT__) || !defined(__STDC__) || defined(__LP64__)
> 
> # ifdef __LP64__
> #   ifndef _FILE_OFFSET_BITS
> #     define _FILE_OFFSET_BITS 64 
> #   else
> #    if _FILE_OFFSET_BITS != 64
>       #error "_FILE_OFFSET_BITS definition incompatible with __LP64__."
> #    endif
> #   endif /* _FILE_OFFSET_BITS */
> 
> #   ifndef _PSTAT64
> #     define _PSTAT64 
> #   endif /* _PSTAT64 */
> 
> #   ifndef _KI64
> #     define _KI64
> #   endif /* _KI64 */
> 
> # endif /* __LP64__ */
> 
> # ifdef _FILE_OFFSET_BITS
> #  if _FILE_OFFSET_BITS == 64
> #    define _FILE64		/* _FILE64 is obsolescent; don't use it */
> #    define __64BIT_OFF_T
> #    if !defined(__LP64__)
> #       define _APP32_64BIT_OFF_T
> #    endif 
> #  else
> #    if _FILE_OFFSET_BITS != 32
> 	#error "_FILE_OFFSET_BITS defined to invalid number!!"
> #    endif
> #  endif/* _FILE_OFFSET_BITS == 64 */
> # endif /* _FILE_OFFSET_BITS */
> 
> # define _LFS_LARGEFILE   1
> # define _LFS64_LARGEFILE 1
> 
> # ifdef _LARGEFILE64_SOURCE
> #  ifndef _LARGEFILE_SOURCE
> #    define _LARGEFILE_SOURCE
> #  endif
> # endif
> 
> #else  /* strict ANSI */
> 
> # ifdef  _FILE_OFFSET_BITS
> #  if !defined(__LP64__) && _FILE_OFFSET_BITS == 64
>     #error "Large Files (ILP32) not supported in strict ANSI mode."
> #  endif
> # endif
> 
> # ifdef _LARGEFILE64_SOURCE
>     #error "Large File interfaces not supported in strict ANSI mode."
> # endif
> 
> # ifdef _PSTAT64
>     #error "wide mode pstat interfaces not supported in strict ANSI mode."
> # endif
> 
> #endif /* __STDC_EXT__ || ! __STDC__  || __LP64__ */
>


From pascal.niklaus at ipw.agrl.ethz.ch  Tue Dec 19 14:32:10 2006
From: pascal.niklaus at ipw.agrl.ethz.ch (Pascal A. Niklaus)
Date: Tue, 19 Dec 2006 14:32:10 +0100
Subject: [Rd] Error compiling on HP-UX
In-Reply-To: <4587CE97.3040109@cimr.cam.ac.uk>
References: <200612181434.17135.pascal.niklaus@ipw.agrl.ethz.ch>
	<200612191213.30590.pascal.niklaus@ipw.agrl.ethz.ch>
	<4587CE97.3040109@cimr.cam.ac.uk>
Message-ID: <200612191432.11240.pascal.niklaus@ipw.agrl.ethz.ch>

On Tuesday 19 December 2006 12:35, Hin-Tak Leung wrote:
> Hmm, HP-UX on IA64 is 64-bit or not? It looks as if it can operate
> in 32-bit mode or run 32-bit binaries. It would be useful if you run
> this:
>
> gcc -E -dM - < /dev/null > /tmp/macrolist
>
> and post the compiler's internal macro list.
>
> gcc -E -dM - < /dev/null > /tmp/macrolist

[pegasus]~/downloads/R-2.4.0/src/main> cat /tmp/macrolist
#define __DBL_MIN_EXP__ (-1021)
#define __FLT_MIN__ 1.17549435e-38F
#define __CHAR_BIT__ 8
#define __WCHAR_MAX__ 4294967295U
#define __DBL_DENORM_MIN__ 4.9406564584124654e-324
#define __FLT_EVAL_METHOD__ 0
#define __ia64 1
#define __DBL_MIN_10_EXP__ (-307)
#define __FINITE_MATH_ONLY__ 0
#define __GNUC_PATCHLEVEL__ 1
#define __hpux 1
#define __SHRT_MAX__ 32767
#define __LDBL_MAX__ 1.18973149535723176508575932662800702e+4932L
#define __UINTMAX_TYPE__ long long unsigned int
#define __unix 1
#define __LDBL_MAX_EXP__ 16384
#define __SCHAR_MAX__ 127
#define __USER_LABEL_PREFIX__
#define __STDC_HOSTED__ 1
#define __LDBL_HAS_INFINITY__ 1
#define __DBL_DIG__ 15
#define __FLT_EPSILON__ 1.19209290e-7F
#define __LDBL_MIN__ 3.36210314311209350626267781732175260e-4932L
#define __unix__ 1
#define __IA64__ 1
#define __DECIMAL_DIG__ 36
#define __ia64__ 1
#define __LDBL_HAS_QUIET_NAN__ 1
#define __GNUC__ 4
#define __DBL_MAX__ 1.7976931348623157e+308
#define __DBL_HAS_INFINITY__ 1
#define __DBL_MAX_EXP__ 1024
#define __LONG_LONG_MAX__ 9223372036854775807LL
#define __GXX_ABI_VERSION 1002
#define __FLT_MIN_EXP__ (-125)
#define __DBL_MIN__ 2.2250738585072014e-308
#define _INCLUDE_LONGLONG 1
#define __DBL_HAS_QUIET_NAN__ 1
#define __REGISTER_PREFIX__
#define __STDCPP__ 1
#define __NO_INLINE__ 1
#define __FLT_MANT_DIG__ 24
#define __VERSION__ "4.1.1"
#define __BIG_ENDIAN__ 1
#define _UINT128_T 1
#define hpux 1
#define unix 1
#define __SIZE_TYPE__ long unsigned int
#define __ELF__ 1
#define __FLT_RADIX__ 2
#define __LDBL_EPSILON__ 1.92592994438723585305597794258492732e-34L
#define __LDBL_DIG__ 33
#define __FLT_HAS_QUIET_NAN__ 1
#define __FLT_MAX_10_EXP__ 38
#define __LONG_MAX__ 2147483647L
#define __FLT_HAS_INFINITY__ 1
#define _ILP32 1
#define __LDBL_MANT_DIG__ 113
#define __itanium__ 1
#define _LONGLONG 1
#define __WCHAR_TYPE__ unsigned int
#define __FLT_DIG__ 6
#define __INT_MAX__ 2147483647
#define __FLT_MAX_EXP__ 128
#define __DBL_MANT_DIG__ 53
#define __WINT_TYPE__ unsigned int
#define __LDBL_MIN_EXP__ (-16381)
#define __STDC_EXT__ 1
#define __LDBL_MAX_10_EXP__ 4932
#define __DBL_EPSILON__ 2.2204460492503131e-16
#define __INTMAX_MAX__ 9223372036854775807LL
#define __FLT_DENORM_MIN__ 1.40129846e-45F
#define __FLT_MAX__ 3.40282347e+38F
#define __FLT_MIN_10_EXP__ (-37)
#define __INTMAX_TYPE__ long long int
#define __GNUC_MINOR__ 1
#define __DBL_MAX_10_EXP__ 308
#define __LDBL_DENORM_MIN__ 6.47517511943802511092443895822764655e-4966L
#define __STDC__ 1
#define __PTRDIFF_TYPE__ long int
#define __hpux__ 1
#define __LDBL_MIN_10_EXP__ (-4931)
#define _HPUX_SOURCE 1

BTW, the error only occurs if netdb.h is included *after* config.h. Not sure 
if this helps...

Pascal


From jeff.horner at vanderbilt.edu  Tue Dec 19 17:56:30 2006
From: jeff.horner at vanderbilt.edu (Jeffrey Horner)
Date: Tue, 19 Dec 2006 10:56:30 -0600
Subject: [Rd] Phonetic symbols (IPA) in R graphics
In-Reply-To: <Pine.LNX.4.58.0612191152480.1305@ctt35.speech.kth.se>
References: <Pine.LNX.4.58.0612131459410.956@ctt35.speech.kth.se>	<45804A25.2040903@stat.auckland.ac.nz>	<Pine.LNX.4.58.0612141146150.21599@ctt35.speech.kth.se>	<4581A729.8010309@stat.auckland.ac.nz>	<Pine.LNX.4.58.0612142151160.30860@ctt14.speech.kth.se>	<45869747.6020909@cimr.cam.ac.uk>
	<Pine.LNX.4.58.0612191152480.1305@ctt35.speech.kth.se>
Message-ID: <458819BE.1090902@vanderbilt.edu>

Giampiero Salvi wrote:
> Hi Hin-Tak Leung,
> thank you for your help. Paul and I had solved the problem off-line.
> Here is the solution: the encoding file contained in the tipa package
> is not in adobe format and therefore causes the problem. The default
> encoding, however, seems to work well. In case of fonts corresponding
> to extended ascii, the octal code you find in appendix A in the tipa
> manual [1] can be entered in the string in the form \xyz.
> 
> This code demonstrates the use of IPA fonts (provided you have
> downloaded the fonts in the Type1 directory in your current path):
> Note in the end that you have to explicitely embed the fonts into the
> pdf file.
> 
> ipa <- Type1Font("InternationalPhoneticAlphabet",
>                   c("Type1/tipa10.afm",
>                     "Type1/tipabx10.afm",
>                     "Type1/tipasi10.afm",
>                     "Type1/tipabx10.afm"))
> pdfFonts(ipa=ipa)
> 
> pdf("ipademo.pdf")
> grid.text("whatever", y=2/3, gp=gpar(fontfamily="ipa"))
> grid.text("WHATEVER", y=1/3, gp=gpar(fontfamily="ipa"))
> grid.text("\312", y=1/4, gp=gpar(fontfamily="ipa"))
> dev.off()
> embedFonts("ipademo.pdf", out="ipademoembed.pdf", fontpath="Type1")
> 
> The only missing part is including symbols that are created in
> tipa/LaTeX by macros, but this is another story...

I've recently added freetype font support (http://www.freetype.org/) and 
pdf output to Simon Urbanek's Cairo package:

http://www.rforge.net/Cairo/

which supports pdf and png output. Freetype supports many font formats, 
including truetype and the newer opentype format. When R plots are 
created with truetype (or opentype) fonts, Cairo will by default embed 
the fonts into the pdf file.

I've also noticed a couple of debian unicode truetype font packages with 
IPA extensions:

$ apt-cache search ipa | grep ttf
ttf-thryomanes - A Unicode font covering Latin, Greek, Cyrillic and IPA
ttf-junicode - a Unicode font for medievalists (Latin, IPA and Runic)

So, I could envision creating an R package very similar to the LaTeX 
tipa package that could spit out the IPA unicode code points for these 
truetype fonts, thus supporting plots with IPA symbols but exclusively 
for the Cairo graphics device.

> 
> Thanks to anyone who helped.
> Giampiero
> 
> [1] http://tug.ctan.org/tex-archive/fonts/tipa/tipaman.pdf
> 
> On Mon, 18 Dec 2006, Hin-Tak Leung wrote:
> 
>> Hi,
>> I am not familiar with how R deals with postscript fonts, but
>> I am fairly familiar with some font technology, so here are a few
>> random thoughts:
>> (1) You are not supposed to specify just any random font family string
>> - postscript type 1 fonts contain their own family name inside.
>> (read the top of the font file - the header is is plain ascii). If it
>> works with a random font family name, it is probably because R does not
>> check (?).
>> (2) if you are using symbol fonts, some of X11 funtionality may depend
>> on your locale - the warning message on PostscriptCIDMetricIndfo
>> did say something about you using a one-byte locale - LANG=en_US.iso88591 .
>> (3) There are various ways to add fonts to the X server - for new
>> linux systems you are just copy them into ${HOME}/.fonts (don't know if
>> R can use fonts via xft), for older linux boxes, you can do
>> "xset fp+ <fontdir>", after running mkfontdir in that directory
>> beforehand.
>>
>> Giampiero Salvi wrote:
>>> Hi Paul,
>>> first thank you for helping out.
>>>
>>> On Fri, 15 Dec 2006, Paul Murrell wrote:
>>>
>>>> Exactly.  The process would be simpler if you drew directly to
>>>> PostScript or PDF via postscript() or pdf().
>>>>
>>>> Also, the text() call should be ...
>>>>
>>>> text(10,10,"whatever",family="ipa")
>>> [...]
>>>
>>>> I'm not sure how you got there.  You've specified the family wrong so I
>>>> would expect more "family not found" warnings.  Let me know if this
>>>> persists with the correct family specified.
>>> Strangely enough I get the
>>> "family 'ipa' not included in PostScript device"
>>> if I run
>>> text(10,10,"whatever",family="ipa")
>>> while the "PostScriptCIDMetricInfo" error if I run
>>> text(10,10,"whatever",family="InternationalPhoneticAlphabet"")
>>>
>>> I get the same behaviour when I write directly to the postscript
>>> device:
>>>
>>> postscript(file="whatever.eps")
>>> plot(10,10,type="n")
>>> text(10,10,"whatever",family="InternationalPhoneticAlphabet")
>>> or
>>> text(10,10,"whatever",family="ipa")
>>>
>>> I suspect the "PostScriptCIDMetricInfo" error depends on the fact the
>>> the encodings/silipa.enc file contains all values from 33 to 255
>>> (with a few undefines values). Can that be possible?
>>>
>>> Thanks,
>>> Giampiero
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


-- 
http://biostat.mc.vanderbilt.edu/JeffreyHorner


From hin-tak.leung at cimr.cam.ac.uk  Tue Dec 19 18:13:56 2006
From: hin-tak.leung at cimr.cam.ac.uk (Hin-Tak Leung)
Date: Tue, 19 Dec 2006 17:13:56 +0000
Subject: [Rd] Error compiling on HP-UX
In-Reply-To: <200612191432.11240.pascal.niklaus@ipw.agrl.ethz.ch>
References: <200612181434.17135.pascal.niklaus@ipw.agrl.ethz.ch>
	<200612191213.30590.pascal.niklaus@ipw.agrl.ethz.ch>
	<4587CE97.3040109@cimr.cam.ac.uk>
	<200612191432.11240.pascal.niklaus@ipw.agrl.ethz.ch>
Message-ID: <45881DD4.3070204@cimr.cam.ac.uk>

Pascal A. Niklaus wrote:
<snipped>
> BTW, the error only occurs if netdb.h is included *after* config.h. Not sure 
> if this helps...

Google have the answer :-). It looks like the gcc folks and some
HP engineers know about this issue but cannot settle on what to do
with it - see this thread:

http://gcc.gnu.org/ml/gcc-patches/2006-05/threads.html#00482

It seems that you have two ways out - either use the HP compiler to
build R, or the older gcc 3.x... or if you are feeling lucky, patching 
gcc with the patch in that thread and rebuild gcc. (or check if any 
similiar change has managed to get into gcc later). Sorry can't
see other alternatives :-(.

If you need to understand what the patch does - gcc on some platforms
keeps some "private" versions of hacked-up system includes in a
private location, when they are known to be slightly
funny and broken (as in this case). The patch just declares the file
as broken on *hp-hpux11* and create that private version of it.
The objection seems to be that the patch affects too many platforms (the
intial poster has an HP address did say he tested on IA64 and PA
HP-UX's, so I don't know what other HP-UXs are out there), so it is
possible that a later gcc may include a restrictive version of the
change...

It seems that any network-related programs are affected, so it might
be a good idea to bite the bullet and patch and rebuild gcc, or
at least, keep gcc 3.x around.

Good luck.

Hin-Tak Leung


From tpapp at Princeton.EDU  Tue Dec 19 18:25:16 2006
From: tpapp at Princeton.EDU (Tamas K Papp)
Date: Tue, 19 Dec 2006 18:25:16 +0100
Subject: [Rd] preserving sparse matrices (Matrix)
Message-ID: <20061219172516.GA1299@pu100877.student.princeton.edu>

Hi,

I have sparse (tridiagonal) matrices, and I use the Matrix package for
handling them.  For certain computations, I need to either set the
first row to zero, or double the last row.  I find that neither
operation preserves sparsity, eg

> m <- Diagonal(5)
> m
5 x 5 diagonal matrix of class "ddiMatrix"
     [,1] [,2] [,3] [,4] [,5]
[1,]    1    .    .    .    .
[2,]    .    1    .    .    .
[3,]    .    .    1    .    .
[4,]    .    .    .    1    .
[5,]    .    .    .    .    1
> m[1,] <- 0
> m
5 x 5 Matrix of class "dgeMatrix"
     [,1] [,2] [,3] [,4] [,5]
[1,]    0    0    0    0    0
[2,]    0    1    0    0    0
[3,]    0    0    1    0    0
[4,]    0    0    0    1    0
[5,]    0    0    0    0    1
> m <- Diagonal(5)
> rbind(m,1:5)
6 x 5 Matrix of class "dgeMatrix"
     [,1] [,2] [,3] [,4] [,5]
[1,]    1    0    0    0    0
[2,]    0    1    0    0    0
[3,]    0    0    1    0    0
[4,]    0    0    0    1    0
[5,]    0    0    0    0    1
[6,]    1    2    3    4    5

Currently, I am calling Matrix to make these sparse again, but my
matrices are large (100x100).  Is there a way to perform the
operations I want without losing sparsity?

Thanks,

Tamas


From btyner at stat.purdue.edu  Tue Dec 19 19:58:02 2006
From: btyner at stat.purdue.edu (Benjamin Tyner)
Date: Tue, 19 Dec 2006 13:58:02 -0500
Subject: [Rd] precision when calling a C function; presence of Fortran call
Message-ID: <4588363A.5050305@stat.purdue.edu>

I'm trying to figure out why the presence of a Fortran call affects the 
result of a floating-point operation. I have C functions

void test1(int *n, double *f){
  int outC;
  double c0;

  c0 = (double) *n * *f;

  outC = floor(c0);
  printf("when f computed by R, C says %d by itself\n",outC);
}

void test2(int *n, double *f){
  extern int F77_NAME(ifloor)(double *);
  int outC,outFor;
  double c0;

  c0 = (double) *n * *f;

  outFor = F77_CALL(ifloor)(&c0);
  outC = floor(c0);
  printf("when f computed by R, C says %d, Fortran says %d\n",outC,outFor);
}

where the Fortran function ifloor is

      integer function ifloor(x)
      DOUBLE PRECISION x
      ifloor=x
      if(ifloor.gt.x) ifloor=ifloor-1
      end

void test3(){
  int outC;
  double f, c0;
  int n;

  n = 111;
  f = 40. / (double) n;

  c0 = (double) n * f;
  outC = floor(c0);
  printf("when f computed by C, C says %d by itself\n",outC);

}

void test4(){
  extern int F77_NAME(ifloor)(double *);
  int outC,outFor;
  double f, c0;
  int n;

  n = 111;
  f = 40. / (double) n;

  c0 = (double) n * f;
  outFor = F77_CALL(ifloor)(&c0);
  outC = floor(c0);
  printf("when f computed by C, C says %d, Fortran says %d\n",outC,outFor);

}

For convenience, I've put all this in a package at 
http://www.stat.purdue.edu/~btyner/test_0.1-1.tar.gz ; just install, 
load, and run test() to see the results. On my system (linux, i686), 
they are:

 > library(test)
 > test()
when f computed by R, C says 39 by itself
when f computed by R, C says 40, Fortran says 40
when f computed by C, C says 40 by itself
when f computed by C, C says 40, Fortran says 40

That is, with n=111 and f=40/111 passed in from R, test1 gives a value 
of 39. This is not a problem; I am well aware of the limitations of 
floating point. However what concerns me is that test2 gives a value of 
40. It's almost as if C precision is reduced by the presence of calling 
the Fortran function ifloor.  Furthermore, when n and f are computed in 
C, the result is always 40. So my questions are:
1. How to explain the change from 39 to 40 seemingly due to the Fortran 
call being present?
2. When Fortran is not present, why does it matter whether f is computed 
by R or C?

Thanks,
Ben


From murdoch at stats.uwo.ca  Tue Dec 19 20:21:25 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Tue, 19 Dec 2006 14:21:25 -0500
Subject: [Rd] precision when calling a C function;
 presence of Fortran call
In-Reply-To: <4588363A.5050305@stat.purdue.edu>
References: <4588363A.5050305@stat.purdue.edu>
Message-ID: <45883BB5.5050806@stats.uwo.ca>

On 12/19/2006 1:58 PM, Benjamin Tyner wrote:
> I'm trying to figure out why the presence of a Fortran call affects the 
> result of a floating-point operation. I have C functions

On Windows, it's fairly common for runtime libraries to switch the 
precision from 80 bit to 64 bit.  R on Windows tries to guard against 
this, and on your test package, I get

when f computed by R, C says 40 by itself
when f computed by R, C says 40, Fortran says 40
when f computed by C, C says 40 by itself
when f computed by C, C says 40, Fortran says 40

It's possible that the floating point change is happening on your 
platform, or happened before you even got to this call.

Here's code that works in Windows to detect such a change across a 
LoadLibrary call:

     rcw = _controlfp(0,0) & ~_MCW_IC;  /* Infinity control is ignored */
     _clearfp();
     tdlh = LoadLibrary(path);
     dllcw = _controlfp(0,0) & ~_MCW_IC;

No idea if _controlfp() exists on your system.

Duncan Murdoch



> 
> void test1(int *n, double *f){
>   int outC;
>   double c0;
> 
>   c0 = (double) *n * *f;
> 
>   outC = floor(c0);
>   printf("when f computed by R, C says %d by itself\n",outC);
> }
> 
> void test2(int *n, double *f){
>   extern int F77_NAME(ifloor)(double *);
>   int outC,outFor;
>   double c0;
> 
>   c0 = (double) *n * *f;
> 
>   outFor = F77_CALL(ifloor)(&c0);
>   outC = floor(c0);
>   printf("when f computed by R, C says %d, Fortran says %d\n",outC,outFor);
> }
> 
> where the Fortran function ifloor is
> 
>       integer function ifloor(x)
>       DOUBLE PRECISION x
>       ifloor=x
>       if(ifloor.gt.x) ifloor=ifloor-1
>       end
> 
> void test3(){
>   int outC;
>   double f, c0;
>   int n;
> 
>   n = 111;
>   f = 40. / (double) n;
> 
>   c0 = (double) n * f;
>   outC = floor(c0);
>   printf("when f computed by C, C says %d by itself\n",outC);
> 
> }
> 
> void test4(){
>   extern int F77_NAME(ifloor)(double *);
>   int outC,outFor;
>   double f, c0;
>   int n;
> 
>   n = 111;
>   f = 40. / (double) n;
> 
>   c0 = (double) n * f;
>   outFor = F77_CALL(ifloor)(&c0);
>   outC = floor(c0);
>   printf("when f computed by C, C says %d, Fortran says %d\n",outC,outFor);
> 
> }
> 
> For convenience, I've put all this in a package at 
> http://www.stat.purdue.edu/~btyner/test_0.1-1.tar.gz ; just install, 
> load, and run test() to see the results. On my system (linux, i686), 
> they are:
> 
>  > library(test)
>  > test()
> when f computed by R, C says 39 by itself
> when f computed by R, C says 40, Fortran says 40
> when f computed by C, C says 40 by itself
> when f computed by C, C says 40, Fortran says 40
> 
> That is, with n=111 and f=40/111 passed in from R, test1 gives a value 
> of 39. This is not a problem; I am well aware of the limitations of 
> floating point. However what concerns me is that test2 gives a value of 
> 40. It's almost as if C precision is reduced by the presence of calling 
> the Fortran function ifloor.  Furthermore, when n and f are computed in 
> C, the result is always 40. So my questions are:
> 1. How to explain the change from 39 to 40 seemingly due to the Fortran 
> call being present?
> 2. When Fortran is not present, why does it matter whether f is computed 
> by R or C?
> 
> Thanks,
> Ben
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From btyner at stat.purdue.edu  Tue Dec 19 22:16:49 2006
From: btyner at stat.purdue.edu (Benjamin Tyner)
Date: Tue, 19 Dec 2006 16:16:49 -0500
Subject: [Rd] precision when calling a C function;
 presence of Fortran call
In-Reply-To: <45883BB5.5050806@stats.uwo.ca>
References: <4588363A.5050305@stat.purdue.edu> <45883BB5.5050806@stats.uwo.ca>
Message-ID: <458856C1.3080600@stat.purdue.edu>

Thanks; I'm on 32-bit linux, but it's good to know the behavior on 
Windows. Do you know a way to force "floor" to use this reduced precision?

Ben

Duncan Murdoch wrote:
> On Windows, it's fairly common for runtime libraries to switch the 
> precision from 80 bit to 64 bit.  R on Windows tries to guard against 
> this, and on your test package, I get
>
> when f computed by R, C says 40 by itself
> when f computed by R, C says 40, Fortran says 40
> when f computed by C, C says 40 by itself
> when f computed by C, C says 40, Fortran says 40
>
> It's possible that the floating point change is happening on your 
> platform, or happened before you even got to this call.
>
> Here's code that works in Windows to detect such a change across a 
> LoadLibrary call:
>
>     rcw = _controlfp(0,0) & ~_MCW_IC;  /* Infinity control is ignored */
>     _clearfp();
>     tdlh = LoadLibrary(path);
>     dllcw = _controlfp(0,0) & ~_MCW_IC;
>
> No idea if _controlfp() exists on your system.
>
> Duncan Murdoch


From murdoch at stats.uwo.ca  Tue Dec 19 22:24:42 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Tue, 19 Dec 2006 16:24:42 -0500
Subject: [Rd] precision when calling a C function;
 presence of Fortran call
In-Reply-To: <458856C1.3080600@stat.purdue.edu>
References: <4588363A.5050305@stat.purdue.edu> <45883BB5.5050806@stats.uwo.ca>
	<458856C1.3080600@stat.purdue.edu>
Message-ID: <4588589A.8020102@stats.uwo.ca>

On 12/19/2006 4:16 PM, Benjamin Tyner wrote:
> Thanks; I'm on 32-bit linux, but it's good to know the behavior on 
> Windows. Do you know a way to force "floor" to use this reduced precision?

Force the value to be stored to a "double" and it will get the reduced 
precision.  You can do this by assigning it to a numeric variable in R 
and then passing it back; you can presumably do it by some trickery in 
your compiler, but watch out for optimizations that leave it in an 80 
bit register the whole time.

Duncan Murdoch


> 
> Ben
> 
> Duncan Murdoch wrote:
>> On Windows, it's fairly common for runtime libraries to switch the 
>> precision from 80 bit to 64 bit.  R on Windows tries to guard against 
>> this, and on your test package, I get
>>
>> when f computed by R, C says 40 by itself
>> when f computed by R, C says 40, Fortran says 40
>> when f computed by C, C says 40 by itself
>> when f computed by C, C says 40, Fortran says 40
>>
>> It's possible that the floating point change is happening on your 
>> platform, or happened before you even got to this call.
>>
>> Here's code that works in Windows to detect such a change across a 
>> LoadLibrary call:
>>
>>     rcw = _controlfp(0,0) & ~_MCW_IC;  /* Infinity control is ignored */
>>     _clearfp();
>>     tdlh = LoadLibrary(path);
>>     dllcw = _controlfp(0,0) & ~_MCW_IC;
>>
>> No idea if _controlfp() exists on your system.
>>
>> Duncan Murdoch


From bolker at zoo.ufl.edu  Tue Dec 19 22:58:54 2006
From: bolker at zoo.ufl.edu (Ben Bolker)
Date: Tue, 19 Dec 2006 21:58:54 +0000 (UTC)
Subject: [Rd] question about trailing arguments in an S4 method
References: <458446F1.40403@zoo.ufl.edu> <m2mz5n5qse.fsf@ziti.local>
	<7098abec0612161857v61307a18ncbf358751a553b88@mail.gmail.com>
Message-ID: <loom.20061219T225730-259@post.gmane.org>

Byron Ellis <byron.ellis <at> gmail.com> writes:

> 
> He wants to specify arguments to AIC that act like the "k" argument
> and is thinking of faking it by, essentially, doing another round of
> argument matching on ...
> 
> I think that if you define an S4 generic that only dispatches on the
> first argument you may be able to do it for a specific method. On the
> bright side, the new documentation for AIC would take precedence over
> the stats documentation so the users couldn't actually complain about
> the method not matching the documentation.
>

  I think I'll bite the bullet and define a separate
"AICtab" function that takes a list of objects and
produces an AIC table.

  thanks, all

   Ben  Bolker


From ripley at stats.ox.ac.uk  Tue Dec 19 23:16:16 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 19 Dec 2006 22:16:16 +0000 (GMT)
Subject: [Rd] precision when calling a C function;
 presence of Fortran call
In-Reply-To: <4588589A.8020102@stats.uwo.ca>
References: <4588363A.5050305@stat.purdue.edu> <45883BB5.5050806@stats.uwo.ca>
	<458856C1.3080600@stat.purdue.edu> <4588589A.8020102@stats.uwo.ca>
Message-ID: <Pine.LNX.4.64.0612192212010.15148@gannet.stats.ox.ac.uk>

On Tue, 19 Dec 2006, Duncan Murdoch wrote:

> On 12/19/2006 4:16 PM, Benjamin Tyner wrote:
>> Thanks; I'm on 32-bit linux, but it's good to know the behavior on
>> Windows. Do you know a way to force "floor" to use this reduced precision?
>
> Force the value to be stored to a "double" and it will get the reduced
> precision.  You can do this by assigning it to a numeric variable in R
> and then passing it back; you can presumably do it by some trickery in
> your compiler, but watch out for optimizations that leave it in an 80
> bit register the whole time.

In C, declaring a value as 'volatile' should force it to be stored in a 
64-bit memory location.  There is no known way to do this in Fortran:
compilers and numeric software have been playing leapfrog games for years.
What you can do with gcc (the compiler collection) is to compile a module 
with -ffloat-store, as we do with dlamc.f.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From btyner at stat.purdue.edu  Tue Dec 19 23:28:47 2006
From: btyner at stat.purdue.edu (Benjamin Tyner)
Date: Tue, 19 Dec 2006 17:28:47 -0500
Subject: [Rd] precision when calling a C function;
 presence of Fortran call
In-Reply-To: <Pine.LNX.4.64.0612192212010.15148@gannet.stats.ox.ac.uk>
References: <4588363A.5050305@stat.purdue.edu> <45883BB5.5050806@stats.uwo.ca>
	<458856C1.3080600@stat.purdue.edu> <4588589A.8020102@stats.uwo.ca>
	<Pine.LNX.4.64.0612192212010.15148@gannet.stats.ox.ac.uk>
Message-ID: <4588679F.5010305@stat.purdue.edu>

Thanks! It seems the 'volatile' declaration is exactly what was needed.

Ben

Prof Brian Ripley wrote:
> In C, declaring a value as 'volatile' should force it to be stored in 
> a 64-bit memory location.  There is no known way to do this in Fortran:
> compilers and numeric software have been playing leapfrog games for 
> years.
> What you can do with gcc (the compiler collection) is to compile a 
> module with -ffloat-store, as we do with dlamc.f.
>


From roebuck at mdanderson.org  Wed Dec 20 00:12:25 2006
From: roebuck at mdanderson.org (Paul Roebuck)
Date: Tue, 19 Dec 2006 17:12:25 -0600 (CST)
Subject: [Rd] Detecting compilation under R
In-Reply-To: <Pine.LNX.4.64.0612141716400.3286@gannet.stats.ox.ac.uk>
References: <45816A65.8000802@lancaster.ac.uk>
	<Pine.LNX.4.64.0612141618580.29210@gannet.stats.ox.ac.uk>
	<45818652.7050102@lancaster.ac.uk>
	<Pine.LNX.4.64.0612141716400.3286@gannet.stats.ox.ac.uk>
Message-ID: <Pine.OSF.4.58.0612191624470.290351@wotan.mdacc.tmc.edu>

On Thu, 14 Dec 2006, Prof Brian Ripley wrote:

> On Thu, 14 Dec 2006, Barry Rowlingson wrote:
>
> [Silently discarding the answer to his question, and breaching
> 'fair use' copyright provisions.]
>
> >> So the problem is that you needed rather
> >>
> >> #include <R.h>
> >> #ifdef USING_R
> >> x = rand_unif(0.0,1.0);
> >> #else
> >> #include <gsl_random.h>
> >> x = gsl_runif(0.0,1.0);
> >> #endif
> >>
> >> since if R.h is not around, the include will not include it.
>
> > If R.h is not around, the preprocessor will throw a tantrum:
>
> If *no* R.h is around: easy to solve.
>
> > cc    -c -o simple.o simple.c
> > simple.c:2:15: error: R.h: No such file or directory
> >
> [SNIP - PLR]

Never saw the reply to Barry's question. His quoting
methodology notwithstanding, I don't see the answer
plainly either.

When Prof. Ripley says above - "easy to solve", is the
implication that R installation become prerequisite or
creating a fake "R.h"?


Would have thought it easiest to solve by adding
-DUSING_R to Makevar's PKG_CPPFLAGS with the code
restructured as below.

#ifdef USING_R
    #include <R.h>
    x = rand_unif(0.0,1.0);
#else
    #include <gsl_random.h>
    x = gsl_runif(0.0,1.0);
#endif

Barry's suggestion to eliminate this step by having any
R-based compile process identify itself (although a single
preprocessor define is sufficient) would be a nice addition,
simplifying life when a source file can be used with
R or standalone.

----------------------------------------------------------
SIGSIG -- signature too long (core dumped)


From vdergachev at rcgardis.com  Wed Dec 20 00:18:43 2006
From: vdergachev at rcgardis.com (Vladimir Dergachev)
Date: Tue, 19 Dec 2006 18:18:43 -0500
Subject: [Rd] data frame subset patch, take 2
In-Reply-To: <17796.26630.481777.933234@cmath-3.math.ethz.ch>
References: <200612061333.09050.vdergachev@rcgardis.com>
	<17796.26025.698050.64495@cmath-3.math.ethz.ch>
	<17796.26630.481777.933234@cmath-3.math.ethz.ch>
Message-ID: <200612191818.43988.vdergachev@rcgardis.com>

On Saturday 16 December 2006 4:41 pm, Martin Maechler wrote:
>
> Correction: the problems show on both platforms;
>
> one is in mgcv, gam(), an error in [[ <-  -- pretty clearly linked to your
> changes but not reproducible when tried isolatedly
> interactively,
>
> the other one is a seg.fault "memory not mapped" when running
> the  example
>
>    > nuke.boot <- boot(nuke.data, nuke.fun, R=999, m=1,
>
>    +      fit.pred=new.fit, x.pred=new.data)
>
>
>     MM> My guess: typically when dealing with model.frames (which
>     MM> internally are "just" data frames with a particular "terms"
> attribute) MM> but the problems are not reproducible when run
> interactively. MM> It may really be that .subset() and .subset2() are
> sometimes MM> used in cases they should not be in your new code; or they
> even have a bug that MM> is not triggered unless by using them in the new
> context of [.data.frame
>
>     MM> So I'm sorry, but we might have to wait for a "take 3"
>     MM> or rather try to find the problem with your patch.
>     MM> Maybe you can try yourself?

Hi Martin, 

   thank you very much for the feedback !

   Of course, there is going to be take 3 :)

   I have reproduced your tests with slightly different results:
boot.Rcheck fails, stats.Rcheck segfaults, cluster.Rcheck fails.

   More importantly I was able to reproduce the problem interactively with 
boot.Rcheck. When interactive I found that the issue has random outcomes - 
sometimes it segfaults and sometimes it produces this:

   1) boot.Rcheck fails with 

> nuke.boot <- boot(nuke.data, nuke.fun, R=999, m=1, 
+      fit.pred=new.fit, x.pred=new.data)
Error: incompatible types (from NULL to list) in [[ assignment
Execution halted

    but does not segfault. Other times it errors out in different places or 
goes through fine. On one occasion I observed a very interesting behaviour - 
the R console looked like it was completely confused about which functions 
are being called and about arguments passed to them.

   After some tinkering, I realized that, perhaps, the problem is with me 
adding .subassign and .subassign2 functions and this somehow interfering with 
saved workspaces. So I did make clean (after updating SVN) and the problem 
appears to be gone.

   Could you try dong make clean && make on your installation and reporting 
the results ?

                              thank you very much !

                                           Vladimir Dergachev


From murdoch at stats.uwo.ca  Wed Dec 20 05:44:41 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Tue, 19 Dec 2006 23:44:41 -0500
Subject: [Rd] Source references from the parser
In-Reply-To: <456890A8.2060908@stats.uwo.ca>
References: <456890A8.2060908@stats.uwo.ca>
Message-ID: <4588BFB9.8010105@stats.uwo.ca>

A few days ago Brian Ripley pointed out a bug with the design of this, 
so I've changed it.  See the notes below if you were trying to work with it.

On 11/25/2006 1:51 PM, Duncan Murdoch wrote:
> I have just committed some changes to R-devel (which will become R 2.5.0 
> next spring) to add source references to parsed R code.  Here's a 
> description of the scheme:
> 
> The design is done through 2 old-style classes.
> 
> "srcfile" corresponds to a source file: it contains a filename, the
> working directory in which that filename is to be interpreted, the last
> modified timestamp of the file at the time the object is created, plus
> some internal components.  It is implemented as an environment so that
> there can be multiple references to it.
> 
> "srcref" is a reference to a particular range of characters (as the
> parser sees them; I think that really means bytes, but I haven't tested
> with MBCSs) in a source file.  It is implemented as a vector of 4
> integers (first line, first column, last line, last column), with the
> srcfile as an attribute.
> 
> The parser attaches a srcref attribute to each complete statement as it
> gets parsed, if option("useSource") is TRUE.  (I've left the old source
> attribute in place as well for functions; I think it won't be needed in 
> the long run, but it is needed now.)

This is the part that changed.  The srcref attribute is no longer 
attached to each statement, because some statements are objects that 
can't have attributes.  Now a list of srcref objects is attached to the 
container of the statements:  the expression() list in the case of 
parse(), or the call to "{" which is how the parser stores a block of code.
> 
> When printing an object with a srcref attribute, print.default tries to
> read the srcfile to obtain the text.  If it fails, it falls back to an
> ugly display of the reference.  Using a new argument useSource=FALSE in
> printing will stop this attempt:  when printing language, it will
> deparse; when printing a srcref, it will print the ugly fallback.
> 
> source(echo=T) will echo all the lines of the file including comments
> and formatting.  demo() does the same, and I would guess Sweave will do
> this too, but I haven't tested that yet.  I think this will improve
> Sweave output, but will need changes to the input file:  people may have
> comments there that they don't want shown.  Some sort of
> "useSource=FALSE" option will need to be added.

As discussed, this facility was added to Sweave, but currently (and 
probably permanently) defaults to not being turned on.

> The browser used with debug() etc. will display statements as they were
> formatted in the original source.  It will not display leading or
> following comments, but will display embedded comments.

I think the debugger will now only use deparsed output, since the srcref 
is no longer part of the statement.
> 
> Parsing errors display the name of the source file that was parsed, and
> display verbose error messages describing what's wrong.  This display
> could still be improved, e.g. by displaying the whole source line with a
> pointer to the error, instead of just the text up to the location of the
> error.
> 
> I plan to add some sort of equivalent of C "#line" directives, so that
> preprocessed source files (e.g. the concatenated source that is
> installed) can include references back to the original source files, for
> syntax error reporting, and/or debugging.  This will require
> modification of the INSTALL process, but I haven't started on this yet.

I haven't done this yet, and I'm not sure I'll have time to get to it 
before 2.5.0.

> It would probably be a good idea to have some utility functions to play
> with the srcref records for debugging and other purposes, but I haven't
> written those yet.  For example, the current source record on a function
> could be replaced with a srcref, but only by expanding the srcref to
> include some of the surrounding comments.

This hasn't been done either.
> 
> Comments and problem reports are welcome.

That's still true.

Duncan Murdoch
> 
> Duncan Murdoch
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From murdoch at stats.uwo.ca  Wed Dec 20 05:51:15 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Tue, 19 Dec 2006 23:51:15 -0500
Subject: [Rd] Source references from the parser
In-Reply-To: <4588BFB9.8010105@stats.uwo.ca>
References: <456890A8.2060908@stats.uwo.ca> <4588BFB9.8010105@stats.uwo.ca>
Message-ID: <4588C143.2060701@stats.uwo.ca>

On 12/19/2006 11:44 PM, Duncan Murdoch wrote:
> A few days ago Brian Ripley pointed out a bug with the design of this, 
> so I've changed it.  See the notes below if you were trying to work with it.
> 
> On 11/25/2006 1:51 PM, Duncan Murdoch wrote:
>> I have just committed some changes to R-devel (which will become R 2.5.0 
>> next spring) to add source references to parsed R code.  Here's a 
>> description of the scheme:
>>
>> The design is done through 2 old-style classes.
>>
>> "srcfile" corresponds to a source file: it contains a filename, the
>> working directory in which that filename is to be interpreted, the last
>> modified timestamp of the file at the time the object is created, plus
>> some internal components.  It is implemented as an environment so that
>> there can be multiple references to it.
>>
>> "srcref" is a reference to a particular range of characters (as the
>> parser sees them; I think that really means bytes, but I haven't tested
>> with MBCSs) in a source file.  It is implemented as a vector of 4
>> integers (first line, first column, last line, last column), with the
>> srcfile as an attribute.
>>
>> The parser attaches a srcref attribute to each complete statement as it
>> gets parsed, if option("useSource") is TRUE.  (I've left the old source
>> attribute in place as well for functions; I think it won't be needed in 
>> the long run, but it is needed now.)

I didn't notice an error in the paragraph above until just now:  the 
option isn't "useSource", it's "keep.source".  "useSource" is the name 
of an argument used when deciding how to print something.

  > This is the part that changed.  The srcref attribute is no longer
> attached to each statement, because some statements are objects that 
> can't have attributes.  Now a list of srcref objects is attached to the 
> container of the statements:  the expression() list in the case of 
> parse(), or the call to "{" which is how the parser stores a block of code.
>> When printing an object with a srcref attribute, print.default tries to
>> read the srcfile to obtain the text.  If it fails, it falls back to an
>> ugly display of the reference.  Using a new argument useSource=FALSE in
>> printing will stop this attempt:  when printing language, it will
>> deparse; when printing a srcref, it will print the ugly fallback.
>>
>> source(echo=T) will echo all the lines of the file including comments
>> and formatting.  demo() does the same, and I would guess Sweave will do
>> this too, but I haven't tested that yet.  I think this will improve
>> Sweave output, but will need changes to the input file:  people may have
>> comments there that they don't want shown.  Some sort of
>> "useSource=FALSE" option will need to be added.
> 
> As discussed, this facility was added to Sweave, but currently (and 
> probably permanently) defaults to not being turned on.
> 
>> The browser used with debug() etc. will display statements as they were
>> formatted in the original source.  It will not display leading or
>> following comments, but will display embedded comments.
> 
> I think the debugger will now only use deparsed output, since the srcref 
> is no longer part of the statement.
>> Parsing errors display the name of the source file that was parsed, and
>> display verbose error messages describing what's wrong.  This display
>> could still be improved, e.g. by displaying the whole source line with a
>> pointer to the error, instead of just the text up to the location of the
>> error.
>>
>> I plan to add some sort of equivalent of C "#line" directives, so that
>> preprocessed source files (e.g. the concatenated source that is
>> installed) can include references back to the original source files, for
>> syntax error reporting, and/or debugging.  This will require
>> modification of the INSTALL process, but I haven't started on this yet.
> 
> I haven't done this yet, and I'm not sure I'll have time to get to it 
> before 2.5.0.
> 
>> It would probably be a good idea to have some utility functions to play
>> with the srcref records for debugging and other purposes, but I haven't
>> written those yet.  For example, the current source record on a function
>> could be replaced with a srcref, but only by expanding the srcref to
>> include some of the surrounding comments.
> 
> This hasn't been done either.
>> Comments and problem reports are welcome.
> 
> That's still true.
> 
> Duncan Murdoch
>> Duncan Murdoch
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From goodrich at fas.harvard.edu  Tue Dec 19 22:45:33 2006
From: goodrich at fas.harvard.edu (goodrich at fas.harvard.edu)
Date: Tue, 19 Dec 2006 22:45:33 +0100 (CET)
Subject: [Rd] Bug in rt() ? (PR#9422)
Message-ID: <20061219214533.8BFFE3FBDA@slim.kubism.ku.dk>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

<<insert bug report here>>
Reproduced on Debian and Windows ...

On 2.4.x if you execute

set.seed(12345)
t.1 <- rt(n = 1000, df = 20)

set.seed(12345)
t.2 <- rt(n = 1000, df = 20, ncp = 0)

all.equal(t.1, t.2) ## Not close to true

This appears to be due to the fact that in 2.4.x rt is now

rt
function (n, df, ncp = 0)
{
    if (missing(ncp))
                .Internal(rt(n, df))
    else rnorm(n, ncp)/sqrt(rchisq(n, df)/df)
}
<environment: namespace:stats>

Whereas in 2.3.1 rt() is verified to work as expected when someone
(redundantly) types ncp = 0

rt
function (n, df, ncp = 0)
{
    if (ncp == 0)
   .Internal(rt(n, df))
    else rnorm(n, ncp)/(rchisq(n, df)/sqrt(df))
}
<environment: namespace:stats>

The only interface difference is missing(ncp) vs. ncp == 0 .

- --please do not edit the information below--

Version:
 platform = i486-pc-linux-gnu
 arch = i486
 os = linux-gnu
 system = i486, linux-gnu
 status =
 major = 2
 minor = 4.1
 year = 2006
 month = 12
 day = 18
 svn rev = 40228
 language = R
 version.string = R version 2.4.1 (2006-12-18)

Locale:
LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=en_US.UTF-8;LC_COLLATE=en_US.UTF-8;LC_MONETARY=en_US.UTF-8;LC_MESSAGES=en_US.UTF-8;LC_PAPER=en_US.UTF-8;LC_NAME=en_US.UTF-8;LC_ADDRESS=en_US.UTF-8;LC_TELEPHONE=en_US.UTF-8;LC_MEASUREMENT=en_US.UTF-8;LC_IDENTIFICATION=en_US.UTF-8

Search Path:
 .GlobalEnv, package:car, package:rkward, package:stats,
package:graphics, package:grDevices, package:utils, package:datasets,
package:methods, Autoloads, package:base
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org

iD8DBQFFiF09zQDSXIcN85kRAhK4AKCBmPNkGszTzFdALfiGgW1LfNIOTwCfZ8RM
0gZjer8+rnmOPDFKZXBbFQw=
=ff85
-----END PGP SIGNATURE-----


From maechler at stat.math.ethz.ch  Wed Dec 20 08:50:49 2006
From: maechler at stat.math.ethz.ch (maechler at stat.math.ethz.ch)
Date: Wed, 20 Dec 2006 08:50:49 +0100 (CET)
Subject: [Rd] Bug in rt() ? (PR#9422)
Message-ID: <20061220075049.856F74C9F8@slim.kubism.ku.dk>

>>>>> "goodrich" == goodrich  <goodrich at fas.harvard.edu>
>>>>>     on Tue, 19 Dec 2006 22:45:33 +0100 (CET) writes:

    goodrich> Reproduced on Debian and Windows ...

    goodrich> On 2.4.x if you execute

    goodrich> set.seed(12345)
    goodrich> t.1 <- rt(n = 1000, df = 20)

    goodrich> set.seed(12345)
    goodrich> t.2 <- rt(n = 1000, df = 20, ncp = 0)

    goodrich> all.equal(t.1, t.2) ## Not close to true

    goodrich> This appears to be due to the fact that in 2.4.x rt is now

    goodrich> rt
    goodrich> function (n, df, ncp = 0)
    goodrich> {
    goodrich> if (missing(ncp))
    goodrich> .Internal(rt(n, df))
    goodrich> else rnorm(n, ncp)/sqrt(rchisq(n, df)/df)
    goodrich> }
    goodrich> <environment: namespace:stats>

    goodrich> Whereas in 2.3.1 rt() is verified to work as expected when someone
    goodrich> (redundantly) types ncp = 0

    goodrich> rt
    goodrich> function (n, df, ncp = 0)
    goodrich> {
    goodrich> if (ncp == 0)
    goodrich> .Internal(rt(n, df))
    goodrich> else rnorm(n, ncp)/(rchisq(n, df)/sqrt(df))
    goodrich> }
    goodrich> <environment: namespace:stats>

    goodrich> The only interface difference is missing(ncp) vs. ncp == 0 .

Your analysis is correct.
But the question mark in your subject line is too: This is no
bug, but quite on purpose:  rt() has been changed to be in line with
qt() and pt().

The idea is that if you specify 'ncp', we give you behavior which
is continuous (in the mathematical sense) in 'ncp' for  ncp --> 0.
Hence, when ncp is specified {aka !missing(.)}, the algorithms
for ncp >=0 are applied; if it's not specified, the algorithms
of the central t-distributions are used.

However, your report does point to a ``bug'' :
We should document the above on the Tdist help page.

So, after all, thank you for the report!
Martin Maechler, ETH Zurich


From ripley at stats.ox.ac.uk  Wed Dec 20 08:59:18 2006
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Wed, 20 Dec 2006 08:59:18 +0100 (CET)
Subject: [Rd] Bug in rt() ? (PR#9422)
Message-ID: <20061220075918.982914C8D1@slim.kubism.ku.dk>

Why do you consider this might be a bug in R rather than in your 
expectations?  Your 'expected' is not what others have expected ....

In 2.4.1  rt(ncp) operates continuously as ncp is varied through 0.
That is different from saying that you want a central t (omitting ncp).

BTW, reports to R-bugs should *never* include a question mark: see the R 
FAQ.  A question on R-devel (or even R-help) would have been reasonable.

On Tue, 19 Dec 2006, goodrich at fas.harvard.edu wrote:

> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> <<insert bug report here>>
> Reproduced on Debian and Windows ...
>
> On 2.4.x if you execute
>
> set.seed(12345)
> t.1 <- rt(n = 1000, df = 20)
>
> set.seed(12345)
> t.2 <- rt(n = 1000, df = 20, ncp = 0)
>
> all.equal(t.1, t.2) ## Not close to true
>
> This appears to be due to the fact that in 2.4.x rt is now
>
> rt
> function (n, df, ncp = 0)
> {
>    if (missing(ncp))
>                .Internal(rt(n, df))
>    else rnorm(n, ncp)/sqrt(rchisq(n, df)/df)
> }
> <environment: namespace:stats>
>
> Whereas in 2.3.1 rt() is verified to work as expected when someone
> (redundantly) types ncp = 0
>
> rt
> function (n, df, ncp = 0)
> {
>    if (ncp == 0)
>   .Internal(rt(n, df))
>    else rnorm(n, ncp)/(rchisq(n, df)/sqrt(df))
> }
> <environment: namespace:stats>
>
> The only interface difference is missing(ncp) vs. ncp == 0 .
>
> - --please do not edit the information below--
>
> Version:
> platform = i486-pc-linux-gnu
> arch = i486
> os = linux-gnu
> system = i486, linux-gnu
> status =
> major = 2
> minor = 4.1
> year = 2006
> month = 12
> day = 18
> svn rev = 40228
> language = R
> version.string = R version 2.4.1 (2006-12-18)
>
> Locale:
> LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=en_US.UTF-8;LC_COLLATE=en_US.UTF-8;LC_MONETARY=en_US.UTF-8;LC_MESSAGES=en_US.UTF-8;LC_PAPER=en_US.UTF-8;LC_NAME=en_US.UTF-8;LC_ADDRESS=en_US.UTF-8;LC_TELEPHONE=en_US.UTF-8;LC_MEASUREMENT=en_US.UTF-8;LC_IDENTIFICATION=en_US.UTF-8
>
> Search Path:
> .GlobalEnv, package:car, package:rkward, package:stats,
> package:graphics, package:grDevices, package:utils, package:datasets,
> package:methods, Autoloads, package:base
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v1.4.6 (GNU/Linux)
> Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org
>
> iD8DBQFFiF09zQDSXIcN85kRAhK4AKCBmPNkGszTzFdALfiGgW1LfNIOTwCfZ8RM
> 0gZjer8+rnmOPDFKZXBbFQw=
> =ff85
> -----END PGP SIGNATURE-----
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From sophie.martin at actigenics.com  Wed Dec 20 10:49:51 2006
From: sophie.martin at actigenics.com (sophie.martin at actigenics.com)
Date: Wed, 20 Dec 2006 10:49:51 +0100 (CET)
Subject: [Rd] jpeg() and png() in R-2.4.x (PR#9423)
Message-ID: <20061220094951.96D2C5732A@slim.kubism.ku.dk>

I have tried to install R-2.4.x on my computer (linux - mandriva 2007 - 
64bits), with tar file for R-4.2.1 and rpm file for R-2.4.0, and 
function capabilities() says to me that JPG, PNG and TCLTK are not 
available. However, with the version R-2.3.x with whicc I work , they 
are available.
May be it's a bug, or may be my mandriva 2007 distribution are not all 
required libraries ? But I have not find "REQUIREMENTS" files on the 
CRAN site to verify that.

Thanks for your help,

Sophie Martin


From maechler at stat.math.ethz.ch  Wed Dec 20 15:43:30 2006
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Wed, 20 Dec 2006 15:43:30 +0100
Subject: [Rd] preserving sparse matrices (Matrix)
In-Reply-To: <20061219172516.GA1299@pu100877.student.princeton.edu>
References: <20061219172516.GA1299@pu100877.student.princeton.edu>
Message-ID: <17801.19474.604113.664972@stat.math.ethz.ch>

Thank you, Tamas,

>>>>> "Tamas" == Tamas K Papp <tpapp at princeton.edu>
>>>>>     on Tue, 19 Dec 2006 18:25:16 +0100 writes:

    Tamas> Hi,
    Tamas> I have sparse (tridiagonal) matrices, and I use the Matrix package for
    Tamas> handling them.  For certain computations, I need to either set the
    Tamas> first row to zero, or double the last row.  I find that neither
    Tamas> operation preserves sparsity, eg

    >> m <- Diagonal(5)
    >> m
    Tamas> 5 x 5 diagonal matrix of class "ddiMatrix"
    Tamas> [,1] [,2] [,3] [,4] [,5]
    Tamas> [1,]    1    .    .    .    .
    Tamas> [2,]    .    1    .    .    .
    Tamas> [3,]    .    .    1    .    .
    Tamas> [4,]    .    .    .    1    .
    Tamas> [5,]    .    .    .    .    1

showClass("ddiMatrix") 

will show you that 'm' is not a 'sparseMatrix' but a
'diagonalMatrix' which inherits from 'denseMatrix';
since I had decided that 'sparseMatrix' should be confined to
those matrices that store "location + content";
This is in line with the fact that a packed triangular matrix
also inherits from 'denseMatrix'.
(Also, to store a diagonalMatrix as sparseMatrix leads to larger
 object size).

I agree however that this is not obvious to the casual user and
also that you should not *have* to know this.

    >> m[1,] <- 0
    >> m
    Tamas> 5 x 5 Matrix of class "dgeMatrix"
    Tamas> [,1] [,2] [,3] [,4] [,5]
    Tamas> [1,]    0    0    0    0    0
    Tamas> [2,]    0    1    0    0    0
    Tamas> [3,]    0    0    1    0    0
    Tamas> [4,]    0    0    0    1    0
    Tamas> [5,]    0    0    0    0    1
    >> m <- Diagonal(5)
    >> rbind(m,1:5)
    Tamas> 6 x 5 Matrix of class "dgeMatrix"
    Tamas> [,1] [,2] [,3] [,4] [,5]
    Tamas> [1,]    1    0    0    0    0
    Tamas> [2,]    0    1    0    0    0
    Tamas> [3,]    0    0    1    0    0
    Tamas> [4,]    0    0    0    1    0
    Tamas> [5,]    0    0    0    0    1
    Tamas> [6,]    1    2    3    4    5

Yes, this is an infelicity (and I'd say for the first example
even a bug) in the 'Matrix' package which I will fix for the
next version.

    Tamas> Currently, I am calling Matrix to make these sparse again, but my
    Tamas> matrices are large (100x100).  Is there a way to perform the
    Tamas> operations I want without losing sparsity?

Yes --- however, not as easily as I thought for the current
	version of 'Matrix' -- due to more infelicities... :

Here's a workable script {which has output as comments}:


m0 <- Diagonal(5)

### 1st problem : ----------------------------

rbind(m0, 1:5)# -> dense

## Need this for now {not anymore in Matrix 0.9975-8 } :
.rb2m <- function(x, y) callGeneric(x, matrix(y, nrow = 1))
setMethod("rbind2", signature(x = "Matrix",    y = "numeric"), .rb2m)
setMethod("rbind2", signature(x = "ddiMatrix", y = "numeric"), .rb2m)
setMethod("rbind2", signature(x = "ddiMatrix", y = "matrix"),
          function(x,y) rbind2(suppressWarnings(as(x,"CsparseMatrix")),
                               Matrix:::as_Csparse(y)))

rbind(m0, 1:5)
## 6 x 5 sparse Matrix of class "dgCMatrix"

## [1,] 1 . . . .
## [2,] . 1 . . .
## [3,] . . 1 . .
## [4,] . . . 1 .
## [5,] . . . . 1
## [6,] 1 2 3 4 5

### 2nd problem: ----------------------------

diag2Sparse <- function(x) ## this is a workaround for a current "Matrix" bug
    Matrix:::diagU2N(suppressWarnings(as(x, "CsparseMatrix")))

m1 <- diag2Sparse(m0)
m1[1,] <- 0 ; m1
m1[,3] <- 3 ; m1
m1[1:3, 3] <- 0
m1
Matrix:::drop0(m1)# remove the "0"
## Should  drop0() be exported and documented? -- probably yes!


---------

I hope this helps.

Next time, we (Prof Douglas Bates and me) will appreciate if you
approach us directly.

Best regards,
Martin


From christian.hoffmann at wsl.ch  Wed Dec 20 14:40:24 2006
From: christian.hoffmann at wsl.ch (christian.hoffmann at wsl.ch)
Date: Wed, 20 Dec 2006 14:40:24 +0100 (CET)
Subject: [Rd] DBI + ROracle problem with parser ?? (PR#9424)
Message-ID: <20061220134024.36DDD57334@slim.kubism.ku.dk>

Full_Name: Christian Hoffmann
Version: 2.4.0
OS: Win 2000
Submission from: (NULL) (193.134.202.252)


Database queries using the combination DBI + ROracle are handicapped by 

quirks in the pipeline between the textual representation of the query 

and the database engine Oracle. Comments and linefeed at start are 
interfering:



dbGetQuery(conn, query):



works:

dbGetQuery(conn, "select * from dual")

dbGetQuery(conn, "select * from dual /* comment */")

dbGetQuery(conn, "select /* comment */ * from dual")



doesn't:

dbGetQuery(conn, "\nselect * from dual")

dbGetQuery(conn, "select\n * from dual")

dbGetQuery(conn, "/* comment */ select * from dual")


From ripley at stats.ox.ac.uk  Wed Dec 20 18:43:47 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 20 Dec 2006 17:43:47 +0000 (GMT)
Subject: [Rd] Connections to https: URLs -- IE expert help needed
Message-ID: <Pine.LNX.4.64.0612201725400.12201@gannet.stats.ox.ac.uk>

I've added to R-devel the ability to use download.file() and url() to 
https: URLs, *only* if --internet2 is used on Windows.

This uses the Internet Explorer internals, and only works if the 
certificate is accepted (so e.g. does not work for 
https://svn.r-project.org).

Now I use IE (and Windows for that matter) only when really necessary, and 
Firefox has simple ways to permanently accept non-verifiable certificates. 
I would be grateful if someone who is much more familiar with IE could 
write a note explaining how to deal with this that we could add to the 
rw-FAQ.

To forestall the inevitable question: there are no plans to add https: 
support on any other platform, but it is something that would make a nice 
project for a user contribution.  The current internal code is based on 
likxml2, and that AFAICS still does not have https: support.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From martin.becker at mx.uni-saarland.de  Wed Dec 20 19:00:00 2006
From: martin.becker at mx.uni-saarland.de (Martin Becker)
Date: Wed, 20 Dec 2006 19:00:00 +0100
Subject: [Rd] Possible bug in cut.Date()
Message-ID: <45897A20.9030600@mx.uni-saarland.de>

Dear list,

I suppose that the behaviour of cut.Date() is not as intended for the 
case ' breaks="year" ' (in R 2.4.1 and previous versions):
The corresponding code fragment which defines the first breakpoint in 
this case reads:

        if (valid == 4) {
            start$mon <- 0
            incr <- 366
        }
 
So the month of the first breakpoint is set to January, but the day of 
month is not set to 1.
This leads to a strange behaviour, see the following example:

 > cut(as.Date(c("2000-01-17","2001-01-13","2001-01-20")),breaks="y")
[1] 2000-01-17 2000-01-17 2001-01-17
Levels: 2000-01-17 2001-01-17

I think, the code fragment above should better read:

        if (valid == 4) {
            start$mon <- 0
            start$mday <- 1
            incr <- 366
        }

(Of course, maybe there are reasons for the current behaviour which I am 
not aware of, and the current behaviour is as intended.)

Regards,

  Martin


From duncan at wald.ucdavis.edu  Wed Dec 20 23:10:41 2006
From: duncan at wald.ucdavis.edu (Duncan Temple Lang)
Date: Wed, 20 Dec 2006 14:10:41 -0800
Subject: [Rd] Connections to https: URLs -- IE expert help needed
In-Reply-To: <Pine.LNX.4.64.0612201725400.12201@gannet.stats.ox.ac.uk>
References: <Pine.LNX.4.64.0612201725400.12201@gannet.stats.ox.ac.uk>
Message-ID: <4589B4E1.8090102@wald.ucdavis.edu>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1



Prof Brian Ripley wrote:
> I've added to R-devel the ability to use download.file() and url() to 
> https: URLs, *only* if --internet2 is used on Windows.
> 
> This uses the Internet Explorer internals, and only works if the 
> certificate is accepted (so e.g. does not work for 
> https://svn.r-project.org).
> 
> Now I use IE (and Windows for that matter) only when really necessary, and 
> Firefox has simple ways to permanently accept non-verifiable certificates. 
> I would be grateful if someone who is much more familiar with IE could 
> write a note explaining how to deal with this that we could add to the 
> rw-FAQ.
> 
> To forestall the inevitable question: there are no plans to add https: 
> support on any other platform, but it is something that would make a nice 
> project for a user contribution.  The current internal code is based on 
> likxml2, and that AFAICS still does not have https: support.
> 

Generally (i.e. not in particular response to Brian but related to this
thread)

An alternative is to use RCurl and leave HTTPS and a host
of other protocols and details to an external library (e.g. libcurl,
libwww, etc.) and an R package that interfaces to it.

If we want the facilities to be accessible via the connections
interface, then we can make that API extensible by packages.
Jeff Horner has a proposal on that.

Generally, it is important if R is to continue to evolve that the R
internals become extensible by package developers so that we can do some
new experiments and provide alternative implementations of the basic
structures rather than being tied to the existing representation.
An object oriented framework underlying the R source code would enable
this and would solve numerous problems that have arisen recently
and I strongly suspect many more that will arise.

 D.


- --
Duncan Temple Lang                    duncan at wald.ucdavis.edu
Department of Statistics              work:  (530) 752-4782
4210 Mathematical Sciences Building   fax:   (530) 752-7099
One Shields Ave.
University of California at Davis
Davis,
CA 95616,
USA
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.3 (Darwin)

iD8DBQFFibTh9p/Jzwa2QP4RAgBiAJ9YojjDf0DMIo9FQ7yW1MiMdANvogCfRgCX
zci7UsavJESdidbyiCl2Xgw=
=HiuE
-----END PGP SIGNATURE-----


From robert.denham at nrm.qld.gov.au  Thu Dec 21 00:57:40 2006
From: robert.denham at nrm.qld.gov.au (robert.denham at nrm.qld.gov.au)
Date: Thu, 21 Dec 2006 00:57:40 +0100 (CET)
Subject: [Rd] R windows crash (PR#9426)
Message-ID: <20061220235740.D29D029D3C@slim.kubism.ku.dk>

Full_Name: Robert Denham
Version: R-2.4.1
OS: Windows Xp
Submission from: (NULL) (61.88.57.1)


R gui exits without warning when I run a function which has an argument with a
default that is not found.  

This was a result of an error in a function I wrote, but I thought that it
should exit more gracefully than it does. Here is an example:


testfun <- function(aa=aa) {
    aa <- lm(y~x,data=aa)
    return(aa)
}

testfun() #R then exits.

Note that 

testfun <- function(aa=bb) {
    aa <- lm(y~x,data=aa)
    return(aa)
}

works as it should, giving "object bb not found".


From matjaz.jeran at amis.net  Wed Dec 20 20:04:47 2006
From: matjaz.jeran at amis.net (matjaz.jeran at amis.net)
Date: Wed, 20 Dec 2006 20:04:47 +0100 (CET)
Subject: [Rd] Missing install libraries for R on OpenSuse 10.2 (PR#9425)
Message-ID: <20061220190447.C08564C9F8@slim.kubism.ku.dk>

Full_Name: Matja? Jeran
Version: R-base-2.4.1-2.1.i58
OS: OpenSuse linux 10.2
Submission from: (NULL) (85.10.21.55)


I have a FRESH installation of Opensuse linux 10.2
I have downloaded R from http://cran.at.r-project.org/bin/linux/suse/10.2/
When I tried to install it the message about missing dependencies appeared:

error: Failed dependencies:
	blas is needed by R-base-2.4.1-2.1.i586
	libgfortran.so.1 is needed by R-base-2.4.1-2.1.i586

The error probably appears because fortran is not included in the suse distro
any more (as e.g in 10.1). I suggest to include the missing libraries in R
package.


From goodrich at fas.harvard.edu  Thu Dec 21 02:08:53 2006
From: goodrich at fas.harvard.edu (goodrich at fas.harvard.edu)
Date: Thu, 21 Dec 2006 02:08:53 +0100 (CET)
Subject: [Rd] Bug in rt() ? (PR#9422)
Message-ID: <20061221010853.B02694421C@slim.kubism.ku.dk>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Prof Brian Ripley wrote:
> Why do you consider this might be a bug in R rather than in your
> expectations?  Your 'expected' is not what others have expected ....

Thank you for this response. I did consider at the time that this
unexpected result could be deliberate, but help(rt) on 2.4.1 seemed to
confirm my expectations. Martin Maechler noted on the first response to
this bug report that help(rt) was not updated to describe the new
functionality of rt().

> In 2.4.1  rt(ncp) operates continuously as ncp is varied through 0.
> That is different from saying that you want a central t (omitting ncp).

I was not expecting random draws from a central t distribution to be the
same as random draws from a limiting case of a non-central t
distribution. I was expecting that redundantly typing the default
arguments of a function would produce the same result as omitting the
default arguments. Are there other functions with this discrepancy?

In other words, I do not understand why rt() continues to default to ncp
= 0, as opposed to no default argument for ncp. It would seem that
args(rt) currently implies that the draws are to be taken from a
limiting case of non-central t distribution, when this is not accurate
if the ncp argument is omitted.

Thanks,
Ben

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org

iD8DBQFFid58zQDSXIcN85kRAhRVAJ0WNf2fMVcPZk4rfxw8qXO272Bs8ACfdVAt
a5OaqyObzqkjL8a5sCooj6w=
=/fPt
-----END PGP SIGNATURE-----


From bcarvalh at jhsph.edu  Thu Dec 21 08:44:27 2006
From: bcarvalh at jhsph.edu (Benilton Carvalho)
Date: Thu, 21 Dec 2006 02:44:27 -0500
Subject: [Rd] Missing install libraries for R on OpenSuse 10.2 (PR#9425)
In-Reply-To: <20061220190447.C08564C9F8@slim.kubism.ku.dk>
References: <20061220190447.C08564C9F8@slim.kubism.ku.dk>
Message-ID: <99C57337-888F-4361-B958-A19FFE11ACF5@jhsph.edu>

Hi Matjaz,

I don't see that as a bug. Instead, you don't have the requirements,  
as you already noticed.

Isn't it simpler just to install the requirements?

See:

http://download.opensuse.org/distribution/10.2/repo/oss/suse/i586/

best,
benilton

On Dec 20, 2006, at 2:04 PM, matjaz.jeran at amis.net wrote:

> Full_Name: Matja? Jeran
> Version: R-base-2.4.1-2.1.i58
> OS: OpenSuse linux 10.2
> Submission from: (NULL) (85.10.21.55)
>
>
> I have a FRESH installation of Opensuse linux 10.2
> I have downloaded R from http://cran.at.r-project.org/bin/linux/ 
> suse/10.2/
> When I tried to install it the message about missing dependencies  
> appeared:
>
> error: Failed dependencies:
> 	blas is needed by R-base-2.4.1-2.1.i586
> 	libgfortran.so.1 is needed by R-base-2.4.1-2.1.i586
>
> The error probably appears because fortran is not included in the  
> suse distro
> any more (as e.g in 10.1). I suggest to include the missing  
> libraries in R
> package.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From ripley at stats.ox.ac.uk  Thu Dec 21 08:56:08 2006
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Thu, 21 Dec 2006 08:56:08 +0100 (CET)
Subject: [Rd] jpeg() and png() in R-2.4.x (PR#9423)
Message-ID: <20061221075608.A1B4156243@slim.kubism.ku.dk>

The file INSTALL says

   The main source of information on installation is the `R Installation
   and Administration Manual', an HTML copy of which is available as file
   `doc/html/R-admin.html'.  Please read that before installing R.  But
   if you are impatient, read on but please refer to the manual to
   resolve any problems.  (If you obtained R using Subversion, the manual
   is at doc/manual/R-admin.texi.)

I suspect this was an installation problem, in which case it is covered in 
that manual.  Configure reports on the capabilities it found, e.g.

   Interfaces supported:      X11, tcltk
   External libraries:        readline
   Additional capabilities:   PNG, JPEG, iconv, MBCS, NLS
   Options enabled:           shared BLAS, R profiling, Java

and you have not told us what your build reported.

An alternative is covered by ?capabilities

      X11: (Unix)  Are the 'X11' graphics device and the X11-based data
           editor available?  This loads the X11 module if not already
           loaded, and checks that the default display can be contacted
           unless a 'X11' device has already been used.

which if false will imply that jpeg and png are not available (but tcltk 
could be).

You need to demonstrate that this really is a bug in R and not a 
mis-report using scarce resources (R-core time).  (The R build not 
magically finding missing components of your OS is not a bug.)


On Wed, 20 Dec 2006, sophie.martin at actigenics.com wrote:

> I have tried to install R-2.4.x on my computer (linux - mandriva 2007 -
> 64bits), with tar file for R-4.2.1 and rpm file for R-2.4.0, and
> function capabilities() says to me that JPG, PNG and TCLTK are not
> available. However, with the version R-2.3.x with whicc I work , they
> are available.
> May be it's a bug, or may be my mandriva 2007 distribution are not all
> required libraries ? But I have not find "REQUIREMENTS" files on the
> CRAN site to verify that.
>
> Thanks for your help,
>
> Sophie Martin

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Thu Dec 21 09:22:54 2006
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Thu, 21 Dec 2006 09:22:54 +0100 (CET)
Subject: [Rd] R windows crash (PR#9426)
Message-ID: <20061221082254.72DEA29D3C@slim.kubism.ku.dk>

The problem is rather that 'aa' *is* found: default arguments are looked 
for within the body of the function, and so the calculation of 'aa' is 
recursive.  Consider the simpler case

> testfun <- function(aa=aa) {aa <- c(aa); aa}
> testfun()
Error in testfun() : recursive default argument reference

On Linux I got

> testfun() #R then exits.
Error: segfault from C stack overflow

Now C stack overflows are instantly fatal on Windows and cannot be caught 
there.  However, using Linux enabled me to locate the loop in a debugger, 
and it is recursion in isMissing to which I have added a stack check.

The remedy is I hope obvious: 'don't do that'.

Adding these checks do have a small but measurable performance cost so we 
have been conservative in adding them.


On Thu, 21 Dec 2006, robert.denham at nrm.qld.gov.au wrote:

> Full_Name: Robert Denham
> Version: R-2.4.1
> OS: Windows Xp
> Submission from: (NULL) (61.88.57.1)
>
>
> R gui exits without warning when I run a function which has an argument with a
> default that is not found.
>
> This was a result of an error in a function I wrote, but I thought that it
> should exit more gracefully than it does. Here is an example:
>
>
> testfun <- function(aa=aa) {
>    aa <- lm(y~x,data=aa)
>    return(aa)
> }
>
> testfun() #R then exits.
>
> Note that
>
> testfun <- function(aa=bb) {
>    aa <- lm(y~x,data=aa)
>    return(aa)
> }
>
> works as it should, giving "object bb not found".
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From detlef.steuer at hsu-hamburg.de  Thu Dec 21 09:01:36 2006
From: detlef.steuer at hsu-hamburg.de (Detlef Steuer)
Date: Thu, 21 Dec 2006 09:01:36 +0100
Subject: [Rd] Missing install libraries for R on OpenSuse 10.2 (PR#9425)
In-Reply-To: <20061220190447.C08564C9F8@slim.kubism.ku.dk>
References: <20061220190447.C08564C9F8@slim.kubism.ku.dk>
Message-ID: <20061221090136.4b0649c5.detlef.steuer@hsu-hamburg.de>

On Wed, 20 Dec 2006 20:04:47 +0100 (CET)
matjaz.jeran at amis.net wrote:

> Full_Name: Matja? Jeran
> Version: R-base-2.4.1-2.1.i58
> OS: OpenSuse linux 10.2
> Submission from: (NULL) (85.10.21.55)
> 
> 
> I have a FRESH installation of Opensuse linux 10.2
> I have downloaded R from http://cran.at.r-project.org/bin/linux/suse/10.2/
> When I tried to install it the message about missing dependencies appeared:
> 
> error: Failed dependencies:
> 	blas is needed by R-base-2.4.1-2.1.i586
> 	libgfortran.so.1 is needed by R-base-2.4.1-2.1.i586
> 
> The error probably appears because fortran is not included in the suse distro
> any more (as e.g in 10.1). I suggest to include the missing libraries in R
> package.

Take a look in the ReadMe for suse. You need to add an online-repository of your choice for blas etc. 

(This is no  r-devel thread! Follow-ups to r-help, please!)

Detlef 

> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From p.dalgaard at biostat.ku.dk  Thu Dec 21 09:29:26 2006
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Thu, 21 Dec 2006 09:29:26 +0100
Subject: [Rd] R windows crash (PR#9426)
In-Reply-To: <20061220235740.D29D029D3C@slim.kubism.ku.dk>
References: <20061220235740.D29D029D3C@slim.kubism.ku.dk>
Message-ID: <458A45E6.3050202@biostat.ku.dk>

robert.denham at nrm.qld.gov.au wrote:
> Full_Name: Robert Denham
> Version: R-2.4.1
> OS: Windows Xp
> Submission from: (NULL) (61.88.57.1)
>
>
> R gui exits without warning when I run a function which has an argument with a
> default that is not found.  
>
> This was a result of an error in a function I wrote, but I thought that it
> should exit more gracefully than it does. Here is an example:
>
>
> testfun <- function(aa=aa) {
>     aa <- lm(y~x,data=aa)
>     return(aa)
> }
>
> testfun() #R then exits.
>
> Note that 
>
> testfun <- function(aa=bb) {
>     aa <- lm(y~x,data=aa)
>     return(aa)
> }
>
> works as it should, giving "object bb not found".
>
>   
This seems reproducible on  Linux, except that it goes into an infinite 
loop. The lm call seems to be the real culprit:

 > testfun <- function(aa=aa) return(aa)
 > testfun()
Error in testfun() : recursive default argument reference
 > testfun <- function(aa=aa) lm(x~y,data=aa)
 > testfun()
(*poof*)


> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From ripley at stats.ox.ac.uk  Thu Dec 21 09:51:31 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 21 Dec 2006 08:51:31 +0000 (GMT)
Subject: [Rd] R windows crash (PR#9426)
In-Reply-To: <458A45E6.3050202@biostat.ku.dk>
References: <20061220235740.D29D029D3C@slim.kubism.ku.dk>
	<458A45E6.3050202@biostat.ku.dk>
Message-ID: <Pine.LNX.4.64.0612210847090.31846@gannet.stats.ox.ac.uk>

On Thu, 21 Dec 2006, Peter Dalgaard wrote:

[...]

> This seems reproducible on  Linux, except that it goes into an infinite
> loop. The lm call seems to be the real culprit:
>
> > testfun <- function(aa=aa) return(aa)
> > testfun()
> Error in testfun() : recursive default argument reference
> > testfun <- function(aa=aa) lm(x~y,data=aa)
> > testfun()
> (*poof*)

The difference is in argument evaluation between closures and internal 
functions (c() in my example, return() in yours).

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From P.Dalgaard at biostat.ku.dk  Thu Dec 21 12:32:21 2006
From: P.Dalgaard at biostat.ku.dk (P.Dalgaard at biostat.ku.dk)
Date: Thu, 21 Dec 2006 12:32:21 +0100 (CET)
Subject: [Rd] R windows crash (PR#9426)
Message-ID: <20061221113221.976C841EC7@slim.kubism.ku.dk>

Prof Brian Ripley wrote:
> On Thu, 21 Dec 2006, Peter Dalgaard wrote:
>
> [...]
>
>   
>> This seems reproducible on  Linux, except that it goes into an infinite
>> loop. The lm call seems to be the real culprit:
>>
>>     
>>> testfun <- function(aa=aa) return(aa)
>>> testfun()
>>>       
>> Error in testfun() : recursive default argument reference
>>     
>>> testfun <- function(aa=aa) lm(x~y,data=aa)
>>> testfun()
>>>       
>> (*poof*)
>>     
>
> The difference is in argument evaluation between closures and internal 
> functions (c() in my example, return() in yours).
>   
Er? I'd rather say that the issue is in the semantics of missing():

> f <- function(x) missing(x)
> testfun <- function(aa=aa) f(aa)
> testfun()
Error: segfault from C stack overflow

which is a bit nasty. AFAICS the thing is that the logic for detection
of recursive arguments works by forcing promises (if you at some point
need the result of the same promise you are forcing, you know that
something is wrong), but missing() tries hard not to force promises. We
already have the following anomaly,

> g <- function(v) missing(v)
> f <- function(v) g(v)
> f()
[1] TRUE
> f <- function(v=!h, h=!v) g(v)
> f()
[1] FALSE
> f <- function(v=!h, h) g(v)
> f()
[1] FALSE

so the fix could be to realize that we cannot detect missingness in a
perfectly reliable way and just pretend that arguments are always
non-missing when they have a default.

[r-bugs reinserted as cc:]

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From hin-tak.leung at cimr.cam.ac.uk  Thu Dec 21 13:32:05 2006
From: hin-tak.leung at cimr.cam.ac.uk (Hin-Tak Leung)
Date: Thu, 21 Dec 2006 12:32:05 +0000
Subject: [Rd] jpeg() and png() in R-2.4.x (PR#9423)
In-Reply-To: <20061221075608.A1B4156243@slim.kubism.ku.dk>
References: <20061221075608.A1B4156243@slim.kubism.ku.dk>
Message-ID: <458A7EC5.1080703@cimr.cam.ac.uk>

Hi Sophie,

(It is not good to abuse the bug system to asking for help that way...
as others no doubt has already written. R-help may be a more
appropriate channel for your questions)

One possibility is your "linux - mandriva 2007 - 64bits"
assertion. I don't use Mandriva myself (my work machine is fedora
6 and home slackware 11), but I had a copy of the Mandriva 2007 
powerplus pack (the "everything+open+proprietary" pack) directly
from one of Mandriva's own technical staff in the last linux-related
conference I went to, because a french collegue of mine wants the
powerplus pack :-).

My french colleague found something quite strange about the mandriva 
pack - all the rpms are listed as for i586 architecture; the readme says
the DVDs are dual-arch and would work on opterons... I don't have access 
to a running Mandriva system, and my french colleague had opted for 
Ubuntu in the end (and it isn't an important/interesting-enough question
I want to ask my mandriva contact directly - one learns not to abuse
useful resources :-) ...), so maybe you can tell me if Mandriva 2007
on opteron is truly dual-arch. I would like to see your output of
"file /usr/lib*/libjpeg*" . Here is mine:

$file /usr/lib*/libjpeg*
/usr/lib64/libjpeg.so:        symbolic link to `libjpeg.so.62.0.0'
/usr/lib64/libjpeg.so.62:     symbolic link to `libjpeg.so.62.0.0'
/usr/lib64/libjpeg.so.62.0.0: ELF 64-bit LSB shared object, AMD x86-64, 
version 1 (SYSV), stripped
/usr/lib/libjpeg.so:          symbolic link to `libjpeg.so.62'
/usr/lib/libjpeg.so.62:       symbolic link to `libjpeg.so.62.0.0'
/usr/lib/libjpeg.so.62.0.0:   ELF 32-bit LSB shared object, Intel 80386, 
version 1 (SYSV), stripped

and your "file /usr/lib*/R/lib/*" output (or equivalent where you 
install your R 2.4 and R 2.3). Here is mine (I have both 32-bit R
and 64-bit R on my system):

$ file /usr/lib*/R/lib/*
/usr/lib64/R/lib/libRblas.so:   ELF 64-bit LSB shared object, AMD 
x86-64, version 1 (SYSV), stripped
/usr/lib64/R/lib/libRlapack.so: ELF 64-bit LSB shared object, AMD 
x86-64, version 1 (SYSV), stripped
/usr/lib64/R/lib/libR.so:       ELF 64-bit LSB shared object, AMD 
x86-64, version 1 (SYSV), stripped
/usr/lib/R/lib/libRblas.so:     ELF 32-bit LSB shared object, Intel 
80386, version 1 (SYSV), stripped
/usr/lib/R/lib/libRlapack.so:   ELF 32-bit LSB shared object, Intel 
80386, version 1 (SYSV), stripped
/usr/lib/R/lib/libR.so:         ELF 32-bit LSB shared object, Intel 
80386, version 1 (SYSV), stripped

One possibility is that your R 2.3 is 32-bit and you just have 32-bits 
of everything and limited 64-bit support. (and you want to talk to 
Mandriva and/or dig out your mandriva DVD if such is that case).

Good luck.

Hin-Tak Leung

ripley at stats.ox.ac.uk wrote:
> The file INSTALL says
> 
>    The main source of information on installation is the `R Installation
>    and Administration Manual', an HTML copy of which is available as file
>    `doc/html/R-admin.html'.  Please read that before installing R.  But
>    if you are impatient, read on but please refer to the manual to
>    resolve any problems.  (If you obtained R using Subversion, the manual
>    is at doc/manual/R-admin.texi.)
> 
> I suspect this was an installation problem, in which case it is covered in 
> that manual.  Configure reports on the capabilities it found, e.g.
> 
>    Interfaces supported:      X11, tcltk
>    External libraries:        readline
>    Additional capabilities:   PNG, JPEG, iconv, MBCS, NLS
>    Options enabled:           shared BLAS, R profiling, Java
> 
> and you have not told us what your build reported.
> 
> An alternative is covered by ?capabilities
> 
>       X11: (Unix)  Are the 'X11' graphics device and the X11-based data
>            editor available?  This loads the X11 module if not already
>            loaded, and checks that the default display can be contacted
>            unless a 'X11' device has already been used.
> 
> which if false will imply that jpeg and png are not available (but tcltk 
> could be).
> 
> You need to demonstrate that this really is a bug in R and not a 
> mis-report using scarce resources (R-core time).  (The R build not 
> magically finding missing components of your OS is not a bug.)
> 
> 
> On Wed, 20 Dec 2006, sophie.martin at actigenics.com wrote:
> 
>> I have tried to install R-2.4.x on my computer (linux - mandriva 2007 -
>> 64bits), with tar file for R-4.2.1 and rpm file for R-2.4.0, and
>> function capabilities() says to me that JPG, PNG and TCLTK are not
>> available. However, with the version R-2.3.x with whicc I work , they
>> are available.
>> May be it's a bug, or may be my mandriva 2007 distribution are not all
>> required libraries ? But I have not find "REQUIREMENTS" files on the
>> CRAN site to verify that.
>>
>> Thanks for your help,
>>
>> Sophie Martin
>


From luke at stat.uiowa.edu  Thu Dec 21 14:32:04 2006
From: luke at stat.uiowa.edu (Luke Tierney)
Date: Thu, 21 Dec 2006 07:32:04 -0600 (CST)
Subject: [Rd] R windows crash (PR#9426)
In-Reply-To: <20061221113221.976C841EC7@slim.kubism.ku.dk>
References: <20061221113221.976C841EC7@slim.kubism.ku.dk>
Message-ID: <Pine.LNX.4.64.0612210729290.14440@itasca2.wildberry.org>

On Thu, 21 Dec 2006, P.Dalgaard at biostat.ku.dk wrote:

> Prof Brian Ripley wrote:
>> On Thu, 21 Dec 2006, Peter Dalgaard wrote:
>>
>> [...]
>>
>>
>>> This seems reproducible on  Linux, except that it goes into an infinite
>>> loop. The lm call seems to be the real culprit:
>>>
>>>
>>>> testfun <- function(aa=aa) return(aa)
>>>> testfun()
>>>>
>>> Error in testfun() : recursive default argument reference
>>>
>>>> testfun <- function(aa=aa) lm(x~y,data=aa)
>>>> testfun()
>>>>
>>> (*poof*)
>>>
>>
>> The difference is in argument evaluation between closures and internal
>> functions (c() in my example, return() in yours).
>>
> Er? I'd rather say that the issue is in the semantics of missing():
>
>> f <- function(x) missing(x)
>> testfun <- function(aa=aa) f(aa)
>> testfun()
> Error: segfault from C stack overflow
>
> which is a bit nasty. AFAICS the thing is that the logic for detection
> of recursive arguments works by forcing promises (if you at some point
> need the result of the same promise you are forcing, you know that
> something is wrong), but missing() tries hard not to force promises. We
> already have the following anomaly,
>
>> g <- function(v) missing(v)
>> f <- function(v) g(v)
>> f()
> [1] TRUE
>> f <- function(v=!h, h=!v) g(v)
>> f()
> [1] FALSE
>> f <- function(v=!h, h) g(v)
>> f()
> [1] FALSE
>
> so the fix could be to realize that we cannot detect missingness in a
> perfectly reliable way and just pretend that arguments are always
> non-missing when they have a default.

We could also mark the promise created for default arguments so it can
be identified as such and use that info in missing().  Probably worth
deciding what the intended semantics are here and then figuring out
the implementation.

Best,

luke


-- 
Luke Tierney
Chair, Statistics and Actuarial Science
Ralph E. Wareham Professor of Mathematical Sciences
University of Iowa                  Phone:             319-335-3386
Department of Statistics and        Fax:               319-335-3017
    Actuarial Science
241 Schaeffer Hall                  email:      luke at stat.uiowa.edu
Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu


From P.Dalgaard at biostat.ku.dk  Thu Dec 21 15:37:18 2006
From: P.Dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Thu, 21 Dec 2006 15:37:18 +0100
Subject: [Rd] R windows crash (PR#9426)
In-Reply-To: <Pine.LNX.4.64.0612210729290.14440@itasca2.wildberry.org>
References: <20061221113221.976C841EC7@slim.kubism.ku.dk>
	<Pine.LNX.4.64.0612210729290.14440@itasca2.wildberry.org>
Message-ID: <458A9C1E.6070604@biostat.ku.dk>

Luke Tierney wrote:
> On Thu, 21 Dec 2006, P.Dalgaard at biostat.ku.dk wrote:
>
>   
>> Prof Brian Ripley wrote:
>>     
>>> On Thu, 21 Dec 2006, Peter Dalgaard wrote:
>>>
>>> [...]
>>>
>>>
>>>       
>>>> This seems reproducible on  Linux, except that it goes into an infinite
>>>> loop. The lm call seems to be the real culprit:
>>>>
>>>>
>>>>         
>>>>> testfun <- function(aa=aa) return(aa)
>>>>> testfun()
>>>>>
>>>>>           
>>>> Error in testfun() : recursive default argument reference
>>>>
>>>>         
>>>>> testfun <- function(aa=aa) lm(x~y,data=aa)
>>>>> testfun()
>>>>>
>>>>>           
>>>> (*poof*)
>>>>
>>>>         
>>> The difference is in argument evaluation between closures and internal
>>> functions (c() in my example, return() in yours).
>>>
>>>       
>> Er? I'd rather say that the issue is in the semantics of missing():
>>
>>     
>>> f <- function(x) missing(x)
>>> testfun <- function(aa=aa) f(aa)
>>> testfun()
>>>       
>> Error: segfault from C stack overflow
>>
>> which is a bit nasty. AFAICS the thing is that the logic for detection
>> of recursive arguments works by forcing promises (if you at some point
>> need the result of the same promise you are forcing, you know that
>> something is wrong), but missing() tries hard not to force promises. We
>> already have the following anomaly,
>>
>>     
>>> g <- function(v) missing(v)
>>> f <- function(v) g(v)
>>> f()
>>>       
>> [1] TRUE
>>     
>>> f <- function(v=!h, h=!v) g(v)
>>> f()
>>>       
>> [1] FALSE
>>     
>>> f <- function(v=!h, h) g(v)
>>> f()
>>>       
>> [1] FALSE
>>
>> so the fix could be to realize that we cannot detect missingness in a
>> perfectly reliable way and just pretend that arguments are always
>> non-missing when they have a default.
>>     
>
> We could also mark the promise created for default arguments so it can
> be identified as such and use that info in missing().  Probably worth
> deciding what the intended semantics are here and then figuring out
> the implementation.
>
>   
Yes, always a good idea...

Just to be precise: The current semantics seems to be that we stop and
declare missingness to be FALSE if any sort of computation is involved
in the default:

> f <- function(v=h,h=v) g(v)
> f()
Error: segfault from C stack overflow

but

> f <- function(v=(v)) g(v)
> f()
[1] FALSE



-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From spencer.graves at pdf.com  Thu Dec 21 22:07:04 2006
From: spencer.graves at pdf.com (Spencer Graves)
Date: Thu, 21 Dec 2006 13:07:04 -0800
Subject: [Rd] Problem installing MinGW 5.0.3: Your internet connection seems
 to be not permitted or dropped out!
Message-ID: <458AF778.6000001@pdf.com>

Hi, All: 

      I'm having trouble installing MinGW 5.0.3, trying to follow Duncan 
Murdoch's suggestions (http://www.murdoch-sutherland.com/Rtools/).  I 
download "MinGW-5.0.3.exe" as he suggested.  After double-clicking on 
it, I get past "Welcome to MinGW" and select either "Download and 
install" or "Download only" and choose to install "Current".  Whether I 
select only "MinGW base tools" or that plus "g++" and "g77" compilers, I 
get the following error message while "Downloading 
mingw-runtime-3.10.tar.gz": 

      "InetClinet plug-in:  Your internet connection seems to be not 
permitted or dropped out!  Please reconnect and click Retry to resume 
installation." 

      After clicking "cancel", I got the following error message: 

downloading mingw-runtime-3.10.tar.gz
SendRequest Error
Could not download 
http://error.dl.sourceforge.net/sourceforge/mingw/mingw-runtime-3.10.tar.gz!

      I got this on two computers, one running Windows 2000 server and 
the other using Windows XP 5.1, Service Pack 2. 

      What do you suggest I try to get past this? 
      Thanks,
      Spencer Graves


From marc_schwartz at comcast.net  Thu Dec 21 22:21:35 2006
From: marc_schwartz at comcast.net (Marc Schwartz)
Date: Thu, 21 Dec 2006 15:21:35 -0600
Subject: [Rd] Problem installing MinGW 5.0.3: Your internet
	connection	seems to be not permitted or dropped out!
In-Reply-To: <458AF778.6000001@pdf.com>
References: <458AF778.6000001@pdf.com>
Message-ID: <1166736095.17456.26.camel@localhost.localdomain>

On Thu, 2006-12-21 at 13:07 -0800, Spencer Graves wrote:
> Hi, All: 
> 
>       I'm having trouble installing MinGW 5.0.3, trying to follow Duncan 
> Murdoch's suggestions (http://www.murdoch-sutherland.com/Rtools/).  I 
> download "MinGW-5.0.3.exe" as he suggested.  After double-clicking on 
> it, I get past "Welcome to MinGW" and select either "Download and 
> install" or "Download only" and choose to install "Current".  Whether I 
> select only "MinGW base tools" or that plus "g++" and "g77" compilers, I get the following error message while "Downloading 
> mingw-runtime-3.10.tar.gz": 
> 
>       "InetClinet plug-in:  Your internet connection seems to be not 
> permitted or dropped out!  Please reconnect and click Retry to resume 
> installation." 
> 
>       After clicking "cancel", I got the following error message: 
> 
> downloading mingw-runtime-3.10.tar.gz
> SendRequest Error
> Could not download 
> http://error.dl.sourceforge.net/sourceforge/mingw/mingw-runtime-3.10.tar.gz!
> 
>       I got this on two computers, one running Windows 2000 server and 
> the other using Windows XP 5.1, Service Pack 2. 
> 
>       What do you suggest I try to get past this? 
>       Thanks,
>       Spencer Graves


Trying that URL in a browser, it indicates that there is no such server.

The following URL:

http://prdownloads.sourceforge.net/mingw/mingw-runtime-3.11.tar.gz?download

does get a file, note however that the most recent version appears to be
3.11, not 3.10.

The home page for the project is here:

http://sourceforge.net/projects/mingw/

There appears to be a more up to date version of MinGW (5.1.2) however,
I would defer to Duncan as to related issues, since I don't run Windows.

HTH,

Marc Schwartz


From murdoch at stats.uwo.ca  Thu Dec 21 22:39:09 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Thu, 21 Dec 2006 16:39:09 -0500
Subject: [Rd] Problem installing MinGW 5.0.3: Your internet connection
 seems to be not permitted or dropped out!
In-Reply-To: <458AF778.6000001@pdf.com>
References: <458AF778.6000001@pdf.com>
Message-ID: <458AFEFD.5080905@stats.uwo.ca>

Their automatic installer is a bit flaky.  You may need to install the 
packages manually.  And as Marc pointed out, 5.0.3 is no longer the 
latest.  I haven't tried 5.1.2 yet, but I'll probably update soon.

Duncan Murdoch

On 12/21/2006 4:07 PM, Spencer Graves wrote:
> Hi, All: 
> 
>       I'm having trouble installing MinGW 5.0.3, trying to follow Duncan 
> Murdoch's suggestions (http://www.murdoch-sutherland.com/Rtools/).  I 
> download "MinGW-5.0.3.exe" as he suggested.  After double-clicking on 
> it, I get past "Welcome to MinGW" and select either "Download and 
> install" or "Download only" and choose to install "Current".  Whether I 
> select only "MinGW base tools" or that plus "g++" and "g77" compilers, I 
> get the following error message while "Downloading 
> mingw-runtime-3.10.tar.gz": 
> 
>       "InetClinet plug-in:  Your internet connection seems to be not 
> permitted or dropped out!  Please reconnect and click Retry to resume 
> installation." 
> 
>       After clicking "cancel", I got the following error message: 
> 
> downloading mingw-runtime-3.10.tar.gz
> SendRequest Error
> Could not download 
> http://error.dl.sourceforge.net/sourceforge/mingw/mingw-runtime-3.10.tar.gz!
> 
>       I got this on two computers, one running Windows 2000 server and 
> the other using Windows XP 5.1, Service Pack 2. 
> 
>       What do you suggest I try to get past this? 
>       Thanks,
>       Spencer Graves


From wuolong at gmail.com  Thu Dec 21 18:08:15 2006
From: wuolong at gmail.com (Michael)
Date: Thu, 21 Dec 2006 11:08:15 -0600
Subject: [Rd] variable scope in update(): bug or feature?
Message-ID: <c2hcvp2n40.fsf@bass.biostat.umn.edu>


I stumbled upon this when using update() (specifically update.lm()).  If
in the original call to lm(), say

a <- lm (y ~ x + z, data = mydata)

where y and z are in data frame mydata but x is in the global environment.

Then if later I run,

a0 <- update (a, ~ . - z)

a0$model will contain values of x in the global environment which may well
be different, even different length from mydata$y.  Somehow, update() pads
a0$model to have the same number of rows as the length of x.

I would think that it would desirable to use x as in a$model rather than the
global one.  

Is this a bug or a deliberate feature?

Thanks,

Michael


From bolker at zoo.ufl.edu  Fri Dec 22 04:48:23 2006
From: bolker at zoo.ufl.edu (Ben Bolker)
Date: Thu, 21 Dec 2006 22:48:23 -0500
Subject: [Rd] tiny typo in ?formals
Message-ID: <458B5587.3030202@zoo.ufl.edu>


  in 2.4.1:

under Value,

"The replacment [sic] form sets the formals of a function ..."

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 254 bytes
Desc: OpenPGP digital signature
Url : https://stat.ethz.ch/pipermail/r-devel/attachments/20061221/e6b4bb0b/attachment.bin 

From spencer.graves at pdf.com  Fri Dec 22 06:44:05 2006
From: spencer.graves at pdf.com (Spencer Graves)
Date: Thu, 21 Dec 2006 21:44:05 -0800
Subject: [Rd] Problem installing MinGW 5.0.3: Your internet connection
 seems to be not permitted or dropped out!
In-Reply-To: <458AFEFD.5080905@stats.uwo.ca>
References: <458AF778.6000001@pdf.com> <458AFEFD.5080905@stats.uwo.ca>
Message-ID: <458B70A5.8060204@pdf.com>

Hi, Duncan, Marc: 
  
      Thanks.  MinGW 5.1.2 seemed to install OK. 

      Best Wishes,
      Spencer Graves

Duncan Murdoch wrote:
> Their automatic installer is a bit flaky.  You may need to install the 
> packages manually.  And as Marc pointed out, 5.0.3 is no longer the 
> latest.  I haven't tried 5.1.2 yet, but I'll probably update soon.
>
> Duncan Murdoch
>
> On 12/21/2006 4:07 PM, Spencer Graves wrote:
>> Hi, All:
>>       I'm having trouble installing MinGW 5.0.3, trying to follow 
>> Duncan Murdoch's suggestions 
>> (http://www.murdoch-sutherland.com/Rtools/).  I download 
>> "MinGW-5.0.3.exe" as he suggested.  After double-clicking on it, I 
>> get past "Welcome to MinGW" and select either "Download and install" 
>> or "Download only" and choose to install "Current".  Whether I select 
>> only "MinGW base tools" or that plus "g++" and "g77" compilers, I get 
>> the following error message while "Downloading 
>> mingw-runtime-3.10.tar.gz":
>>       "InetClinet plug-in:  Your internet connection seems to be not 
>> permitted or dropped out!  Please reconnect and click Retry to resume 
>> installation."
>>       After clicking "cancel", I got the following error message:
>> downloading mingw-runtime-3.10.tar.gz
>> SendRequest Error
>> Could not download 
>> http://error.dl.sourceforge.net/sourceforge/mingw/mingw-runtime-3.10.tar.gz! 
>>
>>
>>       I got this on two computers, one running Windows 2000 server 
>> and the other using Windows XP 5.1, Service Pack 2.
>>       What do you suggest I try to get past this?       Thanks,
>>       Spencer Graves
>
>


From deepayan.sarkar at gmail.com  Fri Dec 22 07:07:27 2006
From: deepayan.sarkar at gmail.com (Deepayan Sarkar)
Date: Thu, 21 Dec 2006 22:07:27 -0800
Subject: [Rd] apropos changes in r-devel: intended feature or bug?
Message-ID: <eb555e660612212207q761861a1r7e95b7bdc3a8b6eb@mail.gmail.com>

The old apropos started with:

    if (!is.character(what))
        what <- as.character(substitute(what))

The new one has:

   if (character.only)
        stopifnot(is.character(what))
    else what <- as.character(substitute(what))

i.e., the check for is.character(what) is missing. This has the effect
that 'what' can no longer be a character string generated by a
function call unless 'character.only = TRUE'. I don't think this was
intended; the change makes previously valid use invalid and I can't
think of a situation where it is useful.

-Deepayan


> apropos(paste("^", "lm", sep = ""))
[1] "paste"
There were 12 warnings (use warnings() to see them)
> warnings()
Warning messages:
1: the condition has length > 1 and only the first element will be
used in: if (is.na(pattern)) {  ...
2: the condition has length > 1 and only the first element will be
used in: if (is.na(pattern)) {  ...
3: the condition has length > 1 and only the first element will be
used in: if (is.na(pattern)) {  ...
...

> sessionInfo()
R version 2.5.0 Under development (unstable) (2006-12-21 r40280)
powerpc-unknown-linux-gnu

locale:
LC_CTYPE=bn_IN.UTF-8;[etc etc]

attached base packages:
[1] "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"
[7] "base"


From dhinds at sonic.net  Fri Dec 22 07:36:28 2006
From: dhinds at sonic.net (dhinds at sonic.net)
Date: Fri, 22 Dec 2006 06:36:28 +0000 (UTC)
Subject: [Rd] DBI + ROracle problem with parser ?? (PR#9424)
References: <20061220134024.36DDD57334@slim.kubism.ku.dk>
Message-ID: <emfudc$kra$1@sea.gmane.org>

christian.hoffmann at wsl.ch wrote:

> doesn't:

> dbGetQuery(conn, "\nselect * from dual")

> dbGetQuery(conn, "select\n * from dual")

> dbGetQuery(conn, "/* comment */ select * from dual")

This sounds like my doing.  What version of Oracle are you using?
Oracle 9i has a bug that interferes with the documented mechanism for
asking Oracle for the type of an SQL statement (i.e. whether it is a
query returning row data, or a statement that modifies rows).  So I
asked David James for a quick fix that consisted of checking the
beginning of the SQL for either "select" or "with".

We could be more sophisticated about parsing things, I guess skipping
over any arbitrary combination of comments and white space.  Or, if
you're using a version of Oracle not affected by the bug, you can edit
src/Makefile and comment out the line:

  WORKAROUND = "-DRS_ORA_SQLGLS_WORKAROUND"

-- Dave


From maechler at stat.math.ethz.ch  Fri Dec 22 09:14:18 2006
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Fri, 22 Dec 2006 09:14:18 +0100
Subject: [Rd] apropos changes in r-devel: intended feature or bug?
In-Reply-To: <eb555e660612212207q761861a1r7e95b7bdc3a8b6eb@mail.gmail.com>
References: <eb555e660612212207q761861a1r7e95b7bdc3a8b6eb@mail.gmail.com>
Message-ID: <17803.37850.646209.904350@stat.math.ethz.ch>

>>>>> "DeepS" == Deepayan Sarkar <deepayan.sarkar at gmail.com>
>>>>>     on Thu, 21 Dec 2006 22:07:27 -0800 writes:

    DeepS> The old apropos started with: if
    DeepS> (!is.character(what)) what <-
    DeepS> as.character(substitute(what))

    DeepS> The new one has:

    DeepS>    if (character.only) stopifnot(is.character(what))
    DeepS>    else what <- as.character(substitute(what))

    DeepS> i.e., the check for is.character(what) is
    DeepS> missing. This has the effect that 'what' can no
    DeepS> longer be a character string generated by a function
    DeepS> call unless 'character.only = TRUE'. I don't think
    DeepS> this was intended; the change makes previously valid
    DeepS> use invalid and I can't think of a situation where it
    DeepS> is useful.

[ Did you read the corresponding NEWS entry? ]

It now parallelizes the use in library() , require() etc,
and in particular does what the documentation says it does!

The old behavior was much less consistent and not according to
documentation:

     apropos(lm)    was equivalent to apropos("lm")
but  apropos(fit)   gave an error.

Martin

    DeepS> -Deepayan


From maechler at stat.math.ethz.ch  Fri Dec 22 09:17:21 2006
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Fri, 22 Dec 2006 09:17:21 +0100
Subject: [Rd] variable scope in update(): bug or feature?
In-Reply-To: <c2hcvp2n40.fsf@bass.biostat.umn.edu>
References: <c2hcvp2n40.fsf@bass.biostat.umn.edu>
Message-ID: <17803.38033.644533.557922@stat.math.ethz.ch>

Hi Michael,
can you please

- use a simple reproducible example -- 
  just for the convenience of your readers

- use R-help.  This is really a question about R.



>>>>> "Michael" == Michael  <wuolong at gmail.com>
>>>>>     on Thu, 21 Dec 2006 11:08:15 -0600 writes:

    Michael> I stumbled upon this when using update()
    Michael> (specifically update.lm()).  If in the original
    Michael> call to lm(), say

    Michael> a <- lm (y ~ x + z, data = mydata)

    Michael> where y and z are in data frame mydata but x is in
    Michael> the global environment.

    Michael> Then if later I run,

    Michael> a0 <- update (a, ~ . - z)

    Michael> a0$model will contain values of x in the global
    Michael> environment which may well be different, even
    Michael> different length from mydata$y.  Somehow, update()
    Michael> pads a0$model to have the same number of rows as
    Michael> the length of x.

    Michael> I would think that it would desirable to use x as
    Michael> in a$model rather than the global one.

    Michael> Is this a bug or a deliberate feature?

    Michael> Thanks,

    Michael> Michael

    Michael> ______________________________________________
    Michael> R-devel at r-project.org mailing list
    Michael> https://stat.ethz.ch/mailman/listinfo/r-devel


From ripley at stats.ox.ac.uk  Fri Dec 22 09:52:24 2006
From: ripley at stats.ox.ac.uk (Brian Ripley)
Date: Fri, 22 Dec 2006 08:52:24 +0000 (GMT)
Subject: [Rd] tiny typo in ?formals
In-Reply-To: <458B5587.3030202@zoo.ufl.edu>
References: <458B5587.3030202@zoo.ufl.edu>
Message-ID: <Pine.LNX.4.64.0612220851350.20687@auk.stats>

Thanks!

I took the opportunity to run aspell over all the help pages, so this 
turned into a few dozen small corrections.

On Thu, 21 Dec 2006, Ben Bolker wrote:

>
>  in 2.4.1:
>
> under Value,
>
> "The replacment [sic] form sets the formals of a function ..."
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From Bill.Venables at csiro.au  Fri Dec 22 01:46:56 2006
From: Bill.Venables at csiro.au (Bill.Venables at csiro.au)
Date: Fri, 22 Dec 2006 01:46:56 +0100 (CET)
Subject: [Rd] substitute creates an object which prints incorrectly (PR#9427)
Message-ID: <20061222004656.0131E4C99B@slim.kubism.ku.dk>

The function "substitute" seems to fail to make a genuine
substitution, although the printed verision seems fine.  Here is an
example.

> m <- substitute(Y <- function(x) FUN(x+1), 
+ list(Y = as.name("y"), FUN = as.name("sin")))
> m
y <- function(x) sin(x + 1)
> eval(m)
> y
function(x) FUN(x+1)

However the story doesn't end there.  The substitution appears to have
been made, even though the printed version, this time, suggests
otherwise.

> y(pi)
[1] -0.841471
> sin(pi+1)
[1] -0.841471
>

Bill Venables 
CMIS, CSIRO Laboratories, 
PO Box 120, Cleveland, Qld. 4163 
AUSTRALIA 
Office Phone (email preferred): +61 7 3826 7251 
Fax (if absolutely necessary):    +61 7 3826 7304 
Mobile (rarely used):                +61 4 1963 4642 
Home Phone:                          +61 7 3286 7700 
mailto:Bill.Venables at csiro.au 
http://www.cmis.csiro.au/bill.venables/ 


--please do not edit the information below--

Version:
 platform = i386-pc-mingw32
 arch = i386
 os = mingw32
 system = i386, mingw32
 status = 
 major = 2
 minor = 4.1
 year = 2006
 month = 12
 day = 18
 svn rev = 40228
 language = R
 version.string = R version 2.4.1 (2006-12-18)

Windows XP Professional (build 2600) Service Pack 2.0

Locale:
LC_COLLATE=English_Australia.1252;LC_CTYPE=English_Australia.1252;LC_MON
ETARY=English_Australia.1252;LC_NUMERIC=C;LC_TIME=English_Australia.1252

Search Path:
 .GlobalEnv, .R_Store, package:RODBC, package:xlsReadWrite,
package:cluster, package:vegan, package:ASOR, package:stats,
package:graphics, package:grDevices, package:utils, package:datasets,
.R_Data, .R_Utils, package:svIDE, package:tcltk, package:methods,
Autoloads, package:base


From p.dalgaard at biostat.ku.dk  Fri Dec 22 12:47:22 2006
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Fri, 22 Dec 2006 12:47:22 +0100
Subject: [Rd] substitute creates an object which prints incorrectly
	(PR#9427)
In-Reply-To: <20061222004656.0131E4C99B@slim.kubism.ku.dk>
References: <20061222004656.0131E4C99B@slim.kubism.ku.dk>
Message-ID: <458BC5CA.7010003@biostat.ku.dk>

Bill.Venables at csiro.au wrote:
> The function "substitute" seems to fail to make a genuine
> substitution, although the printed verision seems fine.  Here is an
> example.
>
>   
>> m <- substitute(Y <- function(x) FUN(x+1), 
>>     
> + list(Y = as.name("y"), FUN = as.name("sin")))
>   
>> m
>>     
> y <- function(x) sin(x + 1)
>   
>> eval(m)
>> y
>>     
> function(x) FUN(x+1)
>
> However the story doesn't end there.  The substitution appears to have
> been made, even though the printed version, this time, suggests
> otherwise.
>
>   
>> y(pi)
>>     
> [1] -0.841471
>   
>> sin(pi+1)
>>     
> [1] -0.841471
>   
>
>   
Yes, this is (fairly) well known. It has to do with the retention of 
function source.

The thing to notice is that it is only the printing of y that is really 
confused. If you do

dput(y)
attr(y, "source")
attr(y, "source") <- NULL
y

then you should see the point. The tricky bit is that the "source" 
attribute exists in an intermediate form inside m. Notice that m 
contains, not the function itself, but a call to the function `function` 
which creates the function when eval'ed. This call contains the function 
source as its 4th element (look at m[[3]][[4]] in your example), and you 
might try setting it to NULL and see how things will clear up.

The issue with substitute is that it cannot sensibly substitute into 
character vectors, so it just leaves  the source as is, which gives the 
symptoms you see. It could, however, and probably should, recognize 
calls to `function` and NULL out their 4th element. It cannot be done 
completely failsafe though (`function` could result from a computation, 
or even be part of the substitution), so one has to decide that the 
extreme cases are too extreme worry about them.
 
-pd

> Bill Venables 
> CMIS, CSIRO Laboratories, 
> PO Box 120, Cleveland, Qld. 4163 
> AUSTRALIA 
> Office Phone (email preferred): +61 7 3826 7251 
> Fax (if absolutely necessary):    +61 7 3826 7304 
> Mobile (rarely used):                +61 4 1963 4642 
> Home Phone:                          +61 7 3286 7700 
> mailto:Bill.Venables at csiro.au 
> http://www.cmis.csiro.au/bill.venables/ 
>
>
> --please do not edit the information below--
>
> Version:
>  platform = i386-pc-mingw32
>  arch = i386
>  os = mingw32
>  system = i386, mingw32
>  status = 
>  major = 2
>  minor = 4.1
>  year = 2006
>  month = 12
>  day = 18
>  svn rev = 40228
>  language = R
>  version.string = R version 2.4.1 (2006-12-18)
>
> Windows XP Professional (build 2600) Service Pack 2.0
>
> Locale:
> LC_COLLATE=English_Australia.1252;LC_CTYPE=English_Australia.1252;LC_MON
> ETARY=English_Australia.1252;LC_NUMERIC=C;LC_TIME=English_Australia.1252
>
> Search Path:
>  .GlobalEnv, .R_Store, package:RODBC, package:xlsReadWrite,
> package:cluster, package:vegan, package:ASOR, package:stats,
> package:graphics, package:grDevices, package:utils, package:datasets,
> .R_Data, .R_Utils, package:svIDE, package:tcltk, package:methods,
> Autoloads, package:base
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From ggrothendieck at gmail.com  Fri Dec 22 13:17:02 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Fri, 22 Dec 2006 07:17:02 -0500
Subject: [Rd] substitute creates an object which prints incorrectly
	(PR#9427)
In-Reply-To: <20061222004656.0131E4C99B@slim.kubism.ku.dk>
References: <20061222004656.0131E4C99B@slim.kubism.ku.dk>
Message-ID: <971536df0612220417o235b1dadh96f3c75c9f3ec38d@mail.gmail.com>

Try issuing the command:

   options(keep.source = FALSE)

prior to running the code you displayed to force the actual source,
rather than the source attribute, to be displayed by print when printing
functions.

On 12/21/06, Bill.Venables at csiro.au <Bill.Venables at csiro.au> wrote:
> The function "substitute" seems to fail to make a genuine
> substitution, although the printed verision seems fine.  Here is an
> example.
>
> > m <- substitute(Y <- function(x) FUN(x+1),
> + list(Y = as.name("y"), FUN = as.name("sin")))
> > m
> y <- function(x) sin(x + 1)
> > eval(m)
> > y
> function(x) FUN(x+1)
>
> However the story doesn't end there.  The substitution appears to have
> been made, even though the printed version, this time, suggests
> otherwise.
>
> > y(pi)
> [1] -0.841471
> > sin(pi+1)
> [1] -0.841471
> >
>
> Bill Venables
> CMIS, CSIRO Laboratories,
> PO Box 120, Cleveland, Qld. 4163
> AUSTRALIA
> Office Phone (email preferred): +61 7 3826 7251
> Fax (if absolutely necessary):    +61 7 3826 7304
> Mobile (rarely used):                +61 4 1963 4642
> Home Phone:                          +61 7 3286 7700
> mailto:Bill.Venables at csiro.au
> http://www.cmis.csiro.au/bill.venables/
>
>
> --please do not edit the information below--
>
> Version:
>  platform = i386-pc-mingw32
>  arch = i386
>  os = mingw32
>  system = i386, mingw32
>  status =
>  major = 2
>  minor = 4.1
>  year = 2006
>  month = 12
>  day = 18
>  svn rev = 40228
>  language = R
>  version.string = R version 2.4.1 (2006-12-18)
>
> Windows XP Professional (build 2600) Service Pack 2.0
>
> Locale:
> LC_COLLATE=English_Australia.1252;LC_CTYPE=English_Australia.1252;LC_MON
> ETARY=English_Australia.1252;LC_NUMERIC=C;LC_TIME=English_Australia.1252
>
> Search Path:
>  .GlobalEnv, .R_Store, package:RODBC, package:xlsReadWrite,
> package:cluster, package:vegan, package:ASOR, package:stats,
> package:graphics, package:grDevices, package:utils, package:datasets,
> .R_Data, .R_Utils, package:svIDE, package:tcltk, package:methods,
> Autoloads, package:base
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From Kurt.Hornik at wu-wien.ac.at  Fri Dec 22 13:48:03 2006
From: Kurt.Hornik at wu-wien.ac.at (Kurt Hornik)
Date: Fri, 22 Dec 2006 13:48:03 +0100
Subject: [Rd] apropos changes in r-devel: intended feature or bug?
In-Reply-To: <17803.37850.646209.904350@stat.math.ethz.ch>
References: <eb555e660612212207q761861a1r7e95b7bdc3a8b6eb@mail.gmail.com>
	<17803.37850.646209.904350@stat.math.ethz.ch>
Message-ID: <17803.54275.647233.118289@mithrandir.hornik.net>

>>>>> Martin Maechler writes:

>>>>> "DeepS" == Deepayan Sarkar <deepayan.sarkar at gmail.com>
>>>>>     on Thu, 21 Dec 2006 22:07:27 -0800 writes:

DeepS> The old apropos started with: if
DeepS> (!is.character(what)) what <-
DeepS> as.character(substitute(what))

DeepS> The new one has:

DeepS> if (character.only) stopifnot(is.character(what))
DeepS> else what <- as.character(substitute(what))

DeepS> i.e., the check for is.character(what) is
DeepS> missing. This has the effect that 'what' can no
DeepS> longer be a character string generated by a function
DeepS> call unless 'character.only = TRUE'. I don't think
DeepS> this was intended; the change makes previously valid
DeepS> use invalid and I can't think of a situation where it
DeepS> is useful.

> [ Did you read the corresponding NEWS entry? ]

> It now parallelizes the use in library() , require() etc,
> and in particular does what the documentation says it does!

> The old behavior was much less consistent and not according to
> documentation:

>      apropos(lm)    was equivalent to apropos("lm")
> but  apropos(fit)   gave an error.

I would actually prefer if we only had standard evaluation for apropos()
and find().

(I understand we cannot do this for library() and help().)

-k


From luke at stat.uiowa.edu  Fri Dec 22 14:08:44 2006
From: luke at stat.uiowa.edu (Luke Tierney)
Date: Fri, 22 Dec 2006 07:08:44 -0600 (CST)
Subject: [Rd] apropos changes in r-devel: intended feature or bug?
In-Reply-To: <17803.54275.647233.118289@mithrandir.hornik.net>
References: <eb555e660612212207q761861a1r7e95b7bdc3a8b6eb@mail.gmail.com>
	<17803.37850.646209.904350@stat.math.ethz.ch>
	<17803.54275.647233.118289@mithrandir.hornik.net>
Message-ID: <Pine.LNX.4.64.0612220707180.23527@itasca2.wildberry.org>

On Fri, 22 Dec 2006, Kurt Hornik wrote:

>>>>>> Martin Maechler writes:
>
>>>>>> "DeepS" == Deepayan Sarkar <deepayan.sarkar at gmail.com>
>>>>>>     on Thu, 21 Dec 2006 22:07:27 -0800 writes:
>
> DeepS> The old apropos started with: if
> DeepS> (!is.character(what)) what <-
> DeepS> as.character(substitute(what))
>
> DeepS> The new one has:
>
> DeepS> if (character.only) stopifnot(is.character(what))
> DeepS> else what <- as.character(substitute(what))
>
> DeepS> i.e., the check for is.character(what) is
> DeepS> missing. This has the effect that 'what' can no
> DeepS> longer be a character string generated by a function
> DeepS> call unless 'character.only = TRUE'. I don't think
> DeepS> this was intended; the change makes previously valid
> DeepS> use invalid and I can't think of a situation where it
> DeepS> is useful.
>
>> [ Did you read the corresponding NEWS entry? ]
>
>> It now parallelizes the use in library() , require() etc,
>> and in particular does what the documentation says it does!
>
>> The old behavior was much less consistent and not according to
>> documentation:
>
>>      apropos(lm)    was equivalent to apropos("lm")
>> but  apropos(fit)   gave an error.
>
> I would actually prefer if we only had standard evaluation for apropos()
> and find().
>
> (I understand we cannot do this for library() and help().)

I agree completely.  If it is OK to make changes that make previous
usage fail then it would be better to go to standard evaluation and
let apropos(lm) fail.

luke

-- 
Luke Tierney
Chair, Statistics and Actuarial Science
Ralph E. Wareham Professor of Mathematical Sciences
University of Iowa                  Phone:             319-335-3386
Department of Statistics and        Fax:               319-335-3017
    Actuarial Science
241 Schaeffer Hall                  email:      luke at stat.uiowa.edu
Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu


From maechler at stat.math.ethz.ch  Fri Dec 22 14:38:36 2006
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Fri, 22 Dec 2006 14:38:36 +0100
Subject: [Rd] apropos changes in r-devel: intended feature or bug?
In-Reply-To: <Pine.LNX.4.64.0612220707180.23527@itasca2.wildberry.org>
References: <eb555e660612212207q761861a1r7e95b7bdc3a8b6eb@mail.gmail.com>
	<17803.37850.646209.904350@stat.math.ethz.ch>
	<17803.54275.647233.118289@mithrandir.hornik.net>
	<Pine.LNX.4.64.0612220707180.23527@itasca2.wildberry.org>
Message-ID: <17803.57308.973556.470123@stat.math.ethz.ch>

Ok, so be it:

We have seen that both apropos() and find()
have used `some' non-standard evaluation up to R 2.4.1
which gave quite incosistent behavior.

Getting rid of non-standard evaluation get's rid of all
inconsistencies but of course is not back-compatible either.

I'll do this.
Martin


>>>>> "Luke" == Luke Tierney <luke at stat.uiowa.edu>
>>>>>     on Fri, 22 Dec 2006 07:08:44 -0600 (CST) writes:

    Luke> On Fri, 22 Dec 2006, Kurt Hornik wrote:
    >>>>>>> Martin Maechler writes:
    >> 
    >>>>>>> "DeepS" == Deepayan Sarkar <deepayan.sarkar at gmail.com>
    >>>>>>> on Thu, 21 Dec 2006 22:07:27 -0800 writes:
    >> 
    DeepS> The old apropos started with: if
    DeepS> (!is.character(what)) what <-
    DeepS> as.character(substitute(what))
    >> 
    DeepS> The new one has:
    >> 
    DeepS> if (character.only) stopifnot(is.character(what))
    DeepS> else what <- as.character(substitute(what))
    >> 
    DeepS> i.e., the check for is.character(what) is
    DeepS> missing. This has the effect that 'what' can no
    DeepS> longer be a character string generated by a function
    DeepS> call unless 'character.only = TRUE'. I don't think
    DeepS> this was intended; the change makes previously valid
    DeepS> use invalid and I can't think of a situation where it
    DeepS> is useful.
    >> 
    >>> [ Did you read the corresponding NEWS entry? ]
    >> 
    >>> It now parallelizes the use in library() , require() etc,
    >>> and in particular does what the documentation says it does!
    >> 
    >>> The old behavior was much less consistent and not according to
    >>> documentation:
    >> 
    >>> apropos(lm)    was equivalent to apropos("lm")
    >>> but  apropos(fit)   gave an error.
    >> 
    >> I would actually prefer if we only had standard evaluation for apropos()
    >> and find().
    >> 
    >> (I understand we cannot do this for library() and help().)

    Luke> I agree completely.  If it is OK to make changes that make previous
    Luke> usage fail then it would be better to go to standard evaluation and
    Luke> let apropos(lm) fail.

    Luke> luke

    Luke> -- 
    Luke> Luke Tierney
    Luke> Chair, Statistics and Actuarial Science
    Luke> Ralph E. Wareham Professor of Mathematical Sciences
    Luke> University of Iowa                  Phone:             319-335-3386
    Luke> Department of Statistics and        Fax:               319-335-3017
    Luke> Actuarial Science
    Luke> 241 Schaeffer Hall                  email:      luke at stat.uiowa.edu
    Luke> Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu

    Luke> ______________________________________________
    Luke> R-devel at r-project.org mailing list
    Luke> https://stat.ethz.ch/mailman/listinfo/r-devel


From ggrothendieck at gmail.com  Fri Dec 22 14:56:45 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Fri, 22 Dec 2006 08:56:45 -0500
Subject: [Rd] apropos changes in r-devel: intended feature or bug?
In-Reply-To: <17803.57308.973556.470123@stat.math.ethz.ch>
References: <eb555e660612212207q761861a1r7e95b7bdc3a8b6eb@mail.gmail.com>
	<17803.37850.646209.904350@stat.math.ethz.ch>
	<17803.54275.647233.118289@mithrandir.hornik.net>
	<Pine.LNX.4.64.0612220707180.23527@itasca2.wildberry.org>
	<17803.57308.973556.470123@stat.math.ethz.ch>
Message-ID: <971536df0612220556ue31e302qc5e56bc0f73ffece@mail.gmail.com>

I have not been followin this thread but if apropos is changed note that
the
   Help | Apropos
menu item in Windows may to be changed depending on what the
change is.

On 12/22/06, Martin Maechler <maechler at stat.math.ethz.ch> wrote:
> Ok, so be it:
>
> We have seen that both apropos() and find()
> have used `some' non-standard evaluation up to R 2.4.1
> which gave quite incosistent behavior.
>
> Getting rid of non-standard evaluation get's rid of all
> inconsistencies but of course is not back-compatible either.
>
> I'll do this.
> Martin
>
>
> >>>>> "Luke" == Luke Tierney <luke at stat.uiowa.edu>
> >>>>>     on Fri, 22 Dec 2006 07:08:44 -0600 (CST) writes:
>
>    Luke> On Fri, 22 Dec 2006, Kurt Hornik wrote:
>    >>>>>>> Martin Maechler writes:
>    >>
>    >>>>>>> "DeepS" == Deepayan Sarkar <deepayan.sarkar at gmail.com>
>    >>>>>>> on Thu, 21 Dec 2006 22:07:27 -0800 writes:
>    >>
>    DeepS> The old apropos started with: if
>    DeepS> (!is.character(what)) what <-
>    DeepS> as.character(substitute(what))
>    >>
>    DeepS> The new one has:
>    >>
>    DeepS> if (character.only) stopifnot(is.character(what))
>    DeepS> else what <- as.character(substitute(what))
>    >>
>    DeepS> i.e., the check for is.character(what) is
>    DeepS> missing. This has the effect that 'what' can no
>    DeepS> longer be a character string generated by a function
>    DeepS> call unless 'character.only = TRUE'. I don't think
>    DeepS> this was intended; the change makes previously valid
>    DeepS> use invalid and I can't think of a situation where it
>    DeepS> is useful.
>    >>
>    >>> [ Did you read the corresponding NEWS entry? ]
>    >>
>    >>> It now parallelizes the use in library() , require() etc,
>    >>> and in particular does what the documentation says it does!
>    >>
>    >>> The old behavior was much less consistent and not according to
>    >>> documentation:
>    >>
>    >>> apropos(lm)    was equivalent to apropos("lm")
>    >>> but  apropos(fit)   gave an error.
>    >>
>    >> I would actually prefer if we only had standard evaluation for apropos()
>    >> and find().
>    >>
>    >> (I understand we cannot do this for library() and help().)
>
>    Luke> I agree completely.  If it is OK to make changes that make previous
>    Luke> usage fail then it would be better to go to standard evaluation and
>    Luke> let apropos(lm) fail.
>
>    Luke> luke
>
>    Luke> --
>    Luke> Luke Tierney
>    Luke> Chair, Statistics and Actuarial Science
>    Luke> Ralph E. Wareham Professor of Mathematical Sciences
>    Luke> University of Iowa                  Phone:             319-335-3386
>    Luke> Department of Statistics and        Fax:               319-335-3017
>    Luke> Actuarial Science
>    Luke> 241 Schaeffer Hall                  email:      luke at stat.uiowa.edu
>    Luke> Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu
>
>    Luke> ______________________________________________
>    Luke> R-devel at r-project.org mailing list
>    Luke> https://stat.ethz.ch/mailman/listinfo/r-devel
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From xiao.gang.fan1 at libertysurf.fr  Fri Dec 22 16:20:51 2006
From: xiao.gang.fan1 at libertysurf.fr (xiao.gang.fan1 at libertysurf.fr)
Date: Fri, 22 Dec 2006 16:20:51 +0100 (CET)
Subject: [Rd] Base R: applying min/max functions() to character string
	vectors (PR#9428)
Message-ID: <20061222152051.111152A346@slim.kubism.ku.dk>

Full_Name: Xiao Gang FAN
Version: 2.4.0
OS: Windows XP
Submission from: (NULL) (159.50.101.9)


Dear All,

This is not really a bug report, but rather a change wish to the Base R
behaviour
on some functions when applying them to character strings vectors/matrices.

Actually in R, we can do thinks like, the most naturally way in this the world:
> "a" < "b"
[1] TRUE

> order(c("b","a"))
[1] 2 1

> pmax(c("a","b"), c("b"))
[1] "b" "b"


But helas, we can't do things like:
> max(c("a","b"))
Error in max(..., na.rm = na.rm) : invalid 'type' (character) of argument

> range(c("z","b","w","c"))
Error in min(..., na.rm = na.rm) : invalid 'type' (character) of argument

> which.min(c("b","a"))
integer(0)
Warning message:
NAs introduced by coercion 

I hope that you could understand the incoherence exhibited here 
and my wish to see that to be changed some day, say in the becoming 
year 2007. Here's a first list of functions to be reviewed: 
min(), max(), which.min(), which.max(), range(), ...

Best regards and happy holidays to all of you !
--
Fan


From murdoch at stats.uwo.ca  Fri Dec 22 17:08:44 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Fri, 22 Dec 2006 11:08:44 -0500
Subject: [Rd] Base R: applying min/max functions() to character string
 vectors (PR#9428)
In-Reply-To: <20061222152051.111152A346@slim.kubism.ku.dk>
References: <20061222152051.111152A346@slim.kubism.ku.dk>
Message-ID: <458C030C.3040309@stats.uwo.ca>

On 12/22/2006 10:20 AM, xiao.gang.fan1 at libertysurf.fr wrote:
> Full_Name: Xiao Gang FAN
> Version: 2.4.0
> OS: Windows XP
> Submission from: (NULL) (159.50.101.9)
> 
> 
> Dear All,
> 
> This is not really a bug report, but rather a change wish to the Base R
> behaviour
> on some functions when applying them to character strings vectors/matrices.
> 
> Actually in R, we can do thinks like, the most naturally way in this the world:
>> "a" < "b"
> [1] TRUE
> 
>> order(c("b","a"))
> [1] 2 1
> 
>> pmax(c("a","b"), c("b"))
> [1] "b" "b"
> 
> 
> But helas, we can't do things like:
>> max(c("a","b"))
> Error in max(..., na.rm = na.rm) : invalid 'type' (character) of argument
> 
>> range(c("z","b","w","c"))
> Error in min(..., na.rm = na.rm) : invalid 'type' (character) of argument
> 
>> which.min(c("b","a"))
> integer(0)
> Warning message:
> NAs introduced by coercion 
> 
> I hope that you could understand the incoherence exhibited here 
> and my wish to see that to be changed some day, say in the becoming 
> year 2007. Here's a first list of functions to be reviewed: 
> min(), max(), which.min(), which.max(), range(), ...

That does seem like a reasonable change.  Why not submit a patch?  min 
and max are in https://svn.r-project.org/R/trunk/src/main/summary.c.  I 
haven't looked up the others, but it's possible they just call the 
internal code for min and max.

Duncan Murdoch


From wuolong at gmail.com  Fri Dec 22 18:59:02 2006
From: wuolong at gmail.com (Michael)
Date: Fri, 22 Dec 2006 11:59:02 -0600
Subject: [Rd] variable scope in update(): bug or feature?
References: <c2hcvp2n40.fsf@bass.biostat.umn.edu>
	<17803.38033.644533.557922@stat.math.ethz.ch>
Message-ID: <u03b77olqx.fsf@gmail.com>


On 22 Dec 2006, Martin Maechler wrote:

> - use a simple reproducible example -- 
> just for the convenience of your readers

Sending email directly to r-devel doesn't seem to work for me.  So I'm
resend this via gmane.

Here is an example:

> rm (list = ls())
> x <- 1:10
> mdata <- data.frame (z = rnorm (10), y = x + 3)
> m1 <- lm (y ~ x + z, data = mdata)
> summary (m1)

Call:
lm(formula = y ~ x + z, data = mdata)

Residuals:
      Min         1Q     Median         3Q        Max
-4.950e-16 -8.107e-17  2.085e-17  9.043e-17  3.787e-16

Coefficients:
             Estimate Std. Error    t value Pr(>|t|)
(Intercept)  3.000e+00  1.923e-16  1.560e+16   <2e-16 ***
x            1.000e+00  2.881e-17  3.472e+16   <2e-16 ***
z           -8.717e-17  1.149e-16 -7.590e-01    0.473
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 2.6e-16 on 7 degrees of freedom
Multiple R-Squared:     1,      Adjusted R-squared:     1
F-statistic: 6.103e+32 on 2 and 7 DF,  p-value: < 2.2e-16

> x <- rep (1:2, each = 5)
> m2 <- update (m1, ~ . - z)
> summary (m2)

Call:
lm(formula = y ~ x, data = mdata)

Residuals:
      Min         1Q     Median         3Q        Max
-2.000e+00 -1.000e+00  2.086e-16  1.000e+00  2.000e+00

Coefficients:
           Estimate Std. Error t value Pr(>|t|)
(Intercept)    1.000      1.581   0.632  0.54474
x              5.000      1.000   5.000  0.00105 **
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.581 on 8 degrees of freedom
Multiple R-Squared: 0.7576,     Adjusted R-squared: 0.7273
F-statistic:    25 on 1 and 8 DF,  p-value: 0.001053

This is R 2.4.1 on Mac OS X 10.4.8.

> - use R-help.  This is really a question about R.

I think this could be a bug (at least it is not doing what I expected)
so I emailed R-devel.

Michael


From deepayan.sarkar at gmail.com  Fri Dec 22 19:16:38 2006
From: deepayan.sarkar at gmail.com (Deepayan Sarkar)
Date: Fri, 22 Dec 2006 10:16:38 -0800
Subject: [Rd] apropos changes in r-devel: intended feature or bug?
In-Reply-To: <17803.37850.646209.904350@stat.math.ethz.ch>
References: <eb555e660612212207q761861a1r7e95b7bdc3a8b6eb@mail.gmail.com>
	<17803.37850.646209.904350@stat.math.ethz.ch>
Message-ID: <eb555e660612221016k1884b47ey30d527e56cd749cd@mail.gmail.com>

On 12/22/06, Martin Maechler <maechler at stat.math.ethz.ch> wrote:
> >>>>> "DeepS" == Deepayan Sarkar <deepayan.sarkar at gmail.com>
> >>>>>     on Thu, 21 Dec 2006 22:07:27 -0800 writes:
>
>     DeepS> The old apropos started with: if
>     DeepS> (!is.character(what)) what <-
>     DeepS> as.character(substitute(what))
>
>     DeepS> The new one has:
>
>     DeepS>    if (character.only) stopifnot(is.character(what))
>     DeepS>    else what <- as.character(substitute(what))
>
>     DeepS> i.e., the check for is.character(what) is
>     DeepS> missing. This has the effect that 'what' can no
>     DeepS> longer be a character string generated by a function
>     DeepS> call unless 'character.only = TRUE'. I don't think
>     DeepS> this was intended; the change makes previously valid
>     DeepS> use invalid and I can't think of a situation where it
>     DeepS> is useful.
>
> [ Did you read the corresponding NEWS entry? ]

Yes, but I didn't connect all the dots. Anyway, I'm happy with either
option (my usage will have to modified anyway).

While we're on the topic of apropos, here's another question:it seems
that determining the mode of an object requires it to be loaded (and
evaluated), at least with the current 'exists' implementation. This
means that whenever 'mode' is not "any", all matching symbols are
loaded. So, something as innocuous looking as

apropos(".", mode = "logical")

will load every lazy-loaded symbol visible, even though very few
things match the mode:

[This is an older r-devel, 2006-11-29 r40062]

> system.time(print(apropos(".", mode = "logical")))
[1] ".noGenerics" "F"           ".noGenerics" "T"
   user  system elapsed
  0.640   0.008   0.648

## after loading a huge annotation package

> library(hgu133plus2)
> system.time(print(apropos(".", mode = "logical")))
[1] ".noGenerics" "F"           ".noGenerics" "T"
   user  system elapsed
 63.112   0.980  64.815

## repeating (now everything is loaded)

> system.time(print(apropos(".", mode = "logical")))
[1] ".noGenerics" "F"           ".noGenerics" "T"
   user  system elapsed
  0.144   0.000   0.143

Is there any hope of avoiding this loading? If not, it might be
helpful to put a note in one of the help pages.

-Deepayan


From ripley at stats.ox.ac.uk  Fri Dec 22 19:29:10 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 22 Dec 2006 18:29:10 +0000 (GMT)
Subject: [Rd] variable scope in update(): bug or feature?
In-Reply-To: <u03b77olqx.fsf@gmail.com>
References: <c2hcvp2n40.fsf@bass.biostat.umn.edu>
	<17803.38033.644533.557922@stat.math.ethz.ch>
	<u03b77olqx.fsf@gmail.com>
Message-ID: <Pine.LNX.4.64.0612221818570.20903@gannet.stats.ox.ac.uk>

You haven't told us what you consider to be the bug here. Note that the 
help page for update says

      'update' will update and (by default) re-fit a model. It does this
      by extracting the call stored in the object, updating the call and
      (by default) evaluating that call. Sometimes it is useful to call
      'update' with only one argument, for example if the data frame has
      been corrected.

which seems to be exactly in accord with the behaviour you report
(especially the last sentence).

Please tell us what you expected and where exactly it is documented that R 
works the way you expected.


On Fri, 22 Dec 2006, Michael wrote:

>
> On 22 Dec 2006, Martin Maechler wrote:
>
>> - use a simple reproducible example --
>> just for the convenience of your readers
>
> Sending email directly to r-devel doesn't seem to work for me.  So I'm
> resend this via gmane.
>
> Here is an example:
>
>> rm (list = ls())
>> x <- 1:10
>> mdata <- data.frame (z = rnorm (10), y = x + 3)
>> m1 <- lm (y ~ x + z, data = mdata)
>> summary (m1)
>
> Call:
> lm(formula = y ~ x + z, data = mdata)
>
> Residuals:
>      Min         1Q     Median         3Q        Max
> -4.950e-16 -8.107e-17  2.085e-17  9.043e-17  3.787e-16
>
> Coefficients:
>             Estimate Std. Error    t value Pr(>|t|)
> (Intercept)  3.000e+00  1.923e-16  1.560e+16   <2e-16 ***
> x            1.000e+00  2.881e-17  3.472e+16   <2e-16 ***
> z           -8.717e-17  1.149e-16 -7.590e-01    0.473
> ---
> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
>
> Residual standard error: 2.6e-16 on 7 degrees of freedom
> Multiple R-Squared:     1,      Adjusted R-squared:     1
> F-statistic: 6.103e+32 on 2 and 7 DF,  p-value: < 2.2e-16
>
>> x <- rep (1:2, each = 5)
>> m2 <- update (m1, ~ . - z)
>> summary (m2)
>
> Call:
> lm(formula = y ~ x, data = mdata)
>
> Residuals:
>      Min         1Q     Median         3Q        Max
> -2.000e+00 -1.000e+00  2.086e-16  1.000e+00  2.000e+00
>
> Coefficients:
>           Estimate Std. Error t value Pr(>|t|)
> (Intercept)    1.000      1.581   0.632  0.54474
> x              5.000      1.000   5.000  0.00105 **
> ---
> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
>
> Residual standard error: 1.581 on 8 degrees of freedom
> Multiple R-Squared: 0.7576,     Adjusted R-squared: 0.7273
> F-statistic:    25 on 1 and 8 DF,  p-value: 0.001053
>
> This is R 2.4.1 on Mac OS X 10.4.8.
>
>> - use R-help.  This is really a question about R.
>
> I think this could be a bug (at least it is not doing what I expected)
> so I emailed R-devel.
>
> Michael
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From wuolong at gmail.com  Fri Dec 22 20:16:02 2006
From: wuolong at gmail.com (Michael)
Date: Fri, 22 Dec 2006 13:16:02 -0600
Subject: [Rd] variable scope in update(): bug or feature?
References: <c2hcvp2n40.fsf@bass.biostat.umn.edu>
	<17803.38033.644533.557922@stat.math.ethz.ch>
	<u03b77olqx.fsf@gmail.com>
	<Pine.LNX.4.64.0612221818570.20903@gannet.stats.ox.ac.uk>
Message-ID: <rrk60jn3m5.fsf@gmail.com>

On 22 Dec 2006, Brian Ripley wrote:

> 'update' will update and (by default) re-fit a model. It does this
> by extracting the call stored in the object, updating the call and
> (by default) evaluating that call. Sometimes it is useful to call
> 'update' with only one argument, for example if the data frame has
> been corrected.

Thanks.  I understand now that this is the expected behavior per the
documentation.

It is just that when I call 'update (m1, ~ . - z)' I did not expect x to
change (or everything can be different if mydata has changed).  I only
wanted to evaluate the old model with old data but sans the z variable.

Would it be useful to have an option in update() not to update the data
(i.e., behaves more like drop1())?

Michael


From Bill.Venables at csiro.au  Sat Dec 23 02:11:10 2006
From: Bill.Venables at csiro.au (Bill.Venables at csiro.au)
Date: Sat, 23 Dec 2006 11:11:10 +1000
Subject: [Rd] substitute creates an object which prints incorrectly
	(PR#9427)
Message-ID: <B998A44C8986644EA8029CFE6396A924840A87@exqld2-bne.qld.csiro.au>

Thanks Peter.  I see the dilemma.  It is serious in my view, though,
even if I can't see an elegant way round it.

I guess the only possibilities are

1. Only keep the source in printing or, much more seriously, dumping, if
the source attribute parses to an object structually identical to the
function itself (even I can see this is going to be impractical)

2. Make the default keep.source option FALSE rather than TRUE and warn
people that switching it on can be unsafe in language manipulation.
This would be practical, I suggest, if comments were kept as part of the
function itself, as well as in the source attribute, but if comments are
only kept in the source attribute (as appears to be the case now) I
concede this becomes impractical.

3. Modify substitute() so that it strips source attributes (or anything
else apparently visible that it will not manipulate) from objects.
Sorry folks, too dangerous.  (I concede this appears to be a bit of an
overkill, too.)

Perhaps the compromise has to be to warn people that keep.source=TRUE
can be dangerous in this way, both in the help informaton for options()
and for substitute().

?

Bill Venables.

-----Original Message-----
From: Peter Dalgaard [mailto:p.dalgaard at biostat.ku.dk] 
Sent: Friday, 22 December 2006 9:47 PM
To: Venables, Bill (CMIS, Cleveland)
Cc: r-devel at stat.math.ethz.ch; R-bugs at biostat.ku.dk
Subject: Re: [Rd] substitute creates an object which prints incorrectly
(PR#9427)

Bill.Venables at csiro.au wrote:
> The function "substitute" seems to fail to make a genuine
> substitution, although the printed verision seems fine.  Here is an
> example.
>
>   
>> m <- substitute(Y <- function(x) FUN(x+1), 
>>     
> + list(Y = as.name("y"), FUN = as.name("sin")))
>   
>> m
>>     
> y <- function(x) sin(x + 1)
>   
>> eval(m)
>> y
>>     
> function(x) FUN(x+1)
>
> However the story doesn't end there.  The substitution appears to have
> been made, even though the printed version, this time, suggests
> otherwise.
>
>   
>> y(pi)
>>     
> [1] -0.841471
>   
>> sin(pi+1)
>>     
> [1] -0.841471
>   
>
>   
Yes, this is (fairly) well known. It has to do with the retention of 
function source.

The thing to notice is that it is only the printing of y that is really 
confused. If you do

dput(y)
attr(y, "source")
attr(y, "source") <- NULL
y

then you should see the point. The tricky bit is that the "source" 
attribute exists in an intermediate form inside m. Notice that m 
contains, not the function itself, but a call to the function `function`

which creates the function when eval'ed. This call contains the function

source as its 4th element (look at m[[3]][[4]] in your example), and you

might try setting it to NULL and see how things will clear up.

The issue with substitute is that it cannot sensibly substitute into 
character vectors, so it just leaves  the source as is, which gives the 
symptoms you see. It could, however, and probably should, recognize 
calls to `function` and NULL out their 4th element. It cannot be done 
completely failsafe though (`function` could result from a computation, 
or even be part of the substitution), so one has to decide that the 
extreme cases are too extreme worry about them.
 
-pd

> Bill Venables 
> CMIS, CSIRO Laboratories, 
> PO Box 120, Cleveland, Qld. 4163 
> AUSTRALIA 
> Office Phone (email preferred): +61 7 3826 7251 
> Fax (if absolutely necessary):    +61 7 3826 7304 
> Mobile (rarely used):                +61 4 1963 4642 
> Home Phone:                          +61 7 3286 7700 
> mailto:Bill.Venables at csiro.au 
> http://www.cmis.csiro.au/bill.venables/ 
>
>
> --please do not edit the information below--
>
> Version:
>  platform = i386-pc-mingw32
>  arch = i386
>  os = mingw32
>  system = i386, mingw32
>  status = 
>  major = 2
>  minor = 4.1
>  year = 2006
>  month = 12
>  day = 18
>  svn rev = 40228
>  language = R
>  version.string = R version 2.4.1 (2006-12-18)
>
> Windows XP Professional (build 2600) Service Pack 2.0
>
> Locale:
>
LC_COLLATE=English_Australia.1252;LC_CTYPE=English_Australia.1252;LC_MON
>
ETARY=English_Australia.1252;LC_NUMERIC=C;LC_TIME=English_Australia.1252
>
> Search Path:
>  .GlobalEnv, .R_Store, package:RODBC, package:xlsReadWrite,
> package:cluster, package:vegan, package:ASOR, package:stats,
> package:graphics, package:grDevices, package:utils, package:datasets,
> .R_Data, .R_Utils, package:svIDE, package:tcltk, package:methods,
> Autoloads, package:base
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From p.dalgaard at biostat.ku.dk  Sat Dec 23 11:28:03 2006
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Sat, 23 Dec 2006 11:28:03 +0100
Subject: [Rd] substitute creates an object which prints
	incorrectly	(PR#9427)
In-Reply-To: <B998A44C8986644EA8029CFE6396A924840A87@exqld2-bne.qld.csiro.au>
References: <B998A44C8986644EA8029CFE6396A924840A87@exqld2-bne.qld.csiro.au>
Message-ID: <458D04B3.6080203@biostat.ku.dk>

Bill.Venables at csiro.au wrote:
> Thanks Peter.  I see the dilemma.  It is serious in my view, though,
> even if I can't see an elegant way round it.
>
> I guess the only possibilities are
>
> 1. Only keep the source in printing or, much more seriously, dumping, if
> the source attribute parses to an object structually identical to the
> function itself (even I can see this is going to be impractical)
>
>   
Yes, dumping is the serious issue here. One should also consider that 
inconsistencies can be created by other means than substitute(), e.g. by 
brute force.

> 2. Make the default keep.source option FALSE rather than TRUE and warn
> people that switching it on can be unsafe in language manipulation.
> This would be practical, I suggest, if comments were kept as part of the
> function itself, as well as in the source attribute, but if comments are
> only kept in the source attribute (as appears to be the case now) I
> concede this becomes impractical.
>
>   
The whole source attribute construction was created because there was no 
way (that we could find, anyway) to make comment and whitespace handling 
sane without either changing the language or making the parser insanely 
complicated. Old R hacks will remember how comments intended for the end 
of a for loop could move to the top when the function was listed.

The basic issue is that S's syntactic sugar coat was modeled on C, but C 
is a compiled language, so its parsers just skip comments and 
whitespace. Trying to retain comments leads to complications.... Even in 
a simple function call f(a=b), there are 7 places to stick in comments, 
so at the very least you need to deal with pre-comments, post-comments, 
and sometimes in-the-middle-comments. And what is worse, there are 
ambiguities, which make automatic parser generators unhappy: Does a 
comment between two expressions belong with the former or the latter? Etc...

> 3. Modify substitute() so that it strips source attributes (or anything
> else apparently visible that it will not manipulate) from objects.
> Sorry folks, too dangerous.  (I concede this appears to be a bit of an
> overkill, too.)
>
>   
Actually, this is the easier fix to my mind. Where do you see the danger?

> Perhaps the compromise has to be to warn people that keep.source=TRUE
> can be dangerous in this way, both in the help informaton for options()
> and for substitute().
>
> ?
>
> Bill Venables.
>
> -----Original Message-----
> From: Peter Dalgaard [mailto:p.dalgaard at biostat.ku.dk] 
> Sent: Friday, 22 December 2006 9:47 PM
> To: Venables, Bill (CMIS, Cleveland)
> Cc: r-devel at stat.math.ethz.ch; R-bugs at biostat.ku.dk
> Subject: Re: [Rd] substitute creates an object which prints incorrectly
> (PR#9427)
>
> Bill.Venables at csiro.au wrote:
>   
>> The function "substitute" seems to fail to make a genuine
>> substitution, although the printed verision seems fine.  Here is an
>> example.
>>
>>   
>>     
>>> m <- substitute(Y <- function(x) FUN(x+1), 
>>>     
>>>       
>> + list(Y = as.name("y"), FUN = as.name("sin")))
>>   
>>     
>>> m
>>>     
>>>       
>> y <- function(x) sin(x + 1)
>>   
>>     
>>> eval(m)
>>> y
>>>     
>>>       
>> function(x) FUN(x+1)
>>
>> However the story doesn't end there.  The substitution appears to have
>> been made, even though the printed version, this time, suggests
>> otherwise.
>>
>>   
>>     
>>> y(pi)
>>>     
>>>       
>> [1] -0.841471
>>   
>>     
>>> sin(pi+1)
>>>     
>>>       
>> [1] -0.841471
>>   
>>
>>   
>>     
> Yes, this is (fairly) well known. It has to do with the retention of 
> function source.
>
> The thing to notice is that it is only the printing of y that is really 
> confused. If you do
>
> dput(y)
> attr(y, "source")
> attr(y, "source") <- NULL
> y
>
> then you should see the point. The tricky bit is that the "source" 
> attribute exists in an intermediate form inside m. Notice that m 
> contains, not the function itself, but a call to the function `function`
>
> which creates the function when eval'ed. This call contains the function
>
> source as its 4th element (look at m[[3]][[4]] in your example), and you
>
> might try setting it to NULL and see how things will clear up.
>
> The issue with substitute is that it cannot sensibly substitute into 
> character vectors, so it just leaves  the source as is, which gives the 
> symptoms you see. It could, however, and probably should, recognize 
> calls to `function` and NULL out their 4th element. It cannot be done 
> completely failsafe though (`function` could result from a computation, 
> or even be part of the substitution), so one has to decide that the 
> extreme cases are too extreme worry about them.
>  
> -pd
>
>   
>> Bill Venables 
>> CMIS, CSIRO Laboratories, 
>> PO Box 120, Cleveland, Qld. 4163 
>> AUSTRALIA 
>> Office Phone (email preferred): +61 7 3826 7251 
>> Fax (if absolutely necessary):    +61 7 3826 7304 
>> Mobile (rarely used):                +61 4 1963 4642 
>> Home Phone:                          +61 7 3286 7700 
>> mailto:Bill.Venables at csiro.au 
>> http://www.cmis.csiro.au/bill.venables/ 
>>
>>
>> --please do not edit the information below--
>>
>> Version:
>>  platform = i386-pc-mingw32
>>  arch = i386
>>  os = mingw32
>>  system = i386, mingw32
>>  status = 
>>  major = 2
>>  minor = 4.1
>>  year = 2006
>>  month = 12
>>  day = 18
>>  svn rev = 40228
>>  language = R
>>  version.string = R version 2.4.1 (2006-12-18)
>>
>> Windows XP Professional (build 2600) Service Pack 2.0
>>
>> Locale:
>>
>>     
> LC_COLLATE=English_Australia.1252;LC_CTYPE=English_Australia.1252;LC_MON
>   
> ETARY=English_Australia.1252;LC_NUMERIC=C;LC_TIME=English_Australia.1252
>   
>> Search Path:
>>  .GlobalEnv, .R_Store, package:RODBC, package:xlsReadWrite,
>> package:cluster, package:vegan, package:ASOR, package:stats,
>> package:graphics, package:grDevices, package:utils, package:datasets,
>> .R_Data, .R_Utils, package:svIDE, package:tcltk, package:methods,
>> Autoloads, package:base
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>     
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From wuolong at gmail.com  Fri Dec 22 18:48:54 2006
From: wuolong at gmail.com (NL)
Date: Fri, 22 Dec 2006 11:48:54 -0600
Subject: [Rd] variable scope in update(): bug or feature?
In-Reply-To: <17803.38033.644533.557922@stat.math.ethz.ch>
References: <c2hcvp2n40.fsf@bass.biostat.umn.edu>
	<17803.38033.644533.557922@stat.math.ethz.ch>
Message-ID: <30b434fe0612220948k18664ef8nbd46fd75b23189ff@mail.gmail.com>

Here is an example:

> rm (list = ls())
> x <- 1:10
> mdata <- data.frame (z = rnorm (10), y = x + 3)
> m1 <- lm (y ~ x + z, data = mdata)
> summary (m1)

Call:
lm(formula = y ~ x + z, data = mdata)

Residuals:
       Min         1Q     Median         3Q        Max
-4.950e-16 -8.107e-17  2.085e-17  9.043e-17  3.787e-16

Coefficients:
              Estimate Std. Error    t value Pr(>|t|)
(Intercept)  3.000e+00  1.923e-16  1.560e+16   <2e-16 ***
x            1.000e+00  2.881e-17  3.472e+16   <2e-16 ***
z           -8.717e-17  1.149e-16 -7.590e-01    0.473
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 2.6e-16 on 7 degrees of freedom
Multiple R-Squared:     1,	Adjusted R-squared:     1
F-statistic: 6.103e+32 on 2 and 7 DF,  p-value: < 2.2e-16

> x <- rep (1:2, each = 5)
> m2 <- update (m1, ~ . - z)
> summary (m2)

Call:
lm(formula = y ~ x, data = mdata)

Residuals:
       Min         1Q     Median         3Q        Max
-2.000e+00 -1.000e+00  2.086e-16  1.000e+00  2.000e+00

Coefficients:
            Estimate Std. Error t value Pr(>|t|)
(Intercept)    1.000      1.581   0.632  0.54474
x              5.000      1.000   5.000  0.00105 **
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.581 on 8 degrees of freedom
Multiple R-Squared: 0.7576,	Adjusted R-squared: 0.7273
F-statistic:    25 on 1 and 8 DF,  p-value: 0.001053

This is R 2.4.1 on Mac OS X 10.4.8.

I think this could be a bug (at least it is not doing what I expected)
so I emailed R-devel.

Michael

On 12/22/06, Martin Maechler <maechler at stat.math.ethz.ch> wrote:
> Hi Michael,
> can you please
>
> - use a simple reproducible example --
>   just for the convenience of your readers
>
> - use R-help.  This is really a question about R.
>
>
>
> >>>>> "Michael" == Michael  <wuolong at gmail.com>
> >>>>>     on Thu, 21 Dec 2006 11:08:15 -0600 writes:
>
>     Michael> I stumbled upon this when using update()
>     Michael> (specifically update.lm()).  If in the original
>     Michael> call to lm(), say
>
>     Michael> a <- lm (y ~ x + z, data = mydata)
>
>     Michael> where y and z are in data frame mydata but x is in
>     Michael> the global environment.
>
>     Michael> Then if later I run,
>
>     Michael> a0 <- update (a, ~ . - z)
>
>     Michael> a0$model will contain values of x in the global
>     Michael> environment which may well be different, even
>     Michael> different length from mydata$y.  Somehow, update()
>     Michael> pads a0$model to have the same number of rows as
>     Michael> the length of x.
>
>     Michael> I would think that it would desirable to use x as
>     Michael> in a$model rather than the global one.
>
>     Michael> Is this a bug or a deliberate feature?
>
>     Michael> Thanks,
>
>     Michael> Michael
>
>     Michael> ______________________________________________
>     Michael> R-devel at r-project.org mailing list
>     Michael> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From zoran.bosnic at fri.uni-lj.si  Sat Dec 23 12:07:11 2006
From: zoran.bosnic at fri.uni-lj.si (zoran.bosnic at fri.uni-lj.si)
Date: Sat, 23 Dec 2006 12:07:11 +0100 (CET)
Subject: [Rd] AltGr not working in R GUI Script Editor (PR#9430)
Message-ID: <20061223110711.DB1214C9A6@slim.kubism.ku.dk>

Full_Name: Zoran Bosnic
Version: 2.4.0
OS: Windows XP SP2
Submission from: (NULL) (212.235.140.146)


This is a problem that occurs in R GUI Script Editor and is connected to Windows
regional settings.

Since I live in Slovenia, my computer has a keyboard with additional slovenian
international characters. I am therefore using Windows XP SP2 with Input
Language (=Keyboard Locale, Control Panel/Regional and Language
Options/Languages/Details/Input language) set to Slovenian.

On slovenian keyboards characters as [, ], {, } are produced by pressing key
combinations AltGr+F, AltGr+G, AltGr+B and AltGr+N, respectively. These
combinations generally work in all Windows programs and also in R Console.
However, R Script editor produces behaves wrongly and causes:
AltGr+F to open Find dialog box,
AltGr+N to open new Script window.

Consequentially, it is not possible to type ] and } brackets using slovenian
input settings in script editor. Meanwhile, AltGr+G and AltGr+B work fine.


From paul.macmanus at gmail.com  Fri Dec 22 19:38:16 2006
From: paul.macmanus at gmail.com (paul.macmanus at gmail.com)
Date: Fri, 22 Dec 2006 19:38:16 +0100 (CET)
Subject: [Rd] bug in sqlSave with fast=F option (PR#9429)
Message-ID: <20061222183816.945BA57323@slim.kubism.ku.dk>

Full_Name: Paul MacManus
Version: 2.3.0
OS: Windows XP
Submission from: (NULL) (216.90.169.253)


See also R-help thread for October 18, 2006

---------------------------
Create a dataframe and save it to a database table "test" as follows:

df <- data.frame(T=1, S=10)
sqlSave(channel, df, "test", rownames=F)

The table now looks like

T  S
1  10

If I create another dataframe and save as follows

df <- data.frame(S=20, T=2)
sqlSave(channel, df, "test", rownames=F, append=T)

Then table "test" now looks like

T  S
1  10
2  20

The important point is that although S was the first column of df,
sqlSave checked the column names and matched the corresponding columns
of df and table "test".

However, if I now create another dataframe and save it using the
fast=F option as follows

df <- data.frame(S=30, T=3)
sqlSave(channel, df, "test", rownames=F, append=T, fast=F)

the table test now looks like

T  S
1  10
2  20
30 3

In other words, sqlSave didn't check column names, it simply mapped
column 1 to column 1 and column 2 to column 2.
-------------------------

I'm using R 2.3.0 and package RODBC 1.1-7 on Windows XP with MS SQL Server


From ligges at statistik.uni-dortmund.de  Sat Dec 23 16:26:35 2006
From: ligges at statistik.uni-dortmund.de (Uwe Ligges)
Date: Sat, 23 Dec 2006 16:26:35 +0100
Subject: [Rd] bug in sqlSave with fast=F option (PR#9429)
In-Reply-To: <20061222183816.945BA57323@slim.kubism.ku.dk>
References: <20061222183816.945BA57323@slim.kubism.ku.dk>
Message-ID: <458D4AAB.1010001@statistik.uni-dortmund.de>

Please read how to report bugs:

1. sqlSave is not part of R's base packages, hence please do not submit 
a bug report here but ask the package maintainer of the corresponding 
package.
2. You have tested with an outdated version of R (2.4.1 is recent).


Uwe Ligges


paul.macmanus at gmail.com wrote:
> Full_Name: Paul MacManus
> Version: 2.3.0
> OS: Windows XP
> Submission from: (NULL) (216.90.169.253)
> 
> 
> See also R-help thread for October 18, 2006
> 
> ---------------------------
> Create a dataframe and save it to a database table "test" as follows:
> 
> df <- data.frame(T=1, S=10)
> sqlSave(channel, df, "test", rownames=F)
> 
> The table now looks like
> 
> T  S
> 1  10
> 
> If I create another dataframe and save as follows
> 
> df <- data.frame(S=20, T=2)
> sqlSave(channel, df, "test", rownames=F, append=T)
> 
> Then table "test" now looks like
> 
> T  S
> 1  10
> 2  20
> 
> The important point is that although S was the first column of df,
> sqlSave checked the column names and matched the corresponding columns
> of df and table "test".
> 
> However, if I now create another dataframe and save it using the
> fast=F option as follows
> 
> df <- data.frame(S=30, T=3)
> sqlSave(channel, df, "test", rownames=F, append=T, fast=F)
> 
> the table test now looks like
> 
> T  S
> 1  10
> 2  20
> 30 3
> 
> In other words, sqlSave didn't check column names, it simply mapped
> column 1 to column 1 and column 2 to column 2.
> -------------------------
> 
> I'm using R 2.3.0 and package RODBC 1.1-7 on Windows XP with MS SQL Server
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From ligges at statistik.uni-dortmund.de  Sat Dec 23 18:02:08 2006
From: ligges at statistik.uni-dortmund.de (Uwe Ligges)
Date: Sat, 23 Dec 2006 18:02:08 +0100
Subject: [Rd] Windows binary package builder and checker
Message-ID: <458D6110.8010309@statistik.uni-dortmund.de>

Dear R-devel readers,

a machine has been set up that provides services for non-Windows users 
to check their source packages under Windows and compile a Windows 
binary without having to go the CRAN way.
This is intended to
  a) provide the service for users who do not (yet) want to submit a 
package to CRAN and
  b) allow users to test and check their packages before finally 
uploading to CRAN.


In particular those who asked me from time to time to look at their 
package can just use this automated service.

For details about the service and how to use it, please read 
http://129.217.207.166/index.htm

As stated on that page, you are using this service on your own risk and 
we do not guarantee privacy nor confidentiality.

Thanks for comments and suggestions to Torsten Hothorn, Duncan Murdoch, 
Paul Murrell, Brian Ripley and Simon Urbanek.
Thanks to the University of Dortmund for funding the machine, 
electricity, space and bandwidth.

Best,
Uwe Ligges


From murdoch at stats.uwo.ca  Sat Dec 23 18:18:44 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Sat, 23 Dec 2006 12:18:44 -0500
Subject: [Rd] substitute creates an object which
	prints	incorrectly	(PR#9427)
In-Reply-To: <458D04B3.6080203@biostat.ku.dk>
References: <B998A44C8986644EA8029CFE6396A924840A87@exqld2-bne.qld.csiro.au>
	<458D04B3.6080203@biostat.ku.dk>
Message-ID: <458D64F4.3090502@stats.uwo.ca>

On 12/23/2006 5:28 AM, Peter Dalgaard wrote:
> Bill.Venables at csiro.au wrote:
>> Thanks Peter.  I see the dilemma.  It is serious in my view, though,
>> even if I can't see an elegant way round it.
>>
>> I guess the only possibilities are
>>
>> 1. Only keep the source in printing or, much more seriously, dumping, if
>> the source attribute parses to an object structually identical to the
>> function itself (even I can see this is going to be impractical)
>>
>>   
> Yes, dumping is the serious issue here. One should also consider that 
> inconsistencies can be created by other means than substitute(), e.g. by 
> brute force.
> 
>> 2. Make the default keep.source option FALSE rather than TRUE and warn
>> people that switching it on can be unsafe in language manipulation.
>> This would be practical, I suggest, if comments were kept as part of the
>> function itself, as well as in the source attribute, but if comments are
>> only kept in the source attribute (as appears to be the case now) I
>> concede this becomes impractical.
>>
>>   
> The whole source attribute construction was created because there was no 
> way (that we could find, anyway) to make comment and whitespace handling 
> sane without either changing the language or making the parser insanely 
> complicated. Old R hacks will remember how comments intended for the end 
> of a for loop could move to the top when the function was listed.
> 
> The basic issue is that S's syntactic sugar coat was modeled on C, but C 
> is a compiled language, so its parsers just skip comments and 
> whitespace. Trying to retain comments leads to complications.... Even in 
> a simple function call f(a=b), there are 7 places to stick in comments, 
> so at the very least you need to deal with pre-comments, post-comments, 
> and sometimes in-the-middle-comments. And what is worse, there are 
> ambiguities, which make automatic parser generators unhappy: Does a 
> comment between two expressions belong with the former or the latter? Etc...
> 
>> 3. Modify substitute() so that it strips source attributes (or anything
>> else apparently visible that it will not manipulate) from objects.
>> Sorry folks, too dangerous.  (I concede this appears to be a bit of an
>> overkill, too.)
>>
>>   
> Actually, this is the easier fix to my mind. Where do you see the danger?

I think we should get rid of source attributes completely, since they 
are no longer needed, but your comment still applies to source 
references. We should strip them when code gets modified.

Duncan Murdoch

> 
>> Perhaps the compromise has to be to warn people that keep.source=TRUE
>> can be dangerous in this way, both in the help informaton for options()
>> and for substitute().
>>
>> ?
>>
>> Bill Venables.
>>
>> -----Original Message-----
>> From: Peter Dalgaard [mailto:p.dalgaard at biostat.ku.dk] 
>> Sent: Friday, 22 December 2006 9:47 PM
>> To: Venables, Bill (CMIS, Cleveland)
>> Cc: r-devel at stat.math.ethz.ch; R-bugs at biostat.ku.dk
>> Subject: Re: [Rd] substitute creates an object which prints incorrectly
>> (PR#9427)
>>
>> Bill.Venables at csiro.au wrote:
>>   
>>> The function "substitute" seems to fail to make a genuine
>>> substitution, although the printed verision seems fine.  Here is an
>>> example.
>>>
>>>   
>>>     
>>>> m <- substitute(Y <- function(x) FUN(x+1), 
>>>>     
>>>>       
>>> + list(Y = as.name("y"), FUN = as.name("sin")))
>>>   
>>>     
>>>> m
>>>>     
>>>>       
>>> y <- function(x) sin(x + 1)
>>>   
>>>     
>>>> eval(m)
>>>> y
>>>>     
>>>>       
>>> function(x) FUN(x+1)
>>>
>>> However the story doesn't end there.  The substitution appears to have
>>> been made, even though the printed version, this time, suggests
>>> otherwise.
>>>
>>>   
>>>     
>>>> y(pi)
>>>>     
>>>>       
>>> [1] -0.841471
>>>   
>>>     
>>>> sin(pi+1)
>>>>     
>>>>       
>>> [1] -0.841471
>>>   
>>>
>>>   
>>>     
>> Yes, this is (fairly) well known. It has to do with the retention of 
>> function source.
>>
>> The thing to notice is that it is only the printing of y that is really 
>> confused. If you do
>>
>> dput(y)
>> attr(y, "source")
>> attr(y, "source") <- NULL
>> y
>>
>> then you should see the point. The tricky bit is that the "source" 
>> attribute exists in an intermediate form inside m. Notice that m 
>> contains, not the function itself, but a call to the function `function`
>>
>> which creates the function when eval'ed. This call contains the function
>>
>> source as its 4th element (look at m[[3]][[4]] in your example), and you
>>
>> might try setting it to NULL and see how things will clear up.
>>
>> The issue with substitute is that it cannot sensibly substitute into 
>> character vectors, so it just leaves  the source as is, which gives the 
>> symptoms you see. It could, however, and probably should, recognize 
>> calls to `function` and NULL out their 4th element. It cannot be done 
>> completely failsafe though (`function` could result from a computation, 
>> or even be part of the substitution), so one has to decide that the 
>> extreme cases are too extreme worry about them.
>>  
>> -pd
>>
>>   
>>> Bill Venables 
>>> CMIS, CSIRO Laboratories, 
>>> PO Box 120, Cleveland, Qld. 4163 
>>> AUSTRALIA 
>>> Office Phone (email preferred): +61 7 3826 7251 
>>> Fax (if absolutely necessary):    +61 7 3826 7304 
>>> Mobile (rarely used):                +61 4 1963 4642 
>>> Home Phone:                          +61 7 3286 7700 
>>> mailto:Bill.Venables at csiro.au 
>>> http://www.cmis.csiro.au/bill.venables/ 
>>>
>>>
>>> --please do not edit the information below--
>>>
>>> Version:
>>>  platform = i386-pc-mingw32
>>>  arch = i386
>>>  os = mingw32
>>>  system = i386, mingw32
>>>  status = 
>>>  major = 2
>>>  minor = 4.1
>>>  year = 2006
>>>  month = 12
>>>  day = 18
>>>  svn rev = 40228
>>>  language = R
>>>  version.string = R version 2.4.1 (2006-12-18)
>>>
>>> Windows XP Professional (build 2600) Service Pack 2.0
>>>
>>> Locale:
>>>
>>>     
>> LC_COLLATE=English_Australia.1252;LC_CTYPE=English_Australia.1252;LC_MON
>>   
>> ETARY=English_Australia.1252;LC_NUMERIC=C;LC_TIME=English_Australia.1252
>>   
>>> Search Path:
>>>  .GlobalEnv, .R_Store, package:RODBC, package:xlsReadWrite,
>>> package:cluster, package:vegan, package:ASOR, package:stats,
>>> package:graphics, package:grDevices, package:utils, package:datasets,
>>> .R_Data, .R_Utils, package:svIDE, package:tcltk, package:methods,
>>> Autoloads, package:base
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>>     
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From murdoch at stats.uwo.ca  Sat Dec 23 18:19:12 2006
From: murdoch at stats.uwo.ca (murdoch at stats.uwo.ca)
Date: Sat, 23 Dec 2006 18:19:12 +0100 (CET)
Subject: [Rd] substitute creates an object which
	prints	incorrectly	(PR#9427)
Message-ID: <20061223171912.73A723F209@slim.kubism.ku.dk>

On 12/23/2006 5:28 AM, Peter Dalgaard wrote:
> Bill.Venables at csiro.au wrote:
>> Thanks Peter.  I see the dilemma.  It is serious in my view, though,
>> even if I can't see an elegant way round it.
>>
>> I guess the only possibilities are
>>
>> 1. Only keep the source in printing or, much more seriously, dumping, if
>> the source attribute parses to an object structually identical to the
>> function itself (even I can see this is going to be impractical)
>>
>>   
> Yes, dumping is the serious issue here. One should also consider that 
> inconsistencies can be created by other means than substitute(), e.g. by 
> brute force.
> 
>> 2. Make the default keep.source option FALSE rather than TRUE and warn
>> people that switching it on can be unsafe in language manipulation.
>> This would be practical, I suggest, if comments were kept as part of the
>> function itself, as well as in the source attribute, but if comments are
>> only kept in the source attribute (as appears to be the case now) I
>> concede this becomes impractical.
>>
>>   
> The whole source attribute construction was created because there was no 
> way (that we could find, anyway) to make comment and whitespace handling 
> sane without either changing the language or making the parser insanely 
> complicated. Old R hacks will remember how comments intended for the end 
> of a for loop could move to the top when the function was listed.
> 
> The basic issue is that S's syntactic sugar coat was modeled on C, but C 
> is a compiled language, so its parsers just skip comments and 
> whitespace. Trying to retain comments leads to complications.... Even in 
> a simple function call f(a=b), there are 7 places to stick in comments, 
> so at the very least you need to deal with pre-comments, post-comments, 
> and sometimes in-the-middle-comments. And what is worse, there are 
> ambiguities, which make automatic parser generators unhappy: Does a 
> comment between two expressions belong with the former or the latter? Etc...
> 
>> 3. Modify substitute() so that it strips source attributes (or anything
>> else apparently visible that it will not manipulate) from objects.
>> Sorry folks, too dangerous.  (I concede this appears to be a bit of an
>> overkill, too.)
>>
>>   
> Actually, this is the easier fix to my mind. Where do you see the danger?

I think we should get rid of source attributes completely, since they 
are no longer needed, but your comment still applies to source 
references. We should strip them when code gets modified.

Duncan Murdoch

> 
>> Perhaps the compromise has to be to warn people that keep.source=TRUE
>> can be dangerous in this way, both in the help informaton for options()
>> and for substitute().
>>
>> ?
>>
>> Bill Venables.
>>
>> -----Original Message-----
>> From: Peter Dalgaard [mailto:p.dalgaard at biostat.ku.dk] 
>> Sent: Friday, 22 December 2006 9:47 PM
>> To: Venables, Bill (CMIS, Cleveland)
>> Cc: r-devel at stat.math.ethz.ch; R-bugs at biostat.ku.dk
>> Subject: Re: [Rd] substitute creates an object which prints incorrectly
>> (PR#9427)
>>
>> Bill.Venables at csiro.au wrote:
>>   
>>> The function "substitute" seems to fail to make a genuine
>>> substitution, although the printed verision seems fine.  Here is an
>>> example.
>>>
>>>   
>>>     
>>>> m <- substitute(Y <- function(x) FUN(x+1), 
>>>>     
>>>>       
>>> + list(Y = as.name("y"), FUN = as.name("sin")))
>>>   
>>>     
>>>> m
>>>>     
>>>>       
>>> y <- function(x) sin(x + 1)
>>>   
>>>     
>>>> eval(m)
>>>> y
>>>>     
>>>>       
>>> function(x) FUN(x+1)
>>>
>>> However the story doesn't end there.  The substitution appears to have
>>> been made, even though the printed version, this time, suggests
>>> otherwise.
>>>
>>>   
>>>     
>>>> y(pi)
>>>>     
>>>>       
>>> [1] -0.841471
>>>   
>>>     
>>>> sin(pi+1)
>>>>     
>>>>       
>>> [1] -0.841471
>>>   
>>>
>>>   
>>>     
>> Yes, this is (fairly) well known. It has to do with the retention of 
>> function source.
>>
>> The thing to notice is that it is only the printing of y that is really 
>> confused. If you do
>>
>> dput(y)
>> attr(y, "source")
>> attr(y, "source") <- NULL
>> y
>>
>> then you should see the point. The tricky bit is that the "source" 
>> attribute exists in an intermediate form inside m. Notice that m 
>> contains, not the function itself, but a call to the function `function`
>>
>> which creates the function when eval'ed. This call contains the function
>>
>> source as its 4th element (look at m[[3]][[4]] in your example), and you
>>
>> might try setting it to NULL and see how things will clear up.
>>
>> The issue with substitute is that it cannot sensibly substitute into 
>> character vectors, so it just leaves  the source as is, which gives the 
>> symptoms you see. It could, however, and probably should, recognize 
>> calls to `function` and NULL out their 4th element. It cannot be done 
>> completely failsafe though (`function` could result from a computation, 
>> or even be part of the substitution), so one has to decide that the 
>> extreme cases are too extreme worry about them.
>>  
>> -pd
>>
>>   
>>> Bill Venables 
>>> CMIS, CSIRO Laboratories, 
>>> PO Box 120, Cleveland, Qld. 4163 
>>> AUSTRALIA 
>>> Office Phone (email preferred): +61 7 3826 7251 
>>> Fax (if absolutely necessary):    +61 7 3826 7304 
>>> Mobile (rarely used):                +61 4 1963 4642 
>>> Home Phone:                          +61 7 3286 7700 
>>> mailto:Bill.Venables at csiro.au 
>>> http://www.cmis.csiro.au/bill.venables/ 
>>>
>>>
>>> --please do not edit the information below--
>>>
>>> Version:
>>>  platform = i386-pc-mingw32
>>>  arch = i386
>>>  os = mingw32
>>>  system = i386, mingw32
>>>  status = 
>>>  major = 2
>>>  minor = 4.1
>>>  year = 2006
>>>  month = 12
>>>  day = 18
>>>  svn rev = 40228
>>>  language = R
>>>  version.string = R version 2.4.1 (2006-12-18)
>>>
>>> Windows XP Professional (build 2600) Service Pack 2.0
>>>
>>> Locale:
>>>
>>>     
>> LC_COLLATE=English_Australia.1252;LC_CTYPE=English_Australia.1252;LC_MON
>>   
>> ETARY=English_Australia.1252;LC_NUMERIC=C;LC_TIME=English_Australia.1252
>>   
>>> Search Path:
>>>  .GlobalEnv, .R_Store, package:RODBC, package:xlsReadWrite,
>>> package:cluster, package:vegan, package:ASOR, package:stats,
>>> package:graphics, package:grDevices, package:utils, package:datasets,
>>> .R_Data, .R_Utils, package:svIDE, package:tcltk, package:methods,
>>> Autoloads, package:base
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>>     
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From murdoch at stats.uwo.ca  Sat Dec 23 19:00:11 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Sat, 23 Dec 2006 13:00:11 -0500
Subject: [Rd] AltGr not working in R GUI Script Editor (PR#9430)
In-Reply-To: <20061223110711.DB1214C9A6@slim.kubism.ku.dk>
References: <20061223110711.DB1214C9A6@slim.kubism.ku.dk>
Message-ID: <458D6EAB.1070400@stats.uwo.ca>

On 12/23/2006 6:07 AM, zoran.bosnic at fri.uni-lj.si wrote:
> Full_Name: Zoran Bosnic
> Version: 2.4.0
> OS: Windows XP SP2
> Submission from: (NULL) (212.235.140.146)
> 
> 
> This is a problem that occurs in R GUI Script Editor and is connected to Windows
> regional settings.
> 
> Since I live in Slovenia, my computer has a keyboard with additional slovenian
> international characters. I am therefore using Windows XP SP2 with Input
> Language (=Keyboard Locale, Control Panel/Regional and Language
> Options/Languages/Details/Input language) set to Slovenian.
> 
> On slovenian keyboards characters as [, ], {, } are produced by pressing key
> combinations AltGr+F, AltGr+G, AltGr+B and AltGr+N, respectively. These
> combinations generally work in all Windows programs and also in R Console.
> However, R Script editor produces behaves wrongly and causes:
> AltGr+F to open Find dialog box,
> AltGr+N to open new Script window.

I see in comments in the source (in 
https://svn.r-project.org/trunk/src/gnuwin32/graphapp/events.c, around 
line 930) that this is a known bug, but I don't know how to fix it.  I'm 
working on an American keyboard, that doesn't have an AltGr key, so it's 
hard to test anything.

One solution would be to add an option to disable handling of shortcut 
keys in menus.  There's probably a better solution, but without being 
able to test it, I don't think I could find it.

Are you familiar enough with Windows internals to work on this and 
submit a patch, or do you know someone who is?

Duncan Murdoch

> 
> Consequentially, it is not possible to type ] and } brackets using slovenian
> input settings in script editor. Meanwhile, AltGr+G and AltGr+B work fine.
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From murdoch at stats.uwo.ca  Sat Dec 23 19:05:03 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Sat, 23 Dec 2006 13:05:03 -0500
Subject: [Rd] AltGr not working in R GUI Script Editor (PR#9430)
In-Reply-To: <458D6EAB.1070400@stats.uwo.ca>
References: <20061223110711.DB1214C9A6@slim.kubism.ku.dk>
	<458D6EAB.1070400@stats.uwo.ca>
Message-ID: <458D6FCF.9030000@stats.uwo.ca>

On 12/23/2006 1:00 PM, Duncan Murdoch wrote:
> On 12/23/2006 6:07 AM, zoran.bosnic at fri.uni-lj.si wrote:
>> Full_Name: Zoran Bosnic
>> Version: 2.4.0
>> OS: Windows XP SP2
>> Submission from: (NULL) (212.235.140.146)
>>
>>
>> This is a problem that occurs in R GUI Script Editor and is connected to Windows
>> regional settings.
>>
>> Since I live in Slovenia, my computer has a keyboard with additional slovenian
>> international characters. I am therefore using Windows XP SP2 with Input
>> Language (=Keyboard Locale, Control Panel/Regional and Language
>> Options/Languages/Details/Input language) set to Slovenian.
>>
>> On slovenian keyboards characters as [, ], {, } are produced by pressing key
>> combinations AltGr+F, AltGr+G, AltGr+B and AltGr+N, respectively. These
>> combinations generally work in all Windows programs and also in R Console.
>> However, R Script editor produces behaves wrongly and causes:
>> AltGr+F to open Find dialog box,
>> AltGr+N to open new Script window.
> 
> I see in comments in the source (in 
> https://svn.r-project.org/trunk/src/gnuwin32/graphapp/events.c, around 

Typo in URL:  should be

https://svn.r-project.org/R/trunk/src/gnuwin32/graphapp/events.c

> line 930) that this is a known bug, but I don't know how to fix it.  I'm 
> working on an American keyboard, that doesn't have an AltGr key, so it's 
> hard to test anything.
> 
> One solution would be to add an option to disable handling of shortcut 
> keys in menus.  There's probably a better solution, but without being 
> able to test it, I don't think I could find it.
> 
> Are you familiar enough with Windows internals to work on this and 
> submit a patch, or do you know someone who is?
> 
> Duncan Murdoch
> 
>> Consequentially, it is not possible to type ] and } brackets using slovenian
>> input settings in script editor. Meanwhile, AltGr+G and AltGr+B work fine.
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From murdoch at stats.uwo.ca  Sat Dec 23 19:05:28 2006
From: murdoch at stats.uwo.ca (murdoch at stats.uwo.ca)
Date: Sat, 23 Dec 2006 19:05:28 +0100 (CET)
Subject: [Rd] AltGr not working in R GUI Script Editor (PR#9430)
Message-ID: <20061223180528.1B5D84C9CA@slim.kubism.ku.dk>

On 12/23/2006 1:00 PM, Duncan Murdoch wrote:
> On 12/23/2006 6:07 AM, zoran.bosnic at fri.uni-lj.si wrote:
>> Full_Name: Zoran Bosnic
>> Version: 2.4.0
>> OS: Windows XP SP2
>> Submission from: (NULL) (212.235.140.146)
>>
>>
>> This is a problem that occurs in R GUI Script Editor and is connected to Windows
>> regional settings.
>>
>> Since I live in Slovenia, my computer has a keyboard with additional slovenian
>> international characters. I am therefore using Windows XP SP2 with Input
>> Language (=Keyboard Locale, Control Panel/Regional and Language
>> Options/Languages/Details/Input language) set to Slovenian.
>>
>> On slovenian keyboards characters as [, ], {, } are produced by pressing key
>> combinations AltGr+F, AltGr+G, AltGr+B and AltGr+N, respectively. These
>> combinations generally work in all Windows programs and also in R Console.
>> However, R Script editor produces behaves wrongly and causes:
>> AltGr+F to open Find dialog box,
>> AltGr+N to open new Script window.
> 
> I see in comments in the source (in 
> https://svn.r-project.org/trunk/src/gnuwin32/graphapp/events.c, around 

Typo in URL:  should be

https://svn.r-project.org/R/trunk/src/gnuwin32/graphapp/events.c

> line 930) that this is a known bug, but I don't know how to fix it.  I'm 
> working on an American keyboard, that doesn't have an AltGr key, so it's 
> hard to test anything.
> 
> One solution would be to add an option to disable handling of shortcut 
> keys in menus.  There's probably a better solution, but without being 
> able to test it, I don't think I could find it.
> 
> Are you familiar enough with Windows internals to work on this and 
> submit a patch, or do you know someone who is?
> 
> Duncan Murdoch
> 
>> Consequentially, it is not possible to type ] and } brackets using slovenian
>> input settings in script editor. Meanwhile, AltGr+G and AltGr+B work fine.
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From zoran.bosnic at fri.uni-lj.si  Sat Dec 23 21:40:36 2006
From: zoran.bosnic at fri.uni-lj.si (Zoran Bosnic)
Date: Sat, 23 Dec 2006 21:40:36 +0100
Subject: [Rd] AltGr not working in R GUI Script Editor (PR#9430)
References: <20061223110711.DB1214C9A6@slim.kubism.ku.dk>
	<458D6EAB.1070400@stats.uwo.ca> <458D6FCF.9030000@stats.uwo.ca>
Message-ID: <000f01c726d2$99c91bb0$928cebd4@jazzer78>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20061223/86ba0440/attachment.pl 

From Bill.Venables at csiro.au  Sat Dec 23 23:13:47 2006
From: Bill.Venables at csiro.au (Bill.Venables at csiro.au)
Date: Sun, 24 Dec 2006 08:13:47 +1000
Subject: [Rd] substitute creates an object which prints
	incorrectly	(PR#9427)
Message-ID: <B998A44C8986644EA8029CFE6396A924840A8B@exqld2-bne.qld.csiro.au>


Bill.Venables at csiro.au (i.e. I) wrote:

> 3. Modify substitute() so that it strips source attributes (or
anything
> else apparently visible that it will not manipulate) from objects.
> Sorry folks, too dangerous.  (I concede this appears to be a bit of an
> overkill, too.)

Peter Dalgaard responded:
  
Actually, this is the easier fix to my mind. Where do you see the
danger?

To which I reply:

Well, if it's feasible, I'd recommend this as the way to go.  My
detached 
phrase "Sorry folks, too dangerous" was simply my wondering how we might

field the inevitable howls of protest when people find that something
has 
changed.  I know people will notice since this is a glych I spotted when

trying to debug someone else's code, but that person, at least, will 
applaud I'm sure.

In short, I don't think there are any real dangers.  I just thought it 
would slow things down too much, but perhaps not.

Bill Venables.


From ripley at stats.ox.ac.uk  Sun Dec 24 08:09:21 2006
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Sun, 24 Dec 2006 08:09:21 +0100 (CET)
Subject: [Rd] AltGr not working in R GUI Script Editor (PR#9430)
Message-ID: <20061224070921.4A5D04421C@slim.kubism.ku.dk>

I do have AltGr (and Slovenian installed).   The issue is that the author 
of graphapp seems not to have had a 'right menu key' as MSDN call it.

This was fixed in R 0.9.1 and unfixed in R 2.0.0 by the author of the 
script editor, who wrote in graphapp/events.c

 	/* Check for menu control keys. */
 	/* disabled : Alt-Gr bug*/ /* Re-enabled for the moment, CJ */

I do now have a proper fix.


On Sat, 23 Dec 2006, Zoran Bosnic wrote:

> Dear Duncan,
>
>> I'm  working on an American keyboard, that doesn't have an AltGr key, so it's
>> hard to test anything.
>>
>> Are you familiar enough with Windows internals to work on this and
>> submit a patch, or do you know someone who is?
>
> Unfortunately I am not so familiar with windows internals and cannot remeber of anyone who might help, but I have a solution for you how you could test this.
>
> AltGr key can be simulated by pressing left Control+Alt keys together. This works on slovenian keyboards, and I guess it should also work on american, if slovenian input locale is set.
>
> I just tested this LeftCtrl+LeftAlt combination in R script editor and behaviour was the same.
>
>
>
>> One solution would be to add an option to disable handling of shortcut
>> keys in menus.  There's probably a better solution, but without being
>> able to test it, I don't think I could find it.
>
> Yes, this would also be an option. In fact I was already looking through the menus if there was such setting to remap keyboard shortcuts.
>
> Hope my suggestion helps.
>
> Best regards, Zoran Bosnic.
>
> Zoran Bosnic, M. Sc.
> Faculty of Computer and Information Science
> Laboratory of Cognitive Modelling
> Trzaska ulica 25
> 1000 Ljubljana
> Slovenia
>
>
>
>
>
> ----- Original Message -----
>  From: Duncan Murdoch
>  To: Duncan Murdoch
>  Cc: zoran.bosnic at fri.uni-lj.si ; R-bugs at biostat.ku.dk ; r-devel at stat.math.ethz.ch
>  Sent: Saturday, December 23, 2006 7:05 PM
>  Subject: Re: [Rd] AltGr not working in R GUI Script Editor (PR#9430)
>
>
>  On 12/23/2006 1:00 PM, Duncan Murdoch wrote:
>  > On 12/23/2006 6:07 AM, zoran.bosnic at fri.uni-lj.si wrote:
>  >> Full_Name: Zoran Bosnic
>  >> Version: 2.4.0
>  >> OS: Windows XP SP2
>  >> Submission from: (NULL) (212.235.140.146)
>  >>
>  >>
>  >> This is a problem that occurs in R GUI Script Editor and is connected to Windows
>  >> regional settings.
>  >>
>  >> Since I live in Slovenia, my computer has a keyboard with additional slovenian
>  >> international characters. I am therefore using Windows XP SP2 with Input
>  >> Language (=Keyboard Locale, Control Panel/Regional and Language
>  >> Options/Languages/Details/Input language) set to Slovenian.
>  >>
>  >> On slovenian keyboards characters as [, ], {, } are produced by pressing key
>  >> combinations AltGr+F, AltGr+G, AltGr+B and AltGr+N, respectively. These
>  >> combinations generally work in all Windows programs and also in R Console.
>  >> However, R Script editor produces behaves wrongly and causes:
>  >> AltGr+F to open Find dialog box,
>  >> AltGr+N to open new Script window.
>  >
>  > I see in comments in the source (in
>  > https://svn.r-project.org/trunk/src/gnuwin32/graphapp/events.c, around
>
>  Typo in URL:  should be
>
>  https://svn.r-project.org/R/trunk/src/gnuwin32/graphapp/events.c
>
>  > line 930) that this is a known bug, but I don't know how to fix it.  I'm
>  > working on an American keyboard, that doesn't have an AltGr key, so it's
>  > hard to test anything.
>  >
>  > One solution would be to add an option to disable handling of shortcut
>  > keys in menus.  There's probably a better solution, but without being
>  > able to test it, I don't think I could find it.
>  >
>  > Are you familiar enough with Windows internals to work on this and
>  > submit a patch, or do you know someone who is?
>  >
>  > Duncan Murdoch
>  >
>  >> Consequentially, it is not possible to type ] and } brackets using slovenian
>  >> input settings in script editor. Meanwhile, AltGr+G and AltGr+B work fine.
>  >>
>  >> ______________________________________________
>  >> R-devel at r-project.org mailing list
>  >> https://stat.ethz.ch/mailman/listinfo/r-devel
>  >
>  > ______________________________________________
>  > R-devel at r-project.org mailing list
>  > https://stat.ethz.ch/mailman/listinfo/r-devel
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From murdoch at stats.uwo.ca  Sun Dec 24 11:45:04 2006
From: murdoch at stats.uwo.ca (murdoch at stats.uwo.ca)
Date: Sun, 24 Dec 2006 11:45:04 +0100 (CET)
Subject: [Rd] AltGr not working in R GUI Script Editor (PR#9430)
Message-ID: <20061224104504.5875E4C8BF@slim.kubism.ku.dk>

On 12/24/2006 2:08 AM, Prof Brian Ripley wrote:
> I do have AltGr (and Slovenian installed).   The issue is that the author 
> of graphapp seems not to have had a 'right menu key' as MSDN call it.
> 
> This was fixed in R 0.9.1 and unfixed in R 2.0.0 by the author of the 
> script editor, who wrote in graphapp/events.c
> 
>  	/* Check for menu control keys. */
>  	/* disabled : Alt-Gr bug*/ /* Re-enabled for the moment, CJ */
> 
> I do now have a proper fix.

Thanks!

Duncan Murdoch

> 
> 
> On Sat, 23 Dec 2006, Zoran Bosnic wrote:
> 
>> Dear Duncan,
>>
>>> I'm  working on an American keyboard, that doesn't have an AltGr key, so it's
>>> hard to test anything.
>>>
>>> Are you familiar enough with Windows internals to work on this and
>>> submit a patch, or do you know someone who is?
>> Unfortunately I am not so familiar with windows internals and cannot remeber of anyone who might help, but I have a solution for you how you could test this.
>>
>> AltGr key can be simulated by pressing left Control+Alt keys together. This works on slovenian keyboards, and I guess it should also work on american, if slovenian input locale is set.
>>
>> I just tested this LeftCtrl+LeftAlt combination in R script editor and behaviour was the same.
>>
>>
>>
>>> One solution would be to add an option to disable handling of shortcut
>>> keys in menus.  There's probably a better solution, but without being
>>> able to test it, I don't think I could find it.
>> Yes, this would also be an option. In fact I was already looking through the menus if there was such setting to remap keyboard shortcuts.
>>
>> Hope my suggestion helps.
>>
>> Best regards, Zoran Bosnic.
>>
>> Zoran Bosnic, M. Sc.
>> Faculty of Computer and Information Science
>> Laboratory of Cognitive Modelling
>> Trzaska ulica 25
>> 1000 Ljubljana
>> Slovenia
>>
>>
>>
>>
>>
>> ----- Original Message -----
>>  From: Duncan Murdoch
>>  To: Duncan Murdoch
>>  Cc: zoran.bosnic at fri.uni-lj.si ; R-bugs at biostat.ku.dk ; r-devel at stat.math.ethz.ch
>>  Sent: Saturday, December 23, 2006 7:05 PM
>>  Subject: Re: [Rd] AltGr not working in R GUI Script Editor (PR#9430)
>>
>>
>>  On 12/23/2006 1:00 PM, Duncan Murdoch wrote:
>>  > On 12/23/2006 6:07 AM, zoran.bosnic at fri.uni-lj.si wrote:
>>  >> Full_Name: Zoran Bosnic
>>  >> Version: 2.4.0
>>  >> OS: Windows XP SP2
>>  >> Submission from: (NULL) (212.235.140.146)
>>  >>
>>  >>
>>  >> This is a problem that occurs in R GUI Script Editor and is connected to Windows
>>  >> regional settings.
>>  >>
>>  >> Since I live in Slovenia, my computer has a keyboard with additional slovenian
>>  >> international characters. I am therefore using Windows XP SP2 with Input
>>  >> Language (=Keyboard Locale, Control Panel/Regional and Language
>>  >> Options/Languages/Details/Input language) set to Slovenian.
>>  >>
>>  >> On slovenian keyboards characters as [, ], {, } are produced by pressing key
>>  >> combinations AltGr+F, AltGr+G, AltGr+B and AltGr+N, respectively. These
>>  >> combinations generally work in all Windows programs and also in R Console.
>>  >> However, R Script editor produces behaves wrongly and causes:
>>  >> AltGr+F to open Find dialog box,
>>  >> AltGr+N to open new Script window.
>>  >
>>  > I see in comments in the source (in
>>  > https://svn.r-project.org/trunk/src/gnuwin32/graphapp/events.c, around
>>
>>  Typo in URL:  should be
>>
>>  https://svn.r-project.org/R/trunk/src/gnuwin32/graphapp/events.c
>>
>>  > line 930) that this is a known bug, but I don't know how to fix it.  I'm
>>  > working on an American keyboard, that doesn't have an AltGr key, so it's
>>  > hard to test anything.
>>  >
>>  > One solution would be to add an option to disable handling of shortcut
>>  > keys in menus.  There's probably a better solution, but without being
>>  > able to test it, I don't think I could find it.
>>  >
>>  > Are you familiar enough with Windows internals to work on this and
>>  > submit a patch, or do you know someone who is?
>>  >
>>  > Duncan Murdoch
>>  >
>>  >> Consequentially, it is not possible to type ] and } brackets using slovenian
>>  >> input settings in script editor. Meanwhile, AltGr+G and AltGr+B work fine.
>>  >>
>>  >> ______________________________________________
>>  >> R-devel at r-project.org mailing list
>>  >> https://stat.ethz.ch/mailman/listinfo/r-devel
>>  >
>>  > ______________________________________________
>>  > R-devel at r-project.org mailing list
>>  > https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>> 	[[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>


From braunm at MIT.EDU  Mon Dec 25 00:58:50 2006
From: braunm at MIT.EDU (Michael Braun)
Date: Sun, 24 Dec 2006 18:58:50 -0500
Subject: [Rd] FW: Passing lists from R to C, extracting elements,
 and sending lists back again
Message-ID: <20061224185851125.00000000424@MBRAUN>

 

Thank you to everyone who responded to my previous post regarding the integration into R of C programs that use external libraries.  I have another issue that I simply have not been able to figure out using documentation, list archives, and so forth.

I have data that is stored in R lists.  I would like to pass the list to C code using the .Call function, perform mathematical operations on the elements of the lists (which might be other lists), and return results in a new list.

As a simple example, suppose I have a list of n matrices (dimension k-by-k) that I want to invert, and return the result in another list.  I wrote the C code below that reads the list as a SEXP.  Then, for each of the i=1..n matrices, I convert the R vector to a gsl matrix, perform the linear algebra operations and populate the new list with the inverted matrix.

The problem is that I can't figure out the best way to get the real elements into the list SEXP to return it to R.  When I run the code below, the compiler (R CMD SHLIB sexp1.c) gives me:

-bash-3.00$ R CMD SHLIB sexp1.c
gcc -I/usr/lib64/R/include -I/usr/lib64/R/include -I/usr/include -I/usr/local/include   -fpic  -O2 -g -c sexp1.c -o sexp1.o
sexp1.c: In function `invMatList':
sexp1.c:37: warning: passing arg 3 of `SET_VECTOR_ELT' from incompatible pointer type gcc -shared -L/usr/local/lib64 -o sexp1.so sexp1.o -L/usr/lib64 -lgsl -lgslcblas -L/usr/lib  -L/usr/lib64/R/lib -lR

So, not only would it be helpful to understand how to solve this specific problem, but I would greatly appreciate some general guidance on how to best more data from lists or C datatypes and back again (especially arrays).  Also, are the functions and macros described in the Rinternals header documented anywhere?  I can't seem to find the source code, or a description of what these functions actually do.

Thanks again for any help you can provide.

Best wishes,

Michael Braun
MIT Sloan School of Management
braunm at mit.edu

	SEXP r = PROTECT(allocVector(VECSXP,n));
	double rm[k][k];

	for (i=0; i<n; i=i+1) {

		for (a=0; a<k; ++a){ // convert to gsl matrix
			for (b=0; b<k; ++b){
				ind = b*k + a;
				m = REAL(VECTOR_ELT(list,i))[ind];
				gsl_matrix_set(mat, b, a, m);
			}
		} // end conversion loops

 		gsl_linalg_LU_decomp(mat, p, &s);
		gsl_linalg_LU_invert(mat, p, inv);


		for (a=0; a<k; ++a){ // convert from gsl matrix
			for (b=0; b<k; ++b){
				rm[b][a] = gsl_matrix_get(inv,b,a);
			}
		}
		SET_VECTOR_ELT(r, i, rm);
	}
	UNPROTECT(1);
	return (r);
}


From spluque at gmail.com  Mon Dec 25 01:43:58 2006
From: spluque at gmail.com (Sebastian P. Luque)
Date: Sun, 24 Dec 2006 18:43:58 -0600
Subject: [Rd] .Rbuildignore and vignettes
Message-ID: <878xgwx0s1.fsf@patagonia.sebmags.homelinux.org>

Hi,

Is there some way of controlling whether building of vignettes should use
.Rbuildignore?  I realized that some objects I had created in a file
listed under .Rbuildignore were available while building the package.  The
package does build _without_ the files listed in .Rbuildignore, but the
vignettes are built ignoring this file.

I'm using:


---<---------------cut here---------------start-------------->---
R> sessionInfo()
R version 2.4.1 (2006-12-18) 
x86_64-pc-linux-gnu 

locale:
LC_CTYPE=en_CA.UTF-8;LC_NUMERIC=C;LC_TIME=en_CA.UTF-8;LC_COLLATE=en_CA.UTF-8;LC_MONETARY=en_CA.UTF-8;LC_MESSAGES=en_CA.UTF-8;LC_PAPER=en_CA.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_CA.UTF-8;LC_IDENTIFICATION=C

attached base packages:
[1] "stats"     "graphics"  "grDevices" "utils"     "datasets"  "methods"  
[7] "base"     

other attached packages:
rcompletion     lattice 
   "0.0-12"   "0.14-16" 
---<---------------cut here---------------end---------------->---



Merry Christmas!

-- 
Seb


From tlumley at u.washington.edu  Mon Dec 25 04:52:49 2006
From: tlumley at u.washington.edu (Thomas Lumley)
Date: Sun, 24 Dec 2006 19:52:49 -0800 (PST)
Subject: [Rd] FW: Passing lists from R to C, extracting elements,
 and sending lists back again
In-Reply-To: <20061224185851125.00000000424@MBRAUN>
References: <20061224185851125.00000000424@MBRAUN>
Message-ID: <Pine.LNX.4.64.0612241943260.20551@homer24.u.washington.edu>

>
> I have data that is stored in R lists.  I would like to pass the list to 
> C code using the .Call function, perform mathematical operations on the 
> elements of the lists (which might be other lists), and return results 
> in a new list.
>
> As a simple example, suppose I have a list of n matrices (dimension 
> k-by-k) that I want to invert, and return the result in another list. 
> I wrote the C code below that reads the list as a SEXP.  Then, for each 
> of the i=1..n matrices, I convert the R vector to a gsl matrix, perform 
> the linear algebra operations and populate the new list with the 
> inverted matrix.
>
> The problem is that I can't figure out the best way to get the real 
> elements into the list SEXP to return it to R.  When I run the code 
> below, the compiler (R CMD SHLIB sexp1.c) gives me:
>
> -bash-3.00$ R CMD SHLIB sexp1.c
> gcc -I/usr/lib64/R/include -I/usr/lib64/R/include -I/usr/include -I/usr/local/include   -fpic  -O2 -g -c sexp1.c -o sexp1.o
> sexp1.c: In function `invMatList':
> sexp1.c:37: warning: passing arg 3 of `SET_VECTOR_ELT' from incompatible pointer type gcc -shared -L/usr/local/lib64 -o sexp1.so sexp1.o -L/usr/lib64 -lgsl -lgslcblas -L/usr/lib  -L/usr/lib64/R/lib -lR
>
<snip>
> 	SEXP r = PROTECT(allocVector(VECSXP,n));
> 	double rm[k][k];

This allocates memory for one k x k C array wherever C allocates temporary 
storage. You need to allocate n vectors of length k*k on the R heap to 
create a list of n matrices in R.   So you need to use allocVector(k*k, 
REALSXP) to allocate space for each element of the list, inside the loop, 
and then copy the data into that rather than into rm.

SET_VECTOR_ELT is giving a warning about incompatible pointer types, but 
the more important issue is that you need to return pointers to n 
different blocks of memory that are not going to go away after your 
function finishes.

 	-thomas

>
>
> 	for (i=0; i<n; i=i+1) {
>
> 		for (a=0; a<k; ++a){ // convert to gsl matrix
> 			for (b=0; b<k; ++b){
> 				ind = b*k + a;
> 				m = REAL(VECTOR_ELT(list,i))[ind];
> 				gsl_matrix_set(mat, b, a, m);
> 			}
> 		} // end conversion loops
>
> 		gsl_linalg_LU_decomp(mat, p, &s);
> 		gsl_linalg_LU_invert(mat, p, inv);
>
>
> 		for (a=0; a<k; ++a){ // convert from gsl matrix
> 			for (b=0; b<k; ++b){
> 				rm[b][a] = gsl_matrix_get(inv,b,a);
> 			}
> 		}
> 		SET_VECTOR_ELT(r, i, rm);
> 	}
> 	UNPROTECT(1);
> 	return (r);
> }
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

Thomas Lumley			Assoc. Professor, Biostatistics
tlumley at u.washington.edu	University of Washington, Seattle


From manuel.castejon at unileon.es  Mon Dec 25 11:10:49 2006
From: manuel.castejon at unileon.es (=?ISO-8859-1?Q?Manuel_Castej=F3n_Limas?=)
Date: Mon, 25 Dec 2006 11:10:49 +0100
Subject: [Rd] FW: Passing lists from R to C, extracting elements,
 and sending lists back again
Message-ID: <458FA3A9.7070905@unileon.es>

Dear Michael,

I had to tackle a similar issue while programming the AMORE package.
I recommend you to have a look at the source code of its "copynet.c" file. You
may find useful the reading of the "copynet_RC" function ( Copies the SEXP net
to the *ptnet) and the "copynet_CR" function (Copies *ptnet to SEXP net).

Of course, I do not pretend to establish what best practices should be, just to
show you how I solved a similar issue following my personal understanding of
what was appropriated in that situation.

Best wishes and Merry Christmas!
Manuel


From tlumley at u.washington.edu  Wed Dec 27 18:54:36 2006
From: tlumley at u.washington.edu (Thomas Lumley)
Date: Wed, 27 Dec 2006 09:54:36 -0800 (PST)
Subject: [Rd] proposal: allowing alternative variance estimators in glm/lm
Message-ID: <Pine.LNX.4.64.0612270934220.25209@homer24.u.washington.edu>


There has been recent discussion about alternatives to the model-based 
standard error estimators for lm. While some people like the sandwich 
estimator and others don't, it is clear that neither estimator dominates 
the other for any sane loss function.  It is also worth noting that the 
sandwich estimator is the default for t.test().

I think it would be useful for models using other variance estimators to 
be able to inherit from lm and use summary.lm and predict.lm (and 
similarly for glm).  The main step in making this possible would be
moving the variance-covariance matrix computation that is currently 
duplicated in summary.lm and predict.lm into vcov.lm, and then having 
summary.lm and predict.lm call vcov().

This allows a fitting function (whether lm() or another function) to 
produce objects that inherit usefully from lm and glm but have other 
standard error estimators, by supplying a new vcov method for the class. 
The initial discusssion was about heteroscedasticity-consistent sandwich 
estimators, but from my point of view autocorrelation-consistent 
estimators and estimators that handle sampling weights are more 
interesting.

OOP purists might point out that the relationship involved is not, 
strictly speaking, inheritance.  They would be quite right. However, 
unless someone wants to rewrite glm and lm for S4 classes I think that 
battle is lost.


     -thomas

Thomas Lumley			Assoc. Professor, Biostatistics
tlumley at u.washington.edu	University of Washington, Seattle


From ripley at stats.ox.ac.uk  Wed Dec 27 19:43:57 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 27 Dec 2006 18:43:57 +0000 (GMT)
Subject: [Rd] proposal: allowing alternative variance estimators in
	glm/lm
In-Reply-To: <Pine.LNX.4.64.0612270934220.25209@homer24.u.washington.edu>
References: <Pine.LNX.4.64.0612270934220.25209@homer24.u.washington.edu>
Message-ID: <Pine.LNX.4.64.0612271834520.11551@gannet.stats.ox.ac.uk>

What concerns me about this is if people call the summary methods directly 
on objects not of the right class.  That used to be quite prevalent in R 
itself, but problems with residuals/weights mean it has now gone, I 
believe.

summary.lm and summary.glm are exported from stats, and this indicates 
that they were quite widely used (and a grep across CRAN suggests that 
they still are).

One fairly backwards-compatible option would seem to be to call the vcov 
generic only if the object inherits from [g]lm and had an earlier class.


On Wed, 27 Dec 2006, Thomas Lumley wrote:

>
> There has been recent discussion about alternatives to the model-based
> standard error estimators for lm. While some people like the sandwich
> estimator and others don't, it is clear that neither estimator dominates
> the other for any sane loss function.  It is also worth noting that the
> sandwich estimator is the default for t.test().
>
> I think it would be useful for models using other variance estimators to
> be able to inherit from lm and use summary.lm and predict.lm (and
> similarly for glm).  The main step in making this possible would be
> moving the variance-covariance matrix computation that is currently
> duplicated in summary.lm and predict.lm into vcov.lm, and then having
> summary.lm and predict.lm call vcov().
>
> This allows a fitting function (whether lm() or another function) to
> produce objects that inherit usefully from lm and glm but have other
> standard error estimators, by supplying a new vcov method for the class.
> The initial discusssion was about heteroscedasticity-consistent sandwich
> estimators, but from my point of view autocorrelation-consistent
> estimators and estimators that handle sampling weights are more
> interesting.
>
> OOP purists might point out that the relationship involved is not,
> strictly speaking, inheritance.  They would be quite right. However,
> unless someone wants to rewrite glm and lm for S4 classes I think that
> battle is lost.
>
>
>     -thomas
>
> Thomas Lumley			Assoc. Professor, Biostatistics
> tlumley at u.washington.edu	University of Washington, Seattle
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ggrothendieck at gmail.com  Thu Dec 28 10:34:50 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Thu, 28 Dec 2006 04:34:50 -0500
Subject: [Rd] Fwd: [R] axis and times() problem
In-Reply-To: <459389EE.2030908@web.de>
References: <45924953.9070100@einthal.de>
	<971536df0612270432q6da9143cu8c0a611508ba39e7@mail.gmail.com>
	<459389EE.2030908@web.de>
Message-ID: <971536df0612280134k4deb34aem3a650c8daa6f1004@mail.gmail.com>

The axes do not intersect with this command.  Is it a bug?

   plot(c(.51, .6), bty = "n", xaxs = "i", yaxs = "i")

If I remove the bty = "n" then they do intersect.

Also see:

https://www.stat.math.ethz.ch/pipermail/r-help/2006-December/122734.html


From tpapp at Princeton.EDU  Thu Dec 28 15:46:28 2006
From: tpapp at Princeton.EDU (Tamas K Papp)
Date: Thu, 28 Dec 2006 15:46:28 +0100
Subject: [Rd] calling optimize/fmin from C code
Message-ID: <20061228144628.GA4458@pu100877.student.princeton.edu>

Hi,

To make a calculation (an innermost loop) that uses optimize faster, I
think I should write things in C.  Is it possible to call fmin, which
is called by optimize, from C?  It is not listed in Writing R
extensions, but I found

double Brent_fmin(double ax, double bx, double (*f)(double, void *),
                  void *info, double tol);

in Applic.h.  Is this the function I am looking for?

My guess is that ax and bx are the endpoints, f is the function, but
what is it's second argument (void *)?  What is *info?

Or is it some other function altogether?

Thanks,

Tamas


From cberry at tajo.ucsd.edu  Thu Dec 28 18:35:35 2006
From: cberry at tajo.ucsd.edu (Charles C. Berry)
Date: Thu, 28 Dec 2006 09:35:35 -0800
Subject: [Rd] Fwd: [R] axis and times() problem
In-Reply-To: <971536df0612280134k4deb34aem3a650c8daa6f1004@mail.gmail.com>
References: <45924953.9070100@einthal.de>
	<971536df0612270432q6da9143cu8c0a611508ba39e7@mail.gmail.com>
	<459389EE.2030908@web.de>
	<971536df0612280134k4deb34aem3a650c8daa6f1004@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0612280930001.11219@tajo.ucsd.edu>

On Thu, 28 Dec 2006, Gabor Grothendieck wrote:

> The axes do not intersect with this command.  Is it a bug?
>
>   plot(c(.51, .6), bty = "n", xaxs = "i", yaxs = "i")
>
> If I remove the bty = "n" then they do intersect.

box() is making it look like the axes are different.

Axis()/axis() is behaving the same way in both cases.

> par(mfrow=c(1,2))
> plot(c(.51, .6), bty = "n", xaxs = "i", yaxs = "i")
> box(lty=2)
> plot(c(.51, .6), xaxs = "i", yaxs = "i")
> axis(4,col=2)

[...]


Charles C. Berry                        (858) 534-2098
                                          Dept of Family/Preventive Medicine
E mailto:cberry at tajo.ucsd.edu	         UC San Diego
http://biostat.ucsd.edu/~cberry/         La Jolla, San Diego 92093-0717


From ross at biostat.ucsf.edu  Thu Dec 28 21:15:58 2006
From: ross at biostat.ucsf.edu (Ross Boylan)
Date: Thu, 28 Dec 2006 12:15:58 -0800
Subject: [Rd] setGeneric and file order in a package
Message-ID: <20061228201558.GB23253@wheat.betterworld.us>

Are there any assumptions I can make about the order in which
different files in the R package subdirectory will be evaluated?  For
example, will it be alphabetical in the file names?  Will case
distinctions be ignored?

I ask because I would like to use setGeneric, as in
setGeneric("foo", function(x) standardGeneric("foo")) and am wondering
where that should go.

I realize I could explicitly test for the existence of the generic in
each spot, and execute setGeneric as needed.  That seems wasteful and
error prone.

Is there other recommended practice in setting generics?  For example,
should I test for existence of a generic in the one spot I create it?
Since that seems like a half-measure (if a generic exists it may well
have different arguments) I suppose I should use namespaces...

Thanks.
Ross Boylan


From gregor.gorjanc at bfro.uni-lj.si  Fri Dec 29 04:10:43 2006
From: gregor.gorjanc at bfro.uni-lj.si (Gregor Gorjanc)
Date: Fri, 29 Dec 2006 03:10:43 +0000 (UTC)
Subject: [Rd] setGeneric and file order in a package
References: <20061228201558.GB23253@wheat.betterworld.us>
Message-ID: <loom.20061229T040847-224@post.gmane.org>

Ross Boylan <ross <at> biostat.ucsf.edu> writes:
> Are there any assumptions I can make about the order in which
> different files in the R package subdirectory will be evaluated?  For
> example, will it be alphabetical in the file names?  Will case
> distinctions be ignored?

Take a look at collate field in DESCRIPTION file. This is from BioC wiki[1]

"If you are using S4 classes or methods, add a Collate field to your package's
DESCRIPTION file. Generally, class definitions come first, generics second,
methods third, and then everything else."

Gregor

[1]http://wiki.fhcrc.org/bioc/Package_Guidelines


From maechler at stat.math.ethz.ch  Fri Dec 29 11:28:39 2006
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Fri, 29 Dec 2006 11:28:39 +0100
Subject: [Rd] Fwd: [R] axis and times() problem
In-Reply-To: <Pine.LNX.4.64.0612280930001.11219@tajo.ucsd.edu>
References: <45924953.9070100@einthal.de>
	<971536df0612270432q6da9143cu8c0a611508ba39e7@mail.gmail.com>
	<459389EE.2030908@web.de>
	<971536df0612280134k4deb34aem3a650c8daa6f1004@mail.gmail.com>
	<Pine.LNX.4.64.0612280930001.11219@tajo.ucsd.edu>
Message-ID: <17812.60887.98978.129308@stat.math.ethz.ch>

>>>>> "ChuckB" == Charles C Berry <cberry at tajo.ucsd.edu>
>>>>>     on Thu, 28 Dec 2006 09:35:35 -0800 writes:

    ChuckB> On Thu, 28 Dec 2006, Gabor Grothendieck wrote:

    >> The axes do not intersect with this command.  Is it a bug?

not at all, as Chuck demonstrated below.

  >> plot(c(.51, .6), bty = "n", xaxs = "i", yaxs = "i")

BTW: The same, an epsilon more efficient and also a bit more
"self-documenting", would be 

 plot(c(.51, .6), frame.plot = FALSE, xaxs = "i", yaxs = "i")

    >> If I remove the bty = "n" then they do intersect.

    ChuckB> box() is making it look like the axes are different.

    ChuckB> Axis()/axis() is behaving the same way in both cases.

In other words, the axes typically do *not* intersect at all.
Because most plot() methods {and plot.default() specifically}
end up calling box() which draws a rectangle ("box") around the
plotting region, many users may have got the wrong
interpretation of  intersecting axes.

They are not, as Chuck's example nicely shows :

    >> par(mfrow=c(1,2))
    >> plot(c(.51, .6), bty = "n", xaxs = "i", yaxs = "i")
    >> box(lty=2)
    >> plot(c(.51, .6), xaxs = "i", yaxs = "i")
    >> axis(4,col=2)

    ChuckB> [...]

Martin Maechler, ETH Zurich


From martin.becker at mx.uni-saarland.de  Fri Dec 29 11:53:55 2006
From: martin.becker at mx.uni-saarland.de (martin.becker at mx.uni-saarland.de)
Date: Fri, 29 Dec 2006 11:53:55 +0100 (CET)
Subject: [Rd] bug in cut.Date() (PR#9433)
Message-ID: <20061229105355.A1299561D6@slim.kubism.ku.dk>

Full_Name: Martin Becker
Version: 2.4.1
OS: WinXP/Linux
Submission from: (NULL) (134.96.96.42)


When using cut.Date() with 'breaks="year"', the month of the breakpoints is
properly set to January, but the day of month is not set to 1.

This leads to a strange behaviour, see the following example:

 > cut(as.Date(c("2000-01-17","2001-01-13","2001-01-20")),breaks="y")
[1] 2000-01-17 2000-01-17 2001-01-17
Levels: 2000-01-17 2001-01-17

I asked on R-devel (2006-12-20), if there are reasons for this (in my opinion
strange) behaviour, but since I got no answer, I suppose this behaviour is not
intended and thus there is a bug in cut.Date(). 

The corresponding code fragment which defines the first breakpoint in 
the case 'breaks="year"' reads (2.4.1, 2.4.1 patched, 2.5.0):

        if (valid == 4) {
            start$mon <- 0
            incr <- 366
        }
 
I think, the code fragment above should better read:

        if (valid == 4) {
            start$mon <- 0
            start$mday <- 1
            incr <- 366
        }

The following patch to src/library/base/R/dates.R should do this change:

301c301
<       if(valid == 4) { start$mon <- 0; incr <- 366 }
---
>       if(valid == 4) { start$mon <- 0; start$mday <- 1; incr <- 366 }

Kind regards,

  Martin


From hin-tak.leung at cimr.cam.ac.uk  Fri Dec 29 23:20:07 2006
From: hin-tak.leung at cimr.cam.ac.uk (Hin-Tak Leung)
Date: Fri, 29 Dec 2006 22:20:07 +0000
Subject: [Rd] calling optimize/fmin from C code
In-Reply-To: <20061228144628.GA4458@pu100877.student.princeton.edu>
References: <20061228144628.GA4458@pu100877.student.princeton.edu>
Message-ID: <45959497.5040604@cimr.cam.ac.uk>

To find out what those parameters are, I would suggest "May the Source
be with you".

What's I like to point out though, is that in R, sometimes it is the 
loop construct which is slow; and also the slower part may not be where 
you think it is. I would suggest looking into (1) moving the whole loop 
into C, (2) replace explicit loops with mapply/tapply/sapply , (3) run 
Rprof() to learn which part of your code is the slowest - it might not 
be where you think it is.

Good luck.

Hin-Tak Leung

Tamas K Papp wrote:
> Hi,
> 
> To make a calculation (an innermost loop) that uses optimize faster, I
> think I should write things in C.  Is it possible to call fmin, which
> is called by optimize, from C?  It is not listed in Writing R
> extensions, but I found
> 
> double Brent_fmin(double ax, double bx, double (*f)(double, void *),
>                   void *info, double tol);
> 
> in Applic.h.  Is this the function I am looking for?
> 
> My guess is that ax and bx are the endpoints, f is the function, but
> what is it's second argument (void *)?  What is *info?
> 
> Or is it some other function altogether?
> 
> Thanks,
> 
> Tamas
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From ross at biostat.ucsf.edu  Sun Dec 31 02:20:17 2006
From: ross at biostat.ucsf.edu (Ross Boylan)
Date: Sat, 30 Dec 2006 17:20:17 -0800
Subject: [Rd] Capturing argument values
Message-ID: <20061231012017.GD23253@wheat.betterworld.us>

I would like to preserve the values of all the arguments to a function
in a results object.
foo <- function(a, b=1) ....
foo(x, 3)

match.call() looks promising, but it records that a is x, while I want
the value of x (in the calling frame).  Also, if the invocation is
foo(x), then match.call doesn't record that b is 1.

So I tried this (inside the function definition):
    myargs <- lapply(names(formals()),
                     function(x) eval(as.name(x)))

That's pretty close.  However, my function has an optional argument in
this sense:
bar <- function(x, testing) ...
where code in the body is 
  if (! missing(testing)) do stuff

When the eval in the previous lapply runs for a function call in which
testing is not supplied, I get
Error in eval(expr, envir, enclos) : argument "testing" is missing,
with no default
exposing a weakness in both my implementation and problem specification.

I think I could simply screen "testing" out of the formals and be
happy, but are there better ways of handling this situation?

I realize I could capture the function's entire local frame, but that
has quite a bit of stuff I don't want in it.  I suspect some of the
items in it might be promises, and so would not have the values I
needed as well.  (Also the frame could later change, though I guess I
could convert it to a list to avoid that problem.)


Ross Boylan


