From ripley at stats.ox.ac.uk  Mon Sep  1 10:28:10 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 1 Sep 2008 09:28:10 +0100 (BST)
Subject: [Rd] scan after seek in text files (PR#12640)
In-Reply-To: <20080829224007.5BB5E282EFF6@mail.pubhealth.ku.dk>
References: <20080829224007.5BB5E282EFF6@mail.pubhealth.ku.dk>
Message-ID: <alpine.LFD.1.10.0809010926040.26166@auk.stats.ox.ac.uk>

The issue is the pushback on text files (which readChar does not use).
I've altered the logic in 2.7.2 patched so that seek() clears the 
pushback.

NB:
1) Your code is incomplete (you need library(MASS)),
2) You are asked not to report on obsolete versions of R.

On Sat, 30 Aug 2008, alex at apeironsports.com wrote:

> Full_Name: Dr. Alex Sheppard
> Version: 2.7.1
> OS: Linux Debian Lenny
> Submission from: (NULL) (79.73.224.62)
>
>
> After scanning from an open (text) connection, then seeking, then scanning
> again, the second scan returns incorrect result. It looks like the first byte
> scanned was from the pre-seek file position, then it continues to read from the
> post-seek file position.
>
>
> To reproduce:
>
> #Put 3x3 matrix in a file
>> write.matrix(t(matrix(1:9,nrow=3)),file="TEST.txt",sep="\t")
>
> #Open file as text
>> fd <- file("TEST.txt",open="rt")
>
> #scan a couple of fields - this looks fine so far
>> scan(file=fd,what=double(),n=2)
> Read 2 items
> [1] 1 2
>
> #seek back to start of file
>> seek(con=fd,where=0,origin="start")
> [1] 5
>
> #scan fields again - this doesn't work properly
>> scan(file=fd,what=double(),n=2)
> Read 2 items
> [1] 31  2
>
> This happens when either n or nmax arguments are used to control number of
> fields read. Problem does not occur when using nlines argument instead. The seek
> appears to work ok, as doing readChar(fd,n=1) after the seek operation correctly
> returns "1".
> Also, if the file is opened as binary, i.e. fd=file("TEST.txt",open="rb") , all
> works fine.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Mon Sep  1 12:06:42 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 1 Sep 2008 11:06:42 +0100 (BST)
Subject: [Rd] (PR#12628) Second X11 call with invalid display crashes R
 after first X11 call.
In-Reply-To: <Pine.GSO.4.56.0808281359120.16731@devsun3201.insightful.com>
References: <20080828085510.0B8F1282C765@mail.pubhealth.ku.dk>
	<alpine.LFD.1.10.0808281102020.15220@auk.stats.ox.ac.uk>
	<Pine.GSO.4.56.0808281359120.16731@devsun3201.insightful.com>
Message-ID: <alpine.LFD.1.10.0809011021550.9719@gannet.stats.ox.ac.uk>

This is a different issue, and one that I am unable to reproduce.  If I 
start PUTTY with X11 forwarding and no X server, I get the usual message 
from X11().

As I understand it, when running available.packages() you are getting a 
call to the tcltk version of chooseCRANmirror().  Again that works 
correctly for me, falling back to a text menu.  This is related to whether 
capabilities("X11") returns TRUE for X11, and that does attempt to open a 
display via in_R_X11_access.

I think this has to be something specific to Bill's X setup.  Note that we 
don't even always set X11 handlers (Rf_setX11Display makes it optional), 
so I don't really want to follow your suggestion and set a handler 
unconditionally.  If we were to go that route, I think setting a separate 
simple handler before the calls to XOpenDisplay in X11_Open and 
in_R_X11_access would be more appropriate.  I'll send Bill a version that 
does that for testing, as I cannot reproduce this.

Rf_setX11Display is always called with setHandlers=TRUE from R itself. 
This seems lost in the mists of time (from the original version of 
src/modules/X11/devX11.h in 2001) so unless anyone knows of a package that 
uses it perhaps we should remove the option.

On Thu, 28 Aug 2008, Bill Dunlap wrote:

> On Thu, 28 Aug 2008, Prof Brian Ripley wrote:
>
>> This is an Xt error, whereas the first one is an Xlib error.  It is easy
>> to trap it.
>>
>> You do realize that this will never work?  In the current setup all open
>> X11 devices must be on the same display, and 'display' is ignored if a
>> device is already open.  (I don't know if that is documented: I did not
>> write the Xlib device nor the help page.)
>
> I have a different problem with the x11() bringing
> down R when $DISPLAY does not refer to a valid X
> server.  I typically sit at a Windows laptop running
> a Cygwin X server and use the ssh client/terminal
> emulator program 'putty' to run a shell on on Linux,
> where I run R.  Putty tunnels X protocol and sets
> DISPLAY (to something like localhost:11.0) whether or
> not the PC's X server is running.  If I have forgotten
> to start the PC's X server R currently shuts down when
> I try to start x11() or the tcl/tk stuff that
> available.packages() runs.  E.g.,
>  > x11()
>  X connection to localhost:11.0 broken (explicit kill or server shutdown).
>  linuxPrompt%
>
> If I call the XIOErrorHandler(R_X11IOErr) before calling XOpenDisplay()
> (in src/modules/X11/devX11.c) then I can trap that error
> and have x11() throw an ordinary R error:
>  > x11()
>  Error in x11() : X11 I/O error while opening device "localhost:11.0"
>  >
>
> The following patch sets the IOErrorHandler before XOpenDisplay
> and changes the handler a bit so it doesn't assume that some
> global variables have been set yet.
>
> It doesn't help the problem in available.packages().  That must
> make its own unprotected call to XOpenDisplay().
>
> Index: src/modules/X11/devX11.c
> ===================================================================
> --- src/modules/X11/devX11.c	(revision 46454)
> +++ src/modules/X11/devX11.c	(working copy)
> @@ -1080,19 +1080,30 @@
>
> static int R_X11IOErr(Display *dsp)
> {
> -    int fd = ConnectionNumber(display);
> -    /*
> -    while (nfonts--)  R_XFreeFont(display, fontcache[nfonts].font);
> -    nfonts = 0;
> -    */
> -    removeInputHandler(&R_InputHandlers,
> -		       getInputHandler(R_InputHandlers,fd));
> -    /*
> -    XCloseDisplay(display);
> -    displayOpen = FALSE;
> -    strcpy(dspname, "");
> -    */
> -    error(_("X11 fatal IO error: please save work and shut down R"));
> +    int fd ;
> +    /* display is only set after successful call to XOpenDisplay.
> +     * If it is non-null I think it should be the same as dsp, but
> +     * display==NULL & dsp!=NULL means that we have run into a problem
> +     * while executing XOpenDisplay.
> +     */
> +    if (display && displayOpen) {
> +       fd = ConnectionNumber(display);
> +       /*
> +       while (nfonts--)  R_XFreeFont(display, fontcache[nfonts].font);
> +       nfonts = 0;
> +       */
> +       removeInputHandler(&R_InputHandlers,
> +		          getInputHandler(R_InputHandlers,fd));
> +       /*
> +       XCloseDisplay(display);
> +       displayOpen = FALSE;
> +       strcpy(dspname, "");
> +       */
> +       error(_("X11 fatal IO error: please save work and shut down R"));
> +    } else if (dsp) { /* In XOpenDisplay() is the intent */
> +       char *devname =  XDisplayName(dspname) ;
> +       error(_("X11 I/O error while opening device \"%s\""), devname);
> +    }
>     return 0; /* but should never get here */
> }
>
> @@ -1247,15 +1258,21 @@
>     /* initialize the X11 device driver data structures. */
>
>     if (!displayOpen) {
> +        /* Set IOErrorHandler before trying to open the display
> +         * just in case DISPLAY is putty tunnelling X11 protocol
> +         * to a machine that is not runing an X server.  Set dspname
> +         * now so R_X11IOErr can show it to user. */
> +	XSetIOErrorHandler(R_X11IOErr);
> +	strncpy(dspname, p, 101);
> +	dspname[100] = '\0';
> 	if ((display = XOpenDisplay(p)) == NULL) {
> +            dspname[0] = '\0' ;
> 	    warning(_("unable to open connection to X11 display '%s'"), p);
> 	    return FALSE;
> 	}
> 	DisplayOpened = TRUE;
> 	Rf_setX11Display(display, gamma_fac, colormodel, maxcube, TRUE);
> 	displayOpen = TRUE;
> -	strncpy(dspname, p, 101);
> -	dspname[100] = '\0';
> 	if(xd->handleOwnEvents == FALSE)
> 	    addInputHandler(R_InputHandlers, ConnectionNumber(display),
> 			    R_ProcessX11Events, XActivity);
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From Rory.WINSTON at rbs.com  Tue Sep  2 11:25:58 2008
From: Rory.WINSTON at rbs.com (Rory.WINSTON at rbs.com)
Date: Tue, 2 Sep 2008 10:25:58 +0100
Subject: [Rd] Moving to a new bug reporting system?
In-Reply-To: <mailman.17.1220263204.30131.r-devel@r-project.org>
References: <mailman.17.1220263204.30131.r-devel@r-project.org>
Message-ID: <F5AB27C222D4164382737207F9869F2B51FDEB57DD@LONMC01014.rbsres07.net>

Hi all

This may be an issue that has been discussed at length before, so apologies if I have missed that discussion, but is there any desire to switch from Jitterbug to something more capable and modern? Say JIRA, for instance?

Rory

Rory Winston
RBS Global Banking & Markets
Office: +44 20 7085 4476


***********************************************************************************
The Royal Bank of Scotland plc. Registered in Scotland No 90312. Registered Office: 36 St Andrew Square, Edinburgh EH2 2YB. 
Authorised and regulated by the Financial Services Authority 

This e-mail message is confidential and for use by the=2...{{dropped:22}}


From P.Dalgaard at biostat.ku.dk  Tue Sep  2 13:11:13 2008
From: P.Dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Tue, 02 Sep 2008 13:11:13 +0200
Subject: [Rd] Moving to a new bug reporting system?
In-Reply-To: <F5AB27C222D4164382737207F9869F2B51FDEB57DD@LONMC01014.rbsres07.net>
References: <mailman.17.1220263204.30131.r-devel@r-project.org>
	<F5AB27C222D4164382737207F9869F2B51FDEB57DD@LONMC01014.rbsres07.net>
Message-ID: <48BD1F51.3020008@biostat.ku.dk>

Rory.WINSTON at rbs.com wrote:
> Hi all
>
> This may be an issue that has been discussed at length before, so apologies if I have missed that discussion, but is there any desire to switch from Jitterbug to something more capable and modern? Say JIRA, for instance?
>   

Not on this list, recently, but internally in R Core. Nothing that needs
to be secret, I think.

Latest explorations (following preliminary discussions at useR) have
been in the direction of moving stuff onto R-forge.r-project.org and its
Gforge tracker tool. I don't see us considering a non-OpenSource option.

In general, the thing to look for is maintainability more than
capablility, at least in my opinion, and R-forge has the advantage that
it is preexisting and supported infrastructure. One major disadvantage
is that we'd lose the possibility of integrating r-devel discussions
with bug reports -- we can echo repository changes to the list, but
feeding followups back in requires manual intervention or that we tell
people not to reply but to go to the repository if they have anything to
add. On the other hand, that seems to be what "everyone else" is doing
these days.

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907


From plleung at cuhk.edu.hk  Tue Sep  2 06:10:08 2008
From: plleung at cuhk.edu.hk (plleung at cuhk.edu.hk)
Date: Tue,  2 Sep 2008 06:10:08 +0200 (CEST)
Subject: [Rd] installation problem on Window XP (PR#12658)
Message-ID: <20080902041008.7929B282EFF8@mail.pubhealth.ku.dk>

Full_Name: Leung Pui Lam
Version: 2.72
OS: Window XP
Submission from: (NULL) (137.189.4.4)


When I installed R2.72 (actually any version >2.62) on Window XP (Traditional
Chinese), I found the following error

Error in structure(.Internal(Sys.getenv(as.character(x), as.character(unset)$
unsupported conversion
...
Error in file.exists(name) : unsuported conversion in 'filenameToWchar'

and then an information window appers:

Fatal error: unable to restore saved data in .RData

Can you help me to fix this installation problem? Thanks.


From ripley at stats.ox.ac.uk  Tue Sep  2 14:24:43 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 2 Sep 2008 13:24:43 +0100 (BST)
Subject: [Rd] installation problem on Window XP (PR#12658)
In-Reply-To: <20080902041008.7929B282EFF8@mail.pubhealth.ku.dk>
References: <20080902041008.7929B282EFF8@mail.pubhealth.ku.dk>
Message-ID: <alpine.LFD.1.10.0809021320420.7941@gannet.stats.ox.ac.uk>

On Tue, 2 Sep 2008, plleung at cuhk.edu.hk wrote:

> Full_Name: Leung Pui Lam
> Version: 2.72
> OS: Window XP
> Submission from: (NULL) (137.189.4.4)
>
>
> When I installed R2.72 (actually any version >2.62) on Window XP (Traditional
> Chinese), I found the following error
>
> Error in structure(.Internal(Sys.getenv(as.character(x), as.character(unset)$
> unsupported conversion
> ...
> Error in file.exists(name) : unsuported conversion in 'filenameToWchar'
>
> and then an information window appers:
>
> Fatal error: unable to restore saved data in .RData
>
> Can you help me to fix this installation problem? Thanks.

Not as a bug report.  This is R reporting a problem with your Windows 
settings.  We have seen similar reports before (only in Traditional 
Chinese), but cannot reproduce them -- R 2.7.x (sic) runs correctly for me 
when I set my Windows XP to Hong Kong/Traditional Chinese.


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From kjell.konis at epfl.ch  Tue Sep  2 14:56:34 2008
From: kjell.konis at epfl.ch (Kjell Konis)
Date: Tue, 2 Sep 2008 14:56:34 +0200
Subject: [Rd] the %ProgramFiles% variable
Message-ID: <84D03A53-C61E-46F1-95EF-31E37ECEF17A@epfl.ch>

Hello,

I want to use the %ProgramFiles% variable in a Sys.setenv (R 2.7.2,  
Windows) but it always seems to get handled literally. For instance,  
in cmd.exe I get what I want


C:\Documents and Settings\user>echo %ProgramFiles%
C:\Program Files


but in R


 > system("echo %ProgramFiles%")
%ProgramFiles%


nope. Is there a way to use %ProgramFIles% or get the corresponding  
path?

Thanks,
Kjell


From wwwhsd at gmail.com  Tue Sep  2 14:59:42 2008
From: wwwhsd at gmail.com (Henrique Dallazuanna)
Date: Tue, 2 Sep 2008 09:59:42 -0300
Subject: [Rd] the %ProgramFiles% variable
In-Reply-To: <84D03A53-C61E-46F1-95EF-31E37ECEF17A@epfl.ch>
References: <84D03A53-C61E-46F1-95EF-31E37ECEF17A@epfl.ch>
Message-ID: <da79af330809020559p303d0043yb85cbd3c0622bb8d@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20080902/2d8f8e62/attachment.pl>

From sandro.saitta at gmail.com  Tue Sep  2 14:31:42 2008
From: sandro.saitta at gmail.com (Clusty)
Date: Tue, 2 Sep 2008 05:31:42 -0700 (PDT)
Subject: [Rd]  rpart: ID3 or C4.5?
Message-ID: <19269303.post@talk.nabble.com>


Hello,

My question is about the algorithm used behind decision tree package rpart.
It is not clear in the help if the algorithm used is ID3 or C4.5. Someone
has any idea?

Regards.
Sandro.
-- 
View this message in context: http://www.nabble.com/rpart%3A-ID3-or-C4.5--tp19269303p19269303.html
Sent from the R devel mailing list archive at Nabble.com.


From Achim.Zeileis at wu-wien.ac.at  Tue Sep  2 15:34:32 2008
From: Achim.Zeileis at wu-wien.ac.at (Achim Zeileis)
Date: Tue, 2 Sep 2008 15:34:32 +0200 (CEST)
Subject: [Rd] rpart: ID3 or C4.5?
In-Reply-To: <19269303.post@talk.nabble.com>
References: <19269303.post@talk.nabble.com>
Message-ID: <Pine.LNX.4.64.0809021531170.6483@paninaro.stat-math.wu-wien.ac.at>

On Tue, 2 Sep 2008, Clusty wrote:

> Hello,
>
> My question is about the algorithm used behind decision tree package rpart.
> It is not clear in the help if the algorithm used is ID3 or C4.5. Someone
> has any idea?

1. Not really an R-devel question.
2. As ?rpart tells you it is neither an implementation of ID3 nor C4.5,
    but of Breiman et al's Classification And Regression Trees (CART).
3. For the availability of various tree-based learners, see
      http://CRAN.R-project.org/view=MachineLearning

> Regards.
> Sandro.
> -- 
> View this message in context: http://www.nabble.com/rpart%3A-ID3-or-C4.5--tp19269303p19269303.html
> Sent from the R devel mailing list archive at Nabble.com.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From alex at revolution-computing.com  Tue Sep  2 21:40:28 2008
From: alex at revolution-computing.com (Alex Chen)
Date: Tue, 2 Sep 2008 12:40:28 -0700
Subject: [Rd] mk5check crashed on Windows
Message-ID: <db7324250809021240g728cc1egde29d3876e4aad11@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20080902/9a6890cd/attachment.pl>

From osklyar at maninvestments.com  Wed Sep  3 14:47:56 2008
From: osklyar at maninvestments.com (Sklyar, Oleg (London))
Date: Wed, 3 Sep 2008 13:47:56 +0100
Subject: [Rd] ugly plots with xlim/ylim exceeding data range (changed since
	R2.6.1)
Message-ID: <1A68FCB28DE72F4BA3B967E6506CCE43030496FB@mildnpexmb01.maninvestments.ad.man.com>

The behaviour of the plot function when used with xlim/ylim and the
matplot function as in the following simple example changed between
R2.6.1 and 2.7.0+ producing ugly plots in the new versions. In case of
plot it looks like the pretty function is called with wrong arguments
(i.e. range of supplied data rather than values of xlim and ylim):

m = matrix(c(-0.033, 0.009, 0.064, 0.050, 0.097,
    -0.008, 0.037, 0.070, 0.060, 0.077,
    -0.027, 0.051, 0.060, 0.106, 0.049,
    -0.068, -0.009, 0.095, 0.091, 0.125,
    -0.065, 0.013, 0.062, 0.111, 0.080), ncol=5, byrow=TRUE)

pdf(sprintf("R2.%s_SVN_%s.pdf", version$minor, version$"svn rev"))
plot(c(-5,5),c(0,10),xlim=c(-10,10),ylim=c(-5,15))
matplot(m)
dev.off()

I attached three PDFs with the outputs from R2.6.1 (43537) (which I
consider to be correct), R2.7.2 patched (46442) and R2.8.0 (46234). Just
in case PDFs are removed by the mail server here is the description of
the problem: the one from R2.6.1 plots the axes correctly putting ticks
along the whole axis range even if the data fits just the part of the
range; the ones from 2.7.2 and 2.8.0 put ticks just for the part of the
axis range. In case of plot they cover the range of the data, but with
the requested xlim and ylim they should cover the range of those, and in
case of matplot the range of ticks does not cover the range of data at
all.

Here are the seesionInfo's:

-----------------------------------------------------------------
R version 2.8.0 Under development (unstable) (2008-08-05 r46234) 
x86_64-unknown-linux-gnu 

locale:
C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

-----------------------------------------------------------------
R version 2.7.2 Patched (2008-08-26 r46442) 
x86_64-unknown-linux-gnu 

locale:
C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base 

-----------------------------------------------------------------
R version 2.6.1 (2007-11-26) 
x86_64-unknown-linux-gnu 

locale:
C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base


loaded via a namespace (and not attached):
[1] rcompgen_0.1-17


Dr Oleg Sklyar
Technology Group
Man Investments Ltd
+44 (0)20 7144 3803
osklyar at maninvestments.com


**********************************************************************
The contents of this email are for the named addressee(s) only.
It contains information which may be confidential and privileged.
If you are not the intended recipient, please notify the sender
immediately, destroy this email and any attachments and do not
otherwise disclose or use them. Email transmission is not a
secure method of communication and Man Investments cannot accept
responsibility for the completeness or accuracy of this email or
any attachments. Whilst Man Investments makes every effort to keep
its network free from viruses, it does not accept responsibility
for any computer virus which might be transferred by way of this
email or any attachments. This email does not constitute a request,
offer, recommendation or solicitation of any kind to buy, subscribe,
sell or redeem any investment instruments or to perform other such
transactions of any kind. Man Investments reserves the right to
monitor, record and retain all electronic communications through
its network to ensure the integrity of its systems, for record
keeping and regulatory purposes. 

Visit us at: www.maninvestments.com

**********************************************************************


From ebo at sandien.com  Wed Sep  3 15:51:52 2008
From: ebo at sandien.com (EBo)
Date: Wed, 3 Sep 2008 07:51:52 MDT
Subject: [Rd] suggestion of new API function for embedded programming.
Message-ID: <twig.1220449912.10283@swcp.com>


While doing some embedded programming and trying to figure out how to generate
a hand coded SEXP equivalent of the line
"t.test(x,conf.level=(1-p))$conf.int[2]" I had an idea for an addition to the
embedded API.

There are a number of hidden or static parse functions (R_ParseBuffer,
R_Parse1Buffer, etc.) which take an IoBuffer* and returns a parsed tree.  If
one or more of these functions were exported to the Rembedded.h API we could
do something like the following:

  R_Expr = R_Parse1Buffer(&R_ConsoleIob, 0, &status);
  if (PARSE_OK==status) {
    ...
    value = eval(R_CurrentExpr, rho);
    ...
  }

or possibly simplifying the interface to take the CMDL string:

  R_Expr = R_Parse1Line("t.test(x,conf.level=(1-p))$conf.int[2]", &status);

I think this would be a useful addition to the embedding interface, and
hopefully not difficult to incorporate by someone more experienced with the
internals than I currently am.  I took a few hours to look into adding this
interface, but will not have time to try to do so for a few months -- I have a
couple of hard and fast deadlines over the next couple of weeks.  So, I would
like to make the suggestion and participate in the dialog.

  Best regards,

  EBo --

ps: if someone can suggest how to hand code
"t.test(x,conf.level=(1-p))$conf.int[2]" so I can embedd it I would be most
appreciative.


From luke at stat.uiowa.edu  Wed Sep  3 16:23:02 2008
From: luke at stat.uiowa.edu (Luke Tierney)
Date: Wed, 3 Sep 2008 09:23:02 -0500 (CDT)
Subject: [Rd] suggestion of new API function for embedded programming.
In-Reply-To: <twig.1220449912.10283@swcp.com>
References: <twig.1220449912.10283@swcp.com>
Message-ID: <alpine.LFD.1.10.0809030920560.28931@nokomis.stat.uiowa.edu>

On Wed, 3 Sep 2008, EBo wrote:

>
> While doing some embedded programming and trying to figure out how to generate
> a hand coded SEXP equivalent of the line
> "t.test(x,conf.level=(1-p))$conf.int[2]" I had an idea for an addition to the
> embedded API.
>
> There are a number of hidden or static parse functions (R_ParseBuffer,
> R_Parse1Buffer, etc.) which take an IoBuffer* and returns a parsed tree.  If
> one or more of these functions were exported to the Rembedded.h API we could
> do something like the following:
>
>  R_Expr = R_Parse1Buffer(&R_ConsoleIob, 0, &status);
>  if (PARSE_OK==status) {
>    ...
>    value = eval(R_CurrentExpr, rho);
>    ...
>  }

We definitely do NOT want this frozen into the public API.

>
> or possibly simplifying the interface to take the CMDL string:
>
>  R_Expr = R_Parse1Line("t.test(x,conf.level=(1-p))$conf.int[2]", &status);
>
> I think this would be a useful addition to the embedding interface, and
> hopefully not difficult to incorporate by someone more experienced with the
> internals than I currently am.  I took a few hours to look into adding this
> interface, but will not have time to try to do so for a few months -- I have a
> couple of hard and fast deadlines over the next couple of weeks.  So, I would
> like to make the suggestion and participate in the dialog.

Something along these lines should be feasible in principle, though
care may be needed in handlign of errors.

luke

>
>  Best regards,
>
>  EBo --
>
> ps: if someone can suggest how to hand code
> "t.test(x,conf.level=(1-p))$conf.int[2]" so I can embedd it I would be most
> appreciative.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Luke Tierney
Chair, Statistics and Actuarial Science
Ralph E. Wareham Professor of Mathematical Sciences
University of Iowa                  Phone:             319-335-3386
Department of Statistics and        Fax:               319-335-3017
    Actuarial Science
241 Schaeffer Hall                  email:      luke at stat.uiowa.edu
Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu


From ebo at sandien.com  Wed Sep  3 17:15:41 2008
From: ebo at sandien.com (EBo)
Date: Wed, 3 Sep 2008 09:15:41 MDT
Subject: [Rd] suggestion of new API function for embedded programming.
In-Reply-To: <alpine.LFD.1.10.0809030920560.28931@nokomis.stat.uiowa.edu>
References: <twig.1220449912.10283@swcp.com>, <twig.1220449912.10283@swcp.com>
Message-ID: <twig.1220454941.83227@swcp.com>

Luke Tierney <luke at stat.uiowa.edu> said:

> ...
> > do something like the following:
> >
> >  R_Expr = R_Parse1Buffer(&R_ConsoleIob, 0, &status);
> >  if (PARSE_OK==status) {
> >    ...
> >    value = eval(R_CurrentExpr, rho);
> >    ...
> >  }
> 
> We definitely do NOT want this frozen into the public API.

What is your objection with making something like this a part of the public
API?  I understand that having to use the IOBuffer seems a bit much, but I do
not understand your concern.

> > or possibly simplifying the interface to take the CMDL string:
> >
> >  R_Expr = R_Parse1Line("t.test(x,conf.level=(1-p))$conf.int[2]", &status);
> 
> Something along these lines should be feasible in principle, though
> care may be needed in handlign of errors.

Agreed.  I would also add that R_Parse1Line should also not modify any global
variables so that it basicall functions independently and does not violate the
law of least surprise.  This imples that an environment would also be passed in:

  R_Expr=R_Parse1Line("t.test(x,conf.level=(1-p))$conf.int[2]", rho, &status);

  Thanks and best regards,

  EBo --


From luke at stat.uiowa.edu  Wed Sep  3 18:07:29 2008
From: luke at stat.uiowa.edu (Luke Tierney)
Date: Wed, 3 Sep 2008 11:07:29 -0500 (CDT)
Subject: [Rd] suggestion of new API function for embedded programming.
In-Reply-To: <twig.1220454941.83227@swcp.com>
References: <twig.1220449912.10283@swcp.com>,
	<twig.1220449912.10283@swcp.com> <twig.1220454941.83227@swcp.com>
Message-ID: <alpine.LFD.1.10.0809031106210.28931@nokomis.stat.uiowa.edu>

On Wed, 3 Sep 2008, EBo wrote:

> Luke Tierney <luke at stat.uiowa.edu> said:
>
>> ...
>>> do something like the following:
>>>
>>>  R_Expr = R_Parse1Buffer(&R_ConsoleIob, 0, &status);
>>>  if (PARSE_OK==status) {
>>>    ...
>>>    value = eval(R_CurrentExpr, rho);
>>>    ...
>>>  }
>>
>> We definitely do NOT want this frozen into the public API.
>
> What is your objection with making something like this a part of the public
> API?  I understand that having to use the IOBuffer seems a bit much, but I do
> not understand your concern.

We need the freedom to completely change these internals if doing so
proves useful.

luke

>>> or possibly simplifying the interface to take the CMDL string:
>>>
>>>  R_Expr = R_Parse1Line("t.test(x,conf.level=(1-p))$conf.int[2]", &status);
>>
>> Something along these lines should be feasible in principle, though
>> care may be needed in handlign of errors.
>
> Agreed.  I would also add that R_Parse1Line should also not modify any global
> variables so that it basicall functions independently and does not violate the
> law of least surprise.  This imples that an environment would also be passed in:
>
>  R_Expr=R_Parse1Line("t.test(x,conf.level=(1-p))$conf.int[2]", rho, &status);
>
>  Thanks and best regards,
>
>  EBo --
>
>

-- 
Luke Tierney
Chair, Statistics and Actuarial Science
Ralph E. Wareham Professor of Mathematical Sciences
University of Iowa                  Phone:             319-335-3386
Department of Statistics and        Fax:               319-335-3017
    Actuarial Science
241 Schaeffer Hall                  email:      luke at stat.uiowa.edu
Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu


From ebo at sandien.com  Wed Sep  3 18:12:15 2008
From: ebo at sandien.com (EBo)
Date: Wed, 3 Sep 2008 10:12:15 MDT
Subject: [Rd] suggestion of new API function for embedded programming.
In-Reply-To: <alpine.LFD.1.10.0809031106210.28931@nokomis.stat.uiowa.edu>
References: <twig.1220449912.10283@swcp.com>,
	<twig.1220449912.10283@swcp.com> <twig.1220454941.83227@swcp.com>,
	<twig.1220454941.83227@swcp.com>
Message-ID: <twig.1220458335.76209@swcp.com>

Luke Tierney <luke at stat.uiowa.edu> said:

> On Wed, 3 Sep 2008, EBo wrote:
> 
> > Luke Tierney <luke at stat.uiowa.edu> said:
> >
> >> ...
> >>> do something like the following:
> >>>
> >>>  R_Expr = R_Parse1Buffer(&R_ConsoleIob, 0, &status);
> >>>  if (PARSE_OK==status) {
> >>>    ...
> >>>    value = eval(R_CurrentExpr, rho);
> >>>    ...
> >>>  }
> >>
> >> We definitely do NOT want this frozen into the public API.
> >
> > What is your objection with making something like this a part of the public
> > API?  I understand that having to use the IOBuffer seems a bit much, but I do
> > not understand your concern.
> 
> We need the freedom to completely change these internals if doing so
> proves useful.

Ah, that makes perfect sense.

Thanks,

  EBo --


From l.temarvelde at nioo.knaw.nl  Thu Sep  4 09:06:44 2008
From: l.temarvelde at nioo.knaw.nl (RFTW)
Date: Thu, 4 Sep 2008 00:06:44 -0700 (PDT)
Subject: [Rd]  calculating means per group
Message-ID: <19271479.post@talk.nabble.com>


Hi all
I have a very basic question, yet i have not found how to do it.

Suppose my dataset looks like this:

Year	Area	value
1	a	20
1	a	25
1	a	28
1	a	31
1	a	23
1	b	25
1	b	28
1	b	23
1	b	19
2	a	25
2	a	23
2	a	24
2	a	26
2	b	27
2	b	28
2	b	20
2	b	25
2	b	28


Now, i want to calculate a MEAN per year per area. How do i do that?

With mean(value) i calculate the mean of all values of course. I just need
to know how to group year and area correctly.

I assume that i can use this grouping in other calculations too, right?


Cheers,

Luc
-- 
View this message in context: http://www.nabble.com/calculating-means-per-group-tp19271479p19271479.html
Sent from the R devel mailing list archive at Nabble.com.


From Thierry.ONKELINX at inbo.be  Thu Sep  4 09:57:25 2008
From: Thierry.ONKELINX at inbo.be (ONKELINX, Thierry)
Date: Thu, 4 Sep 2008 09:57:25 +0200
Subject: [Rd] calculating means per group
In-Reply-To: <19271479.post@talk.nabble.com>
References: <19271479.post@talk.nabble.com>
Message-ID: <2E9C414912813E4EB981326983E0A104055418E6@inboexch.inbo.be>

Dear Luc,

You should send this kind of questions to the general mailing list
(r-help at r-project.org) instead of the developer list.

To answer your question: have a look at ?by and ?aggregate

HTH,

Thierry 


------------------------------------------------------------------------
----
ir. Thierry Onkelinx
Instituut voor natuur- en bosonderzoek / Research Institute for Nature
and Forest
Cel biometrie, methodologie en kwaliteitszorg / Section biometrics,
methodology and quality assurance
Gaverstraat 4
9500 Geraardsbergen
Belgium 
tel. + 32 54/436 185
Thierry.Onkelinx at inbo.be 
www.inbo.be 

To call in the statistician after the experiment is done may be no more
than asking him to perform a post-mortem examination: he may be able to
say what the experiment died of.
~ Sir Ronald Aylmer Fisher

The plural of anecdote is not data.
~ Roger Brinner

The combination of some data and an aching desire for an answer does not
ensure that a reasonable answer can be extracted from a given body of
data.
~ John Tukey

-----Oorspronkelijk bericht-----
Van: r-devel-bounces at r-project.org
[mailto:r-devel-bounces at r-project.org] Namens RFTW
Verzonden: donderdag 4 september 2008 9:07
Aan: r-devel at r-project.org
Onderwerp: [Rd] calculating means per group


Hi all
I have a very basic question, yet i have not found how to do it.

Suppose my dataset looks like this:

Year	Area	value
1	a	20
1	a	25
1	a	28
1	a	31
1	a	23
1	b	25
1	b	28
1	b	23
1	b	19
2	a	25
2	a	23
2	a	24
2	a	26
2	b	27
2	b	28
2	b	20
2	b	25
2	b	28


Now, i want to calculate a MEAN per year per area. How do i do that?

With mean(value) i calculate the mean of all values of course. I just
need
to know how to group year and area correctly.

I assume that i can use this grouping in other calculations too, right?


Cheers,

Luc
-- 
View this message in context:
http://www.nabble.com/calculating-means-per-group-tp19271479p19271479.ht
ml
Sent from the R devel mailing list archive at Nabble.com.

______________________________________________
R-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-devel

Dit bericht en eventuele bijlagen geven enkel de visie van de schrijver weer en binden het INBO onder geen enkel beding, zolang dit bericht niet bevestigd is door een geldig ondertekend document.%CRLF%The views expressed in  this message and any annex are purely those of the writer and may not be regarded as stating an official position of INBO, as long as the message is not confirmed by a duly signed document%CRLF%


From ebo at sandien.com  Thu Sep  4 09:58:03 2008
From: ebo at sandien.com (EBo)
Date: Thu, 4 Sep 2008 01:58:03 MDT
Subject: [Rd] suggestion of new API function for embedded programming.
In-Reply-To: <twig.1220458335.76209@swcp.com>
References: <twig.1220449912.10283@swcp.com>,
	<twig.1220449912.10283@swcp.com> <twig.1220454941.83227@swcp.com>,
	<twig.1220454941.83227@swcp.com>,
	<alpine.LFD.1.10.0809031106210.28931@nokomis.stat.uiowa.edu>
Message-ID: <twig.1220515083.62751@swcp.com>


I stumbled onto a near trivial solution... here is some example code:

  EBo --

#include <Rembedded.h>
#include <Rdefines.h>
#include <Rinternals.h>
#include <R_ext/Parse.h>


SEXP
LineEval (char *cmd)
{
    SEXP ans;
    int error;

    ans = R_tryLineEval (cmd, R_GlobalEnv, &error);

    if (error)
    {
        fprintf (stderr, "Error evaluating line \"%s\"\n", cmd);
        return R_NilValue;
    }

    return ans;
}


SEXP
R_tryLineEval (char *cmd, SEXP rho, int *error)
{
    SEXP cmdSexp, cmdexpr, ans = R_NilValue;
    int i;
    ParseStatus status;

    *error = 0;

    // parse the R epression
    PROTECT(cmdSexp = allocVector(STRSXP, 1));
    SET_STRING_ELT(cmdSexp, 0, mkChar(cmd));
    cmdexpr = PROTECT(R_ParseVector(cmdSexp, -1, &status, R_NilValue));
    if (status != PARSE_OK) {
        UNPROTECT(2);
        return R_NilValue;
    }
    // Loop is needed here as EXPSEXP will be of length > 1 
    for(i = 0; i < length(cmdexpr); i++)
    {
        ans = R_tryEval(VECTOR_ELT(cmdexpr, i), R_GlobalEnv, error);
        if (*error) {
            UNPROTECT(2);
            return R_NilValue;
        }
    }
    UNPROTECT(2);

    return ans;
}


int
main (int argc, char *argv[])
{
    char *cmd[] =
        {"t.test(x,conf.level=0.67)",
         "t.test(x,conf.level=0.67)$conf.int[2]",
         "xyz=c(9,8,7,6); xyz=median(x)",
         "print(x)",
         NULL
        };
    SEXP ans;
    int  i;

    char *args[] = {"bla", "--gui=none", "--silent", "--no-save"};
    Rf_initEmbeddedR (4, args);

    // set the variable "x" to the dataset.
    SEXP value;
    value = NEW_NUMERIC(11);
    for (i=10; 0<=i; i--)
        NUMERIC_DATA(value)[i] = i;
    PROTECT(value);
    setVar(install("x"), value, R_GlobalEnv);
 
    
    // spin through several R expressions and evaluate each.
    for (i=0; cmd[i]; i++)
    {
        ans = LineEval (cmd[i]);
        if (R_NilValue != ans)
        {
            printf ("cmd = \"%s\"\n", cmd[i]);
            if (IS_NUMERIC(ans))
                printf ("  ans is %f\n", REAL(ans)[0]);
            else 
                PrintValue(ans);
            printf ("#############\n\n");
        }
    }

    return 0;
}






EBo <ebo at sandien.com> said:

> Luke Tierney <luke at stat.uiowa.edu> said:
> 
> > On Wed, 3 Sep 2008, EBo wrote:
> > 
> > > Luke Tierney <luke at stat.uiowa.edu> said:
> > >
> > >> ...
> > >>> do something like the following:
> > >>>
> > >>>  R_Expr = R_Parse1Buffer(&R_ConsoleIob, 0, &status);
> > >>>  if (PARSE_OK==status) {
> > >>>    ...
> > >>>    value = eval(R_CurrentExpr, rho);
> > >>>    ...
> > >>>  }
> > >>
> > >> We definitely do NOT want this frozen into the public API.
> > >
> > > What is your objection with making something like this a part of the public
> > > API?  I understand that having to use the IOBuffer seems a bit much, but
I do
> > > not understand your concern.
> > 
> > We need the freedom to completely change these internals if doing so
> > proves useful.
> 
> Ah, that makes perfect sense.
> 
> Thanks,
> 
>   EBo --
> 



--


From kjell.konis at epfl.ch  Thu Sep  4 10:06:04 2008
From: kjell.konis at epfl.ch (Kjell Konis)
Date: Thu, 4 Sep 2008 10:06:04 +0200
Subject: [Rd] calculating means per group
In-Reply-To: <19271479.post@talk.nabble.com>
References: <19271479.post@talk.nabble.com>
Message-ID: <38DADAFB-D754-4E5A-AC1B-BB0E81BEA76E@epfl.ch>

Hi Luc,

First of all, questions like this should really be asked on the R-help  
mailing list.

The tapply function does what you want:

 > year
  [1] 1 1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2 2
Levels: 1 2
 > area
  [1] a a a a a b b b b a a a a b b b b b
Levels: a b
 > value
  [1] 20 25 28 31 23 25 28 23 19 25 23 24 26 27 28 20 25 28

Note that both year and area are factors.

Get the mean for each area:

 > tapply(value, area, mean)
        a        b
25.00000 24.77778

If you make the second argument a list then you can subset on both  
factor columns:

 > tapply(value, list(year, area), mean)
      a     b
1 25.4 23.75
2 24.5 25.60

Kjell


On 4 sept. 08, at 09:06, RFTW wrote:

>
> Hi all
> I have a very basic question, yet i have not found how to do it.
>
> Suppose my dataset looks like this:
>
> Year    Area    value
> 1       a       20
> 1       a       25
> 1       a       28
> 1       a       31
> 1       a       23
> 1       b       25
> 1       b       28
> 1       b       23
> 1       b       19
> 2       a       25
> 2       a       23
> 2       a       24
> 2       a       26
> 2       b       27
> 2       b       28
> 2       b       20
> 2       b       25
> 2       b       28
>
>
> Now, i want to calculate a MEAN per year per area. How do i do that?
>
> With mean(value) i calculate the mean of all values of course. I  
> just need
> to know how to group year and area correctly.
>
> I assume that i can use this grouping in other calculations too,  
> right?
>
>
> Cheers,
>
> Luc
> --
> View this message in context: http://www.nabble.com/calculating-means-per-group-tp19271479p19271479.html
> Sent from the R devel mailing list archive at Nabble.com.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From ripley at stats.ox.ac.uk  Thu Sep  4 10:08:12 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 4 Sep 2008 09:08:12 +0100 (BST)
Subject: [Rd] calculating means per group
In-Reply-To: <2E9C414912813E4EB981326983E0A104055418E6@inboexch.inbo.be>
References: <19271479.post@talk.nabble.com>
	<2E9C414912813E4EB981326983E0A104055418E6@inboexch.inbo.be>
Message-ID: <alpine.LFD.1.10.0809040907390.5977@gannet.stats.ox.ac.uk>

On Thu, 4 Sep 2008, ONKELINX, Thierry wrote:

> Dear Luc,
>
> You should send this kind of questions to the general mailing list
> (r-help at r-project.org) instead of the developer list.
>
> To answer your question: have a look at ?by and ?aggregate

And ?ave .

> HTH,
>
> Thierry

> -----Oorspronkelijk bericht-----
> Van: r-devel-bounces at r-project.org
> [mailto:r-devel-bounces at r-project.org] Namens RFTW
> Verzonden: donderdag 4 september 2008 9:07
> Aan: r-devel at r-project.org
> Onderwerp: [Rd] calculating means per group
>
>
> Hi all
> I have a very basic question, yet i have not found how to do it.
>
> Suppose my dataset looks like this:
>
> Year	Area	value
> 1	a	20
> 1	a	25
> 1	a	28
> 1	a	31
> 1	a	23
> 1	b	25
> 1	b	28
> 1	b	23
> 1	b	19
> 2	a	25
> 2	a	23
> 2	a	24
> 2	a	26
> 2	b	27
> 2	b	28
> 2	b	20
> 2	b	25
> 2	b	28
>
>
> Now, i want to calculate a MEAN per year per area. How do i do that?
>
> With mean(value) i calculate the mean of all values of course. I just
> need
> to know how to group year and area correctly.
>
> I assume that i can use this grouping in other calculations too, right?
>
>
> Cheers,
>
> Luc
> -- 
> View this message in context:
> http://www.nabble.com/calculating-means-per-group-tp19271479p19271479.ht
> ml
> Sent from the R devel mailing list archive at Nabble.com.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
> Dit bericht en eventuele bijlagen geven enkel de visie van de schrijver weer en binden het INBO onder geen enkel beding, zolang dit bericht niet bevestigd is door een geldig ondertekend document.%CRLF%The views expressed in  this message and any annex are purely those of the writer and may not be regarded as stating an official position of INBO, as long as the message is not confirmed by a duly signed document%CRLF%
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From maechler at stat.math.ethz.ch  Thu Sep  4 11:23:58 2008
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Thu, 4 Sep 2008 11:23:58 +0200
Subject: [Rd] PDFs on R-devel ...
In-Reply-To: <1A68FCB28DE72F4BA3B967E6506CCE43030496FB@mildnpexmb01.maninvestments.ad.man.com>
References: <1A68FCB28DE72F4BA3B967E6506CCE43030496FB@mildnpexmb01.maninvestments.ad.man.com>
Message-ID: <18623.43310.215051.805170@stat.math.ethz.ch>

>>>>> "OlegS" == Sklyar, Oleg \(London\) <osklyar at maninvestments.com>
>>>>>     on Wed, 3 Sep 2008 13:47:56 +0100 writes:

[.............]

    OlegS> I attached three PDFs ..........

    OlegS> Just in case PDFs are removed by the mail server here
    OlegS> is the description of the problem:  

[..........]

and the PDFs *were* removed ... for a good reason :

Attachments are allowed if they have the correct 'MIME type'
("google" if you don't know what that is).
Your attached files had  content type  'application/octet-stream'
which basically means "unknown binary format"
i.e. the same format that any executable virus / trojan /
... would also come in.

You may need a smarter e-mail client (than Microsoft's) which
uses the correct type, or one where you can specify the MIME
type of an attachment explictly.  

Martin Maechler, ETH Zurich,
Maintainer of the @r-project.org mailing lists.


From osklyar at maninvestments.com  Thu Sep  4 13:04:27 2008
From: osklyar at maninvestments.com (Sklyar, Oleg (London))
Date: Thu, 4 Sep 2008 12:04:27 +0100
Subject: [Rd] "incorrect" ticks in plot(with xlim/ylim) and matplot in
 R2.7.2, R2.8.0
In-Reply-To: <18623.43310.215051.805170@stat.math.ethz.ch>
References: <1A68FCB28DE72F4BA3B967E6506CCE43030496FB@mildnpexmb01.maninvestments.ad.man.com>
	<18623.43310.215051.805170@stat.math.ethz.ch>
Message-ID: <1A68FCB28DE72F4BA3B967E6506CCE4303049702@mildnpexmb01.maninvestments.ad.man.com>

Dear Martin,

I understand the reasons behind PDF removal, but I actually added a
description of the problem with R2.7+ before... (I cannot select which
email client I use in the office).

Now the problem remains and here is the illustration. The reason for
setting xlim beyond the data range can be e.g. that more data are added
afterwards:

plot(c(-5,5),1:2, xlim=c(-10,10))

R2.6.1 outputs X axis ticks correctly as in:

+--- (-10) --------- (-5) --------- (0) --------- (5) --------- (10)
---+

R2.8.0 and R2.7.2 patched output X-axis ticks "incorrectly" as in the
following illustration (well, the ticks are correct, but the plots are
ugly because ticks do not cover the whole range requested):

+------------- (-6) - (-4) - (-2) - (0) - (2) - (4) - (6)
--------------+

Also, try the following code in R2.6.1 and R2.7+:

m = matrix(c(-0.033, 0.009, 0.064, 0.050, 0.097,
    -0.008, 0.037, 0.070, 0.060, 0.077,
    -0.027, 0.051, 0.060, 0.106, 0.049,
    -0.068, -0.009, 0.095, 0.091, 0.125,
    -0.065, 0.013, 0.062, 0.111, 0.080), ncol=5, byrow=TRUE)

plot(c(-5,5),c(0,10),xlim=c(-10,10),ylim=c(-5,15))
x11(); matplot(m)


Here are the seesionInfo's:

-----------------------------------------------------------------
R version 2.8.0 Under development (unstable) (2008-08-05 r46234) 
x86_64-unknown-linux-gnu 

locale:
C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

-----------------------------------------------------------------
R version 2.7.2 Patched (2008-08-26 r46442) 
x86_64-unknown-linux-gnu 

locale:
C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base 

-----------------------------------------------------------------
R version 2.6.1 (2007-11-26) 
x86_64-unknown-linux-gnu 

locale:
C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base


loaded via a namespace (and not attached):
[1] rcompgen_0.1-17


Dr Oleg Sklyar
Technology Group
Man Investments Ltd
+44 (0)20 7144 3803
osklyar at maninvestments.com 



**********************************************************************
The contents of this email are for the named addressee(s...{{dropped:22}}


From simon.urbanek at r-project.org  Thu Sep  4 16:17:47 2008
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Thu, 4 Sep 2008 10:17:47 -0400
Subject: [Rd] suggestion of new API function for embedded programming.
In-Reply-To: <twig.1220449912.10283@swcp.com>
References: <twig.1220449912.10283@swcp.com>
Message-ID: <B00171C0-EBC2-477F-9D0E-A676FFE62B0C@r-project.org>


On Sep 3, 2008, at 9:51 , EBo wrote:

>
> While doing some embedded programming and trying to figure out how  
> to generate
> a hand coded SEXP equivalent of the line
> "t.test(x,conf.level=(1-p))$conf.int[2]" I had an idea for an  
> addition to the
> embedded API.
>
> There are a number of hidden or static parse functions (R_ParseBuffer,
> R_Parse1Buffer, etc.) which take an IoBuffer* and returns a parsed  
> tree.  If
> one or more of these functions were exported to the Rembedded.h API  
> we could
> do something like the following:
>
>  R_Expr = R_Parse1Buffer(&R_ConsoleIob, 0, &status);
>  if (PARSE_OK==status) {
>    ...
>    value = eval(R_CurrentExpr, rho);
>    ...
>  }
>
> or possibly simplifying the interface to take the CMDL string:
>
>  R_Expr = R_Parse1Line("t.test(x,conf.level=(1-p))$conf.int[2]",  
> &status);
>

Why do you think is R_ParseVector not sufficient for this? That is  
what most of use use to achieve exactly what you describe...
For something that even mimics the continuation behavior of the R  
console have a look at parseString function in Rserve.

Cheers,
Simon


> I think this would be a useful addition to the embedding interface,  
> and
> hopefully not difficult to incorporate by someone more experienced  
> with the
> internals than I currently am.  I took a few hours to look into  
> adding this
> interface, but will not have time to try to do so for a few months  
> -- I have a
> couple of hard and fast deadlines over the next couple of weeks.   
> So, I would
> like to make the suggestion and participate in the dialog.
>
>  Best regards,
>
>  EBo --
>
> ps: if someone can suggest how to hand code
> "t.test(x,conf.level=(1-p))$conf.int[2]" so I can embedd it I would  
> be most
> appreciative.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From osklyar at maninvestments.com  Thu Sep  4 16:27:40 2008
From: osklyar at maninvestments.com (Sklyar, Oleg (London))
Date: Thu, 4 Sep 2008 15:27:40 +0100
Subject: [Rd] patch for graphics/R/plot.R that fixes incorrect tick positions
Message-ID: <1A68FCB28DE72F4BA3B967E6506CCE430304970A@mildnpexmb01.maninvestments.ad.man.com>

As I haven't got any replies to my earlier posts about incorrect tick
positions in plot and matplot, here is the simplest patch to correct
this issue (it fixes both plot with xlim/ylim and matplot). The plot.R
was unchanged between 2.7 and current R-devel. It would be great if the
patch could be (tested and) applied to both the current patched and the
current devel versions.

70,71c70,71
<       localAxis(if(is.null(y)) xy$x else x, side = 1, ...)
<       localAxis(if(is.null(y))  x   else y, side = 2, ...)
---
>         localAxis(xlim, side = 1, ...)
>         localAxis(ylim, side = 2, ...)

It works fine with y given or y NULL, which was an issue before when the
above is.null test was introduced about half a year ago to avoid
conversion to double and thus dropping custom Axis methods. The patched
version was tested with custom time/date Axis methods and works fine, as
well as it works fine with POSIXct objects.

Thanks,
Oleg

Dr Oleg Sklyar
Technology Group
Man Investments Ltd
+44 (0)20 7144 3803
osklyar at maninvestments.com


**********************************************************************
The contents of this email are for the named addressee(s...{{dropped:22}}


From macq at llnl.gov  Thu Sep  4 17:27:52 2008
From: macq at llnl.gov (Don MacQueen)
Date: Thu, 4 Sep 2008 08:27:52 -0700
Subject: [Rd] Request for consideration of small change to R documentation
 file names
Message-ID: <p06230903c4e5ad3f6ec0@[128.115.92.33]>

I hesitate to spend R-core's time with such a small request, but here goes.

On the Manuals page of CRAN one can  download the primary R 
documentation in PDF format. All of the files but one have names 
beginning with "R-". The exception is the R Reference Index 
(fullrefman.pdf). This means that after downloading, all of the files 
but one appear together in a directory listing. It would be 
convenient if *all* of them appeared together.

Hence, I'm requesting that R-core consider changing the name 
"fullrefman.pdf" to "R-fullrefman.pdf".

In the interest of saving time, I don't need an email response to 
this request. The decision will become apparent next time I download 
the documentation, which I do after every update to R.

Thank you,
-Don
-- 
--------------------------------------
Don MacQueen
Environmental Protection Department
Lawrence Livermore National Laboratory
Livermore, CA, USA
925-423-1062


From ebo at sandien.com  Thu Sep  4 17:33:38 2008
From: ebo at sandien.com (EBo)
Date: Thu, 4 Sep 2008 09:33:38 MDT
Subject: [Rd] suggestion of new API function for embedded programming.
In-Reply-To: <B00171C0-EBC2-477F-9D0E-A676FFE62B0C@r-project.org>
References: <twig.1220449912.10283@swcp.com>, <twig.1220449912.10283@swcp.com>
Message-ID: <twig.1220542418.84696@swcp.com>

Simon Urbanek <simon.urbanek at r-project.org> said:

> Why do you think is R_ParseVector not sufficient for this? That is  
> what most of use use to achieve exactly what you describe...
> For something that even mimics the continuation behavior of the R  
> console have a look at parseString function in Rserve.

Thank you for the reply.  

I am new to R, and struggling to learn most of it's aspects and embedding
issues in particular.  When I first posted my questions and comments on the
IRC channel and here I asked how I would go about about achieving this
functionality.  Last night I stumbled onto an example of what R_ParseVector
actually does I was finially able to get it working.  Part of my post was
intended to say I have found a solution, and part of it to show how my
original thought would be done.  There is only on reason to add the API is
code clarity and convenience.  Actually a few additional sentences in the
embedded documentation better explaining what R_ParseVector does would
havekept me from creating this thread and a couple of days of pain.  As for
parseString, this is the first I have read of it, so will now check into it.

Thanks and best regards,

  EBo --


From jeff.horner at vanderbilt.edu  Thu Sep  4 18:00:13 2008
From: jeff.horner at vanderbilt.edu (Jeffrey Horner)
Date: Thu, 04 Sep 2008 11:00:13 -0500
Subject: [Rd] suggestion of new API function for embedded programming.
In-Reply-To: <twig.1220542418.84696@swcp.com>
References: <twig.1220449912.10283@swcp.com>,
	<twig.1220449912.10283@swcp.com> <twig.1220542418.84696@swcp.com>
Message-ID: <48C0060D.8010709@vanderbilt.edu>

EBo wrote on 09/04/2008 10:33 AM:
> Simon Urbanek <simon.urbanek at r-project.org> said:
> 
>> Why do you think is R_ParseVector not sufficient for this? That is  
>> what most of use use to achieve exactly what you describe...
>> For something that even mimics the continuation behavior of the R  
>> console have a look at parseString function in Rserve.
> 
> Thank you for the reply.  
> 
> I am new to R, and struggling to learn most of it's aspects and embedding
> issues in particular.  When I first posted my questions and comments on the
> IRC channel and here I asked how I would go about about achieving this
> functionality.  Last night I stumbled onto an example of what R_ParseVector
> actually does I was finially able to get it working.  Part of my post was
> intended to say I have found a solution, and part of it to show how my
> original thought would be done.  There is only on reason to add the API is
> code clarity and convenience.  Actually a few additional sentences in the
> embedded documentation better explaining what R_ParseVector does would
> havekept me from creating this thread and a couple of days of pain.  As for
> parseString, this is the first I have read of it, so will now check into it.

Also, study the source code in the littler project. As it is a simple 
command line alternative to the R shell script and executable, it may 
bring you up to speed on simple embedding and parsing; another example 
at least.

http://biostat.mc.vanderbilt.edu/LittleR


Jeff

> 
> Thanks and best regards,
> 
>   EBo --
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


-- 
http://biostat.mc.vanderbilt.edu/JeffreyHorner


From ebo at sandien.com  Thu Sep  4 18:22:20 2008
From: ebo at sandien.com (EBo)
Date: Thu, 4 Sep 2008 10:22:20 MDT
Subject: [Rd] suggestion of new API function for embedded programming.
In-Reply-To: <48C0060D.8010709@vanderbilt.edu>
References: <twig.1220449912.10283@swcp.com>,
	<twig.1220449912.10283@swcp.com> <twig.1220542418.84696@swcp.com>,
	<twig.1220542418.84696@swcp.com>
Message-ID: <twig.1220545340.50804@swcp.com>

Jeffrey Horner <jeff.horner at vanderbilt.edu> said:

> Also, study the source code in the littler project. As it is a simple 
> command line alternative to the R shell script and executable, it may 
> bring you up to speed on simple embedding and parsing; another example 
> at least.
> 
> http://biostat.mc.vanderbilt.edu/LittleR


Jeff,

Thank you for the pointer.  Tis is exactly the kind of examples I had
originally asked for and had hoped to find.

  EBo --


From atp at piskorski.com  Thu Sep  4 20:34:19 2008
From: atp at piskorski.com (Andrew Piskorski)
Date: Thu, 4 Sep 2008 14:34:19 -0400
Subject: [Rd] Erlang-style message-passing in R: Rmpi, Snow, NetWorkSpaces,
	etc.
Message-ID: <20080904183419.GA34060@piskorski.com>

I see about 7 different R packages for multi-process parallel
programming.  Which do you think is the best, most complete, and most
robust to pick for general purpose Erlang-style message-passing
programming in R, and why?

First here's my use case, and then my analysis so far.  I often have
code whose basic organization looks something like this:

1. Fetch step: For each date, gather up or pre-process a bunch of
   data.  Return a big list of data, one item on the list for each date.
2. Compute step: For each date on the big list of data, do a bunch of
   computations.

Of course, when the number of dates is large, it's pretty annoying to
wait for all the fetches to complete before starting the compute step.
(Especially when the compute step then hits a bug on the very first
date.)  So in practice, I end up breaking things apart to fetch and
then compute one date at a time, etc.

However, instead of completely serializing everything the way I do
now, it would be nice to have 2 concurrent threads of control
(processes, threads, coroutines, or whatever) which talk to each
other.  Then the compute thread can just periodically say to the fetch
thread, "Give me the next date's worth of data, please."  And usually
the fetch thread will already have that data fetched and ready to go.

Also, sometimes my "compute step" is slow, and has a lots of readily
parallelizable work, so it would be even better if I can optionally
run things across multiple physical machines in a cluster.

How to do it?  R is single-threaded and not thread safe, so threads
are out.  Coroutines are also probably out.  The obvious approach is
to use multiple R processes which talk to each other via some message
passing library.

Fortunately, R has a plethora of such packages.  My question is, which
is the best choice for this sort of use?  From reading their API docs,
here are my brief thoughts on each so far:

- papply:  Not suitable, no bi-directional communication.  Slave
  process return values when the papply() call completes, that's it.

- biopara:  Not suitable, simple one-way master/slave communication
  only, just like papply.

- snow:  Not directly suitable, the supported communication is intended
  to be very simple.  But since it runs on top of Rmpi, perhaps its
  utility code would be useful in conjunction with Rmpi?

- taskPR:  Sounds equivalent to snow.  Also uses MPI underneath.

- Rmpi:  Probably.  Should definitely work for my needs, only question
  is if it's the best choice.  Is it stable, complete, robust, etc.?

- rpvm:  Maybe.  Should be equivalent to Rmpi, but MPI is much more
  popular on clusters than PVM these days.

- NetWorkSpaces:  Maybe.  This looks like a rather mature and
  well-supported multi-language TupleSpace implementation, so it could
  certainly be made to work.

  Passing all my large R data objects back and forth solely as strings
  seems very unappealing, but the docs hint that it includes direct
  (or at least transparent) support for binary R objects.  I need to
  start up and run an explicit NetWorkSpaces Python/Twisted server.

  Also, TupleSpace programming sounds somewhat more limiting than
  Erlang-style message passing (although I definitely do not know that
  for sure!).  On the other hand, the TupleSpace APIs sound a lot
  simpler than MPI.

Since I've never done MPI programming before, I'm also curious about
some of the practical semantics of Rmpi.  E.g., is it possible to send
a message to a busy R process that says, "Stop what you're doing right
now!" and have it obeyed immediately?  Probably not, as I think that
would require either multiple threads or an active event loop
somewhere in either R or the MPI stack.

Finally, here are links and some notes on each of the above 7 packages
(converted from HTML with 'lynx -dump'):

* [1]Rmpi ([2]CRAN, [3]tutorial), [4]rpvm ([5]CRAN). 
* [6]SNOW ([7]CRAN) - Simple Network of Workstations for R, high 
  level interface for parallel R on clusters, uses sockets, MPI, or 
  PVM underneath. Reportedly intended for "embarassingly parallel" 
  not closely coupled problems. 

* [8]papply ([9]CRAN) 
* The [10]Parallel-R project provides both [11]RScaLAPACK ([12]CRAN) 
  and [13]taskPR ([14]old), using MPI. 
* [15]biopara - One-way master/slave communication, much like papply 
  or taskPR. Uses R sockets, no MPI or PVM underneath. 

* [16]NetWorkSpaces for R ([17]article, [18]FAQ) from [19]SCAI is a 
  [20]dual licenced (GPL and commercial) Linda/tuplespace 
  implementation. Also, some aspects sound similar to the [21]data 
  flow variables in [22]Van Roy's [23]CTM and [24]Mozart/Oz. 
 
References 
   1. http://www.stats.uwo.ca/faculty/yu/Rmpi/ 
   2. http://cran.us.r-project.org/src/contrib/Descriptions/Rmpi.html 
   3. http://ace.acadiau.ca/math/ACMMaC/Rmpi/ 
   4. http://www.analytics.washington.edu/statcomp/projects/rhpc/rpvm/ 
   5. http://cran.us.r-project.org/src/contrib/Descriptions/rpvm.html 
   6. http://www.stat.uiowa.edu/~luke/R/cluster/cluster.html 
   7. http://cran.us.r-project.org/src/contrib/Descriptions/snow.html 
   8. http://ace.acadiau.ca/math/ACMMaC/software/papply/ 
   9. http://cran.us.r-project.org/src/contrib/Descriptions/papply.html 
  10. http://www.aspect-sdm.org/Parallel-R/ 
  11. http://www.aspect-sdm.org/Parallel-R/RScaLAPACK/RScaLAPACK.html 
  12. http://cran.us.r-project.org/src/contrib/Descriptions/RScaLAPACK.html 
  13. http://cran.us.r-project.org/web/packages/taskPR/ 
  14. http://www.aspect-sdm.org/Parallel-R/task-pR/task-pR.html 
  15. http://cran.us.r-project.org/src/contrib/Descriptions/biopara.html 
  16. http://sourceforge.net/projects/nws-r/ 
  17. http://www.ddj.com/web-development/200001971 
  18. http://nws-r.sourceforge.net/NetWorkSpacesFAQ.html 
  19. http://www.lindaspaces.com/about/ 
  20. http://www.lindaspaces.com/products/os_licensing.html 
  21. http://en.wikipedia.org/wiki/Oz_(programming_language)#Dataflow_variables_and_declarative_concurrency 
  22. http://www.info.ucl.ac.be/~pvr/cvvanroy.html 
  23. http://www.amazon.com/gp/product/0262220695/ 
  24. http://www.mozart-oz.org/ 

-- 
Andrew Piskorski <atp at piskorski.com>
http://www.piskorski.com/


From astgtciv2008 at gatech.edu  Thu Sep  4 22:06:31 2008
From: astgtciv2008 at gatech.edu (David Bauer)
Date: Thu, 4 Sep 2008 16:06:31 -0400 (EDT)
Subject: [Rd] Erlang-style message-passing in R: Rmpi, Snow,
 NetWorkSpaces, etc.
In-Reply-To: <20080904183419.GA34060@piskorski.com>
Message-ID: <1637954103.1398941220558791777.JavaMail.root@mail7.gatech.edu>

> - taskPR:  Sounds equivalent to snow.  Also uses MPI underneath.

Actually, it is very different from snow.  taskPR was an attempt to get 'free' parallelism out of already existing programs by using simple data dependencies to figure out which individual statements in a program can be run in parallel.  The name comes from the description of the program as exploiting task-level parallelism.  Compare this to snow which uses data-level parallelism (performing the same operation on many pieces of data at once).  Additionally, MPI is optional, and only used for the initial setup of processes.
(If anybody actually uses or has successfully used this package, I would love to hear about it, btw.  While the package *does* work, there are probably few cases where it is worth it.)


David Bauer


From vogranovich at jumptrading.com  Thu Sep  4 23:01:46 2008
From: vogranovich at jumptrading.com (Vadim Organovich)
Date: Thu, 4 Sep 2008 16:01:46 -0500
Subject: [Rd] lapply(NULL, ...) returns empty list
Message-ID: <22D850BC39A25742977325ADDE208E7702669563E4@chiexchange02.w2k.jumptrading.com>

Dear R-devel,

Is there a reason that lapply(NULL, ...) returns the empty list, rather than NULL? It seems intuitive to expect the latter, and rather counterintuitive that lapply(list(), ... ) returns the same value as lapply(NULL, ...).

> lapply(list(), function(x) 1)
list()
>  lapply(NULL, function(x) 1)
list()
> version
               _
platform       i386-pc-mingw32
arch           i386
os             mingw32
system         i386, mingw32
status
major          2
minor          7.1
year           2008
month          06
day            23
svn rev        45970
language       R
version.string R version 2.7.1 (2008-06-23)
>

Regards,
Vadim

Note: This email is for the confidential use of the named addressee(s) only and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you are hereby notified that any review, dissemination or copying of this email is strictly prohibited, and to please notify the sender immediately and destroy this email and any attachments.  Email transmission cannot be guaranteed to be secure or error-free.  Jump Trading, therefore, does not make any guarantees as to the completeness or accuracy of this email or any attachments.  This email is for informational purposes only and does not constitute a recommendation, offer, request or solicitation of any kind to buy, sell, subscribe, redeem or perform any type of transaction of a financial product.


From atp at piskorski.com  Thu Sep  4 23:10:35 2008
From: atp at piskorski.com (Andrew Piskorski)
Date: Thu, 4 Sep 2008 17:10:35 -0400
Subject: [Rd] Erlang-style message-passing in R: Rmpi, Snow,
	NetWorkSpaces, etc.
In-Reply-To: <1637954103.1398941220558791777.JavaMail.root@mail7.gatech.edu>
References: <20080904183419.GA34060@piskorski.com>
	<1637954103.1398941220558791777.JavaMail.root@mail7.gatech.edu>
Message-ID: <20080904211035.GD34060@piskorski.com>

On Thu, Sep 04, 2008 at 04:06:31PM -0400, David Bauer wrote:

> taskPR was an attempt to get 'free' parallelism out of already
> existing programs by using simple data dependencies to figure out
> which individual statements in a program can be run in parallel.
> The name comes from the description of the program as exploiting
> task-level parallelism.

Ah, and thus your reference to Tomasulo's algorithm, interesting.
Thanks for straightening me out there.

  http://users.ece.gatech.edu/~gte810u/Parallel-R/

> (If anybody actually uses or has successfully used this package, I
> would love to hear about it, btw.  While the package *does* work,
> there are probably few cases where it is worth it.)

What would you say typically limits taskPR's approach, not finding
enough instruction-level parallelism at the R script level, or the
communications overhead (probably latency) of trying to make use of
it?

If latency, then perhaps taskPR would work better in a multi-threaded
R interpreter, rather than across a TCP/IP network fabric.  To roughly
test that empirically (assuming you are in fact using MPI for the
communications), I suppose you could start up your several R processes
on a single fat SMP node, and use an MPI that sends messages through
fast shared memory.  That's probably still slower than
thread-to-thread communications, but it should be much lower latency
than TCP/IP.  Maybe you already tried something like that?

-- 
Andrew Piskorski <atp at piskorski.com>
http://www.piskorski.com/


From cedric.carpentier at halbis.com  Thu Sep  4 16:10:07 2008
From: cedric.carpentier at halbis.com (cedric.carpentier at halbis.com)
Date: Thu,  4 Sep 2008 16:10:07 +0200 (CEST)
Subject: [Rd] rgui.exe memory used (PR#12697)
Message-ID: <20080904141007.9D069282EFF8@mail.pubhealth.ku.dk>

Full_Name: cedric Carpentier
Version: 2.6.1
OS: windows 2000
Submission from: (NULL) (212.11.24.48)


Hello, 

I will try to be comprehensive, but excuse me for my approximative english.

I use R to extract data from Factset and  then upload its to a personnal
database. After the storage I create different matrix to do some calculations.

The problem is that when I Open Rgui.exe, this exe take only 24 Mb of memory,
and after matrix creation more than 500mb...

I use rm (list =ls()) + gc() to clear all the R objects..in R i've no more
object (ls () return 0) but Rgui.exe keep 400 Mb of memory used in windows.

In fact I don't succeed to return to the original memory used, that is to say
24Mb.

I've trying to see if an environment have an abnormaly growth but not...?

And then more I advance in my script more the memory growth until the rupture.

Then there is something to do ?

Please note that I used the RODBC package

Many thanks


From h.wickham at gmail.com  Thu Sep  4 23:48:24 2008
From: h.wickham at gmail.com (hadley wickham)
Date: Thu, 4 Sep 2008 16:48:24 -0500
Subject: [Rd] lapply(NULL, ...) returns empty list
In-Reply-To: <22D850BC39A25742977325ADDE208E7702669563E4@chiexchange02.w2k.jumptrading.com>
References: <22D850BC39A25742977325ADDE208E7702669563E4@chiexchange02.w2k.jumptrading.com>
Message-ID: <f8e6ff050809041448j566e8e7dt1375c67bf66abf5a@mail.gmail.com>

On Thu, Sep 4, 2008 at 4:01 PM, Vadim Organovich
<vogranovich at jumptrading.com> wrote:
> Dear R-devel,
>
> Is there a reason that lapply(NULL, ...) returns the empty list, rather than NULL? It seems intuitive to expect the latter, and rather counterintuitive that lapply(list(), ... ) returns the same value as lapply(NULL, ...).


  X: a vector (atomic or list) or an expressions vector.  Other
          objects (including classed objects) will be coerced by
          'as.list'.

> as.list(NULL)
list()

Hadley

-- 
http://had.co.nz/


From astgtciv2008 at gatech.edu  Fri Sep  5 04:57:36 2008
From: astgtciv2008 at gatech.edu (David Bauer)
Date: Thu, 04 Sep 2008 22:57:36 -0400
Subject: [Rd] Erlang-style message-passing in R: Rmpi, Snow,
 NetWorkSpaces, etc.
In-Reply-To: <20080904211035.GD34060@piskorski.com>
References: <20080904183419.GA34060@piskorski.com>
	<1637954103.1398941220558791777.JavaMail.root@mail7.gatech.edu>
	<20080904211035.GD34060@piskorski.com>
Message-ID: <48C0A020.6010102@gatech.edu>

> What would you say typically limits taskPR's approach, not finding
> enough instruction-level parallelism at the R script level, or the
> communications overhead (probably latency) of trying to make use of
> it?

Depends on the specific function.  The communication cost is 
significant, especially serialization and deserialization.  (Since I 
finally found the right way to force a flush of the TCP data, the actual 
network cost isn't a problem for moderate sized data.)  For reasons of 
simplicity of implementation and ease of correctness, a lot of the R 
environment is serialized and sent over with *each* operation.

In terms of the instruction-level parallelism available, code that is a 
performance bottle-neck is usually re-written in C or Fortran and called 
in large blocks.  So now the program is trying to find parallelism in 
the large blocks, which it usually can't.

I didn't have a lot of suitable code to try, and so the best example 
program was one that did a complex calculation followed by an accumulate 
operation in a loop.  Parallel-R/taskPR dynamically unrolled the loop 
(just like Tomosulo's algorithm does on a processor) and got a 
reasonable speedup (about half of linear).  Unfortunately, I don't even 
have that code example any more.


> If latency, then perhaps taskPR would work better in a multi-threaded
> R interpreter, rather than across a TCP/IP network fabric.

Yes, most especially if serialization and deserialization could be 
avoided.  However, I don't believe R is thread-safe?  (Using shared 
memory, but between multiple R processes, was on the TODO list when the 
project ended.)

I was fortunate to have access to a very large NUMA machine at the time 
that I was originally working on this project, so the network itself 
wasn't a limiting factor.  (The network stack turned out to be a 
problem, though.)


David Bauer


From giuseppe1.milicia at hsbcib.com  Fri Sep  5 11:05:56 2008
From: giuseppe1.milicia at hsbcib.com (giuseppe1.milicia at hsbcib.com)
Date: Fri, 5 Sep 2008 10:05:56 +0100
Subject: [Rd] Rmpi on Linux (SuSE) with OpenMPI
Message-ID: <OFF4FA6289.D9DE552C-ON802574BB.00303706-802574BB.00320601@hsbcib.com>


Guys,

I'm having troubles with Rmpi on Linux. I got it to work on windows, but on
Linux (SuSE 64 bit), using OpenMPI, I can't seem to get it to work :(

When I do library(Rmpi) I get the warning:

mca: base: component_find: unable to open osc pt2pt: file not found
(ignored)

Interestingly enough all the examples from the snow tutorial (
http://www.sfu.ca/~sblay/R/snow.html) work despite the warning.

But then, when I run my app I get

mca: base: component_find: unable to open osc pt2pt: file not found
(ignored)
mca: base: component_find: unable to open osc pt2pt: file not found
(ignored)
        2 slaves are spawned successfully. 0 failed.
*** Process received signal ***
Signal: Segmentation fault (11)
Signal code: Address not mapped (1)
Failing at address: 0x1c
*** Process received signal ***
Signal: Segmentation fault (11)
Signal code: Address not mapped (1)
Failing at address: 0x1c
[ 0] /lib64/tls/libc.so.6 [0x2a95c87500]
[ 1] [0x2a99b6df4c]
*** End of error message ***
[ 0] /lib64/tls/libc.so.6 [0x2a95c87500]
[ 1] [0x2a99b6e28c]
*** End of error message ***

Google has brought no useful info... The only discussion on the subject is
about an older version of Rmpi (I checked, the fix is in my version). For
reference that discussion is here
http://www.open-mpi.org/community/lists/users/2007/10/4185.php

I'm running on a multiple cpu box rather than a real cluster, that should
make things easier though... Perhaps some permission issue?

Cheers,

// Giuseppe

************************************************************
HSBC Bank plc may be solicited in the course of its placement efforts for a
new issue, by investment clients of the firm for whom the Bank as a firm
already provides other services. It may equally decide to allocate to its
own proprietary book or with an associate of HSBC Group. This represents a
potential conflict of interest. HSBC Bank plc has internal arrangements
designed to ensure that the firm would give unbiased and full advice to the
corporate finance client about the valuation and pricing of the offering as
well as internal systems, controls and procedures to identify and manage
conflicts of interest.

HSBC Bank plc
Registered Office: 8 Canada Square, London E14 5HQ, United Kingdom
Registered in England - Number 14259
Authorised and regulated by the Financial Services Authority.
************************************************************


-----------------------------------------
SAVE PAPER - THINK BEFORE YOU PRINT!

This transmission has been issued by a member of the HSBC Group
"HSBC" for the information of the addressee only and should not be
reproduced and/or distributed to any other person. Each page
attached hereto must be read in conjunction with any disclaimer
which forms part of it. Unless otherwise stated, this transmission
is neither an offer nor the solicitation of an offer to sell or
purchase any investment. Its contents are based on information
obtained from sources believed to be reliable but HSBC makes no
representation and accepts no responsibility or liability as to its
completeness or accuracy.


From edd at debian.org  Fri Sep  5 15:03:44 2008
From: edd at debian.org (Dirk Eddelbuettel)
Date: Fri, 5 Sep 2008 08:03:44 -0500
Subject: [Rd] Rmpi on Linux (SuSE) with OpenMPI
In-Reply-To: <OFF4FA6289.D9DE552C-ON802574BB.00303706-802574BB.00320601@hsbcib.com>
References: <OFF4FA6289.D9DE552C-ON802574BB.00303706-802574BB.00320601@hsbcib.com>
Message-ID: <18625.11824.271641.60693@ron.nulle.part>


(not a question for r-devel; you are simply having (local) troubles with a
package) 

On 5 September 2008 at 10:05, giuseppe1.milicia at hsbcib.com wrote:
| 
| Guys,
| 
| I'm having troubles with Rmpi on Linux. I got it to work on windows, but on
| Linux (SuSE 64 bit), using OpenMPI, I can't seem to get it to work :(
| 
| When I do library(Rmpi) I get the warning:
| 
| mca: base: component_find: unable to open osc pt2pt: file not found
| (ignored)

It's an Open MPI warning you can suppress in the Open MPI configuration.

| Interestingly enough all the examples from the snow tutorial (
| http://www.sfu.ca/~sblay/R/snow.html) work despite the warning.

Yes because it is just a warning about additional functionality you are not
using.

| But then, when I run my app I get
| 
| mca: base: component_find: unable to open osc pt2pt: file not found
| (ignored)
| mca: base: component_find: unable to open osc pt2pt: file not found
| (ignored)
|         2 slaves are spawned successfully. 0 failed.
| *** Process received signal ***
| Signal: Segmentation fault (11)
| Signal code: Address not mapped (1)
| Failing at address: 0x1c
| *** Process received signal ***
| Signal: Segmentation fault (11)
| Signal code: Address not mapped (1)
| Failing at address: 0x1c
| [ 0] /lib64/tls/libc.so.6 [0x2a95c87500]
| [ 1] [0x2a99b6df4c]
| *** End of error message ***
| [ 0] /lib64/tls/libc.so.6 [0x2a95c87500]
| [ 1] [0x2a99b6e28c]
| *** End of error message ***
| 
| Google has brought no useful info... The only discussion on the subject is
| about an older version of Rmpi (I checked, the fix is in my version). For
| reference that discussion is here
| http://www.open-mpi.org/community/lists/users/2007/10/4185.php
| 
| I'm running on a multiple cpu box rather than a real cluster, that should
| make things easier though... Perhaps some permission issue?

I don't think so. You are getting segfaults. That indicates a code bug or
maybe mismatch between libraries.

But as you didn't provide a reproducible example so we have no way of help
you.

Now, as you say 'multiple cpu box rather than a real cluster' why don't you
stick to using snow with sockets bypassing all your MPI issues ?

Hth,  Dirk

-- 
Three out of two people have difficulties with fractions.


From nuin at genedrift.org  Fri Sep  5 16:03:38 2008
From: nuin at genedrift.org (Paulo Nuin)
Date: Fri, 05 Sep 2008 10:03:38 -0400
Subject: [Rd] Problem installing Biobase on Solaris
Message-ID: <48C13C3A.1040503@genedrift.org>

Hi everyone

This is my first post to the list. I had experience installing and using 
Bioconductor on Linux and Windows systems but I am encountering problems 
installing Biobase on Solaris running on Sparc. The package compilation 
works fine, with only a warning

warning: implicit declaration of function `__builtin_isnan'

the help files are generated but in the end it fails with an error also 
related __builtin_isnan

** building package indices ...
Error in dyn.load(file, DLLpath = DLLpath, ...) :
 unable to load shared library 
'/usr/local/lib/R/library/Biobase/libs/Biobase.so':
 ld.so.1: R: fatal: relocation error: file 
/usr/local/lib/R/library/Biobase/libs/Biobase.so: symbol 
__builtin_isnan: referenced symbol not found
Calls: <Anonymous> ... tryCatch -> tryCatchList -> tryCatchOne -> 
<Anonymous>
Execution halted
ERROR: installing package indices failed

The machine I am using is a Sun SPARC Victoria Falls SunOS 5.10 
Generic_127111-11 sun4v sparc SUNW,T5140

I posted this message to the BioC list and it was suggested that I tried 
installing any R package that needed compilation. I installed the XML 
package with no problems. Any help is appreciated. Thanks in advance

Paulo


From ripley at stats.ox.ac.uk  Fri Sep  5 16:28:40 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 5 Sep 2008 15:28:40 +0100 (BST)
Subject: [Rd] Problem installing Biobase on Solaris
In-Reply-To: <48C13C3A.1040503@genedrift.org>
References: <48C13C3A.1040503@genedrift.org>
Message-ID: <alpine.LFD.1.10.0809051526520.20807@gannet.stats.ox.ac.uk>

What compiler is this?  This is a compiler issue, not an R one.

My guess is that you are mixing gcc (which has __builtin_isnan) and cc 
(which does not).

On Fri, 5 Sep 2008, Paulo Nuin wrote:

> Hi everyone
>
> This is my first post to the list. I had experience installing and using 
> Bioconductor on Linux and Windows systems but I am encountering problems 
> installing Biobase on Solaris running on Sparc. The package compilation works 
> fine, with only a warning
>
> warning: implicit declaration of function `__builtin_isnan'
>
> the help files are generated but in the end it fails with an error also 
> related __builtin_isnan
>
> ** building package indices ...
> Error in dyn.load(file, DLLpath = DLLpath, ...) :
> unable to load shared library 
> '/usr/local/lib/R/library/Biobase/libs/Biobase.so':
> ld.so.1: R: fatal: relocation error: file 
> /usr/local/lib/R/library/Biobase/libs/Biobase.so: symbol __builtin_isnan: 
> referenced symbol not found
> Calls: <Anonymous> ... tryCatch -> tryCatchList -> tryCatchOne -> <Anonymous>
> Execution halted
> ERROR: installing package indices failed
>
> The machine I am using is a Sun SPARC Victoria Falls SunOS 5.10 
> Generic_127111-11 sun4v sparc SUNW,T5140
>
> I posted this message to the BioC list and it was suggested that I tried 
> installing any R package that needed compilation. I installed the XML package 
> with no problems. Any help is appreciated. Thanks in advance
>
> Paulo
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From rbali at ufmg.br  Fri Sep  5 17:05:13 2008
From: rbali at ufmg.br (rbali at ufmg.br)
Date: Fri,  5 Sep 2008 17:05:13 +0200 (CEST)
Subject: [Rd] Passing method to returns() /fSeries (PR#12713)
Message-ID: <20080905150513.391A5282C763@mail.pubhealth.ku.dk>

Full_Name: Robert Iquiapaza
Version: 2.7.2
OS: Vista
Submission from: (NULL) (69.127.35.170)


In the help Examples for returns(fSeries) it is said that you can pass the
method to compute ("continuous", "discrete", "compound", "simple") returns using
'type=' 
i.e.
# Discrete Returns:
   returns(MSFT, type = "discrete")
However when you use 'type' it does compute always the continuous returns, no
matter what method you select.
The only way to get the discrete returns is using 'method=' instead
i.e
# Discrete Returns:
   returns(MSFT, method = "discrete")
I think the help and pdf documentation need to be updated

Robert


From jeff.a.ryan at gmail.com  Fri Sep  5 17:19:45 2008
From: jeff.a.ryan at gmail.com (Jeff Ryan)
Date: Fri, 5 Sep 2008 10:19:45 -0500
Subject: [Rd] Passing method to returns() /fSeries (PR#12713)
In-Reply-To: <20080905150513.391A5282C763@mail.pubhealth.ku.dk>
References: <20080905150513.391A5282C763@mail.pubhealth.ku.dk>
Message-ID: <e8e755250809050819h5b42ca27gd95ff73fb3f2bd82@mail.gmail.com>

This is a concern of the package maintainer.  Nothing to do with
R-devel or R-bugs.

See the Rmetrics site or fSeries package details for their contact information.

Jeff

On Fri, Sep 5, 2008 at 10:05 AM,  <rbali at ufmg.br> wrote:
> Full_Name: Robert Iquiapaza
> Version: 2.7.2
> OS: Vista
> Submission from: (NULL) (69.127.35.170)
>
>
> In the help Examples for returns(fSeries) it is said that you can pass the
> method to compute ("continuous", "discrete", "compound", "simple") returns using
> 'type='
> i.e.
> # Discrete Returns:
>   returns(MSFT, type = "discrete")
> However when you use 'type' it does compute always the continuous returns, no
> matter what method you select.
> The only way to get the discrete returns is using 'method=' instead
> i.e
> # Discrete Returns:
>   returns(MSFT, method = "discrete")
> I think the help and pdf documentation need to be updated
>
> Robert
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>



-- 
Jeffrey Ryan
jeffrey.ryan at insightalgo.com

ia: insight algorithmics
www.insightalgo.com


From nuin at genedrift.org  Fri Sep  5 17:49:37 2008
From: nuin at genedrift.org (Paulo Nuin)
Date: Fri, 05 Sep 2008 11:49:37 -0400
Subject: [Rd] Problem installing Biobase on Solaris
In-Reply-To: <alpine.LFD.1.10.0809051526520.20807@gannet.stats.ox.ac.uk>
References: <48C13C3A.1040503@genedrift.org>
	<alpine.LFD.1.10.0809051526520.20807@gannet.stats.ox.ac.uk>
Message-ID: <48C15511.30103@genedrift.org>

Hi

I thought of that. We have gcc 3.4.3 installed

 /gates/sfw10/builds/sfw10-gate/usr/src/cmd/gcc/gcc-3.4.3/configure 
--prefix=/usr/sfw --with-as=/usr/sfw/bin/gas --with-gnu-as 
--with-ld=/usr/ccs/bin/ld --without-gnu-ld --enable-languages=c,c++ 
--enable-shared

How to make sure which compiler R is using?

Thanks in advance

Paulo

Prof Brian Ripley wrote:
> What compiler is this?  This is a compiler issue, not an R one.
>
> My guess is that you are mixing gcc (which has __builtin_isnan) and cc 
> (which does not).
>
> On Fri, 5 Sep 2008, Paulo Nuin wrote:
>
>> Hi everyone
>>
>> This is my first post to the list. I had experience installing and 
>> using Bioconductor on Linux and Windows systems but I am encountering 
>> problems installing Biobase on Solaris running on Sparc. The package 
>> compilation works fine, with only a warning
>>
>> warning: implicit declaration of function `__builtin_isnan'
>>
>> the help files are generated but in the end it fails with an error 
>> also related __builtin_isnan
>>
>> ** building package indices ...
>> Error in dyn.load(file, DLLpath = DLLpath, ...) :
>> unable to load shared library 
>> '/usr/local/lib/R/library/Biobase/libs/Biobase.so':
>> ld.so.1: R: fatal: relocation error: file 
>> /usr/local/lib/R/library/Biobase/libs/Biobase.so: symbol 
>> __builtin_isnan: referenced symbol not found
>> Calls: <Anonymous> ... tryCatch -> tryCatchList -> tryCatchOne -> 
>> <Anonymous>
>> Execution halted
>> ERROR: installing package indices failed
>>
>> The machine I am using is a Sun SPARC Victoria Falls SunOS 5.10 
>> Generic_127111-11 sun4v sparc SUNW,T5140
>>
>> I posted this message to the BioC list and it was suggested that I 
>> tried installing any R package that needed compilation. I installed 
>> the XML package with no problems. Any help is appreciated. Thanks in 
>> advance
>>
>> Paulo
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>


From nuin at genedrift.org  Fri Sep  5 17:52:31 2008
From: nuin at genedrift.org (Paulo Nuin)
Date: Fri, 05 Sep 2008 11:52:31 -0400
Subject: [Rd] Problem installing Biobase on Solaris
In-Reply-To: <alpine.LFD.1.10.0809051526520.20807@gannet.stats.ox.ac.uk>
References: <48C13C3A.1040503@genedrift.org>
	<alpine.LFD.1.10.0809051526520.20807@gannet.stats.ox.ac.uk>
Message-ID: <48C155BF.9040705@genedrift.org>

Hi

I forgot to paste the compiler output:

gcc -std=gnu99 -I/usr/local/lib/R/include  -I/usr/local/include 
-I/usr/local/ssl/include -I/usr/local/pgsql/include 
-I/usr/local/include/ncurses -I/usr/local/BerkeleyDB.4.2/include 
-I/usr/openwin/include -I/usr/local/rrdtool-1.2.19/include    -fPIC  -O2 
-L/usr/local/pgsql/lib -R/usr/local/pgsql/lib -L/usr/local/lib 
-R/usr/local/lib -L/usr/local/ssl/lib -R/usr/local/ssl/lib 
-L/usr/openwin/lib -R/usr/openwin/lib 
-I/usr/local/rrdtool-1.2.19/include -c anyMissing.c -o anyMissing.o
anyMissing.c: In function `anyMissing':
anyMissing.c:33: warning: implicit declaration of function `__builtin_isnan'
gcc -std=gnu99 -I/usr/local/lib/R/include  -I/usr/local/include 
-I/usr/local/ssl/include -I/usr/local/pgsql/include 
-I/usr/local/include/ncurses -I/usr/local/BerkeleyDB.4.2/include 
-I/usr/openwin/include -I/usr/local/rrdtool-1.2.19/include    -fPIC  -O2 
-L/usr/local/pgsql/lib -R/usr/local/pgsql/lib -L/usr/local/lib 
-R/usr/local/lib -L/usr/local/ssl/lib -R/usr/local/ssl/lib 
-L/usr/openwin/lib -R/usr/openwin/lib 
-I/usr/local/rrdtool-1.2.19/include -c envir.c -o envir.o
gcc -std=gnu99 -I/usr/local/lib/R/include  -I/usr/local/include 
-I/usr/local/ssl/include -I/usr/local/pgsql/include 
-I/usr/local/include/ncurses -I/usr/local/BerkeleyDB.4.2/include 
-I/usr/openwin/include -I/usr/local/rrdtool-1.2.19/include    -fPIC  -O2 
-L/usr/local/pgsql/lib -R/usr/local/pgsql/lib -L/usr/local/lib 
-R/usr/local/lib -L/usr/local/ssl/lib -R/usr/local/ssl/lib 
-L/usr/openwin/lib -R/usr/openwin/lib 
-I/usr/local/rrdtool-1.2.19/include -c matchpt.c -o matchpt.o
gcc -std=gnu99 -I/usr/local/lib/R/include  -I/usr/local/include 
-I/usr/local/ssl/include -I/usr/local/pgsql/include 
-I/usr/local/include/ncurses -I/usr/local/BerkeleyDB.4.2/include 
-I/usr/openwin/include -I/usr/local/rrdtool-1.2.19/include    -fPIC  -O2 
-L/usr/local/pgsql/lib -R/usr/local/pgsql/lib -L/usr/local/lib 
-R/usr/local/lib -L/usr/local/ssl/lib -R/usr/local/ssl/lib 
-L/usr/openwin/lib -R/usr/openwin/lib 
-I/usr/local/rrdtool-1.2.19/include -c Rinit.c -o Rinit.o
gcc -std=gnu99 -I/usr/local/lib/R/include  -I/usr/local/include 
-I/usr/local/ssl/include -I/usr/local/pgsql/include 
-I/usr/local/include/ncurses -I/usr/local/BerkeleyDB.4.2/include 
-I/usr/openwin/include -I/usr/local/rrdtool-1.2.19/include    -fPIC  -O2 
-L/usr/local/pgsql/lib -R/usr/local/pgsql/lib -L/usr/local/lib 
-R/usr/local/lib -L/usr/local/ssl/lib -R/usr/local/ssl/lib 
-L/usr/openwin/lib -R/usr/openwin/lib 
-I/usr/local/rrdtool-1.2.19/include -c rowMedians.c -o rowMedians.o
gcc -std=gnu99 -I/usr/local/lib/R/include  -I/usr/local/include 
-I/usr/local/ssl/include -I/usr/local/pgsql/include 
-I/usr/local/include/ncurses -I/usr/local/BerkeleyDB.4.2/include 
-I/usr/openwin/include -I/usr/local/rrdtool-1.2.19/include    -fPIC  -O2 
-L/usr/local/pgsql/lib -R/usr/local/pgsql/lib -L/usr/local/lib 
-R/usr/local/lib -L/usr/local/ssl/lib -R/usr/local/ssl/lib 
-L/usr/openwin/lib -R/usr/openwin/lib 
-I/usr/local/rrdtool-1.2.19/include -c sublist_extract.c -o 
sublist_extract.o
gcc -std=gnu99 -G -L/usr/local/lib -R/usr/local/lib -R/usr/lib 
-L/usr/local/pgsql/lib -R/usr/local/pgsql/lib -L/usr/lib 
-R/usr/openwin/lib -L/usr/openwin/lib -L/usr/local/ssl/lib 
-R/usr/local/ssl/lib -L/usr/local/BerkeleyDB.4.2/lib 
-R/usr/local/BerkeleyDB.4.2/lib -L/usr/X11R6/lib -R/usr/X11R6/lib -o 
Biobase.so anyMissing.o envir.o matchpt.o Rinit.o rowMedians.o 
sublist_extract.o

Thanks

Paulo

Prof Brian Ripley wrote:
> What compiler is this?  This is a compiler issue, not an R one.
>
> My guess is that you are mixing gcc (which has __builtin_isnan) and cc 
> (which does not).
>
> On Fri, 5 Sep 2008, Paulo Nuin wrote:
>
>> Hi everyone
>>
>> This is my first post to the list. I had experience installing and 
>> using Bioconductor on Linux and Windows systems but I am encountering 
>> problems installing Biobase on Solaris running on Sparc. The package 
>> compilation works fine, with only a warning
>>
>> warning: implicit declaration of function `__builtin_isnan'
>>
>> the help files are generated but in the end it fails with an error 
>> also related __builtin_isnan
>>
>> ** building package indices ...
>> Error in dyn.load(file, DLLpath = DLLpath, ...) :
>> unable to load shared library 
>> '/usr/local/lib/R/library/Biobase/libs/Biobase.so':
>> ld.so.1: R: fatal: relocation error: file 
>> /usr/local/lib/R/library/Biobase/libs/Biobase.so: symbol 
>> __builtin_isnan: referenced symbol not found
>> Calls: <Anonymous> ... tryCatch -> tryCatchList -> tryCatchOne -> 
>> <Anonymous>
>> Execution halted
>> ERROR: installing package indices failed
>>
>> The machine I am using is a Sun SPARC Victoria Falls SunOS 5.10 
>> Generic_127111-11 sun4v sparc SUNW,T5140
>>
>> I posted this message to the BioC list and it was suggested that I 
>> tried installing any R package that needed compilation. I installed 
>> the XML package with no problems. Any help is appreciated. Thanks in 
>> advance
>>
>> Paulo
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>


From atp at piskorski.com  Sat Sep  6 00:38:27 2008
From: atp at piskorski.com (Andrew Piskorski)
Date: Fri, 5 Sep 2008 18:38:27 -0400
Subject: [Rd] typo in cov()?  var() fails on NA in R 2.7.2 but not R 2.6.1
Message-ID: <20080905223827.GA61846@piskorski.com>

I recently started using R 2.7.2, and noticed a surprising change in
the behavior of var() on NA data:

R 2.6.1 (Patched), 2007-11-26, svn.rev 43541, x86_64-unknown-linux-gnu:

  > stdev(rep(NA,3), na.rm=F)
  [1] NA
  > stdev(rep(NA,3), na.rm=T)
  [1] NA
  > var(rep(NA,3), na.rm=T, use="complete.obs")
  [1] NA

R 2.7.2 (Patched), 2008-09-02, svn.rev 46491, x86_64-unknown-linux-gnu:

  > stdev(rep(NA,3), na.rm=F)
  [1] NA

  > stdev(rep(NA,3), na.rm=T)
  Error in var(x, na.rm = na.rm) : no complete element pairs

  Enter a frame number, or 0 to exit
  1: stdev(rep(NA, 3), na.rm = T)
  2: var(x, na.rm = na.rm)
  Selection: 0

  > var(rep(NA,3), na.rm=T, use="complete.obs")
  Error in var(rep(NA, 3), na.rm = T, use = "complete.obs") :
    no complete element pairs

Is this change intentional?  Also, what is causing it?  Looking, I see
no changes in var() at all, so the new behavior must be due to a
change in what this call does:

  .Internal(cov(x, y, na.method, FALSE))

The R 2.7.2 cov() also has this weird line:

  else if (na.method != 3L) {
 
Note the "L" in the "3L".  A typo?  The older 2.6.1 cov() just has "3"
on that line, no "L".

Interactively redefining cov() to remove the "L" makes no difference in my var() calls, but that could b

The original source file seems to be:

  src/library/stats/R/cor.R 

svn annotate says that 3L line was last changed nearly a year ago, way
back in rev 43302:

  ------------------------------------------------------------------------
  r43302 | ripley | 2007-10-29 14:50:18 -0400 (Mon, 29 Oct 2007) | 2 lines
  make cor/cov a little less inconsistent

The strange 3L line occurs twice in that file, in both cor() and cov():

  $ grep -n 3L cor.R  
  36:    else if (na.method != 3L) { 
  118:    else if (na.method != 3L) { 

That line might not be the cause of my "no complete element pairs"
problem (I'm not at all sure), but it does look suspicious.

-- 
Andrew Piskorski <atp at piskorski.com>
http://www.piskorski.com/


From sgiannerini at gmail.com  Sat Sep  6 00:50:04 2008
From: sgiannerini at gmail.com (Simone Giannerini)
Date: Sat, 6 Sep 2008 00:50:04 +0200
Subject: [Rd]  typo in cov()? var() fails on NA in R 2.7.2 but not R 2.6.1
In-Reply-To: <3c12769c0809051548m2aa78da8i296e1a607576789@mail.gmail.com>
References: <20080905223827.GA61846@piskorski.com>
	<3c12769c0809051548m2aa78da8i296e1a607576789@mail.gmail.com>
Message-ID: <3c12769c0809051550j6b52f6a5y2329de79b25d66de@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20080906/a322c109/attachment.pl>

From jfox at mcmaster.ca  Sat Sep  6 03:03:38 2008
From: jfox at mcmaster.ca (John Fox)
Date: Fri, 5 Sep 2008 21:03:38 -0400
Subject: [Rd] Problem with UTF-8 text in the Rcmdr package
Message-ID: <000801c90fbc$658fc900$30af5b00$@ca>

Dear list members,

I've attached some email correspondence with Jaro Lajovic (with his permission), detailing a problem with the Slovenian translation file for the Rcmdr package. 

In brief, while certain UTF-8 characters used in Slovenian used to appear properly in older versions of R, some characters do not display properly in the Rcmdr menus and output window under R 2.7.x. I've confirmed the problem with the current version of the Rcmdr package (1.4-0) and R 2.7.2 under Windows Vista.

I've checked the R docs and NEWS file for changes to R, but wasn't able to turn up anything that seemed relevant. Frankly, however, my understanding of how various character sets are handled is only partial.

Any help would be appreciated.

John

------------------------------
John Fox, Professor
Department of Sociology
McMaster University
Hamilton, Ontario, Canada
web: socserv.mcmaster.ca/jfox


-----Original Message-----
From: Jaro.Lajovic [mailto:Jaro.Lajovic at mf.uni-lj.si] 
Sent: August-26-08 2:57 AM
To: John Fox
Subject: Re: Slovenian Rcmdr .po and .mo - and a problem

Dear John,

> That seems to imply that there's a change in R rather than in the Rcmdr
> that produced this problem. Do you notice the problem with any other
> packages that use translation or with R itself?

As for other translated R packages, I am afraid I am not aware of any. 
However, a quick test using cat with special characters:
cat "??????\n"
reveals that the string prints OK in the R (2.7.1.) console. The command 
line also shows OK in the Rcmdr Script window, but does not display 
right in the Output window. Special chars also fail in the Messages window.

Input (Script window) thus seems not to be affected, while the menu 
system and output do not work properly.

Thank you very much,
Jaro


> On Mon, 25 Aug 2008 21:54:43 +0200
>  "Jaro.Lajovic" <Jaro.Lajovic at mf.uni-lj.si> wrote:
>> Dear John,
>>
>>> One question though: I assume from your message that the previous
>>> version of the Rcmdr worked OK with R 2.7.1. Is that right?
>> No, the version 1.3-5 (that I still have with R 2.5.1) does not work
>> with R 2.7.1 either. So:
>>
>> Rcmdr 1.3-5 with R 2.5.1: works OK.
>> Rcmdr 1.3-5 with R 2.7.1: does not work properly.
>> Rcmdr 1.4-0 with R 2.7.1: does not work properly.
>>
>> Thank you in advance,
>> Jaro
>>
>>
>>
>>> On Mon, 25 Aug 2008 18:52:32 +0200
>>>  "Jaro.Lajovic" <Jaro.Lajovic at mf.uni-lj.si> wrote:
>>>> Dear John,
>>>>
>>>> Please find attached zipped Slovenian versions of .po (plain text
>> and
>>>> UTF-8 coded text) and .mo files.
>>>>
>>>> However, there seems to be a problem I have not been able to
>> resolve.
>>>> While special characters display properly under R version 2.5.1
>> with
>>>> Rcmdr 1.3-5, they fail to display (= are substituted by black
>> blocks)
>>>> under R version 2.7.1 with the new Rcmdr 1.4-0. By the way: the
>> .mo
>>>> file of the ver. 1.3-5 copied to 1.4-0 also failed to display
>>>> properly.
>>>>
>>>> (An additional detail: three special characters that are used in
>> the
>>>> Slo version are c, s and z with hacek. c with hacek is not
>> affected,
>>>> it is just s and z with hacek that are not displayed OK.)
>>>>
>>>> Your advice will be much appreciated.
>>>>
>>>> With best regards,
>>>> Jaro
> 
> --------------------------------
> John Fox, Professor
> Department of Sociology
> McMaster University
> Hamilton, Ontario, Canada
> http://socserv.mcmaster.ca/jfox/
> 


From nilsson.henric at gmail.com  Sat Sep  6 03:47:06 2008
From: nilsson.henric at gmail.com (Henric Nilsson (Public))
Date: Sat, 06 Sep 2008 03:47:06 +0200
Subject: [Rd] typo in cov()? var() fails on NA in R 2.7.2 but not R 2.6.1
In-Reply-To: <20080905223827.GA61846@piskorski.com>
References: <20080905223827.GA61846@piskorski.com>
Message-ID: <48C1E11A.2060409@gmail.com>

Andrew Piskorski wrote:

> I recently started using R 2.7.2, and noticed a surprising change in
> the behavior of var() on NA data:
> 
> R 2.6.1 (Patched), 2007-11-26, svn.rev 43541, x86_64-unknown-linux-gnu:
> 
>   > stdev(rep(NA,3), na.rm=F)
>   [1] NA
>   > stdev(rep(NA,3), na.rm=T)
>   [1] NA
>   > var(rep(NA,3), na.rm=T, use="complete.obs")
>   [1] NA
> 
> R 2.7.2 (Patched), 2008-09-02, svn.rev 46491, x86_64-unknown-linux-gnu:
> 
>   > stdev(rep(NA,3), na.rm=F)
>   [1] NA
> 
>   > stdev(rep(NA,3), na.rm=T)
>   Error in var(x, na.rm = na.rm) : no complete element pairs
> 
>   Enter a frame number, or 0 to exit
>   1: stdev(rep(NA, 3), na.rm = T)
>   2: var(x, na.rm = na.rm)
>   Selection: 0
> 
>   > var(rep(NA,3), na.rm=T, use="complete.obs")
>   Error in var(rep(NA, 3), na.rm = T, use = "complete.obs") :
>     no complete element pairs
> 
> Is this change intentional?  Also, what is causing it?  Looking, I see
> no changes in var() at all, so the new behavior must be due to a
> change in what this call does:
> 
>   .Internal(cov(x, y, na.method, FALSE))
> 
> The R 2.7.2 cov() also has this weird line:
> 
>   else if (na.method != 3L) {
>  
> Note the "L" in the "3L".  A typo?  The older 2.6.1 cov() just has "3"
> on that line, no "L".

Not a typo! See R-2.5.0's NEWS:

NEW FEATURES

     o	Introduced the suffix L for integer literals to create
	integer rather than numeric values, e.g. 100L, 0x10L, 1e2L.

So,

 > class(3)
[1] "numeric"
 > class(3L)
[1] "integer"


HTH,
Henric



> 
> Interactively redefining cov() to remove the "L" makes no difference in my var() calls, but that could b
> 
> The original source file seems to be:
> 
>   src/library/stats/R/cor.R 
> 
> svn annotate says that 3L line was last changed nearly a year ago, way
> back in rev 43302:
> 
>   ------------------------------------------------------------------------
>   r43302 | ripley | 2007-10-29 14:50:18 -0400 (Mon, 29 Oct 2007) | 2 lines
>   make cor/cov a little less inconsistent
> 
> The strange 3L line occurs twice in that file, in both cor() and cov():
> 
>   $ grep -n 3L cor.R  
>   36:    else if (na.method != 3L) { 
>   118:    else if (na.method != 3L) { 
> 
> That line might not be the cause of my "no complete element pairs"
> problem (I'm not at all sure), but it does look suspicious.
>


From ripley at stats.ox.ac.uk  Sat Sep  6 09:20:33 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sat, 6 Sep 2008 08:20:33 +0100 (BST)
Subject: [Rd] Problem installing Biobase on Solaris
In-Reply-To: <48C15511.30103@genedrift.org>
References: <48C13C3A.1040503@genedrift.org>
	<alpine.LFD.1.10.0809051526520.20807@gannet.stats.ox.ac.uk>
	<48C15511.30103@genedrift.org>
Message-ID: <alpine.LFD.1.10.0809060810360.18764@gannet.stats.ox.ac.uk>

Is this a pre-compiled R?  If so, please do compile from the sources on 
your own machine.  The compiler output you show is rather unusually 
complex and quite likely you are picking up some spurious headers or 
libraries.

gcc 3.4.3 is a very old compiler: sunfreeware (which is what you appear to 
be using) has 3.4.6.

I don't currently have R built on a Solaris 10 Sparc system (I do on 
amd64), but we have in the past and will again when we have a box back in 
production use.  We did find the Sun Studio compiler (which is a free 
download) worked much more smoothly than gcc and gave better performance.

On Fri, 5 Sep 2008, Paulo Nuin wrote:

> Hi
>
> I thought of that. We have gcc 3.4.3 installed
>
> /gates/sfw10/builds/sfw10-gate/usr/src/cmd/gcc/gcc-3.4.3/configure 
> --prefix=/usr/sfw --with-as=/usr/sfw/bin/gas --with-gnu-as 
> --with-ld=/usr/ccs/bin/ld --without-gnu-ld --enable-languages=c,c++ 
> --enable-shared
>
> How to make sure which compiler R is using?

Look in R_HOME/etc/Makeconf for CC.

> Thanks in advance
>
> Paulo
>
> Prof Brian Ripley wrote:
>> What compiler is this?  This is a compiler issue, not an R one.
>> 
>> My guess is that you are mixing gcc (which has __builtin_isnan) and cc 
>> (which does not).
>> 
>> On Fri, 5 Sep 2008, Paulo Nuin wrote:
>> 
>>> Hi everyone
>>> 
>>> This is my first post to the list. I had experience installing and using 
>>> Bioconductor on Linux and Windows systems but I am encountering problems 
>>> installing Biobase on Solaris running on Sparc. The package compilation 
>>> works fine, with only a warning
>>> 
>>> warning: implicit declaration of function `__builtin_isnan'
>>> 
>>> the help files are generated but in the end it fails with an error also 
>>> related __builtin_isnan
>>> 
>>> ** building package indices ...
>>> Error in dyn.load(file, DLLpath = DLLpath, ...) :
>>> unable to load shared library 
>>> '/usr/local/lib/R/library/Biobase/libs/Biobase.so':
>>> ld.so.1: R: fatal: relocation error: file 
>>> /usr/local/lib/R/library/Biobase/libs/Biobase.so: symbol __builtin_isnan: 
>>> referenced symbol not found
>>> Calls: <Anonymous> ... tryCatch -> tryCatchList -> tryCatchOne -> 
>>> <Anonymous>
>>> Execution halted
>>> ERROR: installing package indices failed
>>> 
>>> The machine I am using is a Sun SPARC Victoria Falls SunOS 5.10 
>>> Generic_127111-11 sun4v sparc SUNW,T5140
>>> 
>>> I posted this message to the BioC list and it was suggested that I tried 
>>> installing any R package that needed compilation. I installed the XML 
>>> package with no problems. Any help is appreciated. Thanks in advance
>>> 
>>> Paulo
>>> 
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>> 
>> 
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From nuin at genedrift.org  Sat Sep  6 16:49:06 2008
From: nuin at genedrift.org (Paulo Nuin)
Date: Sat, 06 Sep 2008 10:49:06 -0400
Subject: [Rd] Problem installing Biobase on Solaris
In-Reply-To: <alpine.LFD.1.10.0809060810360.18764@gannet.stats.ox.ac.uk>
References: <48C13C3A.1040503@genedrift.org>
	<alpine.LFD.1.10.0809051526520.20807@gannet.stats.ox.ac.uk>
	<48C15511.30103@genedrift.org>
	<alpine.LFD.1.10.0809060810360.18764@gannet.stats.ox.ac.uk>
Message-ID: <48C29862.6050502@genedrift.org>

Hi

Thanks a lot for your suggestions. I had problems compiling R with gcc 
on Solaris, that's why I decided to install the pre-compiled version.  I 
am in the process of compiling now using the Sun Studio compiler and it 
is, so far,  working wonderfully. I will continue installing it and if I 
have any other errors I will reply to the list.

Sorry if my questions sounded naive, but I don't have a lot of 
experience with Solaris, I am more a Linux person.

Thanks again

Paulo

Prof Brian Ripley wrote:
> Is this a pre-compiled R?  If so, please do compile from the sources 
> on your own machine.  The compiler output you show is rather unusually 
> complex and quite likely you are picking up some spurious headers or 
> libraries.
>
> gcc 3.4.3 is a very old compiler: sunfreeware (which is what you 
> appear to be using) has 3.4.6.
>
> I don't currently have R built on a Solaris 10 Sparc system (I do on 
> amd64), but we have in the past and will again when we have a box back 
> in production use.  We did find the Sun Studio compiler (which is a 
> free download) worked much more smoothly than gcc and gave better 
> performance.
>
> On Fri, 5 Sep 2008, Paulo Nuin wrote:
>
>> Hi
>>
>> I thought of that. We have gcc 3.4.3 installed
>>
>> /gates/sfw10/builds/sfw10-gate/usr/src/cmd/gcc/gcc-3.4.3/configure 
>> --prefix=/usr/sfw --with-as=/usr/sfw/bin/gas --with-gnu-as 
>> --with-ld=/usr/ccs/bin/ld --without-gnu-ld --enable-languages=c,c++ 
>> --enable-shared
>>
>> How to make sure which compiler R is using?
>
> Look in R_HOME/etc/Makeconf for CC.
>
>> Thanks in advance
>>
>> Paulo
>>
>> Prof Brian Ripley wrote:
>>> What compiler is this?  This is a compiler issue, not an R one.
>>>
>>> My guess is that you are mixing gcc (which has __builtin_isnan) and 
>>> cc (which does not).
>>>
>>> On Fri, 5 Sep 2008, Paulo Nuin wrote:
>>>
>>>> Hi everyone
>>>>
>>>> This is my first post to the list. I had experience installing and 
>>>> using Bioconductor on Linux and Windows systems but I am 
>>>> encountering problems installing Biobase on Solaris running on 
>>>> Sparc. The package compilation works fine, with only a warning
>>>>
>>>> warning: implicit declaration of function `__builtin_isnan'
>>>>
>>>> the help files are generated but in the end it fails with an error 
>>>> also related __builtin_isnan
>>>>
>>>> ** building package indices ...
>>>> Error in dyn.load(file, DLLpath = DLLpath, ...) :
>>>> unable to load shared library 
>>>> '/usr/local/lib/R/library/Biobase/libs/Biobase.so':
>>>> ld.so.1: R: fatal: relocation error: file 
>>>> /usr/local/lib/R/library/Biobase/libs/Biobase.so: symbol 
>>>> __builtin_isnan: referenced symbol not found
>>>> Calls: <Anonymous> ... tryCatch -> tryCatchList -> tryCatchOne -> 
>>>> <Anonymous>
>>>> Execution halted
>>>> ERROR: installing package indices failed
>>>>
>>>> The machine I am using is a Sun SPARC Victoria Falls SunOS 5.10 
>>>> Generic_127111-11 sun4v sparc SUNW,T5140
>>>>
>>>> I posted this message to the BioC list and it was suggested that I 
>>>> tried installing any R package that needed compilation. I installed 
>>>> the XML package with no problems. Any help is appreciated. Thanks 
>>>> in advance
>>>>
>>>> Paulo
>>>>
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>
>>>
>>
>>
>


From ripley at stats.ox.ac.uk  Sun Sep  7 13:22:55 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sun, 7 Sep 2008 12:22:55 +0100 (BST)
Subject: [Rd] Problem with UTF-8 text in the Rcmdr package
In-Reply-To: <000801c90fbc$658fc900$30af5b00$@ca>
References: <000801c90fbc$658fc900$30af5b00$@ca>
Message-ID: <alpine.LFD.1.10.0809071152260.911@gannet.stats.ox.ac.uk>

The issue appears to be the Rcmdr output window and menus.  They are done 
using Tcl/Tk, not by R.  So this might be a problem in Tcl/Tk or the fonts 
it uses, or it might be problem with what Rcmdr passes to the tcltk 
package.

We need the means to reproduce this (as per the posting guide):

- what OSes are affected?  Does this occur in a UTF-8 locale on Linux, for 
example?

- in what locales?

- what versions of Tcl/Tk?  Note that shipped with Windows R 
changed between 2.5.1 and 2.7.x.

- Is this anything to do with translations?  I've not looked at how 
translations are done in Rcmdr, but if gettext() is used, the string 
passed to R for output is in the native encoding, so 'UTF-8 characters' is 
incorrect.  It is possible that it is an iconv problem if the translations 
are supplied in UTF-8 and not Latin-2.

There are far too many layers involved here to guess at what is going on.
My guess is that it ought to be possible to give a simple example of a 
string which can be output to the Rcmdr console and will be rendered 
incorrectly (together with a screen shot of how it is rendered).

I think the characters referred to are the Unicode glyphs 's and z with 
caron', \u0161 and \u017E.  It seems that these will only be displayable 
in Rcmdr on Windows in a Latin-2 locale, which I do not have set up on 
Windows (but believe I could get installed).  However, examples using that 
(and the menus) seem to be correct in both sl_SI.iso88592 and sl_SI.utf8 
on Linux, which suggests that this is probably not an R issue but a Tcl/Tk 
one.

On Fri, 5 Sep 2008, John Fox wrote:

> Dear list members,
>
> I've attached some email correspondence with Jaro Lajovic (with his 
> permission), detailing a problem with the Slovenian translation file for 
> the Rcmdr package.

Unfortunately, it is not 'detailed', and we do need the details.

> In brief, while certain UTF-8 characters used in Slovenian used to 
> appear properly in older versions of R, some characters do not display 
> properly in the Rcmdr menus and output window under R 2.7.x. I've 
> confirmed the problem with the current version of the Rcmdr package 
> (1.4-0) and R 2.7.2 under Windows Vista.
>
> I've checked the R docs and NEWS file for changes to R, but wasn't able 
> to turn up anything that seemed relevant. Frankly, however, my 
> understanding of how various character sets are handled is only partial.
>
> Any help would be appreciated.
>
> John
>
> ------------------------------
> John Fox, Professor
> Department of Sociology
> McMaster University
> Hamilton, Ontario, Canada
> web: socserv.mcmaster.ca/jfox
>
>
> -----Original Message-----
> From: Jaro.Lajovic [mailto:Jaro.Lajovic at mf.uni-lj.si]
> Sent: August-26-08 2:57 AM
> To: John Fox
> Subject: Re: Slovenian Rcmdr .po and .mo - and a problem
>
> Dear John,
>
>> That seems to imply that there's a change in R rather than in the Rcmdr
>> that produced this problem. Do you notice the problem with any other
>> packages that use translation or with R itself?
>
> As for other translated R packages, I am afraid I am not aware of any.
> However, a quick test using cat with special characters:
> cat "??????\n"
> reveals that the string prints OK in the R (2.7.1.) console. The command
> line also shows OK in the Rcmdr Script window, but does not display
> right in the Output window. Special chars also fail in the Messages window.
>
> Input (Script window) thus seems not to be affected, while the menu
> system and output do not work properly.
>
> Thank you very much,
> Jaro
>
>
>> On Mon, 25 Aug 2008 21:54:43 +0200
>>  "Jaro.Lajovic" <Jaro.Lajovic at mf.uni-lj.si> wrote:
>>> Dear John,
>>>
>>>> One question though: I assume from your message that the previous
>>>> version of the Rcmdr worked OK with R 2.7.1. Is that right?
>>> No, the version 1.3-5 (that I still have with R 2.5.1) does not work
>>> with R 2.7.1 either. So:
>>>
>>> Rcmdr 1.3-5 with R 2.5.1: works OK.
>>> Rcmdr 1.3-5 with R 2.7.1: does not work properly.
>>> Rcmdr 1.4-0 with R 2.7.1: does not work properly.
>>>
>>> Thank you in advance,
>>> Jaro
>>>
>>>
>>>
>>>> On Mon, 25 Aug 2008 18:52:32 +0200
>>>>  "Jaro.Lajovic" <Jaro.Lajovic at mf.uni-lj.si> wrote:
>>>>> Dear John,
>>>>>
>>>>> Please find attached zipped Slovenian versions of .po (plain text
>>> and
>>>>> UTF-8 coded text) and .mo files.
>>>>>
>>>>> However, there seems to be a problem I have not been able to
>>> resolve.
>>>>> While special characters display properly under R version 2.5.1
>>> with
>>>>> Rcmdr 1.3-5, they fail to display (= are substituted by black
>>> blocks)
>>>>> under R version 2.7.1 with the new Rcmdr 1.4-0. By the way: the
>>> .mo
>>>>> file of the ver. 1.3-5 copied to 1.4-0 also failed to display
>>>>> properly.
>>>>>
>>>>> (An additional detail: three special characters that are used in
>>> the
>>>>> Slo version are c, s and z with hacek. c with hacek is not
>>> affected,
>>>>> it is just s and z with hacek that are not displayed OK.)
>>>>>
>>>>> Your advice will be much appreciated.
>>>>>
>>>>> With best regards,
>>>>> Jaro
>>
>> --------------------------------
>> John Fox, Professor
>> Department of Sociology
>> McMaster University
>> Hamilton, Ontario, Canada
>> http://socserv.mcmaster.ca/jfox/
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From jmc at r-project.org  Sun Sep  7 17:10:50 2008
From: jmc at r-project.org (John Chambers)
Date: Sun, 07 Sep 2008 11:10:50 -0400
Subject: [Rd] New relations between S3,
 S4 classes (was:  Re:  '"ts" treated as a registered S3 class ...)
In-Reply-To: <489B1EC8.9070700@r-project.org>
References: <20080807153709.7d713064@mimi> <489B1EC8.9070700@r-project.org>
Message-ID: <48C3EEFA.5090707@r-project.org>

This specific bug led to a much more general enhancement (which is what 
one hopes will happen occasionally from bug reports).  Changes to 
version 2.8.0 (r-devel) were committed today that fix the bug reported 
below, via the general changes.

General problem:  For "ts" and some other S3 classes, one would like to 
assert some S4 behavior (slot classes and/or inheritance) along with the 
S3 inheritance via setOldClass().

The solution is to allow an S4 class definition to be supplied to 
setOldClass(), along with the Classes argument to give the inheritance.  
See ?setOldClass and the new material in the NEWS file.

Classes "ts", "mts", and "data.frame" have revised S4 definitions using 
this feature.  (Any other candidates?  The requirement is that one 
_really_ can assert that the S3 class has known attributes of known 
class and/or that all the code behaves correctly as if the class 
inherited from a virtual class, such as "structure".  Not that often 
that such assertions reliably apply to S3 classes.)

A slightly related enhancement to setOldClass has been introduced at the 
same time.  The created S4 class now has the S3 inheritance coded 
complete in the prototype of the S4 class.  This means that mutiple S3 
classes sharing the same inheritance can be declared to setOldClass() by 
just giving the first class they inherit from--the rest of the 
inheritance will be filled in automatically.  (Only relevant if you have 
S3 classes with a fairly deep inheritance structrue.)

A new technique using the information is to "fill in" the S3 inheritance 
by a special mechanism:
  as(x, "S3")
where x is an S3 object with perhaps just a single S3 class in its class 
attribute.  The object returned will have filled in the inheritance, S3 
style, if the classes involved have been registered by setOldClass().  
See ?S3




John Chambers wrote:
> Yohan Chalabi wrote:
>> Dear all,
>>
>> In R-devel I have noticed the new approach for the "ts" class in the
>> package "methods".
>>
>> the "structure" behaviour of "ts" is not always kept when one uses
>> "ts" objects and objects of classes which extend the virtual class
>> "structure".
>>
>> As a short example:
>>
>> ## this works fine
>> setClass("foo", representation(header = "character"), contains = 
>> "structure")
>> foo <- new("foo", 1:10, header = "foo")
>> ts <- ts(1:10)
>> foo / ts
>>
>> ## but the problem appears when one defines an "Ops" method for class 
>> "foo"
>> setMethod("Ops", c("foo", "foo"),
>>            function(e1, e2) {
>>                .Data <- callGeneric(e1 at .Data, e2 at .Data)
>>                header <- paste(e1 at header, e2 at header, sep = "_")
>>                new("foo", .Data, header = header)
>>            })
>> foo <- new("foo", 1:10, header = "foo")
>> foo + foo
>> ts <- ts(1:10)
>> foo / ts
>> # Error in getDataPart(1:10) : no '.Data' slot defined for class "ts"
>>
>> Is this the expected behavior?
>>   
> No, not expected.  It may take some special treatement to fix it, though.
>
> Your subject heading is indeed the problem.  Normally, the structure 
> of an S3 class is a black box, and no S4 slots should usually be 
> associated with it when it's registered via setOldClass.
>
> However, just because "ts" does want to be a "structure" class, it 
> would be nice to give it a .Data slot.  I'll experiment with this and 
> see if it causes other things to break immediately.
>
> Thanks for the report.
>
> John Chambers
>> regards,
>> Yohan
>>
>> -- 
>> PhD student
>> Swiss Federal Institute of Technology
>> Zurich
>>
>> www.ethz.ch
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From jfox at mcmaster.ca  Sun Sep  7 17:15:26 2008
From: jfox at mcmaster.ca (John Fox)
Date: Sun, 7 Sep 2008 11:15:26 -0400
Subject: [Rd] Problem with UTF-8 text in the Rcmdr package
In-Reply-To: <alpine.LFD.1.10.0809071152260.911@gannet.stats.ox.ac.uk>
References: <000801c90fbc$658fc900$30af5b00$@ca>
	<alpine.LFD.1.10.0809071152260.911@gannet.stats.ox.ac.uk>
Message-ID: <001201c910fc$9016b4e0$b0441ea0$@ca>

Dear Brian,

Thank you for addressing the problem -- I was hoping that you would.

> -----Original Message-----
> From: Prof Brian Ripley [mailto:ripley at stats.ox.ac.uk]
> Sent: September-07-08 7:23 AM
> To: John Fox
> Cc: 'R-devel'; 'Jaro.Lajovic'
> Subject: Re: [Rd] Problem with UTF-8 text in the Rcmdr package
> 
> The issue appears to be the Rcmdr output window and menus.  They are done
> using Tcl/Tk, not by R.  So this might be a problem in Tcl/Tk or the fonts
> it uses, or it might be problem with what Rcmdr passes to the tcltk
> package.
> 
> We need the means to reproduce this (as per the posting guide):

Jaro provides an example in one of his messages in my posting (though it is
slightly in error): If one enters 

cat("??????\n") 

in the Rcmdr Script window, the characters are rendered correctly. Executing
this command (via the Submit button) produces the following in the Output
window:

> cat("??????\n") 
??????

which actually appears as

> cat("??\n") 
??

This is under Windows Vista / R 2.7.2 / Rcmdr 1.4-0.

> 
> - what OSes are affected?  Does this occur in a UTF-8 locale on Linux, for
> example?

I've now checked under Mac OS X and Linux Ubuntu, with the following
results:

Under Mac OS X 10.5.4 / R 2.7.2 / Rcmdr 1.4-0 / Tcl/Tk 8.4 

cat("??????\n") appears as cat("?????\n") in *both* the Script window and
the Output window.

Under Ubuntu Linux 8.04 / R 2.7.0 / Rcmdr 1.4-0/ Tcl/Tk 8.5

cat("??????\n") appears *correctly* in *both* the Script window and the
Output window.

> 
> - in what locales?

I'm afraid that I don't know how to check this short of changing the locale
for my Windows machine. I do observe the problem in Windows when I start
Rgui with language=sl.

> 
> - what versions of Tcl/Tk?  Note that shipped with Windows R
> changed between 2.5.1 and 2.7.x.

Yes, and please see above, but if the problem were with Tcl/Tk, why does
this work in the Script window under Windows and in both Script and Output
under Ubuntu?

> 
> - Is this anything to do with translations?  I've not looked at how
> translations are done in Rcmdr, but if gettext() is used, the string
> passed to R for output is in the native encoding, so 'UTF-8 characters' is
> incorrect.  It is possible that it is an iconv problem if the translations
> are supplied in UTF-8 and not Latin-2.

Yes, the Rcmdr package uses gettext(). Could Jaro avoid the problem by using
Latin-2 in preference to UTF-8?

> 
> There are far too many layers involved here to guess at what is going on.
> My guess is that it ought to be possible to give a simple example of a
> string which can be output to the Rcmdr console and will be rendered
> incorrectly (together with a screen shot of how it is rendered).

Indeed, please see above. I've also attached a screenshot under Windows,
having started R with language=sl.

> 
> I think the characters referred to are the Unicode glyphs 's and z with
> caron', \u0161 and \u017E.  It seems that these will only be displayable
> in Rcmdr on Windows in a Latin-2 locale, which I do not have set up on
> Windows (but believe I could get installed).  However, examples using that
> (and the menus) seem to be correct in both sl_SI.iso88592 and sl_SI.utf8
> on Linux, which suggests that this is probably not an R issue but a Tcl/Tk
> one.

I'm above my depth with respect to these issues, but I do find it curious
that under Windows the characters appears correctly in the Script window but
not the Output window.

> 
> On Fri, 5 Sep 2008, John Fox wrote:
> 
> > Dear list members,
> >
> > I've attached some email correspondence with Jaro Lajovic (with his
> > permission), detailing a problem with the Slovenian translation file for
> > the Rcmdr package.
> 
> Unfortunately, it is not 'detailed', and we do need the details.

I hope that the additional information in this message will supply at least
some of the necessary details.

Thank you for your help,
 John

> 
> > In brief, while certain UTF-8 characters used in Slovenian used to
> > appear properly in older versions of R, some characters do not display
> > properly in the Rcmdr menus and output window under R 2.7.x. I've
> > confirmed the problem with the current version of the Rcmdr package
> > (1.4-0) and R 2.7.2 under Windows Vista.
> >
> > I've checked the R docs and NEWS file for changes to R, but wasn't able
> > to turn up anything that seemed relevant. Frankly, however, my
> > understanding of how various character sets are handled is only partial.
> >
> > Any help would be appreciated.
> >
> > John
> >
> > ------------------------------
> > John Fox, Professor
> > Department of Sociology
> > McMaster University
> > Hamilton, Ontario, Canada
> > web: socserv.mcmaster.ca/jfox
> >
> >
> > -----Original Message-----
> > From: Jaro.Lajovic [mailto:Jaro.Lajovic at mf.uni-lj.si]
> > Sent: August-26-08 2:57 AM
> > To: John Fox
> > Subject: Re: Slovenian Rcmdr .po and .mo - and a problem
> >
> > Dear John,
> >
> >> That seems to imply that there's a change in R rather than in the Rcmdr
> >> that produced this problem. Do you notice the problem with any other
> >> packages that use translation or with R itself?
> >
> > As for other translated R packages, I am afraid I am not aware of any.
> > However, a quick test using cat with special characters:
> > cat "??????\n"
> > reveals that the string prints OK in the R (2.7.1.) console. The command
> > line also shows OK in the Rcmdr Script window, but does not display
> > right in the Output window. Special chars also fail in the Messages
window.
> >
> > Input (Script window) thus seems not to be affected, while the menu
> > system and output do not work properly.
> >
> > Thank you very much,
> > Jaro
> >
> >
> >> On Mon, 25 Aug 2008 21:54:43 +0200
> >>  "Jaro.Lajovic" <Jaro.Lajovic at mf.uni-lj.si> wrote:
> >>> Dear John,
> >>>
> >>>> One question though: I assume from your message that the previous
> >>>> version of the Rcmdr worked OK with R 2.7.1. Is that right?
> >>> No, the version 1.3-5 (that I still have with R 2.5.1) does not work
> >>> with R 2.7.1 either. So:
> >>>
> >>> Rcmdr 1.3-5 with R 2.5.1: works OK.
> >>> Rcmdr 1.3-5 with R 2.7.1: does not work properly.
> >>> Rcmdr 1.4-0 with R 2.7.1: does not work properly.
> >>>
> >>> Thank you in advance,
> >>> Jaro
> >>>
> >>>
> >>>
> >>>> On Mon, 25 Aug 2008 18:52:32 +0200
> >>>>  "Jaro.Lajovic" <Jaro.Lajovic at mf.uni-lj.si> wrote:
> >>>>> Dear John,
> >>>>>
> >>>>> Please find attached zipped Slovenian versions of .po (plain text
> >>> and
> >>>>> UTF-8 coded text) and .mo files.
> >>>>>
> >>>>> However, there seems to be a problem I have not been able to
> >>> resolve.
> >>>>> While special characters display properly under R version 2.5.1
> >>> with
> >>>>> Rcmdr 1.3-5, they fail to display (= are substituted by black
> >>> blocks)
> >>>>> under R version 2.7.1 with the new Rcmdr 1.4-0. By the way: the
> >>> .mo
> >>>>> file of the ver. 1.3-5 copied to 1.4-0 also failed to display
> >>>>> properly.
> >>>>>
> >>>>> (An additional detail: three special characters that are used in
> >>> the
> >>>>> Slo version are c, s and z with hacek. c with hacek is not
> >>> affected,
> >>>>> it is just s and z with hacek that are not displayed OK.)
> >>>>>
> >>>>> Your advice will be much appreciated.
> >>>>>
> >>>>> With best regards,
> >>>>> Jaro
> >>
> >> --------------------------------
> >> John Fox, Professor
> >> Department of Sociology
> >> McMaster University
> >> Hamilton, Ontario, Canada
> >> http://socserv.mcmaster.ca/jfox/
> >>
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >
> 
> --
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
-------------- next part --------------
A non-text attachment was scrubbed...
Name: screenshot.pdf
Type: application/pdf
Size: 58260 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20080907/0f9d413e/attachment.pdf>

From Jaro.Lajovic at mf.uni-lj.si  Mon Sep  8 09:21:45 2008
From: Jaro.Lajovic at mf.uni-lj.si (Jaro.Lajovic)
Date: Mon, 08 Sep 2008 09:21:45 +0200
Subject: [Rd] Problem with UTF-8 text in the Rcmdr package
In-Reply-To: <001201c910fc$9016b4e0$b0441ea0$@ca>
References: <000801c90fbc$658fc900$30af5b00$@ca>
	<alpine.LFD.1.10.0809071152260.911@gannet.stats.ox.ac.uk>
	<001201c910fc$9016b4e0$b0441ea0$@ca>
Message-ID: <48C4D289.4050605@mf.uni-lj.si>

Dear John,

 >> - Is this anything to do with translations?  I've not looked at how
 >> translations are done in Rcmdr, but if gettext() is used, the string
 >> passed to R for output is in the native encoding, so 'UTF-8
 >> characters' is incorrect.  It is possible that it is an iconv problem
 >> if the translations are supplied in UTF-8 and not Latin-2.
 >
 > Yes, the Rcmdr package uses gettext(). Could Jaro avoid the problem by
 > using Latin-2 in preference to UTF-8?

As mentioned, I am testing this under Windows XP (R 2.7.1).

Preparing the .mo file with the Latin-2 encoding (or Win-1250, for that 
matter) does not make any difference.

However, with the help of my son I have made a test, documented in the 
attached screenshot. It seems that the output routines expect Latin-2, 
but (as for the translation) get the native encoding.

Best regards,
Jaro



John Fox pravi:
> Dear Brian,
> 
> Thank you for addressing the problem -- I was hoping that you would.
> 
>> -----Original Message-----
>> From: Prof Brian Ripley [mailto:ripley at stats.ox.ac.uk]
>> Sent: September-07-08 7:23 AM
>> To: John Fox
>> Cc: 'R-devel'; 'Jaro.Lajovic'
>> Subject: Re: [Rd] Problem with UTF-8 text in the Rcmdr package
>>
>> The issue appears to be the Rcmdr output window and menus.  They are done
>> using Tcl/Tk, not by R.  So this might be a problem in Tcl/Tk or the fonts
>> it uses, or it might be problem with what Rcmdr passes to the tcltk
>> package.
>>
>> We need the means to reproduce this (as per the posting guide):
> 
> Jaro provides an example in one of his messages in my posting (though it is
> slightly in error): If one enters 
> 
> cat("??????\n") 
> 
> in the Rcmdr Script window, the characters are rendered correctly. Executing
> this command (via the Submit button) produces the following in the Output
> window:
> 
>> cat("??????\n") 
> ??????
> 
> which actually appears as
> 
>> cat("??\n") 
> ??
> 
> This is under Windows Vista / R 2.7.2 / Rcmdr 1.4-0.
> 
>> - what OSes are affected?  Does this occur in a UTF-8 locale on Linux, for
>> example?
> 
> I've now checked under Mac OS X and Linux Ubuntu, with the following
> results:
> 
> Under Mac OS X 10.5.4 / R 2.7.2 / Rcmdr 1.4-0 / Tcl/Tk 8.4 
> 
> cat("??????\n") appears as cat("?????\n") in *both* the Script window and
> the Output window.
> 
> Under Ubuntu Linux 8.04 / R 2.7.0 / Rcmdr 1.4-0/ Tcl/Tk 8.5
> 
> cat("??????\n") appears *correctly* in *both* the Script window and the
> Output window.
> 
>> - in what locales?
> 
> I'm afraid that I don't know how to check this short of changing the locale
> for my Windows machine. I do observe the problem in Windows when I start
> Rgui with language=sl.
> 
>> - what versions of Tcl/Tk?  Note that shipped with Windows R
>> changed between 2.5.1 and 2.7.x.
> 
> Yes, and please see above, but if the problem were with Tcl/Tk, why does
> this work in the Script window under Windows and in both Script and Output
> under Ubuntu?
> 
>> - Is this anything to do with translations?  I've not looked at how
>> translations are done in Rcmdr, but if gettext() is used, the string
>> passed to R for output is in the native encoding, so 'UTF-8 characters' is
>> incorrect.  It is possible that it is an iconv problem if the translations
>> are supplied in UTF-8 and not Latin-2.
> 
> Yes, the Rcmdr package uses gettext(). Could Jaro avoid the problem by using
> Latin-2 in preference to UTF-8?
> 
>> There are far too many layers involved here to guess at what is going on.
>> My guess is that it ought to be possible to give a simple example of a
>> string which can be output to the Rcmdr console and will be rendered
>> incorrectly (together with a screen shot of how it is rendered).
> 
> Indeed, please see above. I've also attached a screenshot under Windows,
> having started R with language=sl.
> 
>> I think the characters referred to are the Unicode glyphs 's and z with
>> caron', \u0161 and \u017E.  It seems that these will only be displayable
>> in Rcmdr on Windows in a Latin-2 locale, which I do not have set up on
>> Windows (but believe I could get installed).  However, examples using that
>> (and the menus) seem to be correct in both sl_SI.iso88592 and sl_SI.utf8
>> on Linux, which suggests that this is probably not an R issue but a Tcl/Tk
>> one.
> 
> I'm above my depth with respect to these issues, but I do find it curious
> that under Windows the characters appears correctly in the Script window but
> not the Output window.
> 
>> On Fri, 5 Sep 2008, John Fox wrote:
>>
>>> Dear list members,
>>>
>>> I've attached some email correspondence with Jaro Lajovic (with his
>>> permission), detailing a problem with the Slovenian translation file for
>>> the Rcmdr package.
>> Unfortunately, it is not 'detailed', and we do need the details.
> 
> I hope that the additional information in this message will supply at least
> some of the necessary details.
> 
> Thank you for your help,
>  John
> 
>>> In brief, while certain UTF-8 characters used in Slovenian used to
>>> appear properly in older versions of R, some characters do not display
>>> properly in the Rcmdr menus and output window under R 2.7.x. I've
>>> confirmed the problem with the current version of the Rcmdr package
>>> (1.4-0) and R 2.7.2 under Windows Vista.
>>>
>>> I've checked the R docs and NEWS file for changes to R, but wasn't able
>>> to turn up anything that seemed relevant. Frankly, however, my
>>> understanding of how various character sets are handled is only partial.
>>>
>>> Any help would be appreciated.
>>>
>>> John
>>>
>>> ------------------------------
>>> John Fox, Professor
>>> Department of Sociology
>>> McMaster University
>>> Hamilton, Ontario, Canada
>>> web: socserv.mcmaster.ca/jfox
>>>
>>>
>>> -----Original Message-----
>>> From: Jaro.Lajovic [mailto:Jaro.Lajovic at mf.uni-lj.si]
>>> Sent: August-26-08 2:57 AM
>>> To: John Fox
>>> Subject: Re: Slovenian Rcmdr .po and .mo - and a problem
>>>
>>> Dear John,
>>>
>>>> That seems to imply that there's a change in R rather than in the Rcmdr
>>>> that produced this problem. Do you notice the problem with any other
>>>> packages that use translation or with R itself?
>>> As for other translated R packages, I am afraid I am not aware of any.
>>> However, a quick test using cat with special characters:
>>> cat "??????\n"
>>> reveals that the string prints OK in the R (2.7.1.) console. The command
>>> line also shows OK in the Rcmdr Script window, but does not display
>>> right in the Output window. Special chars also fail in the Messages
> window.
>>> Input (Script window) thus seems not to be affected, while the menu
>>> system and output do not work properly.
>>>
>>> Thank you very much,
>>> Jaro
>>>
>>>
>>>> On Mon, 25 Aug 2008 21:54:43 +0200
>>>>  "Jaro.Lajovic" <Jaro.Lajovic at mf.uni-lj.si> wrote:
>>>>> Dear John,
>>>>>
>>>>>> One question though: I assume from your message that the previous
>>>>>> version of the Rcmdr worked OK with R 2.7.1. Is that right?
>>>>> No, the version 1.3-5 (that I still have with R 2.5.1) does not work
>>>>> with R 2.7.1 either. So:
>>>>>
>>>>> Rcmdr 1.3-5 with R 2.5.1: works OK.
>>>>> Rcmdr 1.3-5 with R 2.7.1: does not work properly.
>>>>> Rcmdr 1.4-0 with R 2.7.1: does not work properly.
>>>>>
>>>>> Thank you in advance,
>>>>> Jaro
>>>>>
>>>>>
>>>>>
>>>>>> On Mon, 25 Aug 2008 18:52:32 +0200
>>>>>>  "Jaro.Lajovic" <Jaro.Lajovic at mf.uni-lj.si> wrote:
>>>>>>> Dear John,
>>>>>>>
>>>>>>> Please find attached zipped Slovenian versions of .po (plain text
>>>>> and
>>>>>>> UTF-8 coded text) and .mo files.
>>>>>>>
>>>>>>> However, there seems to be a problem I have not been able to
>>>>> resolve.
>>>>>>> While special characters display properly under R version 2.5.1
>>>>> with
>>>>>>> Rcmdr 1.3-5, they fail to display (= are substituted by black
>>>>> blocks)
>>>>>>> under R version 2.7.1 with the new Rcmdr 1.4-0. By the way: the
>>>>> .mo
>>>>>>> file of the ver. 1.3-5 copied to 1.4-0 also failed to display
>>>>>>> properly.
>>>>>>>
>>>>>>> (An additional detail: three special characters that are used in
>>>>> the
>>>>>>> Slo version are c, s and z with hacek. c with hacek is not
>>>>> affected,
>>>>>>> it is just s and z with hacek that are not displayed OK.)
>>>>>>>
>>>>>>> Your advice will be much appreciated.
>>>>>>>
>>>>>>> With best regards,
>>>>>>> Jaro

-------------- next part --------------
A non-text attachment was scrubbed...
Name: Rcmdr_czs_demo.png
Type: image/png
Size: 20628 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20080908/5d4b5341/attachment.png>

From kyunseop.bae at gmail.com  Mon Sep  8 09:15:12 2008
From: kyunseop.bae at gmail.com (kyunseop.bae at gmail.com)
Date: Mon,  8 Sep 2008 09:15:12 +0200 (CEST)
Subject: [Rd] Different result with different order of binding (PR#12742)
Message-ID: <20080908071512.B75022834158@mail.pubhealth.ku.dk>

Full_Name: Kyun-Seop Bae
Version: 2.7.2
OS: MS-Windows XP SP2
Submission from: (NULL) (148.168.40.4)


# Script that I used

rm(list=objects())
objects()

WT <- 91
AGE <- 41
SCR <- 1.3

CCL1 <- (140-AGE) * WT / (72 * SCR)
CCL2 <- (140-AGE) * WT / 72 / SCR

CCL1
CCL2

identical(CCL1, CCL2)
identical(CCL1, 96.25)
identical(CCL2, 96.25)

CCL1*10 + 0.5
CCL2*10 + 0.5

floor(CCL1*10 + 0.5)
floor(CCL2*10 + 0.5)

as.integer(CCL1*10 + 0.5)
as.integer(CCL2*10 + 0.5)


# Same with multiplied WT
# Same in S-Plus Enterprise Developer Version 7.0.6 for Microsoft Windows :
2005
# But these are accurate in MS-Excel.


From P.Dalgaard at biostat.ku.dk  Mon Sep  8 10:21:02 2008
From: P.Dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Mon, 08 Sep 2008 10:21:02 +0200
Subject: [Rd] Different result with different order of binding (PR#12742)
In-Reply-To: <20080908071512.B75022834158@mail.pubhealth.ku.dk>
References: <20080908071512.B75022834158@mail.pubhealth.ku.dk>
Message-ID: <48C4E06E.90706@biostat.ku.dk>

kyunseop.bae at gmail.com wrote:
> Full_Name: Kyun-Seop Bae
> Version: 2.7.2
> OS: MS-Windows XP SP2
> Submission from: (NULL) (148.168.40.4)
>
>   
FAQ 7.31, not a bug!

> # Script that I used
>
> rm(list=objects())
> objects()
>
> WT <- 91
> AGE <- 41
> SCR <- 1.3
>
> CCL1 <- (140-AGE) * WT / (72 * SCR)
> CCL2 <- (140-AGE) * WT / 72 / SCR
>
> CCL1
> CCL2
>
> identical(CCL1, CCL2)
> identical(CCL1, 96.25)
> identical(CCL2, 96.25)
>
> CCL1*10 + 0.5
> CCL2*10 + 0.5
>
> floor(CCL1*10 + 0.5)
> floor(CCL2*10 + 0.5)
>
> as.integer(CCL1*10 + 0.5)
> as.integer(CCL2*10 + 0.5)
>
>
> # Same with multiplied WT
> # Same in S-Plus Enterprise Developer Version 7.0.6 for Microsoft Windows :
> 2005
> # But these are accurate in MS-Excel.
>
>   
Excel is not th gold standard for scientific computing!!
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>   


-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907


From ripley at stats.ox.ac.uk  Mon Sep  8 10:55:11 2008
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Mon,  8 Sep 2008 10:55:11 +0200 (CEST)
Subject: [Rd] (PR#12742) Different result with different order of
Message-ID: <20080908085511.AF054282C765@mail.pubhealth.ku.dk>

FAQ 7.31 strikes again.

This is expected: you cannot do exact arithmetic on a binary computer if 
some of the quantities involved are not binary fractions (e.g. 1.3)

See also the warning in ?`==`: identical() is equally inappropiate for 
computed numerical quantities.

On Mon, 8 Sep 2008, kyunseop.bae at gmail.com wrote:

> Full_Name: Kyun-Seop Bae
> Version: 2.7.2
> OS: MS-Windows XP SP2
> Submission from: (NULL) (148.168.40.4)
>
>
> # Script that I used
>
> rm(list=objects())
> objects()
>
> WT <- 91
> AGE <- 41
> SCR <- 1.3
>
> CCL1 <- (140-AGE) * WT / (72 * SCR)
> CCL2 <- (140-AGE) * WT / 72 / SCR
>
> CCL1
> CCL2
>
> identical(CCL1, CCL2)
> identical(CCL1, 96.25)
> identical(CCL2, 96.25)
>
> CCL1*10 + 0.5
> CCL2*10 + 0.5
>
> floor(CCL1*10 + 0.5)
> floor(CCL2*10 + 0.5)
>
> as.integer(CCL1*10 + 0.5)
> as.integer(CCL2*10 + 0.5)
>
>
> # Same with multiplied WT
> # Same in S-Plus Enterprise Developer Version 7.0.6 for Microsoft Windows :
> 2005
> # But these are accurate in MS-Excel.

Unlikely, more likely you don't have identical() to test bit-level 
equality.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Mon Sep  8 11:46:17 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 8 Sep 2008 10:46:17 +0100 (BST)
Subject: [Rd] Problem with UTF-8 text in the Rcmdr package
In-Reply-To: <001201c910fc$9016b4e0$b0441ea0$@ca>
References: <000801c90fbc$658fc900$30af5b00$@ca>
	<alpine.LFD.1.10.0809071152260.911@gannet.stats.ox.ac.uk>
	<001201c910fc$9016b4e0$b0441ea0$@ca>
Message-ID: <alpine.LFD.1.10.0809080923380.3605@gannet.stats.ox.ac.uk>

Unless Windows is running in CP1250 (the Slovenian encoding on Windows), 
this is not expected to work.  I believe John tested in CP1252, and it 
just so happens that those characters are in the same place in CP1250 and 
CP1252.

I get something different in CP1250, as pasting into the script window 
also does not work.  But if I use the Unicode escapes, the result in the 
output Window is rendered correctly in the output window.

I think Jaro has put his finger on this: Tcl/Tk output thinks it is in 
Latin-2 and not CP1250, and s and z caron have different positions in 
those two character sets.  Here is something I can reproduce easily: with 
XP set to Slovenian:

> x <-"??????"
> x
[1] "??????"
> charToRaw(x)
[1] c8 8a 8e e8 9a 9e

which is correct for CP1250.  Now if I submit 'x' in the Rcmdr script 
window, I get the wrong output in the output window.

And I've tracked that down to a bug in iconv (something we take from 
libiconv on Windows): it does think the native encoding is Latin-2, not 
CP1252.  I'll put a workaround in R-devel and R-patched shortly.  That has 
other potential ramifications that will take me longer to investigate, and 
correct thing may be to fix iconv.

On Sun, 7 Sep 2008, John Fox wrote:

> Dear Brian,
>
> Thank you for addressing the problem -- I was hoping that you would.
>
>> -----Original Message-----
>> From: Prof Brian Ripley [mailto:ripley at stats.ox.ac.uk]
>> Sent: September-07-08 7:23 AM
>> To: John Fox
>> Cc: 'R-devel'; 'Jaro.Lajovic'
>> Subject: Re: [Rd] Problem with UTF-8 text in the Rcmdr package
>>
>> The issue appears to be the Rcmdr output window and menus.  They are done
>> using Tcl/Tk, not by R.  So this might be a problem in Tcl/Tk or the fonts
>> it uses, or it might be problem with what Rcmdr passes to the tcltk
>> package.
>>
>> We need the means to reproduce this (as per the posting guide):
>
> Jaro provides an example in one of his messages in my posting (though it is
> slightly in error): If one enters
>
> cat("??????\n")
>
> in the Rcmdr Script window, the characters are rendered correctly. Executing
> this command (via the Submit button) produces the following in the Output
> window:
>
>> cat("??????\n")
> ??????
>
> which actually appears as
>
>> cat("??\n")
> ??
>
> This is under Windows Vista / R 2.7.2 / Rcmdr 1.4-0.
>
>>
>> - what OSes are affected?  Does this occur in a UTF-8 locale on Linux, for
>> example?
>
> I've now checked under Mac OS X and Linux Ubuntu, with the following
> results:
>
> Under Mac OS X 10.5.4 / R 2.7.2 / Rcmdr 1.4-0 / Tcl/Tk 8.4
>
> cat("??????\n") appears as cat("?????\n") in *both* the Script window and
> the Output window.
>
> Under Ubuntu Linux 8.04 / R 2.7.0 / Rcmdr 1.4-0/ Tcl/Tk 8.5
>
> cat("??????\n") appears *correctly* in *both* the Script window and the
> Output window.
>
>>
>> - in what locales?
>
> I'm afraid that I don't know how to check this short of changing the locale
> for my Windows machine. I do observe the problem in Windows when I start
> Rgui with language=sl.
>
>>
>> - what versions of Tcl/Tk?  Note that shipped with Windows R
>> changed between 2.5.1 and 2.7.x.
>
> Yes, and please see above, but if the problem were with Tcl/Tk, why does
> this work in the Script window under Windows and in both Script and Output
> under Ubuntu?
>
>>
>> - Is this anything to do with translations?  I've not looked at how
>> translations are done in Rcmdr, but if gettext() is used, the string
>> passed to R for output is in the native encoding, so 'UTF-8 characters' is
>> incorrect.  It is possible that it is an iconv problem if the translations
>> are supplied in UTF-8 and not Latin-2.
>
> Yes, the Rcmdr package uses gettext(). Could Jaro avoid the problem by using
> Latin-2 in preference to UTF-8?
>
>>
>> There are far too many layers involved here to guess at what is going on.
>> My guess is that it ought to be possible to give a simple example of a
>> string which can be output to the Rcmdr console and will be rendered
>> incorrectly (together with a screen shot of how it is rendered).
>
> Indeed, please see above. I've also attached a screenshot under Windows,
> having started R with language=sl.
>
>>
>> I think the characters referred to are the Unicode glyphs 's and z with
>> caron', \u0161 and \u017E.  It seems that these will only be displayable
>> in Rcmdr on Windows in a Latin-2 locale, which I do not have set up on
>> Windows (but believe I could get installed).  However, examples using that
>> (and the menus) seem to be correct in both sl_SI.iso88592 and sl_SI.utf8
>> on Linux, which suggests that this is probably not an R issue but a Tcl/Tk
>> one.
>
> I'm above my depth with respect to these issues, but I do find it curious
> that under Windows the characters appears correctly in the Script window but
> not the Output window.
>
>>
>> On Fri, 5 Sep 2008, John Fox wrote:
>>
>>> Dear list members,
>>>
>>> I've attached some email correspondence with Jaro Lajovic (with his
>>> permission), detailing a problem with the Slovenian translation file for
>>> the Rcmdr package.
>>
>> Unfortunately, it is not 'detailed', and we do need the details.
>
> I hope that the additional information in this message will supply at least
> some of the necessary details.
>
> Thank you for your help,
> John
>
>>
>>> In brief, while certain UTF-8 characters used in Slovenian used to
>>> appear properly in older versions of R, some characters do not display
>>> properly in the Rcmdr menus and output window under R 2.7.x. I've
>>> confirmed the problem with the current version of the Rcmdr package
>>> (1.4-0) and R 2.7.2 under Windows Vista.
>>>
>>> I've checked the R docs and NEWS file for changes to R, but wasn't able
>>> to turn up anything that seemed relevant. Frankly, however, my
>>> understanding of how various character sets are handled is only partial.
>>>
>>> Any help would be appreciated.
>>>
>>> John
>>>
>>> ------------------------------
>>> John Fox, Professor
>>> Department of Sociology
>>> McMaster University
>>> Hamilton, Ontario, Canada
>>> web: socserv.mcmaster.ca/jfox
>>>
>>>
>>> -----Original Message-----
>>> From: Jaro.Lajovic [mailto:Jaro.Lajovic at mf.uni-lj.si]
>>> Sent: August-26-08 2:57 AM
>>> To: John Fox
>>> Subject: Re: Slovenian Rcmdr .po and .mo - and a problem
>>>
>>> Dear John,
>>>
>>>> That seems to imply that there's a change in R rather than in the Rcmdr
>>>> that produced this problem. Do you notice the problem with any other
>>>> packages that use translation or with R itself?
>>>
>>> As for other translated R packages, I am afraid I am not aware of any.
>>> However, a quick test using cat with special characters:
>>> cat "??????\n"
>>> reveals that the string prints OK in the R (2.7.1.) console. The command
>>> line also shows OK in the Rcmdr Script window, but does not display
>>> right in the Output window. Special chars also fail in the Messages
> window.
>>>
>>> Input (Script window) thus seems not to be affected, while the menu
>>> system and output do not work properly.
>>>
>>> Thank you very much,
>>> Jaro
>>>
>>>
>>>> On Mon, 25 Aug 2008 21:54:43 +0200
>>>>  "Jaro.Lajovic" <Jaro.Lajovic at mf.uni-lj.si> wrote:
>>>>> Dear John,
>>>>>
>>>>>> One question though: I assume from your message that the previous
>>>>>> version of the Rcmdr worked OK with R 2.7.1. Is that right?
>>>>> No, the version 1.3-5 (that I still have with R 2.5.1) does not work
>>>>> with R 2.7.1 either. So:
>>>>>
>>>>> Rcmdr 1.3-5 with R 2.5.1: works OK.
>>>>> Rcmdr 1.3-5 with R 2.7.1: does not work properly.
>>>>> Rcmdr 1.4-0 with R 2.7.1: does not work properly.
>>>>>
>>>>> Thank you in advance,
>>>>> Jaro
>>>>>
>>>>>
>>>>>
>>>>>> On Mon, 25 Aug 2008 18:52:32 +0200
>>>>>>  "Jaro.Lajovic" <Jaro.Lajovic at mf.uni-lj.si> wrote:
>>>>>>> Dear John,
>>>>>>>
>>>>>>> Please find attached zipped Slovenian versions of .po (plain text
>>>>> and
>>>>>>> UTF-8 coded text) and .mo files.
>>>>>>>
>>>>>>> However, there seems to be a problem I have not been able to
>>>>> resolve.
>>>>>>> While special characters display properly under R version 2.5.1
>>>>> with
>>>>>>> Rcmdr 1.3-5, they fail to display (= are substituted by black
>>>>> blocks)
>>>>>>> under R version 2.7.1 with the new Rcmdr 1.4-0. By the way: the
>>>>> .mo
>>>>>>> file of the ver. 1.3-5 copied to 1.4-0 also failed to display
>>>>>>> properly.
>>>>>>>
>>>>>>> (An additional detail: three special characters that are used in
>>>>> the
>>>>>>> Slo version are c, s and z with hacek. c with hacek is not
>>>>> affected,
>>>>>>> it is just s and z with hacek that are not displayed OK.)
>>>>>>>
>>>>>>> Your advice will be much appreciated.
>>>>>>>
>>>>>>> With best regards,
>>>>>>> Jaro
>>>>
>>>> --------------------------------
>>>> John Fox, Professor
>>>> Department of Sociology
>>>> McMaster University
>>>> Hamilton, Ontario, Canada
>>>> http://socserv.mcmaster.ca/jfox/
>>>>
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>
>> --
>> Brian D. Ripley,                  ripley at stats.ox.ac.uk
>> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
>> University of Oxford,             Tel:  +44 1865 272861 (self)
>> 1 South Parks Road,                     +44 1865 272866 (PA)
>> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From jfox at mcmaster.ca  Mon Sep  8 14:48:05 2008
From: jfox at mcmaster.ca (John Fox)
Date: Mon, 8 Sep 2008 08:48:05 -0400
Subject: [Rd] Problem with UTF-8 text in the Rcmdr package
In-Reply-To: <alpine.LFD.1.10.0809080923380.3605@gannet.stats.ox.ac.uk>
References: <000801c90fbc$658fc900$30af5b00$@ca>	<alpine.LFD.1.10.0809071152260.911@gannet.stats.ox.ac.uk>	<001201c910fc$9016b4e0$b0441ea0$@ca>
	<alpine.LFD.1.10.0809080923380.3605@gannet.stats.ox.ac.uk>
Message-ID: <004701c911b1$234c0d00$69e42700$@ca>

Dear Brian,

> -----Original Message-----
> From: r-devel-bounces at r-project.org [mailto:r-devel-bounces at r-project.org]
On
> Behalf Of Prof Brian Ripley
> Sent: September-08-08 5:46 AM
> To: John Fox
> Cc: 'Jaro.Lajovic'; 'R-devel'
> Subject: Re: [Rd] Problem with UTF-8 text in the Rcmdr package
> 
> Unless Windows is running in CP1250 (the Slovenian encoding on Windows),
this
> is not expected to work.  I believe John tested in CP1252, and it just so
> happens that those characters are in the same place in CP1250 and CP1252.

Yes, that's right: My locale is English (Canada), which uses CP1252.

> 
> I get something different in CP1250, as pasting into the script window
also
> does not work.  But if I use the Unicode escapes, the result in the output
> Window is rendered correctly in the output window.
> 
> I think Jaro has put his finger on this: Tcl/Tk output thinks it is in
> Latin-2 and not CP1250, and s and z caron have different positions in
those
> two character sets.  Here is something I can reproduce easily: with XP set
to
> Slovenian:
> 
> > x <-"??????"
> > x
> [1] "??????"
> > charToRaw(x)
> [1] c8 8a 8e e8 9a 9e
> 
> which is correct for CP1250.  Now if I submit 'x' in the Rcmdr script
window,
> I get the wrong output in the output window.
> 
> And I've tracked that down to a bug in iconv (something we take from
libiconv
> on Windows): it does think the native encoding is Latin-2, not CP1252.
I'll
> put a workaround in R-devel and R-patched shortly.  That has other
potential
> ramifications that will take me longer to investigate, and correct thing
may
> be to fix iconv.

Thank you very much for tracking this down. 

Recall that there is also apparently a problem under Mac OS X, where the
characters appeared incorrectly in both the Script and Output windows.

Regards,
 John

> 
> On Sun, 7 Sep 2008, John Fox wrote:
> 
> > Dear Brian,
> >
> > Thank you for addressing the problem -- I was hoping that you would.
> >
> >> -----Original Message-----
> >> From: Prof Brian Ripley [mailto:ripley at stats.ox.ac.uk]
> >> Sent: September-07-08 7:23 AM
> >> To: John Fox
> >> Cc: 'R-devel'; 'Jaro.Lajovic'
> >> Subject: Re: [Rd] Problem with UTF-8 text in the Rcmdr package
> >>
> >> The issue appears to be the Rcmdr output window and menus.  They are
> >> done using Tcl/Tk, not by R.  So this might be a problem in Tcl/Tk or
> >> the fonts it uses, or it might be problem with what Rcmdr passes to
> >> the tcltk package.
> >>
> >> We need the means to reproduce this (as per the posting guide):
> >
> > Jaro provides an example in one of his messages in my posting (though
> > it is slightly in error): If one enters
> >
> > cat("??????\n")
> >
> > in the Rcmdr Script window, the characters are rendered correctly.
> > Executing this command (via the Submit button) produces the following
> > in the Output
> > window:
> >
> >> cat("??????\n")
> > ??????
> >
> > which actually appears as
> >
> >> cat("??\n")
> > ??
> >
> > This is under Windows Vista / R 2.7.2 / Rcmdr 1.4-0.
> >
> >>
> >> - what OSes are affected?  Does this occur in a UTF-8 locale on
> >> Linux, for example?
> >
> > I've now checked under Mac OS X and Linux Ubuntu, with the following
> > results:
> >
> > Under Mac OS X 10.5.4 / R 2.7.2 / Rcmdr 1.4-0 / Tcl/Tk 8.4
> >
> > cat("??????\n") appears as cat("?????\n") in *both* the Script window
> > and the Output window.
> >
> > Under Ubuntu Linux 8.04 / R 2.7.0 / Rcmdr 1.4-0/ Tcl/Tk 8.5
> >
> > cat("??????\n") appears *correctly* in *both* the Script window and
> > the Output window.
> >
> >>
> >> - in what locales?
> >
> > I'm afraid that I don't know how to check this short of changing the
> > locale for my Windows machine. I do observe the problem in Windows
> > when I start Rgui with language=sl.
> >
> >>
> >> - what versions of Tcl/Tk?  Note that shipped with Windows R changed
> >> between 2.5.1 and 2.7.x.
> >
> > Yes, and please see above, but if the problem were with Tcl/Tk, why
> > does this work in the Script window under Windows and in both Script
> > and Output under Ubuntu?
> >
> >>
> >> - Is this anything to do with translations?  I've not looked at how
> >> translations are done in Rcmdr, but if gettext() is used, the string
> >> passed to R for output is in the native encoding, so 'UTF-8
> >> characters' is incorrect.  It is possible that it is an iconv problem
> >> if the translations are supplied in UTF-8 and not Latin-2.
> >
> > Yes, the Rcmdr package uses gettext(). Could Jaro avoid the problem by
> > using
> > Latin-2 in preference to UTF-8?
> >
> >>
> >> There are far too many layers involved here to guess at what is going
on.
> >> My guess is that it ought to be possible to give a simple example of
> >> a string which can be output to the Rcmdr console and will be
> >> rendered incorrectly (together with a screen shot of how it is
rendered).
> >
> > Indeed, please see above. I've also attached a screenshot under
> > Windows, having started R with language=sl.
> >
> >>
> >> I think the characters referred to are the Unicode glyphs 's and z
> >> with caron', \u0161 and \u017E.  It seems that these will only be
> >> displayable in Rcmdr on Windows in a Latin-2 locale, which I do not
> >> have set up on Windows (but believe I could get installed).  However,
> >> examples using that (and the menus) seem to be correct in both
> >> sl_SI.iso88592 and sl_SI.utf8 on Linux, which suggests that this is
> >> probably not an R issue but a Tcl/Tk one.
> >
> > I'm above my depth with respect to these issues, but I do find it
> > curious that under Windows the characters appears correctly in the
> > Script window but not the Output window.
> >
> >>
> >> On Fri, 5 Sep 2008, John Fox wrote:
> >>
> >>> Dear list members,
> >>>
> >>> I've attached some email correspondence with Jaro Lajovic (with his
> >>> permission), detailing a problem with the Slovenian translation file
> >>> for the Rcmdr package.
> >>
> >> Unfortunately, it is not 'detailed', and we do need the details.
> >
> > I hope that the additional information in this message will supply at
> > least some of the necessary details.
> >
> > Thank you for your help,
> > John
> >
> >>
> >>> In brief, while certain UTF-8 characters used in Slovenian used to
> >>> appear properly in older versions of R, some characters do not
> >>> display properly in the Rcmdr menus and output window under R 2.7.x.
> >>> I've confirmed the problem with the current version of the Rcmdr
> >>> package
> >>> (1.4-0) and R 2.7.2 under Windows Vista.
> >>>
> >>> I've checked the R docs and NEWS file for changes to R, but wasn't
> >>> able to turn up anything that seemed relevant. Frankly, however, my
> >>> understanding of how various character sets are handled is only
partial.
> >>>
> >>> Any help would be appreciated.
> >>>
> >>> John
> >>>
> >>> ------------------------------
> >>> John Fox, Professor
> >>> Department of Sociology
> >>> McMaster University
> >>> Hamilton, Ontario, Canada
> >>> web: socserv.mcmaster.ca/jfox
> >>>
> >>>
> >>> -----Original Message-----
> >>> From: Jaro.Lajovic [mailto:Jaro.Lajovic at mf.uni-lj.si]
> >>> Sent: August-26-08 2:57 AM
> >>> To: John Fox
> >>> Subject: Re: Slovenian Rcmdr .po and .mo - and a problem
> >>>
> >>> Dear John,
> >>>
> >>>> That seems to imply that there's a change in R rather than in the
> >>>> Rcmdr that produced this problem. Do you notice the problem with
> >>>> any other packages that use translation or with R itself?
> >>>
> >>> As for other translated R packages, I am afraid I am not aware of any.
> >>> However, a quick test using cat with special characters:
> >>> cat "??????\n"
> >>> reveals that the string prints OK in the R (2.7.1.) console. The
> >>> command line also shows OK in the Rcmdr Script window, but does not
> >>> display right in the Output window. Special chars also fail in the
> >>> Messages
> > window.
> >>>
> >>> Input (Script window) thus seems not to be affected, while the menu
> >>> system and output do not work properly.
> >>>
> >>> Thank you very much,
> >>> Jaro
> >>>
> >>>
> >>>> On Mon, 25 Aug 2008 21:54:43 +0200
> >>>>  "Jaro.Lajovic" <Jaro.Lajovic at mf.uni-lj.si> wrote:
> >>>>> Dear John,
> >>>>>
> >>>>>> One question though: I assume from your message that the previous
> >>>>>> version of the Rcmdr worked OK with R 2.7.1. Is that right?
> >>>>> No, the version 1.3-5 (that I still have with R 2.5.1) does not
> >>>>> work with R 2.7.1 either. So:
> >>>>>
> >>>>> Rcmdr 1.3-5 with R 2.5.1: works OK.
> >>>>> Rcmdr 1.3-5 with R 2.7.1: does not work properly.
> >>>>> Rcmdr 1.4-0 with R 2.7.1: does not work properly.
> >>>>>
> >>>>> Thank you in advance,
> >>>>> Jaro
> >>>>>
> >>>>>
> >>>>>
> >>>>>> On Mon, 25 Aug 2008 18:52:32 +0200  "Jaro.Lajovic"
> >>>>>> <Jaro.Lajovic at mf.uni-lj.si> wrote:
> >>>>>>> Dear John,
> >>>>>>>
> >>>>>>> Please find attached zipped Slovenian versions of .po (plain
> >>>>>>> text
> >>>>> and
> >>>>>>> UTF-8 coded text) and .mo files.
> >>>>>>>
> >>>>>>> However, there seems to be a problem I have not been able to
> >>>>> resolve.
> >>>>>>> While special characters display properly under R version 2.5.1
> >>>>> with
> >>>>>>> Rcmdr 1.3-5, they fail to display (= are substituted by black
> >>>>> blocks)
> >>>>>>> under R version 2.7.1 with the new Rcmdr 1.4-0. By the way: the
> >>>>> .mo
> >>>>>>> file of the ver. 1.3-5 copied to 1.4-0 also failed to display
> >>>>>>> properly.
> >>>>>>>
> >>>>>>> (An additional detail: three special characters that are used in
> >>>>> the
> >>>>>>> Slo version are c, s and z with hacek. c with hacek is not
> >>>>> affected,
> >>>>>>> it is just s and z with hacek that are not displayed OK.)
> >>>>>>>
> >>>>>>> Your advice will be much appreciated.
> >>>>>>>
> >>>>>>> With best regards,
> >>>>>>> Jaro
> >>>>
> >>>> --------------------------------
> >>>> John Fox, Professor
> >>>> Department of Sociology
> >>>> McMaster University
> >>>> Hamilton, Ontario, Canada
> >>>> http://socserv.mcmaster.ca/jfox/
> >>>>
> >>>
> >>> ______________________________________________
> >>> R-devel at r-project.org mailing list
> >>> https://stat.ethz.ch/mailman/listinfo/r-devel
> >>>
> >>
> >> --
> >> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> >> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> >> University of Oxford,             Tel:  +44 1865 272861 (self)
> >> 1 South Parks Road,                     +44 1865 272866 (PA)
> >> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
> >
> 
> --
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Mon Sep  8 15:30:14 2008
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Mon,  8 Sep 2008 15:30:14 +0200 (CEST)
Subject: [Rd] (PR#12742) Different result with different order of
Message-ID: <20080908133014.83429282EFF8@mail.pubhealth.ku.dk>

On Mon, 8 Sep 2008, ksbae wrote:

> Thank you for the prompt reply.
>
> Do you know why does MS-Excel give result that I expected?

Know, but I did comment on that.

>
> Thanks,
>
> Kyun-Seop BAE
> Email: kyunseop.bae at gmail.com
>
>
> -----Original Message-----
> From: Prof Brian Ripley [mailto:ripley at stats.ox.ac.uk]
> Sent: Monday, September 08, 2008 1:53 AM
> To: kyunseop.bae at gmail.com
> Cc: R-bugs at r-project.org
> Subject: Re: [Rd] (PR#12742) Different result with different order of
> binding
>
> FAQ 7.31 strikes again.
>
> This is expected: you cannot do exact arithmetic on a binary computer if
> some of the quantities involved are not binary fractions (e.g. 1.3)
>
> See also the warning in ?`==`: identical() is equally inappropiate for
> computed numerical quantities.
>
> On Mon, 8 Sep 2008, kyunseop.bae at gmail.com wrote:
>
>> Full_Name: Kyun-Seop Bae
>> Version: 2.7.2
>> OS: MS-Windows XP SP2
>> Submission from: (NULL) (148.168.40.4)
>>
>>
>> # Script that I used
>>
>> rm(list=objects())
>> objects()
>>
>> WT <- 91
>> AGE <- 41
>> SCR <- 1.3
>>
>> CCL1 <- (140-AGE) * WT / (72 * SCR)
>> CCL2 <- (140-AGE) * WT / 72 / SCR
>>
>> CCL1
>> CCL2
>>
>> identical(CCL1, CCL2)
>> identical(CCL1, 96.25)
>> identical(CCL2, 96.25)
>>
>> CCL1*10 + 0.5
>> CCL2*10 + 0.5
>>
>> floor(CCL1*10 + 0.5)
>> floor(CCL2*10 + 0.5)
>>
>> as.integer(CCL1*10 + 0.5)
>> as.integer(CCL2*10 + 0.5)
>>
>>
>> # Same with multiplied WT
>> # Same in S-Plus Enterprise Developer Version 7.0.6 for Microsoft Windows
> :
>> 2005
>> # But these are accurate in MS-Excel.
>
> Unlikely, more likely you don't have identical() to test bit-level
> equality.
>
> -- 
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From kyunseop.bae at gmail.com  Mon Sep  8 15:25:09 2008
From: kyunseop.bae at gmail.com (kyunseop.bae at gmail.com)
Date: Mon,  8 Sep 2008 15:25:09 +0200 (CEST)
Subject: [Rd] (PR#12742) Different result with different order of binding
Message-ID: <20080908132509.6940E282EFF8@mail.pubhealth.ku.dk>

Thank you for the prompt reply.
 
Do you know why does MS-Excel give result that I expected?

Thanks,

Kyun-Seop BAE
Email: kyunseop.bae at gmail.com


-----Original Message-----
From: Prof Brian Ripley [mailto:ripley at stats.ox.ac.uk] 
Sent: Monday, September 08, 2008 1:53 AM
To: kyunseop.bae at gmail.com
Cc: R-bugs at r-project.org
Subject: Re: [Rd] (PR#12742) Different result with different order of
binding

FAQ 7.31 strikes again.

This is expected: you cannot do exact arithmetic on a binary computer if 
some of the quantities involved are not binary fractions (e.g. 1.3)

See also the warning in ?`==`: identical() is equally inappropiate for 
computed numerical quantities.

On Mon, 8 Sep 2008, kyunseop.bae at gmail.com wrote:

> Full_Name: Kyun-Seop Bae
> Version: 2.7.2
> OS: MS-Windows XP SP2
> Submission from: (NULL) (148.168.40.4)
>
>
> # Script that I used
>
> rm(list=objects())
> objects()
>
> WT <- 91
> AGE <- 41
> SCR <- 1.3
>
> CCL1 <- (140-AGE) * WT / (72 * SCR)
> CCL2 <- (140-AGE) * WT / 72 / SCR
>
> CCL1
> CCL2
>
> identical(CCL1, CCL2)
> identical(CCL1, 96.25)
> identical(CCL2, 96.25)
>
> CCL1*10 + 0.5
> CCL2*10 + 0.5
>
> floor(CCL1*10 + 0.5)
> floor(CCL2*10 + 0.5)
>
> as.integer(CCL1*10 + 0.5)
> as.integer(CCL2*10 + 0.5)
>
>
> # Same with multiplied WT
> # Same in S-Plus Enterprise Developer Version 7.0.6 for Microsoft Windows
:
> 2005
> # But these are accurate in MS-Excel.

Unlikely, more likely you don't have identical() to test bit-level 
equality.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From jschenck at cisco.com  Tue Sep  9 02:25:34 2008
From: jschenck at cisco.com (jschenck at cisco.com)
Date: Tue,  9 Sep 2008 02:25:34 +0200 (CEST)
Subject: [Rd] package "signal", function "filter" (PR#12752)
Message-ID: <20080909002534.ED069282EFF6@mail.pubhealth.ku.dk>

Full_Name: Jeff Schenck
Version: 2.6.2 (signal v. 0.5)
OS: Windows XP
Submission from: (NULL) (128.107.248.220)


The "filter" function in the package "signal" does not properly handle recursive
filters with only two feedback taps.  I looked at the source code in filter.R. 
There is a line that says "if (length(a) > 2)" that I think should have ">=".  I
tried it that way and it seems to work fine.

FYI...  My test filter was a DC notch:
  b <- c(1, -1)
  a <- c(1, -0.95)
  y <- filter(b, a, x)

Thanks,
Jeff Schenck


From ripley at stats.ox.ac.uk  Tue Sep  9 09:30:16 2008
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Tue,  9 Sep 2008 09:30:16 +0200 (CEST)
Subject: [Rd] package "signal", function "filter" (PR#12752)
Message-ID: <20080909073016.91F822834154@mail.pubhealth.ku.dk>

Package 'signal' is not the responsibility of the R developers, so you 
need to follow the FAQ and report this to the maintainer, rather than 
clog up R-bgs with an inappopriate report.

You might find that R's own function filter() is better written.

The FAQ also asks you not to report on long obsolete versions of R.

On Tue, 9 Sep 2008, jschenck at cisco.com wrote:

> Full_Name: Jeff Schenck
> Version: 2.6.2 (signal v. 0.5)
> OS: Windows XP
> Submission from: (NULL) (128.107.248.220)
>
>
> The "filter" function in the package "signal" does not properly handle recursive
> filters with only two feedback taps.  I looked at the source code in filter.R.
> There is a line that says "if (length(a) > 2)" that I think should have ">=".  I
> tried it that way and it seems to work fine.
>
> FYI...  My test filter was a DC notch:
>  b <- c(1, -1)
>  a <- c(1, -0.95)
>  y <- filter(b, a, x)
>
> Thanks,
> Jeff Schenck
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From h.wickham at gmail.com  Tue Sep  9 15:03:58 2008
From: h.wickham at gmail.com (hadley wickham)
Date: Tue, 9 Sep 2008 08:03:58 -0500
Subject: [Rd] package "signal", function "filter" (PR#12752)
In-Reply-To: <20080909073016.91F822834154@mail.pubhealth.ku.dk>
References: <20080909073016.91F822834154@mail.pubhealth.ku.dk>
Message-ID: <f8e6ff050809090603o7a0615edxa726be0cd73fa825@mail.gmail.com>

On Tue, Sep 9, 2008 at 2:30 AM,  <ripley at stats.ox.ac.uk> wrote:
> Package 'signal' is not the responsibility of the R developers, so you
> need to follow the FAQ and report this to the maintainer, rather than
> clog up R-bgs with an inappopriate report.
>
> You might find that R's own function filter() is better written.
>
> The FAQ also asks you not to report on long obsolete versions of R.

Perhaps if these frequently "asked" questions were actually displayed
on the bug reporting page people would notice them.

Hadley

-- 
http://had.co.nz/


From osklyar at maninvestments.com  Tue Sep  9 15:29:13 2008
From: osklyar at maninvestments.com (Sklyar, Oleg (London))
Date: Tue, 9 Sep 2008 14:29:13 +0100
Subject: [Rd] 'xtfrm' performance (influences 'order' performance) in R devel
Message-ID: <1A68FCB28DE72F4BA3B967E6506CCE4303049734@mildnpexmb01.maninvestments.ad.man.com>

Hello everybody,

it looks like the presense of some (do know know which) S4 methods for a
given S4 class degrades the performance of xtfrm (used in 'order' in new
R-devel) by a factor of millions. This is for classes that ARE derived
from numeric directly and thus should be quite trivial to convert to
numeric.

Consider the following example:

setClass("TimeDateBase", 
    representation("numeric", mode="character"),
    prototype(mode="posix")
)
setClass("TimeDate",
    representation("TimeDateBase", tzone="character"),
    prototype(tzone="London")
)
x = new("TimeDate", 1220966224 + runif(1e5))

system.time({ z = order(x) })
## > system.time({ z = order(x) })
##   user  system elapsed 
##  0.048   0.000   0.048 

getClass("TimeDate")
## Class "TimeDate"

## Slots:
                                    
## Name:      .Data     tzone      mode
## Class:   numeric character character

## Extends: 
## Class "TimeDateBase", directly
## Class "numeric", by class "TimeDateBase", distance 2
## Class "vector", by class "TimeDateBase", distance 3


Now, if I load a library that not only defines these same classes, but
also a bunch of methods for those, then I have the following result:

library(AHLCalendar)
x = now() + runif(1e5) ## just random times in POSIXct format
x[1:5]
## TimeDate [posix] object in 'Europe/London' of length 5:
## [1] "2008-09-09 14:19:35.218" "2008-09-09 14:19:35.672"
## [3] "2008-09-09 14:19:35.515" "2008-09-09 14:19:35.721"
## [5] "2008-09-09 14:19:35.657"

> system.time({ z = order(x) })


Enter a frame number, or 0 to exit   

 1: system.time({
 2: order(x)
 3: lapply(z, function(x) if (is.object(x)) xtfrm(x) else x)
 4: FUN(X[[1]], ...)
 5: xtfrm(x)
 6: xtfrm.default(x)
 7: as.vector(rank(x, ties.method = "min", na.last = "keep"))
 8: rank(x, ties.method = "min", na.last = "keep")
 9: switch(ties.method, average = , min = , max =
.Internal(rank(x[!nas], ties.
10: .gt(c(1220966375.21811, 1220966375.67217, 1220966375.51470,
1220966375.7211
11: x[j]
12: x[j]

Selection: 0
Timing stopped at: 47.618 13.791 66.478 

At the same time:

system.time({ z = as.numeric(x) }) ## same as x at .Data
##   user  system elapsed 
##  0.001   0.000   0.001 

The only difference between the two is that I have the following methods
defined for TimeDate (full listing below). 

Any idea why this could be happenning. And yes, it is down to xtfrm
function, 'order' was just a place where the problem occured. Should
xtfrm function be smarter with respect to classes that are actually
derived from 'numeric'?

> showMethods(class="TimeDate")
Function: + (package base)
e1="TimeDate", e2="TimeDate"
e1="TimeDate", e2="numeric"
    (inherited from: e1="TimeDateBase", e2="numeric")

Function: - (package base)
e1="TimeDate", e2="TimeDate"

Function: Time (package AHLCalendar)
x="TimeDate"

Function: TimeDate (package AHLCalendar)
x="TimeDate"

Function: TimeDate<- (package AHLCalendar)
x="TimeSeries", value="TimeDate"

Function: TimeSeries (package AHLCalendar)
x="data.frame", ts="TimeDate"
x="matrix", ts="TimeDate"
x="numeric", ts="TimeDate"

Function: [ (package base)
x="TimeDate", i="POSIXt", j="missing"
x="TimeDate", i="Time", j="missing"
x="TimeDate", i="TimeDate", j="missing"
x="TimeDate", i="integer", j="missing"
    (inherited from: x="TimeDateBase", i="ANY", j="missing")
x="TimeDate", i="logical", j="missing"
    (inherited from: x="TimeDateBase", i="ANY", j="missing")
x="TimeSeries", i="TimeDate", j="missing"
x="TimeSeries", i="TimeDate", j="vector"

Function: [<- (package base)
x="TimeDate", i="ANY", j="ANY", value="ANY"
x="TimeDate", i="ANY", j="ANY", value="numeric"
x="TimeDate", i="missing", j="ANY", value="ANY"
x="TimeDate", i="missing", j="ANY", value="numeric"

Function: add (package AHLCalendar)
x="TimeDate"

Function: addMonths (package AHLCalendar)
x="TimeDate"

Function: addYears (package AHLCalendar)
x="TimeDate"

Function: align (package AHLCalendar)
x="TimeDate", to="character"
x="TimeDate", to="missing"

Function: as.POSIXct (package base)
x="TimeDate"

Function: as.POSIXlt (package base)
x="TimeDate"

Function: coerce (package methods)
from="TimeDate", to="TimeDateBase"

Function: coerce<- (package methods)
from="TimeDate", to="numeric"

Function: dates (package AHLCalendar)
x="TimeDate"

Function: format (package base)
x="TimeDate"

Function: fxFwdDate (package AHLCalendar)
x="TimeDate", country="character"

Function: fxSettleDate (package AHLCalendar)
x="TimeDate", country="character"

Function: holidays (package AHLCalendar)
x="TimeDate"

Function: index (package AHLCalendar)
x="TimeDate", y="POSIXt"
x="TimeDate", y="Time"
x="TimeDate", y="TimeDate"

Function: initialize (package methods)
.Object="TimeDate"
    (inherited from: .Object="ANY")

Function: leapYear (package AHLCalendar)
x="TimeDate"

Function: mday (package AHLCalendar)
x="TimeDate"

Function: mode (package base)
x="TimeDate"
    (inherited from: x="TimeDateBase")

Function: mode<- (package base)
x="TimeDate", value="character"
    (inherited from: x="TimeDateBase", value="character")

Function: month (package AHLCalendar)
x="TimeDate"

Function: pretty (package base)
x="TimeDate"

Function: prettyFormat (package AHLCalendar)
x="TimeDate", munit="character"
x="TimeDate", munit="missing"

Function: print (package base)
x="TimeDate"

Function: show (package methods)
object="TimeDate"
    (inherited from: object="TimeDateBase")

Function: summary (package base)
object="TimeDate"

Function: td2tz (package AHLCalendar)
x="TimeDate"

Function: times (package AHLCalendar)
x="TimeDate"

Function: tojulian (package AHLCalendar)
x="TimeDate"

Function: toposix (package AHLCalendar)
x="TimeDate"

Function: tots (package AHLCalendar)
x="TimeDate"

Function: tzone (package AHLCalendar)
x="TimeDate"

Function: tzone<- (package AHLCalendar)
x="TimeDate"

Function: wday (package AHLCalendar)
x="TimeDate"

Function: yday (package AHLCalendar)
x="TimeDate"

Function: year (package AHLCalendar)
x="TimeDate"



Dr Oleg Sklyar
Research Technologist
AHL / Man Investments Ltd
+44 (0)20 7144 3107
osklyar at maninvestments.com


**********************************************************************
The contents of this email are for the named addressee(s...{{dropped:22}}


From mark_difford at Yahoo.co.uk  Tue Sep  9 15:15:07 2008
From: mark_difford at Yahoo.co.uk (mark_difford at Yahoo.co.uk)
Date: Tue,  9 Sep 2008 15:15:07 +0200 (CEST)
Subject: [Rd] legend does not reset xpd (PR#12756)
Message-ID: <20080909131507.D32F1282EFF6@mail.pubhealth.ku.dk>

Full_Name: Mark Difford
Version: R version 2.7.2 Patched (2008-08-26 r46442)
OS: Windows -- Vista
Submission from: (NULL) (198.54.202.146)


legend(graphics) does not reset xpd to its pre-call state when it has finished
drawing the legend.

## Ex.
par(xpd = FALSE)
plot(1)
legend("top", legend="Tops", xpd=NA, inset=c(-.1))
plot(1); abline(v=1); par(xpd=FALSE)
plot(1)


From ulrich.keller at uni.lu  Tue Sep  9 13:55:11 2008
From: ulrich.keller at uni.lu (ulrich.keller at uni.lu)
Date: Tue,  9 Sep 2008 13:55:11 +0200 (CEST)
Subject: [Rd] Addendum to wishlist bug report #10931 (factanal) (PR#12754)
Message-ID: <20080909115511.4FF112834169@mail.pubhealth.ku.dk>

--=-hiYzUeWcRJ/+kx41aPIZ
Content-Type: text/plain; charset="UTF-8"
Content-Transfer-Encoding: 8bit

Hi,

on March 10 I filed a wishlist bug report asking for the inclusion of
some changes to factanal() and the associated print method. The changes
were originally proposed by John Fox in 2005; they make print.factanal()
display factor correlations if factanal() is called with rotation =
"promax". Since I got no replies, and I am really tired of my R-curious
social science colleagues asking "What, it can't even display factor
correlations?!", I made the changes myself. I would be very grateful if
they'd find their way into a release.

I corrected a small error in John Fox's code and made another change
that enables factor correlations not only for promax, but also for the
rotation methods in package GPArotation.

The changes are against R-devel, downloaded on September 9th 2008.
Changes are indicated by comments from John Fox and me. I also changed
factanal.Rd accordingly, this is commented too.

My bug report is at
http://bugs.r-project.org/cgi-bin/R/wishlist?id=10931;user=guest

John Fox's original post is at
http://tolstoy.newcastle.edu.au/R/devel/05/06/1414.html

The changed files factanal.R and factanal.Rd are attached. If there is
anything else I can do to help these changes make it into R, please let
me know.

Thanks and best regards,

Uli

-- 
Ulrich Keller
Universit?? du Luxembourg
EMACS research unit
B.P. 2
L-7201 Walferdange
Luxembourg
Mail ulrich.keller at uni.lu
Phone +352 46 66 44 9 278

--=-hiYzUeWcRJ/+kx41aPIZ
Content-Disposition: attachment; filename="factanal.R"
Content-Type: text/plain; name="factanal.R"; charset="utf-8"
Content-Transfer-Encoding: 7bit

#  File src/library/stats/R/factanal.R
#  Part of the R package, http://www.R-project.org
#
#  This program is free software; you can redistribute it and/or modify
#  it under the terms of the GNU General Public License as published by
#  the Free Software Foundation; either version 2 of the License, or
#  (at your option) any later version.
#
#  This program is distributed in the hope that it will be useful,
#  but WITHOUT ANY WARRANTY; without even the implied warranty of
#  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#  GNU General Public License for more details.
#
#  A copy of the GNU General Public License is available at
#  http://www.r-project.org/Licenses/

## Hmm, MM thinks diag(.) needs checking { diag(vec) when length(vec)==1 !}
## However, MM does not understand that factor analysis
##   is a *multi*variate technique!
factanal <-
    function (x, factors, data = NULL, covmat = NULL, n.obs = NA,
              subset, na.action, start = NULL,
              scores = c("none", "regression", "Bartlett"),
              rotation = "varimax",
              control = NULL, ...)
{
    sortLoadings <- function(Lambda)
    {
        cn <- colnames(Lambda)
        Phi <- attr(Lambda, "covariance")
        ssq <- apply(Lambda, 2, function(x) -sum(x^2))
        Lambda <- Lambda[, order(ssq), drop = FALSE]
        colnames(Lambda) <- cn
        neg <- colSums(Lambda) < 0
        Lambda[, neg] <- -Lambda[, neg]
        if(!is.null(Phi)) {
            unit <- ifelse(neg, -1, 1)
            attr(Lambda, "covariance") <-
                unit %*% Phi[order(ssq), order(ssq)] %*% unit
        }
        Lambda
    }
    cl <- match.call()
    na.act <- NULL
    if (is.list(covmat)) {
        if (any(is.na(match(c("cov", "n.obs"), names(covmat)))))
            stop("'covmat' is not a valid covariance list")
        cv <- covmat$cov
        n.obs <- covmat$n.obs
        have.x <- FALSE
    }
    else if (is.matrix(covmat)) {
        cv <- covmat
        have.x <- FALSE
    }
    else if (is.null(covmat)) {
        if(missing(x)) stop("neither 'x' nor 'covmat' supplied")
        have.x <- TRUE
        if(inherits(x, "formula")) {
            ## this is not a `standard' model-fitting function,
            ## so no need to consider contrasts or levels
            mt <- terms(x, data = data)
            if(attr(mt, "response") > 0)
                stop("response not allowed in formula")
            attr(mt, "intercept") <- 0
            mf <- match.call(expand.dots = FALSE)
            names(mf)[names(mf) == "x"] <- "formula"
            mf$factors <- mf$covmat <- mf$scores <- mf$start <-
                mf$rotation <- mf$control <- mf$... <- NULL
            mf[[1]] <- as.name("model.frame")
            mf <- eval.parent(mf)
            na.act <- attr(mf, "na.action")
            if (.check_vars_numeric(mf))
                stop("factor analysis applies only to numerical variables")
            z <- model.matrix(mt, mf)
        } else {
            z <- as.matrix(x)
            if(!is.numeric(z))
                stop("factor analysis applies only to numerical variables")
            if(!missing(subset)) z <- z[subset, , drop = FALSE]
        }
        covmat <- cov.wt(z)
        cv <- covmat$cov
        n.obs <- covmat$n.obs
    }
    else stop("'covmat' is of unknown type")
    scores <- match.arg(scores)
    if(scores != "none" && !have.x)
        stop("requested scores without an 'x' matrix")
    p <- ncol(cv)
    if(p < 3) stop("factor analysis requires at least three variables")
    dof <- 0.5 * ((p - factors)^2 - p - factors)
    if(dof < 0)
        stop(gettextf("%d factors is too many for %d variables", factors, p),
             domain = NA)
    sds <- sqrt(diag(cv))
    cv <- cv/(sds %o% sds)

    cn <- list(nstart = 1, trace = FALSE, lower = 0.005)
    cn[names(control)] <- control
    more <- list(...)[c("nstart", "trace", "lower", "opt", "rotate")]
    if(length(more)) cn[names(more)] <- more

    if(is.null(start)) {
        start <- (1 - 0.5*factors/p)/diag(solve(cv))
        if((ns <- cn$nstart) > 1)
            start <- cbind(start, matrix(runif(ns-1), p, ns-1, byrow=TRUE))
    }
    start <- as.matrix(start)
    if(nrow(start) != p)
        stop(gettextf("'start' must have %d rows", p), domain = NA)
    nc <- ncol(start)
    if(nc < 1) stop("no starting values supplied")

    best <- Inf
    for (i in 1:nc) {
        nfit <- factanal.fit.mle(cv, factors, start[, i],
                                 max(cn$lower, 0), cn$opt)
        if(cn$trace)
            cat("start", i, "value:", format(nfit$criteria[1]),
                "uniqs:", format(as.vector(round(nfit$uniquenesses, 4))), "\n")
        if(nfit$converged && nfit$criteria[1] < best) {
            fit <- nfit
            best <- fit$criteria[1]
        }
    }
    if(best == Inf) stop("unable to optimize from these starting value(s)")
    load <- fit$loadings
    if(rotation != "none") {
        rot <- do.call(rotation, c(list(load), cn$rotate))
                                        # the following lines modified by J. Fox, 26 June 2005
        if (is.list(rot)){
          load <- rot$loadings
                                        #the following lines changed by Ulrich Keller, 9 Sept 2008          
          fit$rotmat <-
            if(inherits(rot, "GPArotation")) {
              t(solve(rot$Th))
            } else {
              rot$rotmat
            }
                                        #end changes Ulrich Keller, 9 Sept 2008
        }
        else load <- rot
                                        # end modifications J. Fox, 26 June 2005
    }
    fit$loadings <- sortLoadings(load)
    class(fit$loadings) <- "loadings"
    fit$na.action <- na.act # not used currently
    if(have.x && scores != "none") {
        Lambda <- fit$loadings
        zz <- scale(z, TRUE, TRUE)
        switch(scores,
               regression = {
                   sc <- zz %*% solve(cv, Lambda)
                   if(!is.null(Phi <- attr(Lambda, "covariance")))
                       sc <- sc %*% Phi
               },
               Bartlett = {
                   d <- 1/fit$uniquenesses
                   tmp <- t(Lambda * d)
                   sc <- t(solve(tmp %*% Lambda, tmp %*% t(zz)))
               })
        rownames(sc) <- rownames(z)
        colnames(sc) <- colnames(Lambda)
        if(!is.null(na.act)) sc <- napredict(na.act, sc)
        fit$scores <- sc
    }
    if(!is.na(n.obs) && dof > 0) {
        fit$STATISTIC <- (n.obs - 1 - (2 * p + 5)/6 -
                     (2 * factors)/3) * fit$criteria["objective"]
        fit$PVAL <- pchisq(fit$STATISTIC, dof, lower.tail = FALSE)
    }
    fit$n.obs <- n.obs
    fit$call <- cl
    fit
}

factanal.fit.mle <-
    function(cmat, factors, start=NULL, lower = 0.005, control = NULL, ...)
{
    FAout <- function(Psi, S, q)
    {
        sc <- diag(1/sqrt(Psi))
        Sstar <- sc %*% S %*% sc
        E <- eigen(Sstar, symmetric = TRUE)
        L <- E$vectors[, 1:q, drop = FALSE]
        load <- L %*% diag(sqrt(pmax(E$values[1:q] - 1, 0)), q)
        diag(sqrt(Psi)) %*% load
    }
    FAfn <- function(Psi, S, q)
    {
        sc <- diag(1/sqrt(Psi))
        Sstar <- sc %*% S %*% sc
        E <- eigen(Sstar, symmetric = TRUE, only.values = TRUE)
        e <- E$values[-(1:q)]
        e <- sum(log(e) - e) - q + nrow(S)
##        print(round(c(Psi, -e), 5))  # for tracing
        -e
    }
    FAgr <- function(Psi, S, q)
    {
        sc <- diag(1/sqrt(Psi))
        Sstar <- sc %*% S %*% sc
        E <- eigen(Sstar, symmetric = TRUE)
        L <- E$vectors[, 1:q, drop = FALSE]
        load <- L %*% diag(sqrt(pmax(E$values[1:q] - 1, 0)), q)
        load <- diag(sqrt(Psi)) %*% load
        g <- load %*% t(load) + diag(Psi) - S
        diag(g)/Psi^2
    }
    p <- ncol(cmat)
    if(is.null(start))
        start <- (1 - 0.5*factors/p)/diag(solve(cmat))
    res <- optim(start, FAfn, FAgr, method = "L-BFGS-B",
                 lower = lower, upper = 1,
                 control = c(list(fnscale=1,
                 parscale = rep(0.01, length(start))), control),
                 q = factors, S = cmat)
    Lambda <- FAout(res$par, cmat, factors)
    dimnames(Lambda) <- list(dimnames(cmat)[[1]],
                             paste("Factor", 1:factors, sep = ""))
    p <- ncol(cmat)
    dof <- 0.5 * ((p - factors)^2 - p - factors)
    un <- res$par
    names(un) <- colnames(cmat)
    class(Lambda) <- "loadings"
    ans <- list(converged = res$convergence == 0,
                loadings = Lambda, uniquenesses = un,
                correlation = cmat,
                criteria = c(objective = res$value, counts = res$counts),
                factors = factors, dof = dof, method = "mle")
    class(ans) <- "factanal"
    ans
}

print.loadings <- function(x, digits = 3, cutoff = 0.1, sort = FALSE, ...)
{
    Lambda <- unclass(x)
    p <- nrow(Lambda)
    factors <- ncol(Lambda)
    if (sort) {
        mx <- max.col(abs(Lambda))
        ind <- cbind(1:p, mx)
        mx[abs(Lambda[ind]) < 0.5] <- factors + 1
        Lambda <- Lambda[order(mx, 1:p),]
    }
    cat("\nLoadings:\n")
    fx <- format(round(Lambda, digits))
    names(fx) <- NULL
    nc <- nchar(fx[1], type="c")
    fx[abs(Lambda) < cutoff] <- paste(rep(" ", nc), collapse = "")
    print(fx, quote = FALSE, ...)
    vx <- colSums(x^2)
    varex <- rbind("SS loadings" = vx)
    if(is.null(attr(x, "covariance"))) {
        varex <- rbind(varex, "Proportion Var" = vx/p)
        if(factors > 1)
            varex <- rbind(varex, "Cumulative Var" = cumsum(vx/p))
    }
    cat("\n")
    print(round(varex, digits))
    invisible(x)
}

print.factanal <- function(x, digits = 3, ...)
{
    cat("\nCall:\n", deparse(x$call), "\n\n", sep = "")
    cat("Uniquenesses:\n")
    print(round(x$uniquenesses, digits), ...)
    print(x$loadings, digits = digits, ...)
                                        # the following lines added by J. Fox, 26 June 2005
    if (!is.null(x$rotmat)){

      tmat <- solve(x$rotmat)
      R <- tmat %*% t(tmat)
      factors <- x$factors
      rownames(R) <- colnames(R) <- paste("Factor", 1:factors, sep="")

                                        # the following line changed by Ulrich Keller, 9 Sept 2008
      if (TRUE != all.equal(c(R), c(diag(factors)))){
        cat("\nFactor Correlations:\n")
        print(R, digits=digits, ...)
      }


    }
                                        # end additions J. Fox, 23 June 2005
    if(!is.null(x$STATISTIC)) {
        factors <- x$factors
        cat("\nTest of the hypothesis that", factors, if(factors == 1)
            "factor is" else "factors are", "sufficient.\n")
        cat("The chi square statistic is", round(x$STATISTIC, 2), "on", x$dof,
            if(x$dof == 1) "degree" else "degrees",
            "of freedom.\nThe p-value is", signif(x$PVAL, 3), "\n")
    } else {
        cat(paste("\nThe degrees of freedom for the model is",
                  x$dof, "and the fit was", round(x$criteria["objective"], 4),
                  "\n"))
    }
    invisible(x)
}

varimax <- function(x, normalize = TRUE, eps = 1e-5)
{
    nc <- ncol(x)
    if(nc < 2) return(x)
    if(normalize) {
        sc <- sqrt(drop(apply(x, 1, function(x) sum(x^2))))
        x <- x/sc
    }
    p <- nrow(x)
    TT <- diag(nc)
    d <- 0
    for(i in 1:1000) {
        z <- x %*% TT
        B  <- t(x) %*% (z^3 - z %*% diag(drop(rep(1, p) %*% z^2))/p)
        sB <- La.svd(B)
        TT <- sB$u %*% sB$vt
        dpast <- d
        d <- sum(sB$d)
        if(d < dpast * (1 + eps)) break
    }
    z <- x %*% TT
    if(normalize) z <- z * sc
    dimnames(z) <- dimnames(x)
    class(z) <- "loadings"
    list(loadings = z, rotmat = TT)
}

promax <- function(x, m = 4)
{
    if(ncol(x) < 2) return(x)
    dn <- dimnames(x)
    xx <- varimax(x)
    x <- xx$loadings
    Q <- x * abs(x)^(m-1)
    U <- lm.fit(x, Q)$coefficients
    d <- diag(solve(t(U) %*% U))
    U <- U %*% diag(sqrt(d))
    dimnames(U) <- NULL
    z <- x %*% U
    U <- xx$rotmat %*% U
    dimnames(z) <- dn
    class(z) <- "loadings"
    list(loadings = z, rotmat = U)
}

--=-hiYzUeWcRJ/+kx41aPIZ
Content-Disposition: attachment; filename="factanal.Rd"
Content-Type: text/x-matlab; name="factanal.Rd"; charset="utf-8"
Content-Transfer-Encoding: 8bit

% File src/library/stats/man/factanal.Rd
% Part of the R package, http://www.R-project.org
% Copyright 1995-2007 R Core Development Team
% Distributed under GPL 2 or later

\name{factanal}
\alias{factanal}
%\alias{factanal.fit.mle}
\encoding{latin1}
\title{Factor Analysis}
\description{
  Perform maximum-likelihood factor analysis on a covariance matrix or
  data matrix.
}
\usage{
factanal(x, factors, data = NULL, covmat = NULL, n.obs = NA,
         subset, na.action, start = NULL,
         scores = c("none", "regression", "Bartlett"),
         rotation = "varimax", control = NULL, \dots)
}
\arguments{
  \item{x}{A formula or a numeric matrix or an object that can be
    coerced to a numeric matrix.}
  \item{factors}{The number of factors to be fitted.}
  \item{data}{An optional data frame (or similar: see
    \code{\link{model.frame}}), used only if \code{x} is a formula.  By
    default the variables are taken from \code{environment(formula)}.}
  \item{covmat}{A covariance matrix, or a covariance list as returned by
    \code{\link{cov.wt}}.  Of course, correlation matrices are covariance
    matrices.}
  \item{n.obs}{The number of observations, used if \code{covmat} is a
    covariance matrix.}
  \item{subset}{A specification of the cases to be used, if \code{x} is
    used as a matrix or formula.}
  \item{na.action}{The \code{na.action} to be used if \code{x} is
    used as a formula.}
  \item{start}{\code{NULL} or a matrix of starting values, each column
    giving an initial set of uniquenesses.}
  \item{scores}{Type of scores to produce, if any.  The default is none,
    \code{"regression"} gives Thompson's scores, \code{"Bartlett"} given
    Bartlett's weighted least-squares scores. Partial matching allows
    these names to be abbreviated.}
  \item{rotation}{character. \code{"none"} or the name of a function
    to be used to rotate the factors: it will be called with first
    argument the loadings matrix, and should return a list with component
    \code{loadings} giving the rotated loadings, or just the rotated loadings.}
  \item{control}{A list of control values,
    \describe{
      \item{nstart}{The number of starting values to be tried if
	\code{start = NULL}. Default 1.}
      \item{trace}{logical. Output tracing information? Default \code{FALSE}.}
      \item{lower}{The lower bound for uniquenesses during
	optimization. Should be > 0. Default 0.005.}
      \item{opt}{A list of control values to be passed to
	\code{\link{optim}}'s \code{control} argument.}
      \item{rotate}{a list of additional arguments for the rotation function.}
    }
  }
  \item{\dots}{Components of \code{control} can also be supplied as
    named arguments to \code{factanal}.}
}
\details{
  The factor analysis model is
  \deqn{x = \Lambda f + e}{ x = Lambda f + e}
  for a \eqn{p}--element row-vector \eqn{x}, a \eqn{p \times k}{p x k}
  matrix of \emph{loadings}, a \eqn{k}--element vector of \emph{scores}
  and a \eqn{p}--element vector of errors.  None of the components
  other than \eqn{x} is observed, but the major restriction is that the
  scores be uncorrelated and of unit variance, and that the errors be
  independent with variances \eqn{\Phi}{Phi}, the
  \emph{uniquenesses}.  Thus factor analysis is in essence a model for
  the covariance matrix of \eqn{x},
  \deqn{\Sigma = \Lambda^\prime\Lambda + \Psi}{Sigma = Lambda'Lambda + Psi}
  There is still some indeterminacy in the model for it is unchanged
  if \eqn{\Lambda}{Lambda} is replaced by \eqn{G\Lambda}{G Lambda} for
  any orthogonal matrix \eqn{G}.  Such matrices \eqn{G} are known as
  \emph{rotations} (although the term is applied also to non-orthogonal
  invertible matrices).
  
  If \code{covmat} is supplied it is used.  Otherwise \code{x} is used if
  it is a matrix, or a formula \code{x} is used with \code{data} to
  construct a model matrix, and that is used to construct a covariance
  matrix.  (It makes no sense for the formula to have a response,
  and all the variables must be numeric.)  Once a covariance matrix is found or
  calculated from \code{x}, it is converted to a correlation matrix for
  analysis.  The correlation matrix is returned as component
  \code{correlation} of the result.

  The fit is done by optimizing the log likelihood assuming multivariate
  normality over the uniquenesses.  (The maximizing loadings for given
  uniquenesses can be found analytically: Lawley & Maxwell (1971,
  p. 27).)  All the starting values supplied in \code{start} are tried
  in turn and the best fit obtained is used.  If \code{start = NULL}
  then the first fit is started at the value suggested by
  \enc{J?reskog}{Joreskog} (1963) and given by Lawley & Maxwell
  (1971, p. 31), and then \code{control$nstart - 1} other values are
  tried, randomly selected as equal values of the uniquenesses.

  The uniquenesses are technically constrained to lie in \eqn{[0, 1]},
  but near-zero values are problematical, and the optimization is
  done with a lower bound of \code{control$lower}, default 0.005
  (Lawley & Maxwell, 1971, p. 32).

  Scores can only be produced if a data matrix is supplied and used.
  The first method is the regression method of Thomson (1951), the
  second the weighted least squares method of Bartlett (1937, 8).
  Both are estimates of the unobserved scores \eqn{f}.  Thomson's method
  regresses (in the population) the unknown \eqn{f} on \eqn{x} to yield
  \deqn{\hat f = \Lambda^\prime \Sigma^{-1} x}{hat f = Lambda' Sigma^-1 x}
  and then substitutes the sample estimates of the quantities on the
  right-hand side.  Bartlett's method minimizes the sum of squares of
  standardized errors over the choice of \eqn{f}, given (the fitted)
  \eqn{\Lambda}{Lambda}.

  If \code{x} is a formula then the standard NA-handling is applied to
  the scores (if requested): see \code{\link{napredict}}.
}
\value{
  An object of class \code{"factanal"} with components
  \item{loadings}{A matrix of loadings, one column for each factor.  The
    factors are ordered in decreasing order of sums of squares of
    loadings, and given the sign that will make the sum of the loadings
    positive.}
  \item{uniquenesses}{The uniquenesses computed.}
  \item{correlation}{The correlation matrix used.}
  \item{criteria}{The results of the optimization: the value of the
    negative log-likelihood and information on the iterations used.}
  \item{factors}{The argument \code{factors}.}
  \item{dof}{The number of degrees of freedom of the factor analysis model.}
  \item{method}{The method: always \code{"mle"}.}
  %Modification by Ulrich Keller, Sept 9 2008
  \item{rotmat}{The rotation matrix if relevant.}
  %End modicication by Ulrich Keller, Sept 9 2008
  \item{scores}{If requested, a matrix of scores.  \code{napredict} is
    applied to handle the treatment of values omitted by the \code{na.action}.}
  \item{n.obs}{The number of observations if available, or \code{NA}.}
  \item{call}{The matched call.}
  \item{na.action}{If relevant.}
  \item{STATISTIC, PVAL}{The significance-test statistic and P value, if
    if can be computed.}
}

\note{
  There are so many variations on factor analysis that it is hard to
  compare output from different programs.  Further, the optimization in
  maximum likelihood factor analysis is hard, and many other examples we
  compared had less good fits than produced by this function.  In
  particular, solutions which are Heywood cases (with one or more
  uniquenesses essentially zero) are much often common than most texts
  and some other programs would lead one to believe.
}

\references{
  Bartlett, M. S. (1937) The statistical conception of mental factors.
  \emph{British Journal of Psychology}, \bold{28}, 97--104.

  Bartlett, M. S. (1938) Methods of estimating mental
  factors. \emph{Nature}, \bold{141}, 609--610.
  
  \enc{J?reskog}{Joreskog}, K. G. (1963)
  \emph{Statistical Estimation in Factor Analysis.}  Almqvist and Wicksell.
  
  Lawley, D. N. and Maxwell, A. E. (1971) \emph{Factor Analysis as a
    Statistical Method.} Second edition. Butterworths.

  Thomson, G. H. (1951) \emph{The Factorial Analysis of Human Ability.}
  London University Press.
}

\seealso{
  \code{\link{print.loadings}},
  \code{\link{varimax}}, \code{\link{princomp}},
  \code{\link[datasets]{ability.cov}}, \code{\link[datasets]{Harman23.cor}},
  \code{\link[datasets]{Harman74.cor}}
}

\examples{
# A little demonstration, v2 is just v1 with noise,
# and same for v4 vs. v3 and v6 vs. v5
# Last four cases are there to add noise
# and introduce a positive manifold (g factor)
v1 <- c(1,1,1,1,1,1,1,1,1,1,3,3,3,3,3,4,5,6)
v2 <- c(1,2,1,1,1,1,2,1,2,1,3,4,3,3,3,4,6,5)
v3 <- c(3,3,3,3,3,1,1,1,1,1,1,1,1,1,1,5,4,6)
v4 <- c(3,3,4,3,3,1,1,2,1,1,1,1,2,1,1,5,6,4)
v5 <- c(1,1,1,1,1,3,3,3,3,3,1,1,1,1,1,6,4,5)
v6 <- c(1,1,1,2,1,3,3,3,4,3,1,1,1,2,1,6,5,4)
m1 <- cbind(v1,v2,v3,v4,v5,v6)
cor(m1)
factanal(m1, factors=3) # varimax is the default
factanal(m1, factors=3, rotation="promax")
# The following shows the g factor as PC1
prcomp(m1)

## formula interface
factanal(~v1+v2+v3+v4+v5+v6, factors = 3,
         scores = "Bartlett")$scores

## a realistic example from Barthlomew (1987, pp. 61-65)
utils::example(ability.cov)
}
\keyword{multivariate}

--=-hiYzUeWcRJ/+kx41aPIZ--


From jmc at r-project.org  Tue Sep  9 16:10:36 2008
From: jmc at r-project.org (John Chambers)
Date: Tue, 09 Sep 2008 10:10:36 -0400
Subject: [Rd] 'xtfrm' performance (influences 'order' performance) in R
 devel
In-Reply-To: <1A68FCB28DE72F4BA3B967E6506CCE4303049734@mildnpexmb01.maninvestments.ad.man.com>
References: <1A68FCB28DE72F4BA3B967E6506CCE4303049734@mildnpexmb01.maninvestments.ad.man.com>
Message-ID: <48C683DC.1060707@r-project.org>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20080909/e4797332/attachment.pl>

From osklyar at maninvestments.com  Tue Sep  9 16:40:40 2008
From: osklyar at maninvestments.com (Sklyar, Oleg (London))
Date: Tue, 9 Sep 2008 15:40:40 +0100
Subject: [Rd] 'xtfrm' performance (influences 'order' performance) in R
 devel
In-Reply-To: <48C683DC.1060707@r-project.org>
References: <1A68FCB28DE72F4BA3B967E6506CCE4303049734@mildnpexmb01.maninvestments.ad.man.com>
	<48C683DC.1060707@r-project.org>
Message-ID: <1A68FCB28DE72F4BA3B967E6506CCE4303049736@mildnpexmb01.maninvestments.ad.man.com>

Thanks for a quick reply, I was thinking of [ methods myself, but there
are so many of them. I only tested [(x=TimeDate,i=TimeDate,j=missing),
which is a completely non-standard one. It did not seem to have any
effect though. 

I was thinking of writing the 'order' method and will experiment with
getting the one for xtfrm. However, it seems reasonable for the default
xtfrm to check if the object is inherited from a vector and in that case
simply returning the .Data slot? This would solve this and similar cases
immediately:

if (inherits(x,"vector")) return(as.vector(x at .Data))

BTW, generally, xtfrm.default calls 'rank' and it is not clear why rank
should work for a generic S4 object... this is essentially where the
problem is.


On a side note, a week ago I submitted a patch for the plot.default to
Rd, but nobody reacted (I checked the most recent patched and devel as
well) -- it is really an ugly bug (e.g
plot(1:5,1:5,xlim=c(-10,10),ylim=c(-8,3))  ) and the trivial patch fixes
it. Would be grateful if somebody from R-core checks it up. Meanwhile I
patch the graphics library before compiling R, which is not the best
solution. Here is the patch for src/library/graphics/plot.R

70,71c70,71
<       localAxis(if(is.null(y)) xy$x else x, side = 1, ...)
<       localAxis(if(is.null(y))  x   else y, side = 2, ...)
---
>         localAxis(xlim, side = 1, ...)
>         localAxis(ylim, side = 2, ...)


Dr Oleg Sklyar
Research Technologist
AHL / Man Investments Ltd
+44 (0)20 7144 3107
osklyar at maninvestments.com 

> -----Original Message-----
> From: John Chambers [mailto:jmc at r-project.org] 
> Sent: 09 September 2008 15:11
> To: Sklyar, Oleg (London)
> Cc: R-devel at r-project.org
> Subject: Re: [Rd] 'xtfrm' performance (influences 'order' 
> performance) in R devel
> 
> No definitive answers, but here are a few observations.
> 
> In the call to order() code, I notice that you have dropped 
> into the branch
>     if (any(unlist(lapply(z, is.object))))
> where the alternative in your case would seem to have been 
> going directly to the internal code.
> 
> You can consider a method for xtfrm(), which would help but 
> won't get you completely back to a trivial computation.  
> Alternatively,  order() should be eligible for the new 
> mechanism of defining methods for "...".
> 
> (Individual existing methods may not be the issue, and one 
> can't infer anything definite from the evidence given,  but a 
> plausible culprit is the "[" method.  Because [] expressions 
> appear so often, it's always chancy to define a nontrivial 
> method for this function.)
> 
> John
> 
> Sklyar, Oleg (London) wrote: 
> 
> 	Hello everybody,
> 	
> 	it looks like the presense of some (do know know which) 
> S4 methods for a
> 	given S4 class degrades the performance of xtfrm (used 
> in 'order' in new
> 	R-devel) by a factor of millions. This is for classes 
> that ARE derived
> 	from numeric directly and thus should be quite trivial 
> to convert to
> 	numeric.
> 	
> 	Consider the following example:
> 	
> 	setClass("TimeDateBase", 
> 	    representation("numeric", mode="character"),
> 	    prototype(mode="posix")
> 	)
> 	setClass("TimeDate",
> 	    representation("TimeDateBase", tzone="character"),
> 	    prototype(tzone="London")
> 	)
> 	x = new("TimeDate", 1220966224 + runif(1e5))
> 	
> 	system.time({ z = order(x) })
> 	## > system.time({ z = order(x) })
> 	##   user  system elapsed 
> 	##  0.048   0.000   0.048 
> 	
> 	getClass("TimeDate")
> 	## Class "TimeDate"
> 	
> 	## Slots:
> 	                                    
> 	## Name:      .Data     tzone      mode
> 	## Class:   numeric character character
> 	
> 	## Extends: 
> 	## Class "TimeDateBase", directly
> 	## Class "numeric", by class "TimeDateBase", distance 2
> 	## Class "vector", by class "TimeDateBase", distance 3
> 	
> 	
> 	Now, if I load a library that not only defines these 
> same classes, but
> 	also a bunch of methods for those, then I have the 
> following result:
> 	
> 	library(AHLCalendar)
> 	x = now() + runif(1e5) ## just random times in POSIXct format
> 	x[1:5]
> 	## TimeDate [posix] object in 'Europe/London' of length 5:
> 	## [1] "2008-09-09 14:19:35.218" "2008-09-09 14:19:35.672"
> 	## [3] "2008-09-09 14:19:35.515" "2008-09-09 14:19:35.721"
> 	## [5] "2008-09-09 14:19:35.657"
> 	
> 	  
> 
> 		system.time({ z = order(x) })
> 		    
> 
> 	
> 	
> 	Enter a frame number, or 0 to exit   
> 	
> 	 1: system.time({
> 	 2: order(x)
> 	 3: lapply(z, function(x) if (is.object(x)) xtfrm(x) else x)
> 	 4: FUN(X[[1]], ...)
> 	 5: xtfrm(x)
> 	 6: xtfrm.default(x)
> 	 7: as.vector(rank(x, ties.method = "min", na.last = "keep"))
> 	 8: rank(x, ties.method = "min", na.last = "keep")
> 	 9: switch(ties.method, average = , min = , max =
> 	.Internal(rank(x[!nas], ties.
> 	10: .gt(c(1220966375.21811, 1220966375.67217, 1220966375.51470,
> 	1220966375.7211
> 	11: x[j]
> 	12: x[j]
> 	
> 	Selection: 0
> 	Timing stopped at: 47.618 13.791 66.478 
> 	
> 	At the same time:
> 	
> 	system.time({ z = as.numeric(x) }) ## same as x at .Data
> 	##   user  system elapsed 
> 	##  0.001   0.000   0.001 
> 	
> 	The only difference between the two is that I have the 
> following methods
> 	defined for TimeDate (full listing below). 
> 	
> 	Any idea why this could be happenning. And yes, it is 
> down to xtfrm
> 	function, 'order' was just a place where the problem 
> occured. Should
> 	xtfrm function be smarter with respect to classes that 
> are actually
> 	derived from 'numeric'?
> 	
> 	  
> 
> 		showMethods(class="TimeDate")
> 		    
> 
> 	Function: + (package base)
> 	e1="TimeDate", e2="TimeDate"
> 	e1="TimeDate", e2="numeric"
> 	    (inherited from: e1="TimeDateBase", e2="numeric")
> 	
> 	Function: - (package base)
> 	e1="TimeDate", e2="TimeDate"
> 	
> 	Function: Time (package AHLCalendar)
> 	x="TimeDate"
> 	
> 	Function: TimeDate (package AHLCalendar)
> 	x="TimeDate"
> 	
> 	Function: TimeDate<- (package AHLCalendar)
> 	x="TimeSeries", value="TimeDate"
> 	
> 	Function: TimeSeries (package AHLCalendar)
> 	x="data.frame", ts="TimeDate"
> 	x="matrix", ts="TimeDate"
> 	x="numeric", ts="TimeDate"
> 	
> 	Function: [ (package base)
> 	x="TimeDate", i="POSIXt", j="missing"
> 	x="TimeDate", i="Time", j="missing"
> 	x="TimeDate", i="TimeDate", j="missing"
> 	x="TimeDate", i="integer", j="missing"
> 	    (inherited from: x="TimeDateBase", i="ANY", j="missing")
> 	x="TimeDate", i="logical", j="missing"
> 	    (inherited from: x="TimeDateBase", i="ANY", j="missing")
> 	x="TimeSeries", i="TimeDate", j="missing"
> 	x="TimeSeries", i="TimeDate", j="vector"
> 	
> 	Function: [<- (package base)
> 	x="TimeDate", i="ANY", j="ANY", value="ANY"
> 	x="TimeDate", i="ANY", j="ANY", value="numeric"
> 	x="TimeDate", i="missing", j="ANY", value="ANY"
> 	x="TimeDate", i="missing", j="ANY", value="numeric"
> 	
> 	Function: add (package AHLCalendar)
> 	x="TimeDate"
> 	
> 	Function: addMonths (package AHLCalendar)
> 	x="TimeDate"
> 	
> 	Function: addYears (package AHLCalendar)
> 	x="TimeDate"
> 	
> 	Function: align (package AHLCalendar)
> 	x="TimeDate", to="character"
> 	x="TimeDate", to="missing"
> 	
> 	Function: as.POSIXct (package base)
> 	x="TimeDate"
> 	
> 	Function: as.POSIXlt (package base)
> 	x="TimeDate"
> 	
> 	Function: coerce (package methods)
> 	from="TimeDate", to="TimeDateBase"
> 	
> 	Function: coerce<- (package methods)
> 	from="TimeDate", to="numeric"
> 	
> 	Function: dates (package AHLCalendar)
> 	x="TimeDate"
> 	
> 	Function: format (package base)
> 	x="TimeDate"
> 	
> 	Function: fxFwdDate (package AHLCalendar)
> 	x="TimeDate", country="character"
> 	
> 	Function: fxSettleDate (package AHLCalendar)
> 	x="TimeDate", country="character"
> 	
> 	Function: holidays (package AHLCalendar)
> 	x="TimeDate"
> 	
> 	Function: index (package AHLCalendar)
> 	x="TimeDate", y="POSIXt"
> 	x="TimeDate", y="Time"
> 	x="TimeDate", y="TimeDate"
> 	
> 	Function: initialize (package methods)
> 	.Object="TimeDate"
> 	    (inherited from: .Object="ANY")
> 	
> 	Function: leapYear (package AHLCalendar)
> 	x="TimeDate"
> 	
> 	Function: mday (package AHLCalendar)
> 	x="TimeDate"
> 	
> 	Function: mode (package base)
> 	x="TimeDate"
> 	    (inherited from: x="TimeDateBase")
> 	
> 	Function: mode<- (package base)
> 	x="TimeDate", value="character"
> 	    (inherited from: x="TimeDateBase", value="character")
> 	
> 	Function: month (package AHLCalendar)
> 	x="TimeDate"
> 	
> 	Function: pretty (package base)
> 	x="TimeDate"
> 	
> 	Function: prettyFormat (package AHLCalendar)
> 	x="TimeDate", munit="character"
> 	x="TimeDate", munit="missing"
> 	
> 	Function: print (package base)
> 	x="TimeDate"
> 	
> 	Function: show (package methods)
> 	object="TimeDate"
> 	    (inherited from: object="TimeDateBase")
> 	
> 	Function: summary (package base)
> 	object="TimeDate"
> 	
> 	Function: td2tz (package AHLCalendar)
> 	x="TimeDate"
> 	
> 	Function: times (package AHLCalendar)
> 	x="TimeDate"
> 	
> 	Function: tojulian (package AHLCalendar)
> 	x="TimeDate"
> 	
> 	Function: toposix (package AHLCalendar)
> 	x="TimeDate"
> 	
> 	Function: tots (package AHLCalendar)
> 	x="TimeDate"
> 	
> 	Function: tzone (package AHLCalendar)
> 	x="TimeDate"
> 	
> 	Function: tzone<- (package AHLCalendar)
> 	x="TimeDate"
> 	
> 	Function: wday (package AHLCalendar)
> 	x="TimeDate"
> 	
> 	Function: yday (package AHLCalendar)
> 	x="TimeDate"
> 	
> 	Function: year (package AHLCalendar)
> 	x="TimeDate"
> 	
> 	
> 	
> 	Dr Oleg Sklyar
> 	Research Technologist
> 	AHL / Man Investments Ltd
> 	+44 (0)20 7144 3107
> 	osklyar at maninvestments.com
> 	
> 	
> 	
> **********************************************************************
> 	The contents of this email are for the named 
> addressee(s...{{dropped:22}}
> 	
> 	______________________________________________
> 	R-devel at r-project.org mailing list
> 	https://stat.ethz.ch/mailman/listinfo/r-devel
> 	
> 	  
> 
> 


**********************************************************************
The contents of this email are for the named addressee(s...{{dropped:22}}


From osklyar at maninvestments.com  Tue Sep  9 16:48:34 2008
From: osklyar at maninvestments.com (Sklyar, Oleg (London))
Date: Tue, 9 Sep 2008 15:48:34 +0100
Subject: [Rd] 'xtfrm' performance (influences 'order' performance) in R
 devel
In-Reply-To: <48C683DC.1060707@r-project.org>
References: <1A68FCB28DE72F4BA3B967E6506CCE4303049734@mildnpexmb01.maninvestments.ad.man.com>
	<48C683DC.1060707@r-project.org>
Message-ID: <1A68FCB28DE72F4BA3B967E6506CCE4303049737@mildnpexmb01.maninvestments.ad.man.com>

Ha, defined xtfrm for TimeDate, works instantly (xtfrm is already a
method). However, it won't be taken up by order as it is not in the
imported namespace, so order falls back to xtfrm.default.

Moreover, defining order (which is not a method unfortunately, *any
chance of changing this*?):

setGeneric("order")
setMethod("order", "TimeDate", 
	function (..., na.last = TRUE, decreasing = FALSE) 
		order(list(...)[[1]]@.Data,na.last=na.last,
decreasing=decreasing))

does not help either as it won't be taken up, order still calls the
default one, what am I doing wrong?



Dr Oleg Sklyar
Research Technologist
AHL / Man Investments Ltd
+44 (0)20 7144 3107
osklyar at maninvestments.com 

> -----Original Message-----
> From: John Chambers [mailto:jmc at r-project.org] 
> Sent: 09 September 2008 15:11
> To: Sklyar, Oleg (London)
> Cc: R-devel at r-project.org
> Subject: Re: [Rd] 'xtfrm' performance (influences 'order' 
> performance) in R devel
> 
> No definitive answers, but here are a few observations.
> 
> In the call to order() code, I notice that you have dropped 
> into the branch
>     if (any(unlist(lapply(z, is.object))))
> where the alternative in your case would seem to have been 
> going directly to the internal code.
> 
> You can consider a method for xtfrm(), which would help but 
> won't get you completely back to a trivial computation.  
> Alternatively,  order() should be eligible for the new 
> mechanism of defining methods for "...".
> 
> (Individual existing methods may not be the issue, and one 
> can't infer anything definite from the evidence given,  but a 
> plausible culprit is the "[" method.  Because [] expressions 
> appear so often, it's always chancy to define a nontrivial 
> method for this function.)
> 
> John
> 
> Sklyar, Oleg (London) wrote: 
> 
> 	Hello everybody,
> 	
> 	it looks like the presense of some (do know know which) 
> S4 methods for a
> 	given S4 class degrades the performance of xtfrm (used 
> in 'order' in new
> 	R-devel) by a factor of millions. This is for classes 
> that ARE derived
> 	from numeric directly and thus should be quite trivial 
> to convert to
> 	numeric.
> 	
> 	Consider the following example:
> 	
> 	setClass("TimeDateBase", 
> 	    representation("numeric", mode="character"),
> 	    prototype(mode="posix")
> 	)
> 	setClass("TimeDate",
> 	    representation("TimeDateBase", tzone="character"),
> 	    prototype(tzone="London")
> 	)
> 	x = new("TimeDate", 1220966224 + runif(1e5))
> 	
> 	system.time({ z = order(x) })
> 	## > system.time({ z = order(x) })
> 	##   user  system elapsed 
> 	##  0.048   0.000   0.048 
> 	
> 	getClass("TimeDate")
> 	## Class "TimeDate"
> 	
> 	## Slots:
> 	                                    
> 	## Name:      .Data     tzone      mode
> 	## Class:   numeric character character
> 	
> 	## Extends: 
> 	## Class "TimeDateBase", directly
> 	## Class "numeric", by class "TimeDateBase", distance 2
> 	## Class "vector", by class "TimeDateBase", distance 3
> 	
> 	
> 	Now, if I load a library that not only defines these 
> same classes, but
> 	also a bunch of methods for those, then I have the 
> following result:
> 	
> 	library(AHLCalendar)
> 	x = now() + runif(1e5) ## just random times in POSIXct format
> 	x[1:5]
> 	## TimeDate [posix] object in 'Europe/London' of length 5:
> 	## [1] "2008-09-09 14:19:35.218" "2008-09-09 14:19:35.672"
> 	## [3] "2008-09-09 14:19:35.515" "2008-09-09 14:19:35.721"
> 	## [5] "2008-09-09 14:19:35.657"
> 	
> 	  
> 
> 		system.time({ z = order(x) })
> 		    
> 
> 	
> 	
> 	Enter a frame number, or 0 to exit   
> 	
> 	 1: system.time({
> 	 2: order(x)
> 	 3: lapply(z, function(x) if (is.object(x)) xtfrm(x) else x)
> 	 4: FUN(X[[1]], ...)
> 	 5: xtfrm(x)
> 	 6: xtfrm.default(x)
> 	 7: as.vector(rank(x, ties.method = "min", na.last = "keep"))
> 	 8: rank(x, ties.method = "min", na.last = "keep")
> 	 9: switch(ties.method, average = , min = , max =
> 	.Internal(rank(x[!nas], ties.
> 	10: .gt(c(1220966375.21811, 1220966375.67217, 1220966375.51470,
> 	1220966375.7211
> 	11: x[j]
> 	12: x[j]
> 	
> 	Selection: 0
> 	Timing stopped at: 47.618 13.791 66.478 
> 	
> 	At the same time:
> 	
> 	system.time({ z = as.numeric(x) }) ## same as x at .Data
> 	##   user  system elapsed 
> 	##  0.001   0.000   0.001 
> 	
> 	The only difference between the two is that I have the 
> following methods
> 	defined for TimeDate (full listing below). 
> 	
> 	Any idea why this could be happenning. And yes, it is 
> down to xtfrm
> 	function, 'order' was just a place where the problem 
> occured. Should
> 	xtfrm function be smarter with respect to classes that 
> are actually
> 	derived from 'numeric'?
> 	
> 	  
> 
> 		showMethods(class="TimeDate")
> 		    
> 
> 	Function: + (package base)
> 	e1="TimeDate", e2="TimeDate"
> 	e1="TimeDate", e2="numeric"
> 	    (inherited from: e1="TimeDateBase", e2="numeric")
> 	
> 	Function: - (package base)
> 	e1="TimeDate", e2="TimeDate"
> 	
> 	Function: Time (package AHLCalendar)
> 	x="TimeDate"
> 	
> 	Function: TimeDate (package AHLCalendar)
> 	x="TimeDate"
> 	
> 	Function: TimeDate<- (package AHLCalendar)
> 	x="TimeSeries", value="TimeDate"
> 	
> 	Function: TimeSeries (package AHLCalendar)
> 	x="data.frame", ts="TimeDate"
> 	x="matrix", ts="TimeDate"
> 	x="numeric", ts="TimeDate"
> 	
> 	Function: [ (package base)
> 	x="TimeDate", i="POSIXt", j="missing"
> 	x="TimeDate", i="Time", j="missing"
> 	x="TimeDate", i="TimeDate", j="missing"
> 	x="TimeDate", i="integer", j="missing"
> 	    (inherited from: x="TimeDateBase", i="ANY", j="missing")
> 	x="TimeDate", i="logical", j="missing"
> 	    (inherited from: x="TimeDateBase", i="ANY", j="missing")
> 	x="TimeSeries", i="TimeDate", j="missing"
> 	x="TimeSeries", i="TimeDate", j="vector"
> 	
> 	Function: [<- (package base)
> 	x="TimeDate", i="ANY", j="ANY", value="ANY"
> 	x="TimeDate", i="ANY", j="ANY", value="numeric"
> 	x="TimeDate", i="missing", j="ANY", value="ANY"
> 	x="TimeDate", i="missing", j="ANY", value="numeric"
> 	
> 	Function: add (package AHLCalendar)
> 	x="TimeDate"
> 	
> 	Function: addMonths (package AHLCalendar)
> 	x="TimeDate"
> 	
> 	Function: addYears (package AHLCalendar)
> 	x="TimeDate"
> 	
> 	Function: align (package AHLCalendar)
> 	x="TimeDate", to="character"
> 	x="TimeDate", to="missing"
> 	
> 	Function: as.POSIXct (package base)
> 	x="TimeDate"
> 	
> 	Function: as.POSIXlt (package base)
> 	x="TimeDate"
> 	
> 	Function: coerce (package methods)
> 	from="TimeDate", to="TimeDateBase"
> 	
> 	Function: coerce<- (package methods)
> 	from="TimeDate", to="numeric"
> 	
> 	Function: dates (package AHLCalendar)
> 	x="TimeDate"
> 	
> 	Function: format (package base)
> 	x="TimeDate"
> 	
> 	Function: fxFwdDate (package AHLCalendar)
> 	x="TimeDate", country="character"
> 	
> 	Function: fxSettleDate (package AHLCalendar)
> 	x="TimeDate", country="character"
> 	
> 	Function: holidays (package AHLCalendar)
> 	x="TimeDate"
> 	
> 	Function: index (package AHLCalendar)
> 	x="TimeDate", y="POSIXt"
> 	x="TimeDate", y="Time"
> 	x="TimeDate", y="TimeDate"
> 	
> 	Function: initialize (package methods)
> 	.Object="TimeDate"
> 	    (inherited from: .Object="ANY")
> 	
> 	Function: leapYear (package AHLCalendar)
> 	x="TimeDate"
> 	
> 	Function: mday (package AHLCalendar)
> 	x="TimeDate"
> 	
> 	Function: mode (package base)
> 	x="TimeDate"
> 	    (inherited from: x="TimeDateBase")
> 	
> 	Function: mode<- (package base)
> 	x="TimeDate", value="character"
> 	    (inherited from: x="TimeDateBase", value="character")
> 	
> 	Function: month (package AHLCalendar)
> 	x="TimeDate"
> 	
> 	Function: pretty (package base)
> 	x="TimeDate"
> 	
> 	Function: prettyFormat (package AHLCalendar)
> 	x="TimeDate", munit="character"
> 	x="TimeDate", munit="missing"
> 	
> 	Function: print (package base)
> 	x="TimeDate"
> 	
> 	Function: show (package methods)
> 	object="TimeDate"
> 	    (inherited from: object="TimeDateBase")
> 	
> 	Function: summary (package base)
> 	object="TimeDate"
> 	
> 	Function: td2tz (package AHLCalendar)
> 	x="TimeDate"
> 	
> 	Function: times (package AHLCalendar)
> 	x="TimeDate"
> 	
> 	Function: tojulian (package AHLCalendar)
> 	x="TimeDate"
> 	
> 	Function: toposix (package AHLCalendar)
> 	x="TimeDate"
> 	
> 	Function: tots (package AHLCalendar)
> 	x="TimeDate"
> 	
> 	Function: tzone (package AHLCalendar)
> 	x="TimeDate"
> 	
> 	Function: tzone<- (package AHLCalendar)
> 	x="TimeDate"
> 	
> 	Function: wday (package AHLCalendar)
> 	x="TimeDate"
> 	
> 	Function: yday (package AHLCalendar)
> 	x="TimeDate"
> 	
> 	Function: year (package AHLCalendar)
> 	x="TimeDate"
> 	
> 	
> 	
> 	Dr Oleg Sklyar
> 	Research Technologist
> 	AHL / Man Investments Ltd
> 	+44 (0)20 7144 3107
> 	osklyar at maninvestments.com
> 	
> 	
> 	
> **********************************************************************
> 	The contents of this email are for the named 
> addressee(s...{{dropped:22}}
> 	
> 	______________________________________________
> 	R-devel at r-project.org mailing list
> 	https://stat.ethz.ch/mailman/listinfo/r-devel
> 	
> 	  
> 
> 


**********************************************************************
The contents of this email are for the named addressee(s...{{dropped:22}}


From jfox at mcmaster.ca  Tue Sep  9 16:53:30 2008
From: jfox at mcmaster.ca (John Fox)
Date: Tue, 9 Sep 2008 10:53:30 -0400
Subject: [Rd] Addendum to wishlist bug report #10931 (factanal)
	(PR#12754)
In-Reply-To: <20080909115511.4FF112834169@mail.pubhealth.ku.dk>
References: <20080909115511.4FF112834169@mail.pubhealth.ku.dk>
Message-ID: <000a01c9128b$d31dcef0$79596cd0$@ca>

Dear Ulrich,

I'd frankly forgotten about this, but can't see an argument for not making
this (or a similar) change. 

Thanks for reviving the issue.

John

------------------------------
John Fox, Professor
Department of Sociology
McMaster University
Hamilton, Ontario, Canada
web: socserv.mcmaster.ca/jfox


> -----Original Message-----
> From: r-devel-bounces at r-project.org [mailto:r-devel-bounces at r-project.org]
On
> Behalf Of ulrich.keller at uni.lu
> Sent: September-09-08 7:55 AM
> To: r-devel at stat.math.ethz.ch
> Cc: R-bugs at r-project.org
> Subject: [Rd] Addendum to wishlist bug report #10931 (factanal) (PR#12754)
> 
> --=-hiYzUeWcRJ/+kx41aPIZ
> Content-Type: text/plain; charset="UTF-8"
> Content-Transfer-Encoding: 8bit
> 
> Hi,
> 
> on March 10 I filed a wishlist bug report asking for the inclusion of
> some changes to factanal() and the associated print method. The changes
> were originally proposed by John Fox in 2005; they make print.factanal()
> display factor correlations if factanal() is called with rotation =
> "promax". Since I got no replies, and I am really tired of my R-curious
> social science colleagues asking "What, it can't even display factor
> correlations?!", I made the changes myself. I would be very grateful if
> they'd find their way into a release.
> 
> I corrected a small error in John Fox's code and made another change
> that enables factor correlations not only for promax, but also for the
> rotation methods in package GPArotation.
> 
> The changes are against R-devel, downloaded on September 9th 2008.
> Changes are indicated by comments from John Fox and me. I also changed
> factanal.Rd accordingly, this is commented too.
> 
> My bug report is at
> http://bugs.r-project.org/cgi-bin/R/wishlist?id=10931;user=guest
> 
> John Fox's original post is at
> http://tolstoy.newcastle.edu.au/R/devel/05/06/1414.html
> 
> The changed files factanal.R and factanal.Rd are attached. If there is
> anything else I can do to help these changes make it into R, please let
> me know.
> 
> Thanks and best regards,
> 
> Uli
> 
> --
> Ulrich Keller
> Universit?? du Luxembourg
> EMACS research unit
> B.P. 2
> L-7201 Walferdange
> Luxembourg
> Mail ulrich.keller at uni.lu
> Phone +352 46 66 44 9 278
> 
> --=-hiYzUeWcRJ/+kx41aPIZ
> Content-Disposition: attachment; filename="factanal.R"
> Content-Type: text/plain; name="factanal.R"; charset="utf-8"
> Content-Transfer-Encoding: 7bit
> 
> #  File src/library/stats/R/factanal.R
> #  Part of the R package, http://www.R-project.org
> #
> #  This program is free software; you can redistribute it and/or modify
> #  it under the terms of the GNU General Public License as published by
> #  the Free Software Foundation; either version 2 of the License, or
> #  (at your option) any later version.
> #
> #  This program is distributed in the hope that it will be useful,
> #  but WITHOUT ANY WARRANTY; without even the implied warranty of
> #  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
> #  GNU General Public License for more details.
> #
> #  A copy of the GNU General Public License is available at
> #  http://www.r-project.org/Licenses/
> 
> ## Hmm, MM thinks diag(.) needs checking { diag(vec) when length(vec)==1
!}
> ## However, MM does not understand that factor analysis
> ##   is a *multi*variate technique!
> factanal <-
>     function (x, factors, data = NULL, covmat = NULL, n.obs = NA,
>               subset, na.action, start = NULL,
>               scores = c("none", "regression", "Bartlett"),
>               rotation = "varimax",
>               control = NULL, ...)
> {
>     sortLoadings <- function(Lambda)
>     {
>         cn <- colnames(Lambda)
>         Phi <- attr(Lambda, "covariance")
>         ssq <- apply(Lambda, 2, function(x) -sum(x^2))
>         Lambda <- Lambda[, order(ssq), drop = FALSE]
>         colnames(Lambda) <- cn
>         neg <- colSums(Lambda) < 0
>         Lambda[, neg] <- -Lambda[, neg]
>         if(!is.null(Phi)) {
>             unit <- ifelse(neg, -1, 1)
>             attr(Lambda, "covariance") <-
>                 unit %*% Phi[order(ssq), order(ssq)] %*% unit
>         }
>         Lambda
>     }
>     cl <- match.call()
>     na.act <- NULL
>     if (is.list(covmat)) {
>         if (any(is.na(match(c("cov", "n.obs"), names(covmat)))))
>             stop("'covmat' is not a valid covariance list")
>         cv <- covmat$cov
>         n.obs <- covmat$n.obs
>         have.x <- FALSE
>     }
>     else if (is.matrix(covmat)) {
>         cv <- covmat
>         have.x <- FALSE
>     }
>     else if (is.null(covmat)) {
>         if(missing(x)) stop("neither 'x' nor 'covmat' supplied")
>         have.x <- TRUE
>         if(inherits(x, "formula")) {
>             ## this is not a `standard' model-fitting function,
>             ## so no need to consider contrasts or levels
>             mt <- terms(x, data = data)
>             if(attr(mt, "response") > 0)
>                 stop("response not allowed in formula")
>             attr(mt, "intercept") <- 0
>             mf <- match.call(expand.dots = FALSE)
>             names(mf)[names(mf) == "x"] <- "formula"
>             mf$factors <- mf$covmat <- mf$scores <- mf$start <-
>                 mf$rotation <- mf$control <- mf$... <- NULL
>             mf[[1]] <- as.name("model.frame")
>             mf <- eval.parent(mf)
>             na.act <- attr(mf, "na.action")
>             if (.check_vars_numeric(mf))
>                 stop("factor analysis applies only to numerical
variables")
>             z <- model.matrix(mt, mf)
>         } else {
>             z <- as.matrix(x)
>             if(!is.numeric(z))
>                 stop("factor analysis applies only to numerical
variables")
>             if(!missing(subset)) z <- z[subset, , drop = FALSE]
>         }
>         covmat <- cov.wt(z)
>         cv <- covmat$cov
>         n.obs <- covmat$n.obs
>     }
>     else stop("'covmat' is of unknown type")
>     scores <- match.arg(scores)
>     if(scores != "none" && !have.x)
>         stop("requested scores without an 'x' matrix")
>     p <- ncol(cv)
>     if(p < 3) stop("factor analysis requires at least three variables")
>     dof <- 0.5 * ((p - factors)^2 - p - factors)
>     if(dof < 0)
>         stop(gettextf("%d factors is too many for %d variables", factors,
p),
>              domain = NA)
>     sds <- sqrt(diag(cv))
>     cv <- cv/(sds %o% sds)
> 
>     cn <- list(nstart = 1, trace = FALSE, lower = 0.005)
>     cn[names(control)] <- control
>     more <- list(...)[c("nstart", "trace", "lower", "opt", "rotate")]
>     if(length(more)) cn[names(more)] <- more
> 
>     if(is.null(start)) {
>         start <- (1 - 0.5*factors/p)/diag(solve(cv))
>         if((ns <- cn$nstart) > 1)
>             start <- cbind(start, matrix(runif(ns-1), p, ns-1,
byrow=TRUE))
>     }
>     start <- as.matrix(start)
>     if(nrow(start) != p)
>         stop(gettextf("'start' must have %d rows", p), domain = NA)
>     nc <- ncol(start)
>     if(nc < 1) stop("no starting values supplied")
> 
>     best <- Inf
>     for (i in 1:nc) {
>         nfit <- factanal.fit.mle(cv, factors, start[, i],
>                                  max(cn$lower, 0), cn$opt)
>         if(cn$trace)
>             cat("start", i, "value:", format(nfit$criteria[1]),
>                 "uniqs:", format(as.vector(round(nfit$uniquenesses, 4))),
> "\n")
>         if(nfit$converged && nfit$criteria[1] < best) {
>             fit <- nfit
>             best <- fit$criteria[1]
>         }
>     }
>     if(best == Inf) stop("unable to optimize from these starting
value(s)")
>     load <- fit$loadings
>     if(rotation != "none") {
>         rot <- do.call(rotation, c(list(load), cn$rotate))
>                                         # the following lines modified by
J.
> Fox, 26 June 2005
>         if (is.list(rot)){
>           load <- rot$loadings
>                                         #the following lines changed by
> Ulrich Keller, 9 Sept 2008
>           fit$rotmat <-
>             if(inherits(rot, "GPArotation")) {
>               t(solve(rot$Th))
>             } else {
>               rot$rotmat
>             }
>                                         #end changes Ulrich Keller, 9 Sept
> 2008
>         }
>         else load <- rot
>                                         # end modifications J. Fox, 26
June
> 2005
>     }
>     fit$loadings <- sortLoadings(load)
>     class(fit$loadings) <- "loadings"
>     fit$na.action <- na.act # not used currently
>     if(have.x && scores != "none") {
>         Lambda <- fit$loadings
>         zz <- scale(z, TRUE, TRUE)
>         switch(scores,
>                regression = {
>                    sc <- zz %*% solve(cv, Lambda)
>                    if(!is.null(Phi <- attr(Lambda, "covariance")))
>                        sc <- sc %*% Phi
>                },
>                Bartlett = {
>                    d <- 1/fit$uniquenesses
>                    tmp <- t(Lambda * d)
>                    sc <- t(solve(tmp %*% Lambda, tmp %*% t(zz)))
>                })
>         rownames(sc) <- rownames(z)
>         colnames(sc) <- colnames(Lambda)
>         if(!is.null(na.act)) sc <- napredict(na.act, sc)
>         fit$scores <- sc
>     }
>     if(!is.na(n.obs) && dof > 0) {
>         fit$STATISTIC <- (n.obs - 1 - (2 * p + 5)/6 -
>                      (2 * factors)/3) * fit$criteria["objective"]
>         fit$PVAL <- pchisq(fit$STATISTIC, dof, lower.tail = FALSE)
>     }
>     fit$n.obs <- n.obs
>     fit$call <- cl
>     fit
> }
> 
> factanal.fit.mle <-
>     function(cmat, factors, start=NULL, lower = 0.005, control = NULL,
...)
> {
>     FAout <- function(Psi, S, q)
>     {
>         sc <- diag(1/sqrt(Psi))
>         Sstar <- sc %*% S %*% sc
>         E <- eigen(Sstar, symmetric = TRUE)
>         L <- E$vectors[, 1:q, drop = FALSE]
>         load <- L %*% diag(sqrt(pmax(E$values[1:q] - 1, 0)), q)
>         diag(sqrt(Psi)) %*% load
>     }
>     FAfn <- function(Psi, S, q)
>     {
>         sc <- diag(1/sqrt(Psi))
>         Sstar <- sc %*% S %*% sc
>         E <- eigen(Sstar, symmetric = TRUE, only.values = TRUE)
>         e <- E$values[-(1:q)]
>         e <- sum(log(e) - e) - q + nrow(S)
> ##        print(round(c(Psi, -e), 5))  # for tracing
>         -e
>     }
>     FAgr <- function(Psi, S, q)
>     {
>         sc <- diag(1/sqrt(Psi))
>         Sstar <- sc %*% S %*% sc
>         E <- eigen(Sstar, symmetric = TRUE)
>         L <- E$vectors[, 1:q, drop = FALSE]
>         load <- L %*% diag(sqrt(pmax(E$values[1:q] - 1, 0)), q)
>         load <- diag(sqrt(Psi)) %*% load
>         g <- load %*% t(load) + diag(Psi) - S
>         diag(g)/Psi^2
>     }
>     p <- ncol(cmat)
>     if(is.null(start))
>         start <- (1 - 0.5*factors/p)/diag(solve(cmat))
>     res <- optim(start, FAfn, FAgr, method = "L-BFGS-B",
>                  lower = lower, upper = 1,
>                  control = c(list(fnscale=1,
>                  parscale = rep(0.01, length(start))), control),
>                  q = factors, S = cmat)
>     Lambda <- FAout(res$par, cmat, factors)
>     dimnames(Lambda) <- list(dimnames(cmat)[[1]],
>                              paste("Factor", 1:factors, sep = ""))
>     p <- ncol(cmat)
>     dof <- 0.5 * ((p - factors)^2 - p - factors)
>     un <- res$par
>     names(un) <- colnames(cmat)
>     class(Lambda) <- "loadings"
>     ans <- list(converged = res$convergence == 0,
>                 loadings = Lambda, uniquenesses = un,
>                 correlation = cmat,
>                 criteria = c(objective = res$value, counts = res$counts),
>                 factors = factors, dof = dof, method = "mle")
>     class(ans) <- "factanal"
>     ans
> }
> 
> print.loadings <- function(x, digits = 3, cutoff = 0.1, sort = FALSE, ...)
> {
>     Lambda <- unclass(x)
>     p <- nrow(Lambda)
>     factors <- ncol(Lambda)
>     if (sort) {
>         mx <- max.col(abs(Lambda))
>         ind <- cbind(1:p, mx)
>         mx[abs(Lambda[ind]) < 0.5] <- factors + 1
>         Lambda <- Lambda[order(mx, 1:p),]
>     }
>     cat("\nLoadings:\n")
>     fx <- format(round(Lambda, digits))
>     names(fx) <- NULL
>     nc <- nchar(fx[1], type="c")
>     fx[abs(Lambda) < cutoff] <- paste(rep(" ", nc), collapse = "")
>     print(fx, quote = FALSE, ...)
>     vx <- colSums(x^2)
>     varex <- rbind("SS loadings" = vx)
>     if(is.null(attr(x, "covariance"))) {
>         varex <- rbind(varex, "Proportion Var" = vx/p)
>         if(factors > 1)
>             varex <- rbind(varex, "Cumulative Var" = cumsum(vx/p))
>     }
>     cat("\n")
>     print(round(varex, digits))
>     invisible(x)
> }
> 
> print.factanal <- function(x, digits = 3, ...)
> {
>     cat("\nCall:\n", deparse(x$call), "\n\n", sep = "")
>     cat("Uniquenesses:\n")
>     print(round(x$uniquenesses, digits), ...)
>     print(x$loadings, digits = digits, ...)
>                                         # the following lines added by J.
> Fox, 26 June 2005
>     if (!is.null(x$rotmat)){
> 
>       tmat <- solve(x$rotmat)
>       R <- tmat %*% t(tmat)
>       factors <- x$factors
>       rownames(R) <- colnames(R) <- paste("Factor", 1:factors, sep="")
> 
>                                         # the following line changed by
> Ulrich Keller, 9 Sept 2008
>       if (TRUE != all.equal(c(R), c(diag(factors)))){
>         cat("\nFactor Correlations:\n")
>         print(R, digits=digits, ...)
>       }
> 
> 
>     }
>                                         # end additions J. Fox, 23 June
2005
>     if(!is.null(x$STATISTIC)) {
>         factors <- x$factors
>         cat("\nTest of the hypothesis that", factors, if(factors == 1)
>             "factor is" else "factors are", "sufficient.\n")
>         cat("The chi square statistic is", round(x$STATISTIC, 2), "on",
> x$dof,
>             if(x$dof == 1) "degree" else "degrees",
>             "of freedom.\nThe p-value is", signif(x$PVAL, 3), "\n")
>     } else {
>         cat(paste("\nThe degrees of freedom for the model is",
>                   x$dof, "and the fit was", round(x$criteria["objective"],
> 4),
>                   "\n"))
>     }
>     invisible(x)
> }
> 
> varimax <- function(x, normalize = TRUE, eps = 1e-5)
> {
>     nc <- ncol(x)
>     if(nc < 2) return(x)
>     if(normalize) {
>         sc <- sqrt(drop(apply(x, 1, function(x) sum(x^2))))
>         x <- x/sc
>     }
>     p <- nrow(x)
>     TT <- diag(nc)
>     d <- 0
>     for(i in 1:1000) {
>         z <- x %*% TT
>         B  <- t(x) %*% (z^3 - z %*% diag(drop(rep(1, p) %*% z^2))/p)
>         sB <- La.svd(B)
>         TT <- sB$u %*% sB$vt
>         dpast <- d
>         d <- sum(sB$d)
>         if(d < dpast * (1 + eps)) break
>     }
>     z <- x %*% TT
>     if(normalize) z <- z * sc
>     dimnames(z) <- dimnames(x)
>     class(z) <- "loadings"
>     list(loadings = z, rotmat = TT)
> }
> 
> promax <- function(x, m = 4)
> {
>     if(ncol(x) < 2) return(x)
>     dn <- dimnames(x)
>     xx <- varimax(x)
>     x <- xx$loadings
>     Q <- x * abs(x)^(m-1)
>     U <- lm.fit(x, Q)$coefficients
>     d <- diag(solve(t(U) %*% U))
>     U <- U %*% diag(sqrt(d))
>     dimnames(U) <- NULL
>     z <- x %*% U
>     U <- xx$rotmat %*% U
>     dimnames(z) <- dn
>     class(z) <- "loadings"
>     list(loadings = z, rotmat = U)
> }
> 
> --=-hiYzUeWcRJ/+kx41aPIZ
> Content-Disposition: attachment; filename="factanal.Rd"
> Content-Type: text/x-matlab; name="factanal.Rd"; charset="utf-8"
> Content-Transfer-Encoding: 8bit
> 
> % File src/library/stats/man/factanal.Rd
> % Part of the R package, http://www.R-project.org
> % Copyright 1995-2007 R Core Development Team
> % Distributed under GPL 2 or later
> 
> \name{factanal}
> \alias{factanal}
> %\alias{factanal.fit.mle}
> \encoding{latin1}
> \title{Factor Analysis}
> \description{
>   Perform maximum-likelihood factor analysis on a covariance matrix or
>   data matrix.
> }
> \usage{
> factanal(x, factors, data = NULL, covmat = NULL, n.obs = NA,
>          subset, na.action, start = NULL,
>          scores = c("none", "regression", "Bartlett"),
>          rotation = "varimax", control = NULL, \dots)
> }
> \arguments{
>   \item{x}{A formula or a numeric matrix or an object that can be
>     coerced to a numeric matrix.}
>   \item{factors}{The number of factors to be fitted.}
>   \item{data}{An optional data frame (or similar: see
>     \code{\link{model.frame}}), used only if \code{x} is a formula.  By
>     default the variables are taken from \code{environment(formula)}.}
>   \item{covmat}{A covariance matrix, or a covariance list as returned by
>     \code{\link{cov.wt}}.  Of course, correlation matrices are covariance
>     matrices.}
>   \item{n.obs}{The number of observations, used if \code{covmat} is a
>     covariance matrix.}
>   \item{subset}{A specification of the cases to be used, if \code{x} is
>     used as a matrix or formula.}
>   \item{na.action}{The \code{na.action} to be used if \code{x} is
>     used as a formula.}
>   \item{start}{\code{NULL} or a matrix of starting values, each column
>     giving an initial set of uniquenesses.}
>   \item{scores}{Type of scores to produce, if any.  The default is none,
>     \code{"regression"} gives Thompson's scores, \code{"Bartlett"} given
>     Bartlett's weighted least-squares scores. Partial matching allows
>     these names to be abbreviated.}
>   \item{rotation}{character. \code{"none"} or the name of a function
>     to be used to rotate the factors: it will be called with first
>     argument the loadings matrix, and should return a list with component
>     \code{loadings} giving the rotated loadings, or just the rotated
> loadings.}
>   \item{control}{A list of control values,
>     \describe{
>       \item{nstart}{The number of starting values to be tried if
> 	\code{start = NULL}. Default 1.}
>       \item{trace}{logical. Output tracing information? Default
> \code{FALSE}.}
>       \item{lower}{The lower bound for uniquenesses during
> 	optimization. Should be > 0. Default 0.005.}
>       \item{opt}{A list of control values to be passed to
> 	\code{\link{optim}}'s \code{control} argument.}
>       \item{rotate}{a list of additional arguments for the rotation
> function.}
>     }
>   }
>   \item{\dots}{Components of \code{control} can also be supplied as
>     named arguments to \code{factanal}.}
> }
> \details{
>   The factor analysis model is
>   \deqn{x = \Lambda f + e}{ x = Lambda f + e}
>   for a \eqn{p}--element row-vector \eqn{x}, a \eqn{p \times k}{p x k}
>   matrix of \emph{loadings}, a \eqn{k}--element vector of \emph{scores}
>   and a \eqn{p}--element vector of errors.  None of the components
>   other than \eqn{x} is observed, but the major restriction is that the
>   scores be uncorrelated and of unit variance, and that the errors be
>   independent with variances \eqn{\Phi}{Phi}, the
>   \emph{uniquenesses}.  Thus factor analysis is in essence a model for
>   the covariance matrix of \eqn{x},
>   \deqn{\Sigma = \Lambda^\prime\Lambda + \Psi}{Sigma = Lambda'Lambda +
Psi}
>   There is still some indeterminacy in the model for it is unchanged
>   if \eqn{\Lambda}{Lambda} is replaced by \eqn{G\Lambda}{G Lambda} for
>   any orthogonal matrix \eqn{G}.  Such matrices \eqn{G} are known as
>   \emph{rotations} (although the term is applied also to non-orthogonal
>   invertible matrices).
> 
>   If \code{covmat} is supplied it is used.  Otherwise \code{x} is used if
>   it is a matrix, or a formula \code{x} is used with \code{data} to
>   construct a model matrix, and that is used to construct a covariance
>   matrix.  (It makes no sense for the formula to have a response,
>   and all the variables must be numeric.)  Once a covariance matrix is
found
> or
>   calculated from \code{x}, it is converted to a correlation matrix for
>   analysis.  The correlation matrix is returned as component
>   \code{correlation} of the result.
> 
>   The fit is done by optimizing the log likelihood assuming multivariate
>   normality over the uniquenesses.  (The maximizing loadings for given
>   uniquenesses can be found analytically: Lawley & Maxwell (1971,
>   p. 27).)  All the starting values supplied in \code{start} are tried
>   in turn and the best fit obtained is used.  If \code{start = NULL}
>   then the first fit is started at the value suggested by
>   \enc{J?reskog}{Joreskog} (1963) and given by Lawley & Maxwell
>   (1971, p. 31), and then \code{control$nstart - 1} other values are
>   tried, randomly selected as equal values of the uniquenesses.
> 
>   The uniquenesses are technically constrained to lie in \eqn{[0, 1]},
>   but near-zero values are problematical, and the optimization is
>   done with a lower bound of \code{control$lower}, default 0.005
>   (Lawley & Maxwell, 1971, p. 32).
> 
>   Scores can only be produced if a data matrix is supplied and used.
>   The first method is the regression method of Thomson (1951), the
>   second the weighted least squares method of Bartlett (1937, 8).
>   Both are estimates of the unobserved scores \eqn{f}.  Thomson's method
>   regresses (in the population) the unknown \eqn{f} on \eqn{x} to yield
>   \deqn{\hat f = \Lambda^\prime \Sigma^{-1} x}{hat f = Lambda' Sigma^-1 x}
>   and then substitutes the sample estimates of the quantities on the
>   right-hand side.  Bartlett's method minimizes the sum of squares of
>   standardized errors over the choice of \eqn{f}, given (the fitted)
>   \eqn{\Lambda}{Lambda}.
> 
>   If \code{x} is a formula then the standard NA-handling is applied to
>   the scores (if requested): see \code{\link{napredict}}.
> }
> \value{
>   An object of class \code{"factanal"} with components
>   \item{loadings}{A matrix of loadings, one column for each factor.  The
>     factors are ordered in decreasing order of sums of squares of
>     loadings, and given the sign that will make the sum of the loadings
>     positive.}
>   \item{uniquenesses}{The uniquenesses computed.}
>   \item{correlation}{The correlation matrix used.}
>   \item{criteria}{The results of the optimization: the value of the
>     negative log-likelihood and information on the iterations used.}
>   \item{factors}{The argument \code{factors}.}
>   \item{dof}{The number of degrees of freedom of the factor analysis
model.}
>   \item{method}{The method: always \code{"mle"}.}
>   %Modification by Ulrich Keller, Sept 9 2008
>   \item{rotmat}{The rotation matrix if relevant.}
>   %End modicication by Ulrich Keller, Sept 9 2008
>   \item{scores}{If requested, a matrix of scores.  \code{napredict} is
>     applied to handle the treatment of values omitted by the
> \code{na.action}.}
>   \item{n.obs}{The number of observations if available, or \code{NA}.}
>   \item{call}{The matched call.}
>   \item{na.action}{If relevant.}
>   \item{STATISTIC, PVAL}{The significance-test statistic and P value, if
>     if can be computed.}
> }
> 
> \note{
>   There are so many variations on factor analysis that it is hard to
>   compare output from different programs.  Further, the optimization in
>   maximum likelihood factor analysis is hard, and many other examples we
>   compared had less good fits than produced by this function.  In
>   particular, solutions which are Heywood cases (with one or more
>   uniquenesses essentially zero) are much often common than most texts
>   and some other programs would lead one to believe.
> }
> 
> \references{
>   Bartlett, M. S. (1937) The statistical conception of mental factors.
>   \emph{British Journal of Psychology}, \bold{28}, 97--104.
> 
>   Bartlett, M. S. (1938) Methods of estimating mental
>   factors. \emph{Nature}, \bold{141}, 609--610.
> 
>   \enc{J?reskog}{Joreskog}, K. G. (1963)
>   \emph{Statistical Estimation in Factor Analysis.}  Almqvist and
Wicksell.
> 
>   Lawley, D. N. and Maxwell, A. E. (1971) \emph{Factor Analysis as a
>     Statistical Method.} Second edition. Butterworths.
> 
>   Thomson, G. H. (1951) \emph{The Factorial Analysis of Human Ability.}
>   London University Press.
> }
> 
> \seealso{
>   \code{\link{print.loadings}},
>   \code{\link{varimax}}, \code{\link{princomp}},
>   \code{\link[datasets]{ability.cov}},
\code{\link[datasets]{Harman23.cor}},
>   \code{\link[datasets]{Harman74.cor}}
> }
> 
> \examples{
> # A little demonstration, v2 is just v1 with noise,
> # and same for v4 vs. v3 and v6 vs. v5
> # Last four cases are there to add noise
> # and introduce a positive manifold (g factor)
> v1 <- c(1,1,1,1,1,1,1,1,1,1,3,3,3,3,3,4,5,6)
> v2 <- c(1,2,1,1,1,1,2,1,2,1,3,4,3,3,3,4,6,5)
> v3 <- c(3,3,3,3,3,1,1,1,1,1,1,1,1,1,1,5,4,6)
> v4 <- c(3,3,4,3,3,1,1,2,1,1,1,1,2,1,1,5,6,4)
> v5 <- c(1,1,1,1,1,3,3,3,3,3,1,1,1,1,1,6,4,5)
> v6 <- c(1,1,1,2,1,3,3,3,4,3,1,1,1,2,1,6,5,4)
> m1 <- cbind(v1,v2,v3,v4,v5,v6)
> cor(m1)
> factanal(m1, factors=3) # varimax is the default
> factanal(m1, factors=3, rotation="promax")
> # The following shows the g factor as PC1
> prcomp(m1)
> 
> ## formula interface
> factanal(~v1+v2+v3+v4+v5+v6, factors = 3,
>          scores = "Bartlett")$scores
> 
> ## a realistic example from Barthlomew (1987, pp. 61-65)
> utils::example(ability.cov)
> }
> \keyword{multivariate}
> 
> --=-hiYzUeWcRJ/+kx41aPIZ--
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From osklyar at maninvestments.com  Tue Sep  9 17:30:36 2008
From: osklyar at maninvestments.com (Sklyar, Oleg (London))
Date: Tue, 9 Sep 2008 16:30:36 +0100
Subject: [Rd] 'xtfrm' performance (influences 'order' performance) in R
 devel
In-Reply-To: <1A68FCB28DE72F4BA3B967E6506CCE4303049737@mildnpexmb01.maninvestments.ad.man.com>
References: <1A68FCB28DE72F4BA3B967E6506CCE4303049734@mildnpexmb01.maninvestments.ad.man.com>
	<48C683DC.1060707@r-project.org> 
	<1A68FCB28DE72F4BA3B967E6506CCE4303049737@mildnpexmb01.maninvestments.ad.man.com>
Message-ID: <1A68FCB28DE72F4BA3B967E6506CCE4303049739@mildnpexmb01.maninvestments.ad.man.com>

In fact it all comes back to 'rank', which uses 'order(x[!nas])'
internally. Surprisingly one does not get an infinite recursion: rank ->
order -> xtfrm -> rank -> ...

This is obviously only one of possible outcomes, yet it seems to be
happening. Previous implementation of order did not have a reference to
xtfrm and thus would not cause this infinite loop

Dr Oleg Sklyar
Research Technologist
AHL / Man Investments Ltd
+44 (0)20 7144 3107
osklyar at maninvestments.com 

> -----Original Message-----
> From: r-devel-bounces at r-project.org 
> [mailto:r-devel-bounces at r-project.org] On Behalf Of Sklyar, 
> Oleg (London)
> Sent: 09 September 2008 15:49
> To: John Chambers
> Cc: R-devel at r-project.org
> Subject: Re: [Rd] 'xtfrm' performance (influences 'order' 
> performance) in R devel
> 
> Ha, defined xtfrm for TimeDate, works instantly (xtfrm is already a
> method). However, it won't be taken up by order as it is not in the
> imported namespace, so order falls back to xtfrm.default.
> 
> Moreover, defining order (which is not a method unfortunately, *any
> chance of changing this*?):
> 
> setGeneric("order")
> setMethod("order", "TimeDate", 
> 	function (..., na.last = TRUE, decreasing = FALSE) 
> 		order(list(...)[[1]]@.Data,na.last=na.last,
> decreasing=decreasing))
> 
> does not help either as it won't be taken up, order still calls the
> default one, what am I doing wrong?
> 
> 
> 
> Dr Oleg Sklyar
> Research Technologist
> AHL / Man Investments Ltd
> +44 (0)20 7144 3107
> osklyar at maninvestments.com 
> 
> > -----Original Message-----
> > From: John Chambers [mailto:jmc at r-project.org] 
> > Sent: 09 September 2008 15:11
> > To: Sklyar, Oleg (London)
> > Cc: R-devel at r-project.org
> > Subject: Re: [Rd] 'xtfrm' performance (influences 'order' 
> > performance) in R devel
> > 
> > No definitive answers, but here are a few observations.
> > 
> > In the call to order() code, I notice that you have dropped 
> > into the branch
> >     if (any(unlist(lapply(z, is.object))))
> > where the alternative in your case would seem to have been 
> > going directly to the internal code.
> > 
> > You can consider a method for xtfrm(), which would help but 
> > won't get you completely back to a trivial computation.  
> > Alternatively,  order() should be eligible for the new 
> > mechanism of defining methods for "...".
> > 
> > (Individual existing methods may not be the issue, and one 
> > can't infer anything definite from the evidence given,  but a 
> > plausible culprit is the "[" method.  Because [] expressions 
> > appear so often, it's always chancy to define a nontrivial 
> > method for this function.)
> > 
> > John
> > 
> > Sklyar, Oleg (London) wrote: 
> > 
> > 	Hello everybody,
> > 	
> > 	it looks like the presense of some (do know know which) 
> > S4 methods for a
> > 	given S4 class degrades the performance of xtfrm (used 
> > in 'order' in new
> > 	R-devel) by a factor of millions. This is for classes 
> > that ARE derived
> > 	from numeric directly and thus should be quite trivial 
> > to convert to
> > 	numeric.
> > 	
> > 	Consider the following example:
> > 	
> > 	setClass("TimeDateBase", 
> > 	    representation("numeric", mode="character"),
> > 	    prototype(mode="posix")
> > 	)
> > 	setClass("TimeDate",
> > 	    representation("TimeDateBase", tzone="character"),
> > 	    prototype(tzone="London")
> > 	)
> > 	x = new("TimeDate", 1220966224 + runif(1e5))
> > 	
> > 	system.time({ z = order(x) })
> > 	## > system.time({ z = order(x) })
> > 	##   user  system elapsed 
> > 	##  0.048   0.000   0.048 
> > 	
> > 	getClass("TimeDate")
> > 	## Class "TimeDate"
> > 	
> > 	## Slots:
> > 	                                    
> > 	## Name:      .Data     tzone      mode
> > 	## Class:   numeric character character
> > 	
> > 	## Extends: 
> > 	## Class "TimeDateBase", directly
> > 	## Class "numeric", by class "TimeDateBase", distance 2
> > 	## Class "vector", by class "TimeDateBase", distance 3
> > 	
> > 	
> > 	Now, if I load a library that not only defines these 
> > same classes, but
> > 	also a bunch of methods for those, then I have the 
> > following result:
> > 	
> > 	library(AHLCalendar)
> > 	x = now() + runif(1e5) ## just random times in POSIXct format
> > 	x[1:5]
> > 	## TimeDate [posix] object in 'Europe/London' of length 5:
> > 	## [1] "2008-09-09 14:19:35.218" "2008-09-09 14:19:35.672"
> > 	## [3] "2008-09-09 14:19:35.515" "2008-09-09 14:19:35.721"
> > 	## [5] "2008-09-09 14:19:35.657"
> > 	
> > 	  
> > 
> > 		system.time({ z = order(x) })
> > 		    
> > 
> > 	
> > 	
> > 	Enter a frame number, or 0 to exit   
> > 	
> > 	 1: system.time({
> > 	 2: order(x)
> > 	 3: lapply(z, function(x) if (is.object(x)) xtfrm(x) else x)
> > 	 4: FUN(X[[1]], ...)
> > 	 5: xtfrm(x)
> > 	 6: xtfrm.default(x)
> > 	 7: as.vector(rank(x, ties.method = "min", na.last = "keep"))
> > 	 8: rank(x, ties.method = "min", na.last = "keep")
> > 	 9: switch(ties.method, average = , min = , max =
> > 	.Internal(rank(x[!nas], ties.
> > 	10: .gt(c(1220966375.21811, 1220966375.67217, 1220966375.51470,
> > 	1220966375.7211
> > 	11: x[j]
> > 	12: x[j]
> > 	
> > 	Selection: 0
> > 	Timing stopped at: 47.618 13.791 66.478 
> > 	
> > 	At the same time:
> > 	
> > 	system.time({ z = as.numeric(x) }) ## same as x at .Data
> > 	##   user  system elapsed 
> > 	##  0.001   0.000   0.001 
> > 	
> > 	The only difference between the two is that I have the 
> > following methods
> > 	defined for TimeDate (full listing below). 
> > 	
> > 	Any idea why this could be happenning. And yes, it is 
> > down to xtfrm
> > 	function, 'order' was just a place where the problem 
> > occured. Should
> > 	xtfrm function be smarter with respect to classes that 
> > are actually
> > 	derived from 'numeric'?
> > 	
> > 	  
> > 
> > 		showMethods(class="TimeDate")
> > 		    
> > 
> > 	Function: + (package base)
> > 	e1="TimeDate", e2="TimeDate"
> > 	e1="TimeDate", e2="numeric"
> > 	    (inherited from: e1="TimeDateBase", e2="numeric")
> > 	
> > 	Function: - (package base)
> > 	e1="TimeDate", e2="TimeDate"
> > 	
> > 	Function: Time (package AHLCalendar)
> > 	x="TimeDate"
> > 	
> > 	Function: TimeDate (package AHLCalendar)
> > 	x="TimeDate"
> > 	
> > 	Function: TimeDate<- (package AHLCalendar)
> > 	x="TimeSeries", value="TimeDate"
> > 	
> > 	Function: TimeSeries (package AHLCalendar)
> > 	x="data.frame", ts="TimeDate"
> > 	x="matrix", ts="TimeDate"
> > 	x="numeric", ts="TimeDate"
> > 	
> > 	Function: [ (package base)
> > 	x="TimeDate", i="POSIXt", j="missing"
> > 	x="TimeDate", i="Time", j="missing"
> > 	x="TimeDate", i="TimeDate", j="missing"
> > 	x="TimeDate", i="integer", j="missing"
> > 	    (inherited from: x="TimeDateBase", i="ANY", j="missing")
> > 	x="TimeDate", i="logical", j="missing"
> > 	    (inherited from: x="TimeDateBase", i="ANY", j="missing")
> > 	x="TimeSeries", i="TimeDate", j="missing"
> > 	x="TimeSeries", i="TimeDate", j="vector"
> > 	
> > 	Function: [<- (package base)
> > 	x="TimeDate", i="ANY", j="ANY", value="ANY"
> > 	x="TimeDate", i="ANY", j="ANY", value="numeric"
> > 	x="TimeDate", i="missing", j="ANY", value="ANY"
> > 	x="TimeDate", i="missing", j="ANY", value="numeric"
> > 	
> > 	Function: add (package AHLCalendar)
> > 	x="TimeDate"
> > 	
> > 	Function: addMonths (package AHLCalendar)
> > 	x="TimeDate"
> > 	
> > 	Function: addYears (package AHLCalendar)
> > 	x="TimeDate"
> > 	
> > 	Function: align (package AHLCalendar)
> > 	x="TimeDate", to="character"
> > 	x="TimeDate", to="missing"
> > 	
> > 	Function: as.POSIXct (package base)
> > 	x="TimeDate"
> > 	
> > 	Function: as.POSIXlt (package base)
> > 	x="TimeDate"
> > 	
> > 	Function: coerce (package methods)
> > 	from="TimeDate", to="TimeDateBase"
> > 	
> > 	Function: coerce<- (package methods)
> > 	from="TimeDate", to="numeric"
> > 	
> > 	Function: dates (package AHLCalendar)
> > 	x="TimeDate"
> > 	
> > 	Function: format (package base)
> > 	x="TimeDate"
> > 	
> > 	Function: fxFwdDate (package AHLCalendar)
> > 	x="TimeDate", country="character"
> > 	
> > 	Function: fxSettleDate (package AHLCalendar)
> > 	x="TimeDate", country="character"
> > 	
> > 	Function: holidays (package AHLCalendar)
> > 	x="TimeDate"
> > 	
> > 	Function: index (package AHLCalendar)
> > 	x="TimeDate", y="POSIXt"
> > 	x="TimeDate", y="Time"
> > 	x="TimeDate", y="TimeDate"
> > 	
> > 	Function: initialize (package methods)
> > 	.Object="TimeDate"
> > 	    (inherited from: .Object="ANY")
> > 	
> > 	Function: leapYear (package AHLCalendar)
> > 	x="TimeDate"
> > 	
> > 	Function: mday (package AHLCalendar)
> > 	x="TimeDate"
> > 	
> > 	Function: mode (package base)
> > 	x="TimeDate"
> > 	    (inherited from: x="TimeDateBase")
> > 	
> > 	Function: mode<- (package base)
> > 	x="TimeDate", value="character"
> > 	    (inherited from: x="TimeDateBase", value="character")
> > 	
> > 	Function: month (package AHLCalendar)
> > 	x="TimeDate"
> > 	
> > 	Function: pretty (package base)
> > 	x="TimeDate"
> > 	
> > 	Function: prettyFormat (package AHLCalendar)
> > 	x="TimeDate", munit="character"
> > 	x="TimeDate", munit="missing"
> > 	
> > 	Function: print (package base)
> > 	x="TimeDate"
> > 	
> > 	Function: show (package methods)
> > 	object="TimeDate"
> > 	    (inherited from: object="TimeDateBase")
> > 	
> > 	Function: summary (package base)
> > 	object="TimeDate"
> > 	
> > 	Function: td2tz (package AHLCalendar)
> > 	x="TimeDate"
> > 	
> > 	Function: times (package AHLCalendar)
> > 	x="TimeDate"
> > 	
> > 	Function: tojulian (package AHLCalendar)
> > 	x="TimeDate"
> > 	
> > 	Function: toposix (package AHLCalendar)
> > 	x="TimeDate"
> > 	
> > 	Function: tots (package AHLCalendar)
> > 	x="TimeDate"
> > 	
> > 	Function: tzone (package AHLCalendar)
> > 	x="TimeDate"
> > 	
> > 	Function: tzone<- (package AHLCalendar)
> > 	x="TimeDate"
> > 	
> > 	Function: wday (package AHLCalendar)
> > 	x="TimeDate"
> > 	
> > 	Function: yday (package AHLCalendar)
> > 	x="TimeDate"
> > 	
> > 	Function: year (package AHLCalendar)
> > 	x="TimeDate"
> > 	
> > 	
> > 	
> > 	Dr Oleg Sklyar
> > 	Research Technologist
> > 	AHL / Man Investments Ltd
> > 	+44 (0)20 7144 3107
> > 	osklyar at maninvestments.com
> > 	
> > 	
> > 	
> > 
> **********************************************************************
> > 	The contents of this email are for the named 
> > addressee(s...{{dropped:22}}
> > 	
> > 	______________________________________________
> > 	R-devel at r-project.org mailing list
> > 	https://stat.ethz.ch/mailman/listinfo/r-devel
> > 	
> > 	  
> > 
> > 
> 
> 
> **********************************************************************
> The contents of this email are for the named 
> addressee(s...{{dropped:22}}
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 


**********************************************************************
The contents of this email are for the named addressee(s...{{dropped:22}}


From jmc at r-project.org  Tue Sep  9 17:41:54 2008
From: jmc at r-project.org (John Chambers)
Date: Tue, 09 Sep 2008 11:41:54 -0400
Subject: [Rd] 'xtfrm' performance (influences 'order' performance) in R
 devel
In-Reply-To: <1A68FCB28DE72F4BA3B967E6506CCE4303049737@mildnpexmb01.maninvestments.ad.man.com>
References: <1A68FCB28DE72F4BA3B967E6506CCE4303049734@mildnpexmb01.maninvestments.ad.man.com>	<48C683DC.1060707@r-project.org>
	<1A68FCB28DE72F4BA3B967E6506CCE4303049737@mildnpexmb01.maninvestments.ad.man.com>
Message-ID: <48C69942.8070305@r-project.org>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20080909/95b1c102/attachment.pl>

From osklyar at maninvestments.com  Tue Sep  9 19:04:37 2008
From: osklyar at maninvestments.com (Sklyar, Oleg (London))
Date: Tue, 9 Sep 2008 18:04:37 +0100
Subject: [Rd] 'xtfrm' performance (influences 'order' performance) in R
 devel
In-Reply-To: <48C69942.8070305@r-project.org>
References: <1A68FCB28DE72F4BA3B967E6506CCE4303049734@mildnpexmb01.maninvestments.ad.man.com>
	<48C683DC.1060707@r-project.org> 
	<1A68FCB28DE72F4BA3B967E6506CCE4303049737@mildnpexmb01.maninvestments.ad.man.com>
	<48C69942.8070305@r-project.org>
Message-ID: <1A68FCB28DE72F4BA3B967E6506CCE430304973A@mildnpexmb01.maninvestments.ad.man.com>


Aha, it works if I do

setGeneric("order", signature="...")

However the problem with that is that it generates a warning which I
cannot suppress on install:

Creating a generic for "order" in package  "AHLCalendar"
    (the supplied definition differs from and overrides the implicit
generic in package "base": Signatures differ:  (...), (na.last,
decreasing))

and it generates a warning about masking order from base on load:

  AHLCalendar [0.2.42] (9 Sep 2008). ?AHLCalendar or
vignette('AHLCalendar') to get started

Attaching package: 'AHLCalendar'

        The following object(s) are masked from package:base :

         order 

The package exports (excerpt):

exportPattern("^[^\\.]")
exportMethods(order)

The reason for these messages is that the signature is different and I
particularly dislike the masking thing (as I cannot predict if it leads
to other problems somewhere). As I understand the current dotsMethods
does not allow mixing dots and other types, so I cannot really define a
matching signature. Is that right? Is there a way around it?

As for the rest, yes, I meant generic and it works nicely for xtfrm. But
as I wrote later, the problem is in 'rank' and rank is not generic so
defining a method would not help in calling a different implementation.

Thanks,
Oleg

Dr Oleg Sklyar
Research Technologist
AHL / Man Investments Ltd
+44 (0)20 7144 3107
osklyar at maninvestments.com 

> -----Original Message-----
> From: John Chambers [mailto:jmc at r-project.org] 
> Sent: 09 September 2008 16:42
> To: Sklyar, Oleg (London)
> Cc: R-devel at r-project.org
> Subject: Re: [Rd] 'xtfrm' performance (influences 'order' 
> performance) in R devel
> 
> Sklyar, Oleg (London) wrote: 
> 
> 	Ha, defined xtfrm for TimeDate, works instantly (xtfrm 
> is already a
> 	method). However, it won't be taken up by order as it 
> is not in the
> 	imported namespace, so order falls back to xtfrm.default.
> 	  
> 
> By "method" you mean "generic"?  xtfrm is an S3 generic.  I'm 
> not clear what happens if you define an S3 method for it.  
> Yes, there is a problem defining an S4 generic & it would be 
> good to deal with that.  Nontrivial, however.
> 
> 
> 	
> 	Moreover, defining order (which is not a method 
> unfortunately, *any
> 	chance of changing this*?):
> 	
> 	setGeneric("order")
> 	setMethod("order", "TimeDate", 
> 		function (..., na.last = TRUE, decreasing = FALSE) 
> 			order(list(...)[[1]]@.Data,na.last=na.last,
> 	decreasing=decreasing))
> 	
> 	does not help either as it won't be taken up, order 
> still calls the
> 	default one, what am I doing wrong?
> 	  
> 
> I'm skeptical that this is true.  I did a simple example:
> 
> > setClass("foo", contains = "numeric", representation(flag = 
> "logical"))
> [1] "foo"
> > xx = new("foo", rnorm(5))
> > setGeneric("order", sig = "...")
> Creating a generic for "order" in package  ".GlobalEnv"
>     (the supplied definition differs from and overrides the 
> implicit generic in package "base": Signatures differ:  
> (...), (na.last, decreasing))
> [1] "order"
> > setMethod("order", "foo", function (..., na.last = TRUE, 
> decreasing = FALSE){message("Method called"); order(..1 at .Data)})
> [1] "order"
> > order(xx)
> Method called
> [1] 2 4 3 1 5
> 
> You do need to be calling order() directly from one of your 
> functions, and have it in your namespace, if your package has one.
> 
> 
> 	
> 	
> 	
> 	Dr Oleg Sklyar
> 	Research Technologist
> 	AHL / Man Investments Ltd
> 	+44 (0)20 7144 3107
> 	osklyar at maninvestments.com 
> 	
> 	  
> 
> 		-----Original Message-----
> 		From: John Chambers [mailto:jmc at r-project.org] 
> 		Sent: 09 September 2008 15:11
> 		To: Sklyar, Oleg (London)
> 		Cc: R-devel at r-project.org
> 		Subject: Re: [Rd] 'xtfrm' performance 
> (influences 'order' 
> 		performance) in R devel
> 		
> 		No definitive answers, but here are a few observations.
> 		
> 		In the call to order() code, I notice that you 
> have dropped 
> 		into the branch
> 		    if (any(unlist(lapply(z, is.object))))
> 		where the alternative in your case would seem 
> to have been 
> 		going directly to the internal code.
> 		
> 		You can consider a method for xtfrm(), which 
> would help but 
> 		won't get you completely back to a trivial 
> computation.  
> 		Alternatively,  order() should be eligible for the new 
> 		mechanism of defining methods for "...".
> 		
> 		(Individual existing methods may not be the 
> issue, and one 
> 		can't infer anything definite from the evidence 
> given,  but a 
> 		plausible culprit is the "[" method.  Because 
> [] expressions 
> 		appear so often, it's always chancy to define a 
> nontrivial 
> 		method for this function.)
> 		
> 		John
> 		
> 		Sklyar, Oleg (London) wrote: 
> 		
> 			Hello everybody,
> 			
> 			it looks like the presense of some (do 
> know know which) 
> 		S4 methods for a
> 			given S4 class degrades the performance 
> of xtfrm (used 
> 		in 'order' in new
> 			R-devel) by a factor of millions. This 
> is for classes 
> 		that ARE derived
> 			from numeric directly and thus should 
> be quite trivial 
> 		to convert to
> 			numeric.
> 			
> 			Consider the following example:
> 			
> 			setClass("TimeDateBase", 
> 			    representation("numeric", mode="character"),
> 			    prototype(mode="posix")
> 			)
> 			setClass("TimeDate",
> 			    representation("TimeDateBase", 
> tzone="character"),
> 			    prototype(tzone="London")
> 			)
> 			x = new("TimeDate", 1220966224 + runif(1e5))
> 			
> 			system.time({ z = order(x) })
> 			## > system.time({ z = order(x) })
> 			##   user  system elapsed 
> 			##  0.048   0.000   0.048 
> 			
> 			getClass("TimeDate")
> 			## Class "TimeDate"
> 			
> 			## Slots:
> 			                                    
> 			## Name:      .Data     tzone      mode
> 			## Class:   numeric character character
> 			
> 			## Extends: 
> 			## Class "TimeDateBase", directly
> 			## Class "numeric", by class 
> "TimeDateBase", distance 2
> 			## Class "vector", by class 
> "TimeDateBase", distance 3
> 			
> 			
> 			Now, if I load a library that not only 
> defines these 
> 		same classes, but
> 			also a bunch of methods for those, then 
> I have the 
> 		following result:
> 			
> 			library(AHLCalendar)
> 			x = now() + runif(1e5) ## just random 
> times in POSIXct format
> 			x[1:5]
> 			## TimeDate [posix] object in 
> 'Europe/London' of length 5:
> 			## [1] "2008-09-09 14:19:35.218" 
> "2008-09-09 14:19:35.672"
> 			## [3] "2008-09-09 14:19:35.515" 
> "2008-09-09 14:19:35.721"
> 			## [5] "2008-09-09 14:19:35.657"
> 			
> 			  
> 		
> 				system.time({ z = order(x) })
> 				    
> 		
> 			
> 			
> 			Enter a frame number, or 0 to exit   
> 			
> 			 1: system.time({
> 			 2: order(x)
> 			 3: lapply(z, function(x) if 
> (is.object(x)) xtfrm(x) else x)
> 			 4: FUN(X[[1]], ...)
> 			 5: xtfrm(x)
> 			 6: xtfrm.default(x)
> 			 7: as.vector(rank(x, ties.method = 
> "min", na.last = "keep"))
> 			 8: rank(x, ties.method = "min", 
> na.last = "keep")
> 			 9: switch(ties.method, average = , min 
> = , max =
> 			.Internal(rank(x[!nas], ties.
> 			10: .gt(c(1220966375.21811, 
> 1220966375.67217, 1220966375.51470,
> 			1220966375.7211
> 			11: x[j]
> 			12: x[j]
> 			
> 			Selection: 0
> 			Timing stopped at: 47.618 13.791 66.478 
> 			
> 			At the same time:
> 			
> 			system.time({ z = as.numeric(x) }) ## 
> same as x at .Data
> 			##   user  system elapsed 
> 			##  0.001   0.000   0.001 
> 			
> 			The only difference between the two is 
> that I have the 
> 		following methods
> 			defined for TimeDate (full listing below). 
> 			
> 			Any idea why this could be happenning. 
> And yes, it is 
> 		down to xtfrm
> 			function, 'order' was just a place 
> where the problem 
> 		occured. Should
> 			xtfrm function be smarter with respect 
> to classes that 
> 		are actually
> 			derived from 'numeric'?
> 			
> 			  
> 		
> 				showMethods(class="TimeDate")
> 				    
> 		
> 			Function: + (package base)
> 			e1="TimeDate", e2="TimeDate"
> 			e1="TimeDate", e2="numeric"
> 			    (inherited from: e1="TimeDateBase", 
> e2="numeric")
> 			
> 			Function: - (package base)
> 			e1="TimeDate", e2="TimeDate"
> 			
> 			Function: Time (package AHLCalendar)
> 			x="TimeDate"
> 			
> 			Function: TimeDate (package AHLCalendar)
> 			x="TimeDate"
> 			
> 			Function: TimeDate<- (package AHLCalendar)
> 			x="TimeSeries", value="TimeDate"
> 			
> 			Function: TimeSeries (package AHLCalendar)
> 			x="data.frame", ts="TimeDate"
> 			x="matrix", ts="TimeDate"
> 			x="numeric", ts="TimeDate"
> 			
> 			Function: [ (package base)
> 			x="TimeDate", i="POSIXt", j="missing"
> 			x="TimeDate", i="Time", j="missing"
> 			x="TimeDate", i="TimeDate", j="missing"
> 			x="TimeDate", i="integer", j="missing"
> 			    (inherited from: x="TimeDateBase", 
> i="ANY", j="missing")
> 			x="TimeDate", i="logical", j="missing"
> 			    (inherited from: x="TimeDateBase", 
> i="ANY", j="missing")
> 			x="TimeSeries", i="TimeDate", j="missing"
> 			x="TimeSeries", i="TimeDate", j="vector"
> 			
> 			Function: [<- (package base)
> 			x="TimeDate", i="ANY", j="ANY", value="ANY"
> 			x="TimeDate", i="ANY", j="ANY", value="numeric"
> 			x="TimeDate", i="missing", j="ANY", value="ANY"
> 			x="TimeDate", i="missing", j="ANY", 
> value="numeric"
> 			
> 			Function: add (package AHLCalendar)
> 			x="TimeDate"
> 			
> 			Function: addMonths (package AHLCalendar)
> 			x="TimeDate"
> 			
> 			Function: addYears (package AHLCalendar)
> 			x="TimeDate"
> 			
> 			Function: align (package AHLCalendar)
> 			x="TimeDate", to="character"
> 			x="TimeDate", to="missing"
> 			
> 			Function: as.POSIXct (package base)
> 			x="TimeDate"
> 			
> 			Function: as.POSIXlt (package base)
> 			x="TimeDate"
> 			
> 			Function: coerce (package methods)
> 			from="TimeDate", to="TimeDateBase"
> 			
> 			Function: coerce<- (package methods)
> 			from="TimeDate", to="numeric"
> 			
> 			Function: dates (package AHLCalendar)
> 			x="TimeDate"
> 			
> 			Function: format (package base)
> 			x="TimeDate"
> 			
> 			Function: fxFwdDate (package AHLCalendar)
> 			x="TimeDate", country="character"
> 			
> 			Function: fxSettleDate (package AHLCalendar)
> 			x="TimeDate", country="character"
> 			
> 			Function: holidays (package AHLCalendar)
> 			x="TimeDate"
> 			
> 			Function: index (package AHLCalendar)
> 			x="TimeDate", y="POSIXt"
> 			x="TimeDate", y="Time"
> 			x="TimeDate", y="TimeDate"
> 			
> 			Function: initialize (package methods)
> 			.Object="TimeDate"
> 			    (inherited from: .Object="ANY")
> 			
> 			Function: leapYear (package AHLCalendar)
> 			x="TimeDate"
> 			
> 			Function: mday (package AHLCalendar)
> 			x="TimeDate"
> 			
> 			Function: mode (package base)
> 			x="TimeDate"
> 			    (inherited from: x="TimeDateBase")
> 			
> 			Function: mode<- (package base)
> 			x="TimeDate", value="character"
> 			    (inherited from: x="TimeDateBase", 
> value="character")
> 			
> 			Function: month (package AHLCalendar)
> 			x="TimeDate"
> 			
> 			Function: pretty (package base)
> 			x="TimeDate"
> 			
> 			Function: prettyFormat (package AHLCalendar)
> 			x="TimeDate", munit="character"
> 			x="TimeDate", munit="missing"
> 			
> 			Function: print (package base)
> 			x="TimeDate"
> 			
> 			Function: show (package methods)
> 			object="TimeDate"
> 			    (inherited from: object="TimeDateBase")
> 			
> 			Function: summary (package base)
> 			object="TimeDate"
> 			
> 			Function: td2tz (package AHLCalendar)
> 			x="TimeDate"
> 			
> 			Function: times (package AHLCalendar)
> 			x="TimeDate"
> 			
> 			Function: tojulian (package AHLCalendar)
> 			x="TimeDate"
> 			
> 			Function: toposix (package AHLCalendar)
> 			x="TimeDate"
> 			
> 			Function: tots (package AHLCalendar)
> 			x="TimeDate"
> 			
> 			Function: tzone (package AHLCalendar)
> 			x="TimeDate"
> 			
> 			Function: tzone<- (package AHLCalendar)
> 			x="TimeDate"
> 			
> 			Function: wday (package AHLCalendar)
> 			x="TimeDate"
> 			
> 			Function: yday (package AHLCalendar)
> 			x="TimeDate"
> 			
> 			Function: year (package AHLCalendar)
> 			x="TimeDate"
> 			
> 			
> 			
> 			Dr Oleg Sklyar
> 			Research Technologist
> 			AHL / Man Investments Ltd
> 			+44 (0)20 7144 3107
> 			osklyar at maninvestments.com
> 			
> 			
> 			
> 		
> **********************************************************************
> 			The contents of this email are for the named 
> 		addressee(s...{{dropped:22}}
> 			
> 			______________________________________________
> 			R-devel at r-project.org mailing list
> 			https://stat.ethz.ch/mailman/listinfo/r-devel
> 			
> 			  
> 		
> 		
> 		    
> 
> 	
> 	
> 	
> **********************************************************************
> 	The contents of this email are for the named 
> addressee(s...{{dropped:22}}
> 	
> 	______________________________________________
> 	R-devel at r-project.org mailing list
> 	https://stat.ethz.ch/mailman/listinfo/r-devel
> 	
> 	  
> 
> 


**********************************************************************
The contents of this email are for the named addressee(s...{{dropped:22}}


From hpages at fhcrc.org  Tue Sep  9 19:57:24 2008
From: hpages at fhcrc.org (Herve Pages)
Date: Tue, 09 Sep 2008 10:57:24 -0700
Subject: [Rd] Defining an alias for a generic function and callNextMethod()
 strange behaviour
Message-ID: <48C6B904.3010809@fhcrc.org>

Hi,

My package contains the following foo() generic and methods (simplified
version):

   setGeneric("foo", signature="x", function(x, y=NA) standardGeneric("foo"))
   setMethod("foo", "ANY", function(x, y=NA) list(x, y))
   setMethod("foo", "character", function(x, y=NA) unlist(callNextMethod()))

   > foo(5)
   [[1]]
   [1] 5

   [[2]]
   [1] NA

   > foo("a")
   [1] "a" NA

And I want to define a temporary alias for foo() for backward
compatibility with some existing code:

   oldfoo <- function(...) { .Deprecated("foo"); foo(...) }

   > oldfoo(5)
   [[1]]
   [1] 5

   [[2]]
   [1] NA

   Warning message:
   'oldfoo' is deprecated.
   Use 'foo' instead.
   See help("Deprecated")

   > oldfoo("a")
   Error in .nextMethod() : argument "x" is missing, with no default
   In addition: Warning message:
   'oldfoo' is deprecated.
   Use 'foo' instead.
   See help("Deprecated")

Why isn't this working?

One way to make this work is to specify the arguments in the call
to callNextMethod(), or in the definition of the oldfoo alias.
But wouldn't that be nice to be able to just use
fooalias <- function(...) foo(...) for aliasing?

Thanks!
H.


R version 2.7.0 (2008-04-22)
i686-pc-linux-gnu

locale:
LC_CTYPE=en_CA.UTF-8;LC_NUMERIC=C;LC_TIME=en_CA.UTF-8;LC_COLLATE=en_CA.UTF-8;LC_MONETARY=C;LC_MESSAGES=en_CA.UTF-8;LC_PAPER=en_CA.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_CA.UTF-8;LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base


From bill at insightful.com  Tue Sep  9 22:48:17 2008
From: bill at insightful.com (Bill Dunlap)
Date: Tue, 9 Sep 2008 13:48:17 -0700 (PDT)
Subject: [Rd] should system.file(package="no such pkg",
 "no such file") warn or abort?
Message-ID: <Pine.GSO.4.56.0809090917280.18500@devsun3201.insightful.com>

Currently
   system.file(package="no such pkg","no","such","file")
silently returns the empty string, "", if said file doesn't
exist.  This forces the caller to check for "" or risk getting
a mysterious error message from a function requiring a file
name.  E.g.,

   > read.dcf(system.file(package="no such pkg","DESCRIPTION"))
   Error in gzfile(file, "r") : cannot open the connection
   In addition: Warning message:
   In gzfile(file, "r") :
     cannot open compressed file '', probable reason 'No such file or directory'
   > readLines(system.file(package="no such pkg","no","such","file"))
   character(0)
   Warning message:
   In file(con, "r") :
     file("") only supports open = "w+" and open = "w+b": using the former
   > read.table(system.file(package="no such pkg","examples","data.txt"))
   Error in read.table(system.file(package = "no such pkg", "examples", "data.txt")) :
     no lines available in input
   In addition: Warning message:
   In file(file, "r") :
     file("") only supports open = "w+" and open = "w+b": using the former

I think it would help if system.file(), by default, threw an error
in this case.  It could have an argument to suppress the error
if the caller desires.  I suppose it could just have a warning.

I've attached a prototype, with the new argument missingFileOK=FALSE.
(I don't like the name, but didn't take the time to come up with
something better.)

   > read.table(system.file(package="no such pkg","examples","data.txt"))
   Error in system.file(package = "no such pkg", "examples", "data.txt") :
     Cannot find package "no such pkg"
   > read.table(system.file(package="base", "no", "such", "file"))
   Error in system.file(package = "base", "no", "such", "file") :
     Cannot find file "no/such/file" in package "base"
   > system.file(package="no such pkg","examples","data.txt", missingFileOK=TRUE)
   [1] ""

Is this sort of thing desirable?  It would require changes to
code that calls system.file() and checks for its output being "",
but it would make code that doesn't make the check work better.

`system.file` <-
function (..., package = "base", lib.loc = NULL, missingFileOK = FALSE)
{
    if (nargs() == 0)
        return(file.path(.Library, "base"))
    if (length(package) != 1)
        stop("'package' must be of length 1")
    packagePath <- .find.package(package, lib.loc, quiet = TRUE)
    if (length(packagePath) == 0) {
        if (missingFileOK)
            return("")
        else
            stop("Cannot find package ", dQuote(package))
    }
    FILES <- file.path(packagePath, ...)
    present <- file.exists(FILES)
    if (any(present))
        FILES[present]
    else if (missingFileOK)
        ""
    else stop("Cannot find file ", dQuote(file.path(...)), " in package ", dQuote(package))
}

The diffs are

--- system.file.R~	2008-09-09 13:47:06.608527000 -0700
+++ system.file.R	2008-09-09 11:46:41.509481000 -0700
@@ -1,16 +1,23 @@
 `system.file` <-
-function (..., package = "base", lib.loc = NULL)
+function (..., package = "base", lib.loc = NULL, missingFileOK = FALSE)
 {
     if (nargs() == 0)
         return(file.path(.Library, "base"))
     if (length(package) != 1)
         stop("'package' must be of length 1")
     packagePath <- .find.package(package, lib.loc, quiet = TRUE)
-    if (length(packagePath) == 0)
-        return("")
+    if (length(packagePath) == 0) {
+        if (missingFileOK)
+            return("")
+        else
+            stop("Cannot find package ", dQuote(package))
+    }
     FILES <- file.path(packagePath, ...)
     present <- file.exists(FILES)
     if (any(present))
         FILES[present]
-    else ""
+    else if (missingFileOK)
+        ""
+    else stop("Cannot find file ", dQuote(file.path(...)), " in package ", dQuote(package))
 }

----------------------------------------------------------------------------
Bill Dunlap
TIBCO Spotfire
bill at insightful dot com (for a while)

 "All statements in this message represent the opinions of the author and do
 not necessarily reflect TIBCO Software Inc. policy or position."


From pego.enrico at tiscali.it  Wed Sep 10 17:35:07 2008
From: pego.enrico at tiscali.it (pego.enrico at tiscali.it)
Date: Wed, 10 Sep 2008 17:35:07 +0200 (CEST)
Subject: [Rd] format() under Windows giv wrong resuts with posix data
	(PR#12770)
Message-ID: <20080910153507.83665282EFF6@mail.pubhealth.ku.dk>

Full_Name: Enrico Pegoraro
Version: 2.7.2
OS: Windows
Submission from: (NULL) (87.4.187.101)


The 
format(timevar,format="%I:%M:%S %p")
instruction, with "timevar" a "POSIXt"  "POSIXlt" variable, give wrong return
data.
The format sentence string "%I:%M:%S %p" requires times with AM/PM indicator,
but the resulting output doesn't contain it.
Example:
> pippo=strptime("23:43:12", format="%H:%M:%S")
> pippo
[1] "2008-09-10 23:43:12"
> class(pippo)
[1] "POSIXt"  "POSIXlt"
> format(pippo, format="%I:%M:%S %p")
[1] "11:43:12 "

Note that in linux version of R format() works correctly.
Best regards
Enrico


From ripley at stats.ox.ac.uk  Wed Sep 10 23:05:23 2008
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Wed, 10 Sep 2008 23:05:23 +0200 (CEST)
Subject: [Rd] (PR#12770) format() under Windows giv wrong resuts with
Message-ID: <20080910210523.C0C21282EFF8@mail.pubhealth.ku.dk>

On Windows XP SP3

> format(pippo, format="%I:%M:%S %p")
[1] "11:43:12 PM"

In any case, if there is a problem it is in Windows, not in R, since this 
is an Windows service that is being called.  So there is no evidence at 
all of any bug in R here.

On Wed, 10 Sep 2008, pego.enrico at tiscali.it wrote:

> Full_Name: Enrico Pegoraro
> Version: 2.7.2
> OS: Windows
> Submission from: (NULL) (87.4.187.101)
>
>
> The
> format(timevar,format="%I:%M:%S %p")
> instruction, with "timevar" a "POSIXt"  "POSIXlt" variable, give wrong return
> data.
> The format sentence string "%I:%M:%S %p" requires times with AM/PM indicator,
> but the resulting output doesn't contain it.
> Example:
>> pippo=strptime("23:43:12", format="%H:%M:%S")
>> pippo
> [1] "2008-09-10 23:43:12"
>> class(pippo)
> [1] "POSIXt"  "POSIXlt"
>> format(pippo, format="%I:%M:%S %p")
> [1] "11:43:12 "
>
> Note that in linux version of R format() works correctly.
> Best regards
> Enrico
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Wed Sep 10 23:20:10 2008
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Wed, 10 Sep 2008 23:20:10 +0200 (CEST)
Subject: [Rd] (PR#12770) format() under Windows giv wrong resuts with
Message-ID: <20080910212010.6F000282EFF6@mail.pubhealth.ku.dk>

On Wed, 10 Sep 2008, ripley at stats.ox.ac.uk wrote:

> On Windows XP SP3
>
>> format(pippo, format="%I:%M:%S %p")
> [1] "11:43:12 PM"
>
> In any case, if there is a problem it is in Windows, not in R, since this
> is an Windows service that is being called.  So there is no evidence at
> all of any bug in R here.

Let me add that this might be a locale-specific issue: the locale was not 
given (despite being part of the 'at a minimum' information asked for in 
the posting guide). Note that the help page does say

      '%p' AM/PM indicator in the locale.  Used in conjuction with '%I'
                           ^^^^^^^^^^^^^
Not all locales have such an indicator (usually those that use a 24-hour 
clock).

> On Wed, 10 Sep 2008, pego.enrico at tiscali.it wrote:
>
>> Full_Name: Enrico Pegoraro
>> Version: 2.7.2
>> OS: Windows
>> Submission from: (NULL) (87.4.187.101)
>>
>>
>> The
>> format(timevar,format="%I:%M:%S %p")
>> instruction, with "timevar" a "POSIXt"  "POSIXlt" variable, give wrong return
>> data.
>> The format sentence string "%I:%M:%S %p" requires times with AM/PM indicator,
>> but the resulting output doesn't contain it.
>> Example:
>>> pippo=strptime("23:43:12", format="%H:%M:%S")
>>> pippo
>> [1] "2008-09-10 23:43:12"
>>> class(pippo)
>> [1] "POSIXt"  "POSIXlt"
>>> format(pippo, format="%I:%M:%S %p")
>> [1] "11:43:12 "
>>
>> Note that in linux version of R format() works correctly.
>> Best regards
>> Enrico
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
> -- 
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From bill at insightful.com  Wed Sep 10 23:46:46 2008
From: bill at insightful.com (Bill Dunlap)
Date: Wed, 10 Sep 2008 14:46:46 -0700 (PDT)
Subject: [Rd] (PR#12770) format() under Windows giv wrong resuts with
In-Reply-To: <20080910210523.C0C21282EFF8@mail.pubhealth.ku.dk>
References: <20080910210523.C0C21282EFF8@mail.pubhealth.ku.dk>
Message-ID: <Pine.GSO.4.56.0809101442230.27938@devsun3201.insightful.com>

I can reproduce the problem on Windows XP service pack 3
with R 2.8.0-dev if I set the locale to "italian" (by default
it is English_United States" for me):
   > pippo=strptime("23:43:12", format="%H:%M:%S")
   > format(pippo, format="%I:%M:%S %p")
   [1] "11:43:12 PM"
   > Sys.setlocale(loc="italian")
   [1] "LC_COLLATE=Italian_Italy.1252;LC_CTYPE=Italian_Italy.1252;LC_MONETARY=Italian_Italy.1252;LC_NUMERIC=C;LC_TIME=Italian_Italy.1252"
   >  format(pippo, format="%I:%M:%S %p")
   [1] "11:43:12 "
It does look like a Windows problem.

On Wed, 10 Sep 2008 ripley at stats.ox.ac.uk wrote:

> On Windows XP SP3
>
> > format(pippo, format="%I:%M:%S %p")
> [1] "11:43:12 PM"
>
> In any case, if there is a problem it is in Windows, not in R, since this
> is an Windows service that is being called.  So there is no evidence at
> all of any bug in R here.
>
> On Wed, 10 Sep 2008, pego.enrico at tiscali.it wrote:
>
> > Full_Name: Enrico Pegoraro
> > Version: 2.7.2
> > OS: Windows
> > Submission from: (NULL) (87.4.187.101)
> >
> >
> > The
> > format(timevar,format="%I:%M:%S %p")
> > instruction, with "timevar" a "POSIXt"  "POSIXlt" variable, give wrong return
> > data.
> > The format sentence string "%I:%M:%S %p" requires times with AM/PM indicator,
> > but the resulting output doesn't contain it.
> > Example:
> >> pippo=strptime("23:43:12", format="%H:%M:%S")
> >> pippo
> > [1] "2008-09-10 23:43:12"
> >> class(pippo)
> > [1] "POSIXt"  "POSIXlt"
> >> format(pippo, format="%I:%M:%S %p")
> > [1] "11:43:12 "
> >
> > Note that in linux version of R format() works correctly.
> > Best regards
> > Enrico
> ... signatures ...

----------------------------------------------------------------------------
Bill Dunlap
TIBCO Spotfire
wdunlap tibco.com

 "All statements in this message represent the opinions of the author and do
 not necessarily reflect TIBCO Software Inc. policy or position."


From bill at insightful.com  Wed Sep 10 23:57:30 2008
From: bill at insightful.com (Bill Dunlap)
Date: Wed, 10 Sep 2008 14:57:30 -0700 (PDT)
Subject: [Rd] (PR#12770) format() under Windows giv wrong resuts w
In-Reply-To: <Pine.GSO.4.56.0809101442230.27938@devsun3201.insightful.com>
References: <20080910210523.C0C21282EFF8@mail.pubhealth.ku.dk>
	<Pine.GSO.4.56.0809101442230.27938@devsun3201.insightful.com>
Message-ID: <Pine.GSO.4.56.0809101450580.27938@devsun3201.insightful.com>

On Wed, 10 Sep 2008, Bill Dunlap wrote:

> I can reproduce the problem on Windows XP service pack 3
> with R 2.8.0-dev if I set the locale to "italian" (by default
> it is English_United States" for me):
>    > pippo=strptime("23:43:12", format="%H:%M:%S")
>    > format(pippo, format="%I:%M:%S %p")
>    [1] "11:43:12 PM"
>    > Sys.setlocale(loc="italian")
>    [1] "LC_COLLATE=Italian_Italy.1252;LC_CTYPE=Italian_Italy.1252;LC_MONETARY=Italian_Italy.1252;LC_NUMERIC=C;LC_TIME=Italian_Italy.1252"
>    >  format(pippo, format="%I:%M:%S %p")
>    [1] "11:43:12 "
> It does look like a Windows problem.

It prints PM (or p.m.) for locales Engish_Canada, English_United Kingdom,
English_United States, and Spanish_Mexico.  It prints nothing in the
am/pm slot for English_Ireland, Italian, Spanish_Spain, and French_Canada.

> On Wed, 10 Sep 2008 ripley at stats.ox.ac.uk wrote:
>
> > On Windows XP SP3
> >
> > > format(pippo, format="%I:%M:%S %p")
> > [1] "11:43:12 PM"
> >
> > In any case, if there is a problem it is in Windows, not in R, since this
> > is an Windows service that is being called.  So there is no evidence at
> > all of any bug in R here.
> >
> > On Wed, 10 Sep 2008, pego.enrico at tiscali.it wrote:
> >
> > > Full_Name: Enrico Pegoraro
> > > Version: 2.7.2
> > > OS: Windows
> > > Submission from: (NULL) (87.4.187.101)
> > >
> > >
> > > The
> > > format(timevar,format="%I:%M:%S %p")
> > > instruction, with "timevar" a "POSIXt"  "POSIXlt" variable, give wrong return
> > > data.
> > > The format sentence string "%I:%M:%S %p" requires times with AM/PM indicator,
> > > but the resulting output doesn't contain it.
> > > Example:
> > >> pippo=strptime("23:43:12", format="%H:%M:%S")
> > >> pippo
> > > [1] "2008-09-10 23:43:12"
> > >> class(pippo)
> > > [1] "POSIXt"  "POSIXlt"
> > >> format(pippo, format="%I:%M:%S %p")
> > > [1] "11:43:12 "
> > >
> > > Note that in linux version of R format() works correctly.
> > > Best regards
> > > Enrico
> > ... signatures ...
>
> ----------------------------------------------------------------------------
> Bill Dunlap
> TIBCO Spotfire
> wdunlap tibco.com
>
>  "All statements in this message represent the opinions of the author and do
>  not necessarily reflect TIBCO Software Inc. policy or position."
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

----------------------------------------------------------------------------
Bill Dunlap
TIBCO Spotfire
wdunlap tibco.com

 "All statements in this message represent the opinions of the author and do
 not necessarily reflect TIBCO Software Inc. policy or position."


From ripley at stats.ox.ac.uk  Thu Sep 11 09:30:28 2008
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Thu, 11 Sep 2008 09:30:28 +0200 (CEST)
Subject: [Rd] (PR#12770) format() under Windows giv wrong resuts with
Message-ID: <20080911073028.A3D87282EFF6@mail.pubhealth.ku.dk>

On Wed, 10 Sep 2008, Bill Dunlap wrote:

> I can reproduce the problem on Windows XP service pack 3
> with R 2.8.0-dev if I set the locale to "italian" (by default
> it is English_United States" for me):
>   > pippo=strptime("23:43:12", format="%H:%M:%S")
>   > format(pippo, format="%I:%M:%S %p")
>   [1] "11:43:12 PM"
>   > Sys.setlocale(loc="italian")
>   [1] "LC_COLLATE=Italian_Italy.1252;LC_CTYPE=Italian_Italy.1252;LC_MONETARY=Italian_Italy.1252;LC_NUMERIC=C;LC_TIME=Italian_Italy.1252"
>   >  format(pippo, format="%I:%M:%S %p")
>   [1] "11:43:12 "
> It does look like a Windows problem.

Or a deliberate locale definition on Windows.  The R help does say

      Locale-specific conversions to and from character strings are used
      where appropriate and available.  This affects the names of the
      days and months, the AM/PM indicator (if used) and the separators
      in formats such as '%x' and '%X'.

and AFAICS none is used in the Italian locale on Windows XP.  (POSIX does 
not say that this is allowed to be empty, but it also does not say that it 
not allowed.)

>
> On Wed, 10 Sep 2008 ripley at stats.ox.ac.uk wrote:
>
>> On Windows XP SP3
>>
>>> format(pippo, format="%I:%M:%S %p")
>> [1] "11:43:12 PM"
>>
>> In any case, if there is a problem it is in Windows, not in R, since this
>> is an Windows service that is being called.  So there is no evidence at
>> all of any bug in R here.
>>
>> On Wed, 10 Sep 2008, pego.enrico at tiscali.it wrote:
>>
>>> Full_Name: Enrico Pegoraro
>>> Version: 2.7.2
>>> OS: Windows
>>> Submission from: (NULL) (87.4.187.101)
>>>
>>>
>>> The
>>> format(timevar,format="%I:%M:%S %p")
>>> instruction, with "timevar" a "POSIXt"  "POSIXlt" variable, give wrong return
>>> data.
>>> The format sentence string "%I:%M:%S %p" requires times with AM/PM indicator,
>>> but the resulting output doesn't contain it.
>>> Example:
>>>> pippo=strptime("23:43:12", format="%H:%M:%S")
>>>> pippo
>>> [1] "2008-09-10 23:43:12"
>>>> class(pippo)
>>> [1] "POSIXt"  "POSIXlt"
>>>> format(pippo, format="%I:%M:%S %p")
>>> [1] "11:43:12 "
>>>
>>> Note that in linux version of R format() works correctly.
>>> Best regards
>>> Enrico
>> ... signatures ...
>
> ----------------------------------------------------------------------------
> Bill Dunlap
> TIBCO Spotfire
> wdunlap tibco.com
>
> "All statements in this message represent the opinions of the author and do
> not necessarily reflect TIBCO Software Inc. policy or position."
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From h.wickham at gmail.com  Fri Sep 12 04:45:26 2008
From: h.wickham at gmail.com (hadley wickham)
Date: Thu, 11 Sep 2008 21:45:26 -0500
Subject: [Rd] Bug in cut.Dates with single date and day breaks
Message-ID: <f8e6ff050809111945l364eb05fu8800a35dc7f577ee@mail.gmail.com>

> cut(as.Date("2008-09-12"), "days")
Error in 1:(1 + max(which(breaks < maxx))) :
  result would be too long a vector
In addition: Warning message:
In max(which(breaks < maxx)) :
  no non-missing arguments to max; returning -Inf
> cut(as.Date("2008-09-12"), "weeks")
[1] 2008-09-08
Levels: 2008-09-08
> cut(as.Date("2008-09-12"), "7 days")
Error in 1:(1 + max(which(breaks < maxx))) :
  result would be too long a vector
In addition: Warning message:
In max(which(breaks < maxx)) :
  no non-missing arguments to max; returning -Inf

Hadley

-- 
http://had.co.nz/


From ligges at statistik.tu-dortmund.de  Fri Sep 12 15:15:32 2008
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Fri, 12 Sep 2008 15:15:32 +0200
Subject: [Rd] win-builder offline on Sept. 13
Message-ID: <48CA6B74.40608@statistik.tu-dortmund.de>

Hi,

tomorrow, saturday, September 13, our department (and hence win-builder 
as well as building of any packages for Windows) will be offline. Since 
the IT room gets new fire protection walls, we will have to move out 
whole IT equipment for 3 weeks...

Uwe Ligges


From bates at stat.wisc.edu  Fri Sep 12 19:21:30 2008
From: bates at stat.wisc.edu (Douglas Bates)
Date: Fri, 12 Sep 2008 12:21:30 -0500
Subject: [Rd] Reaching R-forge - tunnel ssh through ssh?
Message-ID: <40e66e0b0809121021v696c00b5hb96a57a54356b852@mail.gmail.com>

This question is only related to R-devel in that I need to work out
how to reach R-forge.R-project.org to update and commit files of R
packages for which I am a developer.

My desktop computer at work runs Ubuntu 8.04.  Because this is not a
supported operating system this computer is behind a firewall.  I can
use a proxy server for http, https and rsync connections.  However,
the proxy server does not allow outgoing (or incoming) ssh
connections.  I can use ssh to log in to a local computer that is not
behind the firewall and then use svn+ssh to contact R-forge.  I have
managed to get myself into a bind with that scheme, however.  I added
and deleted files on the checked out copy on the shared file system
using my desktop and then could not check in the changes from the
"visible" machine because of svn version skew.  The "visible" machine
has an out-of-date version of svn.

Does anyone know how to tunnel ssh over ssh and, further, how I would
specify that in the svn checkin?  If my desktop computer is A, the
"visible" computer is B and the R-forge server is C then I want to use
ssh to set up a tunnel between A and B so that A can reach C for an
svn+ssh checkin.

Off-list replies would be welcome.


From bolker at ufl.edu  Fri Sep 12 20:15:04 2008
From: bolker at ufl.edu (Ben Bolker)
Date: Fri, 12 Sep 2008 14:15:04 -0400
Subject: [Rd] tiny typo in NEWS
Message-ID: <48CAB1A8.6060806@ufl.edu>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1


"browseURL"

    o	brwoseURL() has a new argument 'encodeIfNeeded' to use
	URLencode() in cases where it seems likely that would be
	helpful.  (Unfortunately, those are hard to guess.)


  By the way, thank you !!! to the R developers for

o cov() and cor() newly have the new option 'use = "everything"' as
 default, and so does var() with its default 'na.rm = FALSE'.  This
returns NA instead of signalling an error for NA observations.

   which seems as though it will restore the pre-2.7.0 behavior
for all-missing data ...

  Ben Bolker
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org

iD8DBQFIyrGoc5UpGjwzenMRAoQ+AJ9AI/WLKERA/VJqwALTspSKx3eHAQCeOh6Q
9lpwQnpit3eH1UZ3Xi7tbyg=
=B+d+
-----END PGP SIGNATURE-----


From murdoch at stats.uwo.ca  Fri Sep 12 23:37:10 2008
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Fri, 12 Sep 2008 17:37:10 -0400
Subject: [Rd] tiny typo in NEWS
In-Reply-To: <48CAB1A8.6060806@ufl.edu>
References: <48CAB1A8.6060806@ufl.edu>
Message-ID: <48CAE106.3080207@stats.uwo.ca>

Ben Bolker wrote:
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
>
> "browseURL"
>
>     o	brwoseURL() has a new argument 'encodeIfNeeded' to use
> 	URLencode() in cases where it seems likely that would be
> 	helpful.  (Unfortunately, those are hard to guess.)
>   

Thanks.  Usually there's no need to report NEWS typos quickly; I read 
the RSS feed (see http://developer.r-project.org/RSSfeeds.html) and fix 
what I see.  (In this case Brian Ripley got to it first.)  But if 
something there is more than a few days old, we probably missed it.

Duncan Murdoch
>
>   By the way, thank you !!! to the R developers for
>
> o cov() and cor() newly have the new option 'use = "everything"' as
>  default, and so does var() with its default 'na.rm = FALSE'.  This
> returns NA instead of signalling an error for NA observations.
>
>    which seems as though it will restore the pre-2.7.0 behavior
> for all-missing data ...
>
>   Ben Bolker
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v1.4.6 (GNU/Linux)
> Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org
>
> iD8DBQFIyrGoc5UpGjwzenMRAoQ+AJ9AI/WLKERA/VJqwALTspSKx3eHAQCeOh6Q
> 9lpwQnpit3eH1UZ3Xi7tbyg=
> =B+d+
> -----END PGP SIGNATURE-----
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From blundellc at gmail.com  Fri Sep 12 22:10:14 2008
From: blundellc at gmail.com (blundellc at gmail.com)
Date: Fri, 12 Sep 2008 22:10:14 +0200 (CEST)
Subject: [Rd] write.dcf does not quote as Debian would like it to (PR#12816)
Message-ID: <20080912201014.865A0282C765@mail.pubhealth.ku.dk>

Full_Name: charles blundell
Version: 2.7.0
OS: Debian GNU/Linux
Submission from: (NULL) (217.37.73.202)


The Debian Policy Manual says concerning lines in a Description field:
 * Those containing a space, a full stop and some more characters. These are for
future expansion. Do not use them. 
(section 5.6.13, http://www.debian.org/doc/debian-policy/ch-controlfields.html)

But for example:
> write.dcf(list(Description = 'there was a fat goat .haha'),indent=1,width=10)
Description:
 there
 was a
 fat goat
 .haha

A simple quoting scheme is to add a space in front of such full stops:
--- src/library/base/R/dcf.R.orig       2008-09-12 20:42:37.000000000 +0100
+++ src/library/base/R/dcf.R    2008-09-12 20:54:16.000000000 +0100
@@ -133,7 +133,7 @@
     ## * We have to handle multiple fields per record.

     escape_paragraphs <- function(s)
-        gsub("\n[[:space:]]*\n", "\n .\n ", s)
+        gsub("\n \\.([^\n])","\n  .\\1", gsub("\n[[:space:]]*\n", "\n .\n ",
s))

     if(!is.data.frame(x))
         x <- as.data.frame(x, stringsAsFactors = FALSE)


As so:
> write.dcf(list(Description = 'there was a fat goat .haha'),indent=1,width=10)
Description:
 there
 was a
 fat goat
  .haha

Doing this makes life easier for cran2deb as we can generate valid Debian
control files using write.dcf.


From maechler at stat.math.ethz.ch  Sat Sep 13 15:25:19 2008
From: maechler at stat.math.ethz.ch (maechler at stat.math.ethz.ch)
Date: Sat, 13 Sep 2008 15:25:19 +0200 (CEST)
Subject: [Rd] write.dcf does not quote as Debian would like it to
	(PR#12816)
Message-ID: <20080913132519.5D423282EF48@mail.pubhealth.ku.dk>

>>>>> "chb" == blundellc  <blundellc at gmail.com>
>>>>>     on Fri, 12 Sep 2008 22:10:14 +0200 (CEST) writes:

    chb> Full_Name: charles blundell
    chb> Version: 2.7.0
    chb> OS: Debian GNU/Linux
    chb> Submission from: (NULL) (217.37.73.202)


    chb> The Debian Policy Manual says concerning lines in a
    chb> Description field: * Those containing a space, a full
    chb> stop and some more characters. These are for future
    chb> expansion. Do not use them.  (section 5.6.13,
    chb> http://www.debian.org/doc/debian-policy/ch-controlfields.html)

    chb> But for example:
    >> write.dcf(list(Description = 'there was a fat goat .haha'),indent=1,width=10)
    chb> Description:
    chb>  there
    chb>  was a
    chb>  fat goat
    chb>  .haha

    chb> A simple quoting scheme is to add a space in front of such full stops:
    chb> --- src/library/base/R/dcf.R.orig       2008-09-12 20:42:37.000000000 +0100
    chb> +++ src/library/base/R/dcf.R    2008-09-12 20:54:16.000000000 +0100
    chb> @@ -133,7 +133,7 @@
    chb> ## * We have to handle multiple fields per record.

    chb> escape_paragraphs <- function(s)
    chb> -        gsub("\n[[:space:]]*\n", "\n .\n ", s)
    chb> +        gsub("\n \\.([^\n])","\n  .\\1", gsub("\n[[:space:]]*\n", "\n .\n ",
    chb> s))

    chb> if(!is.data.frame(x))
    chb> x <- as.data.frame(x, stringsAsFactors = FALSE)


    chb> As so:
    >> write.dcf(list(Description = 'there was a fat goat .haha'),indent=1,width=10)
    chb> Description:
    chb>  there
    chb>  was a
    chb>  fat goat
    chb>   .haha

    chb> Doing this makes life easier for cran2deb as we can
    chb> generate valid Debian control files using write.dcf.

That sounds a good enough reason to make the change, notably
since I cannot see a case (in other uses of write.dcf())
where this would be undesirable.

I'm going to test this quickly and will most probably add it to
R-devel (R.2.8.0 to be).

Martin Maechler, ETH Zurich


From maechler at stat.math.ethz.ch  Sat Sep 13 16:29:03 2008
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Sat, 13 Sep 2008 16:29:03 +0200
Subject: [Rd] .. var() fails on NA in R 2.7.2 but not R 2.6.1
In-Reply-To: <3c12769c0809051550j6b52f6a5y2329de79b25d66de@mail.gmail.com>
References: <20080905223827.GA61846@piskorski.com>
	<3c12769c0809051548m2aa78da8i296e1a607576789@mail.gmail.com>
	<3c12769c0809051550j6b52f6a5y2329de79b25d66de@mail.gmail.com>
Message-ID: <18635.52783.33920.673292@cmath-4.math.ethz.ch>

Hi,
I'm getting back to this topic, from a slightly different angle:

>>>>> "HenricN" == Henric Nilsson (Public) <nilsson.henric at gmail.com>
>>>>>     on Sat, 06 Sep 2008 03:47:06 +0200 writes:

    HenricN> Andrew Piskorski wrote:
    >> I recently started using R 2.7.2, and noticed a surprising change in
    >> the behavior of var() on NA data:
    >>
    >> R 2.6.1 (Patched), 2007-11-26, svn.rev 43541, x86_64-unknown-linux-gnu:
    >>
    >> > var(rep(NA,3))
    >> [1] NA

  [.................]

After some R-core internal discussion,
I have implemented the following two changes in 
R-devel {to be R 2.8.0 soon}, and I'm hereby "RFCing" i.e.,
requesting for (your) comments: 

1) cov() & cor()  gain a new option 'use = "everything"',
  *and* that is the new default in the cases where "all.obs" has been the
  default, i.e. including the default uses  of var() or sd()
  {Andy had stdev(), but that's not a standard R function}.

  Explicit use of  use = "all.obs" (or other previously existing
  options of 'use') will remain unchanged of course.

  The new implementation (of use = "everything"), as committed to R-devel
  a few days ago,  basically replaces all error messages
    "missing observations in cov/cor"  (and *only* those, at the moment!)
  by returning  NA  in the corresponding places
  (many, if we have a cov/var/cor *matrix*).

2)  cov() & cor()  gain a new option 'use = "na.or.complete"',
              {better proposals for this "na.or.complete" are still
               welcome, but please think twice: we have partial matching...}
  *and* that is the new default in the cases where "complete.obs" has been the
  default, notably for var(*, na.rm=TRUE).
  Consequently, all of
       var(double(0))
       var(double(0), na.rm=TRUE)
  and  var(NA, na.rm=TRUE)
  now return  NA  instead of an error
  { "empty 'x'" or  "no complete element pairs" }

  This will entail that

    i.  {empty vector <==> {vector of all NAs (= empty after na.omit)}
   ii.  var(<empty>) |->  NA

  by default.

---- 

Feedback is very welcome!

Martin Maechler, ETH Zurich and R core team.


From dutangc at gmail.com  Sat Sep 13 22:14:06 2008
From: dutangc at gmail.com (Christophe Dutang)
Date: Sat, 13 Sep 2008 22:14:06 +0200
Subject: [Rd] package config file for windows
Message-ID: <6A994D5B-AA3B-4C2A-A3DF-2BF82E1D442F@gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20080913/a339cda4/attachment.pl>

From murdoch at stats.uwo.ca  Sun Sep 14 01:11:23 2008
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Sat, 13 Sep 2008 19:11:23 -0400
Subject: [Rd] package config file for windows
In-Reply-To: <6A994D5B-AA3B-4C2A-A3DF-2BF82E1D442F@gmail.com>
References: <6A994D5B-AA3B-4C2A-A3DF-2BF82E1D442F@gmail.com>
Message-ID: <48CC489B.8090904@stats.uwo.ca>

Christophe Dutang wrote:
> Hi,
>
> I'm maintaining randtoolbox package on CRAN and I wonder how to do a  
> windows config file? I need to test SSE2 instructions support as well  
> as inttypes.h library check.
>
> Currently I use the trick of 'foreign' package, i.e. I have config.win  
> file with
> cp -p src/config.h.win src/config.h
> and config.h.win was written manually from config.h.in. There is no  
> test at all on windows.
>
> In 'writing r extension' on this topic, we find
> "
> You should bear in mind that the con???gure script may well not work on  
> Windows systems
> (this seems normally to be the case for those generated by Autoconf,  
> although simple shell scripts
> do work). If your package is to be made publicly available, please  
> give enough information for a
> user on a non-Unix platform to con???gure it manually, or provide a  
> ???configure.win??? script to be
> used on that platform. (Optionally, there can be a ???cleanup.win???  
> script as well. Both should
> be shell scripts to be executed by ash, which is a minimal version of  
> Bourne-style sh.)
> "
> Which tool do I need to write config script on windows? Do I need an  
> autoconf-cygwin solution? ( http://sources.redhat.com/autobook/autobook/autobook_242.html#SEC242 
>   ) or just a port of autoconf available on sourceforge?
>   
I think most configure scripts on Windows were written using a text 
editor, i.e. by hand. Windows systems are pretty consistent, so the 
kinds of tests and searches that you need to do on *nix aren't needed. 
You can assume that the Rtools are installed, but don't rely on anything 
else. We're unlikely to drop tools from that collection, so this advice 
should last quite a while.

Duncan Murdoch
>
> Thanks in advance
>
>
> Christophe
> 	[[alternative HTML version deleted]]
>
>   
> ------------------------------------------------------------------------
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From marzio.sala at gmail.com  Sun Sep 14 10:51:09 2008
From: marzio.sala at gmail.com (Marzio Sala)
Date: Sun, 14 Sep 2008 10:51:09 +0200
Subject: [Rd] Using R from Java
Message-ID: <a7479ce00809140151r7ec62d74k91d003f194a32341@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20080914/6f3aef3a/attachment.pl>

From tobias.verbeke at gmail.com  Sun Sep 14 11:13:37 2008
From: tobias.verbeke at gmail.com (Tobias Verbeke)
Date: Sun, 14 Sep 2008 11:13:37 +0200
Subject: [Rd] Using R from Java
In-Reply-To: <a7479ce00809140151r7ec62d74k91d003f194a32341@mail.gmail.com>
References: <a7479ce00809140151r7ec62d74k91d003f194a32341@mail.gmail.com>
Message-ID: <48CCD5C1.4080605@gmail.com>

Hi Marzio,

> I am interesting in using R from a web application, for basic statistics and
> plots. The server is Java-based (tomcat).
> The simplest solution is a system call that generates the text or the image,
> then the servlet forwards the output. This can be done from any language,
> but it is quite inelegant and slow for the initialization time.
> 
> Is there any package or approach for accessing R from a Java servlet you can
> suggest?

The biocep project might be a good match, see

http://biocep-distrib.r-forge.r-project.org/doc.html

HTH,
Tobias


From dutangc at gmail.com  Sun Sep 14 11:26:03 2008
From: dutangc at gmail.com (Christophe Dutang)
Date: Sun, 14 Sep 2008 11:26:03 +0200
Subject: [Rd] package config file for windows
In-Reply-To: <48CC489B.8090904@stats.uwo.ca>
References: <6A994D5B-AA3B-4C2A-A3DF-2BF82E1D442F@gmail.com>
	<48CC489B.8090904@stats.uwo.ca>
Message-ID: <6F0C127F-2354-49E8-B627-4ED6CEA1D5E3@gmail.com>

Thanks for your answer.

You confirm what I fear, it is not easily possible to test for SSE2  
support on windows.

Can I assume there exists inttypes.h on windows platform?

Thanks again

Christophe

Le 14 sept. 08 ? 01:11, Duncan Murdoch a ?crit :

> Christophe Dutang wrote:
>> Hi,
>>
>> I'm maintaining randtoolbox package on CRAN and I wonder how to do  
>> a  windows config file? I need to test SSE2 instructions support as  
>> well  as inttypes.h library check.
>>
>> Currently I use the trick of 'foreign' package, i.e. I have  
>> config.win  file with
>> cp -p src/config.h.win src/config.h
>> and config.h.win was written manually from config.h.in. There is  
>> no  test at all on windows.
>>
>> In 'writing r extension' on this topic, we find
>> "
>> You should bear in mind that the con?gure script may well not work  
>> on  Windows systems
>> (this seems normally to be the case for those generated by  
>> Autoconf,  although simple shell scripts
>> do work). If your package is to be made publicly available, please   
>> give enough information for a
>> user on a non-Unix platform to con?gure it manually, or provide a   
>> ?configure.win? script to be
>> used on that platform. (Optionally, there can be a  
>> ?cleanup.win?  script as well. Both should
>> be shell scripts to be executed by ash, which is a minimal version  
>> of  Bourne-style sh.)
>> "
>> Which tool do I need to write config script on windows? Do I need  
>> an  autoconf-cygwin solution? ( http://sources.redhat.com/autobook/autobook/autobook_242.html#SEC242 
>>    ) or just a port of autoconf available on sourceforge?
>>
> I think most configure scripts on Windows were written using a text  
> editor, i.e. by hand. Windows systems are pretty consistent, so the  
> kinds of tests and searches that you need to do on *nix aren't  
> needed. You can assume that the Rtools are installed, but don't rely  
> on anything else. We're unlikely to drop tools from that collection,  
> so this advice should last quite a while.
>
> Duncan Murdoch
>>
>> Thanks in advance
>>
>>
>> Christophe
>> 	[[alternative HTML version deleted]]
>>
>>   
>> ------------------------------------------------------------------------
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>


From murdoch at stats.uwo.ca  Sun Sep 14 14:41:40 2008
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Sun, 14 Sep 2008 08:41:40 -0400
Subject: [Rd] package config file for windows
In-Reply-To: <6F0C127F-2354-49E8-B627-4ED6CEA1D5E3@gmail.com>
References: <6A994D5B-AA3B-4C2A-A3DF-2BF82E1D442F@gmail.com>
	<48CC489B.8090904@stats.uwo.ca>
	<6F0C127F-2354-49E8-B627-4ED6CEA1D5E3@gmail.com>
Message-ID: <48CD0684.5060607@stats.uwo.ca>

On 14/09/2008 5:26 AM, Christophe Dutang wrote:
> Thanks for your answer.
> 
> You confirm what I fear, it is not easily possible to test for SSE2  
> support on windows.

> Can I assume there exists inttypes.h on windows platform?

I think you misunderstood.  The test scripts produced by autoconf won't 
necessarily work on Windows, but it's still worth trying.  Just extract 
the tests for SSE2 and inttypes.h from your script on some other 
platform, and adapt them to Windows.  They can probably be shortened, 
because there's less variability.

You can count on Windows using gcc 4.x for current and future versions, 
probably until 5.x becomes commonly used.  I don't know if inttypes.h is 
guaranteed in all of those, but it is currently present.

Duncan Murdoch

> 
> Thanks again
> 
> Christophe
> 
> Le 14 sept. 08 ? 01:11, Duncan Murdoch a ?crit :
> 
>> Christophe Dutang wrote:
>>> Hi,
>>>
>>> I'm maintaining randtoolbox package on CRAN and I wonder how to do  
>>> a  windows config file? I need to test SSE2 instructions support as  
>>> well  as inttypes.h library check.
>>>
>>> Currently I use the trick of 'foreign' package, i.e. I have  
>>> config.win  file with
>>> cp -p src/config.h.win src/config.h
>>> and config.h.win was written manually from config.h.in. There is  
>>> no  test at all on windows.
>>>
>>> In 'writing r extension' on this topic, we find
>>> "
>>> You should bear in mind that the con?gure script may well not work  
>>> on  Windows systems
>>> (this seems normally to be the case for those generated by  
>>> Autoconf,  although simple shell scripts
>>> do work). If your package is to be made publicly available, please   
>>> give enough information for a
>>> user on a non-Unix platform to con?gure it manually, or provide a   
>>> ?configure.win? script to be
>>> used on that platform. (Optionally, there can be a  
>>> ?cleanup.win?  script as well. Both should
>>> be shell scripts to be executed by ash, which is a minimal version  
>>> of  Bourne-style sh.)
>>> "
>>> Which tool do I need to write config script on windows? Do I need  
>>> an  autoconf-cygwin solution? ( http://sources.redhat.com/autobook/autobook/autobook_242.html#SEC242 
>>>    ) or just a port of autoconf available on sourceforge?
>>>
>> I think most configure scripts on Windows were written using a text  
>> editor, i.e. by hand. Windows systems are pretty consistent, so the  
>> kinds of tests and searches that you need to do on *nix aren't  
>> needed. You can assume that the Rtools are installed, but don't rely  
>> on anything else. We're unlikely to drop tools from that collection,  
>> so this advice should last quite a while.
>>
>> Duncan Murdoch
>>> Thanks in advance
>>>
>>>
>>> Christophe
>>> 	[[alternative HTML version deleted]]
>>>
>>>   
>>> ------------------------------------------------------------------------
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>


From mtmorgan at fhcrc.org  Sun Sep 14 15:05:18 2008
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Sun, 14 Sep 2008 06:05:18 -0700
Subject: [Rd] Using R from Java
In-Reply-To: <a7479ce00809140151r7ec62d74k91d003f194a32341@mail.gmail.com>
	(Marzio Sala's message of "Sun, 14 Sep 2008 10:51:09 +0200")
References: <a7479ce00809140151r7ec62d74k91d003f194a32341@mail.gmail.com>
Message-ID: <6phabea27zl.fsf@lamprey.fhcrc.org>

Hi Marzio --

"Marzio Sala" <marzio.sala at gmail.com> writes:

> Hello,
>
> I am interesting in using R from a web application, for basic statistics and
> plots. The server is Java-based (tomcat).
> The simplest solution is a system call that generates the text or the image,
> then the servlet forwards the output. This can be done from any language,
> but it is quite inelegant and slow for the initialization time.
>
> Is there any package or approach for accessing R from a Java servlet you can
> suggest?

The FAQ has a section on R Web Interfaces

http://cran.r-project.org/doc/FAQ/R-FAQ.html#R-Web-Interfaces

include R/Apache and RServe. There is also Bioconductor's
RWebServices,

http://bioconductor.org/packages/2.2/bioc/html/RWebServices.html

which produces soap-based web services from (strongly-typed) R
packages.

Martin

>
> Thanks in advance for any suggestion.
>
> Regards,
> -Marzio
>
> -- 
> http://marzio.sala.googlepages.com
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Martin Morgan
Computational Biology / Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N.
PO Box 19024 Seattle, WA 98109

Location: Arnold Building M2 B169
Phone: (206) 667-2793


From pgilbert at bank-banque-canada.ca  Mon Sep 15 14:56:06 2008
From: pgilbert at bank-banque-canada.ca (Paul Gilbert)
Date: Mon, 15 Sep 2008 08:56:06 -0400
Subject: [Rd] S4 coercion responsibility
Message-ID: <48CE5B66.1050705@bank-banque-canada.ca>

Should functions or the user be responsible for coercing an S4 object 
argument containing the proper object (and thus should below be 
considered a bug in the packages or not)?

The example is  with RSQLite but the same thing happens with RMySQL, and 
other DBI packages.

 > library("RSQLite")  Loading required package: DBI
 > m <- dbDriver("SQLite")
 > con <- dbConnect(m)
 > setClass("SQLConPlus", contains=c("SQLiteConnection","integer"))
[1] "SQLConPlus"
 > conPlus <- new("SQLConPlus", con, 1)
 > dbListTables(con)
character(0)
 > dbListTables(conPlus)
Error in sqliteExecStatement(con, statement, bind.data) :
 RS-DBI driver: (invalid dbManager handle)
 > dbListTables(as(conPlus, "SQLiteConnection"))
character(0)
 >

The problem is happening in sqliteExecStatement which does
   conId <- as(con, "integer")
but con only *contains* an SQLiteConnection and the other integer
causes confusion. If the line were
   conId <- as(as(con, "SQLiteConnection"), "integer")
everything works.

I can work around this, but I am curious where  responsibility for this 
coercion should be.

Paul Gilbert
====================================================================================

La version fran?aise suit le texte anglais.

------------------------------------------------------------------------------------

This email may contain privileged and/or confidential in...{{dropped:26}}


From ernest.turro at ic.ac.uk  Mon Sep 15 16:18:39 2008
From: ernest.turro at ic.ac.uk (Ernest Turro)
Date: Mon, 15 Sep 2008 15:18:39 +0100
Subject: [Rd] Including data in package for use by C functions
Message-ID: <1EFC5117-5635-427A-AFA4-729CD022E075@ic.ac.uk>

How should one go about including data files for use by some C  
function in an R package? The data subdirectory is for additional data  
files the package makes available for loading from R, not C, and  
including the files in some other directory is no good because non- 
standard directories are removed when building the package.

Thanks,

E


From murdoch at stats.uwo.ca  Mon Sep 15 16:28:27 2008
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Mon, 15 Sep 2008 10:28:27 -0400
Subject: [Rd] Including data in package for use by C functions
In-Reply-To: <1EFC5117-5635-427A-AFA4-729CD022E075@ic.ac.uk>
References: <1EFC5117-5635-427A-AFA4-729CD022E075@ic.ac.uk>
Message-ID: <48CE710B.2090102@stats.uwo.ca>

On 9/15/2008 10:18 AM, Ernest Turro wrote:
> How should one go about including data files for use by some C  
> function in an R package? The data subdirectory is for additional data  
> files the package makes available for loading from R, not C, and  
> including the files in some other directory is no good because non- 
> standard directories are removed when building the package.

Nonstandard directories in the "inst" subdir are moved up one level and 
kept, so that's the place to put stuff like this.

e.g. packagesrc/inst/foo becomes package/foo when the package is installed.

Duncan Murdoch


From h.wickham at gmail.com  Mon Sep 15 17:42:44 2008
From: h.wickham at gmail.com (hadley wickham)
Date: Mon, 15 Sep 2008 10:42:44 -0500
Subject: [Rd] Cross-platform function availability
Message-ID: <f8e6ff050809150842n27f724bdl35d637d02d5dbaf0@mail.gmail.com>

Hi all,

Is there any way to determine which functions are available on which
platforms?  For example, winProgr essBar (and related functions) are
only available on Windows, but what about tkProgressBar and
txtProgressBar?  Is there any way to figure out which functions are
only available on certain platforms, without installing R on that
platform and checking?

Thanks,

Hadley

-- 
http://had.co.nz/


From lhansen at blackmesacapital.com  Mon Sep 15 18:52:10 2008
From: lhansen at blackmesacapital.com (Lars Hansen)
Date: Mon, 15 Sep 2008 10:52:10 -0600
Subject: [Rd] Using R from Java
In-Reply-To: <a7479ce00809140151r7ec62d74k91d003f194a32341@mail.gmail.com>
References: <a7479ce00809140151r7ec62d74k91d003f194a32341@mail.gmail.com>
Message-ID: <48CE92BA.3040003@blackmesacapital.com>

Hi,

Take a look at the rJava package. It includes JRI that lets you call R 
from Java. From the README:
> This package contains code that is necessary to run
> R as a single thread of a Java application. It provides
> callback that make it possible to run R in REPL mode
> thus giving the Java application full access to the
> console.
>
> Currently the API is very, very low-level, comparable
> to the C level interface to R. Convenience methods for
> mid to high-level are planned, but not implemented yet.
Good luck,
Lars

Marzio Sala wrote:
> Hello,
>
> I am interesting in using R from a web application, for basic statistics and
> plots. The server is Java-based (tomcat).
> The simplest solution is a system call that generates the text or the image,
> then the servlet forwards the output. This can be done from any language,
> but it is quite inelegant and slow for the initialization time.
>
> Is there any package or approach for accessing R from a Java servlet you can
> suggest?
>
> Thanks in advance for any suggestion.
>
> Regards,
> -Marzio
>
>


From murdoch at stats.uwo.ca  Mon Sep 15 19:06:33 2008
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Mon, 15 Sep 2008 13:06:33 -0400
Subject: [Rd] Cross-platform function availability
In-Reply-To: <f8e6ff050809150842n27f724bdl35d637d02d5dbaf0@mail.gmail.com>
References: <f8e6ff050809150842n27f724bdl35d637d02d5dbaf0@mail.gmail.com>
Message-ID: <48CE9619.3080703@stats.uwo.ca>

On 9/15/2008 11:42 AM, hadley wickham wrote:
> Hi all,
> 
> Is there any way to determine which functions are available on which
> platforms?  For example, winProgr essBar (and related functions) are
> only available on Windows, but what about tkProgressBar and
> txtProgressBar?  Is there any way to figure out which functions are
> only available on certain platforms, without installing R on that
> platform and checking?

Generally I think the only reliable way is to look at the source. 
Things in "windows" subdirs, or marked off with "#ifdef windows" (in Rd) 
or "#ifdef Win32" (in C) are for windows only.  Probably our 
documentation should point out when something is platform-specific, and 
frequently it does, but I don't think it is completely consistent in this.

Duncan


From Greg.Snow at imail.org  Mon Sep 15 19:06:52 2008
From: Greg.Snow at imail.org (Greg Snow)
Date: Mon, 15 Sep 2008 11:06:52 -0600
Subject: [Rd] Cross-platform function availability
In-Reply-To: <f8e6ff050809150842n27f724bdl35d637d02d5dbaf0@mail.gmail.com>
References: <f8e6ff050809150842n27f724bdl35d637d02d5dbaf0@mail.gmail.com>
Message-ID: <B37C0A15B8FB3C468B5BC7EBC7DA14CC613031383F@LP-EXMBVS10.CO.IHC.COM>

I think it is a little more complex than just installing and checking.  tkProgressBar uses tcltk which works on the major platforms (unix/linux, mac, windows), but only if tk is installed and available.  I believe that on mac tk is only available if X11 is used and if I remember correctly, if R is run by clicking an icon, then X11 is not used (but it is if run from a command window).  So checking may say it does not work (when it does in a different way), or that it does work, but the end user may not get it to work.

I believe that txtProgressBar works on any version that can produce text (all that I know of), but you may get some funny results if output is being sent directly to a file.

More generally, from the packages link on your favorite CRAN mirror, there is a link to package test results that show the results of testing the packages on different platforms that may give some idea if the function works on the tested platforms (if the documentation for the function has examples not wrapped in dontrun commands or other tests).

Hope this helps,

--
Gregory (Greg) L. Snow Ph.D.
Statistical Data Center
Intermountain Healthcare
greg.snow at imail.org
(801) 408-8111



> -----Original Message-----
> From: r-devel-bounces at r-project.org
> [mailto:r-devel-bounces at r-project.org] On Behalf Of hadley wickham
> Sent: Monday, September 15, 2008 9:43 AM
> To: r-devel at r-project.org
> Subject: [Rd] Cross-platform function availability
>
> Hi all,
>
> Is there any way to determine which functions are available
> on which platforms?  For example, winProgr essBar (and
> related functions) are only available on Windows, but what
> about tkProgressBar and txtProgressBar?  Is there any way to
> figure out which functions are only available on certain
> platforms, without installing R on that platform and checking?
>
> Thanks,
>
> Hadley
>
> --
> http://had.co.nz/
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From seth at userprimary.net  Mon Sep 15 19:07:41 2008
From: seth at userprimary.net (Seth Falcon)
Date: Mon, 15 Sep 2008 10:07:41 -0700
Subject: [Rd] S4 coercion responsibility
In-Reply-To: <48CE5B66.1050705@bank-banque-canada.ca>
References: <48CE5B66.1050705@bank-banque-canada.ca>
Message-ID: <20080915170741.GX33406@ziti.local>

* On 2008-09-15 at 08:56 -0400 Paul Gilbert wrote:
> Should functions or the user be responsible for coercing an S4 object 
> argument containing the proper object (and thus should below be 
> considered a bug in the packages or not)?
>
> The example is  with RSQLite but the same thing happens with RMySQL, and 
> other DBI packages.
>
> > library("RSQLite")  Loading required package: DBI
> > m <- dbDriver("SQLite")
> > con <- dbConnect(m)
> > setClass("SQLConPlus", contains=c("SQLiteConnection","integer"))
> [1] "SQLConPlus"
> > conPlus <- new("SQLConPlus", con, 1)
> > dbListTables(con)
> character(0)
> > dbListTables(conPlus)
> Error in sqliteExecStatement(con, statement, bind.data) :
> RS-DBI driver: (invalid dbManager handle)
> > dbListTables(as(conPlus, "SQLiteConnection"))
> character(0)
> >
>
> The problem is happening in sqliteExecStatement which does
>   conId <- as(con, "integer")
> but con only *contains* an SQLiteConnection and the other integer
> causes confusion. If the line were
>   conId <- as(as(con, "SQLiteConnection"), "integer")
> everything works.
>
> I can work around this, but I am curious where  responsibility for this 
> coercion should be.

Well, you've created a class that is-a SQLiteConnection *and* is-a
integer.  The fact that the as() method dispatch doesn't match that of
SQLiteConnection should really be that surprising.

I don't see how this could be the responsibility of the author of the
class you've subclassed.

I would also question why SQLConPlus is extending integer.  That seems
like a very strange choice.  Why not extend SQLiteConnection and add
extra slots as you like.  The dispatch will in this case be much
easier to reason about.

+ seth

-- 
Seth Falcon | http://userprimary.net/user/


From h.wickham at gmail.com  Mon Sep 15 19:43:51 2008
From: h.wickham at gmail.com (hadley wickham)
Date: Mon, 15 Sep 2008 12:43:51 -0500
Subject: [Rd] Cross-platform function availability
In-Reply-To: <48CE9619.3080703@stats.uwo.ca>
References: <f8e6ff050809150842n27f724bdl35d637d02d5dbaf0@mail.gmail.com>
	<48CE9619.3080703@stats.uwo.ca>
Message-ID: <f8e6ff050809151043u9618cc1y227888d7bd6ebf46@mail.gmail.com>

On Mon, Sep 15, 2008 at 12:06 PM, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
> On 9/15/2008 11:42 AM, hadley wickham wrote:
>>
>> Hi all,
>>
>> Is there any way to determine which functions are available on which
>> platforms?  For example, winProgr essBar (and related functions) are
>> only available on Windows, but what about tkProgressBar and
>> txtProgressBar?  Is there any way to figure out which functions are
>> only available on certain platforms, without installing R on that
>> platform and checking?
>
> Generally I think the only reliable way is to look at the source. Things in
> "windows" subdirs, or marked off with "#ifdef windows" (in Rd) or "#ifdef
> Win32" (in C) are for windows only.  Probably our documentation should point
> out when something is platform-specific, and frequently it does, but I don't
> think it is completely consistent in this.

To me it seems like it would be easier to include the all functions
all on platforms, and then return an error on platforms where they
aren't supported.  The problem I'm now having is that I'm now getting
an warning when building my package because it can't link to the
documentation for winProgressBar.  Should I just ignore that warning?

Hadley



-- 
http://had.co.nz/


From murdoch at stats.uwo.ca  Mon Sep 15 20:43:46 2008
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Mon, 15 Sep 2008 14:43:46 -0400
Subject: [Rd] Cross-platform function availability
In-Reply-To: <f8e6ff050809151043u9618cc1y227888d7bd6ebf46@mail.gmail.com>
References: <f8e6ff050809150842n27f724bdl35d637d02d5dbaf0@mail.gmail.com>	
	<48CE9619.3080703@stats.uwo.ca>
	<f8e6ff050809151043u9618cc1y227888d7bd6ebf46@mail.gmail.com>
Message-ID: <48CEACE2.9090306@stats.uwo.ca>

On 9/15/2008 1:43 PM, hadley wickham wrote:
> On Mon, Sep 15, 2008 at 12:06 PM, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
>> On 9/15/2008 11:42 AM, hadley wickham wrote:
>>>
>>> Hi all,
>>>
>>> Is there any way to determine which functions are available on which
>>> platforms?  For example, winProgr essBar (and related functions) are
>>> only available on Windows, but what about tkProgressBar and
>>> txtProgressBar?  Is there any way to figure out which functions are
>>> only available on certain platforms, without installing R on that
>>> platform and checking?
>>
>> Generally I think the only reliable way is to look at the source. Things in
>> "windows" subdirs, or marked off with "#ifdef windows" (in Rd) or "#ifdef
>> Win32" (in C) are for windows only.  Probably our documentation should point
>> out when something is platform-specific, and frequently it does, but I don't
>> think it is completely consistent in this.
> 
> To me it seems like it would be easier to include the all functions
> all on platforms, and then return an error on platforms where they
> aren't supported.  The problem I'm now having is that I'm now getting
> an warning when building my package because it can't link to the
> documentation for winProgressBar.  Should I just ignore that warning?

<bromide> It's better not to ignore warnings. </bromide>

I'd suggest wrapping the link in "#ifdef windows" (assuming it's in an 
Rd file).

Duncan Murdoch


From weigand.stephen at gmail.com  Mon Sep 15 23:45:06 2008
From: weigand.stephen at gmail.com (Stephen Weigand)
Date: Mon, 15 Sep 2008 16:45:06 -0500
Subject: [Rd] Typo in cut.Rd
Message-ID: <bc47d3330809151445t2fc0b573n57fab8f65c7a8453@mail.gmail.com>

In the \seealso section of cut.Rd, can "\pkg{hmisc}" be changed to
"\pkg{Hmisc}"?

Thanks,
Stephen

-- 
Rochester, Minn. USA


From murdoch at stats.uwo.ca  Tue Sep 16 00:25:49 2008
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Mon, 15 Sep 2008 18:25:49 -0400
Subject: [Rd] Typo in cut.Rd
In-Reply-To: <bc47d3330809151445t2fc0b573n57fab8f65c7a8453@mail.gmail.com>
References: <bc47d3330809151445t2fc0b573n57fab8f65c7a8453@mail.gmail.com>
Message-ID: <48CEE0ED.2090608@stats.uwo.ca>

On 15/09/2008 5:45 PM, Stephen Weigand wrote:
> In the \seealso section of cut.Rd, can "\pkg{hmisc}" be changed to
> "\pkg{Hmisc}"?

Thanks, I'll fix it.

Duncan Murdoch


From Matthew.Redding at dpi.qld.gov.au  Tue Sep 16 02:10:16 2008
From: Matthew.Redding at dpi.qld.gov.au (Redding, Matthew)
Date: Tue, 16 Sep 2008 10:10:16 +1000
Subject: [Rd] odesolve dynload example
Message-ID: <200809160010.m8G0AGNj088618@dpi-gw1.dpi.qld.gov.au>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20080916/9265985c/attachment.pl>

From glycob at gmail.com  Tue Sep 16 04:42:22 2008
From: glycob at gmail.com (M.)
Date: Mon, 15 Sep 2008 22:42:22 -0400
Subject: [Rd] question in value-based color in image()
Message-ID: <b78ab8330809151942p19928d51p779e25904e7f46cd@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20080915/d5b13e18/attachment.pl>

From p.dalgaard at biostat.ku.dk  Tue Sep 16 07:59:48 2008
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Tue, 16 Sep 2008 07:59:48 +0200
Subject: [Rd] odesolve dynload example
In-Reply-To: <200809160010.m8G0AGNj088618@dpi-gw1.dpi.qld.gov.au>
References: <200809160010.m8G0AGNj088618@dpi-gw1.dpi.qld.gov.au>
Message-ID: <48CF4B54.7010305@biostat.ku.dk>

Redding, Matthew wrote:
> Hello R Developers,
>
> This is my first foray into using c-code with R, so please forgive my
> foolishness.
> I had a look at the archives and did not find anything on this, so
> hopefully I am not doubling up.
>
> I have tried to use R cmd to create an object file from the odesolve
> dynload example.
> I am using windows and have just installed rtools, and have the latest
> version of stable R (2..7.2).
>
> This is what happened:
>
> C:\Program Files\R\R-2.7.2\library\odesolve\dynload\c>Rcmd SHLIB mymod.c
> making mymod.d from mymod.c
> windres --preprocessor="gcc -E -xc -DRC_INVOKED" -I
> C:/PROGRA~1/R/R-27~1.2/include  -i mymod_res.rc -o mymod_res.o
> gcc  -std=gnu99  -shared -s  -o mymod.dll mymod.def mymod.o mymod_res.o
> -LC:/PROGRA~1/R/R-27~1.2/bin    -lR
> Cannot export myderivs: symbol not found
> Cannot export myjac: symbol not found
> Cannot export mymod: symbol not found
> mymod.o: In function `mymod':
> /home/setzer/tasks/Programming_Projects/odesolve/odesolve/inst/dynload/c
> /mymod.c:14: undefined reference to `GLOBAL_OFFSET_TA
> BLE_'
> mymod.o: In function `myderivs':
> /home/setzer/tasks/Programming_Projects/odesolve/odesolve/inst/dynload/c
> /mymod.c:21: undefined reference to `GLOBAL_OFFSET_TA
> BLE_'
> mymod.o: In function `myjac':
> /home/setzer/tasks/Programming_Projects/odesolve/odesolve/inst/dynload/c
> /mymod.c:30: undefined reference to `GLOBAL_OFFSET_TA
> BLE_'
> collect2: ld returned 1 exit status
> make: *** [mymod.dll] Error 1
>
> Any ideas what I have not got set up properly? What do I need to do to
> get this firing? 
> Advice appreciated.
>   
I'm a bit rusty on the windows tools, but it looks like mymod.o and  
mymod_res.rc  not being made above. Any chance that you have old 
versions lying around?

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907


From maechler at stat.math.ethz.ch  Tue Sep 16 11:58:54 2008
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Tue, 16 Sep 2008 11:58:54 +0200
Subject: [Rd] WRONG mailing list - Re: question in value-based color in
	image()
In-Reply-To: <b78ab8330809151942p19928d51p779e25904e7f46cd@mail.gmail.com>
References: <b78ab8330809151942p19928d51p779e25904e7f46cd@mail.gmail.com>
Message-ID: <18639.33630.660463.492148@stat.math.ethz.ch>

Please do use R-help, (not R-devel)
for such questions.

>>>>> "M" == M  <glycob at gmail.com>
>>>>>     on Mon, 15 Sep 2008 22:42:22 -0400 writes:

    M> Hello, I have a matrix with value varying from -1 to 1.
    M> I hope to use scaled color based on its value to produce
    M> an image of this matrix.

    M> Suppose I hope to label those data in [-1,-0.5] with
    M> blue, label those [-0.5,0.8] with light blue (tone is
    M> proportional to its value) and label those [0.8,1] with
    M> white.

    M> How can I use image() and rgb() to achieve this?  It
    M> would be great if I can have a color scale legend, too.

    M> TIA, Chris

    M> 	[[alternative HTML version deleted]]


From ligges at statistik.tu-dortmund.de  Tue Sep 16 12:00:09 2008
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Tue, 16 Sep 2008 12:00:09 +0200
Subject: [Rd] question in value-based color in image()
In-Reply-To: <b78ab8330809151942p19928d51p779e25904e7f46cd@mail.gmail.com>
References: <b78ab8330809151942p19928d51p779e25904e7f46cd@mail.gmail.com>
Message-ID: <48CF83A9.8010208@statistik.tu-dortmund.de>



M. wrote:
> Hello,
> 
> I have a matrix with value varying from -1 to 1.  I hope to use scaled color
> based on its value to produce an image of this matrix.
> 
> Suppose I hope to label those data in [-1,-0.5] with blue, label those
> [-0.5,0.8] with light blue (tone is proportional to its value) and label
> those [0.8,1] with white.
> 
> How can I use image() and rgb() to achieve this?  It would be great if I can
> have a color scale legend, too.


1. This is a message for R-help (if at all), definitely not for R-devel!
2. Have you read ?image ?

Anyway, example:

image(matrix(c(-1, -0.6, -0.4, 1), ncol = 2),
       breaks = c(-1, -0.5, 0.8, 1),
       col = c("blue", "lightblue", "white"))

Uwe Ligges




> TIA,
> Chris
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From rene.locher at zhaw.ch  Tue Sep 16 16:05:07 2008
From: rene.locher at zhaw.ch (rene.locher at zhaw.ch)
Date: Tue, 16 Sep 2008 16:05:07 +0200 (CEST)
Subject: [Rd] aggregate() does not return POSIXct object correctly (PR#12887)
Message-ID: <20080916140507.E0503282C765@mail.pubhealth.ku.dk>

Full_Name: Rene Locher
Version: 2.7.2 Patched (2008-09-12 r46541)
OS: XP
Submission from: (NULL) (160.85.231.40)


dat <- data.frame(event=factor(c("A","A","B")),
                  time=as.POSIXct(c("2008-01-10","2008-01-01","2008-01-04")))

min(dat$time)
## "2008-01-01 CET"
## as expected

aggregate(dat$time,by=list(event=dat$event),min)
## results in
##    event          x
##  1     A 1199142000
##  2     B 1199401200

## I expected:
##    event                x
##  1     A "2008-01-01 CET"
##  2     B "2008-01-04 CET"

## my system:

sessionInfo()
## R version 2.7.2 Patched (2008-09-12 r46541)
## i386-pc-mingw32
##
## locale:
## LC_COLLATE=German_Switzerland.1252;LC_CTYPE=German_Switzerland.1252;LC_MONETARY=German_Switzerland.1252;LC_NUMERIC=C;LC_TIME=German_Switzerland.1252
##
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base

Kind regards

Rene Locher                                     E-Mail: rene.locher at zhaw.ch
Institute for Data Analysis and Process Design     Tel:    +41 58 934 7810
Zurich University of Applied Sciences              Fax:    +41 58 935 7810
Rosenstrasse 3                   
Postfach
CH-8401 Winterthur                                http://www.idp.zhaw.ch


From P.Dalgaard at biostat.ku.dk  Tue Sep 16 17:22:03 2008
From: P.Dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Tue, 16 Sep 2008 17:22:03 +0200
Subject: [Rd] aggregate() does not return POSIXct object correctly
	(PR#12887)
In-Reply-To: <20080916140507.E0503282C765@mail.pubhealth.ku.dk>
References: <20080916140507.E0503282C765@mail.pubhealth.ku.dk>
Message-ID: <48CFCF1B.9090103@biostat.ku.dk>

rene.locher at zhaw.ch wrote:
> Full_Name: Rene Locher
> Version: 2.7.2 Patched (2008-09-12 r46541)
> OS: XP
> Submission from: (NULL) (160.85.231.40)
>
>
> dat <- data.frame(event=factor(c("A","A","B")),
>                   time=as.POSIXct(c("2008-01-10","2008-01-01","2008-01-04")))
>
> min(dat$time)
> ## "2008-01-01 CET"
> ## as expected
>
> aggregate(dat$time,by=list(event=dat$event),min)
> ## results in
> ##    event          x
> ##  1     A 1199142000
> ##  2     B 1199401200
>
> ## I expected:
> ##    event                x
> ##  1     A "2008-01-01 CET"
> ##  2     B "2008-01-04 CET"
>   

This is as documented, possibly annoying, but not a bug.

aggregate() is documented to build on tapply() for which the discarding
of class is documented on ?tapply. The root cause is unlist():

> tapply(dat[["time"]],dat$event,min,simplify=FALSE)
$A
[1] "2008-01-01 CET"

$B
[1] "2008-01-04 CET"

> unlist(tapply(dat[["time"]],dat$event,min,simplify=FALSE))
         A          B
1199142000 1199401200

and a partial rationale is that unlist() wouldn't know what to do if the
arguments had different classes.
The workaround is, of course, just to stick the class back on.




-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907


From ggrothendieck at gmail.com  Tue Sep 16 17:31:01 2008
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Tue, 16 Sep 2008 11:31:01 -0400
Subject: [Rd] aggregate() does not return POSIXct object correctly
	(PR#12887)
In-Reply-To: <48CFCF1B.9090103@biostat.ku.dk>
References: <20080916140507.E0503282C765@mail.pubhealth.ku.dk>
	<48CFCF1B.9090103@biostat.ku.dk>
Message-ID: <971536df0809160831s4a72ec37o720c347ae7d16571@mail.gmail.com>

On Tue, Sep 16, 2008 at 11:22 AM, Peter Dalgaard
<P.Dalgaard at biostat.ku.dk> wrote:
> rene.locher at zhaw.ch wrote:
>> Full_Name: Rene Locher
>> Version: 2.7.2 Patched (2008-09-12 r46541)
>> OS: XP
>> Submission from: (NULL) (160.85.231.40)
>>
>>
>> dat <- data.frame(event=factor(c("A","A","B")),
>>                   time=as.POSIXct(c("2008-01-10","2008-01-01","2008-01-04")))
>>
>> min(dat$time)
>> ## "2008-01-01 CET"
>> ## as expected
>>
>> aggregate(dat$time,by=list(event=dat$event),min)
>> ## results in
>> ##    event          x
>> ##  1     A 1199142000
>> ##  2     B 1199401200
>>
>> ## I expected:
>> ##    event                x
>> ##  1     A "2008-01-01 CET"
>> ##  2     B "2008-01-04 CET"
>>
>
> This is as documented, possibly annoying, but not a bug.
>
> aggregate() is documented to build on tapply() for which the discarding
> of class is documented on ?tapply. The root cause is unlist():
>
>> tapply(dat[["time"]],dat$event,min,simplify=FALSE)
> $A
> [1] "2008-01-01 CET"
>
> $B
> [1] "2008-01-04 CET"
>
>> unlist(tapply(dat[["time"]],dat$event,min,simplify=FALSE))
>         A          B
> 1199142000 1199401200
>
> and a partial rationale is that unlist() wouldn't know what to do if the
> arguments had different classes.
> The workaround is, of course, just to stick the class back on.
>

Another workaround is:

https://stat.ethz.ch/pipermail/r-help/2008-September/173139.html


From Thomas.Petzoldt at tu-dresden.de  Tue Sep 16 19:08:02 2008
From: Thomas.Petzoldt at tu-dresden.de (Thomas Petzoldt)
Date: Tue, 16 Sep 2008 19:08:02 +0200
Subject: [Rd] odesolve dynload example
In-Reply-To: <200809160010.m8G0AGNj088618@dpi-gw1.dpi.qld.gov.au>
References: <200809160010.m8G0AGNj088618@dpi-gw1.dpi.qld.gov.au>
Message-ID: <48CFE7F2.7010907@tu-dresden.de>

Hi Matthew,

thank you for the bug report, Woodrow Setzer just uploaded a minor 
bugfix and I assume he informed you off-list.

One additional note for the records:

We suggest odesolve users should switch over to the new deSolve package. 
It is maintained by the the same (and two additional) authors like 
odesolve. It is almost ;-) fully compatible to odesolve and will replace 
it completely. The authors renamed it to deSolve, because it's able to 
solve also DAE and PDE systems, not only ODEs, so the name odesolve was 
too narrow and is now deprecated.

Note that deSolve has a package vignette about writing models in 
compiled code.

Thomas Petzoldt



Redding, Matthew wrote:
> Hello R Developers,
> 
> This is my first foray into using c-code with R, so please forgive my
> foolishness.
> I had a look at the archives and did not find anything on this, so
> hopefully I am not doubling up.
> 
> I have tried to use R cmd to create an object file from the odesolve
> dynload example.
> I am using windows and have just installed rtools, and have the latest
> version of stable R (2..7.2).
> 
> This is what happened:
> 
> C:\Program Files\R\R-2.7.2\library\odesolve\dynload\c>Rcmd SHLIB mymod.c
> making mymod.d from mymod.c
> windres --preprocessor="gcc -E -xc -DRC_INVOKED" -I
> C:/PROGRA~1/R/R-27~1.2/include  -i mymod_res.rc -o mymod_res.o
> gcc  -std=gnu99  -shared -s  -o mymod.dll mymod.def mymod.o mymod_res.o
> -LC:/PROGRA~1/R/R-27~1.2/bin    -lR
> Cannot export myderivs: symbol not found
> Cannot export myjac: symbol not found
> Cannot export mymod: symbol not found
> mymod.o: In function `mymod':
> /home/setzer/tasks/Programming_Projects/odesolve/odesolve/inst/dynload/c
> /mymod.c:14: undefined reference to `GLOBAL_OFFSET_TA
> BLE_'
> mymod.o: In function `myderivs':
> /home/setzer/tasks/Programming_Projects/odesolve/odesolve/inst/dynload/c
> /mymod.c:21: undefined reference to `GLOBAL_OFFSET_TA
> BLE_'
> mymod.o: In function `myjac':
> /home/setzer/tasks/Programming_Projects/odesolve/odesolve/inst/dynload/c
> /mymod.c:30: undefined reference to `GLOBAL_OFFSET_TA
> BLE_'
> collect2: ld returned 1 exit status
> make: *** [mymod.dll] Error 1
> 
> Any ideas what I have not got set up properly? What do I need to do to
> get this firing? 
> Advice appreciated.
> 
> Kind regards, 
> 
> Matt Redding
> ********************************DISCLAIMER**************...{{dropped:15}}
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 


-- 
Thomas Petzoldt
Technische Universitaet Dresden
Institut fuer Hydrobiologie        thomas.petzoldt at tu-dresden.de
01062 Dresden                      http://tu-dresden.de/hydrobiologie/
GERMANY


From Setzer.Woodrow at epamail.epa.gov  Tue Sep 16 14:27:56 2008
From: Setzer.Woodrow at epamail.epa.gov (Setzer.Woodrow at epamail.epa.gov)
Date: Tue, 16 Sep 2008 08:27:56 -0400
Subject: [Rd] odesolve dynload example
In-Reply-To: <48CF4B54.7010305@biostat.ku.dk>
Message-ID: <OF239F5926.810942CD-ON852574C6.004405AE-852574C6.004479B7@epamail.epa.gov>

I'm the maintainer of odesolve.  In the ...odesolve/dynload/c directory
of the windows distribution are two files that should not be: mymod.o
and mymod.so (I just noticed them).  Try deleting  them and rerunning
your compilation.

By the way, you might want to take a look at deSolve, which supercedes
odesolve.  deSolve includes lsoda with the same API as in odesolve, but
also includes several other ode solvers you might find useful.  In the
next several months, odesolve will be deprecated.

R. Woodrow Setzer, Ph. D.
National Center for Computational Toxicology
http://www.epa.gov/comptox
US Environmental Protection Agency
Mail Drop B205-01/US EPA/RTP, NC 27711
Ph: (919) 541-0128    Fax: (919) 541-1194


                                                                        
             Peter Dalgaard                                             
             <p.dalgaard at bios                                           
             tat.ku.dk>                                              To 
             Sent by:                 "Redding, Matthew"                
             r-devel-bounces@         <Matthew.Redding at dpi.qld.gov.au>  
             r-project.org                                           cc 
                                      r-devel at r-project.org             
                                                                Subject 
             09/16/2008 01:59         Re: [Rd] odesolve dynload example 
             AM                                                         
                                                                        
                                                                        
                                                                        
                                                                        
                                                                        




Redding, Matthew wrote:
> Hello R Developers,
>
> This is my first foray into using c-code with R, so please forgive my
> foolishness.
> I had a look at the archives and did not find anything on this, so
> hopefully I am not doubling up.
>
> I have tried to use R cmd to create an object file from the odesolve
> dynload example.
> I am using windows and have just installed rtools, and have the latest
> version of stable R (2..7.2).
>
> This is what happened:
>
> C:\Program Files\R\R-2.7.2\library\odesolve\dynload\c>Rcmd SHLIB
mymod.c
> making mymod.d from mymod.c
> windres --preprocessor="gcc -E -xc -DRC_INVOKED" -I
> C:/PROGRA~1/R/R-27~1.2/include  -i mymod_res.rc -o mymod_res.o
> gcc  -std=gnu99  -shared -s  -o mymod.dll mymod.def mymod.o
mymod_res.o
> -LC:/PROGRA~1/R/R-27~1.2/bin    -lR
> Cannot export myderivs: symbol not found
> Cannot export myjac: symbol not found
> Cannot export mymod: symbol not found
> mymod.o: In function `mymod':
> /home/setzer/tasks/Programming_Projects/odesolve/odesolve/inst/dynload/c

> /mymod.c:14: undefined reference to `GLOBAL_OFFSET_TA
> BLE_'
> mymod.o: In function `myderivs':
> /home/setzer/tasks/Programming_Projects/odesolve/odesolve/inst/dynload/c

> /mymod.c:21: undefined reference to `GLOBAL_OFFSET_TA
> BLE_'
> mymod.o: In function `myjac':
> /home/setzer/tasks/Programming_Projects/odesolve/odesolve/inst/dynload/c

> /mymod.c:30: undefined reference to `GLOBAL_OFFSET_TA
> BLE_'
> collect2: ld returned 1 exit status
> make: *** [mymod.dll] Error 1
>
> Any ideas what I have not got set up properly? What do I need to do to
> get this firing?
> Advice appreciated.
>
I'm a bit rusty on the windows tools, but it looks like mymod.o and
mymod_res.rc  not being made above. Any chance that you have old
versions lying around?

--
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907

______________________________________________
R-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-devel


From Matthew.Redding at dpi.qld.gov.au  Wed Sep 17 00:17:15 2008
From: Matthew.Redding at dpi.qld.gov.au (Redding, Matthew)
Date: Wed, 17 Sep 2008 08:17:15 +1000
Subject: [Rd] odesolve dynload example
References: <OF239F5926.810942CD-ON852574C6.004405AE-852574C6.004479B7@epamail.epa.gov>
Message-ID: <200809162217.m8GMHGfi096246@dpi-gw1.dpi.qld.gov.au>

Thanks so much for the answer.

I will let you know how things go.

I will definitely look into desolve

Kind regards

-----Original Message-----
From: r-devel-bounces at r-project.org [mailto:r-devel-bounces at r-project.org] On Behalf Of Setzer.Woodrow at epamail.epa.gov
Sent: Tuesday, 16 September 2008 10:28 PM
To: Peter Dalgaard
Cc: Redding, Matthew; r-devel at r-project.org
Subject: Re: [Rd] odesolve dynload example

I'm the maintainer of odesolve.  In the ...odesolve/dynload/c directory of the windows distribution are two files that should not be: mymod.o and mymod.so (I just noticed them).  Try deleting  them and rerunning your compilation.

By the way, you might want to take a look at deSolve, which supercedes odesolve.  deSolve includes lsoda with the same API as in odesolve, but also includes several other ode solvers you might find useful.  In the next several months, odesolve will be deprecated.

R. Woodrow Setzer, Ph. D.
National Center for Computational Toxicology http://www.epa.gov/comptox US Environmental Protection Agency Mail Drop B205-01/US EPA/RTP, NC 27711
Ph: (919) 541-0128    Fax: (919) 541-1194


                                                                        
             Peter Dalgaard                                             
             <p.dalgaard at bios                                           
             tat.ku.dk>                                              To 
             Sent by:                 "Redding, Matthew"                
             r-devel-bounces@         <Matthew.Redding at dpi.qld.gov.au>  
             r-project.org                                           cc 
                                      r-devel at r-project.org             
                                                                Subject 
             09/16/2008 01:59         Re: [Rd] odesolve dynload example 
             AM                                                         
                                                                        
                                                                        
                                                                        
                                                                        
                                                                        




Redding, Matthew wrote:
> Hello R Developers,
>
> This is my first foray into using c-code with R, so please forgive my 
> foolishness.
> I had a look at the archives and did not find anything on this, so 
> hopefully I am not doubling up.
>
> I have tried to use R cmd to create an object file from the odesolve 
> dynload example.
> I am using windows and have just installed rtools, and have the latest 
> version of stable R (2..7.2).
>
> This is what happened:
>
> C:\Program Files\R\R-2.7.2\library\odesolve\dynload\c>Rcmd SHLIB
mymod.c
> making mymod.d from mymod.c
> windres --preprocessor="gcc -E -xc -DRC_INVOKED" -I 
> C:/PROGRA~1/R/R-27~1.2/include  -i mymod_res.rc -o mymod_res.o gcc  
> -std=gnu99  -shared -s  -o mymod.dll mymod.def mymod.o
mymod_res.o
> -LC:/PROGRA~1/R/R-27~1.2/bin    -lR
> Cannot export myderivs: symbol not found Cannot export myjac: symbol 
> not found Cannot export mymod: symbol not found
> mymod.o: In function `mymod':
> /home/setzer/tasks/Programming_Projects/odesolve/odesolve/inst/dynload
> /c

> /mymod.c:14: undefined reference to `GLOBAL_OFFSET_TA BLE_'
> mymod.o: In function `myderivs':
> /home/setzer/tasks/Programming_Projects/odesolve/odesolve/inst/dynload
> /c

> /mymod.c:21: undefined reference to `GLOBAL_OFFSET_TA BLE_'
> mymod.o: In function `myjac':
> /home/setzer/tasks/Programming_Projects/odesolve/odesolve/inst/dynload
> /c

> /mymod.c:30: undefined reference to `GLOBAL_OFFSET_TA BLE_'
> collect2: ld returned 1 exit status
> make: *** [mymod.dll] Error 1
>
> Any ideas what I have not got set up properly? What do I need to do to 
> get this firing?
> Advice appreciated.
>
I'm a bit rusty on the windows tools, but it looks like mymod.o and mymod_res.rc  not being made above. Any chance that you have old versions lying around?

--
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907

______________________________________________
R-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-devel

______________________________________________
R-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-devel

********************************DISCLAIMER****************************=...{{dropped:12}}


From Matthew.Redding at dpi.qld.gov.au  Wed Sep 17 05:04:29 2008
From: Matthew.Redding at dpi.qld.gov.au (Redding, Matthew)
Date: Wed, 17 Sep 2008 13:04:29 +1000
Subject: [Rd] odesolve dynload example
References: <OF239F5926.810942CD-ON852574C6.004405AE-852574C6.004479B7@epamail.epa.gov>
Message-ID: <200809170304.m8H34TtO031179@dpi-gw1.dpi.qld.gov.au>

Hi Woodrow, Peter and others.

Getting rid of those excess files smoothed the process a little:

Rcmd SHLIB mymod.c
C:\Program Files\R\R-2.7.2\library\odesolve\dynload\c>Rcmd SHLIB mymod.c
gcc  -std=gnu99  -IC:/PROGRA~1/R/R-27~1.2/include     -O3 -Wall  -c mymod.c -o mymod.o
gcc  -std=gnu99  -shared -s  -o mymod.dll mymod.def mymod.o mymod_res.o  -LC:/PROGRA~1/R/R-27~1.2/bin    -lR

This completed without returning an error.

The problem now is that it did not produce a "mymod.so" in the folder, only a mymod.o.

so the dyn.load() command in the example R program has nothing to work with..

Any ideas?

Kind regards, 

Matt Redding

-----Original Message-----
From: r-devel-bounces at r-project.org [mailto:r-devel-bounces at r-project.org] On Behalf Of Setzer.Woodrow at epamail.epa.gov
Sent: Tuesday, 16 September 2008 10:28 PM
To: Peter Dalgaard
Cc: Redding, Matthew; r-devel at r-project.org
Subject: Re: [Rd] odesolve dynload example

I'm the maintainer of odesolve.  In the ...odesolve/dynload/c directory of the windows distribution are two files that should not be: mymod.o and mymod.so (I just noticed them).  Try deleting  them and rerunning your compilation.

By the way, you might want to take a look at deSolve, which supercedes odesolve.  deSolve includes lsoda with the same API as in odesolve, but also includes several other ode solvers you might find useful.  In the next several months, odesolve will be deprecated.

R. Woodrow Setzer, Ph. D.
National Center for Computational Toxicology http://www.epa.gov/comptox US Environmental Protection Agency Mail Drop B205-01/US EPA/RTP, NC 27711
Ph: (919) 541-0128    Fax: (919) 541-1194


                                                                        
             Peter Dalgaard                                             
             <p.dalgaard at bios                                           
             tat.ku.dk>                                              To 
             Sent by:                 "Redding, Matthew"                
             r-devel-bounces@         <Matthew.Redding at dpi.qld.gov.au>  
             r-project.org                                           cc 
                                      r-devel at r-project.org             
                                                                Subject 
             09/16/2008 01:59         Re: [Rd] odesolve dynload example 
             AM                                                         
                                                                        
                                                                        
                                                                        
                                                                        
                                                                        




Redding, Matthew wrote:
> Hello R Developers,
>
> This is my first foray into using c-code with R, so please forgive my 
> foolishness.
> I had a look at the archives and did not find anything on this, so 
> hopefully I am not doubling up.
>
> I have tried to use R cmd to create an object file from the odesolve 
> dynload example.
> I am using windows and have just installed rtools, and have the latest 
> version of stable R (2..7.2).
>
> This is what happened:
>
> C:\Program Files\R\R-2.7.2\library\odesolve\dynload\c>Rcmd SHLIB
mymod.c
> making mymod.d from mymod.c
> windres --preprocessor="gcc -E -xc -DRC_INVOKED" -I 
> C:/PROGRA~1/R/R-27~1.2/include  -i mymod_res.rc -o mymod_res.o gcc  
> -std=gnu99  -shared -s  -o mymod.dll mymod.def mymod.o
mymod_res.o
> -LC:/PROGRA~1/R/R-27~1.2/bin    -lR
> Cannot export myderivs: symbol not found Cannot export myjac: symbol 
> not found Cannot export mymod: symbol not found
> mymod.o: In function `mymod':
> /home/setzer/tasks/Programming_Projects/odesolve/odesolve/inst/dynload
> /c

> /mymod.c:14: undefined reference to `GLOBAL_OFFSET_TA BLE_'
> mymod.o: In function `myderivs':
> /home/setzer/tasks/Programming_Projects/odesolve/odesolve/inst/dynload
> /c

> /mymod.c:21: undefined reference to `GLOBAL_OFFSET_TA BLE_'
> mymod.o: In function `myjac':
> /home/setzer/tasks/Programming_Projects/odesolve/odesolve/inst/dynload
> /c

> /mymod.c:30: undefined reference to `GLOBAL_OFFSET_TA BLE_'
> collect2: ld returned 1 exit status
> make: *** [mymod.dll] Error 1
>
> Any ideas what I have not got set up properly? What do I need to do to 
> get this firing?
> Advice appreciated.
>
I'm a bit rusty on the windows tools, but it looks like mymod.o and mymod_res.rc  not being made above. Any chance that you have old versions lying around?

--
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907

______________________________________________
R-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-devel

______________________________________________
R-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-devel

********************************DISCLAIMER****************************=...{{dropped:12}}


From Matthew.Redding at dpi.qld.gov.au  Wed Sep 17 05:08:13 2008
From: Matthew.Redding at dpi.qld.gov.au (Redding, Matthew)
Date: Wed, 17 Sep 2008 13:08:13 +1000
Subject: [Rd] odesolve dynload example
References: <OF239F5926.810942CD-ON852574C6.004405AE-852574C6.004479B7@epamail.epa.gov>
	<200809170304.m8H34TtO031179@dpi-gw1.dpi.qld.gov.au>
Message-ID: <200809170308.m8H38EIv033788@dpi-gw1.dpi.qld.gov.au>

Excuse me, my mistake.

Of course on windows the Rcmd SHLIB makes a DLL... not a .so file.

So with the modification to the R script, it now works beautifully!

Thanks to all for your patience.

Matt 

-----Original Message-----
From: r-devel-bounces at r-project.org [mailto:r-devel-bounces at r-project.org] On Behalf Of Redding, Matthew
Sent: Wednesday, 17 September 2008 1:04 PM
To: Setzer.Woodrow at epamail.epa.gov; Peter Dalgaard
Cc: r-devel at r-project.org
Subject: Re: [Rd] odesolve dynload example

Hi Woodrow, Peter and others.

Getting rid of those excess files smoothed the process a little:

Rcmd SHLIB mymod.c
C:\Program Files\R\R-2.7.2\library\odesolve\dynload\c>Rcmd SHLIB mymod.c
gcc  -std=gnu99  -IC:/PROGRA~1/R/R-27~1.2/include     -O3 -Wall  -c mymod.c -o mymod.o
gcc  -std=gnu99  -shared -s  -o mymod.dll mymod.def mymod.o mymod_res.o  -LC:/PROGRA~1/R/R-27~1.2/bin    -lR

This completed without returning an error.

The problem now is that it did not produce a "mymod.so" in the folder, only a mymod.o.

so the dyn.load() command in the example R program has nothing to work with..

Any ideas?

Kind regards, 

Matt Redding

-----Original Message-----
From: r-devel-bounces at r-project.org [mailto:r-devel-bounces at r-project.org] On Behalf Of Setzer.Woodrow at epamail.epa.gov
Sent: Tuesday, 16 September 2008 10:28 PM
To: Peter Dalgaard
Cc: Redding, Matthew; r-devel at r-project.org
Subject: Re: [Rd] odesolve dynload example

I'm the maintainer of odesolve.  In the ...odesolve/dynload/c directory of the windows distribution are two files that should not be: mymod.o and mymod.so (I just noticed them).  Try deleting  them and rerunning your compilation.

By the way, you might want to take a look at deSolve, which supercedes odesolve.  deSolve includes lsoda with the same API as in odesolve, but also includes several other ode solvers you might find useful.  In the next several months, odesolve will be deprecated.

R. Woodrow Setzer, Ph. D.
National Center for Computational Toxicology http://www.epa.gov/comptox US Environmental Protection Agency Mail Drop B205-01/US EPA/RTP, NC 27711
Ph: (919) 541-0128    Fax: (919) 541-1194


                                                                        
             Peter Dalgaard                                             
             <p.dalgaard at bios                                           
             tat.ku.dk>                                              To 
             Sent by:                 "Redding, Matthew"                
             r-devel-bounces@         <Matthew.Redding at dpi.qld.gov.au>  
             r-project.org                                           cc 
                                      r-devel at r-project.org             
                                                                Subject 
             09/16/2008 01:59         Re: [Rd] odesolve dynload example 
             AM                                                         
                                                                        
                                                                        
                                                                        
                                                                        
                                                                        




Redding, Matthew wrote:
> Hello R Developers,
>
> This is my first foray into using c-code with R, so please forgive my 
> foolishness.
> I had a look at the archives and did not find anything on this, so 
> hopefully I am not doubling up.
>
> I have tried to use R cmd to create an object file from the odesolve 
> dynload example.
> I am using windows and have just installed rtools, and have the latest 
> version of stable R (2..7.2).
>
> This is what happened:
>
> C:\Program Files\R\R-2.7.2\library\odesolve\dynload\c>Rcmd SHLIB
mymod.c
> making mymod.d from mymod.c
> windres --preprocessor="gcc -E -xc -DRC_INVOKED" -I 
> C:/PROGRA~1/R/R-27~1.2/include  -i mymod_res.rc -o mymod_res.o gcc
> -std=gnu99  -shared -s  -o mymod.dll mymod.def mymod.o
mymod_res.o
> -LC:/PROGRA~1/R/R-27~1.2/bin    -lR
> Cannot export myderivs: symbol not found Cannot export myjac: symbol 
> not found Cannot export mymod: symbol not found
> mymod.o: In function `mymod':
> /home/setzer/tasks/Programming_Projects/odesolve/odesolve/inst/dynload
> /c

> /mymod.c:14: undefined reference to `GLOBAL_OFFSET_TA BLE_'
> mymod.o: In function `myderivs':
> /home/setzer/tasks/Programming_Projects/odesolve/odesolve/inst/dynload
> /c

> /mymod.c:21: undefined reference to `GLOBAL_OFFSET_TA BLE_'
> mymod.o: In function `myjac':
> /home/setzer/tasks/Programming_Projects/odesolve/odesolve/inst/dynload
> /c

> /mymod.c:30: undefined reference to `GLOBAL_OFFSET_TA BLE_'
> collect2: ld returned 1 exit status
> make: *** [mymod.dll] Error 1
>
> Any ideas what I have not got set up properly? What do I need to do to 
> get this firing?
> Advice appreciated.
>
I'm a bit rusty on the windows tools, but it looks like mymod.o and mymod_res.rc  not being made above. Any chance that you have old versions lying around?

--
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907

______________________________________________
R-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-devel

______________________________________________
R-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-devel

********************************DISCLAIMER****************************=....{{dropped:17}}


From Phil.Lee at morganstanley.com  Wed Sep 17 19:24:27 2008
From: Phil.Lee at morganstanley.com (Lee, Philip (IT))
Date: Wed, 17 Sep 2008 13:24:27 -0400
Subject: [Rd] Dates in C api
Message-ID: <575EAD86322DA342B50FE422364A9F52082D528B@NYWEXMB27.msad.ms.com>

r-devel,

I've been trying to write a C plugin for R, and I'm struggling to
understand how dates are represented.

I can create a date in R:
> mydate<-as.Date(1, origin="1900-01-01") mydate
[1] "1900-01-02"

When I pass my date to a plugin, though, it's type is that of a real.
There doesn't seem to be a date type in Rinternals.h, is there a way to
recognize that a value is a date rather than a real?

Equally, does anyone know if it's possible to create date values in the
C api?

Thanks,
Phil Lee

Philip Lee
Morgan Stanley | Technology
750 Seventh Avenue, 12th Floor | New York, NY  10019
Phil.Lee at morganstanley.com
--------------------------------------------------------

NOTICE: If received in error, please destroy and notify sender. Sender does not intend to waive confidentiality or privilege. Use of this email is prohibited when received in error.


From osklyar at ebi.ac.uk  Wed Sep 17 22:03:23 2008
From: osklyar at ebi.ac.uk (Oleg Sklyar)
Date: Wed, 17 Sep 2008 21:03:23 +0100
Subject: [Rd] Dates in C api
In-Reply-To: <575EAD86322DA342B50FE422364A9F52082D528B@NYWEXMB27.msad.ms.com>
References: <575EAD86322DA342B50FE422364A9F52082D528B@NYWEXMB27.msad.ms.com>
Message-ID: <48D1628B.103@ebi.ac.uk>

Dates are number of days since 1970-01-01 that is it.

to get data of Date in C:

library(inline)
code = 'Rprintf("%f", REAL(x)[0]); return R_NilValue;'
f = cfunction(signature(x="double"), body=code)
na = f(Sys.date())

to create an object of class Date:
--- in C ---
SEXP res = allocVector(REALSXP, n);
return res;
// one can assign class here, but one can also do it on return to R
--- in R ---
res = .Call("myDateFun", n)
class(res) = "Date"

Best,
Oleg

Lee, Philip (IT) wrote:
> r-devel,
> 
> I've been trying to write a C plugin for R, and I'm struggling to
> understand how dates are represented.
> 
> I can create a date in R:
>> mydate<-as.Date(1, origin="1900-01-01") mydate
> [1] "1900-01-02"
> 
> When I pass my date to a plugin, though, it's type is that of a real.
> There doesn't seem to be a date type in Rinternals.h, is there a way to
> recognize that a value is a date rather than a real?
> 
> Equally, does anyone know if it's possible to create date values in the
> C api?
> 
> Thanks,
> Phil Lee
> 
> Philip Lee
> Morgan Stanley | Technology
> 750 Seventh Avenue, 12th Floor | New York, NY  10019
> Phil.Lee at morganstanley.com
> --------------------------------------------------------
> 
> NOTICE: If received in error, please destroy and notify sender. Sender does not intend to waive confidentiality or privilege. Use of this email is prohibited when received in error.
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Dr Oleg Sklyar * EBI-EMBL, Cambridge CB10 1SD, UK * +44-1223-494466


From murdoch at stats.uwo.ca  Wed Sep 17 22:06:48 2008
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Wed, 17 Sep 2008 16:06:48 -0400
Subject: [Rd] Dates in C api
In-Reply-To: <575EAD86322DA342B50FE422364A9F52082D528B@NYWEXMB27.msad.ms.com>
References: <575EAD86322DA342B50FE422364A9F52082D528B@NYWEXMB27.msad.ms.com>
Message-ID: <48D16358.1050606@stats.uwo.ca>

On 9/17/2008 1:24 PM, Lee, Philip (IT) wrote:
> r-devel,
> 
> I've been trying to write a C plugin for R, and I'm struggling to
> understand how dates are represented.
> 
> I can create a date in R:
>> mydate<-as.Date(1, origin="1900-01-01") mydate
> [1] "1900-01-02"

See ?Date for the internal represention: it's a count of days from a 
particular epoch.

> When I pass my date to a plugin, though, it's type is that of a real.
> There doesn't seem to be a date type in Rinternals.h, is there a way to
> recognize that a value is a date rather than a real?

Look at the class attribute.
> 
> Equally, does anyone know if it's possible to create date values in the
> C api?

Create a vector of doubles, and attach the right class to it.  See 
section 5.8.5 of the R extensions manual for an example.

Duncan Murdoch

> 
> Thanks,
> Phil Lee
> 
> Philip Lee
> Morgan Stanley | Technology
> 750 Seventh Avenue, 12th Floor | New York, NY  10019
> Phil.Lee at morganstanley.com
> --------------------------------------------------------
> 
> NOTICE: If received in error, please destroy and notify sender. Sender does not intend to waive confidentiality or privilege. Use of this email is prohibited when received in error.
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From jeff.a.ryan at gmail.com  Wed Sep 17 22:19:20 2008
From: jeff.a.ryan at gmail.com (Jeff Ryan)
Date: Wed, 17 Sep 2008 15:19:20 -0500
Subject: [Rd] Dates in C api
In-Reply-To: <575EAD86322DA342B50FE422364A9F52082D528B@NYWEXMB27.msad.ms.com>
References: <575EAD86322DA342B50FE422364A9F52082D528B@NYWEXMB27.msad.ms.com>
Message-ID: <e8e755250809171319h15fc8461yfd5c7ab1531ad89e@mail.gmail.com>

If you are looking for examples of handling dates/times (specifically
POSIXct) within C code, the dev branch of xts has quite a bit of code
now.

http://r-forge.r-project.org/plugins/scmsvn/viewcvs.php/dev/pkg/src/?root=xts

Assigning the class (or any attribute) within the C code will be much
faster than doing it outside of C, at least in my experience with
larger data.

setAttrib(ans, R_ClassSymbol, mkString("Date"))

HTH
Jeff

On Wed, Sep 17, 2008 at 12:24 PM, Lee, Philip (IT)
<Phil.Lee at morganstanley.com> wrote:
> r-devel,
>
> I've been trying to write a C plugin for R, and I'm struggling to
> understand how dates are represented.
>
> I can create a date in R:
>> mydate<-as.Date(1, origin="1900-01-01") mydate
> [1] "1900-01-02"
>
> When I pass my date to a plugin, though, it's type is that of a real.
> There doesn't seem to be a date type in Rinternals.h, is there a way to
> recognize that a value is a date rather than a real?
>
> Equally, does anyone know if it's possible to create date values in the
> C api?
>
> Thanks,
> Phil Lee
>
> Philip Lee
> Morgan Stanley | Technology
> 750 Seventh Avenue, 12th Floor | New York, NY  10019
> Phil.Lee at morganstanley.com
> --------------------------------------------------------
>
> NOTICE: If received in error, please destroy and notify sender. Sender does not intend to waive confidentiality or privilege. Use of this email is prohibited when received in error.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>



-- 
Jeffrey Ryan
jeffrey.ryan at insightalgo.com

ia: insight algorithmics
www.insightalgo.com


From Phil.Lee at morganstanley.com  Wed Sep 17 22:22:19 2008
From: Phil.Lee at morganstanley.com (Lee, Philip (IT))
Date: Wed, 17 Sep 2008 16:22:19 -0400
Subject: [Rd] Dates in C api
In-Reply-To: <e8e755250809171319h15fc8461yfd5c7ab1531ad89e@mail.gmail.com>
References: <575EAD86322DA342B50FE422364A9F52082D528B@NYWEXMB27.msad.ms.com>
	<e8e755250809171319h15fc8461yfd5c7ab1531ad89e@mail.gmail.com>
Message-ID: <575EAD86322DA342B50FE422364A9F52082D531D@NYWEXMB27.msad.ms.com>

Thanks, everyone, for the responses.  That's exactly what I was after.

Regards,
Phil 

> -----Original Message-----
> From: Jeff Ryan [mailto:jeff.a.ryan at gmail.com] 
> Sent: Wednesday, September 17, 2008 4:19 PM
> To: Lee, Philip (IT)
> Cc: r-devel at r-project.org
> Subject: Re: [Rd] Dates in C api
> 
> If you are looking for examples of handling dates/times (specifically
> POSIXct) within C code, the dev branch of xts has quite a bit 
> of code now.
> 
> http://r-forge.r-project.org/plugins/scmsvn/viewcvs.php/dev/pk
g/src/?root=xts
> 
> Assigning the class (or any attribute) within the C code will 
> be much faster than doing it outside of C, at least in my 
> experience with larger data.
> 
> setAttrib(ans, R_ClassSymbol, mkString("Date"))
> 
> HTH
> Jeff
> 
> On Wed, Sep 17, 2008 at 12:24 PM, Lee, Philip (IT) 
> <Phil.Lee at morganstanley.com> wrote:
> > r-devel,
> >
> > I've been trying to write a C plugin for R, and I'm struggling to 
> > understand how dates are represented.
> >
> > I can create a date in R:
> >> mydate<-as.Date(1, origin="1900-01-01") mydate
> > [1] "1900-01-02"
> >
> > When I pass my date to a plugin, though, it's type is that 
> of a real.
> > There doesn't seem to be a date type in Rinternals.h, is 
> there a way 
> > to recognize that a value is a date rather than a real?
> >
> > Equally, does anyone know if it's possible to create date values in 
> > the C api?
> >
> > Thanks,
> > Phil Lee
> >
> > Philip Lee
> > Morgan Stanley | Technology
> > 750 Seventh Avenue, 12th Floor | New York, NY  10019 
> > Phil.Lee at morganstanley.com
> > --------------------------------------------------------
> >
> > NOTICE: If received in error, please destroy and notify 
> sender. Sender does not intend to waive confidentiality or 
> privilege. Use of this email is prohibited when received in error.
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >
> 
> 
> 
> --
> Jeffrey Ryan
> jeffrey.ryan at insightalgo.com
> 
> ia: insight algorithmics
> www.insightalgo.com
>
--------------------------------------------------------

NOTICE: If received in error, please destroy and notify sender. Sender does not intend to waive confidentiality or privilege. Use of this email is prohibited when received in error.


From seth at userprimary.net  Thu Sep 18 04:25:03 2008
From: seth at userprimary.net (Seth Falcon)
Date: Wed, 17 Sep 2008 19:25:03 -0700
Subject: [Rd] S4 coercion responsibility
In-Reply-To: <20080915170741.GX33406@ziti.local>
References: <48CE5B66.1050705@bank-banque-canada.ca>
	<20080915170741.GX33406@ziti.local>
Message-ID: <20080918022502.GB511@ziti.local>

A couple more comments...

* On 2008-09-15 at 10:07 -0700 Seth Falcon wrote:
> > The example is with RSQLite but the same thing happens with
> > RMySQL, and other DBI packages.

The use of as() within the various DBI packages should be
re-evaluated.  I suspect some of that code was among the first to make
heavy use of S4.  As S4 has evolved and become better documented and
understood, the DBI packages may not always have had a chance to keep
up.

> > > library("RSQLite")  Loading required package: DBI
> > > m <- dbDriver("SQLite")
> > > con <- dbConnect(m)
> > > setClass("SQLConPlus", contains=c("SQLiteConnection","integer"))
> > [1] "SQLConPlus"
> > > conPlus <- new("SQLConPlus", con, 1)
> > > dbListTables(con)
> > character(0)
> > > dbListTables(conPlus)

In the latest R-devel code (svn r46542), this behaves differently (and
works as you were hoping).  I get:

    library("RSQLite")
    setClass("SQLConPlus", contains=c("SQLiteConnection","integer"))
    dd = data.frame(a=1:3, b=letters[1:3])
    con = new("SQLConPlus", dbConnect(SQLite(), ":memory:"), 11L)
    dbWriteTable(con, "t1", dd)
    dbListTables(con)
    dbDisconnect(con)

I know that the methods package has been undergoing some improvements
recently, so it is not entirely surprising that behavior has changed.

I think the new behavior is desirable as it follows the rule that the
order of the superclasses listed in contains is used to break ties
when multiple methods match.  Here, there are two coerce() methods
(invoked via as()) one for SQLiteConnection and one, I believe
auto-generated, for integer.  Since SQLiteConnection comes first, it
is chosen.  Indeed, if you try the following, you get the error you
were originally seeing:

    setClass("SQLConMinus", contains=c("integer", "SQLiteConnection"))
    con2 = new("SQLConMinus", dbConnect(SQLite(), ":memory:"), 11L)
    
    > as(con, "integer")
    [1] 15395     2
    > as(con2, "integer")
    [1] 11
    > 

> Why not extend SQLiteConnection and add extra slots as you like.
> The dispatch will in this case be much easier to reason about.

This is still appropriate advice.  In general, inheritance should be
used with care, and multiple inheritance should be used with multiple
care.  Using representation() to add additional slots likely makes
more sense here.

+ seth

-- 
Seth Falcon | http://userprimary.net/user/

> sessionInfo()
R version 2.8.0 Under development (unstable) (--) 
i386-apple-darwin9.4.0 

locale:
C

attached base packages:
[1] stats     graphics  grDevices datasets  utils     methods   base     

other attached packages:
[1] RSQLite_0.7-0 DBI_0.2-4


From seth at userprimary.net  Thu Sep 18 06:06:19 2008
From: seth at userprimary.net (Seth Falcon)
Date: Wed, 17 Sep 2008 21:06:19 -0700
Subject: [Rd] S4 coercion responsibility
In-Reply-To: <20080918022502.GB511@ziti.local>
References: <48CE5B66.1050705@bank-banque-canada.ca>
	<20080915170741.GX33406@ziti.local>
	<20080918022502.GB511@ziti.local>
Message-ID: <20080918040619.GF511@ziti.local>

* On 2008-09-17 at 19:25 -0700 Seth Falcon wrote:
> In the latest R-devel code (svn r46542), this behaves differently (and
> works as you were hoping).  I get:
> 
>     library("RSQLite")
>     setClass("SQLConPlus", contains=c("SQLiteConnection","integer"))
>     dd = data.frame(a=1:3, b=letters[1:3])
>     con = new("SQLConPlus", dbConnect(SQLite(), ":memory:"), 11L)
>     dbWriteTable(con, "t1", dd)
>     dbListTables(con)
>     dbDisconnect(con)

*argh* I'm certain this was working for me and yet when I try to
reproduce in a new R shell it errors out.  The dispatch is not as I
wrote.

    as(con, "integer")
    [1] 11

That is, the auto-generated coerce method to integer is selected in
preference to the coerce method for SQLiteConnection.

> I think the new behavior is desirable as it follows the rule that the
> order of the superclasses listed in contains is used to break ties
> when multiple methods match.  Here, there are two coerce() methods
> (invoked via as()) one for SQLiteConnection and one, I believe
> auto-generated, for integer.  Since SQLiteConnection comes first, it
> is chosen.  Indeed, if you try the following, you get the error you
> were originally seeing:
> 
>     setClass("SQLConMinus", contains=c("integer", "SQLiteConnection"))
>     con2 = new("SQLConMinus", dbConnect(SQLite(), ":memory:"), 11L)
>     
>     > as(con, "integer")
>     [1] 15395     2
>     > as(con2, "integer")
>     [1] 11
>     > 

I'm still baffled how this was working for me and now is not.
Nevertheless, I think it is how things *should* work and will do some
further investigation about what's going on.

-- 
Seth Falcon | http://userprimary.net/user/


From seth at userprimary.net  Thu Sep 18 06:21:10 2008
From: seth at userprimary.net (Seth Falcon)
Date: Wed, 17 Sep 2008 21:21:10 -0700
Subject: [Rd] S4 coercion responsibility
In-Reply-To: <20080918040619.GF511@ziti.local>
References: <48CE5B66.1050705@bank-banque-canada.ca>
	<20080915170741.GX33406@ziti.local>
	<20080918022502.GB511@ziti.local> <20080918040619.GF511@ziti.local>
Message-ID: <20080918042110.GH511@ziti.local>

Continuing to talk to myself here...

* On 2008-09-17 at 21:06 -0700 Seth Falcon wrote:
> *argh* I'm certain this was working for me and yet when I try to
> reproduce in a new R shell it errors out.

This looks like an infelicity in the methods caching.

To make it work:

    library("RSQLite")
    setClass("SQLConPlus", contains=c("SQLiteConnection","integer"))
    dd = data.frame(a=1:3, b=letters[1:3])
    con.orig = dbConnect(SQLite(), ":memory:")
    con = new("SQLConPlus", con.orig, 11L)

    ## call selectMethod, must have a side-effect on the
    ## methods cache
    selectMethod(coerce, signature=c("SQLConPlus", "integer"))

    dbWriteTable(con, "t1", dd)
    dbListTables(con)
    dbDisconnect(con)

Now I get:

    as(con, "integer")
    [1] 15719     0

Haven't tried the above in an older version of R.

-- 
Seth Falcon | http://userprimary.net/user/


From mflawren at fhcrc.org  Thu Sep 18 14:59:06 2008
From: mflawren at fhcrc.org (Michael Lawrence)
Date: Thu, 18 Sep 2008 05:59:06 -0700
Subject: [Rd] Rterm.exe, windows event loop running in multiple threads?
Message-ID: <509e0620809180559k6c18a6e1he065daa5bd5a08d7@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20080918/e9932b5c/attachment.pl>

From murdoch at stats.uwo.ca  Thu Sep 18 15:28:42 2008
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Thu, 18 Sep 2008 09:28:42 -0400
Subject: [Rd] Rterm.exe, windows event loop running in multiple threads?
In-Reply-To: <509e0620809180559k6c18a6e1he065daa5bd5a08d7@mail.gmail.com>
References: <509e0620809180559k6c18a6e1he065daa5bd5a08d7@mail.gmail.com>
Message-ID: <48D2578A.5040202@stats.uwo.ca>

On 18/09/2008 8:59 AM, Michael Lawrence wrote:
> For processing events, RGtk2 has moved away from using the old tcl_do hack
> and now synchronizes on the Windows event loop. In Rgui.exe this works fine
> (well mostly), but in Rterm.exe, users report the following warning from
> GLib: "main loop already active in another thread". The most obvious way
> this could occur is if the Windows event loop were iterating in multiple
> threads. This does not seem to be the case from my casual inspection of the
> R source.

Rterm sets up separate threads to handle Windows messages and console 
input, so that the graphics devices can be updated while the console is 
waiting for input.  You can see the source in src/gnuwin32/system.c: 
look for "lineavailable", which indicates that the reader thread has 
read something.

Duncan Murdoch


From mflawren at fhcrc.org  Thu Sep 18 15:38:55 2008
From: mflawren at fhcrc.org (Michael Lawrence)
Date: Thu, 18 Sep 2008 06:38:55 -0700
Subject: [Rd] Rterm.exe, windows event loop running in multiple threads?
In-Reply-To: <48D2578A.5040202@stats.uwo.ca>
References: <509e0620809180559k6c18a6e1he065daa5bd5a08d7@mail.gmail.com>
	<48D2578A.5040202@stats.uwo.ca>
Message-ID: <509e0620809180638l19ded259w439bbcb8c2c1ba12@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20080918/7989afe1/attachment.pl>

From anders at ebi.ac.uk  Thu Sep 18 16:04:19 2008
From: anders at ebi.ac.uk (Simon Anders)
Date: Thu, 18 Sep 2008 15:04:19 +0100 (BST)
Subject: [Rd] Rterm.exe, windows event loop running in multiple threads?
In-Reply-To: <509e0620809180638l19ded259w439bbcb8c2c1ba12@mail.gmail.com>
References: <509e0620809180559k6c18a6e1he065daa5bd5a08d7@mail.gmail.com>
	<48D2578A.5040202@stats.uwo.ca>
	<509e0620809180638l19ded259w439bbcb8c2c1ba12@mail.gmail.com>
Message-ID: <49633.192.54.49.174.1221746659.squirrel@webmail.ebi.ac.uk>

Hi Michael,

Michael Lawrence wrote:
>>> For processing events, RGtk2 has moved away from using the old tcl_do
hack
>>> and now synchronizes on the Windows event loop. In Rgui.exe this works
>>> fine
>>> (well mostly), but in Rterm.exe, users report the following warning from
>>> GLib: "main loop already active in another thread". The most obvious way
>>> this could occur is if the Windows event loop were iterating in multiple
>>> threads. This does not seem to be the case from my casual inspection of
>>> the
>>> R source.

Following your advice, I have changed my HilbertCurveDisplay package from
the tcl_do hack to your threading technique.

IIRC, you start this second thread whose event handler gets called
periodically by a timer. It checks whether there are any pending Gtk
events, and if so, sends a message to the R main thread in order to cause
one GTK event loop iteration.

I have writen my gtkmm code the same way and got the same error message,
repeated many times. However, after I removed the check for pending events
from the handler of the timer event, the error message vanishes. It seems
that GTK does not like it if gtk_events_pending() is called from two
threads even if both threads refer to the same main loop. (Actually, it
does not mind, as the error is just a warning, and fucntionality ois not
disrupted. I guess that Rgui.exe gets the same warning but fails to
display it.)

Could this be the problem for you as well?

[Thinking a bout this again: Why, actually, do we need a second thread.
Could we not set up a Windows timer that dispatches a message to the main
thread's event handler peridoically to trigger a polling of the Gtk event
loop?]

  Simon



+---
| Dr. Simon Anders, Dipl. Phys.
| European Bioinformatics Institute, Hinxton, Cambridgeshire, UK
| office phone +44-1223-494478, mobile phone +44-7505-841692
| preferred (permanent) e-mail: sanders at fs.tum.de


From jmc at r-project.org  Thu Sep 18 16:20:14 2008
From: jmc at r-project.org (John Chambers)
Date: Thu, 18 Sep 2008 10:20:14 -0400
Subject: [Rd] setIs() with coerce= and method selection
Message-ID: <48D2639E.6030705@r-project.org>

A bug has been fixed that basically broke the use of setIs() to define 
explicit inheritance with coerce= and replace= methods.

For inherited methods to work in this case, the argument(s) need to be 
coerced by as() to the defined class in the signature.  This was not 
being done, meaning that any method that relied on the slots or other 
details would fail if the two classes had different representation.

This has been fixed.  Doing so required adding an option in setGeneric() 
to not use such inheritance.  Functions such as initialize() rely on the 
object they get really being the original argument, which is the case 
with simple inheritance but not always with coerce=.  The argument 
simpleInheritanceOnly= to setGeneric() adds this option.

Would owners of packages that use this form of setIs() please try out 
the fixed code, revision 46546.  (That no one has reported this bug 
suggests that the feature isn't used much.)

For details on the issue, see ?setIs and the simpleInheritanceOnly= 
argument in ?setGeneric.

John


From rmh at temple.edu  Wed Sep 17 23:25:18 2008
From: rmh at temple.edu (rmh at temple.edu)
Date: Wed, 17 Sep 2008 23:25:18 +0200 (CEST)
Subject: [Rd] documentation improvement request: add search (PR#12905)
Message-ID: <20080917212518.C5AF9283417B@mail.pubhealth.ku.dk>

# R for Windows will not send your bug report automatically.
# Please copy the bug report (after finishing it) to
# your favorite email program and send it to
#
#       r-bugs at r-project.org
#
######################################################

> help.search("normal probability plot")
No help files found with alias or concept or title matching 'normal
probability plot' using fuzzy matching.


> help.search("probability plot")
finds
  probplot(e1071)         Probability Plot
  ppoints(stats)          Ordinates for Probability Plotting
both of which reference qqnorm.


I would like both the original help.search() calls to find qqnorm
  qqnorm(stats)           Quantile-Quantile Plots

Thanks
Rich



--please do not edit the information below--

Version:
 platform = i386-pc-mingw32
 arch = i386
 os = mingw32
 system = i386, mingw32
 status = 
 major = 2
 minor = 7.2
 year = 2008
 month = 08
 day = 25
 svn rev = 46428
 language = R
 version.string = R version 2.7.2 (2008-08-25)

Windows XP (build 2600) Service Pack 3

Locale:
LC_COLLATE=English_United States.1252;LC_CTYPE=English_United 
States.1252;LC_MONETARY=English_United States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252

Search Path:
 .GlobalEnv, package:RcmdrPlugin.HH, package:leaps, package:HH, package:multcomp, package:mvtnorm, 
package:grid, package:lattice, package:Rcmdr, package:car, package:tcltk, package:stats, 
package:graphics, package:grDevices, package:datasets, package:rcom, package:utils, 
package:methods, RExcelEnv, RcmdrEnv, Autoloads, package:base


From jake.michaelson at gmail.com  Fri Sep 19 11:15:47 2008
From: jake.michaelson at gmail.com (Jake Michaelson)
Date: Fri, 19 Sep 2008 11:15:47 +0200
Subject: [Rd] indexing by character with identical names
Message-ID: <1221815747.7356.83.camel@slipstream>

Hi all,

I've been using R for a while, but was puzzled when I just barely
noticed this behavior:

> x <- 1:10
> names(x) <- c("a","b","a",letters[1:7])
> x
 a  b  a  a  b  c  d  e  f  g 
 1  2  3  4  5  6  7  8  9 10 

> x["a"]
a 
1 

... that is, if a vector has identical (and therefore ambiguous) names,
it only returns the first match when the vector is indexed by a
non-unique name.  From my perspective, a more sensible behavior would be
to return *all* elements which carry the non-unique name (e.g.
x[names(x)=="a"] ), since it's ambiguous as to which element the user
actually wanted to extract.  It just seems safer than quietly returning
only the first matched element with no warning or other indication as to
what's actually happening.

I couldn't find that this behavior is explicitly documented in the help
file for '[' or 'names'.

I also couldn't find any prior discussion of this behavior.  Is this
something that could be addressed in an upcoming release of R? 

Thanks,

jake

R version 2.7.2 (2008-08-25) 
x86_64-unknown-linux-gnu


From b.rowlingson at lancaster.ac.uk  Fri Sep 19 12:07:25 2008
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Fri, 19 Sep 2008 11:07:25 +0100
Subject: [Rd] indexing by character with identical names
In-Reply-To: <1221815747.7356.83.camel@slipstream>
References: <1221815747.7356.83.camel@slipstream>
Message-ID: <d8ad40b50809190307s70139cbah57bdd59c27591d2a@mail.gmail.com>

2008/9/19 Jake Michaelson <jake.michaelson at gmail.com>

> ... that is, if a vector has identical (and therefore ambiguous) names,
> it only returns the first match when the vector is indexed by a
> non-unique name.  From my perspective, a more sensible behavior would be
> to return *all* elements which carry the non-unique name (e.g.
> x[names(x)=="a"] ), since it's ambiguous as to which element the user
> actually wanted to extract.  It just seems safer than quietly returning
> only the first matched element with no warning or other indication as to
> what's actually happening.

 Some people may think it sensible that indexing a vector with an
index of length N returns a vector of length N:

 > x[c("a","b","a")]
 a b a
 1 2 1

> I also couldn't find any prior discussion of this behavior.  Is this
> something that could be addressed in an upcoming release of R?

 Changing this would probably (no, definitely!) break stuff. Breaking
stuff is a bad thing. Perhaps the upcoming R version Aleph-null
release would be the right place for it...

 R is not like other programming languages, so your perspective of
sensibility of minimal use here. You will get bitten by these gotchas.
I bet everyone on this mailing list has done a X[1,] and got bitten by
not having drop=FALSE....

 Ouch. Writing tests on edge cases is a good thing, since it catches
these problems (if you write your tests well!).

Barry


From jake.michaelson at gmail.com  Fri Sep 19 12:20:46 2008
From: jake.michaelson at gmail.com (Jake Michaelson)
Date: Fri, 19 Sep 2008 12:20:46 +0200
Subject: [Rd] indexing by character with identical names
In-Reply-To: <d8ad40b50809190307s70139cbah57bdd59c27591d2a@mail.gmail.com>
References: <1221815747.7356.83.camel@slipstream>
	<d8ad40b50809190307s70139cbah57bdd59c27591d2a@mail.gmail.com>
Message-ID: <1221819646.7356.89.camel@slipstream>

On Fri, 2008-09-19 at 11:07 +0100, Barry Rowlingson wrote:

>  Some people may think it sensible that indexing a vector with an
> index of length N returns a vector of length N:
> 
>  > x[c("a","b","a")]
>  a b a
>  1 2 1

I also thought of this side of it after I sent the original email, and I
realized that this probably would break a lot of stuff.

I think at the very least the documentation for '[' could be updated to
emphasize that only first matches are returned when indexing with a
character vector.

Thanks,

Jake


From Albart.Coster at wur.nl  Fri Sep 19 16:59:30 2008
From: Albart.Coster at wur.nl (Coster, Albart)
Date: Fri, 19 Sep 2008 16:59:30 +0200
Subject: [Rd] Extract method for a new class
References: <mailman.17.1221818408.18628.r-devel@r-project.org>
Message-ID: <7A2D90F7A83A7547AE23FFC56E88D4F2C4B50E@scomp0039.wurnet.nl>

Dear list,

I am trying to write a package for simulating meioses in R. We defined a class 'haplotype' which contains the basic units of our simulation:

setClass("haplotype",representation(snp = "numeric",qtl = "list",
                                    hID = "numeric",phID0 = "numeric",phID1 = "numeric"),
                                    prototype = list(hID = 0,phID0 = NaN,phID1 = NaN))

In addition, we define a class 'haploList', which is just a list of haplotypes:

setClass("haploList",contains = "list",representation(genDist = "numeric",roundDec = "integer"))

Most things work fine, but when subsetting a haploList object an object of class list is returned. I realize that I need to write a function for subsetting this new object, and tried to find the code for '[.listof' or something similar could not find it, probably due to a suboptimal understanding of how it is organized. 

My question is, how could I define a extraction function for my new class that uses all the existing functionality of the Extract function for list? 

Thanks in advance,

Albart Coster

From agajania at cs.newpaltz.edu  Fri Sep 19 20:20:15 2008
From: agajania at cs.newpaltz.edu (agajania at cs.newpaltz.edu)
Date: Fri, 19 Sep 2008 20:20:15 +0200 (CEST)
Subject: [Rd] R spec file change for building on CentOS 5.2 (PR#12939)
Message-ID: <20080919182015.8A91F282EF48@mail.pubhealth.ku.dk>


--GZVR6ND4mMseVXL/
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline


I built R 2.7.2 on CentOS 5.2 today.  I used the R.spec file posted
on the web site, but I had to change one line to get it to work.
I have attached the diffs from my spec file to the original.
(Otherwise, the build went fine.)

-- 
Aram J. Agajanian
Computer Science/UNIX Support
Academic Computing
State University of New York at New Paltz

Support the Free Software Foundation - www.fsf.org

--GZVR6ND4mMseVXL/
Content-Type: text/plain; charset=us-ascii
Content-Disposition: attachment; filename="specfile.diffs"

49c49
< %if %(rpmquery centos-release | grep -v 'not installed$' | grep -c -e '-[0-9]-[0-9].el[0-9]')
---
> %if %(rpmquery centos-release | grep -v 'not installed$' | grep -c -e '-[0-9]-[0-9].[0-9]')
128c128
< Version: 2.7.2
---
> Version: 2.7.1
131c131
< Source0: R-%{version}.tar.gz
---
> Source0: ftp://cran.r-project.org/pub/R/src/base/R-2/R-%{version}.tar.gz

--GZVR6ND4mMseVXL/--


From jaanvajakas at hot.ee  Fri Sep 19 13:10:08 2008
From: jaanvajakas at hot.ee (jaanvajakas at hot.ee)
Date: Fri, 19 Sep 2008 13:10:08 +0200 (CEST)
Subject: [Rd] family="mono" does not work (PR#12931)
Message-ID: <20080919111008.759DA282EF48@mail.pubhealth.ku.dk>

Full_Name: Jaan Vajakas
Version: 2.7.2
OS: Windows XP
Submission from: (NULL) (193.40.5.245)


When I execute the following code in the R GUI, the text "mono" is printed in
monotype font in the first plot, but in normal (sans-serif) font in the
remaining three plots:

op=par(mfrow=c(2,2))
for (i in 1:4) {
 hist(1:10,xlab="")
 mtext("normal",side=1,line=2)
 mtext("mono",side=1,line=3,family="mono")
}
par(op)


From mtmorgan at fhcrc.org  Fri Sep 19 21:40:39 2008
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Fri, 19 Sep 2008 12:40:39 -0700
Subject: [Rd] Extract method for a new class
In-Reply-To: <7A2D90F7A83A7547AE23FFC56E88D4F2C4B50E@scomp0039.wurnet.nl>
	(Albart Coster's message of "Fri, 19 Sep 2008 16:59:30 +0200")
References: <mailman.17.1221818408.18628.r-devel@r-project.org>
	<7A2D90F7A83A7547AE23FFC56E88D4F2C4B50E@scomp0039.wurnet.nl>
Message-ID: <6phskrvlya0.fsf@lamprey.fhcrc.org>

"Coster, Albart" <Albart.Coster at wur.nl> writes:

> Dear list,
>
> I am trying to write a package for simulating meioses in R. We defined
> a class 'haplotype' which contains the basic units of our simulation:
>
> setClass("haplotype",representation(snp = "numeric",qtl = "list", hID
> = "numeric",phID0 = "numeric",phID1 = "numeric"), prototype = list(hID
> = 0,phID0 = NaN,phID1 = NaN))
>
> In addition, we define a class 'haploList', which is just a list of
> haplotypes:
>
> setClass("haploList",contains = "list",representation(genDist =
> "numeric",roundDec = "integer"))
>
> Most things work fine, but when subsetting a haploList object an
> object of class list is returned. I realize that I need to write a
> function for subsetting this new object, and tried to find the code
> for '[.listof' or something similar could not find it, probably due to
> a suboptimal understanding of how it is organized.
>
> My question is, how could I define a extraction function for my new
> class that uses all the existing functionality of the Extract function
> for list?

You can find out what the generic looks like

> getGeneric("[")
standardGeneric for "[" defined from package "base"

function (x, i, j, ..., drop = TRUE) 
standardGeneric("[", .Primitive("["))
<environment: 0xfc17a8>
Methods may be defined for arguments: x, i, j, drop
Use  showMethods("[")  for currently available ones.

and then write method(s) for your class:

setMethod("[",
          signature=signature(x="haploList", i="ANY", j="missing"),
          function(x, i, j, ..., drop=TRUE) {
              ## update and return x
              x at .Data <- x at .Data[i, drop=drop]
              x
          })

Note though that extending 'list' has hazards, e.g.,

> hlst <- new("haploList", list(a=1,b=2))
> names(hlst)
[1] "a" "b"
> names(hlst[2])
[1] "a"

where the names have been confused! You'll want to manage the names
yourself (as a separate slot) or make sure that they're removed
entirely when you create / update your object.

(Here's a variant that I like

setMethod("[",
          signature=signature(x="haploList", i="ANY", j="missing"),
          function(x, i, j, ..., drop=TRUE) {
              ## feed updated values to 'initialize'
              initialize(x, x at .Data[i])
          })

because the initialize call will [provided any initialize methods
defined on contained classes don't interfer] minimize copying. You'll
also likely want methods for $ and [[, and assignment methods [<-
etc.)
          
Hope that helps,

Martin

> Thanks in advance,
>
> Albart Coster ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Martin Morgan
Computational Biology / Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N.
PO Box 19024 Seattle, WA 98109

Location: Arnold Building M2 B169
Phone: (206) 667-2793


From zivan.karaman at gmail.com  Fri Sep 19 19:25:07 2008
From: zivan.karaman at gmail.com (zivan.karaman at gmail.com)
Date: Fri, 19 Sep 2008 19:25:07 +0200 (CEST)
Subject: [Rd] readRegistry function (PR#12937)
Message-ID: <20080919172507.B627C282EF48@mail.pubhealth.ku.dk>

Full_Name: Zivan Karaman
Version: 2.7.2
OS: Windows XP
Submission from: (NULL) (195.6.68.214)


I'm puzzled by the readRegistry function.

Shouldn't the "hive" argument be something like 
c("HLM", "HCR", "HCU", "HU", "HCC", "HPD") rather than 
c("HLM", "HCR", "HCU", "HU", "HCC, HPD").

For example,
> readRegistry("Test",  "HCC, HPD")
Error in readRegistry("Test", "HCC, HPD") : invalid 'hive' value

Please note also that only the first character of the 'key' argument value is
printed in case of error (key not found).

> readRegistry("SOFTWARE\\DummyTest",  "HLM")
Error in readRegistry("SOFTWARE\\DummyTest", "HLM") : 
  Registry key 'S' not found

> sessionInfo()
R version 2.7.2 (2008-08-25) 
i386-pc-mingw32 

locale:
LC_COLLATE=French_France.1252;LC_CTYPE=French_France.1252;LC_MONETARY=French_France.1252;LC_NUMERIC=C;LC_TIME=French_France.1252

attached base packages:
[1] stats     graphics  grDevices utils     base


From murdoch at stats.uwo.ca  Fri Sep 19 21:58:46 2008
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Fri, 19 Sep 2008 15:58:46 -0400
Subject: [Rd] readRegistry function (PR#12937)
In-Reply-To: <20080919172507.B627C282EF48@mail.pubhealth.ku.dk>
References: <20080919172507.B627C282EF48@mail.pubhealth.ku.dk>
Message-ID: <48D40476.3020203@stats.uwo.ca>

On 9/19/2008 1:25 PM, zivan.karaman at gmail.com wrote:
> Full_Name: Zivan Karaman
> Version: 2.7.2
> OS: Windows XP
> Submission from: (NULL) (195.6.68.214)
> 
> 
> I'm puzzled by the readRegistry function.
> 
> Shouldn't the "hive" argument be something like 
> c("HLM", "HCR", "HCU", "HU", "HCC", "HPD") rather than 
> c("HLM", "HCR", "HCU", "HU", "HCC, HPD").

Yes, that's a typo.  I'll fix it.
> 
> For example,
>> readRegistry("Test",  "HCC, HPD")
> Error in readRegistry("Test", "HCC, HPD") : invalid 'hive' value
> 
> Please note also that only the first character of the 'key' argument value is
> printed in case of error (key not found).
> 
>> readRegistry("SOFTWARE\\DummyTest",  "HLM")
> Error in readRegistry("SOFTWARE\\DummyTest", "HLM") : 
>   Registry key 'S' not found

I'll also fix that.  Thanks for the report!

Duncan Murdoch

>> sessionInfo()
> R version 2.7.2 (2008-08-25) 
> i386-pc-mingw32 
> 
> locale:
> LC_COLLATE=French_France.1252;LC_CTYPE=French_France.1252;LC_MONETARY=French_France.1252;LC_NUMERIC=C;LC_TIME=French_France.1252
> 
> attached base packages:
> [1] stats     graphics  grDevices utils     base
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From p.dalgaard at biostat.ku.dk  Sat Sep 20 10:12:08 2008
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Sat, 20 Sep 2008 10:12:08 +0200
Subject: [Rd] family="mono" does not work (PR#12931)
In-Reply-To: <20080919111008.759DA282EF48@mail.pubhealth.ku.dk>
References: <20080919111008.759DA282EF48@mail.pubhealth.ku.dk>
Message-ID: <48D4B058.60801@biostat.ku.dk>

jaanvajakas at hot.ee wrote:
> Full_Name: Jaan Vajakas
> Version: 2.7.2
> OS: Windows XP
> Submission from: (NULL) (193.40.5.245)
>
>
> When I execute the following code in the R GUI, the text "mono" is printed in
> monotype font in the first plot, but in normal (sans-serif) font in the
> remaining three plots:
>
> op=par(mfrow=c(2,2))
> for (i in 1:4) {
>  hist(1:10,xlab="")
>  mtext("normal",side=1,line=2)
>  mtext("mono",side=1,line=3,family="mono")
> }
> par(op)
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>   
This seems to be specific to the Windows driver. I see it in R running 
under Wine on Fedora, but not in native R (X11), and not in the pdf 
driver either, even when run via Wine.

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907


From murdoch at stats.uwo.ca  Sat Sep 20 13:20:48 2008
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Sat, 20 Sep 2008 07:20:48 -0400
Subject: [Rd] family="mono" does not work (PR#12931)
In-Reply-To: <48D4B058.60801@biostat.ku.dk>
References: <20080919111008.759DA282EF48@mail.pubhealth.ku.dk>
	<48D4B058.60801@biostat.ku.dk>
Message-ID: <48D4DC90.90902@stats.uwo.ca>

Peter Dalgaard wrote:
> jaanvajakas at hot.ee wrote:
>   
>> Full_Name: Jaan Vajakas
>> Version: 2.7.2
>> OS: Windows XP
>> Submission from: (NULL) (193.40.5.245)
>>
>>
>> When I execute the following code in the R GUI, the text "mono" is printed in
>> monotype font in the first plot, but in normal (sans-serif) font in the
>> remaining three plots:
>>
>> op=par(mfrow=c(2,2))
>> for (i in 1:4) {
>>  hist(1:10,xlab="")
>>  mtext("normal",side=1,line=2)
>>  mtext("mono",side=1,line=3,family="mono")
>> }
>> par(op)
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>   
>>     
> This seems to be specific to the Windows driver. I see it in R running 
> under Wine on Fedora, but not in native R (X11), and not in the pdf 
> driver either, even when run via Wine.
>
>   
I'll see if I can track it down. 

Duncan Murdoch


From murdoch at stats.uwo.ca  Sat Sep 20 20:12:39 2008
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Sat, 20 Sep 2008 14:12:39 -0400
Subject: [Rd] family="mono" does not work (PR#12931)
In-Reply-To: <20080919111008.759DA282EF48@mail.pubhealth.ku.dk>
References: <20080919111008.759DA282EF48@mail.pubhealth.ku.dk>
Message-ID: <48D53D17.4060504@stats.uwo.ca>

On 19/09/2008 7:10 AM, jaanvajakas at hot.ee wrote:
> Full_Name: Jaan Vajakas
> Version: 2.7.2
> OS: Windows XP
> Submission from: (NULL) (193.40.5.245)
> 
> 
> When I execute the following code in the R GUI, the text "mono" is printed in
> monotype font in the first plot, but in normal (sans-serif) font in the
> remaining three plots:
> 
> op=par(mfrow=c(2,2))
> for (i in 1:4) {
>  hist(1:10,xlab="")
>  mtext("normal",side=1,line=2)
>  mtext("mono",side=1,line=3,family="mono")
> }
> par(op)

This was a windows() device driver bug, as Peter suspected.  Now fixed. 
  Thanks for the report!

Duncan Murdoch


From org.r-project.r-devel at pooryorick.com  Mon Sep 22 12:18:16 2008
From: org.r-project.r-devel at pooryorick.com (=?utf-8?Q?Nathan=20Coulter?=)
Date: Mon, 22 Sep 2008 10:18:16 +0000
Subject: [Rd] =?utf-8?q?handling_spaces_in_R_invocation_scripts?=
Message-ID: <20080922101816.12085.qmail@s461.sureserver.com>

On posix systems, invoking R with arguments containing shell word delimiters
(like space) doesn't currently work:

    bash-2.05b$ ./R -f "/path/to/script with spaces.R" 
    Fatal error: cannot open file '/path/to/script': No such file or directory

The attached patch, built against the devel snapshot of 2008-09-20, attempts to
fix this problem.  In R.sh.in and BATCH, it uses the only array available in a
portable script, positional parameters, to collect arguments, and does away
with $args, avoiding the quoting issues in the exec line which are currently
problematic.  The test criteria in the argument loop is replaced with an
explicit loop through all incoming positional parameters, eventually shifting
them all out and replacing them with modified parameters.  This handles shell
delimiters and blank positional arguments more gracefully.  Empty-string
positional arguments might not normally  be considered useful, but one never
knows.  

In BATCH, there isn't currently a realistic need to be absolutely careful about
passing shell parameters straight through, spaces and all, because the only
place one foresees spaces being encountered is in an --args argument, which the
current R CMD BATCH syntax hardly encourages.  But for consistency in the
source code, and to open the discussion about possibly changing the syntax of R
CMD BATCH to make --args easier to use, I changed the loop handling there as
well.  I'd prefer to see outfile specified with a "-o" option, instead of as a
possible final positional argument.  If there wasn't an optional argument after
infile, the semantics of "--" could be changed to mean the end of options to R
CMD BATCH, with all further arguments save the final one passed into the R
program (example below).

One implication of getting arg-passing right in the shell is that a workaround
people have been employing will behave differently.  Currently, the following
syntax gets some arguments into R in batch mode:

    ./R-devel CMD BATCH '--args arg1 arg2 arg3' "/path/to/script with spaces.R"

With the patch, each argument would need to be passed separately.  The
advantage is that shell word delimiters could occur:

    ./R-devel CMD BATCH --args "-a=argument 1" -arg2 -arg3 "/path/to/script with spaces.R"

Perhaps, though, this syntax would be better:

    ./R-devel CMD BATCH -o outfile.Rout -- --args "a=argument 1" arg2 arg3 "/path/to/script with spaces.R"

The patch also does away with extraneous curly brackets around variables.  This
probably trounces someone's shell-scripting style, but functionally, they're
useless, and visually, they don't accomplish anything that a syntax-colorizing
editor won't already make obvious.


-- 
Nathan Coulter



From plummer at iarc.fr  Mon Sep 22 12:22:55 2008
From: plummer at iarc.fr (Martyn Plummer)
Date: Mon, 22 Sep 2008 12:22:55 +0200
Subject: [Rd] R spec file change for building on CentOS 5.2 (PR#12939)
In-Reply-To: <20080919182015.8A91F282EF48@mail.pubhealth.ku.dk>
References: <20080919182015.8A91F282EF48@mail.pubhealth.ku.dk>
Message-ID: <1222078975.19654.51.camel@seurat.iarc.fr>

Thanks. 

We are moving away from the one-size-fits-all spec file for R 2.8.0, but
you should still be able to rebuild the RedHat 5 source RPM.

On Fri, 2008-09-19 at 20:20 +0200, agajania at cs.newpaltz.edu wrote:
> --GZVR6ND4mMseVXL/
> Content-Type: text/plain; charset=us-ascii
> Content-Disposition: inline
> 
> 
> I built R 2.7.2 on CentOS 5.2 today.  I used the R.spec file posted
> on the web site, but I had to change one line to get it to work.
> I have attached the diffs from my spec file to the original.
> (Otherwise, the build went fine.)
> 

-----------------------------------------------------------------------
This message and its attachments are strictly confidenti...{{dropped:8}}


From org.r-project.r-devel at pooryorick.com  Mon Sep 22 14:41:44 2008
From: org.r-project.r-devel at pooryorick.com (Nathan Coulter)
Date: Mon, 22 Sep 2008 08:41:44 -0400
Subject: [Rd] handling spaces in R invocation scripts
In-Reply-To: <20080922101816.12085.qmail@s461.sureserver.com>
References: <20080922101816.12085.qmail@s461.sureserver.com>
Message-ID: <48D79288.6080400@pooryorick.com>

Nathan Coulter wrote:

> The attached patch, built against the devel snapshot of 2008-09-20, attempts to

Looks like the patch got stripped out.  Here's a link to it:

     http://files.pooryorick.com/2006c1c9f854710cc69ceb5477822ff6a884130a

-- 
Nathan Coulter


From osklyar at maninvestments.com  Mon Sep 22 19:27:34 2008
From: osklyar at maninvestments.com (Sklyar, Oleg (London))
Date: Mon, 22 Sep 2008 18:27:34 +0100
Subject: [Rd] Extract method for a new class
In-Reply-To: <7A2D90F7A83A7547AE23FFC56E88D4F2C4B50E@scomp0039.wurnet.nl>
References: <mailman.17.1221818408.18628.r-devel@r-project.org> 
	<7A2D90F7A83A7547AE23FFC56E88D4F2C4B50E@scomp0039.wurnet.nl>
Message-ID: <1A68FCB28DE72F4BA3B967E6506CCE4303049794@mildnpexmb01.maninvestments.ad.man.com>

You will need to define several for different combinations of i and j
types e.g. ANY,missing; ANY,ANY; missing,ANY or possibly for types like
integer, character and logical more or less in the following way:

setMethod("[", signature(x="haplogList", i="ANY",j="ANY"),
	function(x, i, j, ..., drop=TRUE) {
		## do whatever you want here; your class is not derived
from a list
 		## so we cannot use NextMethod
	}
)

Dr Oleg Sklyar
Research Technologist
AHL / Man Investments Ltd
+44 (0)20 7144 3107
osklyar at maninvestments.com 

> -----Original Message-----
> From: r-devel-bounces at r-project.org 
> [mailto:r-devel-bounces at r-project.org] On Behalf Of Coster, Albart
> Sent: 19 September 2008 16:00
> To: r-devel at r-project.org
> Subject: [Rd] Extract method for a new class
> 
> Dear list,
> 
> I am trying to write a package for simulating meioses in R. 
> We defined a class 'haplotype' which contains the basic units 
> of our simulation:
> 
> setClass("haplotype",representation(snp = "numeric",qtl = "list",
>                                     hID = "numeric",phID0 = 
> "numeric",phID1 = "numeric"),
>                                     prototype = list(hID = 
> 0,phID0 = NaN,phID1 = NaN))
> 
> In addition, we define a class 'haploList', which is just a 
> list of haplotypes:
> 
> setClass("haploList",contains = "list",representation(genDist 
> = "numeric",roundDec = "integer"))
> 
> Most things work fine, but when subsetting a haploList object 
> an object of class list is returned. I realize that I need to 
> write a function for subsetting this new object, and tried to 
> find the code for '[.listof' or something similar could not 
> find it, probably due to a suboptimal understanding of how it 
> is organized. 
> 
> My question is, how could I define a extraction function for 
> my new class that uses all the existing functionality of the 
> Extract function for list? 
> 
> Thanks in advance,
> 
> Albart Coster
> 


**********************************************************************
The contents of this email are for the named addressee(s...{{dropped:22}}


From plummer at iarc.fr  Tue Sep 23 16:13:06 2008
From: plummer at iarc.fr (Martyn Plummer)
Date: Tue, 23 Sep 2008 16:13:06 +0200
Subject: [Rd] handling spaces in R invocation scripts
In-Reply-To: <48D79288.6080400@pooryorick.com>
References: <20080922101816.12085.qmail@s461.sureserver.com>
	<48D79288.6080400@pooryorick.com>
Message-ID: <1222179186.2767.10.camel@seurat.iarc.fr>

Hi Nathan,

Do you think you could provide a patch without the formatting and style
changes? This would be easier to read.

Martyn

On Mon, 2008-09-22 at 08:41 -0400, Nathan Coulter wrote:
> Nathan Coulter wrote:
> 
> > The attached patch, built against the devel snapshot of 2008-09-20, attempts to
> 
> Looks like the patch got stripped out.  Here's a link to it:
> 
>      http://files.pooryorick.com/2006c1c9f854710cc69ceb5477822ff6a884130a
> 

-----------------------------------------------------------------------
This message and its attachments are strictly confidenti...{{dropped:8}}


From Phil.Lee at morganstanley.com  Mon Sep 22 21:41:42 2008
From: Phil.Lee at morganstanley.com (Lee, Philip (IT))
Date: Mon, 22 Sep 2008 15:41:42 -0400
Subject: [Rd] Dates in C api
In-Reply-To: <e8e755250809171319h15fc8461yfd5c7ab1531ad89e@mail.gmail.com>
References: <575EAD86322DA342B50FE422364A9F52082D528B@NYWEXMB27.msad.ms.com>
	<e8e755250809171319h15fc8461yfd5c7ab1531ad89e@mail.gmail.com>
Message-ID: <575EAD86322DA342B50FE422364A9F52084BA34D@NYWEXMB27.msad.ms.com>

r-devel,

One other question just occurred to me - does R have any concept of
times alone?  I can see that there's dates, and datetimes (POSIXct etc),
but how should I represent 12:34:56 as just a time?

Thanks,
Phil

> -----Original Message-----
> From: Jeff Ryan [mailto:jeff.a.ryan at gmail.com]
> Sent: Wednesday, September 17, 2008 4:19 PM
> To: Lee, Philip (IT)
> Cc: r-devel at r-project.org
> Subject: Re: [Rd] Dates in C api
> 
> If you are looking for examples of handling dates/times (specifically
> POSIXct) within C code, the dev branch of xts has quite a bit of code
> now.
> 
> http://r-forge.r-
> project.org/plugins/scmsvn/viewcvs.php/dev/pkg/src/?root=xts
> 
> Assigning the class (or any attribute) within the C code will be much
> faster than doing it outside of C, at least in my experience with
> larger data.
> 
> setAttrib(ans, R_ClassSymbol, mkString("Date"))
> 
> HTH
> Jeff
> 
> On Wed, Sep 17, 2008 at 12:24 PM, Lee, Philip (IT)
> <Phil.Lee at morganstanley.com> wrote:
> > r-devel,
> >
> > I've been trying to write a C plugin for R, and I'm struggling to
> > understand how dates are represented.
> >
> > I can create a date in R:
> >> mydate<-as.Date(1, origin="1900-01-01") mydate
> > [1] "1900-01-02"
> >
> > When I pass my date to a plugin, though, it's type is that of a
real.
> > There doesn't seem to be a date type in Rinternals.h, is there a way
> to
> > recognize that a value is a date rather than a real?
> >
> > Equally, does anyone know if it's possible to create date values in
> the
> > C api?
> >
> > Thanks,
> > Phil Lee
> >
> > Philip Lee
> > Morgan Stanley | Technology
> > 750 Seventh Avenue, 12th Floor | New York, NY  10019
> > Phil.Lee at morganstanley.com
> > --------------------------------------------------------
> >
> > NOTICE: If received in error, please destroy and notify sender.
> Sender does not intend to waive confidentiality or privilege. Use of
> this email is prohibited when received in error.
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >
> 
> 
> 
> --
> Jeffrey Ryan
> jeffrey.ryan at insightalgo.com
> 
> ia: insight algorithmics
> www.insightalgo.com
--------------------------------------------------------

NOTICE: If received in error, please destroy and notify sender. Sender does not intend to waive confidentiality or privilege. Use of this email is prohibited when received in error.


From ggrothendieck at gmail.com  Tue Sep 23 17:23:19 2008
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Tue, 23 Sep 2008 11:23:19 -0400
Subject: [Rd] Dates in C api
In-Reply-To: <575EAD86322DA342B50FE422364A9F52084BA34D@NYWEXMB27.msad.ms.com>
References: <575EAD86322DA342B50FE422364A9F52082D528B@NYWEXMB27.msad.ms.com>
	<e8e755250809171319h15fc8461yfd5c7ab1531ad89e@mail.gmail.com>
	<575EAD86322DA342B50FE422364A9F52084BA34D@NYWEXMB27.msad.ms.com>
Message-ID: <971536df0809230823g4f6eedj66190a7feb93bec7@mail.gmail.com>

The chron package does:

library(chron)
times("12:34:56")

Internally times are represented as a faction of a day.

On Mon, Sep 22, 2008 at 3:41 PM, Lee, Philip (IT)
<Phil.Lee at morganstanley.com> wrote:
> r-devel,
>
> One other question just occurred to me - does R have any concept of
> times alone?  I can see that there's dates, and datetimes (POSIXct etc),
> but how should I represent 12:34:56 as just a time?
>
> Thanks,
> Phil
>
>> -----Original Message-----
>> From: Jeff Ryan [mailto:jeff.a.ryan at gmail.com]
>> Sent: Wednesday, September 17, 2008 4:19 PM
>> To: Lee, Philip (IT)
>> Cc: r-devel at r-project.org
>> Subject: Re: [Rd] Dates in C api
>>
>> If you are looking for examples of handling dates/times (specifically
>> POSIXct) within C code, the dev branch of xts has quite a bit of code
>> now.
>>
>> http://r-forge.r-
>> project.org/plugins/scmsvn/viewcvs.php/dev/pkg/src/?root=xts
>>
>> Assigning the class (or any attribute) within the C code will be much
>> faster than doing it outside of C, at least in my experience with
>> larger data.
>>
>> setAttrib(ans, R_ClassSymbol, mkString("Date"))
>>
>> HTH
>> Jeff
>>
>> On Wed, Sep 17, 2008 at 12:24 PM, Lee, Philip (IT)
>> <Phil.Lee at morganstanley.com> wrote:
>> > r-devel,
>> >
>> > I've been trying to write a C plugin for R, and I'm struggling to
>> > understand how dates are represented.
>> >
>> > I can create a date in R:
>> >> mydate<-as.Date(1, origin="1900-01-01") mydate
>> > [1] "1900-01-02"
>> >
>> > When I pass my date to a plugin, though, it's type is that of a
> real.
>> > There doesn't seem to be a date type in Rinternals.h, is there a way
>> to
>> > recognize that a value is a date rather than a real?
>> >
>> > Equally, does anyone know if it's possible to create date values in
>> the
>> > C api?
>> >
>> > Thanks,
>> > Phil Lee
>> >
>> > Philip Lee
>> > Morgan Stanley | Technology
>> > 750 Seventh Avenue, 12th Floor | New York, NY  10019
>> > Phil.Lee at morganstanley.com
>> > --------------------------------------------------------
>> >
>> > NOTICE: If received in error, please destroy and notify sender.
>> Sender does not intend to waive confidentiality or privilege. Use of
>> this email is prohibited when received in error.
>> >
>> > ______________________________________________
>> > R-devel at r-project.org mailing list
>> > https://stat.ethz.ch/mailman/listinfo/r-devel
>> >
>>
>>
>>
>> --
>> Jeffrey Ryan
>> jeffrey.ryan at insightalgo.com
>>
>> ia: insight algorithmics
>> www.insightalgo.com
> --------------------------------------------------------
>
> NOTICE: If received in error, please destroy and notify sender. Sender does not intend to waive confidentiality or privilege. Use of this email is prohibited when received in error.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From edd at debian.org  Tue Sep 23 17:25:59 2008
From: edd at debian.org (Dirk Eddelbuettel)
Date: Tue, 23 Sep 2008 10:25:59 -0500
Subject: [Rd] Dates in C api
In-Reply-To: <575EAD86322DA342B50FE422364A9F52084BA34D@NYWEXMB27.msad.ms.com>
References: <575EAD86322DA342B50FE422364A9F52082D528B@NYWEXMB27.msad.ms.com>
	<e8e755250809171319h15fc8461yfd5c7ab1531ad89e@mail.gmail.com>
	<575EAD86322DA342B50FE422364A9F52084BA34D@NYWEXMB27.msad.ms.com>
Message-ID: <18649.2695.232428.908026@ron.nulle.part>


On 22 September 2008 at 15:41, Lee, Philip \(IT\) wrote:
| r-devel,
| 
| One other question just occurred to me - does R have any concept of
| times alone?  I can see that there's dates, and datetimes (POSIXct etc),
| but how should I represent 12:34:56 as just a time?

AFAIK you cannot as there is no such type. You could of course create one.

We just had that come up in RPostgreSQL as SQL has 'time' but R doesn't. So
we return SQL columns of type time as characters. RODBC does the same. If
there is a better way, someone tell us

By the way, you may find the manuals at 

	http://cran.us.r-project.org/manuals.html

of value, in particular the 'R Internal' and 'R language definition'.

Dirk

-- 
Three out of two people have difficulties with fractions.


From han at enfor.dk  Tue Sep 23 17:25:07 2008
From: han at enfor.dk (han at enfor.dk)
Date: Tue, 23 Sep 2008 17:25:07 +0200 (CEST)
Subject: [Rd] Bug in base::mean.default ? (PR#12984)
Message-ID: <20080923152507.231832834169@mail.pubhealth.ku.dk>

In the body of base::mean.default the following piece of code is found:

        if (trim >= 0.5)
            return(stats::median(x, na.rm = FALSE))

Should this not be

         if (trim >= 0.5)
            return(stats::median(x, na.rm = na.rm))

where na.rm is supplied in the call to mean.default?

If considered a bug I can imagine why it has low practical importance...

Kind regards,
Henrik


From hb at stat.berkeley.edu  Tue Sep 23 19:46:21 2008
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Tue, 23 Sep 2008 10:46:21 -0700
Subject: [Rd] Bug in base::mean.default ? (PR#12984)
In-Reply-To: <20080923152507.231832834169@mail.pubhealth.ku.dk>
References: <20080923152507.231832834169@mail.pubhealth.ku.dk>
Message-ID: <59d7961d0809231046q7f6b5af7yf6faf290d477a438@mail.gmail.com>

Not a bug.  There is a statement in base::mean.default() before this

    if (na.rm)
        x <- x[!is.na(x)]

that removes any missing values.  Thus, it is known that there are no
missing values beyond this statement.

/Henrik

On Tue, Sep 23, 2008 at 8:25 AM,  <han at enfor.dk> wrote:
> In the body of base::mean.default the following piece of code is found:
>
>        if (trim >= 0.5)
>            return(stats::median(x, na.rm = FALSE))
>
> Should this not be
>
>         if (trim >= 0.5)
>            return(stats::median(x, na.rm = na.rm))
>
> where na.rm is supplied in the call to mean.default?
>
> If considered a bug I can imagine why it has low practical importance...
>
> Kind regards,
> Henrik
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From imanpreet at gmail.com  Wed Sep 24 04:43:23 2008
From: imanpreet at gmail.com (Imanpreet)
Date: Wed, 24 Sep 2008 08:13:23 +0530
Subject: [Rd] Fwd: Profiling on Multicore and Parallel Systems
In-Reply-To: <c26b95920809221304h7f25be45rd03c6fa781ee0001@mail.gmail.com>
References: <c26b95920809221304h7f25be45rd03c6fa781ee0001@mail.gmail.com>
Message-ID: <c26b95920809231943o4c05ce1bvf4c1926456cca5fa@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20080924/73396f03/attachment.pl>

From pdevalpine at gmail.com  Wed Sep 24 06:50:51 2008
From: pdevalpine at gmail.com (Perry de Valpine)
Date: Tue, 23 Sep 2008 21:50:51 -0700
Subject: [Rd] function can permanently modify calling function via
	substitute?
Message-ID: <34988bf10809232150g65e3aba3l9ddffae0d6b2c70b@mail.gmail.com>

Dear R-devel:

The following code seems to allow one function to permanently modify a
calling function.  I did not expect this would be allowed (short of
more creative gymnastics) and wonder if it is really intended.  (I can
see other ways to accomplish the intended task of this code [e.g. via
match.call instead of substitute below] that do not trigger the
problem, but I don't think that is the point.)

do.nothing <- function(blah) {force(blah)}

do.stuff.with.call <- function(mycall) {
  raw.mycall <- substitute(mycall);   # expected raw.mycall would be local
  print( sys.call() )

  # do.nothing( raw.mycall );  # See below re: commented lines.
  # .Call( "showNAMED", raw.mycall[[2]] )

  force( mycall );  # not relevant where (or whether) this is done
  raw.mycall[[2]] <- runif(1); # permanently modifies try.me on the
first time only

  # .Call( "showNAMED", raw.mycall[[2]] )

  raw.mycall
}

gumbo <- function(x) {
  writeLines( paste( "gumbo : x =" ,  x ) )
  return(x);
}

try.me <- function() {
  one.val <- 111;
  one.ans <- do.stuff.with.call( mycall = gumbo( x = one.val ) );
  one.ans
}

# after source()ing the above:
> deparse(try.me)
[1] "function () "
[2] "{"
[3] "    one.val <- 111"
[4] "    one.ans <- do.stuff.with.call(mycall = gumbo(x = one.val))"
[5] "    one.ans"
[6] "}"
> try.me()
do.stuff.with.call(mycall = gumbo(x = one.val))
gumbo : x = 0.396524668671191
gumbo(x = 0.396524668671191)
> deparse(try.me)
[1] "function () "
[2] "{"
[3] "    one.val <- 111"
[4] "    one.ans <- do.stuff.with.call(mycall = gumbo(x = 0.396524668671191))"
[5] "    one.ans"
[6] "}"
> try.me()
do.stuff.with.call(mycall = gumbo(x = 0.396524668671191))
gumbo : x = 0.396524668671191
gumbo(x = 0.0078618151601404)
> deparse(try.me)
[1] "function () "
[2] "{"
[3] "    one.val <- 111"
[4] "    one.ans <- do.stuff.with.call(mycall = gumbo(x = 0.396524668671191))"
[5] "    one.ans"
[6] "}"

So, after the first call of try.me(), do.stuff.with.call has
permanently replaced the name one.val in line 2 of try.me with a
numeric (0.396...).  Subsequent calls from try.me to
do.stuff.with.call now reflect that change, but do.stuff.with.call
does not modify the try.me object again. (Note this means one needs to
keep reloading try.me to investigate).

If this is a problem worth investigating, here are a couple of other
observations that may be relevant but are obviously speculative.

1. If the third line of do.stuff.with.call is uncommented (and try.me
also reloaded), the unexpected behavior does not occur.  Since
do.nothing is eponymous, I was surprised because I believed it should
not impact any other behavior.  Speculating with limited knowledge, I
thought this might implicate something that is supposed to stay
under-the-hood, such as the "`call by value' illusion" described in
the "R internals" documentation.

2. Poking slightly further, I looked at the NAMED values using this C
code via R CMD SHLIB and dyn.load:
#include "R.h"
#include "Rdefines.h"
SEXP showNAMED(SEXP obj) {
  Rprintf("%i\n", NAMED(obj));
  return(R_NilValue);
}
Uncommenting the .Call lines in do.stuff.with.call (with the
do.nothing line re-commented) reveals that on the first time
do.stuff.with.call is called from try.me, raw.mycall[[2]] has NAMED ==
1 both before and after the `[[<-` line.  On subsequent calls it has
NAMED == 2 before and NAMED == 1 after.  If I follow how NAMED is
used, this seems relevant.

Many thanks in advance for any responses.

Perry de Valpine
----------------------
> sessionInfo(); ## Also checked on Windows XP Professional running R-7.2.1, beyond my control to upgrade

R version 2.7.2 (2008-08-25)
i386-apple-darwin8.11.1

locale:
C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

loaded via a namespace (and not attached):
[1] tools_2.7.2


From p.dalgaard at biostat.ku.dk  Wed Sep 24 07:54:11 2008
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Wed, 24 Sep 2008 07:54:11 +0200
Subject: [Rd] function can permanently modify calling function
	via	substitute?
In-Reply-To: <34988bf10809232150g65e3aba3l9ddffae0d6b2c70b@mail.gmail.com>
References: <34988bf10809232150g65e3aba3l9ddffae0d6b2c70b@mail.gmail.com>
Message-ID: <48D9D603.4080101@biostat.ku.dk>

Perry de Valpine wrote:
> Dear R-devel:
>
> The following code seems to allow one function to permanently modify a
> calling function.  I did not expect this would be allowed (short of
> more creative gymnastics) and wonder if it is really intended.  (I can
> see other ways to accomplish the intended task of this code [e.g. via
> match.call instead of substitute below] that do not trigger the
> problem, but I don't think that is the point.)
>
> do.nothing <- function(blah) {force(blah)}
>
> do.stuff.with.call <- function(mycall) {
>   raw.mycall <- substitute(mycall);   # expected raw.mycall would be local
>   print( sys.call() )
>
>   # do.nothing( raw.mycall );  # See below re: commented lines.
>   # .Call( "showNAMED", raw.mycall[[2]] )
>
>   force( mycall );  # not relevant where (or whether) this is done
>   raw.mycall[[2]] <- runif(1); # permanently modifies try.me on the
> first time only
>
>   # .Call( "showNAMED", raw.mycall[[2]] )
>
>   raw.mycall
> }
>
> gumbo <- function(x) {
>   writeLines( paste( "gumbo : x =" ,  x ) )
>   return(x);
> }
>
> try.me <- function() {
>   one.val <- 111;
>   one.ans <- do.stuff.with.call( mycall = gumbo( x = one.val ) );
>   one.ans
> }
>
> # after source()ing the above:
>   
>> deparse(try.me)
>>     
> [1] "function () "
> [2] "{"
> [3] "    one.val <- 111"
> [4] "    one.ans <- do.stuff.with.call(mycall = gumbo(x = one.val))"
> [5] "    one.ans"
> [6] "}"
>   
>> try.me()
>>     
> do.stuff.with.call(mycall = gumbo(x = one.val))
> gumbo : x = 0.396524668671191
> gumbo(x = 0.396524668671191)
>   
>> deparse(try.me)
>>     
> [1] "function () "
> [2] "{"
> [3] "    one.val <- 111"
> [4] "    one.ans <- do.stuff.with.call(mycall = gumbo(x = 0.396524668671191))"
> [5] "    one.ans"
> [6] "}"
>   
>> try.me()
>>     
> do.stuff.with.call(mycall = gumbo(x = 0.396524668671191))
> gumbo : x = 0.396524668671191
> gumbo(x = 0.0078618151601404)
>   
>> deparse(try.me)
>>     
> [1] "function () "
> [2] "{"
> [3] "    one.val <- 111"
> [4] "    one.ans <- do.stuff.with.call(mycall = gumbo(x = 0.396524668671191))"
> [5] "    one.ans"
> [6] "}"
>
> So, after the first call of try.me(), do.stuff.with.call has
> permanently replaced the name one.val in line 2 of try.me with a
> numeric (0.396...).  Subsequent calls from try.me to
> do.stuff.with.call now reflect that change, but do.stuff.with.call
> does not modify the try.me object again. (Note this means one needs to
> keep reloading try.me to investigate).
>
> If this is a problem worth investigating, here are a couple of other
> observations that may be relevant but are obviously speculative.
>
> 1. If the third line of do.stuff.with.call is uncommented (and try.me
> also reloaded), the unexpected behavior does not occur.  Since
> do.nothing is eponymous, I was surprised because I believed it should
> not impact any other behavior.  Speculating with limited knowledge, I
> thought this might implicate something that is supposed to stay
> under-the-hood, such as the "`call by value' illusion" described in
> the "R internals" documentation.
>
> 2. Poking slightly further, I looked at the NAMED values using this C
> code via R CMD SHLIB and dyn.load:
> #include "R.h"
> #include "Rdefines.h"
> SEXP showNAMED(SEXP obj) {
>   Rprintf("%i\n", NAMED(obj));
>   return(R_NilValue);
> }
> Uncommenting the .Call lines in do.stuff.with.call (with the
> do.nothing line re-commented) reveals that on the first time
> do.stuff.with.call is called from try.me, raw.mycall[[2]] has NAMED ==
> 1 both before and after the `[[<-` line.  On subsequent calls it has
> NAMED == 2 before and NAMED == 1 after.  If I follow how NAMED is
> used, this seems relevant.
>
>   
Yes and no. This does sound like a bug and NAMED is likely involved, but 
I don't think raw.mycall[[2]] is the thing to look at. More likely, the 
issue is that raw.mycall[ itself has NAMED == 1 because otherwise [[<- 
assignment would duplicate it first. This suggests that substitute has 
the bug.

 

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907


From mwkimpel at gmail.com  Wed Sep 24 18:12:19 2008
From: mwkimpel at gmail.com (Mark Kimpel)
Date: Wed, 24 Sep 2008 12:12:19 -0400
Subject: [Rd] splitting strings efficiently
Message-ID: <6b93d1830809240912g5bd38355r83f0e70ff2fbc141@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20080924/da43feb7/attachment.pl>

From mwkimpel at gmail.com  Wed Sep 24 18:20:35 2008
From: mwkimpel at gmail.com (Mark Kimpel)
Date: Wed, 24 Sep 2008 12:20:35 -0400
Subject: [Rd] splitting strings efficiently
In-Reply-To: <48DA6822.6090402@biostat.wisc.edu>
References: <6b93d1830809240912g5bd38355r83f0e70ff2fbc141@mail.gmail.com>
	<48DA6822.6090402@biostat.wisc.edu>
Message-ID: <6b93d1830809240920uacdc74dtf5f4e400d3a5eb7e@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20080924/1253c104/attachment.pl>

From ggrothendieck at gmail.com  Wed Sep 24 18:47:02 2008
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Wed, 24 Sep 2008 12:47:02 -0400
Subject: [Rd] splitting strings efficiently
In-Reply-To: <6b93d1830809240920uacdc74dtf5f4e400d3a5eb7e@mail.gmail.com>
References: <6b93d1830809240912g5bd38355r83f0e70ff2fbc141@mail.gmail.com>
	<48DA6822.6090402@biostat.wisc.edu>
	<6b93d1830809240920uacdc74dtf5f4e400d3a5eb7e@mail.gmail.com>
Message-ID: <971536df0809240947n4bad8e7aka7e343b2f7a91a2@mail.gmail.com>

Also one can create a text connection and read it using read.table, scan, etc.

s <- c("12;13;14", "15;16;17")

read.table(textConnection(s), sep = ";")
# or
scan(textConnection(s), sep = ";")


On Wed, Sep 24, 2008 at 12:20 PM, Mark Kimpel <mwkimpel at gmail.com> wrote:
> I knew there HAD to be a basic function, but 'help.search("split string")'
> and 'help("string") did not find it. Thanks for the help on this elementary
> question.
> Mark
> ------------------------------------------------------------
> Mark W. Kimpel MD ** Neuroinformatics ** Dept. of Psychiatry
> Indiana University School of Medicine
>
> 15032 Hunter Court, Westfield, IN 46074
>
> (317) 490-5129 Work, & Mobile & VoiceMail
> (317) 399-1219 Home
> Skype: mkimpel
>
> ******************************************************************
>
>
> On Wed, Sep 24, 2008 at 12:17 PM, Erik Iverson <iverson at biostat.wisc.edu>wrote:
>
>> ?strsplit
>>
>> Mark Kimpel wrote:
>>
>>> I have a very long list of strings. Each string actually contains multiple
>>> values separated by a semi-colon. I need to turn each string into a vector
>>> of the values delimited by the semi-colons. I know I can do this very
>>> laboriously by using loops, nchar, and substr, but it is terribly slow. Is
>>> there a basic R function that handles this situation? If not, is there
>>> perhaps a faster way to do it than I currently am, which is to lapply the
>>> following function? Thanks, Mark
>>>
>>>
>>> #######################################################################################
>>> string.tokenizer.func<-function(string, separator){
>>>  new.vec<- NULL
>>>  newString<- ""
>>>  if(is.null(string)) {new.vec<-""} else {
>>>    for(i in 1:(nchar(string) + 1)){
>>>      if(substr(string, i, i) == separator){
>>>        new.vec<-c(new.vec,newString)
>>>        newString <- ""
>>>      } else {
>>>        newString<-paste(newString, substr(string, i, i), sep="")
>>>      }
>>>    }
>>>    new.vec<-c(new.vec,newString)
>>>  }
>>>  new.vec
>>> }
>>> ------------------------------------------------------------
>>> Mark W. Kimpel MD ** Neuroinformatics ** Dept. of Psychiatry
>>> Indiana University School of Medicine
>>>
>>> 15032 Hunter Court, Westfield, IN 46074
>>>
>>> (317) 490-5129 Work, & Mobile & VoiceMail
>>> (317) 399-1219 Home
>>> Skype: mkimpel
>>>
>>> ******************************************************************
>>>
>>>        [[alternative HTML version deleted]]
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>>
>>
>>
>
>        [[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From luke at stat.uiowa.edu  Wed Sep 24 19:05:26 2008
From: luke at stat.uiowa.edu (Luke Tierney)
Date: Wed, 24 Sep 2008 12:05:26 -0500 (CDT)
Subject: [Rd] function can permanently modify calling function	via
 substitute?
In-Reply-To: <48D9D603.4080101@biostat.ku.dk>
References: <34988bf10809232150g65e3aba3l9ddffae0d6b2c70b@mail.gmail.com>
	<48D9D603.4080101@biostat.ku.dk>
Message-ID: <alpine.LFD.1.10.0809241153441.25405@nokomis.stat.uiowa.edu>

On Wed, 24 Sep 2008, Peter Dalgaard wrote:

> Perry de Valpine wrote:
>> Dear R-devel:
>> 
>> The following code seems to allow one function to permanently modify a
>> calling function.  I did not expect this would be allowed (short of
>> more creative gymnastics) and wonder if it is really intended.  (I can
>> see other ways to accomplish the intended task of this code [e.g. via
>> match.call instead of substitute below] that do not trigger the
>> problem, but I don't think that is the point.)
>> 
>> do.nothing <- function(blah) {force(blah)}
>> 
>> do.stuff.with.call <- function(mycall) {
>>   raw.mycall <- substitute(mycall);   # expected raw.mycall would be local
>>   print( sys.call() )
>>
>>   # do.nothing( raw.mycall );  # See below re: commented lines.
>>   # .Call( "showNAMED", raw.mycall[[2]] )
>>
>>   force( mycall );  # not relevant where (or whether) this is done
>>   raw.mycall[[2]] <- runif(1); # permanently modifies try.me on the
>> first time only
>>
>>   # .Call( "showNAMED", raw.mycall[[2]] )
>>
>>   raw.mycall
>> }
>> 
>> gumbo <- function(x) {
>>   writeLines( paste( "gumbo : x =" ,  x ) )
>>   return(x);
>> }
>> 
>> try.me <- function() {
>>   one.val <- 111;
>>   one.ans <- do.stuff.with.call( mycall = gumbo( x = one.val ) );
>>   one.ans
>> }
>> 
>> # after source()ing the above:
>> 
>>> deparse(try.me)
>>> 
>> [1] "function () "
>> [2] "{"
>> [3] "    one.val <- 111"
>> [4] "    one.ans <- do.stuff.with.call(mycall = gumbo(x = one.val))"
>> [5] "    one.ans"
>> [6] "}"
>> 
>>> try.me()
>>> 
>> do.stuff.with.call(mycall = gumbo(x = one.val))
>> gumbo : x = 0.396524668671191
>> gumbo(x = 0.396524668671191)
>> 
>>> deparse(try.me)
>>> 
>> [1] "function () "
>> [2] "{"
>> [3] "    one.val <- 111"
>> [4] "    one.ans <- do.stuff.with.call(mycall = gumbo(x = 
>> 0.396524668671191))"
>> [5] "    one.ans"
>> [6] "}"
>> 
>>> try.me()
>>> 
>> do.stuff.with.call(mycall = gumbo(x = 0.396524668671191))
>> gumbo : x = 0.396524668671191
>> gumbo(x = 0.0078618151601404)
>> 
>>> deparse(try.me)
>>> 
>> [1] "function () "
>> [2] "{"
>> [3] "    one.val <- 111"
>> [4] "    one.ans <- do.stuff.with.call(mycall = gumbo(x = 
>> 0.396524668671191))"
>> [5] "    one.ans"
>> [6] "}"
>> 
>> So, after the first call of try.me(), do.stuff.with.call has
>> permanently replaced the name one.val in line 2 of try.me with a
>> numeric (0.396...).  Subsequent calls from try.me to
>> do.stuff.with.call now reflect that change, but do.stuff.with.call
>> does not modify the try.me object again. (Note this means one needs to
>> keep reloading try.me to investigate).
>> 
>> If this is a problem worth investigating, here are a couple of other
>> observations that may be relevant but are obviously speculative.
>> 
>> 1. If the third line of do.stuff.with.call is uncommented (and try.me
>> also reloaded), the unexpected behavior does not occur.  Since
>> do.nothing is eponymous, I was surprised because I believed it should
>> not impact any other behavior.  Speculating with limited knowledge, I
>> thought this might implicate something that is supposed to stay
>> under-the-hood, such as the "`call by value' illusion" described in
>> the "R internals" documentation.
>> 
>> 2. Poking slightly further, I looked at the NAMED values using this C
>> code via R CMD SHLIB and dyn.load:
>> #include "R.h"
>> #include "Rdefines.h"
>> SEXP showNAMED(SEXP obj) {
>>   Rprintf("%i\n", NAMED(obj));
>>   return(R_NilValue);
>> }
>> Uncommenting the .Call lines in do.stuff.with.call (with the
>> do.nothing line re-commented) reveals that on the first time
>> do.stuff.with.call is called from try.me, raw.mycall[[2]] has NAMED ==
>> 1 both before and after the `[[<-` line.  On subsequent calls it has
>> NAMED == 2 before and NAMED == 1 after.  If I follow how NAMED is
>> used, this seems relevant.
>>
>> 
> Yes and no. This does sound like a bug and NAMED is likely involved, but I 
> don't think raw.mycall[[2]] is the thing to look at. More likely, the issue 
> is that raw.mycall[ itself has NAMED == 1 because otherwise [[<- assignment 
> would duplicate it first. This suggests that substitute has the bug.

Our extraction functions, like [[, bump up the NAMED value for
components to the value for the container (or to 2 -- doesn't look
like we are consistent here).  substitute() doesn't do that, and
perhaps could.  But arguably it is the point where the promise (from
which substitute gets the expression) is created that is the
extraction point. We could have mkPromise test for NAMED == 2 and bump
up if it isn't.  We could also have parse create all LANGSXPs with
NAMED == 2 but that leaves out programmatically created functions.
Either change fixes this bug; not sure which is the best one (or
whether we should do both).  Changing mkPromise is more conservative
and potentially a little more costly but probably not enough to
notice.

luke

-- 
Luke Tierney
Chair, Statistics and Actuarial Science
Ralph E. Wareham Professor of Mathematical Sciences
University of Iowa                  Phone:             319-335-3386
Department of Statistics and        Fax:               319-335-3017
    Actuarial Science
241 Schaeffer Hall                  email:      luke at stat.uiowa.edu
Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu


From hb at stat.berkeley.edu  Thu Sep 25 00:39:20 2008
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Wed, 24 Sep 2008 15:39:20 -0700
Subject: [Rd] splitting strings efficiently
In-Reply-To: <6b93d1830809240920uacdc74dtf5f4e400d3a5eb7e@mail.gmail.com>
References: <6b93d1830809240912g5bd38355r83f0e70ff2fbc141@mail.gmail.com>
	<48DA6822.6090402@biostat.wisc.edu>
	<6b93d1830809240920uacdc74dtf5f4e400d3a5eb7e@mail.gmail.com>
Message-ID: <59d7961d0809241539g4e7c49a1wd6f7efaf78ffbb8f@mail.gmail.com>

For strsplit(), note that fixed=TRUE is much faster.  /HB

On Wed, Sep 24, 2008 at 9:20 AM, Mark Kimpel <mwkimpel at gmail.com> wrote:
> I knew there HAD to be a basic function, but 'help.search("split string")'
> and 'help("string") did not find it. Thanks for the help on this elementary
> question.
> Mark
> ------------------------------------------------------------
> Mark W. Kimpel MD ** Neuroinformatics ** Dept. of Psychiatry
> Indiana University School of Medicine
>
> 15032 Hunter Court, Westfield, IN 46074
>
> (317) 490-5129 Work, & Mobile & VoiceMail
> (317) 399-1219 Home
> Skype: mkimpel
>
> ******************************************************************
>
>
> On Wed, Sep 24, 2008 at 12:17 PM, Erik Iverson <iverson at biostat.wisc.edu>wrote:
>
>> ?strsplit
>>
>> Mark Kimpel wrote:
>>
>>> I have a very long list of strings. Each string actually contains multiple
>>> values separated by a semi-colon. I need to turn each string into a vector
>>> of the values delimited by the semi-colons. I know I can do this very
>>> laboriously by using loops, nchar, and substr, but it is terribly slow. Is
>>> there a basic R function that handles this situation? If not, is there
>>> perhaps a faster way to do it than I currently am, which is to lapply the
>>> following function? Thanks, Mark
>>>
>>>
>>> #######################################################################################
>>> string.tokenizer.func<-function(string, separator){
>>>  new.vec<- NULL
>>>  newString<- ""
>>>  if(is.null(string)) {new.vec<-""} else {
>>>    for(i in 1:(nchar(string) + 1)){
>>>      if(substr(string, i, i) == separator){
>>>        new.vec<-c(new.vec,newString)
>>>        newString <- ""
>>>      } else {
>>>        newString<-paste(newString, substr(string, i, i), sep="")
>>>      }
>>>    }
>>>    new.vec<-c(new.vec,newString)
>>>  }
>>>  new.vec
>>> }
>>> ------------------------------------------------------------
>>> Mark W. Kimpel MD ** Neuroinformatics ** Dept. of Psychiatry
>>> Indiana University School of Medicine
>>>
>>> 15032 Hunter Court, Westfield, IN 46074
>>>
>>> (317) 490-5129 Work, & Mobile & VoiceMail
>>> (317) 399-1219 Home
>>> Skype: mkimpel
>>>
>>> ******************************************************************
>>>
>>>        [[alternative HTML version deleted]]
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>>
>>
>>
>
>        [[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From j.clayden at ucl.ac.uk  Wed Sep 24 14:36:13 2008
From: j.clayden at ucl.ac.uk (Jon Clayden)
Date: Wed, 24 Sep 2008 13:36:13 +0100
Subject: [Rd] R --interactive and readline() creates infinite loop
Message-ID: <98A53690-6407-4E86-A094-27707C77C744@ucl.ac.uk>

Dear all,

I have asked before, in R-help [1], about a way to create an  
interactive session in which commands are taken from a file or  
standard input - like R CMD BATCH but additionally allowing user input  
- but there was no response to that question, and the workarounds that  
I have found (using "expect", creating a temporary .Rprofile) are ugly  
and problematic.

With the appearance of the --interactive flag in R 2.7.0 I thought  
this might become possible, but it not only does not behave as I would  
expect, it appears to go into an infinite loop, and uses 100% CPU  
until killed.

$ echo 'print(readline("Input:"))' | R --no-save --quiet
 > print(readline("Input:"))
Input:[1] ""
 >
[no interactivity]

$ echo 'print(readline("Input:"))' | R --no-save --quiet --interactive
[no response at all]

This behaviour remains in the latest alphas of R 2.8.0. My platform is  
Mac OS X.5.5 on Intel Core 2 Duo.

I assume, given this outcome, that this is not the intended use of -- 
interactive, but I still wonder if there is any way to achieve an  
interactive session based on a predefined set of commands without  
writing a completely new front-end (overkill, surely?).

Any guidance would be appreciated.

Regards,
Jon

[1] http://finzi.psych.upenn.edu/R/Rhelp02a/archive/117412.html


--
Jonathan D. Clayden, Ph.D.
Research Fellow
Radiology and Physics Unit
UCL Institute of Child Health
30 Guilford Street
LONDON  WC1N 1EH
United Kingdom

t | +44 (0)20 7905 2708
f | +44 (0)20 7905 2358
w | www.homepages.ucl.ac.uk/~sejjjd2/


From noel.mulvihill at btinternet.com  Thu Sep 25 06:06:08 2008
From: noel.mulvihill at btinternet.com (Noel Mulvihill)
Date: Thu, 25 Sep 2008 05:06:08 +0100
Subject: [Rd] C++ & R:  Displaying a lattice graphic using D Com
Message-ID: <000001c91ec4$0b61c570$4e01a8c0@Diana>

Dear list members,

When I modify the MFC sample (using the statconnector graphics device) to
show a lattice graph in the Active X control (actually the wireframe from
http://addictedtor.free.fr/graphiques/graphcode.php?graph=40  ) the program
runs without generating any errors, but the data-driven part of the plot
does not display.  The bounding box is displayed, but not the axes or data
within it.  The same code executes perfectly when typed directly into R, so
this is an issue with my code.

Sometimes the plot 'flickers' into view or partial view very briefly, before
execution has completed.  However, once the code has executed no plot is
visible.

I am using visual C++ - and I have copied out the code at the end of this
note.

I would be grateful for any advice.

Kind regards

Noel

void CMFCClientDlg::OnTest() 
{
  BeginWaitCursor();
  IStatConnector lConnector;
  IDispatch* lCharDev = NULL;
  IDispatch* lGfxDev = NULL;

 
if(FAILED(m_CharDev.GetControlUnknown()->QueryInterface(IID_IDispatch,(LPVOI
D*) &lCharDev))) {
    MessageBox("Error querying Dispatch from Character Device");
    return;
  }
 
if(FAILED(lConnector.CreateDispatch(_T("StatConnectorSrv.StatConnector"))))
{
    MessageBox("Error creating StatConnectorSrv");
    return;
  }
  lConnector.Init(_T("R"));
  lConnector.SetCharacterOutputDevice(lCharDev);
  lConnector.AddGraphicsDevice(_T("Gfx"),m_GraphDev.GetGFX());
  lConnector.EvaluateNoReturn(_T("require(lattice)"));
  lConnector.EvaluateNoReturn(_T("x <- seq(-pi, pi, len = 20)"));
  lConnector.EvaluateNoReturn(_T("y <- seq(-pi, pi, len = 20)"));
  lConnector.EvaluateNoReturn(_T("g <- expand.grid(x = x, y = y)"));
  lConnector.EvaluateNoReturn(_T("g$z <- sin(sqrt(g$x^2 + g$y^2))"));
  lConnector.EvaluateNoReturn(_T("plot(wireframe(z ~ x * y, g, drape = TRUE,
aspect = c(3,1), colorkey = TRUE))"));

  lConnector.Close();

  EndWaitCursor();
}

From hacking at gringer.org  Thu Sep 25 07:00:04 2008
From: hacking at gringer.org (hacking at gringer.org)
Date: Thu, 25 Sep 2008 07:00:04 +0200 (CEST)
Subject: [Rd] Rounding error for high-precision numeric values (PR#13010)
Message-ID: <20080925050004.529E3282EFC2@mail.pubhealth.ku.dk>

Full_Name: David Hall (gringer)
Version: 2.7.2 (2008-08-25)
OS: Debian GNU/Linux (sid/lenny)
Submission from: (NULL) (130.195.86.38)


Following on from a conversation I had with someone on IRC about Java's handling
of difficult floating point numbers and its comparison with R's handling, I
observed a couple of values that appeared to have incorrect rounding
(1.9400994884341946e25, 1.9400994884341945e25). R displays these values to 18
significant figures, but the last digit is incorrect (should be 5, displays 4).
This is probably within the realm of "quirky things that we just have to live
with".

Here's how to reproduce the problem:

$ echo -e "options(digits=22)\n1.9400994884341946e25\n1.9400994884341948e25" | R
\
--vanilla

R version 2.7.2 (2008-08-25)
Copyright (C) 2008 The R Foundation for Statistical Computing
ISBN 3-900051-07-0

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> options(digits=22)
> 1.9400994884341946e25
[1] 1.940099488434194e+25
> 1.9400994884341948e25
[1] 1.940099488434195e+25
>


From henrik.parn at bio.ntnu.no  Thu Sep 25 11:26:12 2008
From: henrik.parn at bio.ntnu.no (Henrik Parn)
Date: Thu, 25 Sep 2008 11:26:12 +0200
Subject: [Rd] help text in read.table
Message-ID: <48DB5934.4020601@bio.ntnu.no>

Dear R-developers,

In read.table() the argument |colClasses = "NULL" can be used to skip 
columns and col.names to name the variables. The first time I tried to 
skip columns, I naively thought that /first/ the "NULL"-columns are 
skipped, /then/ you name only the remaining columns actually specified. 
Therefore, I did not provide names (i.e. "NULL") for the (large) number 
of columns skipped. When I got the warning message, "Error in 
read.table(file = file, header = header, sep = sep, quote = quote,  : 
more columns than column names", I realized that I have to provide 
col.names also for the columns skipped. Now I wonder if it might be an 
idea to add a sentence in the help text for colnames (and maybe for 
colClasses) that you need to provide colnames = "NULL", for variables 
with colClasses = "NULL". Well, just a thought.

I take the opportunity to thank you all for your excellent work with R!


Best regards,

Henrik  

|

-- 
Henrik P?rn
Centre for Conservation Biology
Department of Biology
Norwegian University of Science and Technology
NO-7491 Trondheim
Norway

Office: +47 73596285
Fax: +47 73596100
Mobile: +47 90989255

E-mail: henrik.parn at bio.ntnu.no


From jmc at r-project.org  Thu Sep 25 15:13:59 2008
From: jmc at r-project.org (John Chambers)
Date: Thu, 25 Sep 2008 09:13:59 -0400
Subject: [Rd] R --interactive and readline() creates infinite loop
In-Reply-To: <98A53690-6407-4E86-A094-27707C77C744@ucl.ac.uk>
References: <98A53690-6407-4E86-A094-27707C77C744@ucl.ac.uk>
Message-ID: <48DB8E97.9000609@r-project.org>

For an alternative approach to your original goal, take a look at 
demoSource() in the SoDA package from CRAN.  It's a bit tedious to set 
up (see the Details section of the help file) but uses standard R 
sessions to mix lines from a demo file and interactive input.

John

Jon Clayden wrote:
> Dear all,
>
> I have asked before, in R-help [1], about a way to create an 
> interactive session in which commands are taken from a file or 
> standard input - like R CMD BATCH but additionally allowing user input 
> - but there was no response to that question, and the workarounds that 
> I have found (using "expect", creating a temporary .Rprofile) are ugly 
> and problematic.
>
> With the appearance of the --interactive flag in R 2.7.0 I thought 
> this might become possible, but it not only does not behave as I would 
> expect, it appears to go into an infinite loop, and uses 100% CPU 
> until killed.
>
> $ echo 'print(readline("Input:"))' | R --no-save --quiet
> > print(readline("Input:"))
> Input:[1] ""
> >
> [no interactivity]
>
> $ echo 'print(readline("Input:"))' | R --no-save --quiet --interactive
> [no response at all]
>
> This behaviour remains in the latest alphas of R 2.8.0. My platform is 
> Mac OS X.5.5 on Intel Core 2 Duo.
>
> I assume, given this outcome, that this is not the intended use of 
> --interactive, but I still wonder if there is any way to achieve an 
> interactive session based on a predefined set of commands without 
> writing a completely new front-end (overkill, surely?).
>
> Any guidance would be appreciated.
>
> Regards,
> Jon
>
> [1] http://finzi.psych.upenn.edu/R/Rhelp02a/archive/117412.html
>
>
> -- 
> Jonathan D. Clayden, Ph.D.
> Research Fellow
> Radiology and Physics Unit
> UCL Institute of Child Health
> 30 Guilford Street
> LONDON  WC1N 1EH
> United Kingdom
>
> t | +44 (0)20 7905 2708
> f | +44 (0)20 7905 2358
> w | www.homepages.ucl.ac.uk/~sejjjd2/
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From P.Dalgaard at biostat.ku.dk  Thu Sep 25 15:36:55 2008
From: P.Dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Thu, 25 Sep 2008 15:36:55 +0200
Subject: [Rd] R --interactive and readline() creates infinite loop
In-Reply-To: <48DB8E97.9000609@r-project.org>
References: <98A53690-6407-4E86-A094-27707C77C744@ucl.ac.uk>
	<48DB8E97.9000609@r-project.org>
Message-ID: <48DB93F7.8000509@biostat.ku.dk>

One canonical way of doing it is:

(echo 'print(readline("Input:"))'; cat -) | R --interactive --no-save

(you don't want to leave out --no-save ....)


John Chambers wrote:
> For an alternative approach to your original goal, take a look at
> demoSource() in the SoDA package from CRAN.  It's a bit tedious to set
> up (see the Details section of the help file) but uses standard R
> sessions to mix lines from a demo file and interactive input.
>
> John
>
> Jon Clayden wrote:
>> Dear all,
>>
>> I have asked before, in R-help [1], about a way to create an
>> interactive session in which commands are taken from a file or
>> standard input - like R CMD BATCH but additionally allowing user
>> input - but there was no response to that question, and the
>> workarounds that I have found (using "expect", creating a temporary
>> .Rprofile) are ugly and problematic.
>>
>> With the appearance of the --interactive flag in R 2.7.0 I thought
>> this might become possible, but it not only does not behave as I
>> would expect, it appears to go into an infinite loop, and uses 100%
>> CPU until killed.
>>
>> $ echo 'print(readline("Input:"))' | R --no-save --quiet
>> > print(readline("Input:"))
>> Input:[1] ""
>> >
>> [no interactivity]
>>
>> $ echo 'print(readline("Input:"))' | R --no-save --quiet --interactive
>> [no response at all]
>>
>> This behaviour remains in the latest alphas of R 2.8.0. My platform
>> is Mac OS X.5.5 on Intel Core 2 Duo.
>>
>> I assume, given this outcome, that this is not the intended use of
>> --interactive, but I still wonder if there is any way to achieve an
>> interactive session based on a predefined set of commands without
>> writing a completely new front-end (overkill, surely?).
>>
>> Any guidance would be appreciated.
>>
>> Regards,
>> Jon
>>
>> [1] http://finzi.psych.upenn.edu/R/Rhelp02a/archive/117412.html
>>
>>
>> -- 
>> Jonathan D. Clayden, Ph.D.
>> Research Fellow
>> Radiology and Physics Unit
>> UCL Institute of Child Health
>> 30 Guilford Street
>> LONDON  WC1N 1EH
>> United Kingdom
>>
>> t | +44 (0)20 7905 2708
>> f | +44 (0)20 7905 2358
>> w | www.homepages.ucl.ac.uk/~sejjjd2/
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907


From h.wickham at gmail.com  Thu Sep 25 15:47:07 2008
From: h.wickham at gmail.com (hadley wickham)
Date: Thu, 25 Sep 2008 08:47:07 -0500
Subject: [Rd] R --interactive and readline() creates infinite loop
In-Reply-To: <98A53690-6407-4E86-A094-27707C77C744@ucl.ac.uk>
References: <98A53690-6407-4E86-A094-27707C77C744@ucl.ac.uk>
Message-ID: <f8e6ff050809250647l5dd8c437md272ee0f3761e771@mail.gmail.com>

> I assume, given this outcome, that this is not the intended use of
> --interactive, but I still wonder if there is any way to achieve an
> interactive session based on a predefined set of commands without writing a
> completely new front-end (overkill, surely?).

When you say an interactive session, do you mean that the output
should be identical to what would have happened if you had copied and
pasted the code in to an R session?  I'm working on some code that
allows you to do this, based around parse and eval.

Hadley

-- 
http://had.co.nz/


From P.Dalgaard at biostat.ku.dk  Thu Sep 25 16:07:00 2008
From: P.Dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Thu, 25 Sep 2008 16:07:00 +0200
Subject: [Rd] R --interactive and readline() creates infinite loop
In-Reply-To: <f8e6ff050809250647l5dd8c437md272ee0f3761e771@mail.gmail.com>
References: <98A53690-6407-4E86-A094-27707C77C744@ucl.ac.uk>
	<f8e6ff050809250647l5dd8c437md272ee0f3761e771@mail.gmail.com>
Message-ID: <48DB9B04.8060305@biostat.ku.dk>

hadley wickham wrote:
>> I assume, given this outcome, that this is not the intended use of
>> --interactive, but I still wonder if there is any way to achieve an
>> interactive session based on a predefined set of commands without writing a
>> completely new front-end (overkill, surely?).
>>     
>
> When you say an interactive session, do you mean that the output
> should be identical to what would have happened if you had copied and
> pasted the code in to an R session?  I'm working on some code that
> allows you to do this, based around parse and eval.
>   
I assumed that the point was to allow some code to run, possibly with
user input, and then continue in an interactive session.

It is, BTW, not clear to me whether or not  it could be done using .First().



-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907


From jmc at r-project.org  Thu Sep 25 16:35:20 2008
From: jmc at r-project.org (John Chambers)
Date: Thu, 25 Sep 2008 10:35:20 -0400
Subject: [Rd] R --interactive and readline() creates infinite loop
In-Reply-To: <48DB93F7.8000509@biostat.ku.dk>
References: <98A53690-6407-4E86-A094-27707C77C744@ucl.ac.uk>
	<48DB8E97.9000609@r-project.org> <48DB93F7.8000509@biostat.ku.dk>
Message-ID: <48DBA1A8.2030602@r-project.org>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20080925/0517eb09/attachment.pl>

From jon.clayden at gmail.com  Thu Sep 25 17:37:53 2008
From: jon.clayden at gmail.com (Jon Clayden)
Date: Thu, 25 Sep 2008 16:37:53 +0100
Subject: [Rd] R --interactive and readline() creates infinite loop
In-Reply-To: <48DBA1A8.2030602@r-project.org>
References: <98A53690-6407-4E86-A094-27707C77C744@ucl.ac.uk>
	<48DB8E97.9000609@r-project.org> <48DB93F7.8000509@biostat.ku.dk>
	<48DBA1A8.2030602@r-project.org>
Message-ID: <68e086180809250837h282f9226w4ae0875a7a0d34e4@mail.gmail.com>

Many thanks for the suggestions.

The use case I had in mind is more along the lines of what Peter
Dalgaard mentioned, and his solution looks ideal. I know in advance
exactly what code I want to run, but some of that code may require
user input.

Jon

2008/9/25 John Chambers <jmc at r-project.org>:
> My application, at least, wanted to show (my class) individual commands
> from the file and then optionally insert some typed commands before
> going on to the next part of the source file. As far as I can see, the
> piped shell command approach will have to treat the whole file at one time.
>
> John
>
> Peter Dalgaard wrote:
>> One canonical way of doing it is:
>>
>> (echo 'print(readline("Input:"))'; cat -) | R --interactive --no-save
>>
>> (you don't want to leave out --no-save ....)
>>
>>
>> John Chambers wrote:
>>
>>> For an alternative approach to your original goal, take a look at
>>> demoSource() in the SoDA package from CRAN.  It's a bit tedious to set
>>> up (see the Details section of the help file) but uses standard R
>>> sessions to mix lines from a demo file and interactive input.
>>>
>>> John
>>>
>>> Jon Clayden wrote:
>>>
>>>> Dear all,
>>>>
>>>> I have asked before, in R-help [1], about a way to create an
>>>> interactive session in which commands are taken from a file or
>>>> standard input - like R CMD BATCH but additionally allowing user
>>>> input - but there was no response to that question, and the
>>>> workarounds that I have found (using "expect", creating a temporary
>>>> .Rprofile) are ugly and problematic.
>>>>
>>>> With the appearance of the --interactive flag in R 2.7.0 I thought
>>>> this might become possible, but it not only does not behave as I
>>>> would expect, it appears to go into an infinite loop, and uses 100%
>>>> CPU until killed.
>>>>
>>>> $ echo 'print(readline("Input:"))' | R --no-save --quiet
>>>>
>>>>> print(readline("Input:"))
>>>>>
>>>> Input:[1] ""
>>>>
>>>> [no interactivity]
>>>>
>>>> $ echo 'print(readline("Input:"))' | R --no-save --quiet --interactive
>>>> [no response at all]
>>>>
>>>> This behaviour remains in the latest alphas of R 2.8.0. My platform
>>>> is Mac OS X.5.5 on Intel Core 2 Duo.
>>>>
>>>> I assume, given this outcome, that this is not the intended use of
>>>> --interactive, but I still wonder if there is any way to achieve an
>>>> interactive session based on a predefined set of commands without
>>>> writing a completely new front-end (overkill, surely?).
>>>>
>>>> Any guidance would be appreciated.
>>>>
>>>> Regards,
>>>> Jon
>>>>
>>>> [1] http://finzi.psych.upenn.edu/R/Rhelp02a/archive/117412.html
>>>>
>>>>
>>>> --
>>>> Jonathan D. Clayden, Ph.D.
>>>> Research Fellow
>>>> Radiology and Physics Unit
>>>> UCL Institute of Child Health
>>>> 30 Guilford Street
>>>> LONDON  WC1N 1EH
>>>> United Kingdom
>>>>
>>>> t | +44 (0)20 7905 2708
>>>> f | +44 (0)20 7905 2358
>>>> w | www.homepages.ucl.ac.uk/~sejjjd2/
>>>>
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>
>>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>
>>
>>
>
>        [[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From p.dalgaard at biostat.ku.dk  Thu Sep 25 17:38:37 2008
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Thu, 25 Sep 2008 17:38:37 +0200
Subject: [Rd] R --interactive and readline() creates infinite loop
In-Reply-To: <48DBA1A8.2030602@r-project.org>
References: <98A53690-6407-4E86-A094-27707C77C744@ucl.ac.uk>
	<48DB8E97.9000609@r-project.org> <48DB93F7.8000509@biostat.ku.dk>
	<48DBA1A8.2030602@r-project.org>
Message-ID: <48DBB07D.5070302@biostat.ku.dk>

John Chambers wrote:
> My application, at least, wanted to show (my class) individual 
> commands from the file and then optionally insert some typed commands 
> before going on to the next part of the source file. As far as I can 
> see, the piped shell command approach will have to treat the whole 
> file at one time.
Hmmno... You can "cat -" multiple times if you want, terminating each 
with ctrl-D. That's not to say that it is the optimal solution though. 
Echoing the non-keyboard input seems a bit tricky, for instance.

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907


From cyril.alegret at st.com  Thu Sep 25 13:30:03 2008
From: cyril.alegret at st.com (cyril.alegret at st.com)
Date: Thu, 25 Sep 2008 13:30:03 +0200 (CEST)
Subject: [Rd] Bug while loading Package "tcltk" with R-2.7.2 (PR#13016)
Message-ID: <20080925113003.F1DC3282EFC2@mail.pubhealth.ku.dk>

Full_Name: Cyril Alegret
Version: 2.7.2
OS: Windows
Submission from: (NULL) (90.80.39.42)


An error occurs when I try to load the package "tcltk2_1.0-7" with R-2.7.2
(whereas it works with version 2.6.2).

Please find below the error message :
"> source("C:\\Data\\Travail\\Software&Method\\R\\Procs\\Chargement des
librairies.R")
Le chargement a n?cessit? le package : tcltk
Chargement de Tcl/Tk... termin?
Error in names(res) <- c("default", "menu", "caption", "smallcaption",  : 
  objet "res" non trouv?
Error : .onLoad a ?chou? dans 'loadNamespace' pour 'tcltk2'
Erreur : le chargement du package / espace de noms a ?chou? pour 'tcltk2'"

Thank you for your help


From murdoch at stats.uwo.ca  Thu Sep 25 23:32:01 2008
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Thu, 25 Sep 2008 17:32:01 -0400
Subject: [Rd] Bug while loading Package "tcltk" with R-2.7.2 (PR#13016)
In-Reply-To: <20080925113003.F1DC3282EFC2@mail.pubhealth.ku.dk>
References: <20080925113003.F1DC3282EFC2@mail.pubhealth.ku.dk>
Message-ID: <48DC0351.1030508@stats.uwo.ca>

On 25/09/2008 7:30 AM, cyril.alegret at st.com wrote:
> Full_Name: Cyril Alegret
> Version: 2.7.2
> OS: Windows
> Submission from: (NULL) (90.80.39.42)
> 
> 
> An error occurs when I try to load the package "tcltk2_1.0-7" with R-2.7.2
> (whereas it works with version 2.6.2).
> 
> Please find below the error message :
> "> source("C:\\Data\\Travail\\Software&Method\\R\\Procs\\Chargement des
> librairies.R")
> Le chargement a n?cessit? le package : tcltk
> Chargement de Tcl/Tk... termin?
> Error in names(res) <- c("default", "menu", "caption", "smallcaption",  : 
>   objet "res" non trouv?
> Error : .onLoad a ?chou? dans 'loadNamespace' pour 'tcltk2'
> Erreur : le chargement du package / espace de noms a ?chou? pour 'tcltk2'"
> 
> Thank you for your help

Why do you think this has something to do with tcltk?  It's pretty 
clearly a problem in your script, or in the tcltk2 (not tcltk!) package. 
  But since you didn't track it down within your script, we can't help you.

Duncan Murdoch


From meermeyer at statistik.uni-wuppertal.de  Fri Sep 26 12:15:03 2008
From: meermeyer at statistik.uni-wuppertal.de (meermeyer at statistik.uni-wuppertal.de)
Date: Fri, 26 Sep 2008 12:15:03 +0200 (CEST)
Subject: [Rd] bug in plot.acf, ci.type= "ma" (PR#13071)
Message-ID: <20080926101503.E84362834155@mail.pubhealth.ku.dk>

Full_Name: Martin Meermeyer
Version: 2.51
OS: Win XP SP3
Submission from: (NULL) (132.195.128.210)


I think the confidence-bands in the plot.acf(..., ci.type="ma") must start at
lag 1 due to the Bartlett-approximation. I think so since I?ve calculated these
manually, see the following example:
 
reihe     <- arima.sim(n = 100, list(ma = c(0.5, 0.4)))
reihe.acf <- acf(reihe, ci.type = c("ma"))
reihe.acf <- as.vector(reihe.acf$acf)

# Estimated variances of hat(rho)(2:h) using the Bartlett-approximation
var.acf <- (1 + 2*cumsum(reihe.acf[-1]^2))/100

# Assuming white noise for hat(rho)(1), therefore estimated variance is 1/100 
var.acf <- c(1/100, var.acf)

# Calculate ci-bounds  
ki.acf  <- 1.96*sqrt(var.acf)

# Skip the last one 
ki.acf  <- head(ki.acf, -1)

# Add to the acf, first entry belongs to lag 1.
lines(c(1:20),ki.acf,col=2,lty=2)

#  Numbers identical to actual function 
lines(c(0:19),-ki.acf,col=2,lty=2)


From luke at stat.uiowa.edu  Fri Sep 26 19:02:13 2008
From: luke at stat.uiowa.edu (Luke Tierney)
Date: Fri, 26 Sep 2008 12:02:13 -0500 (CDT)
Subject: [Rd] function can permanently modify calling function	via
 substitute?
In-Reply-To: <alpine.LFD.1.10.0809241153441.25405@nokomis.stat.uiowa.edu>
References: <34988bf10809232150g65e3aba3l9ddffae0d6b2c70b@mail.gmail.com>
	<48D9D603.4080101@biostat.ku.dk>
	<alpine.LFD.1.10.0809241153441.25405@nokomis.stat.uiowa.edu>
Message-ID: <alpine.LFD.1.10.0809261200570.29662@nokomis.stat.uiowa.edu>

On Wed, 24 Sep 2008, Luke Tierney wrote:

> On Wed, 24 Sep 2008, Peter Dalgaard wrote:
>
>> Perry de Valpine wrote:
>>> Dear R-devel:
>>> 
>>> The following code seems to allow one function to permanently modify a
>>> calling function.  I did not expect this would be allowed (short of
>>> more creative gymnastics) and wonder if it is really intended.  (I can
>>> see other ways to accomplish the intended task of this code [e.g. via
>>> match.call instead of substitute below] that do not trigger the
>>> problem, but I don't think that is the point.)
>>> 
>>> do.nothing <- function(blah) {force(blah)}
>>> 
>>> do.stuff.with.call <- function(mycall) {
>>>   raw.mycall <- substitute(mycall);   # expected raw.mycall would be local
>>>   print( sys.call() )
>>>
>>>   # do.nothing( raw.mycall );  # See below re: commented lines.
>>>   # .Call( "showNAMED", raw.mycall[[2]] )
>>>
>>>   force( mycall );  # not relevant where (or whether) this is done
>>>   raw.mycall[[2]] <- runif(1); # permanently modifies try.me on the
>>> first time only
>>>
>>>   # .Call( "showNAMED", raw.mycall[[2]] )
>>>
>>>   raw.mycall
>>> }
>>> 
>>> gumbo <- function(x) {
>>>   writeLines( paste( "gumbo : x =" ,  x ) )
>>>   return(x);
>>> }
>>> 
>>> try.me <- function() {
>>>   one.val <- 111;
>>>   one.ans <- do.stuff.with.call( mycall = gumbo( x = one.val ) );
>>>   one.ans
>>> }
>>> 
>>> # after source()ing the above:
>>> 
>>>> deparse(try.me)
>>>> 
>>> [1] "function () "
>>> [2] "{"
>>> [3] "    one.val <- 111"
>>> [4] "    one.ans <- do.stuff.with.call(mycall = gumbo(x = one.val))"
>>> [5] "    one.ans"
>>> [6] "}"
>>> 
>>>> try.me()
>>>> 
>>> do.stuff.with.call(mycall = gumbo(x = one.val))
>>> gumbo : x = 0.396524668671191
>>> gumbo(x = 0.396524668671191)
>>> 
>>>> deparse(try.me)
>>>> 
>>> [1] "function () "
>>> [2] "{"
>>> [3] "    one.val <- 111"
>>> [4] "    one.ans <- do.stuff.with.call(mycall = gumbo(x = 
>>> 0.396524668671191))"
>>> [5] "    one.ans"
>>> [6] "}"
>>> 
>>>> try.me()
>>>> 
>>> do.stuff.with.call(mycall = gumbo(x = 0.396524668671191))
>>> gumbo : x = 0.396524668671191
>>> gumbo(x = 0.0078618151601404)
>>> 
>>>> deparse(try.me)
>>>> 
>>> [1] "function () "
>>> [2] "{"
>>> [3] "    one.val <- 111"
>>> [4] "    one.ans <- do.stuff.with.call(mycall = gumbo(x = 
>>> 0.396524668671191))"
>>> [5] "    one.ans"
>>> [6] "}"
>>> 
>>> So, after the first call of try.me(), do.stuff.with.call has
>>> permanently replaced the name one.val in line 2 of try.me with a
>>> numeric (0.396...).  Subsequent calls from try.me to
>>> do.stuff.with.call now reflect that change, but do.stuff.with.call
>>> does not modify the try.me object again. (Note this means one needs to
>>> keep reloading try.me to investigate).
>>> 
>>> If this is a problem worth investigating, here are a couple of other
>>> observations that may be relevant but are obviously speculative.
>>> 
>>> 1. If the third line of do.stuff.with.call is uncommented (and try.me
>>> also reloaded), the unexpected behavior does not occur.  Since
>>> do.nothing is eponymous, I was surprised because I believed it should
>>> not impact any other behavior.  Speculating with limited knowledge, I
>>> thought this might implicate something that is supposed to stay
>>> under-the-hood, such as the "`call by value' illusion" described in
>>> the "R internals" documentation.
>>> 
>>> 2. Poking slightly further, I looked at the NAMED values using this C
>>> code via R CMD SHLIB and dyn.load:
>>> #include "R.h"
>>> #include "Rdefines.h"
>>> SEXP showNAMED(SEXP obj) {
>>>   Rprintf("%i\n", NAMED(obj));
>>>   return(R_NilValue);
>>> }
>>> Uncommenting the .Call lines in do.stuff.with.call (with the
>>> do.nothing line re-commented) reveals that on the first time
>>> do.stuff.with.call is called from try.me, raw.mycall[[2]] has NAMED ==
>>> 1 both before and after the `[[<-` line.  On subsequent calls it has
>>> NAMED == 2 before and NAMED == 1 after.  If I follow how NAMED is
>>> used, this seems relevant.
>>> 
>>> 
>> Yes and no. This does sound like a bug and NAMED is likely involved, but I 
>> don't think raw.mycall[[2]] is the thing to look at. More likely, the issue 
>> is that raw.mycall[ itself has NAMED == 1 because otherwise [[<- assignment 
>> would duplicate it first. This suggests that substitute has the bug.
>
> Our extraction functions, like [[, bump up the NAMED value for
> components to the value for the container (or to 2 -- doesn't look
> like we are consistent here).  substitute() doesn't do that, and
> perhaps could.  But arguably it is the point where the promise (from
> which substitute gets the expression) is created that is the
> extraction point. We could have mkPromise test for NAMED == 2 and bump
> up if it isn't.  We could also have parse create all LANGSXPs with
> NAMED == 2 but that leaves out programmatically created functions.
> Either change fixes this bug; not sure which is the best one (or
> whether we should do both).  Changing mkPromise is more conservative
> and potentially a little more costly but probably not enough to
> notice.
>
> luke

I decided it is safest to make the change in mkPromise but that we
might as well also make the change in substitute, so both are in as of
rev 46573.

luke

-- 
Luke Tierney
Chair, Statistics and Actuarial Science
Ralph E. Wareham Professor of Mathematical Sciences
University of Iowa                  Phone:             319-335-3386
Department of Statistics and        Fax:               319-335-3017
    Actuarial Science
241 Schaeffer Hall                  email:      luke at stat.uiowa.edu
Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu


From supersubu123 at gmail.com  Fri Sep 26 19:47:03 2008
From: supersubu123 at gmail.com (subramanian R)
Date: Fri, 26 Sep 2008 23:17:03 +0530
Subject: [Rd] Bug? in some package installations when a Print is added in
	memory.c
Message-ID: <b2d9df730809261047j6461ef57s54e43ab9500eb56a@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20080926/9e4e6d60/attachment.pl>

From j.clayden at ucl.ac.uk  Fri Sep 26 22:35:52 2008
From: j.clayden at ucl.ac.uk (Jon Clayden)
Date: Fri, 26 Sep 2008 21:35:52 +0100
Subject: [Rd] R --interactive and readline() creates infinite loop
In-Reply-To: <48DBB07D.5070302@biostat.ku.dk>
References: <98A53690-6407-4E86-A094-27707C77C744@ucl.ac.uk>
	<48DB8E97.9000609@r-project.org> <48DB93F7.8000509@biostat.ku.dk>
	<48DBA1A8.2030602@r-project.org> <48DBB07D.5070302@biostat.ku.dk>
Message-ID: <68e086180809261335p735959eckc1c7dbf8e67460e@mail.gmail.com>

2008/9/25 Peter Dalgaard <p.dalgaard at biostat.ku.dk>:
> John Chambers wrote:
>>
>> My application, at least, wanted to show (my class) individual commands
>> from the file and then optionally insert some typed commands before going on
>> to the next part of the source file. As far as I can see, the piped shell
>> command approach will have to treat the whole file at one time.
>
> Hmmno... You can "cat -" multiple times if you want, terminating each with
> ctrl-D. That's not to say that it is the optimal solution though. Echoing
> the non-keyboard input seems a bit tricky, for instance.

Yes, looking more into it, the fact that everything gets echoed this
way is less than ideal. And for some reason, presumably to do with the
details of the behaviour of "cat", if I do

(echo 'print(readline("Input:"));q()'; cat -) | R --interactive --no-save

I need an extra newline after giving the input before I get returned
to the shell, even though R seems to have quit already. So I don't
think this is the answer. The "demoSource" approach is interesting,
but I think running two R sessions is also going to be problematic for
my application.

It really would be nice if R could do this kind of thing itself. I
would have thought it would make creating some simple "pass-through"
front-ends (like mine ;) ) very easy. I have very little knowledge of
the R source though, so I acknowledge that it may not be an easy task.

Jon


From supersubu123 at gmail.com  Sat Sep 27 09:15:09 2008
From: supersubu123 at gmail.com (subramanian R)
Date: Sat, 27 Sep 2008 12:45:09 +0530
Subject: [Rd] Bug? in some package installations when a Print is added in
	memory.c
Message-ID: <b2d9df730809270015p489d14a7jc3576fa027809120@mail.gmail.com>

Dear r-devel,
    The first time i noticed this problem is when i enabled some debug
prints in memory.c
DEBUG_GC
DEBUG_ADJUST_HEAP
DEBUG_RELEASE_MEM etc.. These have some prints for debugging .Base R package
installation completes well and good.
The problem comes when some of the Recommended package installation happens.
The following Packages fail "KernSmooth,lattice,rpart,cluster,survival
etc..."
To know the problem i removed the redirection of error to null in
R-2.7.0/src/library/Recommended/Makefile (remove 2>/dev/null around line
number 80 )
and i came to know that it tries to compile packages based on output of some
R session which i think is not proper..

Easier Way to reproduce this
======================
in InitMemory routine in memory.c add this piece of code in the starting

        Rprintf("test print\n");//so that it is printed only once
//the same problem comes with printf but not fprintf(stderr ...) That means
only STDOUT matters for this Bug


and while the package installation starts you can see some thing like after
avoiding redirection of stderr (see above)
>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
* Installing *source* package 'lattice' ...
** libs
make[3]: Entering directory `/tmp/R.INSTALL.NjKF3D/lattice/src'
gcc -std=gnu99 -I/home/subramra/performance-tests/R-2.7.0/include
-I/usr/local/include test print   -fPIC  -g -O2 -c init.c -o init.o
gcc -std=gnu99 -I/home/subramra/performance-tests/R-2.7.0/include
-I/usr/local/include test print   -fPIC  -g -O2 -c threeDplot.c -o
threeDplot.o
gcc: test: No such file or directory
gcc: print: No such file or directory
gcc: test: No such file or directory
gcc: print: No such file or directory
make[3]: *** [init.o] Error 1
make[3]: *** Waiting for unfinished jobs....
make[3]: *** [threeDplot.o] Error 1
make[3]: Leaving directory `/tmp/R.INSTALL.NjKF3D/lattice/src'
ERROR: compilation failed for package 'lattice'
** Removing '/home/subramra/performance-tests/R-2.7.0/library/lattice'
make[2]: *** [lattice.ts] Error 1
>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>


So essentially the problem is these packages try to compile files which are
printed out!!!!!!!!!!!And if there are prints in memory.c they FAIL.

Is this a BUG?

Thanks and Regards,
Subramanian R.


From dannychia at berkeley.edu  Sat Sep 27 03:40:08 2008
From: dannychia at berkeley.edu (dannychia at berkeley.edu)
Date: Sat, 27 Sep 2008 03:40:08 +0200 (CEST)
Subject: [Rd] confusing documentation (PR#13077)
Message-ID: <20080927014008.CB7CC282EFC2@mail.pubhealth.ku.dk>

Full_Name: Danny
Version: 2.7.2
OS: Windows XP SP3
Submission from: (NULL) (71.139.13.68)


Some parts of the R documentation seem pretty confusing. When R is launched, the
text "Natural language support but running in an English locale" appears. What
is this supposed to mean? It should probably be reworded or removed.

The text "[Package stats version 2.7.2 Index]" appears at the bottom of each
page. The "Index]" takes the user to the index. I believe that the developers
meant to just link "Index" (without the closing brackets). However, to make it
less confusing, it should look something like "[Package stats version 2.7.2]
[Index]" with two separate sets of brackets.


From binye at med.wayne.edu  Fri Sep 26 21:10:13 2008
From: binye at med.wayne.edu (binye at med.wayne.edu)
Date: Fri, 26 Sep 2008 21:10:13 +0200 (CEST)
Subject: [Rd] RWeka can't evaluate classifier on new data (PR#13076)
Message-ID: <20080926191014.013DB282EFC2@mail.pubhealth.ku.dk>

Full_Name: Bin Ye
Version: 2.7.2
OS: Window XP
Submission from: (NULL) (146.9.105.101)


command "evaluate_Weka_Classifier", option "newdata=" doesn't working. No matter
you provide new data or not, it always gives you the confusion matrix evaluating
with the training data.


From davidhedin at mac.com  Sat Sep 27 07:10:06 2008
From: davidhedin at mac.com (davidhedin at mac.com)
Date: Sat, 27 Sep 2008 07:10:06 +0200 (CEST)
Subject: [Rd] Error in R-Intro document (PR#13079)
Message-ID: <20080927051006.1D90F2834158@mail.pubhealth.ku.dk>

Full_Name: David Hedin
Version: R 2.6.0 GUI 1.21
OS: Mac 10.4.11
Submission from: (NULL) (24.205.60.123)


page 64 of the R introduction document makes the claim

"If the probability=TRUE argument is given, the bars represent relative
frequencies instead of counts"

This is wrong, the densities (relative frequency/class width) are given, not the
relative frequency. It's only true when the class width is 1. 

What IS the code which will produce a relative frequency histogram?


From p.dalgaard at biostat.ku.dk  Sat Sep 27 11:15:21 2008
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Sat, 27 Sep 2008 11:15:21 +0200
Subject: [Rd] Bug? in some package installations when a Print is added
 in	memory.c
In-Reply-To: <b2d9df730809270015p489d14a7jc3576fa027809120@mail.gmail.com>
References: <b2d9df730809270015p489d14a7jc3576fa027809120@mail.gmail.com>
Message-ID: <48DDF9A9.7010502@biostat.ku.dk>

subramanian R wrote:
>
> So essentially the problem is these packages try to compile files which are
> printed out!!!!!!!!!!!And if there are prints in memory.c they FAIL.
>
> Is this a BUG?
>   

Only in your code. There are things in the INSTALL script that rely on 
calling R and looking at its output, e.g.

  lib=`echo "cat('\n~~~', .libPaths()[1], '\n', sep = '')" | \
    R_DEFAULT_PACKAGES=NULL "${R_EXE}" --no-restore --slave | \
    grep '^~~~' | ${SED} 's/.*~~~//'`

This implies that if you modify R's output, you may break things. It is 
not a bug that R's developers assume that they know what the output of R 
will be. It would be if the assumptions were wrong, but this does not 
include the case where someone makes deliberate changes to the code.

(The section above may or may not be the one that is giving you problem. 
It's just to make the point.)

The fix could be to conditionalize your test prints on something (an 
environment variable, or if you can access flags set by --slave) or just 
not use the hacked version for package installation.

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907


From maechler at stat.math.ethz.ch  Sat Sep 27 11:20:20 2008
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Sat, 27 Sep 2008 11:20:20 +0200
Subject: [Rd] seg.fault from nlme::gnls() {was "[R-sig-ME] GNLS Crash"}
In-Reply-To: <329A68716B57D54E8D39FD3F8A4A84DF0EB93F8E@um-mail0136.unimaas.nl>
References: <329A68716B57D54E8D39FD3F8A4A84DF0EB93F8E@um-mail0136.unimaas.nl>
Message-ID: <18653.64212.996077.405539@cmath-5.math.ethz.ch>

>>>>> "VW" == Viechtbauer Wolfgang (STAT) <Wolfgang.Viechtbauer at STAT.unimaas.nl>
>>>>>     on Fri, 26 Sep 2008 18:00:19 +0200 writes:

    VW> Hi all, I'm trying to fit a marginal (longitudinal)
    VW> model with an exponential serial correlation function to
    VW> the Orange tree data set. However, R crashes frequently
    VW> when using the gnls() function. With the following
    VW> simple example, I was able to reproduce the problem.


    VW> gnls.exp <- gnls(circumference ~ Asym/(1 + exp(-(age-xmid)/scal)) ,
    VW> data = Orange, correlation = corExp(form = ~1 | Tree),
    VW> start = c(Asym=150, xmid=750, scal=300))

Yes, I can reproduce it (on a Linux (RHEL 5) 64bit server), using
R 2.8.0 alpha : Use this

for(i in 1:20)# for MM: ca. 8 to 10 times --> seg.fault
try(
gnls.exp <- gnls(circumference ~ Asym/(1 + exp(-(age-xmid)/scal)) ,
              data = Orange, correlation = corExp(form = ~1 | Tree),
              start = c(Asym=150, xmid=750, scal=300))
)

If I run it in the debugger and then do a backtrace
I see

Error in gnls(circumference ~ Asym/(1 + exp(-(age - xmid)/scal)), data = Orange,  : 
  Step halving factor reduced below minimum in NLS step

[............................................................]
[...................the same about 6 times...................]
[............................................................]

Error in gnls(circumference ~ Asym/(1 + exp(-(age - xmid)/scal)), data = Orange,  : 
  Step halving factor reduced below minimum in NLS step
Error in .makeMessage(..., domain = domain) : 
  incorrect number of arguments to "<-"
Error in .makeMessage(..., domain = domain) : 
  incorrect number of arguments to "<-"

Program received signal SIGABRT, Aborted.
0x0000003294e30155 in raise () from /lib64/libc.so.6
(gdb) bt
#0  0x0000003294e30155 in raise () from /lib64/libc.so.6
#1  0x0000003294e31bf0 in abort () from /lib64/libc.so.6
#2  0x00000000004184f5 in R_gc_internal (size_needed=0)
    at ../../../R/src/main/memory.c:761
#3  0x000000000041b121 in Rf_cons (car=0x1b2ec088, cdr=0x1a3436d8)
    at ../../../R/src/main/memory.c:1755
#4  0x0000000000578472 in applydefine (call=<value optimized out>, 
    op=0x1a3617a8, args=0x1ad47590, rho=0x1b2ea428)
    at ../../../R/src/include/Rinlinedfuns.h:153
#5  0x0000000000575a42 in Rf_eval (e=0x1ad47558, rho=0x1b2ea428)
    at ../../../R/src/main/eval.c:461
#6  0x0000000000576d50 in do_begin (call=0x1ad48450, op=0x1a362518, 
    args=0x1ad47520, rho=0x1b2ea428) at ../../../R/src/main/eval.c:1174
#7  0x0000000000575a42 in Rf_eval (e=0x1ad48450, rho=0x1b2ea428)
    at ../../../R/src/main/eval.c:461
#8  0x0000000000578f9c in Rf_applyClosure (call=0x1b2e9958, op=0x1ad48370, 
    arglist=0x1b2e9a70, rho=0x1b690298, suppliedenv=0x1b2e99c8)
    at ../../../R/src/main/eval.c:667
#9  0x00000000004285b9 in Rf_usemethod (generic=0x67e8d7 "[", 
    obj=<value optimized out>, call=<value optimized out>, 
    args=<value optimized out>, rho=0xffffffffffffffff, callrho=0x1b690298, 
    defrho=0x1a384f28, ans=0x7fffcaa8d5a8) at ../../../R/src/main/objects.c:311
#10 0x0000000000576a25 in Rf_DispatchOrEval (call=0x1a81d8d0, op=0x1a3622e8, 
    generic=0x67e8d7 "[", args=0x1a81d908, rho=0x1b690298, ans=0x7fffcaa8d5a8, 
    dropmissing=0, argsevald=0) at ../../../R/src/main/eval.c:1930
#11 0x00000000004afc40 in do_subset (call=0x7716, op=0x7716, 
    args=0xffffffffffffffff, rho=0x1b690298)
    at ../../../R/src/main/subset.c:577
#12 0x0000000000575a42 in Rf_eval (e=0x1a81d8d0, rho=0x1b690298)
    at ../../../R/src/main/eval.c:461
#13 0x00000000005780c7 in applydefine (call=0x1a81d748, op=0x1a3617a8, 
    args=0x6, rho=0xffffffffffffffff) at ../../../R/src/main/eval.c:1318
#14 0x0000000000575a42 in Rf_eval (e=0x1a81d748, rho=0x1b690298)
    at ../../../R/src/main/eval.c:461
#15 0x00000000005775de in do_for (call=0x1a81d668, op=0x1a360180, 
    args=0x1a81d6a0, rho=0x1b690298) at ../../../R/src/main/eval.c:1073

..... and more (downto #155 for R's main(...)

This is a bug,  probably in the C code of package nlme
which I guess corrupts memory somehere earlier, and we are
seeing the effect only later.
I'll leave this to the (memory-)debugging experts...

Martin

    VW> On my and one other computer, R usually crashes when calling the gnls() function with this code three times in a row. I stumbled across this when trying to fit this model with different starting values.

    VW> Version information:

    VW> platform       i386-pc-mingw32             
    ......
    VW> version.string R version 2.7.2 (2008-08-25)

    VW> Can anybody help figure out what causes this problem?

    VW> Best,

    VW> -- 
    VW> Wolfgang Viechtbauer 
    VW> ?Department of Methodology and Statistics 
    VW> ?University of Maastricht, The Netherlands 
    VW> ?http://www.wvbauer.com/ 

    VW> _______________________________________________
    VW> R-sig-mixed-models at r-project.org mailing list
    VW> https://stat.ethz.ch/mailman/listinfo/r-sig-mixed-models


From maechler at stat.math.ethz.ch  Sat Sep 27 18:25:26 2008
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Sat, 27 Sep 2008 18:25:26 +0200
Subject: [Rd] Error in R-Intro document (PR#13079)
In-Reply-To: <20080927051006.1D90F2834158@mail.pubhealth.ku.dk>
References: <20080927051006.1D90F2834158@mail.pubhealth.ku.dk>
Message-ID: <18654.24182.390073.274042@cmath-5.math.ethz.ch>

>>>>> "d" == davidhedin  <davidhedin at mac.com>
>>>>>     on Sat, 27 Sep 2008 07:10:06 +0200 (CEST) writes:

    d> Full_Name: David Hedin Version: R 2.6.0 GUI 1.21 OS: Mac
    d> 10.4.11 Submission from: (NULL) (24.205.60.123)


    d> page 64 of the R introduction document makes the claim

    d> "If the probability=TRUE argument is given, the bars
    d> represent relative frequencies instead of counts"

    d> This is wrong, the densities (relative frequency/class
    d> width) are given, not the relative frequency. It's only
    d> true when the class width is 1.

Thank you; I have added "divided by the bin width".
Note that one could argue that it really depends on the
definition of "relative" if paragraph you cite is really wrong.
I could define "relative" to mean
"relative WRT to the total and the bin width"  :-)


    D> What IS the code which will produce a relative frequency
    d> histogram?

Well, do you really want a y-axis scale which is neither
counts nor has the usual density scale?
I'd recommend against that.

Here's an example derived from  help(plot.histogram) :

 wwt <- hist(women$weight, nclass = 7, plot = FALSE)

 ## modify the result to show "relative frequencies"
 wt. <- wwt; wt.$density <- wwt$density * diff(wwt$breaks)[1]
 plot(wt., freq=FALSE, ylab="Relative Frequency")

 ## or probably rather 
 wtP <- wwt; wtP$density <- wwt$density * 100 * diff(wwt$breaks)[1]
 plot(wtP, freq=FALSE, ylab="Relative Frequency [ % ]")

But note that I would strongly advocate to use the default of
counts instead of the above, since from counts, one intuitively
gets a notion of *precision* (most people have a crude
approximation of the Poisson built in their brains :-)
which is completely lost when switching to percents.

Martin Maechler, ETH Zurich


From maechler at stat.math.ethz.ch  Sat Sep 27 20:23:37 2008
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Sat, 27 Sep 2008 20:23:37 +0200
Subject: [Rd] On modes, types and R documentation
In-Reply-To: <d8ad40b50809252350v193f366foe4892ab455977b4b@mail.gmail.com>
Message-ID: <18654.31273.439393.362562@cmath-5.math.ethz.ch>

>>>>> "BaRow" == Barry Rowlingson <b.rowlingson at lancaster.ac.uk>
>>>>>     on Fri, 26 Sep 2008 07:50:33 +0100 writes:

    BaRow> 2008/9/25 Kingsford Jones <kingsfordjones at gmail.com>:
    >> 
    >> Try
    >> 
    >> ?type
    >> 
    >> which correctly guesses the user is looking for the
    >> 'typeof' page.
    >> 
    >> Or even
    >> 
    >> example(type)
    >> 
    >> Also, after a brief introduction, the R Language
    >> Definition document begins with a discussion of types.
    >> 
    >> Kingsford Jones


    BaRow>  But if, oh if, we could start R from scratch, would the documentation
    BaRow> contain such gems as:


    BaRow>  "value: a character string giving the desired mode
    BaRow> or 'storage mode' (type) of the object."

Barry, thank you, and we're very often very thankful for patches
to the docs...  I see you found this on help(mode) and there, it
is documenting "value" for

		mode(x) <- value
and	storage.mode(x) <- value

and for that reason got to the above gem.

You probably know that 'type' / 'typeof' is an R-specific
(non-S) concept which has been part of R even before it's
pre-alpha version got a version number.  It returns the basic
R-internal "SEXP" type. 
storage.mode is similar (an old S concept), but slightly
different:

  > storage.mode
  function (x) 
  switch(tx <- typeof(x), 
	 closure = , builtin = , special = "function", 
	 tx)

but I agree equivalent for almost all purposes.
So maybe one should drop the  '(type)'  part in the above gem.

-----

    BaRow> """ 
    BaRow> As storage mode "single" is only a pseudo-mode in
    BaRow> R, it will not be reported by mode or storage.mode:
    BaRow> use attr(object, "Csingle") to examine this. However,
    BaRow> mode<- can be used to set the mode to "single", which
    BaRow> sets the real mode to "double" and the "Csingle"
    BaRow> attribute to TRUE. Setting any other mode will remove
    BaRow> this attribute.

Ah. I found this is cited from the 'Details' section of
help(mode).  Well, I could argue that this paragraph and almost
all mentioning of "single" on that help page should be dropped,
and only one link to  help(single) should remain.

One reason it's there, may be because this part is different
from S/S-plus.  I don't see why an average user should see any
mention of "single" at all.


    BaRow> Looking at the R docs for typeof and mode it seems to
    BaRow> refer to modes, types, storage modes, (storage)
    BaRow> modes, 'storage mode' (type)s, real modes,
    BaRow> pseudo-modes and internal types. Confused? Clearly
    BaRow> people are!

:-) nice list ! 

If we eliminated the above "single" paragraph, we'd eliminate
"pseudo-mode" and "real mode"...

Otherwise, I'm sure you know that

 type         = internal type
 storage.mode = an almost equivalent union (of 'type')
 mode         = an S/S-plus compatible version of storage.mode

but for many years, we've now had class() which for the average
user should be sufficient in 98% of the cases, and in the other 
2% , typeof() would provide the extra info.

Martin


From maechler at stat.math.ethz.ch  Sun Sep 28 00:19:34 2008
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Sun, 28 Sep 2008 00:19:34 +0200
Subject: [Rd] Outdated dependencies and install.packages()
In-Reply-To: <48AD2D26.7040306@biostat.ku.dk>
References: <48ABF23B.70707@biostat.ku.dk>
	<alpine.LFD.1.10.0808201232150.5896@gannet.stats.ox.ac.uk>
	<48AC32FC.8040606@biostat.ku.dk>
	<18605.7073.337671.44537@stat.math.ethz.ch>
	<48AD2D26.7040306@biostat.ku.dk>
Message-ID: <18654.45430.632840.424450@cmath-5.math.ethz.ch>

>>>>> "PD" == Peter Dalgaard <P.Dalgaard at biostat.ku.dk>
>>>>>     on Thu, 21 Aug 2008 10:53:58 +0200 writes:

    PD> Martin Maechler wrote:
    >>>>>>> "PD" == Peter Dalgaard <P.Dalgaard at biostat.ku.dk>
    >>>>>>> on Wed, 20 Aug 2008 17:06:36 +0200 writes:
    >>>>>>> 
    >> 
    PD> Prof Brian Ripley wrote:
    >> >> On Wed, 20 Aug 2008, Peter Dalgaard wrote:
    >> >> 
    >> >>> This looks like a buglet:
    >> >>> 
    >> >>>> install.packages("lme4", depend=TRUE, lib="~/Rlibrary/")
    >> >>> --- Please select a CRAN mirror for use in this session ---
    >> >>> [...snip...]
    >> >>> ** preparing package for lazy loading
    >> >>> Error: package 'Matrix' 0.999375-4 was found, but >= 0.999375.11 is
    >> >>> required by 'lme4'
    >> >>> Execution halted
    >> >>> ERROR: lazy loading failed for package 'lme4'
    >> >>> ** Removing '/home/bs/pd/Rlibrary/lme4'
    >> >>> ** Restoring previous '/home/bs/pd/Rlibrary/lme4'
    >> >>> 
    >> >>> and the DESCRIPTION file for lme 4 does have
    >> >>> 
    >> >>> Depends: methods, R(? 2.7.0), Matrix(? 0.999375-11), lattice
    >> >>> <http://cran.r-project.org/web/packages/lattice/index.html>
    >> >>> 
    >> >>> 
    >> >>> Looks like we're either not checking the version requirement of
    >> >>> dependencies, or something is making 4 > 11... (from my reading of the
    >> >>> code, it is the former, but I could have missed something).
    >> >> 
    >> >> We don't check version requirements of dependencies in
    >> >> install.packages(). That's a minefield related to having multiple
    >> >> versions of a package on a system and which gets loaded/namespace
    >> >> loaded, so you can easily have the needed version but pick up a
    >> >> different one.
    >> >> 
    >> >> Depending on whether lazy-loading is in place (and various other
    >> >> issues) you may or may not need the dependencies to install the
    >> >> package.  It's also a problem that you can update dependencies to
    >> >> incompatible ones, so the versions available at installation are only
    >> >> part of the story.
    >> >> 
    >> >> I don't see why the message reports .11 not -11, but that may be
    >> >> related to "package_version" classes.
    >> >> 
    >> >>> We should at least document the behaviour.
    >> >> 
    >> >> I am not sure where you think it should be documented and is not.
    >> >> But for install.packages():
    >> >> 
    >> >> dependencies: logical indicating to also install uninstalled packages
    >> >> on which these packages depend/suggest/import (and so on
    >> >> recursively).  Not used if 'repos = NULL'. Can also be a
    >> >> character vector, a subset of 'c("Depends", "Imports",
    >> >> "Suggests")'.
    >> >> 
    >> >> 'uninstalled' seems pretty clear to me.
    >> >> 
    PD> It isn't. Matrix 0.999375-11 was 'uninstalled'. The above could just
    PD> mean that if you installed it, it wouldn't be installed again.
    >> 
    PD> Something like "Notice that version dependencies are not checked." would
    PD> help. (Assuming that people read the help page.)
    >> 
    >> Or even more:
    >> 
    >> "
    >> Notice that version dependencies are not checked such that
    >> outdated versions of installed packages are \emph{not} updated.
    >> Consider using  \code{\link{update.packages}()} before 
    >> \code{install.packages()}.
    >> "
    >> 
    >> Note that --- thanks to Heather Turner nice help.request() proposal ---
    >> one of my top "TODOs" for R-devel is
    >> to finish a generalization of the current
    >> update.packages()
    >> function (that I have not quite finished)
    >> which will allow to only look for updates of specified set of
    >> packages rather than all packages in a given lib.loc
    >> {something that should *not* be triggered by a help.request()
    >> for a user (as ours) who has ~ 2000 R packages installed}.

I have now finally committed this code to R-devel (rev 46576)
and plan to port it to R-2.8.0 alpha before feature freeze.

It may well be worth if a few people have a look, and maybe even
try to send their next R-help e-mail with the new
help.request() function ..

Martin

    PD> That's essentially what happened to me (not with 2000 packages, though).
    PD> I was looking into the lme4/aod issue - reinstall lme4 - Matrix out of
    PD> date - update.packages() - wait for an hour or so for gtk2 and friends
    PD> to be updated on my laptop...

    PD> -- 
    PD> O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
    PD> c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
    PD> (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
    PD> ~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907


From martin.bader at unibas.ch  Mon Sep 29 09:55:04 2008
From: martin.bader at unibas.ch (martin.bader at unibas.ch)
Date: Mon, 29 Sep 2008 09:55:04 +0200 (CEST)
Subject: [Rd] Label justification (axis) (PR#13085)
Message-ID: <20080929075504.1694D282EFC2@mail.pubhealth.ku.dk>

Full_Name: Martin Bader
Version: 2.7.2
OS: Mac OS X 10.5.3
Submission from: (NULL) (131.152.1.1)


Hello there, 

in the axis command, label justification remains centered at all times. If one
applies las=1 within the axis command and then moves the axis and labels using
the pos and hadj options, respectively, the labels keep a centered
justification. I.e. a single digit number is then farther away from the axis
than numbers with two or more digits.


From charlie at stat.umn.edu  Mon Sep 29 23:56:23 2008
From: charlie at stat.umn.edu (Charles Geyer)
Date: Mon, 29 Sep 2008 16:56:23 -0500
Subject: [Rd] new TR about when MLE exist in GLM and what to do if not
Message-ID: <20080929215623.GC27828@stat.umn.edu>

This is just to alert the list about a new technical report

    http://www.stat.umn.edu/geyer/gdor/

that shows how to determine, using exact infinite-precision rational arithmetic
when the MLE exists in a GLM (or for that matter in any exponential family,
such as aster models -- contributed package aster) and what to do when it
does not.

This suggests many changes to glm, glm.fit, predict.glm, and anova.glm.
Before any such changes could be implemented, the contributed package
rcdd would need to be made recommended, which in turn would require that
it be made available on Macintosh (the problem is getting the GNU bignum
package GMP to compile with gcc, shouldn't be hard, but apparently is on
Macs, but Jan de Leeuw has done it, so it's not impossible).

The tech report shows how correct data analysis is done in GLMs when
the MLE doesn't exist.  I haven't thought about how this could be worked
into the glm suite of functions, but it clearly could be done.  I would
be glad to help out any way I can if the core team think this should be done.
-- 
Charles Geyer
Professor, School of Statistics
University of Minnesota
charlie at stat.umn.edu


From mflawren at fhcrc.org  Tue Sep 30 02:06:43 2008
From: mflawren at fhcrc.org (Michael Lawrence)
Date: Mon, 29 Sep 2008 17:06:43 -0700
Subject: [Rd] Rterm.exe, windows event loop running in multiple threads?
In-Reply-To: <49633.192.54.49.174.1221746659.squirrel@webmail.ebi.ac.uk>
References: <509e0620809180559k6c18a6e1he065daa5bd5a08d7@mail.gmail.com>
	<48D2578A.5040202@stats.uwo.ca>
	<509e0620809180638l19ded259w439bbcb8c2c1ba12@mail.gmail.com>
	<49633.192.54.49.174.1221746659.squirrel@webmail.ebi.ac.uk>
Message-ID: <509e0620809291706v733dff32s8772c48a3e9c42ee@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20080929/a71b40c1/attachment.pl>

From kemphillips at comcast.net  Mon Sep 29 17:25:03 2008
From: kemphillips at comcast.net (kemphillips at comcast.net)
Date: Mon, 29 Sep 2008 17:25:03 +0200 (CEST)
Subject: [Rd] describe function in package Hmisc and function format.dates
	in chron (PR#13087)
Message-ID: <20080929152503.E0461282EFC2@mail.pubhealth.ku.dk>

Full_Name: Kem Phillips
Version: 2.7.1 (2008-06-23)
OS: Windows Xp professional
Submission from: (NULL) (98.221.200.108)


The Hmisc function   describe   fails, giving the error message:

   Error in formatDateTime(dd, atx, !timeUsed) : 
     could not find function "format.dates"

Loading the chron package, where function  dates  apparently resides, does not
fix the problem.   Note also that loading  chron  gives a warning.  Earlier
versions of  chron  from the archive failed to load properly.  Please see the
entire session below, with the error message at the bottom.

Thanks.


R version 2.7.1 (2008-06-23)
Copyright (C) 2008 The R Foundation for Statistical Computing
ISBN 3-900051-07-0

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

[Previously saved workspace restored]

> library(Hdisc)
Error in library(Hdisc) : there is no package called 'Hdisc'
> library(Hmisc)

Attaching package: 'Hmisc'


        The following object(s) are masked from package:base :

         format.pval,
         round.POSIXt,
         trunc.POSIXt,
         units 

Warning message:
package 'Hmisc' was built under R version 2.7.2 
> library(Design)
Loading required package: survival
Loading required package: splines

Attaching package: 'survival'


        The following object(s) are masked from package:Hmisc :

         untangle.specials 

Design library by Frank E Harrell Jr

Type library(help='Design'), ?Overview, or ?Design.Overview')
to see overall documentation.


Attaching package: 'Design'


        The following object(s) are masked from package:survival :

         Surv,
         survfit 


        The following object(s) are masked from package:Hmisc :

         .R.,
         .SV4. 

Warning message:
package 'Design' was built under R version 2.7.2 
> prostate                 NOTE THAT DATA SET prostate exists 
    patno stage              rx dtime                       status age  wt      
            pf hx sbp dbp                               ekg        hg sz
1       1     3 0.2 mg estrogen    72                        alive  75  76     
normal activity  0  15   9                      heart strain 13.798828  2


..

505 13   8.39843750  0  3311
506 NA  22.19921880  1  3428
> describe(prostate)
Error in formatDateTime(dd, atx, !timeUsed) : 
  could not find function "format.dates"
> library(chron)
Warning message:
package 'chron' was built under R version 2.7.2 
> describe(prostate)
Error in formatDateTime(dd, atx, !timeUsed) : 
  could not find function "format.dates"
>


From wdunlap at tibco.com  Mon Sep 29 21:03:11 2008
From: wdunlap at tibco.com (William Dunlap)
Date: Mon, 29 Sep 2008 12:03:11 -0700
Subject: [Rd] seg.fault from nlme::gnls() {was "[R-sig-ME] GNLS Crash"}
In-Reply-To: <18653.64212.996077.405539@cmath-5.math.ethz.ch>
References: <329A68716B57D54E8D39FD3F8A4A84DF0EB93F8E@um-mail0136.unimaas.nl>
	<18653.64212.996077.405539@cmath-5.math.ethz.ch>
Message-ID: <FBFBD35F5823FD4E97ACDEBB353DD9C608D79D@NA-PA-VBE01.na.tibco.com>

 When I run this under valgrind with gctorture(TRUE) I see memory
misuse in mat_mult (matrix.c, line 82):
% R-2.8.0-dev --debugger=valgrind --debugger-args=--db-attach=yes
... copyright blah blah ...
> data(Orange)
> gctorture(TRUE)
> gnls(circumference ~ Asym/(1 + exp(-(age-xmid)/scal)) ,
+ data = Orange, correlation = corExp(form = ~1 | Tree),
+ start = c(Asym=150, xmid=750, scal=300))
r==5894== Invalid read of size 4
==5894==    at 0x580268F: mult_mat (matrix.c:82)
==5894==    by 0x57FF1B0: corStruct_recalc (corStruct.c:70)
==5894==    by 0x5801F89: gnls_objective (gnls.c:100)
==5894==    by 0x58020FE: fit_gnls (gnls.c:152)
==5894==    by 0x81439A2: do_dotCode (dotcode.c:1758)
==5894==    by 0x8161C56: Rf_eval (eval.c:487)
==5894==    by 0x81637D5: do_set (eval.c:1422)
==5894==    by 0x8161B3B: Rf_eval (eval.c:461)
==5894==    by 0x816384B: do_begin (eval.c:1174)
==5894==    by 0x8161B3B: Rf_eval (eval.c:461)
==5894==    by 0x816397B: do_repeat (eval.c:1137)
==5894==    by 0x8161B3B: Rf_eval (eval.c:461)
==5894==  Address 0x4E4A8CC is 12 bytes inside a block of size 864 free'd
==5894==    at 0x40052A3: free (vg_replace_malloc.c:233)
==5894==    by 0x805ACFD: R_gc_internal (memory.c:767)
==5894==    by 0x805B933: Rf_cons (memory.c:1755)
==5894==    by 0x805B98E: Rf_allocList (memory.c:2094)
==5894==    by 0x815AB4C: replaceCall (Rinlinedfuns.h:84)
==5894==    by 0x8163476: applydefine (eval.c:919)
==5894==    by 0x8161B3B: Rf_eval (eval.c:461)
==5894==    by 0x816384B: do_begin (eval.c:1174)
==5894==    by 0x8161B3B: Rf_eval (eval.c:461)
==5894==    by 0x8161B3B: Rf_eval (eval.c:461)
==5894==    by 0x816384B: do_begin (eval.c:1174)
==5894==    by 0x8161B3B: Rf_eval (eval.c:461)

My copy of valgrind doesn't get along with my copy of gdb,
so when it pops into gdb the debugger doesn't get any
information from *.so files.  I don't have the time now
to put printf statements into mat_mult.

Bill Dunlap
wdunlap tibco.com 

-----Original Message-----
From: r-devel-bounces at r-project.org [mailto:r-devel-bounces at r-project.org] On Behalf Of Martin Maechler
Sent: Saturday, September 27, 2008 2:20 AM
To: Viechtbauer Wolfgang (STAT)
Cc: r-sig-mixed-models at r-project.org; R-devel at stat.math.ethz.ch
Subject: [Rd] seg.fault from nlme::gnls() {was "[R-sig-ME] GNLS Crash"}

>>>>> "VW" == Viechtbauer Wolfgang (STAT) <Wolfgang.Viechtbauer at STAT.unimaas.nl>
>>>>>     on Fri, 26 Sep 2008 18:00:19 +0200 writes:

    VW> Hi all, I'm trying to fit a marginal (longitudinal)
    VW> model with an exponential serial correlation function to
    VW> the Orange tree data set. However, R crashes frequently
    VW> when using the gnls() function. With the following
    VW> simple example, I was able to reproduce the problem.


    VW> gnls.exp <- gnls(circumference ~ Asym/(1 + exp(-(age-xmid)/scal)) ,
    VW> data = Orange, correlation = corExp(form = ~1 | Tree),
    VW> start = c(Asym=150, xmid=750, scal=300))

Yes, I can reproduce it (on a Linux (RHEL 5) 64bit server), using R 2.8.0 alpha : Use this

for(i in 1:20)# for MM: ca. 8 to 10 times --> seg.fault try( gnls.exp <- gnls(circumference ~ Asym/(1 + exp(-(age-xmid)/scal)) ,
              data = Orange, correlation = corExp(form = ~1 | Tree),
              start = c(Asym=150, xmid=750, scal=300))
)

If I run it in the debugger and then do a backtrace I see

Error in gnls(circumference ~ Asym/(1 + exp(-(age - xmid)/scal)), data = Orange,  : 
  Step halving factor reduced below minimum in NLS step

[............................................................]
[...................the same about 6 times...................] [............................................................]

Error in gnls(circumference ~ Asym/(1 + exp(-(age - xmid)/scal)), data = Orange,  : 
  Step halving factor reduced below minimum in NLS step Error in .makeMessage(..., domain = domain) : 
  incorrect number of arguments to "<-"
Error in .makeMessage(..., domain = domain) : 
  incorrect number of arguments to "<-"

Program received signal SIGABRT, Aborted.
0x0000003294e30155 in raise () from /lib64/libc.so.6
(gdb) bt
#0  0x0000003294e30155 in raise () from /lib64/libc.so.6
#1  0x0000003294e31bf0 in abort () from /lib64/libc.so.6
#2  0x00000000004184f5 in R_gc_internal (size_needed=0)
    at ../../../R/src/main/memory.c:761
#3  0x000000000041b121 in Rf_cons (car=0x1b2ec088, cdr=0x1a3436d8)
    at ../../../R/src/main/memory.c:1755
#4  0x0000000000578472 in applydefine (call=<value optimized out>, 
    op=0x1a3617a8, args=0x1ad47590, rho=0x1b2ea428)
    at ../../../R/src/include/Rinlinedfuns.h:153
#5  0x0000000000575a42 in Rf_eval (e=0x1ad47558, rho=0x1b2ea428)
    at ../../../R/src/main/eval.c:461
#6  0x0000000000576d50 in do_begin (call=0x1ad48450, op=0x1a362518, 
    args=0x1ad47520, rho=0x1b2ea428) at ../../../R/src/main/eval.c:1174
#7  0x0000000000575a42 in Rf_eval (e=0x1ad48450, rho=0x1b2ea428)
    at ../../../R/src/main/eval.c:461
#8  0x0000000000578f9c in Rf_applyClosure (call=0x1b2e9958, op=0x1ad48370, 
    arglist=0x1b2e9a70, rho=0x1b690298, suppliedenv=0x1b2e99c8)
    at ../../../R/src/main/eval.c:667
#9  0x00000000004285b9 in Rf_usemethod (generic=0x67e8d7 "[", 
    obj=<value optimized out>, call=<value optimized out>, 
    args=<value optimized out>, rho=0xffffffffffffffff, callrho=0x1b690298, 
    defrho=0x1a384f28, ans=0x7fffcaa8d5a8) at ../../../R/src/main/objects.c:311 #10 0x0000000000576a25 in Rf_DispatchOrEval (call=0x1a81d8d0, op=0x1a3622e8, 
    generic=0x67e8d7 "[", args=0x1a81d908, rho=0x1b690298, ans=0x7fffcaa8d5a8, 
    dropmissing=0, argsevald=0) at ../../../R/src/main/eval.c:1930
#11 0x00000000004afc40 in do_subset (call=0x7716, op=0x7716, 
    args=0xffffffffffffffff, rho=0x1b690298)
    at ../../../R/src/main/subset.c:577
#12 0x0000000000575a42 in Rf_eval (e=0x1a81d8d0, rho=0x1b690298)
    at ../../../R/src/main/eval.c:461
#13 0x00000000005780c7 in applydefine (call=0x1a81d748, op=0x1a3617a8, 
    args=0x6, rho=0xffffffffffffffff) at ../../../R/src/main/eval.c:1318
#14 0x0000000000575a42 in Rf_eval (e=0x1a81d748, rho=0x1b690298)
    at ../../../R/src/main/eval.c:461
#15 0x00000000005775de in do_for (call=0x1a81d668, op=0x1a360180, 
    args=0x1a81d6a0, rho=0x1b690298) at ../../../R/src/main/eval.c:1073

..... and more (downto #155 for R's main(...)

This is a bug,  probably in the C code of package nlme which I guess corrupts memory somehere earlier, and we are seeing the effect only later.
I'll leave this to the (memory-)debugging experts...

Martin

    VW> On my and one other computer, R usually crashes when calling the gnls() function with this code three times in a row. I stumbled across this when trying to fit this model with different starting values.

    VW> Version information:

    VW> platform       i386-pc-mingw32             
    ......
    VW> version.string R version 2.7.2 (2008-08-25)

    VW> Can anybody help figure out what causes this problem?

    VW> Best,

    VW> -- 
    VW> Wolfgang Viechtbauer 
    VW> ?Department of Methodology and Statistics 
    VW> ?University of Maastricht, The Netherlands 
    VW> ?http://www.wvbauer.com/ 

    VW> _______________________________________________
    VW> R-sig-mixed-models at r-project.org mailing list
    VW> https://stat.ethz.ch/mailman/listinfo/r-sig-mixed-models

______________________________________________
R-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-devel


From Kurt.Hornik at wu-wien.ac.at  Tue Sep 30 09:29:28 2008
From: Kurt.Hornik at wu-wien.ac.at (Kurt Hornik)
Date: Tue, 30 Sep 2008 09:29:28 +0200
Subject: [Rd] Rterm.exe, windows event loop running in multiple threads?
In-Reply-To: <509e0620809291706v733dff32s8772c48a3e9c42ee@mail.gmail.com>
References: <509e0620809180559k6c18a6e1he065daa5bd5a08d7@mail.gmail.com>
	<48D2578A.5040202@stats.uwo.ca>
	<509e0620809180638l19ded259w439bbcb8c2c1ba12@mail.gmail.com>
	<49633.192.54.49.174.1221746659.squirrel@webmail.ebi.ac.uk>
	<509e0620809291706v733dff32s8772c48a3e9c42ee@mail.gmail.com>
Message-ID: <18657.54616.392387.77519@fangorn.hornik.net>

>>>>> Michael Lawrence writes:

> On Thu, Sep 18, 2008 at 7:04 AM, Simon Anders <anders at ebi.ac.uk> wrote:
>> Hi Michael,
>> 
>> Michael Lawrence wrote:
>> >>> For processing events, RGtk2 has moved away from using the old tcl_do
>> hack
>> >>> and now synchronizes on the Windows event loop. In Rgui.exe this works
>> >>> fine
>> >>> (well mostly), but in Rterm.exe, users report the following warning
>> from
>> >>> GLib: "main loop already active in another thread". The most obvious
>> way
>> >>> this could occur is if the Windows event loop were iterating in
>> multiple
>> >>> threads. This does not seem to be the case from my casual inspection of
>> >>> the
>> >>> R source.
>> 
>> Following your advice, I have changed my HilbertCurveDisplay package from
>> the tcl_do hack to your threading technique.
>> 
>> IIRC, you start this second thread whose event handler gets called
>> periodically by a timer. It checks whether there are any pending Gtk
>> events, and if so, sends a message to the R main thread in order to cause
>> one GTK event loop iteration.
>> 
>> I have writen my gtkmm code the same way and got the same error message,
>> repeated many times. However, after I removed the check for pending events
>> from the handler of the timer event, the error message vanishes. It seems
>> that GTK does not like it if gtk_events_pending() is called from two
>> threads even if both threads refer to the same main loop. (Actually, it
>> does not mind, as the error is just a warning, and fucntionality ois not
>> disrupted. I guess that Rgui.exe gets the same warning but fails to
>> display it.)
>> 
>> Could this be the problem for you as well?
>> 
>> [Thinking a bout this again: Why, actually, do we need a second thread.
>> Could we not set up a Windows timer that dispatches a message to the main
>> thread's event handler peridoically to trigger a polling of the Gtk event
>> loop?]
>> 

> Thanks a lot for this tip. I have changed from using a thread to a
> timer, and uploaded it as RGtk2 2.12.7 to CRAN. If anyone wants to
> test, thanks!

Thanks, on CRAN now.

Best
-k


From charles.dupont at Vanderbilt.Edu  Tue Sep 30 15:03:32 2008
From: charles.dupont at Vanderbilt.Edu (Charles Dupont)
Date: Tue, 30 Sep 2008 08:03:32 -0500
Subject: [Rd] describe function in package Hmisc and function
 format.dates in chron (PR#13087)
In-Reply-To: <20080929152503.E0461282EFC2@mail.pubhealth.ku.dk>
References: <20080929152503.E0461282EFC2@mail.pubhealth.ku.dk>
Message-ID: <48E223A4.5000608@vanderbilt.edu>

This is because format.dates has become non-callable from outside the chron 
package.  Until the next release of Hmisc you can download a fixed version of 
the describe function at

http://biostat.mc.vanderbilt.edu/svn/R/Hmisc/trunk/R/describe.s

Charles

kemphillips at comcast.net wrote:
> Full_Name: Kem Phillips
> Version: 2.7.1 (2008-06-23)
> OS: Windows Xp professional
> Submission from: (NULL) (98.221.200.108)
> 
> 
> The Hmisc function   describe   fails, giving the error message:
> 
>    Error in formatDateTime(dd, atx, !timeUsed) : 
>      could not find function "format.dates"
> 
> Loading the chron package, where function  dates  apparently resides, does not
> fix the problem.   Note also that loading  chron  gives a warning.  Earlier
> versions of  chron  from the archive failed to load properly.  Please see the
> entire session below, with the error message at the bottom.
> 
> Thanks.
> 
> 
> R version 2.7.1 (2008-06-23)
> Copyright (C) 2008 The R Foundation for Statistical Computing
> ISBN 3-900051-07-0
> 
> R is free software and comes with ABSOLUTELY NO WARRANTY.
> You are welcome to redistribute it under certain conditions.
> Type 'license()' or 'licence()' for distribution details.
> 
>   Natural language support but running in an English locale
> 
> R is a collaborative project with many contributors.
> Type 'contributors()' for more information and
> 'citation()' on how to cite R or R packages in publications.
> 
> Type 'demo()' for some demos, 'help()' for on-line help, or
> 'help.start()' for an HTML browser interface to help.
> Type 'q()' to quit R.
> 
> [Previously saved workspace restored]
> 
>> library(Hdisc)
> Error in library(Hdisc) : there is no package called 'Hdisc'
>> library(Hmisc)
> 
> Attaching package: 'Hmisc'
> 
> 
>         The following object(s) are masked from package:base :
> 
>          format.pval,
>          round.POSIXt,
>          trunc.POSIXt,
>          units 
> 
> Warning message:
> package 'Hmisc' was built under R version 2.7.2 
>> library(Design)
> Loading required package: survival
> Loading required package: splines
> 
> Attaching package: 'survival'
> 
> 
>         The following object(s) are masked from package:Hmisc :
> 
>          untangle.specials 
> 
> Design library by Frank E Harrell Jr
> 
> Type library(help='Design'), ?Overview, or ?Design.Overview')
> to see overall documentation.
> 
> 
> Attaching package: 'Design'
> 
> 
>         The following object(s) are masked from package:survival :
> 
>          Surv,
>          survfit 
> 
> 
>         The following object(s) are masked from package:Hmisc :
> 
>          .R.,
>          .SV4. 
> 
> Warning message:
> package 'Design' was built under R version 2.7.2 
>> prostate                 NOTE THAT DATA SET prostate exists 
>     patno stage              rx dtime                       status age  wt      
>             pf hx sbp dbp                               ekg        hg sz
> 1       1     3 0.2 mg estrogen    72                        alive  75  76     
> normal activity  0  15   9                      heart strain 13.798828  2
> 
> ?..
> 
> 505 13   8.39843750  0  3311
> 506 NA  22.19921880  1  3428
>> describe(prostate)
> Error in formatDateTime(dd, atx, !timeUsed) : 
>   could not find function "format.dates"
>> library(chron)
> Warning message:
> package 'chron' was built under R version 2.7.2 
>> describe(prostate)
> Error in formatDateTime(dd, atx, !timeUsed) : 
>   could not find function "format.dates"
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 


-- 
Charles Dupont	Computer System Analyst		School of Medicine
		Department of Biostatistics	Vanderbilt University


From j.c.l.ooms at uu.nl  Tue Sep 30 15:28:14 2008
From: j.c.l.ooms at uu.nl (Jeroen Ooms)
Date: Tue, 30 Sep 2008 06:28:14 -0700 (PDT)
Subject: [Rd]  weird behavior of drop1() for polr models (MASS)
Message-ID: <19742120.post@talk.nabble.com>


I would like to do a SS type III analysis on a proportional odds logistic
regression model. I use drop1(), but dropterm() shows the same behaviour. It
works as expected for regular main effects models, however when the model
includes an interaction effect it seems to have problems with matching the
parameters to the predictor terms. An example:

library("MASS");
options(contrasts = c("contr.treatment", "contr.poly"));

house.plr1 <- polr(Sat ~ Infl + Type + Cont, weights = Freq, data =
housing);
drop1(house.plr1,attributes(house.plr1$terms)$term.labels,test="Chisq");

house.plr2 <- polr(Sat ~ Infl * Type + Cont, weights = Freq, data =
housing); 
drop1(house.plr2,attributes(house.plr2$terms)$term.labels,test="Chisq");

Notice that model 2 has a * instead of a + between predictors Infl and Type.
In model 1, estimated parameters are nicely attributed to the right term,
however in house.plr2, only 2 of the 4 terms are evaluated.

I am using R version 2.7.2 (2008-08-25) i386-pc-mingw32, and MASS_7.2-44.

-- 
View this message in context: http://www.nabble.com/weird-behavior-of-drop1%28%29-for-polr-models-%28MASS%29-tp19742120p19742120.html
Sent from the R devel mailing list archive at Nabble.com.


From jfox at mcmaster.ca  Tue Sep 30 15:57:36 2008
From: jfox at mcmaster.ca (John Fox)
Date: Tue, 30 Sep 2008 09:57:36 -0400
Subject: [Rd] weird behavior of drop1() for polr models (MASS)
In-Reply-To: <19742120.post@talk.nabble.com>
References: <19742120.post@talk.nabble.com>
Message-ID: <003801c92304$7ea05d50$7be117f0$@ca>

Dear Jeroen,

drop1() respects relationships of marginality among the terms in a model and
won't drop a lower-order term (e.g., a main effect) when a higher-order
relative (e.g., an interaction to which the main effect is marginal) is in
the model. If you want a complete "type-III" ANOVA table and are careful
with contrast coding (which you were not, since contr.treatment produces
contrasts that are not orthogonal in the row basis of the model matrix --
you could use, e.g., contr.sum), then you can use the Anova() function in
the car package, specifying type="III".

Note: I'm responding to this message on the r-devel list where it was
posted, but this is really a question for r-help.

I hope this helps,
 John

------------------------------
John Fox, Professor
Department of Sociology
McMaster University
Hamilton, Ontario, Canada
web: socserv.mcmaster.ca/jfox


> -----Original Message-----
> From: r-devel-bounces at r-project.org [mailto:r-devel-bounces at r-project.org]
On
> Behalf Of Jeroen Ooms
> Sent: September-30-08 9:28 AM
> To: r-devel at r-project.org
> Subject: [Rd] weird behavior of drop1() for polr models (MASS)
> 
> 
> I would like to do a SS type III analysis on a proportional odds logistic
> regression model. I use drop1(), but dropterm() shows the same behaviour.
It
> works as expected for regular main effects models, however when the model
> includes an interaction effect it seems to have problems with matching the
> parameters to the predictor terms. An example:
> 
> library("MASS");
> options(contrasts = c("contr.treatment", "contr.poly"));
> 
> house.plr1 <- polr(Sat ~ Infl + Type + Cont, weights = Freq, data =
> housing);
> drop1(house.plr1,attributes(house.plr1$terms)$term.labels,test="Chisq");
> 
> house.plr2 <- polr(Sat ~ Infl * Type + Cont, weights = Freq, data =
> housing);
> drop1(house.plr2,attributes(house.plr2$terms)$term.labels,test="Chisq");
> 
> Notice that model 2 has a * instead of a + between predictors Infl and
Type.
> In model 1, estimated parameters are nicely attributed to the right term,
> however in house.plr2, only 2 of the 4 terms are evaluated.
> 
> I am using R version 2.7.2 (2008-08-25) i386-pc-mingw32, and MASS_7.2-44.
> 
> --
> View this message in context: http://www.nabble.com/weird-behavior-of-
> drop1%28%29-for-polr-models-%28MASS%29-tp19742120p19742120.html
> Sent from the R devel mailing list archive at Nabble.com.
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From P.Dalgaard at biostat.ku.dk  Tue Sep 30 16:12:01 2008
From: P.Dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Tue, 30 Sep 2008 16:12:01 +0200
Subject: [Rd] weird behavior of drop1() for polr models (MASS)
In-Reply-To: <19742120.post@talk.nabble.com>
References: <19742120.post@talk.nabble.com>
Message-ID: <48E233B1.8040309@biostat.ku.dk>

Jeroen Ooms wrote:
> I would like to do a SS type III analysis on a proportional odds logistic
> regression model. I use drop1(), but dropterm() shows the same behaviour. It
> works as expected for regular main effects models, however when the model
> includes an interaction effect it seems to have problems with matching the
> parameters to the predictor terms. An example:
>
> library("MASS");
> options(contrasts = c("contr.treatment", "contr.poly"));
>
> house.plr1 <- polr(Sat ~ Infl + Type + Cont, weights = Freq, data =
> housing);
> drop1(house.plr1,attributes(house.plr1$terms)$term.labels,test="Chisq");
>
> house.plr2 <- polr(Sat ~ Infl * Type + Cont, weights = Freq, data =
> housing); 
> drop1(house.plr2,attributes(house.plr2$terms)$term.labels,test="Chisq");
>
> Notice that model 2 has a * instead of a + between predictors Infl and Type.
> In model 1, estimated parameters are nicely attributed to the right term,
> however in house.plr2, only 2 of the 4 terms are evaluated.
>
> I am using R version 2.7.2 (2008-08-25) i386-pc-mingw32, and MASS_7.2-44.
>   

(It would have been better form to actually print the result so that
people can see what you're on about:
> drop1(house.plr2,attributes(house.plr2$terms)$term.labels,test="Chisq");
Single term deletions

Model:
Sat ~ Infl * Type + Cont
          Df    AIC        LRT   Pr(Chi)
<none>       3484.6
Infl       0 3484.6  2.086e-08
Type       0 3484.6 -1.301e-10
Cont       1 3497.8       15.1 0.0001009 ***
Infl:Type  6 3495.1       22.5 0.0009786 ***

I take it that the perceived problem is the two 0-Df lines.)



This is slightly peculiar, yes, but notice that in lm() or glm() you'd
normally just not get entries for main effects in the presence of their
interaction. This is deliberate -- type III tests can be seriously
misleading and/or uninterpretable in that case, so you really are better
off without them.

The direct cause of the behaviour above is that in R,

Infl+Type+Infl:Type

and

Type+Infl:Type

are just two parametrizations of the same model. Try


summary(house.plr2)
summary(update(house.plr2,~.-Type))

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907


From maechler at stat.math.ethz.ch  Tue Sep 30 18:52:56 2008
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Tue, 30 Sep 2008 18:52:56 +0200
Subject: [Rd] Planned mailing list "timeout" of several hours
Message-ID: <18658.22888.917953.181261@stat.math.ethz.ch>

There will be upcoming maintenance work on one of main network's server
which will affect the MAIL server 
for all mailing lists R-*@R-project.org (or R-*@stat.math.ethz.ch).

This change will take place on

 Wednesday October 1,	from  9 p.m. (UTC+2)
 ....................         3 p.m. (US East)
 ....................        12 p.m. (US West)
 Thursday  October 2.	      7 a.m. (NZ)
 ....................         5 a.m. (Oz time east ?)
 	   	   
and will last 2 to 6 hours (worst case; expected is 3 hrs).

You should not get any e-mails rejected, so go ahead with your
postings as normal.
The mails should be kept in a secondary/substitute mail server
and be forwarded to ours as soon as that "gets up" again.

But you will notice that your message is not posted to the lists
for several hours.

We are sorry for the inconvenience to the R community.

Martin Maechler,
ETH Zurich


From j.c.l.ooms at uu.nl  Tue Sep 30 21:10:16 2008
From: j.c.l.ooms at uu.nl (Jeroen Ooms)
Date: Tue, 30 Sep 2008 12:10:16 -0700 (PDT)
Subject: [Rd] weird behavior of drop1() for polr models (MASS)
In-Reply-To: <003801c92304$7ea05d50$7be117f0$@ca>
References: <19742120.post@talk.nabble.com>
	<003801c92304$7ea05d50$7be117f0$@ca>
Message-ID: <19748496.post@talk.nabble.com>


Sorry for posting in -dev; I assumed a technical issue. Thanks very much for
the responses, I've realized that interaction effects of categorical
predictors are more complicated than I thought. I've read the contrasts help
file and paragraph in the R manual about contrast, however I'm not quite
sure I fully understand it yet.

I tried Peter's suggestion of fitting "~Infl + Type + Infl:Type" and "Type +
Infl:Type", and indeed these result in identical models. For the first
model, the main effects have 5 parameters and the interaction effect
contains 6 parameters, for the second model the main effects have 3
parameters and the interaction has 8 parameters. Do I understand it
correctly that when the interaction effect is included in the model, R just
fits a parameter for every possible combination of the predictor categories
minus 1 for the reference group (so 3*4-1 parameters in this case)? And that
therefore the attribution of parameters to main or interaction predictors is
kind of arbitrary?

I am aware that there are several ways of encoding the contrasts of
categorical predictors, e.g. contr.sum(4); contr.treatment(4), however I do
not understand how the interaction effects are then coded (just products for
every combination?), and how this influences the SS type III values, when it
does in fact result in the same model. 

And does this same issue then also arise for all other anova models? For
example, if I fit a normal model in glm (I have done the same thing numerous
times in SPSS glm univariate), am I then allowed to interpret the main
effects SS3 values as genuine main effects? For example:

options(contrasts = c("contr.sum", "contr.poly"));
mymodel <- glm(Freq~Infl*Type,data=housing);
drop1(mymodel,attributes(mymodel$terms)$term.labels,test="Chisq");

Thanks again, all comments are very much appreciated!

Jeroen.







John Fox-6 wrote:
> 
> Dear Jeroen,
> 
> drop1() respects relationships of marginality among the terms in a model
> and
> won't drop a lower-order term (e.g., a main effect) when a higher-order
> relative (e.g., an interaction to which the main effect is marginal) is in
> the model. If you want a complete "type-III" ANOVA table and are careful
> with contrast coding (which you were not, since contr.treatment produces
> contrasts that are not orthogonal in the row basis of the model matrix --
> you could use, e.g., contr.sum), then you can use the Anova() function in
> the car package, specifying type="III".
> 
> Note: I'm responding to this message on the r-devel list where it was
> posted, but this is really a question for r-help.
> 
> I hope this helps,
>  John
> 
> ------------------------------
> John Fox, Professor
> Department of Sociology
> McMaster University
> Hamilton, Ontario, Canada
> web: socserv.mcmaster.ca/jfox
> 
> 
>> -----Original Message-----
>> From: r-devel-bounces at r-project.org
>> [mailto:r-devel-bounces at r-project.org]
> On
>> Behalf Of Jeroen Ooms
>> Sent: September-30-08 9:28 AM
>> To: r-devel at r-project.org
>> Subject: [Rd] weird behavior of drop1() for polr models (MASS)
>> 
>> 
>> I would like to do a SS type III analysis on a proportional odds logistic
>> regression model. I use drop1(), but dropterm() shows the same behaviour.
> It
>> works as expected for regular main effects models, however when the model
>> includes an interaction effect it seems to have problems with matching
>> the
>> parameters to the predictor terms. An example:
>> 
>> library("MASS");
>> options(contrasts = c("contr.treatment", "contr.poly"));
>> 
>> house.plr1 <- polr(Sat ~ Infl + Type + Cont, weights = Freq, data =
>> housing);
>> drop1(house.plr1,attributes(house.plr1$terms)$term.labels,test="Chisq");
>> 
>> house.plr2 <- polr(Sat ~ Infl * Type + Cont, weights = Freq, data =
>> housing);
>> drop1(house.plr2,attributes(house.plr2$terms)$term.labels,test="Chisq");
>> 
>> Notice that model 2 has a * instead of a + between predictors Infl and
> Type.
>> In model 1, estimated parameters are nicely attributed to the right term,
>> however in house.plr2, only 2 of the 4 terms are evaluated.
>> 
>> I am using R version 2.7.2 (2008-08-25) i386-pc-mingw32, and MASS_7.2-44.
>> 
>> --
>> View this message in context: http://www.nabble.com/weird-behavior-of-
>> drop1%28%29-for-polr-models-%28MASS%29-tp19742120p19742120.html
>> Sent from the R devel mailing list archive at Nabble.com.
>> 
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 

-- 
View this message in context: http://www.nabble.com/weird-behavior-of-drop1%28%29-for-polr-models-%28MASS%29-tp19742120p19748496.html
Sent from the R devel mailing list archive at Nabble.com.


From jfox at mcmaster.ca  Tue Sep 30 23:14:09 2008
From: jfox at mcmaster.ca (John Fox)
Date: Tue, 30 Sep 2008 17:14:09 -0400
Subject: [Rd] weird behavior of drop1() for polr models (MASS)
In-Reply-To: <19748496.post@talk.nabble.com>
References: <19742120.post@talk.nabble.com>	<003801c92304$7ea05d50$7be117f0$@ca>
	<19748496.post@talk.nabble.com>
Message-ID: <001701c92341$7b157520$71405f60$@ca>

Dear Jeroen,

> -----Original Message-----
> From: r-devel-bounces at r-project.org [mailto:r-devel-bounces at r-project.org]
On
> Behalf Of Jeroen Ooms
> Sent: September-30-08 3:10 PM
> To: r-devel at r-project.org
> Subject: Re: [Rd] weird behavior of drop1() for polr models (MASS)
> 
> 
> Sorry for posting in -dev; I assumed a technical issue. Thanks very much
for
> the responses, I've realized that interaction effects of categorical
> predictors are more complicated than I thought. I've read the contrasts
help
> file and paragraph in the R manual about contrast, however I'm not quite
> sure I fully understand it yet.
> 
> I tried Peter's suggestion of fitting "~Infl + Type + Infl:Type" and "Type
+
> Infl:Type", and indeed these result in identical models. For the first
> model, the main effects have 5 parameters and the interaction effect
> contains 6 parameters, for the second model the main effects have 3
> parameters and the interaction has 8 parameters. Do I understand it
> correctly that when the interaction effect is included in the model, R
just
> fits a parameter for every possible combination of the predictor
categories
> minus 1 for the reference group (so 3*4-1 parameters in this case)? And
that
> therefore the attribution of parameters to main or interaction predictors
is
> kind of arbitrary?
> 
> I am aware that there are several ways of encoding the contrasts of
> categorical predictors, e.g. contr.sum(4); contr.treatment(4), however I
do
> not understand how the interaction effects are then coded (just products
for
> every combination?), and how this influences the SS type III values, when
it
> does in fact result in the same model.

If by type-III SS, you mean dropping particular columns of the model matrix
and noting the increase in the residual sum of squares, this can indeed be
affected by contrast coding, because when you drop columns corresponding to
a term that's marginal to an included term, the resulting model is not
variant with respect to changes in contrast coding. More fundamentally, the
hypotheses that you're testing can change with the contrasts, and if you're
using a set of contrasts that are not orthogonal in the row basis of the
model matrix, the tests for "main effects" will not test what are reasonably
interpreted as main effects.

> 
> And does this same issue then also arise for all other anova models? For
> example, if I fit a normal model in glm (I have done the same thing
numerous
> times in SPSS glm univariate), am I then allowed to interpret the main
> effects SS3 values as genuine main effects? For example:
> 
> options(contrasts = c("contr.sum", "contr.poly"));
> mymodel <- glm(Freq~Infl*Type,data=housing);
> drop1(mymodel,attributes(mymodel$terms)$term.labels,test="Chisq");

Why a chi-square test? Why use glm() for a linear model? contr.sum and
contr.poly do indeed create contrasts that are orthogonal in the row basis
of the model matrix, so you could interpret tests of main effects, though
these imply averaging over the levels of the other factor. In the presence
of an interaction, that might not be of much interest. What is the
attraction of "type-III" tests as opposed to "type-II" tests?

These questions are sufficiently complicated that they're hard to address in
an email. They are addressed in Sec. 8.2 and 10.4 of my Applied Regression
text (either edition).

Regards,
 John

> 
> Thanks again, all comments are very much appreciated!
> 
> Jeroen.
> 
> 
> 
> 
> 
> 
> 
> John Fox-6 wrote:
> >
> > Dear Jeroen,
> >
> > drop1() respects relationships of marginality among the terms in a model
> > and
> > won't drop a lower-order term (e.g., a main effect) when a higher-order
> > relative (e.g., an interaction to which the main effect is marginal) is
in
> > the model. If you want a complete "type-III" ANOVA table and are careful
> > with contrast coding (which you were not, since contr.treatment produces
> > contrasts that are not orthogonal in the row basis of the model matrix
--
> > you could use, e.g., contr.sum), then you can use the Anova() function
in
> > the car package, specifying type="III".
> >
> > Note: I'm responding to this message on the r-devel list where it was
> > posted, but this is really a question for r-help.
> >
> > I hope this helps,
> >  John
> >
> > ------------------------------
> > John Fox, Professor
> > Department of Sociology
> > McMaster University
> > Hamilton, Ontario, Canada
> > web: socserv.mcmaster.ca/jfox
> >
> >
> >> -----Original Message-----
> >> From: r-devel-bounces at r-project.org
> >> [mailto:r-devel-bounces at r-project.org]
> > On
> >> Behalf Of Jeroen Ooms
> >> Sent: September-30-08 9:28 AM
> >> To: r-devel at r-project.org
> >> Subject: [Rd] weird behavior of drop1() for polr models (MASS)
> >>
> >>
> >> I would like to do a SS type III analysis on a proportional odds
logistic
> >> regression model. I use drop1(), but dropterm() shows the same
behaviour.
> > It
> >> works as expected for regular main effects models, however when the
model
> >> includes an interaction effect it seems to have problems with matching
> >> the
> >> parameters to the predictor terms. An example:
> >>
> >> library("MASS");
> >> options(contrasts = c("contr.treatment", "contr.poly"));
> >>
> >> house.plr1 <- polr(Sat ~ Infl + Type + Cont, weights = Freq, data =
> >> housing);
> >>
drop1(house.plr1,attributes(house.plr1$terms)$term.labels,test="Chisq");
> >>
> >> house.plr2 <- polr(Sat ~ Infl * Type + Cont, weights = Freq, data =
> >> housing);
> >>
drop1(house.plr2,attributes(house.plr2$terms)$term.labels,test="Chisq");
> >>
> >> Notice that model 2 has a * instead of a + between predictors Infl and
> > Type.
> >> In model 1, estimated parameters are nicely attributed to the right
term,
> >> however in house.plr2, only 2 of the 4 terms are evaluated.
> >>
> >> I am using R version 2.7.2 (2008-08-25) i386-pc-mingw32, and
MASS_7.2-44.
> >>
> >> --
> >> View this message in context: http://www.nabble.com/weird-behavior-of-
> >> drop1%28%29-for-polr-models-%28MASS%29-tp19742120p19742120.html
> >> Sent from the R devel mailing list archive at Nabble.com.
> >>
> >> ______________________________________________
> >> R-devel at r-project.org mailing list
> >> https://stat.ethz.ch/mailman/listinfo/r-devel
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >
> >
> 
> --
> View this message in context: http://www.nabble.com/weird-behavior-of-
> drop1%28%29-for-polr-models-%28MASS%29-tp19742120p19748496.html
> Sent from the R devel mailing list archive at Nabble.com.
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From Sebastian.Wastl.Meyer at campus.lmu.de  Tue Sep 30 22:50:12 2008
From: Sebastian.Wastl.Meyer at campus.lmu.de (Sebastian.Wastl.Meyer at campus.lmu.de)
Date: Tue, 30 Sep 2008 22:50:12 +0200 (CEST)
Subject: [Rd] anova.glm needs y = TRUE in glm() (PR#13098)
Message-ID: <20080930205012.314C0282EFC1@mail.pubhealth.ku.dk>

Full_Name: Sebastian Meyer
Version: R version 2.7.2 (2008-08-25)
OS: x86_64-pc-linux-gnu
Submission from: (NULL) (138.246.7.137)


In contrast to anova.lm, which works without storing components 'model', 'x' and
'y' in the fitted lm-object, anova.glm throws an error if y = FALSE and if there
is more than one covariate in the corresponding glm() call:

Error in method(x = x[, varseq <= i, drop = FALSE], y = object$y, weights =
object$prior.weights,  : 
  NAs in V(mu)

Reproduce this by e.g.:
fit <- glm(1:10 ~ I(1:10) + I((1:10)^2), y = FALSE)
anova(fit)


This is not nice since it is not clear that the error inherits from the missing
'y' in the glm object. This dependence should be documented and a clear error
message should be thrown in this case.
Another (much better) idea is to eliminate this dependence in 'anova.glm'. This
could be done by taking 'y' from e.g.
   model.response(model.frame(object))
instead of accessing 'object$y', which can be NULL.

Best regards,
    Sebastian Meyer


