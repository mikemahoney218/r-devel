From manuel.lopez-ibanez at ulb.ac.be  Sun Jul  1 17:04:06 2012
From: manuel.lopez-ibanez at ulb.ac.be (=?ISO-8859-1?Q?Manuel_L=F3pez-Ib=E1=F1ez?=)
Date: Sun, 01 Jul 2012 17:04:06 +0200
Subject: [Rd] [patch] one-line fix for the FAQ: disabling okular
	antia-aliasing
Message-ID: <4FF066E6.6000905@ulb.ac.be>

According to the main Okular developer [*], the command-line given in the FAQ 
is not completely correct.

[*] http://bugs.kde.org/show_bug.cgi?id=300604#c5

Cheers,

	Manuel.



-------------- next part --------------
A non-text attachment was scrubbed...
Name: fix-faq.diff
Type: text/x-diff
Size: 452 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20120701/0d3c26f4/attachment.bin>

From krivitsky at stat.psu.edu  Sun Jul  1 23:17:13 2012
From: krivitsky at stat.psu.edu (Pavel N. Krivitsky)
Date: Sun, 01 Jul 2012 17:17:13 -0400
Subject: [Rd] [patch] Behavior of .C() and .Fortran() when given
 double(0) or integer(0).
In-Reply-To: <20417.11242.289932.173647@max.nulle.part>
References: <1336153356.24356.332.camel@Navi.krivitsky.homeip.net>
	<4FB4C900.6070204@stats.ox.ac.uk>
	<1338051754.4646.165.camel@Navi.krivitsky.homeip.net>
	<D2C9AAAD-4B59-43DE-ACD8-3F722216EE89@r-project.org>
	<20417.11242.289932.173647@max.nulle.part>
Message-ID: <1341177433.4555.21.camel@Navi.krivitsky.homeip.net>

On Sat, 2012-05-26 at 14:15 -0500, Dirk Eddelbuettel wrote:
> On 26 May 2012 at 14:00, Simon Urbanek wrote:
> | [...] the real answer is use .Call() instead.
> 
> Maybe Kurt could add something to that extent to the R FAQ ?

Since it looks like the 0-length -> invalid pointer behavior is here to
stay, I want to second this request. It had taken me a long time to
track mysterious behavior of my package down to this issue, and I think
it would be helpful for developers in the future to have some documented
behavior, even if the documentation said that the behavior was
undefined.

                      Thanks,
                      Pavel Krivitsky


From mauricio.zambrano at jrc.ec.europa.eu  Mon Jul  2 17:06:11 2012
From: mauricio.zambrano at jrc.ec.europa.eu (Mauricio Zambrano-Bigiarini)
Date: Mon, 02 Jul 2012 17:06:11 +0200
Subject: [Rd] Dependency problem for "hasArg"
Message-ID: <4FF1B8E3.4050501@jrc.ec.europa.eu>

Dear list,

I'm running an R script which first line is:

#!/usr/bin/Rscript

While running that script from the system console (in Red Hat 
Enterprise Linux 6) I got the following error:


Error in plot2(x = sim, y = obs, plot.type = "single", main = 
paste("Daily",  :
   could not find function "hasArg"
Calls: plot_results -> plot_out -> ggof -> plot2


However, if I call EXACTLY the same script from the R console, by using

 > source("myRscript.R")

I do not get any error.


As you can see in the error message, the function 'plot_results' calls 
'plot_out' (both in the hydroPSO package). Then 'plot_out' calls the 
function 'ggof', which in turn calls 'plot2' (the latter 2 in the 
hydroGOF package), and 'plot2' has a call to 'hasArg'.


The package 'hydroGOF' exports all its functions by using:

exportPattern("^[^\\.]")

At the other hand, the package 'hydroPSO' does not import any function 
of the 'hydroGOF' package, because the call to 'ggof' only occurs within 
the 'plot_out' function if the hydroGOF package is detected on the user 
machine:

if (!require(hydroGOF)) {
      stop("Invalid argument: You don't have the 'hydroGOF' package !!")
} else {
   library(hydroGOF)
   ggof()
}

Do I have to explicitly import 'ggof' and 'plot2' on the 'hydroPSO' 
package in order to avoid this error or is there any better solution ?

sessionInfo()
R version 2.15.0 (2012-03-30)
Platform: x86_64-redhat-linux-gnu (64-bit)

locale:
  [1] LC_CTYPE=en_GB.utf8       LC_NUMERIC=C
  [3] LC_TIME=en_GB.utf8        LC_COLLATE=en_GB.utf8
  [5] LC_MONETARY=en_GB.utf8    LC_MESSAGES=en_GB.utf8
  [7] LC_PAPER=C                LC_NAME=C
  [9] LC_ADDRESS=C              LC_TELEPHONE=C
[11] LC_MEASUREMENT=en_GB.utf8 LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] lhs_0.7          hydroPSO_0.1-57  hydroGOF_0.3-3-1 hydroTSM_0.3-4-5
[5] xts_0.8-6        Lisflood_0.2-10  zoo_1.7-7

loaded via a namespace (and not attached):
  [1] automap_1.0-12 class_7.3-4    cluster_1.14.2 e1071_1.6 
grid_2.15.0   [6] gstat_1.0-12   Hmisc_3.9-3    lattice_0.20-6 
proj4_1.0-7    rgdal_0.7-12  [11] sp_0.9-99      tools_2.15.0



Any help would be very much appreciated.

Kind regards,

Mauricio Zambrano-Bigiarini

-- 
====================================================
Water Resources Unit
Institute for Environment and Sustainability (IES)
Joint Research Centre (JRC), European Commission
webinfo    : http://floods.jrc.ec.europa.eu/
====================================================
DISCLAIMER:\ "The views expressed are purely those of th...{{dropped:11}}


From cfriedem at gmail.com  Mon Jul  2 18:23:18 2012
From: cfriedem at gmail.com (Charlie Friedemann)
Date: Mon, 2 Jul 2012 09:23:18 -0700 (PDT)
Subject: [Rd] Dependency problem for "hasArg"
In-Reply-To: <4FF1B8E3.4050501@jrc.ec.europa.eu>
References: <4FF1B8E3.4050501@jrc.ec.europa.eu>
Message-ID: <1341246198971-4635158.post@n4.nabble.com>

The error message you are getting makes it rather clear what the problem is. 
R is unable to find the function 'hasArg'.  As the hasArg function is part
of the package 'methods', a solution would be to put require(methods) at the
beginning of your script.

For whatever reason, loading R via Rscript does not load the base package
"methods" whereas loading the R console does. I'm not entirely sure why this
is the case, and I'm sure someone who knows more about the differences
between the two could chime in here.

--
View this message in context: http://r.789695.n4.nabble.com/Dependency-problem-for-hasArg-tp4635147p4635158.html
Sent from the R devel mailing list archive at Nabble.com.


From edd at debian.org  Mon Jul  2 19:00:41 2012
From: edd at debian.org (Dirk Eddelbuettel)
Date: Mon, 2 Jul 2012 12:00:41 -0500
Subject: [Rd] Dependency problem for "hasArg"
In-Reply-To: <1341246198971-4635158.post@n4.nabble.com>
References: <4FF1B8E3.4050501@jrc.ec.europa.eu>
	<1341246198971-4635158.post@n4.nabble.com>
Message-ID: <20465.54201.303641.891734@max.nulle.part>


On 2 July 2012 at 09:23, Charlie Friedemann wrote:
| The error message you are getting makes it rather clear what the problem is. 
| R is unable to find the function 'hasArg'.  As the hasArg function is part
| of the package 'methods', a solution would be to put require(methods) at the
| beginning of your script.
| 
| For whatever reason, loading R via Rscript does not load the base package
| "methods" whereas loading the R console does. I'm not entirely sure why this
| is the case, and I'm sure someone who knows more about the differences
| between the two could chime in here.

That was a design decision in Rscript as loading 'methods' is slow.  And
FWIW, littler does the same:

  edd at max:~$ r -e'print(search())'
  [1] ".GlobalEnv"   "Autoloads"    "package:base"
  edd at max:~$ r -lmethods -e'print(search())'
  [1] ".GlobalEnv"      "package:methods" "Autoloads"       "package:base"   
  edd at max:~$ 

Dirk

-- 
Dirk Eddelbuettel | edd at debian.org | http://dirk.eddelbuettel.com


From edd at debian.org  Mon Jul  2 19:19:59 2012
From: edd at debian.org (Dirk Eddelbuettel)
Date: Mon, 2 Jul 2012 12:19:59 -0500
Subject: [Rd] Dependency problem for "hasArg"
In-Reply-To: <20465.54201.303641.891734@max.nulle.part>
References: <4FF1B8E3.4050501@jrc.ec.europa.eu>
	<1341246198971-4635158.post@n4.nabble.com>
	<20465.54201.303641.891734@max.nulle.part>
Message-ID: <20465.55359.526857.970137@max.nulle.part>


On 2 July 2012 at 12:00, Dirk Eddelbuettel wrote:
| 
| On 2 July 2012 at 09:23, Charlie Friedemann wrote:
| | The error message you are getting makes it rather clear what the problem is. 
| | R is unable to find the function 'hasArg'.  As the hasArg function is part
| | of the package 'methods', a solution would be to put require(methods) at the
| | beginning of your script.
| | 
| | For whatever reason, loading R via Rscript does not load the base package
| | "methods" whereas loading the R console does. I'm not entirely sure why this
| | is the case, and I'm sure someone who knows more about the differences
| | between the two could chime in here.
| 
| That was a design decision in Rscript as loading 'methods' is slow.  And
| FWIW, littler does the same:
| 
|   edd at max:~$ r -e'print(search())'
|   [1] ".GlobalEnv"   "Autoloads"    "package:base"
|   edd at max:~$ r -lmethods -e'print(search())'
|   [1] ".GlobalEnv"      "package:methods" "Autoloads"       "package:base"   
|   edd at max:~$ 

Maybe I should revisit this, though, as littler beats Rscript even when
loading methods --- and I could then argue that little is less confusing :)

edd at max:~$ time r -e 'q("no")'

real	0m0.366s
user	0m0.604s
sys	0m0.304s
edd at max:~$ time r -lmethods -e 'q("no")'

real	0m0.420s
user	0m0.648s
sys	0m0.476s
edd at max:~$ time Rscript -e 'q("no")'

real	0m0.485s
user	0m0.712s
sys	0m0.544s
edd at max:~$ 

Dirk

-- 
Dirk Eddelbuettel | edd at debian.org | http://dirk.eddelbuettel.com


From mtmorgan at fhcrc.org  Mon Jul  2 22:51:30 2012
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Mon, 02 Jul 2012 22:51:30 +0200
Subject: [Rd] Dependency problem for "hasArg"
In-Reply-To: <1341246198971-4635158.post@n4.nabble.com>
References: <4FF1B8E3.4050501@jrc.ec.europa.eu>
	<1341246198971-4635158.post@n4.nabble.com>
Message-ID: <4FF209D2.3010400@fhcrc.org>

On 07/02/2012 06:23 PM, Charlie Friedemann wrote:
> The error message you are getting makes it rather clear what the problem is.
> R is unable to find the function 'hasArg'.  As the hasArg function is part
> of the package 'methods', a solution would be to put require(methods) at the
> beginning of your script.

But I think the idea will be to import(methods) in HydroGOF, since the 
package requires these imports to function properly, and import'ing will 
mean that hasArg does not have to be found on the (user-controlled) 
search path.

Martin

>
> For whatever reason, loading R via Rscript does not load the base package
> "methods" whereas loading the R console does. I'm not entirely sure why this
> is the case, and I'm sure someone who knows more about the differences
> between the two could chime in here.
>
> --
> View this message in context: http://r.789695.n4.nabble.com/Dependency-problem-for-hasArg-tp4635147p4635158.html
> Sent from the R devel mailing list archive at Nabble.com.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


-- 
Computational Biology / Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N.
PO Box 19024 Seattle, WA 98109

Location: Arnold Building M1 B861
Phone: (206) 667-2793


From elsander at microstrain.com  Mon Jul  2 15:45:46 2012
From: elsander at microstrain.com (Elizabeth Sander)
Date: Mon, 2 Jul 2012 09:45:46 -0400
Subject: [Rd] S4 class for chunked data that inherits from numeric- numeric
 methods won't work
Message-ID: <CAD20vtBrDSO4pVBQxYn1=Q5uvFqEXA9vCZCLBGkqG7m2CZWD1Q@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20120702/f4cb8c18/attachment.pl>

From sleepingwell at gmail.com  Tue Jul  3 04:53:57 2012
From: sleepingwell at gmail.com (Simon Knapp)
Date: Tue, 3 Jul 2012 12:53:57 +1000
Subject: [Rd] Questions about imports to a namespace
Message-ID: <CAA+5f=3wxx+A3yXuuTYD_6YkfPZBuaPiW1mCKfU3hQAJD=B2GA@mail.gmail.com>

Hi,

I am a bit unsure about using imports in packages and have a few
questions. I'm sure the answer to some of these is 'it depends', but
I'm interested in what others think and 'best practices' when this is
the case.



1) If I use an import or importFrom declaration in a NAMESPACE, should
I also qualify the package in calls to the imported function (e.g.
maptools::readShapePoly)?

2) If the 'best practice' is to qualify the calls, when does one stop;
e.g. is it good/bad to say base::sapply?

3) If one is calling a (S3) generic, should one qualify the namespace?
Can this cause problems?

4) Is it better to check for arguments that are missing, or use a
default value of, say, NA; i.e. is missing(arg) preferable to
is.na(arg)?

5) I would like to declare a (S3) generic 'cleanup(x)' but
'cleanup(...)' already exists in R.utils, which my package depends on.
Should I do it?

6) I am used to writing 'requires(package)' for each package I use
within a function. If I have used import or importFrom in my
NAMESPACE, should I still do this?



Looking forward to your advice,
Simon Knapp


From mauricio.zambrano at jrc.ec.europa.eu  Tue Jul  3 09:07:01 2012
From: mauricio.zambrano at jrc.ec.europa.eu (Mauricio Zambrano-Bigiarini)
Date: Tue, 03 Jul 2012 09:07:01 +0200
Subject: [Rd] Dependency problem for "hasArg"
In-Reply-To: <4FF209D2.3010400@fhcrc.org>
References: <4FF1B8E3.4050501@jrc.ec.europa.eu>
	<1341246198971-4635158.post@n4.nabble.com> <4FF209D2.3010400@fhcrc.org>
Message-ID: <4FF29A15.6000406@jrc.ec.europa.eu>

On 02/07/12 22:51, Martin Morgan wrote:
> On 07/02/2012 06:23 PM, Charlie Friedemann wrote:
>> The error message you are getting makes it rather clear what the
>> problem is.
>> R is unable to find the function 'hasArg'. As the hasArg function is part
>> of the package 'methods', a solution would be to put require(methods)
>> at the
>> beginning of your script.
>
> But I think the idea will be to import(methods) in HydroGOF, since the
> package requires these imports to function properly, and import'ing will
> mean that hasArg does not have to be found on the (user-controlled)
> search path.

Thank you very much for your help.

I have already tried import(methods) in the NAMESPACE of hydroGOF, 
however, I got the following error message when doing R CMD check:

  checking package dependencies ... ERROR
Namespace dependency not required: ?methods?

So it seems that is not possible to force a package to import 'methods'.


Regarding the Dirk's comment, could it be possible to revisit the 
decision about  loading 'methods' in in Rscript ?. BTW, I do not know 
who is responsible for Rscript...


Thanks in advance,

Mauricio
-- 
====================================================
Water Resources Unit
Institute for Environment and Sustainability (IES)
Joint Research Centre (JRC), European Commission
webinfo    : http://floods.jrc.ec.europa.eu/
====================================================
DISCLAIMER:
"The views expressed are purely those of the writer
and may not in any circumstances be regarded as sta-
ting an official position of the European Commission"
====================================================
Linux user #454569 -- Ubuntu user #17469
====================================================
"The only things in life you regret,
Are the risks that you didn't take"
(Anonymous)

>
> Martin
>
>>
>> For whatever reason, loading R via Rscript does not load the base package
>> "methods" whereas loading the R console does. I'm not entirely sure
>> why this
>> is the case, and I'm sure someone who knows more about the differences
>> between the two could chime in here.
>>
>> --
>> View this message in context:
>> http://r.789695.n4.nabble.com/Dependency-problem-for-hasArg-tp4635147p4635158.html
>>
>> Sent from the R devel mailing list archive at Nabble.com.
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From mtmorgan at fhcrc.org  Tue Jul  3 09:10:12 2012
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Tue, 03 Jul 2012 09:10:12 +0200
Subject: [Rd] Dependency problem for "hasArg"
In-Reply-To: <4FF29A15.6000406@jrc.ec.europa.eu>
References: <4FF1B8E3.4050501@jrc.ec.europa.eu>
	<1341246198971-4635158.post@n4.nabble.com>
	<4FF209D2.3010400@fhcrc.org> <4FF29A15.6000406@jrc.ec.europa.eu>
Message-ID: <4FF29AD4.8060704@fhcrc.org>

On 07/03/2012 09:07 AM, Mauricio Zambrano-Bigiarini wrote:
> On 02/07/12 22:51, Martin Morgan wrote:
>> On 07/02/2012 06:23 PM, Charlie Friedemann wrote:
>>> The error message you are getting makes it rather clear what the
>>> problem is.
>>> R is unable to find the function 'hasArg'. As the hasArg function is
>>> part
>>> of the package 'methods', a solution would be to put require(methods)
>>> at the
>>> beginning of your script.
>>
>> But I think the idea will be to import(methods) in HydroGOF, since the
>> package requires these imports to function properly, and import'ing will
>> mean that hasArg does not have to be found on the (user-controlled)
>> search path.
>
> Thank you very much for your help.
>
> I have already tried import(methods) in the NAMESPACE of hydroGOF,
> however, I got the following error message when doing R CMD check:
>
> checking package dependencies ... ERROR
> Namespace dependency not required: ?methods?
>
> So it seems that is not possible to force a package to import 'methods'.

In your DESCRIPTION file, add

Imports: methods

Martin

>
>
> Regarding the Dirk's comment, could it be possible to revisit the
> decision about loading 'methods' in in Rscript ?. BTW, I do not know who
> is responsible for Rscript...
>
>
> Thanks in advance,
>
> Mauricio


-- 
Computational Biology / Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N.
PO Box 19024 Seattle, WA 98109

Location: Arnold Building M1 B861
Phone: (206) 667-2793


From mauricio.zambrano at jrc.ec.europa.eu  Tue Jul  3 09:36:43 2012
From: mauricio.zambrano at jrc.ec.europa.eu (Mauricio Zambrano-Bigiarini)
Date: Tue, 03 Jul 2012 09:36:43 +0200
Subject: [Rd] Dependency problem for "hasArg"
In-Reply-To: <4FF29AD4.8060704@fhcrc.org>
References: <4FF1B8E3.4050501@jrc.ec.europa.eu>
	<1341246198971-4635158.post@n4.nabble.com> <4FF209D2.3010400@fhcrc.org>
	<4FF29A15.6000406@jrc.ec.europa.eu> <4FF29AD4.8060704@fhcrc.org>
Message-ID: <4FF2A10B.5050405@jrc.ec.europa.eu>

On 03/07/12 09:10, Martin Morgan wrote:
> On 07/03/2012 09:07 AM, Mauricio Zambrano-Bigiarini wrote:
>> On 02/07/12 22:51, Martin Morgan wrote:
>>> On 07/02/2012 06:23 PM, Charlie Friedemann wrote:
>>>> The error message you are getting makes it rather clear what the
>>>> problem is.
>>>> R is unable to find the function 'hasArg'. As the hasArg function is
>>>> part
>>>> of the package 'methods', a solution would be to put require(methods)
>>>> at the
>>>> beginning of your script.
>>>
>>> But I think the idea will be to import(methods) in HydroGOF, since the
>>> package requires these imports to function properly, and import'ing will
>>> mean that hasArg does not have to be found on the (user-controlled)
>>> search path.
>>
>> Thank you very much for your help.
>>
>> I have already tried import(methods) in the NAMESPACE of hydroGOF,
>> however, I got the following error message when doing R CMD check:
>>
>> checking package dependencies ... ERROR
>> Namespace dependency not required: ?methods?
>>
>> So it seems that is not possible to force a package to import 'methods'.
>
> In your DESCRIPTION file, add
>
> Imports: methods
>
> Martin
>
Thank you very much Martin.

Now hydroGOF with import(methods) pass R CMD check without any problem.

All the best,

Mauricio

>>
>>
>> Regarding the Dirk's comment, could it be possible to revisit the
>> decision about loading 'methods' in in Rscript ?. BTW, I do not know who
>> is responsible for Rscript...
>>
>>
>> Thanks in advance,
>>
>> Mauricio
>
>


From murdoch.duncan at gmail.com  Tue Jul  3 12:41:45 2012
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Tue, 03 Jul 2012 06:41:45 -0400
Subject: [Rd] Questions about imports to a namespace
In-Reply-To: <CAA+5f=3wxx+A3yXuuTYD_6YkfPZBuaPiW1mCKfU3hQAJD=B2GA@mail.gmail.com>
References: <CAA+5f=3wxx+A3yXuuTYD_6YkfPZBuaPiW1mCKfU3hQAJD=B2GA@mail.gmail.com>
Message-ID: <4FF2CC69.9040209@gmail.com>

On 12-07-02 10:53 PM, Simon Knapp wrote:
> Hi,
>
> I am a bit unsure about using imports in packages and have a few
> questions. I'm sure the answer to some of these is 'it depends', but
> I'm interested in what others think and 'best practices' when this is
> the case.
>
>
>
> 1) If I use an import or importFrom declaration in a NAMESPACE, should
> I also qualify the package in calls to the imported function (e.g.
> maptools::readShapePoly)?

No, you won't need that.  I would expect it to slow things down a bit, 
since it needs two searches instead of one:  look up "maptools", look up 
"readShapePoly".

>
> 2) If the 'best practice' is to qualify the calls, when does one stop;
> e.g. is it good/bad to say base::sapply?
>
> 3) If one is calling a (S3) generic, should one qualify the namespace?
> Can this cause problems?

I think it wouldn't hurt other than the slight speed hit.

> 4) Is it better to check for arguments that are missing, or use a
> default value of, say, NA; i.e. is missing(arg) preferable to
> is.na(arg)?

That depends.  It's easier to set an argument to a special value in a 
call from another function than it is to conditionally set it to be 
missing, but there are only a couple of general purpose choices for 
"missing" values:  NA and NULL, and you might want a user to be able to 
specify those.  (You can also use negative values for counts, etc., in 
particular contexts.)

> 5) I would like to declare a (S3) generic 'cleanup(x)' but
> 'cleanup(...)' already exists in R.utils, which my package depends on.
> Should I do it?

No.  Use a different name.  If you are using R.utils, your users are 
also using it, and their code may want to call R.utils::cleanup without 
the R.utils:: prefix.

> 6) I am used to writing 'requires(package)' for each package I use
> within a function. If I have used import or importFrom in my
> NAMESPACE, should I still do this?

No, it just slows things down, and can cause other problems for users 
because it changes the search list.

Duncan Murdoch


From OleF.Christensen at agrsci.dk  Tue Jul  3 10:57:29 2012
From: OleF.Christensen at agrsci.dk (Ole Fredslund Christensen)
Date: Tue, 3 Jul 2012 10:57:29 +0200
Subject: [Rd] print.data.frame function with option na.print=" " actually
 prints NA
Message-ID: <5D46A8E0D922A14E98DA61151D68DF87014024713B63@DJFEXMBX01.djf.agrsci.dk>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20120703/7e194846/attachment.pl>

From pauljohn32 at gmail.com  Tue Jul  3 19:21:03 2012
From: pauljohn32 at gmail.com (Paul Johnson)
Date: Tue, 3 Jul 2012 12:21:03 -0500
Subject: [Rd] Problem in vignette packaging of Sweave in utils package
Message-ID: <CAErODj_9n7cjy5iPkjr-GOocL23hnJwX2QCYSd+4zJfgu0SUpA@mail.gmail.com>

In ?Sweave, it refers to Sweave User Manual. In the doc folder of
utils package, I see "Sweave.pdf".

However, I can't find it from within R


> vignette("Sweave User Manual")
Warning message:
vignette ?Sweave User Manual? not found


> browseVignettes("utils")
No vignettes found by browseVignettes("utils")


> library(help=utils)

does not refer to any vignettes.

The vignette does not appear in the main page for utils in help.start().

I checked the source code for the Sweave vignette, but I don't see
anything wrong. It has all of the required elements:

%\VignetteIndexEntry{Sweave User Manual}
%\VignettePackage{utils}
%\VignetteDepends{tools}
%\VignetteDepends{datasets}
%\VignetteDepends{stats}

Am I accessing it incorrectly, or is there something wrong in my
install of R-2.15.1?

> sessionInfo()
R version 2.15.1 (2012-06-22)
Platform: x86_64-pc-linux-gnu (64-bit)

locale:
 [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
 [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
 [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
 [7] LC_PAPER=C                 LC_NAME=C
 [9] LC_ADDRESS=C               LC_TELEPHONE=C
[11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

loaded via a namespace (and not attached):
[1] tools_2.15.1
-- 
Paul E. Johnson
Professor, Political Science    Assoc. Director
1541 Lilac Lane, Room 504     Center for Research Methods
University of Kansas               University of Kansas
http://pj.freefaculty.org            http://quant.ku.edu


From murdoch.duncan at gmail.com  Tue Jul  3 19:34:08 2012
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Tue, 03 Jul 2012 13:34:08 -0400
Subject: [Rd] Problem in vignette packaging of Sweave in utils package
In-Reply-To: <CAErODj_9n7cjy5iPkjr-GOocL23hnJwX2QCYSd+4zJfgu0SUpA@mail.gmail.com>
References: <CAErODj_9n7cjy5iPkjr-GOocL23hnJwX2QCYSd+4zJfgu0SUpA@mail.gmail.com>
Message-ID: <4FF32D10.2070803@gmail.com>

On 03/07/2012 1:21 PM, Paul Johnson wrote:
> In ?Sweave, it refers to Sweave User Manual. In the doc folder of
> utils package, I see "Sweave.pdf".
>
> However, I can't find it from within R
>
>
> > vignette("Sweave User Manual")
> Warning message:
> vignette ?Sweave User Manual? not found
>
>
> > browseVignettes("utils")
> No vignettes found by browseVignettes("utils")
>
>
> > library(help=utils)
>
> does not refer to any vignettes.
>
> The vignette does not appear in the main page for utils in help.start().
>
> I checked the source code for the Sweave vignette, but I don't see
> anything wrong. It has all of the required elements:
>
> %\VignetteIndexEntry{Sweave User Manual}
> %\VignettePackage{utils}
> %\VignetteDepends{tools}
> %\VignetteDepends{datasets}
> %\VignetteDepends{stats}
>
> Am I accessing it incorrectly, or is there something wrong in my
> install of R-2.15.1?

The vignette name is "Sweave", so you should see it when you say

vignette("Sweave")

but you should also have seen it in

browseVignettes("utils")

and

library(help=utils)

and the page for utils in the HTML help.  So it looks as though 
something is wrong in your install.  I do see it in 2.15.1 patched on 
Windows.

Duncan Murdoch

>
> > sessionInfo()
> R version 2.15.1 (2012-06-22)
> Platform: x86_64-pc-linux-gnu (64-bit)
>
> locale:
>   [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
>   [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
>   [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
>   [7] LC_PAPER=C                 LC_NAME=C
>   [9] LC_ADDRESS=C               LC_TELEPHONE=C
> [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> loaded via a namespace (and not attached):
> [1] tools_2.15.1


From xie at yihui.name  Tue Jul  3 19:54:04 2012
From: xie at yihui.name (Yihui Xie)
Date: Tue, 3 Jul 2012 13:54:04 -0400
Subject: [Rd] Problem in vignette packaging of Sweave in utils package
In-Reply-To: <4FF32D10.2070803@gmail.com>
References: <CAErODj_9n7cjy5iPkjr-GOocL23hnJwX2QCYSd+4zJfgu0SUpA@mail.gmail.com>
	<4FF32D10.2070803@gmail.com>
Message-ID: <CANROs4e6mpBwbcmqCwGUPdfUJb1iriDw2Xq=DYsDrZu8R2Z_xw@mail.gmail.com>

Strange enough; I just noticed the HTML index pages of several base
packages were gone (e.g. base, stats, tools, utils) under Ubuntu. Not
sure if this is a problem of Debian packages or R itself.

> sessionInfo()
R version 2.15.1 (2012-06-22)
Platform: i686-pc-linux-gnu (32-bit)

locale:
 [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
 [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
 [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
 [7] LC_PAPER=C                 LC_NAME=C
 [9] LC_ADDRESS=C               LC_TELEPHONE=C
[11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

Regards,
Yihui
--
Yihui Xie <xieyihui at gmail.com>
Phone: 515-294-2465 Web: http://yihui.name
Department of Statistics, Iowa State University
2215 Snedecor Hall, Ames, IA


On Tue, Jul 3, 2012 at 1:34 PM, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
> On 03/07/2012 1:21 PM, Paul Johnson wrote:
>>
>> In ?Sweave, it refers to Sweave User Manual. In the doc folder of
>> utils package, I see "Sweave.pdf".
>>
>> However, I can't find it from within R
>>
>>
>> > vignette("Sweave User Manual")
>> Warning message:
>> vignette ?Sweave User Manual? not found
>>
>>
>> > browseVignettes("utils")
>> No vignettes found by browseVignettes("utils")
>>
>>
>> > library(help=utils)
>>
>> does not refer to any vignettes.
>>
>> The vignette does not appear in the main page for utils in help.start().
>>
>> I checked the source code for the Sweave vignette, but I don't see
>> anything wrong. It has all of the required elements:
>>
>> %\VignetteIndexEntry{Sweave User Manual}
>> %\VignettePackage{utils}
>> %\VignetteDepends{tools}
>> %\VignetteDepends{datasets}
>> %\VignetteDepends{stats}
>>
>> Am I accessing it incorrectly, or is there something wrong in my
>> install of R-2.15.1?
>
>
> The vignette name is "Sweave", so you should see it when you say
>
> vignette("Sweave")
>
> but you should also have seen it in
>
> browseVignettes("utils")
>
> and
>
> library(help=utils)
>
> and the page for utils in the HTML help.  So it looks as though something is
> wrong in your install.  I do see it in 2.15.1 patched on Windows.
>
> Duncan Murdoch
>
>
>>
>> > sessionInfo()
>> R version 2.15.1 (2012-06-22)
>> Platform: x86_64-pc-linux-gnu (64-bit)
>>
>> locale:
>>   [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
>>   [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
>>   [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
>>   [7] LC_PAPER=C                 LC_NAME=C
>>   [9] LC_ADDRESS=C               LC_TELEPHONE=C
>> [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
>>
>> attached base packages:
>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>
>> loaded via a namespace (and not attached):
>> [1] tools_2.15.1
>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From marc_schwartz at me.com  Tue Jul  3 21:21:06 2012
From: marc_schwartz at me.com (Marc Schwartz)
Date: Tue, 03 Jul 2012 14:21:06 -0500
Subject: [Rd] Problem in vignette packaging of Sweave in utils package
In-Reply-To: <CANROs4e6mpBwbcmqCwGUPdfUJb1iriDw2Xq=DYsDrZu8R2Z_xw@mail.gmail.com>
References: <CAErODj_9n7cjy5iPkjr-GOocL23hnJwX2QCYSd+4zJfgu0SUpA@mail.gmail.com>
	<4FF32D10.2070803@gmail.com>
	<CANROs4e6mpBwbcmqCwGUPdfUJb1iriDw2Xq=DYsDrZu8R2Z_xw@mail.gmail.com>
Message-ID: <10B60ABF-DF86-426F-8F02-61F056D0A12A@me.com>

The HTML help related pages are dynamically generated upon request, so there are no static pages that would exist otherwise. I can get to the index pages for each of the packages mentioned in Yihui's post.

That being said, I can replicate the vignette issue on:

R version 2.15.1 (2012-06-22) -- "Roasted Marshmallows"

which was a clean install on OSX Lion using the OSX binary on CRAN.


> browseVignettes("utils")
No vignettes found by browseVignettes("utils")

> browseVignettes("grid")
No vignettes found by browseVignettes("grid")

> browseVignettes("parallel")
No vignettes found by browseVignettes("parallel")

> vignette("Sweave")
Warning message:
vignette ?Sweave? not found 


However, Matrix and survival did work.

Curiously, testInstalledPackages() did work for the vignettes without returning an error:

> Result <- testInstalledPackages(types = "vignettes")
Running vignettes for package ?utils?
Running vignettes for package ?grid?
Running vignettes for package ?parallel?
Running vignettes for package ?Matrix?
Running vignettes for package ?survival?
> Result
[1] 0


I then installed:

R version 2.15.1 Patched (2012-07-02 r59715) -- "Roasted Marshmallows"

from Simon's site and:

> browseVignettes("utils")
> browseVignettes("grid")
> browseVignettes("parallel")
> vignette("Sweave")

all worked. 

So it would appear that there was something amiss with the 2.15.1 release packaging or something involving the vignettes at least for those packages. A review of the NEWS file did not reveal anything obvious to me that would be relevant.

Regards,

Marc Schwartz


On Jul 3, 2012, at 12:54 PM, Yihui Xie wrote:

> Strange enough; I just noticed the HTML index pages of several base
> packages were gone (e.g. base, stats, tools, utils) under Ubuntu. Not
> sure if this is a problem of Debian packages or R itself.
> 
>> sessionInfo()
> R version 2.15.1 (2012-06-22)
> Platform: i686-pc-linux-gnu (32-bit)
> 
> locale:
> [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
> [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
> [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
> [7] LC_PAPER=C                 LC_NAME=C
> [9] LC_ADDRESS=C               LC_TELEPHONE=C
> [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
> 
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
> 
> Regards,
> Yihui
> --
> Yihui Xie <xieyihui at gmail.com>
> Phone: 515-294-2465 Web: http://yihui.name
> Department of Statistics, Iowa State University
> 2215 Snedecor Hall, Ames, IA
> 
> 
> On Tue, Jul 3, 2012 at 1:34 PM, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
>> On 03/07/2012 1:21 PM, Paul Johnson wrote:
>>> 
>>> In ?Sweave, it refers to Sweave User Manual. In the doc folder of
>>> utils package, I see "Sweave.pdf".
>>> 
>>> However, I can't find it from within R
>>> 
>>> 
>>>> vignette("Sweave User Manual")
>>> Warning message:
>>> vignette ?Sweave User Manual? not found
>>> 
>>> 
>>>> browseVignettes("utils")
>>> No vignettes found by browseVignettes("utils")
>>> 
>>> 
>>>> library(help=utils)
>>> 
>>> does not refer to any vignettes.
>>> 
>>> The vignette does not appear in the main page for utils in help.start().
>>> 
>>> I checked the source code for the Sweave vignette, but I don't see
>>> anything wrong. It has all of the required elements:
>>> 
>>> %\VignetteIndexEntry{Sweave User Manual}
>>> %\VignettePackage{utils}
>>> %\VignetteDepends{tools}
>>> %\VignetteDepends{datasets}
>>> %\VignetteDepends{stats}
>>> 
>>> Am I accessing it incorrectly, or is there something wrong in my
>>> install of R-2.15.1?
>> 
>> 
>> The vignette name is "Sweave", so you should see it when you say
>> 
>> vignette("Sweave")
>> 
>> but you should also have seen it in
>> 
>> browseVignettes("utils")
>> 
>> and
>> 
>> library(help=utils)
>> 
>> and the page for utils in the HTML help.  So it looks as though something is
>> wrong in your install.  I do see it in 2.15.1 patched on Windows.
>> 
>> Duncan Murdoch


From pauljohn32 at gmail.com  Tue Jul  3 21:23:49 2012
From: pauljohn32 at gmail.com (Paul Johnson)
Date: Tue, 3 Jul 2012 14:23:49 -0500
Subject: [Rd] Problem in vignette packaging of Sweave in utils package
In-Reply-To: <CANROs4e6mpBwbcmqCwGUPdfUJb1iriDw2Xq=DYsDrZu8R2Z_xw@mail.gmail.com>
References: <CAErODj_9n7cjy5iPkjr-GOocL23hnJwX2QCYSd+4zJfgu0SUpA@mail.gmail.com>
	<4FF32D10.2070803@gmail.com>
	<CANROs4e6mpBwbcmqCwGUPdfUJb1iriDw2Xq=DYsDrZu8R2Z_xw@mail.gmail.com>
Message-ID: <CAErODj_mLefWodWE6G=QZeVqCO8X8Yxg4pUhME21bi_aOR97ng@mail.gmail.com>

On Tue, Jul 3, 2012 at 12:54 PM, Yihui Xie <xie at yihui.name> wrote:
> Strange enough; I just noticed the HTML index pages of several base
> packages were gone (e.g. base, stats, tools, utils) under Ubuntu. Not
> sure if this is a problem of Debian packages or R itself.
>

It is not only on Debian where I see:

> vignette("Sweave")
Warning message:
vignette ?Sweave? not found

This afflicts RPM based installs as well. It is not a new problem, AFAICT.

Here's output from R-2.15.0 on a Centos Linux cluster node.:

> vignette("Sweave")
Warning message:
vignette 'Sweave' not found

> sessionInfo()
R version 2.15.0 (2012-03-30)
Platform: x86_64-redhat-linux-gnu (64-bit)

locale:
 [1] LC_CTYPE=en_US.iso885915       LC_NUMERIC=C
 [3] LC_TIME=en_US.iso885915        LC_COLLATE=en_US.iso885915
 [5] LC_MONETARY=en_US.iso885915    LC_MESSAGES=en_US.iso885915
 [7] LC_PAPER=C                     LC_NAME=C
 [9] LC_ADDRESS=C                   LC_TELEPHONE=C
[11] LC_MEASUREMENT=en_US.iso885915 LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

loaded via a namespace (and not attached):
[1] tools_2.15.0

> --
> Yihui Xie <xieyihui at gmail.com>
> Phone: 515-294-2465 Web: http://yihui.name
> Department of Statistics, Iowa State University
> 2215 Snedecor Hall, Ames, IA
>

-- 
Paul E. Johnson
Professor, Political Science    Assoc. Director
1541 Lilac Lane, Room 504     Center for Research Methods
University of Kansas               University of Kansas
http://pj.freefaculty.org            http://quant.ku.edu


From mikko.korpela at aalto.fi  Wed Jul  4 23:01:42 2012
From: mikko.korpela at aalto.fi (Mikko Korpela)
Date: Thu, 5 Jul 2012 00:01:42 +0300
Subject: [Rd] Suggestion / patch to support more Unicode characters in R CMD
	Rd2pdf
Message-ID: <4FF4AF36.40605@aalto.fi>

Hi list,

When using R CMD Rd2pdf, it is possible to set environment variable 
RD2PDF_INPUTENC to value "inputenx" and enjoy better support for UTF-8 
characters (see ?Rd2pdf). This enables LaTeX package "inputenx" instead 
of "inputenc".

Even better support for UTF-8 encoded characters can be had by better 
using the facilities provided by inputenx and making R CMD Rd2pdf insert 
a line to its temporary .tex file: "\input{ix-utf8enc.dfu}". The 
instructions are found in section 1.2 "Unicode" of the inputenx manual: 
http://mirror.ctan.org/macros/latex/contrib/oberdiek/inputenx.pdf

I suggest that R CMD Rd2pdf automatically insert 
"\input{ix-utf8enc.dfu}" to its temporary .tex file when a combination 
of inputenx and UTF-8 is detected. The attached small patch does that.

A demo package is also attached (tarball built manually, not R CMD 
build). It uses some UTF-8 characters not supported without the patch: R 
CMD Rd2pdf gives an error, propagated from LaTeX. With the patch 
installed, R CMD Rd2pdf works OK when RD2PDF_INPUTENC=inputenx is set. 
For testing, unpack tarball and run R CMD Rd2pdf on the resulting 
directory. Tested on R development version r59731 running on Ubuntu 
10.10 64 bit.

-- 
Mikko Korpela
Aalto University School of Science
Department of Information and Computer Science


-------------- next part --------------
A non-text attachment was scrubbed...
Name: encTest3.tar.gz
Type: application/x-gzip
Size: 2429 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20120705/5e61ce90/attachment.gz>
-------------- next part --------------
Index: src/library/tools/R/Rd2pdf.R
===================================================================
--- src/library/tools/R/Rd2pdf.R	(revision 59731)
+++ src/library/tools/R/Rd2pdf.R	(working copy)
@@ -466,12 +466,17 @@
     inputenc <- Sys.getenv("RD2PDF_INPUTENC", "inputenc")
     ## this needs to be canonical, e.g. 'utf8'
     ## trailer is for detection if we want to edit it later.
+    latex_outputEncoding <- latex_canonical_encoding(outputEncoding)
     setEncoding <-
         paste("\\usepackage[",
-              latex_canonical_encoding(outputEncoding), "]{",
+              latex_outputEncoding, "]{",
               inputenc, "} % @SET ENCODING@", sep="")
     useGraphicx <- "% \\usepackage{graphicx} % @USE GRAPHICX@"
     writeLines(c(setEncoding,
+                 if (inputenc == "inputenx" &&
+                     latex_outputEncoding == "utf8") {
+                     "\\input{ix-utf8enc.dfu}"
+                 },
     		 useGraphicx,
                  if (index) "\\makeindex{}",
                  "\\begin{document}"), out)
@@ -545,21 +550,28 @@
     latexEncodings <- unique(latexEncodings)
     latexEncodings <- latexEncodings[!is.na(latexEncodings)]
     cyrillic <- if (nzchar(Sys.getenv("_R_CYRILLIC_TEX_"))) "utf8" %in% latexEncodings else FALSE
-    latex_outputEncoding <- latex_canonical_encoding(outputEncoding)
     encs <- latexEncodings[latexEncodings != latex_outputEncoding]
     if (length(encs) || hasFigures || cyrillic) {
         lines <- readLines(outfile)
+        moreUnicode <- inputenc == "inputenx" && "utf8" %in% encs
 	encs <- paste(encs, latex_outputEncoding, collapse=",", sep=",")
 
 	if (!cyrillic) {
-	    lines[lines == setEncoding] <-
+	    setEncoding2 <-
 		paste0("\\usepackage[", encs, "]{", inputenc, "}")
 	} else {
-	    lines[lines == setEncoding] <-
+	    setEncoding2 <-
 		paste(
 "\\usepackage[", encs, "]{", inputenc, "}
 \\IfFileExists{t2aenc.def}{\\usepackage[T2A]{fontenc}}{}", sep = "")
 	}
+	if (moreUnicode) {
+	    setEncoding2 <-
+		paste0(
+setEncoding2, "
+\\input{ix-utf8enc.dfu}")
+        }
+        lines[lines == setEncoding] <- setEncoding2
 	if (hasFigures)
 	    lines[lines == useGraphicx] <- "\\usepackage{graphicx}\\setkeys{Gin}{width=0.7\\textwidth}"
 	writeLines(lines, outfile)

From sleepingwell at gmail.com  Thu Jul  5 04:04:20 2012
From: sleepingwell at gmail.com (Simon Knapp)
Date: Thu, 5 Jul 2012 12:04:20 +1000
Subject: [Rd] Questions about imports to a namespace
In-Reply-To: <4FF2CC69.9040209@gmail.com>
References: <CAA+5f=3wxx+A3yXuuTYD_6YkfPZBuaPiW1mCKfU3hQAJD=B2GA@mail.gmail.com>
	<4FF2CC69.9040209@gmail.com>
Message-ID: <CAA+5f=3mfe+DmRfDHhRz=nbLXb9MN4GL2H=Wf64tDrQkpnSOEw@mail.gmail.com>

Thanks Duncan.

wrt question 4,  I see your point about passing arguments. Maybe R
could do with a value "MISSING" or "DEFAULT" for this and other
similar purposes. The test for is.na can be frustrating when the
argument (when not NA) has length greater than 1 as it produces a
warning. But in some situations NULL won't suffice. Consider this
contrived (and simplified) example to demonstrate the sort of
situation I mean (contrived in that test for NA is not required for
the case of setdiff).

mapply(function(x, y, z) {
    if(!is.na(y)) x <- setdiff(x, y)
    z[x]
}, x, c(NA, x[-length(x)]), MoreArgs = list(z), SIMPLIFY=F)

where x is a list (and z a vector). One should really make the test
"if(length(y) > 1 && !is.na(y))"... but is there a nicer way?

Thanks again,
Simion



On Tue, Jul 3, 2012 at 8:41 PM, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
> On 12-07-02 10:53 PM, Simon Knapp wrote:

<snip>

>> 4) Is it better to check for arguments that are missing, or use a
>> default value of, say, NA; i.e. is missing(arg) preferable to
>> is.na(arg)?
>
>
> That depends.  It's easier to set an argument to a special value in a call
> from another function than it is to conditionally set it to be missing, but
> there are only a couple of general purpose choices for "missing" values:  NA
> and NULL, and you might want a user to be able to specify those.  (You can
> also use negative values for counts, etc., in particular contexts.)

<snip>

> Duncan Murdoch


From renaud at mancala.cbio.uct.ac.za  Thu Jul  5 10:38:01 2012
From: renaud at mancala.cbio.uct.ac.za (Renaud Gaujoux)
Date: Thu, 05 Jul 2012 10:38:01 +0200
Subject: [Rd] Extracting srcref for S4 methods
Message-ID: <4FF55269.3090005@cbio.uct.ac.za>

Hi,

on R version 2.15.1 (2012-06-22) (Platform: i686-pc-linux-gnu (32-bit)) 
sourced functions have srcref attached as an attribute.
Are such data also available for S4 generics and methods? How? (See 
sample code below)
Thank you.

Bests,
Renaud

f <- textConnection(
"
f <- function(){}

setGeneric('myfun', function(x, ...) standardGeneric('myfun'))

setMethod('myfun', 'numeric', function(x, ...){ 'myfun,numeric' })
")
source(f, keep.source=TRUE)

# there are srcref data for functions
str(f)
# no srcref data
str(myfun)
str(selectMethod(myfun, 'numeric'))

-- 
Renaud Gaujoux
Computational Biology - University of Cape Town
South Africa


From renaud at mancala.cbio.uct.ac.za  Thu Jul  5 17:34:08 2012
From: renaud at mancala.cbio.uct.ac.za (Renaud Gaujoux)
Date: Thu, 05 Jul 2012 17:34:08 +0200
Subject: [Rd] Extracting srcref for S4 methods
Message-ID: <4FF5B3F0.8040701@cbio.uct.ac.za>

Responding to my own question here.
It appears I had overlooked the results from my sample script, as they 
in fact do contain srcref data, but simply do not show them up in str():

f <- textConnection(
"
f <- function(){}

setGeneric('myfun', function(x, ...) standardGeneric('myfun'))

setMethod('myfun', 'numeric', function(x, ...){ 'myfun,numeric' })
")
source(f, keep.source=TRUE)

# there are srcref data for functions
str(f)
# no srcref data
str(attr(myfun, 'srcref'))
str(attr(selectMethod(myfun, 'numeric'), 'srcref'))

So no worries.

Renaud

-- 
Renaud Gaujoux
Computational Biology - University of Cape Town
South Africa


From janko.thyson.rstuff at googlemail.com  Thu Jul  5 18:21:42 2012
From: janko.thyson.rstuff at googlemail.com (Janko Thyson)
Date: Thu, 05 Jul 2012 18:21:42 +0200
Subject: [Rd] Feature request: workaround for 'Sys.timezone()' issue for
 German MS-Windows
Message-ID: <4FF5BF16.9040906@googlemail.com>

Dear list,

I know this is *not* R's but Windows fault, at least for the German 
version. But: `Sys.timezone()' will return with an invalid time zone.

I just wondered if there's a chance to implement an alternative, 
"OS-independent" way for querying the time zone corresponding to the 
country where a specific R session was launched.

I've written a post on SO where I had a go at it, but it involves way to 
many steps: 
http://stackoverflow.com/questions/11347854/retrieve-time-zone-based-on-locale-country-information-in-an-os-independent-wa

It'd be really great if someone could consider addressing this.

Thank you very much,
Janko Thyson


From matt.shotwell at Vanderbilt.Edu  Thu Jul  5 18:40:07 2012
From: matt.shotwell at Vanderbilt.Edu (Shotwell, Matthew Stephen)
Date: Thu, 5 Jul 2012 11:40:07 -0500
Subject: [Rd] typo in src/library/base/man/connections.Rd
Message-ID: <05360D81BEC7394D935D3F2F821B0EF701378613CE@its-hcwnem03.ds.Vanderbilt.edu>

327c327
<   For write-mode connections, \code{compress} specifies now hard the
---
>   For write-mode connections, \code{compress} specifies how hard the


From murdoch.duncan at gmail.com  Thu Jul  5 20:30:49 2012
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Thu, 05 Jul 2012 14:30:49 -0400
Subject: [Rd] typo in src/library/base/man/connections.Rd
In-Reply-To: <05360D81BEC7394D935D3F2F821B0EF701378613CE@its-hcwnem03.ds.Vanderbilt.edu>
References: <05360D81BEC7394D935D3F2F821B0EF701378613CE@its-hcwnem03.ds.Vanderbilt.edu>
Message-ID: <4FF5DD59.5050304@gmail.com>

On 05/07/2012 12:40 PM, Shotwell, Matthew Stephen wrote:
> 327c327
> <   For write-mode connections, \code{compress} specifies now hard the
> ---
> >   For write-mode connections, \code{compress} specifies how hard the
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
Thanks, will fix.

Duncan Murdoch


From jefferis at mrc-lmb.cam.ac.uk  Fri Jul  6 12:57:44 2012
From: jefferis at mrc-lmb.cam.ac.uk (Dr Gregory Jefferis)
Date: Fri, 6 Jul 2012 11:57:44 +0100
Subject: [Rd] depends/suggests when making a new generic to override a
	function in a user package
Message-ID: <B4563F5A-E59B-402E-AEAF-18C2BC3728AA@mrc-lmb.cam.ac.uk>

Dear R developers,

I would like to add a new S3 generic to override a function in a user package, specifically:

	STAR::as.repeatedTrain

I have followed the recommendation here:

	http://cran.r-project.org/doc/manuals/R-exts.html#Adding-new-generics

doing this:

as.repeatedTrain<-function(x,...){
 UseMethod("as.repeatedTrain")
}

as.repeatedTrain.default<-function(x,...) {
 STAR::as.repeatedTrain(x)
}

but the question now arises, how do I make sure that my as.repeatedTrain generic function is used in preference to STAR's. If my package suggests STAR, then STAR will likely be loaded afterwards and my generic will get clobbered. So at the moment I have made my package depend on STAR rather than suggest it. However I will only occasionally use STAR, and it is quite a big package with a number of dependencies and I would prefer to avoid this. Is there another approach? I assume this isn't a problem for a non-generic in a base package because they are loaded first.

Many thanks for any suggestions,

Greg Jefferis.
--
Gregory Jefferis, PhD                      
Division of Neurobiology                   
MRC Laboratory of Molecular Biology,       
Hills Road,                                
Cambridge, CB2 0QH, UK.                    

http://www2.mrc-lmb.cam.ac.uk/group-leaders/h-to-m/g-jefferis
http://www.neuroscience.cam.ac.uk/directory/profile.php?gsxej2
http://flybrain.stanford.edu


From beniltoncarvalho at gmail.com  Sat Jul  7 04:49:34 2012
From: beniltoncarvalho at gmail.com (Benilton Carvalho)
Date: Sat, 7 Jul 2012 03:49:34 +0100
Subject: [Rd] creating a '[' method for an S4 class
Message-ID: <CAO-arWO=1+KAo1utsOjOq8vaaTC1M7bG3yoDPGZh_x_vB5-9tw@mail.gmail.com>

Hi,

I'm working on an S4 class that is expected to behave like an array.

I have some difficulties when defining '[' and I wonder if someone
could point me to the right direction:

1) Call the S4 object "obj"
2) Assume dim(obj) = c(10, 4, 2)
3) Suppose someone calls: obj[1:3,] , which is a mistake, given
dim(obj); how do I detect such situations?

Thank you very much for your attention and time,
benilton


From maechler at stat.math.ethz.ch  Sat Jul  7 10:20:27 2012
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Sat, 7 Jul 2012 10:20:27 +0200
Subject: [Rd] creating a '[' method for an S4 class
In-Reply-To: <CAO-arWO=1+KAo1utsOjOq8vaaTC1M7bG3yoDPGZh_x_vB5-9tw@mail.gmail.com>
References: <CAO-arWO=1+KAo1utsOjOq8vaaTC1M7bG3yoDPGZh_x_vB5-9tw@mail.gmail.com>
Message-ID: <20471.61771.120942.446592@stat.math.ethz.ch>

>>>>> Benilton Carvalho <beniltoncarvalho at gmail.com>
>>>>>     on Sat, 7 Jul 2012 03:49:34 +0100 writes:

    > Hi,

    > I'm working on an S4 class that is expected to behave like an array.

    > I have some difficulties when defining '[' and I wonder if someone
    > could point me to the right direction:

    > 1) Call the S4 object "obj"
    > 2) Assume dim(obj) = c(10, 4, 2)
    > 3) Suppose someone calls: obj[1:3,] , which is a mistake, given
    > dim(obj); how do I detect such situations?

yes, a good question with a tricky answer.
Actually not only relevant for S4,  and hence one of the basic
tricks is already visible in   [.data.frame :
--- you need to use nargs() in addition to others more well
known tools ---

*and* it is trickier than you think:

Not only want you differentiate between  
  obj[ i , ]
and
  obj[ i , , ]

but more importantly,
between
  obj[ i ]
and
  obj[ i , ]
and that's  where nargs() comes into play
(as 'j', the 2nd argument is missing in both cases, you cannot
 use that check alone).

In my CRAN package  Rmpfr  {Interface R <--> MPFR library for
      	   	    	   	      arbitrary precision arithmetic}
I use S4 classes and methods extensively, as two argument
dispatch is the most natural paradigm for arithmetic.
Here is the part (from Rmpfr/R/array.R )
which implements "[" for 'mpfrArray':
{but you probably want the full package in src to understand all
 the details}:

.mpfrA.subset <- function(x,i,j, ..., drop) {
    nA <- nargs()
    if(getOption("verbose"))
        message(sprintf("nargs() == %d  mpfrArray indexing ... ", nA))

    r <- getD(x)# data part of x, a list()
    if(nA == 2) ## A[i]
        return(new("mpfr", r[i]))
    ## else: nA != 2 : nA > 2 -
    dim(r) <- (dx <- dim(x))
    dimnames(r) <- dimnames(x)
    r <- r[i,j, ..., drop=drop]
    if(drop && is.null(dim(r)))
        new("mpfr", r)
    else {
        D <- if(is.null(dr <- dim(r))) # ==> drop is FALSE; can this happen?
            rep.int(1L, length(r)) else dr
        x at Dim <- D
        x at Dimnames <- if(is.null(dn <- dimnames(r)))
            vector("list", length(D)) else dn
	if(length(D) == 2 && class(x) != "mpfrMatrix")
	    ## low-level "coercion" from mpfrArray to *Matrix :
	    attr(x,"class") <- getClass("mpfrMatrix")@className
        attributes(r) <- NULL
        setDataPart(x, r, check=FALSE)
    }
}

## "["
setMethod("[", signature(x = "mpfrArray", i = "ANY", j = "ANY", drop = "ANY"),
          .mpfrA.subset)

## this signature needs a method here, or it triggers the one for "mpfr"
setMethod("[", signature(x = "mpfrArray", i = "ANY", j = "missing",
                         drop = "missing"),
          .mpfrA.subset)




    > Thank you very much for your attention and time,
    > benilton


From murdoch.duncan at gmail.com  Sat Jul  7 14:25:52 2012
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Sat, 07 Jul 2012 08:25:52 -0400
Subject: [Rd] Problem in vignette packaging of Sweave in utils package
In-Reply-To: <CAErODj_9n7cjy5iPkjr-GOocL23hnJwX2QCYSd+4zJfgu0SUpA@mail.gmail.com>
References: <CAErODj_9n7cjy5iPkjr-GOocL23hnJwX2QCYSd+4zJfgu0SUpA@mail.gmail.com>
Message-ID: <4FF82AD0.1020605@gmail.com>

On 12-07-03 1:21 PM, Paul Johnson wrote:
> In ?Sweave, it refers to Sweave User Manual. In the doc folder of
> utils package, I see "Sweave.pdf".
>
> However, I can't find it from within R
>
>
>> vignette("Sweave User Manual")
> Warning message:
> vignette ?Sweave User Manual? not found

Turns out there was a bug in the code to install from tarballs, so base 
package vignettes weren't fully installed.  I've fixed it; installs from 
R-patched or R-devel revisions after 59750 should be okay.

Duncan Murdoch

>
>
>> browseVignettes("utils")
> No vignettes found by browseVignettes("utils")
>
>
>> library(help=utils)
>
> does not refer to any vignettes.
>
> The vignette does not appear in the main page for utils in help.start().
>
> I checked the source code for the Sweave vignette, but I don't see
> anything wrong. It has all of the required elements:
>
> %\VignetteIndexEntry{Sweave User Manual}
> %\VignettePackage{utils}
> %\VignetteDepends{tools}
> %\VignetteDepends{datasets}
> %\VignetteDepends{stats}
>
> Am I accessing it incorrectly, or is there something wrong in my
> install of R-2.15.1?
>
>> sessionInfo()
> R version 2.15.1 (2012-06-22)
> Platform: x86_64-pc-linux-gnu (64-bit)
>
> locale:
>   [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
>   [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
>   [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
>   [7] LC_PAPER=C                 LC_NAME=C
>   [9] LC_ADDRESS=C               LC_TELEPHONE=C
> [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> loaded via a namespace (and not attached):
> [1] tools_2.15.1


From smyth at wehi.EDU.AU  Mon Jul  9 10:03:57 2012
From: smyth at wehi.EDU.AU (Gordon K Smyth)
Date: Mon, 9 Jul 2012 18:03:57 +1000 (AUS Eastern Standard Time)
Subject: [Rd] Using a function from splines.c in our package
Message-ID: <Pine.WNT.4.64.1207091716340.5512@PC765.wehi.edu.au>

Dear all,

I'm writing to ask for advice as to best practice.  A PhD student working 
with me is writing C++ code that we hope to make public as src code in our 
Bioconductor package edgeR.  He wants to call the function fmm_spline, 
which is part of the source code for the stats package

http://svn.r-project.org/R/trunk/src/library/stats/src/splines.c,

from his C++ code.  This function isn't one of the entry points for C code 
documented in Chapter 6 of the "Writing R extensions" manual.

We haven't figured out a way to call the fmm_spline function directly from 
our C++ code.  Is there a way that we have missed?

Can we simply copy the fmm_spline function into our C++ code and declare 
where we got it from?  Should we include the license declaration from the 
header of splines.c?  Anything else we need to do satisfying copyright and 
be good citizens?

Thanks a lot
Gordon

---------------------------------------------
Professor Gordon K Smyth,
Bioinformatics Division,
Walter and Eliza Hall Institute of Medical Research,
1G Royal Parade, Parkville, Vic 3052, Australia.
Tel: (03) 9345 2326, Fax (03) 9347 0852,
http://www.statsci.org/smyth

______________________________________________________________________
The information in this email is confidential and intend...{{dropped:4}}


From ripley at stats.ox.ac.uk  Mon Jul  9 11:45:14 2012
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 9 Jul 2012 10:45:14 +0100 (BST)
Subject: [Rd] Using a function from splines.c in our package
In-Reply-To: <Pine.WNT.4.64.1207091716340.5512@PC765.wehi.edu.au>
References: <Pine.WNT.4.64.1207091716340.5512@PC765.wehi.edu.au>
Message-ID: <alpine.LFD.2.02.1207091037400.22139@gannet.stats.ox.ac.uk>

On Mon, 9 Jul 2012, Gordon K Smyth wrote:

> Dear all,
>
> I'm writing to ask for advice as to best practice.  A PhD student working 
> with me is writing C++ code that we hope to make public as src code in our 
> Bioconductor package edgeR.  He wants to call the function fmm_spline, which 
> is part of the source code for the stats package
>
> http://svn.r-project.org/R/trunk/src/library/stats/src/splines.c,
>
> from his C++ code.  This function isn't one of the entry points for C code 
> documented in Chapter 6 of the "Writing R extensions" manual.

None of those are in a package.

> We haven't figured out a way to call the fmm_spline function directly from 
> our C++ code.  Is there a way that we have missed?

Not a very portable way, but there are some ideas in 'Writing R 
Extensions'.  I don't think they are enough for a CRAN or BioC 
package, though.

> Can we simply copy the fmm_spline function into our C++ code and declare 
> where we got it from?  Should we include the license declaration from the 
> header of splines.c?  Anything else we need to do satisfying copyright and be 
> good citizens?

If your package has a compatible licence, you can (and you must 
include the whole header when you copy).   CRAN's policies say that 
when you copy code from elsewhere you must include that code's authors 
in the Authors field of your package, and that clearly is good 
practice.

> Thanks a lot
> Gordon
>
> ---------------------------------------------
> Professor Gordon K Smyth,
> Bioinformatics Division,
> Walter and Eliza Hall Institute of Medical Research,
> 1G Royal Parade, Parkville, Vic 3052, Australia.
> Tel: (03) 9345 2326, Fax (03) 9347 0852,
> http://www.statsci.org/smyth
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From smyth at wehi.EDU.AU  Tue Jul 10 07:26:29 2012
From: smyth at wehi.EDU.AU (Gordon K Smyth)
Date: Tue, 10 Jul 2012 15:26:29 +1000 (AUS Eastern Standard Time)
Subject: [Rd] Using a function from splines.c in our package
In-Reply-To: <alpine.LFD.2.02.1207091037400.22139@gannet.stats.ox.ac.uk>
References: <Pine.WNT.4.64.1207091716340.5512@PC765.wehi.edu.au>
	<alpine.LFD.2.02.1207091037400.22139@gannet.stats.ox.ac.uk>
Message-ID: <Pine.WNT.4.64.1207101511530.416@PC765.wehi.edu.au>

Thanks.  Our package has LGPL (>= 2) licence, so we'll copy with header 
and proper acknowledgements.

Gordon

On Mon, 9 Jul 2012, Prof Brian Ripley wrote:

> On Mon, 9 Jul 2012, Gordon K Smyth wrote:
>
>> Dear all,
>> 
>> I'm writing to ask for advice as to best practice.  A PhD student working 
>> with me is writing C++ code that we hope to make public as src code in our 
>> Bioconductor package edgeR.  He wants to call the function fmm_spline, 
>> which is part of the source code for the stats package
>> 
>> http://svn.r-project.org/R/trunk/src/library/stats/src/splines.c,
>> 
>> from his C++ code.  This function isn't one of the entry points for C code 
>> documented in Chapter 6 of the "Writing R extensions" manual.
>
> None of those are in a package.
>
>> We haven't figured out a way to call the fmm_spline function directly from 
>> our C++ code.  Is there a way that we have missed?
>
> Not a very portable way, but there are some ideas in 'Writing R Extensions'. 
> I don't think they are enough for a CRAN or BioC package, though.
>
>> Can we simply copy the fmm_spline function into our C++ code and declare 
>> where we got it from?  Should we include the license declaration from the 
>> header of splines.c?  Anything else we need to do satisfying copyright and 
>> be good citizens?
>
> If your package has a compatible licence, you can (and you must include the 
> whole header when you copy).   CRAN's policies say that when you copy code 
> from elsewhere you must include that code's authors in the Authors field of 
> your package, and that clearly is good practice.
>
>> Thanks a lot
>> Gordon
>> 
>> ---------------------------------------------
>> Professor Gordon K Smyth,
>> Bioinformatics Division,
>> Walter and Eliza Hall Institute of Medical Research,
>> 1G Royal Parade, Parkville, Vic 3052, Australia.
>> Tel: (03) 9345 2326, Fax (03) 9347 0852,
>> http://www.statsci.org/smyth
>> 
>
> -- 
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>

______________________________________________________________________
The information in this email is confidential and intend...{{dropped:4}}


From winstonchang1 at gmail.com  Tue Jul 10 23:17:21 2012
From: winstonchang1 at gmail.com (Winston Chang)
Date: Tue, 10 Jul 2012 16:17:21 -0500
Subject: [Rd] Negative years with strptime?
Message-ID: <CAFOpNVELg1wRzcR3SSmeGZ6+W5pCmJiRGWqQ2_ZGMJd0RRy+Ug@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20120710/7fab03aa/attachment.pl>

From ruipbarradas at sapo.pt  Tue Jul 10 23:59:11 2012
From: ruipbarradas at sapo.pt (Rui Barradas)
Date: Tue, 10 Jul 2012 22:59:11 +0100
Subject: [Rd] Negative years with strptime?
In-Reply-To: <CAFOpNVELg1wRzcR3SSmeGZ6+W5pCmJiRGWqQ2_ZGMJd0RRy+Ug@mail.gmail.com>
References: <CAFOpNVELg1wRzcR3SSmeGZ6+W5pCmJiRGWqQ2_ZGMJd0RRy+Ug@mail.gmail.com>
Message-ID: <4FFCA5AF.7050406@sapo.pt>

Hello,

Is there a bug with negative dates? Just see:

seq(as.Date("0000-01-01"), length = 22, by = "-1 year")
  [1] "0000-01-01" "000/-01-01" "000.-01-01" "000--01-01" "000,-01-01"
  [6] "000+-01-01" "000*-01-01" "000)-01-01" "000(-01-01" "000'-01-01"
[11] "00/0-01-01" "00//-01-01" "00/.-01-01" "00/--01-01" "00/,-01-01"
[16] "00/+-01-01" "00/*-01-01" "00/)-01-01" "00/(-01-01" "00/'-01-01"
[21] "00.0-01-01" "00./-01-01"

See the year number: "after" the zero, i.e., downward from zero, the 
printed character is '/' which happens to be the ascii character before 
'0', and before it's '.', etc. This sequence gives the nine ascii 
characters before zero as last digit of the year, then the 10th is '0' 
as (now) expected, then goes to the second digit, etc.

It seems to stop at the first 9, or else we would have some sort of real 
problem.

Anyway, this doesn't look right.

Rui Barradas
Em 10-07-2012 22:17, Winston Chang escreveu:
> Is there a way to make as.Date() and strptime() process strings with
> negative years? It appears that Date objects can contain negative years and
> you can convert them to strings, but you can't convert them back to Date
> objects.
>
>
> x <- as.Date(c("0001-01-24", "0500-01-24"))
> as.character(x)
> # "0001-01-24" "0500-02-02"
> as.Date(as.character(x))
> # "0001-01-24" "0500-01-24"
>
> # Minus 391 days gives negative year
> as.character(x - 391)
> # "-001-12-30" "0498-12-29"
>
> # Can't convert this string back to Date
> as.Date(as.character(x - 391))
> # Error during wrapup: character string is not in a standard unambiguous
> format
>
>
> # as.Date.character uses strptime, so we can try using strptime directly
> strptime(as.character(x), "%Y-%m-%d")
> # "0001-01-24" "0500-01-24"
>
> strptime(as.character(x - 391), "%Y-%m-%d")
> # NA           "0498-12-29"
>
>
> Thanks,
> -Winston
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From jeffrey.ryan at lemnica.com  Wed Jul 11 00:53:25 2012
From: jeffrey.ryan at lemnica.com (Jeffrey Ryan)
Date: Tue, 10 Jul 2012 17:53:25 -0500
Subject: [Rd] Negative years with strptime?
In-Reply-To: <4FFCA5AF.7050406@sapo.pt>
References: <CAFOpNVELg1wRzcR3SSmeGZ6+W5pCmJiRGWqQ2_ZGMJd0RRy+Ug@mail.gmail.com>
	<4FFCA5AF.7050406@sapo.pt>
Message-ID: <CABDUZc82j-Jw-pVWFCYpaV0y4wGz=RPaZ1vYU1_0n716WRiNYw@mail.gmail.com>

?as.Date

Why would pre 0000 years be handled correctly?  The help file
explicitly states that they likely will not.


Note:

     The default formats follow the rules of the ISO 8601 international
     standard which expresses a day as ?"2001-02-03"?.

     If the date string does not specify the date completely, the
     returned answer may be system-specific.  The most common behaviour
     is to assume that a missing year, month or day is the current one.
     If it specifies a date incorrectly, reliable implementations will
     give an error and the date is reported as ?NA?.  Unfortunately
     some common implementations (such as ?glibc?) are unreliable and
     guess at the intended meaning.

     Years before 1CE (aka 1AD) will probably not be handled correctly.



On Tue, Jul 10, 2012 at 4:59 PM, Rui Barradas <ruipbarradas at sapo.pt> wrote:
> Hello,
>
> Is there a bug with negative dates? Just see:
>
> seq(as.Date("0000-01-01"), length = 22, by = "-1 year")
>  [1] "0000-01-01" "000/-01-01" "000.-01-01" "000--01-01" "000,-01-01"
>  [6] "000+-01-01" "000*-01-01" "000)-01-01" "000(-01-01" "000'-01-01"
> [11] "00/0-01-01" "00//-01-01" "00/.-01-01" "00/--01-01" "00/,-01-01"
> [16] "00/+-01-01" "00/*-01-01" "00/)-01-01" "00/(-01-01" "00/'-01-01"
> [21] "00.0-01-01" "00./-01-01"
>
> See the year number: "after" the zero, i.e., downward from zero, the printed
> character is '/' which happens to be the ascii character before '0', and
> before it's '.', etc. This sequence gives the nine ascii characters before
> zero as last digit of the year, then the 10th is '0' as (now) expected, then
> goes to the second digit, etc.
>
> It seems to stop at the first 9, or else we would have some sort of real
> problem.
>
> Anyway, this doesn't look right.
>
> Rui Barradas
> Em 10-07-2012 22:17, Winston Chang escreveu:
>
>> Is there a way to make as.Date() and strptime() process strings with
>> negative years? It appears that Date objects can contain negative years
>> and
>> you can convert them to strings, but you can't convert them back to Date
>> objects.
>>
>>
>> x <- as.Date(c("0001-01-24", "0500-01-24"))
>> as.character(x)
>> # "0001-01-24" "0500-02-02"
>> as.Date(as.character(x))
>> # "0001-01-24" "0500-01-24"
>>
>> # Minus 391 days gives negative year
>> as.character(x - 391)
>> # "-001-12-30" "0498-12-29"
>>
>> # Can't convert this string back to Date
>> as.Date(as.character(x - 391))
>> # Error during wrapup: character string is not in a standard unambiguous
>> format
>>
>>
>> # as.Date.character uses strptime, so we can try using strptime directly
>> strptime(as.character(x), "%Y-%m-%d")
>> # "0001-01-24" "0500-01-24"
>>
>> strptime(as.character(x - 391), "%Y-%m-%d")
>> # NA           "0498-12-29"
>>
>>
>> Thanks,
>> -Winston
>>
>>         [[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel



-- 
Jeffrey Ryan
jeffrey.ryan at lemnica.com

www.lemnica.com
www.esotericR.com


From winstonchang1 at gmail.com  Wed Jul 11 03:05:14 2012
From: winstonchang1 at gmail.com (Winston Chang)
Date: Tue, 10 Jul 2012 20:05:14 -0500
Subject: [Rd] Negative years with strptime?
In-Reply-To: <4FFCA5AF.7050406@sapo.pt>
References: <CAFOpNVELg1wRzcR3SSmeGZ6+W5pCmJiRGWqQ2_ZGMJd0RRy+Ug@mail.gmail.com>
	<4FFCA5AF.7050406@sapo.pt>
Message-ID: <CAFOpNVHT-s26aEQ1+C=1m_AzTv+VDUy9qBR0CGqDM9x=XmqN2A@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20120710/07992d95/attachment.pl>

From ruipbarradas at sapo.pt  Wed Jul 11 06:23:44 2012
From: ruipbarradas at sapo.pt (Rui Barradas)
Date: Wed, 11 Jul 2012 05:23:44 +0100
Subject: [Rd] Negative years with strptime?
In-Reply-To: <CAFOpNVHT-s26aEQ1+C=1m_AzTv+VDUy9qBR0CGqDM9x=XmqN2A@mail.gmail.com>
References: <CAFOpNVELg1wRzcR3SSmeGZ6+W5pCmJiRGWqQ2_ZGMJd0RRy+Ug@mail.gmail.com>
	<4FFCA5AF.7050406@sapo.pt>
	<CAFOpNVHT-s26aEQ1+C=1m_AzTv+VDUy9qBR0CGqDM9x=XmqN2A@mail.gmail.com>
Message-ID: <4FFCFFD0.1000306@sapo.pt>

On my earlier post I forgot to mention the sessionInfo()

R version 2.15.0 (2012-03-30)
Platform: i386-pc-mingw32/i386 (32-bit)

locale:
[1] LC_COLLATE=Portuguese_Portugal.1252 
LC_CTYPE=Portuguese_Portugal.1252
[3] LC_MONETARY=Portuguese_Portugal.1252 LC_NUMERIC=C 

[5] LC_TIME=Portuguese_Portugal.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

Rui Barradas

Em 11-07-2012 02:05, Winston Chang escreveu:
> It looks different on my system (Mac, R 2.15.1)
>
> seq(as.Date("0000-01-01"), length = 22, by = "-1 year")
>   [1] "0000-01-01" "-001-01-01" "-002-01-01" "-003-01-01" "-004-01-01"
>   [6] "-005-01-01" "-006-01-01" "-007-01-01" "-008-01-01" "-009-01-01"
> [11] "-010-01-01" "-011-01-01" "-012-01-01" "-013-01-01" "-014-01-01"
> [16] "-015-01-01" "-016-01-01" "-017-01-01" "-018-01-01" "-019-01-01"
> [21] "-020-01-01" "-021-01-01"
>
> So in addition to the issues with converting a negative-year string to a
> Date, it looks like converting a negative date to a string with
> as.character.Date() is probably also not consistent.
>
> It certainly would be useful to have a way of handling dates with
> negative years.
>
> -Winston
>
>
> On Tue, Jul 10, 2012 at 4:59 PM, Rui Barradas <ruipbarradas at sapo.pt
> <mailto:ruipbarradas at sapo.pt>> wrote:
>
>     Hello,
>
>     Is there a bug with negative dates? Just see:
>
>     seq(as.Date("0000-01-01"), length = 22, by = "-1 year")
>       [1] "0000-01-01" "000/-01-01" "000.-01-01" "000--01-01" "000,-01-01"
>       [6] "000+-01-01" "000*-01-01" "000)-01-01" "000(-01-01" "000'-01-01"
>     [11] "00/0-01-01" "00//-01-01" "00/.-01-01" "00/--01-01" "00/,-01-01"
>     [16] "00/+-01-01" "00/*-01-01" "00/)-01-01" "00/(-01-01" "00/'-01-01"
>     [21] "00.0-01-01" "00./-01-01"
>
>     See the year number: "after" the zero, i.e., downward from zero, the
>     printed character is '/' which happens to be the ascii character
>     before '0', and before it's '.', etc. This sequence gives the nine
>     ascii characters before zero as last digit of the year, then the
>     10th is '0' as (now) expected, then goes to the second digit, etc.
>
>     It seems to stop at the first 9, or else we would have some sort of
>     real problem.
>
>     Anyway, this doesn't look right.
>
>     Rui Barradas
>     Em 10-07-2012 22:17, Winston Chang escreveu:
>
>         Is there a way to make as.Date() and strptime() process strings with
>         negative years? It appears that Date objects can contain
>         negative years and
>         you can convert them to strings, but you can't convert them back
>         to Date
>         objects.
>
>
>         x <- as.Date(c("0001-01-24", "0500-01-24"))
>         as.character(x)
>         # "0001-01-24" "0500-02-02"
>         as.Date(as.character(x))
>         # "0001-01-24" "0500-01-24"
>
>         # Minus 391 days gives negative year
>         as.character(x - 391)
>         # "-001-12-30" "0498-12-29"
>
>         # Can't convert this string back to Date
>         as.Date(as.character(x - 391))
>         # Error during wrapup: character string is not in a standard
>         unambiguous
>         format
>
>
>         # as.Date.character uses strptime, so we can try using strptime
>         directly
>         strptime(as.character(x), "%Y-%m-%d")
>         # "0001-01-24" "0500-01-24"
>
>         strptime(as.character(x - 391), "%Y-%m-%d")
>         # NA           "0498-12-29"
>
>
>         Thanks,
>         -Winston
>
>                  [[alternative HTML version deleted]]
>
>         ________________________________________________
>         R-devel at r-project.org <mailto:R-devel at r-project.org> mailing list
>         https://stat.ethz.ch/mailman/__listinfo/r-devel
>         <https://stat.ethz.ch/mailman/listinfo/r-devel>
>
>
>


From ripley at stats.ox.ac.uk  Wed Jul 11 17:15:01 2012
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 11 Jul 2012 16:15:01 +0100
Subject: [Rd] Suggestion / patch to support more Unicode characters in R
 CMD Rd2pdf
In-Reply-To: <4FF4AF36.40605@aalto.fi>
References: <4FF4AF36.40605@aalto.fi>
Message-ID: <4FFD9875.3010709@stats.ox.ac.uk>

On 04/07/2012 22:01, Mikko Korpela wrote:
> Hi list,
>
> When using R CMD Rd2pdf, it is possible to set environment variable
> RD2PDF_INPUTENC to value "inputenx" and enjoy better support for UTF-8
> characters (see ?Rd2pdf). This enables LaTeX package "inputenx" instead
> of "inputenc".
>
> Even better support for UTF-8 encoded characters can be had by better
> using the facilities provided by inputenx and making R CMD Rd2pdf insert
> a line to its temporary .tex file: "\input{ix-utf8enc.dfu}". The
> instructions are found in section 1.2 "Unicode" of the inputenx manual:
> http://mirror.ctan.org/macros/latex/contrib/oberdiek/inputenx.pdf
>
> I suggest that R CMD Rd2pdf automatically insert
> "\input{ix-utf8enc.dfu}" to its temporary .tex file when a combination
> of inputenx and UTF-8 is detected. The attached small patch does that.
>
> A demo package is also attached (tarball built manually, not R CMD
> build). It uses some UTF-8 characters not supported without the patch: R
> CMD Rd2pdf gives an error, propagated from LaTeX. With the patch
> installed, R CMD Rd2pdf works OK when RD2PDF_INPUTENC=inputenx is set.
> For testing, unpack tarball and run R CMD Rd2pdf on the resulting
> directory. Tested on R development version r59731 running on Ubuntu
> 10.10 64 bit.
>

Thank you for the suggestion.  My concern is that an installation could 
have inputenx but not ix-utf8enc.dfu.  You can check for that at LaTeX 
level by \IFfileExists, as we already do for t2anenc.def.  Could you 
please modify your patch to do so.

And it is easiest if this is filed on bugs.r-project.org as a 'Wishlist' 
item: see the R FAQ.


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From hadley at rice.edu  Thu Jul 12 18:15:06 2012
From: hadley at rice.edu (Hadley Wickham)
Date: Thu, 12 Jul 2012 09:15:06 -0700
Subject: [Rd] Understanding tracemem
Message-ID: <CABdHhvFfhO-FCa94FE7Tm1qrd1fp7y72Zq-rHN8_84rDig__NQ@mail.gmail.com>

Hi all,

I've been trying to get a better handle on what manipulations lead R
to duplicate a vector, creating small experiments and using tracemem
to observe what happens (all in 2.15.1). That's lead me to a few
questions, illustrated using the snippet below.

x <- 1:10
tracemem(x)
# [1] "<0x1058f8238>"
x[5] <- 5
# tracemem[0x1058f8238 -> 0x105994ab0]:
x[11] <- 11

Why does x[5] <- 5 create a copy, when x[11] (which should be
extending a vector does not) ?  I can understand that maybe x[5] <- 5
hasn't yet been optimised to not make a copy, but if that's the case
then why doesn't x[11] <- 11 make one? I thought it might be because
somehow tracemem loses track, but adding an additional tracemem(x)
after x[5] <- 5 doesn't change the output.

Hadley

-- 
Assistant Professor / Dobelman Family Junior Chair
Department of Statistics / Rice University
http://had.co.nz/


From mdowle at mdowle.plus.com  Thu Jul 12 18:54:39 2012
From: mdowle at mdowle.plus.com (Matthew Dowle)
Date: Thu, 12 Jul 2012 16:54:39 +0000
Subject: [Rd] Understanding tracemem
References: <CABdHhvFfhO-FCa94FE7Tm1qrd1fp7y72Zq-rHN8_84rDig@mail.gmail.com>
Message-ID: <loom.20120712T185107-931@post.gmane.org>

Hadley Wickham <hadley <at> rice.edu> writes:

> Why does x[5] <- 5 create a copy

That assigns 5 not 5L. x is being coerced from integer to double.

x[5] <- 5L doesn't copy.

> , when x[11] (which should be
> extending a vector does not) ?  I can understand that maybe x[5] <- 5
> hasn't yet been optimised to not make a copy, but if that's the case
> then why doesn't x[11] <- 11 make one?

Extending a vector is creating a new (longer) vector and copying the old 
(shorter) one in.  That's different to duplicate().  tracemem only reports 
calls to duplicate().

Matthew


From ripley at stats.ox.ac.uk  Thu Jul 12 19:01:40 2012
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 12 Jul 2012 18:01:40 +0100
Subject: [Rd] Understanding tracemem
In-Reply-To: <CABdHhvFfhO-FCa94FE7Tm1qrd1fp7y72Zq-rHN8_84rDig__NQ@mail.gmail.com>
References: <CABdHhvFfhO-FCa94FE7Tm1qrd1fp7y72Zq-rHN8_84rDig__NQ@mail.gmail.com>
Message-ID: <4FFF02F4.4050400@stats.ox.ac.uk>

Read the help carefully as to what 'copy' means:

      When an object is traced any copying of the object by the C
      function ?duplicate? produces a message to standard output, as
      does type coercion and copying when passing arguments to ?.C? or
      ?.Fortran?.

If you want to understand when 'duplicate' is called, you need to read 
the source code.  File src/main/subassign.c will explain the different 
paths taken by your two cases.  But isn't it rather obvious that 
duplicating x is not useful when a new longer vector needs to be created?

(BTW, in earlier versions of R tracemem reported some transformations of 
x to objects of the same length, but not at all consistently.]

On 12/07/2012 17:15, Hadley Wickham wrote:
> Hi all,
>
> I've been trying to get a better handle on what manipulations lead R
> to duplicate a vector, creating small experiments and using tracemem
> to observe what happens (all in 2.15.1). That's lead me to a few
> questions, illustrated using the snippet below.
>
> x <- 1:10
> tracemem(x)
> # [1] "<0x1058f8238>"
> x[5] <- 5
> # tracemem[0x1058f8238 -> 0x105994ab0]:
> x[11] <- 11
>
> Why does x[5] <- 5 create a copy, when x[11] (which should be
> extending a vector does not) ?  I can understand that maybe x[5] <- 5
> hasn't yet been optimised to not make a copy, but if that's the case
> then why doesn't x[11] <- 11 make one? I thought it might be because
> somehow tracemem loses track, but adding an additional tracemem(x)
> after x[5] <- 5 doesn't change the output.
>
> Hadley
>


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From hadley at rice.edu  Thu Jul 12 19:20:56 2012
From: hadley at rice.edu (Hadley Wickham)
Date: Thu, 12 Jul 2012 10:20:56 -0700
Subject: [Rd] Understanding tracemem
In-Reply-To: <4FFF02F4.4050400@stats.ox.ac.uk>
References: <CABdHhvFfhO-FCa94FE7Tm1qrd1fp7y72Zq-rHN8_84rDig__NQ@mail.gmail.com>
	<4FFF02F4.4050400@stats.ox.ac.uk>
Message-ID: <CABdHhvHDxJWD3OLyYb2HLQPKSbVrA=gg0hk50SMksBVMVgwLdA@mail.gmail.com>

> Read the help carefully as to what 'copy' means:
>
>      When an object is traced any copying of the object by the C
>      function ?duplicate? produces a message to standard output, as
>      does type coercion and copying when passing arguments to ?.C? or
>      ?.Fortran?.
>
> If you want to understand when 'duplicate' is called, you need to read the
> source code.  File src/main/subassign.c will explain the different paths
> taken by your two cases.  But isn't it rather obvious that duplicating x is
> not useful when a new longer vector needs to be created?

Thanks, that's useful.

Is there any way to detect when a new longer vector is created?  i.e.
I know that this creates a new vector:

x <- 1:10
x[11] <- 11L

And this doesn't

y <- list2env(as.list(x))
y$a <- 11

But does this?

z <- as.list(x)
z$a <- 11

And thanks to the off-list commenters who pointed out that x[5] <- 5
is duplicated because 5 is numeric, not integer (oops!)

Hadley

-- 
Assistant Professor / Dobelman Family Junior Chair
Department of Statistics / Rice University
http://had.co.nz/


From ripley at stats.ox.ac.uk  Thu Jul 12 19:33:59 2012
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 12 Jul 2012 18:33:59 +0100
Subject: [Rd] Understanding tracemem
In-Reply-To: <CABdHhvHDxJWD3OLyYb2HLQPKSbVrA=gg0hk50SMksBVMVgwLdA@mail.gmail.com>
References: <CABdHhvFfhO-FCa94FE7Tm1qrd1fp7y72Zq-rHN8_84rDig__NQ@mail.gmail.com>
	<4FFF02F4.4050400@stats.ox.ac.uk>
	<CABdHhvHDxJWD3OLyYb2HLQPKSbVrA=gg0hk50SMksBVMVgwLdA@mail.gmail.com>
Message-ID: <4FFF0A87.9030001@stats.ox.ac.uk>

On 12/07/2012 18:20, Hadley Wickham wrote:
>> Read the help carefully as to what 'copy' means:
>>
>>       When an object is traced any copying of the object by the C
>>       function ?duplicate? produces a message to standard output, as
>>       does type coercion and copying when passing arguments to ?.C? or
>>       ?.Fortran?.
>>
>> If you want to understand when 'duplicate' is called, you need to read the
>> source code.  File src/main/subassign.c will explain the different paths
>> taken by your two cases.  But isn't it rather obvious that duplicating x is
>> not useful when a new longer vector needs to be created?
>
> Thanks, that's useful.
>
> Is there any way to detect when a new longer vector is created?  i.e.
> I know that this creates a new vector:

Not programmatically.

> x <- 1:10
> x[11] <- 11L
>
> And this doesn't
>
> y <- list2env(as.list(x))
> y$a <- 11
>
> But does this?
>
> z <- as.list(x)
> z$a <- 11

Yes of course, as z is now of length 11.  There is no provision in R to 
extend a vector except by creating a new one.  (Well, there is at C 
level but I think it is not currently used.)

> And thanks to the off-list commenters who pointed out that x[5] <- 5
> is duplicated because 5 is numeric, not integer (oops!)

AFAIK, it does not actually duplicate: see 'type coercion' above.  But 
note that

x <- 1:10
tracemem(x)
x[10:1] <- x

necessarily duplicates.

>
> Hadley
>


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From hadley at rice.edu  Thu Jul 12 19:46:42 2012
From: hadley at rice.edu (Hadley Wickham)
Date: Thu, 12 Jul 2012 10:46:42 -0700
Subject: [Rd] Understanding tracemem
In-Reply-To: <4FFF0A87.9030001@stats.ox.ac.uk>
References: <CABdHhvFfhO-FCa94FE7Tm1qrd1fp7y72Zq-rHN8_84rDig__NQ@mail.gmail.com>
	<4FFF02F4.4050400@stats.ox.ac.uk>
	<CABdHhvHDxJWD3OLyYb2HLQPKSbVrA=gg0hk50SMksBVMVgwLdA@mail.gmail.com>
	<4FFF0A87.9030001@stats.ox.ac.uk>
Message-ID: <CABdHhvHnS1zxORys7s2v1TB45qUjhkHxHqJ5COvRvGG+enyLkw@mail.gmail.com>

>> But does this?
>>
>> z <- as.list(x)
>> z$a <- 11
>
> Yes of course, as z is now of length 11.  There is no provision in R to
> extend a vector except by creating a new one.  (Well, there is at C level
> but I think it is not currently used.)

I guess a better example is

z <- list(a = 1:1e6, b = runif(1e6))
z$c <- 1

The list gets copied, but do a and b, or does the new list point to
the existing locations?  The following test suggests that it's a deep
copy.

x <- 1:1e7
z <- list(a = x)

system.time(replicate(100, z$b <- 1L)) / 100
# ~ 0.05s
system.time(replicate(100, x[1e6 + 1L] <- 1L)) / 100
# ~ 0.04s

Hadley


-- 
Assistant Professor / Dobelman Family Junior Chair
Department of Statistics / Rice University
http://had.co.nz/


From hadley at rice.edu  Thu Jul 12 19:49:50 2012
From: hadley at rice.edu (Hadley Wickham)
Date: Thu, 12 Jul 2012 10:49:50 -0700
Subject: [Rd] Understanding tracemem
In-Reply-To: <CABdHhvHnS1zxORys7s2v1TB45qUjhkHxHqJ5COvRvGG+enyLkw@mail.gmail.com>
References: <CABdHhvFfhO-FCa94FE7Tm1qrd1fp7y72Zq-rHN8_84rDig__NQ@mail.gmail.com>
	<4FFF02F4.4050400@stats.ox.ac.uk>
	<CABdHhvHDxJWD3OLyYb2HLQPKSbVrA=gg0hk50SMksBVMVgwLdA@mail.gmail.com>
	<4FFF0A87.9030001@stats.ox.ac.uk>
	<CABdHhvHnS1zxORys7s2v1TB45qUjhkHxHqJ5COvRvGG+enyLkw@mail.gmail.com>
Message-ID: <CABdHhvETccpo28Oa1Bab0gpMQA_QJKTfvbe6jiHFh4TDdJY4Zg@mail.gmail.com>

> The list gets copied, but do a and b, or does the new list point to
> the existing locations?  The following test suggests that it's a deep
> copy.
>
> x <- 1:1e7
> z <- list(a = x)
>
> system.time(replicate(100, z$b <- 1L)) / 100
> # ~ 0.05s
> system.time(replicate(100, x[1e6 + 1L] <- 1L)) / 100
> # ~ 0.04s

But that should be

system.time(replicate(100, x[1e7 + 1L] <- 1L)) / 100
# ~0.10s
system.time(replicate(100, z$b <- 1L)) / 100
# ~ 0.04s

which suggests that it's not a deep copy.

But

x <- 1:1e6
z <- list(a = x)
system.time(replicate(100, z$b <- 1L)) / 100
# ~0.005s

which suggests it's not a shallow copy either.


But then neither of those are probably good tests because they modify
in place.  I'll think more.

Hadley

-- 
Assistant Professor / Dobelman Family Junior Chair
Department of Statistics / Rice University
http://had.co.nz/


From hadley at rice.edu  Thu Jul 12 22:54:39 2012
From: hadley at rice.edu (Hadley Wickham)
Date: Thu, 12 Jul 2012 13:54:39 -0700
Subject: [Rd] Modifying a list: what gets copied?
Message-ID: <CABdHhvFEwzO5s3vmGbmEKNMKSY3vTOkUXXcn1SdTYkrpHimHxg@mail.gmail.com>

Hi all,

In my continued effort to understand when and what R copies, I've
designed a small experiment to try and figure out what goes on when a
list gets copied - is it a shallow copy or a deep copy. I believe the
following experiment isolates the difference:

options(digits = 2)
powers <- 4:6
n <- setNames(10 ^ powers, paste0("e", powers))
xs <- lapply(n, seq_len)
zs <- lapply(xs, list)

vector_u <- function(x) x[length(x) + 1L] <- 1L
list_u <- function(x) z$a <- 1L

library(microbenchmark)
microbenchmark(
  vector_u(xs$e4),
  vector_u(xs$e5),
  vector_u(xs$e6),
  list_u(zs$e4),
  list_u(zs$e5),
  list_u(zs$e6)
)

On my computer, I get

Unit: microseconds
             expr    min     lq median     uq    max
1   list_u(zs$e4)  122.0  147.8  283.0  456.5    814
2   list_u(zs$e5)  118.1  158.0  287.6  453.3  12257
3   list_u(zs$e6)  119.8  153.3  299.8  458.8  13701
4 vector_u(xs$e4)   33.5   40.5   52.2   65.4    101
5 vector_u(xs$e5)  253.9  407.7  584.6  955.6   8347
6 vector_u(xs$e6) 4579.5 5511.5 7923.6 9956.1 109075

So the time it takes to modify that vector grows with the size of the
vector (approximately linearly), while the time to modify the list is
constant.  This suggests that the list doesn't make a deep copy, but
the overhead for modifying a list is considerably higher than
modifying a list (roughly equivalent to copying a integer vector of
50,000 elements)

To make sure it wasn't just the way I was modifying the list, I tried
a few alternatives:

list_u2 <- function(x) z[[2]] <- 1L
list_u3 <- function(x) z[["a"]] <- 1L
list_u4 <- function(x) z[1] <- list(1L)

microbenchmark(
  list_u(zs$e4),
  list_u2(zs$e4),
  list_u3(zs$e4),
  list_u4(zs$e4)
)

Unit: microseconds
            expr min  lq median  uq   max
1  list_u(zs$e4) 125 430    447 471   677
2 list_u2(zs$e4) 120 424    447 466 14182
3 list_u3(zs$e4) 118 426    443 459 14075
4 list_u4(zs$e4) 123 435    457 482 13937

i.e. they're basically equivalent.

Are lists really that slow to modify?  Another experiment (not shown)
implies that the time to modify a list is independent of the number of
elements in that list (at least between 1 and 1e6).

What have I missed?

Any feedback would be much appreciated.  Thanks!

Hadley

-- 
Assistant Professor / Dobelman Family Junior Chair
Department of Statistics / Rice University
http://had.co.nz/


From takahashi.kohske at gmail.com  Sat Jul 14 03:23:50 2012
From: takahashi.kohske at gmail.com (Kohske Takahashi)
Date: Sat, 14 Jul 2012 10:23:50 +0900
Subject: [Rd] Modifying a list: what gets copied?
In-Reply-To: <CABdHhvFEwzO5s3vmGbmEKNMKSY3vTOkUXXcn1SdTYkrpHimHxg@mail.gmail.com>
References: <CABdHhvFEwzO5s3vmGbmEKNMKSY3vTOkUXXcn1SdTYkrpHimHxg@mail.gmail.com>
Message-ID: <CAC-jPZqNn_Stnj=YYzr1pveDp-WwtdQVxZQtd=Y5z8axwJn8bQ@mail.gmail.com>

> list_u <- function(x) z$a <- 1L

Note that the argument name is `x` while you are using `z` inside the function.
I'm not sure if this is the reason, though.

kohske

-- 
Kohske Takahashi <takahashi.kohske at gmail.com>

Assistant Professor,
Research Center for Advanced Science and Technology,
The University of  Tokyo, Japan.
http://www.fennel.rcast.u-tokyo.ac.jp/profilee_ktakahashi.html


From spencer.graves at prodsyse.com  Sun Jul 15 00:53:39 2012
From: spencer.graves at prodsyse.com (Spencer Graves)
Date: Sat, 14 Jul 2012 15:53:39 -0700
Subject: [Rd] extractAIC.nls
Message-ID: <5001F873.7020103@prodsyse.com>

Hello:


       Does "extractAIC.nls" exist anywhere?  If no, is there some 
reason it should not be used?


       I'm planning to add it to the fda package, but before I do, I 
felt a need to ask if there is some reason I shouldn't or if there are 
caveats I should include in the help page for it.


       Thanks,
       Spencer


From ggrothendieck at gmail.com  Sun Jul 15 01:11:33 2012
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sat, 14 Jul 2012 19:11:33 -0400
Subject: [Rd] extractAIC.nls
In-Reply-To: <5001F873.7020103@prodsyse.com>
References: <5001F873.7020103@prodsyse.com>
Message-ID: <CAP01uR=kLO7gtKcGAO8XO6_eaRLv42YzywHx6=j73ceeeAScZQ@mail.gmail.com>

On Sat, Jul 14, 2012 at 6:53 PM, Spencer Graves
<spencer.graves at prodsyse.com> wrote:
> Hello:
>
>
>       Does "extractAIC.nls" exist anywhere?  If no, is there some reason it
> should not be used?
>
>
>       I'm planning to add it to the fda package, but before I do, I felt a
> need to ask if there is some reason I shouldn't or if there are caveats I
> should include in the help page for it.
>

AIC in stats works on nls objects. It calls AIC.default which calls logLik.nls .

-- 
Statistics & Software Consulting
GKX Group, GKX Associates Inc.
tel: 1-877-GKX-GROUP
email: ggrothendieck at gmail.com


From spencer.graves at prodsyse.com  Sun Jul 15 02:48:10 2012
From: spencer.graves at prodsyse.com (Spencer Graves)
Date: Sat, 14 Jul 2012 17:48:10 -0700
Subject: [Rd] extractAIC.nls
In-Reply-To: <CAP01uR=kLO7gtKcGAO8XO6_eaRLv42YzywHx6=j73ceeeAScZQ@mail.gmail.com>
References: <5001F873.7020103@prodsyse.com>
	<CAP01uR=kLO7gtKcGAO8XO6_eaRLv42YzywHx6=j73ceeeAScZQ@mail.gmail.com>
Message-ID: <5002134A.7070604@prodsyse.com>

On 7/14/2012 4:11 PM, Gabor Grothendieck wrote:
> On Sat, Jul 14, 2012 at 6:53 PM, Spencer Graves
> <spencer.graves at prodsyse.com> wrote:
>> Hello:
>>
>>
>>        Does "extractAIC.nls" exist anywhere?  If no, is there some reason it
>> should not be used?
>>
>>
>>        I'm planning to add it to the fda package, but before I do, I felt a
>> need to ask if there is some reason I shouldn't or if there are caveats I
>> should include in the help page for it.
>>
> AIC in stats works on nls objects. It calls AIC.default which calls logLik.nls .


       Thanks for the reply.  Unfortunately, it fails for me in the 
following modification of the first example in help('nls'):


 > require(graphics)
 > DNase1 <- subset(DNase, Run == 1)
 > fm1DNase1 <- nls(density ~ SSlogis(log(conc), Asym, xmid, scal), DNase1)
 > extractAIC(fm1DNase1)
Error in UseMethod("extractAIC") :
   no applicable method for 'extractAIC' applied to an object of class "nls"


       Other suggestions?
       Thanks,
       Spencer


  sessionInfo()
R version 2.15.1 (2012-06-22)
Platform: i386-pc-mingw32/i386 (32-bit)

locale:
[1] LC_COLLATE=English_United States.1252
[2] LC_CTYPE=English_United States.1252
[3] LC_MONETARY=English_United States.1252
[4] LC_NUMERIC=C
[5] LC_TIME=English_United States.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods base


From ggrothendieck at gmail.com  Sun Jul 15 03:39:09 2012
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sat, 14 Jul 2012 21:39:09 -0400
Subject: [Rd] extractAIC.nls
In-Reply-To: <5002134A.7070604@prodsyse.com>
References: <5001F873.7020103@prodsyse.com>
	<CAP01uR=kLO7gtKcGAO8XO6_eaRLv42YzywHx6=j73ceeeAScZQ@mail.gmail.com>
	<5002134A.7070604@prodsyse.com>
Message-ID: <CAP01uRkneEJbQjU1vY251PCQAAghcNDFzO4CF74EM=7ntnO_uw@mail.gmail.com>

On Sat, Jul 14, 2012 at 8:48 PM, Spencer Graves
<spencer.graves at prodsyse.com> wrote:
> On 7/14/2012 4:11 PM, Gabor Grothendieck wrote:
>>
>> On Sat, Jul 14, 2012 at 6:53 PM, Spencer Graves
>> <spencer.graves at prodsyse.com> wrote:
>>>
>>> Hello:
>>>
>>>
>>>        Does "extractAIC.nls" exist anywhere?  If no, is there some reason
>>> it
>>> should not be used?
>>>
>>>
>>>        I'm planning to add it to the fda package, but before I do, I felt
>>> a
>>> need to ask if there is some reason I shouldn't or if there are caveats I
>>> should include in the help page for it.
>>>
>> AIC in stats works on nls objects. It calls AIC.default which calls
>> logLik.nls .
>
>
>
>       Thanks for the reply.  Unfortunately, it fails for me in the following
> modification of the first example in help('nls'):

You tried it with extractAIC but my post suggested you use AIC which
is a different function.


-- 
Statistics & Software Consulting
GKX Group, GKX Associates Inc.
tel: 1-877-GKX-GROUP
email: ggrothendieck at gmail.com


From spencer.graves at prodsyse.com  Sun Jul 15 04:57:48 2012
From: spencer.graves at prodsyse.com (Spencer Graves)
Date: Sat, 14 Jul 2012 19:57:48 -0700
Subject: [Rd] extractAIC.nls
In-Reply-To: <CAP01uRkneEJbQjU1vY251PCQAAghcNDFzO4CF74EM=7ntnO_uw@mail.gmail.com>
References: <5001F873.7020103@prodsyse.com>
	<CAP01uR=kLO7gtKcGAO8XO6_eaRLv42YzywHx6=j73ceeeAScZQ@mail.gmail.com>
	<5002134A.7070604@prodsyse.com>
	<CAP01uRkneEJbQjU1vY251PCQAAghcNDFzO4CF74EM=7ntnO_uw@mail.gmail.com>
Message-ID: <500231AC.1000603@prodsyse.com>

On 7/14/2012 6:39 PM, Gabor Grothendieck wrote:
> On Sat, Jul 14, 2012 at 8:48 PM, Spencer Graves
> <spencer.graves at prodsyse.com> wrote:
>> On 7/14/2012 4:11 PM, Gabor Grothendieck wrote:
>>> On Sat, Jul 14, 2012 at 6:53 PM, Spencer Graves
>>> <spencer.graves at prodsyse.com> wrote:
>>>> Hello:
>>>>
>>>>
>>>>         Does "extractAIC.nls" exist anywhere?  If no, is there some reason
>>>> it
>>>> should not be used?
>>>>
>>>>
>>>>         I'm planning to add it to the fda package, but before I do, I felt
>>>> a
>>>> need to ask if there is some reason I shouldn't or if there are caveats I
>>>> should include in the help page for it.
>>>>
>>> AIC in stats works on nls objects. It calls AIC.default which calls
>>> logLik.nls .
>>
>>
>>        Thanks for the reply.  Unfortunately, it fails for me in the following
>> modification of the first example in help('nls'):
> You tried it with extractAIC but my post suggested you use AIC which
> is a different function.

Hi, Gabor:  Thanks very much.  I now see that the help page for AIC 
refers to extractAIC and vice versa.  Spencer


From frobnutz at sogetthis.com  Mon Jul 16 12:44:15 2012
From: frobnutz at sogetthis.com (chuckles the clone)
Date: Mon, 16 Jul 2012 03:44:15 -0700 (PDT)
Subject: [Rd] installing spam package is failing (spam_0.29-1)
Message-ID: <1342435455227-4636628.post@n4.nabble.com>

The primary error seems to be:

 "Creating a new generic function for "diff" in "spam"
   Error in setGeneric(f, where = where) :
     must supply a function skeleton, explicitly or via an existing
function"

And the full output follows. Any thoughts on what may be happening
and/or how to work around the problem?

Thanks!

> install.packages('fields')
Installing package(s) into ?/usr/local/lib/R/site-library?
(as ?lib? is unspecified)
--- Please select a CRAN mirror for use in this session ---
CRAN mirror

 1: Argentina (La Plata)      2: Argentina (Mendoza)
[...]

Selection: 1
also installing the dependency ?spam?

trying URL
'http://mirror.fcaglp.unlp.edu.ar/CRAN/src/contrib/spam_0.29-1.tar.gz'
Content type 'application/x-gzip' length 396179 bytes (386 Kb)
opened URL
==================================================
downloaded 386 Kb

trying URL
'http://mirror.fcaglp.unlp.edu.ar/CRAN/src/contrib/fields_6.6.3.tar.gz'
Content type 'application/x-gzip' length 2488570 bytes (2.4 Mb)
opened URL
==================================================
downloaded 2.4 Mb

* installing *source* package ?spam? ...
** libs
gfortran   -fpic  -O3 -pipe  -g -c bckslvmodified.f -o bckslvmodified.o
gfortran   -fpic  -O3 -pipe  -g -c cholmodified.f -o cholmodified.o
gfortran   -fpic  -O3 -pipe  -g -c dist.f -o dist.o
gfortran   -fpic  -O3 -pipe  -g -c fromsparsekit.f -o fromsparsekit.o
gfortran   -fpic  -O3 -pipe  -g -c kronecker.f -o kronecker.o
gfortran   -fpic  -O3 -pipe  -g -c permutation.f -o permutation.o
gfortran   -fpic  -O3 -pipe  -g -c rowcolstats.f -o rowcolstats.o
gfortran   -fpic  -O3 -pipe  -g -c spamown.f -o spamown.o
gfortran   -fpic  -O3 -pipe  -g -c spamown2.f -o spamown2.o
gfortran   -fpic  -O3 -pipe  -g -c xybind.f -o xybind.o
gcc -shared -o spam.so bckslvmodified.o cholmodified.o dist.o
fromsparsekit.o kronecker.o permutation.o rowcolstats.o s\
pamown.o spamown2.o xybind.o -lgfortran -lm -lquadmath -L/usr/lib/R/lib -lR
installing to /usr/local/lib/R/site-library/spam/libs
** R
** data
**  moving datasets to lazyload DB
** demo
** inst

** preparing package for lazy loading
Creating a new generic function for "print" in "spam"
Creating a new generic function for "summary" in "spam"
Creating a new generic function for "diag" in "spam"
Creating a new generic function for "diag<-" in "spam"
Creating a new generic function for "t" in "spam"
Creating a new generic function for "as.matrix" in "spam"
Creating a new generic function for "all.equal" in "spam"
Creating a new generic function for "isSymmetric" in "spam"
Creating a new generic function for "diff" in "spam"
Error in setGeneric(f, where = where) :
  must supply a function skeleton, explicitly or via an existing function
Error : unable to load R code in package 'spam'
ERROR: lazy loading failed for package ?spam?
* removing ?/usr/local/lib/R/site-library/spam?
ERROR: dependency ?spam? is not available for package ?fields?
* removing ?/usr/local/lib/R/site-library/fields?

The downloaded packages are in
	?/tmp/RtmpauQxtX/downloaded_packages?
Warning messages:
1: In install.packages("fields") :
  installation of package 'spam' had non-zero exit status
2: In install.packages("fields") :
  installation of package 'fields' had non-zero exit status
> 











--
View this message in context: http://r.789695.n4.nabble.com/installing-spam-package-is-failing-spam-0-29-1-tp4636628.html
Sent from the R devel mailing list archive at Nabble.com.


From mdowle at mdowle.plus.com  Mon Jul 16 14:15:03 2012
From: mdowle at mdowle.plus.com (Matthew Dowle)
Date: Mon, 16 Jul 2012 13:15:03 +0100
Subject: [Rd] Non ascii character on Mac on CRAN (C locale)
Message-ID: <4e2b012d65582cdd75c0ca0db7c864c1.squirrel@webmail.plus.net>


Dear all,

A recent bug fix for data.table was for non-ascii characters in column
names and grouping by those column. So, the package's test file now
includes non-ascii characters to test that bug fix :

  # Test non ascii characters when passed as character by, #2134
  x = rep(LETTERS[1:2], 3)
  y = rep(1:3, each=2)
  DT = data.table(?R=x, foo=y)
  test(708, names(DT[, mean(foo), by="?R"]), c("?R","V1"))
  test(709, DT[, mean(foo), by="?R"], DT[, mean(foo), by=?R])
  DT = data.table(F?R=x, foo=y)
  test(710, names(DT[, mean(foo), by="F?R"]), c("F?R","V1"))
  DT = data.table(???=x, foo=y)
  test(711, DT[, mean(foo), by="???"], data.table(???=c("A","B"), V1=2))
  test(712, DT[, mean(foo), by=???], data.table(???=c("A","B"), V1=2))

This passes R CMD check on Linux, Windows and Mac on R-Forge, but not on
Mac on CRAN because Prof Ripley advises that uses the C locale.

It works on Windows because data.table does this first :

  oldenc = options(encoding="UTF-8")[[1L]]
  sys.source("tests.R")  # the file that includes the tests above
  options(encoding=oldenc)

If I change it to the following, will it work on CRAN's Mac, and is this
ok/correct?  Since it passes on R-Forge's Mac, I can't think how else to
test this.

  oldlocale = Sys.getlocale("LC_CTYPE")
  if (oldlocale=="C") Sys.setlocale("LC_CTYPE","en_GB.UTF-8")
  oldenc = options(encoding="UTF-8")[[1L]]
  sys.source("tests.R")  # the file that includes the tests above
  options(encoding=oldenc)
  Sys.setlocalte("LC_CTYPE",oldlocale)

Many thanks,
Matthew


From ligges at statistik.tu-dortmund.de  Mon Jul 16 14:58:05 2012
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Mon, 16 Jul 2012 14:58:05 +0200
Subject: [Rd] installing spam package is failing (spam_0.29-1)
In-Reply-To: <1342435455227-4636628.post@n4.nabble.com>
References: <1342435455227-4636628.post@n4.nabble.com>
Message-ID: <50040FDD.4020307@statistik.tu-dortmund.de>



On 16.07.2012 12:44, chuckles the clone wrote:
> The primary error seems to be:
>
>   "Creating a new generic function for "diff" in "spam"
>     Error in setGeneric(f, where = where) :
>       must supply a function skeleton, explicitly or via an existing
> function"
>
> And the full output follows. Any thoughts on what may be happening
> and/or how to work around the problem?


Is the R-2.15.1 and are all other packages updated?

We do not see this problem in the CRAN checks:

http://cran.r-project.org/web/checks/check_results_spam.html

Uwe Ligges



> Thanks!
>
>> install.packages('fields')
> Installing package(s) into ?/usr/local/lib/R/site-library?
> (as ?lib? is unspecified)
> --- Please select a CRAN mirror for use in this session ---
> CRAN mirror
>
>   1: Argentina (La Plata)      2: Argentina (Mendoza)
> [...]
>
> Selection: 1
> also installing the dependency ?spam?
>
> trying URL
> 'http://mirror.fcaglp.unlp.edu.ar/CRAN/src/contrib/spam_0.29-1.tar.gz'
> Content type 'application/x-gzip' length 396179 bytes (386 Kb)
> opened URL
> ==================================================
> downloaded 386 Kb
>
> trying URL
> 'http://mirror.fcaglp.unlp.edu.ar/CRAN/src/contrib/fields_6.6.3.tar.gz'
> Content type 'application/x-gzip' length 2488570 bytes (2.4 Mb)
> opened URL
> ==================================================
> downloaded 2.4 Mb
>
> * installing *source* package ?spam? ...
> ** libs
> gfortran   -fpic  -O3 -pipe  -g -c bckslvmodified.f -o bckslvmodified.o
> gfortran   -fpic  -O3 -pipe  -g -c cholmodified.f -o cholmodified.o
> gfortran   -fpic  -O3 -pipe  -g -c dist.f -o dist.o
> gfortran   -fpic  -O3 -pipe  -g -c fromsparsekit.f -o fromsparsekit.o
> gfortran   -fpic  -O3 -pipe  -g -c kronecker.f -o kronecker.o
> gfortran   -fpic  -O3 -pipe  -g -c permutation.f -o permutation.o
> gfortran   -fpic  -O3 -pipe  -g -c rowcolstats.f -o rowcolstats.o
> gfortran   -fpic  -O3 -pipe  -g -c spamown.f -o spamown.o
> gfortran   -fpic  -O3 -pipe  -g -c spamown2.f -o spamown2.o
> gfortran   -fpic  -O3 -pipe  -g -c xybind.f -o xybind.o
> gcc -shared -o spam.so bckslvmodified.o cholmodified.o dist.o
> fromsparsekit.o kronecker.o permutation.o rowcolstats.o s\
> pamown.o spamown2.o xybind.o -lgfortran -lm -lquadmath -L/usr/lib/R/lib -lR
> installing to /usr/local/lib/R/site-library/spam/libs
> ** R
> ** data
> **  moving datasets to lazyload DB
> ** demo
> ** inst
>
> ** preparing package for lazy loading
> Creating a new generic function for "print" in "spam"
> Creating a new generic function for "summary" in "spam"
> Creating a new generic function for "diag" in "spam"
> Creating a new generic function for "diag<-" in "spam"
> Creating a new generic function for "t" in "spam"
> Creating a new generic function for "as.matrix" in "spam"
> Creating a new generic function for "all.equal" in "spam"
> Creating a new generic function for "isSymmetric" in "spam"
> Creating a new generic function for "diff" in "spam"
> Error in setGeneric(f, where = where) :
>    must supply a function skeleton, explicitly or via an existing function
> Error : unable to load R code in package 'spam'
> ERROR: lazy loading failed for package ?spam?
> * removing ?/usr/local/lib/R/site-library/spam?
> ERROR: dependency ?spam? is not available for package ?fields?
> * removing ?/usr/local/lib/R/site-library/fields?
>
> The downloaded packages are in
> 	?/tmp/RtmpauQxtX/downloaded_packages?
> Warning messages:
> 1: In install.packages("fields") :
>    installation of package 'spam' had non-zero exit status
> 2: In install.packages("fields") :
>    installation of package 'fields' had non-zero exit status
>>
>
>
>
>
>
>
>
>
>
>
>
> --
> View this message in context: http://r.789695.n4.nabble.com/installing-spam-package-is-failing-spam-0-29-1-tp4636628.html
> Sent from the R devel mailing list archive at Nabble.com.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From frobnutz at sogetthis.com  Mon Jul 16 21:05:40 2012
From: frobnutz at sogetthis.com (chuckles the clone)
Date: Mon, 16 Jul 2012 12:05:40 -0700 (PDT)
Subject: [Rd] installing spam package is failing (spam_0.29-1)
In-Reply-To: <50040FDD.4020307@statistik.tu-dortmund.de>
References: <1342435455227-4636628.post@n4.nabble.com>
	<50040FDD.4020307@statistik.tu-dortmund.de>
Message-ID: <1342465540428-4636676.post@n4.nabble.com>

No, it is R version 2.13.1
This is the latest version apt-get is getting.
Is there some advanced technique for obtaining version 2.15.1 ?

root:~# cat /etc/motd
Welcome to Ubuntu 11.10 (GNU/Linux 3.0.0-16-virtual x86_64)

root:~# apt-get upgrade R
Reading package lists... Done
Building dependency tree
Reading state information... Done
The following packages have been kept back:
  landscape-client libgeos-c1 linux-image-virtual linux-virtual
0 upgraded, 0 newly installed, 0 to remove and 4 not upgraded.
root:~# R --version
R version 2.13.1 (2011-07-08)
Copyright (C) 2011 The R Foundation for Statistical Computing
ISBN 3-900051-07-0
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under the terms of the
GNU General Public License version 2.
For more information about these matters see
http://www.gnu.org/licenses/.



--
View this message in context: http://r.789695.n4.nabble.com/installing-spam-package-is-failing-spam-0-29-1-tp4636628p4636676.html
Sent from the R devel mailing list archive at Nabble.com.


From mailinglist.honeypot at gmail.com  Mon Jul 16 23:17:29 2012
From: mailinglist.honeypot at gmail.com (Steve Lianoglou)
Date: Mon, 16 Jul 2012 17:17:29 -0400
Subject: [Rd] installing spam package is failing (spam_0.29-1)
In-Reply-To: <1342465540428-4636676.post@n4.nabble.com>
References: <1342435455227-4636628.post@n4.nabble.com>
	<50040FDD.4020307@statistik.tu-dortmund.de>
	<1342465540428-4636676.post@n4.nabble.com>
Message-ID: <CAHA9McPTpG0VrbvVjrWo3qugDHv35o4AUuQ-9G1ToviJ35MQ0w@mail.gmail.com>

Hi Chuckles,

On Mon, Jul 16, 2012 at 3:05 PM, chuckles the clone
<frobnutz at sogetthis.com> wrote:
> No, it is R version 2.13.1
> This is the latest version apt-get is getting.
> Is there some advanced technique for obtaining version 2.15.1 ?

If you consider "reading the docs" as an advanced technique, then yes:

http://cran.cnr.Berkeley.edu/bin/linux/ubuntu/

HTH,
-steve

-- 
Steve Lianoglou
Graduate Student: Computational Systems Biology
 | Memorial Sloan-Kettering Cancer Center
 | Weill Medical College of Cornell University
Contact Info: http://cbio.mskcc.org/~lianos/contact


From tobias.verbeke at openanalytics.eu  Mon Jul 16 23:17:55 2012
From: tobias.verbeke at openanalytics.eu (Tobias Verbeke)
Date: Mon, 16 Jul 2012 23:17:55 +0200
Subject: [Rd] installing spam package is failing (spam_0.29-1)
In-Reply-To: <1342465540428-4636676.post@n4.nabble.com>
References: <1342435455227-4636628.post@n4.nabble.com>
	<50040FDD.4020307@statistik.tu-dortmund.de>
	<1342465540428-4636676.post@n4.nabble.com>
Message-ID: <50048503.2050603@openanalytics.eu>

Hi Chuckles,

On 07/16/2012 09:05 PM, chuckles the clone wrote:
> No, it is R version 2.13.1
> This is the latest version apt-get is getting.
> Is there some advanced technique for obtaining version 2.15.1 ?

Have a look here:

http://cran.r-project.org/bin/linux/ubuntu/

HTH,
Tobias

> root:~# cat /etc/motd
> Welcome to Ubuntu 11.10 (GNU/Linux 3.0.0-16-virtual x86_64)
>
> root:~# apt-get upgrade R
> Reading package lists... Done
> Building dependency tree
> Reading state information... Done
> The following packages have been kept back:
>    landscape-client libgeos-c1 linux-image-virtual linux-virtual
> 0 upgraded, 0 newly installed, 0 to remove and 4 not upgraded.
> root:~# R --version
> R version 2.13.1 (2011-07-08)
> Copyright (C) 2011 The R Foundation for Statistical Computing
> ISBN 3-900051-07-0
> Platform: x86_64-pc-linux-gnu (64-bit)
>
> R is free software and comes with ABSOLUTELY NO WARRANTY.
> You are welcome to redistribute it under the terms of the
> GNU General Public License version 2.
> For more information about these matters see
> http://www.gnu.org/licenses/.
>
>
>
> --
> View this message in context: http://r.789695.n4.nabble.com/installing-spam-package-is-failing-spam-0-29-1-tp4636628p4636676.html
> Sent from the R devel mailing list archive at Nabble.com.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From frobnutz at sogetthis.com  Tue Jul 17 08:34:07 2012
From: frobnutz at sogetthis.com (chuckles the clone)
Date: Mon, 16 Jul 2012 23:34:07 -0700 (PDT)
Subject: [Rd] installing spam package is failing (spam_0.29-1)
In-Reply-To: <50048503.2050603@openanalytics.eu>
References: <1342435455227-4636628.post@n4.nabble.com>
	<50040FDD.4020307@statistik.tu-dortmund.de>
	<1342465540428-4636676.post@n4.nabble.com>
	<50048503.2050603@openanalytics.eu>
Message-ID: <1342506847825-4636727.post@n4.nabble.com>

Thank you for your snark but it was not necessary.

In fact I *have* read the "documentation". That's how I got R installed
in the first place. But I followed, again, the instructions on that page 
and, again, I am still at version 2.13.1. (SEE BELOW)

Is there some other means of causing R to update to the latest version?
There is nothing at all in the "documentation" that suggests I should be
having this issue or what to do about it.

Thanks!


# apt-get install r-base
Reading package lists... Done
Building dependency tree
Reading state information... Done
r-base is already the newest version.
0 upgraded, 0 newly installed, 0 to remove and 4 not upgraded.

# apt-get install r-base-dev
Reading package lists... Done
Building dependency tree
Reading state information... Done
r-base-dev is already the newest version.
r-base-dev set to manually installed.
0 upgraded, 0 newly installed, 0 to remove and 4 not upgraded.
root:~# 

root:~# R --version
R version 2.13.1 (2011-07-08)
Copyright (C) 2011 The R Foundation for Statistical Computing
ISBN 3-900051-07-0
Platform: x86_64-pc-linux-gnu (64-bit)


--
View this message in context: http://r.789695.n4.nabble.com/installing-spam-package-is-failing-spam-0-29-1-tp4636628p4636727.html
Sent from the R devel mailing list archive at Nabble.com.


From ht at heatherturner.net  Tue Jul 17 10:15:05 2012
From: ht at heatherturner.net (Heather Turner)
Date: Tue, 17 Jul 2012 09:15:05 +0100
Subject: [Rd] installing spam package is failing (spam_0.29-1)
In-Reply-To: <1342506847825-4636727.post@n4.nabble.com>
References: <1342435455227-4636628.post@n4.nabble.com>
	<50040FDD.4020307@statistik.tu-dortmund.de>
	<1342465540428-4636676.post@n4.nabble.com>
	<50048503.2050603@openanalytics.eu>
	<1342506847825-4636727.post@n4.nabble.com>
Message-ID: <50051ADD.1030101@heatherturner.net>

I expect what's happened is that you have installed R at some point,
then later updated Ubuntu, which caused the R repository you had stored
to be disabled.

Try running

sudo gedit /etc/apt/sources.list

If my guess is right, you will probably have something like

# deb http://<my.favorite.cran.mirror>/bin/linux/ubuntu natty/ #disabled
on upgrade to oneiric

Note that the whole line has been commented out! To fix, simply
uncomment and replace the old ubuntu version (e.g. natty) with your new
one (e.g. oneiric). Then, assuming you already have Michael Rutter's key
on your system, just run

sudo apt-get update && sudo apt-get upgrade

and you should be able to upgrade to 2.15.1

Best wishes,

Heather


On 17/07/12 07:34, chuckles the clone wrote:
> Thank you for your snark but it was not necessary.
>
> In fact I *have* read the "documentation". That's how I got R installed
> in the first place. But I followed, again, the instructions on that page
> and, again, I am still at version 2.13.1. (SEE BELOW)
>
> Is there some other means of causing R to update to the latest version?
> There is nothing at all in the "documentation" that suggests I should be
> having this issue or what to do about it.
>
> Thanks!
>
>
> # apt-get install r-base
> Reading package lists... Done
> Building dependency tree
> Reading state information... Done
> r-base is already the newest version.
> 0 upgraded, 0 newly installed, 0 to remove and 4 not upgraded.
>
> # apt-get install r-base-dev
> Reading package lists... Done
> Building dependency tree
> Reading state information... Done
> r-base-dev is already the newest version.
> r-base-dev set to manually installed.
> 0 upgraded, 0 newly installed, 0 to remove and 4 not upgraded.
> root:~#
>
> root:~# R --version
> R version 2.13.1 (2011-07-08)
> Copyright (C) 2011 The R Foundation for Statistical Computing
> ISBN 3-900051-07-0
> Platform: x86_64-pc-linux-gnu (64-bit)
>
>
> --
> View this message in context: http://r.789695.n4.nabble.com/installing-spam-package-is-failing-spam-0-29-1-tp4636628p4636727.html
> Sent from the R devel mailing list archive at Nabble.com.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From gunter.berton at gene.com  Tue Jul 17 19:48:37 2012
From: gunter.berton at gene.com (Bert Gunter)
Date: Tue, 17 Jul 2012 10:48:37 -0700
Subject: [Rd] R CMD build/check on Windows 7
Message-ID: <CACk-te1fyWvj_aeO7LHt4_fuiirrJ=MVuN7grTfP-emMm7K-eA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20120717/0cf441fd/attachment.pl>

From hb at biostat.ucsf.edu  Tue Jul 17 20:32:30 2012
From: hb at biostat.ucsf.edu (Henrik Bengtsson)
Date: Tue, 17 Jul 2012 20:32:30 +0200
Subject: [Rd] R CMD build/check on Windows 7
In-Reply-To: <CACk-te1fyWvj_aeO7LHt4_fuiirrJ=MVuN7grTfP-emMm7K-eA@mail.gmail.com>
References: <CACk-te1fyWvj_aeO7LHt4_fuiirrJ=MVuN7grTfP-emMm7K-eA@mail.gmail.com>
Message-ID: <CAFDcVCS-1kW+qDhHrQD7WTc+Xn9BMFq4Upc=mspeFeK8EFZdnA@mail.gmail.com>

If of any value/FYI, this seems to be related to my R-devel post 'R
devel [and R 2.14.1 patched]: R CMD build now sources ~/.Rprofile':

https://stat.ethz.ch/pipermail/r-devel/2012-February/063365.html

/Henrik

On Tue, Jul 17, 2012 at 7:48 PM, Bert Gunter <gunter.berton at gene.com> wrote:
> Folks:
>
> sessionInfo()
> R version 2.15.0 (2012-03-30)
> Platform: i386-pc-mingw32/i386 (32-bit)
>
> locale:
> [1] LC_COLLATE=English_United States.1252
> [2] LC_CTYPE=English_United States.1252
> [3] LC_MONETARY=English_United States.1252
> [4] LC_NUMERIC=C
>
> [5] LC_TIME=English_United States.1252
>
> attached base packages:
>  [1] datasets  splines   grid      tcltk     stats     graphics  grDevices
>  [8] utils     methods   base
>
> other attached packages:
> [1] svSocket_0.9-51 lattice_0.19-26 MASS_7.3-17
>
> loaded via a namespace (and not attached):
> [1] cluster_1.14.2 Hmisc_3.9-3    R2HTML_2.2     svMisc_0.9-65
> TinnR_1.0-5
> [6] tools_2.15.0
>
>
> According to section 1.3 of the WRITING R EXTENSIONS manual, both R CMD
> build and R CMD check run R with the '--vanilla' option so no user startup
> files are read.
>
> However,
>
> 1. If I have an Rprofile.site in my etc startup directory, if I am in the
> ...\top directory and try to check or build the top\mypackage source
> package, I can only do so by giving (in the Windows shell, of course) the
> full path name to R CMD build/check, e.g.
> R CMD build pathtoTop\top\mypackage  .
>
> R CMD build mypackage
>
> yields the error:  ERROR  cannot change to directory 'test'
>
>
> 2. However, if I remove (e.g. change the name) of Rprofile.site, then
>
> R CMD build/check mypackage
>
> works fine. Note that my Rprofile.site file DOES contain a setwd()
> statement to some other directory; if I comment out this statement, then I
> also do not need to use the full path name even with the Rprofile.site file
> there.
>
> So my question is: Is the documentation wrong? -- Is there an environmental
> variable or option I need to set/change? -- Is this a Windows "feature"
> subtlety?
>
> Many thanks.
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From frobnutz at sogetthis.com  Wed Jul 18 20:02:09 2012
From: frobnutz at sogetthis.com (chuckles the clone)
Date: Wed, 18 Jul 2012 11:02:09 -0700 (PDT)
Subject: [Rd] installing spam package is failing (spam_0.29-1)
In-Reply-To: <50051ADD.1030101@heatherturner.net>
References: <1342435455227-4636628.post@n4.nabble.com>
	<50040FDD.4020307@statistik.tu-dortmund.de>
	<1342465540428-4636676.post@n4.nabble.com>
	<50048503.2050603@openanalytics.eu>
	<1342506847825-4636727.post@n4.nabble.com>
	<50051ADD.1030101@heatherturner.net>
Message-ID: <1342634529375-4636918.post@n4.nabble.com>

Thanks! But no. sources.list already contains:
deb http://http://cran.cnr.Berkeley.edu/bin/linux/ubuntu oneiric/

Re-running any sort of apt-get results in the same failure to upgrade R.

Is there some way of installing a version of this "spam" library which
is compatible with the version of R that apt-get insists on installing?

(also, who decided to name this thing "spam"? i suppose it seemed
cute at the time but it is virtually impossible to google for. )


--
View this message in context: http://r.789695.n4.nabble.com/installing-spam-package-is-failing-spam-0-29-1-tp4636628p4636918.html
Sent from the R devel mailing list archive at Nabble.com.


From pdalgd at gmail.com  Wed Jul 18 20:19:31 2012
From: pdalgd at gmail.com (peter dalgaard)
Date: Wed, 18 Jul 2012 20:19:31 +0200
Subject: [Rd] installing spam package is failing (spam_0.29-1)
In-Reply-To: <1342634529375-4636918.post@n4.nabble.com>
References: <1342435455227-4636628.post@n4.nabble.com>
	<50040FDD.4020307@statistik.tu-dortmund.de>
	<1342465540428-4636676.post@n4.nabble.com>
	<50048503.2050603@openanalytics.eu>
	<1342506847825-4636727.post@n4.nabble.com>
	<50051ADD.1030101@heatherturner.net>
	<1342634529375-4636918.post@n4.nabble.com>
Message-ID: <88C2FC17-2EE8-4E36-B885-508546DAEC25@gmail.com>


On Jul 18, 2012, at 20:02 , chuckles the clone wrote:

> Thanks! But no. sources.list already contains:
> deb http://http://cran.cnr.Berkeley.edu/bin/linux/ubuntu oneiric/

If it is actually spelled like that, that may be the cause of your problem. Fixing what needs, I see that there is indeed a

http://cran.cnr.berkeley.edu/bin/linux/ubuntu/oneiric/r-base-core_2.15.1-1oneiric0_amd64.deb

file and several of its friends in that directory.

> 
> Re-running any sort of apt-get results in the same failure to upgrade R.
> 
> Is there some way of installing a version of this "spam" library which
> is compatible with the version of R that apt-get insists on installing?
> 
> (also, who decided to name this thing "spam"? i suppose it seemed
> cute at the time but it is virtually impossible to google for. )
> 
> 
> --
> View this message in context: http://r.789695.n4.nabble.com/installing-spam-package-is-failing-spam-0-29-1-tp4636628p4636918.html
> Sent from the R devel mailing list archive at Nabble.com.
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Peter Dalgaard, Professor,
Center for Statistics, Copenhagen Business School
Solbjerg Plads 3, 2000 Frederiksberg, Denmark
Phone: (+45)38153501
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From frobnutz at sogetthis.com  Wed Jul 18 20:20:56 2012
From: frobnutz at sogetthis.com (chuckles the clone)
Date: Wed, 18 Jul 2012 11:20:56 -0700 (PDT)
Subject: [Rd] installing spam package is failing (spam_0.29-1)
In-Reply-To: <1342634529375-4636918.post@n4.nabble.com>
References: <1342435455227-4636628.post@n4.nabble.com>
	<50040FDD.4020307@statistik.tu-dortmund.de>
	<1342465540428-4636676.post@n4.nabble.com>
	<50048503.2050603@openanalytics.eu>
	<1342506847825-4636727.post@n4.nabble.com>
	<50051ADD.1030101@heatherturner.net>
	<1342634529375-4636918.post@n4.nabble.com>
Message-ID: <1342635656046-4636920.post@n4.nabble.com>


also, it does not help to remove and re-install r-base. as far as apt-get is
concerned, version 2.13.1 is the latest.

# apt-get --purge remove r-base-dev
Reading package lists... Done
Building dependency tree
Reading state information... Done
The following packages will be REMOVED:
  r-base-dev*
0 upgraded, 0 newly installed, 1 to remove and 4 not upgraded.
After this operation, 36.9 kB disk space will be freed.
Do you want to continue [Y/n]? y
(Reading database ... 47129 files and directories currently installed.)
Removing r-base-dev ...

# apt-get --purge remove r-base
Reading package lists... Done
Building dependency tree
Reading state information... Done
The following packages were automatically installed and are no longer
required:
  gfortran-4.6 libblas-dev libxml-parser-perl patchutils libncurses5-dev
cdbs
  libreadline6-dev libpcrecpp0 intltool liblapack-dev libtinfo-dev
  python-scour gfortran libpcre3-dev dh-translations libjpeg62-dev dpatch
  libbz2-dev libreadline-dev libpng12-dev
Use 'apt-get autoremove' to remove them.
The following packages will be REMOVED:
  r-base*
0 upgraded, 0 newly installed, 1 to remove and 4 not upgraded.
After this operation, 77.8 kB disk space will be freed.
Do you want to continue [Y/n]? y
(Reading database ... 47126 files and directories currently installed.)
Removing r-base ...

# apt-get install r-base
Reading package lists... Done
Building dependency tree
Reading state information... Done
The following packages were automatically installed and are no longer
required:
  gfortran-4.6 libblas-dev libxml-parser-perl patchutils libncurses5-dev
cdbs
  libreadline6-dev libpcrecpp0 intltool liblapack-dev libtinfo-dev
  python-scour gfortran libpcre3-dev dh-translations libjpeg62-dev dpatch
  libbz2-dev libreadline-dev libpng12-dev
Use 'apt-get autoremove' to remove them.
Suggested packages:
  ess r-doc-info r-doc-pdf
The following NEW packages will be installed:
  r-base
0 upgraded, 1 newly installed, 0 to remove and 4 not upgraded.
Need to get 0 B/9,560 B of archives.
After this operation, 77.8 kB of additional disk space will be used.
debconf: unable to initialize frontend: Dialog
debconf: (Dialog frontend will not work on a dumb terminal, an emacs shell
buffer, or without a controlling terminal.)
debconf: falling back to frontend: Readline
Selecting previously deselected package r-base.
(Reading database ... 47122 files and directories currently installed.)
Unpacking r-base (from .../r-base_2.13.1-1_all.deb) ...
Setting up r-base (2.13.1-1) ...
# apt-get install r-base-dev
Reading package lists... Done
Building dependency tree

Reading state information... Done
The following NEW packages will be installed:
  r-base-dev
0 upgraded, 1 newly installed, 0 to remove and 4 not upgraded.
Need to get 0 B/3,546 B of archives.
After this operation, 36.9 kB of additional disk space will be used.
debconf: unable to initialize frontend: Dialog
debconf: (Dialog frontend will not work on a dumb terminal, an emacs shell
buffer, or without a controlling terminal.)
debconf: falling back to frontend: Readline
Selecting previously deselected package r-base-dev.
(Reading database ... 47126 files and directories currently installed.)
Unpacking r-base-dev (from .../r-base-dev_2.13.1-1_all.deb) ...
Setting up r-base-dev (2.13.1-1) ...
#







--
View this message in context: http://r.789695.n4.nabble.com/installing-spam-package-is-failing-spam-0-29-1-tp4636628p4636920.html
Sent from the R devel mailing list archive at Nabble.com.


From mailinglist.honeypot at gmail.com  Wed Jul 18 20:21:06 2012
From: mailinglist.honeypot at gmail.com (Steve Lianoglou)
Date: Wed, 18 Jul 2012 14:21:06 -0400
Subject: [Rd] installing spam package is failing (spam_0.29-1)
In-Reply-To: <1342634529375-4636918.post@n4.nabble.com>
References: <1342435455227-4636628.post@n4.nabble.com>
	<50040FDD.4020307@statistik.tu-dortmund.de>
	<1342465540428-4636676.post@n4.nabble.com>
	<50048503.2050603@openanalytics.eu>
	<1342506847825-4636727.post@n4.nabble.com>
	<50051ADD.1030101@heatherturner.net>
	<1342634529375-4636918.post@n4.nabble.com>
Message-ID: <CAHA9McO=TEt_o_Yixd2UedzMShtGi7ZrTSoxCDEOCUXXxcxcOw@mail.gmail.com>

Hello Chuckles the Clone,

On Wed, Jul 18, 2012 at 2:02 PM, chuckles the clone
<frobnutz at sogetthis.com> wrote:
> Thanks! But no. sources.list already contains:
> deb http://http://cran.cnr.Berkeley.edu/bin/linux/ubuntu oneiric/

Could you please copy/paste your /etc/apt/sources.list file here? I
guess what you wrote above is a typo, but it's also wrong -- it would
be easier for us to help you that way, I reckon.

> Is there some way of installing a version of this "spam" library which
> is compatible with the version of R that apt-get insists on installing?

You could likely just install it yourself via a call to
`install.packages('spam')`

I reckon you will probably need to `sudo apt-get install r-base-dev`
since it seems (I didn't d/l the package to check) that you'll have to
compile fortran/c code.

Which means you'll also need gcc/gfortran installed.

> (also, who decided to name this thing "spam"? i suppose it seemed
> cute at the time but it is virtually impossible to google for. )

That would be the author of the package.

-- 
Steve Lianoglou
Graduate Student: Computational Systems Biology
 | Memorial Sloan-Kettering Cancer Center
 | Weill Medical College of Cornell University
Contact Info: http://cbio.mskcc.org/~lianos/contact


From murdoch.duncan at gmail.com  Wed Jul 18 20:31:23 2012
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Wed, 18 Jul 2012 14:31:23 -0400
Subject: [Rd] Changes to parser in R-devel
Message-ID: <500700FB.4000606@gmail.com>

I have just committed (in r59883) some changes to the R parser based on 
Romain Francois' parser package.  Packages that made use of parser will 
hopefully find that the information in base R gives them what they need 
to work with, but the data is not identical to
what parser recorded (since it was not consistent with some things 
already in R).  One reason for the change was that the parser in the 
parser package was slightly different than the one in R; the hope is 
that by providing the services in R, it will make maintenance easier for 
things like code analysis, pretty printing, etc.

See ?getParseData for details, and if you are maintaining a package that 
depends on parser, feel free to ask me for help in the transition, or 
make suggestions for changes if I've done something that causes you too 
much trouble.

Duncan Murdoch

P.S. to Qiang Li:  as mentioned privately, the goal for this change was 
to reproduce output equivalent to what parser did, so I have not 
incorporated your suggested change to outlaw expressions like "x[[1] ]"  
(with an embedded space where it shouldn't be).  After things settle 
down we can consider that change and others.


From frobnutz at sogetthis.com  Wed Jul 18 20:35:16 2012
From: frobnutz at sogetthis.com (chuckles the clone)
Date: Wed, 18 Jul 2012 11:35:16 -0700 (PDT)
Subject: [Rd] installing spam package is failing (spam_0.29-1)
In-Reply-To: <CAHA9McO=TEt_o_Yixd2UedzMShtGi7ZrTSoxCDEOCUXXxcxcOw@mail.gmail.com>
References: <1342435455227-4636628.post@n4.nabble.com>
	<50040FDD.4020307@statistik.tu-dortmund.de>
	<1342465540428-4636676.post@n4.nabble.com>
	<50048503.2050603@openanalytics.eu>
	<1342506847825-4636727.post@n4.nabble.com>
	<50051ADD.1030101@heatherturner.net>
	<1342634529375-4636918.post@n4.nabble.com>
	<CAHA9McO=TEt_o_Yixd2UedzMShtGi7ZrTSoxCDEOCUXXxcxcOw@mail.gmail.com>
Message-ID: <1342636516196-4636929.post@n4.nabble.com>

Hello! 

No, doing a hand-install of the spam package fails in the same way as
when it is installed via installing the fields package. ie, in exactly the
same
way as seen in the initial post in this thread.

Apparently the latest version of "spam" is incompatible with the version
of R that I have installed. I am hoping that if I can't upgrade R, that I
can
find a down-graded spam.

The line from my sources.list was cut-and-pasted from a previous suggestion.
Perhaps it is a typo? In any case, here is my entire sources.list.

If it matters, I'm running this on an Amazon EC2 cloud machine.

I'm sorry if these seem like particularly lame questions, but I rarely use
apt-get and have never seen this issue before. 

Thanks!


## modifications made here will not survive a re-bundle.
## if you wish to make changes you can:
## a.) add 'apt_preserve_sources_list: true' to /etc/cloud/cloud.cfg
##     or do the same in user-data
## b.) add sources in /etc/apt/sources.list.d
## c.) make changes to template file /etc/cloud/templates/sources.list.tmpl
#

# See http://help.ubuntu.com/community/UpgradeNotes for how to upgrade to
# newer versions of the distribution.
deb http://us-west-1.ec2.archive.ubuntu.com/ubuntu/ oneiric main
deb-src http://us-west-1.ec2.archive.ubuntu.com/ubuntu/ oneiric main

## Major bug fix updates produced after the final release of the
## distribution.
deb http://us-west-1.ec2.archive.ubuntu.com/ubuntu/ oneiric-updates main
deb-src http://us-west-1.ec2.archive.ubuntu.com/ubuntu/ oneiric-updates main

## N.B. software from this repository is ENTIRELY UNSUPPORTED by the Ubuntu
## team. Also, please note that software in universe WILL NOT receive any
## review or updates from the Ubuntu security team.
deb http://us-west-1.ec2.archive.ubuntu.com/ubuntu/ oneiric universe
deb-src http://us-west-1.ec2.archive.ubuntu.com/ubuntu/ oneiric universe
deb http://us-west-1.ec2.archive.ubuntu.com/ubuntu/ oneiric-updates universe
deb-src http://us-west-1.ec2.archive.ubuntu.com/ubuntu/ oneiric-updates
universe

## N.B. software from this repository is ENTIRELY UNSUPPORTED by the Ubuntu
## team, and may not be under a free licence. Please satisfy yourself as to
## your rights to use the software. Also, please note that software in
## multiverse WILL NOT receive any review or updates from the Ubuntu
## security team.
# deb http://us-west-1.ec2.archive.ubuntu.com/ubuntu/ oneiric multiverse
# deb-src http://us-west-1.ec2.archive.ubuntu.com/ubuntu/ oneiric multiverse
# deb http://us-west-1.ec2.archive.ubuntu.com/ubuntu/ oneiric-updates
multiverse
# deb-src http://us-west-1.ec2.archive.ubuntu.com/ubuntu/ oneiric-updates
multiverse

## Uncomment the following two lines to add software from the 'backports'
## repository.
## N.B. software from this repository may not have been tested as
## extensively as that contained in the main release, although it includes
## newer versions of some applications which may provide useful features.
## Also, please note that software in backports WILL NOT receive any review
## or updates from the Ubuntu security team.
# deb http://us-west-1.ec2.archive.ubuntu.com/ubuntu/ oneiric-backports main
restricted universe multiverse
# deb-src http://us-west-1.ec2.archive.ubuntu.com/ubuntu/ oneiric-backports
main restricted universe multiverse

## Uncomment the following two lines to add software from Canonical's
## 'partner' repository.
## This software is not part of Ubuntu, but is offered by Canonical and the
## respective vendors as a service to Ubuntu users.
# deb http://archive.canonical.com/ubuntu oneiric partner
# deb-src http://archive.canonical.com/ubuntu oneiric partner

deb http://security.ubuntu.com/ubuntu oneiric-security main
deb-src http://security.ubuntu.com/ubuntu oneiric-security main
deb http://security.ubuntu.com/ubuntu oneiric-security universe
deb-src http://security.ubuntu.com/ubuntu oneiric-security universe
# deb http://security.ubuntu.com/ubuntu oneiric-security multiverse
# deb-src http://security.ubuntu.com/ubuntu oneiric-security multiverse


deb http://http://cran.cnr.Berkeley.edu/bin/linux/ubuntu oneiric/






--
View this message in context: http://r.789695.n4.nabble.com/installing-spam-package-is-failing-spam-0-29-1-tp4636628p4636929.html
Sent from the R devel mailing list archive at Nabble.com.


From pdalgd at gmail.com  Wed Jul 18 21:39:02 2012
From: pdalgd at gmail.com (peter dalgaard)
Date: Wed, 18 Jul 2012 21:39:02 +0200
Subject: [Rd] installing spam package is failing (spam_0.29-1)
In-Reply-To: <1342636516196-4636929.post@n4.nabble.com>
References: <1342435455227-4636628.post@n4.nabble.com>
	<50040FDD.4020307@statistik.tu-dortmund.de>
	<1342465540428-4636676.post@n4.nabble.com>
	<50048503.2050603@openanalytics.eu>
	<1342506847825-4636727.post@n4.nabble.com>
	<50051ADD.1030101@heatherturner.net>
	<1342634529375-4636918.post@n4.nabble.com>
	<CAHA9McO=TEt_o_Yixd2UedzMShtGi7ZrTSoxCDEOCUXXxcxcOw@mail.gmail.com>
	<1342636516196-4636929.post@n4.nabble.com>
Message-ID: <40567AF0-0A7B-4679-94B8-7783B837E757@gmail.com>


On Jul 18, 2012, at 20:35 , chuckles the clone wrote:

> 
> The line from my sources.list was cut-and-pasted from a previous suggestion.
> Perhaps it is a typo? In any case, here is my entire sources.list.

In that case, the obvious current suggestion is to lose the double http:// in the last line and retry.

-- 
Peter Dalgaard, Professor,
Center for Statistics, Copenhagen Business School
Solbjerg Plads 3, 2000 Frederiksberg, Denmark
Phone: (+45)38153501
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From frobnutz at sogetthis.com  Thu Jul 19 01:30:47 2012
From: frobnutz at sogetthis.com (chuckles the clone)
Date: Wed, 18 Jul 2012 16:30:47 -0700 (PDT)
Subject: [Rd] installing spam package is failing (spam_0.29-1)
In-Reply-To: <40567AF0-0A7B-4679-94B8-7783B837E757@gmail.com>
References: <1342435455227-4636628.post@n4.nabble.com>
	<50040FDD.4020307@statistik.tu-dortmund.de>
	<1342465540428-4636676.post@n4.nabble.com>
	<50048503.2050603@openanalytics.eu>
	<1342506847825-4636727.post@n4.nabble.com>
	<50051ADD.1030101@heatherturner.net>
	<1342634529375-4636918.post@n4.nabble.com>
	<CAHA9McO=TEt_o_Yixd2UedzMShtGi7ZrTSoxCDEOCUXXxcxcOw@mail.gmail.com>
	<1342636516196-4636929.post@n4.nabble.com>
	<40567AF0-0A7B-4679-94B8-7783B837E757@gmail.com>
Message-ID: <1342654247105-4636972.post@n4.nabble.com>

Well, it looks like part of the problem is that there's an r-base 
on us-west-1.ec2.archive.ubuntu.com which apt-get I suppose
must be thinking is the latest.




# apt-cache showpkg r-base
Package: r-base
Versions:
2.13.1-1
(/var/lib/apt/lists/us-west-1.ec2.archive.ubuntu.com_ubuntu_dists_oneiric_universe_binary-amd64_Packages)
(/va\
\
r/lib/dpkg/status)
 Description Language: en
                 File:
/var/lib/apt/lists/us-west-1.ec2.archive.ubuntu.com_ubuntu_dists_oneiric_universe_i18n_Translati\
\
on-en
                  MD5: e8de27c34fdd57ca1c4480d402910df7
 Description Language:
                 File:
/var/lib/apt/lists/us-west-1.ec2.archive.ubuntu.com_ubuntu_dists_oneiric_universe_binary-amd64_P\
\
ackages
                  MD5: e8de27c34fdd57ca1c4480d402910df7


Reverse Depends:
  r-base-core:i386,r-base 1.4.1-1
  texmacs,r-base
  science-numericalcomputation,r-base
  science-meteorology,r-base
  r-doc-info,r-base 1.4.1-1
  r-doc-html,r-base 1.4.1-1
  r-base-html,r-base 1.4.1-1
  r-base-core,r-base 1.4.1-1
  med-physics,r-base
  ess,r-base
Dependencies:
2.13.1-1 - r-base-core (2 2.13.1-1) r-recommended (5 2.13.1-1) ess (0
(null)) r-doc-info (16 (null)) r-doc-pdf (0 (null\
\
)) r-base-html (0 (null)) r-doc-html (0 (null)) r-base:i386 (0 (null))
Provides:
2.13.1-1 -
Reverse Provides:



--
View this message in context: http://r.789695.n4.nabble.com/installing-spam-package-is-failing-spam-0-29-1-tp4636628p4636972.html
Sent from the R devel mailing list archive at Nabble.com.


From frobnutz at sogetthis.com  Thu Jul 19 01:40:52 2012
From: frobnutz at sogetthis.com (chuckles the clone)
Date: Wed, 18 Jul 2012 16:40:52 -0700 (PDT)
Subject: [Rd] installing spam package is failing (spam_0.29-1)
In-Reply-To: <1342654247105-4636972.post@n4.nabble.com>
References: <50040FDD.4020307@statistik.tu-dortmund.de>
	<1342465540428-4636676.post@n4.nabble.com>
	<50048503.2050603@openanalytics.eu>
	<1342506847825-4636727.post@n4.nabble.com>
	<50051ADD.1030101@heatherturner.net>
	<1342634529375-4636918.post@n4.nabble.com>
	<CAHA9McO=TEt_o_Yixd2UedzMShtGi7ZrTSoxCDEOCUXXxcxcOw@mail.gmail.com>
	<1342636516196-4636929.post@n4.nabble.com>
	<40567AF0-0A7B-4679-94B8-7783B837E757@gmail.com>
	<1342654247105-4636972.post@n4.nabble.com>
Message-ID: <1342654852280-4636973.post@n4.nabble.com>

If I comment out everything in the sources.list file *except* the cran entry,
apt-get fails this way:

# apt-get --reinstall -V install r-base
Reading package lists... Done
Building dependency tree
Reading state information... Done
Reinstallation of r-base is not possible, it cannot be downloaded.
0 upgraded, 0 newly installed, 0 to remove and 1 not upgraded.


Yes, I have successfully done the apt-key thing.




--
View this message in context: http://r.789695.n4.nabble.com/installing-spam-package-is-failing-spam-0-29-1-tp4636628p4636973.html
Sent from the R devel mailing list archive at Nabble.com.


From frobnutz at sogetthis.com  Thu Jul 19 01:46:38 2012
From: frobnutz at sogetthis.com (chuckles the clone)
Date: Wed, 18 Jul 2012 16:46:38 -0700 (PDT)
Subject: [Rd] installing spam package is failing (spam_0.29-1)
In-Reply-To: <1342654852280-4636973.post@n4.nabble.com>
References: <1342465540428-4636676.post@n4.nabble.com>
	<50048503.2050603@openanalytics.eu>
	<1342506847825-4636727.post@n4.nabble.com>
	<50051ADD.1030101@heatherturner.net>
	<1342634529375-4636918.post@n4.nabble.com>
	<CAHA9McO=TEt_o_Yixd2UedzMShtGi7ZrTSoxCDEOCUXXxcxcOw@mail.gmail.com>
	<1342636516196-4636929.post@n4.nabble.com>
	<40567AF0-0A7B-4679-94B8-7783B837E757@gmail.com>
	<1342654247105-4636972.post@n4.nabble.com>
	<1342654852280-4636973.post@n4.nabble.com>
Message-ID: <1342655198035-4636974.post@n4.nabble.com>

I suppose since the package system is completely borked, I'll have to build
from sources.

But there doesn't seem to be any documentation clarifying what sources I
need.
  r-base-core  ?
  r-base          ?  
  r-base-dev  ?

Those will probably be the minimum? But are there other packages that are
needed
to get the basic engine up and running?


Thanks!


--
View this message in context: http://r.789695.n4.nabble.com/installing-spam-package-is-failing-spam-0-29-1-tp4636628p4636974.html
Sent from the R devel mailing list archive at Nabble.com.


From frobnutz at sogetthis.com  Thu Jul 19 01:49:09 2012
From: frobnutz at sogetthis.com (chuckles the clone)
Date: Wed, 18 Jul 2012 16:49:09 -0700 (PDT)
Subject: [Rd] installing spam package is failing (spam_0.29-1)
In-Reply-To: <1342655198035-4636974.post@n4.nabble.com>
References: <50048503.2050603@openanalytics.eu>
	<1342506847825-4636727.post@n4.nabble.com>
	<50051ADD.1030101@heatherturner.net>
	<1342634529375-4636918.post@n4.nabble.com>
	<CAHA9McO=TEt_o_Yixd2UedzMShtGi7ZrTSoxCDEOCUXXxcxcOw@mail.gmail.com>
	<1342636516196-4636929.post@n4.nabble.com>
	<40567AF0-0A7B-4679-94B8-7783B837E757@gmail.com>
	<1342654247105-4636972.post@n4.nabble.com>
	<1342654852280-4636973.post@n4.nabble.com>
	<1342655198035-4636974.post@n4.nabble.com>
Message-ID: <1342655349073-4636975.post@n4.nabble.com>

Still, it would be a lot easier if there were just a version of the "spam" 
library that was known to work with this release of R.  Has anyone
successfully
installed this "spam" thing? How did you do it?

Thanks!


--
View this message in context: http://r.789695.n4.nabble.com/installing-spam-package-is-failing-spam-0-29-1-tp4636628p4636975.html
Sent from the R devel mailing list archive at Nabble.com.


From edd at debian.org  Thu Jul 19 03:16:25 2012
From: edd at debian.org (Dirk Eddelbuettel)
Date: Wed, 18 Jul 2012 20:16:25 -0500
Subject: [Rd] installing spam package is failing (spam_0.29-1)
In-Reply-To: <1342654852280-4636973.post@n4.nabble.com>
References: <50040FDD.4020307@statistik.tu-dortmund.de>
	<1342465540428-4636676.post@n4.nabble.com>
	<50048503.2050603@openanalytics.eu>
	<1342506847825-4636727.post@n4.nabble.com>
	<50051ADD.1030101@heatherturner.net>
	<1342634529375-4636918.post@n4.nabble.com>
	<CAHA9McO=TEt_o_Yixd2UedzMShtGi7ZrTSoxCDEOCUXXxcxcOw@mail.gmail.com>
	<1342636516196-4636929.post@n4.nabble.com>
	<40567AF0-0A7B-4679-94B8-7783B837E757@gmail.com>
	<1342654247105-4636972.post@n4.nabble.com>
	<1342654852280-4636973.post@n4.nabble.com>
Message-ID: <20487.24553.429801.104381@max.nulle.part>


For Pete's sake, could you please stop spamming the r-devel list?

We have a dedicated list r-sig-debian for questions related to R on
Debian/Ubuntu.  Please use it.

And as as far as I can tell, Peter already told you what's up:

   deb http://http://cran.cnr.Berkeley.edu/bin/linux/ubuntu oneiric/
       ^^^^^^^^^^^^

Not a valid url.  Once you have told apt/dpkg about additional sources, the
rest takes care of its own as higher package versions win:

edd at max:~$ apt-cache policy r-base-core
r-base-core:
  Installed: 2.15.1-1precise2
  Candidate: 2.15.1-1precise2
  Version table:
 *** 2.15.1-1precise2 0
        500 http://cran.r-project.org/bin/linux/ubuntu/ precise/ Packages
        100 /var/lib/dpkg/status
     2.15.0-1precise0 0
        500 http://cran.r-project.org/bin/linux/ubuntu/ precise/ Packages
     2.14.1-1 0
        500 http://us.archive.ubuntu.com/ubuntu/ precise/universe amd64 Packages
edd at max:~$ 


Dirk, one of several volunteers making sure the above "just works"

-- 
Dirk Eddelbuettel | edd at debian.org | http://dirk.eddelbuettel.com


From frobnutz at sogetthis.com  Thu Jul 19 03:56:54 2012
From: frobnutz at sogetthis.com (chuckles the clone)
Date: Wed, 18 Jul 2012 18:56:54 -0700 (PDT)
Subject: [Rd] installing spam package is failing (spam_0.29-1)
In-Reply-To: <20487.24553.429801.104381@max.nulle.part>
References: <50048503.2050603@openanalytics.eu>
	<1342506847825-4636727.post@n4.nabble.com>
	<50051ADD.1030101@heatherturner.net>
	<1342634529375-4636918.post@n4.nabble.com>
	<CAHA9McO=TEt_o_Yixd2UedzMShtGi7ZrTSoxCDEOCUXXxcxcOw@mail.gmail.com>
	<1342636516196-4636929.post@n4.nabble.com>
	<40567AF0-0A7B-4679-94B8-7783B837E757@gmail.com>
	<1342654247105-4636972.post@n4.nabble.com>
	<1342654852280-4636973.post@n4.nabble.com>
	<20487.24553.429801.104381@max.nulle.part>
Message-ID: <1342663014047-4636981.post@n4.nabble.com>

No, I repaired that immediately and tried again. It failed in the same way,
re-installing the
old version. I tried commenting out everything in the sources list except
the CRAN archive
and then R could not be installed.

Sorry, no. I does not "just work". 

>From what I can tell, the initial install was done from one of the ubuntu,
not CRAN, 
repositories. And the version there was 2.13. Once that has happened, it
does not 
appear to be possible to upgrade to 2.15 at all.


As a result, I am upgrading my ENTIRE INSTALLATION of ubuntu. In hopes that
that
might kick something in the broken apt-get repository and maybe I'll get a
new version
of R.



But still, this is all JUST SO I CAN INSTALL THE "SPAM" PACKAGE! The spam
package dependencies 
are broken such that it does not "just work". The latest "spam" package
CANNOT be installed
on R version 2.13 AND YET IT TRIES AND THERE DOES NOT SEEM TO BE ANY WAY TO
CAUSE
AN EARLIER VERSION TO BE INSTALLED INSTEAD.


I'm sorry that attempting to get your just-works system to install does not
work to the point
where I have to ask for assistance. But it does not. And there is no
documentation which
even poorly describes what is happening here. So I have no recourse but to
ask. I am happy
it works for you as a maintainer and apologise that it does not for me, a
user.


--
View this message in context: http://r.789695.n4.nabble.com/installing-spam-package-is-failing-spam-0-29-1-tp4636628p4636981.html
Sent from the R devel mailing list archive at Nabble.com.


From brian at braverock.com  Thu Jul 19 04:00:35 2012
From: brian at braverock.com (Brian G. Peterson)
Date: Wed, 18 Jul 2012 21:00:35 -0500
Subject: [Rd] installing spam package is failing (spam_0.29-1)
In-Reply-To: <1342663014047-4636981.post@n4.nabble.com>
References: <50048503.2050603@openanalytics.eu>
	<1342506847825-4636727.post@n4.nabble.com>
	<50051ADD.1030101@heatherturner.net>
	<1342634529375-4636918.post@n4.nabble.com>
	<CAHA9McO=TEt_o_Yixd2UedzMShtGi7ZrTSoxCDEOCUXXxcxcOw@mail.gmail.com>
	<1342636516196-4636929.post@n4.nabble.com>
	<40567AF0-0A7B-4679-94B8-7783B837E757@gmail.com>
	<1342654247105-4636972.post@n4.nabble.com>
	<1342654852280-4636973.post@n4.nabble.com>
	<20487.24553.429801.104381@max.nulle.part>
	<1342663014047-4636981.post@n4.nabble.com>
Message-ID: <50076A43.1020603@braverock.com>

On 07/18/2012 08:56 PM, chuckles the clone wrote:
> As a result, I am upgrading my ENTIRE INSTALLATION of ubuntu. In hopes that
> that might kick something in the broken apt-get repository and maybe I'll get a
> new version of R.
And then please take this discussion to r-sig-debian.


From david.hastie at rsimony.com  Wed Jul 18 19:36:44 2012
From: david.hastie at rsimony.com (David Hastie)
Date: Wed, 18 Jul 2012 18:36:44 +0100
Subject: [Rd] Warning when sourcing file after require
Message-ID: <CAGf+n7V+zUJ1dBUsGmTXoa1nBNbMv=G6TbveMXCjOV7Nzb5T0Q@mail.gmail.com>

Hi

I have recently upgraded to R 2.15.1. Since the upgrade, I am getting
some odd behaviour that I don't understand. If I source a file which
has a function with a require (or library) statement in it, then the
first time I source it behaves as expected. If I then call the
function (so that the require statement is evaluated) the function
also runs ok. However, if I then subsequently try to source the file
again I get an .Internal(eval.with.vis) warning.

At first I obviously thought it must be an error of mine in the file
containing the functions I had written. However, subsequent tests show
that even if the following code

foo<-function(){
   require(XML)
   cat("This is a test fn\n")
}

is put in the file foo.R, then running the following code gives the warning.

> source('foo.R')
> foo()
Loading required package: XML
This is a test fn
> source('foo.R')
Warning message:
In eval.with.vis(ei, envir) :
  .Internal(eval.with.vis) should not be used and will be removed soon

The key part to this is the inclusion of the require statement. If the
require statement was not in the function, then there are no warnings.
I experience this behaviour on my desktop running Ubuntu 12.04 and on
my Mac running OSX. From looking at the change log of 2.15.1 I notice
that the way files are sourced has changed (and seems to relate to
this warning), but it is not clear to me what if anything this means I
should change.

I would be grateful for any tips.

Kind regards
Dave

--
David Hastie, Ph.D.


From murdoch.duncan at gmail.com  Thu Jul 19 13:46:27 2012
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Thu, 19 Jul 2012 07:46:27 -0400
Subject: [Rd] Warning when sourcing file after require
In-Reply-To: <CAGf+n7V+zUJ1dBUsGmTXoa1nBNbMv=G6TbveMXCjOV7Nzb5T0Q@mail.gmail.com>
References: <CAGf+n7V+zUJ1dBUsGmTXoa1nBNbMv=G6TbveMXCjOV7Nzb5T0Q@mail.gmail.com>
Message-ID: <5007F393.90103@gmail.com>

I don't see this in R-patched; I don't have 2.15.1 installed on this 
machine.  But the problem appears to be that XML exports a function 
called source() (a generic), and you're using it -- but not the current 
version, which doesn't give the warning.

Duncan Murdoch

On 12-07-18 1:36 PM, David Hastie wrote:
> Hi
>
> I have recently upgraded to R 2.15.1. Since the upgrade, I am getting
> some odd behaviour that I don't understand. If I source a file which
> has a function with a require (or library) statement in it, then the
> first time I source it behaves as expected. If I then call the
> function (so that the require statement is evaluated) the function
> also runs ok. However, if I then subsequently try to source the file
> again I get an .Internal(eval.with.vis) warning.
>
> At first I obviously thought it must be an error of mine in the file
> containing the functions I had written. However, subsequent tests show
> that even if the following code
>
> foo<-function(){
>     require(XML)
>     cat("This is a test fn\n")
> }
>
> is put in the file foo.R, then running the following code gives the warning.
>
>> source('foo.R')
>> foo()
> Loading required package: XML
> This is a test fn
>> source('foo.R')
> Warning message:
> In eval.with.vis(ei, envir) :
>    .Internal(eval.with.vis) should not be used and will be removed soon
>
> The key part to this is the inclusion of the require statement. If the
> require statement was not in the function, then there are no warnings.
> I experience this behaviour on my desktop running Ubuntu 12.04 and on
> my Mac running OSX. From looking at the change log of 2.15.1 I notice
> that the way files are sourced has changed (and seems to relate to
> this warning), but it is not clear to me what if anything this means I
> should change.
>
> I would be grateful for any tips.
>
> Kind regards
> Dave
>
> --
> David Hastie, Ph.D.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From ripley at stats.ox.ac.uk  Thu Jul 19 14:31:54 2012
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 19 Jul 2012 13:31:54 +0100
Subject: [Rd] Warning when sourcing file after require
In-Reply-To: <5007F393.90103@gmail.com>
References: <CAGf+n7V+zUJ1dBUsGmTXoa1nBNbMv=G6TbveMXCjOV7Nzb5T0Q@mail.gmail.com>
	<5007F393.90103@gmail.com>
Message-ID: <5007FE3A.5000202@stats.ox.ac.uk>

On 19/07/2012 12:46, Duncan Murdoch wrote:
> I don't see this in R-patched; I don't have 2.15.1 installed on this
> machine.  But the problem appears to be that XML exports a function
> called source() (a generic), and you're using it -- but not the current
> version, which doesn't give the warning.

Whenever you upgrade your R you need to re-install your packages.  And 
this is particularly true of noisome packages (mainly using the 
'methods' package) which make copies of code from R itself.  XML is a 
known example.

conflicts()
update.packages(checkBuilt=TRUE)

are your friends. E.g.

 > library(XML)
 > conflicts(, TRUE)
$`package:XML`
[1] "coerce" "show"   "source"

$`package:methods`
[1] "coerce"    "show"      "body<-"    "kronecker"

$`package:base`
[1] "body<-"    "kronecker" "source"


>
> Duncan Murdoch
>
> On 12-07-18 1:36 PM, David Hastie wrote:
>> Hi
>>
>> I have recently upgraded to R 2.15.1. Since the upgrade, I am getting
>> some odd behaviour that I don't understand. If I source a file which
>> has a function with a require (or library) statement in it, then the
>> first time I source it behaves as expected. If I then call the
>> function (so that the require statement is evaluated) the function
>> also runs ok. However, if I then subsequently try to source the file
>> again I get an .Internal(eval.with.vis) warning.
>>
>> At first I obviously thought it must be an error of mine in the file
>> containing the functions I had written. However, subsequent tests show
>> that even if the following code
>>
>> foo<-function(){
>>     require(XML)
>>     cat("This is a test fn\n")
>> }
>>
>> is put in the file foo.R, then running the following code gives the
>> warning.
>>
>>> source('foo.R')
>>> foo()
>> Loading required package: XML
>> This is a test fn
>>> source('foo.R')
>> Warning message:
>> In eval.with.vis(ei, envir) :
>>    .Internal(eval.with.vis) should not be used and will be removed soon
>>
>> The key part to this is the inclusion of the require statement. If the
>> require statement was not in the function, then there are no warnings.
>> I experience this behaviour on my desktop running Ubuntu 12.04 and on
>> my Mac running OSX. From looking at the change log of 2.15.1 I notice
>> that the way files are sourced has changed (and seems to relate to
>> this warning), but it is not clear to me what if anything this means I
>> should change.
>>
>> I would be grateful for any tips.
>>
>> Kind regards
>> Dave
>>
>> --
>> David Hastie, Ph.D.
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From pauljohn32 at gmail.com  Thu Jul 19 18:13:12 2012
From: pauljohn32 at gmail.com (Paul Johnson)
Date: Thu, 19 Jul 2012 11:13:12 -0500
Subject: [Rd] Are R packages supposed to be "relocatable"? (avoiding
	BioConductor scripts...)
Message-ID: <CAErODj_84GbOi4hL5sx43aDkh6YAqrAndDETf2uT2zH=mgy=LQ@mail.gmail.com>

I've asked a question in the BioConductor list about package
management. My solution depends on your answer to the following
question.

Are installed R packages "relocatable"?

I mean relocatable in the same sense that files in a RedHat RPM file
might be "relocatable" after compiling
(http://www.rpm.org/max-rpm/ch-rpm-reloc.html).  This allows one to
build a package as the ordinary user and then the root user can take
the result and put it wherever it fits well in the path (say,
/usr/local/lib/R/library).

Here is why I asked.  I manage packages in our cluster and some users
have asked me to install some BioConductor packages.  BioConductor
install documents expect me to run a script as root that does a bunch
of changes, and I'm just unwilling to do that.  If I have to do
something as root, it has to be something more focused like running a
particular R command (install.packages(), for example).  It seems
insane to me that they expect (http://www.bioconductor.org/install) a
root user to run

source("http://bioconductor.org/biocLite.R")
biocLite("limma")

If I could do the installs as me with their script, and then copy the
install folder into the system, then it would be OK, if the packages
would work.

Or perhaps post-processing is required to fiddle some paths inside
package files?

pj
-- 
Paul E. Johnson
Professor, Political Science    Assoc. Director
1541 Lilac Lane, Room 504     Center for Research Methods
University of Kansas               University of Kansas
http://pj.freefaculty.org            http://quant.ku.edu


From maechler at stat.math.ethz.ch  Thu Jul 19 18:51:06 2012
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Thu, 19 Jul 2012 18:51:06 +0200
Subject: [Rd] installing spam package is failing (spam_0.29-1)
In-Reply-To: <20487.24553.429801.104381@max.nulle.part>
References: <50040FDD.4020307@statistik.tu-dortmund.de>
	<1342465540428-4636676.post@n4.nabble.com>
	<50048503.2050603@openanalytics.eu>
	<1342506847825-4636727.post@n4.nabble.com>
	<50051ADD.1030101@heatherturner.net>
	<1342634529375-4636918.post@n4.nabble.com>
	<CAHA9McO=TEt_o_Yixd2UedzMShtGi7ZrTSoxCDEOCUXXxcxcOw@mail.gmail.com>
	<1342636516196-4636929.post@n4.nabble.com>
	<40567AF0-0A7B-4679-94B8-7783B837E757@gmail.com>
	<1342654247105-4636972.post@n4.nabble.com>
	<1342654852280-4636973.post@n4.nabble.com>
	<20487.24553.429801.104381@max.nulle.part>
Message-ID: <20488.15098.194070.536356@stat.math.ethz.ch>

>>>>> Dirk Eddelbuettel <edd at debian.org>
>>>>>     on Wed, 18 Jul 2012 20:16:25 -0500 writes:

    > For Pete's sake, could you please stop spamming the
    > r-devel list?

Indeed! R-devel is reserved for people who do their homework!

I've added "moderation" for Mr. Clone.

Martin Maechler,
ETH Zurich

    > We have a dedicated list r-sig-debian for questions
    > related to R on Debian/Ubuntu.  Please use it.

    > And as as far as I can tell, Peter already told you what's
    > up:

    >    deb
    > http://http://cran.cnr.Berkeley.edu/bin/linux/ubuntu
    > oneiric/ ^^^^^^^^^^^^

    > [....]


From jeroen.ooms at stat.ucla.edu  Thu Jul 19 19:30:00 2012
From: jeroen.ooms at stat.ucla.edu (Jeroen Ooms)
Date: Thu, 19 Jul 2012 19:30:00 +0200
Subject: [Rd] On RObjectTables
Message-ID: <CABFfbXv480ciNg3vphvwwvZvX03vvWABGRRT8a7SgRn25wPXgg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20120719/e02bcb67/attachment.pl>

From lawrence.michael at gene.com  Thu Jul 19 20:51:49 2012
From: lawrence.michael at gene.com (Michael Lawrence)
Date: Thu, 19 Jul 2012 11:51:49 -0700
Subject: [Rd] On RObjectTables
In-Reply-To: <CABFfbXv480ciNg3vphvwwvZvX03vvWABGRRT8a7SgRn25wPXgg@mail.gmail.com>
References: <CABFfbXv480ciNg3vphvwwvZvX03vvWABGRRT8a7SgRn25wPXgg@mail.gmail.com>
Message-ID: <CAOQ5NyeD--7LVYfLX4QOqqJOEjVeoreH7GPrt7xwQ-8z1u_OJw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20120719/08cc3a66/attachment.pl>

From simon.urbanek at r-project.org  Thu Jul 19 22:24:57 2012
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Thu, 19 Jul 2012 16:24:57 -0400
Subject: [Rd] Are R packages supposed to be "relocatable"? (avoiding
	BioConductor scripts...)
In-Reply-To: <CAErODj_84GbOi4hL5sx43aDkh6YAqrAndDETf2uT2zH=mgy=LQ@mail.gmail.com>
References: <CAErODj_84GbOi4hL5sx43aDkh6YAqrAndDETf2uT2zH=mgy=LQ@mail.gmail.com>
Message-ID: <EAA4E11E-A889-4DE3-969F-678D6585EFF8@r-project.org>


On Jul 19, 2012, at 12:13 PM, Paul Johnson wrote:

> I've asked a question in the BioConductor list about package
> management. My solution depends on your answer to the following
> question.
> 
> Are installed R packages "relocatable"?
> 

It depends on the platform and what you want to relocate (R or just the packages) and on the package itself. For example on OS X absolute paths are included in dylibs, so you can move packages that allow it and don't link to other packages but you can't relocate R or packages that link to other packages directly or libraries within the package (that should be rare, though). Whether a package allows relocation depends whether it hard-codes any paths it uses - typical packages use facilities like system.file to locate files so those are relocatable, but if a package determines paths at configure time it may not be relocatable.

Since you didn't even specify the platform you're interested in, this is only a generic answer ...


> I mean relocatable in the same sense that files in a RedHat RPM file
> might be "relocatable" after compiling
> (http://www.rpm.org/max-rpm/ch-rpm-reloc.html).  This allows one to
> build a package as the ordinary user and then the root user can take
> the result and put it wherever it fits well in the path (say,
> /usr/local/lib/R/library).
> 
> Here is why I asked.  I manage packages in our cluster and some users
> have asked me to install some BioConductor packages.  BioConductor
> install documents expect me to run a script as root that does a bunch
> of changes, and I'm just unwilling to do that.  If I have to do
> something as root, it has to be something more focused like running a
> particular R command (install.packages(), for example).  It seems
> insane to me that they expect (http://www.bioconductor.org/install) a
> root user to run
> 

You can install BioC packages simply with install.packages() - there is no black magic involved, it's a regular repository just like CRAN ...

Cheers,
Simon


> source("http://bioconductor.org/biocLite.R")
> biocLite("limma")
> 
> If I could do the installs as me with their script, and then copy the
> install folder into the system, then it would be OK, if the packages
> would work.
> 
> Or perhaps post-processing is required to fiddle some paths inside
> package files?
> 
> pj
> -- 
> Paul E. Johnson
> Professor, Political Science    Assoc. Director
> 1541 Lilac Lane, Room 504     Center for Research Methods
> University of Kansas               University of Kansas
> http://pj.freefaculty.org            http://quant.ku.edu
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 


From xie at yihui.name  Thu Jul 19 22:41:12 2012
From: xie at yihui.name (Yihui Xie)
Date: Thu, 19 Jul 2012 16:41:12 -0400
Subject: [Rd] Changes to parser in R-devel
In-Reply-To: <500700FB.4000606@gmail.com>
References: <500700FB.4000606@gmail.com>
Message-ID: <CANROs4eTStRa=rWOqhdjBvBPJuaKM303zVeMT9BW3ED9R6B8zw@mail.gmail.com>

I'm not sure if there is a bug somewhere; see this example:

getParseData(parse(text='function(x){}'))

  line1 col1 line2 col2 id parent          token terminal     text
1     1    1     1    8  1     11       FUNCTION     TRUE function
2     1    9     1    9  2     11            '('     TRUE        (
3     1   10     1   10  3      5 SYMBOL_FORMALS     TRUE        x
4     1   11     1   11  4     11            ')'     TRUE        )
5     1   12     1   12  6      8            '{'     TRUE        {
6     1   13     1   13  7      8            '}'     TRUE        }
7     1   12     1   12  5     11            '}'     TRUE        {
8     1   12     1   13  8     11           expr    FALSE
9     1    1     1   13 11      0           expr    FALSE

I get an additional { in the 7th row of the 'text' column.

Another problem is that for this empty function below, there will be
an obvious pause if you run it more than once:

getParseData(parse(text='function(){}'))

and you may get wild line/col numbers like this:

   line1 col1     line2 col2 id parent    token terminal     text
1      1    1         1    8  1      9 FUNCTION     TRUE function
2      1    9         1    9  2      9      '('     TRUE        (
3      1   10         1   10  3      9      ')'     TRUE        )
4      1   11         1   11  4      6      '{'     TRUE        {
5      1   12         1   12  5      6      '}'     TRUE        }
6 320024   11 140106360   11 11      9      '}'     TRUE
7      1   11         1   12  6      9     expr    FALSE
8      1    1         1   12  9     11     expr    FALSE

What is worse is it can crash R:

 *** caught segfault ***
address 0x9488c20, cause 'memory not mapped'

Traceback:
 1: parse(text = "function(){}")
 2: getSrcref(x)
 3: getSrcfile(x)
 4: getParseData(parse(text = "function(){}"))


> sessionInfo()
R Under development (unstable) (2012-07-18 r59904)
Platform: i686-pc-linux-gnu (32-bit)

locale:
 [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
 [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
 [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
 [7] LC_PAPER=C                 LC_NAME=C
 [9] LC_ADDRESS=C               LC_TELEPHONE=C
[11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base


Regards,
Yihui
--
Yihui Xie <xieyihui at gmail.com>
Phone: 515-294-2465 Web: http://yihui.name
Department of Statistics, Iowa State University
2215 Snedecor Hall, Ames, IA


On Wed, Jul 18, 2012 at 2:31 PM, Duncan Murdoch
<murdoch.duncan at gmail.com> wrote:
> I have just committed (in r59883) some changes to the R parser based on
> Romain Francois' parser package.  Packages that made use of parser will
> hopefully find that the information in base R gives them what they need to
> work with, but the data is not identical to
> what parser recorded (since it was not consistent with some things already
> in R).  One reason for the change was that the parser in the parser package
> was slightly different than the one in R; the hope is that by providing the
> services in R, it will make maintenance easier for things like code
> analysis, pretty printing, etc.
>
> See ?getParseData for details, and if you are maintaining a package that
> depends on parser, feel free to ask me for help in the transition, or make
> suggestions for changes if I've done something that causes you too much
> trouble.
>
> Duncan Murdoch
>
> P.S. to Qiang Li:  as mentioned privately, the goal for this change was to
> reproduce output equivalent to what parser did, so I have not incorporated
> your suggested change to outlaw expressions like "x[[1] ]"  (with an
> embedded space where it shouldn't be).  After things settle down we can
> consider that change and others.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From ripley at stats.ox.ac.uk  Thu Jul 19 22:41:27 2012
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 19 Jul 2012 21:41:27 +0100
Subject: [Rd] Are R packages supposed to be "relocatable"? (avoiding
 BioConductor scripts...)
In-Reply-To: <CAErODj_84GbOi4hL5sx43aDkh6YAqrAndDETf2uT2zH=mgy=LQ@mail.gmail.com>
References: <CAErODj_84GbOi4hL5sx43aDkh6YAqrAndDETf2uT2zH=mgy=LQ@mail.gmail.com>
Message-ID: <500870F7.4080507@stats.ox.ac.uk>

Short answer:

setRepositories() # chose what you want from BioC
install.packages()

works and always has. 'Smoke and mirrors' are not actually needed.

As for relocatability:

I am guessing you are talking about a Linux cluster ... but the details 
do matter.

The distribution of Windows binaries relies on installed packages being 
relocatable, so most packages are written to be.  There are a very few 
exceptions: the one most frequently encountered is packages linked to 
Rcpp, which on Linux put the path to Rcpp in their DSOs.  So you can 
relocate the package, but not the Rcpp installation it is linked to. 
(Not a problem on other OSes as it statically links elsewhere.)

A question you did not ask is if you can use differently located R: in 
most cases yes (I regularly run different versions of R with the same 
library trees).

We've relocated complete CRAN/BioC installations on Linux several times.

On 19/07/2012 17:13, Paul Johnson wrote:
> I've asked a question in the BioConductor list about package
> management. My solution depends on your answer to the following
> question.
>
> Are installed R packages "relocatable"?
>
> I mean relocatable in the same sense that files in a RedHat RPM file
> might be "relocatable" after compiling
> (http://www.rpm.org/max-rpm/ch-rpm-reloc.html).  This allows one to
> build a package as the ordinary user and then the root user can take
> the result and put it wherever it fits well in the path (say,
> /usr/local/lib/R/library).
>
> Here is why I asked.  I manage packages in our cluster and some users
> have asked me to install some BioConductor packages.  BioConductor
> install documents expect me to run a script as root that does a bunch
> of changes, and I'm just unwilling to do that.  If I have to do
> something as root, it has to be something more focused like running a
> particular R command (install.packages(), for example).  It seems
> insane to me that they expect (http://www.bioconductor.org/install) a
> root user to run
>
> source("http://bioconductor.org/biocLite.R")
> biocLite("limma")
>
> If I could do the installs as me with their script, and then copy the
> install folder into the system, then it would be OK, if the packages
> would work.
>
> Or perhaps post-processing is required to fiddle some paths inside
> package files?
>
> pj
>


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From murdoch.duncan at gmail.com  Fri Jul 20 00:50:12 2012
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Thu, 19 Jul 2012 18:50:12 -0400
Subject: [Rd] Changes to parser in R-devel
In-Reply-To: <CANROs4eTStRa=rWOqhdjBvBPJuaKM303zVeMT9BW3ED9R6B8zw@mail.gmail.com>
References: <500700FB.4000606@gmail.com>
	<CANROs4eTStRa=rWOqhdjBvBPJuaKM303zVeMT9BW3ED9R6B8zw@mail.gmail.com>
Message-ID: <50088F24.7050100@gmail.com>

On 12-07-19 4:41 PM, Yihui Xie wrote:
> I'm not sure if there is a bug somewhere; see this example:

There's definitely a bug in the handling of empty lists, such as the 
empty list of commands in your first example and the empty list of 
arguments in your second.  There's a partial workaround currently in 
R-devel, but not a perfect fix.  (This is due to me missing a conversion 
from Romain's 0-based column counting to the usual 1-based counting.)

I expect it will be fixed tomorrow, or sooner.

Duncan Murdoch

>
> getParseData(parse(text='function(x){}'))
>
>    line1 col1 line2 col2 id parent          token terminal     text
> 1     1    1     1    8  1     11       FUNCTION     TRUE function
> 2     1    9     1    9  2     11            '('     TRUE        (
> 3     1   10     1   10  3      5 SYMBOL_FORMALS     TRUE        x
> 4     1   11     1   11  4     11            ')'     TRUE        )
> 5     1   12     1   12  6      8            '{'     TRUE        {
> 6     1   13     1   13  7      8            '}'     TRUE        }
> 7     1   12     1   12  5     11            '}'     TRUE        {
> 8     1   12     1   13  8     11           expr    FALSE
> 9     1    1     1   13 11      0           expr    FALSE
>
> I get an additional { in the 7th row of the 'text' column.
>
> Another problem is that for this empty function below, there will be
> an obvious pause if you run it more than once:
>
> getParseData(parse(text='function(){}'))
>
> and you may get wild line/col numbers like this:
>
>     line1 col1     line2 col2 id parent    token terminal     text
> 1      1    1         1    8  1      9 FUNCTION     TRUE function
> 2      1    9         1    9  2      9      '('     TRUE        (
> 3      1   10         1   10  3      9      ')'     TRUE        )
> 4      1   11         1   11  4      6      '{'     TRUE        {
> 5      1   12         1   12  5      6      '}'     TRUE        }
> 6 320024   11 140106360   11 11      9      '}'     TRUE
> 7      1   11         1   12  6      9     expr    FALSE
> 8      1    1         1   12  9     11     expr    FALSE
>
> What is worse is it can crash R:
>
>   *** caught segfault ***
> address 0x9488c20, cause 'memory not mapped'
>
> Traceback:
>   1: parse(text = "function(){}")
>   2: getSrcref(x)
>   3: getSrcfile(x)
>   4: getParseData(parse(text = "function(){}"))
>
>
>> sessionInfo()
> R Under development (unstable) (2012-07-18 r59904)
> Platform: i686-pc-linux-gnu (32-bit)
>
> locale:
>   [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
>   [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
>   [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
>   [7] LC_PAPER=C                 LC_NAME=C
>   [9] LC_ADDRESS=C               LC_TELEPHONE=C
> [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
>
> Regards,
> Yihui
> --
> Yihui Xie <xieyihui at gmail.com>
> Phone: 515-294-2465 Web: http://yihui.name
> Department of Statistics, Iowa State University
> 2215 Snedecor Hall, Ames, IA
>
>
> On Wed, Jul 18, 2012 at 2:31 PM, Duncan Murdoch
> <murdoch.duncan at gmail.com> wrote:
>> I have just committed (in r59883) some changes to the R parser based on
>> Romain Francois' parser package.  Packages that made use of parser will
>> hopefully find that the information in base R gives them what they need to
>> work with, but the data is not identical to
>> what parser recorded (since it was not consistent with some things already
>> in R).  One reason for the change was that the parser in the parser package
>> was slightly different than the one in R; the hope is that by providing the
>> services in R, it will make maintenance easier for things like code
>> analysis, pretty printing, etc.
>>
>> See ?getParseData for details, and if you are maintaining a package that
>> depends on parser, feel free to ask me for help in the transition, or make
>> suggestions for changes if I've done something that causes you too much
>> trouble.
>>
>> Duncan Murdoch
>>
>> P.S. to Qiang Li:  as mentioned privately, the goal for this change was to
>> reproduce output equivalent to what parser did, so I have not incorporated
>> your suggested change to outlaw expressions like "x[[1] ]"  (with an
>> embedded space where it shouldn't be).  After things settle down we can
>> consider that change and others.
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel


From mtmorgan at fhcrc.org  Fri Jul 20 01:20:17 2012
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Thu, 19 Jul 2012 16:20:17 -0700
Subject: [Rd] Are R packages supposed to be "relocatable"? (avoiding
 BioConductor scripts...)
In-Reply-To: <CAErODj_84GbOi4hL5sx43aDkh6YAqrAndDETf2uT2zH=mgy=LQ@mail.gmail.com>
References: <CAErODj_84GbOi4hL5sx43aDkh6YAqrAndDETf2uT2zH=mgy=LQ@mail.gmail.com>
Message-ID: <50089631.3010406@fhcrc.org>

On 07/19/2012 09:13 AM, Paul Johnson wrote:
> I've asked a question in the BioConductor list about package
> management. My solution depends on your answer to the following
> question.
>
> Are installed R packages "relocatable"?
>
> I mean relocatable in the same sense that files in a RedHat RPM file
> might be "relocatable" after compiling
> (http://www.rpm.org/max-rpm/ch-rpm-reloc.html).  This allows one to
> build a package as the ordinary user and then the root user can take
> the result and put it wherever it fits well in the path (say,
> /usr/local/lib/R/library).
>
> Here is why I asked.  I manage packages in our cluster and some users
> have asked me to install some BioConductor packages.  BioConductor
> install documents expect me to run a script as root that does a bunch
> of changes, and I'm just unwilling to do that.  If I have to do
> something as root, it has to be something more focused like running a
> particular R command (install.packages(), for example).  It seems
> insane to me that they expect (http://www.bioconductor.org/install) a
> root user to run
>
> source("http://bioconductor.org/biocLite.R")
> biocLite("limma")

For the record, this does four things.

(1) The 'source' command installs the BiocInstaller package appropriate 
for your (recent) version of R or, if this package is already installed, 
attaches it.

All remaining steps are executed by scripts in the BiocInstaller 
package, so after an initial invocation the 'source()' statement can be 
replaced by library(BiocInstaller).

(2) biocLite() invokes BiocInstaller::biocLite, which checks whether 
BiocInstaller is current and, if not, updates it. Disable this behaviour 
with the option suppressAutoUpdate=TRUE.

(3) The limma package and needed dependencies are installed, using 
install.packages() and the repositories appropriate for your version of 
R (paying attention to utils::setRepositories() and 
utils::chooseBioCmirror()). The 'lib' argument to biocLite is passed to 
install.packages() so the user has control over the directory in which 
packages will be installed.

(4) biocLite checks whether any packages are out-of-date relative to the 
version in the repository, and offers to update those that are out of 
date. Packages that are in directories that cannot be written are 
reported, via a warning and hence when biocLite finishes, as "installed 
directory not writeable, cannot update packages '...'" (this message 
apparently confused you; we will try for a better wording). Use 
suppressUpdates=TRUE to suppress this step, ask=FALSE to have old 
packages (in writeable directories) updated without being prompted; a 
lib.loc argument can be used to restrict the locations where 
old.packages() searches.

The arguments to biocLite are documented on its help page in the 
BiocInstaller package, ?biocLite.


For step (3), Prof Ripley & Dr Urbanek (and me in my response to your 
Bioconductor post, 
https://stat.ethz.ch/pipermail/bioconductor/2012-July/046999.html) are 
correct in stating that this can be done with a direct call to 
install.packages().

Step (4) arises because Bioconductor packages (a) follow a semi-annual 
release cycle, with a 'release' and 'devel' branch, and (b) generally 
have greater dependencies amongst one another. In the past, two very 
common scenarios leading to problems were that user installations mix 
packages from different releases of Bioconductor, and users report bugs 
that have already been addressed via bug fixes to the current release. 
So step (4) is trying to be pro-active, and based on traffic to the 
mailing list this has generally been successful. This synchronization is 
more important, and difficult for the user to manage directly, now that 
R has moved to an annual release cycle.

Steps (1) and (2) are needed to bootstrap the process. The relatively 
recent introduction of the BiocInstaller package allows us to document 
biocLite in a standard way, as well as provide the code in a more 
familiar fashion. Step (1) is partly a legacy (BiocInstaller is not in 
all releases of Bioconductor), and partly a simplification to avoid 
confusion (avoiding 'first time users should do A, return users should 
do B').


As a 'normal' user it is safe and appropriate to use biocLite to manage 
Bioconductor (and CRAN) packages. One takes a more cautious approach as 
'root', but I personally would be comfortable administering a widely 
used R / Bioconductor installation with biocLite.

Martin Morgan
Bioconductor


> If I could do the installs as me with their script, and then copy the
> install folder into the system, then it would be OK, if the packages
> would work.
>
> Or perhaps post-processing is required to fiddle some paths inside
> package files?
>
> pj
>


-- 
Computational Biology / Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N.
PO Box 19024 Seattle, WA 98109

Location: Arnold Building M1 B861
Phone: (206) 667-2793


From spencer.graves at structuremonitoring.com  Fri Jul 20 05:29:38 2012
From: spencer.graves at structuremonitoring.com (Spencer Graves)
Date: Thu, 19 Jul 2012 20:29:38 -0700
Subject: [Rd] subRaw?
Message-ID: <5008D0A2.5070009@structuremonitoring.com>

Hello, All:


       Do you know of any capability to substitute more then one byte in 
an object of class Raw?


       Consider the following:


 > let4 <- paste(letters[1:4], collapse='')
 > (let4Raw <- charToRaw(let4))
[1] 61 62 63 64
 > (let. <- sub('bc', '--', let4Raw))
[1] "61" "62" "63" "64"
 > # no substitution
 > (bc <- charToRaw('bc'))
[1] 62 63
 > (ef <- charToRaw('ef'))
[1] 65 66
 > (let. <- sub(bc, ef, let4Raw))
[1] "61" "65" "63" "64"
Warning messages:
1: In sub(bc, ef, let4Raw) :
   argument 'pattern' has length > 1 and only the first element will be used
2: In sub(bc, ef, let4Raw) :
   argument 'replacement' has length > 1 and only the first element will 
be used


       In this example, "b" was replaced by "e", but "bc" was not 
replaced by "ef"?  Do you know of any function to do this?


       I ask, because I need it.  I've written such a function, subRaw 
for my own use.  If I don't hear that another exists, I plan to add the 
one I've written to the oro.dicom package.


       Thanks,
       Spencer


 > sessionInfo()
R version 2.15.1 (2012-06-22)
Platform: x86_64-pc-mingw32/x64 (64-bit)

locale:
[1] LC_COLLATE=English_United States.1252
[2] LC_CTYPE=English_United States.1252
[3] LC_MONETARY=English_United States.1252
[4] LC_NUMERIC=C
[5] LC_TIME=English_United States.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods base

-- 
Spencer Graves, PE, PhD
President and Chief Technology Officer
Structure Inspection and Monitoring, Inc.
751 Emerson Ct.
San Jos?, CA 95126
ph:  408-655-4567
web:  www.structuremonitoring.com


From hpages at fhcrc.org  Fri Jul 20 07:19:11 2012
From: hpages at fhcrc.org (=?ISO-8859-1?Q?Herv=E9_Pag=E8s?=)
Date: Thu, 19 Jul 2012 22:19:11 -0700
Subject: [Rd] subRaw?
In-Reply-To: <5008D0A2.5070009@structuremonitoring.com>
References: <5008D0A2.5070009@structuremonitoring.com>
Message-ID: <5008EA4F.6030100@fhcrc.org>

Hi Spencer,

On 07/19/2012 08:29 PM, Spencer Graves wrote:
> Hello, All:
>
>
>        Do you know of any capability to substitute more then one byte in
> an object of class Raw?
>
>
>        Consider the following:
>
>
>  > let4 <- paste(letters[1:4], collapse='')
>  > (let4Raw <- charToRaw(let4))
> [1] 61 62 63 64
>  > (let. <- sub('bc', '--', let4Raw))
> [1] "61" "62" "63" "64"
>  > # no substitution
>  > (bc <- charToRaw('bc'))
> [1] 62 63
>  > (ef <- charToRaw('ef'))
> [1] 65 66
>  > (let. <- sub(bc, ef, let4Raw))
> [1] "61" "65" "63" "64"
> Warning messages:
> 1: In sub(bc, ef, let4Raw) :
>    argument 'pattern' has length > 1 and only the first element will be
> used
> 2: In sub(bc, ef, let4Raw) :
>    argument 'replacement' has length > 1 and only the first element will
> be used

It makes no sense to use sub(), grep(), and family (i.e. all the stuff
based on the regex code) *directly* on a raw vector because all these
functions will start by coercing their 'x', 'text', 'pattern',
'replacement' args to character with as.character (if they are not
already character).

But the way as.character() operates on a raw vector won't give good
results in that context. You'd rather do the coercion yourself first
with rawToChar(), and coerce back the result with charToRaw():

   > charToRaw(sub("bc", "--", rawToChar(let4Raw)))
   [1] 61 2d 2d 64

IMO it would make much more sense that sub(), grep(), and family()
raise an error than blindly try to coerce to character but these
functions (like many functions in R) are too polite to tell the
user s/he's doing something wrong.

Cheers,
H.

>
>
>        In this example, "b" was replaced by "e", but "bc" was not
> replaced by "ef"?  Do you know of any function to do this?
>
>
>        I ask, because I need it.  I've written such a function, subRaw
> for my own use.  If I don't hear that another exists, I plan to add the
> one I've written to the oro.dicom package.
>
>
>        Thanks,
>        Spencer
>
>
>  > sessionInfo()
> R version 2.15.1 (2012-06-22)
> Platform: x86_64-pc-mingw32/x64 (64-bit)
>
> locale:
> [1] LC_COLLATE=English_United States.1252
> [2] LC_CTYPE=English_United States.1252
> [3] LC_MONETARY=English_United States.1252
> [4] LC_NUMERIC=C
> [5] LC_TIME=English_United States.1252
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods base
>


-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M1-B514
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fhcrc.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From luke-tierney at uiowa.edu  Fri Jul 20 16:32:21 2012
From: luke-tierney at uiowa.edu (luke-tierney at uiowa.edu)
Date: Fri, 20 Jul 2012 09:32:21 -0500
Subject: [Rd] On RObjectTables
In-Reply-To: <CABFfbXv480ciNg3vphvwwvZvX03vvWABGRRT8a7SgRn25wPXgg@mail.gmail.com>
References: <CABFfbXv480ciNg3vphvwwvZvX03vvWABGRRT8a7SgRn25wPXgg@mail.gmail.com>
Message-ID: <alpine.LFD.2.02.1207200928200.1918@nokomis.stat.uiowa.edu>

I believe everyone who has worked on the relevant files has tried to
maintain this functionality, but as it seems to get used and tested
very little I can't be sure it is functional at this point. The
facility in its current form does complicate the internal code and
limit some experiments we might otherwise do, so I would not be
surprised if it was at least substantially changed in the next year or
two.

Best,

luke

On Thu, 19 Jul 2012, Jeroen Ooms wrote:

> I was wondering if anyone knows more about the state of RObjectTables. This
> largely undocumented functionality was introduced by Duncan around 2002
> somewhere and enables you create an environment where the contents are
> dynamically queried by R through a hook function. It is mentioned in R
> Internals and ?attach. This functionality is quite powerful and allows you
> to e.g. offload a big database of R objects to disk, yet use them as if
> they were in your workspace. The recent RProtoBuf package also uses some of
> this functionality to dynamically lookup proto definitions.
>
> I would like to do something similar, but I am not sure if support for this
> functionality will be or has been discontinued. The RObjectTables package
> is no longer available on OmegaHat and nothing has not been mentioned on
> the mailing lists for about 5 years. I found an old version of the package
> no github which seems to work, but as far as I understand, the package
> still needs the hooks from within R to work. So if this functionality is
> actually unsupported and might be removed at some point, I should probably
> not invest in it.
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Luke Tierney
Chair, Statistics and Actuarial Science
Ralph E. Wareham Professor of Mathematical Sciences
University of Iowa                  Phone:             319-335-3386
Department of Statistics and        Fax:               319-335-3017
    Actuarial Science
241 Schaeffer Hall                  email:   luke-tierney at uiowa.edu
Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu


From spencer.graves at structuremonitoring.com  Fri Jul 20 18:22:20 2012
From: spencer.graves at structuremonitoring.com (Spencer Graves)
Date: Fri, 20 Jul 2012 09:22:20 -0700
Subject: [Rd] subRaw?
In-Reply-To: <5008EA4F.6030100@fhcrc.org>
References: <5008D0A2.5070009@structuremonitoring.com>
	<5008EA4F.6030100@fhcrc.org>
Message-ID: <500985BC.8070203@structuremonitoring.com>

Hi, Herv?:


On 7/19/2012 10:19 PM, Herv? Pag?s wrote:
> Hi Spencer,
>
> On 07/19/2012 08:29 PM, Spencer Graves wrote:
>> Hello, All:
>>
>>
>>        Do you know of any capability to substitute more then one byte in
>> an object of class Raw?
>>
>>
>>        Consider the following:
>>
>>
>>  > let4 <- paste(letters[1:4], collapse='')
>>  > (let4Raw <- charToRaw(let4))
>> [1] 61 62 63 64
>>  > (let. <- sub('bc', '--', let4Raw))
>> [1] "61" "62" "63" "64"
>>  > # no substitution
>>  > (bc <- charToRaw('bc'))
>> [1] 62 63
>>  > (ef <- charToRaw('ef'))
>> [1] 65 66
>>  > (let. <- sub(bc, ef, let4Raw))
>> [1] "61" "65" "63" "64"
>> Warning messages:
>> 1: In sub(bc, ef, let4Raw) :
>>    argument 'pattern' has length > 1 and only the first element will be
>> used
>> 2: In sub(bc, ef, let4Raw) :
>>    argument 'replacement' has length > 1 and only the first element will
>> be used
>
> It makes no sense to use sub(), grep(), and family (i.e. all the stuff
> based on the regex code) *directly* on a raw vector because all these
> functions will start by coercing their 'x', 'text', 'pattern',
> 'replacement' args to character with as.character (if they are not
> already character).
>
> But the way as.character() operates on a raw vector won't give good
> results in that context. You'd rather do the coercion yourself first
> with rawToChar(), and coerce back the result with charToRaw():
>
>   > charToRaw(sub("bc", "--", rawToChar(let4Raw)))
>   [1] 61 2d 2d 64
>
> IMO it would make much more sense that sub(), grep(), and family()
> raise an error than blindly try to coerce to character but these
> functions (like many functions in R) are too polite to tell the
> user s/he's doing something wrong.


       Thanks for the reply.


       It sounds like you agree that a function "subRaw" to facilitate 
this would be useful.  In my testing, charToRaw(sub(pattern, 
replacement, rawToChar(x)) did NOT preserve binary codes that did not 
match legitimate characters.  I tried several things before finding one 
that seemed to work.


       Best Wishes,
       Spencer

>
> Cheers,
> H.
>
>>
>>
>>        In this example, "b" was replaced by "e", but "bc" was not
>> replaced by "ef"?  Do you know of any function to do this?
>>
>>
>>        I ask, because I need it.  I've written such a function, subRaw
>> for my own use.  If I don't hear that another exists, I plan to add the
>> one I've written to the oro.dicom package.
>>
>>
>>        Thanks,
>>        Spencer
>>
>>
>>  > sessionInfo()
>> R version 2.15.1 (2012-06-22)
>> Platform: x86_64-pc-mingw32/x64 (64-bit)
>>
>> locale:
>> [1] LC_COLLATE=English_United States.1252
>> [2] LC_CTYPE=English_United States.1252
>> [3] LC_MONETARY=English_United States.1252
>> [4] LC_NUMERIC=C
>> [5] LC_TIME=English_United States.1252
>>
>> attached base packages:
>> [1] stats     graphics  grDevices utils     datasets  methods base
>>


From murdoch.duncan at gmail.com  Fri Jul 20 18:22:25 2012
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Fri, 20 Jul 2012 12:22:25 -0400
Subject: [Rd] Changes to parser in R-devel
In-Reply-To: <50088F24.7050100@gmail.com>
References: <500700FB.4000606@gmail.com>
	<CANROs4eTStRa=rWOqhdjBvBPJuaKM303zVeMT9BW3ED9R6B8zw@mail.gmail.com>
	<50088F24.7050100@gmail.com>
Message-ID: <500985C1.40703@gmail.com>

On 19/07/2012 6:50 PM, Duncan Murdoch wrote:
> On 12-07-19 4:41 PM, Yihui Xie wrote:
> > I'm not sure if there is a bug somewhere; see this example:
>
> There's definitely a bug in the handling of empty lists, such as the
> empty list of commands in your first example and the empty list of
> arguments in your second.  There's a partial workaround currently in
> R-devel, but not a perfect fix.  (This is due to me missing a conversion
> from Romain's 0-based column counting to the usual 1-based counting.)
>
> I expect it will be fixed tomorrow, or sooner.

As far as I know, it is now fixed (in r59913).

Duncan Murdoch

>
> Duncan Murdoch
>
> >
> > getParseData(parse(text='function(x){}'))
> >
> >    line1 col1 line2 col2 id parent          token terminal     text
> > 1     1    1     1    8  1     11       FUNCTION     TRUE function
> > 2     1    9     1    9  2     11            '('     TRUE        (
> > 3     1   10     1   10  3      5 SYMBOL_FORMALS     TRUE        x
> > 4     1   11     1   11  4     11            ')'     TRUE        )
> > 5     1   12     1   12  6      8            '{'     TRUE        {
> > 6     1   13     1   13  7      8            '}'     TRUE        }
> > 7     1   12     1   12  5     11            '}'     TRUE        {
> > 8     1   12     1   13  8     11           expr    FALSE
> > 9     1    1     1   13 11      0           expr    FALSE
> >
> > I get an additional { in the 7th row of the 'text' column.
> >
> > Another problem is that for this empty function below, there will be
> > an obvious pause if you run it more than once:
> >
> > getParseData(parse(text='function(){}'))
> >
> > and you may get wild line/col numbers like this:
> >
> >     line1 col1     line2 col2 id parent    token terminal     text
> > 1      1    1         1    8  1      9 FUNCTION     TRUE function
> > 2      1    9         1    9  2      9      '('     TRUE        (
> > 3      1   10         1   10  3      9      ')'     TRUE        )
> > 4      1   11         1   11  4      6      '{'     TRUE        {
> > 5      1   12         1   12  5      6      '}'     TRUE        }
> > 6 320024   11 140106360   11 11      9      '}'     TRUE
> > 7      1   11         1   12  6      9     expr    FALSE
> > 8      1    1         1   12  9     11     expr    FALSE
> >
> > What is worse is it can crash R:
> >
> >   *** caught segfault ***
> > address 0x9488c20, cause 'memory not mapped'
> >
> > Traceback:
> >   1: parse(text = "function(){}")
> >   2: getSrcref(x)
> >   3: getSrcfile(x)
> >   4: getParseData(parse(text = "function(){}"))
> >
> >
> >> sessionInfo()
> > R Under development (unstable) (2012-07-18 r59904)
> > Platform: i686-pc-linux-gnu (32-bit)
> >
> > locale:
> >   [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
> >   [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
> >   [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
> >   [7] LC_PAPER=C                 LC_NAME=C
> >   [9] LC_ADDRESS=C               LC_TELEPHONE=C
> > [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
> >
> > attached base packages:
> > [1] stats     graphics  grDevices utils     datasets  methods   base
> >
> >
> > Regards,
> > Yihui
> > --
> > Yihui Xie <xieyihui at gmail.com>
> > Phone: 515-294-2465 Web: http://yihui.name
> > Department of Statistics, Iowa State University
> > 2215 Snedecor Hall, Ames, IA
> >
> >
> > On Wed, Jul 18, 2012 at 2:31 PM, Duncan Murdoch
> > <murdoch.duncan at gmail.com> wrote:
> >> I have just committed (in r59883) some changes to the R parser based on
> >> Romain Francois' parser package.  Packages that made use of parser will
> >> hopefully find that the information in base R gives them what they need to
> >> work with, but the data is not identical to
> >> what parser recorded (since it was not consistent with some things already
> >> in R).  One reason for the change was that the parser in the parser package
> >> was slightly different than the one in R; the hope is that by providing the
> >> services in R, it will make maintenance easier for things like code
> >> analysis, pretty printing, etc.
> >>
> >> See ?getParseData for details, and if you are maintaining a package that
> >> depends on parser, feel free to ask me for help in the transition, or make
> >> suggestions for changes if I've done something that causes you too much
> >> trouble.
> >>
> >> Duncan Murdoch
> >>
> >> P.S. to Qiang Li:  as mentioned privately, the goal for this change was to
> >> reproduce output equivalent to what parser did, so I have not incorporated
> >> your suggested change to outlaw expressions like "x[[1] ]"  (with an
> >> embedded space where it shouldn't be).  After things settle down we can
> >> consider that change and others.
> >>
> >> ______________________________________________
> >> R-devel at r-project.org mailing list
> >> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From dtemplelang at ucdavis.edu  Fri Jul 20 19:50:03 2012
From: dtemplelang at ucdavis.edu (Duncan Temple Lang)
Date: Fri, 20 Jul 2012 10:50:03 -0700
Subject: [Rd] On RObjectTables
In-Reply-To: <CABFfbXv480ciNg3vphvwwvZvX03vvWABGRRT8a7SgRn25wPXgg@mail.gmail.com>
References: <CABFfbXv480ciNg3vphvwwvZvX03vvWABGRRT8a7SgRn25wPXgg@mail.gmail.com>
Message-ID: <50099A4B.9020808@ucdavis.edu>

Hi Jeroen

 I am restoring the packages on the Omegahat site as people
ask for them.

 I just put the RObjectTables package up in in its current form at
   http://www.omegahat.org/RObjectTables/
 and am happy to enhance it as needed.

 We can chat off-list, if you want.

   D.

On 7/19/12 10:30 AM, Jeroen Ooms wrote:
> I was wondering if anyone knows more about the state of RObjectTables. This
> largely undocumented functionality was introduced by Duncan around 2002
> somewhere and enables you create an environment where the contents are
> dynamically queried by R through a hook function. It is mentioned in R
> Internals and ?attach. This functionality is quite powerful and allows you
> to e.g. offload a big database of R objects to disk, yet use them as if
> they were in your workspace. The recent RProtoBuf package also uses some of
> this functionality to dynamically lookup proto definitions.
> 
> I would like to do something similar, but I am not sure if support for this
> functionality will be or has been discontinued. The RObjectTables package
> is no longer available on OmegaHat and nothing has not been mentioned on
> the mailing lists for about 5 years. I found an old version of the package
> no github which seems to work, but as far as I understand, the package
> still needs the hooks from within R to work. So if this functionality is
> actually unsupported and might be removed at some point, I should probably
> not invest in it.
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From xie at yihui.name  Fri Jul 20 20:48:40 2012
From: xie at yihui.name (Yihui Xie)
Date: Fri, 20 Jul 2012 14:48:40 -0400
Subject: [Rd] Changes to parser in R-devel
In-Reply-To: <500985C1.40703@gmail.com>
References: <500700FB.4000606@gmail.com>
	<CANROs4eTStRa=rWOqhdjBvBPJuaKM303zVeMT9BW3ED9R6B8zw@mail.gmail.com>
	<50088F24.7050100@gmail.com> <500985C1.40703@gmail.com>
Message-ID: <CANROs4fkraJLcgPKKGZ+Ug2n+y=X7ZAWBU8Bzj62Se-fdrb3pA@mail.gmail.com>

Great. I just tested it and did not find any more problems. Thanks!

Regards,
Yihui
--
Yihui Xie <xieyihui at gmail.com>
Phone: 515-294-2465 Web: http://yihui.name
Department of Statistics, Iowa State University
2215 Snedecor Hall, Ames, IA


On Fri, Jul 20, 2012 at 12:22 PM, Duncan Murdoch
<murdoch.duncan at gmail.com> wrote:
>
> As far as I know, it is now fixed (in r59913).
>
> Duncan Murdoch
>


From gwgc5 at mail.missouri.edu  Sun Jul 22 01:35:36 2012
From: gwgc5 at mail.missouri.edu (Raymond)
Date: Sat, 21 Jul 2012 16:35:36 -0700 (PDT)
Subject: [Rd] Use GPU in R with .Call
Message-ID: <1342913736238-4637333.post@n4.nabble.com>

Hi All,

      I am a newbie to GPU programming. I wonder if anyone can help me with
using GPU in .Call in R.

      Basically, I want to write a function that calcuates the sum of two
double type vectors and implement this using GPU. My final goal is to make
such an implementation callable from R.

      (a) First, I wrote a R-C interface handles the R object using .Call
(saved as VecAdd_cuda.c file) as below.

=================file VecAdd_cuda.c===================
#include <R.h>
#include <Rinternal.h>

/************************************************/
/* "VecAdd_cuda.c" adds two double vectors using GPU. */
/************************************************/
extern void vecAdd_kernel(double *ain,double *bin,double *cout,int len);
SEXP VecAdd_cuda(SEXP a,SEXP b) {
                  int len;
	double *a_ptr,*b_ptr,*resout_ptr;
	
	/*Digest R objects*/
	len=length(a);
	a_ptr=REAL(a);
	b_ptr=REAL(b);
	
	SEXP resout;
	PROTECT(resout=allocVector(REALSXP,len));
	resout_ptr=REAL(resout);
	
	vecAdd_kernel(a_ptr,b_ptr,resout_ptr,len);
	UNPROTECT(1);
	return resout;
}

     (b) Next, the host function and the kernel are in a *SEPARATE* file
called "VecAdd_kernel.cu".

     =======================file VecAdd_kernel.cu========================
#define THREAD_PER_BLOCK 100

__global__ void VecAdd(double *a,double *b, double *c,int len) { 

    int idx = threadIdx.x + blockIdx.x * blockDim.x;
	if (idx<len){
	    c[idx] = a[idx] + b[idx]; 
	}
}

void vecAdd_kernel(double *ain,double *bin,double *cout,int len){
   int alloc_size;
   alloc_size=len*sizeof(double);
   
   /*Step 0a) Make a device copies of ain,bin,and cout.*/
   double *a_copy,*b_copy,*cout_copy;

   /*Step 0b) Allocate memory for device copies.*/
   cudaMalloc(&amp;a_copy,alloc_size);
   cudaMalloc(&amp;b_copy,alloc_size);
   cudaMalloc(&amp;cout_copy,alloc_size);

   /*Step 0c) Copy arguments to device.*/
   cudaMemcpy(a_copy,ain,alloc_size,cudaMemcpyHostToDevice);
   cudaMemcpy(b_copy,bin,alloc_size,cudaMemcpyHostToDevice);
   cudaMemcpy(cout_copy,cout,alloc_size,cudaMemcpyHostToDevice);
    
   /*Step 1) Execute kernel.*/
  
VecAdd&lt;&lt;&lt;(len+THREAD_PER_BLOCK-1)/THREAD_PER_BLOCK,THREAD_PER_BLOCK>>>(a_copy,b_copy,cout_copy,len);

   /*Step 2) Copy result back to host.*/
   cudaMemcpy(cout,cout_copy,alloc_size,cudaMemcpyDeviceToHost);

   /*Step 3) Deallocate memory for device copies.*/
   cudaFree(a_copy);
   cudaFree(b_copy);
   cudaFree(cout_copy);

   /*Step 4) Get rid of the cuda context,necessary to avoid segfault when R
exits.*/
   cudaThreadExit();
}

     (c) Lastly, I wrote a R wrapper function called "VecAdd_cuda.R" as
below.
     ======================file VecAdd_cuda.R"===========================
#***************************************#
# This is R wrapper function for VecAdd_cuda.   #
#***************************************# 
VecAdd_cuda<-function(a,b){

    if (!is.vector(a) || !is.vector(b)){
         stop("In VecAdd_cuda.R,a and b should be vectors of same length!");
    }

    #load the C code
    if (!is.loaded('VecAdd_cuda')){
       
lib.file<-file.path(paste("VecAdd_cuda",.Platform$dynlib.ext,sep=""));
        dyn.load(lib.file);
        cat(" -Loaded ", lib.file, "\n");
    }
    .Call("VecAdd_cuda",a,b);
}

==================================================

     I am using a 64 bit windows 7 machine. My laptop has graphical card
that are GPU-enabled with computing capability 2.0 (i.e., double precision
is supported).  I can compile "VecAdd_kernel.cu" file and get
"VecAdd_kernel.o" file using the command (I have everything needed for
compiling .cu file installed correctly.)
          nvcc -c -m64 -arch=sm_13 VecAdd_kernel.cu -o VecAdd_kernel.o 

     But my question is:
     (a) How do I compile "VecAdd_cuda.c" and got a .dll file that I can
dynamically load into R.  I tried to use the following
      R CMD SHLIB VecAdd_cuda.c 
   and got the message
                  "undefined reference to VecAdd_kernel, collect2:ld
returned 1 exit stauts". 
      My understanding is that since the function "VecAdd_kernel" is defined
in a different file from "VecAdd_cuda.c", I need to link VecAdd_cuda.c with
VecAdd_kernel.cu or VecAdd_kernel.o. But I do not know how!


      Does anyone know what should I do to get "VecAdd_cuda.dll" that I can
load into R? Thanks!



--
View this message in context: http://r.789695.n4.nabble.com/Use-GPU-in-R-with-Call-tp4637333.html
Sent from the R devel mailing list archive at Nabble.com.


From lawrence.michael at gene.com  Sun Jul 22 12:47:06 2012
From: lawrence.michael at gene.com (Michael Lawrence)
Date: Sun, 22 Jul 2012 03:47:06 -0700
Subject: [Rd] callGeneric(...) and lazy evaluation
Message-ID: <CAOQ5NyeTfJ+Dq1gJHyN+RguVKTF-0p4hXORrit99iO4VYj8f7A@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20120722/6fc3d783/attachment.pl>

From brian at braverock.com  Sun Jul 22 13:21:36 2012
From: brian at braverock.com (Brian G. Peterson)
Date: Sun, 22 Jul 2012 06:21:36 -0500
Subject: [Rd] Use GPU in R with .Call
In-Reply-To: <1342913736238-4637333.post@n4.nabble.com>
References: <1342913736238-4637333.post@n4.nabble.com>
Message-ID: <500BE240.9030503@braverock.com>

On 07/21/2012 06:35 PM, Raymond wrote:
> Hi All,
>
>        I am a newbie to GPU programming. I wonder if anyone can help me with
> using GPU in .Call in R.
>
>        Basically, I want to write a function that calcuates the sum of two
> double type vectors and implement this using GPU. My final goal is to make
> such an implementation callable from R.

There are many packages already available for R that enable various bits 
of GPU functionality.

See the section on GPU's in the High Performance Computing task view:

http://cran.r-project.org/web/views/HighPerformanceComputing.html

I would suggest examining their code for working examples.

After you've done that, perhaps the R-SIG-HPC list would be a more 
appropriate place to continue the discussion.

Regards,

    - Brian

-- 
Brian G. Peterson
http://braverock.com/brian/
Ph: 773-459-4973
IM: bgpbraverock


From brunodepaulak at yahoo.com.br  Sun Jul 22 07:20:56 2012
From: brunodepaulak at yahoo.com.br (Bruno P. Kinoshita)
Date: Sat, 21 Jul 2012 22:20:56 -0700 (PDT)
Subject: [Rd] Announce Jenkins R Plug-in
Message-ID: <1342934456.6402.YahooMailNeo@web161201.mail.bf1.yahoo.com>

Hi all, 

I would like to announce that Jenkins continuous integration server has now an R plug-in [1]. Thanks for all your work on this great programming language. 

Keep up with the good work :-)?

All the best,

[1] https://wiki.jenkins-ci.org/display/JENKINS/R+Plugin

Bruno P. Kinoshita
http://kinoshita.eti.br
http://tupilabs.com?


From gwgc5 at mail.missouri.edu  Sun Jul 22 17:18:42 2012
From: gwgc5 at mail.missouri.edu (Raymond)
Date: Sun, 22 Jul 2012 08:18:42 -0700 (PDT)
Subject: [Rd] Use GPU in R with .Call
In-Reply-To: <1342913736238-4637333.post@n4.nabble.com>
References: <1342913736238-4637333.post@n4.nabble.com>
Message-ID: <1342970322984-4637356.post@n4.nabble.com>


     Thank you--Brian for your reponse. 

     I am really curious about how to compile GPU with R. I know it can be
hard to learn, but still I want to program it by myself. 

 



--
View this message in context: http://r.789695.n4.nabble.com/Use-GPU-in-R-with-Call-tp4637333p4637356.html
Sent from the R devel mailing list archive at Nabble.com.


From david.terk at gmail.com  Sun Jul 22 21:54:02 2012
From: david.terk at gmail.com (David Terk)
Date: Sun, 22 Jul 2012 15:54:02 -0400
Subject: [Rd] Reading many large files causes R to crash - Possible Bug in R
	2.15.1 64-bit Ubuntu
Message-ID: <000001cd6843$bf5700a0$3e0501e0$@gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20120722/4b5b7d0b/attachment.pl>

From josh.m.ulrich at gmail.com  Sun Jul 22 22:47:22 2012
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Sun, 22 Jul 2012 15:47:22 -0500
Subject: [Rd] Reading many large files causes R to crash - Possible Bug
 in R 2.15.1 64-bit Ubuntu
In-Reply-To: <000001cd6843$bf5700a0$3e0501e0$@gmail.com>
References: <000001cd6843$bf5700a0$3e0501e0$@gmail.com>
Message-ID: <CAPPM_gTkk10KmOPbbnS8W2NEPqGUs1z4SurMeRW9cru44VFjgQ@mail.gmail.com>

Cross-posted on Stack Overflow:
http://stackoverflow.com/q/11596747/271616
--
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com


On Sun, Jul 22, 2012 at 2:54 PM, David Terk <david.terk at gmail.com> wrote:
> I am reading several hundred files.  Anywhere from 50k-400k in size.  It
> appears that when I read these files with R 2.15.1 the process will hang or
> seg fault on the scan() call.  This does not happen on R 2.14.1.
>
>
>
> This is happening on the precise build of Ubuntu.
>
>
>
> I have included everything, but the issue appears to be when performing the
> scan in the method parseTickData.
>
>
>
> Below is the code.  Hopefully this is the right place to post.
>
>
>
> parseTickDataFromDir = function(tickerDir, per, subper, fun) {
>
>   tickerAbsFilenames = list.files(tickerDir,full.names=T)
>
>   tickerNames = list.files(tickerDir,full.names=F)
>
>   tickerNames = gsub("_[a-zA-Z0-9].csv","",tickerNames)
>
>   pb <- txtProgressBar(min = 0, max = length(tickerAbsFilenames), style = 3)
>
>
>
>   for(i in 1:length(tickerAbsFilenames)) {
>
>
>
>     # Grab Raw Tick Data
>
>     dat.i = parseTickData(tickerAbsFilenames[i])
>
>     #Sys.sleep(1)
>
>     # Create Template
>
>     dates <- unique(substr(as.character(index(dat.i)), 1,10))
>
>     times <- rep("09:30:00", length(dates))
>
>     openDateTimes <- strptime(paste(dates, times), "%F %H:%M:%S")
>
>     templateTimes <- NULL
>
>
>
>     for (j in 1:length(openDateTimes)) {
>
>       if (is.null(templateTimes)) {
>
>         templateTimes <- openDateTimes[j] + 0:23400
>
>       } else {
>
>         templateTimes <- c(templateTimes, openDateTimes[j] + 0:23400)
>
>       }
>
>     }
>
>
>
>     # Convert templateTimes to XTS, merge with data and convert NA's
>
>     templateTimes <- as.xts(templateTimes)
>
>     dat.i <- merge(dat.i, templateTimes, all=T)
>
>     # If there is no data in the first print, we will have leading NA's.  So
> set them to -1.
>
>     # Since we do not want these values removed by to.period
>
>     if (is.na(dat.i[1])) {
>
>       dat.i[1] <- -1
>
>     }
>
>     # Fix remaining NA's
>
>     dat.i <- na.locf(dat.i)
>
>     # Convert to desired bucket size
>
>     dat.i <- to.period(dat.i, period=per, k=subper, name=NULL)
>
>     # Always use templated index, otherwise merge fails with other symbols
>
>     index(dat.i) <- index(to.period(templateTimes, period=per, k=subper))
>
>     # If there was missing data at open, set close to NA
>
>     valsToChange <- which(dat.i[,"Open"] == -1)
>
>     if (length(valsToChange) != 0) {
>
>       dat.i[valsToChange, "Close"] <- NA
>
>     }
>
>     if(i == 1) {
>
>       DAT = fun(dat.i)
>
>     } else {
>
>       DAT = merge(DAT,fun(dat.i))
>
>     }
>
>     setTxtProgressBar(pb, i)
>
>   }
>
>   close(pb)
>
>   colnames(DAT) = tickerNames
>
>   return(DAT)
>
> }
>
>
>
> parseTickData <- function(inputFile) {
>
>   DAT.list <- scan(file=inputFile,
> sep=",",skip=1,what=list(Date="",Time="",Close=0,Volume=0),quiet=T)
>
>   index <- as.POSIXct(paste(DAT.list$Date,DAT.list$Time),format="%m/%d/%Y
> %H:%M:%S")
>
>   DAT.xts <- xts(DAT.list$Close,index)
>
>   DAT.xts <- make.index.unique(DAT.xts)
>
>   return(DAT.xts)
>
> }
>
>
>
>
>
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From murdoch.duncan at gmail.com  Sun Jul 22 22:47:53 2012
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Sun, 22 Jul 2012 16:47:53 -0400
Subject: [Rd] Reading many large files causes R to crash - Possible Bug
 in R 2.15.1 64-bit Ubuntu
In-Reply-To: <000001cd6843$bf5700a0$3e0501e0$@gmail.com>
References: <000001cd6843$bf5700a0$3e0501e0$@gmail.com>
Message-ID: <500C66F9.5050503@gmail.com>

On 12-07-22 3:54 PM, David Terk wrote:
> I am reading several hundred files.  Anywhere from 50k-400k in size.  It
> appears that when I read these files with R 2.15.1 the process will hang or
> seg fault on the scan() call.  This does not happen on R 2.14.1.

The code below doesn't do anything other than define a couple of 
functions.  Please simplify it to code that creates a file (or multiple 
files), reads it or them, and shows a bug.

If you can't do that, then gradually add the rest of the stuff from 
these functions into the mix until you figure out what is really causing 
the bug.

If you don't post code that allows us to reproduce the crash, it's 
really unlikely that we'll be able to fix it.

Duncan Murdoch

>
>
>
> This is happening on the precise build of Ubuntu.
>
>
>
> I have included everything, but the issue appears to be when performing the
> scan in the method parseTickData.
>
>
>
> Below is the code.  Hopefully this is the right place to post.
>
>
>
> parseTickDataFromDir = function(tickerDir, per, subper, fun) {
>
>    tickerAbsFilenames = list.files(tickerDir,full.names=T)
>
>    tickerNames = list.files(tickerDir,full.names=F)
>
>    tickerNames = gsub("_[a-zA-Z0-9].csv","",tickerNames)
>
>    pb <- txtProgressBar(min = 0, max = length(tickerAbsFilenames), style = 3)
>
>
>
>    for(i in 1:length(tickerAbsFilenames)) {
>
>
>
>      # Grab Raw Tick Data
>
>      dat.i = parseTickData(tickerAbsFilenames[i])
>
>      #Sys.sleep(1)
>
>      # Create Template
>
>      dates <- unique(substr(as.character(index(dat.i)), 1,10))
>
>      times <- rep("09:30:00", length(dates))
>
>      openDateTimes <- strptime(paste(dates, times), "%F %H:%M:%S")
>
>      templateTimes <- NULL
>
>
>
>      for (j in 1:length(openDateTimes)) {
>
>        if (is.null(templateTimes)) {
>
>          templateTimes <- openDateTimes[j] + 0:23400
>
>        } else {
>
>          templateTimes <- c(templateTimes, openDateTimes[j] + 0:23400)
>
>        }
>
>      }
>
>
>
>      # Convert templateTimes to XTS, merge with data and convert NA's
>
>      templateTimes <- as.xts(templateTimes)
>
>      dat.i <- merge(dat.i, templateTimes, all=T)
>
>      # If there is no data in the first print, we will have leading NA's.  So
> set them to -1.
>
>      # Since we do not want these values removed by to.period
>
>      if (is.na(dat.i[1])) {
>
>        dat.i[1] <- -1
>
>      }
>
>      # Fix remaining NA's
>
>      dat.i <- na.locf(dat.i)
>
>      # Convert to desired bucket size
>
>      dat.i <- to.period(dat.i, period=per, k=subper, name=NULL)
>
>      # Always use templated index, otherwise merge fails with other symbols
>
>      index(dat.i) <- index(to.period(templateTimes, period=per, k=subper))
>
>      # If there was missing data at open, set close to NA
>
>      valsToChange <- which(dat.i[,"Open"] == -1)
>
>      if (length(valsToChange) != 0) {
>
>        dat.i[valsToChange, "Close"] <- NA
>
>      }
>
>      if(i == 1) {
>
>        DAT = fun(dat.i)
>
>      } else {
>
>        DAT = merge(DAT,fun(dat.i))
>
>      }
>
>      setTxtProgressBar(pb, i)
>
>    }
>
>    close(pb)
>
>    colnames(DAT) = tickerNames
>
>    return(DAT)
>
> }
>
>
>
> parseTickData <- function(inputFile) {
>
>    DAT.list <- scan(file=inputFile,
> sep=",",skip=1,what=list(Date="",Time="",Close=0,Volume=0),quiet=T)
>
>    index <- as.POSIXct(paste(DAT.list$Date,DAT.list$Time),format="%m/%d/%Y
> %H:%M:%S")
>
>    DAT.xts <- xts(DAT.list$Close,index)
>
>    DAT.xts <- make.index.unique(DAT.xts)
>
>    return(DAT.xts)
>
> }
>
>
>
>
>
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From matloff at cs.ucdavis.edu  Mon Jul 23 01:37:08 2012
From: matloff at cs.ucdavis.edu (Norm Matloff)
Date: Sun, 22 Jul 2012 16:37:08 -0700
Subject: [Rd] Use GPU in R with .Call
Message-ID: <20120722233708.GA17426@laura>

[Sorry, originally sent to wrong list.]

I'm not exactly sure what you are asking, Raymond, but this may answer
your question.

Say you have a file x.cu.  After compiling with nvcc -c as you did, then
do something like this:

setenv PKG_LIBS "-L/usr/local/cuda/lib -lcudart"
R CMD SHLIB x.o -o x.so

PKG_LIBS is an environment variable used by R CMD SHLIB.

Of course, you need to translate the setting of the environment variable
from Linux C shell to Windows, and substitute your location of the CUDA
library.

Norm


From david.terk at gmail.com  Mon Jul 23 07:25:13 2012
From: david.terk at gmail.com (David Terk)
Date: Mon, 23 Jul 2012 01:25:13 -0400
Subject: [Rd] Reading many large files causes R to crash - Possible Bug
	in R 2.15.1 64-bit Ubuntu
In-Reply-To: <500C66F9.5050503@gmail.com>
References: <000001cd6843$bf5700a0$3e0501e0$@gmail.com>
	<500C66F9.5050503@gmail.com>
Message-ID: <002b01cd6893$8a64b770$9f2e2650$@gmail.com>

I've isolated the bug.  When the seg fault was produced there was an error
that memory had not been mapped.  Here is the odd part of the bug.  If you
comment out certain code and get a full run than comment in the code which
is causing the problem it will actually run.   So I think it is safe to
assume something wrong is taking place with memory allocation.  Example.
While testing, I have been able to get to a point where the code will run.
But if I reboot the machine and try again, the code will not run.

The bug itself is happening somewhere in XTS or ZOO.  I will gladly upload
the data files.  It is happening on the 10th data file which is only 225k
lines in size.

Below is the simplified code.  The call to either

dat.i <- to.period(dat.i, period=per, k=subper, name=NULL)
index(dat.i) <- index(to.period(templateTimes, period=per, k=subper))

is what is causing R to hang or crash.  I have been able to replicate this
on Windows 7 64 bit and Ubuntu 64 bit.  Seems easiest to consistently
replicate from R Studio.

The code below will consistently replicate when the appropriate files are
used.

parseTickDataFromDir = function(tickerDir, per, subper) {
  tickerAbsFilenames = list.files(tickerDir,full.names=T)
  tickerNames = list.files(tickerDir,full.names=F)
  tickerNames = gsub("_[a-zA-Z0-9].csv","",tickerNames)
  pb <- txtProgressBar(min = 0, max = length(tickerAbsFilenames), style = 3)
  
  for(i in 1:length(tickerAbsFilenames)) {
    dat.i = parseTickData(tickerAbsFilenames[i])
    dates <- unique(substr(as.character(index(dat.i)), 1,10))
    times <- rep("09:30:00", length(dates))
    openDateTimes <- strptime(paste(dates, times), "%F %H:%M:%S")
    templateTimes <- NULL
    
    for (j in 1:length(openDateTimes)) {
      if (is.null(templateTimes)) {
        templateTimes <- openDateTimes[j] + 0:23400
      } else {
        templateTimes <- c(templateTimes, openDateTimes[j] + 0:23400)
      }
    }
    
    templateTimes <- as.xts(templateTimes)
    dat.i <- merge(dat.i, templateTimes, all=T)
    if (is.na(dat.i[1])) {
      dat.i[1] <- -1
    }
    dat.i <- na.locf(dat.i)
	dat.i <- to.period(dat.i, period=per, k=subper, name=NULL)
	index(dat.i) <- index(to.period(templateTimes, period=per,
k=subper))
    setTxtProgressBar(pb, i)
  }
  close(pb)
}

parseTickData <- function(inputFile) {
  DAT.list <- scan(file=inputFile,
sep=",",skip=1,what=list(Date="",Time="",Close=0,Volume=0),quiet=T)
  index <- as.POSIXct(paste(DAT.list$Date,DAT.list$Time),format="%m/%d/%Y
%H:%M:%S")
  DAT.xts <- xts(DAT.list$Close,index)
  DAT.xts <- make.index.unique(DAT.xts)
  return(DAT.xts)
}

DATTick <- parseTickDataFromDir(tickerDirSecond, "seconds",10)

-----Original Message-----
From: Duncan Murdoch [mailto:murdoch.duncan at gmail.com] 
Sent: Sunday, July 22, 2012 4:48 PM
To: David Terk
Cc: r-devel at r-project.org
Subject: Re: [Rd] Reading many large files causes R to crash - Possible Bug
in R 2.15.1 64-bit Ubuntu

On 12-07-22 3:54 PM, David Terk wrote:
> I am reading several hundred files.  Anywhere from 50k-400k in size.  
> It appears that when I read these files with R 2.15.1 the process will 
> hang or seg fault on the scan() call.  This does not happen on R 2.14.1.

The code below doesn't do anything other than define a couple of functions.
Please simplify it to code that creates a file (or multiple files), reads it
or them, and shows a bug.

If you can't do that, then gradually add the rest of the stuff from these
functions into the mix until you figure out what is really causing the bug.

If you don't post code that allows us to reproduce the crash, it's really
unlikely that we'll be able to fix it.

Duncan Murdoch

>
>
>
> This is happening on the precise build of Ubuntu.
>
>
>
> I have included everything, but the issue appears to be when 
> performing the scan in the method parseTickData.
>
>
>
> Below is the code.  Hopefully this is the right place to post.
>
>
>
> parseTickDataFromDir = function(tickerDir, per, subper, fun) {
>
>    tickerAbsFilenames = list.files(tickerDir,full.names=T)
>
>    tickerNames = list.files(tickerDir,full.names=F)
>
>    tickerNames = gsub("_[a-zA-Z0-9].csv","",tickerNames)
>
>    pb <- txtProgressBar(min = 0, max = length(tickerAbsFilenames), 
> style = 3)
>
>
>
>    for(i in 1:length(tickerAbsFilenames)) {
>
>
>
>      # Grab Raw Tick Data
>
>      dat.i = parseTickData(tickerAbsFilenames[i])
>
>      #Sys.sleep(1)
>
>      # Create Template
>
>      dates <- unique(substr(as.character(index(dat.i)), 1,10))
>
>      times <- rep("09:30:00", length(dates))
>
>      openDateTimes <- strptime(paste(dates, times), "%F %H:%M:%S")
>
>      templateTimes <- NULL
>
>
>
>      for (j in 1:length(openDateTimes)) {
>
>        if (is.null(templateTimes)) {
>
>          templateTimes <- openDateTimes[j] + 0:23400
>
>        } else {
>
>          templateTimes <- c(templateTimes, openDateTimes[j] + 0:23400)
>
>        }
>
>      }
>
>
>
>      # Convert templateTimes to XTS, merge with data and convert NA's
>
>      templateTimes <- as.xts(templateTimes)
>
>      dat.i <- merge(dat.i, templateTimes, all=T)
>
>      # If there is no data in the first print, we will have leading 
> NA's.  So set them to -1.
>
>      # Since we do not want these values removed by to.period
>
>      if (is.na(dat.i[1])) {
>
>        dat.i[1] <- -1
>
>      }
>
>      # Fix remaining NA's
>
>      dat.i <- na.locf(dat.i)
>
>      # Convert to desired bucket size
>
>      dat.i <- to.period(dat.i, period=per, k=subper, name=NULL)
>
>      # Always use templated index, otherwise merge fails with other 
> symbols
>
>      index(dat.i) <- index(to.period(templateTimes, period=per, 
> k=subper))
>
>      # If there was missing data at open, set close to NA
>
>      valsToChange <- which(dat.i[,"Open"] == -1)
>
>      if (length(valsToChange) != 0) {
>
>        dat.i[valsToChange, "Close"] <- NA
>
>      }
>
>      if(i == 1) {
>
>        DAT = fun(dat.i)
>
>      } else {
>
>        DAT = merge(DAT,fun(dat.i))
>
>      }
>
>      setTxtProgressBar(pb, i)
>
>    }
>
>    close(pb)
>
>    colnames(DAT) = tickerNames
>
>    return(DAT)
>
> }
>
>
>
> parseTickData <- function(inputFile) {
>
>    DAT.list <- scan(file=inputFile,
> sep=",",skip=1,what=list(Date="",Time="",Close=0,Volume=0),quiet=T)
>
>    index <- 
> as.POSIXct(paste(DAT.list$Date,DAT.list$Time),format="%m/%d/%Y
> %H:%M:%S")
>
>    DAT.xts <- xts(DAT.list$Close,index)
>
>    DAT.xts <- make.index.unique(DAT.xts)
>
>    return(DAT.xts)
>
> }
>
>
>
>
>
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From david.terk at gmail.com  Mon Jul 23 07:41:49 2012
From: david.terk at gmail.com (David Terk)
Date: Mon, 23 Jul 2012 01:41:49 -0400
Subject: [Rd] Reading many large files causes R to crash - Possible Bug
	in R 2.15.1 64-bit Ubuntu
References: <000001cd6843$bf5700a0$3e0501e0$@gmail.com>
	<500C66F9.5050503@gmail.com> 
Message-ID: <002d01cd6895$dbef6ed0$93ce4c70$@gmail.com>

Looks like the call to:

dat.i <- to.period(dat.i, period=per, k=subper, name=NULL)

If what is causing the issue.  If variable name is not set, or set to any
value other than NULL.  Than no hang occurs.  

-----Original Message-----
From: David Terk [mailto:david.terk at gmail.com] 
Sent: Monday, July 23, 2012 1:25 AM
To: 'Duncan Murdoch'
Cc: 'r-devel at r-project.org'
Subject: RE: [Rd] Reading many large files causes R to crash - Possible Bug
in R 2.15.1 64-bit Ubuntu

I've isolated the bug.  When the seg fault was produced there was an error
that memory had not been mapped.  Here is the odd part of the bug.  If you
comment out certain code and get a full run than comment in the code which
is causing the problem it will actually run.   So I think it is safe to
assume something wrong is taking place with memory allocation.  Example.
While testing, I have been able to get to a point where the code will run.
But if I reboot the machine and try again, the code will not run.

The bug itself is happening somewhere in XTS or ZOO.  I will gladly upload
the data files.  It is happening on the 10th data file which is only 225k
lines in size.

Below is the simplified code.  The call to either

dat.i <- to.period(dat.i, period=per, k=subper, name=NULL)
index(dat.i) <- index(to.period(templateTimes, period=per, k=subper))

is what is causing R to hang or crash.  I have been able to replicate this
on Windows 7 64 bit and Ubuntu 64 bit.  Seems easiest to consistently
replicate from R Studio.

The code below will consistently replicate when the appropriate files are
used.

parseTickDataFromDir = function(tickerDir, per, subper) {
  tickerAbsFilenames = list.files(tickerDir,full.names=T)
  tickerNames = list.files(tickerDir,full.names=F)
  tickerNames = gsub("_[a-zA-Z0-9].csv","",tickerNames)
  pb <- txtProgressBar(min = 0, max = length(tickerAbsFilenames), style = 3)
  
  for(i in 1:length(tickerAbsFilenames)) {
    dat.i = parseTickData(tickerAbsFilenames[i])
    dates <- unique(substr(as.character(index(dat.i)), 1,10))
    times <- rep("09:30:00", length(dates))
    openDateTimes <- strptime(paste(dates, times), "%F %H:%M:%S")
    templateTimes <- NULL
    
    for (j in 1:length(openDateTimes)) {
      if (is.null(templateTimes)) {
        templateTimes <- openDateTimes[j] + 0:23400
      } else {
        templateTimes <- c(templateTimes, openDateTimes[j] + 0:23400)
      }
    }
    
    templateTimes <- as.xts(templateTimes)
    dat.i <- merge(dat.i, templateTimes, all=T)
    if (is.na(dat.i[1])) {
      dat.i[1] <- -1
    }
    dat.i <- na.locf(dat.i)
	dat.i <- to.period(dat.i, period=per, k=subper, name=NULL)
	index(dat.i) <- index(to.period(templateTimes, period=per,
k=subper))
    setTxtProgressBar(pb, i)
  }
  close(pb)
}

parseTickData <- function(inputFile) {
  DAT.list <- scan(file=inputFile,
sep=",",skip=1,what=list(Date="",Time="",Close=0,Volume=0),quiet=T)
  index <- as.POSIXct(paste(DAT.list$Date,DAT.list$Time),format="%m/%d/%Y
%H:%M:%S")
  DAT.xts <- xts(DAT.list$Close,index)
  DAT.xts <- make.index.unique(DAT.xts)
  return(DAT.xts)
}

DATTick <- parseTickDataFromDir(tickerDirSecond, "seconds",10)

-----Original Message-----
From: Duncan Murdoch [mailto:murdoch.duncan at gmail.com]
Sent: Sunday, July 22, 2012 4:48 PM
To: David Terk
Cc: r-devel at r-project.org
Subject: Re: [Rd] Reading many large files causes R to crash - Possible Bug
in R 2.15.1 64-bit Ubuntu

On 12-07-22 3:54 PM, David Terk wrote:
> I am reading several hundred files.  Anywhere from 50k-400k in size.  
> It appears that when I read these files with R 2.15.1 the process will 
> hang or seg fault on the scan() call.  This does not happen on R 2.14.1.

The code below doesn't do anything other than define a couple of functions.
Please simplify it to code that creates a file (or multiple files), reads it
or them, and shows a bug.

If you can't do that, then gradually add the rest of the stuff from these
functions into the mix until you figure out what is really causing the bug.

If you don't post code that allows us to reproduce the crash, it's really
unlikely that we'll be able to fix it.

Duncan Murdoch

>
>
>
> This is happening on the precise build of Ubuntu.
>
>
>
> I have included everything, but the issue appears to be when 
> performing the scan in the method parseTickData.
>
>
>
> Below is the code.  Hopefully this is the right place to post.
>
>
>
> parseTickDataFromDir = function(tickerDir, per, subper, fun) {
>
>    tickerAbsFilenames = list.files(tickerDir,full.names=T)
>
>    tickerNames = list.files(tickerDir,full.names=F)
>
>    tickerNames = gsub("_[a-zA-Z0-9].csv","",tickerNames)
>
>    pb <- txtProgressBar(min = 0, max = length(tickerAbsFilenames), 
> style = 3)
>
>
>
>    for(i in 1:length(tickerAbsFilenames)) {
>
>
>
>      # Grab Raw Tick Data
>
>      dat.i = parseTickData(tickerAbsFilenames[i])
>
>      #Sys.sleep(1)
>
>      # Create Template
>
>      dates <- unique(substr(as.character(index(dat.i)), 1,10))
>
>      times <- rep("09:30:00", length(dates))
>
>      openDateTimes <- strptime(paste(dates, times), "%F %H:%M:%S")
>
>      templateTimes <- NULL
>
>
>
>      for (j in 1:length(openDateTimes)) {
>
>        if (is.null(templateTimes)) {
>
>          templateTimes <- openDateTimes[j] + 0:23400
>
>        } else {
>
>          templateTimes <- c(templateTimes, openDateTimes[j] + 0:23400)
>
>        }
>
>      }
>
>
>
>      # Convert templateTimes to XTS, merge with data and convert NA's
>
>      templateTimes <- as.xts(templateTimes)
>
>      dat.i <- merge(dat.i, templateTimes, all=T)
>
>      # If there is no data in the first print, we will have leading 
> NA's.  So set them to -1.
>
>      # Since we do not want these values removed by to.period
>
>      if (is.na(dat.i[1])) {
>
>        dat.i[1] <- -1
>
>      }
>
>      # Fix remaining NA's
>
>      dat.i <- na.locf(dat.i)
>
>      # Convert to desired bucket size
>
>      dat.i <- to.period(dat.i, period=per, k=subper, name=NULL)
>
>      # Always use templated index, otherwise merge fails with other 
> symbols
>
>      index(dat.i) <- index(to.period(templateTimes, period=per,
> k=subper))
>
>      # If there was missing data at open, set close to NA
>
>      valsToChange <- which(dat.i[,"Open"] == -1)
>
>      if (length(valsToChange) != 0) {
>
>        dat.i[valsToChange, "Close"] <- NA
>
>      }
>
>      if(i == 1) {
>
>        DAT = fun(dat.i)
>
>      } else {
>
>        DAT = merge(DAT,fun(dat.i))
>
>      }
>
>      setTxtProgressBar(pb, i)
>
>    }
>
>    close(pb)
>
>    colnames(DAT) = tickerNames
>
>    return(DAT)
>
> }
>
>
>
> parseTickData <- function(inputFile) {
>
>    DAT.list <- scan(file=inputFile,
> sep=",",skip=1,what=list(Date="",Time="",Close=0,Volume=0),quiet=T)
>
>    index <-
> as.POSIXct(paste(DAT.list$Date,DAT.list$Time),format="%m/%d/%Y
> %H:%M:%S")
>
>    DAT.xts <- xts(DAT.list$Close,index)
>
>    DAT.xts <- make.index.unique(DAT.xts)
>
>    return(DAT.xts)
>
> }
>
>
>
>
>
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From josh.m.ulrich at gmail.com  Mon Jul 23 14:15:26 2012
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Mon, 23 Jul 2012 07:15:26 -0500
Subject: [Rd] Reading many large files causes R to crash - Possible Bug
 in R 2.15.1 64-bit Ubuntu
In-Reply-To: <002d01cd6895$dbef6ed0$93ce4c70$@gmail.com>
References: <000001cd6843$bf5700a0$3e0501e0$@gmail.com>
	<500C66F9.5050503@gmail.com>
	<002d01cd6895$dbef6ed0$93ce4c70$@gmail.com>
Message-ID: <CAPPM_gS=a-XoYT3-zUttsQpdqg3KgJnZY172ekGvbyGUk6mGPA@mail.gmail.com>

David,

You still haven't provided a reproducible example.  As Duncan already
said, "if you don't post code that allows us to reproduce the crash,
it's really unlikely that we'll be able to fix it."

And R-devel is not the appropriate venue to discuss this if it's truly
an issue with xts/zoo.

Best,
--
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com


On Mon, Jul 23, 2012 at 12:41 AM, David Terk <david.terk at gmail.com> wrote:
> Looks like the call to:
>
> dat.i <- to.period(dat.i, period=per, k=subper, name=NULL)
>
> If what is causing the issue.  If variable name is not set, or set to any
> value other than NULL.  Than no hang occurs.
>
> -----Original Message-----
> From: David Terk [mailto:david.terk at gmail.com]
> Sent: Monday, July 23, 2012 1:25 AM
> To: 'Duncan Murdoch'
> Cc: 'r-devel at r-project.org'
> Subject: RE: [Rd] Reading many large files causes R to crash - Possible Bug
> in R 2.15.1 64-bit Ubuntu
>
> I've isolated the bug.  When the seg fault was produced there was an error
> that memory had not been mapped.  Here is the odd part of the bug.  If you
> comment out certain code and get a full run than comment in the code which
> is causing the problem it will actually run.   So I think it is safe to
> assume something wrong is taking place with memory allocation.  Example.
> While testing, I have been able to get to a point where the code will run.
> But if I reboot the machine and try again, the code will not run.
>
> The bug itself is happening somewhere in XTS or ZOO.  I will gladly upload
> the data files.  It is happening on the 10th data file which is only 225k
> lines in size.
>
> Below is the simplified code.  The call to either
>
> dat.i <- to.period(dat.i, period=per, k=subper, name=NULL)
> index(dat.i) <- index(to.period(templateTimes, period=per, k=subper))
>
> is what is causing R to hang or crash.  I have been able to replicate this
> on Windows 7 64 bit and Ubuntu 64 bit.  Seems easiest to consistently
> replicate from R Studio.
>
> The code below will consistently replicate when the appropriate files are
> used.
>
> parseTickDataFromDir = function(tickerDir, per, subper) {
>   tickerAbsFilenames = list.files(tickerDir,full.names=T)
>   tickerNames = list.files(tickerDir,full.names=F)
>   tickerNames = gsub("_[a-zA-Z0-9].csv","",tickerNames)
>   pb <- txtProgressBar(min = 0, max = length(tickerAbsFilenames), style = 3)
>
>   for(i in 1:length(tickerAbsFilenames)) {
>     dat.i = parseTickData(tickerAbsFilenames[i])
>     dates <- unique(substr(as.character(index(dat.i)), 1,10))
>     times <- rep("09:30:00", length(dates))
>     openDateTimes <- strptime(paste(dates, times), "%F %H:%M:%S")
>     templateTimes <- NULL
>
>     for (j in 1:length(openDateTimes)) {
>       if (is.null(templateTimes)) {
>         templateTimes <- openDateTimes[j] + 0:23400
>       } else {
>         templateTimes <- c(templateTimes, openDateTimes[j] + 0:23400)
>       }
>     }
>
>     templateTimes <- as.xts(templateTimes)
>     dat.i <- merge(dat.i, templateTimes, all=T)
>     if (is.na(dat.i[1])) {
>       dat.i[1] <- -1
>     }
>     dat.i <- na.locf(dat.i)
>         dat.i <- to.period(dat.i, period=per, k=subper, name=NULL)
>         index(dat.i) <- index(to.period(templateTimes, period=per,
> k=subper))
>     setTxtProgressBar(pb, i)
>   }
>   close(pb)
> }
>
> parseTickData <- function(inputFile) {
>   DAT.list <- scan(file=inputFile,
> sep=",",skip=1,what=list(Date="",Time="",Close=0,Volume=0),quiet=T)
>   index <- as.POSIXct(paste(DAT.list$Date,DAT.list$Time),format="%m/%d/%Y
> %H:%M:%S")
>   DAT.xts <- xts(DAT.list$Close,index)
>   DAT.xts <- make.index.unique(DAT.xts)
>   return(DAT.xts)
> }
>
> DATTick <- parseTickDataFromDir(tickerDirSecond, "seconds",10)
>
> -----Original Message-----
> From: Duncan Murdoch [mailto:murdoch.duncan at gmail.com]
> Sent: Sunday, July 22, 2012 4:48 PM
> To: David Terk
> Cc: r-devel at r-project.org
> Subject: Re: [Rd] Reading many large files causes R to crash - Possible Bug
> in R 2.15.1 64-bit Ubuntu
>
> On 12-07-22 3:54 PM, David Terk wrote:
>> I am reading several hundred files.  Anywhere from 50k-400k in size.
>> It appears that when I read these files with R 2.15.1 the process will
>> hang or seg fault on the scan() call.  This does not happen on R 2.14.1.
>
> The code below doesn't do anything other than define a couple of functions.
> Please simplify it to code that creates a file (or multiple files), reads it
> or them, and shows a bug.
>
> If you can't do that, then gradually add the rest of the stuff from these
> functions into the mix until you figure out what is really causing the bug.
>
> If you don't post code that allows us to reproduce the crash, it's really
> unlikely that we'll be able to fix it.
>
> Duncan Murdoch
>
>>
>>
>>
>> This is happening on the precise build of Ubuntu.
>>
>>
>>
>> I have included everything, but the issue appears to be when
>> performing the scan in the method parseTickData.
>>
>>
>>
>> Below is the code.  Hopefully this is the right place to post.
>>
>>
>>
>> parseTickDataFromDir = function(tickerDir, per, subper, fun) {
>>
>>    tickerAbsFilenames = list.files(tickerDir,full.names=T)
>>
>>    tickerNames = list.files(tickerDir,full.names=F)
>>
>>    tickerNames = gsub("_[a-zA-Z0-9].csv","",tickerNames)
>>
>>    pb <- txtProgressBar(min = 0, max = length(tickerAbsFilenames),
>> style = 3)
>>
>>
>>
>>    for(i in 1:length(tickerAbsFilenames)) {
>>
>>
>>
>>      # Grab Raw Tick Data
>>
>>      dat.i = parseTickData(tickerAbsFilenames[i])
>>
>>      #Sys.sleep(1)
>>
>>      # Create Template
>>
>>      dates <- unique(substr(as.character(index(dat.i)), 1,10))
>>
>>      times <- rep("09:30:00", length(dates))
>>
>>      openDateTimes <- strptime(paste(dates, times), "%F %H:%M:%S")
>>
>>      templateTimes <- NULL
>>
>>
>>
>>      for (j in 1:length(openDateTimes)) {
>>
>>        if (is.null(templateTimes)) {
>>
>>          templateTimes <- openDateTimes[j] + 0:23400
>>
>>        } else {
>>
>>          templateTimes <- c(templateTimes, openDateTimes[j] + 0:23400)
>>
>>        }
>>
>>      }
>>
>>
>>
>>      # Convert templateTimes to XTS, merge with data and convert NA's
>>
>>      templateTimes <- as.xts(templateTimes)
>>
>>      dat.i <- merge(dat.i, templateTimes, all=T)
>>
>>      # If there is no data in the first print, we will have leading
>> NA's.  So set them to -1.
>>
>>      # Since we do not want these values removed by to.period
>>
>>      if (is.na(dat.i[1])) {
>>
>>        dat.i[1] <- -1
>>
>>      }
>>
>>      # Fix remaining NA's
>>
>>      dat.i <- na.locf(dat.i)
>>
>>      # Convert to desired bucket size
>>
>>      dat.i <- to.period(dat.i, period=per, k=subper, name=NULL)
>>
>>      # Always use templated index, otherwise merge fails with other
>> symbols
>>
>>      index(dat.i) <- index(to.period(templateTimes, period=per,
>> k=subper))
>>
>>      # If there was missing data at open, set close to NA
>>
>>      valsToChange <- which(dat.i[,"Open"] == -1)
>>
>>      if (length(valsToChange) != 0) {
>>
>>        dat.i[valsToChange, "Close"] <- NA
>>
>>      }
>>
>>      if(i == 1) {
>>
>>        DAT = fun(dat.i)
>>
>>      } else {
>>
>>        DAT = merge(DAT,fun(dat.i))
>>
>>      }
>>
>>      setTxtProgressBar(pb, i)
>>
>>    }
>>
>>    close(pb)
>>
>>    colnames(DAT) = tickerNames
>>
>>    return(DAT)
>>
>> }
>>
>>
>>
>> parseTickData <- function(inputFile) {
>>
>>    DAT.list <- scan(file=inputFile,
>> sep=",",skip=1,what=list(Date="",Time="",Close=0,Volume=0),quiet=T)
>>
>>    index <-
>> as.POSIXct(paste(DAT.list$Date,DAT.list$Time),format="%m/%d/%Y
>> %H:%M:%S")
>>
>>    DAT.xts <- xts(DAT.list$Close,index)
>>
>>    DAT.xts <- make.index.unique(DAT.xts)
>>
>>    return(DAT.xts)
>>
>> }
>>
>>
>>
>>
>>
>>
>>       [[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From landronimirc at gmail.com  Mon Jul 23 14:49:02 2012
From: landronimirc at gmail.com (Liviu Andronic)
Date: Mon, 23 Jul 2012 14:49:02 +0200
Subject: [Rd] duplicated() variation that goes both ways to capture all
	duplicates
Message-ID: <CABxs9Vk1bLgRCi=BfH+nnkyUxfYWyXw7R_JrL9aTyfChfAHhxQ@mail.gmail.com>

Dear all
The trouble with the current duplicated() function in is that it can
report duplicates while searching fromFirst _or_ fromLast, but not
both ways. Often users will want to identify and extract all the
copies of the item that has duplicates, not only the duplicates
themselves.

To take the example from the man page:
> data(iris)
> iris[duplicated(iris), ]  ##duplicates while searching "fromFirst"
    Sepal.Length Sepal.Width Petal.Length Petal.Width   Species
143          5.8         2.7          5.1         1.9 virginica
> iris[duplicated(iris, fromLast=T), ]  ##duplicates while searching "fromLast"
    Sepal.Length Sepal.Width Petal.Length Petal.Width   Species
102          5.8         2.7          5.1         1.9 virginica


To extract all the copies of the concerned items ("original" and
duplicates) one would need to do something like this:
> iris[(duplicated(iris) | duplicated(iris, fromLast=T)), ]  ##duplicates while searching "bothWays"
    Sepal.Length Sepal.Width Petal.Length Petal.Width   Species
102          5.8         2.7          5.1         1.9 virginica
143          5.8         2.7          5.1         1.9 virginica


Unfortunately this is unnecessarily long and convoluted. Short of a
'bothWays' argument in duplicated(), I came up with a small wrapper
that simplifies the above:
duplicated2 <-
    function(x, bothWays=TRUE, ...)
    {
        if(!bothWays) {
            return(duplicated(x, ...))
        } else if(bothWays) {
                return((duplicated(x, ...) | duplicated(x, fromLast=TRUE, ...)))
        }
    }


Now the above can be achieved simply via:
> iris[duplicated2(iris), ]  ##duplicates while searching "bothWays"
    Sepal.Length Sepal.Width Petal.Length Petal.Width   Species
102          5.8         2.7          5.1         1.9 virginica
143          5.8         2.7          5.1         1.9 virginica


So here's my inquiry: Would the R Core consider adding such
functionality in 'base' R? Either the---suitably cleaned
up---duplicated2() function above, or a "bothWays" argument in
duplicated() itself? Either of the two would improve user convenience
and reduce confusion. (In my case it took some time before I
understood the correct approach to this problem.)

Regards
Liviu


-- 
Do you know how to read?
http://www.alienetworks.com/srtest.cfm
http://goodies.xfce.org/projects/applications/xfce4-dict#speed-reader
Do you know how to write?
http://garbl.home.comcast.net/~garbl/stylemanual/e.htm#e-mail


From murdoch.duncan at gmail.com  Mon Jul 23 15:08:22 2012
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Mon, 23 Jul 2012 09:08:22 -0400
Subject: [Rd] duplicated() variation that goes both ways to capture all
 duplicates
In-Reply-To: <CABxs9Vk1bLgRCi=BfH+nnkyUxfYWyXw7R_JrL9aTyfChfAHhxQ@mail.gmail.com>
References: <CABxs9Vk1bLgRCi=BfH+nnkyUxfYWyXw7R_JrL9aTyfChfAHhxQ@mail.gmail.com>
Message-ID: <500D4CC6.6010508@gmail.com>

On 23/07/2012 8:49 AM, Liviu Andronic wrote:
> Dear all
> The trouble with the current duplicated() function in is that it can
> report duplicates while searching fromFirst _or_ fromLast, but not
> both ways. Often users will want to identify and extract all the
> copies of the item that has duplicates, not only the duplicates
> themselves.
>
> To take the example from the man page:
> > data(iris)
> > iris[duplicated(iris), ]  ##duplicates while searching "fromFirst"
>      Sepal.Length Sepal.Width Petal.Length Petal.Width   Species
> 143          5.8         2.7          5.1         1.9 virginica
> > iris[duplicated(iris, fromLast=T), ]  ##duplicates while searching "fromLast"
>      Sepal.Length Sepal.Width Petal.Length Petal.Width   Species
> 102          5.8         2.7          5.1         1.9 virginica
>
>
> To extract all the copies of the concerned items ("original" and
> duplicates) one would need to do something like this:
> > iris[(duplicated(iris) | duplicated(iris, fromLast=T)), ]  ##duplicates while searching "bothWays"
>      Sepal.Length Sepal.Width Petal.Length Petal.Width   Species
> 102          5.8         2.7          5.1         1.9 virginica
> 143          5.8         2.7          5.1         1.9 virginica
>
>
> Unfortunately this is unnecessarily long and convoluted. Short of a
> 'bothWays' argument in duplicated(), I came up with a small wrapper
> that simplifies the above:
> duplicated2 <-
>      function(x, bothWays=TRUE, ...)
>      {
>          if(!bothWays) {
>              return(duplicated(x, ...))
>          } else if(bothWays) {
>                  return((duplicated(x, ...) | duplicated(x, fromLast=TRUE, ...)))
>          }
>      }
>
>
> Now the above can be achieved simply via:
> > iris[duplicated2(iris), ]  ##duplicates while searching "bothWays"
>      Sepal.Length Sepal.Width Petal.Length Petal.Width   Species
> 102          5.8         2.7          5.1         1.9 virginica
> 143          5.8         2.7          5.1         1.9 virginica
>
>
> So here's my inquiry: Would the R Core consider adding such
> functionality in 'base' R? Either the---suitably cleaned
> up---duplicated2() function above, or a "bothWays" argument in
> duplicated() itself? Either of the two would improve user convenience
> and reduce confusion. (In my case it took some time before I
> understood the correct approach to this problem.)

I can't speak for all of R core, but I don't see the need for this in 
base R -- your solution looks fine to me.

Duncan Murdoch


From josh.m.ulrich at gmail.com  Mon Jul 23 15:17:26 2012
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Mon, 23 Jul 2012 08:17:26 -0500
Subject: [Rd] Reading many large files causes R to crash - Possible Bug
 in R 2.15.1 64-bit Ubuntu
In-Reply-To: <001801cd68d5$233a52c0$69aef840$@gmail.com>
References: <000001cd6843$bf5700a0$3e0501e0$@gmail.com>
	<500C66F9.5050503@gmail.com>
	<002d01cd6895$dbef6ed0$93ce4c70$@gmail.com>
	<CAPPM_gS=a-XoYT3-zUttsQpdqg3KgJnZY172ekGvbyGUk6mGPA@mail.gmail.com>
	<001801cd68d5$233a52c0$69aef840$@gmail.com>
Message-ID: <CAPPM_gQvV9ht-s_o-K=CazasTNFiT_+yRqnwzA1Wg=rYG+87Pw@mail.gmail.com>

Well, you still haven't convinced anyone but yourself that it's
definitely an xts problem, since you have not provided any
reproducible example...
--
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com


On Mon, Jul 23, 2012 at 8:14 AM, David Terk <david.terk at gmail.com> wrote:
> Where should this be discussed since it is definitely XTS related?  I will
> gladly upload the simplified script + data files to whoever is maintaining
> this part of the code.  Fortunately there is a workaround here.
>
> -----Original Message-----
> From: Joshua Ulrich [mailto:josh.m.ulrich at gmail.com]
> Sent: Monday, July 23, 2012 8:15 AM
> To: David Terk
> Cc: Duncan Murdoch; r-devel at r-project.org
> Subject: Re: [Rd] Reading many large files causes R to crash - Possible Bug
> in R 2.15.1 64-bit Ubuntu
>
> David,
>
> You still haven't provided a reproducible example.  As Duncan already said,
> "if you don't post code that allows us to reproduce the crash, it's really
> unlikely that we'll be able to fix it."
>
> And R-devel is not the appropriate venue to discuss this if it's truly an
> issue with xts/zoo.
>
> Best,
> --
> Joshua Ulrich  |  about.me/joshuaulrich
> FOSS Trading  |  www.fosstrading.com
>
>
> On Mon, Jul 23, 2012 at 12:41 AM, David Terk <david.terk at gmail.com> wrote:
>> Looks like the call to:
>>
>> dat.i <- to.period(dat.i, period=per, k=subper, name=NULL)
>>
>> If what is causing the issue.  If variable name is not set, or set to
>> any value other than NULL.  Than no hang occurs.
>>
>> -----Original Message-----
>> From: David Terk [mailto:david.terk at gmail.com]
>> Sent: Monday, July 23, 2012 1:25 AM
>> To: 'Duncan Murdoch'
>> Cc: 'r-devel at r-project.org'
>> Subject: RE: [Rd] Reading many large files causes R to crash -
>> Possible Bug in R 2.15.1 64-bit Ubuntu
>>
>> I've isolated the bug.  When the seg fault was produced there was an
>> error that memory had not been mapped.  Here is the odd part of the
>> bug.  If you comment out certain code and get a full run than comment in
> the code which
>> is causing the problem it will actually run.   So I think it is safe to
>> assume something wrong is taking place with memory allocation.  Example.
>> While testing, I have been able to get to a point where the code will run.
>> But if I reboot the machine and try again, the code will not run.
>>
>> The bug itself is happening somewhere in XTS or ZOO.  I will gladly
>> upload the data files.  It is happening on the 10th data file which is
>> only 225k lines in size.
>>
>> Below is the simplified code.  The call to either
>>
>> dat.i <- to.period(dat.i, period=per, k=subper, name=NULL)
>> index(dat.i) <- index(to.period(templateTimes, period=per, k=subper))
>>
>> is what is causing R to hang or crash.  I have been able to replicate
>> this on Windows 7 64 bit and Ubuntu 64 bit.  Seems easiest to
>> consistently replicate from R Studio.
>>
>> The code below will consistently replicate when the appropriate files
>> are used.
>>
>> parseTickDataFromDir = function(tickerDir, per, subper) {
>>   tickerAbsFilenames = list.files(tickerDir,full.names=T)
>>   tickerNames = list.files(tickerDir,full.names=F)
>>   tickerNames = gsub("_[a-zA-Z0-9].csv","",tickerNames)
>>   pb <- txtProgressBar(min = 0, max = length(tickerAbsFilenames),
>> style = 3)
>>
>>   for(i in 1:length(tickerAbsFilenames)) {
>>     dat.i = parseTickData(tickerAbsFilenames[i])
>>     dates <- unique(substr(as.character(index(dat.i)), 1,10))
>>     times <- rep("09:30:00", length(dates))
>>     openDateTimes <- strptime(paste(dates, times), "%F %H:%M:%S")
>>     templateTimes <- NULL
>>
>>     for (j in 1:length(openDateTimes)) {
>>       if (is.null(templateTimes)) {
>>         templateTimes <- openDateTimes[j] + 0:23400
>>       } else {
>>         templateTimes <- c(templateTimes, openDateTimes[j] + 0:23400)
>>       }
>>     }
>>
>>     templateTimes <- as.xts(templateTimes)
>>     dat.i <- merge(dat.i, templateTimes, all=T)
>>     if (is.na(dat.i[1])) {
>>       dat.i[1] <- -1
>>     }
>>     dat.i <- na.locf(dat.i)
>>         dat.i <- to.period(dat.i, period=per, k=subper, name=NULL)
>>         index(dat.i) <- index(to.period(templateTimes, period=per,
>> k=subper))
>>     setTxtProgressBar(pb, i)
>>   }
>>   close(pb)
>> }
>>
>> parseTickData <- function(inputFile) {
>>   DAT.list <- scan(file=inputFile,
>> sep=",",skip=1,what=list(Date="",Time="",Close=0,Volume=0),quiet=T)
>>   index <-
>> as.POSIXct(paste(DAT.list$Date,DAT.list$Time),format="%m/%d/%Y
>> %H:%M:%S")
>>   DAT.xts <- xts(DAT.list$Close,index)
>>   DAT.xts <- make.index.unique(DAT.xts)
>>   return(DAT.xts)
>> }
>>
>> DATTick <- parseTickDataFromDir(tickerDirSecond, "seconds",10)
>>
>> -----Original Message-----
>> From: Duncan Murdoch [mailto:murdoch.duncan at gmail.com]
>> Sent: Sunday, July 22, 2012 4:48 PM
>> To: David Terk
>> Cc: r-devel at r-project.org
>> Subject: Re: [Rd] Reading many large files causes R to crash -
>> Possible Bug in R 2.15.1 64-bit Ubuntu
>>
>> On 12-07-22 3:54 PM, David Terk wrote:
>>> I am reading several hundred files.  Anywhere from 50k-400k in size.
>>> It appears that when I read these files with R 2.15.1 the process
>>> will hang or seg fault on the scan() call.  This does not happen on R
> 2.14.1.
>>
>> The code below doesn't do anything other than define a couple of
> functions.
>> Please simplify it to code that creates a file (or multiple files),
>> reads it or them, and shows a bug.
>>
>> If you can't do that, then gradually add the rest of the stuff from
>> these functions into the mix until you figure out what is really causing
> the bug.
>>
>> If you don't post code that allows us to reproduce the crash, it's
>> really unlikely that we'll be able to fix it.
>>
>> Duncan Murdoch
>>
>>>
>>>
>>>
>>> This is happening on the precise build of Ubuntu.
>>>
>>>
>>>
>>> I have included everything, but the issue appears to be when
>>> performing the scan in the method parseTickData.
>>>
>>>
>>>
>>> Below is the code.  Hopefully this is the right place to post.
>>>
>>>
>>>
>>> parseTickDataFromDir = function(tickerDir, per, subper, fun) {
>>>
>>>    tickerAbsFilenames = list.files(tickerDir,full.names=T)
>>>
>>>    tickerNames = list.files(tickerDir,full.names=F)
>>>
>>>    tickerNames = gsub("_[a-zA-Z0-9].csv","",tickerNames)
>>>
>>>    pb <- txtProgressBar(min = 0, max = length(tickerAbsFilenames),
>>> style = 3)
>>>
>>>
>>>
>>>    for(i in 1:length(tickerAbsFilenames)) {
>>>
>>>
>>>
>>>      # Grab Raw Tick Data
>>>
>>>      dat.i = parseTickData(tickerAbsFilenames[i])
>>>
>>>      #Sys.sleep(1)
>>>
>>>      # Create Template
>>>
>>>      dates <- unique(substr(as.character(index(dat.i)), 1,10))
>>>
>>>      times <- rep("09:30:00", length(dates))
>>>
>>>      openDateTimes <- strptime(paste(dates, times), "%F %H:%M:%S")
>>>
>>>      templateTimes <- NULL
>>>
>>>
>>>
>>>      for (j in 1:length(openDateTimes)) {
>>>
>>>        if (is.null(templateTimes)) {
>>>
>>>          templateTimes <- openDateTimes[j] + 0:23400
>>>
>>>        } else {
>>>
>>>          templateTimes <- c(templateTimes, openDateTimes[j] +
>>> 0:23400)
>>>
>>>        }
>>>
>>>      }
>>>
>>>
>>>
>>>      # Convert templateTimes to XTS, merge with data and convert NA's
>>>
>>>      templateTimes <- as.xts(templateTimes)
>>>
>>>      dat.i <- merge(dat.i, templateTimes, all=T)
>>>
>>>      # If there is no data in the first print, we will have leading
>>> NA's.  So set them to -1.
>>>
>>>      # Since we do not want these values removed by to.period
>>>
>>>      if (is.na(dat.i[1])) {
>>>
>>>        dat.i[1] <- -1
>>>
>>>      }
>>>
>>>      # Fix remaining NA's
>>>
>>>      dat.i <- na.locf(dat.i)
>>>
>>>      # Convert to desired bucket size
>>>
>>>      dat.i <- to.period(dat.i, period=per, k=subper, name=NULL)
>>>
>>>      # Always use templated index, otherwise merge fails with other
>>> symbols
>>>
>>>      index(dat.i) <- index(to.period(templateTimes, period=per,
>>> k=subper))
>>>
>>>      # If there was missing data at open, set close to NA
>>>
>>>      valsToChange <- which(dat.i[,"Open"] == -1)
>>>
>>>      if (length(valsToChange) != 0) {
>>>
>>>        dat.i[valsToChange, "Close"] <- NA
>>>
>>>      }
>>>
>>>      if(i == 1) {
>>>
>>>        DAT = fun(dat.i)
>>>
>>>      } else {
>>>
>>>        DAT = merge(DAT,fun(dat.i))
>>>
>>>      }
>>>
>>>      setTxtProgressBar(pb, i)
>>>
>>>    }
>>>
>>>    close(pb)
>>>
>>>    colnames(DAT) = tickerNames
>>>
>>>    return(DAT)
>>>
>>> }
>>>
>>>
>>>
>>> parseTickData <- function(inputFile) {
>>>
>>>    DAT.list <- scan(file=inputFile,
>>> sep=",",skip=1,what=list(Date="",Time="",Close=0,Volume=0),quiet=T)
>>>
>>>    index <-
>>> as.POSIXct(paste(DAT.list$Date,DAT.list$Time),format="%m/%d/%Y
>>> %H:%M:%S")
>>>
>>>    DAT.xts <- xts(DAT.list$Close,index)
>>>
>>>    DAT.xts <- make.index.unique(DAT.xts)
>>>
>>>    return(DAT.xts)
>>>
>>> }
>>>
>>>
>>>
>>>
>>>
>>>
>>>       [[alternative HTML version deleted]]
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From david.terk at gmail.com  Mon Jul 23 15:14:46 2012
From: david.terk at gmail.com (David Terk)
Date: Mon, 23 Jul 2012 09:14:46 -0400
Subject: [Rd] Reading many large files causes R to crash - Possible Bug
	in R 2.15.1 64-bit Ubuntu
In-Reply-To: <CAPPM_gS=a-XoYT3-zUttsQpdqg3KgJnZY172ekGvbyGUk6mGPA@mail.gmail.com>
References: <000001cd6843$bf5700a0$3e0501e0$@gmail.com>
	<500C66F9.5050503@gmail.com>
	<002d01cd6895$dbef6ed0$93ce4c70$@gmail.com>
	<CAPPM_gS=a-XoYT3-zUttsQpdqg3KgJnZY172ekGvbyGUk6mGPA@mail.gmail.com>
Message-ID: <001801cd68d5$233a52c0$69aef840$@gmail.com>

Where should this be discussed since it is definitely XTS related?  I will
gladly upload the simplified script + data files to whoever is maintaining
this part of the code.  Fortunately there is a workaround here.

-----Original Message-----
From: Joshua Ulrich [mailto:josh.m.ulrich at gmail.com] 
Sent: Monday, July 23, 2012 8:15 AM
To: David Terk
Cc: Duncan Murdoch; r-devel at r-project.org
Subject: Re: [Rd] Reading many large files causes R to crash - Possible Bug
in R 2.15.1 64-bit Ubuntu

David,

You still haven't provided a reproducible example.  As Duncan already said,
"if you don't post code that allows us to reproduce the crash, it's really
unlikely that we'll be able to fix it."

And R-devel is not the appropriate venue to discuss this if it's truly an
issue with xts/zoo.

Best,
--
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com


On Mon, Jul 23, 2012 at 12:41 AM, David Terk <david.terk at gmail.com> wrote:
> Looks like the call to:
>
> dat.i <- to.period(dat.i, period=per, k=subper, name=NULL)
>
> If what is causing the issue.  If variable name is not set, or set to 
> any value other than NULL.  Than no hang occurs.
>
> -----Original Message-----
> From: David Terk [mailto:david.terk at gmail.com]
> Sent: Monday, July 23, 2012 1:25 AM
> To: 'Duncan Murdoch'
> Cc: 'r-devel at r-project.org'
> Subject: RE: [Rd] Reading many large files causes R to crash - 
> Possible Bug in R 2.15.1 64-bit Ubuntu
>
> I've isolated the bug.  When the seg fault was produced there was an 
> error that memory had not been mapped.  Here is the odd part of the 
> bug.  If you comment out certain code and get a full run than comment in
the code which
> is causing the problem it will actually run.   So I think it is safe to
> assume something wrong is taking place with memory allocation.  Example.
> While testing, I have been able to get to a point where the code will run.
> But if I reboot the machine and try again, the code will not run.
>
> The bug itself is happening somewhere in XTS or ZOO.  I will gladly 
> upload the data files.  It is happening on the 10th data file which is 
> only 225k lines in size.
>
> Below is the simplified code.  The call to either
>
> dat.i <- to.period(dat.i, period=per, k=subper, name=NULL)
> index(dat.i) <- index(to.period(templateTimes, period=per, k=subper))
>
> is what is causing R to hang or crash.  I have been able to replicate 
> this on Windows 7 64 bit and Ubuntu 64 bit.  Seems easiest to 
> consistently replicate from R Studio.
>
> The code below will consistently replicate when the appropriate files 
> are used.
>
> parseTickDataFromDir = function(tickerDir, per, subper) {
>   tickerAbsFilenames = list.files(tickerDir,full.names=T)
>   tickerNames = list.files(tickerDir,full.names=F)
>   tickerNames = gsub("_[a-zA-Z0-9].csv","",tickerNames)
>   pb <- txtProgressBar(min = 0, max = length(tickerAbsFilenames), 
> style = 3)
>
>   for(i in 1:length(tickerAbsFilenames)) {
>     dat.i = parseTickData(tickerAbsFilenames[i])
>     dates <- unique(substr(as.character(index(dat.i)), 1,10))
>     times <- rep("09:30:00", length(dates))
>     openDateTimes <- strptime(paste(dates, times), "%F %H:%M:%S")
>     templateTimes <- NULL
>
>     for (j in 1:length(openDateTimes)) {
>       if (is.null(templateTimes)) {
>         templateTimes <- openDateTimes[j] + 0:23400
>       } else {
>         templateTimes <- c(templateTimes, openDateTimes[j] + 0:23400)
>       }
>     }
>
>     templateTimes <- as.xts(templateTimes)
>     dat.i <- merge(dat.i, templateTimes, all=T)
>     if (is.na(dat.i[1])) {
>       dat.i[1] <- -1
>     }
>     dat.i <- na.locf(dat.i)
>         dat.i <- to.period(dat.i, period=per, k=subper, name=NULL)
>         index(dat.i) <- index(to.period(templateTimes, period=per,
> k=subper))
>     setTxtProgressBar(pb, i)
>   }
>   close(pb)
> }
>
> parseTickData <- function(inputFile) {
>   DAT.list <- scan(file=inputFile,
> sep=",",skip=1,what=list(Date="",Time="",Close=0,Volume=0),quiet=T)
>   index <- 
> as.POSIXct(paste(DAT.list$Date,DAT.list$Time),format="%m/%d/%Y
> %H:%M:%S")
>   DAT.xts <- xts(DAT.list$Close,index)
>   DAT.xts <- make.index.unique(DAT.xts)
>   return(DAT.xts)
> }
>
> DATTick <- parseTickDataFromDir(tickerDirSecond, "seconds",10)
>
> -----Original Message-----
> From: Duncan Murdoch [mailto:murdoch.duncan at gmail.com]
> Sent: Sunday, July 22, 2012 4:48 PM
> To: David Terk
> Cc: r-devel at r-project.org
> Subject: Re: [Rd] Reading many large files causes R to crash - 
> Possible Bug in R 2.15.1 64-bit Ubuntu
>
> On 12-07-22 3:54 PM, David Terk wrote:
>> I am reading several hundred files.  Anywhere from 50k-400k in size.
>> It appears that when I read these files with R 2.15.1 the process 
>> will hang or seg fault on the scan() call.  This does not happen on R
2.14.1.
>
> The code below doesn't do anything other than define a couple of
functions.
> Please simplify it to code that creates a file (or multiple files), 
> reads it or them, and shows a bug.
>
> If you can't do that, then gradually add the rest of the stuff from 
> these functions into the mix until you figure out what is really causing
the bug.
>
> If you don't post code that allows us to reproduce the crash, it's 
> really unlikely that we'll be able to fix it.
>
> Duncan Murdoch
>
>>
>>
>>
>> This is happening on the precise build of Ubuntu.
>>
>>
>>
>> I have included everything, but the issue appears to be when 
>> performing the scan in the method parseTickData.
>>
>>
>>
>> Below is the code.  Hopefully this is the right place to post.
>>
>>
>>
>> parseTickDataFromDir = function(tickerDir, per, subper, fun) {
>>
>>    tickerAbsFilenames = list.files(tickerDir,full.names=T)
>>
>>    tickerNames = list.files(tickerDir,full.names=F)
>>
>>    tickerNames = gsub("_[a-zA-Z0-9].csv","",tickerNames)
>>
>>    pb <- txtProgressBar(min = 0, max = length(tickerAbsFilenames), 
>> style = 3)
>>
>>
>>
>>    for(i in 1:length(tickerAbsFilenames)) {
>>
>>
>>
>>      # Grab Raw Tick Data
>>
>>      dat.i = parseTickData(tickerAbsFilenames[i])
>>
>>      #Sys.sleep(1)
>>
>>      # Create Template
>>
>>      dates <- unique(substr(as.character(index(dat.i)), 1,10))
>>
>>      times <- rep("09:30:00", length(dates))
>>
>>      openDateTimes <- strptime(paste(dates, times), "%F %H:%M:%S")
>>
>>      templateTimes <- NULL
>>
>>
>>
>>      for (j in 1:length(openDateTimes)) {
>>
>>        if (is.null(templateTimes)) {
>>
>>          templateTimes <- openDateTimes[j] + 0:23400
>>
>>        } else {
>>
>>          templateTimes <- c(templateTimes, openDateTimes[j] + 
>> 0:23400)
>>
>>        }
>>
>>      }
>>
>>
>>
>>      # Convert templateTimes to XTS, merge with data and convert NA's
>>
>>      templateTimes <- as.xts(templateTimes)
>>
>>      dat.i <- merge(dat.i, templateTimes, all=T)
>>
>>      # If there is no data in the first print, we will have leading 
>> NA's.  So set them to -1.
>>
>>      # Since we do not want these values removed by to.period
>>
>>      if (is.na(dat.i[1])) {
>>
>>        dat.i[1] <- -1
>>
>>      }
>>
>>      # Fix remaining NA's
>>
>>      dat.i <- na.locf(dat.i)
>>
>>      # Convert to desired bucket size
>>
>>      dat.i <- to.period(dat.i, period=per, k=subper, name=NULL)
>>
>>      # Always use templated index, otherwise merge fails with other 
>> symbols
>>
>>      index(dat.i) <- index(to.period(templateTimes, period=per,
>> k=subper))
>>
>>      # If there was missing data at open, set close to NA
>>
>>      valsToChange <- which(dat.i[,"Open"] == -1)
>>
>>      if (length(valsToChange) != 0) {
>>
>>        dat.i[valsToChange, "Close"] <- NA
>>
>>      }
>>
>>      if(i == 1) {
>>
>>        DAT = fun(dat.i)
>>
>>      } else {
>>
>>        DAT = merge(DAT,fun(dat.i))
>>
>>      }
>>
>>      setTxtProgressBar(pb, i)
>>
>>    }
>>
>>    close(pb)
>>
>>    colnames(DAT) = tickerNames
>>
>>    return(DAT)
>>
>> }
>>
>>
>>
>> parseTickData <- function(inputFile) {
>>
>>    DAT.list <- scan(file=inputFile,
>> sep=",",skip=1,what=list(Date="",Time="",Close=0,Volume=0),quiet=T)
>>
>>    index <-
>> as.POSIXct(paste(DAT.list$Date,DAT.list$Time),format="%m/%d/%Y
>> %H:%M:%S")
>>
>>    DAT.xts <- xts(DAT.list$Close,index)
>>
>>    DAT.xts <- make.index.unique(DAT.xts)
>>
>>    return(DAT.xts)
>>
>> }
>>
>>
>>
>>
>>
>>
>>       [[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From david.terk at gmail.com  Mon Jul 23 15:41:16 2012
From: david.terk at gmail.com (David Terk)
Date: Mon, 23 Jul 2012 09:41:16 -0400
Subject: [Rd] Reading many large files causes R to crash - Possible Bug
	in R 2.15.1 64-bit Ubuntu
In-Reply-To: <CAPPM_gQvV9ht-s_o-K=CazasTNFiT_+yRqnwzA1Wg=rYG+87Pw@mail.gmail.com>
References: <000001cd6843$bf5700a0$3e0501e0$@gmail.com>
	<500C66F9.5050503@gmail.com>
	<002d01cd6895$dbef6ed0$93ce4c70$@gmail.com>
	<CAPPM_gS=a-XoYT3-zUttsQpdqg3KgJnZY172ekGvbyGUk6mGPA@mail.gmail.com>
	<001801cd68d5$233a52c0$69aef840$@gmail.com>
	<CAPPM_gQvV9ht-s_o-K=CazasTNFiT_+yRqnwzA1Wg=rYG+87Pw@mail.gmail.com>
Message-ID: <001a01cd68d8$d6c96580$845c3080$@gmail.com>

I'm attaching a runnable script and corresponding data files.  This will
freeze at 83%.

I'm not sure how much simpler to get than this. 

-----Original Message-----
From: Joshua Ulrich [mailto:josh.m.ulrich at gmail.com] 
Sent: Monday, July 23, 2012 9:17 AM
To: David Terk
Cc: Duncan Murdoch; r-devel at r-project.org
Subject: Re: [Rd] Reading many large files causes R to crash - Possible Bug
in R 2.15.1 64-bit Ubuntu

Well, you still haven't convinced anyone but yourself that it's definitely
an xts problem, since you have not provided any reproducible example...
--
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com


On Mon, Jul 23, 2012 at 8:14 AM, David Terk <david.terk at gmail.com> wrote:
> Where should this be discussed since it is definitely XTS related?  I 
> will gladly upload the simplified script + data files to whoever is 
> maintaining this part of the code.  Fortunately there is a workaround
here.
>
> -----Original Message-----
> From: Joshua Ulrich [mailto:josh.m.ulrich at gmail.com]
> Sent: Monday, July 23, 2012 8:15 AM
> To: David Terk
> Cc: Duncan Murdoch; r-devel at r-project.org
> Subject: Re: [Rd] Reading many large files causes R to crash - 
> Possible Bug in R 2.15.1 64-bit Ubuntu
>
> David,
>
> You still haven't provided a reproducible example.  As Duncan already 
> said, "if you don't post code that allows us to reproduce the crash, 
> it's really unlikely that we'll be able to fix it."
>
> And R-devel is not the appropriate venue to discuss this if it's truly 
> an issue with xts/zoo.
>
> Best,
> --
> Joshua Ulrich  |  about.me/joshuaulrich FOSS Trading  |  
> www.fosstrading.com
>
>
> On Mon, Jul 23, 2012 at 12:41 AM, David Terk <david.terk at gmail.com> wrote:
>> Looks like the call to:
>>
>> dat.i <- to.period(dat.i, period=per, k=subper, name=NULL)
>>
>> If what is causing the issue.  If variable name is not set, or set to 
>> any value other than NULL.  Than no hang occurs.
>>
>> -----Original Message-----
>> From: David Terk [mailto:david.terk at gmail.com]
>> Sent: Monday, July 23, 2012 1:25 AM
>> To: 'Duncan Murdoch'
>> Cc: 'r-devel at r-project.org'
>> Subject: RE: [Rd] Reading many large files causes R to crash - 
>> Possible Bug in R 2.15.1 64-bit Ubuntu
>>
>> I've isolated the bug.  When the seg fault was produced there was an 
>> error that memory had not been mapped.  Here is the odd part of the 
>> bug.  If you comment out certain code and get a full run than comment 
>> in
> the code which
>> is causing the problem it will actually run.   So I think it is safe to
>> assume something wrong is taking place with memory allocation.  Example.
>> While testing, I have been able to get to a point where the code will
run.
>> But if I reboot the machine and try again, the code will not run.
>>
>> The bug itself is happening somewhere in XTS or ZOO.  I will gladly 
>> upload the data files.  It is happening on the 10th data file which 
>> is only 225k lines in size.
>>
>> Below is the simplified code.  The call to either
>>
>> dat.i <- to.period(dat.i, period=per, k=subper, name=NULL)
>> index(dat.i) <- index(to.period(templateTimes, period=per, k=subper))
>>
>> is what is causing R to hang or crash.  I have been able to replicate 
>> this on Windows 7 64 bit and Ubuntu 64 bit.  Seems easiest to 
>> consistently replicate from R Studio.
>>
>> The code below will consistently replicate when the appropriate files 
>> are used.
>>
>> parseTickDataFromDir = function(tickerDir, per, subper) {
>>   tickerAbsFilenames = list.files(tickerDir,full.names=T)
>>   tickerNames = list.files(tickerDir,full.names=F)
>>   tickerNames = gsub("_[a-zA-Z0-9].csv","",tickerNames)
>>   pb <- txtProgressBar(min = 0, max = length(tickerAbsFilenames), 
>> style = 3)
>>
>>   for(i in 1:length(tickerAbsFilenames)) {
>>     dat.i = parseTickData(tickerAbsFilenames[i])
>>     dates <- unique(substr(as.character(index(dat.i)), 1,10))
>>     times <- rep("09:30:00", length(dates))
>>     openDateTimes <- strptime(paste(dates, times), "%F %H:%M:%S")
>>     templateTimes <- NULL
>>
>>     for (j in 1:length(openDateTimes)) {
>>       if (is.null(templateTimes)) {
>>         templateTimes <- openDateTimes[j] + 0:23400
>>       } else {
>>         templateTimes <- c(templateTimes, openDateTimes[j] + 0:23400)
>>       }
>>     }
>>
>>     templateTimes <- as.xts(templateTimes)
>>     dat.i <- merge(dat.i, templateTimes, all=T)
>>     if (is.na(dat.i[1])) {
>>       dat.i[1] <- -1
>>     }
>>     dat.i <- na.locf(dat.i)
>>         dat.i <- to.period(dat.i, period=per, k=subper, name=NULL)
>>         index(dat.i) <- index(to.period(templateTimes, period=per,
>> k=subper))
>>     setTxtProgressBar(pb, i)
>>   }
>>   close(pb)
>> }
>>
>> parseTickData <- function(inputFile) {
>>   DAT.list <- scan(file=inputFile,
>> sep=",",skip=1,what=list(Date="",Time="",Close=0,Volume=0),quiet=T)
>>   index <-
>> as.POSIXct(paste(DAT.list$Date,DAT.list$Time),format="%m/%d/%Y
>> %H:%M:%S")
>>   DAT.xts <- xts(DAT.list$Close,index)
>>   DAT.xts <- make.index.unique(DAT.xts)
>>   return(DAT.xts)
>> }
>>
>> DATTick <- parseTickDataFromDir(tickerDirSecond, "seconds",10)
>>
>> -----Original Message-----
>> From: Duncan Murdoch [mailto:murdoch.duncan at gmail.com]
>> Sent: Sunday, July 22, 2012 4:48 PM
>> To: David Terk
>> Cc: r-devel at r-project.org
>> Subject: Re: [Rd] Reading many large files causes R to crash - 
>> Possible Bug in R 2.15.1 64-bit Ubuntu
>>
>> On 12-07-22 3:54 PM, David Terk wrote:
>>> I am reading several hundred files.  Anywhere from 50k-400k in size.
>>> It appears that when I read these files with R 2.15.1 the process 
>>> will hang or seg fault on the scan() call.  This does not happen on 
>>> R
> 2.14.1.
>>
>> The code below doesn't do anything other than define a couple of
> functions.
>> Please simplify it to code that creates a file (or multiple files), 
>> reads it or them, and shows a bug.
>>
>> If you can't do that, then gradually add the rest of the stuff from 
>> these functions into the mix until you figure out what is really 
>> causing
> the bug.
>>
>> If you don't post code that allows us to reproduce the crash, it's 
>> really unlikely that we'll be able to fix it.
>>
>> Duncan Murdoch
>>
>>>
>>>
>>>
>>> This is happening on the precise build of Ubuntu.
>>>
>>>
>>>
>>> I have included everything, but the issue appears to be when 
>>> performing the scan in the method parseTickData.
>>>
>>>
>>>
>>> Below is the code.  Hopefully this is the right place to post.
>>>
>>>
>>>
>>> parseTickDataFromDir = function(tickerDir, per, subper, fun) {
>>>
>>>    tickerAbsFilenames = list.files(tickerDir,full.names=T)
>>>
>>>    tickerNames = list.files(tickerDir,full.names=F)
>>>
>>>    tickerNames = gsub("_[a-zA-Z0-9].csv","",tickerNames)
>>>
>>>    pb <- txtProgressBar(min = 0, max = length(tickerAbsFilenames), 
>>> style = 3)
>>>
>>>
>>>
>>>    for(i in 1:length(tickerAbsFilenames)) {
>>>
>>>
>>>
>>>      # Grab Raw Tick Data
>>>
>>>      dat.i = parseTickData(tickerAbsFilenames[i])
>>>
>>>      #Sys.sleep(1)
>>>
>>>      # Create Template
>>>
>>>      dates <- unique(substr(as.character(index(dat.i)), 1,10))
>>>
>>>      times <- rep("09:30:00", length(dates))
>>>
>>>      openDateTimes <- strptime(paste(dates, times), "%F %H:%M:%S")
>>>
>>>      templateTimes <- NULL
>>>
>>>
>>>
>>>      for (j in 1:length(openDateTimes)) {
>>>
>>>        if (is.null(templateTimes)) {
>>>
>>>          templateTimes <- openDateTimes[j] + 0:23400
>>>
>>>        } else {
>>>
>>>          templateTimes <- c(templateTimes, openDateTimes[j] +
>>> 0:23400)
>>>
>>>        }
>>>
>>>      }
>>>
>>>
>>>
>>>      # Convert templateTimes to XTS, merge with data and convert 
>>> NA's
>>>
>>>      templateTimes <- as.xts(templateTimes)
>>>
>>>      dat.i <- merge(dat.i, templateTimes, all=T)
>>>
>>>      # If there is no data in the first print, we will have leading 
>>> NA's.  So set them to -1.
>>>
>>>      # Since we do not want these values removed by to.period
>>>
>>>      if (is.na(dat.i[1])) {
>>>
>>>        dat.i[1] <- -1
>>>
>>>      }
>>>
>>>      # Fix remaining NA's
>>>
>>>      dat.i <- na.locf(dat.i)
>>>
>>>      # Convert to desired bucket size
>>>
>>>      dat.i <- to.period(dat.i, period=per, k=subper, name=NULL)
>>>
>>>      # Always use templated index, otherwise merge fails with other 
>>> symbols
>>>
>>>      index(dat.i) <- index(to.period(templateTimes, period=per,
>>> k=subper))
>>>
>>>      # If there was missing data at open, set close to NA
>>>
>>>      valsToChange <- which(dat.i[,"Open"] == -1)
>>>
>>>      if (length(valsToChange) != 0) {
>>>
>>>        dat.i[valsToChange, "Close"] <- NA
>>>
>>>      }
>>>
>>>      if(i == 1) {
>>>
>>>        DAT = fun(dat.i)
>>>
>>>      } else {
>>>
>>>        DAT = merge(DAT,fun(dat.i))
>>>
>>>      }
>>>
>>>      setTxtProgressBar(pb, i)
>>>
>>>    }
>>>
>>>    close(pb)
>>>
>>>    colnames(DAT) = tickerNames
>>>
>>>    return(DAT)
>>>
>>> }
>>>
>>>
>>>
>>> parseTickData <- function(inputFile) {
>>>
>>>    DAT.list <- scan(file=inputFile,
>>> sep=",",skip=1,what=list(Date="",Time="",Close=0,Volume=0),quiet=T)
>>>
>>>    index <-
>>> as.POSIXct(paste(DAT.list$Date,DAT.list$Time),format="%m/%d/%Y
>>> %H:%M:%S")
>>>
>>>    DAT.xts <- xts(DAT.list$Close,index)
>>>
>>>    DAT.xts <- make.index.unique(DAT.xts)
>>>
>>>    return(DAT.xts)
>>>
>>> }
>>>
>>>
>>>
>>>
>>>
>>>
>>>       [[alternative HTML version deleted]]
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>

From josh.m.ulrich at gmail.com  Mon Jul 23 17:59:33 2012
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Mon, 23 Jul 2012 10:59:33 -0500
Subject: [Rd] Reading many large files causes R to crash - Possible Bug
 in R 2.15.1 64-bit Ubuntu
In-Reply-To: <001a01cd68d8$d6c96580$845c3080$@gmail.com>
References: <000001cd6843$bf5700a0$3e0501e0$@gmail.com>
	<500C66F9.5050503@gmail.com>
	<002d01cd6895$dbef6ed0$93ce4c70$@gmail.com>
	<CAPPM_gS=a-XoYT3-zUttsQpdqg3KgJnZY172ekGvbyGUk6mGPA@mail.gmail.com>
	<001801cd68d5$233a52c0$69aef840$@gmail.com>
	<CAPPM_gQvV9ht-s_o-K=CazasTNFiT_+yRqnwzA1Wg=rYG+87Pw@mail.gmail.com>
	<001a01cd68d8$d6c96580$845c3080$@gmail.com>
Message-ID: <CAPPM_gRhUUoCcRaTwhsyVZjGgdoN7Y3kAndyBdREBSwHqj7waA@mail.gmail.com>

David,

Thank you for providing something reproducible.

This line:
templateTimes <- as.xts(templateTimes)

creates a zero-width xts object (i.e. the coredata is a zero-length
vector, but there is a non-zero-length index). So, the
to.period(templateTimes) call returns OHLC data of random memory
locations.  This is the likely cause of the segfaults.

Since aggregating "no data" doesn't make sense, I have patched
to.period to throw an error when run on zero-width/length objects
(revision 690 on R-Forge).  The attached file works with the CRAN
version of xts because it avoids the issue entirely.

Your script will still "hang" on the BAC_0.csv file because
as.character.POSIXt can take a long time.  Better to just call
format() directly (as I do in the attached file).

If you have any follow-up questions, please send them to R-SIG-Finance.

Best,
--
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com


On Mon, Jul 23, 2012 at 8:41 AM, David Terk <david.terk at gmail.com> wrote:
> I'm attaching a runnable script and corresponding data files.  This will
> freeze at 83%.
>
> I'm not sure how much simpler to get than this.
>
> -----Original Message-----
> From: Joshua Ulrich [mailto:josh.m.ulrich at gmail.com]
> Sent: Monday, July 23, 2012 9:17 AM
> To: David Terk
> Cc: Duncan Murdoch; r-devel at r-project.org
> Subject: Re: [Rd] Reading many large files causes R to crash - Possible Bug
> in R 2.15.1 64-bit Ubuntu
>
> Well, you still haven't convinced anyone but yourself that it's definitely
> an xts problem, since you have not provided any reproducible example...
> --
> Joshua Ulrich  |  about.me/joshuaulrich
> FOSS Trading  |  www.fosstrading.com
>
>
> On Mon, Jul 23, 2012 at 8:14 AM, David Terk <david.terk at gmail.com> wrote:
>> Where should this be discussed since it is definitely XTS related?  I
>> will gladly upload the simplified script + data files to whoever is
>> maintaining this part of the code.  Fortunately there is a workaround
> here.
>>
>> -----Original Message-----
>> From: Joshua Ulrich [mailto:josh.m.ulrich at gmail.com]
>> Sent: Monday, July 23, 2012 8:15 AM
>> To: David Terk
>> Cc: Duncan Murdoch; r-devel at r-project.org
>> Subject: Re: [Rd] Reading many large files causes R to crash -
>> Possible Bug in R 2.15.1 64-bit Ubuntu
>>
>> David,
>>
>> You still haven't provided a reproducible example.  As Duncan already
>> said, "if you don't post code that allows us to reproduce the crash,
>> it's really unlikely that we'll be able to fix it."
>>
>> And R-devel is not the appropriate venue to discuss this if it's truly
>> an issue with xts/zoo.
>>
>> Best,
>> --
>> Joshua Ulrich  |  about.me/joshuaulrich FOSS Trading  |
>> www.fosstrading.com
>>
>>
>> On Mon, Jul 23, 2012 at 12:41 AM, David Terk <david.terk at gmail.com> wrote:
>>> Looks like the call to:
>>>
>>> dat.i <- to.period(dat.i, period=per, k=subper, name=NULL)
>>>
>>> If what is causing the issue.  If variable name is not set, or set to
>>> any value other than NULL.  Than no hang occurs.
>>>
>>> -----Original Message-----
>>> From: David Terk [mailto:david.terk at gmail.com]
>>> Sent: Monday, July 23, 2012 1:25 AM
>>> To: 'Duncan Murdoch'
>>> Cc: 'r-devel at r-project.org'
>>> Subject: RE: [Rd] Reading many large files causes R to crash -
>>> Possible Bug in R 2.15.1 64-bit Ubuntu
>>>
>>> I've isolated the bug.  When the seg fault was produced there was an
>>> error that memory had not been mapped.  Here is the odd part of the
>>> bug.  If you comment out certain code and get a full run than comment
>>> in
>> the code which
>>> is causing the problem it will actually run.   So I think it is safe to
>>> assume something wrong is taking place with memory allocation.  Example.
>>> While testing, I have been able to get to a point where the code will
> run.
>>> But if I reboot the machine and try again, the code will not run.
>>>
>>> The bug itself is happening somewhere in XTS or ZOO.  I will gladly
>>> upload the data files.  It is happening on the 10th data file which
>>> is only 225k lines in size.
>>>
>>> Below is the simplified code.  The call to either
>>>
>>> dat.i <- to.period(dat.i, period=per, k=subper, name=NULL)
>>> index(dat.i) <- index(to.period(templateTimes, period=per, k=subper))
>>>
>>> is what is causing R to hang or crash.  I have been able to replicate
>>> this on Windows 7 64 bit and Ubuntu 64 bit.  Seems easiest to
>>> consistently replicate from R Studio.
>>>
>>> The code below will consistently replicate when the appropriate files
>>> are used.
>>>
>>> parseTickDataFromDir = function(tickerDir, per, subper) {
>>>   tickerAbsFilenames = list.files(tickerDir,full.names=T)
>>>   tickerNames = list.files(tickerDir,full.names=F)
>>>   tickerNames = gsub("_[a-zA-Z0-9].csv","",tickerNames)
>>>   pb <- txtProgressBar(min = 0, max = length(tickerAbsFilenames),
>>> style = 3)
>>>
>>>   for(i in 1:length(tickerAbsFilenames)) {
>>>     dat.i = parseTickData(tickerAbsFilenames[i])
>>>     dates <- unique(substr(as.character(index(dat.i)), 1,10))
>>>     times <- rep("09:30:00", length(dates))
>>>     openDateTimes <- strptime(paste(dates, times), "%F %H:%M:%S")
>>>     templateTimes <- NULL
>>>
>>>     for (j in 1:length(openDateTimes)) {
>>>       if (is.null(templateTimes)) {
>>>         templateTimes <- openDateTimes[j] + 0:23400
>>>       } else {
>>>         templateTimes <- c(templateTimes, openDateTimes[j] + 0:23400)
>>>       }
>>>     }
>>>
>>>     templateTimes <- as.xts(templateTimes)
>>>     dat.i <- merge(dat.i, templateTimes, all=T)
>>>     if (is.na(dat.i[1])) {
>>>       dat.i[1] <- -1
>>>     }
>>>     dat.i <- na.locf(dat.i)
>>>         dat.i <- to.period(dat.i, period=per, k=subper, name=NULL)
>>>         index(dat.i) <- index(to.period(templateTimes, period=per,
>>> k=subper))
>>>     setTxtProgressBar(pb, i)
>>>   }
>>>   close(pb)
>>> }
>>>
>>> parseTickData <- function(inputFile) {
>>>   DAT.list <- scan(file=inputFile,
>>> sep=",",skip=1,what=list(Date="",Time="",Close=0,Volume=0),quiet=T)
>>>   index <-
>>> as.POSIXct(paste(DAT.list$Date,DAT.list$Time),format="%m/%d/%Y
>>> %H:%M:%S")
>>>   DAT.xts <- xts(DAT.list$Close,index)
>>>   DAT.xts <- make.index.unique(DAT.xts)
>>>   return(DAT.xts)
>>> }
>>>
>>> DATTick <- parseTickDataFromDir(tickerDirSecond, "seconds",10)
>>>
>>> -----Original Message-----
>>> From: Duncan Murdoch [mailto:murdoch.duncan at gmail.com]
>>> Sent: Sunday, July 22, 2012 4:48 PM
>>> To: David Terk
>>> Cc: r-devel at r-project.org
>>> Subject: Re: [Rd] Reading many large files causes R to crash -
>>> Possible Bug in R 2.15.1 64-bit Ubuntu
>>>
>>> On 12-07-22 3:54 PM, David Terk wrote:
>>>> I am reading several hundred files.  Anywhere from 50k-400k in size.
>>>> It appears that when I read these files with R 2.15.1 the process
>>>> will hang or seg fault on the scan() call.  This does not happen on
>>>> R
>> 2.14.1.
>>>
>>> The code below doesn't do anything other than define a couple of
>> functions.
>>> Please simplify it to code that creates a file (or multiple files),
>>> reads it or them, and shows a bug.
>>>
>>> If you can't do that, then gradually add the rest of the stuff from
>>> these functions into the mix until you figure out what is really
>>> causing
>> the bug.
>>>
>>> If you don't post code that allows us to reproduce the crash, it's
>>> really unlikely that we'll be able to fix it.
>>>
>>> Duncan Murdoch
>>>
>>>>
>>>>
>>>>
>>>> This is happening on the precise build of Ubuntu.
>>>>
>>>>
>>>>
>>>> I have included everything, but the issue appears to be when
>>>> performing the scan in the method parseTickData.
>>>>
>>>>
>>>>
>>>> Below is the code.  Hopefully this is the right place to post.
>>>>
>>>>
>>>>
>>>> parseTickDataFromDir = function(tickerDir, per, subper, fun) {
>>>>
>>>>    tickerAbsFilenames = list.files(tickerDir,full.names=T)
>>>>
>>>>    tickerNames = list.files(tickerDir,full.names=F)
>>>>
>>>>    tickerNames = gsub("_[a-zA-Z0-9].csv","",tickerNames)
>>>>
>>>>    pb <- txtProgressBar(min = 0, max = length(tickerAbsFilenames),
>>>> style = 3)
>>>>
>>>>
>>>>
>>>>    for(i in 1:length(tickerAbsFilenames)) {
>>>>
>>>>
>>>>
>>>>      # Grab Raw Tick Data
>>>>
>>>>      dat.i = parseTickData(tickerAbsFilenames[i])
>>>>
>>>>      #Sys.sleep(1)
>>>>
>>>>      # Create Template
>>>>
>>>>      dates <- unique(substr(as.character(index(dat.i)), 1,10))
>>>>
>>>>      times <- rep("09:30:00", length(dates))
>>>>
>>>>      openDateTimes <- strptime(paste(dates, times), "%F %H:%M:%S")
>>>>
>>>>      templateTimes <- NULL
>>>>
>>>>
>>>>
>>>>      for (j in 1:length(openDateTimes)) {
>>>>
>>>>        if (is.null(templateTimes)) {
>>>>
>>>>          templateTimes <- openDateTimes[j] + 0:23400
>>>>
>>>>        } else {
>>>>
>>>>          templateTimes <- c(templateTimes, openDateTimes[j] +
>>>> 0:23400)
>>>>
>>>>        }
>>>>
>>>>      }
>>>>
>>>>
>>>>
>>>>      # Convert templateTimes to XTS, merge with data and convert
>>>> NA's
>>>>
>>>>      templateTimes <- as.xts(templateTimes)
>>>>
>>>>      dat.i <- merge(dat.i, templateTimes, all=T)
>>>>
>>>>      # If there is no data in the first print, we will have leading
>>>> NA's.  So set them to -1.
>>>>
>>>>      # Since we do not want these values removed by to.period
>>>>
>>>>      if (is.na(dat.i[1])) {
>>>>
>>>>        dat.i[1] <- -1
>>>>
>>>>      }
>>>>
>>>>      # Fix remaining NA's
>>>>
>>>>      dat.i <- na.locf(dat.i)
>>>>
>>>>      # Convert to desired bucket size
>>>>
>>>>      dat.i <- to.period(dat.i, period=per, k=subper, name=NULL)
>>>>
>>>>      # Always use templated index, otherwise merge fails with other
>>>> symbols
>>>>
>>>>      index(dat.i) <- index(to.period(templateTimes, period=per,
>>>> k=subper))
>>>>
>>>>      # If there was missing data at open, set close to NA
>>>>
>>>>      valsToChange <- which(dat.i[,"Open"] == -1)
>>>>
>>>>      if (length(valsToChange) != 0) {
>>>>
>>>>        dat.i[valsToChange, "Close"] <- NA
>>>>
>>>>      }
>>>>
>>>>      if(i == 1) {
>>>>
>>>>        DAT = fun(dat.i)
>>>>
>>>>      } else {
>>>>
>>>>        DAT = merge(DAT,fun(dat.i))
>>>>
>>>>      }
>>>>
>>>>      setTxtProgressBar(pb, i)
>>>>
>>>>    }
>>>>
>>>>    close(pb)
>>>>
>>>>    colnames(DAT) = tickerNames
>>>>
>>>>    return(DAT)
>>>>
>>>> }
>>>>
>>>>
>>>>
>>>> parseTickData <- function(inputFile) {
>>>>
>>>>    DAT.list <- scan(file=inputFile,
>>>> sep=",",skip=1,what=list(Date="",Time="",Close=0,Volume=0),quiet=T)
>>>>
>>>>    index <-
>>>> as.POSIXct(paste(DAT.list$Date,DAT.list$Time),format="%m/%d/%Y
>>>> %H:%M:%S")
>>>>
>>>>    DAT.xts <- xts(DAT.list$Close,index)
>>>>
>>>>    DAT.xts <- make.index.unique(DAT.xts)
>>>>
>>>>    return(DAT.xts)
>>>>
>>>> }
>>>>
>>>>
>>>>
>>>>
>>>>
>>>>
>>>>       [[alternative HTML version deleted]]
>>>>
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>

From david.terk at gmail.com  Mon Jul 23 18:49:36 2012
From: david.terk at gmail.com (David Terk)
Date: Mon, 23 Jul 2012 12:49:36 -0400
Subject: [Rd] Reading many large files causes R to crash - Possible Bug
	in R 2.15.1 64-bit Ubuntu
In-Reply-To: <CAPPM_gRhUUoCcRaTwhsyVZjGgdoN7Y3kAndyBdREBSwHqj7waA@mail.gmail.com>
References: <000001cd6843$bf5700a0$3e0501e0$@gmail.com>
	<500C66F9.5050503@gmail.com>
	<002d01cd6895$dbef6ed0$93ce4c70$@gmail.com>
	<CAPPM_gS=a-XoYT3-zUttsQpdqg3KgJnZY172ekGvbyGUk6mGPA@mail.gmail.com>
	<001801cd68d5$233a52c0$69aef840$@gmail.com>
	<CAPPM_gQvV9ht-s_o-K=CazasTNFiT_+yRqnwzA1Wg=rYG+87Pw@mail.gmail.com>
	<001a01cd68d8$d6c96580$845c3080$@gmail.com>
	<CAPPM_gRhUUoCcRaTwhsyVZjGgdoN7Y3kAndyBdREBSwHqj7waA@mail.gmail.com>
Message-ID: <006001cd68f3$25d52640$717f72c0$@gmail.com>

Thank you for getting this done so quickly.  This will process now.

One quick question regarding a call to as.character.POSIXt.  When using
scan, since scan reads line by line, would it make sense to have the ability
to perform a char -> POSIXct conversion on each line that is read, rather
than after all lines have been read?  Perhaps this already exists somewhere
and I am not aware of it.

-----Original Message-----
From: Joshua Ulrich [mailto:josh.m.ulrich at gmail.com] 
Sent: Monday, July 23, 2012 12:00 PM
To: David Terk
Cc: Duncan Murdoch; r-devel at r-project.org
Subject: Re: [Rd] Reading many large files causes R to crash - Possible Bug
in R 2.15.1 64-bit Ubuntu

David,

Thank you for providing something reproducible.

This line:
templateTimes <- as.xts(templateTimes)

creates a zero-width xts object (i.e. the coredata is a zero-length vector,
but there is a non-zero-length index). So, the
to.period(templateTimes) call returns OHLC data of random memory locations.
This is the likely cause of the segfaults.

Since aggregating "no data" doesn't make sense, I have patched to.period to
throw an error when run on zero-width/length objects (revision 690 on
R-Forge).  The attached file works with the CRAN version of xts because it
avoids the issue entirely.

Your script will still "hang" on the BAC_0.csv file because
as.character.POSIXt can take a long time.  Better to just call
format() directly (as I do in the attached file).

If you have any follow-up questions, please send them to R-SIG-Finance.

Best,
--
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com


On Mon, Jul 23, 2012 at 8:41 AM, David Terk <david.terk at gmail.com> wrote:
> I'm attaching a runnable script and corresponding data files.  This 
> will freeze at 83%.
>
> I'm not sure how much simpler to get than this.
>
> -----Original Message-----
> From: Joshua Ulrich [mailto:josh.m.ulrich at gmail.com]
> Sent: Monday, July 23, 2012 9:17 AM
> To: David Terk
> Cc: Duncan Murdoch; r-devel at r-project.org
> Subject: Re: [Rd] Reading many large files causes R to crash - 
> Possible Bug in R 2.15.1 64-bit Ubuntu
>
> Well, you still haven't convinced anyone but yourself that it's 
> definitely an xts problem, since you have not provided any reproducible
example...
> --
> Joshua Ulrich  |  about.me/joshuaulrich FOSS Trading  |  
> www.fosstrading.com
>
>
> On Mon, Jul 23, 2012 at 8:14 AM, David Terk <david.terk at gmail.com> wrote:
>> Where should this be discussed since it is definitely XTS related?  I 
>> will gladly upload the simplified script + data files to whoever is 
>> maintaining this part of the code.  Fortunately there is a workaround
> here.
>>
>> -----Original Message-----
>> From: Joshua Ulrich [mailto:josh.m.ulrich at gmail.com]
>> Sent: Monday, July 23, 2012 8:15 AM
>> To: David Terk
>> Cc: Duncan Murdoch; r-devel at r-project.org
>> Subject: Re: [Rd] Reading many large files causes R to crash - 
>> Possible Bug in R 2.15.1 64-bit Ubuntu
>>
>> David,
>>
>> You still haven't provided a reproducible example.  As Duncan already 
>> said, "if you don't post code that allows us to reproduce the crash, 
>> it's really unlikely that we'll be able to fix it."
>>
>> And R-devel is not the appropriate venue to discuss this if it's 
>> truly an issue with xts/zoo.
>>
>> Best,
>> --
>> Joshua Ulrich  |  about.me/joshuaulrich FOSS Trading  | 
>> www.fosstrading.com
>>
>>
>> On Mon, Jul 23, 2012 at 12:41 AM, David Terk <david.terk at gmail.com>
wrote:
>>> Looks like the call to:
>>>
>>> dat.i <- to.period(dat.i, period=per, k=subper, name=NULL)
>>>
>>> If what is causing the issue.  If variable name is not set, or set 
>>> to any value other than NULL.  Than no hang occurs.
>>>
>>> -----Original Message-----
>>> From: David Terk [mailto:david.terk at gmail.com]
>>> Sent: Monday, July 23, 2012 1:25 AM
>>> To: 'Duncan Murdoch'
>>> Cc: 'r-devel at r-project.org'
>>> Subject: RE: [Rd] Reading many large files causes R to crash - 
>>> Possible Bug in R 2.15.1 64-bit Ubuntu
>>>
>>> I've isolated the bug.  When the seg fault was produced there was an 
>>> error that memory had not been mapped.  Here is the odd part of the 
>>> bug.  If you comment out certain code and get a full run than 
>>> comment in
>> the code which
>>> is causing the problem it will actually run.   So I think it is safe to
>>> assume something wrong is taking place with memory allocation.  Example.
>>> While testing, I have been able to get to a point where the code 
>>> will
> run.
>>> But if I reboot the machine and try again, the code will not run.
>>>
>>> The bug itself is happening somewhere in XTS or ZOO.  I will gladly 
>>> upload the data files.  It is happening on the 10th data file which 
>>> is only 225k lines in size.
>>>
>>> Below is the simplified code.  The call to either
>>>
>>> dat.i <- to.period(dat.i, period=per, k=subper, name=NULL)
>>> index(dat.i) <- index(to.period(templateTimes, period=per, 
>>> k=subper))
>>>
>>> is what is causing R to hang or crash.  I have been able to 
>>> replicate this on Windows 7 64 bit and Ubuntu 64 bit.  Seems easiest 
>>> to consistently replicate from R Studio.
>>>
>>> The code below will consistently replicate when the appropriate 
>>> files are used.
>>>
>>> parseTickDataFromDir = function(tickerDir, per, subper) {
>>>   tickerAbsFilenames = list.files(tickerDir,full.names=T)
>>>   tickerNames = list.files(tickerDir,full.names=F)
>>>   tickerNames = gsub("_[a-zA-Z0-9].csv","",tickerNames)
>>>   pb <- txtProgressBar(min = 0, max = length(tickerAbsFilenames), 
>>> style = 3)
>>>
>>>   for(i in 1:length(tickerAbsFilenames)) {
>>>     dat.i = parseTickData(tickerAbsFilenames[i])
>>>     dates <- unique(substr(as.character(index(dat.i)), 1,10))
>>>     times <- rep("09:30:00", length(dates))
>>>     openDateTimes <- strptime(paste(dates, times), "%F %H:%M:%S")
>>>     templateTimes <- NULL
>>>
>>>     for (j in 1:length(openDateTimes)) {
>>>       if (is.null(templateTimes)) {
>>>         templateTimes <- openDateTimes[j] + 0:23400
>>>       } else {
>>>         templateTimes <- c(templateTimes, openDateTimes[j] + 0:23400)
>>>       }
>>>     }
>>>
>>>     templateTimes <- as.xts(templateTimes)
>>>     dat.i <- merge(dat.i, templateTimes, all=T)
>>>     if (is.na(dat.i[1])) {
>>>       dat.i[1] <- -1
>>>     }
>>>     dat.i <- na.locf(dat.i)
>>>         dat.i <- to.period(dat.i, period=per, k=subper, name=NULL)
>>>         index(dat.i) <- index(to.period(templateTimes, period=per,
>>> k=subper))
>>>     setTxtProgressBar(pb, i)
>>>   }
>>>   close(pb)
>>> }
>>>
>>> parseTickData <- function(inputFile) {
>>>   DAT.list <- scan(file=inputFile,
>>> sep=",",skip=1,what=list(Date="",Time="",Close=0,Volume=0),quiet=T)
>>>   index <-
>>> as.POSIXct(paste(DAT.list$Date,DAT.list$Time),format="%m/%d/%Y
>>> %H:%M:%S")
>>>   DAT.xts <- xts(DAT.list$Close,index)
>>>   DAT.xts <- make.index.unique(DAT.xts)
>>>   return(DAT.xts)
>>> }
>>>
>>> DATTick <- parseTickDataFromDir(tickerDirSecond, "seconds",10)
>>>
>>> -----Original Message-----
>>> From: Duncan Murdoch [mailto:murdoch.duncan at gmail.com]
>>> Sent: Sunday, July 22, 2012 4:48 PM
>>> To: David Terk
>>> Cc: r-devel at r-project.org
>>> Subject: Re: [Rd] Reading many large files causes R to crash - 
>>> Possible Bug in R 2.15.1 64-bit Ubuntu
>>>
>>> On 12-07-22 3:54 PM, David Terk wrote:
>>>> I am reading several hundred files.  Anywhere from 50k-400k in size.
>>>> It appears that when I read these files with R 2.15.1 the process 
>>>> will hang or seg fault on the scan() call.  This does not happen on 
>>>> R
>> 2.14.1.
>>>
>>> The code below doesn't do anything other than define a couple of
>> functions.
>>> Please simplify it to code that creates a file (or multiple files), 
>>> reads it or them, and shows a bug.
>>>
>>> If you can't do that, then gradually add the rest of the stuff from 
>>> these functions into the mix until you figure out what is really 
>>> causing
>> the bug.
>>>
>>> If you don't post code that allows us to reproduce the crash, it's 
>>> really unlikely that we'll be able to fix it.
>>>
>>> Duncan Murdoch
>>>
>>>>
>>>>
>>>>
>>>> This is happening on the precise build of Ubuntu.
>>>>
>>>>
>>>>
>>>> I have included everything, but the issue appears to be when 
>>>> performing the scan in the method parseTickData.
>>>>
>>>>
>>>>
>>>> Below is the code.  Hopefully this is the right place to post.
>>>>
>>>>
>>>>
>>>> parseTickDataFromDir = function(tickerDir, per, subper, fun) {
>>>>
>>>>    tickerAbsFilenames = list.files(tickerDir,full.names=T)
>>>>
>>>>    tickerNames = list.files(tickerDir,full.names=F)
>>>>
>>>>    tickerNames = gsub("_[a-zA-Z0-9].csv","",tickerNames)
>>>>
>>>>    pb <- txtProgressBar(min = 0, max = length(tickerAbsFilenames), 
>>>> style = 3)
>>>>
>>>>
>>>>
>>>>    for(i in 1:length(tickerAbsFilenames)) {
>>>>
>>>>
>>>>
>>>>      # Grab Raw Tick Data
>>>>
>>>>      dat.i = parseTickData(tickerAbsFilenames[i])
>>>>
>>>>      #Sys.sleep(1)
>>>>
>>>>      # Create Template
>>>>
>>>>      dates <- unique(substr(as.character(index(dat.i)), 1,10))
>>>>
>>>>      times <- rep("09:30:00", length(dates))
>>>>
>>>>      openDateTimes <- strptime(paste(dates, times), "%F %H:%M:%S")
>>>>
>>>>      templateTimes <- NULL
>>>>
>>>>
>>>>
>>>>      for (j in 1:length(openDateTimes)) {
>>>>
>>>>        if (is.null(templateTimes)) {
>>>>
>>>>          templateTimes <- openDateTimes[j] + 0:23400
>>>>
>>>>        } else {
>>>>
>>>>          templateTimes <- c(templateTimes, openDateTimes[j] +
>>>> 0:23400)
>>>>
>>>>        }
>>>>
>>>>      }
>>>>
>>>>
>>>>
>>>>      # Convert templateTimes to XTS, merge with data and convert 
>>>> NA's
>>>>
>>>>      templateTimes <- as.xts(templateTimes)
>>>>
>>>>      dat.i <- merge(dat.i, templateTimes, all=T)
>>>>
>>>>      # If there is no data in the first print, we will have leading 
>>>> NA's.  So set them to -1.
>>>>
>>>>      # Since we do not want these values removed by to.period
>>>>
>>>>      if (is.na(dat.i[1])) {
>>>>
>>>>        dat.i[1] <- -1
>>>>
>>>>      }
>>>>
>>>>      # Fix remaining NA's
>>>>
>>>>      dat.i <- na.locf(dat.i)
>>>>
>>>>      # Convert to desired bucket size
>>>>
>>>>      dat.i <- to.period(dat.i, period=per, k=subper, name=NULL)
>>>>
>>>>      # Always use templated index, otherwise merge fails with other 
>>>> symbols
>>>>
>>>>      index(dat.i) <- index(to.period(templateTimes, period=per,
>>>> k=subper))
>>>>
>>>>      # If there was missing data at open, set close to NA
>>>>
>>>>      valsToChange <- which(dat.i[,"Open"] == -1)
>>>>
>>>>      if (length(valsToChange) != 0) {
>>>>
>>>>        dat.i[valsToChange, "Close"] <- NA
>>>>
>>>>      }
>>>>
>>>>      if(i == 1) {
>>>>
>>>>        DAT = fun(dat.i)
>>>>
>>>>      } else {
>>>>
>>>>        DAT = merge(DAT,fun(dat.i))
>>>>
>>>>      }
>>>>
>>>>      setTxtProgressBar(pb, i)
>>>>
>>>>    }
>>>>
>>>>    close(pb)
>>>>
>>>>    colnames(DAT) = tickerNames
>>>>
>>>>    return(DAT)
>>>>
>>>> }
>>>>
>>>>
>>>>
>>>> parseTickData <- function(inputFile) {
>>>>
>>>>    DAT.list <- scan(file=inputFile,
>>>> sep=",",skip=1,what=list(Date="",Time="",Close=0,Volume=0),quiet=T)
>>>>
>>>>    index <-
>>>> as.POSIXct(paste(DAT.list$Date,DAT.list$Time),format="%m/%d/%Y
>>>> %H:%M:%S")
>>>>
>>>>    DAT.xts <- xts(DAT.list$Close,index)
>>>>
>>>>    DAT.xts <- make.index.unique(DAT.xts)
>>>>
>>>>    return(DAT.xts)
>>>>
>>>> }
>>>>
>>>>
>>>>
>>>>
>>>>
>>>>
>>>>       [[alternative HTML version deleted]]
>>>>
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>


From walcott3 at msu.edu  Mon Jul 23 19:32:42 2012
From: walcott3 at msu.edu (walcotteric)
Date: Mon, 23 Jul 2012 10:32:42 -0700 (PDT)
Subject: [Rd] large dataset - confused
Message-ID: <1343064762429-4637476.post@n4.nabble.com>

I'm trying to load a dataset into R, but I'm completely lost. This is
probably due mostly to the fact that I'm a complete R newb, but it's got me
stuck in  a research project. 
I've tried just opening the text file in WordPad and copying the data
directly into R, but it's too big and causes the program to crash. 

Any suggestions or assistance? I'm kinda desperate and lost. 



--
View this message in context: http://r.789695.n4.nabble.com/large-dataset-confused-tp4637476.html
Sent from the R devel mailing list archive at Nabble.com.


From ripley at stats.ox.ac.uk  Mon Jul 23 19:42:17 2012
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 23 Jul 2012 18:42:17 +0100
Subject: [Rd] large dataset - confused
In-Reply-To: <1343064762429-4637476.post@n4.nabble.com>
References: <1343064762429-4637476.post@n4.nabble.com>
Message-ID: <500D8CF9.7080302@stats.ox.ac.uk>

On 23/07/2012 18:32, walcotteric wrote:
> I'm trying to load a dataset into R, but I'm completely lost. This is
> probably due mostly to the fact that I'm a complete R newb, but it's got me
> stuck in  a research project.
> I've tried just opening the text file in WordPad and copying the data
> directly into R, but it's too big and causes the program to crash.
>
> Any suggestions or assistance? I'm kinda desperate and lost.

Yes, you are lost. The R posting guide is at 
http://www.r-project.org/posting-guide.html and will point you to the 
right list and also the manuals (at e.g. 
http://cran.r-project.org/manuals.html, and one of them seems exactly 
what you need).

BTW, 'large dataset' is meaningless: when I asked a class of Statistics 
PhD students the answers differed by 7 orders of magnitude.


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From brian at braverock.com  Mon Jul 23 19:43:36 2012
From: brian at braverock.com (Brian G. Peterson)
Date: Mon, 23 Jul 2012 12:43:36 -0500
Subject: [Rd] large dataset - confused
In-Reply-To: <1343064762429-4637476.post@n4.nabble.com>
References: <1343064762429-4637476.post@n4.nabble.com>
Message-ID: <500D8D48.3060901@braverock.com>

On 07/23/2012 12:32 PM, walcotteric wrote:
> I'm trying to load a dataset into R, but I'm completely lost. This is
> probably due mostly to the fact that I'm a complete R newb, but it's got me
> stuck in  a research project.
> I've tried just opening the text file in WordPad and copying the data
> directly into R, but it's too big and causes the program to crash.
>
> Any suggestions or assistance? I'm kinda desperate and lost.

Check the manual about loading data:

http://cran.r-project.org/doc/manuals/R-data.html

If you're still having trouble, read the posting guide:

http://www.r-project.org/posting-guide.html

Follow its advice about reproducibility.

Also, this question should have been directed to R-Help, not R-devel

Regards,

    - Brian

-- 
Brian G. Peterson
http://braverock.com/brian/
Ph: 773-459-4973
IM: bgpbraverock


From michael.weylandt at gmail.com  Mon Jul 23 19:44:39 2012
From: michael.weylandt at gmail.com (R. Michael Weylandt)
Date: Mon, 23 Jul 2012 12:44:39 -0500
Subject: [Rd] large dataset - confused
In-Reply-To: <1343064762429-4637476.post@n4.nabble.com>
References: <1343064762429-4637476.post@n4.nabble.com>
Message-ID: <CAAmySGOic-yjytYbLWZX=EhHd+wy4PkEtUJW5k2H8n-qdMoGPQ@mail.gmail.com>

1) Move this off R-devel to R-help.

2) Read the IO manual here: http://cran.r-project.org/manuals.html

3) You probably want to look at the read.table() function's help page
by typing ?read.table

Michael

On Mon, Jul 23, 2012 at 12:32 PM, walcotteric <walcott3 at msu.edu> wrote:
> I'm trying to load a dataset into R, but I'm completely lost. This is
> probably due mostly to the fact that I'm a complete R newb, but it's got me
> stuck in  a research project.
> I've tried just opening the text file in WordPad and copying the data
> directly into R, but it's too big and causes the program to crash.
>
> Any suggestions or assistance? I'm kinda desperate and lost.
>
>
>
> --
> View this message in context: http://r.789695.n4.nabble.com/large-dataset-confused-tp4637476.html
> Sent from the R devel mailing list archive at Nabble.com.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From sarah.goslee at gmail.com  Mon Jul 23 19:46:16 2012
From: sarah.goslee at gmail.com (Sarah Goslee)
Date: Mon, 23 Jul 2012 13:46:16 -0400
Subject: [Rd] large dataset - confused
In-Reply-To: <1343064762429-4637476.post@n4.nabble.com>
References: <1343064762429-4637476.post@n4.nabble.com>
Message-ID: <CAM_vjumOhd7e71RB13R42sJQs7MB-uyC38+Umd2wB7eSCmbRoQ@mail.gmail.com>

Hi,

On Mon, Jul 23, 2012 at 1:32 PM, walcotteric <walcott3 at msu.edu> wrote:
> I'm trying to load a dataset into R, but I'm completely lost. This is
> probably due mostly to the fact that I'm a complete R newb, but it's got me
> stuck in  a research project.
> I've tried just opening the text file in WordPad and copying the data
> directly into R, but it's too big and causes the program to crash.
>
> Any suggestions or assistance? I'm kinda desperate and lost.

Sure. First of all, you  need to post to the R-help list, not the R-devel list.

Then you need to read the Intro to R that came with R when you installed it.

Then you need to read the posting guide for R-help, and provide the
requested information, including:
how big is your dataset?
what format is it in? (text file isn't very informative)
what R commands have you used? (read.table() perhaps)
and so on.

Also, what do you mean by "crash"? R stops working? You get an error message?

Sarah

-- 
Sarah Goslee
http://www.functionaldiversity.org


From brian at braverock.com  Mon Jul 23 19:58:18 2012
From: brian at braverock.com (Brian G. Peterson)
Date: Mon, 23 Jul 2012 12:58:18 -0500
Subject: [Rd] Reading many large files causes R to crash - Possible Bug
 in R 2.15.1 64-bit Ubuntu
In-Reply-To: <006001cd68f3$25d52640$717f72c0$@gmail.com>
References: <000001cd6843$bf5700a0$3e0501e0$@gmail.com>
	<500C66F9.5050503@gmail.com>
	<002d01cd6895$dbef6ed0$93ce4c70$@gmail.com>
	<CAPPM_gS=a-XoYT3-zUttsQpdqg3KgJnZY172ekGvbyGUk6mGPA@mail.gmail.com>
	<001801cd68d5$233a52c0$69aef840$@gmail.com>
	<CAPPM_gQvV9ht-s_o-K=CazasTNFiT_+yRqnwzA1Wg=rYG+87Pw@mail.gmail.com>
	<001a01cd68d8$d6c96580$845c3080$@gmail.com>
	<CAPPM_gRhUUoCcRaTwhsyVZjGgdoN7Y3kAndyBdREBSwHqj7waA@mail.gmail.com>
	<006001cd68f3$25d52640$717f72c0$@gmail.com>
Message-ID: <500D90BA.3050605@braverock.com>

On 07/23/2012 11:49 AM, David Terk wrote:
> One quick question regarding a call to as.character.POSIXt.  When using
> scan, since scan reads line by line, would it make sense to have the ability
> to perform a char -> POSIXct conversion on each line that is read, rather
> than after all lines have been read?  Perhaps this already exists somewhere
> and I am not aware of it.

It's actually much faster to load everything into memory and then 
convert it all to xts at once. as.POSIXct will work on a vector to 
create your index, this s better than calling it millions of times, once 
for each row.

-- 
Brian


From simon.urbanek at r-project.org  Mon Jul 23 20:00:28 2012
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Mon, 23 Jul 2012 14:00:28 -0400
Subject: [Rd] Reading many large files causes R to crash - Possible Bug
	in R 2.15.1 64-bit Ubuntu
In-Reply-To: <006001cd68f3$25d52640$717f72c0$@gmail.com>
References: <000001cd6843$bf5700a0$3e0501e0$@gmail.com>
	<500C66F9.5050503@gmail.com>
	<002d01cd6895$dbef6ed0$93ce4c70$@gmail.com>
	<CAPPM_gS=a-XoYT3-zUttsQpdqg3KgJnZY172ekGvbyGUk6mGPA@mail.gmail.com>
	<001801cd68d5$233a52c0$69aef840$@gmail.com>
	<CAPPM_gQvV9ht-s_o-K=CazasTNFiT_+yRqnwzA1Wg=rYG+87Pw@mail.gmail.com>
	<001a01cd68d8$d6c96580$845c3080$@gmail.com>
	<CAPPM_gRhUUoCcRaTwhsyVZjGgdoN7Y3kAndyBdREBSwHqj7waA@mail.gmail.com>
	<006001cd68f3$25d52640$717f72c0$@gmail.com>
Message-ID: <CA406B96-0371-45A9-AE25-B75C24F9F17B@r-project.org>


On Jul 23, 2012, at 12:49 PM, David Terk wrote:

> Thank you for getting this done so quickly.  This will process now.
> 
> One quick question regarding a call to as.character.POSIXt.  When using
> scan, since scan reads line by line, would it make sense to have the ability
> to perform a char -> POSIXct conversion on each line that is read, rather
> than after all lines have been read?

That's not the problem -- the problem is that converting through format specifications is very, very slow - if you have standard yyyy-mm-dd hh:mm:ss format (or a subset thereof) you can use fastPOSTXct from http://rforge.net/fasttime  - it's many orders of magnitude faster than using format-based conversions - but it is also limited to the standard GMT format (hence the speed). If you have more complex format and have to go through format, you can use pvec from multicore/parallel to at least use all cores of your machine.

Cheers,
Simon


>  Perhaps this already exists somewhere
> and I am not aware of it.
> 
> -----Original Message-----
> From: Joshua Ulrich [mailto:josh.m.ulrich at gmail.com] 
> Sent: Monday, July 23, 2012 12:00 PM
> To: David Terk
> Cc: Duncan Murdoch; r-devel at r-project.org
> Subject: Re: [Rd] Reading many large files causes R to crash - Possible Bug
> in R 2.15.1 64-bit Ubuntu
> 
> David,
> 
> Thank you for providing something reproducible.
> 
> This line:
> templateTimes <- as.xts(templateTimes)
> 
> creates a zero-width xts object (i.e. the coredata is a zero-length vector,
> but there is a non-zero-length index). So, the
> to.period(templateTimes) call returns OHLC data of random memory locations.
> This is the likely cause of the segfaults.
> 
> Since aggregating "no data" doesn't make sense, I have patched to.period to
> throw an error when run on zero-width/length objects (revision 690 on
> R-Forge).  The attached file works with the CRAN version of xts because it
> avoids the issue entirely.
> 
> Your script will still "hang" on the BAC_0.csv file because
> as.character.POSIXt can take a long time.  Better to just call
> format() directly (as I do in the attached file).
> 
> If you have any follow-up questions, please send them to R-SIG-Finance.
> 
> Best,
> --
> Joshua Ulrich  |  about.me/joshuaulrich
> FOSS Trading  |  www.fosstrading.com
> 
> 
> On Mon, Jul 23, 2012 at 8:41 AM, David Terk <david.terk at gmail.com> wrote:
>> I'm attaching a runnable script and corresponding data files.  This 
>> will freeze at 83%.
>> 
>> I'm not sure how much simpler to get than this.
>> 
>> -----Original Message-----
>> From: Joshua Ulrich [mailto:josh.m.ulrich at gmail.com]
>> Sent: Monday, July 23, 2012 9:17 AM
>> To: David Terk
>> Cc: Duncan Murdoch; r-devel at r-project.org
>> Subject: Re: [Rd] Reading many large files causes R to crash - 
>> Possible Bug in R 2.15.1 64-bit Ubuntu
>> 
>> Well, you still haven't convinced anyone but yourself that it's 
>> definitely an xts problem, since you have not provided any reproducible
> example...
>> --
>> Joshua Ulrich  |  about.me/joshuaulrich FOSS Trading  |  
>> www.fosstrading.com
>> 
>> 
>> On Mon, Jul 23, 2012 at 8:14 AM, David Terk <david.terk at gmail.com> wrote:
>>> Where should this be discussed since it is definitely XTS related?  I 
>>> will gladly upload the simplified script + data files to whoever is 
>>> maintaining this part of the code.  Fortunately there is a workaround
>> here.
>>> 
>>> -----Original Message-----
>>> From: Joshua Ulrich [mailto:josh.m.ulrich at gmail.com]
>>> Sent: Monday, July 23, 2012 8:15 AM
>>> To: David Terk
>>> Cc: Duncan Murdoch; r-devel at r-project.org
>>> Subject: Re: [Rd] Reading many large files causes R to crash - 
>>> Possible Bug in R 2.15.1 64-bit Ubuntu
>>> 
>>> David,
>>> 
>>> You still haven't provided a reproducible example.  As Duncan already 
>>> said, "if you don't post code that allows us to reproduce the crash, 
>>> it's really unlikely that we'll be able to fix it."
>>> 
>>> And R-devel is not the appropriate venue to discuss this if it's 
>>> truly an issue with xts/zoo.
>>> 
>>> Best,
>>> --
>>> Joshua Ulrich  |  about.me/joshuaulrich FOSS Trading  | 
>>> www.fosstrading.com
>>> 
>>> 
>>> On Mon, Jul 23, 2012 at 12:41 AM, David Terk <david.terk at gmail.com>
> wrote:
>>>> Looks like the call to:
>>>> 
>>>> dat.i <- to.period(dat.i, period=per, k=subper, name=NULL)
>>>> 
>>>> If what is causing the issue.  If variable name is not set, or set 
>>>> to any value other than NULL.  Than no hang occurs.
>>>> 
>>>> -----Original Message-----
>>>> From: David Terk [mailto:david.terk at gmail.com]
>>>> Sent: Monday, July 23, 2012 1:25 AM
>>>> To: 'Duncan Murdoch'
>>>> Cc: 'r-devel at r-project.org'
>>>> Subject: RE: [Rd] Reading many large files causes R to crash - 
>>>> Possible Bug in R 2.15.1 64-bit Ubuntu
>>>> 
>>>> I've isolated the bug.  When the seg fault was produced there was an 
>>>> error that memory had not been mapped.  Here is the odd part of the 
>>>> bug.  If you comment out certain code and get a full run than 
>>>> comment in
>>> the code which
>>>> is causing the problem it will actually run.   So I think it is safe to
>>>> assume something wrong is taking place with memory allocation.  Example.
>>>> While testing, I have been able to get to a point where the code 
>>>> will
>> run.
>>>> But if I reboot the machine and try again, the code will not run.
>>>> 
>>>> The bug itself is happening somewhere in XTS or ZOO.  I will gladly 
>>>> upload the data files.  It is happening on the 10th data file which 
>>>> is only 225k lines in size.
>>>> 
>>>> Below is the simplified code.  The call to either
>>>> 
>>>> dat.i <- to.period(dat.i, period=per, k=subper, name=NULL)
>>>> index(dat.i) <- index(to.period(templateTimes, period=per, 
>>>> k=subper))
>>>> 
>>>> is what is causing R to hang or crash.  I have been able to 
>>>> replicate this on Windows 7 64 bit and Ubuntu 64 bit.  Seems easiest 
>>>> to consistently replicate from R Studio.
>>>> 
>>>> The code below will consistently replicate when the appropriate 
>>>> files are used.
>>>> 
>>>> parseTickDataFromDir = function(tickerDir, per, subper) {
>>>>  tickerAbsFilenames = list.files(tickerDir,full.names=T)
>>>>  tickerNames = list.files(tickerDir,full.names=F)
>>>>  tickerNames = gsub("_[a-zA-Z0-9].csv","",tickerNames)
>>>>  pb <- txtProgressBar(min = 0, max = length(tickerAbsFilenames), 
>>>> style = 3)
>>>> 
>>>>  for(i in 1:length(tickerAbsFilenames)) {
>>>>    dat.i = parseTickData(tickerAbsFilenames[i])
>>>>    dates <- unique(substr(as.character(index(dat.i)), 1,10))
>>>>    times <- rep("09:30:00", length(dates))
>>>>    openDateTimes <- strptime(paste(dates, times), "%F %H:%M:%S")
>>>>    templateTimes <- NULL
>>>> 
>>>>    for (j in 1:length(openDateTimes)) {
>>>>      if (is.null(templateTimes)) {
>>>>        templateTimes <- openDateTimes[j] + 0:23400
>>>>      } else {
>>>>        templateTimes <- c(templateTimes, openDateTimes[j] + 0:23400)
>>>>      }
>>>>    }
>>>> 
>>>>    templateTimes <- as.xts(templateTimes)
>>>>    dat.i <- merge(dat.i, templateTimes, all=T)
>>>>    if (is.na(dat.i[1])) {
>>>>      dat.i[1] <- -1
>>>>    }
>>>>    dat.i <- na.locf(dat.i)
>>>>        dat.i <- to.period(dat.i, period=per, k=subper, name=NULL)
>>>>        index(dat.i) <- index(to.period(templateTimes, period=per,
>>>> k=subper))
>>>>    setTxtProgressBar(pb, i)
>>>>  }
>>>>  close(pb)
>>>> }
>>>> 
>>>> parseTickData <- function(inputFile) {
>>>>  DAT.list <- scan(file=inputFile,
>>>> sep=",",skip=1,what=list(Date="",Time="",Close=0,Volume=0),quiet=T)
>>>>  index <-
>>>> as.POSIXct(paste(DAT.list$Date,DAT.list$Time),format="%m/%d/%Y
>>>> %H:%M:%S")
>>>>  DAT.xts <- xts(DAT.list$Close,index)
>>>>  DAT.xts <- make.index.unique(DAT.xts)
>>>>  return(DAT.xts)
>>>> }
>>>> 
>>>> DATTick <- parseTickDataFromDir(tickerDirSecond, "seconds",10)
>>>> 
>>>> -----Original Message-----
>>>> From: Duncan Murdoch [mailto:murdoch.duncan at gmail.com]
>>>> Sent: Sunday, July 22, 2012 4:48 PM
>>>> To: David Terk
>>>> Cc: r-devel at r-project.org
>>>> Subject: Re: [Rd] Reading many large files causes R to crash - 
>>>> Possible Bug in R 2.15.1 64-bit Ubuntu
>>>> 
>>>> On 12-07-22 3:54 PM, David Terk wrote:
>>>>> I am reading several hundred files.  Anywhere from 50k-400k in size.
>>>>> It appears that when I read these files with R 2.15.1 the process 
>>>>> will hang or seg fault on the scan() call.  This does not happen on 
>>>>> R
>>> 2.14.1.
>>>> 
>>>> The code below doesn't do anything other than define a couple of
>>> functions.
>>>> Please simplify it to code that creates a file (or multiple files), 
>>>> reads it or them, and shows a bug.
>>>> 
>>>> If you can't do that, then gradually add the rest of the stuff from 
>>>> these functions into the mix until you figure out what is really 
>>>> causing
>>> the bug.
>>>> 
>>>> If you don't post code that allows us to reproduce the crash, it's 
>>>> really unlikely that we'll be able to fix it.
>>>> 
>>>> Duncan Murdoch
>>>> 
>>>>> 
>>>>> 
>>>>> 
>>>>> This is happening on the precise build of Ubuntu.
>>>>> 
>>>>> 
>>>>> 
>>>>> I have included everything, but the issue appears to be when 
>>>>> performing the scan in the method parseTickData.
>>>>> 
>>>>> 
>>>>> 
>>>>> Below is the code.  Hopefully this is the right place to post.
>>>>> 
>>>>> 
>>>>> 
>>>>> parseTickDataFromDir = function(tickerDir, per, subper, fun) {
>>>>> 
>>>>>   tickerAbsFilenames = list.files(tickerDir,full.names=T)
>>>>> 
>>>>>   tickerNames = list.files(tickerDir,full.names=F)
>>>>> 
>>>>>   tickerNames = gsub("_[a-zA-Z0-9].csv","",tickerNames)
>>>>> 
>>>>>   pb <- txtProgressBar(min = 0, max = length(tickerAbsFilenames), 
>>>>> style = 3)
>>>>> 
>>>>> 
>>>>> 
>>>>>   for(i in 1:length(tickerAbsFilenames)) {
>>>>> 
>>>>> 
>>>>> 
>>>>>     # Grab Raw Tick Data
>>>>> 
>>>>>     dat.i = parseTickData(tickerAbsFilenames[i])
>>>>> 
>>>>>     #Sys.sleep(1)
>>>>> 
>>>>>     # Create Template
>>>>> 
>>>>>     dates <- unique(substr(as.character(index(dat.i)), 1,10))
>>>>> 
>>>>>     times <- rep("09:30:00", length(dates))
>>>>> 
>>>>>     openDateTimes <- strptime(paste(dates, times), "%F %H:%M:%S")
>>>>> 
>>>>>     templateTimes <- NULL
>>>>> 
>>>>> 
>>>>> 
>>>>>     for (j in 1:length(openDateTimes)) {
>>>>> 
>>>>>       if (is.null(templateTimes)) {
>>>>> 
>>>>>         templateTimes <- openDateTimes[j] + 0:23400
>>>>> 
>>>>>       } else {
>>>>> 
>>>>>         templateTimes <- c(templateTimes, openDateTimes[j] +
>>>>> 0:23400)
>>>>> 
>>>>>       }
>>>>> 
>>>>>     }
>>>>> 
>>>>> 
>>>>> 
>>>>>     # Convert templateTimes to XTS, merge with data and convert 
>>>>> NA's
>>>>> 
>>>>>     templateTimes <- as.xts(templateTimes)
>>>>> 
>>>>>     dat.i <- merge(dat.i, templateTimes, all=T)
>>>>> 
>>>>>     # If there is no data in the first print, we will have leading 
>>>>> NA's.  So set them to -1.
>>>>> 
>>>>>     # Since we do not want these values removed by to.period
>>>>> 
>>>>>     if (is.na(dat.i[1])) {
>>>>> 
>>>>>       dat.i[1] <- -1
>>>>> 
>>>>>     }
>>>>> 
>>>>>     # Fix remaining NA's
>>>>> 
>>>>>     dat.i <- na.locf(dat.i)
>>>>> 
>>>>>     # Convert to desired bucket size
>>>>> 
>>>>>     dat.i <- to.period(dat.i, period=per, k=subper, name=NULL)
>>>>> 
>>>>>     # Always use templated index, otherwise merge fails with other 
>>>>> symbols
>>>>> 
>>>>>     index(dat.i) <- index(to.period(templateTimes, period=per,
>>>>> k=subper))
>>>>> 
>>>>>     # If there was missing data at open, set close to NA
>>>>> 
>>>>>     valsToChange <- which(dat.i[,"Open"] == -1)
>>>>> 
>>>>>     if (length(valsToChange) != 0) {
>>>>> 
>>>>>       dat.i[valsToChange, "Close"] <- NA
>>>>> 
>>>>>     }
>>>>> 
>>>>>     if(i == 1) {
>>>>> 
>>>>>       DAT = fun(dat.i)
>>>>> 
>>>>>     } else {
>>>>> 
>>>>>       DAT = merge(DAT,fun(dat.i))
>>>>> 
>>>>>     }
>>>>> 
>>>>>     setTxtProgressBar(pb, i)
>>>>> 
>>>>>   }
>>>>> 
>>>>>   close(pb)
>>>>> 
>>>>>   colnames(DAT) = tickerNames
>>>>> 
>>>>>   return(DAT)
>>>>> 
>>>>> }
>>>>> 
>>>>> 
>>>>> 
>>>>> parseTickData <- function(inputFile) {
>>>>> 
>>>>>   DAT.list <- scan(file=inputFile,
>>>>> sep=",",skip=1,what=list(Date="",Time="",Close=0,Volume=0),quiet=T)
>>>>> 
>>>>>   index <-
>>>>> as.POSIXct(paste(DAT.list$Date,DAT.list$Time),format="%m/%d/%Y
>>>>> %H:%M:%S")
>>>>> 
>>>>>   DAT.xts <- xts(DAT.list$Close,index)
>>>>> 
>>>>>   DAT.xts <- make.index.unique(DAT.xts)
>>>>> 
>>>>>   return(DAT.xts)
>>>>> 
>>>>> }
>>>>> 
>>>>> 
>>>>> 
>>>>> 
>>>>> 
>>>>> 
>>>>>      [[alternative HTML version deleted]]
>>>>> 
>>>>> ______________________________________________
>>>>> R-devel at r-project.org mailing list
>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>> 
>>>> 
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>> 
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 


From oliver at first.in-berlin.de  Mon Jul 23 20:00:44 2012
From: oliver at first.in-berlin.de (oliver)
Date: Mon, 23 Jul 2012 20:00:44 +0200
Subject: [Rd] large dataset - confused
In-Reply-To: <500D8CF9.7080302@stats.ox.ac.uk>
References: <1343064762429-4637476.post@n4.nabble.com>
	<500D8CF9.7080302@stats.ox.ac.uk>
Message-ID: <20120723180044.GB1854@siouxsie>

On Mon, Jul 23, 2012 at 06:42:17PM +0100, Prof Brian Ripley wrote:
[...]
> BTW, 'large dataset' is meaningless: when I asked a class of
> Statistics PhD students the answers differed by 7 orders of
> magnitude.
[...]

lol

But isn't 7 a "small" number? ;-)

Ciao,
   Oliver


From oliver at first.in-berlin.de  Mon Jul 23 20:09:40 2012
From: oliver at first.in-berlin.de (oliver)
Date: Mon, 23 Jul 2012 20:09:40 +0200
Subject: [Rd] large dataset - confused
In-Reply-To: <1343064762429-4637476.post@n4.nabble.com>
References: <1343064762429-4637476.post@n4.nabble.com>
Message-ID: <20120723180940.GC1854@siouxsie>

On Mon, Jul 23, 2012 at 10:32:42AM -0700, walcotteric wrote:
> I'm trying to load a dataset into R, but I'm completely lost. This is
> probably due mostly to the fact that I'm a complete R newb, but it's got me
> stuck in  a research project. 
[...]

Hmhh, becoming stuck in a "research project", because you are a "complete R newb"?
Strange.... what kind of working style is this?
What about first learning the tools you use?


> I've tried just opening the text file in WordPad and copying the data
> directly into R, but it's too big and causes the program to crash. 
[...]

OMFG

> 
> Any suggestions or assistance? I'm kinda desperate and lost. 

Looks like this is completely caused by yourself.

Check your working style...

....and follow the hints to the docs that other people
on this list suggested to you.

There are a lot of good documentatiuons online.
Even books for R are available. Look at the library
of your "research institute"...

Ciao,
   Oliver


From lorenz at usgs.gov  Mon Jul 23 22:33:35 2012
From: lorenz at usgs.gov (David L Lorenz)
Date: Mon, 23 Jul 2012 15:33:35 -0500
Subject: [Rd] S4 objects in formulas
In-Reply-To: <CAErODj_pMMtKihi3zL8hzxc4+wZkrAQnZYydM3tB3HaBeDhAqg@mail.gmail.com>
References: <4FCF5964.5080007@yorku.ca>
	<CAErODj_pMMtKihi3zL8hzxc4+wZkrAQnZYydM3tB3HaBeDhAqg@mail.gmail.com>
Message-ID: <OFE0839D97.CB87016C-ON86257A44.006E234B-86257A44.0070F12D@usgs.gov>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20120723/5344235c/attachment.pl>

From lawrence.michael at gene.com  Tue Jul 24 02:06:28 2012
From: lawrence.michael at gene.com (Michael Lawrence)
Date: Mon, 23 Jul 2012 17:06:28 -0700
Subject: [Rd] On RObjectTables
In-Reply-To: <alpine.LFD.2.02.1207200928200.1918@nokomis.stat.uiowa.edu>
References: <CABFfbXv480ciNg3vphvwwvZvX03vvWABGRRT8a7SgRn25wPXgg@mail.gmail.com>
	<alpine.LFD.2.02.1207200928200.1918@nokomis.stat.uiowa.edu>
Message-ID: <CAOQ5NydxVJG4gHxk60=_xLwVUVvN+t7N+CHwwV=p=a7MUg9yJA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20120723/78947901/attachment.pl>

From winstonchang1 at gmail.com  Tue Jul 24 02:29:34 2012
From: winstonchang1 at gmail.com (Winston Chang)
Date: Mon, 23 Jul 2012 19:29:34 -0500
Subject: [Rd] Finding dynamic shared libraries loaded with a package
Message-ID: <CAFOpNVEJxF3URjj8XD=sSLM4PqtWXQaZsbx1=7JeWay4CshrmQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20120723/668cd267/attachment.pl>

From ggrothendieck at gmail.com  Tue Jul 24 02:47:32 2012
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Mon, 23 Jul 2012 20:47:32 -0400
Subject: [Rd] Finding dynamic shared libraries loaded with a package
In-Reply-To: <CAFOpNVEJxF3URjj8XD=sSLM4PqtWXQaZsbx1=7JeWay4CshrmQ@mail.gmail.com>
References: <CAFOpNVEJxF3URjj8XD=sSLM4PqtWXQaZsbx1=7JeWay4CshrmQ@mail.gmail.com>
Message-ID: <CAP01uR=CXA-71sEFDbqkkHnfc57UTfqkf3ikX-UE+-DBp9=P1A@mail.gmail.com>

On Mon, Jul 23, 2012 at 8:29 PM, Winston Chang <winstonchang1 at gmail.com> wrote:
> Is there a way to query a package to see what dynamic shared libraries are
> loaded with it?
>

This gives a "DLLInfoList" class object whose components are info
associated with the loaded dll's

DLLInfoList <- library.dynam()

and this gives the components associated with package "stats"

DLLInfoList[sapply(DLLInfoList, "[[", "name") == "stats"]





-- 
Statistics & Software Consulting
GKX Group, GKX Associates Inc.
tel: 1-877-GKX-GROUP
email: ggrothendieck at gmail.com


From winstonchang1 at gmail.com  Tue Jul 24 04:33:32 2012
From: winstonchang1 at gmail.com (Winston Chang)
Date: Mon, 23 Jul 2012 21:33:32 -0500
Subject: [Rd] Finding dynamic shared libraries loaded with a package
In-Reply-To: <CAP01uR=CXA-71sEFDbqkkHnfc57UTfqkf3ikX-UE+-DBp9=P1A@mail.gmail.com>
References: <CAFOpNVEJxF3URjj8XD=sSLM4PqtWXQaZsbx1=7JeWay4CshrmQ@mail.gmail.com>
	<CAP01uR=CXA-71sEFDbqkkHnfc57UTfqkf3ikX-UE+-DBp9=P1A@mail.gmail.com>
Message-ID: <CAFOpNVEd4ru6YZj2LZ55RnjPSCxo2VHX8DzTVO9012FiEqRHxA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20120723/65a59509/attachment.pl>

From ripley at stats.ox.ac.uk  Tue Jul 24 07:15:38 2012
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 24 Jul 2012 06:15:38 +0100
Subject: [Rd] S4 objects in formulas (really, model frames)
In-Reply-To: <OFE0839D97.CB87016C-ON86257A44.006E234B-86257A44.0070F12D@usgs.gov>
References: <4FCF5964.5080007@yorku.ca>
	<CAErODj_pMMtKihi3zL8hzxc4+wZkrAQnZYydM3tB3HaBeDhAqg@mail.gmail.com>
	<OFE0839D97.CB87016C-ON86257A44.006E234B-86257A44.0070F12D@usgs.gov>
Message-ID: <500E2F7A.1080609@stats.ox.ac.uk>

The help for model.frame says

      Only variables whose type is raw, logical, integer, real, complex
      or character can be included in a model frame: this includes
      classed variables such as factors (whose underlying type is
      integer), but excludes lists.

Some S4 objects are of one of those types, but some are not.  Some 
matrices are, some are not.  Objects of class "Surv" are.

On 23/07/2012 21:33, David L Lorenz wrote:
> Hi,
>    I have very carefully developed several S4 classes that describe
> censored water-quality data. I have routines for them that will support
> their use in data.frames and so forth. I have run into a problem when I
> try to use the S4 class as the response variable in a formula and try to
> extract the model frame. I get an error like:
>
> Error in model.frame.default(as.lcens(Y) ~ X) : object is not a matrix
>
>    In this case, as.lcens works much like the Surv function in the survival
> package except that the object is an S4 class and not a matrix of class
> Surv. I would have expected that the model.frame function would have been
> able to manipulate any kind of object that can be subsetted and put into a
> data.frame. But that appears not to be the case. I'm using R 2.14.1 if
> that matters.
>    I can supply the routines for the lcens data if needed.
>    Am I looking at needing to write a wrapper to convert all of my S4
> classes into matrices and then extract the necessary data in the matrices
> according to rules for the particular kind of S4 class? Or, am I missing a
> key piece on how model.frame works?
>    Thanks.
> Dave
>
> 	[[alternative HTML version deleted]]

The posting guide asked you not to do that.  And to do your own homework.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From winstonchang1 at gmail.com  Tue Jul 24 08:11:12 2012
From: winstonchang1 at gmail.com (Winston Chang)
Date: Tue, 24 Jul 2012 01:11:12 -0500
Subject: [Rd] Using .onUnload to unload DLLs
Message-ID: <CAFOpNVGEO87Eng2zQtMmaqino+u1oj1wp98C4DEDtSDi6-JMzQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20120724/57a56a5b/attachment.pl>

From ripley at stats.ox.ac.uk  Tue Jul 24 08:53:21 2012
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 24 Jul 2012 07:53:21 +0100
Subject: [Rd] Using .onUnload to unload DLLs
In-Reply-To: <CAFOpNVGEO87Eng2zQtMmaqino+u1oj1wp98C4DEDtSDi6-JMzQ@mail.gmail.com>
References: <CAFOpNVGEO87Eng2zQtMmaqino+u1oj1wp98C4DEDtSDi6-JMzQ@mail.gmail.com>
Message-ID: <500E4661.7030807@stats.ox.ac.uk>

On 24/07/2012 07:11, Winston Chang wrote:
> I've noticed that many of the "base" R packages have an .onUnload()
> function which automatically unloads compiled shared libraries
> with library.dynam.unload(). For example:
>
>> stats:::.onUnload
> function (libpath)
> library.dynam.unload("stats", libpath)
> <bytecode: 0x1033b9c30>
> <environment: namespace:stats>
>
>
> I've noticed that many other packages don't do this. Is it considered good
> practice to do this in packages that have compiled code?

Yes, but do not all packages have well-enough written DSOs to do this. 
(Tcl/Tk does not, so we no longer attempt to upload tcltk.dll.)

>
> -Winston
>
> 	[[alternative HTML version deleted]]

which the posting guide expressly asked you not to do.


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From jeroen.ooms at stat.ucla.edu  Tue Jul 24 11:15:22 2012
From: jeroen.ooms at stat.ucla.edu (Jeroen Ooms)
Date: Tue, 24 Jul 2012 11:15:22 +0200
Subject: [Rd] On RObjectTables
In-Reply-To: <CAOQ5NydxVJG4gHxk60=_xLwVUVvN+t7N+CHwwV=p=a7MUg9yJA@mail.gmail.com>
References: <CABFfbXv480ciNg3vphvwwvZvX03vvWABGRRT8a7SgRn25wPXgg@mail.gmail.com>
	<alpine.LFD.2.02.1207200928200.1918@nokomis.stat.uiowa.edu>
	<CAOQ5NydxVJG4gHxk60=_xLwVUVvN+t7N+CHwwV=p=a7MUg9yJA@mail.gmail.com>
Message-ID: <CABFfbXtUCTpFdYs2AXToXx6_+XNdZBE_Z1c-cEopdVr4C+DjMg@mail.gmail.com>

Maybe it is worth considering to document this functionality a bit
more, or expose some wrappers in R? It's a bit obscure right now,
which seems both dangerous in terms of maintenance and a missed
opportunity (especially if people are already building on it).





On Tue, Jul 24, 2012 at 2:06 AM, Michael Lawrence
<lawrence.michael at gene.com> wrote:
>
> Luke,
>
> Please keep me advised on this, because the Qt interfaces heavily rely on the ObjectTables (btw, it has worked great for my use cases).
>
> Michael
>
>
> On Fri, Jul 20, 2012 at 7:32 AM, <luke-tierney at uiowa.edu> wrote:
>>
>> I believe everyone who has worked on the relevant files has tried to
>> maintain this functionality, but as it seems to get used and tested
>> very little I can't be sure it is functional at this point. The
>> facility in its current form does complicate the internal code and
>> limit some experiments we might otherwise do, so I would not be
>> surprised if it was at least substantially changed in the next year or
>> two.
>>
>> Best,
>>
>> luke
>>
>>
>> On Thu, 19 Jul 2012, Jeroen Ooms wrote:
>>
>>> I was wondering if anyone knows more about the state of RObjectTables. This
>>> largely undocumented functionality was introduced by Duncan around 2002
>>> somewhere and enables you create an environment where the contents are
>>> dynamically queried by R through a hook function. It is mentioned in R
>>> Internals and ?attach. This functionality is quite powerful and allows you
>>> to e.g. offload a big database of R objects to disk, yet use them as if
>>> they were in your workspace. The recent RProtoBuf package also uses some of
>>> this functionality to dynamically lookup proto definitions.
>>>
>>> I would like to do something similar, but I am not sure if support for this
>>> functionality will be or has been discontinued. The RObjectTables package
>>> is no longer available on OmegaHat and nothing has not been mentioned on
>>> the mailing lists for about 5 years. I found an old version of the package
>>> no github which seems to work, but as far as I understand, the package
>>> still needs the hooks from within R to work. So if this functionality is
>>> actually unsupported and might be removed at some point, I should probably
>>> not invest in it.
>>>
>>>         [[alternative HTML version deleted]]
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>
>> --
>> Luke Tierney
>> Chair, Statistics and Actuarial Science
>> Ralph E. Wareham Professor of Mathematical Sciences
>> University of Iowa                  Phone:             319-335-3386
>> Department of Statistics and        Fax:               319-335-3017
>>    Actuarial Science
>> 241 Schaeffer Hall                  email:   luke-tierney at uiowa.edu
>> Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu
>>
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From luke-tierney at uiowa.edu  Tue Jul 24 15:15:15 2012
From: luke-tierney at uiowa.edu (luke-tierney at uiowa.edu)
Date: Tue, 24 Jul 2012 08:15:15 -0500
Subject: [Rd] On RObjectTables
In-Reply-To: <CABFfbXtUCTpFdYs2AXToXx6_+XNdZBE_Z1c-cEopdVr4C+DjMg@mail.gmail.com>
References: <CABFfbXv480ciNg3vphvwwvZvX03vvWABGRRT8a7SgRn25wPXgg@mail.gmail.com>
	<alpine.LFD.2.02.1207200928200.1918@nokomis.stat.uiowa.edu>
	<CAOQ5NydxVJG4gHxk60=_xLwVUVvN+t7N+CHwwV=p=a7MUg9yJA@mail.gmail.com>
	<CABFfbXtUCTpFdYs2AXToXx6_+XNdZBE_Z1c-cEopdVr4C+DjMg@mail.gmail.com>
Message-ID: <alpine.DEB.2.02.1207240811480.2174@luke-Latitude>

In my original reply I wrote

>> The
>> facility in its current form does complicate the internal code and
>> limit some experiments we might otherwise do, so I would not be
>> surprised if it was at least substantially changed in the next year or
>> two.

This is obviously _not_ the time to invest effort in documenting or
expanding this facility. If you want to use it, go ahead. But you will
have to figure things out from what you have and be prepared for
changes under your feet.

If active bindings can do what you want that may be a safer route to
consider.

luke

On Tue, 24 Jul 2012, Jeroen Ooms wrote:

> Maybe it is worth considering to document this functionality a bit
> more, or expose some wrappers in R? It's a bit obscure right now,
> which seems both dangerous in terms of maintenance and a missed
> opportunity (especially if people are already building on it).
>
>
>
>
>
> On Tue, Jul 24, 2012 at 2:06 AM, Michael Lawrence
> <lawrence.michael at gene.com> wrote:
>>
>> Luke,
>>
>> Please keep me advised on this, because the Qt interfaces heavily rely on the ObjectTables (btw, it has worked great for my use cases).
>>
>> Michael
>>
>>
>> On Fri, Jul 20, 2012 at 7:32 AM, <luke-tierney at uiowa.edu> wrote:
>>>
>>> I believe everyone who has worked on the relevant files has tried to
>>> maintain this functionality, but as it seems to get used and tested
>>> very little I can't be sure it is functional at this point. The
>>> facility in its current form does complicate the internal code and
>>> limit some experiments we might otherwise do, so I would not be
>>> surprised if it was at least substantially changed in the next year or
>>> two.
>>>
>>> Best,
>>>
>>> luke
>>>
>>>
>>> On Thu, 19 Jul 2012, Jeroen Ooms wrote:
>>>
>>>> I was wondering if anyone knows more about the state of RObjectTables. This
>>>> largely undocumented functionality was introduced by Duncan around 2002
>>>> somewhere and enables you create an environment where the contents are
>>>> dynamically queried by R through a hook function. It is mentioned in R
>>>> Internals and ?attach. This functionality is quite powerful and allows you
>>>> to e.g. offload a big database of R objects to disk, yet use them as if
>>>> they were in your workspace. The recent RProtoBuf package also uses some of
>>>> this functionality to dynamically lookup proto definitions.
>>>>
>>>> I would like to do something similar, but I am not sure if support for this
>>>> functionality will be or has been discontinued. The RObjectTables package
>>>> is no longer available on OmegaHat and nothing has not been mentioned on
>>>> the mailing lists for about 5 years. I found an old version of the package
>>>> no github which seems to work, but as far as I understand, the package
>>>> still needs the hooks from within R to work. So if this functionality is
>>>> actually unsupported and might be removed at some point, I should probably
>>>> not invest in it.
>>>>
>>>>         [[alternative HTML version deleted]]
>>>>
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>
>>>
>>> --
>>> Luke Tierney
>>> Chair, Statistics and Actuarial Science
>>> Ralph E. Wareham Professor of Mathematical Sciences
>>> University of Iowa                  Phone:             319-335-3386
>>> Department of Statistics and        Fax:               319-335-3017
>>>    Actuarial Science
>>> 241 Schaeffer Hall                  email:   luke-tierney at uiowa.edu
>>> Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu
>>>
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
>

-- 
Luke Tierney
Chair, Statistics and Actuarial Science
Ralph E. Wareham Professor of Mathematical Sciences
University of Iowa                  Phone:             319-335-3386
Department of Statistics and        Fax:               319-335-3017
    Actuarial Science
241 Schaeffer Hall                  email:   luke-tierney at uiowa.edu
Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu


From lux-integ at btconnect.com  Tue Jul 24 21:30:06 2012
From: lux-integ at btconnect.com (luxInteg)
Date: Tue, 24 Jul 2012 20:30:06 +0100
Subject: [Rd] questions on  R CMD INSTALL et al
Message-ID: <201207242030.06665.lux-integ@btconnect.com>

Greetings,

I am learning R
My machine has these;
CPU: 3cores  amd64 
OS pure-64bit CBLFS liux compiled  from sources  (kernel 3.2.1, gcc-4.6.2 
R-2.15
When I compiled R the compiler spewed  out lines  like these:-

make[3]: Entering directory `/tmp/RtmpiHdDJy/R.INSTALL472339eeb23a/mgcv/src'
gcc -m64 -std=gnu99 -I/home/Rman/R-2.15.0/include -DNDEBUG  -
I/usr/local/atlas/include  -I/usr/local/numerics/include    -fpic  -g -O2  -c 
gcv.c -o gcv.o
gcc -m64 -std=gnu99 -I/home/Rman/R-2.15.0/include -DNDEBUG  -
I/usr/local/atlas/include  -I/usr/local/numerics/include    -fpic  -g -O2  -c 
gdi.c -o gdi.o
gcc -m64 -std=gnu99 -I/home/Rman/R-2.15.0/include -DNDEBUG  -
I/usr/local/atlas/include  -I/usr/local/numerics/include    -fpic  -g -O2  -c 
init.c -o init.o
gcc -m64 -std=gnu99 -I/home/Rman/R-2.15.0/include -DNDEBUG  -
I/usr/local/atlas/include  -I/usr/local/numerics/include    -fpic  -g -O2  -c 
magic.c -o magic.o
gcc -m64 -std=gnu99 -I/home/Rman/R-2.15.0/include -DNDEBUG  -
I/usr/local/atlas/include  -I/usr/local/numerics/include    -fpic  -g -O2  -c 
mat.c -o mat.o
gcc -m64 -std=gnu99 -I/home/Rman/R-2.15.0/include -DNDEBUG  -
I/usr/local/atlas/include  -I/usr/local/numerics/include    -fpic  -g -O2  -c 
matrix.c -o matrix.o
gcc -m64 -std=gnu99 -I/home/Rman/R-2.15.0/include -DNDEBUG  -
I/usr/local/atlas/include  -I/usr/local/numerics/include    -fpic  -g -O2  -c 
mgcv.c -o mgcv.o
gcc -m64 -std=gnu99 -I/home/Rman/R-2.15.0/include -DNDEBUG  -
I/usr/local/atlas/include  -I/usr/local/numerics/include    -fpic  -g -O2  -c 
misc.c -o misc.o
gcc -m64 -std=gnu99 -I/home/Rman/R-2.15.0/include -DNDEBUG  -
I/usr/local/atlas/include  -I/usr/local/numerics/include    -fpic  -g -O2  -c 
qp.c -o qp.o
gcc -m64 -std=gnu99 -I/home/Rman/R-2.15.0/include -DNDEBUG  -
I/usr/local/atlas/include  -I/usr/local/numerics/include    -fpic  -g -O2  -c 
sparse-smooth.c -o sparse-smooth.o
gcc -m64 -std=gnu99 -I/home/Rman/R-2.15.0/include -DNDEBUG  -
I/usr/local/atlas/include  -I/usr/local/numerics/include    -fpic  -g -O2  -c 
tprs.c -o tprs.o
gcc -m64 -std=gnu99 -shared -L/usr/local/atlas/lib -L/usr/local/numerics/lib -
L/usr/lib -o mgcv.so gcv.o gdi.o init.o magic.o mat.o matrix.o mgcv.o misc.o 
qp.o sparse-smooth.o tprs.o -L/home/Rman/R-2.15.0/lib -lRlapack -
L/home/Rman/R-2.15.0/lib -lRblas -lgfortran -lm -L/home/Rman/R-2.15.0/lib -lR
make[3]: Leaving directory `/tmp/RtmpiHdDJy/R.INSTALL472339eeb23a/mgcv/src'
installing to /home/Rman/R-2.15.0/library/mgcv/libs
** R
** data
** inst
** byte-compile and prepare package for lazy loading
** help
*** installing help indices
** building package indices
** testing if installed package can be loaded

* DONE (mgcv)
make[2]: Leaving directory `/home/Rman/R-2.15.0/src/library/Recommended'
make[1]: Leaving directory `/home/Rman/R-2.15.0/src/library/Recommended'

-----here is the source_tree   for mgcv ---A
mgcv_SR_tree/mgcv/R
mgcv_SR_tree/mgcv/data
mgcv_SR_tree/mgcv/inst
mgcv_SR_tree/mgcv/man
mgcv_SR_tree/mgcv/po
mgcv_SR_tree/mgcv/src
mgcv_SR_tree/mgcv/DESCRIPTION
mgcv_SR_tree/mgcv/MD5
mgcv_SR_tree/mgcv/NAMESPACE
mgcv_SR_tree/mgcv/changeLog
mgcv_SR_tree/mgcv/gnugpl2.txt
mgcv_SR_tree/mgcv/index

#--and here is the build tree   ---B
mgcv_postBuild_Tree/mgcv/Meta
mgcv_postBuild_Tree/mgcv/R
mgcv_postBuild_Tree/mgcv/data
mgcv_postBuild_Tree/mgcv/help
mgcv_postBuild_Tree/mgcv/html
mgcv_postBuild_Tree/mgcv/libs
mgcv_postBuild_Tree/mgcv/CITATION
mgcv_postBuild_Tree/mgcv/DESCRIPTION
mgcv_postBuild_Tree/mgcv/INDEX
mgcv_postBuild_Tree/mgcv/NAMESPACE

I havent a clue what is happening in the lines prepended by **

Also I used make VERBOSE=1  but the compiler   gave no indication of how one  
arives at  B from A  and  
how the library created mgcv.so) is installed in mgcv_postBuild_Tree/mgcv/libs

advise on hese would be much appreciated


Reading the manual I noticed the way of installing these recommendd packages 
appears to be 
R CMD -l path/to/libraries  recommended_tarball.tar.gz

I  would like to know if the following is possible and if so how so:-
a) obtaining more verbose output from make  (is this makefile related ? )
a) exercising control over the compiler settings for  the creation of the 
library module (mgcv.so in the above case)
b)  manual setting of the source and destination  directroies  and  keeping of    
the source tree  where the package is built.

thannks in advance

sincerely
luxInteg


From rpeng at jhsph.edu  Tue Jul 24 21:39:32 2012
From: rpeng at jhsph.edu (Roger D. Peng)
Date: Tue, 24 Jul 2012 15:39:32 -0400
Subject: [Rd] On RObjectTables
In-Reply-To: <alpine.DEB.2.02.1207240811480.2174@luke-Latitude>
References: <CABFfbXv480ciNg3vphvwwvZvX03vvWABGRRT8a7SgRn25wPXgg@mail.gmail.com>
	<alpine.LFD.2.02.1207200928200.1918@nokomis.stat.uiowa.edu>
	<CAOQ5NydxVJG4gHxk60=_xLwVUVvN+t7N+CHwwV=p=a7MUg9yJA@mail.gmail.com>
	<CABFfbXtUCTpFdYs2AXToXx6_+XNdZBE_Z1c-cEopdVr4C+DjMg@mail.gmail.com>
	<alpine.DEB.2.02.1207240811480.2174@luke-Latitude>
Message-ID: <CAE_NaA07PkotX4KUnauToDQvOVQWzmD0zCqKXMSREzVMrCCFhQ@mail.gmail.com>

I was thinking that the RObjectTables appeared before the active
binding stuff was introduced. On quick examination, it seems the
active binding mechanism might be a more stable way to go. That's how
it was done in filehash.

-roger

On Tue, Jul 24, 2012 at 9:15 AM,  <luke-tierney at uiowa.edu> wrote:
> In my original reply I wrote
>
>
>>> The
>>> facility in its current form does complicate the internal code and
>>> limit some experiments we might otherwise do, so I would not be
>>> surprised if it was at least substantially changed in the next year or
>>> two.
>
>
> This is obviously _not_ the time to invest effort in documenting or
> expanding this facility. If you want to use it, go ahead. But you will
> have to figure things out from what you have and be prepared for
> changes under your feet.
>
> If active bindings can do what you want that may be a safer route to
> consider.
>
> luke
>
>
> On Tue, 24 Jul 2012, Jeroen Ooms wrote:
>
>> Maybe it is worth considering to document this functionality a bit
>> more, or expose some wrappers in R? It's a bit obscure right now,
>> which seems both dangerous in terms of maintenance and a missed
>> opportunity (especially if people are already building on it).
>>
>>
>>
>>
>>
>> On Tue, Jul 24, 2012 at 2:06 AM, Michael Lawrence
>> <lawrence.michael at gene.com> wrote:
>>>
>>>
>>> Luke,
>>>
>>> Please keep me advised on this, because the Qt interfaces heavily rely on
>>> the ObjectTables (btw, it has worked great for my use cases).
>>>
>>> Michael
>>>
>>>
>>> On Fri, Jul 20, 2012 at 7:32 AM, <luke-tierney at uiowa.edu> wrote:
>>>>
>>>>
>>>> I believe everyone who has worked on the relevant files has tried to
>>>> maintain this functionality, but as it seems to get used and tested
>>>> very little I can't be sure it is functional at this point. The
>>>> facility in its current form does complicate the internal code and
>>>> limit some experiments we might otherwise do, so I would not be
>>>> surprised if it was at least substantially changed in the next year or
>>>> two.
>>>>
>>>> Best,
>>>>
>>>> luke
>>>>
>>>>
>>>> On Thu, 19 Jul 2012, Jeroen Ooms wrote:
>>>>
>>>>> I was wondering if anyone knows more about the state of RObjectTables.
>>>>> This
>>>>> largely undocumented functionality was introduced by Duncan around 2002
>>>>> somewhere and enables you create an environment where the contents are
>>>>> dynamically queried by R through a hook function. It is mentioned in R
>>>>> Internals and ?attach. This functionality is quite powerful and allows
>>>>> you
>>>>> to e.g. offload a big database of R objects to disk, yet use them as if
>>>>> they were in your workspace. The recent RProtoBuf package also uses
>>>>> some of
>>>>> this functionality to dynamically lookup proto definitions.
>>>>>
>>>>> I would like to do something similar, but I am not sure if support for
>>>>> this
>>>>> functionality will be or has been discontinued. The RObjectTables
>>>>> package
>>>>> is no longer available on OmegaHat and nothing has not been mentioned
>>>>> on
>>>>> the mailing lists for about 5 years. I found an old version of the
>>>>> package
>>>>> no github which seems to work, but as far as I understand, the package
>>>>> still needs the hooks from within R to work. So if this functionality
>>>>> is
>>>>> actually unsupported and might be removed at some point, I should
>>>>> probably
>>>>> not invest in it.
>>>>>
>>>>>         [[alternative HTML version deleted]]
>>>>>
>>>>> ______________________________________________
>>>>> R-devel at r-project.org mailing list
>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>>
>>>>
>>>> --
>>>> Luke Tierney
>>>> Chair, Statistics and Actuarial Science
>>>> Ralph E. Wareham Professor of Mathematical Sciences
>>>> University of Iowa                  Phone:             319-335-3386
>>>> Department of Statistics and        Fax:               319-335-3017
>>>>    Actuarial Science
>>>> 241 Schaeffer Hall                  email:   luke-tierney at uiowa.edu
>>>> Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu
>>>>
>>>>
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>>
>>>
>>
>
> --
> Luke Tierney
> Chair, Statistics and Actuarial Science
> Ralph E. Wareham Professor of Mathematical Sciences
> University of Iowa                  Phone:             319-335-3386
> Department of Statistics and        Fax:               319-335-3017
>    Actuarial Science
> 241 Schaeffer Hall                  email:   luke-tierney at uiowa.edu
> Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel



-- 
Roger D. Peng  |  http://www.biostat.jhsph.edu/~rpeng/


From moshersteven at gmail.com  Tue Jul 24 22:08:39 2012
From: moshersteven at gmail.com (steven mosher)
Date: Tue, 24 Jul 2012 13:08:39 -0700
Subject: [Rd] Encoding errors in Rd files
Message-ID: <CAFFLneRasns6PUuhFeVZOJnPfWooX04ROCiGDZgVy0h_SL6FNA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20120724/b8b81fff/attachment.pl>

From michael.weylandt at gmail.com  Tue Jul 24 22:22:02 2012
From: michael.weylandt at gmail.com (R. Michael Weylandt)
Date: Tue, 24 Jul 2012 15:22:02 -0500
Subject: [Rd] questions on R CMD INSTALL et al
In-Reply-To: <201207242030.06665.lux-integ@btconnect.com>
References: <201207242030.06665.lux-integ@btconnect.com>
Message-ID: <CAAmySGPBUb7JXkKncQ1KvzNHpkvrrEtY5s7uDoT1gS01zTpkcQ@mail.gmail.com>

On Tue, Jul 24, 2012 at 2:30 PM, luxInteg <lux-integ at btconnect.com> wrote:
> Greetings,
>
> I am learning R
> My machine has these;
> CPU: 3cores  amd64
> OS pure-64bit CBLFS liux compiled  from sources  (kernel 3.2.1, gcc-4.6.2
> R-2.15
> When I compiled R the compiler spewed  out lines  like these:-
>
> make[3]: Entering directory `/tmp/RtmpiHdDJy/R.INSTALL472339eeb23a/mgcv/src'
> gcc -m64 -std=gnu99 -I/home/Rman/R-2.15.0/include -DNDEBUG  -
> I/usr/local/atlas/include  -I/usr/local/numerics/include    -fpic  -g -O2  -c
> gcv.c -o gcv.o
> gcc -m64 -std=gnu99 -I/home/Rman/R-2.15.0/include -DNDEBUG  -
> I/usr/local/atlas/include  -I/usr/local/numerics/include    -fpic  -g -O2  -c
> gdi.c -o gdi.o
> gcc -m64 -std=gnu99 -I/home/Rman/R-2.15.0/include -DNDEBUG  -
> I/usr/local/atlas/include  -I/usr/local/numerics/include    -fpic  -g -O2  -c
> init.c -o init.o
> gcc -m64 -std=gnu99 -I/home/Rman/R-2.15.0/include -DNDEBUG  -
> I/usr/local/atlas/include  -I/usr/local/numerics/include    -fpic  -g -O2  -c
> magic.c -o magic.o
> gcc -m64 -std=gnu99 -I/home/Rman/R-2.15.0/include -DNDEBUG  -
> I/usr/local/atlas/include  -I/usr/local/numerics/include    -fpic  -g -O2  -c
> mat.c -o mat.o
> gcc -m64 -std=gnu99 -I/home/Rman/R-2.15.0/include -DNDEBUG  -
> I/usr/local/atlas/include  -I/usr/local/numerics/include    -fpic  -g -O2  -c
> matrix.c -o matrix.o
> gcc -m64 -std=gnu99 -I/home/Rman/R-2.15.0/include -DNDEBUG  -
> I/usr/local/atlas/include  -I/usr/local/numerics/include    -fpic  -g -O2  -c
> mgcv.c -o mgcv.o
> gcc -m64 -std=gnu99 -I/home/Rman/R-2.15.0/include -DNDEBUG  -
> I/usr/local/atlas/include  -I/usr/local/numerics/include    -fpic  -g -O2  -c
> misc.c -o misc.o
> gcc -m64 -std=gnu99 -I/home/Rman/R-2.15.0/include -DNDEBUG  -
> I/usr/local/atlas/include  -I/usr/local/numerics/include    -fpic  -g -O2  -c
> qp.c -o qp.o
> gcc -m64 -std=gnu99 -I/home/Rman/R-2.15.0/include -DNDEBUG  -
> I/usr/local/atlas/include  -I/usr/local/numerics/include    -fpic  -g -O2  -c
> sparse-smooth.c -o sparse-smooth.o
> gcc -m64 -std=gnu99 -I/home/Rman/R-2.15.0/include -DNDEBUG  -
> I/usr/local/atlas/include  -I/usr/local/numerics/include    -fpic  -g -O2  -c
> tprs.c -o tprs.o
> gcc -m64 -std=gnu99 -shared -L/usr/local/atlas/lib -L/usr/local/numerics/lib -
> L/usr/lib -o mgcv.so gcv.o gdi.o init.o magic.o mat.o matrix.o mgcv.o misc.o
> qp.o sparse-smooth.o tprs.o -L/home/Rman/R-2.15.0/lib -lRlapack -
> L/home/Rman/R-2.15.0/lib -lRblas -lgfortran -lm -L/home/Rman/R-2.15.0/lib -lR
> make[3]: Leaving directory `/tmp/RtmpiHdDJy/R.INSTALL472339eeb23a/mgcv/src'
> installing to /home/Rman/R-2.15.0/library/mgcv/libs
> ** R
> ** data
> ** inst
> ** byte-compile and prepare package for lazy loading
> ** help
> *** installing help indices
> ** building package indices
> ** testing if installed package can be loaded
>
> * DONE (mgcv)
> make[2]: Leaving directory `/home/Rman/R-2.15.0/src/library/Recommended'
> make[1]: Leaving directory `/home/Rman/R-2.15.0/src/library/Recommended'
>
> -----here is the source_tree   for mgcv ---A
> mgcv_SR_tree/mgcv/R
> mgcv_SR_tree/mgcv/data
> mgcv_SR_tree/mgcv/inst
> mgcv_SR_tree/mgcv/man
> mgcv_SR_tree/mgcv/po
> mgcv_SR_tree/mgcv/src
> mgcv_SR_tree/mgcv/DESCRIPTION
> mgcv_SR_tree/mgcv/MD5
> mgcv_SR_tree/mgcv/NAMESPACE
> mgcv_SR_tree/mgcv/changeLog
> mgcv_SR_tree/mgcv/gnugpl2.txt
> mgcv_SR_tree/mgcv/index
>
> #--and here is the build tree   ---B
> mgcv_postBuild_Tree/mgcv/Meta
> mgcv_postBuild_Tree/mgcv/R
> mgcv_postBuild_Tree/mgcv/data
> mgcv_postBuild_Tree/mgcv/help
> mgcv_postBuild_Tree/mgcv/html
> mgcv_postBuild_Tree/mgcv/libs
> mgcv_postBuild_Tree/mgcv/CITATION
> mgcv_postBuild_Tree/mgcv/DESCRIPTION
> mgcv_postBuild_Tree/mgcv/INDEX
> mgcv_postBuild_Tree/mgcv/NAMESPACE
>
> I havent a clue what is happening in the lines prepended by **

Messages (to you) being given by the build script -- it looks like you
got a good build. (The big "DONE" is a good sign)

>
> Also I used make VERBOSE=1  but the compiler   gave no indication of how one
> arives at  B from A  and
> how the library created mgcv.so) is installed in mgcv_postBuild_Tree/mgcv/libs
>
> advise on hese would be much appreciated
>
>
> Reading the manual I noticed the way of installing these recommendd packages
> appears to be
> R CMD -l path/to/libraries  recommended_tarball.tar.gz

I think you have a command missing after CMD. Usually the format is R
CMD __what_to_do__ -flag options tarball.tar.gz. I.e., if I want to
build xts, I get the source and run

R CMD INSTALL xts_0.8-7.tar.gz

and it all "just works."

Linking uses -l as you noted, but only if you need libraries above and
beyond the R headers (which are included automatically with R CMD
install) that aren't in the package's */src directory. You'll see
above the the appropriate flags were passed to gcc for you in
specifing ATLAS and the gnu c99 extensions. Linking within R should be
done properly for you. I'm not an expert on the package build process,
so I'll wait for someone else to say more / correct me if needed.

>
> I  would like to know if the following is possible and if so how so:-
> a) obtaining more verbose output from make  (is this makefile related ? )
> a) exercising control over the compiler settings for  the creation of the
> library module (mgcv.so in the above case)
> b)  manual setting of the source and destination  directroies  and  keeping of
> the source tree  where the package is built.
>

Try

R CMD INSTALL --help

to see available flags.

Best,
Michael

> thannks in advance
>
> sincerely
> luxInteg
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From ripley at stats.ox.ac.uk  Tue Jul 24 22:46:54 2012
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 24 Jul 2012 21:46:54 +0100
Subject: [Rd] Encoding errors in Rd files
In-Reply-To: <CAFFLneRasns6PUuhFeVZOJnPfWooX04ROCiGDZgVy0h_SL6FNA@mail.gmail.com>
References: <CAFFLneRasns6PUuhFeVZOJnPfWooX04ROCiGDZgVy0h_SL6FNA@mail.gmail.com>
Message-ID: <500F09BE.1090804@stats.ox.ac.uk>

On 24/07/2012 21:08, steven mosher wrote:
> Well, I'm working on project trying to bring back an old package last
> published on R 1.9 back to life.
> I'm almost there but I am getting killed by an encoding error in the Rd
> files
>
> After reading the manual, I decided to try UTF-8.  Mostly because I could
> spell it. ha.
>
> That got me a bit closer but I still have these warnings
>
> * checking data for non-ASCII characters ... WARNING
>    Warning: found non-ASCII string(s)
>    'Tourbihre de la Rivihre-aux-Feu' in object 'modpoll'
>    'Lac ` la Fourche' in object 'modpoll'
>    'Lac ` la Loutre' in object 'modpoll'
>    'Lac Kinogami' in object 'modpoll'

How to handle those is in 'Writing R Extensions': basically convert to 
UTF-8 and mark them as UTF-8.

> * checking data for ASCII and uncompressed saves ... OK
> * checking examples ... OK
> * checking PDF version of manual ... WARNING
> LaTeX errors when creating PDF version.
> This typically indicates Rd problems.
> LaTeX errors found:
>   ! Package inputenc Error: Keyboard character used is undefined
> (inputenc)                in inputencoding `utf8'.
>
> I'll keep searching the help list archives for a clue, but If somebody
> could point me at educational material it's really time
> that I learn this aspect.

Without the actual file we can do little.  The message means that 
something in the manual inputs (and it could be the DESCRIPTION file or 
an Rd file) contains a character not known to LaTeX.  Most likely it is 
simply not a UTF-8 character, but it could also be outside LaTeX's gamut.

Normally the LaTeX log (which is in the check output) is more revealing: 
you can also try this part alone with R CMD Rd2pdf (and R CMD Rd2pdf 
--no-description often points the finger at the DESCRIPTION file).

>
> I've read    http://developer.r-project.org/Encodings_and_R.html
>
> How do I figure out which encoding to use with the error seen above

Assuming this is not something esoteric, UTF-8 is the most comprehensive 
choice, but LaTeX's UTF-8 coverage (and that of the fonts used) is 
heavily biased to Western European scripts.  So for example for 
Lithuanian you may want to choose something else (Latin-7?).




-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From moshersteven at gmail.com  Wed Jul 25 09:24:23 2012
From: moshersteven at gmail.com (steven mosher)
Date: Wed, 25 Jul 2012 00:24:23 -0700
Subject: [Rd] Encoding errors in Rd files
In-Reply-To: <500F09BE.1090804@stats.ox.ac.uk>
References: <CAFFLneRasns6PUuhFeVZOJnPfWooX04ROCiGDZgVy0h_SL6FNA@mail.gmail.com>
	<500F09BE.1090804@stats.ox.ac.uk>
Message-ID: <CAFFLneSNYr7kTaW0=7LQYhAw-vfRuXEjdsO3MQmiQp-ir_M5-g@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20120725/1a45d647/attachment.pl>

From murdoch.duncan at gmail.com  Wed Jul 25 10:04:04 2012
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Wed, 25 Jul 2012 04:04:04 -0400
Subject: [Rd] Encoding errors in Rd files
In-Reply-To: <CAFFLneSNYr7kTaW0=7LQYhAw-vfRuXEjdsO3MQmiQp-ir_M5-g@mail.gmail.com>
References: <CAFFLneRasns6PUuhFeVZOJnPfWooX04ROCiGDZgVy0h_SL6FNA@mail.gmail.com>
	<500F09BE.1090804@stats.ox.ac.uk>
	<CAFFLneSNYr7kTaW0=7LQYhAw-vfRuXEjdsO3MQmiQp-ir_M5-g@mail.gmail.com>
Message-ID: <500FA874.6010709@gmail.com>

On 12-07-25 3:24 AM, steven mosher wrote:
> Thank Dr. Ripley.
>
>   When I read the instructions
> " If the DESCRIPTION file is not entirely in ASCII it should contain an ?
> Encoding? field specifying an encoding. This is used as the encoding of the
> DESCRIPTION file itself and of the R and NAMESPACE files, and as the
> default encoding of .Rd files.  "
>
> I assumed that I should specify an encoding of UTF-8 in the description
> file to handle the specific Rd files that were having problems.
>
> After I removed  the encoding field (UTF-8)  I had added to the DESCRIPTION
> file, the following error no longer occurred
>
> "  Package inputenc Error: Keyboard character used is undefined
> (inputenc)                in inputencoding `utf8'. "
>
> however the rd files still had errors.
>
>     looking at the latex versions of the Rd files I was able to spot which
> characters in the Rd files
> were offending. In my normal editor they were simply not showing up, so I
> had no idea what characters were
> causing the problem.
>
> The only thing I am left with is the entries in the data frame. The package
> came with some predefined  .rda files
> in its data subdirectory.  Using encoding() on  the column of the data
> frame that contains the following items
>
>   checking data for non-ASCII characters ... WARNING
>     Warning: found non-ASCII string(s)
>     'Tourbihre de la Rivihre-aux-Feu' in object 'modpoll'
>     'Lac ` la Fourche' in object 'modpoll'
>     'Lac ` la Loutre' in object 'modpoll'
>     'Lac Kinogami' in object 'modpoll'
>
> I get "unknown"  for all the items.  So, If I understand you I should take
> this dataframe, change the encoding
> to UTF-8.

The issue is almost certainly with accented characters in the text.  For 
example, the 5th letter in Rivi?re is an e with a grave accent.  It is 
displayed as "h" in your error message, because R was not told how to 
interpret the way it is stored in the source file, or was told something 
that turned out to be incorrect.

You need to change the source file so that it is stored in the UTF-8 
encoding.  That means you should read the file into an editor that 
displays it correctly (and that's sometimes hard when you don't know the 
original encoding; you may need to do some manual editing), then save it 
again, specifying that it should be saved using the UTF-8 encoding.  How 
you do that depends on your editor.

Then when you tell R that it is encoded in UTF-8, R will read it 
properly and won't complain.

The tools::showNonASCIIfile() function can help to find characters that 
may need fixing.  R can recognize when things are not ASCII (those bytes 
have the high bit set), but it will be up to you to figure out what 
encoding was actually used.  For French, latin1 is a good guess but it 
is not necessarily right.

Duncan Murdoch

>
> Sorry for being so dense
>
> On Tue, Jul 24, 2012 at 1:46 PM, Prof Brian Ripley <ripley at stats.ox.ac.uk>wrote:
>
>> On 24/07/2012 21:08, steven mosher wrote:
>>
>>> Well, I'm working on project trying to bring back an old package last
>>> published on R 1.9 back to life.
>>> I'm almost there but I am getting killed by an encoding error in the Rd
>>> files
>>>
>>> After reading the manual, I decided to try UTF-8.  Mostly because I could
>>> spell it. ha.
>>>
>>> That got me a bit closer but I still have these warnings
>>>
>>> * checking data for non-ASCII characters ... WARNING
>>>     Warning: found non-ASCII string(s)
>>>     'Tourbihre de la Rivihre-aux-Feu' in object 'modpoll'
>>>     'Lac ` la Fourche' in object 'modpoll'
>>>     'Lac ` la Loutre' in object 'modpoll'
>>>     'Lac Kinogami' in object 'modpoll'
>>>
>>
>> How to handle those is in 'Writing R Extensions': basically convert to
>> UTF-8 and mark them as UTF-8.
>>
>>
>>   * checking data for ASCII and uncompressed saves ... OK
>>> * checking examples ... OK
>>> * checking PDF version of manual ... WARNING
>>> LaTeX errors when creating PDF version.
>>> This typically indicates Rd problems.
>>> LaTeX errors found:
>>>    ! Package inputenc Error: Keyboard character used is undefined
>>> (inputenc)                in inputencoding `utf8'.
>>>
>>> I'll keep searching the help list archives for a clue, but If somebody
>>> could point me at educational material it's really time
>>> that I learn this aspect.
>>>
>>
>> Without the actual file we can do little.  The message means that
>> something in the manual inputs (and it could be the DESCRIPTION file or an
>> Rd file) contains a character not known to LaTeX.  Most likely it is simply
>> not a UTF-8 character, but it could also be outside LaTeX's gamut.
>>
>> Normally the LaTeX log (which is in the check output) is more revealing:
>> you can also try this part alone with R CMD Rd2pdf (and R CMD Rd2pdf
>> --no-description often points the finger at the DESCRIPTION file).
>>
>>
>>
>>> I've read    http://developer.r-project.**org/Encodings_and_R.html<http://developer.r-project.org/Encodings_and_R.html>
>>>
>>> How do I figure out which encoding to use with the error seen above
>>>
>>
>> Assuming this is not something esoteric, UTF-8 is the most comprehensive
>> choice, but LaTeX's UTF-8 coverage (and that of the fonts used) is heavily
>> biased to Western European scripts.  So for example for Lithuanian you may
>> want to choose something else (Latin-7?).
>>
>>
>>
>>
>> --
>> Brian D. Ripley,                  ripley at stats.ox.ac.uk
>> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~**ripley/<http://www.stats.ox.ac.uk/~ripley/>
>> University of Oxford,             Tel:  +44 1865 272861 (self)
>> 1 South Parks Road,                     +44 1865 272866 (PA)
>> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>>
>
> 	[[alternative HTML version deleted]]
>
>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From moshersteven at gmail.com  Wed Jul 25 10:16:58 2012
From: moshersteven at gmail.com (steven mosher)
Date: Wed, 25 Jul 2012 01:16:58 -0700
Subject: [Rd] Encoding errors in Rd files
In-Reply-To: <500FA874.6010709@gmail.com>
References: <CAFFLneRasns6PUuhFeVZOJnPfWooX04ROCiGDZgVy0h_SL6FNA@mail.gmail.com>
	<500F09BE.1090804@stats.ox.ac.uk>
	<CAFFLneSNYr7kTaW0=7LQYhAw-vfRuXEjdsO3MQmiQp-ir_M5-g@mail.gmail.com>
	<500FA874.6010709@gmail.com>
Message-ID: <CAFFLneSdRxreyYrgGYgkAgJLxvUboxwRCZnRYiNpThOcas83Sw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20120725/e39c4e98/attachment.pl>

From gunter.berton at gene.com  Wed Jul 25 01:39:09 2012
From: gunter.berton at gene.com (Bert Gunter)
Date: Tue, 24 Jul 2012 16:39:09 -0700
Subject: [Rd] Convenience function to get unevaluated ... function arguments
Message-ID: <CACk-te1KNZRVQmE52L30dSoEMB8nE9DzU5avVFP66+yOkBvcBQ@mail.gmail.com>

Folks:

Herein is a suggestion for a little R convenience function mainly to
obtain unevaluated ... function arguments. It arose from a query on
R-help on how to get these arguments. The standard (I think) idiom to
do this is via

match.call(expand.dots=FALSE)$...

However, Bill Dunlap pointed out that this repeats the argument
matching of the function call and suggested a couple of alternatives
that do not, one of which I've adapted as the following function,fun
(I'll comment on naming in a second):

fun <- as.list(substitute((...), env = parent.frame()))[-1]

Typical usage would be:

f <- function(x, ...,y)fun()

e.g.

> f(x = 5,z=sin(a),y=3,stop("oh"),w=warning("Yikes"))
$z
sin(a)

[[2]]
stop("oh")

$w
warning("Yikes")

It turns out that (surprisingly to me) the substitute idiom is faster
than the match.call idiom, although the difference appears
unimportant, since both are so fast. And it is a little slower when
wrapped into a function, anyway -- I wasn't able to figure out a
convenient way to wrap the match.call version into a function.

The question is where -- if anywhere -- should this little one-liner
go? Seems to me that there are 3 possibilities:
1. Nowhere. Unnecessary and trivial.  An entirely reasonable response,
imho; I leave it to guRus to make this judgment.

2. In with match.call(); in which case a name like match.dots would
seem appropriate.

3. In with substitute(); in which case something like substituteDots
to make the relationship clear might be appropriate.

If R core or others do want to use this, I would be happy to write the
line or two of additional documentation required (if no one else wants
to).

And to repeat... I know this is trivial, so no explanation or response
is needed if it is decided to ignore it.

Best,
Bert




-- 

Bert Gunter
Genentech Nonclinical Biostatistics

Internal Contact Info:
Phone: 467-7374
Website:
http://pharmadevelopment.roche.com/index/pdb/pdb-functional-groups/pdb-biostatistics/pdb-ncb-home.htm


From hadley at rice.edu  Thu Jul 26 00:56:44 2012
From: hadley at rice.edu (Hadley Wickham)
Date: Wed, 25 Jul 2012 15:56:44 -0700
Subject: [Rd] Rconfig.h & unsupported architectures
Message-ID: <CABdHhvFjtYWco-s0oujAW0sArcz+D1Zyv9-PmVEjfgBdGHKTDw@mail.gmail.com>

Hi all,

Recently, when compiling R packages containing C code, I've started
getting the following error:

* installing to library ?/Users/hadley/R?
* installing *source* package ?appdirs? ...
** Creating default NAMESPACE file
** libs
*** arch - i386
gcc -arch i386 -std=gnu99
-I/Library/Frameworks/R.framework/Resources/include
-I/Library/Frameworks/R.framework/Resources/include/i386 -DNDEBUG
-I/usr/local/include    -fPIC  -g -O2  -c win-path.c -o win-path.o
In file included from /Library/Frameworks/R.framework/Resources/include/R.h:34,
                 from win-path.c:1:
/Library/Frameworks/R.framework/Resources/include/Rconfig.h:13:2:
error: #error "Unsupported architecture."
In file included from
/Library/Frameworks/R.framework/Resources/include/R_ext/RS.h:27,
                 from /Library/Frameworks/R.framework/Resources/include/R.h:44,
                 from win-path.c:1:
/Library/Frameworks/R.framework/Resources/include/Rconfig.h:13:2:
error: #error "Unsupported architecture."

I'm on

> sessionInfo()
R version 2.15.1 (2012-06-22)
Platform: x86_64-apple-darwin9.8.0/x86_64 (64-bit)

And in case it helps:

gcc --version
i686-apple-darwin11-llvm-gcc-4.2 (GCC) 4.2.1 (Based on Apple Inc.
build 5658) (LLVM build 2336.9.00)

Any ideas about what I might have done to break this?

Thanks!

Hadley


-- 
Assistant Professor / Dobelman Family Junior Chair
Department of Statistics / Rice University
http://had.co.nz/


From dwinsemius at comcast.net  Thu Jul 26 00:59:34 2012
From: dwinsemius at comcast.net (David Winsemius)
Date: Wed, 25 Jul 2012 15:59:34 -0700
Subject: [Rd] Convenience function to get unevaluated ... function
	arguments
In-Reply-To: <CACk-te1KNZRVQmE52L30dSoEMB8nE9DzU5avVFP66+yOkBvcBQ@mail.gmail.com>
References: <CACk-te1KNZRVQmE52L30dSoEMB8nE9DzU5avVFP66+yOkBvcBQ@mail.gmail.com>
Message-ID: <D4D70962-54B9-4B5A-B5F7-5CBFF1FFF5F6@comcast.net>


On Jul 24, 2012, at 4:39 PM, Bert Gunter wrote:

> Folks:
>
> Herein is a suggestion for a little R convenience function mainly to
> obtain unevaluated ... function arguments. It arose from a query on
> R-help on how to get these arguments. The standard (I think) idiom to
> do this is via
>
> match.call(expand.dots=FALSE)$...
>
> However, Bill Dunlap pointed out that this repeats the argument
> matching of the function call and suggested a couple of alternatives
> that do not, one of which I've adapted as the following function,fun
> (I'll comment on naming in a second):
>
> fun <- as.list(substitute((...), env = parent.frame()))[-1]

I think instead:

fun <- function() as.list(substitute((...), env = parent.frame()))[-1]

-- 
David.
>
> Typical usage would be:
>
> f <- function(x, ...,y)fun()
>
> e.g.
>
>> f(x = 5,z=sin(a),y=3,stop("oh"),w=warning("Yikes"))
> $z
> sin(a)
>
> [[2]]
> stop("oh")
>
> $w
> warning("Yikes")
>
> It turns out that (surprisingly to me) the substitute idiom is faster
> than the match.call idiom, although the difference appears
> unimportant, since both are so fast. And it is a little slower when
> wrapped into a function, anyway -- I wasn't able to figure out a
> convenient way to wrap the match.call version into a function.
>
> The question is where -- if anywhere -- should this little one-liner
> go? Seems to me that there are 3 possibilities:
> 1. Nowhere. Unnecessary and trivial.  An entirely reasonable response,
> imho; I leave it to guRus to make this judgment.
>
> 2. In with match.call(); in which case a name like match.dots would
> seem appropriate.
>
> 3. In with substitute(); in which case something like substituteDots
> to make the relationship clear might be appropriate.
>
> If R core or others do want to use this, I would be happy to write the
> line or two of additional documentation required (if no one else wants
> to).
>
> And to repeat... I know this is trivial, so no explanation or response
> is needed if it is decided to ignore it.
>
> Best,
> Bert
>
>
>
>
> -- 
>
> Bert Gunter
> Genentech Nonclinical Biostatistics
>
> Internal Contact Info:
> Phone: 467-7374
> Website:
> http://pharmadevelopment.roche.com/index/pdb/pdb-functional-groups/pdb-biostatistics/pdb-ncb-home.htm
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

David Winsemius, MD
Heritage Laboratories
West Hartford, CT


From hkawakat at gmail.com  Thu Jul 26 01:37:02 2012
From: hkawakat at gmail.com (Hiroyuki Kawakatsu)
Date: Thu, 26 Jul 2012 00:37:02 +0100
Subject: [Rd] pie() bug in r59963
Message-ID: <CADBEN2zW83A9r0taBDXs-nopdnTJD5J8bP7FGdFgzhw+4=sHkw@mail.gmail.com>

hi,

there appears to be a bug in r-devel (r59963)
src/library/graphics/R/pie.R, line 62
        P <- t2xy(seq.int(x[i], x[i + 1], n))
meant to be
        P <- t2xy(seq.int(x[i], x[i + 1], length.out=n))
?
discovered when running demo(graphics). simpler example
is

pie(rep(1, 3), col=rainbow(3), radius=0.9)

h.
-- 
+---
| Hiroyuki Kawakatsu
| Business School, Dublin City University
| Dublin 9, Ireland. Tel +353 (0)1 700 7496


From edd at debian.org  Thu Jul 26 01:46:16 2012
From: edd at debian.org (Dirk Eddelbuettel)
Date: Wed, 25 Jul 2012 18:46:16 -0500
Subject: [Rd] Rconfig.h & unsupported architectures
In-Reply-To: <CABdHhvFjtYWco-s0oujAW0sArcz+D1Zyv9-PmVEjfgBdGHKTDw@mail.gmail.com>
References: <CABdHhvFjtYWco-s0oujAW0sArcz+D1Zyv9-PmVEjfgBdGHKTDw@mail.gmail.com>
Message-ID: <20496.34120.802225.641963@max.nulle.part>


On 25 July 2012 at 15:56, Hadley Wickham wrote:
| Hi all,
| 
| Recently, when compiling R packages containing C code, I've started
| getting the following error:
| 
| * installing to library ?/Users/hadley/R?
| * installing *source* package ?appdirs? ...
| ** Creating default NAMESPACE file
| ** libs
| *** arch - i386
| gcc -arch i386 -std=gnu99
| -I/Library/Frameworks/R.framework/Resources/include
| -I/Library/Frameworks/R.framework/Resources/include/i386 -DNDEBUG
| -I/usr/local/include    -fPIC  -g -O2  -c win-path.c -o win-path.o
| In file included from /Library/Frameworks/R.framework/Resources/include/R.h:34,
|                  from win-path.c:1:
| /Library/Frameworks/R.framework/Resources/include/Rconfig.h:13:2:
| error: #error "Unsupported architecture."
| In file included from
| /Library/Frameworks/R.framework/Resources/include/R_ext/RS.h:27,
|                  from /Library/Frameworks/R.framework/Resources/include/R.h:44,
|                  from win-path.c:1:
| /Library/Frameworks/R.framework/Resources/include/Rconfig.h:13:2:
| error: #error "Unsupported architecture."
| 
| I'm on
| 
| > sessionInfo()
| R version 2.15.1 (2012-06-22)
| Platform: x86_64-apple-darwin9.8.0/x86_64 (64-bit)
| 
| And in case it helps:
| 
| gcc --version
| i686-apple-darwin11-llvm-gcc-4.2 (GCC) 4.2.1 (Based on Apple Inc.
| build 5658) (LLVM build 2336.9.00)
| 
| Any ideas about what I might have done to break this?

A quick grep for the string shows it pop up in pcre:

edd at max:~/src/debian/R/R-2.15.1/src$ grep "Unsupported arch" */*/*
extra/pcre/pcre_jit_compile.c:#error Unsupported architecture
edd at max:~/src/debian/R/R-2.15.1/src$ 

and it is the same in R-devel. Can you substitute a pre-built pcre library?

Dirk

 
| Thanks!
| 
| Hadley
| 
| 
| -- 
| Assistant Professor / Dobelman Family Junior Chair
| Department of Statistics / Rice University
| http://had.co.nz/
| 
| ______________________________________________
| R-devel at r-project.org mailing list
| https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Dirk Eddelbuettel | edd at debian.org | http://dirk.eddelbuettel.com  


From edd at debian.org  Thu Jul 26 02:07:24 2012
From: edd at debian.org (Dirk Eddelbuettel)
Date: Wed, 25 Jul 2012 19:07:24 -0500
Subject: [Rd] Rconfig.h & unsupported architectures
In-Reply-To: <20496.34120.802225.641963@max.nulle.part>
References: <CABdHhvFjtYWco-s0oujAW0sArcz+D1Zyv9-PmVEjfgBdGHKTDw@mail.gmail.com>
	<20496.34120.802225.641963@max.nulle.part>
Message-ID: <20496.35388.778327.693500@max.nulle.part>


On 25 July 2012 at 18:46, Dirk Eddelbuettel wrote:
| 
| On 25 July 2012 at 15:56, Hadley Wickham wrote:
| | Hi all,
| | 
| | Recently, when compiling R packages containing C code, I've started
| | getting the following error:
| | 
| | * installing to library ?/Users/hadley/R?
| | * installing *source* package ?appdirs? ...
| | ** Creating default NAMESPACE file
| | ** libs
| | *** arch - i386
| | gcc -arch i386 -std=gnu99
| | -I/Library/Frameworks/R.framework/Resources/include
| | -I/Library/Frameworks/R.framework/Resources/include/i386 -DNDEBUG
| | -I/usr/local/include    -fPIC  -g -O2  -c win-path.c -o win-path.o
| | In file included from /Library/Frameworks/R.framework/Resources/include/R.h:34,
| |                  from win-path.c:1:
| | /Library/Frameworks/R.framework/Resources/include/Rconfig.h:13:2:
| | error: #error "Unsupported architecture."
| | In file included from
| | /Library/Frameworks/R.framework/Resources/include/R_ext/RS.h:27,
| |                  from /Library/Frameworks/R.framework/Resources/include/R.h:44,
| |                  from win-path.c:1:
| | /Library/Frameworks/R.framework/Resources/include/Rconfig.h:13:2:
| | error: #error "Unsupported architecture."
| | 
| | I'm on
| | 
| | > sessionInfo()
| | R version 2.15.1 (2012-06-22)
| | Platform: x86_64-apple-darwin9.8.0/x86_64 (64-bit)
| | 
| | And in case it helps:
| | 
| | gcc --version
| | i686-apple-darwin11-llvm-gcc-4.2 (GCC) 4.2.1 (Based on Apple Inc.
| | build 5658) (LLVM build 2336.9.00)
| | 
| | Any ideas about what I might have done to break this?
| 
| A quick grep for the string shows it pop up in pcre:
| 
| edd at max:~/src/debian/R/R-2.15.1/src$ grep "Unsupported arch" */*/*
| extra/pcre/pcre_jit_compile.c:#error Unsupported architecture
| edd at max:~/src/debian/R/R-2.15.1/src$ 
| 
| and it is the same in R-devel. Can you substitute a pre-built pcre library?

Actually, probably not the issue. You are getting it from one of R's headers
so it may have gotten there while you configured R on your machine. 

Dirk
 
| Dirk
| 
|  
| | Thanks!
| | 
| | Hadley
| | 
| | 
| | -- 
| | Assistant Professor / Dobelman Family Junior Chair
| | Department of Statistics / Rice University
| | http://had.co.nz/
| | 
| | ______________________________________________
| | R-devel at r-project.org mailing list
| | https://stat.ethz.ch/mailman/listinfo/r-devel
| 
| -- 
| Dirk Eddelbuettel | edd at debian.org | http://dirk.eddelbuettel.com  
| 
| ______________________________________________
| R-devel at r-project.org mailing list
| https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Dirk Eddelbuettel | edd at debian.org | http://dirk.eddelbuettel.com  


From ripley at stats.ox.ac.uk  Thu Jul 26 07:21:54 2012
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 26 Jul 2012 06:21:54 +0100
Subject: [Rd] pie() bug in r59963
In-Reply-To: <CADBEN2zW83A9r0taBDXs-nopdnTJD5J8bP7FGdFgzhw+4=sHkw@mail.gmail.com>
References: <CADBEN2zW83A9r0taBDXs-nopdnTJD5J8bP7FGdFgzhw+4=sHkw@mail.gmail.com>
Message-ID: <5010D3F2.7000504@stats.ox.ac.uk>

On 26/07/2012 00:37, Hiroyuki Kawakatsu wrote:
> hi,
>
> there appears to be a bug in r-devel (r59963)
> src/library/graphics/R/pie.R, line 62
>          P <- t2xy(seq.int(x[i], x[i + 1], n))
> meant to be
>          P <- t2xy(seq.int(x[i], x[i + 1], length.out=n))
> ?
> discovered when running demo(graphics). simpler example
> is
>
> pie(rep(1, 3), col=rainbow(3), radius=0.9)
>
> h.
>
Yes, that was an unintended change, but this is work in progress (on 
rep_ and it has gone again.

Thanks for commenting.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From gunter.berton at gene.com  Thu Jul 26 07:47:01 2012
From: gunter.berton at gene.com (Bert Gunter)
Date: Wed, 25 Jul 2012 22:47:01 -0700
Subject: [Rd] Convenience function to get unevaluated ... function
	arguments
In-Reply-To: <D4D70962-54B9-4B5A-B5F7-5CBFF1FFF5F6@comcast.net>
References: <CACk-te1KNZRVQmE52L30dSoEMB8nE9DzU5avVFP66+yOkBvcBQ@mail.gmail.com>
	<D4D70962-54B9-4B5A-B5F7-5CBFF1FFF5F6@comcast.net>
Message-ID: <CACk-te0KRK4hYga3PX+CVKfX79n4NV7UsFbB8_GKs-pS2g7yJg@mail.gmail.com>

Indeed!

-- Bert

On Wed, Jul 25, 2012 at 3:59 PM, David Winsemius <dwinsemius at comcast.net> wrote:
>
> On Jul 24, 2012, at 4:39 PM, Bert Gunter wrote:
>
>> Folks:
>>
>> Herein is a suggestion for a little R convenience function mainly to
>> obtain unevaluated ... function arguments. It arose from a query on
>> R-help on how to get these arguments. The standard (I think) idiom to
>> do this is via
>>
>> match.call(expand.dots=FALSE)$...
>>
>> However, Bill Dunlap pointed out that this repeats the argument
>> matching of the function call and suggested a couple of alternatives
>> that do not, one of which I've adapted as the following function,fun
>> (I'll comment on naming in a second):
>>
>> fun <- as.list(substitute((...), env = parent.frame()))[-1]
>
>
> I think instead:
>
> fun <- function() as.list(substitute((...), env = parent.frame()))[-1]
>
> --
> David.
>>
>>
>> Typical usage would be:
>>
>> f <- function(x, ...,y)fun()
>>
>> e.g.
>>
>>> f(x = 5,z=sin(a),y=3,stop("oh"),w=warning("Yikes"))
>>
>> $z
>> sin(a)
>>
>> [[2]]
>> stop("oh")
>>
>> $w
>> warning("Yikes")
>>
>> It turns out that (surprisingly to me) the substitute idiom is faster
>> than the match.call idiom, although the difference appears
>> unimportant, since both are so fast. And it is a little slower when
>> wrapped into a function, anyway -- I wasn't able to figure out a
>> convenient way to wrap the match.call version into a function.
>>
>> The question is where -- if anywhere -- should this little one-liner
>> go? Seems to me that there are 3 possibilities:
>> 1. Nowhere. Unnecessary and trivial.  An entirely reasonable response,
>> imho; I leave it to guRus to make this judgment.
>>
>> 2. In with match.call(); in which case a name like match.dots would
>> seem appropriate.
>>
>> 3. In with substitute(); in which case something like substituteDots
>> to make the relationship clear might be appropriate.
>>
>> If R core or others do want to use this, I would be happy to write the
>> line or two of additional documentation required (if no one else wants
>> to).
>>
>> And to repeat... I know this is trivial, so no explanation or response
>> is needed if it is decided to ignore it.
>>
>> Best,
>> Bert
>>
>>
>>
>>
>> --
>>
>> Bert Gunter
>> Genentech Nonclinical Biostatistics
>>
>> Internal Contact Info:
>> Phone: 467-7374
>> Website:
>>
>> http://pharmadevelopment.roche.com/index/pdb/pdb-functional-groups/pdb-biostatistics/pdb-ncb-home.htm
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>
> David Winsemius, MD
> Heritage Laboratories
> West Hartford, CT
>



-- 

Bert Gunter
Genentech Nonclinical Biostatistics

Internal Contact Info:
Phone: 467-7374
Website:
http://pharmadevelopment.roche.com/index/pdb/pdb-functional-groups/pdb-biostatistics/pdb-ncb-home.htm


From ggrothendieck at gmail.com  Thu Jul 26 21:55:51 2012
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Thu, 26 Jul 2012 15:55:51 -0400
Subject: [Rd] rep fails on pairlist
Message-ID: <CAP01uRkj9jBY0=G=kL3UjHMhhfNvn35=483qqxV_3XcZeEUVkQ@mail.gmail.com>

This code which has worked for years in R but fails under R-devel:

> R.version.string
[1] "R Under development (unstable) (2012-07-25 r59963)"
>
> n <- 3
> f <- function(x) {}
> formals(f) <- rep(formals(f), n) ##
Error in rep(formals(f), n) : replication of pairlists is defunct

The message suggests that the change was intentional.
Why was this functionality removed?
What code should be used in its place?


-- 
Statistics & Software Consulting
GKX Group, GKX Associates Inc.
tel: 1-877-GKX-GROUP
email: ggrothendieck at gmail.com


From edd at debian.org  Thu Jul 26 22:24:39 2012
From: edd at debian.org (Dirk Eddelbuettel)
Date: Thu, 26 Jul 2012 15:24:39 -0500
Subject: [Rd] rep fails on pairlist
In-Reply-To: <CAP01uRkj9jBY0=G=kL3UjHMhhfNvn35=483qqxV_3XcZeEUVkQ@mail.gmail.com>
References: <CAP01uRkj9jBY0=G=kL3UjHMhhfNvn35=483qqxV_3XcZeEUVkQ@mail.gmail.com>
Message-ID: <20497.42887.179117.803137@max.nulle.part>


On 26 July 2012 at 15:55, Gabor Grothendieck wrote:
| This code which has worked for years in R but fails under R-devel:
| 
| > R.version.string
| [1] "R Under development (unstable) (2012-07-25 r59963)"
| >
| > n <- 3
| > f <- function(x) {}
| > formals(f) <- rep(formals(f), n) ##
| Error in rep(formals(f), n) : replication of pairlists is defunct
| 
| The message suggests that the change was intentional.
| Why was this functionality removed?
| What code should be used in its place?

FWIW there are changes happening right now to rep() so that may be spillage
from code under development.  To keep abreast of these changes, I follow the
RSS feed Duncan set up a few years ago -- it is also as html at

   http://developer.r-project.org/blosxom.cgi/R-devel

and summarizes changes committed to the NEWS file, ie high-level changes
worth knowing about.

Dirk

-- 
Dirk Eddelbuettel | edd at debian.org | http://dirk.eddelbuettel.com


From ggrothendieck at gmail.com  Thu Jul 26 22:27:33 2012
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Thu, 26 Jul 2012 16:27:33 -0400
Subject: [Rd] rep fails on pairlist
In-Reply-To: <20497.42887.179117.803137@max.nulle.part>
References: <CAP01uRkj9jBY0=G=kL3UjHMhhfNvn35=483qqxV_3XcZeEUVkQ@mail.gmail.com>
	<20497.42887.179117.803137@max.nulle.part>
Message-ID: <CAP01uRnCcvvJEngHR4eQhdXP_9+9TyXiyj1N9qJ9B-eZ9TEvNA@mail.gmail.com>

On Thu, Jul 26, 2012 at 4:24 PM, Dirk Eddelbuettel <edd at debian.org> wrote:
>
> On 26 July 2012 at 15:55, Gabor Grothendieck wrote:
> | This code which has worked for years in R but fails under R-devel:
> |
> | > R.version.string
> | [1] "R Under development (unstable) (2012-07-25 r59963)"
> | >
> | > n <- 3
> | > f <- function(x) {}
> | > formals(f) <- rep(formals(f), n) ##
> | Error in rep(formals(f), n) : replication of pairlists is defunct
> |
> | The message suggests that the change was intentional.
> | Why was this functionality removed?
> | What code should be used in its place?
>
> FWIW there are changes happening right now to rep() so that may be spillage
> from code under development.  To keep abreast of these changes, I follow the
> RSS feed Duncan set up a few years ago -- it is also as html at
>
>    http://developer.r-project.org/blosxom.cgi/R-devel
>
> and summarizes changes committed to the NEWS file, ie high-level changes
> worth knowing about.

That page says:

Calling ?rep()? or ?rep.int()? on a pairlist or other non-vector
object is now an error.

so it again seems to be intentional.

-- 
Statistics & Software Consulting
GKX Group, GKX Associates Inc.
tel: 1-877-GKX-GROUP
email: ggrothendieck at gmail.com


From murdoch.duncan at gmail.com  Fri Jul 27 01:29:19 2012
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Thu, 26 Jul 2012 19:29:19 -0400
Subject: [Rd] rep fails on pairlist
In-Reply-To: <CAP01uRkj9jBY0=G=kL3UjHMhhfNvn35=483qqxV_3XcZeEUVkQ@mail.gmail.com>
References: <CAP01uRkj9jBY0=G=kL3UjHMhhfNvn35=483qqxV_3XcZeEUVkQ@mail.gmail.com>
Message-ID: <5011D2CF.3030001@gmail.com>

On 12-07-26 3:55 PM, Gabor Grothendieck wrote:
> This code which has worked for years in R but fails under R-devel:
>
>> R.version.string
> [1] "R Under development (unstable) (2012-07-25 r59963)"
>>
>> n <- 3
>> f <- function(x) {}
>> formals(f) <- rep(formals(f), n) ##
> Error in rep(formals(f), n) : replication of pairlists is defunct
>
> The message suggests that the change was intentional.
> Why was this functionality removed?
> What code should be used in its place?
>
>

rep() on a pairlist didn't return a pairlist, it coerced to a list and 
then rep'd that.  So you could do the same explicitly if that's what you 
really want:

formals(f) <- rep(as.list(formals(f)), n)

This works because the formals<- code is forgiving; other uses of 
pairlists would not accept the result of rep on a pairlist.

Duncan Murdoch


From ggrothendieck at gmail.com  Fri Jul 27 01:31:52 2012
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Thu, 26 Jul 2012 19:31:52 -0400
Subject: [Rd] rep fails on pairlist
In-Reply-To: <5011D2CF.3030001@gmail.com>
References: <CAP01uRkj9jBY0=G=kL3UjHMhhfNvn35=483qqxV_3XcZeEUVkQ@mail.gmail.com>
	<5011D2CF.3030001@gmail.com>
Message-ID: <CAP01uRm10L4Tds6d7JR3cTjAF0O0WZ7vrxEj+KH=doibBdGqFw@mail.gmail.com>

On Thu, Jul 26, 2012 at 7:29 PM, Duncan Murdoch
<murdoch.duncan at gmail.com> wrote:
> On 12-07-26 3:55 PM, Gabor Grothendieck wrote:
>>
>> This code which has worked for years in R but fails under R-devel:
>>
>>> R.version.string
>>
>> [1] "R Under development (unstable) (2012-07-25 r59963)"
>>>
>>>
>>> n <- 3
>>> f <- function(x) {}
>>> formals(f) <- rep(formals(f), n) ##
>>
>> Error in rep(formals(f), n) : replication of pairlists is defunct
>>
>> The message suggests that the change was intentional.
>> Why was this functionality removed?
>> What code should be used in its place?
>>
>>
>
> rep() on a pairlist didn't return a pairlist, it coerced to a list and then
> rep'd that.  So you could do the same explicitly if that's what you really
> want:
>
> formals(f) <- rep(as.list(formals(f)), n)
>
> This works because the formals<- code is forgiving; other uses of pairlists
> would not accept the result of rep on a pairlist.
>

Thanks. I will use that instead.

-- 
Statistics & Software Consulting
GKX Group, GKX Associates Inc.
tel: 1-877-GKX-GROUP
email: ggrothendieck at gmail.com


From pauljohn32 at gmail.com  Fri Jul 27 07:23:44 2012
From: pauljohn32 at gmail.com (Paul Johnson)
Date: Fri, 27 Jul 2012 00:23:44 -0500
Subject: [Rd] Problem in vignette packaging of Sweave in utils package
In-Reply-To: <4FF82AD0.1020605@gmail.com>
References: <CAErODj_9n7cjy5iPkjr-GOocL23hnJwX2QCYSd+4zJfgu0SUpA@mail.gmail.com>
	<4FF82AD0.1020605@gmail.com>
Message-ID: <CAErODj9Xu=TcHnEzQj6Auq9CO6cEAbvQeW9RTS3j=g60F-BnBA@mail.gmail.com>

New help request below

On Sat, Jul 7, 2012 at 7:25 AM, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
> On 12-07-03 1:21 PM, Paul Johnson wrote:
>>
>> In ?Sweave, it refers to Sweave User Manual. In the doc folder of
>> utils package, I see "Sweave.pdf".
>>
>> However, I can't find it from within R
>>
>>
>>> vignette("Sweave User Manual")
>>
>> Warning message:
>> vignette ?Sweave User Manual? not found
>
>
> Turns out there was a bug in the code to install from tarballs, so base
> package vignettes weren't fully installed.  I've fixed it; installs from
> R-patched or R-devel revisions after 59750 should be okay.
>
> Duncan Murdoch
>
>

Thanks, Duncan

Can I ask you to check this one again?

I just built RPMS for R-2.15.1-patched 2012-07-25 on a Rocks Cluster
(Centos 5.3).  I still see the trouble that the vignette for Sweave is
missing from the vignette index.

Below I'm showing everything I can think of that is related to this,
hoping it will give you an idea if the problem is on my end.

> sessionInfo()
R version 2.15.1 Patched (2012-07-25 r59963)
Platform: x86_64-redhat-linux-gnu (64-bit)

locale:
 [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
 [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
 [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
 [7] LC_PAPER=C                 LC_NAME=C
 [9] LC_ADDRESS=C               LC_TELEPHONE=C
[11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

loaded via a namespace (and not attached):
[1] tools_2.15.1

> browseVignettes("utils")
No vignettes found by browseVignettes("utils")

> vignette("Sweave")
Warning message:
vignette ?Sweave? not found

As far as I can tell, the vignette WAS built and installed, as evidenced:

$ pwd
/usr/lib64/R/library/utils/doc
[pauljohn at devel doc]$ ls
Sweave.pdf

But it is not found by the vignette indexing system, it's not in the
output from
help(package="utils")

Maybe I did something to break the install when making the RPM.  But I
don't know what:)  I also built R the "old fashioned way" in the shell
and the result is the same.

For the RPM, I used a spec file I've slightly adapted from Tom "Spot"
Calloway's spec file that is used to build R for EPEL and Fedora.
Here's a copy:

http://pj.freefaculty.org/misc/R-2.15.1-patch.spec

And the output (stdout and stderr) from the build process, obtained from

$ rpmbuild -ba R-2.15.1-patch.spec --define "dist kurocks53" >
R-2.15.1-patch.txt 2>&1

http://pj.freefaculty.org/misc/R-2.15.1-patch.txt

In order to make this work, I did one unsavory thing.  I took the
contents of this R-patched_2012-07-25.tar.gz and re-named the
directory R-2.15.1 and then repackaged that as R-2.15.1.tar.gz.  I
know this is unsavory to rename somebody else's packaging, but it was
the only way I could get the RPM build system to accept the version
number and file name. I put the date in the release version to reduce
confusion.  The RPMs have names like:

R-core-2.15.1-20120725kurocks53.x86_64.rpm

Oh, heck. I'm just uploading them all to the same folder as the spec
file, on the off chance you can see what's wrong.

libRmath-2.15.1-20120725kurocks53.x86_64.rpm
libRmath-devel-2.15.1-20120725kurocks53.x86_64.rpm
libRmath-static-2.15.1-20120725kurocks53.x86_64.rpm
R-2.15.1-20120725kurocks53.x86_64.rpm
R-core-2.15.1-20120725kurocks53.x86_64.rpm
R-debuginfo-2.15.1-20120725kurocks53.x86_64.rpm
R-devel-2.15.1-20120725kurocks53.x86_64.rpm

And the SRPM:

R-2.15.1-20120725kurocks53.src.rpm

pj

-- 
Paul E. Johnson
Professor, Political Science    Assoc. Director
1541 Lilac Lane, Room 504     Center for Research Methods
University of Kansas               University of Kansas
http://pj.freefaculty.org            http://quant.ku.edu


From gregory.warnes at novartis.com  Thu Jul 26 16:52:54 2012
From: gregory.warnes at novartis.com (Warnes, Gregory)
Date: Thu, 26 Jul 2012 14:52:54 +0000
Subject: [Rd] Convenience function to get unevaluated ...
	function	arguments
In-Reply-To: <CACk-te0KRK4hYga3PX+CVKfX79n4NV7UsFbB8_GKs-pS2g7yJg@mail.gmail.com>
References: <CACk-te1KNZRVQmE52L30dSoEMB8nE9DzU5avVFP66+yOkBvcBQ@mail.gmail.com>
	<D4D70962-54B9-4B5A-B5F7-5CBFF1FFF5F6@comcast.net>,
	<CACk-te0KRK4hYga3PX+CVKfX79n4NV7UsFbB8_GKs-pS2g7yJg@mail.gmail.com>
Message-ID: <CF0332AF-2DC7-4BB4-86A2-D778E6C408C2@novartis.com>

I'll be glad to add it to the gtools package if it doesn't (immediately) go into one of the core packages.

Sent from my iPhone

On Jul 26, 2012, at 7:35 AM, "Bert Gunter" <gunter.berton at gene.com> wrote:

> Indeed!
> 
> -- Bert
> 
> On Wed, Jul 25, 2012 at 3:59 PM, David Winsemius <dwinsemius at comcast.net> wrote:
>> 
>> On Jul 24, 2012, at 4:39 PM, Bert Gunter wrote:
>> 
>>> Folks:
>>> 
>>> Herein is a suggestion for a little R convenience function mainly to
>>> obtain unevaluated ... function arguments. It arose from a query on
>>> R-help on how to get these arguments. The standard (I think) idiom to
>>> do this is via
>>> 
>>> match.call(expand.dots=FALSE)$...
>>> 
>>> However, Bill Dunlap pointed out that this repeats the argument
>>> matching of the function call and suggested a couple of alternatives
>>> that do not, one of which I've adapted as the following function,fun
>>> (I'll comment on naming in a second):
>>> 
>>> fun <- as.list(substitute((...), env = parent.frame()))[-1]
>> 
>> 
>> I think instead:
>> 
>> fun <- function() as.list(substitute((...), env = parent.frame()))[-1]
>> 
>> --
>> David.
>>> 
>>> 
>>> Typical usage would be:
>>> 
>>> f <- function(x, ...,y)fun()
>>> 
>>> e.g.
>>> 
>>>> f(x = 5,z=sin(a),y=3,stop("oh"),w=warning("Yikes"))
>>> 
>>> $z
>>> sin(a)
>>> 
>>> [[2]]
>>> stop("oh")
>>> 
>>> $w
>>> warning("Yikes")
>>> 
>>> It turns out that (surprisingly to me) the substitute idiom is faster
>>> than the match.call idiom, although the difference appears
>>> unimportant, since both are so fast. And it is a little slower when
>>> wrapped into a function, anyway -- I wasn't able to figure out a
>>> convenient way to wrap the match.call version into a function.
>>> 
>>> The question is where -- if anywhere -- should this little one-liner
>>> go? Seems to me that there are 3 possibilities:
>>> 1. Nowhere. Unnecessary and trivial.  An entirely reasonable response,
>>> imho; I leave it to guRus to make this judgment.
>>> 
>>> 2. In with match.call(); in which case a name like match.dots would
>>> seem appropriate.
>>> 
>>> 3. In with substitute(); in which case something like substituteDots
>>> to make the relationship clear might be appropriate.
>>> 
>>> If R core or others do want to use this, I would be happy to write the
>>> line or two of additional documentation required (if no one else wants
>>> to).
>>> 
>>> And to repeat... I know this is trivial, so no explanation or response
>>> is needed if it is decided to ignore it.
>>> 
>>> Best,
>>> Bert
>>> 
>>> 
>>> 
>>> 
>>> --
>>> 
>>> Bert Gunter
>>> Genentech Nonclinical Biostatistics
>>> 
>>> Internal Contact Info:
>>> Phone: 467-7374
>>> Website:
>>> 
>>> http://pharmadevelopment.roche.com/index/pdb/pdb-functional-groups/pdb-biostatistics/pdb-ncb-home.htm
>>> 
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>> 
>> 
>> David Winsemius, MD
>> Heritage Laboratories
>> West Hartford, CT
>> 
> 
> 
> 
> -- 
> 
> Bert Gunter
> Genentech Nonclinical Biostatistics
> 
> Internal Contact Info:
> Phone: 467-7374
> Website:
> http://pharmadevelopment.roche.com/index/pdb/pdb-functional-groups/pdb-biostatistics/pdb-ncb-home.htm
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From gunter.berton at gene.com  Thu Jul 26 17:12:47 2012
From: gunter.berton at gene.com (Bert Gunter)
Date: Thu, 26 Jul 2012 08:12:47 -0700
Subject: [Rd] Convenience function to get unevaluated ... function
	arguments
In-Reply-To: <CF0332AF-2DC7-4BB4-86A2-D778E6C408C2@novartis.com>
References: <CACk-te1KNZRVQmE52L30dSoEMB8nE9DzU5avVFP66+yOkBvcBQ@mail.gmail.com>
	<D4D70962-54B9-4B5A-B5F7-5CBFF1FFF5F6@comcast.net>
	<CACk-te0KRK4hYga3PX+CVKfX79n4NV7UsFbB8_GKs-pS2g7yJg@mail.gmail.com>
	<CF0332AF-2DC7-4BB4-86A2-D778E6C408C2@novartis.com>
Message-ID: <CACk-te1P+O0j194EHtETdWDbMcuHp+yDt579senTE5-nQ5LjDA@mail.gmail.com>

Feel free.

-- Bert

On Thu, Jul 26, 2012 at 7:52 AM, Warnes, Gregory
<gregory.warnes at novartis.com> wrote:
> I'll be glad to add it to the gtools package if it doesn't (immediately) go into one of the core packages.
>
> Sent from my iPhone
>
> On Jul 26, 2012, at 7:35 AM, "Bert Gunter" <gunter.berton at gene.com> wrote:
>
>> Indeed!
>>
>> -- Bert
>>
>> On Wed, Jul 25, 2012 at 3:59 PM, David Winsemius <dwinsemius at comcast.net> wrote:
>>>
>>> On Jul 24, 2012, at 4:39 PM, Bert Gunter wrote:
>>>
>>>> Folks:
>>>>
>>>> Herein is a suggestion for a little R convenience function mainly to
>>>> obtain unevaluated ... function arguments. It arose from a query on
>>>> R-help on how to get these arguments. The standard (I think) idiom to
>>>> do this is via
>>>>
>>>> match.call(expand.dots=FALSE)$...
>>>>
>>>> However, Bill Dunlap pointed out that this repeats the argument
>>>> matching of the function call and suggested a couple of alternatives
>>>> that do not, one of which I've adapted as the following function,fun
>>>> (I'll comment on naming in a second):
>>>>
>>>> fun <- as.list(substitute((...), env = parent.frame()))[-1]
>>>
>>>
>>> I think instead:
>>>
>>> fun <- function() as.list(substitute((...), env = parent.frame()))[-1]
>>>
>>> --
>>> David.
>>>>
>>>>
>>>> Typical usage would be:
>>>>
>>>> f <- function(x, ...,y)fun()
>>>>
>>>> e.g.
>>>>
>>>>> f(x = 5,z=sin(a),y=3,stop("oh"),w=warning("Yikes"))
>>>>
>>>> $z
>>>> sin(a)
>>>>
>>>> [[2]]
>>>> stop("oh")
>>>>
>>>> $w
>>>> warning("Yikes")
>>>>
>>>> It turns out that (surprisingly to me) the substitute idiom is faster
>>>> than the match.call idiom, although the difference appears
>>>> unimportant, since both are so fast. And it is a little slower when
>>>> wrapped into a function, anyway -- I wasn't able to figure out a
>>>> convenient way to wrap the match.call version into a function.
>>>>
>>>> The question is where -- if anywhere -- should this little one-liner
>>>> go? Seems to me that there are 3 possibilities:
>>>> 1. Nowhere. Unnecessary and trivial.  An entirely reasonable response,
>>>> imho; I leave it to guRus to make this judgment.
>>>>
>>>> 2. In with match.call(); in which case a name like match.dots would
>>>> seem appropriate.
>>>>
>>>> 3. In with substitute(); in which case something like substituteDots
>>>> to make the relationship clear might be appropriate.
>>>>
>>>> If R core or others do want to use this, I would be happy to write the
>>>> line or two of additional documentation required (if no one else wants
>>>> to).
>>>>
>>>> And to repeat... I know this is trivial, so no explanation or response
>>>> is needed if it is decided to ignore it.
>>>>
>>>> Best,
>>>> Bert
>>>>
>>>>
>>>>
>>>>
>>>> --
>>>>
>>>> Bert Gunter
>>>> Genentech Nonclinical Biostatistics
>>>>
>>>> Internal Contact Info:
>>>> Phone: 467-7374
>>>> Website:
>>>>
>>>> http://pharmadevelopment.roche.com/index/pdb/pdb-functional-groups/pdb-biostatistics/pdb-ncb-home.htm
>>>>
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>>
>>> David Winsemius, MD
>>> Heritage Laboratories
>>> West Hartford, CT
>>>
>>
>>
>>
>> --
>>
>> Bert Gunter
>> Genentech Nonclinical Biostatistics
>>
>> Internal Contact Info:
>> Phone: 467-7374
>> Website:
>> http://pharmadevelopment.roche.com/index/pdb/pdb-functional-groups/pdb-biostatistics/pdb-ncb-home.htm
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel



-- 

Bert Gunter
Genentech Nonclinical Biostatistics

Internal Contact Info:
Phone: 467-7374
Website:
http://pharmadevelopment.roche.com/index/pdb/pdb-functional-groups/pdb-biostatistics/pdb-ncb-home.htm


From murdoch.duncan at gmail.com  Fri Jul 27 16:54:43 2012
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Fri, 27 Jul 2012 10:54:43 -0400
Subject: [Rd] Problem in vignette packaging of Sweave in utils package
In-Reply-To: <CAErODj9Xu=TcHnEzQj6Auq9CO6cEAbvQeW9RTS3j=g60F-BnBA@mail.gmail.com>
References: <CAErODj_9n7cjy5iPkjr-GOocL23hnJwX2QCYSd+4zJfgu0SUpA@mail.gmail.com>
	<4FF82AD0.1020605@gmail.com>
	<CAErODj9Xu=TcHnEzQj6Auq9CO6cEAbvQeW9RTS3j=g60F-BnBA@mail.gmail.com>
Message-ID: <5012ABB3.3020300@gmail.com>

On 12-07-27 1:23 AM, Paul Johnson wrote:
> New help request below
>
> On Sat, Jul 7, 2012 at 7:25 AM, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
>> On 12-07-03 1:21 PM, Paul Johnson wrote:
>>>
>>> In ?Sweave, it refers to Sweave User Manual. In the doc folder of
>>> utils package, I see "Sweave.pdf".
>>>
>>> However, I can't find it from within R
>>>
>>>
>>>> vignette("Sweave User Manual")
>>>
>>> Warning message:
>>> vignette ?Sweave User Manual? not found
>>
>>
>> Turns out there was a bug in the code to install from tarballs, so base
>> package vignettes weren't fully installed.  I've fixed it; installs from
>> R-patched or R-devel revisions after 59750 should be okay.
>>
>> Duncan Murdoch
>>
>>
>
> Thanks, Duncan
>
> Can I ask you to check this one again?

Sorry, I can't help with this.  If you build from svn or from a tarball, 
then I could help, but someone else produces the rpms, and I don't have 
access to a Linux system to try them.

Duncan Murdoch

>
> I just built RPMS for R-2.15.1-patched 2012-07-25 on a Rocks Cluster
> (Centos 5.3).  I still see the trouble that the vignette for Sweave is
> missing from the vignette index.
>
> Below I'm showing everything I can think of that is related to this,
> hoping it will give you an idea if the problem is on my end.
>
>> sessionInfo()
> R version 2.15.1 Patched (2012-07-25 r59963)
> Platform: x86_64-redhat-linux-gnu (64-bit)
>
> locale:
>   [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
>   [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
>   [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
>   [7] LC_PAPER=C                 LC_NAME=C
>   [9] LC_ADDRESS=C               LC_TELEPHONE=C
> [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> loaded via a namespace (and not attached):
> [1] tools_2.15.1
>
>> browseVignettes("utils")
> No vignettes found by browseVignettes("utils")
>
>> vignette("Sweave")
> Warning message:
> vignette ?Sweave? not found
>
> As far as I can tell, the vignette WAS built and installed, as evidenced:
>
> $ pwd
> /usr/lib64/R/library/utils/doc
> [pauljohn at devel doc]$ ls
> Sweave.pdf
>
> But it is not found by the vignette indexing system, it's not in the
> output from
> help(package="utils")
>
> Maybe I did something to break the install when making the RPM.  But I
> don't know what:)  I also built R the "old fashioned way" in the shell
> and the result is the same.
>
> For the RPM, I used a spec file I've slightly adapted from Tom "Spot"
> Calloway's spec file that is used to build R for EPEL and Fedora.
> Here's a copy:
>
> http://pj.freefaculty.org/misc/R-2.15.1-patch.spec
>
> And the output (stdout and stderr) from the build process, obtained from
>
> $ rpmbuild -ba R-2.15.1-patch.spec --define "dist kurocks53" >
> R-2.15.1-patch.txt 2>&1
>
> http://pj.freefaculty.org/misc/R-2.15.1-patch.txt
>
> In order to make this work, I did one unsavory thing.  I took the
> contents of this R-patched_2012-07-25.tar.gz and re-named the
> directory R-2.15.1 and then repackaged that as R-2.15.1.tar.gz.  I
> know this is unsavory to rename somebody else's packaging, but it was
> the only way I could get the RPM build system to accept the version
> number and file name. I put the date in the release version to reduce
> confusion.  The RPMs have names like:
>
> R-core-2.15.1-20120725kurocks53.x86_64.rpm
>
> Oh, heck. I'm just uploading them all to the same folder as the spec
> file, on the off chance you can see what's wrong.
>
> libRmath-2.15.1-20120725kurocks53.x86_64.rpm
> libRmath-devel-2.15.1-20120725kurocks53.x86_64.rpm
> libRmath-static-2.15.1-20120725kurocks53.x86_64.rpm
> R-2.15.1-20120725kurocks53.x86_64.rpm
> R-core-2.15.1-20120725kurocks53.x86_64.rpm
> R-debuginfo-2.15.1-20120725kurocks53.x86_64.rpm
> R-devel-2.15.1-20120725kurocks53.x86_64.rpm
>
> And the SRPM:
>
> R-2.15.1-20120725kurocks53.src.rpm
>
> pj
>


From pauljohn32 at gmail.com  Fri Jul 27 22:55:53 2012
From: pauljohn32 at gmail.com (Paul Johnson)
Date: Fri, 27 Jul 2012 15:55:53 -0500
Subject: [Rd] Problem in vignette packaging of Sweave in utils package
In-Reply-To: <5012ABB3.3020300@gmail.com>
References: <CAErODj_9n7cjy5iPkjr-GOocL23hnJwX2QCYSd+4zJfgu0SUpA@mail.gmail.com>
	<4FF82AD0.1020605@gmail.com>
	<CAErODj9Xu=TcHnEzQj6Auq9CO6cEAbvQeW9RTS3j=g60F-BnBA@mail.gmail.com>
	<5012ABB3.3020300@gmail.com>
Message-ID: <CAErODj_bN3xec_6HGGPi1ZFrXt486BttOEzO0JxVGmZu2H9GvQ@mail.gmail.com>

On Fri, Jul 27, 2012 at 9:54 AM, Duncan Murdoch
<murdoch.duncan at gmail.com> wrote:
> On 12-07-27 1:23 AM, Paul Johnson wrote:
>>
>> New help request below
>>
>> On Sat, Jul 7, 2012 at 7:25 AM, Duncan Murdoch <murdoch.duncan at gmail.com>
>> wrote:
>>>
>>> On 12-07-03 1:21 PM, Paul Johnson wrote:
>>>>
>>>>
>>>> In ?Sweave, it refers to Sweave User Manual. In the doc folder of
>>>> utils package, I see "Sweave.pdf".
>>>>
>>>> However, I can't find it from within R
>>>>
>>>>
>>>>> vignette("Sweave User Manual")
>>>>
>>>>
>>>> Warning message:
>>>> vignette ?Sweave User Manual? not found
>>>
>>>
>>>
>>> Turns out there was a bug in the code to install from tarballs, so base
>>> package vignettes weren't fully installed.  I've fixed it; installs from
>>> R-patched or R-devel revisions after 59750 should be okay.
>>>
>>> Duncan Murdoch
>>>
>>>
>>
>> Thanks, Duncan
>>
>> Can I ask you to check this one again?
>
>
> Sorry, I can't help with this.  If you build from svn or from a tarball,
> then I could help, but someone else produces the rpms, and I don't have
> access to a Linux system to try them.
>
> Duncan Murdoch
>
>

Sorry I was unclear. I did build from R-patched tarball, from here:

ftp://ftp.stat.math.ethz.ch/Software/R/R-patched_2012-07-25.tar.gz

I get the same result whether I build that into an RPM or if I build
and install the "old fashioned" way (configure, make, make install).
The Sweave pdf is created, but not found inside R.

I just re-ran the compilation in an Emacs shell and you can see
everything that goes on:

http://pj.freefaculty.org/misc/R-patched-build-20120725.txt

As you will see, I run into problems with pdf creation in

make pdf

dealing with refman. I think that links back to the ancient tetex
toolkit and the lack of incolsolata font.  If that is the reason R
can't find the vignette, I would be glad to know.

I do get the Sweave.pdf vignette created, just not indexed.

pj
-- 
Paul E. Johnson
Professor, Political Science    Assoc. Director
1541 Lilac Lane, Room 504     Center for Research Methods
University of Kansas               University of Kansas
http://pj.freefaculty.org            http://quant.ku.edu


From hadley at rice.edu  Fri Jul 27 23:06:13 2012
From: hadley at rice.edu (Hadley Wickham)
Date: Fri, 27 Jul 2012 14:06:13 -0700
Subject: [Rd] Rconfig.h & unsupported architectures
In-Reply-To: <20496.35388.778327.693500@max.nulle.part>
References: <CABdHhvFjtYWco-s0oujAW0sArcz+D1Zyv9-PmVEjfgBdGHKTDw@mail.gmail.com>
	<20496.34120.802225.641963@max.nulle.part>
	<20496.35388.778327.693500@max.nulle.part>
Message-ID: <CABdHhvGf3eEcuzo0xTKxXB6GS52vGgfX1VVd+7m3quXtDmtCkg@mail.gmail.com>

> Actually, probably not the issue. You are getting it from one of R's headers
> so it may have gotten there while you configured R on your machine.

Which I didn't do, since I got a pre-built binary from CRAN.  I guess
I'll try re-installing and hope the problem goes away.

Hadley

-- 
Assistant Professor / Dobelman Family Junior Chair
Department of Statistics / Rice University
http://had.co.nz/


From hadley at rice.edu  Fri Jul 27 23:53:18 2012
From: hadley at rice.edu (Hadley Wickham)
Date: Fri, 27 Jul 2012 14:53:18 -0700
Subject: [Rd] Version of substitute that evaluates it's first argument
Message-ID: <CABdHhvFstF51xCxPHLZssh0A6ORH9PfVi2W=ZyonrF=X4XxRPQ@mail.gmail.com>

Hi all,

Does there already exist a version of substitute that evaluates it's
first argument? (i.e. it accepts an already quoted expression).  This
seems like something that's pretty handy, but I haven't found any
existing function to do it:

substitute_e <- function(expr, env) {
  eval(substitute(substitute(expr, env), list(expr = expr)))
}

f <- quote(x + y + z)

substitute(f, list(y = 1, z = as.name("b")))
substitute_e(f, list(y = 1, z = as.name("b")))

Hadley

-- 
Assistant Professor / Dobelman Family Junior Chair
Department of Statistics / Rice University
http://had.co.nz/


From wdunlap at tibco.com  Sat Jul 28 00:18:57 2012
From: wdunlap at tibco.com (William Dunlap)
Date: Fri, 27 Jul 2012 22:18:57 +0000
Subject: [Rd] Version of substitute that evaluates it's first argument
In-Reply-To: <CABdHhvFstF51xCxPHLZssh0A6ORH9PfVi2W=ZyonrF=X4XxRPQ@mail.gmail.com>
References: <CABdHhvFstF51xCxPHLZssh0A6ORH9PfVi2W=ZyonrF=X4XxRPQ@mail.gmail.com>
Message-ID: <E66794E69CFDE04D9A70842786030B932DEEE1@PA-MBX01.na.tibco.com>

For what it's worth, S+'s substitute() has had an evaluate=FALSE argument
to substitute() for quite a while (I think it came with Sv4).  evaluate=TRUE
means to evaluate its first arument:
  > myCall <- call("myFunc", as.name("arg1"))
  > substitute(myCall, list(arg1=as.name("newArg1")), evaluate=TRUE)
  myFunc(newArg1)
  > substitute(myCall, list(arg1=as.name("newArg1")))
  myCall
It seems like a good name for the option and it is handy.

Bill Dunlap
Spotfire, TIBCO Software
wdunlap tibco.com

> -----Original Message-----
> From: r-devel-bounces at r-project.org [mailto:r-devel-bounces at r-project.org] On Behalf
> Of Hadley Wickham
> Sent: Friday, July 27, 2012 2:53 PM
> To: r-devel at r-project.org
> Subject: [Rd] Version of substitute that evaluates it's first argument
> 
> Hi all,
> 
> Does there already exist a version of substitute that evaluates it's
> first argument? (i.e. it accepts an already quoted expression).  This
> seems like something that's pretty handy, but I haven't found any
> existing function to do it:
> 
> substitute_e <- function(expr, env) {
>   eval(substitute(substitute(expr, env), list(expr = expr)))
> }
> 
> f <- quote(x + y + z)
> 
> substitute(f, list(y = 1, z = as.name("b")))
> substitute_e(f, list(y = 1, z = as.name("b")))
> 
> Hadley
> 
> --
> Assistant Professor / Dobelman Family Junior Chair
> Department of Statistics / Rice University
> http://had.co.nz/
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From dusa.adrian at gmail.com  Sat Jul 28 00:52:32 2012
From: dusa.adrian at gmail.com (=?UTF-8?B?QWRyaWFuIER1xZ9h?=)
Date: Sat, 28 Jul 2012 00:52:32 +0200
Subject: [Rd] C code validation
Message-ID: <CAJ=0CtAQw+J5xMBHvnK4ttyRNfzWM2Ak=Q3u8m9HGZt9G0fnmQ@mail.gmail.com>

Dear R-devel,

I'm trying to validate the results from a C function, against a (trial
and tested) older R function. For reasons unknown to me, the C
function seems to give different result sometimes at each trial, even
with the very same data.

These are the relevant outputs from R:


> library(QCA)
Loading required package: lpSolve
> benchmark <- function(x, y) {
+     index <- 0
+     while((index <- index + 1) < length(x)) {
+         x <- setdiff(x, findSubsets(y + 1, x[index], max(x)))
+     }
+     return(x)
+ }
>
> set.seed(12345)
> exprnec <- sort(sample(13:19683, 500))
> noflevels <- rep(2, 9)
> mbase <- rev(c(1, cumprod(rev(noflevels + 1))))[-1]
> foo1 <- benchmark(exprnec, noflevels)
> foo2 <- .Call("removeRedundants", exprnec, noflevels, mbase)
>
> all.equal(foo1, foo2)
[1] "Numeric: lengths (184, 181) differ"
>
>
> set.seed(12345)
> exprnec <- sort(sample(13:19683, 500))
> foo2 <- .Call("removeRedundants", exprnec, noflevels, mbase)
> all.equal(foo1, foo2)
[1] TRUE
>
>
> set.seed(12345)
> exprnec <- sort(sample(13:19683, 500))
> foo2 <- .Call("removeRedundants", exprnec, noflevels, mbase)
> all.equal(foo1, foo2)
[1] TRUE
>
>
> set.seed(12345)
> exprnec <- sort(sample(13:19683, 500))
> foo2 <- .Call("removeRedundants", exprnec, noflevels, mbase)
> all.equal(foo1, foo2)
[1] "Numeric: lengths (184, 173) differ"


The relevant C code can be found here:
http://codeviewer.org/view/code:287e

As I am too baffled by these (to me strange) results, any hint is much
appreciated.

Thanks very much in advance,
Adrian

-- 
Adrian Dusa
Romanian Social Data Archive
1, Schitu Magureanu Bd.
050025 Bucharest sector 5
Romania
Tel.:+40 21 3126618 \
       +40 21 3120210 / int.101
Fax: +40 21 3158391


From ripley at stats.ox.ac.uk  Sat Jul 28 07:54:10 2012
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sat, 28 Jul 2012 06:54:10 +0100
Subject: [Rd] C code validation
In-Reply-To: <CAJ=0CtAQw+J5xMBHvnK4ttyRNfzWM2Ak=Q3u8m9HGZt9G0fnmQ@mail.gmail.com>
References: <CAJ=0CtAQw+J5xMBHvnK4ttyRNfzWM2Ak=Q3u8m9HGZt9G0fnmQ@mail.gmail.com>
Message-ID: <50137E82.8040706@stats.ox.ac.uk>

On 27/07/2012 23:52, Adrian Du?a wrote:
> Dear R-devel,
>
> I'm trying to validate the results from a C function, against a (trial
> and tested) older R function. For reasons unknown to me, the C
> function seems to give different result sometimes at each trial, even
> with the very same data.

See the advice in 'Writing R Extensions'.  In particular, the most 
common cause is the use of initialized values, so run under valgrind.

Also check that your C code does not change any of its arguments: if it 
does you may end up with self-modifying R code.  (That's probably rare, 
but I spent a couple of hours on such an example last night.)


>
> These are the relevant outputs from R:
>
>
>> library(QCA)
> Loading required package: lpSolve
>> benchmark <- function(x, y) {
> +     index <- 0
> +     while((index <- index + 1) < length(x)) {
> +         x <- setdiff(x, findSubsets(y + 1, x[index], max(x)))
> +     }
> +     return(x)
> + }
>>
>> set.seed(12345)
>> exprnec <- sort(sample(13:19683, 500))
>> noflevels <- rep(2, 9)
>> mbase <- rev(c(1, cumprod(rev(noflevels + 1))))[-1]
>> foo1 <- benchmark(exprnec, noflevels)
>> foo2 <- .Call("removeRedundants", exprnec, noflevels, mbase)
>>
>> all.equal(foo1, foo2)
> [1] "Numeric: lengths (184, 181) differ"
>>
>>
>> set.seed(12345)
>> exprnec <- sort(sample(13:19683, 500))
>> foo2 <- .Call("removeRedundants", exprnec, noflevels, mbase)
>> all.equal(foo1, foo2)
> [1] TRUE
>>
>>
>> set.seed(12345)
>> exprnec <- sort(sample(13:19683, 500))
>> foo2 <- .Call("removeRedundants", exprnec, noflevels, mbase)
>> all.equal(foo1, foo2)
> [1] TRUE
>>
>>
>> set.seed(12345)
>> exprnec <- sort(sample(13:19683, 500))
>> foo2 <- .Call("removeRedundants", exprnec, noflevels, mbase)
>> all.equal(foo1, foo2)
> [1] "Numeric: lengths (184, 173) differ"
>
>
> The relevant C code can be found here:
> http://codeviewer.org/view/code:287e
>
> As I am too baffled by these (to me strange) results, any hint is much
> appreciated.
>
> Thanks very much in advance,
> Adrian
>


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From dusa.adrian at gmail.com  Sat Jul 28 13:02:54 2012
From: dusa.adrian at gmail.com (=?UTF-8?B?QWRyaWFuIER1xZ9h?=)
Date: Sat, 28 Jul 2012 13:02:54 +0200
Subject: [Rd] C code validation
In-Reply-To: <50137E82.8040706@stats.ox.ac.uk>
References: <CAJ=0CtAQw+J5xMBHvnK4ttyRNfzWM2Ak=Q3u8m9HGZt9G0fnmQ@mail.gmail.com>
	<50137E82.8040706@stats.ox.ac.uk>
Message-ID: <CAJ=0CtCbK3PJ39Fj50iNOE+9s_F+Gatfk9RKB3oTr5=0kbnzJg@mail.gmail.com>

Dear Prof. Ripley,

On Sat, Jul 28, 2012 at 7:54 AM, Prof Brian Ripley
<ripley at stats.ox.ac.uk> wrote:
> [...]
> See the advice in 'Writing R Extensions'.  In particular, the most common
> cause is the use of initialized values, so run under valgrind.
>
> Also check that your C code does not change any of its arguments: if it does
> you may end up with self-modifying R code.  (That's probably rare, but I
> spent a couple of hours on such an example last night.)

Thanks very much for this, valgrind proved to be a real asset. Thanks
to Martin Morgan as well for pointing the same thing, the issue is now
solved (the code tried to read outside the bounds of the allocated
memory).

Best wishes,
Adrian


-- 
Adrian Dusa
Romanian Social Data Archive
1, Schitu Magureanu Bd.
050025 Bucharest sector 5
Romania
Tel.:+40 21 3126618 \
       +40 21 3120210 / int.101
Fax: +40 21 3158391


From simon.urbanek at r-project.org  Sun Jul 29 01:59:47 2012
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Sat, 28 Jul 2012 19:59:47 -0400
Subject: [Rd] Rconfig.h & unsupported architectures
In-Reply-To: <CABdHhvGf3eEcuzo0xTKxXB6GS52vGgfX1VVd+7m3quXtDmtCkg@mail.gmail.com>
References: <CABdHhvFjtYWco-s0oujAW0sArcz+D1Zyv9-PmVEjfgBdGHKTDw@mail.gmail.com>
	<20496.34120.802225.641963@max.nulle.part>
	<20496.35388.778327.693500@max.nulle.part>
	<CABdHhvGf3eEcuzo0xTKxXB6GS52vGgfX1VVd+7m3quXtDmtCkg@mail.gmail.com>
Message-ID: <74162BC9-0565-4B80-A3A0-194B34EFEC11@r-project.org>


On Jul 27, 2012, at 5:06 PM, Hadley Wickham wrote:

>> Actually, probably not the issue. You are getting it from one of R's headers
>> so it may have gotten there while you configured R on your machine.
> 
> Which I didn't do, since I got a pre-built binary from CRAN.  I guess
> I'll try re-installing and hope the problem goes away.
> 

What compilers/OS is this? The error comes from the multi-arch header stub so it dispatches depending on the architecture to the actual headers in the arch subdirectories, but the error means that your architecture is not installed/supported. This is rather odd, unless you're trying to use PPC on more recent OS X without Rosetta but even then ... If in doubt, sudo rm -rf /Library/Frameworks/R.framework and re-install R ...

Cheers,
Simon


From pdalgd at gmail.com  Sun Jul 29 09:06:12 2012
From: pdalgd at gmail.com (peter dalgaard)
Date: Sun, 29 Jul 2012 09:06:12 +0200
Subject: [Rd] Rconfig.h & unsupported architectures
In-Reply-To: <74162BC9-0565-4B80-A3A0-194B34EFEC11@r-project.org>
References: <CABdHhvFjtYWco-s0oujAW0sArcz+D1Zyv9-PmVEjfgBdGHKTDw@mail.gmail.com>
	<20496.34120.802225.641963@max.nulle.part>
	<20496.35388.778327.693500@max.nulle.part>
	<CABdHhvGf3eEcuzo0xTKxXB6GS52vGgfX1VVd+7m3quXtDmtCkg@mail.gmail.com>
	<74162BC9-0565-4B80-A3A0-194B34EFEC11@r-project.org>
Message-ID: <AC8E58A4-3A46-4C64-A737-BED186A22194@gmail.com>


On Jul 29, 2012, at 01:59 , Simon Urbanek wrote:

> 
> On Jul 27, 2012, at 5:06 PM, Hadley Wickham wrote:
> 
>>> Actually, probably not the issue. You are getting it from one of R's headers
>>> so it may have gotten there while you configured R on your machine.
>> 
>> Which I didn't do, since I got a pre-built binary from CRAN.  I guess
>> I'll try re-installing and hope the problem goes away.
>> 
> 
> What compilers/OS is this? The error comes from the multi-arch header stub so it dispatches depending on the architecture to the actual headers in the arch subdirectories, but the error means that your architecture is not installed/supported. This is rather odd, unless you're trying to use PPC on more recent OS X without Rosetta but even then ... If in doubt, sudo rm -rf /Library/Frameworks/R.framework and re-install R ...
> 

It would appear to be the stock Lion compiler. I can compile biarch with that and a current  R. 

As /Library/Frameworks/R.framework/Resources/include/Rconfig.h in its entirety is the following, the only obvious way to reach the #error  would be if __i386__ somehow got undefined. Or the file itself is corrupted, of course.

-pd

/* This is an automatically generated universal stub for architecture-dependent headers. */
#ifdef __i386__
#include "i386/Rconfig.h"
#elif defined __ppc__
#include "ppc/Rconfig.h"
#elif defined __ppc64__
#include "ppc64/Rconfig.h"
#elif defined __x86_64__
#include "x86_64/Rconfig.h"
#elif defined __arm__
#include "arm/Rconfig.h"
#else
#error "Unsupported architecture."
#endif



> Cheers,
> Simon
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Peter Dalgaard, Professor,
Center for Statistics, Copenhagen Business School
Solbjerg Plads 3, 2000 Frederiksberg, Denmark
Phone: (+45)38153501
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From hadley at rice.edu  Sun Jul 29 15:12:12 2012
From: hadley at rice.edu (Hadley Wickham)
Date: Sun, 29 Jul 2012 06:12:12 -0700
Subject: [Rd] Rconfig.h & unsupported architectures
In-Reply-To: <AC8E58A4-3A46-4C64-A737-BED186A22194@gmail.com>
References: <CABdHhvFjtYWco-s0oujAW0sArcz+D1Zyv9-PmVEjfgBdGHKTDw@mail.gmail.com>
	<20496.34120.802225.641963@max.nulle.part>
	<20496.35388.778327.693500@max.nulle.part>
	<CABdHhvGf3eEcuzo0xTKxXB6GS52vGgfX1VVd+7m3quXtDmtCkg@mail.gmail.com>
	<74162BC9-0565-4B80-A3A0-194B34EFEC11@r-project.org>
	<AC8E58A4-3A46-4C64-A737-BED186A22194@gmail.com>
Message-ID: <CABdHhvHEpiZ6FbJWicNFjpJzwTxd5LGYEagnhZoXxQXN3rSJqQ@mail.gmail.com>

> It would appear to be the stock Lion compiler. I can compile biarch with that and a current  R.
>
> As /Library/Frameworks/R.framework/Resources/include/Rconfig.h in its entirety is the following, the only obvious way to reach the #error  would be if __i386__ somehow got undefined. Or the file itself is corrupted, of course.

Ooops, that's was it!  I was looking at Rconfig.h for another reason,
and must have accidentally entered a space.  Thanks!

Hadley

-- 
Assistant Professor / Dobelman Family Junior Chair
Department of Statistics / Rice University
http://had.co.nz/


From damien.georges2 at gmail.com  Mon Jul 30 12:22:10 2012
From: damien.georges2 at gmail.com (Damien Georges)
Date: Mon, 30 Jul 2012 12:22:10 +0200
Subject: [Rd] Package index help file question.
Message-ID: <50166052.2080907@gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20120730/8275765d/attachment.pl>

From paul_roebuck at comcast.net  Sun Jul 29 19:17:36 2012
From: paul_roebuck at comcast.net (Paul Roebuck)
Date: Sun, 29 Jul 2012 12:17:36 -0500
Subject: [Rd] [BUG?] utils::prompt(name=f)
Message-ID: <2AEDBAEB-8185-45E9-AE2A-61CDD962332D@comcast.net>

> ?prompt
[SNIP]
    ## Create a help file for each function in the .GlobalEnv:
    for(f in ls()) if(is.function(get(f))) prompt(name = f)

> foo <- function(x) { cat(x, '\n')}
> prompt(name="foo")
Error in utils:::prompt(object, filename = filename, name = name, ...) : 
  argument "object" is missing, with no default
> version
platform       x86_64-apple-darwin9.8.0                    
arch           x86_64                                      
os             darwin9.8.0                                 
system         x86_64, darwin9.8.0                         
status         Patched                                     
major          2                                           
minor          15.1                                        
year           2012                                        
month          07                                          
day            05                                          
svn rev        59734                                       
language       R                                           
version.string R version 2.15.1 Patched (2012-07-05 r59734)
nickname       Roasted Marshmallows


From lorenz at usgs.gov  Mon Jul 30 15:48:02 2012
From: lorenz at usgs.gov (David L Lorenz)
Date: Mon, 30 Jul 2012 08:48:02 -0500
Subject: [Rd] Shared routines in a dynamic library.
In-Reply-To: <E66794E69CFDE04D9A70842786030B932DEEE1@PA-MBX01.na.tibco.com>
References: <CABdHhvFstF51xCxPHLZssh0A6ORH9PfVi2W=ZyonrF=X4XxRPQ@mail.gmail.com>
	<E66794E69CFDE04D9A70842786030B932DEEE1@PA-MBX01.na.tibco.com>
Message-ID: <OF6269363E.841F3B79-ON86257A4B.004A38BE-86257A4B.004BCF4D@usgs.gov>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20120730/263212c8/attachment.pl>

From bbolker at gmail.com  Mon Jul 30 16:12:01 2012
From: bbolker at gmail.com (Ben Bolker)
Date: Mon, 30 Jul 2012 10:12:01 -0400
Subject: [Rd] confusion over S3/S4 importing
Message-ID: <50169631.6020709@ufl.edu>


  Can anyone help me figure out the right way to import a method that is
defined as S3 in one package and S4 in another?

  Specifically:

 profile() is defined as an S3 method in the stats package:

function (fitted, ...)
UseMethod("profile")
<bytecode: 0xa4cd6e8>
<environment: namespace:stats>

 In stats4 it is defined as an S4 method:

 stats4:::profile
standardGeneric for "profile" defined from package "stats"

function (fitted, ...)
standardGeneric("profile")
<environment: 0xa59a364>

   In the bbmle package I want to define it as an S4 method:

  setMethod("profile", "mle2", function (...) {...})

  In the NAMESPACE file for bbmle I have

 importFrom(stats4,profile)

  However, in R 2.14.2 (which is I am currently trying to fix: I would
like to try to allow for backward compatibility), I get

library(bbmle)
example(mle2) ## to create some fitted objects
profile(fit)
Error in UseMethod("profile") :
  no applicable method for 'profile' applied to an object of class "mle2"

 whereas stats4::profile(fit) works fine.

  -- a similar issue occurs for coef.

  I would have thought that importFrom() would allow package code to
find the 'stats4' version of profile (and coef) before it found the
'stats' versions , but that doesn't seem to be the case.

  Just for kicks I tried

import(stats4)

  which leads to warning messages but no improvements.

If I add an explicit Depends: on stats4 that fixes the problem. I may be
forced to do that, but I thought it was supposed to be a last resort and
that I was *supposed* to be able to fix my problems by proper use of
imports.

  Any insights?

  thanks
    Ben Bolker


From michael.weylandt at gmail.com  Mon Jul 30 21:13:16 2012
From: michael.weylandt at gmail.com (R. Michael Weylandt)
Date: Mon, 30 Jul 2012 14:13:16 -0500
Subject: [Rd] [BUG?] utils::prompt(name=f)
In-Reply-To: <2AEDBAEB-8185-45E9-AE2A-61CDD962332D@comcast.net>
References: <2AEDBAEB-8185-45E9-AE2A-61CDD962332D@comcast.net>
Message-ID: <CAAmySGN6ms8PGt5mzrw+Cmspf93w1kq0pc=2_YeoMSoXcqR6Jw@mail.gmail.com>

Just for the record, I don't see that error with 2.15.0 or with
R-Devel 60040-someodd. Both display

> foo <- function(x) cat(x, "\n")
> prompt(name = "foo")
Created file named ?foo.Rd?.
Edit the file and move it to the appropriate directory.

Best,
Michael

On Sun, Jul 29, 2012 at 12:17 PM, Paul Roebuck <paul_roebuck at comcast.net> wrote:
>> ?prompt
> [SNIP]
>     ## Create a help file for each function in the .GlobalEnv:
>     for(f in ls()) if(is.function(get(f))) prompt(name = f)
>
>> foo <- function(x) { cat(x, '\n')}
>> prompt(name="foo")
> Error in utils:::prompt(object, filename = filename, name = name, ...) :
>   argument "object" is missing, with no default
>> version
> platform       x86_64-apple-darwin9.8.0
> arch           x86_64
> os             darwin9.8.0
> system         x86_64, darwin9.8.0
> status         Patched
> major          2
> minor          15.1
> year           2012
> month          07
> day            05
> svn rev        59734
> language       R
> version.string R version 2.15.1 Patched (2012-07-05 r59734)
> nickname       Roasted Marshmallows
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From ripley at stats.ox.ac.uk  Mon Jul 30 22:36:06 2012
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 30 Jul 2012 21:36:06 +0100
Subject: [Rd] Shared routines in a dynamic library.
In-Reply-To: <OF6269363E.841F3B79-ON86257A4B.004A38BE-86257A4B.004BCF4D@usgs.gov>
References: <CABdHhvFstF51xCxPHLZssh0A6ORH9PfVi2W=ZyonrF=X4XxRPQ@mail.gmail.com>
	<E66794E69CFDE04D9A70842786030B932DEEE1@PA-MBX01.na.tibco.com>
	<OF6269363E.841F3B79-ON86257A4B.004A38BE-86257A4B.004BCF4D@usgs.gov>
Message-ID: <5016F036.8010102@stats.ox.ac.uk>

On 30/07/2012 14:48, David L Lorenz wrote:
> All,
>    I have a question about referring to a subroutine that is in a dynamic
> library other than the one in my current package.
> Let's say that I have a package foo and it has some FORTRAN code that
> contains the subroutines foo1 and foocommon. The package foo has an R
> function that calls foo1 and foocommon is a subroutine that is called from
> foo1.
> And, I have another package called bar which also has some FORTRAN code
> that contains the subrouting bar1. But bar1 also calls foocommon. The bar
> package is distinctly different from foo, but would require foo (even if
> the FORTRAN code did not have the common subroutine).
>
>    I can think of a few ways to resolve this.
> 1. Place a copy of foocommon.f into the shared library for bar.
> 2. Put all of the FORTRAN code into the foo package and just rely on the R
> code in bar to call the code that it needs.
> 3. Refer to the shared library in the bar package. I assume that I'd do
> this in the NAMESPACE file using useDynLib(foo) in addition to
> useDynLib(bar), but I found no reference to it in Writing R extensions.
>    Is there a recommended way to solve this issue? Thanks.

See 
http://cran.r-project.org/doc/manuals/R-exts.html#Linking-to-other-packages 
.  It is the main recommendation (and none of the above).

If bar loads foo, you can access things in foo's DLL by e.g.
.C("bah", PACKAGE="foo").  foo's DLL must be loaded so (3.) is not 
relevant.   But that is dangerous (foo might change) and will be noted 
by R CMD check.


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ligges at statistik.tu-dortmund.de  Mon Jul 30 23:14:59 2012
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Mon, 30 Jul 2012 23:14:59 +0200
Subject: [Rd] [BUG?] utils::prompt(name=f)
In-Reply-To: <CAAmySGN6ms8PGt5mzrw+Cmspf93w1kq0pc=2_YeoMSoXcqR6Jw@mail.gmail.com>
References: <2AEDBAEB-8185-45E9-AE2A-61CDD962332D@comcast.net>
	<CAAmySGN6ms8PGt5mzrw+Cmspf93w1kq0pc=2_YeoMSoXcqR6Jw@mail.gmail.com>
Message-ID: <5016F953.1040101@statistik.tu-dortmund.de>



On 30.07.2012 21:13, R. Michael Weylandt wrote:
> Just for the record, I don't see that error with 2.15.0 or with
> R-Devel 60040-someodd.


.. nor do I see it with R-release.

Uwe

Both display
>
>> foo <- function(x) cat(x, "\n")
>> prompt(name = "foo")
> Created file named ?foo.Rd?.
> Edit the file and move it to the appropriate directory.
>
> Best,
> Michael
>
> On Sun, Jul 29, 2012 at 12:17 PM, Paul Roebuck <paul_roebuck at comcast.net> wrote:
>>> ?prompt
>> [SNIP]
>>      ## Create a help file for each function in the .GlobalEnv:
>>      for(f in ls()) if(is.function(get(f))) prompt(name = f)
>>
>>> foo <- function(x) { cat(x, '\n')}
>>> prompt(name="foo")
>> Error in utils:::prompt(object, filename = filename, name = name, ...) :
>>    argument "object" is missing, with no default
>>> version
>> platform       x86_64-apple-darwin9.8.0
>> arch           x86_64
>> os             darwin9.8.0
>> system         x86_64, darwin9.8.0
>> status         Patched
>> major          2
>> minor          15.1
>> year           2012
>> month          07
>> day            05
>> svn rev        59734
>> language       R
>> version.string R version 2.15.1 Patched (2012-07-05 r59734)
>> nickname       Roasted Marshmallows
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From njs at pobox.com  Mon Jul 30 17:26:16 2012
From: njs at pobox.com (Nathaniel Smith)
Date: Mon, 30 Jul 2012 16:26:16 +0100
Subject: [Rd] Numerics behind splineDesign
Message-ID: <CAPJVwB=ppJ=SOs9k0p5ZHqGdnk8L1MZMBUbCSQ6oH5Zd5Pwpig@mail.gmail.com>

Hi all,

I find myself needing to be able to reproduce the spline bases that R
computes when using ns() and bs() -- but without using R. Before I go
diving headfirst into the C code in
./src/library/splines/src/splines.c, are there any simpler references
anyone might recommend? I notice that the help pages for these
functions don't seem to have any citations.

Thanks,
- Nathaniel


From bbolker at gmail.com  Tue Jul 31 15:25:01 2012
From: bbolker at gmail.com (Ben Bolker)
Date: Tue, 31 Jul 2012 13:25:01 +0000
Subject: [Rd] Numerics behind splineDesign
References: <CAPJVwB=ppJ=SOs9k0p5ZHqGdnk8L1MZMBUbCSQ6oH5Zd5Pwpig@mail.gmail.com>
Message-ID: <loom.20120731T152127-870@post.gmane.org>

Nathaniel Smith <njs <at> pobox.com> writes:

> I find myself needing to be able to reproduce the spline bases that R
> computes when using ns() and bs() -- but without using R. Before I go
> diving headfirst into the C code in
> ./src/library/splines/src/splines.c, are there any simpler references
> anyone might recommend? 

 [snip]

  Some of this stuff *might* be in the "White Book" (Statistical
Models in S, ed Chambers & Hastie (esp. chapter 7?)

  Ben Bolker


From bbolker at gmail.com  Tue Jul 31 15:49:56 2012
From: bbolker at gmail.com (Ben Bolker)
Date: Tue, 31 Jul 2012 09:49:56 -0400
Subject: [Rd] Numerics behind splineDesign
In-Reply-To: <CACk-te3ERmEVe2f2YqU8t5iFSVj0E9a4RGDTudDvGiAUyUQUtg@mail.gmail.com>
References: <CAPJVwB=ppJ=SOs9k0p5ZHqGdnk8L1MZMBUbCSQ6oH5Zd5Pwpig@mail.gmail.com>
	<loom.20120731T152127-870@post.gmane.org>
	<CACk-te3ERmEVe2f2YqU8t5iFSVj0E9a4RGDTudDvGiAUyUQUtg@mail.gmail.com>
Message-ID: <5017E284.903@gmail.com>

  ... I took the original poster's word for it that there were no
citations in the help files (sorry, that got snipped from my reply
because Gmane was complaining ... " I notice that the help pages for
these functions don't seem to have any citations.") Now that I took
30 seconds to go back and look for myself, there *is* a citation --
exactly the same one I gave ...

On 12-07-31 09:46 AM, Bert Gunter wrote:
> Well, I would first check the references given in the Help file!.
> That's what they're for, no?  Hastie's book is likely to more complete
> on the algebra, I think.
> 
> You might also be interested in the relevant chapters of Friedman,
> Hastie, et. al "The Elements of Statistical Learning Theory," which
> might be a gentler exposition of the math.
> 
> Of course, the code (or a suitable exposition of it, which may not
> exist) is the ultimate reference.
> 
> -- Bert
> 
> On Tue, Jul 31, 2012 at 6:25 AM, Ben Bolker <bbolker at gmail.com> wrote:
>> Nathaniel Smith <njs <at> pobox.com> writes:
>>
>>> I find myself needing to be able to reproduce the spline bases that R
>>> computes when using ns() and bs() -- but without using R. Before I go
>>> diving headfirst into the C code in
>>> ./src/library/splines/src/splines.c, are there any simpler references
>>> anyone might recommend?
>>
>>  [snip]
>>
>>   Some of this stuff *might* be in the "White Book" (Statistical
>> Models in S, ed Chambers & Hastie (esp. chapter 7?)
>>
>>   Ben Bolker
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 
>


From gunter.berton at gene.com  Tue Jul 31 15:46:20 2012
From: gunter.berton at gene.com (Bert Gunter)
Date: Tue, 31 Jul 2012 06:46:20 -0700
Subject: [Rd] Numerics behind splineDesign
In-Reply-To: <loom.20120731T152127-870@post.gmane.org>
References: <CAPJVwB=ppJ=SOs9k0p5ZHqGdnk8L1MZMBUbCSQ6oH5Zd5Pwpig@mail.gmail.com>
	<loom.20120731T152127-870@post.gmane.org>
Message-ID: <CACk-te3ERmEVe2f2YqU8t5iFSVj0E9a4RGDTudDvGiAUyUQUtg@mail.gmail.com>

Well, I would first check the references given in the Help file!.
That's what they're for, no?  Hastie's book is likely to more complete
on the algebra, I think.

You might also be interested in the relevant chapters of Friedman,
Hastie, et. al "The Elements of Statistical Learning Theory," which
might be a gentler exposition of the math.

Of course, the code (or a suitable exposition of it, which may not
exist) is the ultimate reference.

-- Bert

On Tue, Jul 31, 2012 at 6:25 AM, Ben Bolker <bbolker at gmail.com> wrote:
> Nathaniel Smith <njs <at> pobox.com> writes:
>
>> I find myself needing to be able to reproduce the spline bases that R
>> computes when using ns() and bs() -- but without using R. Before I go
>> diving headfirst into the C code in
>> ./src/library/splines/src/splines.c, are there any simpler references
>> anyone might recommend?
>
>  [snip]
>
>   Some of this stuff *might* be in the "White Book" (Statistical
> Models in S, ed Chambers & Hastie (esp. chapter 7?)
>
>   Ben Bolker
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel



-- 

Bert Gunter
Genentech Nonclinical Biostatistics

Internal Contact Info:
Phone: 467-7374
Website:
http://pharmadevelopment.roche.com/index/pdb/pdb-functional-groups/pdb-biostatistics/pdb-ncb-home.htm


