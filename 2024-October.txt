From |kry|ov @end|ng |rom d|@root@org  Tue Oct  8 09:16:52 2024
From: |kry|ov @end|ng |rom d|@root@org (Ivan Krylov)
Date: Tue, 8 Oct 2024 10:16:52 +0300
Subject: [Rd] WRE about R_strtod
Message-ID: <20241008101618.6acf739c@Tarkus>

Hello,

This is what "Writing R extensions" currently says about R_atof and
R_strtod:

>> Function: void R_atof (const char* str)
>> Function: void R_strtod (const char* str, char ** end)
>>
>> Implementations of the C99/POSIX functions atof and strtod which
>> guarantee platform-dependent behaviour, including always using the
>> period as the decimal point aka ?radix character? and converting
>> "NA" to R?s NA_REAL_ . 

Besides the easily fixable return type (void -> double), shouldn't the
documentation mention the fact that, unlike the standard C library
functions, R's parser returns NA_REAL instead of 0 when no conversion
is performed (including for the "NA" string, *end == str)?

Index: doc/manual/R-exts.texi
===================================================================
--- doc/manual/R-exts.texi	(revision 87211)
+++ doc/manual/R-exts.texi	(working copy)
@@ -16482,12 +16482,12 @@
 
 @apifun R_atof
 @apifun R_strtod
- at deftypefun void R_atof (const char* @var{str})
- at deftypefunx void R_strtod (const char* @var{str}, char ** @var{end})
+ at deftypefun double R_atof (const char* @var{str})
+ at deftypefunx double R_strtod (const char* @var{str}, char ** @var{end})
 Implementations of the C99/POSIX functions @code{atof} and @code{strtod}
 which guarantee platform-dependent behaviour, including always using the
-period as the decimal point @emph{aka} `@I{radix character}' and converting
- at code{"NA"} to R's @code{NA_REAL_} .
+period as the decimal point @emph{aka} `@I{radix character}' and returning
+R's @code{NA_REAL_} for all unconverted strings, including @code{"NA"}.
 @end deftypefun
 

-- 
Best regards,
Ivan


From Kurt@Horn|k @end|ng |rom wu@@c@@t  Thu Oct 10 11:04:26 2024
From: Kurt@Horn|k @end|ng |rom wu@@c@@t (Kurt Hornik)
Date: Thu, 10 Oct 2024 11:04:26 +0200
Subject: [Rd] WRE about R_strtod
In-Reply-To: <20241008101618.6acf739c@Tarkus>
References: <20241008101618.6acf739c@Tarkus>
Message-ID: <26375.39066.926653.673190@hornik.net>

>>>>> Ivan Krylov via R-devel writes:

Thanks: changed now.

Best
-k

> Hello,
> This is what "Writing R extensions" currently says about R_atof and
> R_strtod:

>>> Function: void R_atof (const char* str)
>>> Function: void R_strtod (const char* str, char ** end)
>>> 
>>> Implementations of the C99/POSIX functions atof and strtod which
>>> guarantee platform-dependent behaviour, including always using the
>>> period as the decimal point aka ?radix character? and converting
>>> "NA" to R?s NA_REAL_ . 

> Besides the easily fixable return type (void -> double), shouldn't the
> documentation mention the fact that, unlike the standard C library
> functions, R's parser returns NA_REAL instead of 0 when no conversion
> is performed (including for the "NA" string, *end == str)?

> Index: doc/manual/R-exts.texi
> ===================================================================
> --- doc/manual/R-exts.texi	(revision 87211)
> +++ doc/manual/R-exts.texi	(working copy)
> @@ -16482,12 +16482,12 @@
 
>  @apifun R_atof
>  @apifun R_strtod
> - at deftypefun void R_atof (const char* @var{str})
> - at deftypefunx void R_strtod (const char* @var{str}, char ** @var{end})
> + at deftypefun double R_atof (const char* @var{str})
> + at deftypefunx double R_strtod (const char* @var{str}, char ** @var{end})
>  Implementations of the C99/POSIX functions @code{atof} and @code{strtod}
>  which guarantee platform-dependent behaviour, including always using the
> -period as the decimal point @emph{aka} `@I{radix character}' and converting
> - at code{"NA"} to R's @code{NA_REAL_} .
> +period as the decimal point @emph{aka} `@I{radix character}' and returning
> +R's @code{NA_REAL_} for all unconverted strings, including @code{"NA"}.
>  @end deftypefun
 

> -- 
> Best regards,
> Ivan

> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From ru|pb@rr@d@@ @end|ng |rom @@po@pt  Thu Oct 10 21:53:26 2024
From: ru|pb@rr@d@@ @end|ng |rom @@po@pt (Rui Barradas)
Date: Thu, 10 Oct 2024 20:53:26 +0100
Subject: [Rd] Typo in DateTimeClasses.Rd
Message-ID: <f4eddfe6-0d5d-42f4-bb3c-23e71492faba@sapo.pt>

Hello,

When following a thread that started today [1], I read the documentation 
for DateTimeClasses {base} more carefully and noticed a typo in the 
"Details on POSIXlt" section, in the paragraph right after the 
components list.

The original and corrected are "he" instead of "the".


 From earlier versions of R, he last two components will not be present 
for times in UTC and are platform-dependent.

 From earlier versions of R, the last two components will not be present 
for times in UTC and are platform-dependent.




--- datetimeclasses.rd	2024-03-26 23:02:03.000000000 +0000
+++ datetimeclasses_2.rd	2024-10-10 20:39:16.496162900 +0100
@@ -198,7 +198,7 @@
    }
    The components must be in this order: that was only minimally checked
    prior to \R 4.3.0.  All objects created in \R 4.3.0 have the optional
-  components.  From earlier versions of \R, he last two components will
+  components.  From earlier versions of \R, the last two components will
    not be present for times in UTC and are platform-dependent.  Currently
    \code{gmtoff} is set on almost all current platforms: those based on
    BSD or \code{glibc} (including Linux and macOS) and those using the


Hope this helps,

Rui Barradas


-- 
Este e-mail foi analisado pelo software antiv?rus AVG para verificar a presen?a de v?rus.
www.avg.com


From ru|pb@rr@d@@ @end|ng |rom @@po@pt  Thu Oct 10 21:57:33 2024
From: ru|pb@rr@d@@ @end|ng |rom @@po@pt (Rui Barradas)
Date: Thu, 10 Oct 2024 20:57:33 +0100
Subject: [Rd] Typo in DateTimeClasses.Rd
Message-ID: <c1548f0e-ad3f-4f67-95f5-ea8d2ab22fc6@sapo.pt>

Hello,

In my previous e-mail I forgot the link to the thread I mention.

[1] https://stat.ethz.ch/pipermail/r-help/2024-October/480098.html

Sorry for the mess,

Rui Barradas


-- 
Este e-mail foi analisado pelo software antiv?rus AVG para verificar a presen?a de v?rus.
www.avg.com


From @eb@meyer @end|ng |rom |@u@de  Thu Oct 10 22:04:47 2024
From: @eb@meyer @end|ng |rom |@u@de (Sebastian Meyer)
Date: Thu, 10 Oct 2024 22:04:47 +0200
Subject: [Rd] Typo in DateTimeClasses.Rd
In-Reply-To: <f4eddfe6-0d5d-42f4-bb3c-23e71492faba@sapo.pt>
References: <f4eddfe6-0d5d-42f4-bb3c-23e71492faba@sapo.pt>
Message-ID: <4c909c1a-c520-40c0-8be0-c7429517c8b9@fau.de>

Thanks, fixed in the trunk.

	Sebastian Meyer


Am 10.10.24 um 21:53 schrieb Rui Barradas:
> Hello,
> 
> When following a thread that started today [1], I read the documentation
> for DateTimeClasses {base} more carefully and noticed a typo in the
> "Details on POSIXlt" section, in the paragraph right after the
> components list.
> 
> The original and corrected are "he" instead of "the".
> 
> 
>   From earlier versions of R, he last two components will not be present
> for times in UTC and are platform-dependent.
> 
>   From earlier versions of R, the last two components will not be present
> for times in UTC and are platform-dependent.
> 
> 
> 
> 
> --- datetimeclasses.rd	2024-03-26 23:02:03.000000000 +0000
> +++ datetimeclasses_2.rd	2024-10-10 20:39:16.496162900 +0100
> @@ -198,7 +198,7 @@
>      }
>      The components must be in this order: that was only minimally checked
>      prior to \R 4.3.0.  All objects created in \R 4.3.0 have the optional
> -  components.  From earlier versions of \R, he last two components will
> +  components.  From earlier versions of \R, the last two components will
>      not be present for times in UTC and are platform-dependent.  Currently
>      \code{gmtoff} is set on almost all current platforms: those based on
>      BSD or \code{glibc} (including Linux and macOS) and those using the
> 
> 
> Hope this helps,
> 
> Rui Barradas
> 
>


From pd@|gd @end|ng |rom gm@||@com  Fri Oct 11 10:50:32 2024
From: pd@|gd @end|ng |rom gm@||@com (peter dalgaard)
Date: Fri, 11 Oct 2024 10:50:32 +0200
Subject: [Rd] R 4.4.2 scheduled for October 31
Message-ID: <7D93F015-8D42-4847-BDF0-88B360816B08@gmail.com>

Full schedule is available on developer.r-project.org (pending update from SVN).

-- 
Peter Dalgaard, Professor,
Center for Statistics, Copenhagen Business School
Solbjerg Plads 3, 2000 Frederiksberg, Denmark
Phone: (+45)38153501
Office: A 4.23
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com

______________________________________________
R-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-devel


From wo||g@ng@v|echtb@uer @end|ng |rom m@@@tr|chtun|ver@|ty@n|  Fri Oct 11 12:27:42 2024
From: wo||g@ng@v|echtb@uer @end|ng |rom m@@@tr|chtun|ver@|ty@n| (Viechtbauer, Wolfgang (NP))
Date: Fri, 11 Oct 2024 10:27:42 +0000
Subject: [Rd] Error message when calling t.test() and aov() with a factor
 variables
Message-ID: <AS8PR08MB91934F160E97429FAFEB78588B792@AS8PR08MB9193.eurprd08.prod.outlook.com>

Hi all,

Just noticed that the error that arises when calling t.test() with factors could be a bit clearer:

> t.test(factor(c(3,1,2,4,3,5,4,5)), factor(c(2,1,2,3,4,5)))
Error in var(x) : Calling var(x) on a factor x is defunct.
  Use something like 'all(duplicated(x)[-1L])' to test for a constant vector.
In addition: Warning message:
In mean.default(x) :
  argument is not numeric or logical: returning NA

Obviously, using factors as input is nonsense, but this might happen on accident and then the error message could be a bit more on point. Similar for aov():

> aov(factor(c(3,1,2,4,3,5,4,5)) ~ factor(c(2,1,2,2,2,1,2,1)))
Call:
   aov(formula = factor(c(3, 1, 2, 4, 3, 5, 4, 5)) ~ factor(c(2,
    1, 2, 2, 2, 1, 2, 1)))
Error in levels(x)[x] :
  only 0's may be mixed with negative subscripts
In addition: Warning messages:
1: In model.response(mf, "numeric") :
  using type = "numeric" with a factor response will be ignored
2: In Ops.factor(y, z$residuals) : '-' not meaningful for factors

Not a big deal and trying to catch all of the silly things users may do is of course impossible, but for this one adding a check that the (response) variable is actually numeric could be useful.

Best,
Wolfgang

--
Wolfgang Viechtbauer, PhD, Statistician | Department of Psychiatry and
Neuropsychology | Maastricht University | PO Box 616 (VIJV1) | 6200 MD
Maastricht, The Netherlands | +31(43)3884170 | https://www.wvbauer.com


From Kurt@Horn|k @end|ng |rom wu@@c@@t  Fri Oct 11 14:18:07 2024
From: Kurt@Horn|k @end|ng |rom wu@@c@@t (Kurt Hornik)
Date: Fri, 11 Oct 2024 14:18:07 +0200
Subject: [Rd] 
 Error message when calling t.test() and aov() with a factor
 variables
In-Reply-To: <AS8PR08MB91934F160E97429FAFEB78588B792@AS8PR08MB9193.eurprd08.prod.outlook.com>
References: <AS8PR08MB91934F160E97429FAFEB78588B792@AS8PR08MB9193.eurprd08.prod.outlook.com>
Message-ID: <26377.6015.100740.392260@hornik.net>

>>>>> Viechtbauer, Wolfgang (NP) writes:

> Hi all,
> Just noticed that the error that arises when calling t.test() with factors could be a bit clearer:

>> t.test(factor(c(3,1,2,4,3,5,4,5)), factor(c(2,1,2,3,4,5)))
> Error in var(x) : Calling var(x) on a factor x is defunct.
>   Use something like 'all(duplicated(x)[-1L])' to test for a constant vector.
> In addition: Warning message:
> In mean.default(x) :
>   argument is not numeric or logical: returning NA

> Obviously, using factors as input is nonsense, but this might happen on accident and then the error message could be a bit more on point. Similar for aov():

>> aov(factor(c(3,1,2,4,3,5,4,5)) ~ factor(c(2,1,2,2,2,1,2,1)))
> Call:
>    aov(formula = factor(c(3, 1, 2, 4, 3, 5, 4, 5)) ~ factor(c(2,
>     1, 2, 2, 2, 1, 2, 1)))
> Error in levels(x)[x] :
>   only 0's may be mixed with negative subscripts
> In addition: Warning messages:
> 1: In model.response(mf, "numeric") :
>   using type = "numeric" with a factor response will be ignored
> 2: In Ops.factor(y, z$residuals) : '-' not meaningful for factors

> Not a big deal and trying to catch all of the silly things users may
> do is of course impossible, but for this one adding a check that the
> (response) variable is actually numeric could be useful.

Indeed.

As always, the question is whether we want to give an error unless
is.numeric, or ensure via as.numeric?

Best
-k

> Best,
> Wolfgang

> --
> Wolfgang Viechtbauer, PhD, Statistician | Department of Psychiatry and
> Neuropsychology | Maastricht University | PO Box 616 (VIJV1) | 6200 MD
> Maastricht, The Netherlands | +31(43)3884170 | https://www.wvbauer.com

> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From wo||g@ng@v|echtb@uer @end|ng |rom m@@@tr|chtun|ver@|ty@n|  Fri Oct 11 15:51:36 2024
From: wo||g@ng@v|echtb@uer @end|ng |rom m@@@tr|chtun|ver@|ty@n| (Viechtbauer, Wolfgang (NP))
Date: Fri, 11 Oct 2024 13:51:36 +0000
Subject: [Rd] 
 Error message when calling t.test() and aov() with a factor
 variables
In-Reply-To: <26377.6015.100740.392260@hornik.net>
References: <AS8PR08MB91934F160E97429FAFEB78588B792@AS8PR08MB9193.eurprd08.prod.outlook.com>
 <26377.6015.100740.392260@hornik.net>
Message-ID: <AS8PR08MB9193F95F26D8FF82DFAC65108B792@AS8PR08MB9193.eurprd08.prod.outlook.com>

> -----Original Message-----
> From: Kurt Hornik <Kurt.Hornik at wu.ac.at>
> Sent: Friday, October 11, 2024 14:18
> To: Viechtbauer, Wolfgang (NP) <wolfgang.viechtbauer at maastrichtuniversity.nl>
> Cc: r-devel <r-devel at r-project.org>
> Subject: Re: [Rd] Error message when calling t.test() and aov() with a factor
> variables
>
> >>>>> Viechtbauer, Wolfgang (NP) writes:
>
> > Hi all,
> > Just noticed that the error that arises when calling t.test() with factors
> could be a bit clearer:
>
> >> t.test(factor(c(3,1,2,4,3,5,4,5)), factor(c(2,1,2,3,4,5)))
> > Error in var(x) : Calling var(x) on a factor x is defunct.
> >   Use something like 'all(duplicated(x)[-1L])' to test for a constant vector.
> > In addition: Warning message:
> > In mean.default(x) :
> >   argument is not numeric or logical: returning NA
>
> > Obviously, using factors as input is nonsense, but this might happen on
> accident and then the error message could be a bit more on point. Similar for
> aov():
>
> >> aov(factor(c(3,1,2,4,3,5,4,5)) ~ factor(c(2,1,2,2,2,1,2,1)))
> > Call:
> >    aov(formula = factor(c(3, 1, 2, 4, 3, 5, 4, 5)) ~ factor(c(2,
> >     1, 2, 2, 2, 1, 2, 1)))
> > Error in levels(x)[x] :
> >   only 0's may be mixed with negative subscripts
> > In addition: Warning messages:
> > 1: In model.response(mf, "numeric") :
> >   using type = "numeric" with a factor response will be ignored
> > 2: In Ops.factor(y, z$residuals) : '-' not meaningful for factors
>
> > Not a big deal and trying to catch all of the silly things users may
> > do is of course impossible, but for this one adding a check that the
> > (response) variable is actually numeric could be useful.
>
> Indeed.
>
> As always, the question is whether we want to give an error unless
> is.numeric, or ensure via as.numeric?

I would issue an error. Using as.numeric() could lead to totally nonsensical results, for example when:

as.numeric(factor(c("low","high","mid")))

> Best
> -k
>
> > Best,
> > Wolfgang


From Kurt@Horn|k @end|ng |rom wu@@c@@t  Fri Oct 11 15:53:00 2024
From: Kurt@Horn|k @end|ng |rom wu@@c@@t (Kurt Hornik)
Date: Fri, 11 Oct 2024 15:53:00 +0200
Subject: [Rd] 
 Error message when calling t.test() and aov() with a factor
 variables
In-Reply-To: <AS8PR08MB9193F95F26D8FF82DFAC65108B792@AS8PR08MB9193.eurprd08.prod.outlook.com>
References: <AS8PR08MB91934F160E97429FAFEB78588B792@AS8PR08MB9193.eurprd08.prod.outlook.com>
 <26377.6015.100740.392260@hornik.net>
 <AS8PR08MB9193F95F26D8FF82DFAC65108B792@AS8PR08MB9193.eurprd08.prod.outlook.com>
Message-ID: <26377.11708.68794.532369@hornik.net>

>>>>> Viechtbauer, Wolfgang (NP) writes:

Thanks.  Patches welcome :-)

Best
-k

>> -----Original Message-----
>> From: Kurt Hornik <Kurt.Hornik at wu.ac.at>
>> Sent: Friday, October 11, 2024 14:18
>> To: Viechtbauer, Wolfgang (NP) <wolfgang.viechtbauer at maastrichtuniversity.nl>
>> Cc: r-devel <r-devel at r-project.org>
>> Subject: Re: [Rd] Error message when calling t.test() and aov() with a factor
>> variables
>> 
>> >>>>> Viechtbauer, Wolfgang (NP) writes:
>> 
>> > Hi all,
>> > Just noticed that the error that arises when calling t.test() with factors
>> could be a bit clearer:
>> 
>> >> t.test(factor(c(3,1,2,4,3,5,4,5)), factor(c(2,1,2,3,4,5)))
>> > Error in var(x) : Calling var(x) on a factor x is defunct.
>> >   Use something like 'all(duplicated(x)[-1L])' to test for a constant vector.
>> > In addition: Warning message:
>> > In mean.default(x) :
>> >   argument is not numeric or logical: returning NA
>> 
>> > Obviously, using factors as input is nonsense, but this might happen on
>> accident and then the error message could be a bit more on point. Similar for
>> aov():
>> 
>> >> aov(factor(c(3,1,2,4,3,5,4,5)) ~ factor(c(2,1,2,2,2,1,2,1)))
>> > Call:
>> >    aov(formula = factor(c(3, 1, 2, 4, 3, 5, 4, 5)) ~ factor(c(2,
>> >     1, 2, 2, 2, 1, 2, 1)))
>> > Error in levels(x)[x] :
>> >   only 0's may be mixed with negative subscripts
>> > In addition: Warning messages:
>> > 1: In model.response(mf, "numeric") :
>> >   using type = "numeric" with a factor response will be ignored
>> > 2: In Ops.factor(y, z$residuals) : '-' not meaningful for factors
>> 
>> > Not a big deal and trying to catch all of the silly things users may
>> > do is of course impossible, but for this one adding a check that the
>> > (response) variable is actually numeric could be useful.
>> 
>> Indeed.
>> 
>> As always, the question is whether we want to give an error unless
>> is.numeric, or ensure via as.numeric?

> I would issue an error. Using as.numeric() could lead to totally nonsensical results, for example when:

> as.numeric(factor(c("low","high","mid")))

>> Best
>> -k
>> 
>> > Best,
>> > Wolfgang


