From ripley at stats.ox.ac.uk  Thu Sep  1 08:34:12 2011
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 1 Sep 2011 07:34:12 +0100 (BST)
Subject: [Rd] How to safely using OpenMP pragma inside a .C() function?
In-Reply-To: <BDB09C50-B682-4593-B219-B2F0EC952198@r-project.org>
References: <1314643732236-3777036.post@n4.nabble.com>
	<B2571962-7567-4F59-A1CB-415088594F47@r-project.org>
	<1314705201298-3778482.post@n4.nabble.com>
	<1314723468677-3779214.post@n4.nabble.com>
	<798B5A8C-40DD-4BFD-B02A-45950F94EAF4@r-project.org>
	<1314821163584-3782073.post@n4.nabble.com>
	<1314823566871-3782178.post@n4.nabble.com>
	<BDB09C50-B682-4593-B219-B2F0EC952198@r-project.org>
Message-ID: <alpine.LFD.2.02.1109010717540.6154@gannet.stats.ox.ac.uk>

Note that currently R internals do not actually use multiple threads 
in OpenMP, and there is no documented way to make them do so.

The main issue is that there is insufficient knowlege of where they 
are worthwhile (which is both OS and platform-dependent: we don't even 
have reliable cross-platform ways to decide a reasonable number of 
threads, and the number of virtual cores on a multi-user platform 
definitely is not reasonable).  Luke Tierney reported that the 
crossover point for a speed-up on Mac OS X was much larger matrices 
than on Linux, for example, and there is currently no OpenMP support 
in the Windows toolchain.

The current implementation is a trial: there are more places planned 
to use OpenMP as and when the uncertainties are resolved.

This will change at some point: given the current instability in 
thread support in the MinGW-w64 project this may or may not be before 
R 2.14.0.

On Wed, 31 Aug 2011, Simon Urbanek wrote:

> Pawel,
>
> On Aug 31, 2011, at 4:46 PM, pawelm wrote:
>
>> I just found this (performance improvement of the "dist" function when using
>> openmp):

You failed to describe the platform!  See the posting guide (which 
asked you to do so 'at a minimum').

>> .Internal(setMaxNumMathThreads(1)); .Internal(setNumMathThreads(1)); m <-
>> matrix(rnorm(810000),900,900); system.time(d <- dist(m))
>>
>>  user  system elapsed
>>  3.510   0.013   3.524
>>
>> .Internal(setMaxNumMathThreads(5)); .Internal(setNumMathThreads(5)); m <-
>> matrix(rnorm(810000),900,900); system.time(d <- dist(m));
>>
>>   user  system elapsed
>>  3.536   0.007   1.321
>>
>> Works great! Just the question stays if it's a good practice to use
>> "R_num_math_threads" in external packages?

Most definitely not: it is never good practice to use undocumented 
non-API variables. See 'Writing R Extensions'.

> Normally you don't need to mess with all this and I would recommend 
> not to do so. The R internals use a different strategy since they 
> need to cope with the fall-back case, but packages should not worry 
> about that. The default number of threads is defined by the 
> OMP_NUM_THREADS environment variable and that is the documented way 
> in OpenMP, so my recommendation would be to not mess with 
> num_threads() which is precisely why I did not use it in the example 
> I gave you.

I'd be cautious there.  OMP_NUM_THREADS affects all the OpenMP code in 
the R session, and possibly others which use it (some parallel BLAS do 
too).

>
> That said, R-devel has new facilities for parallelization so things 
> may change in the future.
>
> Cheers,
> Simon

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From maechler at stat.math.ethz.ch  Thu Sep  1 11:50:49 2011
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Thu, 1 Sep 2011 11:50:49 +0200
Subject: [Rd] An example of very slow computation
In-Reply-To: <BEF2E70E-5AEF-47CF-8ABE-B393E9793D3F@eva.mpg.de>
References: <4E4B7B69.6030106@uottawa.ca> <87aab82cfy.fsf@tajo.ucsd.edu>
	<2F9EA67EF9AE1C48A147CB41BE2E15C3059E2B@DOM-EB-MAIL2.win.ad.jhu.edu>
	<2F9EA67EF9AE1C48A147CB41BE2E15C3059E9C@DOM-EB-MAIL2.win.ad.jhu.edu>
	<6872DD31-1949-44D3-8D02-283ED822D3BA@gmail.com>
	<2F9EA67EF9AE1C48A147CB41BE2E15C305A17D@DOM-EB-MAIL2.win.ad.jhu.edu>
	<BEF2E70E-5AEF-47CF-8ABE-B393E9793D3F@eva.mpg.de>
Message-ID: <20063.21881.461085.553214@stat.math.ethz.ch>

>>>>> Michael Lachmann <lachmann at eva.mpg.de>
>>>>>     on Fri, 19 Aug 2011 02:08:48 +0200 writes:

    > On my trials, after eliminating all the extra matrix<->dgeMatrix
    > conversions, using expm() and the method below were equally fast.

    > Michael

I'm sorry I hadn't time to get into this thread when it was
hot..
and I have told Ravi in the mean time what I would have said
*VERY* early here:

1) There's an 'expm' package --- which will be mentioned on the 
   Matrix::expm help page in the next version of Matrix ---
   that has better and faster algorithms (notably also some
   which work with *sparse* matrices!) than the one in Matrix.

2) Matrix::expm()  is really more reliable than one of the 19
   dubious ways that Peter mentioned correctly,
   and, it is really typically not a good idea to use a faster
   but considerably less reliable method.

   Reliability  is *much* *much* more important
   than speed, *really*
   and we (R-core) have always tried to emphasize this approach
   in all contexts.

3) Thanks to Ravi, an upcoming version of the 'expm' package
   will also contain a (Krylov space) version of expm()
   which is faster for the special case of evaluating
      expm(A * t) %*% v   	   {A matrix, v vector, t scalar}
   and *still* numerically reliable.


Martin Maechler, ETH Zurich

   
    >> Which is why I said it applies when the system is "diagonalizable".
    >> It won't work for non-diagonalizable matrix A, because T (eigenvector
    >> matrix) is singular.
    >> 
    >> Ravi.  ________________________________________ From: peter dalgaard
    >> [pdalgd at gmail.com] Sent: Thursday, August 18, 2011 6:37 PM To: Ravi
    >> Varadhan Cc: 'cberry at tajo.ucsd.edu'; r-devel at stat.math.ethz.ch;
    >> 'nashjc at uottawa.ca' Subject: Re: [Rd] An example of very slow
    >> computation
    >> 
    >> On Aug 17, 2011, at 23:24 , Ravi Varadhan wrote:
    >> 
    >>> A principled way to solve this system of ODEs is to use the idea of
    >>> "fundamental matrix", which is the same idea as that of
    >>> diagonalization of a matrix (see Boyce and DiPrima or any ODE text).
    >>> 
    >>> Here is the code for that:
    >>> 
    >>> 
    >>> nlogL2 <- function(theta){ k <- exp(theta[1:3]) sigma <-
    >>> exp(theta[4]) A <- rbind( c(-k[1], k[2]), c( k[1], -(k[2]+k[3])) ) eA
    >>> <- eigen(A) T <- eA$vectors r <- eA$values x0 <- c(0,100) Tx0 <- T
    >>> %*% x0
    >>> 
    >>> sol <- function(t) 100 - sum(T %*% diag(exp(r*t)) %*% Tx0) pred <-
    >>> sapply(dat[,1], sol) -sum(dnorm(dat[,2], mean=pred, sd=sigma,
    >>> log=TRUE)) } This is much faster than using expm(A*t), but much
    >>> slower than "by hand" calculations since we have to repeatedly do the
    >>> diagonalization.  An obvious advantage of this fuunction is that it
    >>> applies to *any* linear system of ODEs for which the eigenvalues are
    >>> real (and negative).
    >> 
    >> I believe this is method 14 of the "19 dubious ways..." (Google for
    >> it) and doesn't work for certain non-symmetric A matrices.
    >> 
    >>> 
    >>> Ravi.
    >>> 
    >>> -------------------------------------------------------
    >>> Ravi Varadhan, Ph.D.
    >>> Assistant Professor,
    >>> Division of Geriatric Medicine and Gerontology School of Medicine Johns Hopkins University
    >>> 
    >>> Ph. (410) 502-2619
    >>> email: rvaradhan at jhmi.edu
    >>> 
    >>> 
    >>> -----Original Message-----
    >>> From: r-devel-bounces at r-project.org [mailto:r-devel-bounces at r-project.org] On Behalf Of Ravi Varadhan
    >>> Sent: Wednesday, August 17, 2011 2:33 PM
    >>> To: 'cberry at tajo.ucsd.edu'; r-devel at stat.math.ethz.ch; 'nashjc at uottawa.ca'
    >>> Subject: Re: [Rd] An example of very slow computation
    >>> 
    >>> Yes, the culprit is the evaluation of expm(A*t).  This is a lazy way of solving the system of ODEs, where you save analytic effort, but you pay for it dearly in terms of computational effort!
    >>> 
    >>> Even in this lazy approach, I am sure there ought to be faster ways to evaluating exponent of a matrix than that in "Matrix" package.
    >>> 
    >>> Ravi.
    >>> 
    >>> -------------------------------------------------------
    >>> Ravi Varadhan, Ph.D.
    >>> Assistant Professor,
    >>> Division of Geriatric Medicine and Gerontology School of Medicine Johns Hopkins University
    >>> 
    >>> Ph. (410) 502-2619
    >>> email: rvaradhan at jhmi.edu
    >>> 
    >>> -----Original Message-----
    >>> From: r-devel-bounces at r-project.org [mailto:r-devel-bounces at r-project.org] On Behalf Of cberry at tajo.ucsd.edu
    >>> Sent: Wednesday, August 17, 2011 1:08 PM
    >>> To: r-devel at stat.math.ethz.ch
    >>> Subject: Re: [Rd] An example of very slow computation
    >>> 
    >>> John C Nash <nashjc at uottawa.ca> writes:
    >>> 
    >>>> This message is about a curious difference in timing between two ways of computing the
    >>>> same function. One uses expm, so is expected to be a bit slower, but "a bit" turned out to
    >>>> be a factor of >1000. The code is below. We would be grateful if anyone can point out any
    >>>> egregious bad practice in our code, or enlighten us on why one approach is so much slower
    >>>> than the other.
    >>> 
    >>> Looks like A*t in expm(A*t) is a "matrix".
    >>> 
    >>> 'getMethod("expm","matrix")' coerces it arg to a "Matrix", then calls
    >>> expm(), whose method coerces its arg to a "dMatrix" and calls expm(),
    >>> whose method coerces its arg to a 'dgeMatrix' and calls expm(), whose
    >>> method finally calls '.Call(dgeMatrix_exp, x)'
    >>> 
    >>> Whew!
    >>> 
    >>> The time difference between 'expm( diag(10)+1 )' and 'expm( as( diag(10)+1,
    >>> "dgeMatrix" ))' is a factor of 10 on my box.
    >>> 
    >>> Dunno 'bout the other factor of 100.
    >>> 
    >>> Chuck
    >>> 
    >>> 
    >>>> The problem arose in an activity to develop guidelines for nonlinear
    >>>> modeling in ecology (at NCEAS, Santa Barbara, with worldwide participants), and we will be
    >>>> trying to include suggestions of how to prepare problems like this for efficient and
    >>>> effective solution. The code for nlogL was the "original" from the worker who supplied the
    >>>> problem.
    >>>> 
    >>>> Best,
    >>>> 
    >>>> John Nash
    >>>> 
    >>>> --------------------------------------------------------------------------------------
    >>>> 
    >>>> cat("mineral-timing.R == benchmark MIN functions in R\n")
    >>>> #  J C Nash July 31, 2011
    >>>> 
    >>>> require("microbenchmark")
    >>>> require("numDeriv")
    >>>> library(Matrix)
    >>>> library(optimx)
    >>>> # dat<-read.table('min.dat', skip=3, header=FALSE)
    >>>> # t<-dat[,1]
    >>>> t <- c(0.77,  1.69,  2.69,  3.67,  4.69,  5.71,  7.94,  9.67, 11.77, 17.77,
    >>>> 23.77, 32.77, 40.73, 47.75, 54.90, 62.81, 72.88, 98.77, 125.92, 160.19,
    >>>> 191.15, 223.78, 287.70, 340.01, 340.95, 342.01)
    >>>> 
    >>>> # y<-dat[,2] # ?? tidy up
    >>>> y<- c(1.396, 3.784, 5.948, 7.717, 9.077, 10.100, 11.263, 11.856, 12.251, 12.699,
    >>>> 12.869, 13.048, 13.222, 13.347, 13.507, 13.628, 13.804, 14.087, 14.185, 14.351,
    >>>> 14.458, 14.756, 15.262, 15.703, 15.703, 15.703)
    >>>> 
    >>>> 
    >>>> ones<-rep(1,length(t))
    >>>> theta<-c(-2,-2,-2,-2)
    >>>> 
    >>>> 
    >>>> nlogL<-function(theta){
    >>>> k<-exp(theta[1:3])
    >>>> sigma<-exp(theta[4])
    >>>> A<-rbind(
    >>>> c(-k[1], k[2]),
    >>>> c( k[1], -(k[2]+k[3]))
    >>>> )
    >>>> x0<-c(0,100)
    >>>> sol<-function(t)100-sum(expm(A*t)%*%x0)
    >>>> pred<-sapply(dat[,1],sol)
    >>>> -sum(dnorm(dat[,2],mean=pred,sd=sigma, log=TRUE))
    >>>> }
    >>>> 
    >>>> getpred<-function(theta, t){
    >>>> k<-exp(theta[1:3])
    >>>> sigma<-exp(theta[4])
    >>>> A<-rbind(
    >>>> c(-k[1], k[2]),
    >>>> c( k[1], -(k[2]+k[3]))
    >>>> )
    >>>> x0<-c(0,100)
    >>>> sol<-function(tt)100-sum(expm(A*tt)%*%x0)
    >>>> pred<-sapply(t,sol)
    >>>> }
    >>>> 
    >>>> Mpred <- function(theta) {
    >>>> # WARNING: assumes t global
    >>>> kvec<-exp(theta[1:3])
    >>>> k1<-kvec[1]
    >>>> k2<-kvec[2]
    >>>> k3<-kvec[3]
    >>>> #   MIN problem terbuthylazene disappearance
    >>>> z<-k1+k2+k3
    >>>> y<-z*z-4*k1*k3
    >>>> l1<-0.5*(-z+sqrt(y))
    >>>> l2<-0.5*(-z-sqrt(y))
    >>>> val<-100*(1-((k1+k2+l2)*exp(l2*t)-(k1+k2+l1)*exp(l1*t))/(l2-l1))
    >>>> } # val should be a vector if t is a vector
    >>>> 
    >>>> negll <- function(theta){
    >>>> # non expm version JN 110731
    >>>> pred<-Mpred(theta)
    >>>> sigma<-exp(theta[4])
    >>>> -sum(dnorm(dat[,2],mean=pred,sd=sigma, log=TRUE))
    >>>> }
    >>>> 
    >>>> theta<-rep(-2,4)
    >>>> fand<-nlogL(theta)
    >>>> fsim<-negll(theta)
    >>>> cat("Check fn vals: expm =",fand,"   simple=",fsim,"  diff=",fand-fsim,"\n")
    >>>> 
    >>>> cat("time the function in expm form\n")
    >>>> tnlogL<-microbenchmark(nlogL(theta), times=100L)
    >>>> tnlogL
    >>>> 
    >>>> cat("time the function in simpler form\n")
    >>>> tnegll<-microbenchmark(negll(theta), times=100L)
    >>>> tnegll
    >>>> 
    >>>> ftimes<-data.frame(texpm=tnlogL$time, tsimp=tnegll$time)
    >>>> # ftimes
    >>>> 
    >>>> 
    >>>> boxplot(log(ftimes))
    >>>> title("Log times in nanoseconds for matrix exponential and simple MIN fn")
    >>>> 
    >>> 
    >>> --
    >>> Charles C. Berry                         cberry at tajo.ucsd.edu
    >>> 
    >>> ______________________________________________
    >>> R-devel at r-project.org mailing list
    >>> https://stat.ethz.ch/mailman/listinfo/r-devel
    >> 
    >> --
    >> Peter Dalgaard, Professor,
    >> Center for Statistics, Copenhagen Business School
    >> Solbjerg Plads 3, 2000 Frederiksberg, Denmark
    >> Phone: (+45)38153501
    >> Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com
    >> "D?den skal tape!" --- Nordahl Grieg


From pawel.matykiewicz at gmail.com  Thu Sep  1 15:39:15 2011
From: pawel.matykiewicz at gmail.com (=?ISO-8859-2?Q?Pawe=B3_Matykiewicz?=)
Date: Thu, 1 Sep 2011 09:39:15 -0400
Subject: [Rd] How to safely using OpenMP pragma inside a .C() function?
In-Reply-To: <alpine.LFD.2.02.1109010717540.6154@gannet.stats.ox.ac.uk>
References: <1314643732236-3777036.post@n4.nabble.com>
	<B2571962-7567-4F59-A1CB-415088594F47@r-project.org>
	<1314705201298-3778482.post@n4.nabble.com>
	<1314723468677-3779214.post@n4.nabble.com>
	<798B5A8C-40DD-4BFD-B02A-45950F94EAF4@r-project.org>
	<1314821163584-3782073.post@n4.nabble.com>
	<1314823566871-3782178.post@n4.nabble.com>
	<BDB09C50-B682-4593-B219-B2F0EC952198@r-project.org>
	<alpine.LFD.2.02.1109010717540.6154@gannet.stats.ox.ac.uk>
Message-ID: <CAEdd+FY2Wjc=LgAUCoymgtRpxek716Tanj2TOQdjKd9neuWLLw@mail.gmail.com>

>>> .Internal(setMaxNumMathThreads(1)); .Internal(setNumMathThreads(1)); m <-
>>> matrix(rnorm(810000),900,900); system.time(d <- dist(m))
>>>
>>> ?user ?system elapsed
>>> ?3.510 ? 0.013 ? 3.524
>>>
>>> .Internal(setMaxNumMathThreads(5)); .Internal(setNumMathThreads(5)); m <-
>>> matrix(rnorm(810000),900,900); system.time(d <- dist(m));
>>>
>>> ?user ?system elapsed
>>> ?3.536 ? 0.007 ? 1.321

These results are obtained on:

  Model Name:	Mac Pro
  Model Identifier:	MacPro4,1
  Processor Name:	Quad-Core Intel Xeon
  Processor Speed:	2.93 GHz
  Number Of Processors:	2
  Total Number Of Cores:	8
  L2 Cache (per core):	256 KB
  L3 Cache (per processor):	8 MB
  Memory:	12 GB
  Processor Interconnect Speed:	6.4 GT/s
  Boot ROM Version:	MP41.0081.B07
  SMC Version (system):	1.39f5
  SMC Version (processor tray):	1.39f5

Thank you for your comments
Regards
-- 
Pawel Matykiewicz
http://www.neuron.m4u.pl
http://www.linkedin.com/in/pawelmatykiewicz


From lachmann at eva.mpg.de  Thu Sep  1 17:52:05 2011
From: lachmann at eva.mpg.de (Michael Lachmann)
Date: Thu, 1 Sep 2011 17:52:05 +0200
Subject: [Rd] How to safely using OpenMP pragma inside a .C() function?
In-Reply-To: <alpine.LFD.2.02.1109010717540.6154@gannet.stats.ox.ac.uk>
References: <1314643732236-3777036.post@n4.nabble.com>
	<B2571962-7567-4F59-A1CB-415088594F47@r-project.org>
	<1314705201298-3778482.post@n4.nabble.com>
	<1314723468677-3779214.post@n4.nabble.com>
	<798B5A8C-40DD-4BFD-B02A-45950F94EAF4@r-project.org>
	<1314821163584-3782073.post@n4.nabble.com>
	<1314823566871-3782178.post@n4.nabble.com>
	<BDB09C50-B682-4593-B219-B2F0EC952198@r-project.org>
	<alpine.LFD.2.02.1109010717540.6154@gannet.stats.ox.ac.uk>
Message-ID: <0E91238B-CCD7-4652-B400-0420EB51AA54@eva.mpg.de>

This is probably obvious, but I just wanted to say that it should be possible to turn off multithreading even when on a machine with multiple cores. 
Reasons could be because you run in a cluster, and are given just one core for yourself.
Or, if you have a setup with trivial parallelization (i.e. you run almost the same task 100 times), where getting a speedup of 100 fold on 100 cores is easy, and multithreading would slow you down.

Michael


On 1 Sep 2011, at 8:34AM, Prof Brian Ripley wrote:

> Note that currently R internals do not actually use multiple threads in OpenMP, and there is no documented way to make them do so.
> 
> The main issue is that there is insufficient knowlege of where they are worthwhile (which is both OS and platform-dependent: we don't even have reliable cross-platform ways to decide a reasonable number of threads, and the number of virtual cores on a multi-user platform definitely is not reasonable).  Luke Tierney reported that the crossover point for a speed-up on Mac OS X was much larger matrices than on Linux, for example, and there is currently no OpenMP support in the Windows toolchain.
> 
> The current implementation is a trial: there are more places planned to use OpenMP as and when the uncertainties are resolved.
> 
> This will change at some point: given the current instability in thread support in the MinGW-w64 project this may or may not be before R 2.14.0.
> 
> On Wed, 31 Aug 2011, Simon Urbanek wrote:
> 
>> Pawel,
>> 
>> On Aug 31, 2011, at 4:46 PM, pawelm wrote:
>> 
>>> I just found this (performance improvement of the "dist" function when using
>>> openmp):
> 
> You failed to describe the platform!  See the posting guide (which asked you to do so 'at a minimum').
> 
>>> .Internal(setMaxNumMathThreads(1)); .Internal(setNumMathThreads(1)); m <-
>>> matrix(rnorm(810000),900,900); system.time(d <- dist(m))
>>> 
>>> user  system elapsed
>>> 3.510   0.013   3.524
>>> 
>>> .Internal(setMaxNumMathThreads(5)); .Internal(setNumMathThreads(5)); m <-
>>> matrix(rnorm(810000),900,900); system.time(d <- dist(m));
>>> 
>>>  user  system elapsed
>>> 3.536   0.007   1.321
>>> 
>>> Works great! Just the question stays if it's a good practice to use
>>> "R_num_math_threads" in external packages?
> 
> Most definitely not: it is never good practice to use undocumented non-API variables. See 'Writing R Extensions'.
> 
>> Normally you don't need to mess with all this and I would recommend not to do so. The R internals use a different strategy since they need to cope with the fall-back case, but packages should not worry about that. The default number of threads is defined by the OMP_NUM_THREADS environment variable and that is the documented way in OpenMP, so my recommendation would be to not mess with num_threads() which is precisely why I did not use it in the example I gave you.
> 
> I'd be cautious there.  OMP_NUM_THREADS affects all the OpenMP code in the R session, and possibly others which use it (some parallel BLAS do too).
> 
>> 
>> That said, R-devel has new facilities for parallelization so things may change in the future.
>> 
>> Cheers,
>> Simon
> 
> -- 
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 
> 


From wdunlap at tibco.com  Thu Sep  1 23:43:18 2011
From: wdunlap at tibco.com (William Dunlap)
Date: Thu, 1 Sep 2011 21:43:18 +0000
Subject: [Rd] "\088" is legal syntax?
Message-ID: <E66794E69CFDE04D9A70842786030B9304EE3E@PA-MBX04.na.tibco.com>

Is it intentional that the digit 8 is allowed
in octal escape sequences in character literals?

  > "\110" == "\088"
  [1] TRUE
  > "\8" == "\b"
  [1] TRUE

9's are rejected, so I'd expected 8's to be illegal as well.

  > "\9"
  Error: '\9' is an unrecognized escape in character string starting "\9"
  > "\091")
  Error: embedded nul in string: '\091'

Bill Dunlap
Spotfire, TIBCO Software
wdunlap tibco.com 

> sessionInfo()
R version 2.13.1 (2011-07-08)
Platform: x86_64-unknown-linux-gnu (64-bit)

locale:
 [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
 [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
 [5] LC_MONETARY=C              LC_MESSAGES=en_US.UTF-8
 [7] LC_PAPER=en_US.UTF-8       LC_NAME=C
 [9] LC_ADDRESS=C               LC_TELEPHONE=C
[11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base


From wdunlap at tibco.com  Fri Sep  2 00:24:19 2011
From: wdunlap at tibco.com (William Dunlap)
Date: Thu, 1 Sep 2011 22:24:19 +0000
Subject: [Rd] parser does not catch strings without closing quote
Message-ID: <E66794E69CFDE04D9A70842786030B9304F690@PA-MBX04.na.tibco.com>

Shouldn't the parser complain about unfinished strings in files?
It doesn't and will tack on a newline if there isn't one there. 

  > withOption <- function(optionList, expr) {
  +     oldOption <- options(optionList)
  +     on.exit(options(oldOption))
  +     expr
  + }

  > cat(file=tf<-tempfile(), "\"string without closing quote\n")
  > p <- withOption(list(keep.source=FALSE), parse(tf))
  > p
  expression("string without closing quote\n")

  > cat(file=tf<-tempfile(), "\"string with no closing quote nor newline")
  > p <- withOption(list(keep.source=FALSE), parse(tf))
  > p
  expression("string with no closing quote nor newline\n")

It does complain when parsing a character string with the same problem.
  > p <- withOption(list(keep.source=FALSE), parse(text="\"unfinished string"))
  Error in parse(text = "\"unfinished string") :
    2:0: unexpected end of input
  1: "unfinished string
    ^

Bill Dunlap
Spotfire, TIBCO Software
wdunlap tibco.com 


From murdoch.duncan at gmail.com  Fri Sep  2 02:30:19 2011
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Thu, 01 Sep 2011 20:30:19 -0400
Subject: [Rd] "\088" is legal syntax?
In-Reply-To: <E66794E69CFDE04D9A70842786030B9304EE3E@PA-MBX04.na.tibco.com>
References: <E66794E69CFDE04D9A70842786030B9304EE3E@PA-MBX04.na.tibco.com>
Message-ID: <4E60239B.8070105@gmail.com>

On 11-09-01 5:43 PM, William Dunlap wrote:
> Is it intentional that the digit 8 is allowed
> in octal escape sequences in character literals?
>
>    >  "\110" == "\088"
>    [1] TRUE
>    >  "\8" == "\b"
>    [1] TRUE
>
> 9's are rejected, so I'd expected 8's to be illegal as well.

It is documented that way in the R-lang manual, but I imagine it's just 
a thinko.  It's been like that since octal escapes were added in 1998. 
I wonder how much will break if I fix it?

Duncan Murdoch

>
>    >  "\9"
>    Error: '\9' is an unrecognized escape in character string starting "\9"
>    >  "\091")
>    Error: embedded nul in string: '\091'
>
> Bill Dunlap
> Spotfire, TIBCO Software
> wdunlap tibco.com
>
>> sessionInfo()
> R version 2.13.1 (2011-07-08)
> Platform: x86_64-unknown-linux-gnu (64-bit)
>
> locale:
>   [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
>   [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
>   [5] LC_MONETARY=C              LC_MESSAGES=en_US.UTF-8
>   [7] LC_PAPER=en_US.UTF-8       LC_NAME=C
>   [9] LC_ADDRESS=C               LC_TELEPHONE=C
> [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From wdunlap at tibco.com  Fri Sep  2 02:47:33 2011
From: wdunlap at tibco.com (William Dunlap)
Date: Fri, 2 Sep 2011 00:47:33 +0000
Subject: [Rd] "\088" is legal syntax?
In-Reply-To: <4E60239B.8070105@gmail.com>
References: <E66794E69CFDE04D9A70842786030B9304EE3E@PA-MBX04.na.tibco.com>
	<4E60239B.8070105@gmail.com>
Message-ID: <E66794E69CFDE04D9A70842786030B9304F703@PA-MBX04.na.tibco.com>

The CRAN package svMisc misuses it, using "\8" instead of "\10" or "\b":
 ./svMisc/R/progress.R:          backspaces <- paste(rep("\8", l3), collapse = "")

I noticed it when S+ emitted a warning when parsing that file:
  > p <- parse("svMisc/R/progress.R")
  Warning messages:
    The initial backslash is ignored in \8 -- not a recognized escape sequence.
          Use \\ to make a backslash in: parse("svMisc/R/progress.R")
(S+ parses the "\8" as "8", as the warning obliquly implies.)

I grepped through other CRAN sources for "\\0*8" and also found
  ./mvbutils/R/mvbutils.R:  rep.percent <- '\008'
S+ emits no warning for that but parses it as "", because it
considers the octal escape to stop at the first non-octal digit.

Bill Dunlap
Spotfire, TIBCO Software
wdunlap tibco.com 

> -----Original Message-----
> From: Duncan Murdoch [mailto:murdoch.duncan at gmail.com]
> Sent: Thursday, September 01, 2011 5:30 PM
> To: William Dunlap
> Cc: r-devel at r-project.org
> Subject: Re: [Rd] "\088" is legal syntax?
> 
> On 11-09-01 5:43 PM, William Dunlap wrote:
> > Is it intentional that the digit 8 is allowed
> > in octal escape sequences in character literals?
> >
> >    >  "\110" == "\088"
> >    [1] TRUE
> >    >  "\8" == "\b"
> >    [1] TRUE
> >
> > 9's are rejected, so I'd expected 8's to be illegal as well.
> 
> It is documented that way in the R-lang manual, but I imagine it's just
> a thinko.  It's been like that since octal escapes were added in 1998.
> I wonder how much will break if I fix it?
> 
> Duncan Murdoch
> 
> >
> >    >  "\9"
> >    Error: '\9' is an unrecognized escape in character string starting "\9"
> >    >  "\091")
> >    Error: embedded nul in string: '\091'
> >
> > Bill Dunlap
> > Spotfire, TIBCO Software
> > wdunlap tibco.com
> >
> >> sessionInfo()
> > R version 2.13.1 (2011-07-08)
> > Platform: x86_64-unknown-linux-gnu (64-bit)
> >
> > locale:
> >   [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
> >   [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
> >   [5] LC_MONETARY=C              LC_MESSAGES=en_US.UTF-8
> >   [7] LC_PAPER=en_US.UTF-8       LC_NAME=C
> >   [9] LC_ADDRESS=C               LC_TELEPHONE=C
> > [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
> >
> > attached base packages:
> > [1] stats     graphics  grDevices utils     datasets  methods   base
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel


From murdoch.duncan at gmail.com  Fri Sep  2 02:55:38 2011
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Thu, 01 Sep 2011 20:55:38 -0400
Subject: [Rd] "\088" is legal syntax?
In-Reply-To: <E66794E69CFDE04D9A70842786030B9304F703@PA-MBX04.na.tibco.com>
References: <E66794E69CFDE04D9A70842786030B9304EE3E@PA-MBX04.na.tibco.com>
	<4E60239B.8070105@gmail.com>
	<E66794E69CFDE04D9A70842786030B9304F703@PA-MBX04.na.tibco.com>
Message-ID: <4E60298A.2060100@gmail.com>

On 11-09-01 8:47 PM, William Dunlap wrote:
> The CRAN package svMisc misuses it, using "\8" instead of "\10" or "\b":
>   ./svMisc/R/progress.R:          backspaces<- paste(rep("\8", l3), collapse = "")
>
> I noticed it when S+ emitted a warning when parsing that file:
>    >  p<- parse("svMisc/R/progress.R")
>    Warning messages:
>      The initial backslash is ignored in \8 -- not a recognized escape sequence.
>            Use \\ to make a backslash in: parse("svMisc/R/progress.R")
> (S+ parses the "\8" as "8", as the warning obliquly implies.)
>
> I grepped through other CRAN sources for "\\0*8" and also found

I don't have the CRAN sources installed here so I can't check myself, 
but grepping for \\[0-7]*8 might find other instances.  The parser would 
accept an 8 in any position.

Duncan

>    ./mvbutils/R/mvbutils.R:  rep.percent<- '\008'
> S+ emits no warning for that but parses it as "", because it
> considers the octal escape to stop at the first non-octal digit.


> Bill Dunlap
> Spotfire, TIBCO Software
> wdunlap tibco.com
>
>> -----Original Message-----
>> From: Duncan Murdoch [mailto:murdoch.duncan at gmail.com]
>> Sent: Thursday, September 01, 2011 5:30 PM
>> To: William Dunlap
>> Cc: r-devel at r-project.org
>> Subject: Re: [Rd] "\088" is legal syntax?
>>
>> On 11-09-01 5:43 PM, William Dunlap wrote:
>>> Is it intentional that the digit 8 is allowed
>>> in octal escape sequences in character literals?
>>>
>>>     >   "\110" == "\088"
>>>     [1] TRUE
>>>     >   "\8" == "\b"
>>>     [1] TRUE
>>>
>>> 9's are rejected, so I'd expected 8's to be illegal as well.
>>
>> It is documented that way in the R-lang manual, but I imagine it's just
>> a thinko.  It's been like that since octal escapes were added in 1998.
>> I wonder how much will break if I fix it?
>>
>> Duncan Murdoch
>>
>>>
>>>     >   "\9"
>>>     Error: '\9' is an unrecognized escape in character string starting "\9"
>>>     >   "\091")
>>>     Error: embedded nul in string: '\091'
>>>
>>> Bill Dunlap
>>> Spotfire, TIBCO Software
>>> wdunlap tibco.com
>>>
>>>> sessionInfo()
>>> R version 2.13.1 (2011-07-08)
>>> Platform: x86_64-unknown-linux-gnu (64-bit)
>>>
>>> locale:
>>>    [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
>>>    [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
>>>    [5] LC_MONETARY=C              LC_MESSAGES=en_US.UTF-8
>>>    [7] LC_PAPER=en_US.UTF-8       LC_NAME=C
>>>    [9] LC_ADDRESS=C               LC_TELEPHONE=C
>>> [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
>>>
>>> attached base packages:
>>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From wdunlap at tibco.com  Fri Sep  2 02:56:48 2011
From: wdunlap at tibco.com (William Dunlap)
Date: Fri, 2 Sep 2011 00:56:48 +0000
Subject: [Rd] "\088" is legal syntax?
In-Reply-To: <E66794E69CFDE04D9A70842786030B9304F703@PA-MBX04.na.tibco.com>
References: <E66794E69CFDE04D9A70842786030B9304EE3E@PA-MBX04.na.tibco.com>
	<4E60239B.8070105@gmail.com>
	<E66794E69CFDE04D9A70842786030B9304F703@PA-MBX04.na.tibco.com>
Message-ID: <E66794E69CFDE04D9A70842786030B9304F720@PA-MBX04.na.tibco.com>

Also, the relax package in CRAN uses "\283" instead of "\303"
in many places:

./relax/R/relax.R:    pc<-eval(parse(text='"\\283"'))  # UTF-8-pre-char
./relax/R/weaveRhtml.R:      pc<-eval(parse(text='"\\283"'))  # UTF-8-pre-char
./relax/R/weaveRhtml.R:      input<-gsub("\283\237","&szlig;",input)
./relax/R/weaveRhtml.R:      input<-gsub("(\283\244|\283\266|\283\274|\283\204|\283\226|\283\234)",
./relax/R/weaveRhtml.R:      input<-chartr("\283\244\283\266\283\274\283\204\283\226\283\234",
./relax/R/weaveR.R:      pc<-eval(parse(text='"\\283"'))  # UTF-8-pre-char
./relax/R/weaveR.R:    input<-gsub("\283\237","{\\\\ss}",input)
./relax/R/weaveR.R:    input<-gsub("(\283\244|\283\266|\283\274|\283\204|\283\226|\283\234)",
./relax/R/weaveR.R:    input<-chartr("\283\244\283\266\283\274\283\204\283\226\283\234",
./relax/R/weaveR.R:        # pc<-eval(parse(text='"\\283"'))  # UTF-8-pre-char
./relax/R/weaveR.R:             '"\\283\\244\\283\\266\\283\\274\\283\\204\\283\\226\\283\\234\\283\\237"'))


Bill Dunlap
Spotfire, TIBCO Software
wdunlap tibco.com 

> -----Original Message-----
> From: r-devel-bounces at r-project.org [mailto:r-devel-bounces at r-project.org] On Behalf Of William Dunlap
> Sent: Thursday, September 01, 2011 5:48 PM
> To: Duncan Murdoch
> Cc: r-devel at r-project.org
> Subject: Re: [Rd] "\088" is legal syntax?
> 
> The CRAN package svMisc misuses it, using "\8" instead of "\10" or "\b":
>  ./svMisc/R/progress.R:          backspaces <- paste(rep("\8", l3), collapse = "")
> 
> I noticed it when S+ emitted a warning when parsing that file:
>   > p <- parse("svMisc/R/progress.R")
>   Warning messages:
>     The initial backslash is ignored in \8 -- not a recognized escape sequence.
>           Use \\ to make a backslash in: parse("svMisc/R/progress.R")
> (S+ parses the "\8" as "8", as the warning obliquly implies.)
> 
> I grepped through other CRAN sources for "\\0*8" and also found
>   ./mvbutils/R/mvbutils.R:  rep.percent <- '\008'
> S+ emits no warning for that but parses it as "", because it
> considers the octal escape to stop at the first non-octal digit.
> 
> Bill Dunlap
> Spotfire, TIBCO Software
> wdunlap tibco.com
> 
> > -----Original Message-----
> > From: Duncan Murdoch [mailto:murdoch.duncan at gmail.com]
> > Sent: Thursday, September 01, 2011 5:30 PM
> > To: William Dunlap
> > Cc: r-devel at r-project.org
> > Subject: Re: [Rd] "\088" is legal syntax?
> >
> > On 11-09-01 5:43 PM, William Dunlap wrote:
> > > Is it intentional that the digit 8 is allowed
> > > in octal escape sequences in character literals?
> > >
> > >    >  "\110" == "\088"
> > >    [1] TRUE
> > >    >  "\8" == "\b"
> > >    [1] TRUE
> > >
> > > 9's are rejected, so I'd expected 8's to be illegal as well.
> >
> > It is documented that way in the R-lang manual, but I imagine it's just
> > a thinko.  It's been like that since octal escapes were added in 1998.
> > I wonder how much will break if I fix it?
> >
> > Duncan Murdoch
> >
> > >
> > >    >  "\9"
> > >    Error: '\9' is an unrecognized escape in character string starting "\9"
> > >    >  "\091")
> > >    Error: embedded nul in string: '\091'
> > >
> > > Bill Dunlap
> > > Spotfire, TIBCO Software
> > > wdunlap tibco.com
> > >
> > >> sessionInfo()
> > > R version 2.13.1 (2011-07-08)
> > > Platform: x86_64-unknown-linux-gnu (64-bit)
> > >
> > > locale:
> > >   [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
> > >   [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
> > >   [5] LC_MONETARY=C              LC_MESSAGES=en_US.UTF-8
> > >   [7] LC_PAPER=en_US.UTF-8       LC_NAME=C
> > >   [9] LC_ADDRESS=C               LC_TELEPHONE=C
> > > [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
> > >
> > > attached base packages:
> > > [1] stats     graphics  grDevices utils     datasets  methods   base
> > >
> > > ______________________________________________
> > > R-devel at r-project.org mailing list
> > > https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From murdoch.duncan at gmail.com  Fri Sep  2 13:57:48 2011
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Fri, 02 Sep 2011 07:57:48 -0400
Subject: [Rd] parser does not catch strings without closing quote
In-Reply-To: <E66794E69CFDE04D9A70842786030B9304F690@PA-MBX04.na.tibco.com>
References: <E66794E69CFDE04D9A70842786030B9304F690@PA-MBX04.na.tibco.com>
Message-ID: <4E60C4BC.4020800@gmail.com>

On 11-09-01 6:24 PM, William Dunlap wrote:
> Shouldn't the parser complain about unfinished strings in files?
> It doesn't and will tack on a newline if there isn't one there.
>
>    >  withOption<- function(optionList, expr) {
>    +     oldOption<- options(optionList)
>    +     on.exit(options(oldOption))
>    +     expr
>    + }
>
>    >  cat(file=tf<-tempfile(), "\"string without closing quote\n")
>    >  p<- withOption(list(keep.source=FALSE), parse(tf))
>    >  p
>    expression("string without closing quote\n")
>
>    >  cat(file=tf<-tempfile(), "\"string with no closing quote nor newline")
>    >  p<- withOption(list(keep.source=FALSE), parse(tf))
>    >  p
>    expression("string with no closing quote nor newline\n")
>
> It does complain when parsing a character string with the same problem.
>    >  p<- withOption(list(keep.source=FALSE), parse(text="\"unfinished string"))
>    Error in parse(text = "\"unfinished string") :
>      2:0: unexpected end of input
>    1: "unfinished string
>      ^

I assume this is a bug, but the way the parser handles input is quite a 
mess, so I'm not sure where to fix this.  The obvious place (within the 
parser where it is getting tokens) does not work:  the higher level code 
breaks up input into small pieces, and the parser frequently hits the 
end of a piece (at a newline or semicolon, for example), and signals an 
incomplete parse, which is restarted.

(For others than Bill:  this is necessary because the S language doesn't 
have a clear end of statement marker.  If the parser sees "x + ", it 
tries to get more input to finish the statement.  It's only an error if 
nothing more is there.)

A possibility would be to add a new token "incomplete string", which 
will eventually trigger an error if the restart doesn't complete it.

I'll think about it...

Duncan Murdoch


From wdunlap at tibco.com  Fri Sep  2 17:28:09 2011
From: wdunlap at tibco.com (William Dunlap)
Date: Fri, 2 Sep 2011 15:28:09 +0000
Subject: [Rd] parser does not catch strings without closing quote
In-Reply-To: <4E60C4BC.4020800@gmail.com>
References: <E66794E69CFDE04D9A70842786030B9304F690@PA-MBX04.na.tibco.com>
	<4E60C4BC.4020800@gmail.com>
Message-ID: <E66794E69CFDE04D9A70842786030B9304F8A8@PA-MBX04.na.tibco.com>

By the way, I noticed the problem in R because S+ could not
parse a file in the CRAN package SAPP because it ended with
a garbage line with a quote in it:

  % tail -3 SAPP/data/res2003JUL26.R
  res2003JUL26 <- data.frame(res2003JUL26)
  names(res2003JUL26) <- c("no.", "longitude", "latitude", "magnitude", "time", "depth", "trans.time")
  ")

Bill Dunlap
Spotfire, TIBCO Software
wdunlap tibco.com 

> -----Original Message-----
> From: Duncan Murdoch [mailto:murdoch.duncan at gmail.com]
> Sent: Friday, September 02, 2011 4:58 AM
> To: William Dunlap
> Cc: r-devel at r-project.org
> Subject: Re: [Rd] parser does not catch strings without closing quote
> 
> On 11-09-01 6:24 PM, William Dunlap wrote:
> > Shouldn't the parser complain about unfinished strings in files?
> > It doesn't and will tack on a newline if there isn't one there.
> >
> >    >  withOption<- function(optionList, expr) {
> >    +     oldOption<- options(optionList)
> >    +     on.exit(options(oldOption))
> >    +     expr
> >    + }
> >
> >    >  cat(file=tf<-tempfile(), "\"string without closing quote\n")
> >    >  p<- withOption(list(keep.source=FALSE), parse(tf))
> >    >  p
> >    expression("string without closing quote\n")
> >
> >    >  cat(file=tf<-tempfile(), "\"string with no closing quote nor newline")
> >    >  p<- withOption(list(keep.source=FALSE), parse(tf))
> >    >  p
> >    expression("string with no closing quote nor newline\n")
> >
> > It does complain when parsing a character string with the same problem.
> >    >  p<- withOption(list(keep.source=FALSE), parse(text="\"unfinished string"))
> >    Error in parse(text = "\"unfinished string") :
> >      2:0: unexpected end of input
> >    1: "unfinished string
> >      ^
> 
> I assume this is a bug, but the way the parser handles input is quite a
> mess, so I'm not sure where to fix this.  The obvious place (within the
> parser where it is getting tokens) does not work:  the higher level code
> breaks up input into small pieces, and the parser frequently hits the
> end of a piece (at a newline or semicolon, for example), and signals an
> incomplete parse, which is restarted.
> 
> (For others than Bill:  this is necessary because the S language doesn't
> have a clear end of statement marker.  If the parser sees "x + ", it
> tries to get more input to finish the statement.  It's only an error if
> nothing more is there.)
> 
> A possibility would be to add a new token "incomplete string", which
> will eventually trigger an error if the restart doesn't complete it.
> 
> I'll think about it...
> 
> Duncan Murdoch


From murdoch.duncan at gmail.com  Fri Sep  2 17:33:10 2011
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Fri, 02 Sep 2011 11:33:10 -0400
Subject: [Rd] parser does not catch strings without closing quote
In-Reply-To: <E66794E69CFDE04D9A70842786030B9304F8A8@PA-MBX04.na.tibco.com>
References: <E66794E69CFDE04D9A70842786030B9304F690@PA-MBX04.na.tibco.com>
	<4E60C4BC.4020800@gmail.com>
	<E66794E69CFDE04D9A70842786030B9304F8A8@PA-MBX04.na.tibco.com>
Message-ID: <4E60F736.1060705@gmail.com>

On 02/09/2011 11:28 AM, William Dunlap wrote:
> By the way, I noticed the problem in R because S+ could not
> parse a file in the CRAN package SAPP because it ended with
> a garbage line with a quote in it:
>
>    % tail -3 SAPP/data/res2003JUL26.R
>    res2003JUL26<- data.frame(res2003JUL26)
>    names(res2003JUL26)<- c("no.", "longitude", "latitude", "magnitude", "time", "depth", "trans.time")
>    ")

Thanks.  I tried adding the new token type, and it seems to work, and to 
give reasonably intelligible error messages.  So I'll probably commit 
that, as well as the octal upper limit change.

Duncan

> Bill Dunlap
> Spotfire, TIBCO Software
> wdunlap tibco.com
>
> >  -----Original Message-----
> >  From: Duncan Murdoch [mailto:murdoch.duncan at gmail.com]
> >  Sent: Friday, September 02, 2011 4:58 AM
> >  To: William Dunlap
> >  Cc: r-devel at r-project.org
> >  Subject: Re: [Rd] parser does not catch strings without closing quote
> >
> >  On 11-09-01 6:24 PM, William Dunlap wrote:
> >  >  Shouldn't the parser complain about unfinished strings in files?
> >  >  It doesn't and will tack on a newline if there isn't one there.
> >  >
> >  >     >   withOption<- function(optionList, expr) {
> >  >     +     oldOption<- options(optionList)
> >  >     +     on.exit(options(oldOption))
> >  >     +     expr
> >  >     + }
> >  >
> >  >     >   cat(file=tf<-tempfile(), "\"string without closing quote\n")
> >  >     >   p<- withOption(list(keep.source=FALSE), parse(tf))
> >  >     >   p
> >  >     expression("string without closing quote\n")
> >  >
> >  >     >   cat(file=tf<-tempfile(), "\"string with no closing quote nor newline")
> >  >     >   p<- withOption(list(keep.source=FALSE), parse(tf))
> >  >     >   p
> >  >     expression("string with no closing quote nor newline\n")
> >  >
> >  >  It does complain when parsing a character string with the same problem.
> >  >     >   p<- withOption(list(keep.source=FALSE), parse(text="\"unfinished string"))
> >  >     Error in parse(text = "\"unfinished string") :
> >  >       2:0: unexpected end of input
> >  >     1: "unfinished string
> >  >       ^
> >
> >  I assume this is a bug, but the way the parser handles input is quite a
> >  mess, so I'm not sure where to fix this.  The obvious place (within the
> >  parser where it is getting tokens) does not work:  the higher level code
> >  breaks up input into small pieces, and the parser frequently hits the
> >  end of a piece (at a newline or semicolon, for example), and signals an
> >  incomplete parse, which is restarted.
> >
> >  (For others than Bill:  this is necessary because the S language doesn't
> >  have a clear end of statement marker.  If the parser sees "x + ", it
> >  tries to get more input to finish the statement.  It's only an error if
> >  nothing more is there.)
> >
> >  A possibility would be to add a new token "incomplete string", which
> >  will eventually trigger an error if the restart doesn't complete it.
> >
> >  I'll think about it...
> >
> >  Duncan Murdoch


From descostes at ciml.univ-mrs.fr  Sat Sep  3 17:17:03 2011
From: descostes at ciml.univ-mrs.fr (Nico902)
Date: Sat, 3 Sep 2011 08:17:03 -0700 (PDT)
Subject: [Rd] mclust: modelNames("E") vs modelNames=("V")
Message-ID: <1315063023253-3787982.post@n4.nabble.com>

Hi,

I'm trying to use the library mclust for gaussian mixture on a numeric
vector. The function Mclust(data,G=3) is working fine but the fitting is not
optimal and is using modelNames="E". When I'm trying
Mclust(data,G=3,modelName="V") I have the following message:

Error in if (Sumry$G > 1) ans[c(orderedNames, "z")] else ans[orderedNames] : 
  argument is of length zero
In addition: Warning message:
In pickBIC(object[as.character(G), modelNames, drop = FALSE], k = 3) :
  none of the selected models could be fitted


Using variable variance would fit my data better, any idea how to do it?

Thanks a lot.

--
View this message in context: http://r.789695.n4.nabble.com/mclust-modelNames-E-vs-modelNames-V-tp3787982p3787982.html
Sent from the R devel mailing list archive at Nabble.com.


From brian at braverock.com  Sun Sep  4 00:27:13 2011
From: brian at braverock.com (Brian G. Peterson)
Date: Sat, 03 Sep 2011 17:27:13 -0500
Subject: [Rd] mclust: modelNames("E") vs modelNames=("V")
In-Reply-To: <1315063023253-3787982.post@n4.nabble.com>
References: <1315063023253-3787982.post@n4.nabble.com>
Message-ID: <1315088833.4192.31.camel@brian-desktop>

On Sat, 2011-09-03 at 08:17 -0700, Nico902 wrote:
> I'm trying to use the library mclust for gaussian mixture on a numeric
> vector. The function Mclust(data,G=3) is working fine but the fitting is not
> optimal and is using modelNames="E". When I'm trying
> Mclust(data,G=3,modelName="V") I have the following message:
> 
> Error in if (Sumry$G > 1) ans[c(orderedNames, "z")] else ans[orderedNames] : 
>   argument is of length zero
> In addition: Warning message:
> In pickBIC(object[as.character(G), modelNames, drop = FALSE], k = 3) :
>   none of the selected models could be fitted
> 
> Using variable variance would fit my data better, any idea how to do it?

This list is for issues related to the development of the R language
itself.  Wouldn't the r-help list be a more appropriate place to ask for
assistance?

Regards,

   - Brian

-- 
Brian G. Peterson
http://braverock.com/brian/
Ph: 773-459-4973
IM: bgpbraverock


From descostes at ciml.univ-mrs.fr  Sun Sep  4 14:10:48 2011
From: descostes at ciml.univ-mrs.fr (Nico902)
Date: Sun, 4 Sep 2011 05:10:48 -0700 (PDT)
Subject: [Rd] mclust: modelNames("E") vs modelNames=("V")
In-Reply-To: <1315088833.4192.31.camel@brian-desktop>
References: <1315063023253-3787982.post@n4.nabble.com>
	<1315088833.4192.31.camel@brian-desktop>
Message-ID: <1315138248714-3789154.post@n4.nabble.com>

sorry about that and thanks for your answer.

--
View this message in context: http://r.789695.n4.nabble.com/mclust-modelNames-E-vs-modelNames-V-tp3787982p3789154.html
Sent from the R devel mailing list archive at Nabble.com.


From hankin.robin at gmail.com  Tue Sep  6 06:12:01 2011
From: hankin.robin at gmail.com (robin hankin)
Date: Tue, 6 Sep 2011 16:12:01 +1200
Subject: [Rd] repeatable segfault
Message-ID: <CAHHjBM7Q7T+zuK2w4yr580dOp0wYKR6eXV9oz_DhvnkWVnzM1A@mail.gmail.com>

Hi.  macosx 10.6.8

With R-2.13.1 and also revision 56948 I get the following repeatable segfault:



wt118:~% R --vanilla --quiet
> R.Version()
$platform
[1] "x86_64-apple-darwin9.8.0"

$arch
[1] "x86_64"

$os
[1] "darwin9.8.0"

$system
[1] "x86_64, darwin9.8.0"

$status
[1] ""

$major
[1] "2"

$minor
[1] "13.1"

$year
[1] "2011"

$month
[1] "07"

$day
[1] "08"

$`svn rev`
[1] "56322"

$language
[1] "R"

$version.string
[1] "R version 2.13.1 (2011-07-08)"

> eigen(crossprod(matrix(1:2000, 50)) + (0+0i), T, T)

 *** caught segfault ***
address 0x1038000a8, cause 'memory not mapped'

Traceback:
 1: .Call("La_rs_cmplx", x, only.values, PACKAGE = "base")
 2: eigen(crossprod(matrix(1:2000, 50)) + (0 + (0+0i)), T, T)

Possible actions:
1: abort (with core dump, if enabled)
2: normal R exit
3: exit R without saving workspace
4: exit R saving workspace
Selection: 2
wt118:~%





-- 
Robin Hankin
Uncertainty Analyst
hankin.robin at gmail.com


From dwinsemius at comcast.net  Tue Sep  6 06:38:13 2011
From: dwinsemius at comcast.net (David Winsemius)
Date: Tue, 6 Sep 2011 00:38:13 -0400
Subject: [Rd] repeatable segfault
In-Reply-To: <CAHHjBM7Q7T+zuK2w4yr580dOp0wYKR6eXV9oz_DhvnkWVnzM1A@mail.gmail.com>
References: <CAHHjBM7Q7T+zuK2w4yr580dOp0wYKR6eXV9oz_DhvnkWVnzM1A@mail.gmail.com>
Message-ID: <F4958E2B-9A75-4C83-A773-A7940C46FA86@comcast.net>

I can reproduce:
eigen(crossprod(matrix(1:2000, 50)) + (0+0i), T, T)

  *** caught segfault ***
address 0x102d0e028, cause 'memory not mapped'

Traceback:
  1: .Call("La_rs_cmplx", x, only.values, PACKAGE = "base")
  2: eigen(crossprod(matrix(1:2000, 50)) + (0 + (0+0i)), T, T)
##---- after restart
 > sessionInfo()
R version 2.13.1 (2011-07-08)
Platform: x86_64-apple-darwin9.8.0/x86_64 (64-bit)

locale:
[1] en_US.UTF-8/en_US.UTF-8/C/C/en_US.UTF-8/en_US.UTF-8

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

With OSX 10.5.8

Also happens with 32 bit R
[R.app GUI 1.41 (5874) i386-apple-darwin9.8.0]


David Winsemius

On Sep 6, 2011, at 12:12 AM, robin hankin wrote:

> Hi.  macosx 10.6.8
>
> With R-2.13.1 and also revision 56948 I get the following repeatable  
> segfault:
>
>
>
> wt118:~% R --vanilla --quiet
>> R.Version()
> $platform
> [1] "x86_64-apple-darwin9.8.0"
>
> $arch
> [1] "x86_64"
>
> $os
> [1] "darwin9.8.0"
>
> $system
> [1] "x86_64, darwin9.8.0"
>
> $status
> [1] ""
>
> $major
> [1] "2"
>
> $minor
> [1] "13.1"
>
> $year
> [1] "2011"
>
> $month
> [1] "07"
>
> $day
> [1] "08"
>
> $`svn rev`
> [1] "56322"
>
> $language
> [1] "R"
>
> $version.string
> [1] "R version 2.13.1 (2011-07-08)"
>
>> eigen(crossprod(matrix(1:2000, 50)) + (0+0i), T, T)
>
> *** caught segfault ***
> address 0x1038000a8, cause 'memory not mapped'
>
> Traceback:
> 1: .Call("La_rs_cmplx", x, only.values, PACKAGE = "base")
> 2: eigen(crossprod(matrix(1:2000, 50)) + (0 + (0+0i)), T, T)
>
> Possible actions:
> 1: abort (with core dump, if enabled)
> 2: normal R exit
> 3: exit R without saving workspace
> 4: exit R saving workspace
> Selection: 2
> wt118:~%
>
>
>
>
>
> -- 
> Robin Hankin
> Uncertainty Analyst
> hankin.robin at gmail.com
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

David Winsemius, MD
Heritage Laboratories
West Hartford, CT


From nick.sabbe at ugent.be  Tue Sep  6 11:49:55 2011
From: nick.sabbe at ugent.be (Nick Sabbe)
Date: Tue, 6 Sep 2011 11:49:55 +0200
Subject: [Rd] do.call and sys.call: suggestion for improval?
Message-ID: <039101cc6c7a$54f31b10$fed95130$@sabbe@ugent.be>

Hi all.

I'll start by introducing the origin of the problem, although it appears to
me that it goes beyond my specific setting.

I'm currently working on a method for finding the 'lowest named function
call' on the call stack. I am aware that the name of a function is not
uniquely defined, but for most reasonable cases, the intended name can be
easily induced.
You can see some of the specific issues here:
http://stackoverflow.com/questions/7307987/logging-current-function-name if
you like.

After some fidgeting and great help by Andrie (see the SO link; sorry I
don't know his last name), it works rather well.

There are, however, issues wrt do.call.
Typical usage would then be: do.call(some.named.function, some.list)
Now, when I look at the stackframe inside this some.named.function (or a
function that is called from it), more or less like this:
funcs <- sapply(2+1:sys.nframe(), function(i) sys.call(sys.parent(n=i))[[1]]
)
I get strange results: contrary to the 'normal' named function calls, I
don't get the function name, but I get back a closure, that is really just
(a copy of) my original some.named.function. On the other hand, the do.call
call itself is _not_ on the stackframe.

The good news is: this makes do.call still reasonably identifiable (I'm
willing to assume this closure returning in sys.call is unique to do.call).
The bad news is, that there is, as of now, no way to retrieve the name of
the function as it was passed to do.call.

So, my questions:
* why is the do.call call itself not on the stackframe? (I could hope to
extract the name there somehow)
* why is the result of sys.call not consistent with normal function calls? I
am aware of the warning in the help for do.call that "the precise semantics
are currently undefined and subject to change", but I was hoping this could
be (easily) altered? I believe it is in the best interest of the R community
that calls through do.call are as close as possible to 'normal' calls, and
this is rather a big difference.
* does anybody have other suggestions on how to obtain the name of the
function in that case? I'm also willing to accept that I may need to change
my own implementation after 'the specific semantics' change somewhere in the
future.

If there is a reason behind the difference (besides something like "it's not
so easy to code that"), I would be very interested in learning about it.
Also, if I have completely misunderstood how things work, I will gladly
accept redirections and/or flames.

Thanks in advance (well, not for potential flames),

Nick Sabbe
--
ping: nick.sabbe at ugent.be
link: http://biomath.ugent.be
wink: A1.056, Coupure Links 653, 9000 Gent
ring: 09/264.59.36

-- Do Not Disapprove


From fincomputing at gmail.com  Tue Sep  6 15:46:27 2011
From: fincomputing at gmail.com (hongxu)
Date: Tue, 6 Sep 2011 21:46:27 +0800
Subject: [Rd] "Error: invalid version specification 2.2" during make
Message-ID: <201109062146227745424@gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20110906/cc51a9a7/attachment.pl>

From wolfgang.viechtbauer at maastrichtuniversity.nl  Tue Sep  6 17:31:18 2011
From: wolfgang.viechtbauer at maastrichtuniversity.nl (Viechtbauer Wolfgang (STAT))
Date: Tue, 6 Sep 2011 17:31:18 +0200
Subject: [Rd] Generic Functions for dffits and covratio
Message-ID: <077E31A57DA26E46AB0D493C9966AC730C359B42E1@UM-MAIL4112.unimaas.nl>

Dear All,

A while back, I asked about the possibility of adding a generic function for dffits to stats:

https://stat.ethz.ch/pipermail/r-devel/2011-May/061011.html

I am still hoping that this would be possible. The same also applies to covratio. Currently, there are no generics for these two functions (while there are generics for cooks.distance, dfbetas, and a few more).

I think it would be more consistent to have generics for dffits and covratio as well. This would only require adding those two generics and turning the current dffits and covatio functions into dffits.default and covratio.default:

dffits <- function(model, ...)
   UseMethod("dffits")

covratio <- function(model, ...)
   UseMethod("covratio")

dffits.default <- function(model, infl = lm.influence(model, do.coef = FALSE), res = weighted.residuals(model), ...) {
    res <- res * sqrt(infl$hat)/(infl$sigma * (1 - infl$hat))
    res[is.infinite(res)] <- NaN
    res
}

covratio.default <- function(model, infl = lm.influence(model, do.coef = FALSE), res = weighted.residuals(model), ...) {
   n <- nrow(qr.lm(model)$qr)
   p <- model$rank
   omh <- 1 - infl$hat
   e.star <- res/(infl$sigma * sqrt(omh))
   e.star[is.infinite(e.star)] <- NaN
   1/(omh * (((n - p - 1) + e.star^2)/(n - p))^p)
}

This would allow package authors to easily add dffits and covratio methods for models other than lm and glm to their package. Making those substitutions above in another package is a bit awkward and of course leads to messages about dffits and covratio being masked.

I hope that there is some interest in this.

Best,

Wolfgang


From marco.atzeri at gmail.com  Tue Sep  6 17:39:52 2011
From: marco.atzeri at gmail.com (Marco atzeri)
Date: Tue, 06 Sep 2011 17:39:52 +0200
Subject: [Rd] libtool FIXME
Message-ID: <4E663EC8.3040309@gmail.com>

Hi,
looking on the build scripts, I noticed on configure.ac

## <FIXME>
## Completely disable using libtool for building shlibs until libtool
## fully supports Fortran and C++.
## AC_ARG_WITH([libtool],
## [AS_HELP_STRING([--with-libtool],[use libtool for building shared 
libraries @
<:@yes@:>@])],
## [use_libtool="${withval}"],
## [use_libtool=yes])
## AM_CONDITIONAL(USE_LIBTOOL, [test "x${use_libtool}" = xyes])
## </FIXME>


Is this comment outdated or still valid ?

In my experience, Octave, that is mainly Fortran and C++ plus a small
amount of C, is fully employing libtool and automake with a very clean
and lean build system.

My question is not just academic; I was thinking to package
R for cygwin but the current configuration produce shared libs
with the wrong name

   /usr/bin/libR.dll
   /usr/bin/libRmath.dll

instead of expected

   /usr/bin/cygR.dll
   /usr/bin/cygRmath.dll

(http://cygwin.com/cygwin-ug-net/dll.html#dll-build)
so the "as it is" package will be rejected and a substantial
patching of the various "Makefile.in" will be needed to make
it conformant.


Thanks in advance
Marco


From adele_thompson at cargill.com  Wed Sep  7 21:27:29 2011
From: adele_thompson at cargill.com (Schatzi)
Date: Wed, 7 Sep 2011 12:27:29 -0700 (PDT)
Subject: [Rd] Refresh every minute
Message-ID: <1315423649399-3797011.post@n4.nabble.com>

I would like some code to rerun every minute, automatically (it calls time
and I want this to update). 
Here is the code (it is really the plot that I am interested in): 


hourc<-as.numeric(substr(date(),12,13)) 
minc<-as.numeric(substr(date(),15,16)) 
ftime<-c(hourc,minc) 
barplot(ftime, axes = FALSE, main="Time") 


Is there any way to get this to automatically update every minute or do I
have to rerun it manually each time I want to see the updated plot? 

I am using microsoft (vista). 

-----
In theory, practice and theory are the same. In practice, they are not - Albert Einstein
--
View this message in context: http://r.789695.n4.nabble.com/Refresh-every-minute-tp3797011p3797011.html
Sent from the R devel mailing list archive at Nabble.com.


From simon.urbanek at r-project.org  Wed Sep  7 21:32:30 2011
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Wed, 7 Sep 2011 15:32:30 -0400
Subject: [Rd] Refresh every minute
In-Reply-To: <1315423649399-3797011.post@n4.nabble.com>
References: <1315423649399-3797011.post@n4.nabble.com>
Message-ID: <B4998159-0189-49AE-9C2D-32A43338EE81@r-project.org>


On Sep 7, 2011, at 3:27 PM, Schatzi wrote:

> I would like some code to rerun every minute, automatically (it calls time
> and I want this to update). 
> Here is the code (it is really the plot that I am interested in): 
> 
> 
> hourc<-as.numeric(substr(date(),12,13)) 
> minc<-as.numeric(substr(date(),15,16)) 
> ftime<-c(hourc,minc) 
> barplot(ftime, axes = FALSE, main="Time") 
> 
> 
> Is there any way to get this to automatically update every minute or do I
> have to rerun it manually each time I want to see the updated plot? 
> 

while (TRUE) {
 hourc<-as.numeric(substr(date(),12,13)) 
 minc<-as.numeric(substr(date(),15,16)) 
 ftime<-c(hourc,minc) 
 barplot(ftime, axes = FALSE, main="Time") 
 Sys.sleep(60)
}


> I am using microsoft (vista). 
> 
> -----
> In theory, practice and theory are the same. In practice, they are not - Albert Einstein
> --
> View this message in context: http://r.789695.n4.nabble.com/Refresh-every-minute-tp3797011p3797011.html
> Sent from the R devel mailing list archive at Nabble.com.
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 


From adele_thompson at cargill.com  Wed Sep  7 22:30:08 2011
From: adele_thompson at cargill.com (Schatzi)
Date: Wed, 7 Sep 2011 13:30:08 -0700 (PDT)
Subject: [Rd] Refresh every minute
In-Reply-To: <1315423649399-3797011.post@n4.nabble.com>
References: <1315423649399-3797011.post@n4.nabble.com>
Message-ID: <1315427408388-3797174.post@n4.nabble.com>

That works perfect. Thank you.

On Sep 7, 2011, at 3:27 PM, Schatzi wrote:

> I would like some code to rerun every minute, automatically (it calls 
> time and I want this to update).
> Here is the code (it is really the plot that I am interested in): 
> 
> 
> hourc<-as.numeric(substr(date(),12,13))
> minc<-as.numeric(substr(date(),15,16))
> ftime<-c(hourc,minc)
> barplot(ftime, axes = FALSE, main="Time")
> 
> 
> Is there any way to get this to automatically update every minute or 
> do I have to rerun it manually each time I want to see the updated plot?
> 

while (TRUE) {
 hourc<-as.numeric(substr(date(),12,13))
 minc<-as.numeric(substr(date(),15,16))
 ftime<-c(hourc,minc)
 barplot(ftime, axes = FALSE, main="Time")
 Sys.sleep(60)
}


> I am using microsoft (vista). 


-----
In theory, practice and theory are the same. In practice, they are not - Albert Einstein
--
View this message in context: http://r.789695.n4.nabble.com/Refresh-every-minute-tp3797011p3797174.html
Sent from the R devel mailing list archive at Nabble.com.


From pdalgd at gmail.com  Wed Sep  7 23:10:58 2011
From: pdalgd at gmail.com (peter dalgaard)
Date: Wed, 7 Sep 2011 23:10:58 +0200
Subject: [Rd] Refresh every minute
In-Reply-To: <1315427408388-3797174.post@n4.nabble.com>
References: <1315423649399-3797011.post@n4.nabble.com>
	<1315427408388-3797174.post@n4.nabble.com>
Message-ID: <BB170497-91AA-40E8-B3B4-2AC9745A6E98@gmail.com>


On Sep 7, 2011, at 22:30 , Schatzi wrote:

> That works perfect. Thank you.
> 


Also, for an async solution, try something along these lines

library(tcltk)
f <- function() barplot(rpois(4, lambda=3))
g <- function() {f(); if (run) tcl("after", 4000, g)} # reschedule after 4000 ms
run <- TRUE; g()

To stop it:

run <- FALSE

(With this structure, the time to run f() is added into the interval between invocations. For tighter timing control, reschedule before running f(), but then you'd better be sure it completes in time for the next iteration.)

> On Sep 7, 2011, at 3:27 PM, Schatzi wrote:
> 
>> I would like some code to rerun every minute, automatically (it calls 
>> time and I want this to update).
>> Here is the code (it is really the plot that I am interested in): 
>> 
>> 
>> hourc<-as.numeric(substr(date(),12,13))
>> minc<-as.numeric(substr(date(),15,16))
>> ftime<-c(hourc,minc)
>> barplot(ftime, axes = FALSE, main="Time")
>> 
>> 
>> Is there any way to get this to automatically update every minute or 
>> do I have to rerun it manually each time I want to see the updated plot?
>> 
> 
> while (TRUE) {
> hourc<-as.numeric(substr(date(),12,13))
> minc<-as.numeric(substr(date(),15,16))
> ftime<-c(hourc,minc)
> barplot(ftime, axes = FALSE, main="Time")
> Sys.sleep(60)
> }
> 
> 
>> I am using microsoft (vista). 
> 
> 
> -----
> In theory, practice and theory are the same. In practice, they are not - Albert Einstein
> --
> View this message in context: http://r.789695.n4.nabble.com/Refresh-every-minute-tp3797011p3797174.html
> Sent from the R devel mailing list archive at Nabble.com.
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Peter Dalgaard, Professor,
Center for Statistics, Copenhagen Business School
Solbjerg Plads 3, 2000 Frederiksberg, Denmark
Phone: (+45)38153501
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com
"D?den skal tape!" --- Nordahl Grieg


From adele_thompson at cargill.com  Wed Sep  7 23:51:39 2011
From: adele_thompson at cargill.com (Schatzi)
Date: Wed, 7 Sep 2011 14:51:39 -0700 (PDT)
Subject: [Rd] Refresh every minute
In-Reply-To: <BB170497-91AA-40E8-B3B4-2AC9745A6E98@gmail.com>
References: <1315423649399-3797011.post@n4.nabble.com>
	<1315427408388-3797174.post@n4.nabble.com>
	<BB170497-91AA-40E8-B3B4-2AC9745A6E98@gmail.com>
Message-ID: <3418BB40740A9F4282EE51A8E5B002E80BB8F9574F@MEUSELKG331.Na.Corp.Cargill.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20110907/b94b31bb/attachment.pl>

From maechler at stat.math.ethz.ch  Thu Sep  8 10:01:49 2011
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Thu, 8 Sep 2011 10:01:49 +0200
Subject: [Rd] repeatable segfault - on Mac
In-Reply-To: <F4958E2B-9A75-4C83-A773-A7940C46FA86@comcast.net>
References: <CAHHjBM7Q7T+zuK2w4yr580dOp0wYKR6eXV9oz_DhvnkWVnzM1A@mail.gmail.com>
	<F4958E2B-9A75-4C83-A773-A7940C46FA86@comcast.net>
Message-ID: <20072.30317.130733.348774@stat.math.ethz.ch>

>>>>> David Winsemius <dwinsemius at comcast.net>
>>>>>     on Tue, 6 Sep 2011 00:38:13 -0400 writes:

    > I can reproduce:
    > eigen(crossprod(matrix(1:2000, 50)) + (0+0i), T, T)

    > *** caught segfault ***
    > address 0x102d0e028, cause 'memory not mapped'

    > Traceback:
    > 1: .Call("La_rs_cmplx", x, only.values, PACKAGE = "base")
    > 2: eigen(crossprod(matrix(1:2000, 50)) + (0 + (0+0i)), T, T)
    > ##---- after restart
    >> sessionInfo()
    > R version 2.13.1 (2011-07-08)
    > Platform: x86_64-apple-darwin9.8.0/x86_64 (64-bit)

    > locale:
    > [1] en_US.UTF-8/en_US.UTF-8/C/C/en_US.UTF-8/en_US.UTF-8

    > attached base packages:
    > [1] stats     graphics  grDevices utils     datasets  methods   base

    > With OSX 10.5.8

    > Also happens with 32 bit R
    > [R.app GUI 1.41 (5874) i386-apple-darwin9.8.0]

It does not happen on Linux (different versions) 
nor Windows (2.13.1 patched, early August).

As this is calling LAPACK code,
I guess that this is yet another case where the Mac version
of optimized BLAS / LAPACK is playing wrongly.

Martin Maechler

    > David Winsemius

    > On Sep 6, 2011, at 12:12 AM, robin hankin wrote:

    >> Hi.  macosx 10.6.8
    >> 
    >> With R-2.13.1 and also revision 56948 I get the following repeatable  
    >> segfault:
    >> 
    >> 
    >> 
    >> wt118:~% R --vanilla --quiet
    >>> R.Version()
    >> $platform
    >> [1] "x86_64-apple-darwin9.8.0"
    >> 
    >> $arch
    >> [1] "x86_64"
    >> 
    >> $os
    >> [1] "darwin9.8.0"
    >> 
    >> $system
    >> [1] "x86_64, darwin9.8.0"
    >> 
    >> $status
    >> [1] ""
    >> 
    >> $major
    >> [1] "2"
    >> 
    >> $minor
    >> [1] "13.1"
    >> 
    >> $year
    >> [1] "2011"
    >> 
    >> $month
    >> [1] "07"
    >> 
    >> $day
    >> [1] "08"
    >> 
    >> $`svn rev`
    >> [1] "56322"
    >> 
    >> $language
    >> [1] "R"
    >> 
    >> $version.string
    >> [1] "R version 2.13.1 (2011-07-08)"
    >> 
    >>> eigen(crossprod(matrix(1:2000, 50)) + (0+0i), T, T)
    >> 
    >> *** caught segfault ***
    >> address 0x1038000a8, cause 'memory not mapped'
    >> 
    >> Traceback:
    >> 1: .Call("La_rs_cmplx", x, only.values, PACKAGE = "base")
    >> 2: eigen(crossprod(matrix(1:2000, 50)) + (0 + (0+0i)), T, T)
    >> 
    >> Possible actions:
    >> 1: abort (with core dump, if enabled)
    >> 2: normal R exit
    >> 3: exit R without saving workspace
    >> 4: exit R saving workspace
    >> Selection: 2
    >> wt118:~%
    >> 
    >> 
    >> 
    >> 
    >> 
    >> -- 
    >> Robin Hankin
    >> Uncertainty Analyst
    >> hankin.robin at gmail.com
    >> 
    >> ______________________________________________
    >> R-devel at r-project.org mailing list
    >> https://stat.ethz.ch/mailman/listinfo/r-devel

    > David Winsemius, MD
    > Heritage Laboratories
    > West Hartford, CT

    > ______________________________________________
    > R-devel at r-project.org mailing list
    > https://stat.ethz.ch/mailman/listinfo/r-devel


From pdalgd at gmail.com  Thu Sep  8 13:15:16 2011
From: pdalgd at gmail.com (peter dalgaard)
Date: Thu, 8 Sep 2011 13:15:16 +0200
Subject: [Rd] repeatable segfault - on Mac
In-Reply-To: <20072.30317.130733.348774@stat.math.ethz.ch>
References: <CAHHjBM7Q7T+zuK2w4yr580dOp0wYKR6eXV9oz_DhvnkWVnzM1A@mail.gmail.com>
	<F4958E2B-9A75-4C83-A773-A7940C46FA86@comcast.net>
	<20072.30317.130733.348774@stat.math.ethz.ch>
Message-ID: <BFEB9A7D-387C-42E3-9732-8D5043FB371E@gmail.com>


On Sep 8, 2011, at 10:01 , Martin Maechler wrote:

>>>>>> David Winsemius <dwinsemius at comcast.net>
>>>>>>    on Tue, 6 Sep 2011 00:38:13 -0400 writes:
> 
>> I can reproduce:
>> eigen(crossprod(matrix(1:2000, 50)) + (0+0i), T, T)
> 
>> *** caught segfault ***
>> address 0x102d0e028, cause 'memory not mapped'
> 
>> Traceback:
>> 1: .Call("La_rs_cmplx", x, only.values, PACKAGE = "base")
>> 2: eigen(crossprod(matrix(1:2000, 50)) + (0 + (0+0i)), T, T)
>> ##---- after restart
>>> sessionInfo()
>> R version 2.13.1 (2011-07-08)
>> Platform: x86_64-apple-darwin9.8.0/x86_64 (64-bit)
> 
>> locale:
>> [1] en_US.UTF-8/en_US.UTF-8/C/C/en_US.UTF-8/en_US.UTF-8
> 
>> attached base packages:
>> [1] stats     graphics  grDevices utils     datasets  methods   base
> 
>> With OSX 10.5.8
> 
>> Also happens with 32 bit R
>> [R.app GUI 1.41 (5874) i386-apple-darwin9.8.0]
> 
> It does not happen on Linux (different versions) 
> nor Windows (2.13.1 patched, early August).
> 
> As this is calling LAPACK code,
> I guess that this is yet another case where the Mac version
> of optimized BLAS / LAPACK is playing wrongly.

Hmm, it does happen too on OSX (64bit) with a recent R-devel, vanilla compiled with

LAPACK_LIBS='-L$(R_HOME)/lib$(R_ARCH) -lRlapack'

I tried recompiling with -O0, still happening:


Program received signal EXC_BAD_ACCESS, Could not access memory.
Reason: KERN_INVALID_ADDRESS at address: 0x0000000102ddc128
0x000000010046805e in zher2k (uplo=@0x7fff5fbf9b0e, trans=@0x1039fc54b, n=@0x7fff5fbf98cc, k=@0x7fff5fbf98e0, alpha=@0x1039fc528, a=0x102198228, lda=@0x7fff5fbf9b08, b=0x1023abca8, ldb=@0x7fff5fbf98f4, beta=@0x1039fc660, c=0x10219d228, ldc=@0x7fff5fbf9b08, _uplo=1, _trans=12) at ../../../../R/src/extra/blas/cmplxblas.f:1566
1566	                     TEMP1 = ALPHA*DCONJG( B( J, L ) )
(gdb) where
#0  0x000000010046805e in zher2k (uplo=@0x7fff5fbf9b0e, trans=@0x1039fc54b, n=@0x7fff5fbf98cc, k=@0x7fff5fbf98e0, alpha=@0x1039fc528, a=0x102198228, lda=@0x7fff5fbf9b08, b=0x1023abca8, ldb=@0x7fff5fbf98f4, beta=@0x1039fc660, c=0x10219d228, ldc=@0x7fff5fbf9b08, _uplo=1, _trans=12) at ../../../../R/src/extra/blas/cmplxblas.f:1566
#1  0x00000001039939aa in zhetrd (uplo=@0x7fff5fbf9b0e, n=@0x7fff5fbf9b08, a=0x102198028, lda=@0x7fff5fbf9b08, d=0x100597f28, e=0x102e02d58, tau=0x1023ab828, work=0x1023abaa8, lwork=@0x7fff5fbf9a30, info=@0x7fff5fbf9a44, _uplo=1) at ../../../../R/src/modules/lapack/cmplx.f:8841
#2  0x000000010399209e in zheev (jobz=@0x7fff5fbf9b0f, uplo=@0x7fff5fbf9b0e, n=@0x7fff5fbf9b08, a=0x102198028, lda=@0x7fff5fbf9b08, w=0x100597f28, work=0x1023ab828, lwork=@0x7fff5fbf9b04, rwork=0x102e02d58, info=@0x7fff5fbf9b00, _jobz=10096376, _uplo=36013056) at ../../../../R/src/modules/lapack/cmplx.f:8275
#3  0x00000001007f102e in modLa_rs_cmplx (xin=0x102258400, only_values=0x1009a0ef8) at ../../../../R/src/modules/lapack/Lapack.c:776
#4  0x0000000100103baf in La_rs_cmplx (x=0x102258400, only_values=0x1009a0ef8) at ../../../R/src/main/lapack.c:113
#5  0x000000010007a82b in do_dotcall (call=0x1026c62e8, op=0x100864718, args=0x1026d9278, env=0x1026d4278) at ../../../R/src/main/dotcode.c:845
Segmentation fault


(The segfault appears to be gdb itself tripping over)

-pd


> 
> Martin Maechler
> 
>> David Winsemius
> 
>> On Sep 6, 2011, at 12:12 AM, robin hankin wrote:
> 
>>> Hi.  macosx 10.6.8
>>> 
>>> With R-2.13.1 and also revision 56948 I get the following repeatable  
>>> segfault:
>>> 
>>> 
>>> 
>>> wt118:~% R --vanilla --quiet
>>>> R.Version()
>>> $platform
>>> [1] "x86_64-apple-darwin9.8.0"
>>> 
>>> $arch
>>> [1] "x86_64"
>>> 
>>> $os
>>> [1] "darwin9.8.0"
>>> 
>>> $system
>>> [1] "x86_64, darwin9.8.0"
>>> 
>>> $status
>>> [1] ""
>>> 
>>> $major
>>> [1] "2"
>>> 
>>> $minor
>>> [1] "13.1"
>>> 
>>> $year
>>> [1] "2011"
>>> 
>>> $month
>>> [1] "07"
>>> 
>>> $day
>>> [1] "08"
>>> 
>>> $`svn rev`
>>> [1] "56322"
>>> 
>>> $language
>>> [1] "R"
>>> 
>>> $version.string
>>> [1] "R version 2.13.1 (2011-07-08)"
>>> 
>>>> eigen(crossprod(matrix(1:2000, 50)) + (0+0i), T, T)
>>> 
>>> *** caught segfault ***
>>> address 0x1038000a8, cause 'memory not mapped'
>>> 
>>> Traceback:
>>> 1: .Call("La_rs_cmplx", x, only.values, PACKAGE = "base")
>>> 2: eigen(crossprod(matrix(1:2000, 50)) + (0 + (0+0i)), T, T)
>>> 
>>> Possible actions:
>>> 1: abort (with core dump, if enabled)
>>> 2: normal R exit
>>> 3: exit R without saving workspace
>>> 4: exit R saving workspace
>>> Selection: 2
>>> wt118:~%
>>> 
>>> 
>>> 
>>> 
>>> 
>>> -- 
>>> Robin Hankin
>>> Uncertainty Analyst
>>> hankin.robin at gmail.com
>>> 
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
>> David Winsemius, MD
>> Heritage Laboratories
>> West Hartford, CT
> 
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Peter Dalgaard, Professor
Center for Statistics, Copenhagen Business School
Solbjerg Plads 3, 2000 Frederiksberg, Denmark
Phone: (+45)38153501
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From simon.urbanek at r-project.org  Thu Sep  8 15:33:23 2011
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Thu, 8 Sep 2011 09:33:23 -0400
Subject: [Rd] repeatable segfault - on Mac
In-Reply-To: <20072.30317.130733.348774@stat.math.ethz.ch>
References: <CAHHjBM7Q7T+zuK2w4yr580dOp0wYKR6eXV9oz_DhvnkWVnzM1A@mail.gmail.com>
	<F4958E2B-9A75-4C83-A773-A7940C46FA86@comcast.net>
	<20072.30317.130733.348774@stat.math.ethz.ch>
Message-ID: <5A694883-AD7E-420F-B991-8536B87E1C3E@r-project.org>


On Sep 8, 2011, at 4:01 AM, Martin Maechler wrote:

>>>>>> David Winsemius <dwinsemius at comcast.net>
>>>>>>    on Tue, 6 Sep 2011 00:38:13 -0400 writes:
> 
>> I can reproduce:
>> eigen(crossprod(matrix(1:2000, 50)) + (0+0i), T, T)
> 
>> *** caught segfault ***
>> address 0x102d0e028, cause 'memory not mapped'
> 
>> Traceback:
>> 1: .Call("La_rs_cmplx", x, only.values, PACKAGE = "base")
>> 2: eigen(crossprod(matrix(1:2000, 50)) + (0 + (0+0i)), T, T)
>> ##---- after restart
>>> sessionInfo()
>> R version 2.13.1 (2011-07-08)
>> Platform: x86_64-apple-darwin9.8.0/x86_64 (64-bit)
> 
>> locale:
>> [1] en_US.UTF-8/en_US.UTF-8/C/C/en_US.UTF-8/en_US.UTF-8
> 
>> attached base packages:
>> [1] stats     graphics  grDevices utils     datasets  methods   base
> 
>> With OSX 10.5.8
> 
>> Also happens with 32 bit R
>> [R.app GUI 1.41 (5874) i386-apple-darwin9.8.0]
> 
> It does not happen on Linux (different versions) 
> nor Windows (2.13.1 patched, early August).
> 
> As this is calling LAPACK code,
> I guess that this is yet another case where the Mac version
> of optimized BLAS / LAPACK is playing wrongly.
> 

Nope, this is R's BLAS / LAPACK! 


> Martin Maechler
> 
>> David Winsemius
> 
>> On Sep 6, 2011, at 12:12 AM, robin hankin wrote:
> 
>>> Hi.  macosx 10.6.8
>>> 
>>> With R-2.13.1 and also revision 56948 I get the following repeatable  
>>> segfault:
>>> 
>>> 
>>> 
>>> wt118:~% R --vanilla --quiet
>>>> R.Version()
>>> $platform
>>> [1] "x86_64-apple-darwin9.8.0"
>>> 
>>> $arch
>>> [1] "x86_64"
>>> 
>>> $os
>>> [1] "darwin9.8.0"
>>> 
>>> $system
>>> [1] "x86_64, darwin9.8.0"
>>> 
>>> $status
>>> [1] ""
>>> 
>>> $major
>>> [1] "2"
>>> 
>>> $minor
>>> [1] "13.1"
>>> 
>>> $year
>>> [1] "2011"
>>> 
>>> $month
>>> [1] "07"
>>> 
>>> $day
>>> [1] "08"
>>> 
>>> $`svn rev`
>>> [1] "56322"
>>> 
>>> $language
>>> [1] "R"
>>> 
>>> $version.string
>>> [1] "R version 2.13.1 (2011-07-08)"
>>> 
>>>> eigen(crossprod(matrix(1:2000, 50)) + (0+0i), T, T)
>>> 
>>> *** caught segfault ***
>>> address 0x1038000a8, cause 'memory not mapped'
>>> 
>>> Traceback:
>>> 1: .Call("La_rs_cmplx", x, only.values, PACKAGE = "base")
>>> 2: eigen(crossprod(matrix(1:2000, 50)) + (0 + (0+0i)), T, T)
>>> 
>>> Possible actions:
>>> 1: abort (with core dump, if enabled)
>>> 2: normal R exit
>>> 3: exit R without saving workspace
>>> 4: exit R saving workspace
>>> Selection: 2
>>> wt118:~%
>>> 
>>> 
>>> 
>>> 
>>> 
>>> -- 
>>> Robin Hankin
>>> Uncertainty Analyst
>>> hankin.robin at gmail.com
>>> 
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
>> David Winsemius, MD
>> Heritage Laboratories
>> West Hartford, CT
> 
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
>


From maechler at stat.math.ethz.ch  Thu Sep  8 16:27:42 2011
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Thu, 8 Sep 2011 16:27:42 +0200
Subject: [Rd] repeatable segfault - on Mac
In-Reply-To: <5A694883-AD7E-420F-B991-8536B87E1C3E@r-project.org>
References: <CAHHjBM7Q7T+zuK2w4yr580dOp0wYKR6eXV9oz_DhvnkWVnzM1A@mail.gmail.com>
	<F4958E2B-9A75-4C83-A773-A7940C46FA86@comcast.net>
	<20072.30317.130733.348774@stat.math.ethz.ch>
	<5A694883-AD7E-420F-B991-8536B87E1C3E@r-project.org>
Message-ID: <20072.53470.273868.325169@stat.math.ethz.ch>

>>>>> Simon Urbanek <simon.urbanek at r-project.org>
>>>>>     on Thu, 8 Sep 2011 09:33:23 -0400 writes:

    > On Sep 8, 2011, at 4:01 AM, Martin Maechler wrote:

    >>>>>>> David Winsemius <dwinsemius at comcast.net>
    >>>>>>> on Tue, 6 Sep 2011 00:38:13 -0400 writes:
    >> 
    >>> I can reproduce:
    >>> eigen(crossprod(matrix(1:2000, 50)) + (0+0i), T, T)
    >> 
    >>> *** caught segfault ***
    >>> address 0x102d0e028, cause 'memory not mapped'
    >> 
    >>> Traceback:
    >>> 1: .Call("La_rs_cmplx", x, only.values, PACKAGE = "base")
    >>> 2: eigen(crossprod(matrix(1:2000, 50)) + (0 + (0+0i)), T, T)
    >>> ##---- after restart
    >>>> sessionInfo()
    >>> R version 2.13.1 (2011-07-08)
    >>> Platform: x86_64-apple-darwin9.8.0/x86_64 (64-bit)
    >> 
    >>> locale:
    >>> [1] en_US.UTF-8/en_US.UTF-8/C/C/en_US.UTF-8/en_US.UTF-8
    >> 
    >>> attached base packages:
    >>> [1] stats     graphics  grDevices utils     datasets  methods   base
    >> 
    >>> With OSX 10.5.8
    >> 
    >>> Also happens with 32 bit R
    >>> [R.app GUI 1.41 (5874) i386-apple-darwin9.8.0]
    >> 
    >> It does not happen on Linux (different versions) 
    >> nor Windows (2.13.1 patched, early August).
    >> 
    >> As this is calling LAPACK code,
    >> I guess that this is yet another case where the Mac version
    >> of optimized BLAS / LAPACK is playing wrongly.
    >> 

    > Nope, this is R's BLAS / LAPACK! 

yes, it seems, as Peter is confirming as well.

*BUT* as far as we currently know, the problem was never seen 
outside of MacOS X , right?

Martin Maechler

    >>> David Winsemius
    >> 
    >>> On Sep 6, 2011, at 12:12 AM, robin hankin wrote:
    >> 
    >>>> Hi.  macosx 10.6.8
    >>>> 
    >>>> With R-2.13.1 and also revision 56948 I get the following repeatable
    >>>> segfault:
    >>>> 
    >>>> 
    >>>> 
    >>>> wt118:~% R --vanilla --quiet
    >>>>> R.Version()
    >>>> $platform
    >>>> [1] "x86_64-apple-darwin9.8.0"
    >>>> 
    >>>> $arch
    >>>> [1] "x86_64"
    >>>> 
    >>>> $os
    >>>> [1] "darwin9.8.0"
    >>>> 
    >>>> $system
    >>>> [1] "x86_64, darwin9.8.0"
    >>>> 
    >>>> $status
    >>>> [1] ""
    >>>> 
    >>>> $major
    >>>> [1] "2"
    >>>> 
    >>>> $minor
    >>>> [1] "13.1"
    >>>> 
    >>>> $year
    >>>> [1] "2011"
    >>>> 
    >>>> $month
    >>>> [1] "07"
    >>>> 
    >>>> $day
    >>>> [1] "08"
    >>>> 
    >>>> $`svn rev`
    >>>> [1] "56322"
    >>>> 
    >>>> $language
    >>>> [1] "R"
    >>>> 
    >>>> $version.string
    >>>> [1] "R version 2.13.1 (2011-07-08)"
    >>>> 
    >>>>> eigen(crossprod(matrix(1:2000, 50)) + (0+0i), T, T)
    >>>> 
    >>>> *** caught segfault ***
    >>>> address 0x1038000a8, cause 'memory not mapped'
    >>>> 
    >>>> Traceback:
    >>>> 1: .Call("La_rs_cmplx", x, only.values, PACKAGE = "base")
    >>>> 2: eigen(crossprod(matrix(1:2000, 50)) + (0 + (0+0i)), T, T)
    >>>> 
    >>>> Possible actions:
    >>>> 1: abort (with core dump, if enabled)
    >>>> 2: normal R exit
    >>>> 3: exit R without saving workspace
    >>>> 4: exit R saving workspace
    >>>> Selection: 2
    >>>> wt118:~%
    >>>> 
    >>>> 
    >>>> 
    >>>> 
    >>>> 
    >>>> -- 
    >>>> Robin Hankin
    >>>> Uncertainty Analyst
    >>>> hankin.robin at gmail.com
    >>>> 
    >>>> ______________________________________________
    >>>> R-devel at r-project.org mailing list
    >>>> https://stat.ethz.ch/mailman/listinfo/r-devel
    >> 
    >>> David Winsemius, MD
    >>> Heritage Laboratories
    >>> West Hartford, CT
    >> 
    >>> ______________________________________________
    >>> R-devel at r-project.org mailing list
    >>> https://stat.ethz.ch/mailman/listinfo/r-devel
    >> 
    >> ______________________________________________
    >> R-devel at r-project.org mailing list
    >> https://stat.ethz.ch/mailman/listinfo/r-devel
    >> 
    >>


From luke-tierney at uiowa.edu  Thu Sep  8 17:00:07 2011
From: luke-tierney at uiowa.edu (luke-tierney at uiowa.edu)
Date: Thu, 8 Sep 2011 10:00:07 -0500
Subject: [Rd] repeatable segfault - on Mac
In-Reply-To: <20072.53470.273868.325169@stat.math.ethz.ch>
References: <CAHHjBM7Q7T+zuK2w4yr580dOp0wYKR6eXV9oz_DhvnkWVnzM1A@mail.gmail.com>
	<F4958E2B-9A75-4C83-A773-A7940C46FA86@comcast.net>
	<20072.30317.130733.348774@stat.math.ethz.ch>
	<5A694883-AD7E-420F-B991-8536B87E1C3E@r-project.org>
	<20072.53470.273868.325169@stat.math.ethz.ch>
Message-ID: <alpine.LFD.2.02.1109080956390.16672@nokomis.stat.uiowa.edu>

On Thu, 8 Sep 2011, Martin Maechler wrote:

>>>>>> Simon Urbanek <simon.urbanek at r-project.org>
>>>>>>     on Thu, 8 Sep 2011 09:33:23 -0400 writes:
>
>    > On Sep 8, 2011, at 4:01 AM, Martin Maechler wrote:
>
>    >>>>>>> David Winsemius <dwinsemius at comcast.net>
>    >>>>>>> on Tue, 6 Sep 2011 00:38:13 -0400 writes:
>    >>
>    >>> I can reproduce:
>    >>> eigen(crossprod(matrix(1:2000, 50)) + (0+0i), T, T)
>    >>
>    >>> *** caught segfault ***
>    >>> address 0x102d0e028, cause 'memory not mapped'
>    >>
>    >>> Traceback:
>    >>> 1: .Call("La_rs_cmplx", x, only.values, PACKAGE = "base")
>    >>> 2: eigen(crossprod(matrix(1:2000, 50)) + (0 + (0+0i)), T, T)
>    >>> ##---- after restart
>    >>>> sessionInfo()
>    >>> R version 2.13.1 (2011-07-08)
>    >>> Platform: x86_64-apple-darwin9.8.0/x86_64 (64-bit)
>    >>
>    >>> locale:
>    >>> [1] en_US.UTF-8/en_US.UTF-8/C/C/en_US.UTF-8/en_US.UTF-8
>    >>
>    >>> attached base packages:
>    >>> [1] stats     graphics  grDevices utils     datasets  methods   base
>    >>
>    >>> With OSX 10.5.8
>    >>
>    >>> Also happens with 32 bit R
>    >>> [R.app GUI 1.41 (5874) i386-apple-darwin9.8.0]
>    >>
>    >> It does not happen on Linux (different versions)
>    >> nor Windows (2.13.1 patched, early August).
>    >>
>    >> As this is calling LAPACK code,
>    >> I guess that this is yet another case where the Mac version
>    >> of optimized BLAS / LAPACK is playing wrongly.
>    >>
>
>    > Nope, this is R's BLAS / LAPACK!
>
> yes, it seems, as Peter is confirming as well.
>
> *BUT* as far as we currently know, the problem was never seen
> outside of MacOS X , right?
>

My experience is that the Mac OS malloc is less forgiving of writing
outside allocated memory than the one usually used on Linux, so some
things show up only on macs or are easier to trigger on macs even
though the problems exist else where as well. Valgrind probably makes
up for that most of the time but maybe not always.

Best,

luke


> Martin Maechler
>
>    >>> David Winsemius
>    >>
>    >>> On Sep 6, 2011, at 12:12 AM, robin hankin wrote:
>    >>
>    >>>> Hi.  macosx 10.6.8
>    >>>>
>    >>>> With R-2.13.1 and also revision 56948 I get the following repeatable
>    >>>> segfault:
>    >>>>
>    >>>>
>    >>>>
>    >>>> wt118:~% R --vanilla --quiet
>    >>>>> R.Version()
>    >>>> $platform
>    >>>> [1] "x86_64-apple-darwin9.8.0"
>    >>>>
>    >>>> $arch
>    >>>> [1] "x86_64"
>    >>>>
>    >>>> $os
>    >>>> [1] "darwin9.8.0"
>    >>>>
>    >>>> $system
>    >>>> [1] "x86_64, darwin9.8.0"
>    >>>>
>    >>>> $status
>    >>>> [1] ""
>    >>>>
>    >>>> $major
>    >>>> [1] "2"
>    >>>>
>    >>>> $minor
>    >>>> [1] "13.1"
>    >>>>
>    >>>> $year
>    >>>> [1] "2011"
>    >>>>
>    >>>> $month
>    >>>> [1] "07"
>    >>>>
>    >>>> $day
>    >>>> [1] "08"
>    >>>>
>    >>>> $`svn rev`
>    >>>> [1] "56322"
>    >>>>
>    >>>> $language
>    >>>> [1] "R"
>    >>>>
>    >>>> $version.string
>    >>>> [1] "R version 2.13.1 (2011-07-08)"
>    >>>>
>    >>>>> eigen(crossprod(matrix(1:2000, 50)) + (0+0i), T, T)
>    >>>>
>    >>>> *** caught segfault ***
>    >>>> address 0x1038000a8, cause 'memory not mapped'
>    >>>>
>    >>>> Traceback:
>    >>>> 1: .Call("La_rs_cmplx", x, only.values, PACKAGE = "base")
>    >>>> 2: eigen(crossprod(matrix(1:2000, 50)) + (0 + (0+0i)), T, T)
>    >>>>
>    >>>> Possible actions:
>    >>>> 1: abort (with core dump, if enabled)
>    >>>> 2: normal R exit
>    >>>> 3: exit R without saving workspace
>    >>>> 4: exit R saving workspace
>    >>>> Selection: 2
>    >>>> wt118:~%
>    >>>>
>    >>>>
>    >>>>
>    >>>>
>    >>>>
>    >>>> --
>    >>>> Robin Hankin
>    >>>> Uncertainty Analyst
>    >>>> hankin.robin at gmail.com
>    >>>>
>    >>>> ______________________________________________
>    >>>> R-devel at r-project.org mailing list
>    >>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>    >>
>    >>> David Winsemius, MD
>    >>> Heritage Laboratories
>    >>> West Hartford, CT
>    >>
>    >>> ______________________________________________
>    >>> R-devel at r-project.org mailing list
>    >>> https://stat.ethz.ch/mailman/listinfo/r-devel
>    >>
>    >> ______________________________________________
>    >> R-devel at r-project.org mailing list
>    >> https://stat.ethz.ch/mailman/listinfo/r-devel
>    >>
>    >>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Luke Tierney
Chair, Statistics and Actuarial Science
Ralph E. Wareham Professor of Mathematical Sciences
University of Iowa                  Phone:             319-335-3386
Department of Statistics and        Fax:               319-335-3017
    Actuarial Science
241 Schaeffer Hall                  email:      luke at stat.uiowa.edu
Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu


From robjgoedman at me.com  Thu Sep  8 17:31:41 2011
From: robjgoedman at me.com (Rob Goedman)
Date: Thu, 08 Sep 2011 08:31:41 -0700
Subject: [Rd] repeatable segfault - on Mac
In-Reply-To: <alpine.LFD.2.02.1109080956390.16672@nokomis.stat.uiowa.edu>
References: <CAHHjBM7Q7T+zuK2w4yr580dOp0wYKR6eXV9oz_DhvnkWVnzM1A@mail.gmail.com>
	<F4958E2B-9A75-4C83-A773-A7940C46FA86@comcast.net>
	<20072.30317.130733.348774@stat.math.ethz.ch>
	<5A694883-AD7E-420F-B991-8536B87E1C3E@r-project.org>
	<20072.53470.273868.325169@stat.math.ethz.ch>
	<alpine.LFD.2.02.1109080956390.16672@nokomis.stat.uiowa.edu>
Message-ID: <3CB09B4B-999F-44BB-B58C-F9DF6CFFB503@me.com>

It is intermittent on both my systems.

Rob






On Sep 8, 2011, at 8:00 AM, luke-tierney at uiowa.edu wrote:

> On Thu, 8 Sep 2011, Martin Maechler wrote:
> 
>>>>>>> Simon Urbanek <simon.urbanek at r-project.org>
>>>>>>>    on Thu, 8 Sep 2011 09:33:23 -0400 writes:
>> 
>>   > On Sep 8, 2011, at 4:01 AM, Martin Maechler wrote:
>> 
>>   >>>>>>> David Winsemius <dwinsemius at comcast.net>
>>   >>>>>>> on Tue, 6 Sep 2011 00:38:13 -0400 writes:
>>   >>
>>   >>> I can reproduce:
>>   >>> eigen(crossprod(matrix(1:2000, 50)) + (0+0i), T, T)
>>   >>
>>   >>> *** caught segfault ***
>>   >>> address 0x102d0e028, cause 'memory not mapped'
>>   >>
>>   >>> Traceback:
>>   >>> 1: .Call("La_rs_cmplx", x, only.values, PACKAGE = "base")
>>   >>> 2: eigen(crossprod(matrix(1:2000, 50)) + (0 + (0+0i)), T, T)
>>   >>> ##---- after restart
>>   >>>> sessionInfo()
>>   >>> R version 2.13.1 (2011-07-08)
>>   >>> Platform: x86_64-apple-darwin9.8.0/x86_64 (64-bit)
>>   >>
>>   >>> locale:
>>   >>> [1] en_US.UTF-8/en_US.UTF-8/C/C/en_US.UTF-8/en_US.UTF-8
>>   >>
>>   >>> attached base packages:
>>   >>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>   >>
>>   >>> With OSX 10.5.8
>>   >>
>>   >>> Also happens with 32 bit R
>>   >>> [R.app GUI 1.41 (5874) i386-apple-darwin9.8.0]
>>   >>
>>   >> It does not happen on Linux (different versions)
>>   >> nor Windows (2.13.1 patched, early August).
>>   >>
>>   >> As this is calling LAPACK code,
>>   >> I guess that this is yet another case where the Mac version
>>   >> of optimized BLAS / LAPACK is playing wrongly.
>>   >>
>> 
>>   > Nope, this is R's BLAS / LAPACK!
>> 
>> yes, it seems, as Peter is confirming as well.
>> 
>> *BUT* as far as we currently know, the problem was never seen
>> outside of MacOS X , right?
>> 
> 
> My experience is that the Mac OS malloc is less forgiving of writing
> outside allocated memory than the one usually used on Linux, so some
> things show up only on macs or are easier to trigger on macs even
> though the problems exist else where as well. Valgrind probably makes
> up for that most of the time but maybe not always.
> 
> Best,
> 
> luke
> 
> 
>> Martin Maechler
>> 
>>   >>> David Winsemius
>>   >>
>>   >>> On Sep 6, 2011, at 12:12 AM, robin hankin wrote:
>>   >>
>>   >>>> Hi.  macosx 10.6.8
>>   >>>>
>>   >>>> With R-2.13.1 and also revision 56948 I get the following repeatable
>>   >>>> segfault:
>>   >>>>
>>   >>>>
>>   >>>>
>>   >>>> wt118:~% R --vanilla --quiet
>>   >>>>> R.Version()
>>   >>>> $platform
>>   >>>> [1] "x86_64-apple-darwin9.8.0"
>>   >>>>
>>   >>>> $arch
>>   >>>> [1] "x86_64"
>>   >>>>
>>   >>>> $os
>>   >>>> [1] "darwin9.8.0"
>>   >>>>
>>   >>>> $system
>>   >>>> [1] "x86_64, darwin9.8.0"
>>   >>>>
>>   >>>> $status
>>   >>>> [1] ""
>>   >>>>
>>   >>>> $major
>>   >>>> [1] "2"
>>   >>>>
>>   >>>> $minor
>>   >>>> [1] "13.1"
>>   >>>>
>>   >>>> $year
>>   >>>> [1] "2011"
>>   >>>>
>>   >>>> $month
>>   >>>> [1] "07"
>>   >>>>
>>   >>>> $day
>>   >>>> [1] "08"
>>   >>>>
>>   >>>> $`svn rev`
>>   >>>> [1] "56322"
>>   >>>>
>>   >>>> $language
>>   >>>> [1] "R"
>>   >>>>
>>   >>>> $version.string
>>   >>>> [1] "R version 2.13.1 (2011-07-08)"
>>   >>>>
>>   >>>>> eigen(crossprod(matrix(1:2000, 50)) + (0+0i), T, T)
>>   >>>>
>>   >>>> *** caught segfault ***
>>   >>>> address 0x1038000a8, cause 'memory not mapped'
>>   >>>>
>>   >>>> Traceback:
>>   >>>> 1: .Call("La_rs_cmplx", x, only.values, PACKAGE = "base")
>>   >>>> 2: eigen(crossprod(matrix(1:2000, 50)) + (0 + (0+0i)), T, T)
>>   >>>>
>>   >>>> Possible actions:
>>   >>>> 1: abort (with core dump, if enabled)
>>   >>>> 2: normal R exit
>>   >>>> 3: exit R without saving workspace
>>   >>>> 4: exit R saving workspace
>>   >>>> Selection: 2
>>   >>>> wt118:~%
>>   >>>>
>>   >>>>
>>   >>>>
>>   >>>>
>>   >>>>
>>   >>>> --
>>   >>>> Robin Hankin
>>   >>>> Uncertainty Analyst
>>   >>>> hankin.robin at gmail.com
>>   >>>>
>>   >>>> ______________________________________________
>>   >>>> R-devel at r-project.org mailing list
>>   >>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>   >>
>>   >>> David Winsemius, MD
>>   >>> Heritage Laboratories
>>   >>> West Hartford, CT
>>   >>
>>   >>> ______________________________________________
>>   >>> R-devel at r-project.org mailing list
>>   >>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>   >>
>>   >> ______________________________________________
>>   >> R-devel at r-project.org mailing list
>>   >> https://stat.ethz.ch/mailman/listinfo/r-devel
>>   >>
>>   >>
>> 
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>> 
> 
> -- 
> Luke Tierney
> Chair, Statistics and Actuarial Science
> Ralph E. Wareham Professor of Mathematical Sciences
> University of Iowa                  Phone:             319-335-3386
> Department of Statistics and        Fax:               319-335-3017
>   Actuarial Science
> 241 Schaeffer Hall                  email:      luke at stat.uiowa.edu
> Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From mailinglist.honeypot at gmail.com  Thu Sep  8 21:59:18 2011
From: mailinglist.honeypot at gmail.com (Steve Lianoglou)
Date: Thu, 8 Sep 2011 15:59:18 -0400
Subject: [Rd] As a package author,
 is there a way to specify that your package is architecture
 (x86_64) specific?
Message-ID: <CAHA9McPk2acp1UknAPO2KaFtkb=YquA=XiwwhSXagnZGCh3USw@mail.gmail.com>

Hi,

Essentially: subject line says it all.

I've created a package that wraps an external c++ library (which I
didn't write) that only successfully compiles on 64bit machines.

I'd like to make the package broadly available, but is there a way to
get it on CRAN if the 32-bit builds break by specifying its 64-bit
only somehow?

Luckily, I've ./configure'd my R-devel-compiled-from-source to only
build x86_64 libs, so I can develop and install my package against
that, but trying to `R CMD INSTALL mypackage` using the official R
binaries breaks since it also tries to build a 32-bit *.so (I'm on a
mac).

I see hints in how to limit which architecture a package is built
against in the R-ext and R-admin manuals where they seem to suggest to
include a src/Makefile in order to do that ... but I'm not sure what I
should put in it.

Is it possible to limit the build architecture by putting something in
my src/Makevars instead of trying to engineer an entire Makefile since
"the normal build process" works just fine (except this whole
architecture thing)?

Even if it can't go on CRAN as 64-bit only, it would be great if I can
put up some easy install instructions for people to d/l my source
package externally and use it that way.

Thanks,

-steve

-- 
Steve Lianoglou
Graduate Student: Computational Systems Biology
?| Memorial Sloan-Kettering Cancer Center
?| Weill Medical College of Cornell University
Contact Info: http://cbio.mskcc.org/~lianos/contact


From mailinglist.honeypot at gmail.com  Thu Sep  8 22:11:00 2011
From: mailinglist.honeypot at gmail.com (Steve Lianoglou)
Date: Thu, 8 Sep 2011 16:11:00 -0400
Subject: [Rd] As a package author,
 is there a way to specify that your package is architecture
 (x86_64) specific?
In-Reply-To: <CAHA9McPk2acp1UknAPO2KaFtkb=YquA=XiwwhSXagnZGCh3USw@mail.gmail.com>
References: <CAHA9McPk2acp1UknAPO2KaFtkb=YquA=XiwwhSXagnZGCh3USw@mail.gmail.com>
Message-ID: <CAHA9McMte_XJHSJRFjy7qUTRFLtzMLyjxNuLeiLt2665CYn=dg@mail.gmail.com>

Quick follow up before I get RTFM'd:

I just found I can do:

R CMD INSTALL --no-multiarch mypackage

To get this to successfully work from the command line, so apologies
for the second part of the question.

The first Q remains, which is to either get this to happen
"automagically" via Makevars, or somehow specify the package as 64bit
only to see if the package can go up on CRAN until I can find time to
fix the problem (if/when).

Thanks,
-steve

On Thu, Sep 8, 2011 at 3:59 PM, Steve Lianoglou
<mailinglist.honeypot at gmail.com> wrote:
> Hi,
>
> Essentially: subject line says it all.
>
> I've created a package that wraps an external c++ library (which I
> didn't write) that only successfully compiles on 64bit machines.
>
> I'd like to make the package broadly available, but is there a way to
> get it on CRAN if the 32-bit builds break by specifying its 64-bit
> only somehow?
>
> Luckily, I've ./configure'd my R-devel-compiled-from-source to only
> build x86_64 libs, so I can develop and install my package against
> that, but trying to `R CMD INSTALL mypackage` using the official R
> binaries breaks since it also tries to build a 32-bit *.so (I'm on a
> mac).
>
> I see hints in how to limit which architecture a package is built
> against in the R-ext and R-admin manuals where they seem to suggest to
> include a src/Makefile in order to do that ... but I'm not sure what I
> should put in it.
>
> Is it possible to limit the build architecture by putting something in
> my src/Makevars instead of trying to engineer an entire Makefile since
> "the normal build process" works just fine (except this whole
> architecture thing)?
>
> Even if it can't go on CRAN as 64-bit only, it would be great if I can
> put up some easy install instructions for people to d/l my source
> package externally and use it that way.
>
> Thanks,
>
> -steve
>
> --
> Steve Lianoglou
> Graduate Student: Computational Systems Biology
> ?| Memorial Sloan-Kettering Cancer Center
> ?| Weill Medical College of Cornell University
> Contact Info: http://cbio.mskcc.org/~lianos/contact
>



-- 
Steve Lianoglou
Graduate Student: Computational Systems Biology
?| Memorial Sloan-Kettering Cancer Center
?| Weill Medical College of Cornell University
Contact Info: http://cbio.mskcc.org/~lianos/contact


From simon.urbanek at r-project.org  Thu Sep  8 22:11:45 2011
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Thu, 8 Sep 2011 16:11:45 -0400
Subject: [Rd] As a package author,
	is there a way to specify that your package is architecture
	(x86_64) specific?
In-Reply-To: <CAHA9McPk2acp1UknAPO2KaFtkb=YquA=XiwwhSXagnZGCh3USw@mail.gmail.com>
References: <CAHA9McPk2acp1UknAPO2KaFtkb=YquA=XiwwhSXagnZGCh3USw@mail.gmail.com>
Message-ID: <9AFCA8AB-5CF1-4E78-ACBF-93C53E8EF095@r-project.org>


On Sep 8, 2011, at 3:59 PM, Steve Lianoglou wrote:

> Hi,
> 
> Essentially: subject line says it all.
> 
> I've created a package that wraps an external c++ library (which I didn't write) that only successfully compiles on 64bit machines.
> 

That doesn't sound right, it contradicts your subject line - x86_64 is just one of many 64-bit architectures ... but from what you describe it's not about an architecture at all - it's about the library .. (see below).


> I'd like to make the package broadly available, but is there a way to
> get it on CRAN if the 32-bit builds break by specifying its 64-bit
> only somehow?
> 
> Luckily, I've ./configure'd my R-devel-compiled-from-source to only
> build x86_64 libs, so I can develop and install my package against
> that, but trying to `R CMD INSTALL mypackage` using the official R
> binaries breaks since it also tries to build a 32-bit *.so (I'm on a
> mac).
> 
> I see hints in how to limit which architecture a package is built
> against in the R-ext and R-admin manuals where they seem to suggest to
> include a src/Makefile in order to do that ... but I'm not sure what I
> should put in it.
> 

No, that's not the purpose.


> Is it possible to limit the build architecture by putting something in
> my src/Makevars instead of trying to engineer an entire Makefile since
> "the normal build process" works just fine (except this whole
> architecture thing)?
> 
> Even if it can't go on CRAN as 64-bit only, it would be great if I can
> put up some easy install instructions for people to d/l my source
> package externally and use it that way.
> 

The configure script is designed to figure out things like that, so all you need to do is to add a configure script that will check whether the package can be built for that architecture or not. In fact, it should really check whatever the C++ library does that prevents it from working elsewhere. The particularities depends on the library so you'll need to provide more info in oder to help you better ...

Note that it will also ensure that the package will be built only for one architecture.

Cheers,
Simon


From wdunlap at tibco.com  Thu Sep  8 22:45:49 2011
From: wdunlap at tibco.com (William Dunlap)
Date: Thu, 8 Sep 2011 20:45:49 +0000
Subject: [Rd] nobs(lm(...)) != nobs(glm(...)) when there are 0s in weights
Message-ID: <E66794E69CFDE04D9A70842786030B93052005@PA-MBX04.na.tibco.com>

What is the rationale for nobs.lm omitting observations with
zero weights while nobs.glm includes them?

> df <- data.frame(x1=log(1:10), x2=1/(1:10), y=1:10, wt=c(0,2,0,4,0,6,7,8,9,10))
> nobs(lm(data=df, y~x1+x2, weights=wt))
[1] 7
> nobs(glm(data=df, y~x1+x2, weights=wt))
[1] 10

The anova methods for lm and glm seem to agree on the number
of degrees of freedom here, although anova.glm issues a message
about it:

> anova(lm(data=df, y~x1+x2, weights=wt))
Analysis of Variance Table

Response: y
          Df  Sum Sq Mean Sq  F value    Pr(>F)    
x1         1 196.682 196.682 1034.648 5.569e-06 ***
x2         1  11.514  11.514   60.572   0.00147 ** 
Residuals  4   0.760   0.190                       
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 
> anova(glm(data=df, y~x1+x2, weights=wt))
Analysis of Deviance Table

Model: gaussian, link: identity

Response: y

Terms added sequentially (first to last)


     Df Deviance Resid. Df Resid. Dev
NULL                     6    208.957
x1    1  196.682         5     12.275
x2    1   11.514         4      0.760
Warning message:
In summary.glm(object, dispersion = dispersion) :
  observations with zero weight not used for calculating dispersion


Bill Dunlap
Spotfire, TIBCO Software
wdunlap tibco.com 


From mailinglist.honeypot at gmail.com  Fri Sep  9 05:43:46 2011
From: mailinglist.honeypot at gmail.com (Steve Lianoglou)
Date: Thu, 8 Sep 2011 23:43:46 -0400
Subject: [Rd] As a package author,
 is there a way to specify that your package is architecture
 (x86_64) specific?
In-Reply-To: <9AFCA8AB-5CF1-4E78-ACBF-93C53E8EF095@r-project.org>
References: <CAHA9McPk2acp1UknAPO2KaFtkb=YquA=XiwwhSXagnZGCh3USw@mail.gmail.com>
	<9AFCA8AB-5CF1-4E78-ACBF-93C53E8EF095@r-project.org>
Message-ID: <CAHA9McO7-gQ0_Ez+ejJRkHXM-nbtAi1qRL3CKG4kc5cfrVCxCA@mail.gmail.com>

Hi Simon,

Thanks for the quick response.

Comments in line:

On Thu, Sep 8, 2011 at 4:11 PM, Simon Urbanek
<simon.urbanek at r-project.org> wrote:
>
> On Sep 8, 2011, at 3:59 PM, Steve Lianoglou wrote:
>
>> Hi,
>>
>> Essentially: subject line says it all.
>>
>> I've created a package that wraps an external c++ library (which I didn't write) that only successfully compiles on 64bit machines.
>>
>
> That doesn't sound right, it contradicts your subject line - x86_64 is just one of many 64-bit architectures ...

Ok, sorry for being imprecise. Let's see if we can figure out what it
is (more precise details are at the bottom of the email). I see x86_64
on every 64bit machine I touch (linux or mac), so I thought they were
interchangeable (as names).

> My hunch is that it really is about the architecture, not x86_64  but from what you describe it's not about an architecture at all - it's about the library .. (see below).

[snip]

>> I see hints in how to limit which architecture a package is built
>> against in the R-ext and R-admin manuals where they seem to suggest to
>> include a src/Makefile in order to do that ... but I'm not sure what I
>> should put in it.
>>
>
> No, that's not the purpose.

Well, the r-admin doc does suggest using your own Makefile in close
proximity to targetting specific architectures several times ... eg.
section 2.6, 6.3.1, 6.3.4.

In fact, if you search that document for "src/Makefile" it's almost
always found next to something that talks about compiling architecture
specific builds ... I'm sure it's used for a lot more than that, but
r-admin repeatedly suggests that this is one of its functions.

But let's get to the good stuff.

>> Even if it can't go on CRAN as 64-bit only, it would be great if I can
>> put up some easy install instructions for people to d/l my source
>> package externally and use it that way.
>>
>
> The configure script is designed to figure out things like that, so all you need to do is to add a configure script that will check whether the package can be built for that architecture or not.

OK ... I was hoping I could avoid getting into configure/autoconf
stuff, but at some point I'll have to bite the bullet and read up on
it much more than I really want to, so I guess that will happen sooner
than later.

> In fact, it should really check whatever the C++ library does that prevents it from working elsewhere. The particularities depends on the library so you'll need to provide more info in oder to help you better ...

It's doing some inline assembly. The problematic code is here:

https://github.com/lianos/buckshot/blob/master/src/cas_array.h#L90

Compiling the 32bit version of the library on my mac complains about
the call to `cmpxchg`, specifically:

/var/folders/C2/C2bsTekpH-qdLj5psUvjtk+++TM/-Tmp-//cc7q88qD.s:785:suffix
or operands invalid for `cmpxchg'

Doing surgery on the code to actually fix it is a bit above my pay
grade right now as the last time I had to write in assembly was > 10
years ago for an undergraduate class, so I'd just like to sidestep the
issue.

I'm not sure how to properly check if this call to cmpxchg can work
inside a configure script or using autoconf. If it's relatively
simple, I'd appreciate a hint if you've got one to spare, otherwise
I'll just keep compiling the 64bit only version of the library until I
can figure out how to sort it out.

The library also compiles fine on our linux compute servers, which
`uname -a` tells me are also of the x86_64 64bit variety. I'm not sure
if that's helpful to know, but thought I'd just put it out there.

Thanks,
-steve

-- 
Steve Lianoglou
Graduate Student: Computational Systems Biology
?| Memorial Sloan-Kettering Cancer Center
?| Weill Medical College of Cornell University
Contact Info: http://cbio.mskcc.org/~lianos/contact


From Kurt.Hornik at wu.ac.at  Fri Sep  9 09:27:13 2011
From: Kurt.Hornik at wu.ac.at (Kurt Hornik)
Date: Fri, 9 Sep 2011 09:27:13 +0200
Subject: [Rd] libtool FIXME
In-Reply-To: <4E663EC8.3040309@gmail.com>
References: <4E663EC8.3040309@gmail.com>
Message-ID: <20073.49105.854708.116503@fangorn.hornik.net>

>>>>> Marco atzeri writes:

> Hi,
> looking on the build scripts, I noticed on configure.ac

> ## <FIXME>
> ## Completely disable using libtool for building shlibs until libtool
> ## fully supports Fortran and C++.
> ## AC_ARG_WITH([libtool],
> ## [AS_HELP_STRING([--with-libtool],[use libtool for building shared 
> libraries @
> <:@yes@:>@])],
> ## [use_libtool="${withval}"],
> ## [use_libtool=yes])
> ## AM_CONDITIONAL(USE_LIBTOOL, [test "x${use_libtool}" = xyes])
> ## </FIXME>

> Is this comment outdated or still valid ?

Marco,

svn blame has

 17895     hornik ## Completely disable using libtool for building shlibs until libtool
 17895     hornik ## Completely disable using libtool for building shlibs until libtool

and change set 17895 is from 2002-01-21, so almost 10 years old.

Then it was certainly true.  Whether it still is, I don't know: we
needed to put considerable effort into creating our own non-libtool
solution.  Now we have something working and considerable effort would
be needed to rewrite the build toolchain [and I'd additionally be
concerned about possible future lack of libtool support for things R
needs to support].

Best
-k

> In my experience, Octave, that is mainly Fortran and C++ plus a small
> amount of C, is fully employing libtool and automake with a very clean
> and lean build system.

> My question is not just academic; I was thinking to package
> R for cygwin but the current configuration produce shared libs
> with the wrong name

>    /usr/bin/libR.dll
>    /usr/bin/libRmath.dll

> instead of expected

>    /usr/bin/cygR.dll
>    /usr/bin/cygRmath.dll

> (http://cygwin.com/cygwin-ug-net/dll.html#dll-build)
> so the "as it is" package will be rejected and a substantial
> patching of the various "Makefile.in" will be needed to make
> it conformant.


> Thanks in advance
> Marco

> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From ripley at stats.ox.ac.uk  Fri Sep  9 14:36:07 2011
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 9 Sep 2011 13:36:07 +0100 (BST)
Subject: [Rd] As a package author,
 is there a way to specify that your package is architecture
 (x86_64) specific?
In-Reply-To: <CAHA9McO7-gQ0_Ez+ejJRkHXM-nbtAi1qRL3CKG4kc5cfrVCxCA@mail.gmail.com>
References: <CAHA9McPk2acp1UknAPO2KaFtkb=YquA=XiwwhSXagnZGCh3USw@mail.gmail.com>
	<9AFCA8AB-5CF1-4E78-ACBF-93C53E8EF095@r-project.org>
	<CAHA9McO7-gQ0_Ez+ejJRkHXM-nbtAi1qRL3CKG4kc5cfrVCxCA@mail.gmail.com>
Message-ID: <alpine.LFD.2.02.1109091330510.10017@gannet.stats.ox.ac.uk>

On Thu, 8 Sep 2011, Steve Lianoglou wrote:

> Hi Simon,
>
> Thanks for the quick response.
>
> Comments in line:
>
> On Thu, Sep 8, 2011 at 4:11 PM, Simon Urbanek
> <simon.urbanek at r-project.org> wrote:
>>
>> On Sep 8, 2011, at 3:59 PM, Steve Lianoglou wrote:
>>
>>> Hi,
>>>
>>> Essentially: subject line says it all.
>>>
>>> I've created a package that wraps an external c++ library (which I didn't write) that only successfully compiles on 64bit machines.
>>>
>>
>> That doesn't sound right, it contradicts your subject line - x86_64 
>> is just one of many 64-bit architectures ...
>
> Ok, sorry for being imprecise. Let's see if we can figure out what it
> is (more precise details are at the bottom of the email). I see x86_64
> on every 64bit machine I touch (linux or mac), so I thought they were
> interchangeable (as names).

Not so.  That's not what Windows uses (it mainly uses x64, sometimes 
amd64 or x86-64, almost never x86_64), and although it is what Solaris 
uses, your Linux x86_64 assembler (presumably GNU) will not work 
there.

>> My hunch is that it really is about the architecture, not x86_64 
>> but from what you describe it's not about an architecture at all - 
>> it's about the library .. (see below).
>
> [snip]
>
>>> I see hints in how to limit which architecture a package is built
>>> against in the R-ext and R-admin manuals where they seem to suggest to
>>> include a src/Makefile in order to do that ... but I'm not sure what I
>>> should put in it.
>>
>> No, that's not the purpose.
>
> Well, the r-admin doc does suggest using your own Makefile in close
> proximity to targetting specific architectures several times ... eg.
> section 2.6, 6.3.1, 6.3.4.

No, it suggests there is an interaction: *if* you use your own 
src/Makefile it interacts with multiarch builds.  And so does having a 
configure file ....

> In fact, if you search that document for "src/Makefile" it's almost
> always found next to something that talks about compiling architecture
> specific builds ... I'm sure it's used for a lot more than that, but
> r-admin repeatedly suggests that this is one of its functions.
>
> But let's get to the good stuff.
>
>>> Even if it can't go on CRAN as 64-bit only, it would be great if I can
>>> put up some easy install instructions for people to d/l my source
>>> package externally and use it that way.
>>>
>>
>> The configure script is designed to figure out things like that, so all you need to do is to add a configure script that will check whether the package can be built for that architecture or not.
>
> OK ... I was hoping I could avoid getting into configure/autoconf
> stuff, but at some point I'll have to bite the bullet and read up on
> it much more than I really want to, so I guess that will happen sooner
> than later.
>
>> In fact, it should really check whatever the C++ library does that 
>> prevents it from working elsewhere. The particularities depends on 
>> the library so you'll need to provide more info in oder to help you 
>> better ...
>
> It's doing some inline assembly. The problematic code is here:
>
> https://github.com/lianos/buckshot/blob/master/src/cas_array.h#L90
>
> Compiling the 32bit version of the library on my mac complains about
> the call to `cmpxchg`, specifically:
>
> /var/folders/C2/C2bsTekpH-qdLj5psUvjtk+++TM/-Tmp-//cc7q88qD.s:785:suffix
> or operands invalid for `cmpxchg'
>
> Doing surgery on the code to actually fix it is a bit above my pay
> grade right now as the last time I had to write in assembly was > 10
> years ago for an undergraduate class, so I'd just like to sidestep the
> issue.
>
> I'm not sure how to properly check if this call to cmpxchg can work
> inside a configure script or using autoconf. If it's relatively
> simple, I'd appreciate a hint if you've got one to spare, otherwise
> I'll just keep compiling the 64bit only version of the library until I
> can figure out how to sort it out.
>
> The library also compiles fine on our linux compute servers, which
> `uname -a` tells me are also of the x86_64 64bit variety. I'm not sure
> if that's helpful to know, but thought I'd just put it out there.

You try to compile the crucial fragament of code in configure: there 
are lots of examples of that in the R sources (mainly in the m4 
directory).

>
> Thanks,
> -steve
>
> -- 
> Steve Lianoglou
> Graduate Student: Computational Systems Biology
> ?| Memorial Sloan-Kettering Cancer Center
> ?| Weill Medical College of Cornell University
> Contact Info: http://cbio.mskcc.org/~lianos/contact
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From simon.urbanek at r-project.org  Fri Sep  9 15:41:36 2011
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Fri, 9 Sep 2011 09:41:36 -0400
Subject: [Rd] As a package author,
	is there a way to specify that your package is architecture
	(x86_64) specific?
In-Reply-To: <alpine.LFD.2.02.1109091330510.10017@gannet.stats.ox.ac.uk>
References: <CAHA9McPk2acp1UknAPO2KaFtkb=YquA=XiwwhSXagnZGCh3USw@mail.gmail.com>
	<9AFCA8AB-5CF1-4E78-ACBF-93C53E8EF095@r-project.org>
	<CAHA9McO7-gQ0_Ez+ejJRkHXM-nbtAi1qRL3CKG4kc5cfrVCxCA@mail.gmail.com>
	<alpine.LFD.2.02.1109091330510.10017@gannet.stats.ox.ac.uk>
Message-ID: <A8EB1004-FAD1-4639-81B3-B9256BAACA58@r-project.org>

Steve,

On Sep 9, 2011, at 8:36 AM, Prof Brian Ripley wrote:

> On Thu, 8 Sep 2011, Steve Lianoglou wrote:
> 
>> Hi Simon,
>> 
>> Thanks for the quick response.
>> 
>> Comments in line:
>> 
>> On Thu, Sep 8, 2011 at 4:11 PM, Simon Urbanek
>> <simon.urbanek at r-project.org> wrote:
>>> 
>>> On Sep 8, 2011, at 3:59 PM, Steve Lianoglou wrote:
>>> 
>>>> Hi,
>>>> 
>>>> Essentially: subject line says it all.
>>>> 
>>>> I've created a package that wraps an external c++ library (which I didn't write) that only successfully compiles on 64bit machines.
>>>> 
>>> 
>>> That doesn't sound right, it contradicts your subject line - x86_64 is just one of many 64-bit architectures ...
>> 
>> Ok, sorry for being imprecise. Let's see if we can figure out what it
>> is (more precise details are at the bottom of the email). I see x86_64
>> on every 64bit machine I touch (linux or mac), so I thought they were
>> interchangeable (as names).
> 
> Not so.  That's not what Windows uses (it mainly uses x64, sometimes amd64 or x86-64, almost never x86_64), and although it is what Solaris uses, your Linux x86_64 assembler (presumably GNU) will not work there.
> 

Moreover not all 64-bit machines are x86_64/amd64 - there is ppc64, Sparc, MIPS64, IA64, ... which was my point about this having to do with a very particular machine type (and my suspicion involving asm was correct ;)) and not 64-bit architectures in general.


>>> My hunch is that it really is about the architecture, not x86_64 but from what you describe it's not about an architecture at all - it's about the library .. (see below).
>> 
>> [snip]
>> 
>>>> I see hints in how to limit which architecture a package is built
>>>> against in the R-ext and R-admin manuals where they seem to suggest to
>>>> include a src/Makefile in order to do that ... but I'm not sure what I
>>>> should put in it.
>>> 
>>> No, that's not the purpose.
>> 
>> Well, the r-admin doc does suggest using your own Makefile in close
>> proximity to targetting specific architectures several times ... eg.
>> section 2.6, 6.3.1, 6.3.4.
> 
> No, it suggests there is an interaction: *if* you use your own src/Makefile it interacts with multiarch builds.  And so does having a configure file ....
> 
>> In fact, if you search that document for "src/Makefile" it's almost
>> always found next to something that talks about compiling architecture
>> specific builds ... I'm sure it's used for a lot more than that, but
>> r-admin repeatedly suggests that this is one of its functions.
>> 
>> But let's get to the good stuff.
>> 
>>>> Even if it can't go on CRAN as 64-bit only, it would be great if I can
>>>> put up some easy install instructions for people to d/l my source
>>>> package externally and use it that way.
>>>> 
>>> 
>>> The configure script is designed to figure out things like that, so all you need to do is to add a configure script that will check whether the package can be built for that architecture or not.
>> 
>> OK ... I was hoping I could avoid getting into configure/autoconf
>> stuff, but at some point I'll have to bite the bullet and read up on
>> it much more than I really want to, so I guess that will happen sooner
>> than later.
>> 
>>> In fact, it should really check whatever the C++ library does that prevents it from working elsewhere. The particularities depends on the library so you'll need to provide more info in oder to help you better ...
>> 
>> It's doing some inline assembly. The problematic code is here:
>> 
>> https://github.com/lianos/buckshot/blob/master/src/cas_array.h#L90
>> 
>> Compiling the 32bit version of the library on my mac complains about
>> the call to `cmpxchg`, specifically:
>> 
>> /var/folders/C2/C2bsTekpH-qdLj5psUvjtk+++TM/-Tmp-//cc7q88qD.s:785:suffix
>> or operands invalid for `cmpxchg'
>> 
>> Doing surgery on the code to actually fix it is a bit above my pay
>> grade right now as the last time I had to write in assembly was > 10
>> years ago for an undergraduate class, so I'd just like to sidestep the
>> issue.
>> 
>> I'm not sure how to properly check if this call to cmpxchg can work
>> inside a configure script or using autoconf. If it's relatively
>> simple, I'd appreciate a hint if you've got one to spare, otherwise
>> I'll just keep compiling the 64bit only version of the library until I
>> can figure out how to sort it out.
>> 
>> The library also compiles fine on our linux compute servers, which
>> `uname -a` tells me are also of the x86_64 64bit variety. I'm not sure
>> if that's helpful to know, but thought I'd just put it out there.


It's irrelevant, though, because you can build both i386 and x8_64 binaries on a x86_64 system, so it won't tell you which architecture is being built. Also some machines (e.g. older Mac OS X) will run i386 kernel while the rest of the OS runs fully in x86_64 so you can't even discard the possibility based on uname (which returns i386 in that case even though R can run in x86_64 there).


> You try to compile the crucial fragament of code in configure: there are lots of examples of that in the R sources (mainly in the m4 directory).
> 


Yes, that is the right thing to do. It's only a few lines of configure.in if you want to use autoconf, but if you don't, it's still fairly easy in pure shell code, just a bit more legwork.

Cheers,
Simon


From mailinglist.honeypot at gmail.com  Fri Sep  9 16:30:03 2011
From: mailinglist.honeypot at gmail.com (Steve Lianoglou)
Date: Fri, 9 Sep 2011 10:30:03 -0400
Subject: [Rd] As a package author,
 is there a way to specify that your package is architecture
 (x86_64) specific?
In-Reply-To: <A8EB1004-FAD1-4639-81B3-B9256BAACA58@r-project.org>
References: <CAHA9McPk2acp1UknAPO2KaFtkb=YquA=XiwwhSXagnZGCh3USw@mail.gmail.com>
	<9AFCA8AB-5CF1-4E78-ACBF-93C53E8EF095@r-project.org>
	<CAHA9McO7-gQ0_Ez+ejJRkHXM-nbtAi1qRL3CKG4kc5cfrVCxCA@mail.gmail.com>
	<alpine.LFD.2.02.1109091330510.10017@gannet.stats.ox.ac.uk>
	<A8EB1004-FAD1-4639-81B3-B9256BAACA58@r-project.org>
Message-ID: <CAHA9McMUjnvWbe5MoriwioBspOAiqJwZTv3e4k9YUUTg_Mj9jA@mail.gmail.com>

Hi Simon, Prof. Ripley, and Dirk,

First: thanks again for the tips, it's great to have some of the "top
bRass" providing this type of help.

Last (few) comments in line:

On Fri, Sep 9, 2011 at 9:41 AM, Simon Urbanek
<simon.urbanek at r-project.org> wrote:
> On Sep 9, 2011, at 8:36 AM, Prof Brian Ripley wrote:
>> On Thu, 8 Sep 2011, Steve Lianoglou wrote:

[snip]

About the architecture thing:

>>> Ok, sorry for being imprecise. Let's see if we can figure out what it
>>> is (more precise details are at the bottom of the email). I see x86_64
>>> on every 64bit machine I touch (linux or mac), so I thought they were
>>> interchangeable (as names).
>>
>> Not so. ?That's not what Windows uses (it mainly uses x64, sometimes amd64 or x86-64, almost never x86_64), and although it is what Solaris uses, your Linux x86_64 assembler (presumably GNU) will not work there.
>>
>
> Moreover not all 64-bit machines are x86_64/amd64 - there is ppc64, Sparc, MIPS64, IA64, ... which was my point about this having to do with a very particular machine type (and my suspicion involving asm was correct ;)) and not 64-bit architectures in general.

Right, of course ... as soon as you mentioned ppc64, the distinction
you folks were trying to point out was immediately clear, thanks.

[snip]

About the configure/autoconf testing thing:

>> You try to compile the crucial fragament of code in configure: there are lots of examples of that in the R sources (mainly in the m4 directory).
>
> Yes, that is the right thing to do. It's only a few lines of configure.in if you want to use autoconf, but if you don't, it's still fairly easy in pure shell code, just a bit more legwork.

OK, thanks for that, too.

So, last question here -- say I catch this error condition during the
configure (or shell) check code, and I realize that some bit of code
won't work on this machine type.

How do I signal to R's build/compile process to "error out" on the
package build proces, but just move on to the next arch/machine-type
it should try to compile?

I mean: I can imagine how one could catch an error during the compile
test and then define some var that an `#ifdef SOMETHING` could be used
in my codebase to do one thing or the other, but in this case I'm not
trying to direct the compiler down a different codepath that will work
for the machine type (for now), I just want it to give up on the
current build and try the build for the next machine-type in line.

Thanks again,
-steve

-- 
Steve Lianoglou
Graduate Student: Computational Systems Biology
?| Memorial Sloan-Kettering Cancer Center
?| Weill Medical College of Cornell University
Contact Info: http://cbio.mskcc.org/~lianos/contact


From pauljohn32 at gmail.com  Fri Sep  9 18:38:12 2011
From: pauljohn32 at gmail.com (Paul Johnson)
Date: Fri, 9 Sep 2011 11:38:12 -0500
Subject: [Rd] Please explain your workflow from R code -> package -> R code
	-> package
Message-ID: <CAErODj_mu8dOujVCJh14d-UbDw9qrq-9CC3MeeCSQ6d28-rJDg@mail.gmail.com>

Hi,

I'm asking another one of those questions that would be obvious if I
could watch your work while you do it.

I'm having trouble understanding the workflow of code and package maintenance.

Stage 1.  Make some R functions in a folder.  This is in a Subversion repo

R/trunk/myproject

Stage 2. Make a package:

After the package.skeleton, and R check, I have a new folder with the
project in it,

R/trunk/myproject/mypackage
  DESCRIPTION
  man
  R

I to into the man folder and manually edit the Rd files. I don't
change anything in the R folder because I think it is OK so far.

And eventually I end up with a tarball mypackage_1.0.tar.gz.

Stage 3. How to make the round trip? I add more R code, and
re-generate a package.

package.skeleton obliterates the help files I've already edited.

So keeping the R code in sync with the documentation appears to be a hassle.

In other languages, I've seen to write the documentation inside the
code files and then post-process to make the documentation.  Is there
a similar thing for R, to unify the R code development and
documentation/package-making process?

pj

-- 
Paul E. Johnson
Professor, Political Science
1541 Lilac Lane, Room 504
University of Kansas


From josh.m.ulrich at gmail.com  Fri Sep  9 18:49:39 2011
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Fri, 9 Sep 2011 11:49:39 -0500
Subject: [Rd] Please explain your workflow from R code -> package -> R
 code -> package
In-Reply-To: <CAErODj_mu8dOujVCJh14d-UbDw9qrq-9CC3MeeCSQ6d28-rJDg@mail.gmail.com>
References: <CAErODj_mu8dOujVCJh14d-UbDw9qrq-9CC3MeeCSQ6d28-rJDg@mail.gmail.com>
Message-ID: <CAPPM_gR3J8fOUJvNoK71PX3WAYAwcmsqfY6Vr4758SWxGnyCrQ@mail.gmail.com>

On Fri, Sep 9, 2011 at 11:38 AM, Paul Johnson <pauljohn32 at gmail.com> wrote:
> Hi,
>
> I'm asking another one of those questions that would be obvious if I
> could watch your work while you do it.
>
> I'm having trouble understanding the workflow of code and package maintenance.
>
> Stage 1. ?Make some R functions in a folder. ?This is in a Subversion repo
>
> R/trunk/myproject
>
> Stage 2. Make a package:
>
> After the package.skeleton, and R check, I have a new folder with the
> project in it,
>
> R/trunk/myproject/mypackage
> ?DESCRIPTION
> ?man
> ?R
>
> I to into the man folder and manually edit the Rd files. I don't
> change anything in the R folder because I think it is OK so far.
>
> And eventually I end up with a tarball mypackage_1.0.tar.gz.
>
> Stage 3. How to make the round trip? I add more R code, and
> re-generate a package.
>
> package.skeleton obliterates the help files I've already edited.
>
See ?dump and ?prompt.

> So keeping the R code in sync with the documentation appears to be a hassle.
>
> In other languages, I've seen to write the documentation inside the
> code files and then post-process to make the documentation. ?Is there
> a similar thing for R, to unify the R code development and
> documentation/package-making process?
>
Yes.  See the roxygen / roxygen2 and devtools packages.

> pj
>
> --
> Paul E. Johnson
> Professor, Political Science
> 1541 Lilac Lane, Room 504
> University of Kansas
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

Best,
--
Joshua Ulrich  |  FOSS Trading: www.fosstrading.com


From spencer.graves at prodsyse.com  Fri Sep  9 19:05:27 2011
From: spencer.graves at prodsyse.com (Spencer Graves)
Date: Fri, 9 Sep 2011 10:05:27 -0700
Subject: [Rd] Please explain your workflow from R code -> package -> R
 code -> package
In-Reply-To: <CAPPM_gR3J8fOUJvNoK71PX3WAYAwcmsqfY6Vr4758SWxGnyCrQ@mail.gmail.com>
References: <CAErODj_mu8dOujVCJh14d-UbDw9qrq-9CC3MeeCSQ6d28-rJDg@mail.gmail.com>
	<CAPPM_gR3J8fOUJvNoK71PX3WAYAwcmsqfY6Vr4758SWxGnyCrQ@mail.gmail.com>
Message-ID: <4E6A4757.4070704@prodsyse.com>

       I write the *.Rd file including examples that I use as unit tests 
before I write the code.  Others criticize this approach insisting that 
\examples is NOT a place for unit tests.  There are unit testing 
protocols for R that I have not learned.  Instead, I rely on \dontshow 
inside \examples.


       There are two documents on CRAN -> "Documentation:  Contributed" 
entitled "Creating R Packages".  They might help.


       Hope this helps.
       Spencer


On 9/9/2011 9:49 AM, Joshua Ulrich wrote:
> On Fri, Sep 9, 2011 at 11:38 AM, Paul Johnson<pauljohn32 at gmail.com>  wrote:
>> Hi,
>>
>> I'm asking another one of those questions that would be obvious if I
>> could watch your work while you do it.
>>
>> I'm having trouble understanding the workflow of code and package maintenance.
>>
>> Stage 1.  Make some R functions in a folder.  This is in a Subversion repo
>>
>> R/trunk/myproject
>>
>> Stage 2. Make a package:
>>
>> After the package.skeleton, and R check, I have a new folder with the
>> project in it,
>>
>> R/trunk/myproject/mypackage
>>   DESCRIPTION
>>   man
>>   R
>>
>> I to into the man folder and manually edit the Rd files. I don't
>> change anything in the R folder because I think it is OK so far.
>>
>> And eventually I end up with a tarball mypackage_1.0.tar.gz.
>>
>> Stage 3. How to make the round trip? I add more R code, and
>> re-generate a package.
>>
>> package.skeleton obliterates the help files I've already edited.
>>
> See ?dump and ?prompt.
>
>> So keeping the R code in sync with the documentation appears to be a hassle.
>>
>> In other languages, I've seen to write the documentation inside the
>> code files and then post-process to make the documentation.  Is there
>> a similar thing for R, to unify the R code development and
>> documentation/package-making process?
>>
> Yes.  See the roxygen / roxygen2 and devtools packages.
>
>> pj
>>
>> --
>> Paul E. Johnson
>> Professor, Political Science
>> 1541 Lilac Lane, Room 504
>> University of Kansas
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
> Best,
> --
> Joshua Ulrich  |  FOSS Trading: www.fosstrading.com
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From edd at debian.org  Fri Sep  9 19:42:56 2011
From: edd at debian.org (Dirk Eddelbuettel)
Date: Fri, 9 Sep 2011 12:42:56 -0500
Subject: [Rd] Please explain your workflow from R code -> package -> R
	code	-> package
In-Reply-To: <CAErODj_mu8dOujVCJh14d-UbDw9qrq-9CC3MeeCSQ6d28-rJDg@mail.gmail.com>
References: <CAErODj_mu8dOujVCJh14d-UbDw9qrq-9CC3MeeCSQ6d28-rJDg@mail.gmail.com>
Message-ID: <20074.20512.95925.44559@max.nulle.part>


On 9 September 2011 at 11:38, Paul Johnson wrote:
| Hi,
| 
| I'm asking another one of those questions that would be obvious if I
| could watch your work while you do it.
| 
| I'm having trouble understanding the workflow of code and package maintenance.
| 
| Stage 1.  Make some R functions in a folder.  This is in a Subversion repo
| 
| R/trunk/myproject
| 
| Stage 2. Make a package:
| 
| After the package.skeleton, and R check, I have a new folder with the
| project in it,
| 
| R/trunk/myproject/mypackage
|   DESCRIPTION
|   man
|   R
| 
| I to into the man folder and manually edit the Rd files. I don't
| change anything in the R folder because I think it is OK so far.
| 
| And eventually I end up with a tarball mypackage_1.0.tar.gz.
| 
| Stage 3. How to make the round trip? I add more R code, and
| re-generate a package.
| 
| package.skeleton obliterates the help files I've already edited.

In my case a lot of 'C-x f' to open a new man/foo.Rd file, maybe a new
src/foo.cpp file, maybe a new unit tests file ...  It all depends.  I tend
then call little one-line shell commands which may rebuild the package and
run test expressions via littler.

But as a general rule, code and documentation (still) gets written (manually)
in an editor.

| So keeping the R code in sync with the documentation appears to be a hassle.

But 'R CMD check' is vigilant and reminds you when you get some details wrong.
 
| In other languages, I've seen to write the documentation inside the
| code files and then post-process to make the documentation.  Is there
| a similar thing for R, to unify the R code development and
| documentation/package-making process?

You can also follow the cool kids who these days tie some of this together
using roxygen.
 

And just as a philosophical note: There is (still) no silver bullet.  The
slow boring of thick boards applies not only to politics (as per Max Weber)
but quite conceivably to programming.

Hth, Dirk
 
| pj
| 
| -- 
| Paul E. Johnson
| Professor, Political Science
| 1541 Lilac Lane, Room 504
| University of Kansas
| 
| ______________________________________________
| R-devel at r-project.org mailing list
| https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Two new Rcpp master classes for R and C++ integration scheduled for 
New York (Sep 24) and San Francisco (Oct 8), more details are at
http://dirk.eddelbuettel.com/blog/2011/08/04#rcpp_classes_2011-09_and_2011-10
http://www.revolutionanalytics.com/products/training/public/rcpp-master-class.php


From murdoch.duncan at gmail.com  Fri Sep  9 19:47:11 2011
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Fri, 9 Sep 2011 13:47:11 -0400
Subject: [Rd] Please explain your workflow from R code -> package -> R
 code -> package
In-Reply-To: <CAErODj_mu8dOujVCJh14d-UbDw9qrq-9CC3MeeCSQ6d28-rJDg@mail.gmail.com>
References: <CAErODj_mu8dOujVCJh14d-UbDw9qrq-9CC3MeeCSQ6d28-rJDg@mail.gmail.com>
Message-ID: <4E6A511F.4090607@gmail.com>

On 09/09/2011 12:38 PM, Paul Johnson wrote:
> Hi,
>
> I'm asking another one of those questions that would be obvious if I
> could watch your work while you do it.
>
> I'm having trouble understanding the workflow of code and package maintenance.
>
> Stage 1.  Make some R functions in a folder.  This is in a Subversion repo
>
> R/trunk/myproject
>
> Stage 2. Make a package:
>
> After the package.skeleton, and R check, I have a new folder with the
> project in it,
>
> R/trunk/myproject/mypackage
>    DESCRIPTION
>    man
>    R
>
> I to into the man folder and manually edit the Rd files. I don't
> change anything in the R folder because I think it is OK so far.
>
> And eventually I end up with a tarball mypackage_1.0.tar.gz.
>
> Stage 3. How to make the round trip? I add more R code, and
> re-generate a package.
>
> package.skeleton obliterates the help files I've already edited.

You should only run it once.  After that, add your code by editing *.R 
files in the R directory, sourcing them, and generate *.Rd files using 
prompt().  As Dirk said, run R CMD check when you think you're done, and 
it will point out how wrong you are.
> So keeping the R code in sync with the documentation appears to be a hassle.

If you write the *.Rd file before (like Spencer) or soon after writing 
the code, then design errors will usually stick out at you, and you can 
modify the functions.  If you keep your functions small, you'll get them 
working early, and won't have a lot of problems keeping them in sync 
with the docs, because they won't change much once you get them right.

Duncan Murdoch

> In other languages, I've seen to write the documentation inside the
> code files and then post-process to make the documentation.  Is there
> a similar thing for R, to unify the R code development and
> documentation/package-making process?
>
> pj
>


From spencer.graves at prodsyse.com  Fri Sep  9 20:10:07 2011
From: spencer.graves at prodsyse.com (Spencer Graves)
Date: Fri, 9 Sep 2011 11:10:07 -0700
Subject: [Rd] Please explain your workflow from R code -> package -> R
 code -> package
In-Reply-To: <4E6A511F.4090607@gmail.com>
References: <CAErODj_mu8dOujVCJh14d-UbDw9qrq-9CC3MeeCSQ6d28-rJDg@mail.gmail.com>
	<4E6A511F.4090607@gmail.com>
Message-ID: <4E6A567F.8070007@prodsyse.com>

On 9/9/2011 10:47 AM, Duncan Murdoch wrote:
> On 09/09/2011 12:38 PM, Paul Johnson wrote:
>> Hi,
>>
>> I'm asking another one of those questions that would be obvious if I
>> could watch your work while you do it.
>>
>> I'm having trouble understanding the workflow of code and package 
>> maintenance.
>>
>> Stage 1.  Make some R functions in a folder.  This is in a Subversion 
>> repo
>>
>> R/trunk/myproject
>>
>> Stage 2. Make a package:
>>
>> After the package.skeleton, and R check, I have a new folder with the
>> project in it,
>>
>> R/trunk/myproject/mypackage
>>    DESCRIPTION
>>    man
>>    R
>>
>> I to into the man folder and manually edit the Rd files. I don't
>> change anything in the R folder because I think it is OK so far.
>>
>> And eventually I end up with a tarball mypackage_1.0.tar.gz.
>>
>> Stage 3. How to make the round trip? I add more R code, and
>> re-generate a package.
>>
>> package.skeleton obliterates the help files I've already edited.
>
> You should only run it once.  After that, add your code by editing *.R 
> files in the R directory, sourcing them, and generate *.Rd files using 
> prompt().  As Dirk said, run R CMD check when you think you're done, 
> and it will point out how wrong you are.
>> So keeping the R code in sync with the documentation appears to be a 
>> hassle.
>
> If you write the *.Rd file before (like Spencer) or soon after writing 
> the code, then design errors will usually stick out at you, and you 
> can modify the functions.  If you keep your functions small, you'll 
> get them working early, and won't have a lot of problems keeping them 
> in sync with the docs, because they won't change much once you get 
> them right.


For me, the benefits are huge:  I believe I tripled my software 
development productivity almost overnight when I started writing 
documentation with examples (unit tests) before writing the code.  Then 
I run "R CMD check" after every tiny change.  This may seem like extra 
work, but it saves debugging time, because any new problems are likely 
restricted to what I changed.  For example, I write a function A.  Then 
I write B.  Then I write C.  In the process of writing C, I change A.  R 
CMD check after adding C reveals that the change to A broke B.  Without 
the R package discipline, it could easily be a year before a found that 
a bug existed, and then it was an enormous effort to find and fix it.  
(See Wikipedia, "Software repository", "Package development process".)  
In addition to having better code is less time for myself, I can easily 
share the results with others -- thereby increasing my productivity 
substantially more than the factor of three I mentioned.


Spencer


> Duncan Murdoch
>
>> In other languages, I've seen to write the documentation inside the
>> code files and then post-process to make the documentation.  Is there
>> a similar thing for R, to unify the R code development and
>> documentation/package-making process?
>>
>> pj
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From michael.m.spiegel at gmail.com  Fri Sep  9 20:40:42 2011
From: michael.m.spiegel at gmail.com (Michael Spiegel)
Date: Fri, 9 Sep 2011 14:40:42 -0400
Subject: [Rd] R CMD INSTALL configure.args and CC customization
Message-ID: <CANwu5-rGUYrC73vRo04GJCdW_ZQerycbVU4K_2Dun1ytqNXQ7g@mail.gmail.com>

I am running into the following issue that has been previously
reported on the R-devel mailing list. The short version is that I'm
writing a package for MPI, and I'd like to change CC and SHLIB_LD to
"mpicc". Trying to change them in Makevars.in has no effect, because
the values are clobbered by /etc/R/Makeconf. Will the following
changes to Makeconf.in introduce any problems?

--Michael


Subject:	[Rd] R CMD INSTALL configure.args and CC customization	
From:	Paul Johnson (paul... at gmail.com)
Date:	Jan 20, 2010 11:30:44 am
List:	org.r-project.r-devel
Hi, everybody.

I hope the new year is treating you well.

In a Rocks Cluster Linux system (that's Centos 5.2 based), I have
built R-2.10 and it runs well.

While fiddling with MPI libraries and R packages, I've noticed a few
little wrinkles.

This comes as no surprise to the veteran R programmers, but let me
share to the new guys the following gem:

There is a difference between . and -

Simple, and yet so vital!

install.packages inside R takes a period between "configure" and
"args", as in "configure.args=", while in the shell, the same option
specified to R CMD INSTALL wants a dash, as in "--configure-args=".
The "period" versus the "hyphen" was  killing me all morning!

When building Rmpi, I had to specify configure options to let R know
which MPI library to use. I *tried* to avoid that by forcing the
compiler to be "mpicc", not "gcc".   I believe that if one uses mpicc,
then the compiler really is gcc, but it is initiated with the INC and
LIB dirs set so that the configure  can find what it needs. But gcc
seems to be deeply glued to R installation of packages.

I find various posts in the r-help list in which people claim this should work:

CC=mpicc R CMD INSTALL ...

but it doesn't make a difference for me. The compiler that gets used
is gcc, no matter how many different ways I try to say it should be
mpicc:

$ CC=mpicc R CMD INSTALL
--configure-args=--with-mpi=/usr/lib64/openmpi/1.2.7-gcc
--configure-vars=CC=mpicc Rmpi_0.5-8.tar.gz
Password:
* installing to library '/share/apps/lib/R/site-library'
* installing *source* package 'Rmpi' ...
checking for gcc... gcc -m64 -std=gnu99
checking for C compiler default output file name... a.out
checking whether the C compiler works... yes
checking whether we are cross compiling... no
checking for suffix of executables...
checking for suffix of object files... o
checking whether we are using the GNU C compiler... yes
checking whether gcc -m64 -std=gnu99 accepts -g... yes
checking for gcc -m64 -std=gnu99 option to accept ISO C89... none needed
Trying to find mpi.h ...
Found in /usr/lib64/openmpi/1.2.7-gcc/include
Trying to find libmpi.so or libmpich.a ...
Found libmpi in /usr/lib64/openmpi/1.2.7-gcc/lib
checking for openpty in -lutil... yes
checking for main in -lpthread... yes
configure: creating ./config.status
config.status: creating src/Makevars
** libs
gcc -m64 -std=gnu99 -I/usr/include/R -DPACKAGE_NAME=\"\"
-DPACKAGE_TARNAME=\"\" -DPACKAGE_VERSION=\"\" -DPACKAGE_STRING=\"\"
-DPACKAGE_BUGREPORT=\"\" -I/usr/lib64/openmpi/1.2.7-gcc/include
-DMPI2 -DOPENMPI -I/usr/local/include    -fpic  -O2 -g -pipe -Wall
-Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector
--param=ssp-buffer-size=4 -m64 -mtune=generic -c RegQuery.c -o
RegQuery.o
gcc -m64 -std=gnu99 -I/usr/include/R -DPACKAGE_NAME=\"\"
-DPACKAGE_TARNAME=\"\" -DPACKAGE_VERSION=\"\" -DPACKAGE_STRING=\"\"
-DPACKAGE_BUGREPORT=\"\" -I/usr/lib64/openmpi/1.2.7-gcc/include
-DMPI2 -DOPENMPI -I/usr/local/include    -fpic  -O2 -g -pipe -Wall
-Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector
--param=ssp-buffer-size=4 -m64 -mtune=generic -c Rmpi.c -o Rmpi.o
gcc -m64 -std=gnu99 -I/usr/include/R -DPACKAGE_NAME=\"\"
-DPACKAGE_TARNAME=\"\" -DPACKAGE_VERSION=\"\" -DPACKAGE_STRING=\"\"
-DPACKAGE_BUGREPORT=\"\" -I/usr/lib64/openmpi/1.2.7-gcc/include
-DMPI2 -DOPENMPI -I/usr/local/include    -fpic  -O2 -g -pipe -Wall
-Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector
--param=ssp-buffer-size=4 -m64 -mtune=generic -c conversion.c -o
conversion.o
gcc -m64 -std=gnu99 -I/usr/include/R -DPACKAGE_NAME=\"\"
-DPACKAGE_TARNAME=\"\" -DPACKAGE_VERSION=\"\" -DPACKAGE_STRING=\"\"
-DPACKAGE_BUGREPORT=\"\" -I/usr/lib64/openmpi/1.2.7-gcc/include
-DMPI2 -DOPENMPI -I/usr/local/include    -fpic  -O2 -g -pipe -Wall
-Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector
--param=ssp-buffer-size=4 -m64 -mtune=generic -c internal.c -o
internal.o
gcc -m64 -std=gnu99 -shared -L/usr/local/lib64 -o Rmpi.so RegQuery.o
Rmpi.o conversion.o internal.o -L/usr/lib64/openmpi/1.2.7-gcc/lib
-lmpi -lutil -lpthread -L/usr/lib64/R/lib -lR
** R
** demo
** inst
** preparing package for lazy loading
** help
*** installing help indices
** building package indices ...
* DONE (Rmpi)
======================

The same effect (or lack thereof) can be had with configure.vars in
install.packages:

install.packages("Rmpi",
configure.args="--with-mpi=/usr/lib64/openmpi/1.2.7-gcc",
configure.vars="CC=mpicc")
Warning in install.packages("Rmpi", configure.args =
"--with-mpi=/usr/lib64/openmpi/1.2.7-gcc",  :
  argument 'lib' is missing: using '/share/apps/lib/R/site-library'
--- Please select a CRAN mirror for use in this session ---
Loading Tcl/Tk interface ... done
trying URL 'http://cran.mirrors.hoobly.com/src/contrib/Rmpi_0.5-8.tar.gz'
Content type 'application/x-gzip' length 87528 bytes (85 Kb)
opened URL
==================================================
downloaded 85 Kb

* installing *source* package 'Rmpi' ...
checking for gcc... gcc -m64 -std=gnu99
checking for C compiler default output file name... a.out
checking whether the C compiler works... yes
checking whether we are cross compiling... no
checking for suffix of executables...
checking for suffix of object files... o
checking whether we are using the GNU C compiler... yes
checking whether gcc -m64 -std=gnu99 accepts -g... yes
checking for gcc -m64 -std=gnu99 option to accept ISO C89... none needed
Trying to find mpi.h ...
Found in /usr/lib64/openmpi/1.2.7-gcc/include
Trying to find libmpi.so or libmpich.a ...
Found libmpi in /usr/lib64/openmpi/1.2.7-gcc/lib
checking for openpty in -lutil... yes
checking for main in -lpthread... yes
configure: creating ./config.status
config.status: creating src/Makevars
** libs
gcc -m64 -std=gnu99 -I/usr/include/R -DPACKAGE_NAME=\"\"
-DPACKAGE_TARNAME=\"\" -DPACKAGE_VERSION=\"\" -DPACKAGE_STRING=\"\"
-DPACKAGE_BUGREPORT=\"\" -I/usr/lib64/openmpi/1.2.7-gcc/include
-DMPI2 -DOPENMPI -I/usr/local/include    -fpic  -O2 -g -pipe -Wall
-Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector
--param=ssp-buffer-size=4 -m64 -mtune=generic -c RegQuery.c -o
RegQuery.o
gcc -m64 -std=gnu99 -I/usr/include/R -DPACKAGE_NAME=\"\"
-DPACKAGE_TARNAME=\"\" -DPACKAGE_VERSION=\"\" -DPACKAGE_STRING=\"\"
-DPACKAGE_BUGREPORT=\"\" -I/usr/lib64/openmpi/1.2.7-gcc/include
-DMPI2 -DOPENMPI -I/usr/local/include    -fpic  -O2 -g -pipe -Wall
-Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector
--param=ssp-buffer-size=4 -m64 -mtune=generic -c Rmpi.c -o Rmpi.o
gcc -m64 -std=gnu99 -I/usr/include/R -DPACKAGE_NAME=\"\"
-DPACKAGE_TARNAME=\"\" -DPACKAGE_VERSION=\"\" -DPACKAGE_STRING=\"\"
-DPACKAGE_BUGREPORT=\"\" -I/usr/lib64/openmpi/1.2.7-gcc/include
-DMPI2 -DOPENMPI -I/usr/local/include    -fpic  -O2 -g -pipe -Wall
-Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector
--param=ssp-buffer-size=4 -m64 -mtune=generic -c conversion.c -o
conversion.o
gcc -m64 -std=gnu99 -I/usr/include/R -DPACKAGE_NAME=\"\"
-DPACKAGE_TARNAME=\"\" -DPACKAGE_VERSION=\"\" -DPACKAGE_STRING=\"\"
-DPACKAGE_BUGREPORT=\"\" -I/usr/lib64/openmpi/1.2.7-gcc/include
-DMPI2 -DOPENMPI -I/usr/local/include    -fpic  -O2 -g -pipe -Wall
-Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector
--param=ssp-buffer-size=4 -m64 -mtune=generic -c internal.c -o
internal.o
gcc -m64 -std=gnu99 -shared -L/usr/local/lib64 -o Rmpi.so RegQuery.o
Rmpi.o conversion.o internal.o -L/usr/lib64/openmpi/1.2.7-gcc/lib
-lmpi -lutil -lpthread -L/usr/lib64/R/lib -lR
** R
** demo
** inst
** preparing package for lazy loading
** help
*** installing help indices
** building package indices ...
* DONE (Rmpi)

-- 
Paul E. Johnson
Professor, Political Science
1541 Lilac Lane, Room 504
University of Kansas
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Makeconf.in.patch
Type: text/x-patch
Size: 599 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20110909/61152097/attachment.bin>

From hadley at rice.edu  Fri Sep  9 20:41:39 2011
From: hadley at rice.edu (Hadley Wickham)
Date: Fri, 9 Sep 2011 13:41:39 -0500
Subject: [Rd] Please explain your workflow from R code -> package -> R
 code -> package
In-Reply-To: <20074.20512.95925.44559@max.nulle.part>
References: <CAErODj_mu8dOujVCJh14d-UbDw9qrq-9CC3MeeCSQ6d28-rJDg@mail.gmail.com>
	<20074.20512.95925.44559@max.nulle.part>
Message-ID: <CABdHhvE2amMC=DVr1tykkrnLZ3c5omSJPcHhoC9EuH4tpvXBWQ@mail.gmail.com>

> | In other languages, I've seen to write the documentation inside the
> | code files and then post-process to make the documentation. ?Is there
> | a similar thing for R, to unify the R code development and
> | documentation/package-making process?
>
> You can also follow the cool kids who these days tie some of this together
> using roxygen.

It's not the cool kids who are doing this, it's the lazy kids ;)
Roxygen(2) does remove a considerable amount of replication between
code and documentation (e.g. replicating function usage in two
places), and the close proximity between code and documentation does
make it easier to remember to update your documentation when the code
changes.

Roxygen2 adds a few other tools for reducing duplication like
templates, the ability to inherit parameter documentation from other
function, and the family tag to automatically add seealso references
between all members of a related family of functions.  These are
things that are painful to do by hand and add a significance
maintenance burden.

I agree that there's no silver bullet, but good tools certainly can
make life easier.

Hadley

-- 
Assistant Professor / Dobelman Family Junior Chair
Department of Statistics / Rice University
http://had.co.nz/


From hadley at rice.edu  Fri Sep  9 20:43:43 2011
From: hadley at rice.edu (Hadley Wickham)
Date: Fri, 9 Sep 2011 13:43:43 -0500
Subject: [Rd] Please explain your workflow from R code -> package -> R
 code -> package
In-Reply-To: <4E6A567F.8070007@prodsyse.com>
References: <CAErODj_mu8dOujVCJh14d-UbDw9qrq-9CC3MeeCSQ6d28-rJDg@mail.gmail.com>
	<4E6A511F.4090607@gmail.com> <4E6A567F.8070007@prodsyse.com>
Message-ID: <CABdHhvFoFkNHOfWwH0SuZhNBcFkAASGG=zJW_E--Rf5REp-1fA@mail.gmail.com>

>> If you write the *.Rd file before (like Spencer) or soon after writing the
>> code, then design errors will usually stick out at you, and you can modify
>> the functions. ?If you keep your functions small, you'll get them working
>> early, and won't have a lot of problems keeping them in sync with the docs,
>> because they won't change much once you get them right.
>
> For me, the benefits are huge: ?I believe I tripled my software development
> productivity almost overnight when I started writing documentation with
> examples (unit tests) before writing the code. ?Then I run "R CMD check"
> after every tiny change. ?This may seem like extra work, but it saves
> debugging time, because any new problems are likely restricted to what I
> changed. ?For example, I write a function A. ?Then I write B. ?Then I write
> C. ?In the process of writing C, I change A. ?R CMD check after adding C
> reveals that the change to A broke B. ?Without the R package discipline, it
> could easily be a year before a found that a bug existed, and then it was an
> enormous effort to find and fix it. ?(See Wikipedia, "Software repository",
> "Package development process".) ?In addition to having better code is less
> time for myself, I can easily share the results with others -- thereby
> increasing my productivity substantially more than the factor of three I
> mentioned.

The eventual goal for the devtools package is to make this fast and
completely automated, so that while you are editing your package you
have another window open that detects any problems as soon as you make
them.  This isn't quite possible with R CMD check because it's so
thorough, which tends to make it rather slow.  But if you know what's
changed, you should be able to selectively figure out what pieces of
the check to run.

Hadley


-- 
Assistant Professor / Dobelman Family Junior Chair
Department of Statistics / Rice University
http://had.co.nz/


From wmichaelking1 at gmail.com  Fri Sep  9 22:07:25 2011
From: wmichaelking1 at gmail.com (Michael King)
Date: Fri, 9 Sep 2011 16:07:25 -0400
Subject: [Rd] Saving Rcpp Objects for Future Use
Message-ID: <CAO1znps6wtbK+L=imO5FD47w=ZHZZLnL=SUcaKM1FcjwXrVhdw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20110909/d9c3f804/attachment.pl>

From simon.urbanek at r-project.org  Fri Sep  9 23:32:33 2011
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Fri, 9 Sep 2011 17:32:33 -0400
Subject: [Rd] As a package author,
	is there a way to specify that your package is architecture
	(x86_64) specific?
In-Reply-To: <CAHA9McMUjnvWbe5MoriwioBspOAiqJwZTv3e4k9YUUTg_Mj9jA@mail.gmail.com>
References: <CAHA9McPk2acp1UknAPO2KaFtkb=YquA=XiwwhSXagnZGCh3USw@mail.gmail.com>
	<9AFCA8AB-5CF1-4E78-ACBF-93C53E8EF095@r-project.org>
	<CAHA9McO7-gQ0_Ez+ejJRkHXM-nbtAi1qRL3CKG4kc5cfrVCxCA@mail.gmail.com>
	<alpine.LFD.2.02.1109091330510.10017@gannet.stats.ox.ac.uk>
	<A8EB1004-FAD1-4639-81B3-B9256BAACA58@r-project.org>
	<CAHA9McMUjnvWbe5MoriwioBspOAiqJwZTv3e4k9YUUTg_Mj9jA@mail.gmail.com>
Message-ID: <136FE422-890F-4983-B6B8-5B667B39EFAF@r-project.org>


On Sep 9, 2011, at 10:30 AM, Steve Lianoglou wrote:

> Hi Simon, Prof. Ripley, and Dirk,
> 
> First: thanks again for the tips, it's great to have some of the "top
> bRass" providing this type of help.
> 
> Last (few) comments in line:
> 
> On Fri, Sep 9, 2011 at 9:41 AM, Simon Urbanek
> <simon.urbanek at r-project.org> wrote:
>> On Sep 9, 2011, at 8:36 AM, Prof Brian Ripley wrote:
>>> On Thu, 8 Sep 2011, Steve Lianoglou wrote:
> 
> [snip]
> 
> About the architecture thing:
> 
>>>> Ok, sorry for being imprecise. Let's see if we can figure out what it
>>>> is (more precise details are at the bottom of the email). I see x86_64
>>>> on every 64bit machine I touch (linux or mac), so I thought they were
>>>> interchangeable (as names).
>>> 
>>> Not so.  That's not what Windows uses (it mainly uses x64, sometimes amd64 or x86-64, almost never x86_64), and although it is what Solaris uses, your Linux x86_64 assembler (presumably GNU) will not work there.
>>> 
>> 
>> Moreover not all 64-bit machines are x86_64/amd64 - there is ppc64, Sparc, MIPS64, IA64, ... which was my point about this having to do with a very particular machine type (and my suspicion involving asm was correct ;)) and not 64-bit architectures in general.
> 
> Right, of course ... as soon as you mentioned ppc64, the distinction
> you folks were trying to point out was immediately clear, thanks.
> 
> [snip]
> 
> About the configure/autoconf testing thing:
> 
>>> You try to compile the crucial fragament of code in configure: there are lots of examples of that in the R sources (mainly in the m4 directory).
>> 
>> Yes, that is the right thing to do. It's only a few lines of configure.in if you want to use autoconf, but if you don't, it's still fairly easy in pure shell code, just a bit more legwork.
> 
> OK, thanks for that, too.
> 
> So, last question here -- say I catch this error condition during the
> configure (or shell) check code, and I realize that some bit of code
> won't work on this machine type.
> 
> How do I signal to R's build/compile process to "error out" on the
> package build proces, but just move on to the next arch/machine-type
> it should try to compile?
> 
> I mean: I can imagine how one could catch an error during the compile
> test and then define some var that an `#ifdef SOMETHING` could be used
> in my codebase to do one thing or the other, but in this case I'm not
> trying to direct the compiler down a different codepath that will work
> for the machine type (for now), I just want it to give up on the
> current build and try the build for the next machine-type in line.
> 

You can't. Your packages either builds or not. And as you should know by now there is no "next matching-type" in line since configure guarantees just one arch.

So you have two options:

a) fail on unsupported architecture. That means only if the architecture is supported there will be a binary. Simple and clean.

b) let configure detect the support and flag it. Then you can #ifdef your code and create a stub that simply calls Rf_error("unsupported architecture"). In fact in your particular case you could even possibly get away with #if __x86_64__ and no configure. It's less clean because the user doesn't know that your package doesn't work and may be clumsy if you have several R entry points.

Cheers,
Simon


From mailinglist.honeypot at gmail.com  Sat Sep 10 00:29:23 2011
From: mailinglist.honeypot at gmail.com (Steve Lianoglou)
Date: Fri, 9 Sep 2011 18:29:23 -0400
Subject: [Rd] As a package author,
 is there a way to specify that your package is architecture
 (x86_64) specific?
In-Reply-To: <136FE422-890F-4983-B6B8-5B667B39EFAF@r-project.org>
References: <CAHA9McPk2acp1UknAPO2KaFtkb=YquA=XiwwhSXagnZGCh3USw@mail.gmail.com>
	<9AFCA8AB-5CF1-4E78-ACBF-93C53E8EF095@r-project.org>
	<CAHA9McO7-gQ0_Ez+ejJRkHXM-nbtAi1qRL3CKG4kc5cfrVCxCA@mail.gmail.com>
	<alpine.LFD.2.02.1109091330510.10017@gannet.stats.ox.ac.uk>
	<A8EB1004-FAD1-4639-81B3-B9256BAACA58@r-project.org>
	<CAHA9McMUjnvWbe5MoriwioBspOAiqJwZTv3e4k9YUUTg_Mj9jA@mail.gmail.com>
	<136FE422-890F-4983-B6B8-5B667B39EFAF@r-project.org>
Message-ID: <CAHA9McOo2WvAnXDoFJm6p5+22-3GTvz5LWQeDY0HKWv=0b-htg@mail.gmail.com>

Hi Simon,

On Fri, Sep 9, 2011 at 5:32 PM, Simon Urbanek
<simon.urbanek at r-project.org> wrote:
>
> On Sep 9, 2011, at 10:30 AM, Steve Lianoglou wrote:
>
>> Hi Simon, Prof. Ripley, and Dirk,
>>
>> First: thanks again for the tips, it's great to have some of the "top
>> bRass" providing this type of help.
>>
>> Last (few) comments in line:
>>
>> On Fri, Sep 9, 2011 at 9:41 AM, Simon Urbanek
>> <simon.urbanek at r-project.org> wrote:
>>> On Sep 9, 2011, at 8:36 AM, Prof Brian Ripley wrote:
>>>> On Thu, 8 Sep 2011, Steve Lianoglou wrote:
>>
>> [snip]
>>
>> About the architecture thing:
>>
>>>>> Ok, sorry for being imprecise. Let's see if we can figure out what it
>>>>> is (more precise details are at the bottom of the email). I see x86_64
>>>>> on every 64bit machine I touch (linux or mac), so I thought they were
>>>>> interchangeable (as names).
>>>>
>>>> Not so. ?That's not what Windows uses (it mainly uses x64, sometimes amd64 or x86-64, almost never x86_64), and although it is what Solaris uses, your Linux x86_64 assembler (presumably GNU) will not work there.
>>>>
>>>
>>> Moreover not all 64-bit machines are x86_64/amd64 - there is ppc64, Sparc, MIPS64, IA64, ... which was my point about this having to do with a very particular machine type (and my suspicion involving asm was correct ;)) and not 64-bit architectures in general.
>>
>> Right, of course ... as soon as you mentioned ppc64, the distinction
>> you folks were trying to point out was immediately clear, thanks.
>>
>> [snip]
>>
>> About the configure/autoconf testing thing:
>>
>>>> You try to compile the crucial fragament of code in configure: there are lots of examples of that in the R sources (mainly in the m4 directory).
>>>
>>> Yes, that is the right thing to do. It's only a few lines of configure.in if you want to use autoconf, but if you don't, it's still fairly easy in pure shell code, just a bit more legwork.
>>
>> OK, thanks for that, too.
>>
>> So, last question here -- say I catch this error condition during the
>> configure (or shell) check code, and I realize that some bit of code
>> won't work on this machine type.
>>
>> How do I signal to R's build/compile process to "error out" on the
>> package build proces, but just move on to the next arch/machine-type
>> it should try to compile?
>>
>> I mean: I can imagine how one could catch an error during the compile
>> test and then define some var that an `#ifdef SOMETHING` could be used
>> in my codebase to do one thing or the other, but in this case I'm not
>> trying to direct the compiler down a different codepath that will work
>> for the machine type (for now), I just want it to give up on the
>> current build and try the build for the next machine-type in line.
>>
>
> You can't. Your packages either builds or not. And as you should know by now there is no "next matching-type" in line since configure guarantees just one arch.
>
> So you have two options:
>
> a) fail on unsupported architecture. That means only if the architecture is supported there will be a binary. Simple and clean.
>
> b) let configure detect the support and flag it. Then you can #ifdef your code and create a stub that simply calls Rf_error("unsupported architecture"). In fact in your particular case you could even possibly get away with #if __x86_64__ and no configure. It's less clean because the user doesn't know that your package doesn't work and may be clumsy if you have several R entry points.

Ah! I didn't even think of throwing an Rf_error() from within the code
that would fail, thanks.

It's not pretty but it does the trick for now.

Thanks again for all the help,

-steve

-- 
Steve Lianoglou
Graduate Student: Computational Systems Biology
?| Memorial Sloan-Kettering Cancer Center
?| Weill Medical College of Cornell University
Contact Info: http://cbio.mskcc.org/~lianos/contact


From edd at debian.org  Sat Sep 10 00:52:00 2011
From: edd at debian.org (Dirk Eddelbuettel)
Date: Fri, 9 Sep 2011 17:52:00 -0500
Subject: [Rd] Saving Rcpp Objects for Future Use
In-Reply-To: <CAO1znps6wtbK+L=imO5FD47w=ZHZZLnL=SUcaKM1FcjwXrVhdw@mail.gmail.com>
References: <CAO1znps6wtbK+L=imO5FD47w=ZHZZLnL=SUcaKM1FcjwXrVhdw@mail.gmail.com>
Message-ID: <20074.39056.354600.986451@max.nulle.part>


Hola,

On 9 September 2011 at 16:07, Michael King wrote:
| Hello,
| 
| I have recently been doing some research regarding how to successfully save
| and load Rcpp Objects ( objects from modules ) for future use, but with
| little success. For example, to use the example package (from package
| skeleton) in Rcpp:
| 
| >library(Rcpp)
| >Rcpp.package.skeleton("rdevelhelp", module=TRUE)
| ...
| > q()
| // install rdevelhelp using R CMD INSTALL
| // load new R Session
| 
| >library(rdevelhelp)
| >x <- new(World)
| >x$set("help me")
| >x$greet()
| "help me"
| >save(x, "x.RData")
| >q()
| 
| // reload R
| >library(rdevelhelp)
| >load("x.RData")
| > ### here comes the problem...
| > x$greet()
| Error in .External(list(name = "CppMethod__invoke_notvoid", address =
| <pointer: 0x0>,  :
|   NULL value passed as symbol address
| >q()
| 
| ################
| 
| is there a best practice to solving this problem? I have read some posts
| about external pointers and have learned a little about serialization, but
| want to make sure I am approaching the problem correctly.

This has been discussed several times _on the list dedicated to Rcpp
question_ ie rcpp-devel.  You could try a search such as 

    site:gmane.org rcpp-devel 'reload module'

to catch some of those.  

But in short: the load / save cycle is simply not available for Rcpp modules
objects. 
 
| Thanks for your help.

Pleasure. Hope to see you over at rcpp-devel. Subscribe before you try to post.

Dirk
 
| -Mike
| 
| 	[[alternative HTML version deleted]]
| 
| ______________________________________________
| R-devel at r-project.org mailing list
| https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Two new Rcpp master classes for R and C++ integration scheduled for 
New York (Sep 24) and San Francisco (Oct 8), more details are at
http://dirk.eddelbuettel.com/blog/2011/08/04#rcpp_classes_2011-09_and_2011-10
http://www.revolutionanalytics.com/products/training/public/rcpp-master-class.php


From baptiste.auguie at googlemail.com  Sat Sep 10 04:04:42 2011
From: baptiste.auguie at googlemail.com (baptiste auguie)
Date: Sat, 10 Sep 2011 14:04:42 +1200
Subject: [Rd] Please explain your workflow from R code -> package -> R
 code -> package
In-Reply-To: <CABdHhvE2amMC=DVr1tykkrnLZ3c5omSJPcHhoC9EuH4tpvXBWQ@mail.gmail.com>
References: <CAErODj_mu8dOujVCJh14d-UbDw9qrq-9CC3MeeCSQ6d28-rJDg@mail.gmail.com>
	<20074.20512.95925.44559@max.nulle.part>
	<CABdHhvE2amMC=DVr1tykkrnLZ3c5omSJPcHhoC9EuH4tpvXBWQ@mail.gmail.com>
Message-ID: <CANLFJPow+PHkAE0s2Wp1zoN_-zHe5t8cNhG4=TBVzhWCyq21QA@mail.gmail.com>

+1 for roxygen2, lazycoolness oblige.

An alternative that has not been mentioned is inlinedocs,
http://inlinedocs.r-forge.r-project.org/
I don't use it myself, but it might appeal to your workflow.

baptiste


On 10 September 2011 06:41, Hadley Wickham <hadley at rice.edu> wrote:
>> | In other languages, I've seen to write the documentation inside the
>> | code files and then post-process to make the documentation. ?Is there
>> | a similar thing for R, to unify the R code development and
>> | documentation/package-making process?
>>
>> You can also follow the cool kids who these days tie some of this together
>> using roxygen.
>
> It's not the cool kids who are doing this, it's the lazy kids ;)
> Roxygen(2) does remove a considerable amount of replication between
> code and documentation (e.g. replicating function usage in two
> places), and the close proximity between code and documentation does
> make it easier to remember to update your documentation when the code
> changes.
>
> Roxygen2 adds a few other tools for reducing duplication like
> templates, the ability to inherit parameter documentation from other
> function, and the family tag to automatically add seealso references
> between all members of a related family of functions. ?These are
> things that are painful to do by hand and add a significance
> maintenance burden.
>
> I agree that there's no silver bullet, but good tools certainly can
> make life easier.
>
> Hadley
>
> --
> Assistant Professor / Dobelman Family Junior Chair
> Department of Statistics / Rice University
> http://had.co.nz/
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From b.rowlingson at lancaster.ac.uk  Sat Sep 10 10:21:34 2011
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Sat, 10 Sep 2011 09:21:34 +0100
Subject: [Rd] Please explain your workflow from R code -> package -> R
 code -> package
In-Reply-To: <CABdHhvE2amMC=DVr1tykkrnLZ3c5omSJPcHhoC9EuH4tpvXBWQ@mail.gmail.com>
References: <CAErODj_mu8dOujVCJh14d-UbDw9qrq-9CC3MeeCSQ6d28-rJDg@mail.gmail.com>
	<20074.20512.95925.44559@max.nulle.part>
	<CABdHhvE2amMC=DVr1tykkrnLZ3c5omSJPcHhoC9EuH4tpvXBWQ@mail.gmail.com>
Message-ID: <CANVKczPUc=iqL8R9HL8cxxyBrS_LrurCQCOBtgfHdoGYk=3abQ@mail.gmail.com>

On Fri, Sep 9, 2011 at 7:41 PM, Hadley Wickham <hadley at rice.edu> wrote:

> It's not the cool kids who are doing this, it's the lazy kids ;)

 laziness being one of the three virtues of a programmer. The other
two being hubris and something else I don't have time to look up at
the moment.

 library(fortunes) fodder: "Don't do as I say, do as Hadley does."

-- 
blog: http://geospaced.blogspot.com/
web: http://www.maths.lancs.ac.uk/~rowlings
web: http://www.rowlingson.com/
twitter: http://twitter.com/geospacedman
pics: http://www.flickr.com/photos/spacedman


From alastair.andrew at gmail.com  Sat Sep 10 13:26:08 2011
From: alastair.andrew at gmail.com (Alastair)
Date: Sat, 10 Sep 2011 04:26:08 -0700 (PDT)
Subject: [Rd] Is xtable still being maintained?
Message-ID: <1315653968946-3803657.post@n4.nabble.com>

Hi,

I wonder if anyone knows if the xtable package is still actively being
maintained? The last update to the CRAN was about 2 years ago. Earlier in
the year I found I wanted to use the short caption option of LaTeX tables to
display an abridged title in my table of contents. It was a relatively
simple change to get xtable to support this. I bundled up my changes and
sent the maintainer David B. Dahl an email and I got absolutely no response?
What's the etiquette for this kind of situation? I think he's done a
sterling job maintaining a really useful package; I wanted to help and
contribute to the community but if he's not doing it anymore how can anyone
get their improvements / bug fixes into circulation?

Cheers,
Alastair

--
View this message in context: http://r.789695.n4.nabble.com/Is-xtable-still-being-maintained-tp3803657p3803657.html
Sent from the R devel mailing list archive at Nabble.com.


From ligges at statistik.tu-dortmund.de  Sat Sep 10 15:06:17 2011
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Sat, 10 Sep 2011 15:06:17 +0200
Subject: [Rd] Is xtable still being maintained?
In-Reply-To: <1315653968946-3803657.post@n4.nabble.com>
References: <1315653968946-3803657.post@n4.nabble.com>
Message-ID: <4E6B60C9.4040007@statistik.tu-dortmund.de>



On 10.09.2011 13:26, Alastair wrote:
> Hi,
>
> I wonder if anyone knows if the xtable package is still actively being
> maintained? The last update to the CRAN was about 2 years ago. Earlier in
> the year I found I wanted to use the short caption option of LaTeX tables to
> display an abridged title in my table of contents. It was a relatively
> simple change to get xtable to support this. I bundled up my changes and
> sent the maintainer David B. Dahl an email and I got absolutely no response?

Try to "ping" - at least I do so in this case. No response would be 
unfortunate, of course.


> What's the etiquette for this kind of situation? I think he's done a
> sterling job maintaining a really useful package; I wanted to help and
> contribute to the community but if he's not doing it anymore how can anyone
> get their improvements / bug fixes into circulation?

xtable's DESCRIPTION file says

License:            GPL (>= 2)

so go ahead in case you do not get a response.

Best,
Uwe Ligges


>
> Cheers,
> Alastair
>
> --
> View this message in context: http://r.789695.n4.nabble.com/Is-xtable-still-being-maintained-tp3803657p3803657.html
> Sent from the R devel mailing list archive at Nabble.com.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From spencer.graves at prodsyse.com  Sat Sep 10 16:40:24 2011
From: spencer.graves at prodsyse.com (Spencer Graves)
Date: Sat, 10 Sep 2011 07:40:24 -0700
Subject: [Rd] Is xtable still being maintained?
In-Reply-To: <4E6B60C9.4040007@statistik.tu-dortmund.de>
References: <1315653968946-3803657.post@n4.nabble.com>
	<4E6B60C9.4040007@statistik.tu-dortmund.de>
Message-ID: <4E6B76D8.4090302@prodsyse.com>



On 9/10/2011 6:06 AM, Uwe Ligges wrote:
>
>
> On 10.09.2011 13:26, Alastair wrote:
>> Hi,
>>
>> I wonder if anyone knows if the xtable package is still actively being
>> maintained? The last update to the CRAN was about 2 years ago. 
>> Earlier in
>> the year I found I wanted to use the short caption option of LaTeX 
>> tables to
>> display an abridged title in my table of contents. It was a relatively
>> simple change to get xtable to support this. I bundled up my changes and
>> sent the maintainer David B. Dahl an email and I got absolutely no 
>> response?
>
> Try to "ping" - at least I do so in this case. No response would be 
> unfortunate, of course.


       David B. Dahl still has a web site as an Associate Professor at 
Texas A&M U.
>
>
>> What's the etiquette for this kind of situation? I think he's done a
>> sterling job maintaining a really useful package; I wanted to help and
>> contribute to the community but if he's not doing it anymore how can 
>> anyone
>> get their improvements / bug fixes into circulation?
>
> xtable's DESCRIPTION file says
>
> License:            GPL (>= 2)
>
> so go ahead in case you do not get a response.
>
> Best,
> Uwe Ligges


      xtable has a long list of reverse depends, imports, suggests and 
enhances, so many people clearly think it's useful.


       My preference is to encourage the maintainer(s) to migrate the 
project to R-Forge where others can help maintain it and add 
enhancements (that shouldn't break current applications) that people 
feel are generally useful.  (Not everyone responds positively to this 
kind of suggestion, but some do.)


       R-Forge also lists tabulaR, which "is a comprehensive package for 
presenting quality tabular output within the R Environment. Differing 
from xtable and Hmisc, it manipulates, formats and presents tabular data 
to any R device stream, which can then be used by any structured 
format."  So far, however, I was unable to find evidence that the the 
tabulaR team has done anything for with R-Forge beyond successfully 
getting a shell created for the project.


       Good luck!
       Spencer
>
>
>>
>> Cheers,
>> Alastair
>>
>> -- 
>> View this message in context: 
>> http://r.789695.n4.nabble.com/Is-xtable-still-being-maintained-tp3803657p3803657.html
>> Sent from the R devel mailing list archive at Nabble.com.
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


-- 
Spencer Graves, PE, PhD
President and Chief Technology Officer
Structure Inspection and Monitoring, Inc.
751 Emerson Ct.
San Jos?, CA 95126
ph:  408-655-4567
web:  www.structuremonitoring.com


From jeffrey.ryan at lemnica.com  Sat Sep 10 17:08:17 2011
From: jeffrey.ryan at lemnica.com (Jeffrey Ryan)
Date: Sat, 10 Sep 2011 10:08:17 -0500
Subject: [Rd] Is xtable still being maintained?
In-Reply-To: <4E6B76D8.4090302@prodsyse.com>
References: <1315653968946-3803657.post@n4.nabble.com>
	<4E6B60C9.4040007@statistik.tu-dortmund.de>
	<4E6B76D8.4090302@prodsyse.com>
Message-ID: <CABDUZc--KtjuA2zW9bYSiP-=-WcBAddZfJ1iDmB25-XSzSq2Qg@mail.gmail.com>

I would be leery of just taking over as maintainer if a package still
works and passes all checks on CRAN.

My personal take is that even commercial packages ignore feature
requests, and to expect such from an OSS one is expecting too much.
Of course patches are welcomed, but they can't honestly be expected to
be committed.  Even if they are they may be a low priority for the
maintainer/author - be it for style, design, or
implementation/maintenance purposes.

My suggestion would be to continue to ask, but if that doesn't work
simply build an extension that others might be able to use with xtable
in this case (xtableExtras??). In the absolute last case I would fork
it if you feel the need and the intense desire to maintain a whole new
version.  The caveat of adding another package that duplicates, but
only adds one feature (however amazing you think), isn't likely to be
helpful to the entire R universe - in fact it is likely harmful.

my 2c
Jeff

On Sat, Sep 10, 2011 at 9:40 AM, Spencer Graves
<spencer.graves at prodsyse.com> wrote:
>
>
> On 9/10/2011 6:06 AM, Uwe Ligges wrote:
>>
>>
>> On 10.09.2011 13:26, Alastair wrote:
>>>
>>> Hi,
>>>
>>> I wonder if anyone knows if the xtable package is still actively being
>>> maintained? The last update to the CRAN was about 2 years ago. Earlier in
>>> the year I found I wanted to use the short caption option of LaTeX tables
>>> to
>>> display an abridged title in my table of contents. It was a relatively
>>> simple change to get xtable to support this. I bundled up my changes and
>>> sent the maintainer David B. Dahl an email and I got absolutely no
>>> response?
>>
>> Try to "ping" - at least I do so in this case. No response would be
>> unfortunate, of course.
>
>
> ? ? ?David B. Dahl still has a web site as an Associate Professor at Texas
> A&M U.
>>
>>
>>> What's the etiquette for this kind of situation? I think he's done a
>>> sterling job maintaining a really useful package; I wanted to help and
>>> contribute to the community but if he's not doing it anymore how can
>>> anyone
>>> get their improvements / bug fixes into circulation?
>>
>> xtable's DESCRIPTION file says
>>
>> License: ? ? ? ? ? ?GPL (>= 2)
>>
>> so go ahead in case you do not get a response.
>>
>> Best,
>> Uwe Ligges
>
>
> ? ? xtable has a long list of reverse depends, imports, suggests and
> enhances, so many people clearly think it's useful.
>
>
> ? ? ?My preference is to encourage the maintainer(s) to migrate the project
> to R-Forge where others can help maintain it and add enhancements (that
> shouldn't break current applications) that people feel are generally useful.
> ?(Not everyone responds positively to this kind of suggestion, but some do.)
>
>
> ? ? ?R-Forge also lists tabulaR, which "is a comprehensive package for
> presenting quality tabular output within the R Environment. Differing from
> xtable and Hmisc, it manipulates, formats and presents tabular data to any R
> device stream, which can then be used by any structured format." ?So far,
> however, I was unable to find evidence that the the tabulaR team has done
> anything for with R-Forge beyond successfully getting a shell created for
> the project.
>
>
> ? ? ?Good luck!
> ? ? ?Spencer
>>
>>
>>>
>>> Cheers,
>>> Alastair
>>>
>>> --
>>> View this message in context:
>>> http://r.789695.n4.nabble.com/Is-xtable-still-being-maintained-tp3803657p3803657.html
>>> Sent from the R devel mailing list archive at Nabble.com.
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
>
> --
> Spencer Graves, PE, PhD
> President and Chief Technology Officer
> Structure Inspection and Monitoring, Inc.
> 751 Emerson Ct.
> San Jos?, CA 95126
> ph: ?408-655-4567
> web: ?www.structuremonitoring.com
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>



-- 
Jeffrey Ryan
jeffrey.ryan at lemnica.com

www.lemnica.com
www.esotericR.com


From moshersteven at gmail.com  Sat Sep 10 18:23:35 2011
From: moshersteven at gmail.com (steven mosher)
Date: Sat, 10 Sep 2011 09:23:35 -0700
Subject: [Rd] Please explain your workflow from R code -> package -> R
 code -> package
In-Reply-To: <CABdHhvE2amMC=DVr1tykkrnLZ3c5omSJPcHhoC9EuH4tpvXBWQ@mail.gmail.com>
References: <CAErODj_mu8dOujVCJh14d-UbDw9qrq-9CC3MeeCSQ6d28-rJDg@mail.gmail.com>
	<20074.20512.95925.44559@max.nulle.part>
	<CABdHhvE2amMC=DVr1tykkrnLZ3c5omSJPcHhoC9EuH4tpvXBWQ@mail.gmail.com>
Message-ID: <CAFFLneTg2EuSL+fnLnhybwnvhxVBHyraiAMmLjCJ0rqvFXzwTQ@mail.gmail.com>

All I need now is a tool to go through the 4 packages I already
created without Roxygen and  spit out source files with the Roxygen
comments in them...

really lazy.



On Fri, Sep 9, 2011 at 11:41 AM, Hadley Wickham <hadley at rice.edu> wrote:
>> | In other languages, I've seen to write the documentation inside the
>> | code files and then post-process to make the documentation. ?Is there
>> | a similar thing for R, to unify the R code development and
>> | documentation/package-making process?
>>
>> You can also follow the cool kids who these days tie some of this together
>> using roxygen.
>
> It's not the cool kids who are doing this, it's the lazy kids ;)
> Roxygen(2) does remove a considerable amount of replication between
> code and documentation (e.g. replicating function usage in two
> places), and the close proximity between code and documentation does
> make it easier to remember to update your documentation when the code
> changes.
>
> Roxygen2 adds a few other tools for reducing duplication like
> templates, the ability to inherit parameter documentation from other
> function, and the family tag to automatically add seealso references
> between all members of a related family of functions. ?These are
> things that are painful to do by hand and add a significance
> maintenance burden.
>
> I agree that there's no silver bullet, but good tools certainly can
> make life easier.
>
> Hadley
>
> --
> Assistant Professor / Dobelman Family Junior Chair
> Department of Statistics / Rice University
> http://had.co.nz/
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From josh.m.ulrich at gmail.com  Sat Sep 10 18:31:21 2011
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Sat, 10 Sep 2011 11:31:21 -0500
Subject: [Rd] Please explain your workflow from R code -> package -> R
 code -> package
In-Reply-To: <CAFFLneTg2EuSL+fnLnhybwnvhxVBHyraiAMmLjCJ0rqvFXzwTQ@mail.gmail.com>
References: <CAErODj_mu8dOujVCJh14d-UbDw9qrq-9CC3MeeCSQ6d28-rJDg@mail.gmail.com>
	<20074.20512.95925.44559@max.nulle.part>
	<CABdHhvE2amMC=DVr1tykkrnLZ3c5omSJPcHhoC9EuH4tpvXBWQ@mail.gmail.com>
	<CAFFLneTg2EuSL+fnLnhybwnvhxVBHyraiAMmLjCJ0rqvFXzwTQ@mail.gmail.com>
Message-ID: <CAPPM_gSaWYBtownMCT_LcAQkCX-OWfWB7OkWG_Ww6RWDOR8f8w@mail.gmail.com>

On Sat, Sep 10, 2011 at 11:23 AM, steven mosher <moshersteven at gmail.com> wrote:
> All I need now is a tool to go through the 4 packages I already
> created without Roxygen and ?spit out source files with the Roxygen
> comments in them...
>
> really lazy.
>
>
That's what Rd2roxygen does...

Best,
--
Joshua Ulrich  |  FOSS Trading: www.fosstrading.com



>
> On Fri, Sep 9, 2011 at 11:41 AM, Hadley Wickham <hadley at rice.edu> wrote:
>>> | In other languages, I've seen to write the documentation inside the
>>> | code files and then post-process to make the documentation. ?Is there
>>> | a similar thing for R, to unify the R code development and
>>> | documentation/package-making process?
>>>
>>> You can also follow the cool kids who these days tie some of this together
>>> using roxygen.
>>
>> It's not the cool kids who are doing this, it's the lazy kids ;)
>> Roxygen(2) does remove a considerable amount of replication between
>> code and documentation (e.g. replicating function usage in two
>> places), and the close proximity between code and documentation does
>> make it easier to remember to update your documentation when the code
>> changes.
>>
>> Roxygen2 adds a few other tools for reducing duplication like
>> templates, the ability to inherit parameter documentation from other
>> function, and the family tag to automatically add seealso references
>> between all members of a related family of functions. ?These are
>> things that are painful to do by hand and add a significance
>> maintenance burden.
>>
>> I agree that there's no silver bullet, but good tools certainly can
>> make life easier.
>>
>> Hadley
>>
>> --
>> Assistant Professor / Dobelman Family Junior Chair
>> Department of Statistics / Rice University
>> http://had.co.nz/
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From nashjc at uottawa.ca  Sat Sep 10 18:31:47 2011
From: nashjc at uottawa.ca (John C Nash)
Date: Sat, 10 Sep 2011 12:31:47 -0400
Subject: [Rd] control list gotcha
Message-ID: <4E6B90F3.4030404@uottawa.ca>

This is mainly a reminder to others developing R packages to be careful not to supply
control list items that are not used by the called package. Optimx is a wrapper package
that aims to provide a common syntax to a number of existing optimization packages.
Recently in extending optimx package I inadvertently introduced a new control for optimx
which is NOT in any of the wrapped optimization packages. There are probably other methods
of keeping things tidy, but I copy the control list and null out unwanted elements for
each of the called packages. I missed this in a couple of places in the R-forge
development version of optimx (I'm working on fixing these, but they are still there at
the moment).

The "nasty" here was that the package mostly works, with plausible but not very good
results for some of the optimizers. If it crashed and burned, it would have been noticed
sooner. There is also a potential interaction with a use of the dot-dot-dot variable to
pass scaling information.

If there are ideas on how to quickly reveal errors related to calling sequences involving
control lists and "...", I'd welcome them (off-list?), and be prepared to summarize
findings in a vignette.

Best,

JN


From ggrothendieck at gmail.com  Sat Sep 10 19:08:59 2011
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sat, 10 Sep 2011 13:08:59 -0400
Subject: [Rd] control list gotcha
In-Reply-To: <4E6B90F3.4030404@uottawa.ca>
References: <4E6B90F3.4030404@uottawa.ca>
Message-ID: <CAP01uRn6Dm=Q72vUUB7jiAWOrRhHc9eSf5F2OY-7hbfdW4EafQ@mail.gmail.com>

On Sat, Sep 10, 2011 at 12:31 PM, John C Nash <nashjc at uottawa.ca> wrote:
> This is mainly a reminder to others developing R packages to be careful not to supply
> control list items that are not used by the called package. Optimx is a wrapper package
> that aims to provide a common syntax to a number of existing optimization packages.
> Recently in extending optimx package I inadvertently introduced a new control for optimx
> which is NOT in any of the wrapped optimization packages. There are probably other methods
> of keeping things tidy, but I copy the control list and null out unwanted elements for
> each of the called packages. I missed this in a couple of places in the R-forge
> development version of optimx (Iam working on fixing these, but they are still there at
> the moment).
>
> The "nasty" here was that the package mostly works, with plausible but not very good
> results for some of the optimizers. If it crashed and burned, it would have been noticed
> sooner. There is also a potential interaction with a use of the dot-dot-dot variable to
> pass scaling information.
>
> If there are ideas on how to quickly reveal errors related to calling sequences involving
> control lists and "...", I'd welcome them (off-list?), and be prepared to summarize
> findings in a vignette.
>


Suppose we wish to call f with the control.list components plus
those in the default.args not already specified in the control.list.
If any such arg is not an arg of f exclude it:

# test data - f, default.args and control.list
f <- function(a, b, c = 0, d = 1) print(match.call())
default.args <- list(a = 2, b = 1)
control.list <- list(a = 1, d = 2, e = 3)

# override default.args with control.list
use.args <- modifyList(default.args, control.list)

# exclude components of use.args that are not args of f
sel <- names(use.args) %in% names(as.list(args(f)))
final.args <- use.args[sel]

# run f
do.call("f", final.args)

The last line gives:

> do.call("f", final.args)
f(a = 1, b = 1, d = 2)

-- 
Statistics & Software Consulting
GKX Group, GKX Associates Inc.
tel: 1-877-GKX-GROUP
email: ggrothendieck at gmail.com


From oliver at first.in-berlin.de  Sat Sep 10 19:19:54 2011
From: oliver at first.in-berlin.de (oliver)
Date: Sat, 10 Sep 2011 19:19:54 +0200
Subject: [Rd] Is xtable still being maintained?
In-Reply-To: <4E6B76D8.4090302@prodsyse.com>
References: <1315653968946-3803657.post@n4.nabble.com>
	<4E6B60C9.4040007@statistik.tu-dortmund.de>
	<4E6B76D8.4090302@prodsyse.com>
Message-ID: <20110910171954.GA1680@siouxsie>

On Sat, Sep 10, 2011 at 07:40:24AM -0700, Spencer Graves wrote:
> 
> 
> On 9/10/2011 6:06 AM, Uwe Ligges wrote:
> >
> >
> >On 10.09.2011 13:26, Alastair wrote:
> >>Hi,
> >>
> >>I wonder if anyone knows if the xtable package is still actively being
> >>maintained? The last update to the CRAN was about 2 years ago.
> >>Earlier in
> >>the year I found I wanted to use the short caption option of
> >>LaTeX tables to
> >>display an abridged title in my table of contents. It was a relatively
> >>simple change to get xtable to support this. I bundled up my changes and
> >>sent the maintainer David B. Dahl an email and I got absolutely
> >>no response?
> >
> >Try to "ping" - at least I do so in this case. No response would
> >be unfortunate, of course.
> 
> 
>       David B. Dahl still has a web site as an Associate Professor
> at Texas A&M U.
> >
> >
> >>What's the etiquette for this kind of situation? I think he's done a
> >>sterling job maintaining a really useful package; I wanted to help and
> >>contribute to the community but if he's not doing it anymore how
> >>can anyone
> >>get their improvements / bug fixes into circulation?
> >
> >xtable's DESCRIPTION file says
> >
> >License:            GPL (>= 2)
> >
> >so go ahead in case you do not get a response.
> >
> >Best,
> >Uwe Ligges
> 
> 
>      xtable has a long list of reverse depends, imports, suggests
> and enhances, so many people clearly think it's useful.
> 
> 
>       My preference is to encourage the maintainer(s) to migrate the
> project to R-Forge where others can help maintain it and add
[...]

AFAIK xtable was also there available, but looking it up via search function
it seems not to be the case.
So I may have mixed up it with a different package... hmhhh ah, I think it
was zoo-package. Hmhh, yes, I think zoo... and the r-forge zoo-package allows
rollapply() also on any data type, wheras the older r-cran zoo only allowed
rollapply() to zoo-dataytpe (at lkeast at that time when I compared both packages).


If Rforge is the devel-hosting platform, but R-CRAN is the platform where packages
should be downloadet from (at least it seems to be the default for install),
then from time to time packages should be copied to R-CRAN, so that there the
progress one day will pop up - maybe with a delay, and only hosting well tested
packages.

Something like "testing" and "stable" in Debian's distribution concept
for the R-packages.

It seems the R-Forge issue is not so well known.

First time when I heard of R-forge is some months ago,
and it was via #R channel on freenode, which I also can
recommend for fast communication.


Ciao,
   Oliver


From spencer.graves at prodsyse.com  Sat Sep 10 19:24:49 2011
From: spencer.graves at prodsyse.com (Spencer Graves)
Date: Sat, 10 Sep 2011 10:24:49 -0700
Subject: [Rd] Is xtable still being maintained?
In-Reply-To: <20110910171954.GA1680@siouxsie>
References: <1315653968946-3803657.post@n4.nabble.com>
	<4E6B60C9.4040007@statistik.tu-dortmund.de>
	<4E6B76D8.4090302@prodsyse.com> <20110910171954.GA1680@siouxsie>
Message-ID: <4E6B9D61.5070406@prodsyse.com>

On 9/10/2011 10:19 AM, oliver wrote:
> On Sat, Sep 10, 2011 at 07:40:24AM -0700, Spencer Graves wrote:
>>
>> On 9/10/2011 6:06 AM, Uwe Ligges wrote:
>>>
>>> On 10.09.2011 13:26, Alastair wrote:
>>>> Hi,
>>>>
>>>> I wonder if anyone knows if the xtable package is still actively being
>>>> maintained? The last update to the CRAN was about 2 years ago.
>>>> Earlier in
>>>> the year I found I wanted to use the short caption option of
>>>> LaTeX tables to
>>>> display an abridged title in my table of contents. It was a relatively
>>>> simple change to get xtable to support this. I bundled up my changes and
>>>> sent the maintainer David B. Dahl an email and I got absolutely
>>>> no response?
>>> Try to "ping" - at least I do so in this case. No response would
>>> be unfortunate, of course.
>>
>>        David B. Dahl still has a web site as an Associate Professor
>> at Texas A&M U.
>>>
>>>> What's the etiquette for this kind of situation? I think he's done a
>>>> sterling job maintaining a really useful package; I wanted to help and
>>>> contribute to the community but if he's not doing it anymore how
>>>> can anyone
>>>> get their improvements / bug fixes into circulation?
>>> xtable's DESCRIPTION file says
>>>
>>> License:            GPL (>= 2)
>>>
>>> so go ahead in case you do not get a response.
>>>
>>> Best,
>>> Uwe Ligges
>>
>>       xtable has a long list of reverse depends, imports, suggests
>> and enhances, so many people clearly think it's useful.
>>
>>
>>        My preference is to encourage the maintainer(s) to migrate the
>> project to R-Forge where others can help maintain it and add
> [...]
>
> AFAIK xtable was also there available, but looking it up via search function
> it seems not to be the case.
> So I may have mixed up it with a different package... hmhhh ah, I think it
> was zoo-package. Hmhh, yes, I think zoo... and the r-forge zoo-package allows
> rollapply() also on any data type, wheras the older r-cran zoo only allowed
> rollapply() to zoo-dataytpe (at lkeast at that time when I compared both packages).
>
>
> If Rforge is the devel-hosting platform, but R-CRAN is the platform where packages
> should be downloadet from (at least it seems to be the default for install),
> then from time to time packages should be copied to R-CRAN, so that there the
> progress one day will pop up - maybe with a delay, and only hosting well tested
> packages.

Exactly:  R-Forge -> (log in and select a package for which you are a 
maintainer or admin) -> "R packages" -> "[Submit this package to CRAN]" 
->  (answer the questions) -> submit --- but only when you feel the new 
version is ready.


Spencer
>
> Something like "testing" and "stable" in Debian's distribution concept
> for the R-packages.
>
> It seems the R-Forge issue is not so well known.
>
> First time when I heard of R-forge is some months ago,
> and it was via #R channel on freenode, which I also can
> recommend for fast communication.
>
>
> Ciao,
>     Oliver


-- 
Spencer Graves, PE, PhD
President and Chief Technology Officer
Structure Inspection and Monitoring, Inc.
751 Emerson Ct.
San Jos?, CA 95126
ph:  408-655-4567
web:  www.structuremonitoring.com


From ggrothendieck at gmail.com  Sat Sep 10 19:29:09 2011
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sat, 10 Sep 2011 13:29:09 -0400
Subject: [Rd] Is xtable still being maintained?
In-Reply-To: <20110910171954.GA1680@siouxsie>
References: <1315653968946-3803657.post@n4.nabble.com>
	<4E6B60C9.4040007@statistik.tu-dortmund.de>
	<4E6B76D8.4090302@prodsyse.com> <20110910171954.GA1680@siouxsie>
Message-ID: <CAP01uRmS_JUFkofajDjDccbwd=39mi=vqEPmO56nRVAN1t8vbg@mail.gmail.com>

On Sat, Sep 10, 2011 at 1:19 PM, oliver <oliver at first.in-berlin.de> wrote:
> On Sat, Sep 10, 2011 at 07:40:24AM -0700, Spencer Graves wrote:
>>
>>
>> On 9/10/2011 6:06 AM, Uwe Ligges wrote:
>> >
>> >
>> >On 10.09.2011 13:26, Alastair wrote:
>> >>Hi,
>> >>
>> >>I wonder if anyone knows if the xtable package is still actively being
>> >>maintained? The last update to the CRAN was about 2 years ago.
>> >>Earlier in
>> >>the year I found I wanted to use the short caption option of
>> >>LaTeX tables to
>> >>display an abridged title in my table of contents. It was a relatively
>> >>simple change to get xtable to support this. I bundled up my changes and
>> >>sent the maintainer David B. Dahl an email and I got absolutely
>> >>no response?
>> >
>> >Try to "ping" - at least I do so in this case. No response would
>> >be unfortunate, of course.
>>
>>
>> ? ? ? David B. Dahl still has a web site as an Associate Professor
>> at Texas A&M U.
>> >
>> >
>> >>What's the etiquette for this kind of situation? I think he's done a
>> >>sterling job maintaining a really useful package; I wanted to help and
>> >>contribute to the community but if he's not doing it anymore how
>> >>can anyone
>> >>get their improvements / bug fixes into circulation?
>> >
>> >xtable's DESCRIPTION file says
>> >
>> >License: ? ? ? ? ? ?GPL (>= 2)
>> >
>> >so go ahead in case you do not get a response.
>> >
>> >Best,
>> >Uwe Ligges
>>
>>
>> ? ? ?xtable has a long list of reverse depends, imports, suggests
>> and enhances, so many people clearly think it's useful.
>>
>>
>> ? ? ? My preference is to encourage the maintainer(s) to migrate the
>> project to R-Forge where others can help maintain it and add
> [...]
>
> AFAIK xtable was also there available, but looking it up via search function
> it seems not to be the case.
> So I may have mixed up it with a different package... hmhhh ah, I think it
> was zoo-package. Hmhh, yes, I think zoo... and the r-forge zoo-package allows
> rollapply() also on any data type, wheras the older r-cran zoo only allowed
> rollapply() to zoo-dataytpe (at lkeast at that time when I compared both packages).

That has since become the CRAN version of zoo:

> library(zoo)
> rollapply(1:10, 3, sum)
[1]  6  9 12 15 18 21 24 27
> packageVersion("zoo")
[1] ?1.7.4?


-- 
Statistics & Software Consulting
GKX Group, GKX Associates Inc.
tel: 1-877-GKX-GROUP
email: ggrothendieck at gmail.com


From ligges at statistik.tu-dortmund.de  Sat Sep 10 19:45:19 2011
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Sat, 10 Sep 2011 19:45:19 +0200
Subject: [Rd] Is xtable still being maintained?
In-Reply-To: <CADc7_tVtTSQ2K_qZpZiyn8v9JpHok0Pu40m=Ee2YLuosRZetbA@mail.gmail.com>
References: <CADc7_tVtTSQ2K_qZpZiyn8v9JpHok0Pu40m=Ee2YLuosRZetbA@mail.gmail.com>
Message-ID: <4E6BA22F.9030307@statistik.tu-dortmund.de>

I think posting this to R-devel was a good idea. In any case, the new 
maintainer should be aware about the many dependencies and that she or 
he should be careful not to break code of others when updating.

Thank you for your contributions!!!

Best wishes,
Uwe Ligges





On 10.09.2011 19:14, David B. Dahl wrote:
> Hello,
>
> Regarding whether xtable is still maintained, yes, but at a minimal
> level.  I am committed to ensuring that it passes the tests on the
> latest version of R, but I am having difficulty finding the time and
> interest in incorporating new features.  So, I'd be very glad if someone
> would like to take over as the maintainer.  In fact, a few weeks ago I
> sent the following e-mail to Kurt Hornik:
>
> Kurt,
>
> I am the original author and maintainer of the xtable package first
> released in 2000.  Judging by the reverse dependencies and its common
> use with Sweave, the popularity of my xtable far exceeded my
> expectations.
>
> xtable does everything I need (and more!), but I still get occasional
> requests for new features, etc.  I find that I have little time and
> interest in extending it much further.  I am happy to continue to make
> sure it passes the checks with new releases of R, but I wonder if the
> community would be served by a new maintainer.  I read the document
> here:
>
> http://cran.r-project.org/src/contrib/Orphaned/README
>
> Do you have any further suggestions for a smooth transition?
>
> -- David
>
> --
> David B. Dahl
> Associate Professor
> Department of Statistics
> Texas A&M University
>
> Phone: 979-845-3141 <tel:979-845-3141>
> E-mail: dahl at stat.tamu.edu <mailto:dahl at stat.tamu.edu>
> Website: http://www.stat.tamu.edu/~dahl
>


From dahl at stat.tamu.edu  Sat Sep 10 19:14:07 2011
From: dahl at stat.tamu.edu (David B. Dahl)
Date: Sat, 10 Sep 2011 12:14:07 -0500
Subject: [Rd]  Is xtable still being maintained?
Message-ID: <CADc7_tVtTSQ2K_qZpZiyn8v9JpHok0Pu40m=Ee2YLuosRZetbA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20110910/1ceca8df/attachment.pl>

From xie at yihui.name  Sun Sep 11 00:03:48 2011
From: xie at yihui.name (Yihui Xie)
Date: Sat, 10 Sep 2011 17:03:48 -0500
Subject: [Rd] Please explain your workflow from R code -> package -> R
 code -> package
In-Reply-To: <CAPPM_gSaWYBtownMCT_LcAQkCX-OWfWB7OkWG_Ww6RWDOR8f8w@mail.gmail.com>
References: <CAErODj_mu8dOujVCJh14d-UbDw9qrq-9CC3MeeCSQ6d28-rJDg@mail.gmail.com>
	<20074.20512.95925.44559@max.nulle.part>
	<CABdHhvE2amMC=DVr1tykkrnLZ3c5omSJPcHhoC9EuH4tpvXBWQ@mail.gmail.com>
	<CAFFLneTg2EuSL+fnLnhybwnvhxVBHyraiAMmLjCJ0rqvFXzwTQ@mail.gmail.com>
	<CAPPM_gSaWYBtownMCT_LcAQkCX-OWfWB7OkWG_Ww6RWDOR8f8w@mail.gmail.com>
Message-ID: <CANROs4cNxAccwg=zf_yGgxMzXVwLJXtAJnPd_0VnHF4Ewah6KQ@mail.gmail.com>

Exactly. Rd2roxygen is proud to be a member of the "Lazy Ally", and
tries to make diligent developers lazier... Although it does not
guarantee a perfect transition from Rd to roxygen (be sure to check
out the documentation), it should be able to save you a considerable
amount of time.

Regards,
Yihui
--
Yihui Xie <xieyihui at gmail.com>
Phone: 515-294-2465 Web: http://yihui.name
Department of Statistics, Iowa State University
2215 Snedecor Hall, Ames, IA



On Sat, Sep 10, 2011 at 11:31 AM, Joshua Ulrich <josh.m.ulrich at gmail.com> wrote:
> On Sat, Sep 10, 2011 at 11:23 AM, steven mosher <moshersteven at gmail.com> wrote:
>> All I need now is a tool to go through the 4 packages I already
>> created without Roxygen and ?spit out source files with the Roxygen
>> comments in them...
>>
>> really lazy.
>>
>>
> That's what Rd2roxygen does...
>
> Best,
> --
> Joshua Ulrich ?| ?FOSS Trading: www.fosstrading.com
>


From moshersteven at gmail.com  Sun Sep 11 00:33:44 2011
From: moshersteven at gmail.com (steven mosher)
Date: Sat, 10 Sep 2011 15:33:44 -0700
Subject: [Rd] Please explain your workflow from R code -> package -> R
 code -> package
In-Reply-To: <CAPPM_gSaWYBtownMCT_LcAQkCX-OWfWB7OkWG_Ww6RWDOR8f8w@mail.gmail.com>
References: <CAErODj_mu8dOujVCJh14d-UbDw9qrq-9CC3MeeCSQ6d28-rJDg@mail.gmail.com>
	<20074.20512.95925.44559@max.nulle.part>
	<CABdHhvE2amMC=DVr1tykkrnLZ3c5omSJPcHhoC9EuH4tpvXBWQ@mail.gmail.com>
	<CAFFLneTg2EuSL+fnLnhybwnvhxVBHyraiAMmLjCJ0rqvFXzwTQ@mail.gmail.com>
	<CAPPM_gSaWYBtownMCT_LcAQkCX-OWfWB7OkWG_Ww6RWDOR8f8w@mail.gmail.com>
Message-ID: <CAFFLneRW-gth3Hfyk3VKAtkz54hzgx4Oq2BHrucpFUvtRQD2cQ@mail.gmail.com>

Thanks, I was too lazy to even look for it.



On Sat, Sep 10, 2011 at 9:31 AM, Joshua Ulrich <josh.m.ulrich at gmail.com> wrote:
> On Sat, Sep 10, 2011 at 11:23 AM, steven mosher <moshersteven at gmail.com> wrote:
>> All I need now is a tool to go through the 4 packages I already
>> created without Roxygen and ?spit out source files with the Roxygen
>> comments in them...
>>
>> really lazy.
>>
>>
> That's what Rd2roxygen does...
>
> Best,
> --
> Joshua Ulrich ?| ?FOSS Trading: www.fosstrading.com
>
>
>
>>
>> On Fri, Sep 9, 2011 at 11:41 AM, Hadley Wickham <hadley at rice.edu> wrote:
>>>> | In other languages, I've seen to write the documentation inside the
>>>> | code files and then post-process to make the documentation. ?Is there
>>>> | a similar thing for R, to unify the R code development and
>>>> | documentation/package-making process?
>>>>
>>>> You can also follow the cool kids who these days tie some of this together
>>>> using roxygen.
>>>
>>> It's not the cool kids who are doing this, it's the lazy kids ;)
>>> Roxygen(2) does remove a considerable amount of replication between
>>> code and documentation (e.g. replicating function usage in two
>>> places), and the close proximity between code and documentation does
>>> make it easier to remember to update your documentation when the code
>>> changes.
>>>
>>> Roxygen2 adds a few other tools for reducing duplication like
>>> templates, the ability to inherit parameter documentation from other
>>> function, and the family tag to automatically add seealso references
>>> between all members of a related family of functions. ?These are
>>> things that are painful to do by hand and add a significance
>>> maintenance burden.
>>>
>>> I agree that there's no silver bullet, but good tools certainly can
>>> make life easier.
>>>
>>> Hadley
>>>
>>> --
>>> Assistant Professor / Dobelman Family Junior Chair
>>> Department of Statistics / Rice University
>>> http://had.co.nz/
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>


From oliver at first.in-berlin.de  Sun Sep 11 00:39:39 2011
From: oliver at first.in-berlin.de (oliver)
Date: Sun, 11 Sep 2011 00:39:39 +0200
Subject: [Rd] Is xtable still being maintained?
In-Reply-To: <4E6B9D61.5070406@prodsyse.com>
References: <1315653968946-3803657.post@n4.nabble.com>
	<4E6B60C9.4040007@statistik.tu-dortmund.de>
	<4E6B76D8.4090302@prodsyse.com> <20110910171954.GA1680@siouxsie>
	<4E6B9D61.5070406@prodsyse.com>
Message-ID: <20110910223939.GC2382@siouxsie>

On Sat, Sep 10, 2011 at 10:24:49AM -0700, Spencer Graves wrote:
> On 9/10/2011 10:19 AM, oliver wrote:
> >On Sat, Sep 10, 2011 at 07:40:24AM -0700, Spencer Graves wrote:
> >>
> >>On 9/10/2011 6:06 AM, Uwe Ligges wrote:
> >>>
> >>>On 10.09.2011 13:26, Alastair wrote:
> >>>>Hi,
> >>>>
> >>>>I wonder if anyone knows if the xtable package is still actively being
[...]

long beard shaved away ;-)


[...]
> >If Rforge is the devel-hosting platform, but R-CRAN is the platform where packages
> >should be downloadet from (at least it seems to be the default for install),
> >then from time to time packages should be copied to R-CRAN, so that there the
> >progress one day will pop up - maybe with a delay, and only hosting well tested
> >packages.
> 
> Exactly:  R-Forge -> (log in and select a package for which you are
> a maintainer or admin) -> "R packages" -> "[Submit this package to
> CRAN]" ->  (answer the questions) -> submit --- but only when you
> feel the new version is ready.
[...]


I think, often things become unsupported, because
too much overhead is annoying.
But this sounds very good / supporting.

Ciao,
   Oliver


From oliver at first.in-berlin.de  Sun Sep 11 00:35:13 2011
From: oliver at first.in-berlin.de (oliver)
Date: Sun, 11 Sep 2011 00:35:13 +0200
Subject: [Rd] Is xtable still being maintained?
In-Reply-To: <CADc7_tVtTSQ2K_qZpZiyn8v9JpHok0Pu40m=Ee2YLuosRZetbA@mail.gmail.com>
References: <CADc7_tVtTSQ2K_qZpZiyn8v9JpHok0Pu40m=Ee2YLuosRZetbA@mail.gmail.com>
Message-ID: <20110910223513.GB2382@siouxsie>

Hello,

On Sat, Sep 10, 2011 at 12:14:07PM -0500, David B. Dahl wrote:
> Hello,
> 
> Regarding whether xtable is still maintained, yes, but at a minimal level.
>  I am committed to ensuring that it passes the tests on the latest version
> of R, but I am having difficulty finding the time and interest in
> incorporating new features.
[...]


I also missed some features.
I have written my own R-code for circumvent this, but
it would be better toi enhance xtable, because
the functionality otherwise would split into package-code and "user-code".

So it would be better to incorporate some more features.

If someone would want to take over maintenance, I had some feature wishes...


Ciao,
   Oliver


From Mark.Bravington at csiro.au  Sun Sep 11 02:48:12 2011
From: Mark.Bravington at csiro.au (Mark.Bravington at csiro.au)
Date: Sun, 11 Sep 2011 10:48:12 +1000
Subject: [Rd] Please explain your workflow from R code -> package -> R
 code	-> package
In-Reply-To: <CAErODj_mu8dOujVCJh14d-UbDw9qrq-9CC3MeeCSQ6d28-rJDg@mail.gmail.com>
References: <CAErODj_mu8dOujVCJh14d-UbDw9qrq-9CC3MeeCSQ6d28-rJDg@mail.gmail.com>
Message-ID: <3D59DF35E7CF3E42BA70C23BD5CBE6A85F59422557@exvic-mbx04.nexus.csiro.au>

I create & maintain all my packages using the 'mvbutils' package. Documentation in plain-text format (not Rd) is stored along with each function definition--- so when you edit your function, its doco is right there too, and it looks like proper documentation, not code-comments or quasi-Latex. The entire package source tree, including the Rd files, is created automatically by the 'preinstall' function, after which you can then R-BUILD the package as usual. However, with 'mvbutils' you only need R-BUILD when you want a distribution version for others. Normal maintenance doesn't require R-BUILD; you can add/remove/edit functions, documentation, and data to the package on-the-fly while it is loaded, with no need to unload/uninstall/rebuild/reload.

It works with compiled code, too. My own way of working with compiled code is a bit different to most other people's, but colleagues who use more traditional routes have also successfully used 'mvbutils' to build and maintain their packages.

In the spirit of several other replies-- I spent months developing this stuff and getting it to run smoothly, precisely because I'm lazy and have a limited memory...

HTH (though whether "yet another approach is..." will actually help you, I'm not sure)

Mark


Mark Bravington
CSIRO CMIS
Marine Lab
Hobart
Australia
________________________________________
From: r-devel-bounces at r-project.org [r-devel-bounces at r-project.org] On Behalf Of Paul Johnson [pauljohn32 at gmail.com]
Sent: 10 September 2011 02:38
To: r-devel at stat.math.ethz.ch
Subject: [Rd] Please explain your workflow from R code -> package -> R code     -> package

Hi,

I'm asking another one of those questions that would be obvious if I
could watch your work while you do it.

I'm having trouble understanding the workflow of code and package maintenance.

Stage 1.  Make some R functions in a folder.  This is in a Subversion repo

R/trunk/myproject

Stage 2. Make a package:

After the package.skeleton, and R check, I have a new folder with the
project in it,

R/trunk/myproject/mypackage
  DESCRIPTION
  man
  R

I to into the man folder and manually edit the Rd files. I don't
change anything in the R folder because I think it is OK so far.

And eventually I end up with a tarball mypackage_1.0.tar.gz.

Stage 3. How to make the round trip? I add more R code, and
re-generate a package.

package.skeleton obliterates the help files I've already edited.

So keeping the R code in sync with the documentation appears to be a hassle.

In other languages, I've seen to write the documentation inside the
code files and then post-process to make the documentation.  Is there
a similar thing for R, to unify the R code development and
documentation/package-making process?

pj

--
Paul E. Johnson
Professor, Political Science
1541 Lilac Lane, Room 504
University of Kansas

______________________________________________
R-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-devel


From moshersteven at gmail.com  Sun Sep 11 03:03:24 2011
From: moshersteven at gmail.com (steven mosher)
Date: Sat, 10 Sep 2011 18:03:24 -0700
Subject: [Rd] Importing from a package with dependencies
Message-ID: <CAFFLneS1HD80LfEKg7zB4EZuqGik8DQV9GHsu8zy3P9qTbDWrw@mail.gmail.com>

 I needed to do a little cleanup on my packages ( before trying
Rd2Roxygen) and that involved
switching some packages from my Depends list  to Imports.

Specifically, I had a dependency on "R.utils", but since I only used
one or two functions
(gunzip ) I thought it best to importFrom("R.utils",gunzip) in the
namespace and then switch
from depending on R.util to Importing.

However, R.utils depends upon R.oo and R.methodsS3. I removed them as
well from the depends.

Now, when I build the package I get the following warning


"library or require call not declared from R.oo

I know this is something stupid I am missing.

I would like to import from R.util  because of a name clash with
"raster"  ( extract).

Do I still need to declare a depends on R.oo and R.methodsS3?


Thanks

Steve


From moshersteven at gmail.com  Sun Sep 11 07:14:29 2011
From: moshersteven at gmail.com (steven mosher)
Date: Sat, 10 Sep 2011 22:14:29 -0700
Subject: [Rd] Importing from a package with dependencies
In-Reply-To: <CAFFLneS1HD80LfEKg7zB4EZuqGik8DQV9GHsu8zy3P9qTbDWrw@mail.gmail.com>
References: <CAFFLneS1HD80LfEKg7zB4EZuqGik8DQV9GHsu8zy3P9qTbDWrw@mail.gmail.com>
Message-ID: <CAFFLneQFAeuYmeE8bheCbHFCP-HtoaLXD8G2Kk1dvME_DK8sSA@mail.gmail.com>

Disregard.  I found the problem.  A stray  "require" statement I didnt
find on the first pass through the code.

On Sat, Sep 10, 2011 at 6:03 PM, steven mosher <moshersteven at gmail.com> wrote:
> ?I needed to do a little cleanup on my packages ( before trying
> Rd2Roxygen) and that involved
> switching some packages from my Depends list ?to Imports.
>
> Specifically, I had a dependency on "R.utils", but since I only used
> one or two functions
> (gunzip ) I thought it best to importFrom("R.utils",gunzip) in the
> namespace and then switch
> from depending on R.util to Importing.
>
> However, R.utils depends upon R.oo and R.methodsS3. I removed them as
> well from the depends.
>
> Now, when I build the package I get the following warning
>
>
> "library or require call not declared from R.oo
>
> I know this is something stupid I am missing.
>
> I would like to import from R.util ?because of a name clash with
> "raster" ?( extract).
>
> Do I still need to declare a depends on R.oo and R.methodsS3?
>
>
> Thanks
>
> Steve
>


From graham.li at eurus-energy.com  Sun Sep 11 12:30:28 2011
From: graham.li at eurus-energy.com (typhoong)
Date: Sun, 11 Sep 2011 03:30:28 -0700 (PDT)
Subject: [Rd] Link between Qt GUI and R
Message-ID: <1315737028101-3804976.post@n4.nabble.com>

hi, 

i want to build a Qt front-end GUI which communicates with R, and i am not
sure what i should use for the interface. There seems to be many ways:
R.dll, Rinside, Rcpp, RQt, Rtools... . what is the best way? please advice.

basically what i want to do is that, the Qt GUI will allow users to make
selection and enter numbers, these inputs will be fed to R, already written
.R files will perform the calculations, the calculation results
(graphs/numbers) to be fed back and display in the GUI.

graham



--
View this message in context: http://r.789695.n4.nabble.com/Link-between-Qt-GUI-and-R-tp3804976p3804976.html
Sent from the R devel mailing list archive at Nabble.com.


From simon.urbanek at r-project.org  Sun Sep 11 17:34:35 2011
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Sun, 11 Sep 2011 11:34:35 -0400
Subject: [Rd] Link between Qt GUI and R
In-Reply-To: <1315737028101-3804976.post@n4.nabble.com>
References: <1315737028101-3804976.post@n4.nabble.com>
Message-ID: <57A9E72C-405E-4D29-B9ED-C4DEE25FA482@r-project.org>


On Sep 11, 2011, at 6:30 AM, typhoong wrote:

> hi, 
> 
> i want to build a Qt front-end GUI which communicates with R, and i am not
> sure what i should use for the interface. There seems to be many ways:
> R.dll, Rinside, Rcpp, RQt, Rtools... . what is the best way? please advice.
> 

I think qtgui already provides that ... but I didnt' test it myself ...

Cheers,
Simon


> basically what i want to do is that, the Qt GUI will allow users to make
> selection and enter numbers, these inputs will be fed to R, already written
> .R files will perform the calculations, the calculation results
> (graphs/numbers) to be fed back and display in the GUI.
> 
> graham
> 
> 
> 
> --
> View this message in context: http://r.789695.n4.nabble.com/Link-between-Qt-GUI-and-R-tp3804976p3804976.html
> Sent from the R devel mailing list archive at Nabble.com.
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 


From edd at debian.org  Sun Sep 11 19:09:22 2011
From: edd at debian.org (Dirk Eddelbuettel)
Date: Sun, 11 Sep 2011 12:09:22 -0500
Subject: [Rd] Link between Qt GUI and R
In-Reply-To: <1315737028101-3804976.post@n4.nabble.com>
References: <1315737028101-3804976.post@n4.nabble.com>
Message-ID: <20076.60226.200032.727016@max.nulle.part>


On 11 September 2011 at 03:30, typhoong wrote:
| hi, 
| 
| i want to build a Qt front-end GUI which communicates with R, and i am not
| sure what i should use for the interface. There seems to be many ways:
| R.dll, Rinside, Rcpp, RQt, Rtools... . what is the best way? please advice.
| 
| basically what i want to do is that, the Qt GUI will allow users to make
| selection and enter numbers, these inputs will be fed to R, already written
| .R files will perform the calculations, the calculation results
| (graphs/numbers) to be fed back and display in the GUI.

There is a complete (and working :) example in the RInside package. The
design used in that application is to have a main C++ program (written with
Qt) with happens to 'have R inside' --- which Rcpp and RInside facilitate.

RInside is on CRAN as well as on my site at

   http://dirk.eddelbuettel.com/code/rinside.html

and I blogged about this example at

   http://dirk.eddelbuettel.com/blog/2011/03/25#rinside_and_qt

As Simom mentioned, you can go the other way with keeping R as the core part
and extending via R via the qtbase / qtgui / ... project inside the GGobi
sources on github:

   https://github.com/ggobi

Dirk

-- 
Two new Rcpp master classes for R and C++ integration scheduled for 
New York (Sep 24) and San Francisco (Oct 8), more details are at
http://dirk.eddelbuettel.com/blog/2011/08/04#rcpp_classes_2011-09_and_2011-10
http://www.revolutionanalytics.com/products/training/public/rcpp-master-class.php


From b.rowlingson at lancaster.ac.uk  Sun Sep 11 20:28:44 2011
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Sun, 11 Sep 2011 19:28:44 +0100
Subject: [Rd] Link between Qt GUI and R
In-Reply-To: <1315737028101-3804976.post@n4.nabble.com>
References: <1315737028101-3804976.post@n4.nabble.com>
Message-ID: <CANVKczNxMK88-ZEqLYYLw=wSV-rv7Bf+4vE-qM4gMH5197y4pA@mail.gmail.com>

On Sun, Sep 11, 2011 at 11:30 AM, typhoong <graham.li at eurus-energy.com> wrote:
> hi,
>
> i want to build a Qt front-end GUI which communicates with R, and i am not
> sure what i should use for the interface. There seems to be many ways:
> R.dll, Rinside, Rcpp, RQt, Rtools... . what is the best way? please advice.
>

Another way is to write the Qt GUI code in Python using the PyQt4
classes, then use RPy to call the required R functionality, get the
results back, slap them into the GUI.

If you can program in Python or want to learn it then its the best way by far :)

Barry


From graham.li at eurus-energy.com  Mon Sep 12 03:00:57 2011
From: graham.li at eurus-energy.com (typhoong)
Date: Sun, 11 Sep 2011 18:00:57 -0700 (PDT)
Subject: [Rd] Link between Qt GUI and R
In-Reply-To: <CANVKczNxMK88-ZEqLYYLw=wSV-rv7Bf+4vE-qM4gMH5197y4pA@mail.gmail.com>
References: <1315737028101-3804976.post@n4.nabble.com>
	<CANVKczNxMK88-ZEqLYYLw=wSV-rv7Bf+4vE-qM4gMH5197y4pA@mail.gmail.com>
Message-ID: <1315789257039-3806067.post@n4.nabble.com>

hi everyone, thanks for all the tips.


Barry, can you tell me why you think PyQT is by far the best way?

graham

--
View this message in context: http://r.789695.n4.nabble.com/Link-between-Qt-GUI-and-R-tp3804976p3806067.html
Sent from the R devel mailing list archive at Nabble.com.


From b.rowlingson at lancaster.ac.uk  Mon Sep 12 09:11:04 2011
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Mon, 12 Sep 2011 08:11:04 +0100
Subject: [Rd] Link between Qt GUI and R
In-Reply-To: <1315789257039-3806067.post@n4.nabble.com>
References: <1315737028101-3804976.post@n4.nabble.com>
	<CANVKczNxMK88-ZEqLYYLw=wSV-rv7Bf+4vE-qM4gMH5197y4pA@mail.gmail.com>
	<1315789257039-3806067.post@n4.nabble.com>
Message-ID: <CANVKczOKxzNAoMArqNPrCLMJ=+E9t-j3ZoVL=QyREsJfB-GUPw@mail.gmail.com>

On Mon, Sep 12, 2011 at 2:00 AM, typhoong <graham.li at eurus-energy.com> wrote:
> hi everyone, thanks for all the tips.
>
>
> Barry, can you tell me why you think PyQT is by far the best way?

 I said that conditional on you knowing or wanting to learn Python.
Python interacts with Qt in much the same way as C++ interacts with
it, but without the annoying compile and link steps of C++ (Python is
an interpreted language). Qt was designed to work with C++, and so
development with Python and C++ should be faster than most other Qt
interfaces.

So if you already know Python, and your R scripts are already in the
can ready to go, there's less point learning, or even constructing,
some R-Qt interface than using the well-established and robust
Python-Qt interface.

Barry


From timothy.c.bates at gmail.com  Mon Sep 12 19:29:36 2011
From: timothy.c.bates at gmail.com (Timothy Bates)
Date: Mon, 12 Sep 2011 18:29:36 +0100
Subject: [Rd] R CMD INSTALL configure.args and CC customization
In-Reply-To: <CANwu5-rGUYrC73vRo04GJCdW_ZQerycbVU4K_2Dun1ytqNXQ7g@mail.gmail.com>
References: <CANwu5-rGUYrC73vRo04GJCdW_ZQerycbVU4K_2Dun1ytqNXQ7g@mail.gmail.com>
Message-ID: <F60AC3B3-28E4-486E-BE0B-E09EEA7618C9@gmail.com>

Hi Michael,
That change seems like a good saving for maintainers: cuts 281 lines in the Rmpi
package configure.ac file  down to just  2 lines in Makevars.in: CC=mpicc
SHLIB_LD=mpicc.

Hopefully the patch can get up? ?

entire patch to Makeconf.in (4 new lines):

--- Makeconf.in 2011-03-17 14:18:05.000000000 -0400
+++ Makeconf.in.new     2011-09-09 14:37:15.701103349 -0400
@@ -16,7 +16,9 @@
## next two for future support of cross-compiling, not actually used
BUILD_CC = @BUILD_CC@
BUILD_R = @BUILD_R@
+ifndef CC
CC = @CC@
+endif
CFLAGS = @CFLAGS@
CPICFLAGS = @CPICFLAGS@
CPPFLAGS = @CPPFLAGS@
@@ -88,7 +90,9 @@
SHLIB_EXT = @SHLIB_EXT@
SHLIB_CFLAGS = @SHLIB_CFLAGS@
SHLIB_FFLAGS = @SHLIB_FFLAGS@
+ifndef SHLIB_LD
SHLIB_LD = @SHLIB_LD@
+endif
SHLIB_LDFLAGS = @SHLIB_LDFLAGS@
SHLIB_LINK = $(SHLIB_LD) $(SHLIB_LDFLAGS) $(LDFLAGS)
STRIP_LIBS = @striplib@

On 9 Sep 2011, at 7:40 PM, Michael Spiegel wrote:

> I am running into the following issue that has been previously
> reported on the R-devel mailing list. The short version is that I'm
> writing a package for MPI, and I'd like to change CC and SHLIB_LD to
> "mpicc". Trying to change them in Makevars.in has no effect, because
> the values are clobbered by /etc/R/Makeconf. Will the following
> changes to Makeconf.in introduce any problems?
> 
> --Michael
> 
> 
> Subject:	[Rd] R CMD INSTALL configure.args and CC customization	
> From:	Paul Johnson (paul... at gmail.com)
> Date:	Jan 20, 2010 11:30:44 am
> List:	org.r-project.r-devel
> Hi, everybody.
> 
> I hope the new year is treating you well.
> 
> In a Rocks Cluster Linux system (that's Centos 5.2 based), I have
> built R-2.10 and it runs well.
> 
> While fiddling with MPI libraries and R packages, I've noticed a few
> little wrinkles.
> 
> This comes as no surprise to the veteran R programmers, but let me
> share to the new guys the following gem:
> 
> There is a difference between . and -
> 
> Simple, and yet so vital!
> 
> install.packages inside R takes a period between "configure" and
> "args", as in "configure.args=", while in the shell, the same option
> specified to R CMD INSTALL wants a dash, as in "--configure-args=".
> The "period" versus the "hyphen" was  killing me all morning!
> 
> When building Rmpi, I had to specify configure options to let R know
> which MPI library to use. I *tried* to avoid that by forcing the
> compiler to be "mpicc", not "gcc".   I believe that if one uses mpicc,
> then the compiler really is gcc, but it is initiated with the INC and
> LIB dirs set so that the configure  can find what it needs. But gcc
> seems to be deeply glued to R installation of packages.
> 
> I find various posts in the r-help list in which people claim this should work:
> 
> CC=mpicc R CMD INSTALL ...
> 
> but it doesn't make a difference for me. The compiler that gets used
> is gcc, no matter how many different ways I try to say it should be
> mpicc:
> 
> $ CC=mpicc R CMD INSTALL
> --configure-args=--with-mpi=/usr/lib64/openmpi/1.2.7-gcc
> --configure-vars=CC=mpicc Rmpi_0.5-8.tar.gz
> Password:
> * installing to library '/share/apps/lib/R/site-library'
> * installing *source* package 'Rmpi' ...
> checking for gcc... gcc -m64 -std=gnu99
> checking for C compiler default output file name... a.out
> checking whether the C compiler works... yes
> checking whether we are cross compiling... no
> checking for suffix of executables...
> checking for suffix of object files... o
> checking whether we are using the GNU C compiler... yes
> checking whether gcc -m64 -std=gnu99 accepts -g... yes
> checking for gcc -m64 -std=gnu99 option to accept ISO C89... none needed
> Trying to find mpi.h ...
> Found in /usr/lib64/openmpi/1.2.7-gcc/include
> Trying to find libmpi.so or libmpich.a ...
> Found libmpi in /usr/lib64/openmpi/1.2.7-gcc/lib
> checking for openpty in -lutil... yes
> checking for main in -lpthread... yes
> configure: creating ./config.status
> config.status: creating src/Makevars
> ** libs
> gcc -m64 -std=gnu99 -I/usr/include/R -DPACKAGE_NAME=\"\"
> -DPACKAGE_TARNAME=\"\" -DPACKAGE_VERSION=\"\" -DPACKAGE_STRING=\"\"
> -DPACKAGE_BUGREPORT=\"\" -I/usr/lib64/openmpi/1.2.7-gcc/include
> -DMPI2 -DOPENMPI -I/usr/local/include    -fpic  -O2 -g -pipe -Wall
> -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector
> --param=ssp-buffer-size=4 -m64 -mtune=generic -c RegQuery.c -o
> RegQuery.o
> gcc -m64 -std=gnu99 -I/usr/include/R -DPACKAGE_NAME=\"\"
> -DPACKAGE_TARNAME=\"\" -DPACKAGE_VERSION=\"\" -DPACKAGE_STRING=\"\"
> -DPACKAGE_BUGREPORT=\"\" -I/usr/lib64/openmpi/1.2.7-gcc/include
> -DMPI2 -DOPENMPI -I/usr/local/include    -fpic  -O2 -g -pipe -Wall
> -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector
> --param=ssp-buffer-size=4 -m64 -mtune=generic -c Rmpi.c -o Rmpi.o
> gcc -m64 -std=gnu99 -I/usr/include/R -DPACKAGE_NAME=\"\"
> -DPACKAGE_TARNAME=\"\" -DPACKAGE_VERSION=\"\" -DPACKAGE_STRING=\"\"
> -DPACKAGE_BUGREPORT=\"\" -I/usr/lib64/openmpi/1.2.7-gcc/include
> -DMPI2 -DOPENMPI -I/usr/local/include    -fpic  -O2 -g -pipe -Wall
> -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector
> --param=ssp-buffer-size=4 -m64 -mtune=generic -c conversion.c -o
> conversion.o
> gcc -m64 -std=gnu99 -I/usr/include/R -DPACKAGE_NAME=\"\"
> -DPACKAGE_TARNAME=\"\" -DPACKAGE_VERSION=\"\" -DPACKAGE_STRING=\"\"
> -DPACKAGE_BUGREPORT=\"\" -I/usr/lib64/openmpi/1.2.7-gcc/include
> -DMPI2 -DOPENMPI -I/usr/local/include    -fpic  -O2 -g -pipe -Wall
> -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector
> --param=ssp-buffer-size=4 -m64 -mtune=generic -c internal.c -o
> internal.o
> gcc -m64 -std=gnu99 -shared -L/usr/local/lib64 -o Rmpi.so RegQuery.o
> Rmpi.o conversion.o internal.o -L/usr/lib64/openmpi/1.2.7-gcc/lib
> -lmpi -lutil -lpthread -L/usr/lib64/R/lib -lR
> ** R
> ** demo
> ** inst
> ** preparing package for lazy loading
> ** help
> *** installing help indices
> ** building package indices ...
> * DONE (Rmpi)
> ======================
> 
> The same effect (or lack thereof) can be had with configure.vars in
> install.packages:
> 
> install.packages("Rmpi",
> configure.args="--with-mpi=/usr/lib64/openmpi/1.2.7-gcc",
> configure.vars="CC=mpicc")
> Warning in install.packages("Rmpi", configure.args =
> "--with-mpi=/usr/lib64/openmpi/1.2.7-gcc",  :
>  argument 'lib' is missing: using '/share/apps/lib/R/site-library'
> --- Please select a CRAN mirror for use in this session ---
> Loading Tcl/Tk interface ... done
> trying URL 'http://cran.mirrors.hoobly.com/src/contrib/Rmpi_0.5-8.tar.gz'
> Content type 'application/x-gzip' length 87528 bytes (85 Kb)
> opened URL
> ==================================================
> downloaded 85 Kb
> 
> * installing *source* package 'Rmpi' ...
> checking for gcc... gcc -m64 -std=gnu99
> checking for C compiler default output file name... a.out
> checking whether the C compiler works... yes
> checking whether we are cross compiling... no
> checking for suffix of executables...
> checking for suffix of object files... o
> checking whether we are using the GNU C compiler... yes
> checking whether gcc -m64 -std=gnu99 accepts -g... yes
> checking for gcc -m64 -std=gnu99 option to accept ISO C89... none needed
> Trying to find mpi.h ...
> Found in /usr/lib64/openmpi/1.2.7-gcc/include
> Trying to find libmpi.so or libmpich.a ...
> Found libmpi in /usr/lib64/openmpi/1.2.7-gcc/lib
> checking for openpty in -lutil... yes
> checking for main in -lpthread... yes
> configure: creating ./config.status
> config.status: creating src/Makevars
> ** libs
> gcc -m64 -std=gnu99 -I/usr/include/R -DPACKAGE_NAME=\"\"
> -DPACKAGE_TARNAME=\"\" -DPACKAGE_VERSION=\"\" -DPACKAGE_STRING=\"\"
> -DPACKAGE_BUGREPORT=\"\" -I/usr/lib64/openmpi/1.2.7-gcc/include
> -DMPI2 -DOPENMPI -I/usr/local/include    -fpic  -O2 -g -pipe -Wall
> -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector
> --param=ssp-buffer-size=4 -m64 -mtune=generic -c RegQuery.c -o
> RegQuery.o
> gcc -m64 -std=gnu99 -I/usr/include/R -DPACKAGE_NAME=\"\"
> -DPACKAGE_TARNAME=\"\" -DPACKAGE_VERSION=\"\" -DPACKAGE_STRING=\"\"
> -DPACKAGE_BUGREPORT=\"\" -I/usr/lib64/openmpi/1.2.7-gcc/include
> -DMPI2 -DOPENMPI -I/usr/local/include    -fpic  -O2 -g -pipe -Wall
> -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector
> --param=ssp-buffer-size=4 -m64 -mtune=generic -c Rmpi.c -o Rmpi.o
> gcc -m64 -std=gnu99 -I/usr/include/R -DPACKAGE_NAME=\"\"
> -DPACKAGE_TARNAME=\"\" -DPACKAGE_VERSION=\"\" -DPACKAGE_STRING=\"\"
> -DPACKAGE_BUGREPORT=\"\" -I/usr/lib64/openmpi/1.2.7-gcc/include
> -DMPI2 -DOPENMPI -I/usr/local/include    -fpic  -O2 -g -pipe -Wall
> -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector
> --param=ssp-buffer-size=4 -m64 -mtune=generic -c conversion.c -o
> conversion.o
> gcc -m64 -std=gnu99 -I/usr/include/R -DPACKAGE_NAME=\"\"
> -DPACKAGE_TARNAME=\"\" -DPACKAGE_VERSION=\"\" -DPACKAGE_STRING=\"\"
> -DPACKAGE_BUGREPORT=\"\" -I/usr/lib64/openmpi/1.2.7-gcc/include
> -DMPI2 -DOPENMPI -I/usr/local/include    -fpic  -O2 -g -pipe -Wall
> -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector
> --param=ssp-buffer-size=4 -m64 -mtune=generic -c internal.c -o
> internal.o
> gcc -m64 -std=gnu99 -shared -L/usr/local/lib64 -o Rmpi.so RegQuery.o
> Rmpi.o conversion.o internal.o -L/usr/lib64/openmpi/1.2.7-gcc/lib
> -lmpi -lutil -lpthread -L/usr/lib64/R/lib -lR
> ** R
> ** demo
> ** inst
> ** preparing package for lazy loading
> ** help
> *** installing help indices
> ** building package indices ...
> * DONE (Rmpi)
> 
> -- 
> Paul E. Johnson
> Professor, Political Science
> 1541 Lilac Lane, Room 504
> University of Kansas
> <Makeconf.in.patch>______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From mtmorgan at fhcrc.org  Mon Sep 12 22:37:07 2011
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Mon, 12 Sep 2011 13:37:07 -0700
Subject: [Rd] How to safely using OpenMP pragma inside a .C() function?
In-Reply-To: <B2571962-7567-4F59-A1CB-415088594F47@r-project.org>
References: <1314643732236-3777036.post@n4.nabble.com>
	<B2571962-7567-4F59-A1CB-415088594F47@r-project.org>
Message-ID: <4E6E6D73.7040504@fhcrc.org>

On 08/29/2011 05:36 PM, Simon Urbanek wrote:
>
> On Aug 29, 2011, at 7:48 PM, Alireza Mahani wrote:
>
>> I am trying to parallelize part of a C function that is called from
>> R (via .C) using OpenMP's "parallel for" pragma. I get mixed
>> results: some runs finish with no problem, but some lead to R
>> crashing after issuing a long error message involving memory
>> violations.
>>
>
> You'll have to provide the code. In general it works (even R uses it
> itself), but there are strict requirements (no R API calls) that you
> must adhere to.

Hi Simon et al.,

I'm trying to resolve this dictum (no R API calls) with my understanding 
of OpenMP's shared memory model. For instance I would have thought R API 
calls inside critical sections would be safe, as this (though obviously 
gratuitous) appears to be on my own machine (which I know is no way to 
arrive at a general understanding!)

#include <omp.h>
#include <Rdefines.h>

SEXP omp()
{
     const int n = 40;
     SEXP res = PROTECT(allocVector(INTSXP, n));
     const int it = 1000;
     int j;
     for (j = 0; j < Rf_length(res); ++j)
         INTEGER(res)[j] = 0;

     omp_set_num_threads(n);
     j = 0;
#pragma omp parallel for
     for (int i = 0; i < it; ++i)
#pragma omp critical
     {
         j  = omp_get_thread_num();
         SEXP elt = PROTECT(Rf_ScalarInteger(1));
         INTEGER(res)[j] = INTEGER(res)[j] + INTEGER(elt)[0];
         UNPROTECT(1);
     }

     UNPROTECT(1);
     return res;
}

and

 > dyn.load("omp.so"); table(x <- .Call("omp"))

25
40


?

Martin

 > sessionInfo()
R Under development (unstable) (2011-09-12 r56997)
Platform: x86_64-unknown-linux-gnu (64-bit)

locale:
  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
  [7] LC_PAPER=C                 LC_NAME=C
  [9] LC_ADDRESS=C               LC_TELEPHONE=C
[11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  utils     datasets  grDevices methods   base

loaded via a namespace (and not attached):
[1] tools_2.14.0


>
>
>> I found this post, which describes how a .Call() function can be
>> made to avoid crashing R by raising the stack limit:
>>
>> http://www.r-bloggers.com/using-openmp-ized-c-code-with-r/
>>
>
> I skimmed through the post and all of the examples are broken - they
> will only work (incidentally) as R internals, not officially (and
> they are unnecessary inefficient).
>
>
>> However, trying this in my .C function doesn't help things. Any
>> suggestions/tips on whether I can safely use OpenMP inside a .C
>> function, and if yes how?
>>
>
> There are issues with OpenMP on some platforms in general (in fact
> pretty much every platform had some issue at some point in time), but
> apart from those you only have to make sure that you declare
> shared/private variables properly and don't use *any* R API calls in
> the parallel part (this includes things like LENGTH, REAL, ...).
>
> Cheers, Simon
>
>
>
>> Thank you, Alireza Mahani
>>
>> -- View this message in context:
>> http://r.789695.n4.nabble.com/How-to-safely-using-OpenMP-pragma-inside-a-C-function-tp3777036p3777036.html
>>
>>
Sent from the R devel mailing list archive at Nabble.com.
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
>
> ______________________________________________ R-devel at r-project.org
> mailing list https://stat.ethz.ch/mailman/listinfo/r-devel


-- 
Computational Biology
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N. PO Box 19024 Seattle, WA 98109

Location: M1-B861
Telephone: 206 667-2793


From lawrence.michael at gene.com  Mon Sep 12 23:00:05 2011
From: lawrence.michael at gene.com (Michael Lawrence)
Date: Mon, 12 Sep 2011 14:00:05 -0700
Subject: [Rd] Link between Qt GUI and R
In-Reply-To: <1315737028101-3804976.post@n4.nabble.com>
References: <1315737028101-3804976.post@n4.nabble.com>
Message-ID: <CAOQ5NyfOGVxLxJ+Q+niCU9rykdmt2ghbE6hBQaxYJT1QZX5vZw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20110912/74f01ac1/attachment.pl>

From jverzani at gmail.com  Mon Sep 12 18:23:21 2011
From: jverzani at gmail.com (jverzani)
Date: Mon, 12 Sep 2011 16:23:21 +0000
Subject: [Rd] Link between Qt GUI and R
References: <1315737028101-3804976.post@n4.nabble.com>
	<CANVKczNxMK88-ZEqLYYLw=wSV-rv7Bf+4vE-qM4gMH5197y4pA@mail.gmail.com>
	<1315789257039-3806067.post@n4.nabble.com>
	<CANVKczOKxzNAoMArqNPrCLMJ=+E9t-j3ZoVL=QyREsJfB-GUPw@mail.gmail.com>
Message-ID: <loom.20110912T181817-263@post.gmane.org>

Barry Rowlingson <b.rowlingson <at> lancaster.ac.uk> writes:

> 
> On Mon, Sep 12, 2011 at 2:00 AM, typhoong <graham.li <at> 
> eurus-energy.com> wrote:
> > hi everyone, thanks for all the tips.
> >
> >
> > Barry, can you tell me why you think PyQT is by far the best way?
> 
>  I said that conditional on you knowing or wanting to learn Python.
> Python interacts with Qt in much the same way as C++ interacts with
> it, but without the annoying compile and link steps of C++ (Python is
> an interpreted language). Qt was designed to work with C++, and so
> development with Python and C++ should be faster than most other Qt
> interfaces.
> 
> So if you already know Python, and your R scripts are already in the
> can ready to go, there's less point learning, or even constructing,
> some R-Qt interface than using the well-established and robust
> Python-Qt interface.
> 
> Barry
> 
> 


If you don't know python, there is no need to construct an R-Qt interface, there
already is one. Take a look at: https://github.com/ggobi/ for the package 
qtbase and friends. There is some great work there.  (Simon referenced this
 earlier in this thread) For a simpler interface, there is also the gWidgetsQt 
package on r-forge (https://r-forge.r-project.org/R/?group_id=761).

--John


From graham.li at eurus-energy.com  Mon Sep 12 16:29:24 2011
From: graham.li at eurus-energy.com (typhoong)
Date: Mon, 12 Sep 2011 07:29:24 -0700 (PDT)
Subject: [Rd] Link between Qt GUI and R
In-Reply-To: <CANVKczOKxzNAoMArqNPrCLMJ=+E9t-j3ZoVL=QyREsJfB-GUPw@mail.gmail.com>
References: <1315737028101-3804976.post@n4.nabble.com>
	<CANVKczNxMK88-ZEqLYYLw=wSV-rv7Bf+4vE-qM4gMH5197y4pA@mail.gmail.com>
	<1315789257039-3806067.post@n4.nabble.com>
	<CANVKczOKxzNAoMArqNPrCLMJ=+E9t-j3ZoVL=QyREsJfB-GUPw@mail.gmail.com>
Message-ID: <1315837764712-3807563.post@n4.nabble.com>

hi Barry thanks for your explanation. 

actually i don't know much about python, also i know nothing about C++, but
i am willing to learn.

i had a look at the Rpy documentation, it looks quite good. I can see you
can use R functions within Python. However, i don't really want to do that
unless it is necessary, because all my codes necessary for calculation are
already written in R ! 

I am not sure but I guess it is possible to get the numerical inputs from
the GUI, initiate the already written R codes (dot R files) to calculate and
produce the graphs/number, feed it back to Python/PyQt, and finally display
in the GUI. Is that possible? 

graham 

--
View this message in context: http://r.789695.n4.nabble.com/Link-between-Qt-GUI-and-R-tp3804976p3807563.html
Sent from the R devel mailing list archive at Nabble.com.


From ross.gore at gmail.com  Mon Sep 12 19:07:59 2011
From: ross.gore at gmail.com (Ross Gore)
Date: Mon, 12 Sep 2011 13:07:59 -0400
Subject: [Rd] R CMD INSTALL configure.args and CC
Message-ID: <CALGPY6D2nL=fnZCX+zaYmnLsjpUi=PVb96qkrfHDHA4YT2WZxw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20110912/0e584bc1/attachment.pl>

From timothee.carayol at gmail.com  Tue Sep 13 20:16:59 2011
From: timothee.carayol at gmail.com (=?ISO-8859-1?Q?Timoth=E9e_Carayol?=)
Date: Tue, 13 Sep 2011 19:16:59 +0100
Subject: [Rd] Please explain your workflow from R code -> package -> R
 code -> package
In-Reply-To: <3D59DF35E7CF3E42BA70C23BD5CBE6A85F59422557@exvic-mbx04.nexus.csiro.au>
References: <CAErODj_mu8dOujVCJh14d-UbDw9qrq-9CC3MeeCSQ6d28-rJDg@mail.gmail.com>
	<3D59DF35E7CF3E42BA70C23BD5CBE6A85F59422557@exvic-mbx04.nexus.csiro.au>
Message-ID: <CAGam+C6+PBiOWyiNbvJTs05=HaDphf5w_TeNxTvX1VG=WNUU6Q@mail.gmail.com>

Hi--

I guess I'm a bit late to the party. I enjoyed this thread immensely,
and it helped me discover roxygen2, in what I predict to be the
beginning of a beautiful friendship.

I wrote a couple of wrappers over the last few days which are making
my workflow easier. I code on a computer but run my computations on
several different boxes, meaning that I need a simple way (ideally
one-liner) to deploy the code on each box. So I have a couple of
wrapper functions, which I am happy to share with you.

1) RPush: this bash function roxygenizes, commits and pushes a package
to a git repo. It assumes that your packages are all in a folder, the
path to which is given by the environment variable $RPACK. For example
$RPACK/Package1 and $RPACK/Package2.)

function RPush {
cd $RPACK/$1
R --quiet --vanilla --slave  <<EOF
suppressMessages(library(roxygen2))
roxygenize("./")
EOF
git add ./
git commit -am "$2"
git push
cd - > /dev/null
}

The syntax is
RPush <package name> 'commit message'

2) GitInstall is an R function somewhat inspired by Hadley Wickham's
Intall_Github, except that it is not bound to Github and can (I think)
be used with any git server.

GitInstall <- function(
                       repo,
                       branch = "HEAD",
                       remote="git at yougitserver:yourrepo"
                       ) {
  repo <- as.character(substitute(repo))
  tartf <- tempfile()
  pkgtd <- tempfile()
  dir.create(pkgtd)
  on.exit(unlink(c(tartf, pkgtd)))
  system(
         paste(
               "git archive --format=tar --remote=",
               remote, repo,
               " ", branch, "> ",
               tartf,
               sep=""
               ))
  message("Attempting to install ", repo, " from ", remote, ".")
  system(paste(
               "tar -xf",
               tartf,
               "-C",
               pkgtd
               ))
  install.packages(pkgtd, repo=NULL, type="source")
}

You can then wrap it in a bash function such as

function RInstall {
sudo R --quiet --slave <<EOF
Package1::GitInstall($1)
EOF
}

(where it is assumed that you put the GitInstall function in Package1)

So that to update a package and deploy it to a remote machine you just
need to type:
- on the local machine: RPush Package1 'commit message'
- on the remote machine: RInstall Package1

I don't think it gets much lazier than that!

Hope it helps, though I am sure this code is not super clean and may
break for other people..

Timothee


On Sun, Sep 11, 2011 at 1:48 AM,  <Mark.Bravington at csiro.au> wrote:
> I create & maintain all my packages using the 'mvbutils' package. Documentation in plain-text format (not Rd) is stored along with each function definition--- so when you edit your function, its doco is right there too, and it looks like proper documentation, not code-comments or quasi-Latex. The entire package source tree, including the Rd files, is created automatically by the 'preinstall' function, after which you can then R-BUILD the package as usual. However, with 'mvbutils' you only need R-BUILD when you want a distribution version for others. Normal maintenance doesn't require R-BUILD; you can add/remove/edit functions, documentation, and data to the package on-the-fly while it is loaded, with no need to unload/uninstall/rebuild/reload.
>
> It works with compiled code, too. My own way of working with compiled code is a bit different to most other people's, but colleagues who use more traditional routes have also successfully used 'mvbutils' to build and maintain their packages.
>
> In the spirit of several other replies-- I spent months developing this stuff and getting it to run smoothly, precisely because I'm lazy and have a limited memory...
>
> HTH (though whether "yet another approach is..." will actually help you, I'm not sure)
>
> Mark
>
>
> Mark Bravington
> CSIRO CMIS
> Marine Lab
> Hobart
> Australia
> ________________________________________
> From: r-devel-bounces at r-project.org [r-devel-bounces at r-project.org] On Behalf Of Paul Johnson [pauljohn32 at gmail.com]
> Sent: 10 September 2011 02:38
> To: r-devel at stat.math.ethz.ch
> Subject: [Rd] Please explain your workflow from R code -> package -> R code ? ? -> package
>
> Hi,
>
> I'm asking another one of those questions that would be obvious if I
> could watch your work while you do it.
>
> I'm having trouble understanding the workflow of code and package maintenance.
>
> Stage 1. ?Make some R functions in a folder. ?This is in a Subversion repo
>
> R/trunk/myproject
>
> Stage 2. Make a package:
>
> After the package.skeleton, and R check, I have a new folder with the
> project in it,
>
> R/trunk/myproject/mypackage
> ?DESCRIPTION
> ?man
> ?R
>
> I to into the man folder and manually edit the Rd files. I don't
> change anything in the R folder because I think it is OK so far.
>
> And eventually I end up with a tarball mypackage_1.0.tar.gz.
>
> Stage 3. How to make the round trip? I add more R code, and
> re-generate a package.
>
> package.skeleton obliterates the help files I've already edited.
>
> So keeping the R code in sync with the documentation appears to be a hassle.
>
> In other languages, I've seen to write the documentation inside the
> code files and then post-process to make the documentation. ?Is there
> a similar thing for R, to unify the R code development and
> documentation/package-making process?
>
> pj
>
> --
> Paul E. Johnson
> Professor, Political Science
> 1541 Lilac Lane, Room 504
> University of Kansas
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From francesco.finazzi at unibg.it  Wed Sep 14 09:40:44 2011
From: francesco.finazzi at unibg.it (Francesco Finazzi)
Date: Wed, 14 Sep 2011 09:40:44 +0200
Subject: [Rd] Building R package with precompiled shared library
Message-ID: <CABeDHXCznmmUDVRhcDXc-3NXR4PK4A9r_30YLNcTuC1Kihpo6Q@mail.gmail.com>

Dear R users,

we are trying to build a R package that includes a precompiled shared
library, let's say mylib.so. We created the skeleton of the package
and we moved the mylib.so file into the libs folder that we created at
the same level of the folders man and R. Moreover we created the file
NAMESPACE and we added the line useDynLib(mylib, .registration=TRUE).
The building step seems to work correctly but when we try to install
the package we get

** testing if installed package can be loaded
Error in library.dynam(lib, package, package.lib) :
 shared library 'mylib' not found

we cannot understand what's wrong and where R searches for the mylib.so files.

Any suggestion?

Thanks,

Michela and Francesco


From zenlines at gmail.com  Wed Sep 14 12:27:32 2011
From: zenlines at gmail.com (Brian Oney)
Date: Wed, 14 Sep 2011 12:27:32 +0200
Subject: [Rd] Revision of shell.exec?
Message-ID: <4E708194.8060406@gmail.com>

Hi List,
I hope this is correct list to propose function extensions, sorry if not.
I am preparing for a (hopefully painless) migration to linux. As far as 
I am aware of, the function "shell.exec" only comes with the windows 
version. I think this is a handy little function and would like to see 
my scripts work when I migrate.

May I propose something (like the following)?

open.file <- function(file) {
     if(.Platform$OS.type=="windows") {shell.exec(file)} else 
{system(paste("open ",file))}
}

Or just a small addition to the shell.exec function and no new named 
function.
Hope the idea isn't received as "too stupid".

Cheers,
Brian


From ligges at statistik.tu-dortmund.de  Wed Sep 14 13:47:19 2011
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Wed, 14 Sep 2011 13:47:19 +0200
Subject: [Rd] Revision of shell.exec?
In-Reply-To: <4E708194.8060406@gmail.com>
References: <4E708194.8060406@gmail.com>
Message-ID: <4E709447.10305@statistik.tu-dortmund.de>



On 14.09.2011 12:27, Brian Oney wrote:
> Hi List,
> I hope this is correct list to propose function extensions, sorry if not.
> I am preparing for a (hopefully painless) migration to linux. As far as
> I am aware of, the function "shell.exec" only comes with the windows
> version. I think this is a handy little function and would like to see
> my scripts work when I migrate.
>
> May I propose something (like the following)?
>
> open.file <- function(file) {
> if(.Platform$OS.type=="windows") {shell.exec(file)} else
> {system(paste("open ",file))}
> }
>
> Or just a small addition to the shell.exec function and no new named
> function.
> Hope the idea isn't received as "too stupid".

What is "open" supposed to do on a non-Windows machine? I do not have it 
on the only Linux installation I looked at now, hence we obviously 
cannot assume it exists on an arbitrary installation.

Best,
Uwe Ligges


>
> Cheers,
> Brian
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From pgilbert at bank-banque-canada.ca  Wed Sep 14 15:52:54 2011
From: pgilbert at bank-banque-canada.ca (Paul Gilbert)
Date: Wed, 14 Sep 2011 13:52:54 +0000
Subject: [Rd] Building R package with precompiled shared library
In-Reply-To: <CABeDHXCznmmUDVRhcDXc-3NXR4PK4A9r_30YLNcTuC1Kihpo6Q@mail.gmail.com>
References: <CABeDHXCznmmUDVRhcDXc-3NXR4PK4A9r_30YLNcTuC1Kihpo6Q@mail.gmail.com>
Message-ID: <6441154A9FF1CD4386AF4ABF141A056D2A74C013@WMEXOSCD2-N1.bocad.bank-banque-canada.ca>

My understanding is that this cannot be done, for both licence and security reasons. The package build expects source code and removes binaries. You can link with binaries that are provided separately from the package, possibly coming from a vendor that sells non-open source code, but you cannot include them in the package.

Paul

> -----Original Message-----
> From: r-devel-bounces at r-project.org [mailto:r-devel-bounces at r-
> project.org] On Behalf Of Francesco Finazzi
> Sent: September 14, 2011 3:41 AM
> To: r-devel at r-project.org
> Subject: [Rd] Building R package with precompiled shared library
> 
> Dear R users,
> 
> we are trying to build a R package that includes a precompiled shared
> library, let's say mylib.so. We created the skeleton of the package
> and we moved the mylib.so file into the libs folder that we created at
> the same level of the folders man and R. Moreover we created the file
> NAMESPACE and we added the line useDynLib(mylib, .registration=TRUE).
> The building step seems to work correctly but when we try to install
> the package we get
> 
> ** testing if installed package can be loaded
> Error in library.dynam(lib, package, package.lib) :
>  shared library 'mylib' not found
> 
> we cannot understand what's wrong and where R searches for the mylib.so
> files.
> 
> Any suggestion?
> 
> Thanks,
> 
> Michela and Francesco
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
====================================================================================

La version fran?aise suit le texte anglais.

------------------------------------------------------------------------------------

This email may contain privileged and/or confidential information, and the Bank of
Canada does not waive any related rights. Any distribution, use, or copying of this
email or the information it contains by other than the intended recipient is
unauthorized. If you received this email in error please delete it immediately from
your system and notify the sender promptly by email that you have done so. 

------------------------------------------------------------------------------------

Le pr?sent courriel peut contenir de l'information privil?gi?e ou confidentielle.
La Banque du Canada ne renonce pas aux droits qui s'y rapportent. Toute diffusion,
utilisation ou copie de ce courriel ou des renseignements qu'il contient par une
personne autre que le ou les destinataires d?sign?s est interdite. Si vous recevez
ce courriel par erreur, veuillez le supprimer imm?diatement et envoyer sans d?lai ?
l'exp?diteur un message ?lectronique pour l'aviser que vous avez ?limin? de votre
ordinateur toute copie du courriel re?u.

From simon.urbanek at r-project.org  Wed Sep 14 16:13:03 2011
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Wed, 14 Sep 2011 10:13:03 -0400
Subject: [Rd] Building R package with precompiled shared library
In-Reply-To: <6441154A9FF1CD4386AF4ABF141A056D2A74C013@WMEXOSCD2-N1.bocad.bank-banque-canada.ca>
References: <CABeDHXCznmmUDVRhcDXc-3NXR4PK4A9r_30YLNcTuC1Kihpo6Q@mail.gmail.com>
	<6441154A9FF1CD4386AF4ABF141A056D2A74C013@WMEXOSCD2-N1.bocad.bank-banque-canada.ca>
Message-ID: <D739FDB8-44FE-469D-B7F0-808D2333E596@r-project.org>

On Sep 14, 2011, at 9:52 AM, Paul Gilbert wrote:

> My understanding is that this cannot be done, for both licence and security reasons. The package build expects source code and removes binaries. You can link with binaries that are provided separately from the package, possibly coming from a vendor that sells non-open source code, but you cannot include them in the package.
> 

It is not quite true and it is not the reason for it failing ;). That reason is that libs is the wrong folder to put it in. Note that libs is the folder in the *installed* package that the shared object go to, not in the sources.

Also note that it is practically impossible to provide precompiled .so binaries (legal issues aside) because that would limit the package to one particular architecture and OS yet many R installations have at least two architectures. This also means that you would have to determine at build time where to put it ... (or relay on R installation mechanism but then you must make sure your binary is compatible with the currently built architecture).

In practice this is occasionally done for very specific systems - for example Windows: it can be quite hard to compile some (open source) dependencies on Windows so they can be shipped as static binaries (for both x64 and i386) and used by the build process. On all other systems the system libraries are used instead (for an example of this approach see "png" or "jpeg" packages on CRAN). But still, the shared object (here .dll) is not shipped, because that depends on the R version, so it is created from the static libraries by the R package building process instead.

Cheers,
Simon


> Paul
> 
>> -----Original Message-----
>> From: r-devel-bounces at r-project.org [mailto:r-devel-bounces at r-
>> project.org] On Behalf Of Francesco Finazzi
>> Sent: September 14, 2011 3:41 AM
>> To: r-devel at r-project.org
>> Subject: [Rd] Building R package with precompiled shared library
>> 
>> Dear R users,
>> 
>> we are trying to build a R package that includes a precompiled shared
>> library, let's say mylib.so. We created the skeleton of the package
>> and we moved the mylib.so file into the libs folder that we created at
>> the same level of the folders man and R. Moreover we created the file
>> NAMESPACE and we added the line useDynLib(mylib, .registration=TRUE).
>> The building step seems to work correctly but when we try to install
>> the package we get
>> 
>> ** testing if installed package can be loaded
>> Error in library.dynam(lib, package, package.lib) :
>> shared library 'mylib' not found
>> 
>> we cannot understand what's wrong and where R searches for the mylib.so
>> files.
>> 
>> Any suggestion?
>> 
>> Thanks,
>> 
>> Michela and Francesco
>> 
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
> ====================================================================================
> 
> La version fran?aise suit le texte anglais.
> 
> ------------------------------------------------------------------------------------
> 
> This email may contain privileged and/or confidential information, and the Bank of
> Canada does not waive any related rights. Any distribution, use, or copying of this
> email or the information it contains by other than the intended recipient is
> unauthorized. If you received this email in error please delete it immediately from
> your system and notify the sender promptly by email that you have done so. 
> 
> ------------------------------------------------------------------------------------
> 
> Le pr?sent courriel peut contenir de l'information privil?gi?e ou confidentielle.
> La Banque du Canada ne renonce pas aux droits qui s'y rapportent. Toute diffusion,
> utilisation ou copie de ce courriel ou des renseignements qu'il contient par une
> personne autre que le ou les destinataires d?sign?s est interdite. Si vous recevez
> ce courriel par erreur, veuillez le supprimer imm?diatement et envoyer sans d?lai ?
> l'exp?diteur un message ?lectronique pour l'aviser que vous avez ?limin? de votre
> ordinateur toute copie du courriel re?u.
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From ligges at statistik.tu-dortmund.de  Wed Sep 14 16:16:17 2011
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Wed, 14 Sep 2011 16:16:17 +0200
Subject: [Rd] Building R package with precompiled shared library
In-Reply-To: <6441154A9FF1CD4386AF4ABF141A056D2A74C013@WMEXOSCD2-N1.bocad.bank-banque-canada.ca>
References: <CABeDHXCznmmUDVRhcDXc-3NXR4PK4A9r_30YLNcTuC1Kihpo6Q@mail.gmail.com>
	<6441154A9FF1CD4386AF4ABF141A056D2A74C013@WMEXOSCD2-N1.bocad.bank-banque-canada.ca>
Message-ID: <4E70B731.2020308@statistik.tu-dortmund.de>



On 14.09.2011 15:52, Paul Gilbert wrote:
> My understanding is that this cannot be done, for both licence and security reasons. The package build expects source code and removes binaries. You can link with binaries that are provided separately from the package, possibly coming from a vendor that sells non-open source code, but you cannot include them in the package.

Actually, you can include them, but then the package won't be accepted 
on CRAN, for example.

Let me cite Writing R Extensions:

"Note that CRAN does not accept submissions of precompiled binaries due 
to security concerns, and does not allow binary executables in packages. 
Maintainers who need additional software for the Windows binaries of 
their packages on CRAN have three options

1. To arrange for installation of the package to download the additional 
software from a URL, as e.g. package Cairo does.
2. To negotiate with Uwe Ligges to host the additional components on 
WinBuilder, and write a ?configure.win? file to install them. There are 
many examples, e.g. package rgdal."

So in case you do not want to move it to CRAN, you can simply use the 
same tricks that rgdal uses for Windows binaries on CRAN.

Uwe Ligges





>
> Paul
>
>> -----Original Message-----
>> From: r-devel-bounces at r-project.org [mailto:r-devel-bounces at r-
>> project.org] On Behalf Of Francesco Finazzi
>> Sent: September 14, 2011 3:41 AM
>> To: r-devel at r-project.org
>> Subject: [Rd] Building R package with precompiled shared library
>>
>> Dear R users,
>>
>> we are trying to build a R package that includes a precompiled shared
>> library, let's say mylib.so. We created the skeleton of the package
>> and we moved the mylib.so file into the libs folder that we created at
>> the same level of the folders man and R. Moreover we created the file
>> NAMESPACE and we added the line useDynLib(mylib, .registration=TRUE).
>> The building step seems to work correctly but when we try to install
>> the package we get
>>
>> ** testing if installed package can be loaded
>> Error in library.dynam(lib, package, package.lib) :
>>   shared library 'mylib' not found
>>
>> we cannot understand what's wrong and where R searches for the mylib.so
>> files.
>>
>> Any suggestion?
>>
>> Thanks,
>>
>> Michela and Francesco
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
> ====================================================================================
>
> La version fran?aise suit le texte anglais.
>
> ------------------------------------------------------------------------------------
>
> This email may contain privileged and/or confidential information, and the Bank of
> Canada does not waive any related rights. Any distribution, use, or copying of this
> email or the information it contains by other than the intended recipient is
> unauthorized. If you received this email in error please delete it immediately from
> your system and notify the sender promptly by email that you have done so.
>
> ------------------------------------------------------------------------------------
>
> Le pr?sent courriel peut contenir de l'information privil?gi?e ou confidentielle.
> La Banque du Canada ne renonce pas aux droits qui s'y rapportent. Toute diffusion,
> utilisation ou copie de ce courriel ou des renseignements qu'il contient par une
> personne autre que le ou les destinataires d?sign?s est interdite. Si vous recevez
> ce courriel par erreur, veuillez le supprimer imm?diatement et envoyer sans d?lai ?
> l'exp?diteur un message ?lectronique pour l'aviser que vous avez ?limin? de votre
> ordinateur toute copie du courriel re?u.
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From zenlines at gmail.com  Wed Sep 14 17:08:00 2011
From: zenlines at gmail.com (Brian Oney)
Date: Wed, 14 Sep 2011 17:08:00 +0200
Subject: [Rd] Revision of shell.exec?
In-Reply-To: <CALh21i+JyvKJf=UGi2ENTXtB5rbbG-DZuwCYtGb97afG7Nguxg@mail.gmail.com>
References: <4E708194.8060406@gmail.com>	<4E709447.10305@statistik.tu-dortmund.de>
	<CALh21i+JyvKJf=UGi2ENTXtB5rbbG-DZuwCYtGb97afG7Nguxg@mail.gmail.com>
Message-ID: <4E70C350.6020506@gmail.com>

Hi Steve,

a quick look at "browseURL" will tell you that indeed "system" or 
"shell.exec" (on a windows platform) is used to open up a URL.
The "open " part of the proposed function was written to work on a Mac. 
Because Mac is a unix platform, I assumed that the function "open" would 
be omnipresent on unix platforms, my mistake. Well I guess, we know how 
to make to work on a mac.

I will make the transition to Linux and get back to this in a while, ok?

Cheers,
Brian


On 9/14/2011 2:50 PM, Stephen Weston wrote:
> 2011/9/14 Uwe Ligges<ligges at statistik.tu-dortmund.de>:
>>
>> On 14.09.2011 12:27, Brian Oney wrote:
>>> Hi List,
>>> I hope this is correct list to propose function extensions, sorry if not.
>>> I am preparing for a (hopefully painless) migration to linux. As far as
>>> I am aware of, the function "shell.exec" only comes with the windows
>>> version. I think this is a handy little function and would like to see
>>> my scripts work when I migrate.
>>>
>>> May I propose something (like the following)?
>>>
>>> open.file<- function(file) {
>>> if(.Platform$OS.type=="windows") {shell.exec(file)} else
>>> {system(paste("open ",file))}
>>> }
>>>
>>> Or just a small addition to the shell.exec function and no new named
>>> function.
>>> Hope the idea isn't received as "too stupid".
>> What is "open" supposed to do on a non-Windows machine? I do not have it on
>> the only Linux installation I looked at now, hence we obviously cannot
>> assume it exists on an arbitrary installation.
> I think the nearest equivalent for those running Gnome or KDE may be
> "xdg-open".  So there would probably need to be a new option for specifying
> the appropriate command.
>
> Personally, I am more inclined to use "system" for executing commands,
> and "browseURL" for opening documents.  "browseURL" even uses
> "xdg-open" in my R installation on my Linux machine.
>
> - Steve
>
>
>> Best,
>> Uwe Ligges
>>
>>
>>> Cheers,
>>> Brian
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>


From simon.urbanek at r-project.org  Wed Sep 14 17:35:53 2011
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Wed, 14 Sep 2011 11:35:53 -0400
Subject: [Rd] Revision of shell.exec?
In-Reply-To: <4E70C350.6020506@gmail.com>
References: <4E708194.8060406@gmail.com>	<4E709447.10305@statistik.tu-dortmund.de>
	<CALh21i+JyvKJf=UGi2ENTXtB5rbbG-DZuwCYtGb97afG7Nguxg@mail.gmail.com>
	<4E70C350.6020506@gmail.com>
Message-ID: <74357D3F-67CC-4D09-BBE9-C3988293317F@r-project.org>


On Sep 14, 2011, at 11:08 AM, Brian Oney wrote:

> Hi Steve,
> 
> a quick look at "browseURL" will tell you that indeed "system" or "shell.exec" (on a windows platform) is used to open up a URL.
> The "open " part of the proposed function was written to work on a Mac. Because Mac is a unix platform, I assumed that the function "open" would be omnipresent on unix platforms, my mistake.

Well, the problem is that "open" is unfortunately mapped to openvt on Linux systems which is a quite obscure anachronism. But since Linux is Linux there is no standard way to open a file, so it doesn't really matter ;) -- xdg-utils come closest to what one may call standard but on many systems they are not installed by default (in fact on none of the Linux machines I have around). For URLs R does the hard work to try to figure out what to do with them (it also does the same for PDFs), but you may end up opening things in a browser although that's not what you had in mind.


> Well I guess, we know how to make to work on a mac.
> 

Yes, "open" works very well on Macs and is extremely useful (I use it all the time - among other things you can use it with directories to browse them...) - it is still beyond me why other unices don't bother ...

Cheers,
Simon



> I will make the transition to Linux and get back to this in a while, ok?
> 
> Cheers,
> Brian
> 
> 
> On 9/14/2011 2:50 PM, Stephen Weston wrote:
>> 2011/9/14 Uwe Ligges<ligges at statistik.tu-dortmund.de>:
>>> 
>>> On 14.09.2011 12:27, Brian Oney wrote:
>>>> Hi List,
>>>> I hope this is correct list to propose function extensions, sorry if not.
>>>> I am preparing for a (hopefully painless) migration to linux. As far as
>>>> I am aware of, the function "shell.exec" only comes with the windows
>>>> version. I think this is a handy little function and would like to see
>>>> my scripts work when I migrate.
>>>> 
>>>> May I propose something (like the following)?
>>>> 
>>>> open.file<- function(file) {
>>>> if(.Platform$OS.type=="windows") {shell.exec(file)} else
>>>> {system(paste("open ",file))}
>>>> }
>>>> 
>>>> Or just a small addition to the shell.exec function and no new named
>>>> function.
>>>> Hope the idea isn't received as "too stupid".
>>> What is "open" supposed to do on a non-Windows machine? I do not have it on
>>> the only Linux installation I looked at now, hence we obviously cannot
>>> assume it exists on an arbitrary installation.
>> I think the nearest equivalent for those running Gnome or KDE may be
>> "xdg-open".  So there would probably need to be a new option for specifying
>> the appropriate command.
>> 
>> Personally, I am more inclined to use "system" for executing commands,
>> and "browseURL" for opening documents.  "browseURL" even uses
>> "xdg-open" in my R installation on my Linux machine.
>> 
>> - Steve
>> 
>> 
>>> Best,
>>> Uwe Ligges
>>> 
>>> 
>>>> Cheers,
>>>> Brian
>>>> 
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>> 
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 


From hb at biostat.ucsf.edu  Wed Sep 14 19:10:17 2011
From: hb at biostat.ucsf.edu (Henrik Bengtsson)
Date: Wed, 14 Sep 2011 10:10:17 -0700
Subject: [Rd] Revision of shell.exec?
In-Reply-To: <74357D3F-67CC-4D09-BBE9-C3988293317F@r-project.org>
References: <4E708194.8060406@gmail.com>
	<4E709447.10305@statistik.tu-dortmund.de>
	<CALh21i+JyvKJf=UGi2ENTXtB5rbbG-DZuwCYtGb97afG7Nguxg@mail.gmail.com>
	<4E70C350.6020506@gmail.com>
	<74357D3F-67CC-4D09-BBE9-C3988293317F@r-project.org>
Message-ID: <CAFDcVCRiTPc1f9q+KnsEAoD3SUtb1Za_4waCw1O0r_PbWQFQ+Q@mail.gmail.com>

On Wed, Sep 14, 2011 at 8:35 AM, Simon Urbanek
<simon.urbanek at r-project.org> wrote:
>
> On Sep 14, 2011, at 11:08 AM, Brian Oney wrote:
>
>> Hi Steve,
>>
>> a quick look at "browseURL" will tell you that indeed "system" or "shell.exec" (on a windows platform) is used to open up a URL.
>> The "open " part of the proposed function was written to work on a Mac. Because Mac is a unix platform, I assumed that the function "open" would be omnipresent on unix platforms, my mistake.
>
> Well, the problem is that "open" is unfortunately mapped to openvt on Linux systems which is a quite obscure anachronism. But since Linux is Linux there is no standard way to open a file, so it doesn't really matter ;) -- xdg-utils come closest to what one may call standard but on many systems they are not installed by default (in fact on none of the Linux machines I have around). For URLs R does the hard work to try to figure out what to do with them (it also does the same for PDFs), but you may end up opening things in a browser although that's not what you had in mind.
>
>
>> Well I guess, we know how to make to work on a mac.
>>
>
> Yes, "open" works very well on Macs and is extremely useful (I use it all the time - among other things you can use it with directories to browse them...) - it is still beyond me why other unices don't bother ...

Apple probably patented it.

/Henrik

>
> Cheers,
> Simon
>
>
>
>> I will make the transition to Linux and get back to this in a while, ok?
>>
>> Cheers,
>> Brian
>>
>>
>> On 9/14/2011 2:50 PM, Stephen Weston wrote:
>>> 2011/9/14 Uwe Ligges<ligges at statistik.tu-dortmund.de>:
>>>>
>>>> On 14.09.2011 12:27, Brian Oney wrote:
>>>>> Hi List,
>>>>> I hope this is correct list to propose function extensions, sorry if not.
>>>>> I am preparing for a (hopefully painless) migration to linux. As far as
>>>>> I am aware of, the function "shell.exec" only comes with the windows
>>>>> version. I think this is a handy little function and would like to see
>>>>> my scripts work when I migrate.
>>>>>
>>>>> May I propose something (like the following)?
>>>>>
>>>>> open.file<- function(file) {
>>>>> if(.Platform$OS.type=="windows") {shell.exec(file)} else
>>>>> {system(paste("open ",file))}
>>>>> }
>>>>>
>>>>> Or just a small addition to the shell.exec function and no new named
>>>>> function.
>>>>> Hope the idea isn't received as "too stupid".
>>>> What is "open" supposed to do on a non-Windows machine? I do not have it on
>>>> the only Linux installation I looked at now, hence we obviously cannot
>>>> assume it exists on an arbitrary installation.
>>> I think the nearest equivalent for those running Gnome or KDE may be
>>> "xdg-open". ?So there would probably need to be a new option for specifying
>>> the appropriate command.
>>>
>>> Personally, I am more inclined to use "system" for executing commands,
>>> and "browseURL" for opening documents. ?"browseURL" even uses
>>> "xdg-open" in my R installation on my Linux machine.
>>>
>>> - Steve
>>>
>>>
>>>> Best,
>>>> Uwe Ligges
>>>>
>>>>
>>>>> Cheers,
>>>>> Brian
>>>>>
>>>>> ______________________________________________
>>>>> R-devel at r-project.org mailing list
>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From proebuck at mdanderson.org  Wed Sep 14 19:53:39 2011
From: proebuck at mdanderson.org (Roebuck,Paul L)
Date: Wed, 14 Sep 2011 12:53:39 -0500
Subject: [Rd] [Q] Package NS Hook Lint NOTE
Message-ID: <CA965453.2098B%proebuck@mdanderson.org>

Have a question about the following NOTEs appearing on CRAN checks:

> .onLoad calls:
> require(methods)
> 
> Package startup functions should not change the search path.
> See section ?Good practice? in ?.onAttach.


For years, I have had the following in my S4-requiring packages.

##---------------------------------------------------------------------
.onLoad <- function(libname, pkgname) {
    ## In case namespace is loaded (via import) by package that
    ## doesn't depend on S4 methods and used in a session with
    ## non-default set of packages
    require(methods)
}

It was all based on an explanation Prof. Ripley gave to someone
about some package loading corner case (reference lost to history
though circa R-2.7 or before). Is it no longer an issue?


From zenlines at gmail.com  Wed Sep 14 22:15:30 2011
From: zenlines at gmail.com (Brian Oney)
Date: Wed, 14 Sep 2011 22:15:30 +0200
Subject: [Rd] Revision of shell.exec?
In-Reply-To: <CAFDcVCRiTPc1f9q+KnsEAoD3SUtb1Za_4waCw1O0r_PbWQFQ+Q@mail.gmail.com>
References: <4E708194.8060406@gmail.com>
	<4E709447.10305@statistik.tu-dortmund.de>
	<CALh21i+JyvKJf=UGi2ENTXtB5rbbG-DZuwCYtGb97afG7Nguxg@mail.gmail.com>
	<4E70C350.6020506@gmail.com>
	<74357D3F-67CC-4D09-BBE9-C3988293317F@r-project.org>
	<CAFDcVCRiTPc1f9q+KnsEAoD3SUtb1Za_4waCw1O0r_PbWQFQ+Q@mail.gmail.com>
Message-ID: <4E710B62.10703@gmail.com>

Hi there,
new idea (at 10 at night). All the emails keep me thinking (btw thanks 
for all the feedback).
What does this do on linux?

getOption("pdfviewer")
### I got this idea from: getS3method("print","vignette")

On windows, (an advantage...) somebody wrote a little program "open.exe" 
that comes stock with an R-installation, which somehow accesses the file 
system to find the default program to for a certain file type. I am 
guessing this little beauty is the engine of "shell.exec".

(An honest) cheers,
Brian

On 9/14/2011 7:49 PM, Simon Urbanek wrote:
> On Sep 14, 2011, at 1:10 PM, Henrik Bengtsson wrote:
>
>> On Wed, Sep 14, 2011 at 8:35 AM, Simon Urbanek
>> <simon.urbanek at r-project.org>  wrote:
>>> On Sep 14, 2011, at 11:08 AM, Brian Oney wrote:
>>>
>>>> Hi Steve,
>>>>
>>>> a quick look at "browseURL" will tell you that indeed "system" or "shell.exec" (on a windows platform) is used to open up a URL.
>>>> The "open " part of the proposed function was written to work on a Mac. Because Mac is a unix platform, I assumed that the function "open" would be omnipresent on unix platforms, my mistake.
>>> Well, the problem is that "open" is unfortunately mapped to openvt on Linux systems which is a quite obscure anachronism. But since Linux is Linux there is no standard way to open a file, so it doesn't really matter ;) -- xdg-utils come closest to what one may call standard but on many systems they are not installed by default (in fact on none of the Linux machines I have around). For URLs R does the hard work to try to figure out what to do with them (it also does the same for PDFs), but you may end up opening things in a browser although that's not what you had in mind.
>>>
>>>
>>>> Well I guess, we know how to make to work on a mac.
>>>>
>>> Yes, "open" works very well on Macs and is extremely useful (I use it all the time - among other things you can use it with directories to browse them...) - it is still beyond me why other unices don't bother ...
>> Apple probably patented it.
>>
> I'm pretty sure it's at least as old as NeXT so that's way before the abuse of software patents ;) - but who knows ...
>
> Cheers,
> S
>
>
>
>> /Henrik
>>
>>> Cheers,
>>> Simon
>>>
>>>
>>>
>>>> I will make the transition to Linux and get back to this in a while, ok?
>>>>
>>>> Cheers,
>>>> Brian
>>>>
>>>>
>>>> On 9/14/2011 2:50 PM, Stephen Weston wrote:
>>>>> 2011/9/14 Uwe Ligges<ligges at statistik.tu-dortmund.de>:
>>>>>> On 14.09.2011 12:27, Brian Oney wrote:
>>>>>>> Hi List,
>>>>>>> I hope this is correct list to propose function extensions, sorry if not.
>>>>>>> I am preparing for a (hopefully painless) migration to linux. As far as
>>>>>>> I am aware of, the function "shell.exec" only comes with the windows
>>>>>>> version. I think this is a handy little function and would like to see
>>>>>>> my scripts work when I migrate.
>>>>>>>
>>>>>>> May I propose something (like the following)?
>>>>>>>
>>>>>>> open.file<- function(file) {
>>>>>>> if(.Platform$OS.type=="windows") {shell.exec(file)} else
>>>>>>> {system(paste("open ",file))}
>>>>>>> }
>>>>>>>
>>>>>>> Or just a small addition to the shell.exec function and no new named
>>>>>>> function.
>>>>>>> Hope the idea isn't received as "too stupid".
>>>>>> What is "open" supposed to do on a non-Windows machine? I do not have it on
>>>>>> the only Linux installation I looked at now, hence we obviously cannot
>>>>>> assume it exists on an arbitrary installation.
>>>>> I think the nearest equivalent for those running Gnome or KDE may be
>>>>> "xdg-open".  So there would probably need to be a new option for specifying
>>>>> the appropriate command.
>>>>>
>>>>> Personally, I am more inclined to use "system" for executing commands,
>>>>> and "browseURL" for opening documents.  "browseURL" even uses
>>>>> "xdg-open" in my R installation on my Linux machine.
>>>>>
>>>>> - Steve
>>>>>
>>>>>
>>>>>> Best,
>>>>>> Uwe Ligges
>>>>>>
>>>>>>
>>>>>>> Cheers,
>>>>>>> Brian
>>>>>>>
>>>>>>> ______________________________________________
>>>>>>> R-devel at r-project.org mailing list
>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>>> ______________________________________________
>>>>>> R-devel at r-project.org mailing list
>>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>>>
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>
>>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>


From simon.urbanek at r-project.org  Wed Sep 14 22:22:13 2011
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Wed, 14 Sep 2011 16:22:13 -0400
Subject: [Rd] Revision of shell.exec?
In-Reply-To: <4E710B62.10703@gmail.com>
References: <4E708194.8060406@gmail.com>
	<4E709447.10305@statistik.tu-dortmund.de>
	<CALh21i+JyvKJf=UGi2ENTXtB5rbbG-DZuwCYtGb97afG7Nguxg@mail.gmail.com>
	<4E70C350.6020506@gmail.com>
	<74357D3F-67CC-4D09-BBE9-C3988293317F@r-project.org>
	<CAFDcVCRiTPc1f9q+KnsEAoD3SUtb1Za_4waCw1O0r_PbWQFQ+Q@mail.gmail.com>
	<4E710B62.10703@gmail.com>
Message-ID: <012257AC-B91F-4E7E-86AC-95E5833F74AA@r-project.org>


On Sep 14, 2011, at 4:15 PM, Brian Oney wrote:

> Hi there,
> new idea (at 10 at night). All the emails keep me thinking (btw thanks for all the feedback).
> What does this do on linux?
> 
> getOption("pdfviewer")
> ### I got this idea from: getS3method("print","vignette")
> 

It gives you the detected PDF viewer as I was explaining (essentially R_PDFVIEWER). The two detected settings I was referring to are R_PDFVIEWER (for PDF) and R_BROWSER (for URLs) which are the initial settings for the "pdfviewer" and "browser" options.

Note that it's what it say it is - R_PDFVIEWER is usually something like acroread or evince so not particularly useful for your purpose ...

Cheers,
Simon


> On windows, (an advantage...) somebody wrote a little program "open.exe" that comes stock with an R-installation, which somehow accesses the file system to find the default program to for a certain file type. I am guessing this little beauty is the engine of "shell.exec".
> 
> (An honest) cheers,
> Brian
> 
> On 9/14/2011 7:49 PM, Simon Urbanek wrote:
>> On Sep 14, 2011, at 1:10 PM, Henrik Bengtsson wrote:
>> 
>>> On Wed, Sep 14, 2011 at 8:35 AM, Simon Urbanek
>>> <simon.urbanek at r-project.org>  wrote:
>>>> On Sep 14, 2011, at 11:08 AM, Brian Oney wrote:
>>>> 
>>>>> Hi Steve,
>>>>> 
>>>>> a quick look at "browseURL" will tell you that indeed "system" or "shell.exec" (on a windows platform) is used to open up a URL.
>>>>> The "open " part of the proposed function was written to work on a Mac. Because Mac is a unix platform, I assumed that the function "open" would be omnipresent on unix platforms, my mistake.
>>>> Well, the problem is that "open" is unfortunately mapped to openvt on Linux systems which is a quite obscure anachronism. But since Linux is Linux there is no standard way to open a file, so it doesn't really matter ;) -- xdg-utils come closest to what one may call standard but on many systems they are not installed by default (in fact on none of the Linux machines I have around). For URLs R does the hard work to try to figure out what to do with them (it also does the same for PDFs), but you may end up opening things in a browser although that's not what you had in mind.
>>>> 
>>>> 
>>>>> Well I guess, we know how to make to work on a mac.
>>>>> 
>>>> Yes, "open" works very well on Macs and is extremely useful (I use it all the time - among other things you can use it with directories to browse them...) - it is still beyond me why other unices don't bother ...
>>> Apple probably patented it.
>>> 
>> I'm pretty sure it's at least as old as NeXT so that's way before the abuse of software patents ;) - but who knows ...
>> 
>> Cheers,
>> S
>> 
>> 
>> 
>>> /Henrik
>>> 
>>>> Cheers,
>>>> Simon
>>>> 
>>>> 
>>>> 
>>>>> I will make the transition to Linux and get back to this in a while, ok?
>>>>> 
>>>>> Cheers,
>>>>> Brian
>>>>> 
>>>>> 
>>>>> On 9/14/2011 2:50 PM, Stephen Weston wrote:
>>>>>> 2011/9/14 Uwe Ligges<ligges at statistik.tu-dortmund.de>:
>>>>>>> On 14.09.2011 12:27, Brian Oney wrote:
>>>>>>>> Hi List,
>>>>>>>> I hope this is correct list to propose function extensions, sorry if not.
>>>>>>>> I am preparing for a (hopefully painless) migration to linux. As far as
>>>>>>>> I am aware of, the function "shell.exec" only comes with the windows
>>>>>>>> version. I think this is a handy little function and would like to see
>>>>>>>> my scripts work when I migrate.
>>>>>>>> 
>>>>>>>> May I propose something (like the following)?
>>>>>>>> 
>>>>>>>> open.file<- function(file) {
>>>>>>>> if(.Platform$OS.type=="windows") {shell.exec(file)} else
>>>>>>>> {system(paste("open ",file))}
>>>>>>>> }
>>>>>>>> 
>>>>>>>> Or just a small addition to the shell.exec function and no new named
>>>>>>>> function.
>>>>>>>> Hope the idea isn't received as "too stupid".
>>>>>>> What is "open" supposed to do on a non-Windows machine? I do not have it on
>>>>>>> the only Linux installation I looked at now, hence we obviously cannot
>>>>>>> assume it exists on an arbitrary installation.
>>>>>> I think the nearest equivalent for those running Gnome or KDE may be
>>>>>> "xdg-open".  So there would probably need to be a new option for specifying
>>>>>> the appropriate command.
>>>>>> 
>>>>>> Personally, I am more inclined to use "system" for executing commands,
>>>>>> and "browseURL" for opening documents.  "browseURL" even uses
>>>>>> "xdg-open" in my R installation on my Linux machine.
>>>>>> 
>>>>>> - Steve
>>>>>> 
>>>>>> 
>>>>>>> Best,
>>>>>>> Uwe Ligges
>>>>>>> 
>>>>>>> 
>>>>>>>> Cheers,
>>>>>>>> Brian
>>>>>>>> 
>>>>>>>> ______________________________________________
>>>>>>>> R-devel at r-project.org mailing list
>>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>>>> ______________________________________________
>>>>>>> R-devel at r-project.org mailing list
>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>>>> 
>>>>> ______________________________________________
>>>>> R-devel at r-project.org mailing list
>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>> 
>>>>> 
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>> 
>>> 
> 
> 


From edd at debian.org  Wed Sep 14 22:44:56 2011
From: edd at debian.org (Dirk Eddelbuettel)
Date: Wed, 14 Sep 2011 15:44:56 -0500
Subject: [Rd] Revision of shell.exec?
In-Reply-To: <012257AC-B91F-4E7E-86AC-95E5833F74AA@r-project.org>
References: <4E708194.8060406@gmail.com>
	<4E709447.10305@statistik.tu-dortmund.de>
	<CALh21i+JyvKJf=UGi2ENTXtB5rbbG-DZuwCYtGb97afG7Nguxg@mail.gmail.com>
	<4E70C350.6020506@gmail.com>
	<74357D3F-67CC-4D09-BBE9-C3988293317F@r-project.org>
	<CAFDcVCRiTPc1f9q+KnsEAoD3SUtb1Za_4waCw1O0r_PbWQFQ+Q@mail.gmail.com>
	<4E710B62.10703@gmail.com>
	<012257AC-B91F-4E7E-86AC-95E5833F74AA@r-project.org>
Message-ID: <20081.4680.253129.80251@max.nulle.part>


On 14 September 2011 at 16:22, Simon Urbanek wrote:
| 
| On Sep 14, 2011, at 4:15 PM, Brian Oney wrote:
| 
| > Hi there,
| > new idea (at 10 at night). All the emails keep me thinking (btw thanks for all the feedback).
| > What does this do on linux?
| > 
| > getOption("pdfviewer")
| > ### I got this idea from: getS3method("print","vignette")
| > 
| 
| It gives you the detected PDF viewer as I was explaining (essentially R_PDFVIEWER). The two detected settings I was referring to are R_PDFVIEWER (for PDF) and R_BROWSER (for URLs) which are the initial settings for the "pdfviewer" and "browser" options.
| 
| Note that it's what it say it is - R_PDFVIEWER is usually something like acroread or evince so not particularly useful for your purpose ...

R> getOption("pdfviewer")
[1] "/usr/bin/xdg-open"
R> 

We've had that as xdg-open in Debian / Ubuntu for a while now...

Dirk

-- 
New Rcpp master class for R and C++ integration is scheduled for 
San Francisco (Oct 8), more details / reg.info available at
http://www.revolutionanalytics.com/products/training/public/rcpp-master-class.php


From simon.urbanek at r-project.org  Wed Sep 14 22:56:25 2011
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Wed, 14 Sep 2011 16:56:25 -0400
Subject: [Rd] Revision of shell.exec?
In-Reply-To: <20081.4680.253129.80251@max.nulle.part>
References: <4E708194.8060406@gmail.com>
	<4E709447.10305@statistik.tu-dortmund.de>
	<CALh21i+JyvKJf=UGi2ENTXtB5rbbG-DZuwCYtGb97afG7Nguxg@mail.gmail.com>
	<4E70C350.6020506@gmail.com>
	<74357D3F-67CC-4D09-BBE9-C3988293317F@r-project.org>
	<CAFDcVCRiTPc1f9q+KnsEAoD3SUtb1Za_4waCw1O0r_PbWQFQ+Q@mail.gmail.com>
	<4E710B62.10703@gmail.com>
	<012257AC-B91F-4E7E-86AC-95E5833F74AA@r-project.org>
	<20081.4680.253129.80251@max.nulle.part>
Message-ID: <914EDA75-E5B9-4B75-8171-1A3A2B87C9A7@r-project.org>


On Sep 14, 2011, at 4:44 PM, Dirk Eddelbuettel wrote:

> 
> On 14 September 2011 at 16:22, Simon Urbanek wrote:
> | 
> | On Sep 14, 2011, at 4:15 PM, Brian Oney wrote:
> | 
> | > Hi there,
> | > new idea (at 10 at night). All the emails keep me thinking (btw thanks for all the feedback).
> | > What does this do on linux?
> | > 
> | > getOption("pdfviewer")
> | > ### I got this idea from: getS3method("print","vignette")
> | > 
> | 
> | It gives you the detected PDF viewer as I was explaining (essentially R_PDFVIEWER). The two detected settings I was referring to are R_PDFVIEWER (for PDF) and R_BROWSER (for URLs) which are the initial settings for the "pdfviewer" and "browser" options.
> | 
> | Note that it's what it say it is - R_PDFVIEWER is usually something like acroread or evince so not particularly useful for your purpose ...
> 
> R> getOption("pdfviewer")
> [1] "/usr/bin/xdg-open"
> R> 
> 
> We've had that as xdg-open in Debian / Ubuntu for a while now...
> 

Yes, but that's merely a side-effect. For example on Ubuntu (R from sources) I get

gis:~$ Rscript -e 'cat(getOption("pdfviewer"),"\n")'
/usr/bin/X11/evince 

because xdg-open is not installed by default. My point is that the setting is meant for something else, so misappropriating it, although possible, may not be wise. If you really want to go down that alley, you could use some logic like

if (identical(getOption("pdfviewer"), getOption("browser"))) { # better chance that it's something that can open things universally
} else { ## well, bad luck ... }

That will work on Macs and possibly on OSes that have generic open commands ... (but is not guaranteed to ...).

Cheers,
Simon



> Dirk
> 
> -- 
> New Rcpp master class for R and C++ integration is scheduled for 
> San Francisco (Oct 8), more details / reg.info available at
> http://www.revolutionanalytics.com/products/training/public/rcpp-master-class.php
> 
> 


From ligges at statistik.tu-dortmund.de  Thu Sep 15 10:27:28 2011
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Thu, 15 Sep 2011 10:27:28 +0200
Subject: [Rd] Revision of shell.exec?
In-Reply-To: <4E710B62.10703@gmail.com>
References: <4E708194.8060406@gmail.com>
	<4E709447.10305@statistik.tu-dortmund.de>
	<CALh21i+JyvKJf=UGi2ENTXtB5rbbG-DZuwCYtGb97afG7Nguxg@mail.gmail.com>
	<4E70C350.6020506@gmail.com>
	<74357D3F-67CC-4D09-BBE9-C3988293317F@r-project.org>
	<CAFDcVCRiTPc1f9q+KnsEAoD3SUtb1Za_4waCw1O0r_PbWQFQ+Q@mail.gmail.com>
	<4E710B62.10703@gmail.com>
Message-ID: <4E71B6F0.5040106@statistik.tu-dortmund.de>



On 14.09.2011 22:15, Brian Oney wrote:
> Hi there,
> new idea (at 10 at night). All the emails keep me thinking (btw thanks
> for all the feedback).
> What does this do on linux?
>
> getOption("pdfviewer")
> ### I got this idea from: getS3method("print","vignette")
>
> On windows, (an advantage...) somebody wrote a little program "open.exe"
> that comes stock with an R-installation, which somehow accesses the file
> system to find the default program to for a certain file type. I am
> guessing this little beauty is the engine of "shell.exec".

No. It simply uses ShellExecute() in windows.h, i.e. defined in 
Microsoft's Windows User Interface.?:
http://msdn.microsoft.com/en-us/library/bb762153%28v=vs.85%29.aspx


Uwe Ligges



>
> (An honest) cheers,
> Brian
>
> On 9/14/2011 7:49 PM, Simon Urbanek wrote:
>> On Sep 14, 2011, at 1:10 PM, Henrik Bengtsson wrote:
>>
>>> On Wed, Sep 14, 2011 at 8:35 AM, Simon Urbanek
>>> <simon.urbanek at r-project.org> wrote:
>>>> On Sep 14, 2011, at 11:08 AM, Brian Oney wrote:
>>>>
>>>>> Hi Steve,
>>>>>
>>>>> a quick look at "browseURL" will tell you that indeed "system" or
>>>>> "shell.exec" (on a windows platform) is used to open up a URL.
>>>>> The "open " part of the proposed function was written to work on a
>>>>> Mac. Because Mac is a unix platform, I assumed that the function
>>>>> "open" would be omnipresent on unix platforms, my mistake.
>>>> Well, the problem is that "open" is unfortunately mapped to openvt
>>>> on Linux systems which is a quite obscure anachronism. But since
>>>> Linux is Linux there is no standard way to open a file, so it
>>>> doesn't really matter ;) -- xdg-utils come closest to what one may
>>>> call standard but on many systems they are not installed by default
>>>> (in fact on none of the Linux machines I have around). For URLs R
>>>> does the hard work to try to figure out what to do with them (it
>>>> also does the same for PDFs), but you may end up opening things in a
>>>> browser although that's not what you had in mind.
>>>>
>>>>
>>>>> Well I guess, we know how to make to work on a mac.
>>>>>
>>>> Yes, "open" works very well on Macs and is extremely useful (I use
>>>> it all the time - among other things you can use it with directories
>>>> to browse them...) - it is still beyond me why other unices don't
>>>> bother ...
>>> Apple probably patented it.
>>>
>> I'm pretty sure it's at least as old as NeXT so that's way before the
>> abuse of software patents ;) - but who knows ...
>>
>> Cheers,
>> S
>>
>>
>>
>>> /Henrik
>>>
>>>> Cheers,
>>>> Simon
>>>>
>>>>
>>>>
>>>>> I will make the transition to Linux and get back to this in a
>>>>> while, ok?
>>>>>
>>>>> Cheers,
>>>>> Brian
>>>>>
>>>>>
>>>>> On 9/14/2011 2:50 PM, Stephen Weston wrote:
>>>>>> 2011/9/14 Uwe Ligges<ligges at statistik.tu-dortmund.de>:
>>>>>>> On 14.09.2011 12:27, Brian Oney wrote:
>>>>>>>> Hi List,
>>>>>>>> I hope this is correct list to propose function extensions,
>>>>>>>> sorry if not.
>>>>>>>> I am preparing for a (hopefully painless) migration to linux. As
>>>>>>>> far as
>>>>>>>> I am aware of, the function "shell.exec" only comes with the
>>>>>>>> windows
>>>>>>>> version. I think this is a handy little function and would like
>>>>>>>> to see
>>>>>>>> my scripts work when I migrate.
>>>>>>>>
>>>>>>>> May I propose something (like the following)?
>>>>>>>>
>>>>>>>> open.file<- function(file) {
>>>>>>>> if(.Platform$OS.type=="windows") {shell.exec(file)} else
>>>>>>>> {system(paste("open ",file))}
>>>>>>>> }
>>>>>>>>
>>>>>>>> Or just a small addition to the shell.exec function and no new
>>>>>>>> named
>>>>>>>> function.
>>>>>>>> Hope the idea isn't received as "too stupid".
>>>>>>> What is "open" supposed to do on a non-Windows machine? I do not
>>>>>>> have it on
>>>>>>> the only Linux installation I looked at now, hence we obviously
>>>>>>> cannot
>>>>>>> assume it exists on an arbitrary installation.
>>>>>> I think the nearest equivalent for those running Gnome or KDE may be
>>>>>> "xdg-open". So there would probably need to be a new option for
>>>>>> specifying
>>>>>> the appropriate command.
>>>>>>
>>>>>> Personally, I am more inclined to use "system" for executing
>>>>>> commands,
>>>>>> and "browseURL" for opening documents. "browseURL" even uses
>>>>>> "xdg-open" in my R installation on my Linux machine.
>>>>>>
>>>>>> - Steve
>>>>>>
>>>>>>
>>>>>>> Best,
>>>>>>> Uwe Ligges
>>>>>>>
>>>>>>>
>>>>>>>> Cheers,
>>>>>>>> Brian
>>>>>>>>
>>>>>>>> ______________________________________________
>>>>>>>> R-devel at r-project.org mailing list
>>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>>>> ______________________________________________
>>>>>>> R-devel at r-project.org mailing list
>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>>>>
>>>>> ______________________________________________
>>>>> R-devel at r-project.org mailing list
>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>>
>>>>>
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>
>>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From murdoch.duncan at gmail.com  Thu Sep 15 12:19:52 2011
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Thu, 15 Sep 2011 06:19:52 -0400
Subject: [Rd] Revision of shell.exec?
In-Reply-To: <4E71B6F0.5040106@statistik.tu-dortmund.de>
References: <4E708194.8060406@gmail.com>	<4E709447.10305@statistik.tu-dortmund.de>	<CALh21i+JyvKJf=UGi2ENTXtB5rbbG-DZuwCYtGb97afG7Nguxg@mail.gmail.com>	<4E70C350.6020506@gmail.com>	<74357D3F-67CC-4D09-BBE9-C3988293317F@r-project.org>	<CAFDcVCRiTPc1f9q+KnsEAoD3SUtb1Za_4waCw1O0r_PbWQFQ+Q@mail.gmail.com>	<4E710B62.10703@gmail.com>
	<4E71B6F0.5040106@statistik.tu-dortmund.de>
Message-ID: <4E71D148.9040403@gmail.com>

On 11-09-15 4:27 AM, Uwe Ligges wrote:
>
>
> On 14.09.2011 22:15, Brian Oney wrote:
>> Hi there,
>> new idea (at 10 at night). All the emails keep me thinking (btw thanks
>> for all the feedback).
>> What does this do on linux?
>>
>> getOption("pdfviewer")
>> ### I got this idea from: getS3method("print","vignette")
>>
>> On windows, (an advantage...) somebody wrote a little program "open.exe"
>> that comes stock with an R-installation, which somehow accesses the file
>> system to find the default program to for a certain file type. I am
>> guessing this little beauty is the engine of "shell.exec".
>
> No. It simply uses ShellExecute() in windows.h, i.e. defined in
> Microsoft's Windows User Interface.?:
> http://msdn.microsoft.com/en-us/library/bb762153%28v=vs.85%29.aspx

Yes, and open.exe is a simple command line wrapper for that call.

Duncan Murdoch


>
> Uwe Ligges
>
>
>
>>
>> (An honest) cheers,
>> Brian
>>
>> On 9/14/2011 7:49 PM, Simon Urbanek wrote:
>>> On Sep 14, 2011, at 1:10 PM, Henrik Bengtsson wrote:
>>>
>>>> On Wed, Sep 14, 2011 at 8:35 AM, Simon Urbanek
>>>> <simon.urbanek at r-project.org>  wrote:
>>>>> On Sep 14, 2011, at 11:08 AM, Brian Oney wrote:
>>>>>
>>>>>> Hi Steve,
>>>>>>
>>>>>> a quick look at "browseURL" will tell you that indeed "system" or
>>>>>> "shell.exec" (on a windows platform) is used to open up a URL.
>>>>>> The "open " part of the proposed function was written to work on a
>>>>>> Mac. Because Mac is a unix platform, I assumed that the function
>>>>>> "open" would be omnipresent on unix platforms, my mistake.
>>>>> Well, the problem is that "open" is unfortunately mapped to openvt
>>>>> on Linux systems which is a quite obscure anachronism. But since
>>>>> Linux is Linux there is no standard way to open a file, so it
>>>>> doesn't really matter ;) -- xdg-utils come closest to what one may
>>>>> call standard but on many systems they are not installed by default
>>>>> (in fact on none of the Linux machines I have around). For URLs R
>>>>> does the hard work to try to figure out what to do with them (it
>>>>> also does the same for PDFs), but you may end up opening things in a
>>>>> browser although that's not what you had in mind.
>>>>>
>>>>>
>>>>>> Well I guess, we know how to make to work on a mac.
>>>>>>
>>>>> Yes, "open" works very well on Macs and is extremely useful (I use
>>>>> it all the time - among other things you can use it with directories
>>>>> to browse them...) - it is still beyond me why other unices don't
>>>>> bother ...
>>>> Apple probably patented it.
>>>>
>>> I'm pretty sure it's at least as old as NeXT so that's way before the
>>> abuse of software patents ;) - but who knows ...
>>>
>>> Cheers,
>>> S
>>>
>>>
>>>
>>>> /Henrik
>>>>
>>>>> Cheers,
>>>>> Simon
>>>>>
>>>>>
>>>>>
>>>>>> I will make the transition to Linux and get back to this in a
>>>>>> while, ok?
>>>>>>
>>>>>> Cheers,
>>>>>> Brian
>>>>>>
>>>>>>
>>>>>> On 9/14/2011 2:50 PM, Stephen Weston wrote:
>>>>>>> 2011/9/14 Uwe Ligges<ligges at statistik.tu-dortmund.de>:
>>>>>>>> On 14.09.2011 12:27, Brian Oney wrote:
>>>>>>>>> Hi List,
>>>>>>>>> I hope this is correct list to propose function extensions,
>>>>>>>>> sorry if not.
>>>>>>>>> I am preparing for a (hopefully painless) migration to linux. As
>>>>>>>>> far as
>>>>>>>>> I am aware of, the function "shell.exec" only comes with the
>>>>>>>>> windows
>>>>>>>>> version. I think this is a handy little function and would like
>>>>>>>>> to see
>>>>>>>>> my scripts work when I migrate.
>>>>>>>>>
>>>>>>>>> May I propose something (like the following)?
>>>>>>>>>
>>>>>>>>> open.file<- function(file) {
>>>>>>>>> if(.Platform$OS.type=="windows") {shell.exec(file)} else
>>>>>>>>> {system(paste("open ",file))}
>>>>>>>>> }
>>>>>>>>>
>>>>>>>>> Or just a small addition to the shell.exec function and no new
>>>>>>>>> named
>>>>>>>>> function.
>>>>>>>>> Hope the idea isn't received as "too stupid".
>>>>>>>> What is "open" supposed to do on a non-Windows machine? I do not
>>>>>>>> have it on
>>>>>>>> the only Linux installation I looked at now, hence we obviously
>>>>>>>> cannot
>>>>>>>> assume it exists on an arbitrary installation.
>>>>>>> I think the nearest equivalent for those running Gnome or KDE may be
>>>>>>> "xdg-open". So there would probably need to be a new option for
>>>>>>> specifying
>>>>>>> the appropriate command.
>>>>>>>
>>>>>>> Personally, I am more inclined to use "system" for executing
>>>>>>> commands,
>>>>>>> and "browseURL" for opening documents. "browseURL" even uses
>>>>>>> "xdg-open" in my R installation on my Linux machine.
>>>>>>>
>>>>>>> - Steve
>>>>>>>
>>>>>>>
>>>>>>>> Best,
>>>>>>>> Uwe Ligges
>>>>>>>>
>>>>>>>>
>>>>>>>>> Cheers,
>>>>>>>>> Brian
>>>>>>>>>
>>>>>>>>> ______________________________________________
>>>>>>>>> R-devel at r-project.org mailing list
>>>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>>>>> ______________________________________________
>>>>>>>> R-devel at r-project.org mailing list
>>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>>>>>
>>>>>> ______________________________________________
>>>>>> R-devel at r-project.org mailing list
>>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>>>
>>>>>>
>>>>> ______________________________________________
>>>>> R-devel at r-project.org mailing list
>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>>
>>>>
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From stephen.b.weston at gmail.com  Wed Sep 14 14:50:18 2011
From: stephen.b.weston at gmail.com (Stephen Weston)
Date: Wed, 14 Sep 2011 08:50:18 -0400
Subject: [Rd] Revision of shell.exec?
In-Reply-To: <4E709447.10305@statistik.tu-dortmund.de>
References: <4E708194.8060406@gmail.com>
	<4E709447.10305@statistik.tu-dortmund.de>
Message-ID: <CALh21i+JyvKJf=UGi2ENTXtB5rbbG-DZuwCYtGb97afG7Nguxg@mail.gmail.com>

2011/9/14 Uwe Ligges <ligges at statistik.tu-dortmund.de>:
>
>
> On 14.09.2011 12:27, Brian Oney wrote:
>>
>> Hi List,
>> I hope this is correct list to propose function extensions, sorry if not.
>> I am preparing for a (hopefully painless) migration to linux. As far as
>> I am aware of, the function "shell.exec" only comes with the windows
>> version. I think this is a handy little function and would like to see
>> my scripts work when I migrate.
>>
>> May I propose something (like the following)?
>>
>> open.file <- function(file) {
>> if(.Platform$OS.type=="windows") {shell.exec(file)} else
>> {system(paste("open ",file))}
>> }
>>
>> Or just a small addition to the shell.exec function and no new named
>> function.
>> Hope the idea isn't received as "too stupid".
>
> What is "open" supposed to do on a non-Windows machine? I do not have it on
> the only Linux installation I looked at now, hence we obviously cannot
> assume it exists on an arbitrary installation.

I think the nearest equivalent for those running Gnome or KDE may be
"xdg-open".  So there would probably need to be a new option for specifying
the appropriate command.

Personally, I am more inclined to use "system" for executing commands,
and "browseURL" for opening documents.  "browseURL" even uses
"xdg-open" in my R installation on my Linux machine.

- Steve


>
> Best,
> Uwe Ligges
>
>
>>
>> Cheers,
>> Brian
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From edzer.pebesma at uni-muenster.de  Wed Sep 14 23:00:38 2011
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Wed, 14 Sep 2011 23:00:38 +0200
Subject: [Rd] S4 method dispatch
Message-ID: <4E7115F6.20209@uni-muenster.de>

List,

In order to get rid of some old, unreadable S3 code in package sp, I'm
trying to rewrite things using S4 methods. Somewhere I fail, and I
cannot sort out why. In order to isolate the problem, I created two
functions, doNothing<- and dosth, and both should do nothing. The issue
is that in most cases they do nothing, but in some cases dosth(obj)
changes the class of obj and breaks with the error. I couldn't find a
pattern when this happens, but have a few cases where it consistently
breaks. Here's the code snippet:

setGeneric("doNothing<-", function(object, value)
    standardGeneric("doNothing<-"))

setReplaceMethod("doNothing",
    signature(object = "Spatial", value = "ANY"),
    function(object, value) object)

dosth = function(obj) {
    cl1 = class(obj)
    doNothing(obj) = TRUE
    cl2 = class(obj)
    if (!identical(cl1, cl2)) {
        print(paste(cl1, cl2))
        stopifnot(identical(cl1, cl2))
    }
    obj
}

When things go wrong, dosth and doNothing are called with a subclass of
Spatial, e.g. an object of class SpatialGrid, but when this gets in
doNothing, the object is suddenly of class Spatial, and is then returned
as an object of class Spatial, which should never happen.

For instance, I have a case where consistently

setMethod("fullgrid", c("Spatial"),
    function(obj) { is(obj, "SpatialGrid") })
> class(g)
[1] "SpatialGrid"
attr(,"package")
[1] "sp"
> fullgrid(g)
[1] FALSE

is obviously false, but in other cases it works fine.

When I change the signature of doNothing to signature(object = "ANY",
value = "ANY"), the problem disappears.

I tried to make a self-contained example that reproduced the issue, but
could only get something that worked as expected.

I would appreciate any help or suggestions.
-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From jbullard at pacificbiosciences.com  Wed Sep 14 23:21:25 2011
From: jbullard at pacificbiosciences.com (James Bullard)
Date: Wed, 14 Sep 2011 21:21:25 +0000
Subject: [Rd] External pointers and an apparent memory leak
Message-ID: <7B72273302B0994797DC8CC69E56FD260450FA@DC-EXCHMBX01.Nanofluidics.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20110914/21291978/attachment.pl>

From matt at biostatmatt.com  Thu Sep 15 16:05:35 2011
From: matt at biostatmatt.com (Matt Shotwell)
Date: Thu, 15 Sep 2011 09:05:35 -0500
Subject: [Rd] External pointers and an apparent memory leak
In-Reply-To: <7B72273302B0994797DC8CC69E56FD260450FA@DC-EXCHMBX01.Nanofluidics.com>
References: <7B72273302B0994797DC8CC69E56FD260450FA@DC-EXCHMBX01.Nanofluidics.com>
Message-ID: <1316095535.1829.11.camel@pal>

James, 

Works for me!

In a file, 'test.c', I have:

void h5R_allocate_finalizer(SEXP eptr) {
    char* vector = (char*) R_ExternalPtrAddr(eptr);
    free(vector);
    printf("memory freed at address %lu\n", (long unsigned) vector);
    R_ClearExternalPtr(eptr);
}

SEXP h5R_allocate(SEXP size) {
    int i = INTEGER(size)[0];
    char* vector = (char*) malloc(i*sizeof(char));
    printf("memory allocated at address %lu\n", (long unsigned) vector);
    SEXP e_ptr = R_MakeExternalPtr(vector, R_NilValue, R_NilValue);
    R_RegisterCFinalizerEx(e_ptr, h5R_allocate_finalizer, TRUE);
    return e_ptr;
}

I generated the shared library with R CMD SHLIB. Then, at the R prompt:

R> dyn.load('test.so')
R> system(paste('ps -eo pid,vsz | grep', Sys.getpid()))
10961  77160
R> v <- .Call('h5R_allocate', as.integer(2^24))
memory allocated at address 140127935406096
R> system(paste('ps -eo pid,vsz | grep', Sys.getpid()))
10961  93548
R> rm(v); gc()
memory freed at address 140127935406096
         used (Mb) gc trigger (Mb) max used (Mb)
Ncells 132769  7.1     350000 18.7   350000 18.7
Vcells 129312  1.0     786432  6.0   555216  4.3
R> system(paste('ps -eo pid,vsz | grep', Sys.getpid()))
10961  77160

It appears that the external pointer is behaving as expected. However, I
did find that gc() may not immediately collect the removed object 'v'.
Sometimes it took more than one call. In any case, the memory was freed
when R exits.

Best,
Matt

On Wed, 2011-09-14 at 21:21 +0000, James Bullard wrote:
> I'm using external pointers and seemingly leaking memory. My determination of a memory leak is that the R process continually creeps up in memory as seen by top while the usage as reported by gc() stays flat. I have isolated the C code:
> 
> void h5R_allocate_finalizer(SEXP eptr) {
>     Rprintf("Calling the finalizer\n");
>     void* vector = R_ExternalPtrAddr(eptr);
>     free(vector);
>     R_ClearExternalPtr(eptr);
> }
> 
> SEXP h5R_allocate(SEXP size) {
>     int i = INTEGER(size)[0];
>     char* vector = (char*) malloc(i*sizeof(char));
>     SEXP e_ptr = R_MakeExternalPtr(vector, R_NilValue, R_NilValue);
>     R_RegisterCFinalizerEx(e_ptr, h5R_allocate_finalizer, TRUE);
>     return e_ptr;
> }
> 
> 
> If I run an R program like this:
> 
> v <- replicate(100000, {
>   .Call("h5R_allocate", as.integer(1000000))
> })
> rm(v)
> gc()
> 
> Then you can see the problem (top reports that R still has a bunch of memory, but R doesn't think it does). I have tried using valgrind and it says I have memory left on the table at the end lest you think it is because top. Also, I have tried Free/Calloc as well and this doesn't make a difference. Finally, I see this in both R-2-12 (patched) and R-2-13 - I think it is more an understanding issue on my part.
> 
> thanks much in advance, to me it really resembles the connection.c code, but what am I missing?
> 
> thanks, jim
> 
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From simon.urbanek at r-project.org  Thu Sep 15 17:35:55 2011
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Thu, 15 Sep 2011 11:35:55 -0400
Subject: [Rd] External pointers and an apparent memory leak
In-Reply-To: <7B72273302B0994797DC8CC69E56FD260450FA@DC-EXCHMBX01.Nanofluidics.com>
References: <7B72273302B0994797DC8CC69E56FD260450FA@DC-EXCHMBX01.Nanofluidics.com>
Message-ID: <D67194B6-A1F2-44B9-9DD1-61139E75DEAC@r-project.org>

Jim,

On Sep 14, 2011, at 5:21 PM, James Bullard wrote:

> I'm using external pointers and seemingly leaking memory. My determination of a memory leak is that the R process continually creeps up in memory as seen by top while the usage as reported by gc() stays flat. I have isolated the C code:
> 
> void h5R_allocate_finalizer(SEXP eptr) {
>    Rprintf("Calling the finalizer\n");
>    void* vector = R_ExternalPtrAddr(eptr);
>    free(vector);
>    R_ClearExternalPtr(eptr);
> }
> 
> SEXP h5R_allocate(SEXP size) {
>    int i = INTEGER(size)[0];
>    char* vector = (char*) malloc(i*sizeof(char));
>    SEXP e_ptr = R_MakeExternalPtr(vector, R_NilValue, R_NilValue);
>    R_RegisterCFinalizerEx(e_ptr, h5R_allocate_finalizer, TRUE);
>    return e_ptr;
> }
> 
> 
> If I run an R program like this:
> 
> v <- replicate(100000, {
>  .Call("h5R_allocate", as.integer(1000000))
> })
> rm(v)
> gc()
> 

This seems a little optimistic to me - at least on the machines most mortals have - since it will allocate ~93GB of memory - before rm/gc:

vmmap:

                                 VIRTUAL ALLOCATION      BYTES
MALLOC ZONE                         SIZE      COUNT  ALLOCATED  % FULL
===========                      =======  =========  =========  ======
DefaultMallocZone_0x1004cf000      62.8M     120044      93.5G    152363%
environ_0x100601000                1024K         27       1280      0%
===========                      =======  =========  =========  ======
TOTAL                              63.8M     120071      93.5G    149977%

ps:

  UID   PID  PPID CPU PRI NI      VSZ    RSS WCHAN  STAT   TT       TIME COMMAND
  501 26287 26170   0  31  0 100511220  64864 -      S+   s002    1:06.81 /Library/Frameworks/R.framework/Resources/bin/exec/x86_64/R

fortunately it's never used, so it's actually possible (purely virtual). But as Matt said, it gets released without problems - after rm/gc:

> gc()
         used (Mb) gc trigger (Mb) max used (Mb)
Ncells 433341 23.2     667722 35.7   597831 32.0
Vcells 630031  4.9    1300721 10.0  1211088  9.3

                                 VIRTUAL ALLOCATION      BYTES
MALLOC ZONE                         SIZE      COUNT  ALLOCATED  % FULL
===========                      =======  =========  =========  ======
DefaultMallocZone_0x1004cf000      59.3M      19083      36.6M     61%
environ_0x100601000                1024K         27       1280      0%
===========                      =======  =========  =========  ======
TOTAL                              60.3M      19110      36.6M     60%

  501 26287 26170   0  31  0  2522872  60880 -      S+   s002    1:35.69 /Library/Frameworks/R.framework/Resources/bin/exec/x86_64/R

> sessionInfo()
R version 2.13.1 (2011-07-08)
Platform: x86_64-apple-darwin9.8.0/x86_64 (64-bit)

locale:
[1] en_US.UTF-8/en_US.UTF-8/C/C/en_US.UTF-8/en_US.UTF-8

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     


> Then you can see the problem (top reports that R still has a bunch of memory, but R doesn't think it does). I have tried using valgrind and it says I have memory left on the table at the end lest you think it is because top. Also, I have tried Free/Calloc as well and this doesn't make a difference. Finally, I see this in both R-2-12 (patched) and R-2-13 - I think it is more an understanding issue on my part.
> 

You didn't mention your OS - some OSes do not release memory immediately (some wait until you try to allocate new memory) and some can't release certain type of memory at all. Also depending on your OS allocation library you can get more info about the allocation pool to understand what is going on. But for that you'd have to share with us the platform info ...


> thanks much in advance, to me it really resembles the connection.c code, but what am I missing?
> 

Cheers,
Simon


PS: This has nothing to do with your question but I'd suggest checking the result on malloc [e.g.,
if (!vector) Rf_error("unable to allocate %d bytes", i);
Also i = asInteger(size) is much more safe (and convenient) than i = INTEGER(size)[0] and completely irrelevantly as.integer(1000000) is more efficiently written as 1000000L.


> thanks, jim
> 
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 


From jbullard at pacificbiosciences.com  Thu Sep 15 19:30:00 2011
From: jbullard at pacificbiosciences.com (James Bullard)
Date: Thu, 15 Sep 2011 17:30:00 +0000
Subject: [Rd] External pointers and an apparent memory leak
In-Reply-To: <D67194B6-A1F2-44B9-9DD1-61139E75DEAC@r-project.org>
References: <7B72273302B0994797DC8CC69E56FD260450FA@DC-EXCHMBX01.Nanofluidics.com>,
	<D67194B6-A1F2-44B9-9DD1-61139E75DEAC@r-project.org>
Message-ID: <7B72273302B0994797DC8CC69E56FD260452FF@DC-EXCHMBX01.Nanofluidics.com>

Hi Simon, Matt

First, thank you for the help. My memory is still growing and it is clear that I'm removing the things I am allocating - potentially it is just Linux not giving back the memory until another process needs it, but it definitely doesn't behave that way when I allocate directly within R. To be a better poster:

#> system("uname -a")
#Linux mp-f020.nanofluidics.com 2.6.32-30-server #59-Ubuntu SMP Tue Mar 1 22:46:09 UTC 2011 x86_64 #GNU/Linux

#> sessionInfo()
#R version 2.13.1 Patched (2011-09-13 r57007)
#Platform: x86_64-unknown-linux-gnu (64-bit)

Here, if you look at the successive allocations you'll see that by the end I have started to grow my memory and, at least w.r.t. the ps method of memory profiling, I'm leaking memory.

> showPS <- function() system(paste('ps -eo pid,vsz,%mem | grep', Sys.getpid()))
> gcl <- function() { lapply(1:10, gc, verbose = F)[[10]] }
> 
> showPS()
18937 147828  0.1
> m <- .Call("h5R_allocate_gig")
> rm(m)
> gcl()
         used (Mb) gc trigger (Mb) max used (Mb)
Ncells 213919 11.5     407500 21.8   213919 11.5
Vcells 168725  1.3     786432  6.0   168725  1.3
> showPS()
18937 147828  0.1
> 
> m <- sapply(1:1000, function(a) {
+   .Call("h5R_allocate_meg")
+ })
> rm(m)
> gcl()
         used (Mb) gc trigger (Mb) max used (Mb)
Ncells 213920 11.5     467875   25   213920 11.5
Vcells 168725  1.3     786432    6   168725  1.3
> showPS()
18937 147828  0.1
> 
> m <- sapply(1:100000, function(a) {
+   .Call("h5R_allocate_k")
+ })
> rm(m)
> gcl()
         used (Mb) gc trigger (Mb) max used (Mb)
Ncells 213920 11.5     818163 43.7   213920 11.5
Vcells 168725  1.3     895968  6.9   168725  1.3
> showPS()
18937 271860  0.9
> 
> m <- sapply(1:1000000, function(a) {
+   .Call("h5R_allocate_k")
+ })
> rm(m)
> gcl()
         used (Mb) gc trigger (Mb) max used (Mb)
Ncells 213920 11.5     785114 42.0   213920 11.5
Vcells 168725  1.3    1582479 12.1   168725  1.3
> showPS()
18937 1409568  7.8

I have redone the examples to better demonstrate the issue I am seeing. Below is the C code:

#include <hdf5.h>
#include <Rinternals.h>    
#include <R.h>
void h5R_allocate_finalizer(SEXP eptr) {
    char* vector = R_ExternalPtrAddr(eptr);
    Free(vector);
    R_ClearExternalPtr(eptr);
}
SEXP h5R_allocate_meg() {
    char* vector = (char*) Calloc(1048576, char);
    for (int j = 0; j < 1048576; j++) {
    	vector[j] = 'c';
    }
    SEXP e_ptr = R_MakeExternalPtr(vector, R_NilValue, R_NilValue); 
    PROTECT(e_ptr);
    R_RegisterCFinalizerEx(e_ptr, h5R_allocate_finalizer, TRUE);
    UNPROTECT(1);
    return e_ptr;
}
SEXP h5R_allocate_k() {
    char* vector = (char*) Calloc(1024, char);
    for (int j = 0; j < 1024; j++) {
    	vector[j] = 'c';
    }
    SEXP e_ptr = R_MakeExternalPtr(vector, R_NilValue, R_NilValue); 
    PROTECT(e_ptr);
    R_RegisterCFinalizerEx(e_ptr, h5R_allocate_finalizer, TRUE);
    UNPROTECT(1);
    return e_ptr;
}
SEXP h5R_allocate_gig() {
    char* vector = (char*) Calloc(1073741824, char);
    for (int j = 0; j < 1073741824; j++) {
    	vector[j] = 'c';
    }
    SEXP e_ptr = R_MakeExternalPtr(vector, R_NilValue, R_NilValue); 
    PROTECT(e_ptr);
    R_RegisterCFinalizerEx(e_ptr, h5R_allocate_finalizer, TRUE);
    UNPROTECT(1);
    return e_ptr;
}


Finally, when I use valgrind on the test script, I see:

==22098== 135,792 bytes in 69 blocks are possibly lost in loss record 1,832 of 1,858
==22098==    at 0x4C274A8: malloc (vg_replace_malloc.c:236)
==22098==    by 0x4F5D799: GetNewPage (memory.c:786)
==22098==    by 0x4F5EE6F: Rf_allocVector (memory.c:2330)
==22098==    by 0x4F6007F: R_MakeWeakRefC (memory.c:1198)
==22098==    by 0xE01BACF: h5R_allocate_k (h5_debug.c:33)
==22098==    by 0x4EE17E4: do_dotcall (dotcode.c:837)
==22098==    by 0x4F18D02: Rf_eval (eval.c:508)
==22098==    by 0x4F1A7FD: do_begin (eval.c:1420)
==22098==    by 0x4F18B1A: Rf_eval (eval.c:482)
==22098==    by 0x4F1B7FC: Rf_applyClosure (eval.c:838)
==22098==    by 0x4F189F7: Rf_eval (eval.c:526)
==22098==    by 0x4E6F3D8: do_lapply (apply.c:72)

Thanks for any help!

jim
________________________________________
From: Simon Urbanek [simon.urbanek at r-project.org]
Sent: Thursday, September 15, 2011 8:35 AM
To: James Bullard
Cc: r-devel at r-project.org
Subject: Re: [Rd] External pointers and an apparent memory leak

Jim,

On Sep 14, 2011, at 5:21 PM, James Bullard wrote:

> I'm using external pointers and seemingly leaking memory. My determination of a memory leak is that the R process continually creeps up in memory as seen by top while the usage as reported by gc() stays flat. I have isolated the C code:
>
> void h5R_allocate_finalizer(SEXP eptr) {
>    Rprintf("Calling the finalizer\n");
>    void* vector = R_ExternalPtrAddr(eptr);
>    free(vector);
>    R_ClearExternalPtr(eptr);
> }
>
> SEXP h5R_allocate(SEXP size) {
>    int i = INTEGER(size)[0];
>    char* vector = (char*) malloc(i*sizeof(char));
>    SEXP e_ptr = R_MakeExternalPtr(vector, R_NilValue, R_NilValue);
>    R_RegisterCFinalizerEx(e_ptr, h5R_allocate_finalizer, TRUE);
>    return e_ptr;
> }
>
>
> If I run an R program like this:
>
> v <- replicate(100000, {
>  .Call("h5R_allocate", as.integer(1000000))
> })
> rm(v)
> gc()
>

This seems a little optimistic to me - at least on the machines most mortals have - since it will allocate ~93GB of memory - before rm/gc:

vmmap:

                                 VIRTUAL ALLOCATION      BYTES
MALLOC ZONE                         SIZE      COUNT  ALLOCATED  % FULL
===========                      =======  =========  =========  ======
DefaultMallocZone_0x1004cf000      62.8M     120044      93.5G    152363%
environ_0x100601000                1024K         27       1280      0%
===========                      =======  =========  =========  ======
TOTAL                              63.8M     120071      93.5G    149977%

ps:

  UID   PID  PPID CPU PRI NI      VSZ    RSS WCHAN  STAT   TT       TIME COMMAND
  501 26287 26170   0  31  0 100511220  64864 -      S+   s002    1:06.81 /Library/Frameworks/R.framework/Resources/bin/exec/x86_64/R

fortunately it's never used, so it's actually possible (purely virtual). But as Matt said, it gets released without problems - after rm/gc:

> gc()
         used (Mb) gc trigger (Mb) max used (Mb)
Ncells 433341 23.2     667722 35.7   597831 32.0
Vcells 630031  4.9    1300721 10.0  1211088  9.3

                                 VIRTUAL ALLOCATION      BYTES
MALLOC ZONE                         SIZE      COUNT  ALLOCATED  % FULL
===========                      =======  =========  =========  ======
DefaultMallocZone_0x1004cf000      59.3M      19083      36.6M     61%
environ_0x100601000                1024K         27       1280      0%
===========                      =======  =========  =========  ======
TOTAL                              60.3M      19110      36.6M     60%

  501 26287 26170   0  31  0  2522872  60880 -      S+   s002    1:35.69 /Library/Frameworks/R.framework/Resources/bin/exec/x86_64/R

> sessionInfo()
R version 2.13.1 (2011-07-08)
Platform: x86_64-apple-darwin9.8.0/x86_64 (64-bit)

locale:
[1] en_US.UTF-8/en_US.UTF-8/C/C/en_US.UTF-8/en_US.UTF-8

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base


> Then you can see the problem (top reports that R still has a bunch of memory, but R doesn't think it does). I have tried using valgrind and it says I have memory left on the table at the end lest you think it is because top. Also, I have tried Free/Calloc as well and this doesn't make a difference. Finally, I see this in both R-2-12 (patched) and R-2-13 - I think it is more an understanding issue on my part.
>

You didn't mention your OS - some OSes do not release memory immediately (some wait until you try to allocate new memory) and some can't release certain type of memory at all. Also depending on your OS allocation library you can get more info about the allocation pool to understand what is going on. But for that you'd have to share with us the platform info ...


> thanks much in advance, to me it really resembles the connection.c code, but what am I missing?
>

Cheers,
Simon


PS: This has nothing to do with your question but I'd suggest checking the result on malloc [e.g.,
if (!vector) Rf_error("unable to allocate %d bytes", i);
Also i = asInteger(size) is much more safe (and convenient) than i = INTEGER(size)[0] and completely irrelevantly as.integer(1000000) is more efficiently written as 1000000L.


> thanks, jim
>
>
>       [[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>



From simon.urbanek at r-project.org  Thu Sep 15 21:27:40 2011
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Thu, 15 Sep 2011 15:27:40 -0400
Subject: [Rd] External pointers and an apparent memory leak
In-Reply-To: <7B72273302B0994797DC8CC69E56FD260452FF@DC-EXCHMBX01.Nanofluidics.com>
References: <7B72273302B0994797DC8CC69E56FD260450FA@DC-EXCHMBX01.Nanofluidics.com>,
	<D67194B6-A1F2-44B9-9DD1-61139E75DEAC@r-project.org>
	<7B72273302B0994797DC8CC69E56FD260452FF@DC-EXCHMBX01.Nanofluidics.com>
Message-ID: <D77B1B7E-207C-49E5-9EEC-4EEAE915176B@r-project.org>

Jim,

ok, now we're getting somewhere ;)

The most important details are a) Linux b) small allocations.

The answer is that Linux cannot release the memory due to the way its allocator works - it's not your fault. This has been discussed in part in
https://bugs.r-project.org/bugzilla3/show_bug.cgi?id=14611

You get hit by the same issue - notice that there is no issue for large allocations in your example, because Linux uses mmap for those and not brk. You can use my mallinfo package to query the glibc allocator.

A really simple example to illustrate the issue using just R code is:

a = paste("foo", 1:1e6)
b = "bar"

Linux won't release any brk memory used by a because b is behind it, so even though a is allocated as a whole in a contiguous region, that region is before b so it cannot be released. The same applies to you since your mallocs/callocs will use brk and thus just a single subsequent R object is enough to block it out:

> a = paste("foo", 1:1e6)
> mallinfo()
   arena   ordblks    smblks     hblks    hblkhd   usmblks   fsmblks  uordblks 
120893440       527         1         8  30105600         0       112 120327680 
fordblks  keepcost 
  565760     41584 
> b = "bar"
> .Internal(inspect(a))
@7f9664cd2010 16 STRSXP g1c7 [MARK,NAM(1)] (len=1000000, tl=0)
 @4a67e58 09 CHARSXP g1c1 [MARK,gp=0x20] "foo 1"
 @4a67e28 09 CHARSXP g1c1 [MARK,gp=0x20] "foo 2"
 @4a67df8 09 CHARSXP g1c1 [MARK,gp=0x20] "foo 3"
 @4a67dc8 09 CHARSXP g1c1 [MARK,gp=0x20] "foo 4"
 @4a67d98 09 CHARSXP g1c1 [MARK,gp=0x20] "foo 5"
 ...
> .Internal(inspect(b))
@4a73a48 16 STRSXP g0c1 [NAM(2)] (len=1, tl=0)
 @4a73a18 09 CHARSXP g0c1 [gp=0x20,ATT] "bar"
> rm(a)
> gc()
         used (Mb) gc trigger (Mb) max used  (Mb)
Ncells  132154  7.1    1801024 96.2  2133131 114.0
Vcells 1112432  8.5    7089858 54.1  6613056  50.5
> mallinfo()
   arena   ordblks    smblks     hblks    hblkhd   usmblks   fsmblks  uordblks 
120893440      1019         3         5  10096640         0       176  14944848 
fordblks  keepcost 
105948592     25440 


Cheers,
Simon

 


On Sep 15, 2011, at 1:30 PM, James Bullard wrote:

> Hi Simon, Matt
> 
> First, thank you for the help. My memory is still growing and it is clear that I'm removing the things I am allocating - potentially it is just Linux not giving back the memory until another process needs it, but it definitely doesn't behave that way when I allocate directly within R. To be a better poster:
> 
> #> system("uname -a")
> #Linux mp-f020.nanofluidics.com 2.6.32-30-server #59-Ubuntu SMP Tue Mar 1 22:46:09 UTC 2011 x86_64 #GNU/Linux
> 
> #> sessionInfo()
> #R version 2.13.1 Patched (2011-09-13 r57007)
> #Platform: x86_64-unknown-linux-gnu (64-bit)
> 
> Here, if you look at the successive allocations you'll see that by the end I have started to grow my memory and, at least w.r.t. the ps method of memory profiling, I'm leaking memory.
> 
>> showPS <- function() system(paste('ps -eo pid,vsz,%mem | grep', Sys.getpid()))
>> gcl <- function() { lapply(1:10, gc, verbose = F)[[10]] }
>> 
>> showPS()
> 18937 147828  0.1
>> m <- .Call("h5R_allocate_gig")
>> rm(m)
>> gcl()
>         used (Mb) gc trigger (Mb) max used (Mb)
> Ncells 213919 11.5     407500 21.8   213919 11.5
> Vcells 168725  1.3     786432  6.0   168725  1.3
>> showPS()
> 18937 147828  0.1
>> 
>> m <- sapply(1:1000, function(a) {
> +   .Call("h5R_allocate_meg")
> + })
>> rm(m)
>> gcl()
>         used (Mb) gc trigger (Mb) max used (Mb)
> Ncells 213920 11.5     467875   25   213920 11.5
> Vcells 168725  1.3     786432    6   168725  1.3
>> showPS()
> 18937 147828  0.1
>> 
>> m <- sapply(1:100000, function(a) {
> +   .Call("h5R_allocate_k")
> + })
>> rm(m)
>> gcl()
>         used (Mb) gc trigger (Mb) max used (Mb)
> Ncells 213920 11.5     818163 43.7   213920 11.5
> Vcells 168725  1.3     895968  6.9   168725  1.3
>> showPS()
> 18937 271860  0.9
>> 
>> m <- sapply(1:1000000, function(a) {
> +   .Call("h5R_allocate_k")
> + })
>> rm(m)
>> gcl()
>         used (Mb) gc trigger (Mb) max used (Mb)
> Ncells 213920 11.5     785114 42.0   213920 11.5
> Vcells 168725  1.3    1582479 12.1   168725  1.3
>> showPS()
> 18937 1409568  7.8
> 
> I have redone the examples to better demonstrate the issue I am seeing. Below is the C code:
> 
> #include <hdf5.h>
> #include <Rinternals.h>    
> #include <R.h>
> void h5R_allocate_finalizer(SEXP eptr) {
>    char* vector = R_ExternalPtrAddr(eptr);
>    Free(vector);
>    R_ClearExternalPtr(eptr);
> }
> SEXP h5R_allocate_meg() {
>    char* vector = (char*) Calloc(1048576, char);
>    for (int j = 0; j < 1048576; j++) {
>    	vector[j] = 'c';
>    }
>    SEXP e_ptr = R_MakeExternalPtr(vector, R_NilValue, R_NilValue); 
>    PROTECT(e_ptr);
>    R_RegisterCFinalizerEx(e_ptr, h5R_allocate_finalizer, TRUE);
>    UNPROTECT(1);
>    return e_ptr;
> }
> SEXP h5R_allocate_k() {
>    char* vector = (char*) Calloc(1024, char);
>    for (int j = 0; j < 1024; j++) {
>    	vector[j] = 'c';
>    }
>    SEXP e_ptr = R_MakeExternalPtr(vector, R_NilValue, R_NilValue); 
>    PROTECT(e_ptr);
>    R_RegisterCFinalizerEx(e_ptr, h5R_allocate_finalizer, TRUE);
>    UNPROTECT(1);
>    return e_ptr;
> }
> SEXP h5R_allocate_gig() {
>    char* vector = (char*) Calloc(1073741824, char);
>    for (int j = 0; j < 1073741824; j++) {
>    	vector[j] = 'c';
>    }
>    SEXP e_ptr = R_MakeExternalPtr(vector, R_NilValue, R_NilValue); 
>    PROTECT(e_ptr);
>    R_RegisterCFinalizerEx(e_ptr, h5R_allocate_finalizer, TRUE);
>    UNPROTECT(1);
>    return e_ptr;
> }
> 
> 
> Finally, when I use valgrind on the test script, I see:
> 
> ==22098== 135,792 bytes in 69 blocks are possibly lost in loss record 1,832 of 1,858
> ==22098==    at 0x4C274A8: malloc (vg_replace_malloc.c:236)
> ==22098==    by 0x4F5D799: GetNewPage (memory.c:786)
> ==22098==    by 0x4F5EE6F: Rf_allocVector (memory.c:2330)
> ==22098==    by 0x4F6007F: R_MakeWeakRefC (memory.c:1198)
> ==22098==    by 0xE01BACF: h5R_allocate_k (h5_debug.c:33)
> ==22098==    by 0x4EE17E4: do_dotcall (dotcode.c:837)
> ==22098==    by 0x4F18D02: Rf_eval (eval.c:508)
> ==22098==    by 0x4F1A7FD: do_begin (eval.c:1420)
> ==22098==    by 0x4F18B1A: Rf_eval (eval.c:482)
> ==22098==    by 0x4F1B7FC: Rf_applyClosure (eval.c:838)
> ==22098==    by 0x4F189F7: Rf_eval (eval.c:526)
> ==22098==    by 0x4E6F3D8: do_lapply (apply.c:72)
> 
> Thanks for any help!
> 
> jim
> ________________________________________
> From: Simon Urbanek [simon.urbanek at r-project.org]
> Sent: Thursday, September 15, 2011 8:35 AM
> To: James Bullard
> Cc: r-devel at r-project.org
> Subject: Re: [Rd] External pointers and an apparent memory leak
> 
> Jim,
> 
> On Sep 14, 2011, at 5:21 PM, James Bullard wrote:
> 
>> I'm using external pointers and seemingly leaking memory. My determination of a memory leak is that the R process continually creeps up in memory as seen by top while the usage as reported by gc() stays flat. I have isolated the C code:
>> 
>> void h5R_allocate_finalizer(SEXP eptr) {
>>   Rprintf("Calling the finalizer\n");
>>   void* vector = R_ExternalPtrAddr(eptr);
>>   free(vector);
>>   R_ClearExternalPtr(eptr);
>> }
>> 
>> SEXP h5R_allocate(SEXP size) {
>>   int i = INTEGER(size)[0];
>>   char* vector = (char*) malloc(i*sizeof(char));
>>   SEXP e_ptr = R_MakeExternalPtr(vector, R_NilValue, R_NilValue);
>>   R_RegisterCFinalizerEx(e_ptr, h5R_allocate_finalizer, TRUE);
>>   return e_ptr;
>> }
>> 
>> 
>> If I run an R program like this:
>> 
>> v <- replicate(100000, {
>> .Call("h5R_allocate", as.integer(1000000))
>> })
>> rm(v)
>> gc()
>> 
> 
> This seems a little optimistic to me - at least on the machines most mortals have - since it will allocate ~93GB of memory - before rm/gc:
> 
> vmmap:
> 
>                                 VIRTUAL ALLOCATION      BYTES
> MALLOC ZONE                         SIZE      COUNT  ALLOCATED  % FULL
> ===========                      =======  =========  =========  ======
> DefaultMallocZone_0x1004cf000      62.8M     120044      93.5G    152363%
> environ_0x100601000                1024K         27       1280      0%
> ===========                      =======  =========  =========  ======
> TOTAL                              63.8M     120071      93.5G    149977%
> 
> ps:
> 
>  UID   PID  PPID CPU PRI NI      VSZ    RSS WCHAN  STAT   TT       TIME COMMAND
>  501 26287 26170   0  31  0 100511220  64864 -      S+   s002    1:06.81 /Library/Frameworks/R.framework/Resources/bin/exec/x86_64/R
> 
> fortunately it's never used, so it's actually possible (purely virtual). But as Matt said, it gets released without problems - after rm/gc:
> 
>> gc()
>         used (Mb) gc trigger (Mb) max used (Mb)
> Ncells 433341 23.2     667722 35.7   597831 32.0
> Vcells 630031  4.9    1300721 10.0  1211088  9.3
> 
>                                 VIRTUAL ALLOCATION      BYTES
> MALLOC ZONE                         SIZE      COUNT  ALLOCATED  % FULL
> ===========                      =======  =========  =========  ======
> DefaultMallocZone_0x1004cf000      59.3M      19083      36.6M     61%
> environ_0x100601000                1024K         27       1280      0%
> ===========                      =======  =========  =========  ======
> TOTAL                              60.3M      19110      36.6M     60%
> 
>  501 26287 26170   0  31  0  2522872  60880 -      S+   s002    1:35.69 /Library/Frameworks/R.framework/Resources/bin/exec/x86_64/R
> 
>> sessionInfo()
> R version 2.13.1 (2011-07-08)
> Platform: x86_64-apple-darwin9.8.0/x86_64 (64-bit)
> 
> locale:
> [1] en_US.UTF-8/en_US.UTF-8/C/C/en_US.UTF-8/en_US.UTF-8
> 
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
> 
> 
>> Then you can see the problem (top reports that R still has a bunch of memory, but R doesn't think it does). I have tried using valgrind and it says I have memory left on the table at the end lest you think it is because top. Also, I have tried Free/Calloc as well and this doesn't make a difference. Finally, I see this in both R-2-12 (patched) and R-2-13 - I think it is more an understanding issue on my part.
>> 
> 
> You didn't mention your OS - some OSes do not release memory immediately (some wait until you try to allocate new memory) and some can't release certain type of memory at all. Also depending on your OS allocation library you can get more info about the allocation pool to understand what is going on. But for that you'd have to share with us the platform info ...
> 
> 
>> thanks much in advance, to me it really resembles the connection.c code, but what am I missing?
>> 
> 
> Cheers,
> Simon
> 
> 
> PS: This has nothing to do with your question but I'd suggest checking the result on malloc [e.g.,
> if (!vector) Rf_error("unable to allocate %d bytes", i);
> Also i = asInteger(size) is much more safe (and convenient) than i = INTEGER(size)[0] and completely irrelevantly as.integer(1000000) is more efficiently written as 1000000L.
> 
> 
>> thanks, jim
>> 
>> 
>>      [[alternative HTML version deleted]]
>> 
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>> 
>> 
> 
> 
> 


From edd at debian.org  Thu Sep 15 14:16:32 2011
From: edd at debian.org (Dirk Eddelbuettel)
Date: Thu, 15 Sep 2011 07:16:32 -0500
Subject: [Rd] Revision of shell.exec?
In-Reply-To: <914EDA75-E5B9-4B75-8171-1A3A2B87C9A7@r-project.org>
References: <4E708194.8060406@gmail.com>
	<4E709447.10305@statistik.tu-dortmund.de>
	<CALh21i+JyvKJf=UGi2ENTXtB5rbbG-DZuwCYtGb97afG7Nguxg@mail.gmail.com>
	<4E70C350.6020506@gmail.com>
	<74357D3F-67CC-4D09-BBE9-C3988293317F@r-project.org>
	<CAFDcVCRiTPc1f9q+KnsEAoD3SUtb1Za_4waCw1O0r_PbWQFQ+Q@mail.gmail.com>
	<4E710B62.10703@gmail.com>
	<012257AC-B91F-4E7E-86AC-95E5833F74AA@r-project.org>
	<20081.4680.253129.80251@max.nulle.part>
	<914EDA75-E5B9-4B75-8171-1A3A2B87C9A7@r-project.org>
Message-ID: <20081.60576.249765.23714@max.nulle.part>


On 14 September 2011 at 16:56, Simon Urbanek wrote:
| 
| On Sep 14, 2011, at 4:44 PM, Dirk Eddelbuettel wrote:
| 
| > 
| > On 14 September 2011 at 16:22, Simon Urbanek wrote:
| > | 
| > | On Sep 14, 2011, at 4:15 PM, Brian Oney wrote:
| > | 
| > | > Hi there,
| > | > new idea (at 10 at night). All the emails keep me thinking (btw thanks for all the feedback).
| > | > What does this do on linux?
| > | > 
| > | > getOption("pdfviewer")
| > | > ### I got this idea from: getS3method("print","vignette")
| > | > 
| > | 
| > | It gives you the detected PDF viewer as I was explaining (essentially R_PDFVIEWER). The two detected settings I was referring to are R_PDFVIEWER (for PDF) and R_BROWSER (for URLs) which are the initial settings for the "pdfviewer" and "browser" options.
| > | 
| > | Note that it's what it say it is - R_PDFVIEWER is usually something like acroread or evince so not particularly useful for your purpose ...
| > 
| > R> getOption("pdfviewer")
| > [1] "/usr/bin/xdg-open"
| > R> 
| > 
| > We've had that as xdg-open in Debian / Ubuntu for a while now...
| > 
| 
| Yes, but that's merely a side-effect. For example on Ubuntu (R from sources) I get
| 
| gis:~$ Rscript -e 'cat(getOption("pdfviewer"),"\n")'
| /usr/bin/X11/evince 
| 
| because xdg-open is not installed by default. My point is that the setting is meant for something else, so misappropriating it, although possible, may not be wise. If you really want to go down that alley, you could use some logic like
| 
| if (identical(getOption("pdfviewer"), getOption("browser"))) { # better chance that it's something that can open things universally
| } else { ## well, bad luck ... }
| 
| That will work on Macs and possibly on OSes that have generic open commands ... (but is not guaranteed to ...).

Not a side-effect, but carefully planned by several parties :)

Kurt has this in m4/R.m4 for R's configure:

  AC_DEFUN([R_PROG_BROWSER],
  [if test -z "${R_BROWSER}"; then
    AC_PATH_PROGS(R_BROWSER, [firefox mozilla galeon opera xdg-open kfmclient gnome-moz-remote open])
  fi

and

  AC_DEFUN([R_PROG_PDFVIEWER],
  [AC_PATH_PROGS(R_PDFVIEWER,
                 [${R_PDFVIEWER} acroread acroread4 xdg-open evince xpdf gv gnome-gv ggv okular kpdf open gpdf kghostview])

so xdg-open can be use as R_BROWSER and R_PDFVIEWER. That is a 'Good Thing'
because xdg-open is itself a wrapper which finds the appropriate _installed_
binary via the desktop resources -- shifting the choice from compile-time to
run-time. 

I then ensure via a Build-Depends on the xdg-utils package ensure that
xdg-open is present when R is built (as the Debian / Ubuntu binary). (I also
set 'R_BROWSER=xdg-open' in the call to configure which may be redundant.)

So we could try to generalize this and, if on Linux, look for xdg-open and
call that.

Dirk

-- 
New Rcpp master class for R and C++ integration is scheduled for 
San Francisco (Oct 8), more details / reg.info available at
http://www.revolutionanalytics.com/products/training/public/rcpp-master-class.php


From Mark.Bravington at csiro.au  Fri Sep 16 06:45:18 2011
From: Mark.Bravington at csiro.au (Mark.Bravington at csiro.au)
Date: Fri, 16 Sep 2011 14:45:18 +1000
Subject: [Rd] grep problem in R-devel 2.14 r57004
Message-ID: <3D59DF35E7CF3E42BA70C23BD5CBE6A85F5943005A@exvic-mbx04.nexus.csiro.au>

Problem below with PCRE grep in R-devel; works fine in R-patched. (Unless there's been an absolutely massive change in rules for updated PCRE version 8.13; jeez I hope not)

> grep( '[.][.]', '', perl=TRUE)
Error in grep("[.][.]", "", perl = TRUE) :
  invalid regular expression '[.][.]'
In addition: Warning message:
In grep("[.][.]", "", perl = TRUE) : PCRE pattern compilation error
        'POSIX collating elements are not supported'
        at '[.][.]'

> sessionInfo()
R Under development (unstable) (2011-09-13 r57004)
Platform: i386-pc-mingw32/i386 (32-bit)

locale:
[1] LC_COLLATE=English_Australia.1252  LC_CTYPE=English_Australia.1252
[3] LC_MONETARY=English_Australia.1252 LC_NUMERIC=C
[5] LC_TIME=English_Australia.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

NB I'm sending to R-devel rather than posting a bug report because (i) I have a dim recollection that's what we're supposed to do for bugs in R-devel, and (ii) Bugzilla doesn't include an R-devel version and (iii) couldn't find any guidance on these matters.

Mark

-- 
Mark Bravington
CSIRO Mathematical & Information Sciences
Marine Laboratory
Castray Esplanade
Hobart 7001
TAS

ph (+61) 3 6232 5118
fax (+61) 3 6232 5012
mob (+61) 438 315 623


From maarten.schipper at rivm.nl  Fri Sep 16 09:28:41 2011
From: maarten.schipper at rivm.nl (Maarten Schipper)
Date: Fri, 16 Sep 2011 09:28:41 +0200
Subject: [Rd] package snow/parallel doesnt make any clusters
Message-ID: <OFB1922FC5.788D92C4-ONC125790D.002876CA-C125790D.0029140A@notesmail.rivm.nl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20110916/e2b3291a/attachment.pl>

From simon.urbanek at r-project.org  Fri Sep 16 15:01:20 2011
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Fri, 16 Sep 2011 09:01:20 -0400
Subject: [Rd] grep problem in R-devel 2.14 r57004
In-Reply-To: <3D59DF35E7CF3E42BA70C23BD5CBE6A85F5943005A@exvic-mbx04.nexus.csiro.au>
References: <3D59DF35E7CF3E42BA70C23BD5CBE6A85F5943005A@exvic-mbx04.nexus.csiro.au>
Message-ID: <43C65FC9-F4B0-48B0-91ED-EDAAD0EDA25D@r-project.org>

Mark, quick googling gives the answer - [.] is not what you think it is, you probably meant [\.]. Bracket expressions starting with [. are collating symbols which is unsupported by PCRE (only [:xxx:] is supported, neither [=xxx=] nor [.xxx.] is) but that's probably not what you intended. See POSIX:

9.3.5 RE Bracket Expression
[...]
1. [..] The character sequences "[.", "[=", and "[:" (left-bracket followed by a period, equals-sign, or colon) shall be special inside a bracket expression and are used to delimit collating symbols, equivalence class expressions, and character class expressions.

Cheers,
Simon



On Sep 16, 2011, at 12:45 AM, <Mark.Bravington at csiro.au> <Mark.Bravington at csiro.au> wrote:

> Problem below with PCRE grep in R-devel; works fine in R-patched. (Unless there's been an absolutely massive change in rules for updated PCRE version 8.13; jeez I hope not)
> 
>> grep( '[.][.]', '', perl=TRUE)
> Error in grep("[.][.]", "", perl = TRUE) :
>  invalid regular expression '[.][.]'
> In addition: Warning message:
> In grep("[.][.]", "", perl = TRUE) : PCRE pattern compilation error
>        'POSIX collating elements are not supported'
>        at '[.][.]'
> 
>> sessionInfo()
> R Under development (unstable) (2011-09-13 r57004)
> Platform: i386-pc-mingw32/i386 (32-bit)
> 
> locale:
> [1] LC_COLLATE=English_Australia.1252  LC_CTYPE=English_Australia.1252
> [3] LC_MONETARY=English_Australia.1252 LC_NUMERIC=C
> [5] LC_TIME=English_Australia.1252
> 
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
> 
> NB I'm sending to R-devel rather than posting a bug report because (i) I have a dim recollection that's what we're supposed to do for bugs in R-devel, and (ii) Bugzilla doesn't include an R-devel version and (iii) couldn't find any guidance on these matters.
> 
> Mark
> 
> -- 
> Mark Bravington
> CSIRO Mathematical & Information Sciences
> Marine Laboratory
> Castray Esplanade
> Hobart 7001
> TAS
> 
> ph (+61) 3 6232 5118
> fax (+61) 3 6232 5012
> mob (+61) 438 315 623
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 


From simon.urbanek at r-project.org  Fri Sep 16 15:42:24 2011
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Fri, 16 Sep 2011 09:42:24 -0400
Subject: [Rd] grep problem in R-devel 2.14 r57004
In-Reply-To: <43C65FC9-F4B0-48B0-91ED-EDAAD0EDA25D@r-project.org>
References: <3D59DF35E7CF3E42BA70C23BD5CBE6A85F5943005A@exvic-mbx04.nexus.csiro.au>
	<43C65FC9-F4B0-48B0-91ED-EDAAD0EDA25D@r-project.org>
Message-ID: <5C4B6FD3-B726-456A-97DF-E5797A9AF056@r-project.org>

I forgot to mention the more obvious ;) - yes, it is a known issue in PCRE 8.13 which is hitting more people.
After re-reading the standard I think the problem was that PCRE did not require enclosing [ to treat [. as special.  This has been addressed in the PCRE trunk since and it also has a comment on what happened. I have ported that fix into R-devel. 

Cheers,
Simon


On Sep 16, 2011, at 9:01 AM, Simon Urbanek wrote:

> Mark, quick googling gives the answer - [.] is not what you think it is, you probably meant [\.]. Bracket expressions starting with [. are collating symbols which is unsupported by PCRE (only [:xxx:] is supported, neither [=xxx=] nor [.xxx.] is) but that's probably not what you intended. See POSIX:
> 
> 9.3.5 RE Bracket Expression
> [...]
> 1. [..] The character sequences "[.", "[=", and "[:" (left-bracket followed by a period, equals-sign, or colon) shall be special inside a bracket expression and are used to delimit collating symbols, equivalence class expressions, and character class expressions.
> 
> Cheers,
> Simon
> 
> 
> 
> On Sep 16, 2011, at 12:45 AM, <Mark.Bravington at csiro.au> <Mark.Bravington at csiro.au> wrote:
> 
>> Problem below with PCRE grep in R-devel; works fine in R-patched. (Unless there's been an absolutely massive change in rules for updated PCRE version 8.13; jeez I hope not)
>> 
>>> grep( '[.][.]', '', perl=TRUE)
>> Error in grep("[.][.]", "", perl = TRUE) :
>> invalid regular expression '[.][.]'
>> In addition: Warning message:
>> In grep("[.][.]", "", perl = TRUE) : PCRE pattern compilation error
>>       'POSIX collating elements are not supported'
>>       at '[.][.]'
>> 
>>> sessionInfo()
>> R Under development (unstable) (2011-09-13 r57004)
>> Platform: i386-pc-mingw32/i386 (32-bit)
>> 
>> locale:
>> [1] LC_COLLATE=English_Australia.1252  LC_CTYPE=English_Australia.1252
>> [3] LC_MONETARY=English_Australia.1252 LC_NUMERIC=C
>> [5] LC_TIME=English_Australia.1252
>> 
>> attached base packages:
>> [1] stats     graphics  grDevices utils     datasets  methods   base
>> 
>> NB I'm sending to R-devel rather than posting a bug report because (i) I have a dim recollection that's what we're supposed to do for bugs in R-devel, and (ii) Bugzilla doesn't include an R-devel version and (iii) couldn't find any guidance on these matters.
>> 
>> Mark
>> 
>> -- 
>> Mark Bravington
>> CSIRO Mathematical & Information Sciences
>> Marine Laboratory
>> Castray Esplanade
>> Hobart 7001
>> TAS
>> 
>> ph (+61) 3 6232 5118
>> fax (+61) 3 6232 5012
>> mob (+61) 438 315 623
>> 
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>> 
>> 
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 


From friendly at yorku.ca  Fri Sep 16 16:32:00 2011
From: friendly at yorku.ca (Michael Friendly)
Date: Fri, 16 Sep 2011 10:32:00 -0400
Subject: [Rd] R license for a derived data-only package
Message-ID: <4E735DE0.3030002@yorku.ca>

I'm looking for guidance or advice about the R license to use in 
preparing a package containing the
Baseball Database from http://baseball1.com/statistics/
My main purpose is to make it available to students in a course, and to 
develop it with others
I'd like to put it on R-Forge, and then perhaps make it public on CRAN.

However, the page above bears a very restrictive copyright notice and 
limited license:

This database is copyright 1996-2010 by Sean Lahman. A license is granted
for individual use for research purposes. It may not be re-distributed
without permission. Any commercial use, or other dissemination of the
database in part or in whole is prohibited. Use of this database
constitutes acceptance of these terms.

I've written several times to the author asking permission for my 
intended wider use, but have
received no reply.

What makes this perplexing is that I am apparently free to "distribute" 
this by sending links
in an email or posting them on a web page, so that others actually 
download them for
personal use.  The R package, however would be considered a "derived 
work", I think,
since it contains .RData files I created and .Rd documentation.  Does 
the original
limited license apply to this?

AFAICS, none of the R licenses described at: 
http://www.r-project.org/Licenses/
seem to cover this situation, although they seem to apply to the R 
package, not the
data on which it is based.

The TeX archive CTAN defines a wider range of licenses, including a 
bunch of non-free ones,
http://ctan.mirror.rafal.ca/help/Catalogue/licenses.html

But I don't know if any of these are acceptable in R packages (e.g., 
will pass R CMD check).
I'd rather not have to consult a lawyer, so any guidance is welcome.

-- 
Michael Friendly     Email: friendly AT yorku DOT ca
Professor, Psychology Dept.
York University      Voice: 416 736-5115 x66249 Fax: 416 736-5814
4700 Keele Street    Web:   http://www.datavis.ca
Toronto, ONT  M3J 1P3 CANADA


From simon.urbanek at r-project.org  Fri Sep 16 16:50:17 2011
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Fri, 16 Sep 2011 10:50:17 -0400
Subject: [Rd] R license for a derived data-only package
In-Reply-To: <4E735DE0.3030002@yorku.ca>
References: <4E735DE0.3030002@yorku.ca>
Message-ID: <DDDCC2E5-CA43-42D9-B0EA-87660D91ED24@r-project.org>

On Sep 16, 2011, at 10:32 AM, Michael Friendly wrote:

> I'm looking for guidance or advice about the R license to use in preparing a package containing the
> Baseball Database from http://baseball1.com/statistics/
> My main purpose is to make it available to students in a course, and to develop it with others
> I'd like to put it on R-Forge, and then perhaps make it public on CRAN.
> 
> However, the page above bears a very restrictive copyright notice and limited license:
> 
> This database is copyright 1996-2010 by Sean Lahman. A license is granted
> for individual use for research purposes. It may not be re-distributed
> without permission. Any commercial use, or other dissemination of the
> database in part or in whole is prohibited. Use of this database
> constitutes acceptance of these terms.
> 
> I've written several times to the author asking permission for my intended wider use, but have
> received no reply.
> 
> What makes this perplexing is that I am apparently free to "distribute" this by sending links
> in an email or posting them on a web page, so that others actually download them for
> personal use.  The R package, however would be considered a "derived work", I think,
> since it contains .RData files I created and .Rd documentation.  Does the original
> limited license apply to this?
> 

The way people have dealt with this in the past is to create a package that displays the license and downloads the data. The way I read it (but I am not a lawyer and the wording is very ambiguous) you cannot redistribute it in any form (not even in original form) so the only way to obtain it is to download in from the site. This also implies that the conversion to .RData has to be done at (or after) install time from the download and can't be done at build time.

This does not constitute a legal advice, it is just my personal opinion.

Cheers,
Simon


> AFAICS, none of the R licenses described at: http://www.r-project.org/Licenses/
> seem to cover this situation, although they seem to apply to the R package, not the
> data on which it is based.
> 
> The TeX archive CTAN defines a wider range of licenses, including a bunch of non-free ones,
> http://ctan.mirror.rafal.ca/help/Catalogue/licenses.html
> 
> But I don't know if any of these are acceptable in R packages (e.g., will pass R CMD check).
> I'd rather not have to consult a lawyer, so any guidance is welcome.
> 
> -- 
> Michael Friendly     Email: friendly AT yorku DOT ca
> Professor, Psychology Dept.
> York University      Voice: 416 736-5115 x66249 Fax: 416 736-5814
> 4700 Keele Street    Web:   http://www.datavis.ca
> Toronto, ONT  M3J 1P3 CANADA
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 


From pgilbert at bank-banque-canada.ca  Fri Sep 16 16:55:03 2011
From: pgilbert at bank-banque-canada.ca (Paul Gilbert)
Date: Fri, 16 Sep 2011 14:55:03 +0000
Subject: [Rd] R license for a derived data-only package
In-Reply-To: <4E735DE0.3030002@yorku.ca>
References: <4E735DE0.3030002@yorku.ca>
Message-ID: <6441154A9FF1CD4386AF4ABF141A056D2A74ECBF@WMEXOSCD2-N1.bocad.bank-banque-canada.ca>

Michael

You might look at my TSzip package on CRAN. There are examples in the Guide: http://cran.at.r-project.org/web/packages/TSzip/vignettes/Guide.pdf. The package may not work directly, since it is designed for time series data (the example is daily market data.) But the general idea of just getting the data directly from their web site rather than re-distributing it should work with simple modifications. (If it is time series data you need for your course, there are also examples of other data sets in the guides for TSxls, TSgetSymbol, and TShistQuote.)

HTH,
Paul

> -----Original Message-----
> From: r-devel-bounces at r-project.org [mailto:r-devel-bounces at r-
> project.org] On Behalf Of Michael Friendly
> Sent: September 16, 2011 10:32 AM
> To: r-devel
> Subject: [Rd] R license for a derived data-only package
> 
> I'm looking for guidance or advice about the R license to use in
> preparing a package containing the
> Baseball Database from http://baseball1.com/statistics/
> My main purpose is to make it available to students in a course, and to
> develop it with others
> I'd like to put it on R-Forge, and then perhaps make it public on CRAN.
> 
> However, the page above bears a very restrictive copyright notice and
> limited license:
> 
> This database is copyright 1996-2010 by Sean Lahman. A license is
> granted
> for individual use for research purposes. It may not be re-distributed
> without permission. Any commercial use, or other dissemination of the
> database in part or in whole is prohibited. Use of this database
> constitutes acceptance of these terms.
> 
> I've written several times to the author asking permission for my
> intended wider use, but have
> received no reply.
> 
> What makes this perplexing is that I am apparently free to "distribute"
> this by sending links
> in an email or posting them on a web page, so that others actually
> download them for
> personal use.  The R package, however would be considered a "derived
> work", I think,
> since it contains .RData files I created and .Rd documentation.  Does
> the original
> limited license apply to this?
> 
> AFAICS, none of the R licenses described at:
> http://www.r-project.org/Licenses/
> seem to cover this situation, although they seem to apply to the R
> package, not the
> data on which it is based.
> 
> The TeX archive CTAN defines a wider range of licenses, including a
> bunch of non-free ones,
> http://ctan.mirror.rafal.ca/help/Catalogue/licenses.html
> 
> But I don't know if any of these are acceptable in R packages (e.g.,
> will pass R CMD check).
> I'd rather not have to consult a lawyer, so any guidance is welcome.
> 
> --
> Michael Friendly     Email: friendly AT yorku DOT ca
> Professor, Psychology Dept.
> York University      Voice: 416 736-5115 x66249 Fax: 416 736-5814
> 4700 Keele Street    Web:   http://www.datavis.ca
> Toronto, ONT  M3J 1P3 CANADA
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
====================================================================================

La version fran?aise suit le texte anglais.

------------------------------------------------------------------------------------

This email may contain privileged and/or confidential information, and the Bank of
Canada does not waive any related rights. Any distribution, use, or copying of this
email or the information it contains by other than the intended recipient is
unauthorized. If you received this email in error please delete it immediately from
your system and notify the sender promptly by email that you have done so. 

------------------------------------------------------------------------------------

Le pr?sent courriel peut contenir de l'information privil?gi?e ou confidentielle.
La Banque du Canada ne renonce pas aux droits qui s'y rapportent. Toute diffusion,
utilisation ou copie de ce courriel ou des renseignements qu'il contient par une
personne autre que le ou les destinataires d?sign?s est interdite. Si vous recevez
ce courriel par erreur, veuillez le supprimer imm?diatement et envoyer sans d?lai ?
l'exp?diteur un message ?lectronique pour l'aviser que vous avez ?limin? de votre
ordinateur toute copie du courriel re?u.

From ligges at statistik.tu-dortmund.de  Fri Sep 16 17:40:33 2011
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Fri, 16 Sep 2011 17:40:33 +0200
Subject: [Rd] package snow/parallel doesnt make any clusters
In-Reply-To: <OFB1922FC5.788D92C4-ONC125790D.002876CA-C125790D.0029140A@notesmail.rivm.nl>
References: <OFB1922FC5.788D92C4-ONC125790D.002876CA-C125790D.0029140A@notesmail.rivm.nl>
Message-ID: <4E736DF1.6040605@statistik.tu-dortmund.de>

Have you tried Admin privileges? It may be necessary to have some 
additional permissions (and Admin includes those).

Best,
Uwe Ligges



On 16.09.2011 09:28, Maarten Schipper wrote:
> I am running R.And  I want to make parallel computations.
> When using the snow package under R-2.13.1patched or the parallel package
> under R 2.14.0dev, R isn't able to create a cluster. When typing:
>
> cl<- makeCluster(4)
>
> R doesn't respond. It doesn't crash either.
>
> specs:
>
> OS: 32 bit, Windows XP Prof, SP3.
> Processor: Intel Core i3 cpu, quad core.
>
>
> My colleague works on exactly the same system and operating system, and he
> hasn't encountered any problems. What can be the problem?
>
> Best regards,
> Maarten Schipper
>
> Maarten Schipper, PhD
> Senior Consultant Biostatistics
> Expertise Centre for Methodology and Information Services - EMI
> National Institute for Public Health and the Environment - RIVM
> P.O. Box 1, 3720 BA Bilthoven, The Netherlands
> t: +31 30 2743504 | f: +31 30 2744456 | e: maarten.schipper at rivm.nl
>
>
>
> Proclaimer RIVM
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From patrick.mccormick at alum.mit.edu  Fri Sep 16 21:15:43 2011
From: patrick.mccormick at alum.mit.edu (Patrick McCormick)
Date: Fri, 16 Sep 2011 15:15:43 -0400
Subject: [Rd] patch] writeForeignSAS writes invalid SASdata for logical
	columns
Message-ID: <CAEut_u5JLK-r8n0J5vfgW3g0H++jQODm1bpkkEWJnhSZvwKuAQ@mail.gmail.com>

Hi,

I have been trying to encourage R use among my colleagues who use SAS,
and part of that is demonstrating that R can perform a high fidelity
export to SAS with the foreign package. ?Recently one of my exports
caused a SAS error, and I found that logical vectors within a
dataframe are not exported properly. ?While write.foreign doesn't
claim to handle this datatype, I think it is pretty essential (and
easy) to export.

I searched and have not found this issue reported before.

Example:
df = data.frame(id = c(1,2,3), boolean = c(TRUE,FALSE,TRUE))
library(foreign)
write.foreign(df, "test.sasdata", "test.sas",
? ?"SAS", dataname="WORK.TEST", validvarname="V7")

Contents of test.sasdata:
1,TRUE
2,FALSE
3,TRUE

SAS output:
NOTE: Invalid data for boolean in line 1 3-6
RULE: ----+----1--...
1 ? ? 1,TRUE 6
id=1 boolean=. _ERROR_=1 _N_=1
... (errors for remaining rows)

Attached is a patch to foreign which I believe will address the issue
by converting logical vectors into integers (0,1). ?I have not tested
it very much.

Thanks,
Patrick McCormick

From patrick.mccormick at alum.mit.edu  Sun Sep 18 01:50:54 2011
From: patrick.mccormick at alum.mit.edu (Patrick McCormick)
Date: Sat, 17 Sep 2011 19:50:54 -0400
Subject: [Rd] [patch] writeForeignSAS writes invalid SASdata for logical
	columns
Message-ID: <CAEut_u7aWz=QA-UbOshL1wZt5kL8D2WCe6i7zUfrTgpY2-M06A@mail.gmail.com>

Hi,

The patch attachment did not make it in my previous mail.  I have
pasted it below.

Thanks,
Patrick McCormick

diff -U3 -r foreign_0.8-45/R/writeForeignSAS.R foreign/R/writeForeignSAS.R
--- foreign_0.8-45/R/writeForeignSAS.R	2010-12-17 07:17:32.000000000 -0500
+++ foreign/R/writeForeignSAS.R	2011-09-16 14:57:46.518814100 -0400
@@ -50,6 +50,7 @@
     ## FIXME: re-write this to hold a connection open
     factors <- sapply(df, is.factor)
     strings <- sapply(df, is.character)
+    logicals <- sapply(df, is.logical)
     dates <- sapply(df, FUN = function(x) inherits(x, "Date") ||
inherits(x, "dates") || inherits(x, "date"))
     xdates <- sapply(df, FUN = function(x)  inherits(x, "dates") ||
inherits(x, "date"))
     datetimes <- sapply(df, FUN = function(x) inherits(x, "POSIXt"))
@@ -63,6 +64,8 @@
     dfn <- df
     if (any(factors))
         dfn[factors] <- lapply(dfn[factors], as.numeric)
+    if (any(logicals))
+        dfn[logicals] <- lapply(dfn[logicals], as.numeric)
     if (any(datetimes))
         dfn[datetimes] <- lapply(dfn[datetimes],
                                  function(x) format(x, "%d%b%Y %H:%M:%S"))


From edzer.pebesma at uni-muenster.de  Sun Sep 18 12:33:09 2011
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Sun, 18 Sep 2011 12:33:09 +0200
Subject: [Rd] S4 method dispatch
In-Reply-To: <4E7115F6.20209@uni-muenster.de>
References: <4E7115F6.20209@uni-muenster.de>
Message-ID: <4E75C8E5.4000607@uni-muenster.de>

As a follow-up, I managed to isolate the problem I sent earlier this
week, and reduced it to a small case (I'm using R 2.13.1,
i486-pc-linux-gnu (32-bit)).

The following script does what I expect:


setClass("A", representation(x = "numeric"))
setClass("AB", representation("A"))

setGeneric("doNothing<-", function(obj, value)
  standardGeneric("doNothing<-"))

setReplaceMethod("doNothing", c("A", "character"),
  function(obj, value) obj)

x = new("AB", x = 10)
doNothing(x) = "irrelevant"
class(x)

setAs("AB", "A", function(from) new("A", x = from at x))
x = new("AB", x = 10)
doNothing(x) = "irrelevant"
class(x)


and results in class(x) being "AB".
However, the following, very similar script:


setClass("A", representation(x = "numeric"))
setClass("AB", representation("A"))

setGeneric("doNothing<-", function(obj, value)
  standardGeneric("doNothing<-"))

setReplaceMethod("doNothing", c("A", "character"),
  function(obj, value) obj)

setAs("AB", "A", function(from) new("A", x = from at x))

x = new("AB", x = 10)
doNothing(x) = "irrelevant"
class(x)


returns "A" as the class of x. Why is this the case? Is this behaviour
intentional?

Best regards,


On 09/14/2011 11:00 PM, Edzer Pebesma wrote:
> List,
> 
> In order to get rid of some old, unreadable S3 code in package sp, I'm
> trying to rewrite things using S4 methods. Somewhere I fail, and I
> cannot sort out why. In order to isolate the problem, I created two
> functions, doNothing<- and dosth, and both should do nothing. The issue
> is that in most cases they do nothing, but in some cases dosth(obj)
> changes the class of obj and breaks with the error. I couldn't find a
> pattern when this happens, but have a few cases where it consistently
> breaks. Here's the code snippet:
> 
> setGeneric("doNothing<-", function(object, value)
>     standardGeneric("doNothing<-"))
> 
> setReplaceMethod("doNothing",
>     signature(object = "Spatial", value = "ANY"),
>     function(object, value) object)
> 
> dosth = function(obj) {
>     cl1 = class(obj)
>     doNothing(obj) = TRUE
>     cl2 = class(obj)
>     if (!identical(cl1, cl2)) {
>         print(paste(cl1, cl2))
>         stopifnot(identical(cl1, cl2))
>     }
>     obj
> }
> 
> When things go wrong, dosth and doNothing are called with a subclass of
> Spatial, e.g. an object of class SpatialGrid, but when this gets in
> doNothing, the object is suddenly of class Spatial, and is then returned
> as an object of class Spatial, which should never happen.
> 
> For instance, I have a case where consistently
> 
> setMethod("fullgrid", c("Spatial"),
>     function(obj) { is(obj, "SpatialGrid") })
>> class(g)
> [1] "SpatialGrid"
> attr(,"package")
> [1] "sp"
>> fullgrid(g)
> [1] FALSE
> 
> is obviously false, but in other cases it works fine.
> 
> When I change the signature of doNothing to signature(object = "ANY",
> value = "ANY"), the problem disappears.
> 
> I tried to make a self-contained example that reproduced the issue, but
> could only get something that worked as expected.
> 
> I would appreciate any help or suggestions.

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From jmc at r-project.org  Sun Sep 18 23:04:41 2011
From: jmc at r-project.org (John Chambers)
Date: Sun, 18 Sep 2011 14:04:41 -0700
Subject: [Rd] S4 method dispatch
In-Reply-To: <4E75C8E5.4000607@uni-muenster.de>
References: <4E7115F6.20209@uni-muenster.de> <4E75C8E5.4000607@uni-muenster.de>
Message-ID: <4E765CE9.8080505@r-project.org>

The distinction here is "simple inheritance"  ("Software for Data 
Analysis", p. 346).  Your first example is simple inheritance (would be 
clearer if you used the contains= argument).  In the second version you 
supply an explicit coerce method, so method dispatch can no longer just 
pass in the object from the subclass, but has to call the coerce method 
explicitly.  Details in the reference.

If you need to have an explicit coerce method, it's possible to emulate 
simple inheritance, but the programming may be more subtle than you want 
to take on.  When your method is called, it actually gets also an 
argument strict= which will be FALSE for method dispatch. You need to 
take account of the strict= argument in writing your method.  See ?setAs 
for a few more details.  Someone on the list may have an example.

John

On 9/18/11 3:33 AM, Edzer Pebesma wrote:
> As a follow-up, I managed to isolate the problem I sent earlier this
> week, and reduced it to a small case (I'm using R 2.13.1,
> i486-pc-linux-gnu (32-bit)).
>
> The following script does what I expect:
>
>
> setClass("A", representation(x = "numeric"))
> setClass("AB", representation("A"))
>
> setGeneric("doNothing<-", function(obj, value)
>    standardGeneric("doNothing<-"))
>
> setReplaceMethod("doNothing", c("A", "character"),
>    function(obj, value) obj)
>
> x = new("AB", x = 10)
> doNothing(x) = "irrelevant"
> class(x)
>
> setAs("AB", "A", function(from) new("A", x = from at x))
> x = new("AB", x = 10)
> doNothing(x) = "irrelevant"
> class(x)
>
>
> and results in class(x) being "AB".
> However, the following, very similar script:
>
>
> setClass("A", representation(x = "numeric"))
> setClass("AB", representation("A"))
>
> setGeneric("doNothing<-", function(obj, value)
>    standardGeneric("doNothing<-"))
>
> setReplaceMethod("doNothing", c("A", "character"),
>    function(obj, value) obj)
>
> setAs("AB", "A", function(from) new("A", x = from at x))
>
> x = new("AB", x = 10)
> doNothing(x) = "irrelevant"
> class(x)
>
>
> returns "A" as the class of x. Why is this the case? Is this behaviour
> intentional?
>
> Best regards,
>
>
> On 09/14/2011 11:00 PM, Edzer Pebesma wrote:
>> List,
>>
>> In order to get rid of some old, unreadable S3 code in package sp, I'm
>> trying to rewrite things using S4 methods. Somewhere I fail, and I
>> cannot sort out why. In order to isolate the problem, I created two
>> functions, doNothing<- and dosth, and both should do nothing. The issue
>> is that in most cases they do nothing, but in some cases dosth(obj)
>> changes the class of obj and breaks with the error. I couldn't find a
>> pattern when this happens, but have a few cases where it consistently
>> breaks. Here's the code snippet:
>>
>> setGeneric("doNothing<-", function(object, value)
>>      standardGeneric("doNothing<-"))
>>
>> setReplaceMethod("doNothing",
>>      signature(object = "Spatial", value = "ANY"),
>>      function(object, value) object)
>>
>> dosth = function(obj) {
>>      cl1 = class(obj)
>>      doNothing(obj) = TRUE
>>      cl2 = class(obj)
>>      if (!identical(cl1, cl2)) {
>>          print(paste(cl1, cl2))
>>          stopifnot(identical(cl1, cl2))
>>      }
>>      obj
>> }
>>
>> When things go wrong, dosth and doNothing are called with a subclass of
>> Spatial, e.g. an object of class SpatialGrid, but when this gets in
>> doNothing, the object is suddenly of class Spatial, and is then returned
>> as an object of class Spatial, which should never happen.
>>
>> For instance, I have a case where consistently
>>
>> setMethod("fullgrid", c("Spatial"),
>>      function(obj) { is(obj, "SpatialGrid") })
>>> class(g)
>> [1] "SpatialGrid"
>> attr(,"package")
>> [1] "sp"
>>> fullgrid(g)
>> [1] FALSE
>>
>> is obviously false, but in other cases it works fine.
>>
>> When I change the signature of doNothing to signature(object = "ANY",
>> value = "ANY"), the problem disappears.
>>
>> I tried to make a self-contained example that reproduced the issue, but
>> could only get something that worked as expected.
>>
>> I would appreciate any help or suggestions.
>


From hb at biostat.ucsf.edu  Mon Sep 19 07:32:15 2011
From: hb at biostat.ucsf.edu (Henrik Bengtsson)
Date: Sun, 18 Sep 2011 22:32:15 -0700
Subject: [Rd] file.info(path) "inconsistent" with file.exists(path) when
	path == "C:/"
Message-ID: <CAFDcVCQu+8MYhfCsc2wCsNq_k8iuqhENFOLwKF05LGE_UpXchA@mail.gmail.com>

Hi,

on Windows 7 (tested on NTFS file system) and R-devel:

1. file.info("C:/") gives NAs whilst file.exists("C:/") gives TRUE.
Instead you have to do file.info("C:/.").
2. Any number of dots will do, e.g.
identical(file.info("C:/........."), file.info("C:/.")) == TRUE

DETAILS:

# C:/ => DISCREPANCY file.exists() and file.info()
> file.exists("C:/")
[1] TRUE
> file.info("C:/")
    size isdir mode mtime ctime atime  exe
C:/   NA    NA <NA>  <NA>  <NA>  <NA> <NA>
> x <- list.files("C:/")
> str(x)
 chr [1:62] "$Recycle.Bin" "Boot" "bootmgr" "BOOTSECT.BAK" ...
> x <- shell('dir "C:/"', intern=TRUE)
> str(x)
 chr [1:57] " Volume in drive C is Windows7_OS" ...


# C:/.  => OK
> file.exists("C:/.")
[1] TRUE
> file.info("C:/.")
     size isdir mode      mtime      ctime      atime exe
C:/.    0  TRUE  777 1980-01-01 1980-01-01 1980-01-01  no
> x <- list.files("C:/.")
> str(x)
 chr [1:62] "$Recycle.Bin" "Boot" "bootmgr" "BOOTSECT.BAK" ...
> x <- shell('dir "C:/."', intern=TRUE)
> str(x)
 chr [1:57] " Volume in drive C is Windows7_OS" ...


# C:/..  => OK
> file.exists("C:/..")
[1] TRUE
> file.info("C:/..")
      size isdir mode      mtime      ctime      atime exe
C:/..    0  TRUE  777 1980-01-01 1980-01-01 1980-01-01  no
> x <- list.files("C:/..")
> str(x)
 chr [1:62] "$Recycle.Bin" "Boot" "bootmgr" "BOOTSECT.BAK" ...
> x <- shell('dir "C:/.."', intern=TRUE)
> str(x)
 chr [1:57] " Volume in drive C is Windows7_OS" ...


# C:/...  => SURPRISE IN R
> file.exists("C:/...")
[1] TRUE
> file.info("C:/...")
       size isdir mode      mtime      ctime      atime exe
C:/...    0  TRUE  777 1980-01-01 1980-01-01 1980-01-01  no
> x <- list.files("C:/...")
> str(x)
 chr [1:62] "$Recycle.Bin" "Boot" "bootmgr" "BOOTSECT.BAK" ...
> x <- shell('dir "C:/..."', intern=TRUE)
File Not Found
Warning message:
running command 'C:\Windows\system32\cmd.exe /c dir "C:/..."' had status 1


> sessionInfo()
R Under development (unstable) (2011-09-13 r57004)
Platform: x86_64-pc-mingw32/x64 (64-bit)

locale:
[1] LC_COLLATE=English_United States.1252
[2] LC_CTYPE=English_United States.1252
[3] LC_MONETARY=English_United States.1252
[4] LC_NUMERIC=C
[5] LC_TIME=English_United States.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base


/Henrik


From ripley at stats.ox.ac.uk  Mon Sep 19 10:14:06 2011
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 19 Sep 2011 09:14:06 +0100 (BST)
Subject: [Rd] Revision of shell.exec?
In-Reply-To: <74357D3F-67CC-4D09-BBE9-C3988293317F@r-project.org>
References: <4E708194.8060406@gmail.com>
	<4E709447.10305@statistik.tu-dortmund.de>
	<CALh21i+JyvKJf=UGi2ENTXtB5rbbG-DZuwCYtGb97afG7Nguxg@mail.gmail.com>
	<4E70C350.6020506@gmail.com>
	<74357D3F-67CC-4D09-BBE9-C3988293317F@r-project.org>
Message-ID: <alpine.LFD.2.02.1109190911570.23088@gannet.stats.ox.ac.uk>

On Wed, 14 Sep 2011, Simon Urbanek wrote:

>
> On Sep 14, 2011, at 11:08 AM, Brian Oney wrote:
>
>> Hi Steve,
>>
>> a quick look at "browseURL" will tell you that indeed "system" or "shell.exec" (on a windows platform) is used to open up a URL.
>> The "open " part of the proposed function was written to work on a Mac. Because Mac is a unix platform, I assumed that the function "open" would be omnipresent on unix platforms, my mistake.
>
> Well, the problem is that "open" is unfortunately mapped to openvt on Linux systems which is a quite obscure anachronism. But since Linux is Linux there is no standard way to open a file, so it doesn't really matter ;) -- xdg-utils come closest to what one may call standard but on many systems they are not installed by default (in fact on none of the Linux machines I have around). For URLs R does the hard work to try to figure out what to do with them (it also does the same for PDFs), but you may end up opening things in a browser although that's not what you had in mind.
>
>
>> Well I guess, we know how to make to work on a mac.
>>
>
> Yes, "open" works very well on Macs and is extremely useful (I use 
> it all the time - among other things you can use it with directories 
> to browse them...) - it is still beyond me why other unices don't 
> bother ...

They do: as 'open' is already taken, they use xdg-open.

I am not at all convinced base R needs any such addition: we manage to 
open anything R itself needs with the existing code.

>
> Cheers,
> Simon
>
>
>
>> I will make the transition to Linux and get back to this in a while, ok?
>>
>> Cheers,
>> Brian
>>
>>
>> On 9/14/2011 2:50 PM, Stephen Weston wrote:
>>> 2011/9/14 Uwe Ligges<ligges at statistik.tu-dortmund.de>:
>>>>
>>>> On 14.09.2011 12:27, Brian Oney wrote:
>>>>> Hi List,
>>>>> I hope this is correct list to propose function extensions, sorry if not.
>>>>> I am preparing for a (hopefully painless) migration to linux. As far as
>>>>> I am aware of, the function "shell.exec" only comes with the windows
>>>>> version. I think this is a handy little function and would like to see
>>>>> my scripts work when I migrate.
>>>>>
>>>>> May I propose something (like the following)?
>>>>>
>>>>> open.file<- function(file) {
>>>>> if(.Platform$OS.type=="windows") {shell.exec(file)} else
>>>>> {system(paste("open ",file))}
>>>>> }
>>>>>
>>>>> Or just a small addition to the shell.exec function and no new named
>>>>> function.
>>>>> Hope the idea isn't received as "too stupid".
>>>> What is "open" supposed to do on a non-Windows machine? I do not have it on
>>>> the only Linux installation I looked at now, hence we obviously cannot
>>>> assume it exists on an arbitrary installation.
>>> I think the nearest equivalent for those running Gnome or KDE may be
>>> "xdg-open".  So there would probably need to be a new option for specifying
>>> the appropriate command.
>>>
>>> Personally, I am more inclined to use "system" for executing commands,
>>> and "browseURL" for opening documents.  "browseURL" even uses
>>> "xdg-open" in my R installation on my Linux machine.
>>>
>>> - Steve
>>>
>>>
>>>> Best,
>>>> Uwe Ligges
>>>>
>>>>
>>>>> Cheers,
>>>>> Brian
>>>>>
>>>>> ______________________________________________
>>>>> R-devel at r-project.org mailing list
>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From proebuck at mdanderson.org  Mon Sep 19 19:30:57 2011
From: proebuck at mdanderson.org (Roebuck,Paul L)
Date: Mon, 19 Sep 2011 12:30:57 -0500
Subject: [Rd] FW: [Q] Package NS Hook Lint NOTE (unanswered)
In-Reply-To: <CA965453.2098B%proebuck@mdanderson.org>
Message-ID: <CA9CE681.20D91%proebuck@mdanderson.org>

Still have a question about the following NOTEs appearing on CRAN checks:

> .onLoad calls:
> require(methods)
> 
> Package startup functions should not change the search path.
> See section ?Good practice? in ?.onAttach.


For years, I have had the following in my S4-requiring packages.

##---------------------------------------------------------------------
.onLoad <- function(libname, pkgname) {
    ## In case namespace is loaded (via import) by package that
    ## doesn't depend on S4 methods and used in a session with
    ## non-default set of packages
    require(methods)
}

It was all based on an explanation Prof. Ripley gave to someone
about some package loading corner case (reference lost to history
though circa R-2.7 or before). Is it no longer an issue?

The 'methods' package is (in all cases) already listed in each package's
DESCRIPTION Depends entry. Under normal circumstances, is the require()
method in the .onLoad() actually altering the search path (since the
'methods' package was already a dependency)?


From MEC at stowers.org  Tue Sep 20 00:35:15 2011
From: MEC at stowers.org (Cook, Malcolm)
Date: Mon, 19 Sep 2011 17:35:15 -0500
Subject: [Rd] using R as SHELL in gnu make
Message-ID: <2C40E43D1F7A56408C4463FD245DDDF9856C3218@EXCHMB-02.stowers-institute.org>

I am intrigued by the possibility of using R as the SHELL in a (Gnu) makefile (instead of /bin/sh).  (c.f. http://www.gnu.org/software/make/manual/make.html#Choosing-the-Shell)

Well, rather, I would like the makefile's SHELL to be a command which communicated with an R process.

The makefile targets/prerequistes would, as always, be OS files, which would be written/read using standard R file IO.

The makefile's "recipe"s would be written in R (instead of the usual shell).

The R process would be able to be initiated by `load`ing one or more R datasets, libraries or entire images.

The R process would be able to accumulate state as the makefile progressed.  The recipe's would be able to refer to that state, allowing conditional execution.

The R process would optionally be saved as an image of on job termination/completion.

The R process might be managed using the RServe package, and would need to be initiated once only, when the makefile was first invoked.

I would appreciate learning if anyone had any success, informative failures, or other lore that may help in (or dissuade me from) embarking on attempt this.

Thanks,

Malcolm Cook
Stowers Institute for Medical Research


From sdmorris at u.washington.edu  Mon Sep 19 22:48:13 2011
From: sdmorris at u.washington.edu (Stephanie M. Gogarten)
Date: Mon, 19 Sep 2011 13:48:13 -0700
Subject: [Rd] "could not find function" after import
Message-ID: <4E77AA8D.2040409@u.washington.edu>

I am trying to build a package (GWASTools, submitted to Bioconductor) 
that uses the "sandwich" package.  I have references to "sandwich" in 
DESCRIPTION:
Imports: methods, DBI, RSQLite, sandwich, survival, DNAcopy

and NAMESPACE:
import(sandwich)

In the code itself is a call to vcovHC:
Vhat <- vcovHC(mod, type="HC0")

I have sandwich version 2.2-7 installed.

When I run R CMD check on my package, I get the following error during 
checking of examples:
* using R Under development (unstable) (2011-08-29 r56828)
* using platform: x86_64-apple-darwin9.8.0 (64-bit)
...
* checking examples ... ERROR
...
Error in estfun.glm(x) : could not find function "is.zoo"
Calls: assocTestRegression ... meatHC -> rowMeans -> is.data.frame -> 
estfun -> estfun.glm

I import sandwich, sandwich depends on zoo, but a function in zoo cannot 
be found during execution.

I tried to get around this by explicitly including a "require" statement 
in assocTestRegression:
require(sandwich)

The example now runs, but I have a warning in R CMD check:
* checking for unstated dependencies in R code ... WARNING
?library? or ?require? call not declared from: ?sandwich?

I am not sure why this is a problem, as there is a "require" statement 
(for a different package) in another function which does not cause any 
warnings.

Can anyone advise on how to get my package to successfully pass R CMD check?

thanks,
Stephanie Gogarten
Research Scientist, Biostatistics
University of Washington


From murdoch.duncan at gmail.com  Tue Sep 20 02:09:39 2011
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Mon, 19 Sep 2011 20:09:39 -0400
Subject: [Rd] "could not find function" after import
In-Reply-To: <4E77AA8D.2040409@u.washington.edu>
References: <4E77AA8D.2040409@u.washington.edu>
Message-ID: <4E77D9C3.1070307@gmail.com>

On 11-09-19 4:48 PM, Stephanie M. Gogarten wrote:
> I am trying to build a package (GWASTools, submitted to Bioconductor)
> that uses the "sandwich" package.  I have references to "sandwich" in
> DESCRIPTION:
> Imports: methods, DBI, RSQLite, sandwich, survival, DNAcopy
>
> and NAMESPACE:
> import(sandwich)
>
> In the code itself is a call to vcovHC:
> Vhat<- vcovHC(mod, type="HC0")
>
> I have sandwich version 2.2-7 installed.
>
> When I run R CMD check on my package, I get the following error during
> checking of examples:
> * using R Under development (unstable) (2011-08-29 r56828)
> * using platform: x86_64-apple-darwin9.8.0 (64-bit)
> ...
> * checking examples ... ERROR
> ...
> Error in estfun.glm(x) : could not find function "is.zoo"
> Calls: assocTestRegression ... meatHC ->  rowMeans ->  is.data.frame ->
> estfun ->  estfun.glm
>
> I import sandwich, sandwich depends on zoo, but a function in zoo cannot
> be found during execution.
>
> I tried to get around this by explicitly including a "require" statement
> in assocTestRegression:
> require(sandwich)
>
> The example now runs, but I have a warning in R CMD check:
> * checking for unstated dependencies in R code ... WARNING
> ?library? or ?require? call not declared from: ?sandwich?
>
> I am not sure why this is a problem, as there is a "require" statement
> (for a different package) in another function which does not cause any
> warnings.
>
> Can anyone advise on how to get my package to successfully pass R CMD check?
>

If you said that your package Depends on sandwich, you'd probably pass 
checks, but this is arguably a bug in the sandwich package.

The problem is that since you only import sandwich, it never gets 
attached.  So it never attaches its dependency zoo.   It should import 
zoo (or import the functions in zoo that it uses) to work properly the 
way you are calling it.

You can see the same error as follows:

1.  Install sandwich, but don't attach it or zoo.

2.  Run

example(glm)

to create the "glm" object glm.D93.

Try to call

sandwich::estfun(glm.D93)

You'll get the same error as before because is.zoo() will not be loaded.

It's also arguably a design flaw in R.  For testing sandwich, zoo would 
generally end up being attached, because the testing of sandwich would 
attach it.  However, examples like the one above are never tested.

Duncan Murdoch


From pgilbert at bank-banque-canada.ca  Tue Sep 20 15:31:57 2011
From: pgilbert at bank-banque-canada.ca (Paul Gilbert)
Date: Tue, 20 Sep 2011 13:31:57 +0000
Subject: [Rd] using R as SHELL in gnu make
In-Reply-To: <2C40E43D1F7A56408C4463FD245DDDF9856C3218@EXCHMB-02.stowers-institute.org>
References: <2C40E43D1F7A56408C4463FD245DDDF9856C3218@EXCHMB-02.stowers-institute.org>
Message-ID: <6441154A9FF1CD4386AF4ABF141A056D2A7502B2@WMEXOSCD2-N1.bocad.bank-banque-canada.ca>

Other than the RServe part, I do this all the time. It works well. Perhaps we can put together some notes off-line and then bring it back to the list.

Paul

> -----Original Message-----
> From: r-devel-bounces at r-project.org [mailto:r-devel-bounces at r-
> project.org] On Behalf Of Cook, Malcolm
> Sent: September 19, 2011 6:35 PM
> To: 'help-make at gnu.org'; 'r-devel at r-project.org'
> Subject: [Rd] using R as SHELL in gnu make
> 
> I am intrigued by the possibility of using R as the SHELL in a (Gnu)
> makefile (instead of /bin/sh).  (c.f.
> http://www.gnu.org/software/make/manual/make.html#Choosing-the-Shell)
> 
> Well, rather, I would like the makefile's SHELL to be a command which
> communicated with an R process.
> 
> The makefile targets/prerequistes would, as always, be OS files, which
> would be written/read using standard R file IO.
> 
> The makefile's "recipe"s would be written in R (instead of the usual
> shell).
> 
> The R process would be able to be initiated by `load`ing one or more R
> datasets, libraries or entire images.
> 
> The R process would be able to accumulate state as the makefile
> progressed.  The recipe's would be able to refer to that state,
> allowing conditional execution.
> 
> The R process would optionally be saved as an image of on job
> termination/completion.
> 
> The R process might be managed using the RServe package, and would need
> to be initiated once only, when the makefile was first invoked.
> 
> I would appreciate learning if anyone had any success, informative
> failures, or other lore that may help in (or dissuade me from)
> embarking on attempt this.
> 
> Thanks,
> 
> Malcolm Cook
> Stowers Institute for Medical Research
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
====================================================================================

La version fran?aise suit le texte anglais.

------------------------------------------------------------------------------------

This email may contain privileged and/or confidential information, and the Bank of
Canada does not waive any related rights. Any distribution, use, or copying of this
email or the information it contains by other than the intended recipient is
unauthorized. If you received this email in error please delete it immediately from
your system and notify the sender promptly by email that you have done so. 

------------------------------------------------------------------------------------

Le pr?sent courriel peut contenir de l'information privil?gi?e ou confidentielle.
La Banque du Canada ne renonce pas aux droits qui s'y rapportent. Toute diffusion,
utilisation ou copie de ce courriel ou des renseignements qu'il contient par une
personne autre que le ou les destinataires d?sign?s est interdite. Si vous recevez
ce courriel par erreur, veuillez le supprimer imm?diatement et envoyer sans d?lai ?
l'exp?diteur un message ?lectronique pour l'aviser que vous avez ?limin? de votre
ordinateur toute copie du courriel re?u.

From xpxixpy at gmail.com  Tue Sep 20 16:28:48 2011
From: xpxixpy at gmail.com (Ken Kelley)
Date: Tue, 20 Sep 2011 10:28:48 -0400
Subject: [Rd] The boot Package with bca Intervals and Inf and NaN Values in
 an Automated Function [mediation()]
Message-ID: <CAJ6vjxDx5vrZ7kvg1V8axXPM2wM2ghYtX2ZzyCmj8qxkT8sTmw@mail.gmail.com>

Hi everyone,

I use the boot package within the MBESS package to automate much of
the hard part for folks interested in performing a (simple) mediation
model. The function mediation() works well, except for a (probably)
unrealistic artificial data set.

When I apply the bootstrap I sometimes get:
Error in t.star[r, ] <- res[[r]]
which is (I think) due to Inf and -Inf and NaN values produced for
some of the estimates in the bootstrap resamples. Here are my warnings
> warnings()
Warning messages:
1: In sqrt((1 - R2.Y_XM) * ((N - 1) * Cov.Matrix[3, 3]/(N -  ... : NaNs produced
2: In max(abs(b.contained)) : no non-missing arguments to max; returning -Inf
3: In max(abs(From.b)) : no non-missing arguments to max; returning -Inf
4: In max(abs(From.a)) : no non-missing arguments to max; returning -Inf
5: In sqrt((1 - R2.Y_XM) * ((N - 1) * Cov.Matrix[3, 3]/(N -  ... : NaNs produced
6: In max(abs(b.contained)) : no non-missing arguments to max; returning -Inf
7: In max(abs(From.b)) : no non-missing arguments to max; returning -Inf
8: In max(abs(From.a)) : no non-missing arguments to max; returning -Inf
9: In max(abs(b.contained)) : no non-missing arguments to max; returning -Inf
10: In max(abs(From.b)) : no non-missing arguments to max; returning -Inf
11: In max(abs(From.a)) : no non-missing arguments to max; returning -Inf

and here is what boot.out looks like:
Bootstrap Statistics :
     original     bias     std. error
t1*         0 0.01784141  0.030664717
t2*         0 0.00522446  0.009407206
t3*         0 0.01530606  0.026118581
t4*         0 0.10293090  0.132874564
t5*         0        Inf          NaN
t6*         0        Inf          NaN
t7*         0 0.06200062  0.069837762
t8*       NaN        NaN  0.165104486
t9*         0 0.01550669  0.026480612
t10*        0 0.01653285  0.029406830
t11*      Inf       -Inf 10.806967364
t12*        0 0.05329459  0.074168364
t13*        0 0.06153211  0.081591660
t14*        0 0.10558389  0.136462038

The original estimates of 0, NaN or Inf are correct for this
particular set of data (which is artificial for testing purposes).

I'm wondering if there is an easy workaround (e.g., to tell boot to
ignore NaN, etc.). Alternatively, I could make modifications to the
mediation() function in the MBESS package. The idea of the function is
to automate much of the hard part for folks interested in a simple
mediation model (i.e., so that non R users can easily use the
function). However, I'm not sure exactly what I should have
mediation() do so that an extreme data set does not produce the
problem when coupled with boot.  I thought about removing the rows
from boot.out$t with NaN and then changing boot.out$R to reflect the
reduced number of rows, but I wasn't sure that was such a good idea.
The NaNs, by the way, come from dividing 0 by 0.

I didn't provide example code because the mediation() function I'm
using is not the released version. However, I can send the updated
mediation() function to whomever if interested (email me off list for
the updated function).

Any thoughts on this would be most welcomed!

Thanks,
Ken


From alireza.s.mahani at gmail.com  Tue Sep 20 19:26:35 2011
From: alireza.s.mahani at gmail.com (Alireza Mahani)
Date: Tue, 20 Sep 2011 10:26:35 -0700 (PDT)
Subject: [Rd] Is it possible to pass a function argument from R to compiled
 code in C?
Message-ID: <1316539595929-3827563.post@n4.nabble.com>

I have a function in R that takes another function as argument:

f <- function(g, ...) { #g is expected to be a function
}

I want to see if there is a way to implement "f" in C and calling it from R
using ".C" interface. I know that I can use function pointers for my C
implementation, but I imagine it's going to be nearly impossible to pass a
function from R to C. Are there any exact or approximate solutions
available?

Thank you,
Alireza Mahani


--
View this message in context: http://r.789695.n4.nabble.com/Is-it-possible-to-pass-a-function-argument-from-R-to-compiled-code-in-C-tp3827563p3827563.html
Sent from the R devel mailing list archive at Nabble.com.


From ligges at statistik.tu-dortmund.de  Tue Sep 20 19:40:24 2011
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Tue, 20 Sep 2011 19:40:24 +0200
Subject: [Rd] Is it possible to pass a function argument from R to
 compiled code in C?
In-Reply-To: <1316539595929-3827563.post@n4.nabble.com>
References: <1316539595929-3827563.post@n4.nabble.com>
Message-ID: <4E78D008.4060800@statistik.tu-dortmund.de>

You can evaluate R functions from C, see Writing R Extension.

Uwe Ligges


On 20.09.2011 19:26, Alireza Mahani wrote:
> I have a function in R that takes another function as argument:
>
> f<- function(g, ...) { #g is expected to be a function
> }
>
> I want to see if there is a way to implement "f" in C and calling it from R
> using ".C" interface. I know that I can use function pointers for my C
> implementation, but I imagine it's going to be nearly impossible to pass a
> function from R to C. Are there any exact or approximate solutions
> available?
>
> Thank you,
> Alireza Mahani
>
>
> --
> View this message in context: http://r.789695.n4.nabble.com/Is-it-possible-to-pass-a-function-argument-from-R-to-compiled-code-in-C-tp3827563p3827563.html
> Sent from the R devel mailing list archive at Nabble.com.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From gmbecker at ucdavis.edu  Tue Sep 20 19:45:45 2011
From: gmbecker at ucdavis.edu (Gabriel Becker)
Date: Tue, 20 Sep 2011 10:45:45 -0700
Subject: [Rd] Is it possible to pass a function argument from R to
 compiled code in C?
In-Reply-To: <4E78D008.4060800@statistik.tu-dortmund.de>
References: <1316539595929-3827563.post@n4.nabble.com>
	<4E78D008.4060800@statistik.tu-dortmund.de>
Message-ID: <CADwqtCPWD5CXk_TKW10Nsy+GbAML9AAZaMm+J3zSzuhVS5KizA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20110920/a9ef212b/attachment.pl>

From alireza.s.mahani at gmail.com  Tue Sep 20 20:07:26 2011
From: alireza.s.mahani at gmail.com (Alireza Mahani)
Date: Tue, 20 Sep 2011 11:07:26 -0700 (PDT)
Subject: [Rd] Is it possible to pass a function argument from R to
 compiled code in C?
In-Reply-To: <CADwqtCPWD5CXk_TKW10Nsy+GbAML9AAZaMm+J3zSzuhVS5KizA@mail.gmail.com>
References: <1316539595929-3827563.post@n4.nabble.com>
	<4E78D008.4060800@statistik.tu-dortmund.de>
	<CADwqtCPWD5CXk_TKW10Nsy+GbAML9AAZaMm+J3zSzuhVS5KizA@mail.gmail.com>
Message-ID: <1316542046079-3827690.post@n4.nabble.com>

OK, thanks. But there are two issues with using ".Call":

1- I may give up performance if I am literally running R code inside C,
right? In some ways, wouldn't it defy the purpose of calling a compiled code
if I end up back in R?

2- If I use the ".Call" interface, the resulting code will be tailored to R,
i.e. I will end up having the lengthy code with all the R macros in it. I
always prefer to use ".C" interface because I can use the exact same piece
of code inside of a C program, i.e. I can call the same function either from
R or from C. But with .Call, I am passing R's pointers into the function,
which obviously I won't be doing when my call comes from inside of C.

Nevertheless, it's good to know that there is at least a sub-optimal
solution out there (sub-optimal from my perspective, of course!).

-Alireza

--
View this message in context: http://r.789695.n4.nabble.com/Is-it-possible-to-pass-a-function-argument-from-R-to-compiled-code-in-C-tp3827563p3827690.html
Sent from the R devel mailing list archive at Nabble.com.


From jeffrey.ryan at lemnica.com  Tue Sep 20 20:12:49 2011
From: jeffrey.ryan at lemnica.com (Jeffrey Ryan)
Date: Tue, 20 Sep 2011 13:12:49 -0500
Subject: [Rd] Is it possible to pass a function argument from R to
 compiled code in C?
In-Reply-To: <1316542046079-3827690.post@n4.nabble.com>
References: <1316539595929-3827563.post@n4.nabble.com>
	<4E78D008.4060800@statistik.tu-dortmund.de>
	<CADwqtCPWD5CXk_TKW10Nsy+GbAML9AAZaMm+J3zSzuhVS5KizA@mail.gmail.com>
	<1316542046079-3827690.post@n4.nabble.com>
Message-ID: <CABDUZc9MNguqRz=L_1D73Gf39cx22OdptJNcbrdpddOQx3tGtg@mail.gmail.com>

You can't call "R" code as if it is C code.  It is R, and requires
that it be evaluated.  How would your C know what to do with an R
pointer...

.Call is more efficient than .C, all the time.  Check this list and
experiment.  That said, you can still call "just C" within the .Call
"R" function, it really is 'just C' in there.

Probably something like a simple example of what you are trying to do
would help the list steer you into the right direction (steer, since
you seem to be missing something in your thinking on this...)

Best,
Jeff

On Tue, Sep 20, 2011 at 1:07 PM, Alireza Mahani
<alireza.s.mahani at gmail.com> wrote:
> OK, thanks. But there are two issues with using ".Call":
>
> 1- I may give up performance if I am literally running R code inside C,
> right? In some ways, wouldn't it defy the purpose of calling a compiled code
> if I end up back in R?
>
> 2- If I use the ".Call" interface, the resulting code will be tailored to R,
> i.e. I will end up having the lengthy code with all the R macros in it. I
> always prefer to use ".C" interface because I can use the exact same piece
> of code inside of a C program, i.e. I can call the same function either from
> R or from C. But with .Call, I am passing R's pointers into the function,
> which obviously I won't be doing when my call comes from inside of C.
>
> Nevertheless, it's good to know that there is at least a sub-optimal
> solution out there (sub-optimal from my perspective, of course!).
>
> -Alireza
>
> --
> View this message in context: http://r.789695.n4.nabble.com/Is-it-possible-to-pass-a-function-argument-from-R-to-compiled-code-in-C-tp3827563p3827690.html
> Sent from the R devel mailing list archive at Nabble.com.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>



-- 
Jeffrey Ryan
jeffrey.ryan at lemnica.com

www.lemnica.com
www.esotericR.com


From edd at debian.org  Tue Sep 20 20:35:39 2011
From: edd at debian.org (Dirk Eddelbuettel)
Date: Tue, 20 Sep 2011 13:35:39 -0500
Subject: [Rd] Is it possible to pass a function argument from R to
 compiled code in C?
In-Reply-To: <1316539595929-3827563.post@n4.nabble.com>
References: <1316539595929-3827563.post@n4.nabble.com>
Message-ID: <20088.56571.906649.129025@max.nulle.part>


On 20 September 2011 at 10:26, Alireza Mahani wrote:
| I have a function in R that takes another function as argument:
| 
| f <- function(g, ...) { #g is expected to be a function
| }
| 
| I want to see if there is a way to implement "f" in C and calling it from R
| using ".C" interface. I know that I can use function pointers for my C
| implementation, but I imagine it's going to be nearly impossible to pass a
| function from R to C. Are there any exact or approximate solutions
| available?

Yes you can -- using .Call() with can receive/return SEXP-typed variable, and
you can use an external pointer wrapped up in a SEXP.  The standard C API to
R supports it.

Now, Romain and I argue that the Rcpp interface for C++ makes it easier.
So what I am showing you now uses C++. You could do all that in C as well,
but you'd need to add a lot more hand-holding code which we hide behind the
C++ type system.

To keep this concrete, I have a full example in the Rcpp-using variant of
DEoptim, the RcppDE package which is on CRAN and R-Forge.  Here are some core
pieces of what demo(CompiledBenchmark) does:

R function:

    Wild <- function(x) { 		## 'Wild' function, global minimum at about -15.81515
        sum(10 * sin(0.3 * x) * sin(1.3 * x^2) + 0.00001 * x^4 + 0.2 * x + 80)/length(x)
    }

C++ variant of same function:


    double wild(SEXP xs) {
       Rcpp::NumericVector x(xs);
       int n = x.size();
       double sum = 0.0;
       for (int i=0; i<n; i++) {
          sum += 10 * sin(0.3 * x[i]) * sin(1.3 * x[i]*x[i]) + 0.00001 * x[i]*x[i]*x[i]*x[i] + 0.2 * x[i] + 80;
       }
       sum /= n;
       return(sum);
    }

and the key is then to (using the inline package, wrapping C++ code) create
an external pointer object (using the Rcpp::XPtr type) pointing at this C++
function just shown (and the real version does this for three different
functions with a switch, but the essence is just this):

    ## now via a class returning external pointer
    src.xptr <- 'return(XPtr<funcPtr>(new funcPtr(&wild)));'
    create_xptr <- cxxfunction(signature(funname="character"), body=src.xptr, inc=inc, plugin="Rcpp")

Calling create_xptr() in R gives us the XPtr in R --- and there we just pass
it down to the optimising function which then has a simple switch on the type
it receives to see whether it evaluates an R function, or a C++ function.  So
in the C++ function implementing the inner core of the optimisation (in
devol.cpp), we do

    if (TYPEOF(fcall) == EXTPTRSXP) { 		// non-standard mode: we are being passed an external pointer
	ev = new Rcpp::DE::EvalCompiled(fcall); // so assign a pointer using external pointer in fcall SEXP
    } else {					// standard mode: env_ is an env, fcall_ is a function 
	ev = new Rcpp::DE::EvalStandard(fcall, rho);	// so assign R function and environment
    }

and that simple branches between two cases of evaluator helper class.

To evaluate the R function at the C++ level we do

    double eval(SEXP par) {
	neval++;
	return defaultfun(par);
    }

with

    double defaultfun(SEXP par) { 			// essentialy same as the old evaluate
	SEXP fn = ::Rf_lang3(fcall, par, R_DotsSymbol); 
	SEXP sexp_fvec = ::Rf_eval(fn, env);		
	double f_result = REAL(sexp_fvec)[0];
	if (ISNAN(f_result)) 
	    ::Rf_error("NaN value of objective function! \nPerhaps adjust the bounds.");
	return(f_result); 
    }

whereas to evaluate the C++ function passed in, we do

    EvalCompiled( SEXP xps ) {				// get funptr from external pointer
	Rcpp::XPtr<funcPtr> xptr(xps);
	funptr = *(xptr);
    };
    double eval(SEXP par) {
	neval++;
	return funptr(par);
    }

This can probably be refined further, as it was mostly just one big proof of
concept.  But it works fine, do

   library(RcppDE)
   demo(CompiledBenchmark)

and several R-vs-C++ comparison of objective funtions should be timed for you.

If you're interested, we're always happy to take on Rcpp-specific questions
on the rcpp-devel list.

Hope this helps,  Dirk


-- 
New Rcpp master class for R and C++ integration is scheduled for 
San Francisco (Oct 8), more details / reg.info available at
http://www.revolutionanalytics.com/products/training/public/rcpp-master-class.php


From bbolker at gmail.com  Tue Sep 20 20:57:01 2011
From: bbolker at gmail.com (Ben Bolker)
Date: Tue, 20 Sep 2011 14:57:01 -0400
Subject: [Rd] difficulty with 'parallel' in building r57032 -- missing
	Makefile?
Message-ID: <4E78E1FD.4070302@ufl.edu>


  From SVN revision 57032, with configuration

R is now configured for i686-pc-linux-gnu

  Source directory:          .
  Installation directory:    /usr/local

  C compiler:                gcc -std=gnu99  -g -O2
  Fortran 77 compiler:       gfortran  -g -O2

  C++ compiler:              g++  -g -O2
  Fortran 90/95 compiler:    gfortran -g -O2
  Obj-C compiler:	

  Interfaces supported:      X11
  External libraries:        readline
  Additional capabilities:   PNG, JPEG, NLS, cairo
  Options enabled:           shared BLAS, R profiling, Java

  Recommended packages:      yes


  having run tools/rsync-recommended, I get stuck at:


make[3]: Entering directory
`/mnt/hgfs/bolker/Documents/R/r-devel/src/library/parallel'
make[3]: *** No rule to make target `all'.  Stop.
make[3]: Leaving directory
`/mnt/hgfs/bolker/Documents/R/r-devel/src/library/parallel'
make[2]: *** [R] Error 1

  I don't know quite enough about configure/make/etc. to know what's
going wrong here, but it seems that one symptom is that "Makefile" does
not exist/is not built in src/library/parallel ... Makefile.in and
Makefile.win  in my fumbling way, I looked through configure,
configure.ac, etc., comparing what is done with the "splines" package,
and no glaring differences leap out at me -- so I'm stumped.

 If I do ./configure --without-parallel; make , it works.


  If I'm being an idiot please be gentle ...

  Ben Bolker


From pdalgd at gmail.com  Tue Sep 20 21:29:56 2011
From: pdalgd at gmail.com (peter dalgaard)
Date: Tue, 20 Sep 2011 21:29:56 +0200
Subject: [Rd] difficulty with 'parallel' in building r57032 -- missing
	Makefile?
In-Reply-To: <4E78E1FD.4070302@ufl.edu>
References: <4E78E1FD.4070302@ufl.edu>
Message-ID: <2F7496D8-FB9B-4737-9BAE-CBE651169CFF@gmail.com>


On Sep 20, 2011, at 20:57 , Ben Bolker wrote:

> 
>  From SVN revision 57032, with configuration
> 
> R is now configured for i686-pc-linux-gnu
> 
>  Source directory:          .
>  Installation directory:    /usr/local
> 
>  C compiler:                gcc -std=gnu99  -g -O2
>  Fortran 77 compiler:       gfortran  -g -O2
> 
>  C++ compiler:              g++  -g -O2
>  Fortran 90/95 compiler:    gfortran -g -O2
>  Obj-C compiler:	
> 
>  Interfaces supported:      X11
>  External libraries:        readline
>  Additional capabilities:   PNG, JPEG, NLS, cairo
>  Options enabled:           shared BLAS, R profiling, Java
> 
>  Recommended packages:      yes
> 
> 
>  having run tools/rsync-recommended, I get stuck at:
> 
> 
> make[3]: Entering directory
> `/mnt/hgfs/bolker/Documents/R/r-devel/src/library/parallel'
> make[3]: *** No rule to make target `all'.  Stop.
> make[3]: Leaving directory
> `/mnt/hgfs/bolker/Documents/R/r-devel/src/library/parallel'
> make[2]: *** [R] Error 1
> 
>  I don't know quite enough about configure/make/etc. to know what's
> going wrong here, but it seems that one symptom is that "Makefile" does
> not exist/is not built in src/library/parallel ... Makefile.in and
> Makefile.win  in my fumbling way, I looked through configure,
> configure.ac, etc., comparing what is done with the "splines" package,
> and no glaring differences leap out at me -- so I'm stumped.
> 
> If I do ./configure --without-parallel; make , it works.
> 
> 
>  If I'm being an idiot please be gentle ...

Hmm, did you do this as a squeaky-clean build? I think I saw something like that on OSX and it disappeared after "make distclean" and reconfiguration.

It's fairly common that a clean build is required after changes to the directory structure or similar changes to the build structure. Every once in a while, it is just not worth the trouble to ensure that you can keep previously built intermediate files. 

Also, try not building in the source directory. It's much easier to clean up if build in a separate build directory.


> 
>  Ben Bolker
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Peter Dalgaard, Professor,
Center for Statistics, Copenhagen Business School
Solbjerg Plads 3, 2000 Frederiksberg, Denmark
Phone: (+45)38153501
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com
"D?den skal tape!" --- Nordahl Grieg


From bbolker at gmail.com  Thu Sep 15 10:54:57 2011
From: bbolker at gmail.com (Ben Bolker)
Date: Thu, 15 Sep 2011 10:54:57 +0200
Subject: [Rd] difficulty with 'parallel' in building r57032 -- missing
 Makefile?
In-Reply-To: <2F7496D8-FB9B-4737-9BAE-CBE651169CFF@gmail.com>
References: <4E78E1FD.4070302@ufl.edu>
	<2F7496D8-FB9B-4737-9BAE-CBE651169CFF@gmail.com>
Message-ID: <4E71BD61.7030106@gmail.com>

On 11-09-20 09:29 PM, peter dalgaard wrote:
> 
> On Sep 20, 2011, at 20:57 , Ben Bolker wrote:
> 
>> 
>> From SVN revision 57032, with configuration
>> 
>> R is now configured for i686-pc-linux-gnu
>> 
>> Source directory:          . Installation directory:    /usr/local
>> 
>> C compiler:                gcc -std=gnu99  -g -O2 Fortran 77
>> compiler:       gfortran  -g -O2
>> 
>> C++ compiler:              g++  -g -O2 Fortran 90/95 compiler:
>> gfortran -g -O2 Obj-C compiler:
>> 
>> Interfaces supported:      X11 External libraries:        readline 
>> Additional capabilities:   PNG, JPEG, NLS, cairo Options enabled:
>> shared BLAS, R profiling, Java
>> 
>> Recommended packages:      yes
>> 
>> 
>> having run tools/rsync-recommended, I get stuck at:
>> 
>> 
>> make[3]: Entering directory 
>> `/mnt/hgfs/bolker/Documents/R/r-devel/src/library/parallel' 
>> make[3]: *** No rule to make target `all'.  Stop. make[3]: Leaving
>> directory 
>> `/mnt/hgfs/bolker/Documents/R/r-devel/src/library/parallel' 
>> make[2]: *** [R] Error 1
>> 
>> I don't know quite enough about configure/make/etc. to know what's 
>> going wrong here, but it seems that one symptom is that "Makefile"
>> does not exist/is not built in src/library/parallel ... Makefile.in
>> and Makefile.win  in my fumbling way, I looked through configure, 
>> configure.ac, etc., comparing what is done with the "splines"
>> package, and no glaring differences leap out at me -- so I'm
>> stumped.
>> 
>> If I do ./configure --without-parallel; make , it works.
>> 
>> 
>> If I'm being an idiot please be gentle ...
> 
> Hmm, did you do this as a squeaky-clean build? I think I saw
> something like that on OSX and it disappeared after "make distclean"
> and reconfiguration.
> 
> It's fairly common that a clean build is required after changes to
> the directory structure or similar changes to the build structure.
> Every once in a while, it is just not worth the trouble to ensure
> that you can keep previously built intermediate files.
> 
> Also, try not building in the source directory. It's much easier to
> clean up if build in a separate build directory.
> 
> 

  Yes, thank you, that seems to have done the trick.

  Ben Bolker


From bbolker at gmail.com  Thu Sep 15 11:03:26 2011
From: bbolker at gmail.com (Ben Bolker)
Date: Thu, 15 Sep 2011 11:03:26 +0200
Subject: [Rd] load.R patch suggestion
Message-ID: <4E71BF5E.20908@gmail.com>


Inspired by

http://stackoverflow.com/questions/7487778/could-you-tell-me-what-this-error-means

I wrote the following very small (one-line) patch which returns an
*informative* error message when R tries to load a zero-byte file rather
than

Error in if (!grepl("RD[AX]2\n", magic)) { : argument is of length zero

  I would guess that error messages with the word "magic" in them would
be disturbing to new users, who are probably worried already that R is
magic ...

  Ben Bolker

-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: load.R.txt
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20110915/8bfee80d/attachment.txt>

From tim.bates at ed.ac.uk  Wed Sep 21 19:55:58 2011
From: tim.bates at ed.ac.uk (Timothy Bates)
Date: Wed, 21 Sep 2011 18:55:58 +0100
Subject: [Rd] names Rd see Also{slotNames}
Message-ID: <0E6CAE23-3AE4-42DB-9197-E2504AB98E6B@ed.ac.uk>

Would anyone object to a suggestion that the names.Rd file could usefully point to seeAlso{slotNames}?

cheers,
tim
-- 
The University of Edinburgh is a charitable body, registered in
Scotland, with registration number SC005336.


From nick.sabbe at ugent.be  Thu Sep 22 13:16:02 2011
From: nick.sabbe at ugent.be (Nick Sabbe)
Date: Thu, 22 Sep 2011 13:16:02 +0200
Subject: [Rd] R check error / update.packages
Message-ID: <025b01cc7919$03675a30$0a360e90$@sabbe@ugent.be>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20110922/479b50e4/attachment.pl>

From nick.sabbe at ugent.be  Thu Sep 22 13:53:56 2011
From: nick.sabbe at ugent.be (Nick Sabbe)
Date: Thu, 22 Sep 2011 13:53:56 +0200
Subject: [Rd] R CMD check file issues
Message-ID: <027501cc791e$4f4df2b0$ede9d810$@sabbe@ugent.be>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20110922/e8c14ab7/attachment.pl>

From ligges at statistik.tu-dortmund.de  Thu Sep 22 13:54:18 2011
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Thu, 22 Sep 2011 13:54:18 +0200
Subject: [Rd] R check error / update.packages
In-Reply-To: <025b01cc7919$03675a30$0a360e90$@sabbe@ugent.be>
References: <025b01cc7919$03675a30$0a360e90$@sabbe@ugent.be>
Message-ID: <4E7B21EA.2020903@statistik.tu-dortmund.de>

This is an infelicity in a recent glmnet release, I will follow up off 
list in a minute.

Best,
Uwe Ligges



On 22.09.2011 13:16, Nick Sabbe wrote:
> While building/checking a package of mine that depends on glmnet, I got the
> following message:
>
>
>
> * checking whether the name space can be loaded with stated dependencies
> ...Warn
>
> ing: running command
> '"C:/Users/nisabbe/Documents/R/R-2.13.1/bin/i386/Rterm.exe"
>
>   R_DEFAULT_PACKAGES=NULL --vanilla --slave -f
> C:\Users\nisabbe\AppData\Local\Tem
>
> p\RtmpZpjj07\Rin121ae93' had status 1
>
>   WARNING
>
> Error: .onLoad failed in loadNamespace() for 'glmnet', details:
>
>    call: cat("Loaded glmnet", installed.packages()["glmnet", "Version"],
>
>    error: could not find function "installed.packages"
>
> Execution halted
>
>
>
> A namespace must be able to be loaded with just the base namespace
>
> loaded: otherwise if the namespace gets loaded by a saved object, the
>
> session will be unable to start.
>
>
>
> Probably some imports need to be declared in the NAMESPACE file.
>
>
>
> I have not changed anything to my dependencies (since my last successful
> build the day before yesterday), and to my knowledge, I have not changed
> anything relevant. I am using R 2.13.1 (unchanged since the last successful
> build) on Windows 7 32bit. When starting a vanilla R terminal, the function
> installed.packages is present and can be run. Apart from this, I do not get
> any warnings or errors (e.g. the examples run fine). Also, as far as I can
> tell, I've never had the warning wrt status 1 (up to today), but it is
> unclear whether one is just the consequence of the other. Note: the sources
> for this package can be found on R-Forge:
> https://r-forge.r-project.org/R/?group_id=1130
>
> The namespace itself contains as its import statement: import(glmnet, rgl,
> Matrix, snowfall)
>
> Can someone please help me avoid this warning, as I prefer 0 errors 0
> warnings.
>
>
>
>
>
> On a related note, while trying to alleviate the problem, I ran
> update.packages, which led me to another problem: apparently, packages that
> are loaded at the time of update.packages are not updated and may end up
> broken (this was the case for lattice and Hmisc, for me). Luckily my
> colleague had gone through the same troubles and pointed me to the solution.
> I can imagine it to be hard to define exactly which packages should or
> shouldn't be updated, but it would be nice if the update.packages at least
> issued a warning against this.
>
>
>
>
>
> Nick Sabbe
>
> --
>
> ping: nick.sabbe at ugent.be
>
> link:<http://biomath.ugent.be/>  http://biomath.ugent.be
>
> wink: A1.056, Coupure Links 653, 9000 Gent
>
> ring: 09/264.59.36
>
>
>
> -- Do Not Disapprove
>
>
>
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From ligges at statistik.tu-dortmund.de  Thu Sep 22 13:57:42 2011
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Thu, 22 Sep 2011 13:57:42 +0200
Subject: [Rd] R CMD check file issues
In-Reply-To: <027501cc791e$4f4df2b0$ede9d810$@sabbe@ugent.be>
References: <027501cc791e$4f4df2b0$ede9d810$@sabbe@ugent.be>
Message-ID: <4E7B22B6.50404@statistik.tu-dortmund.de>

Are you sure there is no other check process or editor that locks the file?

Uwe Ligges


On 22.09.2011 13:53, Nick Sabbe wrote:
> This problem is likely to be specific to Windows, and particularly Win7.
>
>
>
> After a successful build of a package (R CMD build addendum), I immediately
> run an R CMD check for the same package.
>
> Not always, but _very_ often, I get the following error:
>
> C:\Users\nisabbe\Documents\@Doctoraat\R>R CMD check addendum
>
> Loading required package: tcltk
>
> Loading Tcl/Tk interface ... done
>
> Loading required package: Hmisc
>
> Loading required package: survival
>
> Loading required package: stats
>
> Loading required package: graphics
>
> Loading required package: splines
>
>
>
> Attaching package: 'Hmisc'
>
>
>
> The following object(s) are masked from 'package:survival':
>
>
>
>      untangle.specials
>
>
>
> The following object(s) are masked from 'package:base':
>
>
>
>      format.pval, round.POSIXt, trunc.POSIXt, units
>
>
>
> Loading required package: R2HTML
>
> Warning in file(filename, "wt") :
>
>    cannot open file
> 'C:/Users/nisabbe/Documents/@Doctoraat/R/addendum.Rcheck/00ch
>
> eck.log': Permission denied
>
> Error in file(filename, "wt") : cannot open the connection
>
> Execution halted
>
>
>
> If, after this, I immediately reissue the R CMD check command, it works,
> without the error.
>
> I think this has something to do with how Win7 processes file handling
> (there are known issues even noticeable in windows explorer), but perhaps
> there is a way of circumventing this? It would be greatly appreciated, as
> this issue is preventing automation of build/check/install scripts.
>
>
>
> Suggestions will be greatly appreciated.
>
>
>
> Nick Sabbe
>
> --
>
> ping: nick.sabbe at ugent.be
>
> link:<http://biomath.ugent.be/>  http://biomath.ugent.be
>
> wink: A1.056, Coupure Links 653, 9000 Gent
>
> ring: 09/264.59.36
>
>
>
> -- Do Not Disapprove
>
>
>
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From nick.sabbe at ugent.be  Thu Sep 22 14:16:20 2011
From: nick.sabbe at ugent.be (Nick Sabbe)
Date: Thu, 22 Sep 2011 14:16:20 +0200
Subject: [Rd] R CMD check file issues
In-Reply-To: <4E7B22B6.50404@statistik.tu-dortmund.de>
References: <027501cc791e$4f4df2b0$ede9d810$@sabbe@ugent.be>
	<4E7B22B6.50404@statistik.tu-dortmund.de>
Message-ID: <027b01cc7921$6ff74720$4fe5d560$@sabbe@ugent.be>

Hello Uwe, and thanks for your interest in the issue.

There is most certainly not another process that stops working between the
two R CMD check calls (recently, I've made a habit out of being ready to
press <up arrow> <enter> in the seconds after running my first R CMD check,
to rerun it if it fails).

At worst, there may ever have been an explorer window open, but this is
definitely not always the case, and I'm sure this window was not closed
then, between the calls.

I'm really quite afraid it is more of a windows issue than an R issue, but I
was hoping you wizards might have a workaround (apart from the obvious
suggestion to install Linux), as it is immensely annoying...


Nick Sabbe
--
ping: nick.sabbe at ugent.be
link: http://biomath.ugent.be
wink: A1.056, Coupure Links 653, 9000 Gent
ring: 09/264.59.36

-- Do Not Disapprove




> -----Original Message-----
> From: Uwe Ligges [mailto:ligges at statistik.tu-dortmund.de]
> Sent: donderdag 22 september 2011 13:58
> To: Nick Sabbe
> Cc: r-devel at r-project.org
> Subject: Re: [Rd] R CMD check file issues
> 
> Are you sure there is no other check process or editor that locks the
> file?
> 
> Uwe Ligges
> 
> 
> On 22.09.2011 13:53, Nick Sabbe wrote:
> > This problem is likely to be specific to Windows, and particularly
> Win7.
> >
> >
> >
> > After a successful build of a package (R CMD build addendum), I
> immediately
> > run an R CMD check for the same package.
> >
> > Not always, but _very_ often, I get the following error:
> >
> > C:\Users\nisabbe\Documents\@Doctoraat\R>R CMD check addendum
> >
> > Loading required package: tcltk
> >
> > Loading Tcl/Tk interface ... done
> >
> > Loading required package: Hmisc
> >
> > Loading required package: survival
> >
> > Loading required package: stats
> >
> > Loading required package: graphics
> >
> > Loading required package: splines
> >
> >
> >
> > Attaching package: 'Hmisc'
> >
> >
> >
> > The following object(s) are masked from 'package:survival':
> >
> >
> >
> >      untangle.specials
> >
> >
> >
> > The following object(s) are masked from 'package:base':
> >
> >
> >
> >      format.pval, round.POSIXt, trunc.POSIXt, units
> >
> >
> >
> > Loading required package: R2HTML
> >
> > Warning in file(filename, "wt") :
> >
> >    cannot open file
> > 'C:/Users/nisabbe/Documents/@Doctoraat/R/addendum.Rcheck/00ch
> >
> > eck.log': Permission denied
> >
> > Error in file(filename, "wt") : cannot open the connection
> >
> > Execution halted
> >
> >
> >
> > If, after this, I immediately reissue the R CMD check command, it
> works,
> > without the error.
> >
> > I think this has something to do with how Win7 processes file
> handling
> > (there are known issues even noticeable in windows explorer), but
> perhaps
> > there is a way of circumventing this? It would be greatly
> appreciated, as
> > this issue is preventing automation of build/check/install scripts.
> >
> >
> >
> > Suggestions will be greatly appreciated.
> >
> >
> >
> > Nick Sabbe
> >
> > --
> >
> > ping: nick.sabbe at ugent.be
> >
> > link:<http://biomath.ugent.be/>  http://biomath.ugent.be
> >
> > wink: A1.056, Coupure Links 653, 9000 Gent
> >
> > ring: 09/264.59.36
> >
> >
> >
> > -- Do Not Disapprove
> >
> >
> >
> >
> > 	[[alternative HTML version deleted]]
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel


From ligges at statistik.tu-dortmund.de  Thu Sep 22 14:19:51 2011
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Thu, 22 Sep 2011 14:19:51 +0200
Subject: [Rd] R CMD check file issues
In-Reply-To: <027b01cc7921$6ff74720$4fe5d560$@sabbe@ugent.be>
References: <027501cc791e$4f4df2b0$ede9d810$@sabbe@ugent.be>
	<4E7B22B6.50404@statistik.tu-dortmund.de>
	<027b01cc7921$6ff74720$4fe5d560$@sabbe@ugent.be>
Message-ID: <4E7B27E7.7020609@statistik.tu-dortmund.de>



On 22.09.2011 14:16, Nick Sabbe wrote:
> Hello Uwe, and thanks for your interest in the issue.
>
> There is most certainly not another process that stops working between the
> two R CMD check calls (recently, I've made a habit out of being ready to
> press<up arrow>  <enter>  in the seconds after running my first R CMD check,
> to rerun it if it fails).
>
> At worst, there may ever have been an explorer window open, but this is
> definitely not always the case, and I'm sure this window was not closed
> then, between the calls.
>
> I'm really quite afraid it is more of a windows issue than an R issue, but I
> was hoping you wizards might have a workaround (apart from the obvious
> suggestion to install Linux), as it is immensely annoying...


I have not seen this problem so far (but then, I am mostly under Windows 
XP and winbuilder is Windows Server 2003).

Uwe


>
> Nick Sabbe
> --
> ping: nick.sabbe at ugent.be
> link: http://biomath.ugent.be
> wink: A1.056, Coupure Links 653, 9000 Gent
> ring: 09/264.59.36
>
> -- Do Not Disapprove
>
>
>
>
>> -----Original Message-----
>> From: Uwe Ligges [mailto:ligges at statistik.tu-dortmund.de]
>> Sent: donderdag 22 september 2011 13:58
>> To: Nick Sabbe
>> Cc: r-devel at r-project.org
>> Subject: Re: [Rd] R CMD check file issues
>>
>> Are you sure there is no other check process or editor that locks the
>> file?
>>
>> Uwe Ligges
>>
>>
>> On 22.09.2011 13:53, Nick Sabbe wrote:
>>> This problem is likely to be specific to Windows, and particularly
>> Win7.
>>>
>>>
>>>
>>> After a successful build of a package (R CMD build addendum), I
>> immediately
>>> run an R CMD check for the same package.
>>>
>>> Not always, but _very_ often, I get the following error:
>>>
>>> C:\Users\nisabbe\Documents\@Doctoraat\R>R CMD check addendum
>>>
>>> Loading required package: tcltk
>>>
>>> Loading Tcl/Tk interface ... done
>>>
>>> Loading required package: Hmisc
>>>
>>> Loading required package: survival
>>>
>>> Loading required package: stats
>>>
>>> Loading required package: graphics
>>>
>>> Loading required package: splines
>>>
>>>
>>>
>>> Attaching package: 'Hmisc'
>>>
>>>
>>>
>>> The following object(s) are masked from 'package:survival':
>>>
>>>
>>>
>>>       untangle.specials
>>>
>>>
>>>
>>> The following object(s) are masked from 'package:base':
>>>
>>>
>>>
>>>       format.pval, round.POSIXt, trunc.POSIXt, units
>>>
>>>
>>>
>>> Loading required package: R2HTML
>>>
>>> Warning in file(filename, "wt") :
>>>
>>>     cannot open file
>>> 'C:/Users/nisabbe/Documents/@Doctoraat/R/addendum.Rcheck/00ch
>>>
>>> eck.log': Permission denied
>>>
>>> Error in file(filename, "wt") : cannot open the connection
>>>
>>> Execution halted
>>>
>>>
>>>
>>> If, after this, I immediately reissue the R CMD check command, it
>> works,
>>> without the error.
>>>
>>> I think this has something to do with how Win7 processes file
>> handling
>>> (there are known issues even noticeable in windows explorer), but
>> perhaps
>>> there is a way of circumventing this? It would be greatly
>> appreciated, as
>>> this issue is preventing automation of build/check/install scripts.
>>>
>>>
>>>
>>> Suggestions will be greatly appreciated.
>>>
>>>
>>>
>>> Nick Sabbe
>>>
>>> --
>>>
>>> ping: nick.sabbe at ugent.be
>>>
>>> link:<http://biomath.ugent.be/>   http://biomath.ugent.be
>>>
>>> wink: A1.056, Coupure Links 653, 9000 Gent
>>>
>>> ring: 09/264.59.36
>>>
>>>
>>>
>>> -- Do Not Disapprove
>>>
>>>
>>>
>>>
>>> 	[[alternative HTML version deleted]]
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From murdoch.duncan at gmail.com  Thu Sep 22 14:20:14 2011
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Thu, 22 Sep 2011 08:20:14 -0400
Subject: [Rd] R CMD check file issues
In-Reply-To: <4e7b2236.9a58df0a.3724.7ee5SMTPIN_ADDED@mx.google.com>
References: <4e7b2236.9a58df0a.3724.7ee5SMTPIN_ADDED@mx.google.com>
Message-ID: <4E7B27FE.6050804@gmail.com>

On 11-09-22 7:53 AM, Nick Sabbe wrote:
> This problem is likely to be specific to Windows, and particularly Win7.

The symptoms sound like interference from an anti-virus checker.

Duncan Murdoch

>
>
> After a successful build of a package (R CMD build addendum), I immediately
> run an R CMD check for the same package.
>
> Not always, but _very_ often, I get the following error:
>
> C:\Users\nisabbe\Documents\@Doctoraat\R>R CMD check addendum
>
> Loading required package: tcltk
>
> Loading Tcl/Tk interface ... done
>
> Loading required package: Hmisc
>
> Loading required package: survival
>
> Loading required package: stats
>
> Loading required package: graphics
>
> Loading required package: splines
>
>
>
> Attaching package: 'Hmisc'
>
>
>
> The following object(s) are masked from 'package:survival':
>
>
>
>      untangle.specials
>
>
>
> The following object(s) are masked from 'package:base':
>
>
>
>      format.pval, round.POSIXt, trunc.POSIXt, units
>
>
>
> Loading required package: R2HTML
>
> Warning in file(filename, "wt") :
>
>    cannot open file
> 'C:/Users/nisabbe/Documents/@Doctoraat/R/addendum.Rcheck/00ch
>
> eck.log': Permission denied
>
> Error in file(filename, "wt") : cannot open the connection
>
> Execution halted
>
>
>
> If, after this, I immediately reissue the R CMD check command, it works,
> without the error.
>
> I think this has something to do with how Win7 processes file handling
> (there are known issues even noticeable in windows explorer), but perhaps
> there is a way of circumventing this? It would be greatly appreciated, as
> this issue is preventing automation of build/check/install scripts.
>
>
>
> Suggestions will be greatly appreciated.
>
>
>
> Nick Sabbe
>
> --
>
> ping: nick.sabbe at ugent.be
>
> link:<http://biomath.ugent.be/>  http://biomath.ugent.be
>
> wink: A1.056, Coupure Links 653, 9000 Gent
>
> ring: 09/264.59.36
>
>
>
> -- Do Not Disapprove
>
>
>
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From nick.sabbe at ugent.be  Thu Sep 22 14:30:17 2011
From: nick.sabbe at ugent.be (Nick Sabbe)
Date: Thu, 22 Sep 2011 14:30:17 +0200
Subject: [Rd] R CMD check file issues
In-Reply-To: <4E7B27FE.6050804@gmail.com>
References: <4e7b2236.9a58df0a.3724.7ee5SMTPIN_ADDED@mx.google.com>
	<4E7B27FE.6050804@gmail.com>
Message-ID: <027c01cc7923$62fce960$28f6bc20$@sabbe@ugent.be>

Hi Duncan (and others).

I've just turned off my virus scanner (MS Forefront Endpoint Protection).

The issue persists. It appears that the first time I call R CMD check, it
deletes the previous rcheck folder, but tries to proceed before it is
actually gone. By the time I reissue the command, the folder is truly gone,
and the R CMD check can safely do its work.

Is anyone else here using Win7 (32bit) and successfully building/checking R
packages? Perhaps I'm the only one who has treaded this path :-)


Nick Sabbe
--
ping: nick.sabbe at ugent.be
link: http://biomath.ugent.be
wink: A1.056, Coupure Links 653, 9000 Gent
ring: 09/264.59.36

-- Do Not Disapprove




> -----Original Message-----
> From: Duncan Murdoch [mailto:murdoch.duncan at gmail.com]
> Sent: donderdag 22 september 2011 14:20
> To: Nick Sabbe
> Cc: r-devel at r-project.org
> Subject: Re: [Rd] R CMD check file issues
> 
> On 11-09-22 7:53 AM, Nick Sabbe wrote:
> > This problem is likely to be specific to Windows, and particularly
> Win7.
> 
> The symptoms sound like interference from an anti-virus checker.
> 
> Duncan Murdoch
> 
> >
> >
> > After a successful build of a package (R CMD build addendum), I
> immediately
> > run an R CMD check for the same package.
> >
> > Not always, but _very_ often, I get the following error:
> >
> > C:\Users\nisabbe\Documents\@Doctoraat\R>R CMD check addendum
> >
> > Loading required package: tcltk
> >
> > Loading Tcl/Tk interface ... done
> >
> > Loading required package: Hmisc
> >
> > Loading required package: survival
> >
> > Loading required package: stats
> >
> > Loading required package: graphics
> >
> > Loading required package: splines
> >
> >
> >
> > Attaching package: 'Hmisc'
> >
> >
> >
> > The following object(s) are masked from 'package:survival':
> >
> >
> >
> >      untangle.specials
> >
> >
> >
> > The following object(s) are masked from 'package:base':
> >
> >
> >
> >      format.pval, round.POSIXt, trunc.POSIXt, units
> >
> >
> >
> > Loading required package: R2HTML
> >
> > Warning in file(filename, "wt") :
> >
> >    cannot open file
> > 'C:/Users/nisabbe/Documents/@Doctoraat/R/addendum.Rcheck/00ch
> >
> > eck.log': Permission denied
> >
> > Error in file(filename, "wt") : cannot open the connection
> >
> > Execution halted
> >
> >
> >
> > If, after this, I immediately reissue the R CMD check command, it
> works,
> > without the error.
> >
> > I think this has something to do with how Win7 processes file
> handling
> > (there are known issues even noticeable in windows explorer), but
> perhaps
> > there is a way of circumventing this? It would be greatly
> appreciated, as
> > this issue is preventing automation of build/check/install scripts.
> >
> >
> >
> > Suggestions will be greatly appreciated.
> >
> >
> >
> > Nick Sabbe
> >
> > --
> >
> > ping: nick.sabbe at ugent.be
> >
> > link:<http://biomath.ugent.be/>  http://biomath.ugent.be
> >
> > wink: A1.056, Coupure Links 653, 9000 Gent
> >
> > ring: 09/264.59.36
> >
> >
> >
> > -- Do Not Disapprove
> >
> >
> >
> >
> > 	[[alternative HTML version deleted]]
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel


From murdoch.duncan at gmail.com  Thu Sep 22 14:33:03 2011
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Thu, 22 Sep 2011 08:33:03 -0400
Subject: [Rd] R CMD check file issues
In-Reply-To: <4e7b2a5a.d1c9e30a.0f61.ffffa3c8SMTPIN_ADDED@mx.google.com>
References: <4e7b2236.9a58df0a.3724.7ee5SMTPIN_ADDED@mx.google.com>
	<4E7B27FE.6050804@gmail.com>
	<4e7b2a5a.d1c9e30a.0f61.ffffa3c8SMTPIN_ADDED@mx.google.com>
Message-ID: <4E7B2AFF.8010904@gmail.com>

On 11-09-22 8:30 AM, Nick Sabbe wrote:
> Hi Duncan (and others).
>
> I've just turned off my virus scanner (MS Forefront Endpoint Protection).
>
> The issue persists. It appears that the first time I call R CMD check, it
> deletes the previous rcheck folder, but tries to proceed before it is
> actually gone. By the time I reissue the command, the folder is truly gone,
> and the R CMD check can safely do its work.
>
> Is anyone else here using Win7 (32bit) and successfully building/checking R
> packages? Perhaps I'm the only one who has treaded this path :-)

I do use Win7 on one machine, and have seen odd things happen, but not 
what you describe.

I imagine a simple workaround for you would be to delete the folder 
before you call R CMD check (i.e. wrap R CMD check in a batch file to do 
that), but it would be nice if that were not necessary.

Duncan Murdoch

>
>
> Nick Sabbe
> --
> ping: nick.sabbe at ugent.be
> link: http://biomath.ugent.be
> wink: A1.056, Coupure Links 653, 9000 Gent
> ring: 09/264.59.36
>
> -- Do Not Disapprove
>
>
>
>
>> -----Original Message-----
>> From: Duncan Murdoch [mailto:murdoch.duncan at gmail.com]
>> Sent: donderdag 22 september 2011 14:20
>> To: Nick Sabbe
>> Cc: r-devel at r-project.org
>> Subject: Re: [Rd] R CMD check file issues
>>
>> On 11-09-22 7:53 AM, Nick Sabbe wrote:
>>> This problem is likely to be specific to Windows, and particularly
>> Win7.
>>
>> The symptoms sound like interference from an anti-virus checker.
>>
>> Duncan Murdoch
>>
>>>
>>>
>>> After a successful build of a package (R CMD build addendum), I
>> immediately
>>> run an R CMD check for the same package.
>>>
>>> Not always, but _very_ often, I get the following error:
>>>
>>> C:\Users\nisabbe\Documents\@Doctoraat\R>R CMD check addendum
>>>
>>> Loading required package: tcltk
>>>
>>> Loading Tcl/Tk interface ... done
>>>
>>> Loading required package: Hmisc
>>>
>>> Loading required package: survival
>>>
>>> Loading required package: stats
>>>
>>> Loading required package: graphics
>>>
>>> Loading required package: splines
>>>
>>>
>>>
>>> Attaching package: 'Hmisc'
>>>
>>>
>>>
>>> The following object(s) are masked from 'package:survival':
>>>
>>>
>>>
>>>       untangle.specials
>>>
>>>
>>>
>>> The following object(s) are masked from 'package:base':
>>>
>>>
>>>
>>>       format.pval, round.POSIXt, trunc.POSIXt, units
>>>
>>>
>>>
>>> Loading required package: R2HTML
>>>
>>> Warning in file(filename, "wt") :
>>>
>>>     cannot open file
>>> 'C:/Users/nisabbe/Documents/@Doctoraat/R/addendum.Rcheck/00ch
>>>
>>> eck.log': Permission denied
>>>
>>> Error in file(filename, "wt") : cannot open the connection
>>>
>>> Execution halted
>>>
>>>
>>>
>>> If, after this, I immediately reissue the R CMD check command, it
>> works,
>>> without the error.
>>>
>>> I think this has something to do with how Win7 processes file
>> handling
>>> (there are known issues even noticeable in windows explorer), but
>> perhaps
>>> there is a way of circumventing this? It would be greatly
>> appreciated, as
>>> this issue is preventing automation of build/check/install scripts.
>>>
>>>
>>>
>>> Suggestions will be greatly appreciated.
>>>
>>>
>>>
>>> Nick Sabbe
>>>
>>> --
>>>
>>> ping: nick.sabbe at ugent.be
>>>
>>> link:<http://biomath.ugent.be/>   http://biomath.ugent.be
>>>
>>> wink: A1.056, Coupure Links 653, 9000 Gent
>>>
>>> ring: 09/264.59.36
>>>
>>>
>>>
>>> -- Do Not Disapprove
>>>
>>>
>>>
>>>
>>> 	[[alternative HTML version deleted]]
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From MEC at stowers.org  Thu Sep 22 15:29:19 2011
From: MEC at stowers.org (Cook, Malcolm)
Date: Thu, 22 Sep 2011 08:29:19 -0500
Subject: [Rd] using R as SHELL in gnu make
In-Reply-To: <6441154A9FF1CD4386AF4ABF141A056D2A7502B2@WMEXOSCD2-N1.bocad.bank-banque-canada.ca>
References: <2C40E43D1F7A56408C4463FD245DDDF9856C3218@EXCHMB-02.stowers-institute.org>
	<6441154A9FF1CD4386AF4ABF141A056D2A7502B2@WMEXOSCD2-N1.bocad.bank-banque-canada.ca>
Message-ID: <2C40E43D1F7A56408C4463FD245DDDF9856C3577@EXCHMB-02.stowers-institute.org>

OK,

I now have a working version of setting SHELL=R in a GNU make script, allowing make?s recipes to be written in R, that works out most of the complications.

I plan to clean it up a little more and blog about it soon here: http://malcook-gedanken.blogspot.com/ - I?ll follow up here  when I do.

The approach optionally allows evaluating the recipes using a running Rserve (http://rosuda.org/Rserve/), avoiding initialization time and allowing pre-loading of R libraries common to multiple recipes.

The approach however does NOT provide any special mechanism to preserve state between recipes, 
Rather, recipes may create the make rule?s target as a state dump by setting with `file=?$@?`  in a call to `save` (or `save.image`, `dump`, as desired).  
Other make rules may then call `load('$<')` when the previously saved dump is a pre-requisite to the rule.

I?m still not sure if it is not more of an amusement and am interested in all thoughts on this, and welcome any suggestions for example applications that I might include when I go to blog it up...

Cheers,

~Malcolm


-----Original Message-----
From: Paul Gilbert [mailto:pgilbert at bank-banque-canada.ca] 
Sent: Tuesday, September 20, 2011 8:32 AM
To: Cook, Malcolm; 'help-make at gnu.org'; 'r-devel at r-project.org'
Subject: RE: using R as SHELL in gnu make

Other than the RServe part, I do this all the time. It works well. Perhaps we can put together some notes off-line and then bring it back to the list.

Paul

> -----Original Message-----
> From: r-devel-bounces at r-project.org [mailto:r-devel-bounces at r-
> project.org] On Behalf Of Cook, Malcolm
> Sent: September 19, 2011 6:35 PM
> To: 'help-make at gnu.org'; 'r-devel at r-project.org'
> Subject: [Rd] using R as SHELL in gnu make
> 
> I am intrigued by the possibility of using R as the SHELL in a (Gnu)
> makefile (instead of /bin/sh).  (c.f.
> http://www.gnu.org/software/make/manual/make.html#Choosing-the-Shell)
> 
> Well, rather, I would like the makefile's SHELL to be a command which
> communicated with an R process.
> 
> The makefile targets/prerequistes would, as always, be OS files, which
> would be written/read using standard R file IO.
> 
> The makefile's "recipe"s would be written in R (instead of the usual
> shell).
> 
> The R process would be able to be initiated by `load`ing one or more R
> datasets, libraries or entire images.
> 
> The R process would be able to accumulate state as the makefile
> progressed.  The recipe's would be able to refer to that state,
> allowing conditional execution.
> 
> The R process would optionally be saved as an image of on job
> termination/completion.
> 
> The R process might be managed using the RServe package, and would need
> to be initiated once only, when the makefile was first invoked.
> 
> I would appreciate learning if anyone had any success, informative
> failures, or other lore that may help in (or dissuade me from)
> embarking on attempt this.
> 
> Thanks,
> 
> Malcolm Cook
> Stowers Institute for Medical Research
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
====================================================================================

La version fran?aise suit le texte anglais.

------------------------------------------------------------------------------------

This email may contain privileged and/or confidential information, and the Bank of
Canada does not waive any related rights. Any distribution, use, or copying of this
email or the information it contains by other than the intended recipient is
unauthorized. If you received this email in error please delete it immediately from
your system and notify the sender promptly by email that you have done so. 

------------------------------------------------------------------------------------

Le pr?sent courriel peut contenir de l'information privil?gi?e ou confidentielle.
La Banque du Canada ne renonce pas aux droits qui s'y rapportent. Toute diffusion,
utilisation ou copie de ce courriel ou des renseignements qu'il contient par une
personne autre que le ou les destinataires d?sign?s est interdite. Si vous recevez
ce courriel par erreur, veuillez le supprimer imm?diatement et envoyer sans d?lai ?
l'exp?diteur un message ?lectronique pour l'aviser que vous avez ?limin? de votre
ordinateur toute copie du courriel re?u.

From hb at biostat.ucsf.edu  Thu Sep 22 17:59:14 2011
From: hb at biostat.ucsf.edu (Henrik Bengtsson)
Date: Thu, 22 Sep 2011 08:59:14 -0700
Subject: [Rd] R CMD check file issues
In-Reply-To: <4E7B2AFF.8010904@gmail.com>
References: <4e7b2236.9a58df0a.3724.7ee5SMTPIN_ADDED@mx.google.com>
	<4E7B27FE.6050804@gmail.com>
	<4e7b2a5a.d1c9e30a.0f61.ffffa3c8SMTPIN_ADDED@mx.google.com>
	<4E7B2AFF.8010904@gmail.com>
Message-ID: <CAFDcVCSaGSAL4jxvMWk2ftLAV-B3_Z2c9YhmrKvVB=TDzVeqQw@mail.gmail.com>

I'm on Windows 7 (64-bit) and everything works perfectly.  Obviously,
there is either another process locking down a file with the same name
or the directory doesn't exist at the time of the file() call.

Now to the most important question  ...what's your sessionInfo()?

/Henrik

On Thu, Sep 22, 2011 at 5:33 AM, Duncan Murdoch
<murdoch.duncan at gmail.com> wrote:
> On 11-09-22 8:30 AM, Nick Sabbe wrote:
>>
>> Hi Duncan (and others).
>>
>> I've just turned off my virus scanner (MS Forefront Endpoint Protection).
>>
>> The issue persists. It appears that the first time I call R CMD check, it
>> deletes the previous rcheck folder, but tries to proceed before it is
>> actually gone. By the time I reissue the command, the folder is truly
>> gone,
>> and the R CMD check can safely do its work.
>>
>> Is anyone else here using Win7 (32bit) and successfully building/checking
>> R
>> packages? Perhaps I'm the only one who has treaded this path :-)
>
> I do use Win7 on one machine, and have seen odd things happen, but not what
> you describe.
>
> I imagine a simple workaround for you would be to delete the folder before
> you call R CMD check (i.e. wrap R CMD check in a batch file to do that), but
> it would be nice if that were not necessary.
>
> Duncan Murdoch
>
>>
>>
>> Nick Sabbe
>> --
>> ping: nick.sabbe at ugent.be
>> link: http://biomath.ugent.be
>> wink: A1.056, Coupure Links 653, 9000 Gent
>> ring: 09/264.59.36
>>
>> -- Do Not Disapprove
>>
>>
>>
>>
>>> -----Original Message-----
>>> From: Duncan Murdoch [mailto:murdoch.duncan at gmail.com]
>>> Sent: donderdag 22 september 2011 14:20
>>> To: Nick Sabbe
>>> Cc: r-devel at r-project.org
>>> Subject: Re: [Rd] R CMD check file issues
>>>
>>> On 11-09-22 7:53 AM, Nick Sabbe wrote:
>>>>
>>>> This problem is likely to be specific to Windows, and particularly
>>>
>>> Win7.
>>>
>>> The symptoms sound like interference from an anti-virus checker.
>>>
>>> Duncan Murdoch
>>>
>>>>
>>>>
>>>> After a successful build of a package (R CMD build addendum), I
>>>
>>> immediately
>>>>
>>>> run an R CMD check for the same package.
>>>>
>>>> Not always, but _very_ often, I get the following error:
>>>>
>>>> C:\Users\nisabbe\Documents\@Doctoraat\R>R CMD check addendum
>>>>
>>>> Loading required package: tcltk
>>>>
>>>> Loading Tcl/Tk interface ... done
>>>>
>>>> Loading required package: Hmisc
>>>>
>>>> Loading required package: survival
>>>>
>>>> Loading required package: stats
>>>>
>>>> Loading required package: graphics
>>>>
>>>> Loading required package: splines
>>>>
>>>>
>>>>
>>>> Attaching package: 'Hmisc'
>>>>
>>>>
>>>>
>>>> The following object(s) are masked from 'package:survival':
>>>>
>>>>
>>>>
>>>> ? ? ?untangle.specials
>>>>
>>>>
>>>>
>>>> The following object(s) are masked from 'package:base':
>>>>
>>>>
>>>>
>>>> ? ? ?format.pval, round.POSIXt, trunc.POSIXt, units
>>>>
>>>>
>>>>
>>>> Loading required package: R2HTML
>>>>
>>>> Warning in file(filename, "wt") :
>>>>
>>>> ? ?cannot open file
>>>> 'C:/Users/nisabbe/Documents/@Doctoraat/R/addendum.Rcheck/00ch
>>>>
>>>> eck.log': Permission denied
>>>>
>>>> Error in file(filename, "wt") : cannot open the connection
>>>>
>>>> Execution halted
>>>>
>>>>
>>>>
>>>> If, after this, I immediately reissue the R CMD check command, it
>>>
>>> works,
>>>>
>>>> without the error.
>>>>
>>>> I think this has something to do with how Win7 processes file
>>>
>>> handling
>>>>
>>>> (there are known issues even noticeable in windows explorer), but
>>>
>>> perhaps
>>>>
>>>> there is a way of circumventing this? It would be greatly
>>>
>>> appreciated, as
>>>>
>>>> this issue is preventing automation of build/check/install scripts.
>>>>
>>>>
>>>>
>>>> Suggestions will be greatly appreciated.
>>>>
>>>>
>>>>
>>>> Nick Sabbe
>>>>
>>>> --
>>>>
>>>> ping: nick.sabbe at ugent.be
>>>>
>>>> link:<http://biomath.ugent.be/> ? http://biomath.ugent.be
>>>>
>>>> wink: A1.056, Coupure Links 653, 9000 Gent
>>>>
>>>> ring: 09/264.59.36
>>>>
>>>>
>>>>
>>>> -- Do Not Disapprove
>>>>
>>>>
>>>>
>>>>
>>>> ? ? ? ?[[alternative HTML version deleted]]
>>>>
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From alireza.s.mahani at gmail.com  Thu Sep 22 20:08:40 2011
From: alireza.s.mahani at gmail.com (Alireza Mahani)
Date: Thu, 22 Sep 2011 11:08:40 -0700 (PDT)
Subject: [Rd] How to call an MPI-enabled program from R?
Message-ID: <1316714920320-3834332.post@n4.nabble.com>

Conceptually, how is it possible to call an MPI-parallelized code in C from
R? My experience with MPI so far indicates that one has to launch an
MPI-enabled binary using a command like

mpiexec -n <number of processes> <name of binary>

In other words, I'm not sure how to create an MPI 'library' and then call it
from a single-threaded application. In this sense, my question is perhaps
not strictly a R question but an MPI question. (Using a system call forces
one to use disk as intermediary between R and the MPI binary to pass data
between the two.)

I am also aware of packages such as Rmpi, but at this stage I want to be
able to understand the low-level capabilities rather than relying on an
abstraction layer.

Thank you,
Alireza


--
View this message in context: http://r.789695.n4.nabble.com/How-to-call-an-MPI-enabled-program-from-R-tp3834332p3834332.html
Sent from the R devel mailing list archive at Nabble.com.


From ripley at stats.ox.ac.uk  Thu Sep 22 22:04:04 2011
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 22 Sep 2011 21:04:04 +0100 (BST)
Subject: [Rd] R CMD check file issues
In-Reply-To: <CAFDcVCSaGSAL4jxvMWk2ftLAV-B3_Z2c9YhmrKvVB=TDzVeqQw@mail.gmail.com>
References: <4e7b2236.9a58df0a.3724.7ee5SMTPIN_ADDED@mx.google.com>
	<4E7B27FE.6050804@gmail.com>
	<4e7b2a5a.d1c9e30a.0f61.ffffa3c8SMTPIN_ADDED@mx.google.com>
	<4E7B2AFF.8010904@gmail.com>
	<CAFDcVCSaGSAL4jxvMWk2ftLAV-B3_Z2c9YhmrKvVB=TDzVeqQw@mail.gmail.com>
Message-ID: <alpine.LFD.2.02.1109222102180.13324@gannet.stats.ox.ac.uk>

I do see this on Win7, and it is an antivirus issue (Sophos). 
Excluding the R check area solves it for me, as does an earlier 
delete.

I have considered adding a delay in check.R, but it is not clear how 
long it would need to be.

On Thu, 22 Sep 2011, Henrik Bengtsson wrote:

> I'm on Windows 7 (64-bit) and everything works perfectly.  Obviously,
> there is either another process locking down a file with the same name
> or the directory doesn't exist at the time of the file() call.
>
> Now to the most important question  ...what's your sessionInfo()?
>
> /Henrik
>
> On Thu, Sep 22, 2011 at 5:33 AM, Duncan Murdoch
> <murdoch.duncan at gmail.com> wrote:
>> On 11-09-22 8:30 AM, Nick Sabbe wrote:
>>>
>>> Hi Duncan (and others).
>>>
>>> I've just turned off my virus scanner (MS Forefront Endpoint Protection).
>>>
>>> The issue persists. It appears that the first time I call R CMD check, it
>>> deletes the previous rcheck folder, but tries to proceed before it is
>>> actually gone. By the time I reissue the command, the folder is truly
>>> gone,
>>> and the R CMD check can safely do its work.
>>>
>>> Is anyone else here using Win7 (32bit) and successfully building/checking
>>> R
>>> packages? Perhaps I'm the only one who has treaded this path :-)
>>
>> I do use Win7 on one machine, and have seen odd things happen, but not what
>> you describe.
>>
>> I imagine a simple workaround for you would be to delete the folder before
>> you call R CMD check (i.e. wrap R CMD check in a batch file to do that), but
>> it would be nice if that were not necessary.
>>
>> Duncan Murdoch
>>
>>>
>>>
>>> Nick Sabbe
>>> --
>>> ping: nick.sabbe at ugent.be
>>> link: http://biomath.ugent.be
>>> wink: A1.056, Coupure Links 653, 9000 Gent
>>> ring: 09/264.59.36
>>>
>>> -- Do Not Disapprove
>>>
>>>
>>>
>>>
>>>> -----Original Message-----
>>>> From: Duncan Murdoch [mailto:murdoch.duncan at gmail.com]
>>>> Sent: donderdag 22 september 2011 14:20
>>>> To: Nick Sabbe
>>>> Cc: r-devel at r-project.org
>>>> Subject: Re: [Rd] R CMD check file issues
>>>>
>>>> On 11-09-22 7:53 AM, Nick Sabbe wrote:
>>>>>
>>>>> This problem is likely to be specific to Windows, and particularly
>>>>
>>>> Win7.
>>>>
>>>> The symptoms sound like interference from an anti-virus checker.
>>>>
>>>> Duncan Murdoch
>>>>
>>>>>
>>>>>
>>>>> After a successful build of a package (R CMD build addendum), I
>>>>
>>>> immediately
>>>>>
>>>>> run an R CMD check for the same package.
>>>>>
>>>>> Not always, but _very_ often, I get the following error:
>>>>>
>>>>> C:\Users\nisabbe\Documents\@Doctoraat\R>R CMD check addendum
>>>>>
>>>>> Loading required package: tcltk
>>>>>
>>>>> Loading Tcl/Tk interface ... done
>>>>>
>>>>> Loading required package: Hmisc
>>>>>
>>>>> Loading required package: survival
>>>>>
>>>>> Loading required package: stats
>>>>>
>>>>> Loading required package: graphics
>>>>>
>>>>> Loading required package: splines
>>>>>
>>>>>
>>>>>
>>>>> Attaching package: 'Hmisc'
>>>>>
>>>>>
>>>>>
>>>>> The following object(s) are masked from 'package:survival':
>>>>>
>>>>>
>>>>>
>>>>> ? ? ?untangle.specials
>>>>>
>>>>>
>>>>>
>>>>> The following object(s) are masked from 'package:base':
>>>>>
>>>>>
>>>>>
>>>>> ? ? ?format.pval, round.POSIXt, trunc.POSIXt, units
>>>>>
>>>>>
>>>>>
>>>>> Loading required package: R2HTML
>>>>>
>>>>> Warning in file(filename, "wt") :
>>>>>
>>>>> ? ?cannot open file
>>>>> 'C:/Users/nisabbe/Documents/@Doctoraat/R/addendum.Rcheck/00ch
>>>>>
>>>>> eck.log': Permission denied
>>>>>
>>>>> Error in file(filename, "wt") : cannot open the connection
>>>>>
>>>>> Execution halted
>>>>>
>>>>>
>>>>>
>>>>> If, after this, I immediately reissue the R CMD check command, it
>>>>
>>>> works,
>>>>>
>>>>> without the error.
>>>>>
>>>>> I think this has something to do with how Win7 processes file
>>>>
>>>> handling
>>>>>
>>>>> (there are known issues even noticeable in windows explorer), but
>>>>
>>>> perhaps
>>>>>
>>>>> there is a way of circumventing this? It would be greatly
>>>>
>>>> appreciated, as
>>>>>
>>>>> this issue is preventing automation of build/check/install scripts.
>>>>>
>>>>>
>>>>>
>>>>> Suggestions will be greatly appreciated.
>>>>>
>>>>>
>>>>>
>>>>> Nick Sabbe
>>>>>
>>>>> --
>>>>>
>>>>> ping: nick.sabbe at ugent.be
>>>>>
>>>>> link:<http://biomath.ugent.be/> ? http://biomath.ugent.be
>>>>>
>>>>> wink: A1.056, Coupure Links 653, 9000 Gent
>>>>>
>>>>> ring: 09/264.59.36
>>>>>
>>>>>
>>>>>
>>>>> -- Do Not Disapprove
>>>>>
>>>>>
>>>>>
>>>>>
>>>>> ? ? ? ?[[alternative HTML version deleted]]
>>>>>
>>>>> ______________________________________________
>>>>> R-devel at r-project.org mailing list
>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>>
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From D.Strbenac at garvan.org.au  Fri Sep 23 02:00:24 2011
From: D.Strbenac at garvan.org.au (Dario Strbenac)
Date: Fri, 23 Sep 2011 10:00:24 +1000 (EST)
Subject: [Rd] R-2.13.2 beta build for Windows
Message-ID: <20110923100024.BMZ16327@gimr.garvan.unsw.edu.au>

Hello,

I've had a look at a number of CRAN servers and all of them give a similar error, like :

Not Found
The requested URL /bin/windows/base/R-2.13.2beta-win.exe was not found on this server.

Additionally, a 404 Not Found error was encountered while trying to use an ErrorDocument to handle the request.

--------------------------------------
Dario Strbenac
Research Assistant
Cancer Epigenetics
Garvan Institute of Medical Research
Darlinghurst NSW 2010
Australia


From murdoch.duncan at gmail.com  Fri Sep 23 03:20:49 2011
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Thu, 22 Sep 2011 21:20:49 -0400
Subject: [Rd] R-2.13.2 beta build for Windows
In-Reply-To: <20110923100024.BMZ16327@gimr.garvan.unsw.edu.au>
References: <20110923100024.BMZ16327@gimr.garvan.unsw.edu.au>
Message-ID: <4E7BDEF1.30003@gmail.com>

On 11-09-22 8:00 PM, Dario Strbenac wrote:
> Hello,
>
> I've had a look at a number of CRAN servers and all of them give a similar error, like :
>
> Not Found
> The requested URL /bin/windows/base/R-2.13.2beta-win.exe was not found on this server.
>
> Additionally, a 404 Not Found error was encountered while trying to use an ErrorDocument to handle the request.

Thank you.  We changed the scripts over the summer, and the new one 
still had an error in it.  Things should be fixed soon.

Duncan Murdoch


From johannes.egner at gmail.com  Fri Sep 23 13:46:56 2011
From: johannes.egner at gmail.com (Johannes Egner)
Date: Fri, 23 Sep 2011 12:46:56 +0100
Subject: [Rd] Building R on Windows 7 -- No rule to make target
 `etc/GETDESC', needed by `fixetc'.
Message-ID: <CALp0smn2=OphPTuHozm3o+QHzzW7qk=boS7z0xRpP1NcEUMD2w@mail.gmail.com>

Hi all,

I have been experiencing difficulties building R (be this 2.13.1,
beta, devel, or rc) on Windows 7 64bit.

I believe I am following the manual religiously, and don't think I am
doing anything differently from the many successful build attempts in
the past. Unzipping the tarball works fine, but when I invoke make, I
get (shown for R-rc, same for 2-13.1):

H:\R_Builds\R-rc\src\gnuwin32>make all recommended
cat MkRules.dist MkRules.rules > MkRules
-------- Building ../../../library/base/R/Rprofile from
../../library/profile/Common.R
../../library/profile/Rprofile.windows--------
mkdir -p ../../../library/base/R
cp -p html/rwin.html ../../../doc/html/index.html
make[3]: *** No rule to make target `etc/GETDESC', needed by `fixetc'.  Stop.
make[2]: *** [fixfiles] Error 2
make[1]: *** [rbuild] Error 2
make: *** [all] Error 2

Any help?
Thanks, Jo


From ligges at statistik.tu-dortmund.de  Fri Sep 23 15:35:59 2011
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Fri, 23 Sep 2011 15:35:59 +0200
Subject: [Rd] Building R on Windows 7 -- No rule to make target
 `etc/GETDESC', needed by `fixetc'.
In-Reply-To: <CALp0smn2=OphPTuHozm3o+QHzzW7qk=boS7z0xRpP1NcEUMD2w@mail.gmail.com>
References: <CALp0smn2=OphPTuHozm3o+QHzzW7qk=boS7z0xRpP1NcEUMD2w@mail.gmail.com>
Message-ID: <4E7C8B3F.8090104@statistik.tu-dortmund.de>

Fine for me with R-2.13.2 RC. No idea where you got the differences 
from. Perhaps reinstall recent version of the Rtools, check the PATH, 
make sure this is a clean checkout / directory and try again.

Uwe ligges



On 23.09.2011 13:46, Johannes Egner wrote:
> Hi all,
>
> I have been experiencing difficulties building R (be this 2.13.1,
> beta, devel, or rc) on Windows 7 64bit.
>
> I believe I am following the manual religiously, and don't think I am
> doing anything differently from the many successful build attempts in
> the past. Unzipping the tarball works fine, but when I invoke make, I
> get (shown for R-rc, same for 2-13.1):
>
> H:\R_Builds\R-rc\src\gnuwin32>make all recommended
> cat MkRules.dist MkRules.rules>  MkRules
> -------- Building ../../../library/base/R/Rprofile from
> ../../library/profile/Common.R
> ../../library/profile/Rprofile.windows--------
> mkdir -p ../../../library/base/R
> cp -p html/rwin.html ../../../doc/html/index.html
> make[3]: *** No rule to make target `etc/GETDESC', needed by `fixetc'.  Stop.
> make[2]: *** [fixfiles] Error 2
> make[1]: *** [rbuild] Error 2
> make: *** [all] Error 2
>
> Any help?
> Thanks, Jo
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From jon.clayden at gmail.com  Fri Sep 23 15:58:32 2011
From: jon.clayden at gmail.com (Jon Clayden)
Date: Fri, 23 Sep 2011 14:58:32 +0100
Subject: [Rd] Issue with seek() on gzipped connections in R-devel
Message-ID: <CAM9CR=0kgvt987jMPU3_N17CLH1aBn1RMi09WES8Z7LSRRYVTg@mail.gmail.com>

Dear all,

In R-devel (2011-09-23 r57050), I'm running into a serious problem
with seek()ing on connections opened with gzfile(). A warning is
generated and the file position does not seek to the requested
location. It doesn't seem to occur all the time - I tried to create a
small example file to illustrate it, but the problem didn't occur.
However, it can be seen with a file I use for testing my packages,
which is available through the URL
<https://github.com/jonclayden/tractor/blob/master/tests/data/nifti/maskedb0_lia.nii.gz?raw=true>:

> con <- gzfile("~/Downloads/maskedb0_lia.nii.gz","rb")
> seek(con, 352)
[1] 0
Warning message:
In seek.connection(con, 352) :
  seek on a gzfile connection returned an internal error
> seek(con, NA)
[1] 190

The same commands with the same file work as expected in R 2.13.1, and
have worked over many previous versions of R.

> con <- gzfile("~/Downloads/maskedb0_lia.nii.gz","rb")
> seek(con, 352)
[1] 0
> seek(con, NA)
[1] 352

My sessionInfo() output is:

R Under development (unstable) (2011-09-23 r57050)
Platform: x86_64-apple-darwin11.1.0 (64-bit)

locale:
[1] en_GB.UTF-8/en_US.UTF-8/en_GB.UTF-8/C/en_GB.UTF-8/en_GB.UTF-8

attached base packages:
[1] splines   stats     graphics  grDevices utils     datasets  methods
[8] base

other attached packages:
[1] tractor.nt_2.0.1      tractor.session_2.0.3 tractor.utils_2.0.0
[4] tractor.base_2.0.3    reportr_0.2.0

This seems to occur whether or not R is compiled with
"--with-system-zlib". I see some zlib-related changes mentioned in the
NEWS, but I don't see any indication that this is expected. Could
anyone shed any light on it, please?

Thanks and all the best,
Jon


From ripley at stats.ox.ac.uk  Fri Sep 23 17:28:40 2011
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 23 Sep 2011 16:28:40 +0100 (BST)
Subject: [Rd] Issue with seek() on gzipped connections in R-devel
In-Reply-To: <CAM9CR=0kgvt987jMPU3_N17CLH1aBn1RMi09WES8Z7LSRRYVTg@mail.gmail.com>
References: <CAM9CR=0kgvt987jMPU3_N17CLH1aBn1RMi09WES8Z7LSRRYVTg@mail.gmail.com>
Message-ID: <alpine.LFD.2.02.1109231626390.4985@gannet.stats.ox.ac.uk>

Basically seek with zlib is flaky: we've stumbled on several errors. 
If it worked for you in the past, count yourself lucky.  I'd suggest 
you avoid relying on it in your packages.

On Fri, 23 Sep 2011, Jon Clayden wrote:

> Dear all,
>
> In R-devel (2011-09-23 r57050), I'm running into a serious problem
> with seek()ing on connections opened with gzfile(). A warning is
> generated and the file position does not seek to the requested
> location. It doesn't seem to occur all the time - I tried to create a
> small example file to illustrate it, but the problem didn't occur.
> However, it can be seen with a file I use for testing my packages,
> which is available through the URL
> <https://github.com/jonclayden/tractor/blob/master/tests/data/nifti/maskedb0_lia.nii.gz?raw=true>:
>
>> con <- gzfile("~/Downloads/maskedb0_lia.nii.gz","rb")
>> seek(con, 352)
> [1] 0
> Warning message:
> In seek.connection(con, 352) :
>  seek on a gzfile connection returned an internal error
>> seek(con, NA)
> [1] 190
>
> The same commands with the same file work as expected in R 2.13.1, and
> have worked over many previous versions of R.
>
>> con <- gzfile("~/Downloads/maskedb0_lia.nii.gz","rb")
>> seek(con, 352)
> [1] 0
>> seek(con, NA)
> [1] 352
>
> My sessionInfo() output is:
>
> R Under development (unstable) (2011-09-23 r57050)
> Platform: x86_64-apple-darwin11.1.0 (64-bit)
>
> locale:
> [1] en_GB.UTF-8/en_US.UTF-8/en_GB.UTF-8/C/en_GB.UTF-8/en_GB.UTF-8
>
> attached base packages:
> [1] splines   stats     graphics  grDevices utils     datasets  methods
> [8] base
>
> other attached packages:
> [1] tractor.nt_2.0.1      tractor.session_2.0.3 tractor.utils_2.0.0
> [4] tractor.base_2.0.3    reportr_0.2.0
>
> This seems to occur whether or not R is compiled with
> "--with-system-zlib". I see some zlib-related changes mentioned in the
> NEWS, but I don't see any indication that this is expected. Could
> anyone shed any light on it, please?
>
> Thanks and all the best,
> Jon
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From wdunlap at tibco.com  Fri Sep 23 17:49:43 2011
From: wdunlap at tibco.com (William Dunlap)
Date: Fri, 23 Sep 2011 15:49:43 +0000
Subject: [Rd] should dir(all=TRUE) return "." and ".."?
Message-ID: <E66794E69CFDE04D9A70842786030B93074E30@PA-MBX04.na.tibco.com>

dir(all=TRUE) returns the file names "." and ".."
while dir(recursive=TRUE, all=TRUE, include.dirs=TRUE)
does not.  I always filter out the "." and ".." entries
and was wondering if anyone would mind if dir(all=TRUE)
just omitted them?  It might make recursive file operations
like cleaning out a directory safer, as
  unlink(recursive=TRUE, dir(all=TRUE, "dirToClean"))
might start attacking dirToClean/.., then dirToClean/../..,
etc., until your disk is empty.

  > dir.create(tdir <- tempfile("tdir"))
  > file.create(file.path(tdir, c(".dotFile", "noDotFile")))
  [1] TRUE TRUE
  > dir.create(file.path(tdir, ".dotDir"))
  > file.create(file.path(tdir, ".dotDir", c("noDotFileInDotDir", ".dotFileInDotDir")))
  [1] TRUE TRUE
  > dir(tdir, all=TRUE) # omit "." and ".." here?
  [1] "."         ".."        ".dotDir"   ".dotFile" 
  [5] "noDotFile"
  > dir(tdir, all=TRUE, recursive=TRUE, include.dirs=TRUE)
  [1] ".dotDir"                   ".dotDir/.dotFileInDotDir" 
  [3] ".dotDir/noDotFileInDotDir" ".dotFile"                 
  [5] "noDotFile"                

Bill Dunlap
Spotfire, TIBCO Software
wdunlap tibco.com 


From jeffrey.ryan at lemnica.com  Fri Sep 23 17:54:07 2011
From: jeffrey.ryan at lemnica.com (Jeffrey Ryan)
Date: Fri, 23 Sep 2011 10:54:07 -0500
Subject: [Rd] Issue with seek() on gzipped connections in R-devel
In-Reply-To: <CAM9CR=0kgvt987jMPU3_N17CLH1aBn1RMi09WES8Z7LSRRYVTg@mail.gmail.com>
References: <CAM9CR=0kgvt987jMPU3_N17CLH1aBn1RMi09WES8Z7LSRRYVTg@mail.gmail.com>
Message-ID: <CABDUZc-hG9DAv8T+FNn0y8n8L1Z0=n5QqWkoHO594t96Q3m5FA@mail.gmail.com>

seek() in general is a bad idea IMO if you are writing cross-platform code.

?seek

Warning:

     Use of ?seek? on Windows is discouraged.  We have found so many
     errors in the Windows implementation of file positioning that
     users are advised to use it only at their own risk, and asked not
     to waste the R developers' time with bug reports on Windows'
     deficiencies.

Aside from making me laugh, the above highlights the core reason to not use IMO.

For not zipped files, you can try the mmap package.  ?mmap and ?types
are good starting points.  Allows for accessing binary data on disk
with very simple R-like semantics, and is very fast.  Not as fast as a
sequential read... but fast.  At present this is 'little endian' only
though, but that describes most of the world today.

Best,
Jeff

On Fri, Sep 23, 2011 at 8:58 AM, Jon Clayden <jon.clayden at gmail.com> wrote:
> Dear all,
>
> In R-devel (2011-09-23 r57050), I'm running into a serious problem
> with seek()ing on connections opened with gzfile(). A warning is
> generated and the file position does not seek to the requested
> location. It doesn't seem to occur all the time - I tried to create a
> small example file to illustrate it, but the problem didn't occur.
> However, it can be seen with a file I use for testing my packages,
> which is available through the URL
> <https://github.com/jonclayden/tractor/blob/master/tests/data/nifti/maskedb0_lia.nii.gz?raw=true>:
>
>> con <- gzfile("~/Downloads/maskedb0_lia.nii.gz","rb")
>> seek(con, 352)
> [1] 0
> Warning message:
> In seek.connection(con, 352) :
> ?seek on a gzfile connection returned an internal error
>> seek(con, NA)
> [1] 190
>
> The same commands with the same file work as expected in R 2.13.1, and
> have worked over many previous versions of R.
>
>> con <- gzfile("~/Downloads/maskedb0_lia.nii.gz","rb")
>> seek(con, 352)
> [1] 0
>> seek(con, NA)
> [1] 352
>
> My sessionInfo() output is:
>
> R Under development (unstable) (2011-09-23 r57050)
> Platform: x86_64-apple-darwin11.1.0 (64-bit)
>
> locale:
> [1] en_GB.UTF-8/en_US.UTF-8/en_GB.UTF-8/C/en_GB.UTF-8/en_GB.UTF-8
>
> attached base packages:
> [1] splines ? stats ? ? graphics ?grDevices utils ? ? datasets ?methods
> [8] base
>
> other attached packages:
> [1] tractor.nt_2.0.1 ? ? ?tractor.session_2.0.3 tractor.utils_2.0.0
> [4] tractor.base_2.0.3 ? ?reportr_0.2.0
>
> This seems to occur whether or not R is compiled with
> "--with-system-zlib". I see some zlib-related changes mentioned in the
> NEWS, but I don't see any indication that this is expected. Could
> anyone shed any light on it, please?
>
> Thanks and all the best,
> Jon
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>



-- 
Jeffrey Ryan
jeffrey.ryan at lemnica.com

www.lemnica.com
www.esotericR.com


From jon.clayden at gmail.com  Fri Sep 23 18:13:36 2011
From: jon.clayden at gmail.com (Jon Clayden)
Date: Fri, 23 Sep 2011 17:13:36 +0100
Subject: [Rd] Issue with seek() on gzipped connections in R-devel
In-Reply-To: <CABDUZc-hG9DAv8T+FNn0y8n8L1Z0=n5QqWkoHO594t96Q3m5FA@mail.gmail.com>
References: <CAM9CR=0kgvt987jMPU3_N17CLH1aBn1RMi09WES8Z7LSRRYVTg@mail.gmail.com>
	<CABDUZc-hG9DAv8T+FNn0y8n8L1Z0=n5QqWkoHO594t96Q3m5FA@mail.gmail.com>
Message-ID: <CAM9CR=3NLeWXOGqch5Xn++F-oyjbo29E49638h0m3J2YFB4mig@mail.gmail.com>

Thanks for the replies. I take the point, although it does seem like a
substantial regression (on non-Windows platforms).

I like to keep the external dependencies of my packages minimal, but I
will look into the mmap package - thanks, Jeff, for the tip.

Aside from that, though, what is the alternative to using seek? If I
want to read something at (original, uncompressed) byte offset 352, as
here, do I have to read and discard everything that comes before it
first? That seems inelegant at best...

Regards,
Jon


On 23 September 2011 16:54, Jeffrey Ryan <jeffrey.ryan at lemnica.com> wrote:
> seek() in general is a bad idea IMO if you are writing cross-platform code.
>
> ?seek
>
> Warning:
>
> ? ? Use of ?seek? on Windows is discouraged. ?We have found so many
> ? ? errors in the Windows implementation of file positioning that
> ? ? users are advised to use it only at their own risk, and asked not
> ? ? to waste the R developers' time with bug reports on Windows'
> ? ? deficiencies.
>
> Aside from making me laugh, the above highlights the core reason to not use IMO.
>
> For not zipped files, you can try the mmap package. ??mmap and ?types
> are good starting points. ?Allows for accessing binary data on disk
> with very simple R-like semantics, and is very fast. ?Not as fast as a
> sequential read... but fast. ?At present this is 'little endian' only
> though, but that describes most of the world today.
>
> Best,
> Jeff
>
> On Fri, Sep 23, 2011 at 8:58 AM, Jon Clayden <jon.clayden at gmail.com> wrote:
>> Dear all,
>>
>> In R-devel (2011-09-23 r57050), I'm running into a serious problem
>> with seek()ing on connections opened with gzfile(). A warning is
>> generated and the file position does not seek to the requested
>> location. It doesn't seem to occur all the time - I tried to create a
>> small example file to illustrate it, but the problem didn't occur.
>> However, it can be seen with a file I use for testing my packages,
>> which is available through the URL
>> <https://github.com/jonclayden/tractor/blob/master/tests/data/nifti/maskedb0_lia.nii.gz?raw=true>:
>>
>>> con <- gzfile("~/Downloads/maskedb0_lia.nii.gz","rb")
>>> seek(con, 352)
>> [1] 0
>> Warning message:
>> In seek.connection(con, 352) :
>> ?seek on a gzfile connection returned an internal error
>>> seek(con, NA)
>> [1] 190
>>
>> The same commands with the same file work as expected in R 2.13.1, and
>> have worked over many previous versions of R.
>>
>>> con <- gzfile("~/Downloads/maskedb0_lia.nii.gz","rb")
>>> seek(con, 352)
>> [1] 0
>>> seek(con, NA)
>> [1] 352
>>
>> My sessionInfo() output is:
>>
>> R Under development (unstable) (2011-09-23 r57050)
>> Platform: x86_64-apple-darwin11.1.0 (64-bit)
>>
>> locale:
>> [1] en_GB.UTF-8/en_US.UTF-8/en_GB.UTF-8/C/en_GB.UTF-8/en_GB.UTF-8
>>
>> attached base packages:
>> [1] splines ? stats ? ? graphics ?grDevices utils ? ? datasets ?methods
>> [8] base
>>
>> other attached packages:
>> [1] tractor.nt_2.0.1 ? ? ?tractor.session_2.0.3 tractor.utils_2.0.0
>> [4] tractor.base_2.0.3 ? ?reportr_0.2.0
>>
>> This seems to occur whether or not R is compiled with
>> "--with-system-zlib". I see some zlib-related changes mentioned in the
>> NEWS, but I don't see any indication that this is expected. Could
>> anyone shed any light on it, please?
>>
>> Thanks and all the best,
>> Jon
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
>
>
> --
> Jeffrey Ryan
> jeffrey.ryan at lemnica.com
>
> www.lemnica.com
> www.esotericR.com
>


From jeffrey.ryan at lemnica.com  Fri Sep 23 18:40:27 2011
From: jeffrey.ryan at lemnica.com (Jeffrey Ryan)
Date: Fri, 23 Sep 2011 11:40:27 -0500
Subject: [Rd] Issue with seek() on gzipped connections in R-devel
In-Reply-To: <CAM9CR=3NLeWXOGqch5Xn++F-oyjbo29E49638h0m3J2YFB4mig@mail.gmail.com>
References: <CAM9CR=0kgvt987jMPU3_N17CLH1aBn1RMi09WES8Z7LSRRYVTg@mail.gmail.com>
	<CABDUZc-hG9DAv8T+FNn0y8n8L1Z0=n5QqWkoHO594t96Q3m5FA@mail.gmail.com>
	<CAM9CR=3NLeWXOGqch5Xn++F-oyjbo29E49638h0m3J2YFB4mig@mail.gmail.com>
Message-ID: <CABDUZc9k399NU8d9eCf0Pyw+xfgkJS310yhcfxTMd8eBzJiLGw@mail.gmail.com>

Yes, inelegant would be a good description.  Sadly a fact we have to
put up with I guess.

FWIW, I too don't like dependencies.  mmap has none, and is cross
platform, but I get the idea.

Good luck,
Jeff

On Fri, Sep 23, 2011 at 11:13 AM, Jon Clayden <jon.clayden at gmail.com> wrote:
> Thanks for the replies. I take the point, although it does seem like a
> substantial regression (on non-Windows platforms).
>
> I like to keep the external dependencies of my packages minimal, but I
> will look into the mmap package - thanks, Jeff, for the tip.
>
> Aside from that, though, what is the alternative to using seek? If I
> want to read something at (original, uncompressed) byte offset 352, as
> here, do I have to read and discard everything that comes before it
> first? That seems inelegant at best...
>
> Regards,
> Jon
>
>
> On 23 September 2011 16:54, Jeffrey Ryan <jeffrey.ryan at lemnica.com> wrote:
>> seek() in general is a bad idea IMO if you are writing cross-platform code.
>>
>> ?seek
>>
>> Warning:
>>
>> ? ? Use of ?seek? on Windows is discouraged. ?We have found so many
>> ? ? errors in the Windows implementation of file positioning that
>> ? ? users are advised to use it only at their own risk, and asked not
>> ? ? to waste the R developers' time with bug reports on Windows'
>> ? ? deficiencies.
>>
>> Aside from making me laugh, the above highlights the core reason to not use IMO.
>>
>> For not zipped files, you can try the mmap package. ??mmap and ?types
>> are good starting points. ?Allows for accessing binary data on disk
>> with very simple R-like semantics, and is very fast. ?Not as fast as a
>> sequential read... but fast. ?At present this is 'little endian' only
>> though, but that describes most of the world today.
>>
>> Best,
>> Jeff
>>
>> On Fri, Sep 23, 2011 at 8:58 AM, Jon Clayden <jon.clayden at gmail.com> wrote:
>>> Dear all,
>>>
>>> In R-devel (2011-09-23 r57050), I'm running into a serious problem
>>> with seek()ing on connections opened with gzfile(). A warning is
>>> generated and the file position does not seek to the requested
>>> location. It doesn't seem to occur all the time - I tried to create a
>>> small example file to illustrate it, but the problem didn't occur.
>>> However, it can be seen with a file I use for testing my packages,
>>> which is available through the URL
>>> <https://github.com/jonclayden/tractor/blob/master/tests/data/nifti/maskedb0_lia.nii.gz?raw=true>:
>>>
>>>> con <- gzfile("~/Downloads/maskedb0_lia.nii.gz","rb")
>>>> seek(con, 352)
>>> [1] 0
>>> Warning message:
>>> In seek.connection(con, 352) :
>>> ?seek on a gzfile connection returned an internal error
>>>> seek(con, NA)
>>> [1] 190
>>>
>>> The same commands with the same file work as expected in R 2.13.1, and
>>> have worked over many previous versions of R.
>>>
>>>> con <- gzfile("~/Downloads/maskedb0_lia.nii.gz","rb")
>>>> seek(con, 352)
>>> [1] 0
>>>> seek(con, NA)
>>> [1] 352
>>>
>>> My sessionInfo() output is:
>>>
>>> R Under development (unstable) (2011-09-23 r57050)
>>> Platform: x86_64-apple-darwin11.1.0 (64-bit)
>>>
>>> locale:
>>> [1] en_GB.UTF-8/en_US.UTF-8/en_GB.UTF-8/C/en_GB.UTF-8/en_GB.UTF-8
>>>
>>> attached base packages:
>>> [1] splines ? stats ? ? graphics ?grDevices utils ? ? datasets ?methods
>>> [8] base
>>>
>>> other attached packages:
>>> [1] tractor.nt_2.0.1 ? ? ?tractor.session_2.0.3 tractor.utils_2.0.0
>>> [4] tractor.base_2.0.3 ? ?reportr_0.2.0
>>>
>>> This seems to occur whether or not R is compiled with
>>> "--with-system-zlib". I see some zlib-related changes mentioned in the
>>> NEWS, but I don't see any indication that this is expected. Could
>>> anyone shed any light on it, please?
>>>
>>> Thanks and all the best,
>>> Jon
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>
>>
>>
>> --
>> Jeffrey Ryan
>> jeffrey.ryan at lemnica.com
>>
>> www.lemnica.com
>> www.esotericR.com
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>



-- 
Jeffrey Ryan
jeffrey.ryan at lemnica.com

www.lemnica.com
www.esotericR.com


From moshersteven at gmail.com  Fri Sep 23 18:57:45 2011
From: moshersteven at gmail.com (steven mosher)
Date: Fri, 23 Sep 2011 09:57:45 -0700
Subject: [Rd] "could not find function" after import
In-Reply-To: <4E77D9C3.1070307@gmail.com>
References: <4E77AA8D.2040409@u.washington.edu> <4E77D9C3.1070307@gmail.com>
Message-ID: <CAFFLneR_tuCSx0GG9jZBz4oF9ysnVTz5Ut8P6gQ_LW2aNcXNmA@mail.gmail.com>

Duncan

I have a related question.

I need one function from R.utils.  But R.utils depends on R.oo and  R.methodsS3.
so I made R.util an import and then used importFrom() in the namespace.

The package passed the  "check".  However when it came to use the function
it had not been loaded? do I need to add the upstream packages that
R.util  depends
upon?  also in the code do I need a library or require?

A bit confused

Steve

On Mon, Sep 19, 2011 at 5:09 PM, Duncan Murdoch
<murdoch.duncan at gmail.com> wrote:
> On 11-09-19 4:48 PM, Stephanie M. Gogarten wrote:
>>
>> I am trying to build a package (GWASTools, submitted to Bioconductor)
>> that uses the "sandwich" package. ?I have references to "sandwich" in
>> DESCRIPTION:
>> Imports: methods, DBI, RSQLite, sandwich, survival, DNAcopy
>>
>> and NAMESPACE:
>> import(sandwich)
>>
>> In the code itself is a call to vcovHC:
>> Vhat<- vcovHC(mod, type="HC0")
>>
>> I have sandwich version 2.2-7 installed.
>>
>> When I run R CMD check on my package, I get the following error during
>> checking of examples:
>> * using R Under development (unstable) (2011-08-29 r56828)
>> * using platform: x86_64-apple-darwin9.8.0 (64-bit)
>> ...
>> * checking examples ... ERROR
>> ...
>> Error in estfun.glm(x) : could not find function "is.zoo"
>> Calls: assocTestRegression ... meatHC -> ?rowMeans -> ?is.data.frame ->
>> estfun -> ?estfun.glm
>>
>> I import sandwich, sandwich depends on zoo, but a function in zoo cannot
>> be found during execution.
>>
>> I tried to get around this by explicitly including a "require" statement
>> in assocTestRegression:
>> require(sandwich)
>>
>> The example now runs, but I have a warning in R CMD check:
>> * checking for unstated dependencies in R code ... WARNING
>> ?library? or ?require? call not declared from: ?sandwich?
>>
>> I am not sure why this is a problem, as there is a "require" statement
>> (for a different package) in another function which does not cause any
>> warnings.
>>
>> Can anyone advise on how to get my package to successfully pass R CMD
>> check?
>>
>
> If you said that your package Depends on sandwich, you'd probably pass
> checks, but this is arguably a bug in the sandwich package.
>
> The problem is that since you only import sandwich, it never gets attached.
> ?So it never attaches its dependency zoo. ? It should import zoo (or import
> the functions in zoo that it uses) to work properly the way you are calling
> it.
>
> You can see the same error as follows:
>
> 1. ?Install sandwich, but don't attach it or zoo.
>
> 2. ?Run
>
> example(glm)
>
> to create the "glm" object glm.D93.
>
> Try to call
>
> sandwich::estfun(glm.D93)
>
> You'll get the same error as before because is.zoo() will not be loaded.
>
> It's also arguably a design flaw in R. ?For testing sandwich, zoo would
> generally end up being attached, because the testing of sandwich would
> attach it. ?However, examples like the one above are never tested.
>
> Duncan Murdoch
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From maechler at stat.math.ethz.ch  Fri Sep 23 18:59:33 2011
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Fri, 23 Sep 2011 18:59:33 +0200
Subject: [Rd] should dir(all=TRUE) return "." and ".."?
In-Reply-To: <E66794E69CFDE04D9A70842786030B93074E30@PA-MBX04.na.tibco.com>
References: <E66794E69CFDE04D9A70842786030B93074E30@PA-MBX04.na.tibco.com>
Message-ID: <20092.47861.165002.499347@stat.math.ethz.ch>

>>>>> William Dunlap <wdunlap at tibco.com>
>>>>>     on Fri, 23 Sep 2011 15:49:43 +0000 writes:

    > dir(all=TRUE) returns the file names "." and ".."  while
    > dir(recursive=TRUE, all=TRUE, include.dirs=TRUE) does not.
    > I always filter out the "." and ".." entries and was
    > wondering if anyone would mind if dir(all=TRUE) just
    > omitted them?  It might make recursive file operations
    > like cleaning out a directory safer, as
    > unlink(recursive=TRUE, dir(all=TRUE, "dirToClean")) might
    > start attacking dirToClean/.., then dirToClean/../..,
    > etc., until your disk is empty.

 :-)

Thank you, Bill.
I agree that there is a problem.  It seems wrong to me that 

   dir(all.files=TRUE, recursive=TRUE, include.dirs=TRUE)

*omits* the (symbolic) directories  '.' and '..'  when simple

   dir(all.files=TRUE)

includes them.

However, from a strict description (of the argument names, and
also the help file) I would have expected that both would *include* 
rather than omit them.
But then --the scenario abov, and also more general
reasoning -- would rather suggest to follow your proposal.

Martin


    >> dir.create(tdir <- tempfile("tdir"))
    >> file.create(file.path(tdir, c(".dotFile", "noDotFile")))
    >   [1] TRUE TRUE
    >> dir.create(file.path(tdir, ".dotDir"))
    >> file.create(file.path(tdir, ".dotDir",
    >> c("noDotFileInDotDir", ".dotFileInDotDir")))
    >   [1] TRUE TRUE
    >> dir(tdir, all=TRUE) # omit "." and ".." here?
    >   [1] "."  ".."  ".dotDir" ".dotFile" [5] "noDotFile"
    >> dir(tdir, all=TRUE, recursive=TRUE, include.dirs=TRUE)
    >   [1] ".dotDir" ".dotDir/.dotFileInDotDir" [3]
    > ".dotDir/noDotFileInDotDir" ".dotFile" [5] "noDotFile"

    > Bill Dunlap Spotfire, TIBCO Software wdunlap tibco.com


From ripley at stats.ox.ac.uk  Fri Sep 23 19:13:02 2011
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 23 Sep 2011 18:13:02 +0100 (BST)
Subject: [Rd] Issue with seek() on gzipped connections in R-devel
In-Reply-To: <CAM9CR=3NLeWXOGqch5Xn++F-oyjbo29E49638h0m3J2YFB4mig@mail.gmail.com>
References: <CAM9CR=0kgvt987jMPU3_N17CLH1aBn1RMi09WES8Z7LSRRYVTg@mail.gmail.com>
	<CABDUZc-hG9DAv8T+FNn0y8n8L1Z0=n5QqWkoHO594t96Q3m5FA@mail.gmail.com>
	<CAM9CR=3NLeWXOGqch5Xn++F-oyjbo29E49638h0m3J2YFB4mig@mail.gmail.com>
Message-ID: <alpine.LFD.2.02.1109231812330.10207@gannet.stats.ox.ac.uk>

On Fri, 23 Sep 2011, Jon Clayden wrote:

> Thanks for the replies. I take the point, although it does seem like a
> substantial regression (on non-Windows platforms).
>
> I like to keep the external dependencies of my packages minimal, but I
> will look into the mmap package - thanks, Jeff, for the tip.
>
> Aside from that, though, what is the alternative to using seek? If I
> want to read something at (original, uncompressed) byte offset 352, as
> here, do I have to read and discard everything that comes before it
> first? That seems inelegant at best...

Or uncompress the file.

>
> Regards,
> Jon
>
>
> On 23 September 2011 16:54, Jeffrey Ryan <jeffrey.ryan at lemnica.com> wrote:
>> seek() in general is a bad idea IMO if you are writing cross-platform code.
>>
>> ?seek
>>
>> Warning:
>>
>> ? ? Use of ?seek? on Windows is discouraged. ?We have found so many
>> ? ? errors in the Windows implementation of file positioning that
>> ? ? users are advised to use it only at their own risk, and asked not
>> ? ? to waste the R developers' time with bug reports on Windows'
>> ? ? deficiencies.
>>
>> Aside from making me laugh, the above highlights the core reason to not use IMO.
>>
>> For not zipped files, you can try the mmap package. ??mmap and ?types
>> are good starting points. ?Allows for accessing binary data on disk
>> with very simple R-like semantics, and is very fast. ?Not as fast as a
>> sequential read... but fast. ?At present this is 'little endian' only
>> though, but that describes most of the world today.
>>
>> Best,
>> Jeff
>>
>> On Fri, Sep 23, 2011 at 8:58 AM, Jon Clayden <jon.clayden at gmail.com> wrote:
>>> Dear all,
>>>
>>> In R-devel (2011-09-23 r57050), I'm running into a serious problem
>>> with seek()ing on connections opened with gzfile(). A warning is
>>> generated and the file position does not seek to the requested
>>> location. It doesn't seem to occur all the time - I tried to create a
>>> small example file to illustrate it, but the problem didn't occur.
>>> However, it can be seen with a file I use for testing my packages,
>>> which is available through the URL
>>> <https://github.com/jonclayden/tractor/blob/master/tests/data/nifti/maskedb0_lia.nii.gz?raw=true>:
>>>
>>>> con <- gzfile("~/Downloads/maskedb0_lia.nii.gz","rb")
>>>> seek(con, 352)
>>> [1] 0
>>> Warning message:
>>> In seek.connection(con, 352) :
>>> ?seek on a gzfile connection returned an internal error
>>>> seek(con, NA)
>>> [1] 190
>>>
>>> The same commands with the same file work as expected in R 2.13.1, and
>>> have worked over many previous versions of R.
>>>
>>>> con <- gzfile("~/Downloads/maskedb0_lia.nii.gz","rb")
>>>> seek(con, 352)
>>> [1] 0
>>>> seek(con, NA)
>>> [1] 352
>>>
>>> My sessionInfo() output is:
>>>
>>> R Under development (unstable) (2011-09-23 r57050)
>>> Platform: x86_64-apple-darwin11.1.0 (64-bit)
>>>
>>> locale:
>>> [1] en_GB.UTF-8/en_US.UTF-8/en_GB.UTF-8/C/en_GB.UTF-8/en_GB.UTF-8
>>>
>>> attached base packages:
>>> [1] splines ? stats ? ? graphics ?grDevices utils ? ? datasets ?methods
>>> [8] base
>>>
>>> other attached packages:
>>> [1] tractor.nt_2.0.1 ? ? ?tractor.session_2.0.3 tractor.utils_2.0.0
>>> [4] tractor.base_2.0.3 ? ?reportr_0.2.0
>>>
>>> This seems to occur whether or not R is compiled with
>>> "--with-system-zlib". I see some zlib-related changes mentioned in the
>>> NEWS, but I don't see any indication that this is expected. Could
>>> anyone shed any light on it, please?
>>>
>>> Thanks and all the best,
>>> Jon
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>
>>
>>
>> --
>> Jeffrey Ryan
>> jeffrey.ryan at lemnica.com
>>
>> www.lemnica.com
>> www.esotericR.com
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From ripley at stats.ox.ac.uk  Fri Sep 23 19:19:40 2011
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 23 Sep 2011 18:19:40 +0100 (BST)
Subject: [Rd] should dir(all=TRUE) return "." and ".."?
In-Reply-To: <20092.47861.165002.499347@stat.math.ethz.ch>
References: <E66794E69CFDE04D9A70842786030B93074E30@PA-MBX04.na.tibco.com>
	<20092.47861.165002.499347@stat.math.ethz.ch>
Message-ID: <alpine.LFD.2.02.1109231815080.10207@gannet.stats.ox.ac.uk>

On Fri, 23 Sep 2011, Martin Maechler wrote:

>>>>>> William Dunlap <wdunlap at tibco.com>
>>>>>>     on Fri, 23 Sep 2011 15:49:43 +0000 writes:
>
>    > dir(all=TRUE) returns the file names "." and ".."  while
>    > dir(recursive=TRUE, all=TRUE, include.dirs=TRUE) does not.
>    > I always filter out the "." and ".." entries and was
>    > wondering if anyone would mind if dir(all=TRUE) just
>    > omitted them?  It might make recursive file operations
>    > like cleaning out a directory safer, as
>    > unlink(recursive=TRUE, dir(all=TRUE, "dirToClean")) might
>    > start attacking dirToClean/.., then dirToClean/../..,
>    > etc., until your disk is empty.
>
> :-)
>
> Thank you, Bill.
> I agree that there is a problem.  It seems wrong to me that
>
>   dir(all.files=TRUE, recursive=TRUE, include.dirs=TRUE)
>
> *omits* the (symbolic) directories  '.' and '..'  when simple
>
>   dir(all.files=TRUE)
>
> includes them.

It was intentional.  The authors of that part wanted it that way, the 
original author of list.files (aka dir) wanted this the way it was 
before include.dirs was added.

> However, from a strict description (of the argument names, and
> also the help file) I would have expected that both would *include*
> rather than omit them.
> But then --the scenario abov, and also more general
> reasoning -- would rather suggest to follow your proposal.

Someone would need to check for back-compatibility though: 
list.files() has been around for a long time.

There are lots of odder things about list.files(), for example that it 
lists directories with recursive=FALSE and not with recursive=TRUE. 
So is a directory a file or not?

> Martin
>
>
>    >> dir.create(tdir <- tempfile("tdir"))
>    >> file.create(file.path(tdir, c(".dotFile", "noDotFile")))
>    >   [1] TRUE TRUE
>    >> dir.create(file.path(tdir, ".dotDir"))
>    >> file.create(file.path(tdir, ".dotDir",
>    >> c("noDotFileInDotDir", ".dotFileInDotDir")))
>    >   [1] TRUE TRUE
>    >> dir(tdir, all=TRUE) # omit "." and ".." here?
>    >   [1] "."  ".."  ".dotDir" ".dotFile" [5] "noDotFile"
>    >> dir(tdir, all=TRUE, recursive=TRUE, include.dirs=TRUE)
>    >   [1] ".dotDir" ".dotDir/.dotFileInDotDir" [3]
>    > ".dotDir/noDotFileInDotDir" ".dotFile" [5] "noDotFile"
>
>    > Bill Dunlap Spotfire, TIBCO Software wdunlap tibco.com
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From hpages at fhcrc.org  Fri Sep 23 19:58:59 2011
From: hpages at fhcrc.org (=?ISO-8859-1?Q?Herv=E9_Pag=E8s?=)
Date: Fri, 23 Sep 2011 10:58:59 -0700
Subject: [Rd] broken save(..., compress="xy")
Message-ID: <4E7CC8E3.8050903@fhcrc.org>

Hi,

With current R devel and R 2.13.1:

 > aa=1:5
 > save(aa, file="aa.rda", compress="xy")
Error in identical(compress, "gzip") || compress :
   invalid 'y' type in 'x || y'

Thanks!
H.

 > sessionInfo()
R version 2.13.1 (2011-07-08)
Platform: x86_64-unknown-linux-gnu (64-bit)

locale:
  [1] LC_CTYPE=en_CA.UTF-8       LC_NUMERIC=C
  [3] LC_TIME=en_CA.UTF-8        LC_COLLATE=en_CA.UTF-8
  [5] LC_MONETARY=C              LC_MESSAGES=en_CA.UTF-8
  [7] LC_PAPER=en_CA.UTF-8       LC_NAME=C
  [9] LC_ADDRESS=C               LC_TELEPHONE=C
[11] LC_MEASUREMENT=en_CA.UTF-8 LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base


-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M1-B514
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fhcrc.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From sarah.goslee at gmail.com  Fri Sep 23 20:02:51 2011
From: sarah.goslee at gmail.com (Sarah Goslee)
Date: Fri, 23 Sep 2011 14:02:51 -0400
Subject: [Rd] broken save(..., compress="xy")
In-Reply-To: <4E7CC8E3.8050903@fhcrc.org>
References: <4E7CC8E3.8050903@fhcrc.org>
Message-ID: <CAM_vjum1prAhwqR2QVXOYbg_qWUtHzHkg4un3vzpS0bw4yXa9w@mail.gmail.com>

Hi,


2011/9/23 Herv? Pag?s <hpages at fhcrc.org>:
> Hi,
>
> With current R devel and R 2.13.1:
>
>> aa=1:5
>> save(aa, file="aa.rda", compress="xy")
> Error in identical(compress, "gzip") || compress :
> ?invalid 'y' type in 'x || y'

The options for compress are "gzip" "bzip2" or "xz" (and not "xy"), at
least on my linux system. Are you sure you want "xy"?

Sarah

> Thanks!
> H.
>
>> sessionInfo()
> R version 2.13.1 (2011-07-08)
> Platform: x86_64-unknown-linux-gnu (64-bit)
>
> locale:
> ?[1] LC_CTYPE=en_CA.UTF-8 ? ? ? LC_NUMERIC=C
> ?[3] LC_TIME=en_CA.UTF-8 ? ? ? ?LC_COLLATE=en_CA.UTF-8
> ?[5] LC_MONETARY=C ? ? ? ? ? ? ?LC_MESSAGES=en_CA.UTF-8
> ?[7] LC_PAPER=en_CA.UTF-8 ? ? ? LC_NAME=C
> ?[9] LC_ADDRESS=C ? ? ? ? ? ? ? LC_TELEPHONE=C
> [11] LC_MEASUREMENT=en_CA.UTF-8 LC_IDENTIFICATION=C
>
> attached base packages:
> [1] stats ? ? graphics ?grDevices utils ? ? datasets ?methods ? base
>
>
> --


-- 
Sarah Goslee
http://www.functionaldiversity.org


From hpages at fhcrc.org  Fri Sep 23 20:44:32 2011
From: hpages at fhcrc.org (=?ISO-8859-1?Q?Herv=E9_Pag=E8s?=)
Date: Fri, 23 Sep 2011 11:44:32 -0700
Subject: [Rd] broken save(..., compress="xy")
In-Reply-To: <CAM_vjum1prAhwqR2QVXOYbg_qWUtHzHkg4un3vzpS0bw4yXa9w@mail.gmail.com>
References: <4E7CC8E3.8050903@fhcrc.org>
	<CAM_vjum1prAhwqR2QVXOYbg_qWUtHzHkg4un3vzpS0bw4yXa9w@mail.gmail.com>
Message-ID: <4E7CD390.7020805@fhcrc.org>

On 11-09-23 11:02 AM, Sarah Goslee wrote:
> Hi,
>
>
> 2011/9/23 Herv? Pag?s<hpages at fhcrc.org>:
>> Hi,
>>
>> With current R devel and R 2.13.1:
>>
>>> aa=1:5
>>> save(aa, file="aa.rda", compress="xy")
>> Error in identical(compress, "gzip") || compress :
>>   invalid 'y' type in 'x || y'
>
> The options for compress are "gzip" "bzip2" or "xz" (and not "xy"), at
> least on my linux system. Are you sure you want "xy"?

Right, I wanted "xz", sorry... Maybe error handling could be improved
though so a typo in the input doesn't "break" the code?

Thanks,
H.

>
> Sarah
>
>> Thanks!
>> H.
>>
>>> sessionInfo()
>> R version 2.13.1 (2011-07-08)
>> Platform: x86_64-unknown-linux-gnu (64-bit)
>>
>> locale:
>>   [1] LC_CTYPE=en_CA.UTF-8       LC_NUMERIC=C
>>   [3] LC_TIME=en_CA.UTF-8        LC_COLLATE=en_CA.UTF-8
>>   [5] LC_MONETARY=C              LC_MESSAGES=en_CA.UTF-8
>>   [7] LC_PAPER=en_CA.UTF-8       LC_NAME=C
>>   [9] LC_ADDRESS=C               LC_TELEPHONE=C
>> [11] LC_MEASUREMENT=en_CA.UTF-8 LC_IDENTIFICATION=C
>>
>> attached base packages:
>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>
>>
>> --
>
>


-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M1-B514
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fhcrc.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From murdoch.duncan at gmail.com  Fri Sep 23 20:44:57 2011
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Fri, 23 Sep 2011 14:44:57 -0400
Subject: [Rd] "could not find function" after import
In-Reply-To: <CAFFLneR_tuCSx0GG9jZBz4oF9ysnVTz5Ut8P6gQ_LW2aNcXNmA@mail.gmail.com>
References: <4E77AA8D.2040409@u.washington.edu> <4E77D9C3.1070307@gmail.com>
	<CAFFLneR_tuCSx0GG9jZBz4oF9ysnVTz5Ut8P6gQ_LW2aNcXNmA@mail.gmail.com>
Message-ID: <4E7CD3A9.9020808@gmail.com>

On 23/09/2011 12:57 PM, steven mosher wrote:
> Duncan
>
> I have a related question.
>
> I need one function from R.utils.  But R.utils depends on R.oo and  R.methodsS3.
> so I made R.util an import and then used importFrom() in the namespace.
>
> The package passed the  "check".  However when it came to use the function
> it had not been loaded? do I need to add the upstream packages that
> R.util  depends
> upon?  also in the code do I need a library or require?

Sounds exactly like the situation with sandwich below.    The workaround 
available to you is to Depend on R.utils.  The author of R.utils could 
fix the problem by importing R.oo and R.methodsS3, and the authors of R 
could fix it by changing the behaviour of how R handles imports.

Duncan Murdoch

> A bit confused
>
> Steve
>
> On Mon, Sep 19, 2011 at 5:09 PM, Duncan Murdoch
> <murdoch.duncan at gmail.com>  wrote:
> >  On 11-09-19 4:48 PM, Stephanie M. Gogarten wrote:
> >>
> >>  I am trying to build a package (GWASTools, submitted to Bioconductor)
> >>  that uses the "sandwich" package.  I have references to "sandwich" in
> >>  DESCRIPTION:
> >>  Imports: methods, DBI, RSQLite, sandwich, survival, DNAcopy
> >>
> >>  and NAMESPACE:
> >>  import(sandwich)
> >>
> >>  In the code itself is a call to vcovHC:
> >>  Vhat<- vcovHC(mod, type="HC0")
> >>
> >>  I have sandwich version 2.2-7 installed.
> >>
> >>  When I run R CMD check on my package, I get the following error during
> >>  checking of examples:
> >>  * using R Under development (unstable) (2011-08-29 r56828)
> >>  * using platform: x86_64-apple-darwin9.8.0 (64-bit)
> >>  ...
> >>  * checking examples ... ERROR
> >>  ...
> >>  Error in estfun.glm(x) : could not find function "is.zoo"
> >>  Calls: assocTestRegression ... meatHC ->    rowMeans ->    is.data.frame ->
> >>  estfun ->    estfun.glm
> >>
> >>  I import sandwich, sandwich depends on zoo, but a function in zoo cannot
> >>  be found during execution.
> >>
> >>  I tried to get around this by explicitly including a "require" statement
> >>  in assocTestRegression:
> >>  require(sandwich)
> >>
> >>  The example now runs, but I have a warning in R CMD check:
> >>  * checking for unstated dependencies in R code ... WARNING
> >>  ?library? or ?require? call not declared from: ?sandwich?
> >>
> >>  I am not sure why this is a problem, as there is a "require" statement
> >>  (for a different package) in another function which does not cause any
> >>  warnings.
> >>
> >>  Can anyone advise on how to get my package to successfully pass R CMD
> >>  check?
> >>
> >
> >  If you said that your package Depends on sandwich, you'd probably pass
> >  checks, but this is arguably a bug in the sandwich package.
> >
> >  The problem is that since you only import sandwich, it never gets attached.
> >    So it never attaches its dependency zoo.   It should import zoo (or import
> >  the functions in zoo that it uses) to work properly the way you are calling
> >  it.
> >
> >  You can see the same error as follows:
> >
> >  1.  Install sandwich, but don't attach it or zoo.
> >
> >  2.  Run
> >
> >  example(glm)
> >
> >  to create the "glm" object glm.D93.
> >
> >  Try to call
> >
> >  sandwich::estfun(glm.D93)
> >
> >  You'll get the same error as before because is.zoo() will not be loaded.
> >
> >  It's also arguably a design flaw in R.  For testing sandwich, zoo would
> >  generally end up being attached, because the testing of sandwich would
> >  attach it.  However, examples like the one above are never tested.
> >
> >  Duncan Murdoch
> >
> >  ______________________________________________
> >  R-devel at r-project.org mailing list
> >  https://stat.ethz.ch/mailman/listinfo/r-devel
> >


From moshersteven at gmail.com  Fri Sep 23 21:13:59 2011
From: moshersteven at gmail.com (steven mosher)
Date: Fri, 23 Sep 2011 12:13:59 -0700
Subject: [Rd] "could not find function" after import
In-Reply-To: <4E7CD3A9.9020808@gmail.com>
References: <4E77AA8D.2040409@u.washington.edu> <4E77D9C3.1070307@gmail.com>
	<CAFFLneR_tuCSx0GG9jZBz4oF9ysnVTz5Ut8P6gQ_LW2aNcXNmA@mail.gmail.com>
	<4E7CD3A9.9020808@gmail.com>
Message-ID: <CAFFLneQf8ke2813Q1xJiMsUVU0rkh8z+OU0rCEtvNLJSAY_DuA@mail.gmail.com>

Thanks duncan.

I fixed it by changing to depends and resubmitting my packages.  But I
changed from depends to imports for a very specific reason. namespace
conflicts. There are work arounds for that so its not terminally
broken, but  IMPORT had the promise of just the elegance I was looking
for.

Thanks for the explanation.

Steve



On Fri, Sep 23, 2011 at 11:44 AM, Duncan Murdoch
<murdoch.duncan at gmail.com> wrote:
> On 23/09/2011 12:57 PM, steven mosher wrote:
>>
>> Duncan
>>
>> I have a related question.
>>
>> I need one function from R.utils. ?But R.utils depends on R.oo and
>> ?R.methodsS3.
>> so I made R.util an import and then used importFrom() in the namespace.
>>
>> The package passed the ?"check". ?However when it came to use the function
>> it had not been loaded? do I need to add the upstream packages that
>> R.util ?depends
>> upon? ?also in the code do I need a library or require?
>
> Sounds exactly like the situation with sandwich below. ? ?The workaround
> available to you is to Depend on R.utils. ?The author of R.utils could fix
> the problem by importing R.oo and R.methodsS3, and the authors of R could
> fix it by changing the behaviour of how R handles imports.
>
> Duncan Murdoch
>
>> A bit confused
>>
>> Steve
>>
>> On Mon, Sep 19, 2011 at 5:09 PM, Duncan Murdoch
>> <murdoch.duncan at gmail.com> ?wrote:
>> > ?On 11-09-19 4:48 PM, Stephanie M. Gogarten wrote:
>> >>
>> >> ?I am trying to build a package (GWASTools, submitted to Bioconductor)
>> >> ?that uses the "sandwich" package. ?I have references to "sandwich" in
>> >> ?DESCRIPTION:
>> >> ?Imports: methods, DBI, RSQLite, sandwich, survival, DNAcopy
>> >>
>> >> ?and NAMESPACE:
>> >> ?import(sandwich)
>> >>
>> >> ?In the code itself is a call to vcovHC:
>> >> ?Vhat<- vcovHC(mod, type="HC0")
>> >>
>> >> ?I have sandwich version 2.2-7 installed.
>> >>
>> >> ?When I run R CMD check on my package, I get the following error during
>> >> ?checking of examples:
>> >> ?* using R Under development (unstable) (2011-08-29 r56828)
>> >> ?* using platform: x86_64-apple-darwin9.8.0 (64-bit)
>> >> ?...
>> >> ?* checking examples ... ERROR
>> >> ?...
>> >> ?Error in estfun.glm(x) : could not find function "is.zoo"
>> >> ?Calls: assocTestRegression ... meatHC -> ? ?rowMeans ->
>> >> ?is.data.frame ->
>> >> ?estfun -> ? ?estfun.glm
>> >>
>> >> ?I import sandwich, sandwich depends on zoo, but a function in zoo
>> >> cannot
>> >> ?be found during execution.
>> >>
>> >> ?I tried to get around this by explicitly including a "require"
>> >> statement
>> >> ?in assocTestRegression:
>> >> ?require(sandwich)
>> >>
>> >> ?The example now runs, but I have a warning in R CMD check:
>> >> ?* checking for unstated dependencies in R code ... WARNING
>> >> ??library? or ?require? call not declared from: ?sandwich?
>> >>
>> >> ?I am not sure why this is a problem, as there is a "require" statement
>> >> ?(for a different package) in another function which does not cause any
>> >> ?warnings.
>> >>
>> >> ?Can anyone advise on how to get my package to successfully pass R CMD
>> >> ?check?
>> >>
>> >
>> > ?If you said that your package Depends on sandwich, you'd probably pass
>> > ?checks, but this is arguably a bug in the sandwich package.
>> >
>> > ?The problem is that since you only import sandwich, it never gets
>> > attached.
>> > ? ?So it never attaches its dependency zoo. ? It should import zoo (or
>> > import
>> > ?the functions in zoo that it uses) to work properly the way you are
>> > calling
>> > ?it.
>> >
>> > ?You can see the same error as follows:
>> >
>> > ?1. ?Install sandwich, but don't attach it or zoo.
>> >
>> > ?2. ?Run
>> >
>> > ?example(glm)
>> >
>> > ?to create the "glm" object glm.D93.
>> >
>> > ?Try to call
>> >
>> > ?sandwich::estfun(glm.D93)
>> >
>> > ?You'll get the same error as before because is.zoo() will not be
>> > loaded.
>> >
>> > ?It's also arguably a design flaw in R. ?For testing sandwich, zoo would
>> > ?generally end up being attached, because the testing of sandwich would
>> > ?attach it. ?However, examples like the one above are never tested.
>> >
>> > ?Duncan Murdoch
>> >
>> > ?______________________________________________
>> > ?R-devel at r-project.org mailing list
>> > ?https://stat.ethz.ch/mailman/listinfo/r-devel
>> >
>
>


From hpages at fhcrc.org  Fri Sep 23 22:46:55 2011
From: hpages at fhcrc.org (=?ISO-8859-1?Q?Herv=E9_Pag=E8s?=)
Date: Fri, 23 Sep 2011 13:46:55 -0700
Subject: [Rd] cbind() crashes on raw vectors
Message-ID: <4E7CF03F.7090100@fhcrc.org>

Hi,

cbind() doesn't seem to like raw vectors:

 > df <- cbind(a=integer(4000), b=raw(4000))
 > df
*** glibc detected *** /home/hpages/R-2.13.1/bin/exec/R: malloc(): 
memory corruption: 0x0000000002d73ca0 ***
======= Backtrace: =========
/lib/x86_64-linux-gnu/libc.so.6(+0x79d7a)[0x7f3592b91d7a]
/lib/x86_64-linux-gnu/libc.so.6(__libc_malloc+0x6e)[0x7f3592b9431e]
/lib/libreadline.so.5(xmalloc+0x6)[0x7f3592620ab6]
/lib/libreadline.so.5(add_history+0xbe)[0x7f359262136e]
/home/hpages/R-2.13.1/lib/libR.so(+0x1b6538)[0x7f35936bd538]
/lib/libreadline.so.5(rl_callback_read_char+0x8c)[0x7f359261cb1c]
/home/hpages/R-2.13.1/lib/libR.so(+0x1b6f74)[0x7f35936bdf74]
/home/hpages/R-2.13.1/lib/libR.so(Rf_ReplIteration+0xe7)[0x7f3593610eb7]
/home/hpages/R-2.13.1/lib/libR.so(+0x10a260)[0x7f3593611260]
/home/hpages/R-2.13.1/lib/libR.so(run_Rmainloop+0x50)[0x7f3593611780]
/home/hpages/R-2.13.1/bin/exec/R(main+0x1b)[0x40085b]
/lib/x86_64-linux-gnu/libc.so.6(__libc_start_main+0xff)[0x7f3592b36eff]
/home/hpages/R-2.13.1/bin/exec/R[0x400779]
======= Memory map: ========
00400000-00401000 r-xp 00000000 08:01 3811201 
  /home/hpages/R-2.13.1/bin/exec/R
00600000-00601000 r--p 00000000 08:01 3811201 
  /home/hpages/R-2.13.1/bin/exec/R
00601000-00602000 rw-p 00001000 08:01 3811201 
  /home/hpages/R-2.13.1/bin/exec/R
02583000-03b16000 rw-p 00000000 00:00 0 
  [heap]
7f358c000000-7f358c021000 rw-p 00000000 00:00 0
7f358c021000-7f3590000000 ---p 00000000 00:00 0
7f3590342000-7f3590357000 r-xp 00000000 08:06 8155 
  /lib/x86_64-linux-gnu/libgcc_s.so.1
7f3590357000-7f3590556000 ---p 00015000 08:06 8155 
  /lib/x86_64-linux-gnu/libgcc_s.so.1
7f3590556000-7f3590557000 r--p 00014000 08:06 8155 
  /lib/x86_64-linux-gnu/libgcc_s.so.1
7f3590557000-7f3590558000 rw-p 00015000 08:06 8155 
  /lib/x86_64-linux-gnu/libgcc_s.so.1
7f3590558000-7f35905c4000 r-xp 00000000 08:01 3818237 
  /home/hpages/R-2.13.1/library/stats/libs/stats.so
7f35905c4000-7f35907c3000 ---p 0006c000 08:01 3818237 
  /home/hpages/R-2.13.1/library/stats/libs/stats.so
7f35907c3000-7f35907c5000 r--p 0006b000 08:01 3818237 
  /home/hpages/R-2.13.1/library/stats/libs/stats.so
7f35907c5000-7f35907c7000 rw-p 0006d000 08:01 3818237 
  /home/hpages/R-2.13.1/library/stats/libs/stats.so
7f35907c7000-7f359083a000 rw-p 00000000 00:00 0
7f359083a000-7f359085c000 r-xp 00000000 08:01 3817784 
  /home/hpages/R-2.13.1/library/grDevices/libs/grDevices.so
7f359085c000-7f3590a5b000 ---p 00022000 08:01 3817784 
  /home/hpages/R-2.13.1/library/grDevices/libs/grDevices.so
7f3590a5b000-7f3590a5c000 r--p 00021000 08:01 3817784 
  /home/hpages/R-2.13.1/library/grDevices/libs/grDevices.so
7f3590a5c000-7f3590a5d000 rw-p 00022000 08:01 3817784 
  /home/hpages/R-2.13.1/library/grDevices/libs/grDevices.so
7f3590b61000-7f3590b63000 r-xp 00000000 08:07 671027 
  /usr/lib/x86_64-linux-gnu/gconv/ISO8859-1.so
7f3590b63000-7f3590d62000 ---p 00002000 08:07 671027 
  /usr/lib/x86_64-linux-gnu/gconv/ISO8859-1.so
7f3590d62000-7f3590d63000 r--p 00001000 08:07 671027 
  /usr/lib/x86_64-linux-gnu/gconv/ISO8859-1.so
7f3590d63000-7f3590d64000 rw-p 00002000 08:07 671027 
  /usr/lib/x86_64-linux-gnu/gconv/ISO8859-1.so
7f3590d64000-7f3590de6000 rw-p 00000000 00:00 0
7f3590de6000-7f3590ded000 r-xp 00000000 08:01 3818288 
  /home/hpages/R-2.13.1/library/methods/libs/methods.so
7f3590ded000-7f3590fec000 ---p 00007000 08:01 3818288 
  /home/hpages/R-2.13.1/library/methods/libs/methods.so
7f3590fec000-7f3590fed000 r--p 00006000 08:01 3818288 
  /home/hpages/R-2.13.1/library/methods/libs/methods.so
7f3590fed000-7f3590fee000 rw-p 00007000 08:01 3818288 
  /home/hpages/R-2.13.1/library/methods/libs/methods.so
7f3590fee000-7f3590ffa000 r-xp 00000000 08:06 8319 
  /lib/x86_64-linux-gnu/libnss_files-2.13.so
7f3590ffa000-7f35911f9000 ---p 0000c000 08:06 8319 
  /lib/x86_64-linux-gnu/libnss_files-2.13.so
7f35911f9000-7f35911fa000 r--p 0000b000 08:06 8319 
  /lib/x86_64-linux-gnu/libnss_files-2.13.so
7f35911fa000-7f35911fb000 rw-p 0000c000 08:06 8319 
  /lib/x86_64-linux-gnu/libnss_files-2.13.so
7f35911fb000-7f3591206000 r-xp 00000000 08:06 8321 
  /lib/x86_64-linux-gnu/libnss_nis-2.13.so
7f3591206000-7f3591405000 ---p 0000b000 08:06 8321 
  /lib/x86_64-linux-gnu/libnss_nis-2.13.so
7f3591405000-7f3591406000 r--p 0000a000 08:06 8321 
  /lib/x86_64-linux-gnu/libnss_nis-2.13.so
7f3591406000-7f3591407000 rw-p 0000b000 08:06 8321 
  /lib/x86_64-linux-gnu/libnss_nis-2.13.so
7f3591407000-7f359141e000 r-xp 00000000 08:06 8316 
  /lib/x86_64-linux-gnu/libnsl-2.13.so
7f359141e000-7f359161d000 ---p 00017000 08:06 8316 
  /lib/x86_64-linux-gnu/libnsl-2.13.so
7f359161d000-7f359161e000 r--p 00016000 08:06 8316 
  /lib/x86_64-linux-gnu/libnsl-2.13.so
7f359161e000-7f359161f000 rw-p 00017000 08:06 8316 
  /lib/x86_64-linux-gnu/libnsl-2.13.so
7f359161f000-7f3591621000 rw-p 00000000 00:00 0
7f3591621000-7f3591629000 r-xp 00000000 08:06 8317 
  /lib/x86_64-linux-gnu/libnss_compat-2.13.so
7f3591629000-7f3591828000 ---p 00008000 08:06 8317 
  /lib/x86_64-linux-gnu/libnss_compat-2.13.so
7f3591828000-7f3591829000 r--p 00007000 08:06 8317 
  /lib/x86_64-linux-gnu/libnss_compat-2.13.so
7f3591829000-7f359182a000 rw-p 00008000 08:06 8317 
  /lib/x86_64-linux-gnu/libnss_compat-2.13.so
7f359182a000-7f3591d21000 r--p 00000000 08:07 590549 
  /usr/lib/locale/locale-archive
7f3591d21000-7f3591d61000 r-xp 00000000 08:06 8139 
  /lib/libncurses.so.5.7
7f3591d61000-7f3591f60000 ---p 00040000 08:06 8139 
  /lib/libncurses.so.5.7
7f3591f60000-7f3591f64000 r--p 0003f000 08:06 8139 
  /lib/libncurses.so.5.7
7f3591f64000-7f3591f65000 rw-p 00043000 08:06 8139 
  /lib/libncurses.so.5.7
7f3591f65000-7f3591f6c000 r-xp 00000000 08:06 8326 
  /lib/x86_64-linux-gnu/librt-2.13.so
7f3591f6c000-7f359216b000 ---p 00007000 08:06 8326 
  /lib/x86_64-linux-gnu/librt-2.13.so
7f359216b000-7f359216c000 r--p 00006000 08:06 8326 
  /lib/x86_64-linux-gnu/librt-2.13.soAborted

This is with R 2.13.1 but it also crashes recent R devel.

Thanks,
H.

 > sessionInfo()
R version 2.13.1 (2011-07-08)
Platform: x86_64-unknown-linux-gnu (64-bit)

locale:
  [1] LC_CTYPE=en_CA.UTF-8       LC_NUMERIC=C
  [3] LC_TIME=en_CA.UTF-8        LC_COLLATE=en_CA.UTF-8
  [5] LC_MONETARY=C              LC_MESSAGES=en_CA.UTF-8
  [7] LC_PAPER=en_CA.UTF-8       LC_NAME=C
  [9] LC_ADDRESS=C               LC_TELEPHONE=C
[11] LC_MEASUREMENT=en_CA.UTF-8 LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M1-B514
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fhcrc.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From bbolker at gmail.com  Sat Sep 24 00:03:42 2011
From: bbolker at gmail.com (Ben Bolker)
Date: Fri, 23 Sep 2011 18:03:42 -0400
Subject: [Rd] inconsolata font for building vignettes with R-devel
Message-ID: <4E7D023E.5070003@ufl.edu>

  Just to save someone else a few seconds of googling: when you try to R
CMD check with recent versions of R-devel and you get

* checking PDF version of manual ... WARNING
LaTeX errors when creating PDF version.
This typically indicates Rd problems.
LaTeX errors found:
! LaTeX Error: File `inconsolata.sty' not found.

 the Debian/Ubuntu solution is:

sudo apt-get install texlive-fonts-extra


From edd at debian.org  Sat Sep 24 00:25:01 2011
From: edd at debian.org (Dirk Eddelbuettel)
Date: Fri, 23 Sep 2011 17:25:01 -0500
Subject: [Rd] inconsolata font for building vignettes with R-devel
In-Reply-To: <4E7D023E.5070003@ufl.edu>
References: <4E7D023E.5070003@ufl.edu>
Message-ID: <20093.1853.453993.100510@max.nulle.part>


On 23 September 2011 at 18:03, Ben Bolker wrote:
|   Just to save someone else a few seconds of googling: when you try to R
| CMD check with recent versions of R-devel and you get
| 
| * checking PDF version of manual ... WARNING
| LaTeX errors when creating PDF version.
| This typically indicates Rd problems.
| LaTeX errors found:
| ! LaTeX Error: File `inconsolata.sty' not found.
| 
|  the Debian/Ubuntu solution is:
| 
| sudo apt-get install texlive-fonts-extra

Odd.  I just built the R 2.13.2 release candidate this morning.  My
Build-Depends list is 

   Build-Depends: gcc (>= 4:4.1.0), g++ (>= 4:4.1.0), gfortran (>= 4:4.1.0),
     libblas-dev, liblapack-dev (>= 3.1.1), tcl8.5-dev, tk8.5-dev, bison,
     groff-base, libncurses5-dev, libreadline-dev, debhelper (>= 7.2.3),
     texi2html, texinfo (>= 4.1-2), libbz2-dev, liblzma-dev, libpcre3-dev,
     xdg-utils, zlib1g-dev, libpng12-dev, libjpeg-dev, libx11-dev, libxt-dev,
     x11proto-core-dev, libpango1.0-dev, libcairo2-dev, libtiff4-dev, xvfb,
     xauth, xfonts-base, texlive-base, texlive-latex-base,
     texlive-generic-recommended, texlive-fonts-recommended,
     texlive-extra-utils, texlive-latex-recommended, texlive-latex-extra,
     texinfo, texi2html, openjdk-6-jdk [!arm !hppa !kfreebsd-i386
     !kfreebsd-amd64 !hurd-i386 !mips] 

which has texlive-fonts-recommended but t-f-extra as you suggest. Seems not
to have any side effects:

edd at max:~$ wc -l src/debian/build-logs/r-base_2.13.2~20110922-1.log 
17147 src/debian/build-logs/r-base_2.13.2~20110922-1.log
edd at max:~$ 

So is there a safe fallback or not?  Should I install texlive-fonts-extra too
when building?

Dirk

-- 
New Rcpp master class for R and C++ integration is scheduled for 
San Francisco (Oct 8), more details / reg.info available at
http://www.revolutionanalytics.com/products/training/public/rcpp-master-class.php


From bbolker at gmail.com  Sat Sep 24 00:27:45 2011
From: bbolker at gmail.com (Ben Bolker)
Date: Fri, 23 Sep 2011 18:27:45 -0400
Subject: [Rd] inconsolata font for building vignettes with R-devel
In-Reply-To: <20093.1853.453993.100510@max.nulle.part>
References: <4E7D023E.5070003@ufl.edu>
	<20093.1853.453993.100510@max.nulle.part>
Message-ID: <4E7D07E1.70906@gmail.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 09/23/2011 06:25 PM, Dirk Eddelbuettel wrote:
> 
> On 23 September 2011 at 18:03, Ben Bolker wrote:
> |   Just to save someone else a few seconds of googling: when you try to R
> | CMD check with recent versions of R-devel and you get
> | 
> | * checking PDF version of manual ... WARNING
> | LaTeX errors when creating PDF version.
> | This typically indicates Rd problems.
> | LaTeX errors found:
> | ! LaTeX Error: File `inconsolata.sty' not found.
> | 
> |  the Debian/Ubuntu solution is:
> | 
> | sudo apt-get install texlive-fonts-extra
> 
> Odd.  I just built the R 2.13.2 release candidate this morning.  My
> Build-Depends list is 
> 
>    Build-Depends: gcc (>= 4:4.1.0), g++ (>= 4:4.1.0), gfortran (>= 4:4.1.0),
>      libblas-dev, liblapack-dev (>= 3.1.1), tcl8.5-dev, tk8.5-dev, bison,
>      groff-base, libncurses5-dev, libreadline-dev, debhelper (>= 7.2.3),
>      texi2html, texinfo (>= 4.1-2), libbz2-dev, liblzma-dev, libpcre3-dev,
>      xdg-utils, zlib1g-dev, libpng12-dev, libjpeg-dev, libx11-dev, libxt-dev,
>      x11proto-core-dev, libpango1.0-dev, libcairo2-dev, libtiff4-dev, xvfb,
>      xauth, xfonts-base, texlive-base, texlive-latex-base,
>      texlive-generic-recommended, texlive-fonts-recommended,
>      texlive-extra-utils, texlive-latex-recommended, texlive-latex-extra,
>      texinfo, texi2html, openjdk-6-jdk [!arm !hppa !kfreebsd-i386
>      !kfreebsd-amd64 !hurd-i386 !mips] 
> 
> which has texlive-fonts-recommended but t-f-extra as you suggest. Seems not
> to have any side effects:
> 
> edd at max:~$ wc -l src/debian/build-logs/r-base_2.13.2~20110922-1.log 
> 17147 src/debian/build-logs/r-base_2.13.2~20110922-1.log
> edd at max:~$ 
> 
> So is there a safe fallback or not?  Should I install texlive-fonts-extra too
> when building?
> 
> Dirk

  I'm on 10.04 LTS which might have something to do with it ... maybe
texlive-latex-recommended is a different/older version with less stuff
in it?  (Maybe ????)



> 

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.10 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/

iQEcBAEBAgAGBQJOfQfgAAoJED2whTVMEyK9GB0H/2gy7aaGeogtbwT6xDJEqV2G
qDeS8/xDS4gXlXm1mXucLcgVyz9GwpT75YfKdGVJTH5m9EDXyeM13I+SyC87VL37
T/g9rIGo4PyqqqipGKO7MRKd799igr6uv+Ua/mzkyWkNptyHZNVwxSgk35GQD6cp
l+F6h0a4L6l11dR+HwjtfyRXC8io+/aRF1WlEmfZjwr5P8/soQTDpawi0SSpWrCa
Rh32fHE0X2RKiXevrN0yscSRTD7PR3ZdEcqThiKK/6xxF/HM6AW0CD+xVbxpoAz8
3ftXpKCik7z/23tzbskVjuASvvdYWwFGSQiULFS+xOm/aCLrjt/W2RmWlw4Y2C4=
=jpMf
-----END PGP SIGNATURE-----


From maechler at stat.math.ethz.ch  Sat Sep 24 01:12:30 2011
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Sat, 24 Sep 2011 01:12:30 +0200
Subject: [Rd] broken save(..., compress="xy")
In-Reply-To: <4E7CD390.7020805@fhcrc.org>
References: <4E7CC8E3.8050903@fhcrc.org>
	<CAM_vjum1prAhwqR2QVXOYbg_qWUtHzHkg4un3vzpS0bw4yXa9w@mail.gmail.com>
	<4E7CD390.7020805@fhcrc.org>
Message-ID: <20093.4702.530808.308873@stat.math.ethz.ch>

>>>>> Herv? Pag?s <hpages at fhcrc.org>
>>>>>     on Fri, 23 Sep 2011 11:44:32 -0700 writes:

    > On 11-09-23 11:02 AM, Sarah Goslee wrote:
    >> Hi,
    >> 
    >> 
    >> 2011/9/23 Herv? Pag?s<hpages at fhcrc.org>:
    >>> Hi,
    >>> 
    >>> With current R devel and R 2.13.1:
    >>> 
    >>>> aa=1:5 save(aa, file="aa.rda", compress="xy")
    >>> Error in identical(compress, "gzip") || compress :
    >>> invalid 'y' type in 'x || y'
    >> 
    >> The options for compress are "gzip" "bzip2" or "xz" (and
    >> not "xy"), at least on my linux system. Are you sure you
    >> want "xy"?

    > Right, I wanted "xz", sorry... Maybe error handling could
    > be improved though so a typo in the input doesn't "break"
    > the code?

well, what every  ' "break" the code '  means,
you are right that a more informative error message makes sense
here (though, the code now is slightly longer).
I've committed such a change {svn rev 57057}.

Martin

    > Thanks, H.

    >> 
    >> Sarah
    >> 
    >>> Thanks!  H.
    >>> 
    >>>> sessionInfo()
    >>> R version 2.13.1 (2011-07-08) Platform:
    >>> x86_64-unknown-linux-gnu (64-bit)
    >>> 
    >>> locale: [1] LC_CTYPE=en_CA.UTF-8 LC_NUMERIC=C [3]
    >>> LC_TIME=en_CA.UTF-8 LC_COLLATE=en_CA.UTF-8 [5]
    >>> LC_MONETARY=C LC_MESSAGES=en_CA.UTF-8 [7]
    >>> LC_PAPER=en_CA.UTF-8 LC_NAME=C [9] LC_ADDRESS=C
    >>> LC_TELEPHONE=C [11] LC_MEASUREMENT=en_CA.UTF-8
    >>> LC_IDENTIFICATION=C
    >>> 
    >>> attached base packages: [1] stats graphics grDevices
    >>> utils datasets methods base
    >>> 
    >>> 
    >>> --
    >> 
>


-- 
Herv? Pag?s

    > Program in Computational Biology Division of Public Health
    > Sciences Fred Hutchinson Cancer Research Center 1100
    > Fairview Ave. N, M1-B514 P.O. Box 19024 Seattle, WA
    > 98109-1024

    > E-mail: hpages at fhcrc.org Phone: (206) 667-5791 Fax: (206)
    > 667-1319

    > ______________________________________________
    > R-devel at r-project.org mailing list
    > https://stat.ethz.ch/mailman/listinfo/r-devel


From mtmorgan at fhcrc.org  Sat Sep 24 01:23:14 2011
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Fri, 23 Sep 2011 16:23:14 -0700
Subject: [Rd] cbind() crashes on raw vectors
In-Reply-To: <4E7CF03F.7090100@fhcrc.org>
References: <4E7CF03F.7090100@fhcrc.org>
Message-ID: <4E7D14E2.1090204@fhcrc.org>

On 09/23/2011 01:46 PM, Herv? Pag?s wrote:
> Hi,
>
> cbind() doesn't seem to like raw vectors:
>
>  > df <- cbind(a=integer(4000), b=raw(4000))
>  > df
> *** glibc detected *** /home/hpages/R-2.13.1/bin/exec/R: malloc():
> memory corruption: 0x0000000002d73ca0 ***

For what it's worth, under valgrind

R -d valgrind -e "df <- cbind(a=integer(4000), b=raw(4000)) "
==19446== Memcheck, a memory error detector
==19446== Copyright (C) 2002-2009, and GNU GPL'd, by Julian Seward et al.
==19446== Using Valgrind-3.5.0 and LibVEX; rerun with -h for copyright info
==19446== Command: /home/mtmorgan/bin/R-devel/bin/exec/R --no-save 
--quiet -e df~+~\<-~+~cbind(a=integer(4000),~+~b=raw(4000))~+~
==19446==
 > df <- cbind(a=integer(4000), b=raw(4000))
==19446== Invalid write of size 8
==19446==    at 0x4E8C488: cbind (bind.c:1318)
==19446==    by 0x4E8B910: do_bind (bind.c:1117)
==19446==    by 0x4F77460: do_internal (names.c:1229)
==19446==    by 0x4F14543: Rf_eval (eval.c:469)
==19446==    by 0x4F154EC: Rf_applyClosure (eval.c:838)
==19446==    by 0x4F14856: Rf_eval (eval.c:513)
==19446==    by 0x4F17F19: do_set (eval.c:1724)
==19446==    by 0x4F14543: Rf_eval (eval.c:469)
==19446==    by 0x4F5D0A8: Rf_ReplIteration (main.c:255)
==19446==    by 0x4F5D295: R_ReplConsole (main.c:304)
==19446==    by 0x4F5E8F4: run_Rmainloop (main.c:985)
==19446==    by 0x4F5E909: Rf_mainloop (main.c:992)
==19446==  Address 0x8253298 is 0 bytes after a block of size 32,040 alloc'd
==19446==    at 0x4C26C3A: malloc (in 
/usr/lib64/valgrind/vgpreload_memcheck-amd64-linux.so)

and at bind.c:1306:1319

		if (TYPEOF(u) <= INTSXP) {
		    if (mode <= INTSXP) {
			for (i = 0; i < idx; i++)
			    INTEGER(result)[n++] = INTEGER(u)[i % k];
		    }
		    else {
			for (i = 0; i < idx; i++)
			    REAL(result)[n++] = (INTEGER(u)[i % k]) == NA_INTEGER ? NA_REAL : 
INTEGER(u)[i % k];
		    }
		}
		else {
		    for (i = 0; i < idx; i++)
			REAL(result)[n++] = REAL(u)[i % k];
		}

we end up writing REAL(result)[n++] = REAL(u)[i % k] even though

  (gdb) p TYPEOF(u)
$15 = 24

i.e., RAWSXP

(gdb) p TYPEOF(result)
$16 = 13

i.e., INTSXP

it's because the test TYPEOF(u) <= INTSXP fails bind.c:1306.

Martin

  sessionInfo()
R Under development (unstable) (2011-09-19 r57030)
Platform: x86_64-unknown-linux-gnu (64-bit)

locale:
  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
  [7] LC_PAPER=C                 LC_NAME=C
  [9] LC_ADDRESS=C               LC_TELEPHONE=C
[11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base


> ======= Backtrace: =========
> /lib/x86_64-linux-gnu/libc.so.6(+0x79d7a)[0x7f3592b91d7a]
> /lib/x86_64-linux-gnu/libc.so.6(__libc_malloc+0x6e)[0x7f3592b9431e]
> /lib/libreadline.so.5(xmalloc+0x6)[0x7f3592620ab6]
> /lib/libreadline.so.5(add_history+0xbe)[0x7f359262136e]
> /home/hpages/R-2.13.1/lib/libR.so(+0x1b6538)[0x7f35936bd538]
> /lib/libreadline.so.5(rl_callback_read_char+0x8c)[0x7f359261cb1c]
> /home/hpages/R-2.13.1/lib/libR.so(+0x1b6f74)[0x7f35936bdf74]
> /home/hpages/R-2.13.1/lib/libR.so(Rf_ReplIteration+0xe7)[0x7f3593610eb7]
> /home/hpages/R-2.13.1/lib/libR.so(+0x10a260)[0x7f3593611260]
> /home/hpages/R-2.13.1/lib/libR.so(run_Rmainloop+0x50)[0x7f3593611780]
> /home/hpages/R-2.13.1/bin/exec/R(main+0x1b)[0x40085b]
> /lib/x86_64-linux-gnu/libc.so.6(__libc_start_main+0xff)[0x7f3592b36eff]
> /home/hpages/R-2.13.1/bin/exec/R[0x400779]
> ======= Memory map: ========
> 00400000-00401000 r-xp 00000000 08:01 3811201
> /home/hpages/R-2.13.1/bin/exec/R
> 00600000-00601000 r--p 00000000 08:01 3811201
> /home/hpages/R-2.13.1/bin/exec/R
> 00601000-00602000 rw-p 00001000 08:01 3811201
> /home/hpages/R-2.13.1/bin/exec/R
> 02583000-03b16000 rw-p 00000000 00:00 0 [heap]
> 7f358c000000-7f358c021000 rw-p 00000000 00:00 0
> 7f358c021000-7f3590000000 ---p 00000000 00:00 0
> 7f3590342000-7f3590357000 r-xp 00000000 08:06 8155
> /lib/x86_64-linux-gnu/libgcc_s.so.1
> 7f3590357000-7f3590556000 ---p 00015000 08:06 8155
> /lib/x86_64-linux-gnu/libgcc_s.so.1
> 7f3590556000-7f3590557000 r--p 00014000 08:06 8155
> /lib/x86_64-linux-gnu/libgcc_s.so.1
> 7f3590557000-7f3590558000 rw-p 00015000 08:06 8155
> /lib/x86_64-linux-gnu/libgcc_s.so.1
> 7f3590558000-7f35905c4000 r-xp 00000000 08:01 3818237
> /home/hpages/R-2.13.1/library/stats/libs/stats.so
> 7f35905c4000-7f35907c3000 ---p 0006c000 08:01 3818237
> /home/hpages/R-2.13.1/library/stats/libs/stats.so
> 7f35907c3000-7f35907c5000 r--p 0006b000 08:01 3818237
> /home/hpages/R-2.13.1/library/stats/libs/stats.so
> 7f35907c5000-7f35907c7000 rw-p 0006d000 08:01 3818237
> /home/hpages/R-2.13.1/library/stats/libs/stats.so
> 7f35907c7000-7f359083a000 rw-p 00000000 00:00 0
> 7f359083a000-7f359085c000 r-xp 00000000 08:01 3817784
> /home/hpages/R-2.13.1/library/grDevices/libs/grDevices.so
> 7f359085c000-7f3590a5b000 ---p 00022000 08:01 3817784
> /home/hpages/R-2.13.1/library/grDevices/libs/grDevices.so
> 7f3590a5b000-7f3590a5c000 r--p 00021000 08:01 3817784
> /home/hpages/R-2.13.1/library/grDevices/libs/grDevices.so
> 7f3590a5c000-7f3590a5d000 rw-p 00022000 08:01 3817784
> /home/hpages/R-2.13.1/library/grDevices/libs/grDevices.so
> 7f3590b61000-7f3590b63000 r-xp 00000000 08:07 671027
> /usr/lib/x86_64-linux-gnu/gconv/ISO8859-1.so
> 7f3590b63000-7f3590d62000 ---p 00002000 08:07 671027
> /usr/lib/x86_64-linux-gnu/gconv/ISO8859-1.so
> 7f3590d62000-7f3590d63000 r--p 00001000 08:07 671027
> /usr/lib/x86_64-linux-gnu/gconv/ISO8859-1.so
> 7f3590d63000-7f3590d64000 rw-p 00002000 08:07 671027
> /usr/lib/x86_64-linux-gnu/gconv/ISO8859-1.so
> 7f3590d64000-7f3590de6000 rw-p 00000000 00:00 0
> 7f3590de6000-7f3590ded000 r-xp 00000000 08:01 3818288
> /home/hpages/R-2.13.1/library/methods/libs/methods.so
> 7f3590ded000-7f3590fec000 ---p 00007000 08:01 3818288
> /home/hpages/R-2.13.1/library/methods/libs/methods.so
> 7f3590fec000-7f3590fed000 r--p 00006000 08:01 3818288
> /home/hpages/R-2.13.1/library/methods/libs/methods.so
> 7f3590fed000-7f3590fee000 rw-p 00007000 08:01 3818288
> /home/hpages/R-2.13.1/library/methods/libs/methods.so
> 7f3590fee000-7f3590ffa000 r-xp 00000000 08:06 8319
> /lib/x86_64-linux-gnu/libnss_files-2.13.so
> 7f3590ffa000-7f35911f9000 ---p 0000c000 08:06 8319
> /lib/x86_64-linux-gnu/libnss_files-2.13.so
> 7f35911f9000-7f35911fa000 r--p 0000b000 08:06 8319
> /lib/x86_64-linux-gnu/libnss_files-2.13.so
> 7f35911fa000-7f35911fb000 rw-p 0000c000 08:06 8319
> /lib/x86_64-linux-gnu/libnss_files-2.13.so
> 7f35911fb000-7f3591206000 r-xp 00000000 08:06 8321
> /lib/x86_64-linux-gnu/libnss_nis-2.13.so
> 7f3591206000-7f3591405000 ---p 0000b000 08:06 8321
> /lib/x86_64-linux-gnu/libnss_nis-2.13.so
> 7f3591405000-7f3591406000 r--p 0000a000 08:06 8321
> /lib/x86_64-linux-gnu/libnss_nis-2.13.so
> 7f3591406000-7f3591407000 rw-p 0000b000 08:06 8321
> /lib/x86_64-linux-gnu/libnss_nis-2.13.so
> 7f3591407000-7f359141e000 r-xp 00000000 08:06 8316
> /lib/x86_64-linux-gnu/libnsl-2.13.so
> 7f359141e000-7f359161d000 ---p 00017000 08:06 8316
> /lib/x86_64-linux-gnu/libnsl-2.13.so
> 7f359161d000-7f359161e000 r--p 00016000 08:06 8316
> /lib/x86_64-linux-gnu/libnsl-2.13.so
> 7f359161e000-7f359161f000 rw-p 00017000 08:06 8316
> /lib/x86_64-linux-gnu/libnsl-2.13.so
> 7f359161f000-7f3591621000 rw-p 00000000 00:00 0
> 7f3591621000-7f3591629000 r-xp 00000000 08:06 8317
> /lib/x86_64-linux-gnu/libnss_compat-2.13.so
> 7f3591629000-7f3591828000 ---p 00008000 08:06 8317
> /lib/x86_64-linux-gnu/libnss_compat-2.13.so
> 7f3591828000-7f3591829000 r--p 00007000 08:06 8317
> /lib/x86_64-linux-gnu/libnss_compat-2.13.so
> 7f3591829000-7f359182a000 rw-p 00008000 08:06 8317
> /lib/x86_64-linux-gnu/libnss_compat-2.13.so
> 7f359182a000-7f3591d21000 r--p 00000000 08:07 590549
> /usr/lib/locale/locale-archive
> 7f3591d21000-7f3591d61000 r-xp 00000000 08:06 8139 /lib/libncurses.so.5.7
> 7f3591d61000-7f3591f60000 ---p 00040000 08:06 8139 /lib/libncurses.so.5.7
> 7f3591f60000-7f3591f64000 r--p 0003f000 08:06 8139 /lib/libncurses.so.5.7
> 7f3591f64000-7f3591f65000 rw-p 00043000 08:06 8139 /lib/libncurses.so.5.7
> 7f3591f65000-7f3591f6c000 r-xp 00000000 08:06 8326
> /lib/x86_64-linux-gnu/librt-2.13.so
> 7f3591f6c000-7f359216b000 ---p 00007000 08:06 8326
> /lib/x86_64-linux-gnu/librt-2.13.so
> 7f359216b000-7f359216c000 r--p 00006000 08:06 8326
> /lib/x86_64-linux-gnu/librt-2.13.soAborted
>
> This is with R 2.13.1 but it also crashes recent R devel.
>
> Thanks,
> H.
>
>  > sessionInfo()
> R version 2.13.1 (2011-07-08)
> Platform: x86_64-unknown-linux-gnu (64-bit)
>
> locale:
> [1] LC_CTYPE=en_CA.UTF-8 LC_NUMERIC=C
> [3] LC_TIME=en_CA.UTF-8 LC_COLLATE=en_CA.UTF-8
> [5] LC_MONETARY=C LC_MESSAGES=en_CA.UTF-8
> [7] LC_PAPER=en_CA.UTF-8 LC_NAME=C
> [9] LC_ADDRESS=C LC_TELEPHONE=C
> [11] LC_MEASUREMENT=en_CA.UTF-8 LC_IDENTIFICATION=C
>
> attached base packages:
> [1] stats graphics grDevices utils datasets methods base
>


-- 
Computational Biology
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N. PO Box 19024 Seattle, WA 98109

Location: M1-B861
Telephone: 206 667-2793


From hpages at fhcrc.org  Sat Sep 24 01:37:15 2011
From: hpages at fhcrc.org (=?ISO-8859-1?Q?Herv=E9_Pag=E8s?=)
Date: Fri, 23 Sep 2011 16:37:15 -0700
Subject: [Rd] broken save(..., compress="xy")
In-Reply-To: <20093.4702.530808.308873@stat.math.ethz.ch>
References: <4E7CC8E3.8050903@fhcrc.org>	<CAM_vjum1prAhwqR2QVXOYbg_qWUtHzHkg4un3vzpS0bw4yXa9w@mail.gmail.com>	<4E7CD390.7020805@fhcrc.org>
	<20093.4702.530808.308873@stat.math.ethz.ch>
Message-ID: <4E7D182B.1010708@fhcrc.org>

Hi Martin,

On 11-09-23 04:12 PM, Martin Maechler wrote:
>>>>>> Herv? Pag?s<hpages at fhcrc.org>
>>>>>>      on Fri, 23 Sep 2011 11:44:32 -0700 writes:
>
>      >  On 11-09-23 11:02 AM, Sarah Goslee wrote:
>      >>  Hi,
>      >>
>      >>
>      >>  2011/9/23 Herv? Pag?s<hpages at fhcrc.org>:
>      >>>  Hi,
>      >>>
>      >>>  With current R devel and R 2.13.1:
>      >>>
>      >>>>  aa=1:5 save(aa, file="aa.rda", compress="xy")
>      >>>  Error in identical(compress, "gzip") || compress :
>      >>>  invalid 'y' type in 'x || y'
>      >>
>      >>  The options for compress are "gzip" "bzip2" or "xz" (and
>      >>  not "xy"), at least on my linux system. Are you sure you
>      >>  want "xy"?
>
>      >  Right, I wanted "xz", sorry... Maybe error handling could
>      >  be improved though so a typo in the input doesn't "break"
>      >  the code?
>
> well, what every  ' "break" the code '  means,

"break" here means that the if statement in charge of examining
user input doesn't execute properly for some invalid input.

> you are right that a more informative error message makes sense
> here (though, the code now is slightly longer).
> I've committed such a change {svn rev 57057}.

Thank you!

H.

>
> Martin
>
>      >  Thanks, H.
>
>      >>
>      >>  Sarah
>      >>
>      >>>  Thanks!  H.
>      >>>
>      >>>>  sessionInfo()
>      >>>  R version 2.13.1 (2011-07-08) Platform:
>      >>>  x86_64-unknown-linux-gnu (64-bit)
>      >>>
>      >>>  locale: [1] LC_CTYPE=en_CA.UTF-8 LC_NUMERIC=C [3]
>      >>>  LC_TIME=en_CA.UTF-8 LC_COLLATE=en_CA.UTF-8 [5]
>      >>>  LC_MONETARY=C LC_MESSAGES=en_CA.UTF-8 [7]
>      >>>  LC_PAPER=en_CA.UTF-8 LC_NAME=C [9] LC_ADDRESS=C
>      >>>  LC_TELEPHONE=C [11] LC_MEASUREMENT=en_CA.UTF-8
>      >>>  LC_IDENTIFICATION=C
>      >>>
>      >>>  attached base packages: [1] stats graphics grDevices
>      >>>  utils datasets methods base
>      >>>
>      >>>
>      >>>  --
>      >>
>>
>
>


-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M1-B514
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fhcrc.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From mtmorgan at fhcrc.org  Sun Sep 25 04:13:57 2011
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Sat, 24 Sep 2011 19:13:57 -0700
Subject: [Rd] WIndows Makeconf masks user-specified zlib.h
Message-ID: <4E7E8E65.5020905@fhcrc.org>

On windows under current R-devel (r57066), R CMD INSTALL, for instance, 
invokes gcc with -I"$(R_HOME)/include" prior to any user-defined include 
paths. This means that a package cannot specify an alternative zlib.h, 
as a (reduced) version of this is in $(R_HOME)/include.

One way around this is to redefine .o rules

%.o: %.c
	$(CC) $(MY_ZFLAGS) $(ALL_CPPFLAGS) $(ALL_CFLAGS) -c $< -o $@

Is there a better way? Can the ordering of the include search path be 
altered in src/gnuwin32/fixed/etc/Makeconf:160-161?

Martin
-- 
Computational Biology
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N. PO Box 19024 Seattle, WA 98109

Location: M1-B861
Telephone: 206 667-2793


From nick.sabbe at ugent.be  Sun Sep 25 09:58:52 2011
From: nick.sabbe at ugent.be (Nick Sabbe)
Date: Sun, 25 Sep 2011 09:58:52 +0200
Subject: [Rd] R CMD check file issues
In-Reply-To: <CAFDcVCSaGSAL4jxvMWk2ftLAV-B3_Z2c9YhmrKvVB=TDzVeqQw@mail.gmail.com>
References: <4e7b2236.9a58df0a.3724.7ee5SMTPIN_ADDED@mx.google.com>
	<4E7B27FE.6050804@gmail.com>
	<4e7b2a5a.d1c9e30a.0f61.ffffa3c8SMTPIN_ADDED@mx.google.com>
	<4E7B2AFF.8010904@gmail.com>
	<CAFDcVCSaGSAL4jxvMWk2ftLAV-B3_Z2c9YhmrKvVB=TDzVeqQw@mail.gmail.com>
Message-ID: <036a01cc7b58$f781f710$e685e530$@sabbe@ugent.be>

Here you go (though I doubt it will be actually helpful):

R version 2.13.1 (2011-07-08)
Platform: i386-pc-mingw32/i386 (32-bit)

locale:
[1] LC_COLLATE=Dutch_Belgium.1252  LC_CTYPE=Dutch_Belgium.1252
LC_MONETARY=Dutch_Belgium.1252 LC_NUMERIC=C                  
[5] LC_TIME=Dutch_Belgium.1252    

attached base packages:
[1] grDevices datasets  splines   graphics  stats     tcltk     utils
methods   base     

other attached packages:
 [1] addendum_1.4       snowfall_1.84      snow_0.3-7         mgcv_1.7-6
rgl_0.92.798       glmnet_1.7        
 [7] Matrix_0.9996875-3 lattice_0.19-33    svSocket_0.9-51    TinnR_1.0.3
R2HTML_2.2         Hmisc_3.8-3       
[13] survival_2.36-9   

loaded via a namespace (and not attached):
[1] cluster_1.14.0 grid_2.13.1    nlme_3.1-102   svMisc_0.9-63  tools_2.13.1

Note that this is the sessionInfo from an interactive session. I don't know
of an obvious way to provide you the sessionInfo of the session that is
started by R CMD check (Assuming that at that point, an 'actual' R session
has actually been started - it appears the error occurs before any 'real
work' is started).


Nick Sabbe
--
ping: nick.sabbe at ugent.be
link: http://biomath.ugent.be
wink: A1.056, Coupure Links 653, 9000 Gent
ring: 09/264.59.36

-- Do Not Disapprove




> -----Original Message-----
> From: henrik.bengtsson at gmail.com [mailto:henrik.bengtsson at gmail.com] On
> Behalf Of Henrik Bengtsson
> Sent: donderdag 22 september 2011 17:59
> To: Duncan Murdoch
> Cc: Nick Sabbe; r-devel at r-project.org
> Subject: Re: [Rd] R CMD check file issues
> 
> I'm on Windows 7 (64-bit) and everything works perfectly.  Obviously,
> there is either another process locking down a file with the same name
> or the directory doesn't exist at the time of the file() call.
> 
> Now to the most important question  ...what's your sessionInfo()?
> 
> /Henrik
> 
> On Thu, Sep 22, 2011 at 5:33 AM, Duncan Murdoch
> <murdoch.duncan at gmail.com> wrote:
> > On 11-09-22 8:30 AM, Nick Sabbe wrote:
> >>
> >> Hi Duncan (and others).
> >>
> >> I've just turned off my virus scanner (MS Forefront Endpoint
> Protection).
> >>
> >> The issue persists. It appears that the first time I call R CMD
> check, it
> >> deletes the previous rcheck folder, but tries to proceed before it
> is
> >> actually gone. By the time I reissue the command, the folder is
> truly
> >> gone,
> >> and the R CMD check can safely do its work.
> >>
> >> Is anyone else here using Win7 (32bit) and successfully
> building/checking
> >> R
> >> packages? Perhaps I'm the only one who has treaded this path :-)
> >
> > I do use Win7 on one machine, and have seen odd things happen, but
> not what
> > you describe.
> >
> > I imagine a simple workaround for you would be to delete the folder
> before
> > you call R CMD check (i.e. wrap R CMD check in a batch file to do
> that), but
> > it would be nice if that were not necessary.
> >
> > Duncan Murdoch
> >
> >>
> >>
> >> Nick Sabbe
> >> --
> >> ping: nick.sabbe at ugent.be
> >> link: http://biomath.ugent.be
> >> wink: A1.056, Coupure Links 653, 9000 Gent
> >> ring: 09/264.59.36
> >>
> >> -- Do Not Disapprove
> >>
> >>
> >>
> >>
> >>> -----Original Message-----
> >>> From: Duncan Murdoch [mailto:murdoch.duncan at gmail.com]
> >>> Sent: donderdag 22 september 2011 14:20
> >>> To: Nick Sabbe
> >>> Cc: r-devel at r-project.org
> >>> Subject: Re: [Rd] R CMD check file issues
> >>>
> >>> On 11-09-22 7:53 AM, Nick Sabbe wrote:
> >>>>
> >>>> This problem is likely to be specific to Windows, and particularly
> >>>
> >>> Win7.
> >>>
> >>> The symptoms sound like interference from an anti-virus checker.
> >>>
> >>> Duncan Murdoch
> >>>
> >>>>
> >>>>
> >>>> After a successful build of a package (R CMD build addendum), I
> >>>
> >>> immediately
> >>>>
> >>>> run an R CMD check for the same package.
> >>>>
> >>>> Not always, but _very_ often, I get the following error:
> >>>>
> >>>> C:\Users\nisabbe\Documents\@Doctoraat\R>R CMD check addendum
> >>>>
> >>>> Loading required package: tcltk
> >>>>
> >>>> Loading Tcl/Tk interface ... done
> >>>>
> >>>> Loading required package: Hmisc
> >>>>
> >>>> Loading required package: survival
> >>>>
> >>>> Loading required package: stats
> >>>>
> >>>> Loading required package: graphics
> >>>>
> >>>> Loading required package: splines
> >>>>
> >>>>
> >>>>
> >>>> Attaching package: 'Hmisc'
> >>>>
> >>>>
> >>>>
> >>>> The following object(s) are masked from 'package:survival':
> >>>>
> >>>>
> >>>>
> >>>> ? ? ?untangle.specials
> >>>>
> >>>>
> >>>>
> >>>> The following object(s) are masked from 'package:base':
> >>>>
> >>>>
> >>>>
> >>>> ? ? ?format.pval, round.POSIXt, trunc.POSIXt, units
> >>>>
> >>>>
> >>>>
> >>>> Loading required package: R2HTML
> >>>>
> >>>> Warning in file(filename, "wt") :
> >>>>
> >>>> ? ?cannot open file
> >>>> 'C:/Users/nisabbe/Documents/@Doctoraat/R/addendum.Rcheck/00ch
> >>>>
> >>>> eck.log': Permission denied
> >>>>
> >>>> Error in file(filename, "wt") : cannot open the connection
> >>>>
> >>>> Execution halted
> >>>>
> >>>>
> >>>>
> >>>> If, after this, I immediately reissue the R CMD check command, it
> >>>
> >>> works,
> >>>>
> >>>> without the error.
> >>>>
> >>>> I think this has something to do with how Win7 processes file
> >>>
> >>> handling
> >>>>
> >>>> (there are known issues even noticeable in windows explorer), but
> >>>
> >>> perhaps
> >>>>
> >>>> there is a way of circumventing this? It would be greatly
> >>>
> >>> appreciated, as
> >>>>
> >>>> this issue is preventing automation of build/check/install
> scripts.
> >>>>
> >>>>
> >>>>
> >>>> Suggestions will be greatly appreciated.
> >>>>
> >>>>
> >>>>
> >>>> Nick Sabbe
> >>>>
> >>>> --
> >>>>
> >>>> ping: nick.sabbe at ugent.be
> >>>>
> >>>> link:<http://biomath.ugent.be/> ? http://biomath.ugent.be
> >>>>
> >>>> wink: A1.056, Coupure Links 653, 9000 Gent
> >>>>
> >>>> ring: 09/264.59.36
> >>>>
> >>>>
> >>>>
> >>>> -- Do Not Disapprove
> >>>>
> >>>>
> >>>>
> >>>>
> >>>> ? ? ? ?[[alternative HTML version deleted]]
> >>>>
> >>>> ______________________________________________
> >>>> R-devel at r-project.org mailing list
> >>>> https://stat.ethz.ch/mailman/listinfo/r-devel
> >>
> >>
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >


From nick.sabbe at ugent.be  Sun Sep 25 10:04:55 2011
From: nick.sabbe at ugent.be (Nick Sabbe)
Date: Sun, 25 Sep 2011 10:04:55 +0200
Subject: [Rd] R CMD check file issues
In-Reply-To: <alpine.LFD.2.02.1109222102180.13324@gannet.stats.ox.ac.uk>
References: <4e7b2236.9a58df0a.3724.7ee5SMTPIN_ADDED@mx.google.com>	<4E7B27FE.6050804@gmail.com>	<4e7b2a5a.d1c9e30a.0f61.ffffa3c8SMTPIN_ADDED@mx.google.com>	<4E7B2AFF.8010904@gmail.com>	<CAFDcVCSaGSAL4jxvMWk2ftLAV-B3_Z2c9YhmrKvVB=TDzVeqQw@mail.gmail.com>
	<alpine.LFD.2.02.1109222102180.13324@gannet.stats.ox.ac.uk>
Message-ID: <036b01cc7b59$d0228210$70678630$@sabbe@ugent.be>

In my particular case, the antivirus appears irrelevant (turning it off does
not change anything ; admittedly, turning 'off' an antivirus program through
its user interface may still involve some background meddling - stubborn
creatures they are, these AVs)

Either way: since this is the only place I know of where R has problems with
the slow filehandling in Win7, a solution may be to check repeatedly (with
some delay and a timeout) after the delete calls whether the files are
actually gone.

Ugly, I admit, but since our Redmond friends don't provide it...


Nick Sabbe
--
ping: nick.sabbe at ugent.be
link: http://biomath.ugent.be
wink: A1.056, Coupure Links 653, 9000 Gent
ring: 09/264.59.36

-- Do Not Disapprove




> -----Original Message-----
> From: r-devel-bounces at r-project.org [mailto:r-devel-bounces at r-
> project.org] On Behalf Of Prof Brian Ripley
> Sent: donderdag 22 september 2011 22:04
> To: Henrik Bengtsson
> Cc: r-devel at r-project.org
> Subject: Re: [Rd] R CMD check file issues
> 
> I do see this on Win7, and it is an antivirus issue (Sophos).
> Excluding the R check area solves it for me, as does an earlier delete.
> 
> I have considered adding a delay in check.R, but it is not clear how
> long it would need to be.
> 
> On Thu, 22 Sep 2011, Henrik Bengtsson wrote:
> 
> > I'm on Windows 7 (64-bit) and everything works perfectly.  Obviously,
> > there is either another process locking down a file with the same
> name
> > or the directory doesn't exist at the time of the file() call.
> >
> > Now to the most important question  ...what's your sessionInfo()?
> >
> > /Henrik
> >
> > On Thu, Sep 22, 2011 at 5:33 AM, Duncan Murdoch
> > <murdoch.duncan at gmail.com> wrote:
> >> On 11-09-22 8:30 AM, Nick Sabbe wrote:
> >>>
> >>> Hi Duncan (and others).
> >>>
> >>> I've just turned off my virus scanner (MS Forefront Endpoint
> Protection).
> >>>
> >>> The issue persists. It appears that the first time I call R CMD
> >>> check, it deletes the previous rcheck folder, but tries to proceed
> >>> before it is actually gone. By the time I reissue the command, the
> >>> folder is truly gone, and the R CMD check can safely do its work.
> >>>
> >>> Is anyone else here using Win7 (32bit) and successfully
> >>> building/checking R packages? Perhaps I'm the only one who has
> >>> treaded this path :-)
> >>
> >> I do use Win7 on one machine, and have seen odd things happen, but
> >> not what you describe.
> >>
> >> I imagine a simple workaround for you would be to delete the folder
> >> before you call R CMD check (i.e. wrap R CMD check in a batch file
> to
> >> do that), but it would be nice if that were not necessary.
> >>
> >> Duncan Murdoch
> >>
> >>>
> >>>
> >>> Nick Sabbe
> >>> --
> >>> ping: nick.sabbe at ugent.be
> >>> link: http://biomath.ugent.be
> >>> wink: A1.056, Coupure Links 653, 9000 Gent
> >>> ring: 09/264.59.36
> >>>
> >>> -- Do Not Disapprove
> >>>
> >>>
> >>>
> >>>
> >>>> -----Original Message-----
> >>>> From: Duncan Murdoch [mailto:murdoch.duncan at gmail.com]
> >>>> Sent: donderdag 22 september 2011 14:20
> >>>> To: Nick Sabbe
> >>>> Cc: r-devel at r-project.org
> >>>> Subject: Re: [Rd] R CMD check file issues
> >>>>
> >>>> On 11-09-22 7:53 AM, Nick Sabbe wrote:
> >>>>>
> >>>>> This problem is likely to be specific to Windows, and
> particularly
> >>>>
> >>>> Win7.
> >>>>
> >>>> The symptoms sound like interference from an anti-virus checker.
> >>>>
> >>>> Duncan Murdoch
> >>>>
> >>>>>
> >>>>>
> >>>>> After a successful build of a package (R CMD build addendum), I
> >>>>
> >>>> immediately
> >>>>>
> >>>>> run an R CMD check for the same package.
> >>>>>
> >>>>> Not always, but _very_ often, I get the following error:
> >>>>>
> >>>>> C:\Users\nisabbe\Documents\@Doctoraat\R>R CMD check addendum
> >>>>>
> >>>>> Loading required package: tcltk
> >>>>>
> >>>>> Loading Tcl/Tk interface ... done
> >>>>>
> >>>>> Loading required package: Hmisc
> >>>>>
> >>>>> Loading required package: survival
> >>>>>
> >>>>> Loading required package: stats
> >>>>>
> >>>>> Loading required package: graphics
> >>>>>
> >>>>> Loading required package: splines
> >>>>>
> >>>>>
> >>>>>
> >>>>> Attaching package: 'Hmisc'
> >>>>>
> >>>>>
> >>>>>
> >>>>> The following object(s) are masked from 'package:survival':
> >>>>>
> >>>>>
> >>>>>
> >>>>> ? ? ?untangle.specials
> >>>>>
> >>>>>
> >>>>>
> >>>>> The following object(s) are masked from 'package:base':
> >>>>>
> >>>>>
> >>>>>
> >>>>> ? ? ?format.pval, round.POSIXt, trunc.POSIXt, units
> >>>>>
> >>>>>
> >>>>>
> >>>>> Loading required package: R2HTML
> >>>>>
> >>>>> Warning in file(filename, "wt") :
> >>>>>
> >>>>> ? ?cannot open file
> >>>>> 'C:/Users/nisabbe/Documents/@Doctoraat/R/addendum.Rcheck/00ch
> >>>>>
> >>>>> eck.log': Permission denied
> >>>>>
> >>>>> Error in file(filename, "wt") : cannot open the connection
> >>>>>
> >>>>> Execution halted
> >>>>>
> >>>>>
> >>>>>
> >>>>> If, after this, I immediately reissue the R CMD check command, it
> >>>>
> >>>> works,
> >>>>>
> >>>>> without the error.
> >>>>>
> >>>>> I think this has something to do with how Win7 processes file
> >>>>
> >>>> handling
> >>>>>
> >>>>> (there are known issues even noticeable in windows explorer), but
> >>>>
> >>>> perhaps
> >>>>>
> >>>>> there is a way of circumventing this? It would be greatly
> >>>>
> >>>> appreciated, as
> >>>>>
> >>>>> this issue is preventing automation of build/check/install
> scripts.
> >>>>>
> >>>>>
> >>>>>
> >>>>> Suggestions will be greatly appreciated.
> >>>>>
> >>>>>
> >>>>>
> >>>>> Nick Sabbe
> >>>>>
> >>>>> --
> >>>>>
> >>>>> ping: nick.sabbe at ugent.be
> >>>>>
> >>>>> link:<http://biomath.ugent.be/> ? http://biomath.ugent.be
> >>>>>
> >>>>> wink: A1.056, Coupure Links 653, 9000 Gent
> >>>>>
> >>>>> ring: 09/264.59.36
> >>>>>
> >>>>>
> >>>>>
> >>>>> -- Do Not Disapprove
> >>>>>
> >>>>>
> >>>>>
> >>>>>
> >>>>> ? ? ? ?[[alternative HTML version deleted]]
> >>>>>
> >>>>> ______________________________________________
> >>>>> R-devel at r-project.org mailing list
> >>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
> >>>
> >>>
> >>
> >> ______________________________________________
> >> R-devel at r-project.org mailing list
> >> https://stat.ethz.ch/mailman/listinfo/r-devel
> >>
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >
> 
> --
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From hb at biostat.ucsf.edu  Sun Sep 25 14:57:51 2011
From: hb at biostat.ucsf.edu (Henrik Bengtsson)
Date: Sun, 25 Sep 2011 05:57:51 -0700
Subject: [Rd] R CMD check file issues
In-Reply-To: <4e7edfa1.ca17440a.5f2f.ffff99fbSMTPIN_ADDED@mx.google.com>
References: <4e7b2236.9a58df0a.3724.7ee5SMTPIN_ADDED@mx.google.com>
	<4E7B27FE.6050804@gmail.com>
	<4e7b2a5a.d1c9e30a.0f61.ffffa3c8SMTPIN_ADDED@mx.google.com>
	<4E7B2AFF.8010904@gmail.com>
	<CAFDcVCSaGSAL4jxvMWk2ftLAV-B3_Z2c9YhmrKvVB=TDzVeqQw@mail.gmail.com>
	<4e7edfa1.ca17440a.5f2f.ffff99fbSMTPIN_ADDED@mx.google.com>
Message-ID: <CAFDcVCQPBZZy2QC+PY4+UfjTBM+BckjQdd6QHEThgJgpCfBi=A@mail.gmail.com>

On Sun, Sep 25, 2011 at 12:58 AM, Nick Sabbe <nick.sabbe at ugent.be> wrote:
> Here you go (though I doubt it will be actually helpful):
>
> R version 2.13.1 (2011-07-08)
> Platform: i386-pc-mingw32/i386 (32-bit)

It is useful, especially to know which version of R you are running
(at times when error report are posted it is only late in the
discussion it is found out it is for an old version of R).

FYI, checking the SVN log it seems that Brian Ripley has added some
protection/workarounds for your race condition in R rev 57047.  So try
with a new R 2.13.2RC or R devel.

/Henrik

>
> locale:
> [1] LC_COLLATE=Dutch_Belgium.1252 ?LC_CTYPE=Dutch_Belgium.1252
> LC_MONETARY=Dutch_Belgium.1252 LC_NUMERIC=C
> [5] LC_TIME=Dutch_Belgium.1252
>
> attached base packages:
> [1] grDevices datasets ?splines ? graphics ?stats ? ? tcltk ? ? utils
> methods ? base
>
> other attached packages:
> ?[1] addendum_1.4 ? ? ? snowfall_1.84 ? ? ?snow_0.3-7 ? ? ? ? mgcv_1.7-6
> rgl_0.92.798 ? ? ? glmnet_1.7
> ?[7] Matrix_0.9996875-3 lattice_0.19-33 ? ?svSocket_0.9-51 ? ?TinnR_1.0.3
> R2HTML_2.2 ? ? ? ? Hmisc_3.8-3
> [13] survival_2.36-9
>
> loaded via a namespace (and not attached):
> [1] cluster_1.14.0 grid_2.13.1 ? ?nlme_3.1-102 ? svMisc_0.9-63 ?tools_2.13.1
>
> Note that this is the sessionInfo from an interactive session. I don't know
> of an obvious way to provide you the sessionInfo of the session that is
> started by R CMD check (Assuming that at that point, an 'actual' R session
> has actually been started - it appears the error occurs before any 'real
> work' is started).
>
>
> Nick Sabbe
> --
> ping: nick.sabbe at ugent.be
> link: http://biomath.ugent.be
> wink: A1.056, Coupure Links 653, 9000 Gent
> ring: 09/264.59.36
>
> -- Do Not Disapprove
>
>
>
>
>> -----Original Message-----
>> From: henrik.bengtsson at gmail.com [mailto:henrik.bengtsson at gmail.com] On
>> Behalf Of Henrik Bengtsson
>> Sent: donderdag 22 september 2011 17:59
>> To: Duncan Murdoch
>> Cc: Nick Sabbe; r-devel at r-project.org
>> Subject: Re: [Rd] R CMD check file issues
>>
>> I'm on Windows 7 (64-bit) and everything works perfectly. ?Obviously,
>> there is either another process locking down a file with the same name
>> or the directory doesn't exist at the time of the file() call.
>>
>> Now to the most important question ?...what's your sessionInfo()?
>>
>> /Henrik
>>
>> On Thu, Sep 22, 2011 at 5:33 AM, Duncan Murdoch
>> <murdoch.duncan at gmail.com> wrote:
>> > On 11-09-22 8:30 AM, Nick Sabbe wrote:
>> >>
>> >> Hi Duncan (and others).
>> >>
>> >> I've just turned off my virus scanner (MS Forefront Endpoint
>> Protection).
>> >>
>> >> The issue persists. It appears that the first time I call R CMD
>> check, it
>> >> deletes the previous rcheck folder, but tries to proceed before it
>> is
>> >> actually gone. By the time I reissue the command, the folder is
>> truly
>> >> gone,
>> >> and the R CMD check can safely do its work.
>> >>
>> >> Is anyone else here using Win7 (32bit) and successfully
>> building/checking
>> >> R
>> >> packages? Perhaps I'm the only one who has treaded this path :-)
>> >
>> > I do use Win7 on one machine, and have seen odd things happen, but
>> not what
>> > you describe.
>> >
>> > I imagine a simple workaround for you would be to delete the folder
>> before
>> > you call R CMD check (i.e. wrap R CMD check in a batch file to do
>> that), but
>> > it would be nice if that were not necessary.
>> >
>> > Duncan Murdoch
>> >
>> >>
>> >>
>> >> Nick Sabbe
>> >> --
>> >> ping: nick.sabbe at ugent.be
>> >> link: http://biomath.ugent.be
>> >> wink: A1.056, Coupure Links 653, 9000 Gent
>> >> ring: 09/264.59.36
>> >>
>> >> -- Do Not Disapprove
>> >>
>> >>
>> >>
>> >>
>> >>> -----Original Message-----
>> >>> From: Duncan Murdoch [mailto:murdoch.duncan at gmail.com]
>> >>> Sent: donderdag 22 september 2011 14:20
>> >>> To: Nick Sabbe
>> >>> Cc: r-devel at r-project.org
>> >>> Subject: Re: [Rd] R CMD check file issues
>> >>>
>> >>> On 11-09-22 7:53 AM, Nick Sabbe wrote:
>> >>>>
>> >>>> This problem is likely to be specific to Windows, and particularly
>> >>>
>> >>> Win7.
>> >>>
>> >>> The symptoms sound like interference from an anti-virus checker.
>> >>>
>> >>> Duncan Murdoch
>> >>>
>> >>>>
>> >>>>
>> >>>> After a successful build of a package (R CMD build addendum), I
>> >>>
>> >>> immediately
>> >>>>
>> >>>> run an R CMD check for the same package.
>> >>>>
>> >>>> Not always, but _very_ often, I get the following error:
>> >>>>
>> >>>> C:\Users\nisabbe\Documents\@Doctoraat\R>R CMD check addendum
>> >>>>
>> >>>> Loading required package: tcltk
>> >>>>
>> >>>> Loading Tcl/Tk interface ... done
>> >>>>
>> >>>> Loading required package: Hmisc
>> >>>>
>> >>>> Loading required package: survival
>> >>>>
>> >>>> Loading required package: stats
>> >>>>
>> >>>> Loading required package: graphics
>> >>>>
>> >>>> Loading required package: splines
>> >>>>
>> >>>>
>> >>>>
>> >>>> Attaching package: 'Hmisc'
>> >>>>
>> >>>>
>> >>>>
>> >>>> The following object(s) are masked from 'package:survival':
>> >>>>
>> >>>>
>> >>>>
>> >>>> ? ? ?untangle.specials
>> >>>>
>> >>>>
>> >>>>
>> >>>> The following object(s) are masked from 'package:base':
>> >>>>
>> >>>>
>> >>>>
>> >>>> ? ? ?format.pval, round.POSIXt, trunc.POSIXt, units
>> >>>>
>> >>>>
>> >>>>
>> >>>> Loading required package: R2HTML
>> >>>>
>> >>>> Warning in file(filename, "wt") :
>> >>>>
>> >>>> ? ?cannot open file
>> >>>> 'C:/Users/nisabbe/Documents/@Doctoraat/R/addendum.Rcheck/00ch
>> >>>>
>> >>>> eck.log': Permission denied
>> >>>>
>> >>>> Error in file(filename, "wt") : cannot open the connection
>> >>>>
>> >>>> Execution halted
>> >>>>
>> >>>>
>> >>>>
>> >>>> If, after this, I immediately reissue the R CMD check command, it
>> >>>
>> >>> works,
>> >>>>
>> >>>> without the error.
>> >>>>
>> >>>> I think this has something to do with how Win7 processes file
>> >>>
>> >>> handling
>> >>>>
>> >>>> (there are known issues even noticeable in windows explorer), but
>> >>>
>> >>> perhaps
>> >>>>
>> >>>> there is a way of circumventing this? It would be greatly
>> >>>
>> >>> appreciated, as
>> >>>>
>> >>>> this issue is preventing automation of build/check/install
>> scripts.
>> >>>>
>> >>>>
>> >>>>
>> >>>> Suggestions will be greatly appreciated.
>> >>>>
>> >>>>
>> >>>>
>> >>>> Nick Sabbe
>> >>>>
>> >>>> --
>> >>>>
>> >>>> ping: nick.sabbe at ugent.be
>> >>>>
>> >>>> link:<http://biomath.ugent.be/> ? http://biomath.ugent.be
>> >>>>
>> >>>> wink: A1.056, Coupure Links 653, 9000 Gent
>> >>>>
>> >>>> ring: 09/264.59.36
>> >>>>
>> >>>>
>> >>>>
>> >>>> -- Do Not Disapprove
>> >>>>
>> >>>>
>> >>>>
>> >>>>
>> >>>> ? ? ? ?[[alternative HTML version deleted]]
>> >>>>
>> >>>> ______________________________________________
>> >>>> R-devel at r-project.org mailing list
>> >>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>> >>
>> >>
>> >
>> > ______________________________________________
>> > R-devel at r-project.org mailing list
>> > https://stat.ethz.ch/mailman/listinfo/r-devel
>> >
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From ripley at stats.ox.ac.uk  Sun Sep 25 17:43:43 2011
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sun, 25 Sep 2011 16:43:43 +0100 (BST)
Subject: [Rd] R CMD check file issues
In-Reply-To: <CAFDcVCQPBZZy2QC+PY4+UfjTBM+BckjQdd6QHEThgJgpCfBi=A@mail.gmail.com>
References: <4e7b2236.9a58df0a.3724.7ee5SMTPIN_ADDED@mx.google.com>
	<4E7B27FE.6050804@gmail.com>
	<4e7b2a5a.d1c9e30a.0f61.ffffa3c8SMTPIN_ADDED@mx.google.com>
	<4E7B2AFF.8010904@gmail.com>
	<CAFDcVCSaGSAL4jxvMWk2ftLAV-B3_Z2c9YhmrKvVB=TDzVeqQw@mail.gmail.com>
	<4e7edfa1.ca17440a.5f2f.ffff99fbSMTPIN_ADDED@mx.google.com>
	<CAFDcVCQPBZZy2QC+PY4+UfjTBM+BckjQdd6QHEThgJgpCfBi=A@mail.gmail.com>
Message-ID: <alpine.LFD.2.02.1109251643180.3338@gannet.stats.ox.ac.uk>

On Sun, 25 Sep 2011, Henrik Bengtsson wrote:

> On Sun, Sep 25, 2011 at 12:58 AM, Nick Sabbe <nick.sabbe at ugent.be> wrote:
>> Here you go (though I doubt it will be actually helpful):
>>
>> R version 2.13.1 (2011-07-08)
>> Platform: i386-pc-mingw32/i386 (32-bit)
>
> It is useful, especially to know which version of R you are running
> (at times when error report are posted it is only late in the
> discussion it is found out it is for an old version of R).
>
> FYI, checking the SVN log it seems that Brian Ripley has added some
> protection/workarounds for your race condition in R rev 57047.  So try
> with a new R 2.13.2RC or R devel.

Actually, for the one I see, and only in R-devel.

>
> /Henrik
>
>>
>> locale:
>> [1] LC_COLLATE=Dutch_Belgium.1252 ?LC_CTYPE=Dutch_Belgium.1252
>> LC_MONETARY=Dutch_Belgium.1252 LC_NUMERIC=C
>> [5] LC_TIME=Dutch_Belgium.1252
>>
>> attached base packages:
>> [1] grDevices datasets ?splines ? graphics ?stats ? ? tcltk ? ? utils
>> methods ? base
>>
>> other attached packages:
>> ?[1] addendum_1.4 ? ? ? snowfall_1.84 ? ? ?snow_0.3-7 ? ? ? ? mgcv_1.7-6
>> rgl_0.92.798 ? ? ? glmnet_1.7
>> ?[7] Matrix_0.9996875-3 lattice_0.19-33 ? ?svSocket_0.9-51 ? ?TinnR_1.0.3
>> R2HTML_2.2 ? ? ? ? Hmisc_3.8-3
>> [13] survival_2.36-9
>>
>> loaded via a namespace (and not attached):
>> [1] cluster_1.14.0 grid_2.13.1 ? ?nlme_3.1-102 ? svMisc_0.9-63 ?tools_2.13.1
>>
>> Note that this is the sessionInfo from an interactive session. I don't know
>> of an obvious way to provide you the sessionInfo of the session that is
>> started by R CMD check (Assuming that at that point, an 'actual' R session
>> has actually been started - it appears the error occurs before any 'real
>> work' is started).
>>
>>
>> Nick Sabbe
>> --
>> ping: nick.sabbe at ugent.be
>> link: http://biomath.ugent.be
>> wink: A1.056, Coupure Links 653, 9000 Gent
>> ring: 09/264.59.36
>>
>> -- Do Not Disapprove
>>
>>
>>
>>
>>> -----Original Message-----
>>> From: henrik.bengtsson at gmail.com [mailto:henrik.bengtsson at gmail.com] On
>>> Behalf Of Henrik Bengtsson
>>> Sent: donderdag 22 september 2011 17:59
>>> To: Duncan Murdoch
>>> Cc: Nick Sabbe; r-devel at r-project.org
>>> Subject: Re: [Rd] R CMD check file issues
>>>
>>> I'm on Windows 7 (64-bit) and everything works perfectly. ?Obviously,
>>> there is either another process locking down a file with the same name
>>> or the directory doesn't exist at the time of the file() call.
>>>
>>> Now to the most important question ?...what's your sessionInfo()?
>>>
>>> /Henrik
>>>
>>> On Thu, Sep 22, 2011 at 5:33 AM, Duncan Murdoch
>>> <murdoch.duncan at gmail.com> wrote:
>>>> On 11-09-22 8:30 AM, Nick Sabbe wrote:
>>>>>
>>>>> Hi Duncan (and others).
>>>>>
>>>>> I've just turned off my virus scanner (MS Forefront Endpoint
>>> Protection).
>>>>>
>>>>> The issue persists. It appears that the first time I call R CMD
>>> check, it
>>>>> deletes the previous rcheck folder, but tries to proceed before it
>>> is
>>>>> actually gone. By the time I reissue the command, the folder is
>>> truly
>>>>> gone,
>>>>> and the R CMD check can safely do its work.
>>>>>
>>>>> Is anyone else here using Win7 (32bit) and successfully
>>> building/checking
>>>>> R
>>>>> packages? Perhaps I'm the only one who has treaded this path :-)
>>>>
>>>> I do use Win7 on one machine, and have seen odd things happen, but
>>> not what
>>>> you describe.
>>>>
>>>> I imagine a simple workaround for you would be to delete the folder
>>> before
>>>> you call R CMD check (i.e. wrap R CMD check in a batch file to do
>>> that), but
>>>> it would be nice if that were not necessary.
>>>>
>>>> Duncan Murdoch
>>>>
>>>>>
>>>>>
>>>>> Nick Sabbe
>>>>> --
>>>>> ping: nick.sabbe at ugent.be
>>>>> link: http://biomath.ugent.be
>>>>> wink: A1.056, Coupure Links 653, 9000 Gent
>>>>> ring: 09/264.59.36
>>>>>
>>>>> -- Do Not Disapprove
>>>>>
>>>>>
>>>>>
>>>>>
>>>>>> -----Original Message-----
>>>>>> From: Duncan Murdoch [mailto:murdoch.duncan at gmail.com]
>>>>>> Sent: donderdag 22 september 2011 14:20
>>>>>> To: Nick Sabbe
>>>>>> Cc: r-devel at r-project.org
>>>>>> Subject: Re: [Rd] R CMD check file issues
>>>>>>
>>>>>> On 11-09-22 7:53 AM, Nick Sabbe wrote:
>>>>>>>
>>>>>>> This problem is likely to be specific to Windows, and particularly
>>>>>>
>>>>>> Win7.
>>>>>>
>>>>>> The symptoms sound like interference from an anti-virus checker.
>>>>>>
>>>>>> Duncan Murdoch
>>>>>>
>>>>>>>
>>>>>>>
>>>>>>> After a successful build of a package (R CMD build addendum), I
>>>>>>
>>>>>> immediately
>>>>>>>
>>>>>>> run an R CMD check for the same package.
>>>>>>>
>>>>>>> Not always, but _very_ often, I get the following error:
>>>>>>>
>>>>>>> C:\Users\nisabbe\Documents\@Doctoraat\R>R CMD check addendum
>>>>>>>
>>>>>>> Loading required package: tcltk
>>>>>>>
>>>>>>> Loading Tcl/Tk interface ... done
>>>>>>>
>>>>>>> Loading required package: Hmisc
>>>>>>>
>>>>>>> Loading required package: survival
>>>>>>>
>>>>>>> Loading required package: stats
>>>>>>>
>>>>>>> Loading required package: graphics
>>>>>>>
>>>>>>> Loading required package: splines
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>> Attaching package: 'Hmisc'
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>> The following object(s) are masked from 'package:survival':
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>> ? ? ?untangle.specials
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>> The following object(s) are masked from 'package:base':
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>> ? ? ?format.pval, round.POSIXt, trunc.POSIXt, units
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>> Loading required package: R2HTML
>>>>>>>
>>>>>>> Warning in file(filename, "wt") :
>>>>>>>
>>>>>>> ? ?cannot open file
>>>>>>> 'C:/Users/nisabbe/Documents/@Doctoraat/R/addendum.Rcheck/00ch
>>>>>>>
>>>>>>> eck.log': Permission denied
>>>>>>>
>>>>>>> Error in file(filename, "wt") : cannot open the connection
>>>>>>>
>>>>>>> Execution halted
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>> If, after this, I immediately reissue the R CMD check command, it
>>>>>>
>>>>>> works,
>>>>>>>
>>>>>>> without the error.
>>>>>>>
>>>>>>> I think this has something to do with how Win7 processes file
>>>>>>
>>>>>> handling
>>>>>>>
>>>>>>> (there are known issues even noticeable in windows explorer), but
>>>>>>
>>>>>> perhaps
>>>>>>>
>>>>>>> there is a way of circumventing this? It would be greatly
>>>>>>
>>>>>> appreciated, as
>>>>>>>
>>>>>>> this issue is preventing automation of build/check/install
>>> scripts.
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>> Suggestions will be greatly appreciated.
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>> Nick Sabbe
>>>>>>>
>>>>>>> --
>>>>>>>
>>>>>>> ping: nick.sabbe at ugent.be
>>>>>>>
>>>>>>> link:<http://biomath.ugent.be/> ? http://biomath.ugent.be
>>>>>>>
>>>>>>> wink: A1.056, Coupure Links 653, 9000 Gent
>>>>>>>
>>>>>>> ring: 09/264.59.36
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>> -- Do Not Disapprove
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>> ? ? ? ?[[alternative HTML version deleted]]
>>>>>>>
>>>>>>> ______________________________________________
>>>>>>> R-devel at r-project.org mailing list
>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>>
>>>>>
>>>>
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From simon.urbanek at r-project.org  Sun Sep 25 22:06:07 2011
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Sun, 25 Sep 2011 16:06:07 -0400
Subject: [Rd] cbind() crashes on raw vectors
In-Reply-To: <4E7CF03F.7090100@fhcrc.org>
References: <4E7CF03F.7090100@fhcrc.org>
Message-ID: <22DD113B-230D-482C-9894-2EB0D6CC6B67@r-project.org>

Thanks, now fixed.
Simon


On Sep 23, 2011, at 4:46 PM, Herv? Pag?s wrote:

> Hi,
> 
> cbind() doesn't seem to like raw vectors:
> 
> > df <- cbind(a=integer(4000), b=raw(4000))
> > df
> *** glibc detected *** /home/hpages/R-2.13.1/bin/exec/R: malloc(): memory corruption: 0x0000000002d73ca0 ***
> ======= Backtrace: =========
> /lib/x86_64-linux-gnu/libc.so.6(+0x79d7a)[0x7f3592b91d7a]
> /lib/x86_64-linux-gnu/libc.so.6(__libc_malloc+0x6e)[0x7f3592b9431e]
> /lib/libreadline.so.5(xmalloc+0x6)[0x7f3592620ab6]
> /lib/libreadline.so.5(add_history+0xbe)[0x7f359262136e]
> /home/hpages/R-2.13.1/lib/libR.so(+0x1b6538)[0x7f35936bd538]
> /lib/libreadline.so.5(rl_callback_read_char+0x8c)[0x7f359261cb1c]
> /home/hpages/R-2.13.1/lib/libR.so(+0x1b6f74)[0x7f35936bdf74]
> /home/hpages/R-2.13.1/lib/libR.so(Rf_ReplIteration+0xe7)[0x7f3593610eb7]
> /home/hpages/R-2.13.1/lib/libR.so(+0x10a260)[0x7f3593611260]
> /home/hpages/R-2.13.1/lib/libR.so(run_Rmainloop+0x50)[0x7f3593611780]
> /home/hpages/R-2.13.1/bin/exec/R(main+0x1b)[0x40085b]
> /lib/x86_64-linux-gnu/libc.so.6(__libc_start_main+0xff)[0x7f3592b36eff]
> /home/hpages/R-2.13.1/bin/exec/R[0x400779]
> ======= Memory map: ========
> 00400000-00401000 r-xp 00000000 08:01 3811201  /home/hpages/R-2.13.1/bin/exec/R
> 00600000-00601000 r--p 00000000 08:01 3811201  /home/hpages/R-2.13.1/bin/exec/R
> 00601000-00602000 rw-p 00001000 08:01 3811201  /home/hpages/R-2.13.1/bin/exec/R
> 02583000-03b16000 rw-p 00000000 00:00 0  [heap]
> 7f358c000000-7f358c021000 rw-p 00000000 00:00 0
> 7f358c021000-7f3590000000 ---p 00000000 00:00 0
> 7f3590342000-7f3590357000 r-xp 00000000 08:06 8155  /lib/x86_64-linux-gnu/libgcc_s.so.1
> 7f3590357000-7f3590556000 ---p 00015000 08:06 8155  /lib/x86_64-linux-gnu/libgcc_s.so.1
> 7f3590556000-7f3590557000 r--p 00014000 08:06 8155  /lib/x86_64-linux-gnu/libgcc_s.so.1
> 7f3590557000-7f3590558000 rw-p 00015000 08:06 8155  /lib/x86_64-linux-gnu/libgcc_s.so.1
> 7f3590558000-7f35905c4000 r-xp 00000000 08:01 3818237  /home/hpages/R-2.13.1/library/stats/libs/stats.so
> 7f35905c4000-7f35907c3000 ---p 0006c000 08:01 3818237  /home/hpages/R-2.13.1/library/stats/libs/stats.so
> 7f35907c3000-7f35907c5000 r--p 0006b000 08:01 3818237  /home/hpages/R-2.13.1/library/stats/libs/stats.so
> 7f35907c5000-7f35907c7000 rw-p 0006d000 08:01 3818237  /home/hpages/R-2.13.1/library/stats/libs/stats.so
> 7f35907c7000-7f359083a000 rw-p 00000000 00:00 0
> 7f359083a000-7f359085c000 r-xp 00000000 08:01 3817784  /home/hpages/R-2.13.1/library/grDevices/libs/grDevices.so
> 7f359085c000-7f3590a5b000 ---p 00022000 08:01 3817784  /home/hpages/R-2.13.1/library/grDevices/libs/grDevices.so
> 7f3590a5b000-7f3590a5c000 r--p 00021000 08:01 3817784  /home/hpages/R-2.13.1/library/grDevices/libs/grDevices.so
> 7f3590a5c000-7f3590a5d000 rw-p 00022000 08:01 3817784  /home/hpages/R-2.13.1/library/grDevices/libs/grDevices.so
> 7f3590b61000-7f3590b63000 r-xp 00000000 08:07 671027  /usr/lib/x86_64-linux-gnu/gconv/ISO8859-1.so
> 7f3590b63000-7f3590d62000 ---p 00002000 08:07 671027  /usr/lib/x86_64-linux-gnu/gconv/ISO8859-1.so
> 7f3590d62000-7f3590d63000 r--p 00001000 08:07 671027  /usr/lib/x86_64-linux-gnu/gconv/ISO8859-1.so
> 7f3590d63000-7f3590d64000 rw-p 00002000 08:07 671027  /usr/lib/x86_64-linux-gnu/gconv/ISO8859-1.so
> 7f3590d64000-7f3590de6000 rw-p 00000000 00:00 0
> 7f3590de6000-7f3590ded000 r-xp 00000000 08:01 3818288  /home/hpages/R-2.13.1/library/methods/libs/methods.so
> 7f3590ded000-7f3590fec000 ---p 00007000 08:01 3818288  /home/hpages/R-2.13.1/library/methods/libs/methods.so
> 7f3590fec000-7f3590fed000 r--p 00006000 08:01 3818288  /home/hpages/R-2.13.1/library/methods/libs/methods.so
> 7f3590fed000-7f3590fee000 rw-p 00007000 08:01 3818288  /home/hpages/R-2.13.1/library/methods/libs/methods.so
> 7f3590fee000-7f3590ffa000 r-xp 00000000 08:06 8319  /lib/x86_64-linux-gnu/libnss_files-2.13.so
> 7f3590ffa000-7f35911f9000 ---p 0000c000 08:06 8319  /lib/x86_64-linux-gnu/libnss_files-2.13.so
> 7f35911f9000-7f35911fa000 r--p 0000b000 08:06 8319  /lib/x86_64-linux-gnu/libnss_files-2.13.so
> 7f35911fa000-7f35911fb000 rw-p 0000c000 08:06 8319  /lib/x86_64-linux-gnu/libnss_files-2.13.so
> 7f35911fb000-7f3591206000 r-xp 00000000 08:06 8321  /lib/x86_64-linux-gnu/libnss_nis-2.13.so
> 7f3591206000-7f3591405000 ---p 0000b000 08:06 8321  /lib/x86_64-linux-gnu/libnss_nis-2.13.so
> 7f3591405000-7f3591406000 r--p 0000a000 08:06 8321  /lib/x86_64-linux-gnu/libnss_nis-2.13.so
> 7f3591406000-7f3591407000 rw-p 0000b000 08:06 8321  /lib/x86_64-linux-gnu/libnss_nis-2.13.so
> 7f3591407000-7f359141e000 r-xp 00000000 08:06 8316  /lib/x86_64-linux-gnu/libnsl-2.13.so
> 7f359141e000-7f359161d000 ---p 00017000 08:06 8316  /lib/x86_64-linux-gnu/libnsl-2.13.so
> 7f359161d000-7f359161e000 r--p 00016000 08:06 8316  /lib/x86_64-linux-gnu/libnsl-2.13.so
> 7f359161e000-7f359161f000 rw-p 00017000 08:06 8316  /lib/x86_64-linux-gnu/libnsl-2.13.so
> 7f359161f000-7f3591621000 rw-p 00000000 00:00 0
> 7f3591621000-7f3591629000 r-xp 00000000 08:06 8317  /lib/x86_64-linux-gnu/libnss_compat-2.13.so
> 7f3591629000-7f3591828000 ---p 00008000 08:06 8317  /lib/x86_64-linux-gnu/libnss_compat-2.13.so
> 7f3591828000-7f3591829000 r--p 00007000 08:06 8317  /lib/x86_64-linux-gnu/libnss_compat-2.13.so
> 7f3591829000-7f359182a000 rw-p 00008000 08:06 8317  /lib/x86_64-linux-gnu/libnss_compat-2.13.so
> 7f359182a000-7f3591d21000 r--p 00000000 08:07 590549  /usr/lib/locale/locale-archive
> 7f3591d21000-7f3591d61000 r-xp 00000000 08:06 8139  /lib/libncurses.so.5.7
> 7f3591d61000-7f3591f60000 ---p 00040000 08:06 8139  /lib/libncurses.so.5.7
> 7f3591f60000-7f3591f64000 r--p 0003f000 08:06 8139  /lib/libncurses.so.5.7
> 7f3591f64000-7f3591f65000 rw-p 00043000 08:06 8139  /lib/libncurses.so.5.7
> 7f3591f65000-7f3591f6c000 r-xp 00000000 08:06 8326  /lib/x86_64-linux-gnu/librt-2.13.so
> 7f3591f6c000-7f359216b000 ---p 00007000 08:06 8326  /lib/x86_64-linux-gnu/librt-2.13.so
> 7f359216b000-7f359216c000 r--p 00006000 08:06 8326  /lib/x86_64-linux-gnu/librt-2.13.soAborted
> 
> This is with R 2.13.1 but it also crashes recent R devel.
> 
> Thanks,
> H.
> 
> > sessionInfo()
> R version 2.13.1 (2011-07-08)
> Platform: x86_64-unknown-linux-gnu (64-bit)
> 
> locale:
> [1] LC_CTYPE=en_CA.UTF-8       LC_NUMERIC=C
> [3] LC_TIME=en_CA.UTF-8        LC_COLLATE=en_CA.UTF-8
> [5] LC_MONETARY=C              LC_MESSAGES=en_CA.UTF-8
> [7] LC_PAPER=en_CA.UTF-8       LC_NAME=C
> [9] LC_ADDRESS=C               LC_TELEPHONE=C
> [11] LC_MEASUREMENT=en_CA.UTF-8 LC_IDENTIFICATION=C
> 
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
> 
> -- 
> Herv? Pag?s
> 
> Program in Computational Biology
> Division of Public Health Sciences
> Fred Hutchinson Cancer Research Center
> 1100 Fairview Ave. N, M1-B514
> P.O. Box 19024
> Seattle, WA 98109-1024
> 
> E-mail: hpages at fhcrc.org
> Phone:  (206) 667-5791
> Fax:    (206) 667-1319
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 


From hankin.robin at gmail.com  Tue Sep 27 22:35:08 2011
From: hankin.robin at gmail.com (robin hankin)
Date: Wed, 28 Sep 2011 09:35:08 +1300
Subject: [Rd] array extraction
Message-ID: <CAHHjBM5eG0tc_D-XpFTroRT+Yv1yHYdL+RgDh+xkH3WpT8MW5w@mail.gmail.com>

hello everyone.

Look at the following R idiom:

 a <- array(1:30,c(3,5,2))
 M <- (matrix(1:15,c(3,5)) %% 4) < 2
 a[M,] <- 0

Now, I think that "a[M,]" has an unambiguous meaning (to a human).
However, the last line doesn't work as desired, but I expected it
to...and it recently took me an indecent amount of time to debug an
analogous case.  Just to be explicit, I would expect a[M,] to extract
a[i,j,] where M[i,j] is TRUE.  (Extract.Rd is perfectly clear here, and R is
behaving as documented).

The best I could cobble together was the following:

 ind <- which(M,arr.ind=TRUE)
 n <- 3
 ind <- cbind(kronecker(ind,rep(1,dim(a)[n])),rep(seq_len(dim(a)[n]),nrow(ind)))
 a[ind] <- 0


but the intent is hardly clear, certainly compared to "a[M,]"

I've been pondering how to implement such indexing, and its
generalization.

Suppose 'a' is a seven-dimensional array, and M1 a matrix and M2 a
three-dimensional array (both Boolean).  Then "a[,M1,,M2]" is a
natural generalization of the above.  I would want a[,M1,,M2] to
extract a[i1,i2,i3,i4,i5,i6,i7] where M1[i2,i3] and M[i5,i6,i7] are
TRUE.

One would need all(dim(a)[2:3] == dim(M1)) and all(dim(a)[5:7] ==
dim(M2)) for consistency.

Can any R-devel subscribers advise?




-- 
Robin Hankin
Uncertainty Analyst
hankin.robin at gmail.com


From sleepingwell at gmail.com  Tue Sep 27 23:39:56 2011
From: sleepingwell at gmail.com (Simon Knapp)
Date: Wed, 28 Sep 2011 07:39:56 +1000
Subject: [Rd] array extraction
In-Reply-To: <CAHHjBM5eG0tc_D-XpFTroRT+Yv1yHYdL+RgDh+xkH3WpT8MW5w@mail.gmail.com>
References: <CAHHjBM5eG0tc_D-XpFTroRT+Yv1yHYdL+RgDh+xkH3WpT8MW5w@mail.gmail.com>
Message-ID: <CAA+5f=2ib1zJpg-BC9KwzD3zGkyKBcYybVP5RwioJSR48w50+A@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20110928/0cf4e616/attachment.pl>

From hankin.robin at gmail.com  Wed Sep 28 00:12:26 2011
From: hankin.robin at gmail.com (robin hankin)
Date: Wed, 28 Sep 2011 11:12:26 +1300
Subject: [Rd] array extraction
In-Reply-To: <CAA+5f=2ib1zJpg-BC9KwzD3zGkyKBcYybVP5RwioJSR48w50+A@mail.gmail.com>
References: <CAHHjBM5eG0tc_D-XpFTroRT+Yv1yHYdL+RgDh+xkH3WpT8MW5w@mail.gmail.com>
	<CAA+5f=2ib1zJpg-BC9KwzD3zGkyKBcYybVP5RwioJSR48w50+A@mail.gmail.com>
Message-ID: <CAHHjBM633nEhJ9eFA4asach6qQkwHnR6OuqcVYvhkscZOq5Raw@mail.gmail.com>

thank you Simon.

I find a[M] working to be unexpected, but consistent with (a close
reading of) Extract.Rd

Can we reproduce a[,M]?

[I would expect this to extract a[,j,k] where M[j,k] is TRUE]

try this:


> a <- array(1:30,c(3,5,2))
> M <- matrix(1:10,5,2) %% 3==1
> a[M]
 [1]  1  4  7 10 11 14 17 20 21 24 27 30

This is not doing what I would want a[,M] to do.




I'll checkout afill() right now....

best wishes


Robin


On Wed, Sep 28, 2011 at 10:39 AM, Simon Knapp <sleepingwell at gmail.com> wrote:
> a[M] gives the same as your `cobbled together' code.
>
> On Wed, Sep 28, 2011 at 6:35 AM, robin hankin <hankin.robin at gmail.com>
> wrote:
>>
>> hello everyone.
>>
>> Look at the following R idiom:
>>
>> ?a <- array(1:30,c(3,5,2))
>> ?M <- (matrix(1:15,c(3,5)) %% 4) < 2
>> ?a[M,] <- 0
>>
>> Now, I think that "a[M,]" has an unambiguous meaning (to a human).
>> However, the last line doesn't work as desired, but I expected it
>> to...and it recently took me an indecent amount of time to debug an
>> analogous case. ?Just to be explicit, I would expect a[M,] to extract
>> a[i,j,] where M[i,j] is TRUE. ?(Extract.Rd is perfectly clear here, and R
>> is
>> behaving as documented).
>>
>> The best I could cobble together was the following:
>>
>> ?ind <- which(M,arr.ind=TRUE)
>> ?n <- 3
>> ?ind <-
>> cbind(kronecker(ind,rep(1,dim(a)[n])),rep(seq_len(dim(a)[n]),nrow(ind)))
>> ?a[ind] <- 0
>>
>>
>> but the intent is hardly clear, certainly compared to "a[M,]"
>>
>> I've been pondering how to implement such indexing, and its
>> generalization.
>>
>> Suppose 'a' is a seven-dimensional array, and M1 a matrix and M2 a
>> three-dimensional array (both Boolean). ?Then "a[,M1,,M2]" is a
>> natural generalization of the above. ?I would want a[,M1,,M2] to
>> extract a[i1,i2,i3,i4,i5,i6,i7] where M1[i2,i3] and M[i5,i6,i7] are
>> TRUE.
>>
>> One would need all(dim(a)[2:3] == dim(M1)) and all(dim(a)[5:7] ==
>> dim(M2)) for consistency.
>>
>> Can any R-devel subscribers advise?
>>
>>
>>
>>
>> --
>> Robin Hankin
>> Uncertainty Analyst
>> hankin.robin at gmail.com
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>



-- 
Robin Hankin
Uncertainty Analyst
hankin.robin at gmail.com


From msuzen at mango-solutions.com  Wed Sep 28 01:23:53 2011
From: msuzen at mango-solutions.com (Mehmet Suzen)
Date: Wed, 28 Sep 2011 00:23:53 +0100
Subject: [Rd] read.csv behaviour
Message-ID: <3CBFCFB1FEFFA841BA83ADF2F2A9C6FA01AB2673@mango-data1.Mango.local>


This might be obvious but I was wondering if anyone knows quick and easy
way of writing out a CSV file with varying row lengths, ideally an
initial data read from a CSV file which has the same format. See example
below.


I found it quite strange that R cannot write it in one go, so one must
append blocks or post-process the file, is this true? (even Ruby can do
it!!) 

Otherwise it puts ,"","" or similar for missing column values in the
shorter length rows and fill=FALSE option do not work!

I don't want to post-process if possible.

See this post:
http://r.789695.n4.nabble.com/Re-read-csv-trap-td3301924.html

Example that generated Error!

writeLines(c("A,B,C,D",
             "1,a,b,c",
             "2,f,g,c",
             "3,a,i,j",
             "4,a,b,c",
             "5,d,e,f",
             "6,g,h,i,j,k,l,m,n"),
           con=file("test.csv"))

read.csv("test.csv")
try(read.csv("test.csv",fill=FALSE))
LEGAL NOTICE
This message is intended for the use o...{{dropped:10}}


From ted.harding at wlandres.net  Wed Sep 28 01:28:41 2011
From: ted.harding at wlandres.net ( (Ted Harding))
Date: Wed, 28 Sep 2011 00:28:41 +0100 (BST)
Subject: [Rd] array extraction
In-Reply-To: <CAHHjBM633nEhJ9eFA4asach6qQkwHnR6OuqcVYvhkscZOq5Raw@mail.gmail.com>
Message-ID: <XFMail.110928002841.ted.harding@wlandres.net>

Somewhat out of my depth here (I have only 2 arms, but am
swimming in waters which require 3): My interpretation is
that a and M are basically vectors, with dimension attributes,
accessed down the columns.

The array 'a' consists of 30 elements 1:30 in that order,
accessed by each of 3 rows for each of 5 columns in each
of two "layers", in that order of precedence.

The matrix M consusts of 15 elements, accessed by each
of 35 rows for each of 5 columns.

Thus a(M) treats M as an selection vector, ignoring dimension,
and reads along a and at the same time along M, selecting
according to TRUE of FALSE. Then, when it gets to the end
of the first "layer" in 'a' it re-cycles M.

When I tried a[M,] I got

  a[M,]
  # Error in a[M, ] : incorrect number of dimensions

I infer that it is treating the M as a vector, so there
are only 2 dimensions in a[M,] instead of 3. So try:

  a[M,,]
  # Error: (subscript) logical subscript too long

which is not surprising since one is applying a 15-long
selector to the first dimension of 'a', which has only
length 3, just as in

  a[rep(TRUE,15),,]
  # Error: (subscript) logical subscript too long

which, interestingly, differs from

  a[rep(1,15),,]
  # (Output, which is what you'd expect, omitted)

(Hmm, out of my depth again ... ).

Well, maybe two arms is not enough when you need three
to swim in these waters; but it seems that one long swishy
tail will do nicely. That being said, I still find the
water quite murky!
Ted.

On 27-Sep-11 22:12:26, robin hankin wrote:
> thank you Simon.
> 
> I find a[M] working to be unexpected, but consistent with (a close
> reading of) Extract.Rd
> 
> Can we reproduce a[,M]?
> 
> [I would expect this to extract a[,j,k] where M[j,k] is TRUE]
> 
> try this:
> 
> 
>> a <- array(1:30,c(3,5,2))
>> M <- matrix(1:10,5,2) %% 3==1
>> a[M]
>  [1]  1  4  7 10 11 14 17 20 21 24 27 30
> 
> This is not doing what I would want a[,M] to do.
> 
> 
> 
> 
> I'll checkout afill() right now....
> 
> best wishes
> 
> 
> Robin
> 
> 
> On Wed, Sep 28, 2011 at 10:39 AM, Simon Knapp <sleepingwell at gmail.com>
> wrote:
>> a[M] gives the same as your `cobbled together' code.
>>
>> On Wed, Sep 28, 2011 at 6:35 AM, robin hankin <hankin.robin at gmail.com>
>> wrote:
>>>
>>> hello everyone.
>>>
>>> Look at the following R idiom:
>>>
>>> _a <- array(1:30,c(3,5,2))
>>> _M <- (matrix(1:15,c(3,5)) %% 4) < 2
>>> _a[M,] <- 0
>>>
>>> Now, I think that "a[M,]" has an unambiguous meaning (to a human).
>>> However, the last line doesn't work as desired, but I expected it
>>> to...and it recently took me an indecent amount of time to debug an
>>> analogous case. _Just to be explicit, I would expect a[M,] to extract
>>> a[i,j,] where M[i,j] is TRUE. _(Extract.Rd is perfectly clear here,
>>> and R
>>> is
>>> behaving as documented).
>>>
>>> The best I could cobble together was the following:
>>>
>>> _ind <- which(M,arr.ind=TRUE)
>>> _n <- 3
>>> _ind <-
>>> cbind(kronecker(ind,rep(1,dim(a)[n])),rep(seq_len(dim(a)[n]),nrow(ind)
>>> ))
>>> _a[ind] <- 0
>>>
>>>
>>> but the intent is hardly clear, certainly compared to "a[M,]"
>>>
>>> I've been pondering how to implement such indexing, and its
>>> generalization.
>>>
>>> Suppose 'a' is a seven-dimensional array, and M1 a matrix and M2 a
>>> three-dimensional array (both Boolean). _Then "a[,M1,,M2]" is a
>>> natural generalization of the above. _I would want a[,M1,,M2] to
>>> extract a[i1,i2,i3,i4,i5,i6,i7] where M1[i2,i3] and M[i5,i6,i7] are
>>> TRUE.
>>>
>>> One would need all(dim(a)[2:3] == dim(M1)) and all(dim(a)[5:7] ==
>>> dim(M2)) for consistency.
>>>
>>> Can any R-devel subscribers advise?
>>>
>>>
>>>
>>>
>>> --
>>> Robin Hankin
>>> Uncertainty Analyst
>>> hankin.robin at gmail.com
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
> 
> 
> 
> -- 
> Robin Hankin
> Uncertainty Analyst
> hankin.robin at gmail.com
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

--------------------------------------------------------------------
E-Mail: (Ted Harding) <ted.harding at wlandres.net>
Fax-to-email: +44 (0)870 094 0861
Date: 28-Sep-11                                       Time: 00:28:37
------------------------------ XFMail ------------------------------


From jdnewmil at dcn.davis.ca.us  Wed Sep 28 02:03:00 2011
From: jdnewmil at dcn.davis.ca.us (Jeff Newmiller)
Date: Tue, 27 Sep 2011 17:03:00 -0700
Subject: [Rd] [SPAM?]  [R] read.csv behaviour
In-Reply-To: <3CBFCFB1FEFFA841BA83ADF2F2A9C6FA01AB2673@mango-data1.Mango.local>
References: <3CBFCFB1FEFFA841BA83ADF2F2A9C6FA01AB2673@mango-data1.Mango.local>
Message-ID: <7f50c2f2-3f40-4a67-93c9-1c158a8c83c5@email.android.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20110927/05097c96/attachment.pl>

From thetroopermail at gmail.com  Tue Sep 27 20:38:13 2011
From: thetroopermail at gmail.com (jorgeA)
Date: Tue, 27 Sep 2011 11:38:13 -0700 (PDT)
Subject: [Rd] How to set values
In-Reply-To: <1316420916919-3823290.post@n4.nabble.com>
References: <1316420916919-3823290.post@n4.nabble.com>
Message-ID: <1317148693791-3848526.post@n4.nabble.com>

I'm not sure if I have understood your question, so I will put two
possibilities: 

1 - You have a variable called X ="0" and a variable called Y = "12" and
want that to be numeric. You can do this: 

X <- as.numeric(X) 
Y <- as.numeric(Y) 

2 - You have a variable called XY = "0","12" and want to make a list of
numeric. Then you can do something like this: 

XY <- as.numeric(unlist(strsplit(XY, ","))) 

I hope this helps, 

Best regards 
Jorge Aikes Junior

--
View this message in context: http://r.789695.n4.nabble.com/How-to-set-values-tp3823290p3848526.html
Sent from the R devel mailing list archive at Nabble.com.


From maechler at stat.math.ethz.ch  Wed Sep 28 12:18:12 2011
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Wed, 28 Sep 2011 12:18:12 +0200
Subject: [Rd] load.R patch suggestion
In-Reply-To: <4E71BF5E.20908@gmail.com>
References: <4E71BF5E.20908@gmail.com>
Message-ID: <20098.62564.966185.480273@stat.math.ethz.ch>

>>>>> Ben Bolker <bbolker at gmail.com>
>>>>>     on Thu, 15 Sep 2011 11:03:26 +0200 writes:

    > Inspired by

    > http://stackoverflow.com/questions/7487778/could-you-tell-me-what-this-error-means

    > I wrote the following very small (one-line) patch which
    > returns an *informative* error message when R tries to
    > load a zero-byte file rather than

    > Error in if (!grepl("RD[AX]2\n", magic)) { : argument is
    > of length zero

    >   I would guess that error messages with the word "magic"
    > in them would be disturbing to new users, who are probably
    > worried already that R is magic ...

:-)  indeed...

While it would not be a good idea to program around such error
messages in general, as each extra if(...) is executed everytime
the function is called, i.e. has a (albeit *very small*) penalty for
every correct call just for the sake of that message in the
erronous call case,
I do agree that it is worth here and so have added it (for
R-devel only).

Thank you, Ben.

    >   Ben Bolker


> ----------------------------------------------------------------------
> Index: load.R
> ===================================================================
> --- load.R	(revision 56743)
> +++ load.R	(working copy)
> @@ -25,6 +25,7 @@
>          ## Since the connection is not open this opens it in binary mode
>          ## and closes it again.
>          magic <- readChar(con, 5L, useBytes = TRUE)
> +        if (length(magic)==0) stop("empty (zero-byte) file")
>          if (!grepl("RD[AX]2\n", magic)) {
>              ## a check while we still know the call to load()
>              if(grepl("RD[ABX][12]\r", magic))
> 
> ----------------------------------------------------------------------


From jim at bitwrit.com.au  Wed Sep 28 12:17:20 2011
From: jim at bitwrit.com.au (Jim Lemon)
Date: Wed, 28 Sep 2011 20:17:20 +1000
Subject: [Rd] [R] read.csv behaviour
In-Reply-To: <3CBFCFB1FEFFA841BA83ADF2F2A9C6FA01AB2673@mango-data1.Mango.local>
References: <3CBFCFB1FEFFA841BA83ADF2F2A9C6FA01AB2673@mango-data1.Mango.local>
Message-ID: <4E82F430.7010104@bitwrit.com.au>

On 09/28/2011 09:23 AM, Mehmet Suzen wrote:
>
> This might be obvious but I was wondering if anyone knows quick and easy
> way of writing out a CSV file with varying row lengths, ideally an
> initial data read from a CSV file which has the same format. See example
> below.
>
>
> I found it quite strange that R cannot write it in one go, so one must
> append blocks or post-process the file, is this true? (even Ruby can do
> it!!)
>
> Otherwise it puts ,"","" or similar for missing column values in the
> shorter length rows and fill=FALSE option do not work!
>
> I don't want to post-process if possible.
>
> See this post:
> http://r.789695.n4.nabble.com/Re-read-csv-trap-td3301924.html
>
> Example that generated Error!
>
> writeLines(c("A,B,C,D",
>               "1,a,b,c",
>               "2,f,g,c",
>               "3,a,i,j",
>               "4,a,b,c",
>               "5,d,e,f",
>               "6,g,h,i,j,k,l,m,n"),
>             con=file("test.csv"))
>
> read.csv("test.csv")
> try(read.csv("test.csv",fill=FALSE))

Hi Mehmet,
The example doesn't need to call "file", writeLines does it for you. It 
worked for me:

  writeLines(c("A,B,C,D",
               "1,a,b,c",
               "2,f,g,c",
               "3,a,i,j",
               "4,a,b,c",
               "5,d,e,f",
               "6,g,h,i,j,k,l,m,n"),
             con="test.csv")

and to get the original object back, use:

readLines("test.csv")

The reason you can't use read.csv is that it returns a data frame, and 
that object can't have elements of unequal length. If you want an object 
with elements of unequal length, try:

as.list(readLines("test.csv"))

Jim


From bbolker at gmail.com  Wed Sep 28 14:19:22 2011
From: bbolker at gmail.com (Ben Bolker)
Date: Wed, 28 Sep 2011 12:19:22 +0000
Subject: [Rd] read.csv behaviour
References: <3CBFCFB1FEFFA841BA83ADF2F2A9C6FA01AB2673@mango-data1.Mango.local>
Message-ID: <loom.20110928T141727-917@post.gmane.org>

Mehmet Suzen <msuzen <at> mango-solutions.com> writes:

> This might be obvious but I was wondering if anyone knows quick and easy
> way of writing out a CSV file with varying row lengths, ideally an
> initial data read from a CSV file which has the same format. See example
> below.
> 
> writeLines(c("A,B,C,D",
>              "1,a,b,c",
>              "2,f,g,c",
>              "3,a,i,j",
>              "4,a,b,c",
>              "5,d,e,f",
>              "6,g,h,i,j,k,l,m,n"),
>            con=file("test.csv"))
> 

X <- read.csv("test.csv")


  It's not that pretty, but something like


tmpf <- function(x) paste(x[nzchar(x)],collapse=",")
writeLines(apply(as.matrix(X),1,tmpf),con="outfile.csv")

  might work


From michael.m.spiegel at gmail.com  Wed Sep 28 21:10:49 2011
From: michael.m.spiegel at gmail.com (Michael Spiegel)
Date: Wed, 28 Sep 2011 15:10:49 -0400
Subject: [Rd] serialize/unserialize vector improvement
Message-ID: <CANwu5-oZXZjThFof++sf9bE2xYt-1g60+HjhA3vogD7Qnm_m6Q@mail.gmail.com>

Hi folks,

I've attached a patch to the svn trunk that improves the performance
of the serialize/unserialize interface for vector types. The current
implementation: a) invokes the R_XDREncode operation for each element
of the vector type, and b) uses a switch statement to determine the
stream type for each element of the vector type. I've added
R_XDREncodeVector/R_XDRDecodeVector functions that accept N elements
at a time, and I've reorganized the implementation so that the stream
type is not queried once per element.

In the following microbenchmark (below), I've observed performance
improvements of about x2.4.  In a real benchmark that is using the
serialization interface to make MPI calls, I see about a 10%
improvement in performance.

Cheers,
--Michael

microbenchmark:

input <- matrix(1:100000000, 10000, 10000)
output <- serialize(input, NULL)
for(i in 1:10) { print(system.time(serialize(input, NULL))) }
for(i in 1:10) { print(system.time(unserialize(output))) }
-------------- next part --------------
A non-text attachment was scrubbed...
Name: serialize-vector-performance.patch
Type: text/x-patch
Size: 10234 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20110928/47381102/attachment.bin>

From k.jewell at campden.co.uk  Thu Sep 29 13:11:31 2011
From: k.jewell at campden.co.uk (Keith Jewell)
Date: Thu, 29 Sep 2011 12:11:31 +0100
Subject: [Rd] Finding inter-function dependencies within a package
Message-ID: <j61jp4$esl$1@dough.gmane.org>

Hi,

I'd like to know which functions in a package call one specific function.
I think I've seen a tool for identifying such dependencies, but now I can't 
find it :-(
Searches of help and R site search for keywords like function, call, tree, 
depend haven't helped :-(

Can anyone point me in the right direction?

Thanks in advance,

Keith Jewell


From r.m.krug at gmail.com  Thu Sep 29 13:15:53 2011
From: r.m.krug at gmail.com (Rainer M Krug)
Date: Thu, 29 Sep 2011 13:15:53 +0200
Subject: [Rd] Finding inter-function dependencies within a package
In-Reply-To: <j61jp4$esl$1@dough.gmane.org>
References: <j61jp4$esl$1@dough.gmane.org>
Message-ID: <CAGhLh6G3rqJSTbeSZrkSgMmQn5mu3oD1Mw8XRTCO-HpiVH=6oA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20110929/a9c9c9d0/attachment.pl>

From murdoch.duncan at gmail.com  Thu Sep 29 14:04:49 2011
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Thu, 29 Sep 2011 08:04:49 -0400
Subject: [Rd] Finding inter-function dependencies within a package
In-Reply-To: <j61jp4$esl$1@dough.gmane.org>
References: <j61jp4$esl$1@dough.gmane.org>
Message-ID: <4E845EE1.70808@gmail.com>

On 11-09-29 7:11 AM, Keith Jewell wrote:
> Hi,
>
> I'd like to know which functions in a package call one specific function.
> I think I've seen a tool for identifying such dependencies, but now I can't
> find it :-(
> Searches of help and R site search for keywords like function, call, tree,
> depend haven't helped :-(
>
> Can anyone point me in the right direction?

codetools::findGlobals could be used to do this.

Duncan Murdoch

>
> Thanks in advance,
>
> Keith Jewell
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From ronggui.huang at gmail.com  Thu Sep 29 18:44:37 2011
From: ronggui.huang at gmail.com (Wincent)
Date: Fri, 30 Sep 2011 00:44:37 +0800
Subject: [Rd] Warning: changing locked binding for ...
Message-ID: <CANQBBMu00yLvLTpL_MQpiNwPMidr1THSP5G4YegRBoxdfwgJkw@mail.gmail.com>

Dear all, I use the R R Under development (unstable) (2011-09-28 r57099).

When I load the RQDA package, it issues warnings. As the RQDA package
developer, what should I deal with such message? Thank you very much.

> library(gWidgetsRGtk2)
Loading required package: gWidgets
> library(RQDA)
Loading required package: DBI
Loading required package: RSQLite

Use 'RQDA()' to start the programe.

Warning: changing locked binding for ?stockIcons? in ?gWidgetsRGtk2?
whilst loading ?RQDA?
Warning: changing locked binding for ?updateStockIcons? in
?gWidgetsRGtk2? whilst loading ?RQDA?
Warning: changing locked binding for ?n? in ?gWidgets? whilst loading ?RQDA?

> sessionInfo()
R Under development (unstable) (2011-09-28 r57099)
Platform: i386-pc-mingw32/i386 (32-bit)

locale:
[1] LC_COLLATE=Chinese (Simplified)_People's Republic of China.936
LC_CTYPE=Chinese (Simplified)_People's Republic of China.936
[3] LC_MONETARY=Chinese (Simplified)_People's Republic of China.936
LC_NUMERIC=C
[5] LC_TIME=Chinese (Simplified)_People's Republic of China.936

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] RQDA_0.2-1           RSQLite_0.9-4        DBI_0.2-5
gWidgetsRGtk2_0.0-76 gWidgets_0.0-46

loaded via a namespace (and not attached):
[1] RGtk2_2.20.17 tools_2.14.0


-- 
Wincent Ronggui HUANG
Sociology Department of Fudan University
PhD of City University of Hong Kong
http://homepage.fudan.edu.cn/rghuang/cv/


From murdoch.duncan at gmail.com  Thu Sep 29 19:01:43 2011
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Thu, 29 Sep 2011 13:01:43 -0400
Subject: [Rd] Warning: changing locked binding for ...
In-Reply-To: <CANQBBMu00yLvLTpL_MQpiNwPMidr1THSP5G4YegRBoxdfwgJkw@mail.gmail.com>
References: <CANQBBMu00yLvLTpL_MQpiNwPMidr1THSP5G4YegRBoxdfwgJkw@mail.gmail.com>
Message-ID: <4E84A477.9090800@gmail.com>

On 29/09/2011 12:44 PM, Wincent wrote:
> Dear all, I use the R R Under development (unstable) (2011-09-28 r57099).
>
> When I load the RQDA package, it issues warnings. As the RQDA package
> developer, what should I deal with such message? Thank you very much.

Don't attempt to change variables in other packages.  Something that 
RQDA is doing is attempting to change stockIcons and updateStockIcons in 
the gWidgetsRGtk2 package.

Duncan Murdoch

> >  library(gWidgetsRGtk2)
> Loading required package: gWidgets
> >  library(RQDA)
> Loading required package: DBI
> Loading required package: RSQLite
>
> Use 'RQDA()' to start the programe.
>
> Warning: changing locked binding for ?stockIcons? in ?gWidgetsRGtk2?
> whilst loading ?RQDA?
> Warning: changing locked binding for ?updateStockIcons? in
> ?gWidgetsRGtk2? whilst loading ?RQDA?
> Warning: changing locked binding for ?n? in ?gWidgets? whilst loading ?RQDA?
>
> >  sessionInfo()
> R Under development (unstable) (2011-09-28 r57099)
> Platform: i386-pc-mingw32/i386 (32-bit)
>
> locale:
> [1] LC_COLLATE=Chinese (Simplified)_People's Republic of China.936
> LC_CTYPE=Chinese (Simplified)_People's Republic of China.936
> [3] LC_MONETARY=Chinese (Simplified)_People's Republic of China.936
> LC_NUMERIC=C
> [5] LC_TIME=Chinese (Simplified)_People's Republic of China.936
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> other attached packages:
> [1] RQDA_0.2-1           RSQLite_0.9-4        DBI_0.2-5
> gWidgetsRGtk2_0.0-76 gWidgets_0.0-46
>
> loaded via a namespace (and not attached):
> [1] RGtk2_2.20.17 tools_2.14.0
>
>


From jeffrey.horner at gmail.com  Thu Sep 29 23:00:42 2011
From: jeffrey.horner at gmail.com (Jeffrey Horner)
Date: Thu, 29 Sep 2011 16:00:42 -0500
Subject: [Rd] grep and PCRE fun
Message-ID: <CAD+yNFjsZcddyJ6KPuOfW93PLfoz7wzeGhX+iKt7s5wv=_0TZg@mail.gmail.com>

Hello,

I think I've found a bug in the C function do_grep located in
src/main/grep.c. It seems to affect both the latest revisions of
R-2-13-branch and trunk when compiling R without optimizations and
with it's own version of pcre located in src/extra, at least on ubuntu
10.04.

 According to the pcre_exec API (I presume the later versions), the
ovecsize argument must be a multiple of 3 , and the ovector argument
must point to a location that can hold at least ovecsize integers. All
the pcre_exec calls made by do_grep, save one, honors this. That one
call seems to overwrite areas of the stack it shouldn't. Here's the
smallest example I found that tickles the bug:

> grep("[^[:blank][:cntrl]]","\\n",perl=TRUE)
Error in grep("[^[:blank][:cntrl]]", "\\n", perl = TRUE) :
  negative length vectors are not allowed

As described above, this error occurs on ubuntu 10.04 when R is
compiled without optimizations ( I typically use CFLAGS="-ggdb"
CXXFLAGS="-ggdb" FFLAGS="-ggdb" ./configure --enable-R-shlib), and the
pcre_exec call executed from do_get overwrites the integer nmatches
and sets it to -1. This has the effect of making do_grep try and
allocate a results vector of length -1, which of course causes the
error message above.

I'd be interested to know if this bug happens on other platforms.

Below is my simple fix for R-2-13-branch (a similar fix works for
trunk as well).

Jeff

$ svn diff main/grep.c
Index: main/grep.c
===================================================================
--- main/grep.c	(revision 57110)
+++ main/grep.c	(working copy)
@@ -723,7 +723,7 @@
 {
     SEXP pat, text, ind, ans;
     regex_t reg;
-    int i, j, n, nmatches = 0, ov, rc;
+    int i, j, n, nmatches = 0, ov[3], rc;
     int igcase_opt, value_opt, perl_opt, fixed_opt, useBytes, invert;
     const char *spat = NULL;
     pcre *re_pcre = NULL /* -Wall */;
@@ -882,7 +882,7 @@
 	    if (fixed_opt)
 		LOGICAL(ind)[i] = fgrep_one(spat, s, useBytes, use_UTF8, NULL) >= 0;
 	    else if (perl_opt) {
-		if (pcre_exec(re_pcre, re_pe, s, strlen(s), 0, 0, &ov, 0) >= 0)
+		if (pcre_exec(re_pcre, re_pe, s, strlen(s), 0, 0, ov, 3) >= 0)
 		    INTEGER(ind)[i] = 1;
 	    } else {
 		if (!use_WC)


From jeffrey.horner at gmail.com  Thu Sep 29 23:34:01 2011
From: jeffrey.horner at gmail.com (Jeffrey Horner)
Date: Thu, 29 Sep 2011 16:34:01 -0500
Subject: [Rd] grep and PCRE fun
In-Reply-To: <CAD+yNFjsZcddyJ6KPuOfW93PLfoz7wzeGhX+iKt7s5wv=_0TZg@mail.gmail.com>
References: <CAD+yNFjsZcddyJ6KPuOfW93PLfoz7wzeGhX+iKt7s5wv=_0TZg@mail.gmail.com>
Message-ID: <CAD+yNFjAW88yWeagfvozg-bOvHa1QNup0U-Ov-9sEaN-g0E-2w@mail.gmail.com>

On Thu, Sep 29, 2011 at 4:00 PM, Jeffrey Horner
<jeffrey.horner at gmail.com> wrote:
> Hello,
>
> I think I've found a bug in the C function do_grep located in
> src/main/grep.c. It seems to affect both the latest revisions of
> R-2-13-branch and trunk when compiling R without optimizations and
> with it's own version of pcre located in src/extra, at least on ubuntu
> 10.04.
>
> ?According to the pcre_exec API (I presume the later versions), the
> ovecsize argument must be a multiple of 3 , and the ovector argument
> must point to a location that can hold at least ovecsize integers. All
> the pcre_exec calls made by do_grep, save one, honors this. That one
> call seems to overwrite areas of the stack it shouldn't. Here's the
> smallest example I found that tickles the bug:
>
>> grep("[^[:blank][:cntrl]]","\\n",perl=TRUE)
> Error in grep("[^[:blank][:cntrl]]", "\\n", perl = TRUE) :
> ?negative length vectors are not allowed

As many of you know, that regex is invalid. It's just the one I
happened upon that tickled the bug. It actually came from an error
that occurred when building R itself. Here's a snippet of my make log:

make[1]: Leaving directory `/home/hornerj/R-sources/branches/R-2-13-branch/po'
you should 'make docs' now ...
make[1]: Entering directory `/home/hornerj/R-sources/branches/R-2-13-branch/doc'
Error in grep("[^[:blank:][:cntrl:]]", unlist(Rd[sections == "TEXT"]),  :
  negative length vectors are not allowed
Calls: saveRDS -> <Anonymous> -> prepare2_Rd -> grep
Execution halted
make[1]: *** [NEWS.rds] Error 1

>
> As described above, this error occurs on ubuntu 10.04 when R is
> compiled without optimizations ( I typically use CFLAGS="-ggdb"
> CXXFLAGS="-ggdb" FFLAGS="-ggdb" ./configure --enable-R-shlib), and the
> pcre_exec call executed from do_get overwrites the integer nmatches
> and sets it to -1. This has the effect of making do_grep try and
> allocate a results vector of length -1, which of course causes the
> error message above.
>
> I'd be interested to know if this bug happens on other platforms.
>
> Below is my simple fix for R-2-13-branch (a similar fix works for
> trunk as well).
>
> Jeff
>
> $ svn diff main/grep.c
> Index: main/grep.c
> ===================================================================
> --- main/grep.c (revision 57110)
> +++ main/grep.c (working copy)
> @@ -723,7 +723,7 @@
> ?{
> ? ? SEXP pat, text, ind, ans;
> ? ? regex_t reg;
> - ? ?int i, j, n, nmatches = 0, ov, rc;
> + ? ?int i, j, n, nmatches = 0, ov[3], rc;
> ? ? int igcase_opt, value_opt, perl_opt, fixed_opt, useBytes, invert;
> ? ? const char *spat = NULL;
> ? ? pcre *re_pcre = NULL /* -Wall */;
> @@ -882,7 +882,7 @@
> ? ? ? ? ? ?if (fixed_opt)
> ? ? ? ? ? ? ? ?LOGICAL(ind)[i] = fgrep_one(spat, s, useBytes, use_UTF8, NULL) >= 0;
> ? ? ? ? ? ?else if (perl_opt) {
> - ? ? ? ? ? ? ? if (pcre_exec(re_pcre, re_pe, s, strlen(s), 0, 0, &ov, 0) >= 0)
> + ? ? ? ? ? ? ? if (pcre_exec(re_pcre, re_pe, s, strlen(s), 0, 0, ov, 3) >= 0)
> ? ? ? ? ? ? ? ? ? ?INTEGER(ind)[i] = 1;
> ? ? ? ? ? ?} else {
> ? ? ? ? ? ? ? ?if (!use_WC)
>


From hb at biostat.ucsf.edu  Thu Sep 29 23:34:50 2011
From: hb at biostat.ucsf.edu (Henrik Bengtsson)
Date: Thu, 29 Sep 2011 14:34:50 -0700
Subject: [Rd] grep and PCRE fun
In-Reply-To: <CAD+yNFjsZcddyJ6KPuOfW93PLfoz7wzeGhX+iKt7s5wv=_0TZg@mail.gmail.com>
References: <CAD+yNFjsZcddyJ6KPuOfW93PLfoz7wzeGhX+iKt7s5wv=_0TZg@mail.gmail.com>
Message-ID: <CAFDcVCRNqfMcRdh+-onLT3gVZc6HjgBNhpax_rBWS_Ya7FYivQ@mail.gmail.com>

On Thu, Sep 29, 2011 at 2:00 PM, Jeffrey Horner
<jeffrey.horner at gmail.com> wrote:
> Hello,
>
> I think I've found a bug in the C function do_grep located in
> src/main/grep.c. It seems to affect both the latest revisions of
> R-2-13-branch and trunk when compiling R without optimizations and
> with it's own version of pcre located in src/extra, at least on ubuntu
> 10.04.
>
> ?According to the pcre_exec API (I presume the later versions), the
> ovecsize argument must be a multiple of 3 , and the ovector argument
> must point to a location that can hold at least ovecsize integers. All
> the pcre_exec calls made by do_grep, save one, honors this. That one
> call seems to overwrite areas of the stack it shouldn't. Here's the
> smallest example I found that tickles the bug:
>
>> grep("[^[:blank][:cntrl]]","\\n",perl=TRUE)
> Error in grep("[^[:blank][:cntrl]]", "\\n", perl = TRUE) :
> ?negative length vectors are not allowed
>
> As described above, this error occurs on ubuntu 10.04 when R is
> compiled without optimizations ( I typically use CFLAGS="-ggdb"
> CXXFLAGS="-ggdb" FFLAGS="-ggdb" ./configure --enable-R-shlib), and the
> pcre_exec call executed from do_get overwrites the integer nmatches
> and sets it to -1. This has the effect of making do_grep try and
> allocate a results vector of length -1, which of course causes the
> error message above.
>
> I'd be interested to know if this bug happens on other platforms.

With R devel (2011-09-28 r57099) and R v2.13.1 patched (2011-09-05
r56953) on Windows 7 64-bit you get:

> grep("[^[:blank][:cntrl]]","\\n",perl=TRUE)
integer(0)

/Henrik

>
> Below is my simple fix for R-2-13-branch (a similar fix works for
> trunk as well).
>
> Jeff
>
> $ svn diff main/grep.c
> Index: main/grep.c
> ===================================================================
> --- main/grep.c (revision 57110)
> +++ main/grep.c (working copy)
> @@ -723,7 +723,7 @@
> ?{
> ? ? SEXP pat, text, ind, ans;
> ? ? regex_t reg;
> - ? ?int i, j, n, nmatches = 0, ov, rc;
> + ? ?int i, j, n, nmatches = 0, ov[3], rc;
> ? ? int igcase_opt, value_opt, perl_opt, fixed_opt, useBytes, invert;
> ? ? const char *spat = NULL;
> ? ? pcre *re_pcre = NULL /* -Wall */;
> @@ -882,7 +882,7 @@
> ? ? ? ? ? ?if (fixed_opt)
> ? ? ? ? ? ? ? ?LOGICAL(ind)[i] = fgrep_one(spat, s, useBytes, use_UTF8, NULL) >= 0;
> ? ? ? ? ? ?else if (perl_opt) {
> - ? ? ? ? ? ? ? if (pcre_exec(re_pcre, re_pe, s, strlen(s), 0, 0, &ov, 0) >= 0)
> + ? ? ? ? ? ? ? if (pcre_exec(re_pcre, re_pe, s, strlen(s), 0, 0, ov, 3) >= 0)
> ? ? ? ? ? ? ? ? ? ?INTEGER(ind)[i] = 1;
> ? ? ? ? ? ?} else {
> ? ? ? ? ? ? ? ?if (!use_WC)
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From Mark.Bravington at csiro.au  Fri Sep 30 02:07:39 2011
From: Mark.Bravington at csiro.au (Mark.Bravington at csiro.au)
Date: Fri, 30 Sep 2011 10:07:39 +1000
Subject: [Rd] Finding inter-function dependencies within a package
In-Reply-To: <j61jp4$esl$1@dough.gmane.org>
References: <j61jp4$esl$1@dough.gmane.org>
Message-ID: <3D59DF35E7CF3E42BA70C23BD5CBE6A85F5BD9F884@exvic-mbx04.nexus.csiro.au>

Hi Keith

'foodweb' and friends in the 'mvbutils' package should do what you're after. 

For example, I just tried this on the 'debug' package:

> ff <- foodweb( where=asNamespace( 'debug'))

> # Now either just eyeball the dependency graph that 'foodweb' produces, or more formally:

> callers.of( 'find.debug.HQ', ff) 
 [1] ".end.incarnation"          ".onLoad"                   "bp"                        "check.legality"           
 [5] "debug.eval.guts"           "debug.q"                   "debug.Recall"              "debug.with"               
 [9] "debug.within"              "dismiss.debug.window"      "enact.command.r"           "eval.catching.errors"     
[13] "evaluator"                 "find.active.control.frame" "get.mtraced.callers"       "launch.debug.windows"     
[17] "qqq"                       "set.global.debug.vars"     "stepping"                  "try2"                     

HTH
Mark

-- 
Mark Bravington
CSIRO Mathematical & Information Sciences
Marine Laboratory
Castray Esplanade
Hobart 7001
TAS

ph (+61) 3 6232 5118
fax (+61) 3 6232 5012
mob (+61) 438 315 623

Keith Jewell wrote:
> Hi,
> 
> I'd like to know which functions in a package call one specific
> function. 
> I think I've seen a tool for identifying such dependencies, but now I
> can't find it :-( Searches of help and R site search for keywords
> like function, call, tree, depend haven't helped :-(  
> 
> Can anyone point me in the right direction?
> 
> Thanks in advance,
> 
> Keith Jewell
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

From ronggui.huang at gmail.com  Fri Sep 30 04:04:04 2011
From: ronggui.huang at gmail.com (Wincent)
Date: Fri, 30 Sep 2011 10:04:04 +0800
Subject: [Rd] Warning: changing locked binding for ...
In-Reply-To: <4E84A477.9090800@gmail.com>
References: <CANQBBMu00yLvLTpL_MQpiNwPMidr1THSP5G4YegRBoxdfwgJkw@mail.gmail.com>
	<4E84A477.9090800@gmail.com>
Message-ID: <CANQBBMt4dNMB0EkV-aJ6+0N7R9KztJ0L0t9ZD433gWZqOYPByw@mail.gmail.com>

Duncan, thanks very much.

Yet, I don't recall I attempt to change any thing in the
gWidgetsRGtk2. Is there a way to trace what part of the code is trying
to do so?

Thanks.
Wincent

On 30 September 2011 01:01, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
> On 29/09/2011 12:44 PM, Wincent wrote:
>>
>> Dear all, I use the R R Under development (unstable) (2011-09-28 r57099).
>>
>> When I load the RQDA package, it issues warnings. As the RQDA package
>> developer, what should I deal with such message? Thank you very much.
>
> Don't attempt to change variables in other packages. ?Something that RQDA is
> doing is attempting to change stockIcons and updateStockIcons in the
> gWidgetsRGtk2 package.
>
> Duncan Murdoch
>
>> > ?library(gWidgetsRGtk2)
>> Loading required package: gWidgets
>> > ?library(RQDA)
>> Loading required package: DBI
>> Loading required package: RSQLite
>>
>> Use 'RQDA()' to start the programe.
>>
>> Warning: changing locked binding for ?stockIcons? in ?gWidgetsRGtk2?
>> whilst loading ?RQDA?
>> Warning: changing locked binding for ?updateStockIcons? in
>> ?gWidgetsRGtk2? whilst loading ?RQDA?
>> Warning: changing locked binding for ?n? in ?gWidgets? whilst loading
>> ?RQDA?
>>
>> > ?sessionInfo()
>> R Under development (unstable) (2011-09-28 r57099)
>> Platform: i386-pc-mingw32/i386 (32-bit)
>>
>> locale:
>> [1] LC_COLLATE=Chinese (Simplified)_People's Republic of China.936
>> LC_CTYPE=Chinese (Simplified)_People's Republic of China.936
>> [3] LC_MONETARY=Chinese (Simplified)_People's Republic of China.936
>> LC_NUMERIC=C
>> [5] LC_TIME=Chinese (Simplified)_People's Republic of China.936
>>
>> attached base packages:
>> [1] stats ? ? graphics ?grDevices utils ? ? datasets ?methods ? base
>>
>> other attached packages:
>> [1] RQDA_0.2-1 ? ? ? ? ? RSQLite_0.9-4 ? ? ? ?DBI_0.2-5
>> gWidgetsRGtk2_0.0-76 gWidgets_0.0-46
>>
>> loaded via a namespace (and not attached):
>> [1] RGtk2_2.20.17 tools_2.14.0
>>
>>
>
>



-- 
Wincent Ronggui HUANG
Sociology Department of Fudan University
PhD of City University of Hong Kong
http://homepage.fudan.edu.cn/rghuang/cv/


From edzer.pebesma at uni-muenster.de  Fri Sep 30 09:48:16 2011
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Fri, 30 Sep 2011 09:48:16 +0200
Subject: [Rd] S4 method dispatch
In-Reply-To: <4E765CE9.8080505@r-project.org>
References: <4E7115F6.20209@uni-muenster.de> <4E75C8E5.4000607@uni-muenster.de>
	<4E765CE9.8080505@r-project.org>
Message-ID: <4E857440.405@uni-muenster.de>

Thanks, John!

I did not manage to figure out how the strict= works, but changed class 
inheritance such that simple inheritance did not take place.

I see you're advocating to use the contains= to stress inheritance; back 
in 2005, I followed the green book, which did not yet have this.

If I now would change class definitions from using the representation= 
into contains= to express inheritance, does the binary representation 
also change, i.e. do people relying on sp classes get into problem with 
old, saved objects read by the new software? I'm asking this because 
there's lots of it around, e.g. all the world administrative regions 
available as .RData files from http://gadm.org/ .

On 09/18/2011 11:04 PM, John Chambers wrote:
> The distinction here is "simple inheritance" ("Software for Data
> Analysis", p. 346). Your first example is simple inheritance (would be
> clearer if you used the contains= argument). In the second version you
> supply an explicit coerce method, so method dispatch can no longer just
> pass in the object from the subclass, but has to call the coerce method
> explicitly. Details in the reference.
>
> If you need to have an explicit coerce method, it's possible to emulate
> simple inheritance, but the programming may be more subtle than you want
> to take on. When your method is called, it actually gets also an
> argument strict= which will be FALSE for method dispatch. You need to
> take account of the strict= argument in writing your method. See ?setAs
> for a few more details. Someone on the list may have an example.
>
> John
>
> On 9/18/11 3:33 AM, Edzer Pebesma wrote:
>> As a follow-up, I managed to isolate the problem I sent earlier this
>> week, and reduced it to a small case (I'm using R 2.13.1,
>> i486-pc-linux-gnu (32-bit)).
>>
>> The following script does what I expect:
>>
>>
>> setClass("A", representation(x = "numeric"))
>> setClass("AB", representation("A"))
>>
>> setGeneric("doNothing<-", function(obj, value)
>> standardGeneric("doNothing<-"))
>>
>> setReplaceMethod("doNothing", c("A", "character"),
>> function(obj, value) obj)
>>
>> x = new("AB", x = 10)
>> doNothing(x) = "irrelevant"
>> class(x)
>>
>> setAs("AB", "A", function(from) new("A", x = from at x))
>> x = new("AB", x = 10)
>> doNothing(x) = "irrelevant"
>> class(x)
>>
>>
>> and results in class(x) being "AB".
>> However, the following, very similar script:
>>
>>
>> setClass("A", representation(x = "numeric"))
>> setClass("AB", representation("A"))
>>
>> setGeneric("doNothing<-", function(obj, value)
>> standardGeneric("doNothing<-"))
>>
>> setReplaceMethod("doNothing", c("A", "character"),
>> function(obj, value) obj)
>>
>> setAs("AB", "A", function(from) new("A", x = from at x))
>>
>> x = new("AB", x = 10)
>> doNothing(x) = "irrelevant"
>> class(x)
>>
>>
>> returns "A" as the class of x. Why is this the case? Is this behaviour
>> intentional?
>>
>> Best regards,
>>
>>
>> On 09/14/2011 11:00 PM, Edzer Pebesma wrote:
>>> List,
>>>
>>> In order to get rid of some old, unreadable S3 code in package sp, I'm
>>> trying to rewrite things using S4 methods. Somewhere I fail, and I
>>> cannot sort out why. In order to isolate the problem, I created two
>>> functions, doNothing<- and dosth, and both should do nothing. The issue
>>> is that in most cases they do nothing, but in some cases dosth(obj)
>>> changes the class of obj and breaks with the error. I couldn't find a
>>> pattern when this happens, but have a few cases where it consistently
>>> breaks. Here's the code snippet:
>>>
>>> setGeneric("doNothing<-", function(object, value)
>>> standardGeneric("doNothing<-"))
>>>
>>> setReplaceMethod("doNothing",
>>> signature(object = "Spatial", value = "ANY"),
>>> function(object, value) object)
>>>
>>> dosth = function(obj) {
>>> cl1 = class(obj)
>>> doNothing(obj) = TRUE
>>> cl2 = class(obj)
>>> if (!identical(cl1, cl2)) {
>>> print(paste(cl1, cl2))
>>> stopifnot(identical(cl1, cl2))
>>> }
>>> obj
>>> }
>>>
>>> When things go wrong, dosth and doNothing are called with a subclass of
>>> Spatial, e.g. an object of class SpatialGrid, but when this gets in
>>> doNothing, the object is suddenly of class Spatial, and is then returned
>>> as an object of class Spatial, which should never happen.
>>>
>>> For instance, I have a case where consistently
>>>
>>> setMethod("fullgrid", c("Spatial"),
>>> function(obj) { is(obj, "SpatialGrid") })
>>>> class(g)
>>> [1] "SpatialGrid"
>>> attr(,"package")
>>> [1] "sp"
>>>> fullgrid(g)
>>> [1] FALSE
>>>
>>> is obviously false, but in other cases it works fine.
>>>
>>> When I change the signature of doNothing to signature(object = "ANY",
>>> value = "ANY"), the problem disappears.
>>>
>>> I tried to make a self-contained example that reproduced the issue, but
>>> could only get something that worked as expected.
>>>
>>> I would appreciate any help or suggestions.
>>

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From ripley at stats.ox.ac.uk  Fri Sep 30 10:06:14 2011
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 30 Sep 2011 09:06:14 +0100 (BST)
Subject: [Rd] Warning: changing locked binding for ...
In-Reply-To: <CANQBBMt4dNMB0EkV-aJ6+0N7R9KztJ0L0t9ZD433gWZqOYPByw@mail.gmail.com>
References: <CANQBBMu00yLvLTpL_MQpiNwPMidr1THSP5G4YegRBoxdfwgJkw@mail.gmail.com>
	<4E84A477.9090800@gmail.com>
	<CANQBBMt4dNMB0EkV-aJ6+0N7R9KztJ0L0t9ZD433gWZqOYPByw@mail.gmail.com>
Message-ID: <alpine.LFD.2.02.1109300858510.5960@gannet.stats.ox.ac.uk>

On Fri, 30 Sep 2011, Wincent wrote:

> Duncan, thanks very much.
>
> Yet, I don't recall I attempt to change any thing in the
> gWidgetsRGtk2. Is there a way to trace what part of the code is trying
> to do so?

Use options(warn=2)

I get

> library(RQDA)
Loading required package: DBI
Loading required package: RSQLite
Loading required package: gWidgets
Loading required package: gWidgetsRGtk2
Xlib:  extension "RANDR" missing on display ":5.0".

Use 'RQDA()' to start the programe.

Select a GUI toolkit

1: gWidgetsRGtk2
2: gWidgetstcltk

Selection: 1
Error : .onAttach failed in attachNamespace() for 'RQDA', details:
   call: NULL
   error: (converted from warning) changing locked binding for 
?stockIcons? in ?gWidgetsRGtk2? whilst loading ?RQDA?
Error: package/namespace load failed for ?RQDA?

So take a closer look at your .onAttach.

In fact it is gWidgetsRGtk2 that is using assignInNamespace, and you 
are running that in your startup code.  assignInNamespace was never 
intended to be used in production code, and John Verzani's packages 
need to be re-designed to respect the integrity of their namespaces.

Startup hooks was also not designed to be used to run large chunks of 
code, and as they are run under tryCatch they can be difficult to 
debug.

>
> Thanks.
> Wincent
>
> On 30 September 2011 01:01, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
>> On 29/09/2011 12:44 PM, Wincent wrote:
>>>
>>> Dear all, I use the R R Under development (unstable) (2011-09-28 r57099).
>>>
>>> When I load the RQDA package, it issues warnings. As the RQDA package
>>> developer, what should I deal with such message? Thank you very much.
>>
>> Don't attempt to change variables in other packages. ?Something that RQDA is
>> doing is attempting to change stockIcons and updateStockIcons in the
>> gWidgetsRGtk2 package.
>>
>> Duncan Murdoch
>>
>>>> ?library(gWidgetsRGtk2)
>>> Loading required package: gWidgets
>>>> ?library(RQDA)
>>> Loading required package: DBI
>>> Loading required package: RSQLite
>>>
>>> Use 'RQDA()' to start the programe.
>>>
>>> Warning: changing locked binding for ?stockIcons? in ?gWidgetsRGtk2?
>>> whilst loading ?RQDA?
>>> Warning: changing locked binding for ?updateStockIcons? in
>>> ?gWidgetsRGtk2? whilst loading ?RQDA?
>>> Warning: changing locked binding for ?n? in ?gWidgets? whilst loading
>>> ?RQDA?
>>>
>>>> ?sessionInfo()
>>> R Under development (unstable) (2011-09-28 r57099)
>>> Platform: i386-pc-mingw32/i386 (32-bit)
>>>
>>> locale:
>>> [1] LC_COLLATE=Chinese (Simplified)_People's Republic of China.936
>>> LC_CTYPE=Chinese (Simplified)_People's Republic of China.936
>>> [3] LC_MONETARY=Chinese (Simplified)_People's Republic of China.936
>>> LC_NUMERIC=C
>>> [5] LC_TIME=Chinese (Simplified)_People's Republic of China.936
>>>
>>> attached base packages:
>>> [1] stats ? ? graphics ?grDevices utils ? ? datasets ?methods ? base
>>>
>>> other attached packages:
>>> [1] RQDA_0.2-1 ? ? ? ? ? RSQLite_0.9-4 ? ? ? ?DBI_0.2-5
>>> gWidgetsRGtk2_0.0-76 gWidgets_0.0-46
>>>
>>> loaded via a namespace (and not attached):
>>> [1] RGtk2_2.20.17 tools_2.14.0
>>>
>>>
>>
>>
>
>
>
> -- 
> Wincent Ronggui HUANG
> Sociology Department of Fudan University
> PhD of City University of Hong Kong
> http://homepage.fudan.edu.cn/rghuang/cv/
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From k.jewell at campden.co.uk  Fri Sep 30 10:54:48 2011
From: k.jewell at campden.co.uk (Keith Jewell)
Date: Fri, 30 Sep 2011 09:54:48 +0100
Subject: [Rd] Finding inter-function dependencies within a package
References: <j61jp4$esl$1@dough.gmane.org>
	<3D59DF35E7CF3E42BA70C23BD5CBE6A85F5BD9F884@exvic-mbx04.nexus.csiro.au>
Message-ID: <j64058$unj$1@dough.gmane.org>

Thanks for the suggestions. Just to wrap up this thread...

Rainer Krug pointed out that Roxygen did have dependency graphs, although 
Roxygen2 doesn't. But I guess (probably wrongly!) that I'd need to 
process/modify the .R files to use that, and I'm not the package author.

Duncan Murdoch pointed out codetools::findGlobals which can be used to find 
functions called by a target function. But I want to find functions calling 
a target function.

Mark Bravington pointed out mvbutils::foodweb and callers.of which almost do 
what I want (I think it was this I half remembered). But this works in the 
namespace of the package, and my target function isn't exported so foodweb 
doesn't see it!

Working from Duncan's suggestion I came up with this, not pretty or fast, 
could certainly be improved, but it did my one-off job.:
--------------------
# return a character vector of names of functions in 'tarPack' (character) 
which directly call the function 'tarFunc' (character)
called.by <- function(tarFunc, tarPack){
require(codetools)
flist <-   sapply(lsf.str(tarPack, all=TRUE), c)
names(flist) <- NULL
gotit <- sapply(flist, function(x) tarFunc %in% findGlobals(get(x, tarPack), 
FALSE)$functions)
flist[gotit]
}
# e.g.
called.by("CreateMeanFizz", "package:sensory")
------------------------------------------

Thanks again for the input.

Keith Jewell

>> Hi,
>>
>> I'd like to know which functions in a package call one specific
>> function.
>> I think I've seen a tool for identifying such dependencies, but now I
>> can't find it :-( Searches of help and R site search for keywords
>> like function, call, tree, depend haven't helped :-(
>>
>> Can anyone point me in the right direction?
>>
>> Thanks in advance,
>>
>> Keith Jewell
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel


From surajg at gmail.com  Thu Sep 29 17:42:25 2011
From: surajg at gmail.com (Suraj Gupta)
Date: Thu, 29 Sep 2011 11:42:25 -0400
Subject: [Rd] documenting a behavior of adding named item to a list
Message-ID: <CAE9ddGCmEwx1t7aATrGYrBeKm-eh3azZbnB5wtnVvghkuZkboQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20110929/9d2293ee/attachment.pl>

From murdoch.duncan at gmail.com  Fri Sep 30 15:56:00 2011
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Fri, 30 Sep 2011 09:56:00 -0400
Subject: [Rd] documenting a behavior of adding named item to a list
In-Reply-To: <CAE9ddGCmEwx1t7aATrGYrBeKm-eh3azZbnB5wtnVvghkuZkboQ@mail.gmail.com>
References: <CAE9ddGCmEwx1t7aATrGYrBeKm-eh3azZbnB5wtnVvghkuZkboQ@mail.gmail.com>
Message-ID: <4E85CA70.30102@gmail.com>

On 29/09/2011 11:42 AM, Suraj Gupta wrote:
> Folks,
>
> Per a post to StackOverflow, I'm looking for an opinion on whether something
> should be documented:
> When adding a named item to a list, its guaranteed that the item will be
> added to the end of the list.

I'd say not.  There's an easy way to guarantee the order:  instead of using

mylist$newname <- 1

use

mylist <- c(mylist, newname=1)

The former construction doesn't necessarily put it last, only when 
newname is a new name.  The latter guarantees that it goes last.

Currently, you can do something like this:

x <- list(1)   # one element list
x[[10]] <- 10  # grows x to a 10 element list, filling in NULLs in 
positions 2 to 9
x$newname <- 11  # puts the newname in the 11th position

It's not obvious to me that the newname shouldn't go into the 2nd 
position (if I ignore the comments).  I wouldn't want to rule that out 
as a future change.

Duncan Murdoch

> SO post:
> http://stackoverflow.com/questions/7599349/adding-named-item-to-list-guaranteed-to-append-to-end-of-list/7599610#7599610
>
> This is my first email to r-devel, so I hope this is an appropriate
> question.
>
> -Suraj
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From simon.urbanek at r-project.org  Fri Sep 30 17:04:21 2011
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Fri, 30 Sep 2011 11:04:21 -0400
Subject: [Rd] grep and PCRE fun
In-Reply-To: <CAD+yNFjsZcddyJ6KPuOfW93PLfoz7wzeGhX+iKt7s5wv=_0TZg@mail.gmail.com>
References: <CAD+yNFjsZcddyJ6KPuOfW93PLfoz7wzeGhX+iKt7s5wv=_0TZg@mail.gmail.com>
Message-ID: <DF520E23-2EE0-4BED-9F6C-9245F4958FF0@r-project.org>

Jeff,

this is really a bug in PCRE since the length (0) is a multiple of 3 as documented so PCRE should not be writing anything. Anyway, this has been now fixed (by Brian).

Cheers,
Simon


On Sep 29, 2011, at 5:00 PM, Jeffrey Horner wrote:

> Hello,
> 
> I think I've found a bug in the C function do_grep located in
> src/main/grep.c. It seems to affect both the latest revisions of
> R-2-13-branch and trunk when compiling R without optimizations and
> with it's own version of pcre located in src/extra, at least on ubuntu
> 10.04.
> 
> According to the pcre_exec API (I presume the later versions), the
> ovecsize argument must be a multiple of 3 , and the ovector argument
> must point to a location that can hold at least ovecsize integers. All
> the pcre_exec calls made by do_grep, save one, honors this. That one
> call seems to overwrite areas of the stack it shouldn't. Here's the
> smallest example I found that tickles the bug:
> 
>> grep("[^[:blank][:cntrl]]","\\n",perl=TRUE)
> Error in grep("[^[:blank][:cntrl]]", "\\n", perl = TRUE) :
>  negative length vectors are not allowed
> 
> As described above, this error occurs on ubuntu 10.04 when R is
> compiled without optimizations ( I typically use CFLAGS="-ggdb"
> CXXFLAGS="-ggdb" FFLAGS="-ggdb" ./configure --enable-R-shlib), and the
> pcre_exec call executed from do_get overwrites the integer nmatches
> and sets it to -1. This has the effect of making do_grep try and
> allocate a results vector of length -1, which of course causes the
> error message above.
> 
> I'd be interested to know if this bug happens on other platforms.
> 
> Below is my simple fix for R-2-13-branch (a similar fix works for
> trunk as well).
> 
> Jeff
> 
> $ svn diff main/grep.c
> Index: main/grep.c
> ===================================================================
> --- main/grep.c	(revision 57110)
> +++ main/grep.c	(working copy)
> @@ -723,7 +723,7 @@
> {
>     SEXP pat, text, ind, ans;
>     regex_t reg;
> -    int i, j, n, nmatches = 0, ov, rc;
> +    int i, j, n, nmatches = 0, ov[3], rc;
>     int igcase_opt, value_opt, perl_opt, fixed_opt, useBytes, invert;
>     const char *spat = NULL;
>     pcre *re_pcre = NULL /* -Wall */;
> @@ -882,7 +882,7 @@
> 	    if (fixed_opt)
> 		LOGICAL(ind)[i] = fgrep_one(spat, s, useBytes, use_UTF8, NULL) >= 0;
> 	    else if (perl_opt) {
> -		if (pcre_exec(re_pcre, re_pe, s, strlen(s), 0, 0, &ov, 0) >= 0)
> +		if (pcre_exec(re_pcre, re_pe, s, strlen(s), 0, 0, ov, 3) >= 0)
> 		    INTEGER(ind)[i] = 1;
> 	    } else {
> 		if (!use_WC)
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 


From ripley at stats.ox.ac.uk  Fri Sep 30 17:12:29 2011
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 30 Sep 2011 16:12:29 +0100 (BST)
Subject: [Rd] grep and PCRE fun
In-Reply-To: <DF520E23-2EE0-4BED-9F6C-9245F4958FF0@r-project.org>
References: <CAD+yNFjsZcddyJ6KPuOfW93PLfoz7wzeGhX+iKt7s5wv=_0TZg@mail.gmail.com>
	<DF520E23-2EE0-4BED-9F6C-9245F4958FF0@r-project.org>
Message-ID: <alpine.LFD.2.02.1109301611460.12807@toucan.stats.ox.ac.uk>

On Fri, 30 Sep 2011, Simon Urbanek wrote:

> Jeff,
>
> this is really a bug in PCRE since the length (0) is a multiple of 3 as documented so PCRE should not be writing anything. Anyway, this has been now fixed (by Brian).

Only in R-devel: R-2-13-branch is now closed (and was by the time I 
read the message).

>
> Cheers,
> Simon
>
>
> On Sep 29, 2011, at 5:00 PM, Jeffrey Horner wrote:
>
>> Hello,
>>
>> I think I've found a bug in the C function do_grep located in
>> src/main/grep.c. It seems to affect both the latest revisions of
>> R-2-13-branch and trunk when compiling R without optimizations and
>> with it's own version of pcre located in src/extra, at least on ubuntu
>> 10.04.
>>
>> According to the pcre_exec API (I presume the later versions), the
>> ovecsize argument must be a multiple of 3 , and the ovector argument
>> must point to a location that can hold at least ovecsize integers. All
>> the pcre_exec calls made by do_grep, save one, honors this. That one
>> call seems to overwrite areas of the stack it shouldn't. Here's the
>> smallest example I found that tickles the bug:
>>
>>> grep("[^[:blank][:cntrl]]","\\n",perl=TRUE)
>> Error in grep("[^[:blank][:cntrl]]", "\\n", perl = TRUE) :
>>  negative length vectors are not allowed
>>
>> As described above, this error occurs on ubuntu 10.04 when R is
>> compiled without optimizations ( I typically use CFLAGS="-ggdb"
>> CXXFLAGS="-ggdb" FFLAGS="-ggdb" ./configure --enable-R-shlib), and the
>> pcre_exec call executed from do_get overwrites the integer nmatches
>> and sets it to -1. This has the effect of making do_grep try and
>> allocate a results vector of length -1, which of course causes the
>> error message above.
>>
>> I'd be interested to know if this bug happens on other platforms.
>>
>> Below is my simple fix for R-2-13-branch (a similar fix works for
>> trunk as well).
>>
>> Jeff
>>
>> $ svn diff main/grep.c
>> Index: main/grep.c
>> ===================================================================
>> --- main/grep.c	(revision 57110)
>> +++ main/grep.c	(working copy)
>> @@ -723,7 +723,7 @@
>> {
>>     SEXP pat, text, ind, ans;
>>     regex_t reg;
>> -    int i, j, n, nmatches = 0, ov, rc;
>> +    int i, j, n, nmatches = 0, ov[3], rc;
>>     int igcase_opt, value_opt, perl_opt, fixed_opt, useBytes, invert;
>>     const char *spat = NULL;
>>     pcre *re_pcre = NULL /* -Wall */;
>> @@ -882,7 +882,7 @@
>> 	    if (fixed_opt)
>> 		LOGICAL(ind)[i] = fgrep_one(spat, s, useBytes, use_UTF8, NULL) >= 0;
>> 	    else if (perl_opt) {
>> -		if (pcre_exec(re_pcre, re_pe, s, strlen(s), 0, 0, &ov, 0) >= 0)
>> +		if (pcre_exec(re_pcre, re_pe, s, strlen(s), 0, 0, ov, 3) >= 0)
>> 		    INTEGER(ind)[i] = 1;
>> 	    } else {
>> 		if (!use_WC)
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From jmc at r-project.org  Fri Sep 30 18:16:51 2011
From: jmc at r-project.org (John Chambers)
Date: Fri, 30 Sep 2011 09:16:51 -0700
Subject: [Rd] S4 method dispatch
In-Reply-To: <4E857440.405@uni-muenster.de>
References: <4E7115F6.20209@uni-muenster.de> <4E75C8E5.4000607@uni-muenster.de>
	<4E765CE9.8080505@r-project.org> <4E857440.405@uni-muenster.de>
Message-ID: <4E85EB73.6080306@r-project.org>



On 9/30/11 12:48 AM, Edzer Pebesma wrote:
> Thanks, John!
>
> I did not manage to figure out how the strict= works, but changed class
> inheritance such that simple inheritance did not take place.
>
> I see you're advocating to use the contains= to stress inheritance; back
> in 2005, I followed the green book, which did not yet have this.
>
> If I now would change class definitions from using the representation=
> into contains= to express inheritance, does the binary representation
> also change, i.e. do people relying on sp classes get into problem with
> old, saved objects read by the new software? I'm asking this because
> there's lots of it around, e.g. all the world administrative regions
> available as .RData files from http://gadm.org/

It's just a question of readability: Better to have a clear statement of 
inheritance rather than plowing through the representation list for 
empty name fields.  And easier to discuss (e.g., section 9.3 of SoDA).

You're hardly the only sinner in the flock.  I imagine many packages on 
CRAN would have failed by now if there was a problem.  I only complain 
about it when feeling fussy.

John
.
>
> On 09/18/2011 11:04 PM, John Chambers wrote:
>> The distinction here is "simple inheritance" ("Software for Data
>> Analysis", p. 346). Your first example is simple inheritance (would be
>> clearer if you used the contains= argument). In the second version you
>> supply an explicit coerce method, so method dispatch can no longer just
>> pass in the object from the subclass, but has to call the coerce method
>> explicitly. Details in the reference.
>>
>> If you need to have an explicit coerce method, it's possible to emulate
>> simple inheritance, but the programming may be more subtle than you want
>> to take on. When your method is called, it actually gets also an
>> argument strict= which will be FALSE for method dispatch. You need to
>> take account of the strict= argument in writing your method. See ?setAs
>> for a few more details. Someone on the list may have an example.
>>
>> John
>>
>> On 9/18/11 3:33 AM, Edzer Pebesma wrote:
>>> As a follow-up, I managed to isolate the problem I sent earlier this
>>> week, and reduced it to a small case (I'm using R 2.13.1,
>>> i486-pc-linux-gnu (32-bit)).
>>>
>>> The following script does what I expect:
>>>
>>>
>>> setClass("A", representation(x = "numeric"))
>>> setClass("AB", representation("A"))
>>>
>>> setGeneric("doNothing<-", function(obj, value)
>>> standardGeneric("doNothing<-"))
>>>
>>> setReplaceMethod("doNothing", c("A", "character"),
>>> function(obj, value) obj)
>>>
>>> x = new("AB", x = 10)
>>> doNothing(x) = "irrelevant"
>>> class(x)
>>>
>>> setAs("AB", "A", function(from) new("A", x = from at x))
>>> x = new("AB", x = 10)
>>> doNothing(x) = "irrelevant"
>>> class(x)
>>>
>>>
>>> and results in class(x) being "AB".
>>> However, the following, very similar script:
>>>
>>>
>>> setClass("A", representation(x = "numeric"))
>>> setClass("AB", representation("A"))
>>>
>>> setGeneric("doNothing<-", function(obj, value)
>>> standardGeneric("doNothing<-"))
>>>
>>> setReplaceMethod("doNothing", c("A", "character"),
>>> function(obj, value) obj)
>>>
>>> setAs("AB", "A", function(from) new("A", x = from at x))
>>>
>>> x = new("AB", x = 10)
>>> doNothing(x) = "irrelevant"
>>> class(x)
>>>
>>>
>>> returns "A" as the class of x. Why is this the case? Is this behaviour
>>> intentional?
>>>
>>> Best regards,
>>>
>>>
>>> On 09/14/2011 11:00 PM, Edzer Pebesma wrote:
>>>> List,
>>>>
>>>> In order to get rid of some old, unreadable S3 code in package sp, I'm
>>>> trying to rewrite things using S4 methods. Somewhere I fail, and I
>>>> cannot sort out why. In order to isolate the problem, I created two
>>>> functions, doNothing<- and dosth, and both should do nothing. The issue
>>>> is that in most cases they do nothing, but in some cases dosth(obj)
>>>> changes the class of obj and breaks with the error. I couldn't find a
>>>> pattern when this happens, but have a few cases where it consistently
>>>> breaks. Here's the code snippet:
>>>>
>>>> setGeneric("doNothing<-", function(object, value)
>>>> standardGeneric("doNothing<-"))
>>>>
>>>> setReplaceMethod("doNothing",
>>>> signature(object = "Spatial", value = "ANY"),
>>>> function(object, value) object)
>>>>
>>>> dosth = function(obj) {
>>>> cl1 = class(obj)
>>>> doNothing(obj) = TRUE
>>>> cl2 = class(obj)
>>>> if (!identical(cl1, cl2)) {
>>>> print(paste(cl1, cl2))
>>>> stopifnot(identical(cl1, cl2))
>>>> }
>>>> obj
>>>> }
>>>>
>>>> When things go wrong, dosth and doNothing are called with a subclass of
>>>> Spatial, e.g. an object of class SpatialGrid, but when this gets in
>>>> doNothing, the object is suddenly of class Spatial, and is then
>>>> returned
>>>> as an object of class Spatial, which should never happen.
>>>>
>>>> For instance, I have a case where consistently
>>>>
>>>> setMethod("fullgrid", c("Spatial"),
>>>> function(obj) { is(obj, "SpatialGrid") })
>>>>> class(g)
>>>> [1] "SpatialGrid"
>>>> attr(,"package")
>>>> [1] "sp"
>>>>> fullgrid(g)
>>>> [1] FALSE
>>>>
>>>> is obviously false, but in other cases it works fine.
>>>>
>>>> When I change the signature of doNothing to signature(object = "ANY",
>>>> value = "ANY"), the problem disappears.
>>>>
>>>> I tried to make a self-contained example that reproduced the issue, but
>>>> could only get something that worked as expected.
>>>>
>>>> I would appreciate any help or suggestions.
>>>
>


From jtalbot at stanford.edu  Fri Sep 30 18:26:53 2011
From: jtalbot at stanford.edu (Justin Talbot)
Date: Fri, 30 Sep 2011 09:26:53 -0700
Subject: [Rd] Language definition question - order of argument side effects
Message-ID: <CALLn38Myu=BTaj7h10vPh3qbprPG28p8E38OMsAgb5KhxONQbA@mail.gmail.com>

I'm interested in the difference between these two intuitively
equivalent sequences that produce different results (in R version
2.13.1 (2011-07-08) 32-bit). I think R's reference counting
optimization is causing this difference in behavior.

> a <- 1
> a+{a[1] <- 20}
[1] 21

> a <- 1
> a[1] <- 1
> a+{a[1] <- 20}
[1] 40

Is one of these the "correct" answer, or is the order of side effects
undefined in these statements? Section 4.3.3 of the R Language
Definition just says that doing assignment in an argument to a
function is "bad style", but doesn't say anything about evaluation
order.

In general, for primitive and internal functions, is a particular
evaluation order for the arguments guaranteed?

Thanks,
Justin Talbot


From murdoch.duncan at gmail.com  Fri Sep 30 19:40:36 2011
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Fri, 30 Sep 2011 13:40:36 -0400
Subject: [Rd] Language definition question - order of argument side
	effects
In-Reply-To: <CALLn38Myu=BTaj7h10vPh3qbprPG28p8E38OMsAgb5KhxONQbA@mail.gmail.com>
References: <CALLn38Myu=BTaj7h10vPh3qbprPG28p8E38OMsAgb5KhxONQbA@mail.gmail.com>
Message-ID: <4E85FF14.3020004@gmail.com>

On 30/09/2011 12:26 PM, Justin Talbot wrote:
> I'm interested in the difference between these two intuitively
> equivalent sequences that produce different results (in R version
> 2.13.1 (2011-07-08) 32-bit). I think R's reference counting
> optimization is causing this difference in behavior.
>
> >  a<- 1
> >  a+{a[1]<- 20}
> [1] 21
>
> >  a<- 1
> >  a[1]<- 1
> >  a+{a[1]<- 20}
> [1] 40
>
> Is one of these the "correct" answer, or is the order of side effects
> undefined in these statements? Section 4.3.3 of the R Language
> Definition just says that doing assignment in an argument to a
> function is "bad style", but doesn't say anything about evaluation
> order.
>
> In general, for primitive and internal functions, is a particular
> evaluation order for the arguments guaranteed?

In general, evaluation order is undefined.  I was surprised by the 
result, but I think you're right about the explanation.  In particular:

>  a<- 1
>  .Internal(inspect(a))
@4a06440 14 REALSXP g0c1 [NAM(2)] (len=1, tl=0) 1
>  a[1]<- 1
>  .Internal(inspect(a))
@4a06300 14 REALSXP g0c1 [NAM(1)] (len=1, tl=0) 1

The only difference is in the "named" value.

Duncan Murdoch


