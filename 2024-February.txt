From x|ny|@xu97 @end|ng |rom gm@||@com  Thu Feb  1 17:28:57 2024
From: x|ny|@xu97 @end|ng |rom gm@||@com (Xinyi)
Date: Thu, 1 Feb 2024 16:28:57 +0000
Subject: [Rd] [Feature Request] Hide API Key in download.file() / R's libcurl
Message-ID: <CAOmDYzZe2ODCqgK+9sOtAAh1dVpAKK=PT7h7bs12cAFzk+ckMg@mail.gmail.com>

Hi all,

When trying to install a package from R using install.packages(), it will
print out the full url address (of the remote repository) it was trying to
access. A bit further digging shows it is from the in_do_curlDownload
method from R's libcurl
<https://github.com/wch/r-source/blob/trunk/src/modules/internet/libcurl.c>:
install.packages() calls download.packages(), and download.packages() calls
download.file(), which uses "libcurl" as its default method.

This line from R mirror
<https://github.com/wch/r-source/blob/trunk/src/modules/internet/libcurl.c#L772>
("if (!quiet) REprintf(_("trying URL '%s'\n"), url);")  prints the full url
it is trying to access.

This is totally fine for public urls without credentials, but in the case
that a given url contains an API key, it poses security issues. For
example, if the getOption("repos") has been overridden to a
customized repository (protected by API keys), then
> install.packages("zoo")
Installing packages into '--removed local directory path--'
trying URL 'https://--removed userid--:--removed
api-key-- at repository-addresss.com:4443/.../src/contrib/zoo_1.8-12.tar.gz  '
Content type 'application/x-gzip' length 782344 bytes (764 KB)
===================================
downloaded 764 KB

* installing *source* package 'zoo' ...
-- further logs removed --
>

I also tried several other options:

1. quite=1
> install.packages("zoo", quite=1)
It did hide the url, but it also hid all other useful information.
2. method="curl"
> install.packages("zoo", method="curl")
This does not print the url when the download is successful, but if there
were any errors, it still prints the url with API key in it.
3. method="wget"
> install.packages("zoo", method="wget")
This hides API key by *password*, but I wasn't able to install packages
with this method even with public repos, with the error "Warning: unable to
access index for repository https://cloud.r-project.org/src/contrib/4.3:
'wget' call had nonzero exit status"


In other dynamic languages' package managers like Python's pip, API keys
are hidden by default since pip 18.x in 2018, and masked by "****" from pip
19.x in 2019, see below examples. Can we get a similar default behaviour in
R?

1. with pip 10.x
$ pip install numpy -v # API key was not hided
Looking in indexes:  https://--removed userid--:--removed
api-key-- at repository-addresss.com:4443/.../pypi/simple
2. with pip 18.x # All credentials are removed by pip
$ pip install numpy -v
Looking in indexes:  https://repository-addresss.com:4443/
.../pypi/simple
3. with pip 19.x onwards # userid is kept, API key is replaced by ****
$ pip install numpy -v
Looking in indexes:  https://userid:****@
repository-addresss.com:4443/.../pypi/simple


I was instructed by https://www.r-project.org/bugs.html that I should get
some discussion on r-devel before filing a feature request. So looking
forward to comments/suggestions.

Thanks,
Xinyi

	[[alternative HTML version deleted]]


From murdoch@dunc@n @end|ng |rom gm@||@com  Thu Feb  1 18:37:15 2024
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Thu, 1 Feb 2024 12:37:15 -0500
Subject: [Rd] [Feature Request] Hide API Key in download.file() / R's
 libcurl
In-Reply-To: <CAOmDYzZe2ODCqgK+9sOtAAh1dVpAKK=PT7h7bs12cAFzk+ckMg@mail.gmail.com>
References: <CAOmDYzZe2ODCqgK+9sOtAAh1dVpAKK=PT7h7bs12cAFzk+ckMg@mail.gmail.com>
Message-ID: <63240c58-da4e-4d38-902c-d1588e2acb63@gmail.com>

I've just been reading 
https://developer.mozilla.org/en-US/docs/Web/HTTP/Authentication, and it 
states that putting userid:password in the URL is deprecated, but it 
does make sense that R should protect users who still use that scheme.

Duncan Murdoch

On 01/02/2024 11:28 a.m., Xinyi wrote:
> Hi all,
> 
> When trying to install a package from R using install.packages(), it will
> print out the full url address (of the remote repository) it was trying to
> access. A bit further digging shows it is from the in_do_curlDownload
> method from R's libcurl
> <https://github.com/wch/r-source/blob/trunk/src/modules/internet/libcurl.c>:
> install.packages() calls download.packages(), and download.packages() calls
> download.file(), which uses "libcurl" as its default method.
> 
> This line from R mirror
> <https://github.com/wch/r-source/blob/trunk/src/modules/internet/libcurl.c#L772>
> ("if (!quiet) REprintf(_("trying URL '%s'\n"), url);")  prints the full url
> it is trying to access.
> 
> This is totally fine for public urls without credentials, but in the case
> that a given url contains an API key, it poses security issues. For
> example, if the getOption("repos") has been overridden to a
> customized repository (protected by API keys), then
>> install.packages("zoo")
> Installing packages into '--removed local directory path--'
> trying URL 'https://--removed userid--:--removed
> api-key-- at repository-addresss.com:4443/.../src/contrib/zoo_1.8-12.tar.gz  '
> Content type 'application/x-gzip' length 782344 bytes (764 KB)
> ===================================
> downloaded 764 KB
> 
> * installing *source* package 'zoo' ...
> -- further logs removed --
>>
> 
> I also tried several other options:
> 
> 1. quite=1
>> install.packages("zoo", quite=1)
> It did hide the url, but it also hid all other useful information.
> 2. method="curl"
>> install.packages("zoo", method="curl")
> This does not print the url when the download is successful, but if there
> were any errors, it still prints the url with API key in it.
> 3. method="wget"
>> install.packages("zoo", method="wget")
> This hides API key by *password*, but I wasn't able to install packages
> with this method even with public repos, with the error "Warning: unable to
> access index for repository https://cloud.r-project.org/src/contrib/4.3:
> 'wget' call had nonzero exit status"
> 
> 
> In other dynamic languages' package managers like Python's pip, API keys
> are hidden by default since pip 18.x in 2018, and masked by "****" from pip
> 19.x in 2019, see below examples. Can we get a similar default behaviour in
> R?
> 
> 1. with pip 10.x
> $ pip install numpy -v # API key was not hided
> Looking in indexes:  https://--removed userid--:--removed
> api-key-- at repository-addresss.com:4443/.../pypi/simple
> 2. with pip 18.x # All credentials are removed by pip
> $ pip install numpy -v
> Looking in indexes:  https://repository-addresss.com:4443/
> .../pypi/simple
> 3. with pip 19.x onwards # userid is kept, API key is replaced by ****
> $ pip install numpy -v
> Looking in indexes:  https://userid:****@
> repository-addresss.com:4443/.../pypi/simple
> 
> 
> I was instructed by https://www.r-project.org/bugs.html that I should get
> some discussion on r-devel before filing a feature request. So looking
> forward to comments/suggestions.
> 
> Thanks,
> Xinyi
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From @|mon@urb@nek @end|ng |rom R-project@org  Sat Feb  3 22:33:34 2024
From: @|mon@urb@nek @end|ng |rom R-project@org (Simon Urbanek)
Date: Sun, 4 Feb 2024 10:33:34 +1300
Subject: [Rd] [Feature Request] Hide API Key in download.file() / R's
 libcurl
In-Reply-To: <CAOmDYzZe2ODCqgK+9sOtAAh1dVpAKK=PT7h7bs12cAFzk+ckMg@mail.gmail.com>
References: <CAOmDYzZe2ODCqgK+9sOtAAh1dVpAKK=PT7h7bs12cAFzk+ckMg@mail.gmail.com>
Message-ID: <4A2FF313-9285-43C9-9179-6A4C93342D48@R-project.org>

Any reason why you didn't use quiet=TRUE to suppress that output?

There is no official API structure for credentials in R repositories, so R has no way of knowing which part of the URL are credentials as it is not under R's purview - it could be part of the path or anything, so there is no way R can reliably mask it. Hence it makes more sense for the user to suppress the output if they think it may contain sensitive information - and R supports that.

If that's still not enough, then please make a concrete proposal that defines exactly what kind processing you'd like to see under what conditions - and how you think that will solve the problem.

Cheers,
Simon



> On Feb 2, 2024, at 5:28 AM, Xinyi <xinyi.xu97 at gmail.com> wrote:
> 
> Hi all,
> 
> When trying to install a package from R using install.packages(), it will
> print out the full url address (of the remote repository) it was trying to
> access. A bit further digging shows it is from the in_do_curlDownload
> method from R's libcurl
> <https://github.com/wch/r-source/blob/trunk/src/modules/internet/libcurl.c>:
> install.packages() calls download.packages(), and download.packages() calls
> download.file(), which uses "libcurl" as its default method.
> 
> This line from R mirror
> <https://github.com/wch/r-source/blob/trunk/src/modules/internet/libcurl.c#L772>
> ("if (!quiet) REprintf(_("trying URL '%s'\n"), url);")  prints the full url
> it is trying to access.
> 
> This is totally fine for public urls without credentials, but in the case
> that a given url contains an API key, it poses security issues. For
> example, if the getOption("repos") has been overridden to a
> customized repository (protected by API keys), then
>> install.packages("zoo")
> Installing packages into '--removed local directory path--'
> trying URL 'https://--removed userid--:--removed
> api-key-- at repository-addresss.com:4443/.../src/contrib/zoo_1.8-12.tar.gz  '
> Content type 'application/x-gzip' length 782344 bytes (764 KB)
> ===================================
> downloaded 764 KB
> 
> * installing *source* package 'zoo' ...
> -- further logs removed --
>> 
> 
> I also tried several other options:
> 
> 1. quite=1
>> install.packages("zoo", quite=1)
> It did hide the url, but it also hid all other useful information.
> 2. method="curl"
>> install.packages("zoo", method="curl")
> This does not print the url when the download is successful, but if there
> were any errors, it still prints the url with API key in it.
> 3. method="wget"
>> install.packages("zoo", method="wget")
> This hides API key by *password*, but I wasn't able to install packages
> with this method even with public repos, with the error "Warning: unable to
> access index for repository https://cloud.r-project.org/src/contrib/4.3:
> 'wget' call had nonzero exit status"
> 
> 
> In other dynamic languages' package managers like Python's pip, API keys
> are hidden by default since pip 18.x in 2018, and masked by "****" from pip
> 19.x in 2019, see below examples. Can we get a similar default behaviour in
> R?
> 
> 1. with pip 10.x
> $ pip install numpy -v # API key was not hided
> Looking in indexes:  https://--removed userid--:--removed
> api-key-- at repository-addresss.com:4443/.../pypi/simple
> 2. with pip 18.x # All credentials are removed by pip
> $ pip install numpy -v
> Looking in indexes:  https://repository-addresss.com:4443/
> .../pypi/simple
> 3. with pip 19.x onwards # userid is kept, API key is replaced by ****
> $ pip install numpy -v
> Looking in indexes:  https://userid:****@
> repository-addresss.com:4443/.../pypi/simple
> 
> 
> I was instructed by https://www.r-project.org/bugs.html that I should get
> some discussion on r-devel before filing a feature request. So looking
> forward to comments/suggestions.
> 


From hp@ge@@on@g|thub @end|ng |rom gm@||@com  Sun Feb  4 06:28:57 2024
From: hp@ge@@on@g|thub @end|ng |rom gm@||@com (=?UTF-8?B?SGVydsOpIFBhZ8Oocw==?=)
Date: Sat, 3 Feb 2024 21:28:57 -0800
Subject: [Rd] =?utf-8?q?NOTE=3A_multiple_local_function_definitions_for_?=
 =?utf-8?q?=E2=80=98fun=E2=80=99_with_different_formal_arguments?=
Message-ID: <d21ed424-ffa4-4f1c-b743-306a443989c4@gmail.com>

Hi,

I just ran into this 'R CMD check' NOTE for the first time:

* checking R code for possible problems ... NOTE
toto: multiple local function definitions for ?fun? with different
 ? formal arguments

The "offending" code is something like this (simplified from the real code):

toto <- function(mode)
{
 ??? if (mode == 1)
 ??????? fun <- function(a, b) a*b
 ??? else
 ??????? fun <- function(u, v, w) (u + v) / w
 ??? fun
}

Is that NOTE really intended? Hard to see why this code would be 
considered "wrong".

I know it's just a NOTE but still...

Thanks,

H.

-- 
Herv? Pag?s

Bioconductor Core Team
hpages.on.github at gmail.com

	[[alternative HTML version deleted]]


From |zm|r||g @end|ng |rom m@||@n|h@gov  Sun Feb  4 16:55:13 2024
From: |zm|r||g @end|ng |rom m@||@n|h@gov (Izmirlian, Grant (NIH/NCI) [E])
Date: Sun, 4 Feb 2024 15:55:13 +0000
Subject: [Rd] NOTE: multiple local function definitions for ?fun? with
 different formal arguments
In-Reply-To: <CA+jjkEbwGe-W-gSfds1=4Vzrf=LOitwiE=4Vx0+NCj4t2t09JA@mail.gmail.com>
References: <5jst8ric3j9fg55fkwuhhlyk.1707061436584@email.android.com>
 <CA+jjkEbwGe-W-gSfds1=4Vzrf=LOitwiE=4Vx0+NCj4t2t09JA@mail.gmail.com>
Message-ID: <lo01v1qa61gmseab9ma660ts.1707061568394@email.android.com>

Well you can see that yeast is exactly weekday you have.  The way out is to just not name the result

toto <- function(mode)
{
    ifelse(mode == 1,
        function(a,b) a*b,
        function(u, v, w) (u + v) / w)
}


________________________________
From: Grant Izmirlian <izmirlidroid at gmail.com>
Date: Sun, Feb 4, 2024, 10:44 AM
To: "Izmirlian, Grant (NIH/NCI) [E]" <izmirlig at mail.nih.gov>
Subject: Fwd: [EXTERNAL] R-devel Digest, Vol 252, Issue 2

Hi,

I just ran into this 'R CMD check' NOTE for the first time:

* checking R code for possible problems ... NOTE
toto: multiple local function definitions for ?fun? with different
  formal arguments

The "offending" code is something like this (simplified from the real code):

toto <- function(mode)
{
    if (mode == 1)
        fun <- function(a, b) a*b
    else
        fun <- function(u, v, w) (u + v) / w
    fun
}

Is that NOTE really intended? Hard to see why this code would be
considered "wrong".

I know it's just a NOTE but still...

Thanks,

H.

--
Herv? Pag?s

Bioconductor Core Team
hpages.on.github at gmail.com<mailto:hpages.on.github at gmail.com>


CAUTION: This email originated from outside of the organization. Do not click links or open attachments unless you recognize the sender and are confident the content is safe.


	[[alternative HTML version deleted]]


From murdoch@dunc@n @end|ng |rom gm@||@com  Sun Feb  4 18:07:24 2024
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Sun, 4 Feb 2024 12:07:24 -0500
Subject: [Rd] NOTE: multiple local function definitions for ?fun? with
 different formal arguments
In-Reply-To: <lo01v1qa61gmseab9ma660ts.1707061568394@email.android.com>
References: <5jst8ric3j9fg55fkwuhhlyk.1707061436584@email.android.com>
 <CA+jjkEbwGe-W-gSfds1=4Vzrf=LOitwiE=4Vx0+NCj4t2t09JA@mail.gmail.com>
 <lo01v1qa61gmseab9ma660ts.1707061568394@email.android.com>
Message-ID: <5cb29a06-5b73-4fe4-b8dc-7aa9db6a2cff@gmail.com>

On 04/02/2024 10:55 a.m., Izmirlian, Grant (NIH/NCI) [E] via R-devel wrote:
> Well you can see that yeast is exactly weekday you have.  The way out is to just not name the result

I think something happened to your explanation...

> 
> toto <- function(mode)
> {
>      ifelse(mode == 1,
>          function(a,b) a*b,
>          function(u, v, w) (u + v) / w)
> }

It's a bad idea to use ifelse() when you really want if() ... else ... . 
  In this case it works, but it doesn't always.  So the workaround should be


toto <- function(mode)
{
     if(mode == 1)
         function(a,b) a*b
     else
         function(u, v, w) (u + v) / w
}


> 
> 
> ________________________________
> From: Grant Izmirlian <izmirlidroid at gmail.com>
> Date: Sun, Feb 4, 2024, 10:44 AM
> To: "Izmirlian, Grant (NIH/NCI) [E]" <izmirlig at mail.nih.gov>
> Subject: Fwd: [EXTERNAL] R-devel Digest, Vol 252, Issue 2
> 
> Hi,
> 
> I just ran into this 'R CMD check' NOTE for the first time:
> 
> * checking R code for possible problems ... NOTE
> toto: multiple local function definitions for ?fun? with different
>    formal arguments
> 
> The "offending" code is something like this (simplified from the real code):
> 
> toto <- function(mode)
> {
>      if (mode == 1)
>          fun <- function(a, b) a*b
>      else
>          fun <- function(u, v, w) (u + v) / w
>      fun
> }
> 
> Is that NOTE really intended? Hard to see why this code would be
> considered "wrong".
> 
> I know it's just a NOTE but still...

I agree it's a false positive, but the issue is that you have a function 
object in your function which can't be called unconditionally.  The 
workaround doesn't create such an object.

Recognizing that your function never tries to call fun requires global 
inspection of toto(), and most of the checks are based on local inspection.

Duncan Murdoch


From hhoe|||n @end|ng |rom gm@||@com  Sun Feb  4 20:41:51 2024
From: hhoe|||n @end|ng |rom gm@||@com (Holger Hoefling)
Date: Sun, 4 Feb 2024 20:41:51 +0100
Subject: [Rd] Advice debugging M1Mac check errors
Message-ID: <CAFDswJu2aDQzCZHJT7RqyBP-J8DLcj6PLzRBHbcStfxBJvw5Mg@mail.gmail.com>

Hi,

I wanted to ask if people have good advice on how to debug M1Mac package
check errors when you don?t have a Mac? Is a cloud machine the best option
or is there something else?

Thanks

Holger

	[[alternative HTML version deleted]]


From edd @end|ng |rom deb|@n@org  Sun Feb  4 20:51:37 2024
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Sun, 4 Feb 2024 13:51:37 -0600
Subject: [Rd] Advice debugging M1Mac check errors
In-Reply-To: <CAFDswJu2aDQzCZHJT7RqyBP-J8DLcj6PLzRBHbcStfxBJvw5Mg@mail.gmail.com>
References: <CAFDswJu2aDQzCZHJT7RqyBP-J8DLcj6PLzRBHbcStfxBJvw5Mg@mail.gmail.com>
Message-ID: <26047.60105.385115.834455@rob.eddelbuettel.com>


On 4 February 2024 at 20:41, Holger Hoefling wrote:
| I wanted to ask if people have good advice on how to debug M1Mac package
| check errors when you don?t have a Mac? Is a cloud machine the best option
| or is there something else?

a) Use the 'mac builder' CRAN offers:
   https://mac.r-project.org/macbuilder/submit.html 

b) Use the newly added M1 runners at GitHub Actions,
   https://github.blog/changelog/2024-01-30-github-actions-introducing-the-new-m1-macos-runner-available-to-open-source/

Option a) is pretty good as the machine is set up for CRAN and builds
fast. Option b) gives you more control should you need it.

Dirk

-- 
dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From pro|jcn@@h @end|ng |rom gm@||@com  Sun Feb  4 22:47:27 2024
From: pro|jcn@@h @end|ng |rom gm@||@com (J C Nash)
Date: Sun, 4 Feb 2024 13:47:27 -0800
Subject: [Rd] Advice debugging M1Mac check errors
In-Reply-To: <26047.60105.385115.834455@rob.eddelbuettel.com>
References: <CAFDswJu2aDQzCZHJT7RqyBP-J8DLcj6PLzRBHbcStfxBJvw5Mg@mail.gmail.com>
 <26047.60105.385115.834455@rob.eddelbuettel.com>
Message-ID: <e7c3318f-7f31-42af-9bd0-c8df686d5bcb@gmail.com>

Slightly tangential: I had some woes with some vignettes in my
optimx and nlsr packages (actually in examples comparing to OTHER
packages) because the M? processors don't have 80 bit registers of
the old IEEE 754 arithmetic, so some existing "tolerances" are too
small when looking to see if is small enough to "converge", and one
gets "did not converge" type errors. There are workarounds,
but the discussion is beyond this post. However, worth awareness that
the code may be mostly correct except for appropriate tests of
smallness for these processors.

JN




On 2024-02-04 11:51, Dirk Eddelbuettel wrote:
> 
> On 4 February 2024 at 20:41, Holger Hoefling wrote:
> | I wanted to ask if people have good advice on how to debug M1Mac package
> | check errors when you don?t have a Mac? Is a cloud machine the best option
> | or is there something else?
> 
> a) Use the 'mac builder' CRAN offers:
>     https://mac.r-project.org/macbuilder/submit.html
> 
> b) Use the newly added M1 runners at GitHub Actions,
>     https://github.blog/changelog/2024-01-30-github-actions-introducing-the-new-m1-macos-runner-available-to-open-source/
> 
> Option a) is pretty good as the machine is set up for CRAN and builds
> fast. Option b) gives you more control should you need it.
> 
> Dirk
>


From @vr@h@m@@d|er @end|ng |rom gm@||@com  Sun Feb  4 23:00:15 2024
From: @vr@h@m@@d|er @end|ng |rom gm@||@com (Avraham Adler)
Date: Sun, 4 Feb 2024 17:00:15 -0500
Subject: [Rd] Advice debugging M1Mac check errors
In-Reply-To: <e7c3318f-7f31-42af-9bd0-c8df686d5bcb@gmail.com>
References: <e7c3318f-7f31-42af-9bd0-c8df686d5bcb@gmail.com>
Message-ID: <49032727-A982-46B3-B98F-55304724B573@gmail.com>

I think I had that problem with the minimaxApprox package as well.

Avi

Sent from my iPhone

> On Feb 4, 2024, at 4:47?PM, J C Nash <profjcnash at gmail.com> wrote:
> 
> ?Slightly tangential: I had some woes with some vignettes in my
> optimx and nlsr packages (actually in examples comparing to OTHER
> packages) because the M? processors don't have 80 bit registers of
> the old IEEE 754 arithmetic, so some existing "tolerances" are too
> small when looking to see if is small enough to "converge", and one
> gets "did not converge" type errors. There are workarounds,
> but the discussion is beyond this post. However, worth awareness that
> the code may be mostly correct except for appropriate tests of
> smallness for these processors.
> 
> JN
> 
> 
> 
> 
>> On 2024-02-04 11:51, Dirk Eddelbuettel wrote:
>> On 4 February 2024 at 20:41, Holger Hoefling wrote:
>> | I wanted to ask if people have good advice on how to debug M1Mac package
>> | check errors when you don?t have a Mac? Is a cloud machine the best option
>> | or is there something else?
>> a) Use the 'mac builder' CRAN offers:
>>    https://mac.r-project.org/macbuilder/submit.html
>> b) Use the newly added M1 runners at GitHub Actions,
>>    https://github.blog/changelog/2024-01-30-github-actions-introducing-the-new-m1-macos-runner-available-to-open-source/
>> Option a) is pretty good as the machine is set up for CRAN and builds
>> fast. Option b) gives you more control should you need it.
>> Dirk
>> 
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From murdoch@dunc@n @end|ng |rom gm@||@com  Mon Feb  5 00:26:32 2024
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Sun, 4 Feb 2024 18:26:32 -0500
Subject: [Rd] Advice debugging M1Mac check errors
In-Reply-To: <e7c3318f-7f31-42af-9bd0-c8df686d5bcb@gmail.com>
References: <CAFDswJu2aDQzCZHJT7RqyBP-J8DLcj6PLzRBHbcStfxBJvw5Mg@mail.gmail.com>
 <26047.60105.385115.834455@rob.eddelbuettel.com>
 <e7c3318f-7f31-42af-9bd0-c8df686d5bcb@gmail.com>
Message-ID: <df8d1572-ff79-4a52-a49e-f83d94fd4cc2@gmail.com>

Hi John.

I don't think the 80 bit format was part of IEEE 754; I think it was an 
Intel invention for the 8087 chip (which I believe preceded that 
standard), and didn't make it into the standard.

The standard does talk about 64 bit and 128 bit floating point formats, 
but not 80 bit.

Duncan Murdoch

On 04/02/2024 4:47 p.m., J C Nash wrote:
> Slightly tangential: I had some woes with some vignettes in my
> optimx and nlsr packages (actually in examples comparing to OTHER
> packages) because the M? processors don't have 80 bit registers of
> the old IEEE 754 arithmetic, so some existing "tolerances" are too
> small when looking to see if is small enough to "converge", and one
> gets "did not converge" type errors. There are workarounds,
> but the discussion is beyond this post. However, worth awareness that
> the code may be mostly correct except for appropriate tests of
> smallness for these processors.
> 
> JN
> 
> 
> 
> 
> On 2024-02-04 11:51, Dirk Eddelbuettel wrote:
>>
>> On 4 February 2024 at 20:41, Holger Hoefling wrote:
>> | I wanted to ask if people have good advice on how to debug M1Mac package
>> | check errors when you don?t have a Mac? Is a cloud machine the best option
>> | or is there something else?
>>
>> a) Use the 'mac builder' CRAN offers:
>>      https://mac.r-project.org/macbuilder/submit.html
>>
>> b) Use the newly added M1 runners at GitHub Actions,
>>      https://github.blog/changelog/2024-01-30-github-actions-introducing-the-new-m1-macos-runner-available-to-open-source/
>>
>> Option a) is pretty good as the machine is set up for CRAN and builds
>> fast. Option b) gives you more control should you need it.
>>
>> Dirk
>>
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From kev|nu@hey @end|ng |rom gm@||@com  Mon Feb  5 00:31:52 2024
From: kev|nu@hey @end|ng |rom gm@||@com (Kevin Ushey)
Date: Sun, 4 Feb 2024 15:31:52 -0800
Subject: [Rd] [Feature Request] Hide API Key in download.file() / R's
 libcurl
In-Reply-To: <4A2FF313-9285-43C9-9179-6A4C93342D48@R-project.org>
References: <CAOmDYzZe2ODCqgK+9sOtAAh1dVpAKK=PT7h7bs12cAFzk+ckMg@mail.gmail.com>
 <4A2FF313-9285-43C9-9179-6A4C93342D48@R-project.org>
Message-ID: <CAJXgQP1BD6VUCCN5e3zeRkpokxvddDWQOvkHsLoZokkN_xf6TA@mail.gmail.com>

For cases like these, I think it would be more useful to have some
mechanism for associating URLs / hosts with credentials, and have R use
those credentials by default whenever accessing those URLs. Since
download.file() now supports custom headers, this could be a mechanism for
setting headers to be used by default when downloading files from
particular URLs. Then, users could do something like:

    options(download.file.headers = list(
        example.org = c(Authorization = "<...>")
    ))

And those headers would be used automatically by download.file() whenever
talking to that server.

All of that to say -- I think the better way forward would be to make it
easier to safely use authentication credentials in download.file(), rather
than just tooling in support for suppressing specific types of output.

Best,
Kevin


On Sat, Feb 3, 2024 at 1:33?PM Simon Urbanek <simon.urbanek at r-project.org>
wrote:
>
> Any reason why you didn't use quiet=TRUE to suppress that output?
>
> There is no official API structure for credentials in R repositories, so
R has no way of knowing which part of the URL are credentials as it is not
under R's purview - it could be part of the path or anything, so there is
no way R can reliably mask it. Hence it makes more sense for the user to
suppress the output if they think it may contain sensitive information -
and R supports that.
>
> If that's still not enough, then please make a concrete proposal that
defines exactly what kind processing you'd like to see under what
conditions - and how you think that will solve the problem.
>
> Cheers,
> Simon
>
>
>
> > On Feb 2, 2024, at 5:28 AM, Xinyi <xinyi.xu97 at gmail.com> wrote:
> >
> > Hi all,
> >
> > When trying to install a package from R using install.packages(), it
will
> > print out the full url address (of the remote repository) it was trying
to
> > access. A bit further digging shows it is from the in_do_curlDownload
> > method from R's libcurl
> > <
https://github.com/wch/r-source/blob/trunk/src/modules/internet/libcurl.c>:
> > install.packages() calls download.packages(), and download.packages()
calls
> > download.file(), which uses "libcurl" as its default method.
> >
> > This line from R mirror
> > <
https://github.com/wch/r-source/blob/trunk/src/modules/internet/libcurl.c#L772
>
> > ("if (!quiet) REprintf(_("trying URL '%s'\n"), url);")  prints the full
url
> > it is trying to access.
> >
> > This is totally fine for public urls without credentials, but in the
case
> > that a given url contains an API key, it poses security issues. For
> > example, if the getOption("repos") has been overridden to a
> > customized repository (protected by API keys), then
> >> install.packages("zoo")
> > Installing packages into '--removed local directory path--'
> > trying URL 'https://--removed userid--:--removed
> > api-key-- at repository-addresss.com:4443/.../src/contrib/zoo_1.8-12.tar.gz
'
> > Content type 'application/x-gzip' length 782344 bytes (764 KB)
> > ===================================
> > downloaded 764 KB
> >
> > * installing *source* package 'zoo' ...
> > -- further logs removed --
> >>
> >
> > I also tried several other options:
> >
> > 1. quite=1
> >> install.packages("zoo", quite=1)
> > It did hide the url, but it also hid all other useful information.
> > 2. method="curl"
> >> install.packages("zoo", method="curl")
> > This does not print the url when the download is successful, but if
there
> > were any errors, it still prints the url with API key in it.
> > 3. method="wget"
> >> install.packages("zoo", method="wget")
> > This hides API key by *password*, but I wasn't able to install packages
> > with this method even with public repos, with the error "Warning:
unable to
> > access index for repository https://cloud.r-project.org/src/contrib/4.3:
> > 'wget' call had nonzero exit status"
> >
> >
> > In other dynamic languages' package managers like Python's pip, API keys
> > are hidden by default since pip 18.x in 2018, and masked by "****" from
pip
> > 19.x in 2019, see below examples. Can we get a similar default
behaviour in
> > R?
> >
> > 1. with pip 10.x
> > $ pip install numpy -v # API key was not hided
> > Looking in indexes:  https://--removed userid--:--removed
> > api-key-- at repository-addresss.com:4443/.../pypi/simple
> > 2. with pip 18.x # All credentials are removed by pip
> > $ pip install numpy -v
> > Looking in indexes:  https://repository-addresss.com:4443/
> > .../pypi/simple
> > 3. with pip 19.x onwards # userid is kept, API key is replaced by ****
> > $ pip install numpy -v
> > Looking in indexes:  https://userid:****@
> > repository-addresss.com:4443/.../pypi/simple
> >
> >
> > I was instructed by https://www.r-project.org/bugs.html that I should
get
> > some discussion on r-devel before filing a feature request. So looking
> > forward to comments/suggestions.
> >
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

	[[alternative HTML version deleted]]


From pro|jcn@@h @end|ng |rom gm@||@com  Mon Feb  5 01:43:32 2024
From: pro|jcn@@h @end|ng |rom gm@||@com (J C Nash)
Date: Sun, 4 Feb 2024 16:43:32 -0800
Subject: [Rd] Advice debugging M1Mac check errors
In-Reply-To: <df8d1572-ff79-4a52-a49e-f83d94fd4cc2@gmail.com>
References: <CAFDswJu2aDQzCZHJT7RqyBP-J8DLcj6PLzRBHbcStfxBJvw5Mg@mail.gmail.com>
 <26047.60105.385115.834455@rob.eddelbuettel.com>
 <e7c3318f-7f31-42af-9bd0-c8df686d5bcb@gmail.com>
 <df8d1572-ff79-4a52-a49e-f83d94fd4cc2@gmail.com>
Message-ID: <581a8ca8-a0ea-4f88-85f5-ebe80b8fd29e@gmail.com>

80 bit registers (I don't have my original docs with me here in Victoria)
seem to have been part of the 1985 standard to which I was one of the 31 named
contributors. See

https://stackoverflow.com/questions/612507/what-are-the-applications-benefits-of-an-80-bit-extended-precision-data-type

or the Wikipedia item on IEEE 754.

It appears to have been omitted from 2008 and 2020 versions, but is still (I believe) part of
many processors. It's an internal precision for handling multiplications and accumulation,
and not one of the storage modes.

Most of the time this makes very little difference in results for R, since it is only some
operations where the extended precision gets activated. If we store quantities, we get the
regular precision. Thus very few situations using the M? chips give differences, but when
they do, it is a nuisance.

There is plenty of scope for debating the pros and cons of extended precision internally.
Not having it likely contributes to speed / bang for the buck of the M? chips. But we do
now have occasional differences in outcomes which will lead to confusion and extra work.

JN




On 2024-02-04 15:26, Duncan Murdoch wrote:
> Hi John.
> 
> I don't think the 80 bit format was part of IEEE 754; I think it was an Intel invention for the 8087 chip (which I 
> believe preceded that standard), and didn't make it into the standard.
> 
> The standard does talk about 64 bit and 128 bit floating point formats, but not 80 bit.
> 
> Duncan Murdoch
> 
> On 04/02/2024 4:47 p.m., J C Nash wrote:
>> Slightly tangential: I had some woes with some vignettes in my
>> optimx and nlsr packages (actually in examples comparing to OTHER
>> packages) because the M? processors don't have 80 bit registers of
>> the old IEEE 754 arithmetic, so some existing "tolerances" are too
>> small when looking to see if is small enough to "converge", and one
>> gets "did not converge" type errors. There are workarounds,
>> but the discussion is beyond this post. However, worth awareness that
>> the code may be mostly correct except for appropriate tests of
>> smallness for these processors.
>>
>> JN
>>
>>
>>
>>
>> On 2024-02-04 11:51, Dirk Eddelbuettel wrote:
>>>
>>> On 4 February 2024 at 20:41, Holger Hoefling wrote:
>>> | I wanted to ask if people have good advice on how to debug M1Mac package
>>> | check errors when you don?t have a Mac? Is a cloud machine the best option
>>> | or is there something else?
>>>
>>> a) Use the 'mac builder' CRAN offers:
>>> ???? https://mac.r-project.org/macbuilder/submit.html
>>>
>>> b) Use the newly added M1 runners at GitHub Actions,
>>>      
>>> https://github.blog/changelog/2024-01-30-github-actions-introducing-the-new-m1-macos-runner-available-to-open-source/
>>>
>>> Option a) is pretty good as the machine is set up for CRAN and builds
>>> fast. Option b) gives you more control should you need it.
>>>
>>> Dirk
>>>
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From @|mon@urb@nek @end|ng |rom R-project@org  Mon Feb  5 01:46:20 2024
From: @|mon@urb@nek @end|ng |rom R-project@org (Simon Urbanek)
Date: Mon, 5 Feb 2024 13:46:20 +1300
Subject: [Rd] Advice debugging M1Mac check errors
In-Reply-To: <df8d1572-ff79-4a52-a49e-f83d94fd4cc2@gmail.com>
References: <CAFDswJu2aDQzCZHJT7RqyBP-J8DLcj6PLzRBHbcStfxBJvw5Mg@mail.gmail.com>
 <26047.60105.385115.834455@rob.eddelbuettel.com>
 <e7c3318f-7f31-42af-9bd0-c8df686d5bcb@gmail.com>
 <df8d1572-ff79-4a52-a49e-f83d94fd4cc2@gmail.com>
Message-ID: <2FE607B2-C2C5-43BB-B8ED-E90DE8708B40@R-project.org>



> On Feb 5, 2024, at 12:26 PM, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
> 
> Hi John.
> 
> I don't think the 80 bit format was part of IEEE 754; I think it was an Intel invention for the 8087 chip (which I believe preceded that standard), and didn't make it into the standard.
> 
> The standard does talk about 64 bit and 128 bit floating point formats, but not 80 bit.
> 

Yes, the 80 bit was Intel-specific (motivated by internal operations, not as external format), but as it used to be most popular architecture, people didn't quite realize that tests relying on Intel results will be Intel-specific (PowerPC Macs had 128-bit floating point, but they were not popular enough to cause trouble in the same way). The IEEE standard allows "extended precision" formats, but doesn't prescribe their format or precision - and they are optional. Arm64 CPUs only support 64-bit double precision in hardware (true both on macOS and Windows), so only what is in the basic standard. There are 128-bit floating point solutions in software, but, obviously, they are a lot slower (several orders of magnitude). Apple has been asking for priorities in the scientific community and 128-bit floating number support was not something high on people's priority list. It is far from trivial, because there is a long list of operations (all variations of the math functions) so I wouldn't expect this to change anytime soon - in fact once Microsoft's glacial move is done we'll be likely seeing only 64-bit everywhere.

That said even if you don't have a arm64 CPU, you can build R with --disable-long-double to get closer to the arm64 results if that is your worry.

Cheers,
Simon


> 
> On 04/02/2024 4:47 p.m., J C Nash wrote:
>> Slightly tangential: I had some woes with some vignettes in my
>> optimx and nlsr packages (actually in examples comparing to OTHER
>> packages) because the M? processors don't have 80 bit registers of
>> the old IEEE 754 arithmetic, so some existing "tolerances" are too
>> small when looking to see if is small enough to "converge", and one
>> gets "did not converge" type errors. There are workarounds,
>> but the discussion is beyond this post. However, worth awareness that
>> the code may be mostly correct except for appropriate tests of
>> smallness for these processors.
>> JN
>> On 2024-02-04 11:51, Dirk Eddelbuettel wrote:
>>> 
>>> On 4 February 2024 at 20:41, Holger Hoefling wrote:
>>> | I wanted to ask if people have good advice on how to debug M1Mac package
>>> | check errors when you don?t have a Mac? Is a cloud machine the best option
>>> | or is there something else?
>>> 
>>> a) Use the 'mac builder' CRAN offers:
>>>     https://mac.r-project.org/macbuilder/submit.html
>>> 
>>> b) Use the newly added M1 runners at GitHub Actions,
>>>     https://github.blog/changelog/2024-01-30-github-actions-introducing-the-new-m1-macos-runner-available-to-open-source/
>>> 
>>> Option a) is pretty good as the machine is set up for CRAN and builds
>>> fast. Option b) gives you more control should you need it.
>>> 
>>> Dirk
>>> 
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 


From pro|jcn@@h @end|ng |rom gm@||@com  Mon Feb  5 02:20:37 2024
From: pro|jcn@@h @end|ng |rom gm@||@com (J C Nash)
Date: Sun, 4 Feb 2024 17:20:37 -0800
Subject: [Rd] Advice debugging M1Mac check errors
In-Reply-To: <2FE607B2-C2C5-43BB-B8ED-E90DE8708B40@R-project.org>
References: <CAFDswJu2aDQzCZHJT7RqyBP-J8DLcj6PLzRBHbcStfxBJvw5Mg@mail.gmail.com>
 <26047.60105.385115.834455@rob.eddelbuettel.com>
 <e7c3318f-7f31-42af-9bd0-c8df686d5bcb@gmail.com>
 <df8d1572-ff79-4a52-a49e-f83d94fd4cc2@gmail.com>
 <2FE607B2-C2C5-43BB-B8ED-E90DE8708B40@R-project.org>
Message-ID: <eb03da30-2957-4ee7-ae45-c29646e18909@gmail.com>

Simon's comments add another viewpoint to mine. My own knowledge of the
impact of "disable-long-double" does not include an understanding of
exactly what effect this has. One needs to spend a lot of time and effort
with excruciating details. Fortunately, we can usually get away with
64 bit FP arithmetic for almost all applications. I suspect applications
that need really long precision are likely best handled with special
hardware.

JN


On 2024-02-04 16:46, Simon Urbanek wrote:
> 
> 
>> On Feb 5, 2024, at 12:26 PM, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
>>
>> Hi John.
>>
>> I don't think the 80 bit format was part of IEEE 754; I think it was an Intel invention for the 8087 chip (which I believe preceded that standard), and didn't make it into the standard.
>>
>> The standard does talk about 64 bit and 128 bit floating point formats, but not 80 bit.
>>
> 
> Yes, the 80 bit was Intel-specific (motivated by internal operations, not as external format), but as it used to be most popular architecture, people didn't quite realize that tests relying on Intel results will be Intel-specific (PowerPC Macs had 128-bit floating point, but they were not popular enough to cause trouble in the same way). The IEEE standard allows "extended precision" formats, but doesn't prescribe their format or precision - and they are optional. Arm64 CPUs only support 64-bit double precision in hardware (true both on macOS and Windows), so only what is in the basic standard. There are 128-bit floating point solutions in software, but, obviously, they are a lot slower (several orders of magnitude). Apple has been asking for priorities in the scientific community and 128-bit floating number support was not something high on people's priority list. It is far from trivial, because there is a long list of operations (all variations of the math functions) so I wouldn't expect this to change anytime soon - in fact once Microsoft's glacial move is done we'll be likely seeing only 64-bit everywhere.
> 
> That said even if you don't have a arm64 CPU, you can build R with --disable-long-double to get closer to the arm64 results if that is your worry.
> 
> Cheers,
> Simon
> 
> 
>>
>> On 04/02/2024 4:47 p.m., J C Nash wrote:
>>> Slightly tangential: I had some woes with some vignettes in my
>>> optimx and nlsr packages (actually in examples comparing to OTHER
>>> packages) because the M? processors don't have 80 bit registers of
>>> the old IEEE 754 arithmetic, so some existing "tolerances" are too
>>> small when looking to see if is small enough to "converge", and one
>>> gets "did not converge" type errors. There are workarounds,
>>> but the discussion is beyond this post. However, worth awareness that
>>> the code may be mostly correct except for appropriate tests of
>>> smallness for these processors.
>>> JN
>>> On 2024-02-04 11:51, Dirk Eddelbuettel wrote:
>>>>
>>>> On 4 February 2024 at 20:41, Holger Hoefling wrote:
>>>> | I wanted to ask if people have good advice on how to debug M1Mac package
>>>> | check errors when you don?t have a Mac? Is a cloud machine the best option
>>>> | or is there something else?
>>>>
>>>> a) Use the 'mac builder' CRAN offers:
>>>>      https://mac.r-project.org/macbuilder/submit.html
>>>>
>>>> b) Use the newly added M1 runners at GitHub Actions,
>>>>      https://github.blog/changelog/2024-01-30-github-actions-introducing-the-new-m1-macos-runner-available-to-open-source/
>>>>
>>>> Option a) is pretty good as the machine is set up for CRAN and builds
>>>> fast. Option b) gives you more control should you need it.
>>>>
>>>> Dirk
>>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

From m@ech|er @end|ng |rom @t@t@m@th@ethz@ch  Mon Feb  5 13:17:41 2024
From: m@ech|er @end|ng |rom @t@t@m@th@ethz@ch (Martin Maechler)
Date: Mon, 5 Feb 2024 13:17:41 +0100
Subject: [Rd] [Feature Request] Hide API Key in download.file() / R's
 libcurl
In-Reply-To: <4A2FF313-9285-43C9-9179-6A4C93342D48@R-project.org>
References: <CAOmDYzZe2ODCqgK+9sOtAAh1dVpAKK=PT7h7bs12cAFzk+ckMg@mail.gmail.com>
 <4A2FF313-9285-43C9-9179-6A4C93342D48@R-project.org>
Message-ID: <26048.53733.550786.251117@stat.math.ethz.ch>

>>>>> Simon Urbanek 
>>>>>     on Sun, 4 Feb 2024 10:33:34 +1300 writes:

    > Any reason why you didn't use quiet=TRUE to suppress that
    > output?  

He wrote 'quite' instead of 'quiet' {see cited below '1. quite=1'}
and probably never tried the correct spelling ...

    > There is no official API structure for
    > credentials in R repositories, so R has no way of knowing
    > which part of the URL are credentials as it is not under
    > R's purview - it could be part of the path or anything, so
    > there is no way R can reliably mask it. Hence it makes
    > more sense for the user to suppress the output if they
    > think it may contain sensitive information - and R
    > supports that.

    > If that's still not enough, then please make a concrete
    > proposal that defines exactly what kind processing you'd
    > like to see under what conditions - and how you think that
    > will solve the problem.

    > Cheers, Simon



    >> On Feb 2, 2024, at 5:28 AM, Xinyi <xinyi.xu97 at gmail.com>
    >> wrote:
    >> 
    >> Hi all,
    >> 
    >> When trying to install a package from R using
    >> install.packages(), it will print out the full url
    >> address (of the remote repository) it was trying to
    >> access. A bit further digging shows it is from the
    >> in_do_curlDownload method from R's libcurl
    >> <https://github.com/wch/r-source/blob/trunk/src/modules/internet/libcurl.c>:
    >> install.packages() calls download.packages(), and
    >> download.packages() calls download.file(), which uses
    >> "libcurl" as its default method.
    >> 
    >> This line from R mirror
    >> <https://github.com/wch/r-source/blob/trunk/src/modules/internet/libcurl.c#L772>
    >> ("if (!quiet) REprintf(_("trying URL '%s'\n"), url);")
    >> prints the full url it is trying to access.
    >> 
    >> This is totally fine for public urls without credentials,
    >> but in the case that a given url contains an API key, it
    >> poses security issues. For example, if the
    >> getOption("repos") has been overridden to a customized
    >> repository (protected by API keys), then
    >>> install.packages("zoo")
    >> Installing packages into '--removed local directory
    >> path--' trying URL 'https://--removed userid--:--removed
    >> api-key-- at repository-addresss.com:4443/.../src/contrib/zoo_1.8-12.tar.gz
    >> ' Content type 'application/x-gzip' length 782344 bytes
    >> (764 KB) =================================== downloaded
    >> 764 KB
    >> 
    >> * installing *source* package 'zoo' ...  -- further logs
    >> removed --
    >>> 
    >> 
    >> I also tried several other options:
    >> 
    >> 1. quite=1
    >>> install.packages("zoo", quite=1)
    >> It did hide the url, but it also hid all other useful
    >> information.  2. method="curl"
    >>> install.packages("zoo", method="curl")
    >> This does not print the url when the download is
    >> successful, but if there were any errors, it still prints
    >> the url with API key in it.  3. method="wget"
    >>> install.packages("zoo", method="wget")
    >> This hides API key by *password*, but I wasn't able to
    >> install packages with this method even with public repos,
    >> with the error "Warning: unable to access index for
    >> repository https://cloud.r-project.org/src/contrib/4.3:
    >> 'wget' call had nonzero exit status"
    >> 
    >> 
    >> In other dynamic languages' package managers like
    >> Python's pip, API keys are hidden by default since pip
    >> 18.x in 2018, and masked by "****" from pip 19.x in 2019,
    >> see below examples. Can we get a similar default
    >> behaviour in R?
    >> 
    >> 1. with pip 10.x $ pip install numpy -v # API key was not
    >> hided Looking in indexes: https://--removed
    >> userid--:--removed
    >> api-key-- at repository-addresss.com:4443/.../pypi/simple
    >> 2. with pip 18.x # All credentials are removed by pip $
    >> pip install numpy -v Looking in indexes:
    >> https://repository-addresss.com:4443/ .../pypi/simple
    >> 3. with pip 19.x onwards # userid is kept, API key is
    >> replaced by **** $ pip install numpy -v Looking in
    >> indexes: https://userid:****@
    >> repository-addresss.com:4443/.../pypi/simple
    >> 
    >> 
    >> I was instructed by https://www.r-project.org/bugs.html
    >> that I should get some discussion on r-devel before
    >> filing a feature request. So looking forward to
    >> comments/suggestions.
    >> 

    > ______________________________________________
    > R-devel at r-project.org mailing list
    > https://stat.ethz.ch/mailman/listinfo/r-devel


From x|ny|@xu97 @end|ng |rom gm@||@com  Mon Feb  5 14:09:55 2024
From: x|ny|@xu97 @end|ng |rom gm@||@com (Xinyi)
Date: Mon, 5 Feb 2024 13:09:55 +0000
Subject: [Rd] [Feature Request] Hide API Key in download.file() / R's
 libcurl
In-Reply-To: <26048.53733.550786.251117@stat.math.ethz.ch>
References: <CAOmDYzZe2ODCqgK+9sOtAAh1dVpAKK=PT7h7bs12cAFzk+ckMg@mail.gmail.com>
 <4A2FF313-9285-43C9-9179-6A4C93342D48@R-project.org>
 <26048.53733.550786.251117@stat.math.ethz.ch>
Message-ID: <CAOmDYzYnyBy4=4jAOgBdvoBaibgbAr_yHoc3zkXajSpe7+cOcg@mail.gmail.com>

Apologies for the typo in my original email. I meant ?quiet=1? and it was
working. The log was typed but not copied so that was why there was a typo.

But as stated in the reasoning - it hides all the output, so also other
useful information like where the lib is installed, compile details etc.
which will be useful for debugging. I.e. quiet=1 can be a workaround but
not a real solution.

I would know it was typo if I have only tried quite? As it would print
error telling me ?quite? is not recognised ;)

Cheers,
Xinyi



On Mon, Feb 5, 2024 at 12:17 Martin Maechler <maechler at stat.math.ethz.ch>
wrote:

> >>>>> Simon Urbanek
> >>>>>     on Sun, 4 Feb 2024 10:33:34 +1300 writes:
>
>     > Any reason why you didn't use quiet=TRUE to suppress that
>     > output?
>
> He wrote 'quite' instead of 'quiet' {see cited below '1. quite=1'}
> and probably never tried the correct spelling ...
>
>     > There is no official API structure for
>     > credentials in R repositories, so R has no way of knowing
>     > which part of the URL are credentials as it is not under
>     > R's purview - it could be part of the path or anything, so
>     > there is no way R can reliably mask it. Hence it makes
>     > more sense for the user to suppress the output if they
>     > think it may contain sensitive information - and R
>     > supports that.
>
>     > If that's still not enough, then please make a concrete
>     > proposal that defines exactly what kind processing you'd
>     > like to see under what conditions - and how you think that
>     > will solve the problem.
>
>     > Cheers, Simon
>
>
>
>     >> On Feb 2, 2024, at 5:28 AM, Xinyi <xinyi.xu97 at gmail.com>
>     >> wrote:
>     >>
>     >> Hi all,
>     >>
>     >> When trying to install a package from R using
>     >> install.packages(), it will print out the full url
>     >> address (of the remote repository) it was trying to
>     >> access. A bit further digging shows it is from the
>     >> in_do_curlDownload method from R's libcurl
>     >> <
> https://github.com/wch/r-source/blob/trunk/src/modules/internet/libcurl.c
> >:
>     >> install.packages() calls download.packages(), and
>     >> download.packages() calls download.file(), which uses
>     >> "libcurl" as its default method.
>     >>
>     >> This line from R mirror
>     >> <
> https://github.com/wch/r-source/blob/trunk/src/modules/internet/libcurl.c#L772
> >
>     >> ("if (!quiet) REprintf(_("trying URL '%s'\n"), url);")
>     >> prints the full url it is trying to access.
>     >>
>     >> This is totally fine for public urls without credentials,
>     >> but in the case that a given url contains an API key, it
>     >> poses security issues. For example, if the
>     >> getOption("repos") has been overridden to a customized
>     >> repository (protected by API keys), then
>     >>> install.packages("zoo")
>     >> Installing packages into '--removed local directory
>     >> path--' trying URL 'https://--removed userid--:--removed
>     >>
> api-key-- at repository-addresss.com:4443/.../src/contrib/zoo_1.8-12.tar.gz
>     >> ' Content type 'application/x-gzip' length 782344 bytes
>     >> (764 KB) =================================== downloaded
>     >> 764 KB
>     >>
>     >> * installing *source* package 'zoo' ...  -- further logs
>     >> removed --
>     >>>
>     >>
>     >> I also tried several other options:
>     >>
>     >> 1. quite=1
>     >>> install.packages("zoo", quite=1)
>     >> It did hide the url, but it also hid all other useful
>     >> information.  2. method="curl"
>     >>> install.packages("zoo", method="curl")
>     >> This does not print the url when the download is
>     >> successful, but if there were any errors, it still prints
>     >> the url with API key in it.  3. method="wget"
>     >>> install.packages("zoo", method="wget")
>     >> This hides API key by *password*, but I wasn't able to
>     >> install packages with this method even with public repos,
>     >> with the error "Warning: unable to access index for
>     >> repository https://cloud.r-project.org/src/contrib/4.3:
>     >> 'wget' call had nonzero exit status"
>     >>
>     >>
>     >> In other dynamic languages' package managers like
>     >> Python's pip, API keys are hidden by default since pip
>     >> 18.x in 2018, and masked by "****" from pip 19.x in 2019,
>     >> see below examples. Can we get a similar default
>     >> behaviour in R?
>     >>
>     >> 1. with pip 10.x $ pip install numpy -v # API key was not
>     >> hided Looking in indexes: https://--removed
>     >> userid--:--removed
>     >> api-key-- at repository-addresss.com:4443/.../pypi/simple
>     >> 2. with pip 18.x # All credentials are removed by pip $
>     >> pip install numpy -v Looking in indexes:
>     >> https://repository-addresss.com:4443/ .../pypi/simple
>     >> 3. with pip 19.x onwards # userid is kept, API key is
>     >> replaced by **** $ pip install numpy -v Looking in
>     >> indexes: https://userid:****@
>     >> repository-addresss.com:4443/.../pypi/simple
>     >>
>     >>
>     >> I was instructed by https://www.r-project.org/bugs.html
>     >> that I should get some discussion on r-devel before
>     >> filing a feature request. So looking forward to
>     >> comments/suggestions.
>     >>
>
>     > ______________________________________________
>     > R-devel at r-project.org mailing list
>     > https://stat.ethz.ch/mailman/listinfo/r-devel
>

	[[alternative HTML version deleted]]


From |kry|ov @end|ng |rom d|@root@org  Mon Feb  5 22:01:11 2024
From: |kry|ov @end|ng |rom d|@root@org (Ivan Krylov)
Date: Tue, 6 Feb 2024 00:01:11 +0300
Subject: [Rd] Advice debugging M1Mac check errors
In-Reply-To: <CAFDswJu2aDQzCZHJT7RqyBP-J8DLcj6PLzRBHbcStfxBJvw5Mg@mail.gmail.com>
References: <CAFDswJu2aDQzCZHJT7RqyBP-J8DLcj6PLzRBHbcStfxBJvw5Mg@mail.gmail.com>
Message-ID: <20240206000111.07ada026@Tarkus>

On Sun, 4 Feb 2024 20:41:51 +0100
Holger Hoefling <hhoeflin at gmail.com> wrote:

> I wanted to ask if people have good advice on how to debug M1Mac
> package check errors when you don?t have a Mac?

Apologies for not answering the question you asked, but is this about
hdf5r and problems printing R_xlen_t [*] that appeared in 1.3.8 and you
tried to solve in 1.3.9?

We had a thread about this last November:
https://stat.ethz.ch/pipermail/r-package-devel/2023q4/010123.html

To summarise, there is no single standard C format specifier that can be
used to print R_xlen_t. As an implementation detail, it can be defined
as int or ptrdiff_t (or something completely different in the future),
and ptrdiff_t itself is usually defined as long or long long (or, also,
something completely different on a weirder platform). All three basic
types can have different widths and cause painful stack-related
problems when a mismatch happens.

In R-4.4, there will be a macro R_PRIdXLEN_T defining a compatible
printf specifier. Until then (and for compatibility with R-4.3 and
lower), it's relatively safe to cast to (long long) or (ptrdiff_t) and
then use the corresponding specifier, but that's not 100% future-proof.
Also, mind the warnings that mingw compilers sometimes emit for "new"
printf specifiers despite UCRT is documented to support them.

-- 
Best regards,
Ivan

[*] https://www.stats.ox.ac.uk/pub/bdr/M1mac/hdf5r.out


From @g|@nner|n| @end|ng |rom gm@||@com  Tue Feb  6 15:25:03 2024
From: @g|@nner|n| @end|ng |rom gm@||@com (Simone Giannerini)
Date: Tue, 6 Feb 2024 15:25:03 +0100
Subject: [Rd] NROW and NCOL on NULL
In-Reply-To: <CANcXGizv3sD3kiE__EUkuaESn44mvtQMrtpO_k=FjUwFQDGnVQ@mail.gmail.com>
References: <CANcXGizv3sD3kiE__EUkuaESn44mvtQMrtpO_k=FjUwFQDGnVQ@mail.gmail.com>
Message-ID: <CANcXGiyF-2hPtYKKyMJn015EK55uS02U52wPmiW7HuxERa6ncg@mail.gmail.com>

I just saw this
------------------------------------------------------------------------
r85704 | hornik | 2023-12-19 00:33:07 -0600 (Tue, 19 Dec 2023) | 1 line
Changed paths:
   M /trunk/doc/NEWS.Rd
   M /trunk/src/library/base/R/matrix.R
   M /trunk/src/library/base/man/nrow.Rd
   M /trunk/src/library/profile/Common.R

Have NCOL(NULL) return 0 instead of 1.
------------------------------------------------------------------------

Many thanks to Kurt and the whole R-core team!

Simone

On Sat, Sep 23, 2023 at 7:43?PM Simone Giannerini <sgiannerini at gmail.com> wrote:
>
> Dear list,
>
> I do not know what would be the 'correct' answer to the following but
> I think that they should return the same value to avoid potential
> problems and hard to debug errors.
>
> Regards,
>
> Simone
> ---------------------------------------
>
> > NCOL(NULL)
> [1] 1
>
> > NROW(NULL)
> [1] 0
>
> > sessionInfo()
> R version 4.3.1 RC (2023-06-08 r84523 ucrt)
> Platform: x86_64-w64-mingw32/x64 (64-bit)
> Running under: Windows 11 x64 (build 22621)
>
> Matrix products: default
>
>
> locale:
> [1] LC_COLLATE=Italian_Italy.utf8  LC_CTYPE=Italian_Italy.utf8
> [3] LC_MONETARY=Italian_Italy.utf8 LC_NUMERIC=C
> [5] LC_TIME=Italian_Italy.utf8
>
> time zone: Europe/Rome
> tzcode source: internal
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> loaded via a namespace (and not attached):
> [1] compiler_4.3.1
>
> --
> ___________________________________________________
>
> Simone Giannerini
> Dipartimento di Scienze Statistiche "Paolo Fortunati"
> Universita' di Bologna
> Via delle belle arti 41 - 40126  Bologna,  ITALY
> Tel: +39 051 2098262  Fax: +39 051 232153
> https://simonegiannerini.net/
> ___________________________________________________



-- 
___________________________________________________

Simone Giannerini
Dipartimento di Scienze Statistiche "Paolo Fortunati"
Universita' di Bologna
Via delle belle arti 41 - 40126  Bologna,  ITALY
Tel: +39 051 2098262  Fax: +39 051 232153
https://simonegiannerini.net/


From r|p|ey @end|ng |rom @t@t@@ox@@c@uk  Tue Feb  6 17:06:46 2024
From: r|p|ey @end|ng |rom @t@t@@ox@@c@uk (Prof Brian Ripley)
Date: Tue, 6 Feb 2024 16:06:46 +0000
Subject: [Rd] Advice debugging M1Mac check errors
In-Reply-To: <CAFDswJu2aDQzCZHJT7RqyBP-J8DLcj6PLzRBHbcStfxBJvw5Mg@mail.gmail.com>
References: <CAFDswJu2aDQzCZHJT7RqyBP-J8DLcj6PLzRBHbcStfxBJvw5Mg@mail.gmail.com>
Message-ID: <90026864-f81c-4663-8cfe-6ae99d23307b@stats.ox.ac.uk>

On 04/02/2024 19:41, Holger Hoefling wrote:
> Hi,
> 
> I wanted to ask if people have good advice on how to debug M1Mac package
> check errors when you don?t have a Mac? Is a cloud machine the best option
> or is there something else?

I presumed this was about a CRAN package, possibly hdf5r which has a 
R-devel-only warning from the Apple clang compiler.  And that is not a 
'check error' and not something to 'debug'.

The original poster had errors for his package flsa until yesterday on 
fedora-clang and M1mac, which were compilation errors with recent LLVM 
and Apple compilers.  Again, not really something to 'debug' -- the 
compiler messages were clear and the CRAN notification contained advice 
on where in our manual to look this up.

The mac-builder service offers checks for R 4.3.0, the 'development' 
option being (last time I tried) the same as the 'release' option. (When 
I asked, Simon said that 'development' checks were only available in the 
run up to a x.y.0 when he starts package building and checks for R-devel.)


We were left to guess, but I doubt this has to do with the lack of 
'extended precision' nor long doubles longer than doubles on arm64 
macOS.  And issues with that are rather rare (much rarer than numerical 
issues for non-reference x86_64 BLAS/LAPACKs).  Of the 20,300 CRAN 
packages just 18 have M1mac-specific errors, none obviously from 
numerical inaccuracy.  A quick look back suggests we get about 20 a year 
with M1mac numerical issues, about half of which were mirrored on the 
x86_64 'noLD' checks.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Emeritus Professor of Applied Statistics, University of Oxford


From pro|jcn@@h @end|ng |rom gm@||@com  Tue Feb  6 17:37:26 2024
From: pro|jcn@@h @end|ng |rom gm@||@com (J C Nash)
Date: Tue, 6 Feb 2024 08:37:26 -0800
Subject: [Rd] Advice debugging M1Mac check errors
In-Reply-To: <90026864-f81c-4663-8cfe-6ae99d23307b@stats.ox.ac.uk>
References: <CAFDswJu2aDQzCZHJT7RqyBP-J8DLcj6PLzRBHbcStfxBJvw5Mg@mail.gmail.com>
 <90026864-f81c-4663-8cfe-6ae99d23307b@stats.ox.ac.uk>
Message-ID: <f46816fb-12fc-4763-b4e2-08c7d312fccc@gmail.com>

M1mac numerical issues should be rare, but when they do pop up they can be disconcerting.

The following little script reveals what happens with no extended precision. A few months
ago I built this into a "package" and used https://mac.r-project.org/macbuilder/submit.html
to run it, getting the indicated result of 0 for (sum(vv1) - 1.0e0), with non-zero on my
Ryzen 7 laptop.

JN

# FPExtendedTest.R   J C Nash
loopsum <- function(vec){
    n <- length(vec)
    vsum<-0.0
    for (i in 1:n) { vsum <- vsum + vec[i]}
    vsum
}
small<-.Machine$double.eps/4 # 1/4 of the machine precision
vsmall <- rep(small, 1e4) # a long vector of small numbers
vv1 <- c(1.0, vsmall) # 1 at the front of this vector
vv2 <- c(vsmall, 1.0) # 1 at the end
(sum(vv1) - 1.0e0) # Should be > 0 for extended precision, 0 otherwise
(sum(vv2) - 1.0e0) # Should be > 0
(loopsum(vv1) - 1.0e0) # should be zero
(loopsum(vv2) - 1.0e0) # should be greater than zero



On 2024-02-06 08:06, Prof Brian Ripley via R-devel wrote:

> 
> We were left to guess, but I doubt this has to do with the lack of 'extended precision' nor long doubles longer than 
> doubles on arm64 macOS.? And issues with that are rather rare (much rarer than numerical issues for non-reference x86_64 
> BLAS/LAPACKs).? Of the 20,300 CRAN packages just 18 have M1mac-specific errors, none obviously from numerical 
> inaccuracy.? A quick look back suggests we get about 20 a year with M1mac numerical issues, about half of which were 
> mirrored on the x86_64 'noLD' checks.
>


From hp@ge@@on@g|thub @end|ng |rom gm@||@com  Tue Feb  6 20:17:20 2024
From: hp@ge@@on@g|thub @end|ng |rom gm@||@com (=?UTF-8?B?SGVydsOpIFBhZ8Oocw==?=)
Date: Tue, 6 Feb 2024 11:17:20 -0800
Subject: [Rd] NOTE: multiple local function definitions for ?fun? with
 different formal arguments
In-Reply-To: <5cb29a06-5b73-4fe4-b8dc-7aa9db6a2cff@gmail.com>
References: <5jst8ric3j9fg55fkwuhhlyk.1707061436584@email.android.com>
 <CA+jjkEbwGe-W-gSfds1=4Vzrf=LOitwiE=4Vx0+NCj4t2t09JA@mail.gmail.com>
 <lo01v1qa61gmseab9ma660ts.1707061568394@email.android.com>
 <5cb29a06-5b73-4fe4-b8dc-7aa9db6a2cff@gmail.com>
Message-ID: <15c10f0d-2c05-4b84-a3f0-0c02fdbb15e2@gmail.com>

Thanks. Workarounds are interesting but... what's the point of the NOTE 
in the first place?

H.

On 2/4/24 09:07, Duncan Murdoch wrote:
> On 04/02/2024 10:55 a.m., Izmirlian, Grant (NIH/NCI) [E] via R-devel 
> wrote:
>> Well you can see that yeast is exactly weekday you have.? The way out 
>> is to just not name the result
>
> I think something happened to your explanation...
>
>>
>> toto <- function(mode)
>> {
>> ???? ifelse(mode == 1,
>> ???????? function(a,b) a*b,
>> ???????? function(u, v, w) (u + v) / w)
>> }
>
> It's a bad idea to use ifelse() when you really want if() ... else ... 
> . ?In this case it works, but it doesn't always.? So the workaround 
> should be
>
>
> toto <- function(mode)
> {
> ??? if(mode == 1)
> ??????? function(a,b) a*b
> ??? else
> ??????? function(u, v, w) (u + v) / w
> }
>
>
>>
>>
>> ________________________________
>> From: Grant Izmirlian <izmirlidroid at gmail.com>
>> Date: Sun, Feb 4, 2024, 10:44 AM
>> To: "Izmirlian, Grant (NIH/NCI) [E]" <izmirlig at mail.nih.gov>
>> Subject: Fwd: [EXTERNAL] R-devel Digest, Vol 252, Issue 2
>>
>> Hi,
>>
>> I just ran into this 'R CMD check' NOTE for the first time:
>>
>> * checking R code for possible problems ... NOTE
>> toto: multiple local function definitions for ?fun? with different
>> ?? formal arguments
>>
>> The "offending" code is something like this (simplified from the real 
>> code):
>>
>> toto <- function(mode)
>> {
>> ???? if (mode == 1)
>> ???????? fun <- function(a, b) a*b
>> ???? else
>> ???????? fun <- function(u, v, w) (u + v) / w
>> ???? fun
>> }
>>
>> Is that NOTE really intended? Hard to see why this code would be
>> considered "wrong".
>>
>> I know it's just a NOTE but still...
>
> I agree it's a false positive, but the issue is that you have a 
> function object in your function which can't be called 
> unconditionally.? The workaround doesn't create such an object.
>
> Recognizing that your function never tries to call fun requires global 
> inspection of toto(), and most of the checks are based on local 
> inspection.
>
> Duncan Murdoch
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Herv? Pag?s

Bioconductor Core Team
hpages.on.github at gmail.com

	[[alternative HTML version deleted]]


From |zm|r||g @end|ng |rom m@||@n|h@gov  Tue Feb  6 20:19:55 2024
From: |zm|r||g @end|ng |rom m@||@n|h@gov (Izmirlian, Grant (NIH/NCI) [E])
Date: Tue, 6 Feb 2024 19:19:55 +0000
Subject: [Rd] 
 [EXTERNAL] Re: NOTE: multiple local function definitions for
 ?fun? with different formal arguments
In-Reply-To: <15c10f0d-2c05-4b84-a3f0-0c02fdbb15e2@gmail.com>
References: <5jst8ric3j9fg55fkwuhhlyk.1707061436584@email.android.com>
 <CA+jjkEbwGe-W-gSfds1=4Vzrf=LOitwiE=4Vx0+NCj4t2t09JA@mail.gmail.com>
 <lo01v1qa61gmseab9ma660ts.1707061568394@email.android.com>
 <5cb29a06-5b73-4fe4-b8dc-7aa9db6a2cff@gmail.com>
 <15c10f0d-2c05-4b84-a3f0-0c02fdbb15e2@gmail.com>
Message-ID: <SA0PR09MB6955A7EF8CD84520F2FA6D8AE5462@SA0PR09MB6955.namprd09.prod.outlook.com>

The note refers to the fact that the function named ?fun? appears to be defined in two different ways.

From: Herv? Pag?s <hpages.on.github at gmail.com>
Sent: Tuesday, February 6, 2024 2:17 PM
To: Duncan Murdoch <murdoch.duncan at gmail.com>; Izmirlian, Grant (NIH/NCI) [E] <izmirlig at mail.nih.gov>; r-devel at r-project.org
Subject: [EXTERNAL] Re: [Rd] NOTE: multiple local function definitions for ?fun? with different formal arguments


Thanks. Workarounds are interesting but... what's the point of the NOTE in the first place?

H.
On 2/4/24 09:07, Duncan Murdoch wrote:
On 04/02/2024 10:55 a.m., Izmirlian, Grant (NIH/NCI) [E] via R-devel wrote:

Well you can see that yeast is exactly weekday you have.  The way out is to just not name the result

I think something happened to your explanation...



toto <- function(mode)
{
     ifelse(mode == 1,
         function(a,b) a*b,
         function(u, v, w) (u + v) / w)
}

It's a bad idea to use ifelse() when you really want if() ... else ... .  In this case it works, but it doesn't always.  So the workaround should be


toto <- function(mode)
{
    if(mode == 1)
        function(a,b) a*b
    else
        function(u, v, w) (u + v) / w
}





________________________________
From: Grant Izmirlian <izmirlidroid at gmail.com><mailto:izmirlidroid at gmail.com>
Date: Sun, Feb 4, 2024, 10:44 AM
To: "Izmirlian, Grant (NIH/NCI) [E]" <izmirlig at mail.nih.gov><mailto:izmirlig at mail.nih.gov>
Subject: Fwd: [EXTERNAL] R-devel Digest, Vol 252, Issue 2

Hi,

I just ran into this 'R CMD check' NOTE for the first time:

* checking R code for possible problems ... NOTE
toto: multiple local function definitions for ?fun? with different
   formal arguments

The "offending" code is something like this (simplified from the real code):

toto <- function(mode)
{
     if (mode == 1)
         fun <- function(a, b) a*b
     else
         fun <- function(u, v, w) (u + v) / w
     fun
}

Is that NOTE really intended? Hard to see why this code would be
considered "wrong".

I know it's just a NOTE but still...

I agree it's a false positive, but the issue is that you have a function object in your function which can't be called unconditionally.  The workaround doesn't create such an object.

Recognizing that your function never tries to call fun requires global inspection of toto(), and most of the checks are based on local inspection.

Duncan Murdoch

______________________________________________
R-devel at r-project.org<mailto:R-devel at r-project.org> mailing list
https://stat.ethz.ch/mailman/listinfo/r-devel

--

Herv? Pag?s



Bioconductor Core Team

hpages.on.github at gmail.com<mailto:hpages.on.github at gmail.com>
CAUTION: This email originated from outside of the organization. Do not click links or open attachments unless you recognize the sender and are confident the content is safe.


	[[alternative HTML version deleted]]


From |zm|r||g @end|ng |rom m@||@n|h@gov  Tue Feb  6 22:14:29 2024
From: |zm|r||g @end|ng |rom m@||@n|h@gov (Izmirlian, Grant (NIH/NCI) [E])
Date: Tue, 6 Feb 2024 21:14:29 +0000
Subject: [Rd] 
 [EXTERNAL] Re: NOTE: multiple local function definitions for
 ?fun? with different formal arguments
In-Reply-To: <33b6ee55-1caa-461b-a132-42e22f41dd1a@gmail.com>
References: <5jst8ric3j9fg55fkwuhhlyk.1707061436584@email.android.com>
 <CA+jjkEbwGe-W-gSfds1=4Vzrf=LOitwiE=4Vx0+NCj4t2t09JA@mail.gmail.com>
 <lo01v1qa61gmseab9ma660ts.1707061568394@email.android.com>
 <5cb29a06-5b73-4fe4-b8dc-7aa9db6a2cff@gmail.com>
 <15c10f0d-2c05-4b84-a3f0-0c02fdbb15e2@gmail.com>
 <SA0PR09MB6955A7EF8CD84520F2FA6D8AE5462@SA0PR09MB6955.namprd09.prod.outlook.com>
 <33b6ee55-1caa-461b-a132-42e22f41dd1a@gmail.com>
Message-ID: <SA0PR09MB69552A24686B60186A86BEC3E5462@SA0PR09MB6955.namprd09.prod.outlook.com>

Because functions get called and therefore, the calling sequence matters. It?s just protecting you from yourself, but as someone pointed out, there?s a way to silence such notes.
G


From: Herv? Pag?s <hpages.on.github at gmail.com>
Sent: Tuesday, February 6, 2024 2:40 PM
To: Izmirlian, Grant (NIH/NCI) [E] <izmirlig at mail.nih.gov>; Duncan Murdoch <murdoch.duncan at gmail.com>; r-devel at r-project.org
Subject: Re: [EXTERNAL] Re: [Rd] NOTE: multiple local function definitions for ?fun? with different formal arguments


On 2/6/24 11:19, Izmirlian, Grant (NIH/NCI) [E] wrote:
The note refers to the fact that the function named ?fun? appears to be defined in two different ways.

Sure I get that. But how is that any different from a variable being defined in two different ways like in

    if (mode == 1)
        x <- -8
    else
        x <- 55

This is such a common and perfectly fine pattern. Why would this be considered a potential hazard when the variable is a function?

H.

From: Herv? Pag?s <hpages.on.github at gmail.com><mailto:hpages.on.github at gmail.com>
Sent: Tuesday, February 6, 2024 2:17 PM
To: Duncan Murdoch <murdoch.duncan at gmail.com><mailto:murdoch.duncan at gmail.com>; Izmirlian, Grant (NIH/NCI) [E] <izmirlig at mail.nih.gov><mailto:izmirlig at mail.nih.gov>; r-devel at r-project.org<mailto:r-devel at r-project.org>
Subject: [EXTERNAL] Re: [Rd] NOTE: multiple local function definitions for ?fun? with different formal arguments


Thanks. Workarounds are interesting but... what's the point of the NOTE in the first place?

H.
On 2/4/24 09:07, Duncan Murdoch wrote:
On 04/02/2024 10:55 a.m., Izmirlian, Grant (NIH/NCI) [E] via R-devel wrote:


Well you can see that yeast is exactly weekday you have.  The way out is to just not name the result

I think something happened to your explanation...




toto <- function(mode)
{
     ifelse(mode == 1,
         function(a,b) a*b,
         function(u, v, w) (u + v) / w)
}

It's a bad idea to use ifelse() when you really want if() ... else ... .  In this case it works, but it doesn't always.  So the workaround should be


toto <- function(mode)
{
    if(mode == 1)
        function(a,b) a*b
    else
        function(u, v, w) (u + v) / w
}






________________________________
From: Grant Izmirlian <izmirlidroid at gmail.com><mailto:izmirlidroid at gmail.com>
Date: Sun, Feb 4, 2024, 10:44 AM
To: "Izmirlian, Grant (NIH/NCI) [E]" <izmirlig at mail.nih.gov><mailto:izmirlig at mail.nih.gov>
Subject: Fwd: [EXTERNAL] R-devel Digest, Vol 252, Issue 2

Hi,

I just ran into this 'R CMD check' NOTE for the first time:

* checking R code for possible problems ... NOTE
toto: multiple local function definitions for ?fun? with different
   formal arguments

The "offending" code is something like this (simplified from the real code):

toto <- function(mode)
{
     if (mode == 1)
         fun <- function(a, b) a*b
     else
         fun <- function(u, v, w) (u + v) / w
     fun
}

Is that NOTE really intended? Hard to see why this code would be
considered "wrong".

I know it's just a NOTE but still...

I agree it's a false positive, but the issue is that you have a function object in your function which can't be called unconditionally.  The workaround doesn't create such an object.

Recognizing that your function never tries to call fun requires global inspection of toto(), and most of the checks are based on local inspection.

Duncan Murdoch

______________________________________________
R-devel at r-project.org<mailto:R-devel at r-project.org> mailing list
https://stat.ethz.ch/mailman/listinfo/r-devel

--

Herv? Pag?s



Bioconductor Core Team

hpages.on.github at gmail.com<mailto:hpages.on.github at gmail.com>
CAUTION: This email originated from outside of the organization. Do not click links or open attachments unless you recognize the sender and are confident the content is safe.


--

Herv? Pag?s



Bioconductor Core Team

hpages.on.github at gmail.com<mailto:hpages.on.github at gmail.com>
CAUTION: This email originated from outside of the organization. Do not click links or open attachments unless you recognize the sender and are confident the content is safe.


	[[alternative HTML version deleted]]


From murdoch@dunc@n @end|ng |rom gm@||@com  Tue Feb  6 22:20:33 2024
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Tue, 6 Feb 2024 16:20:33 -0500
Subject: [Rd] NOTE: multiple local function definitions for ?fun? with
 different formal arguments
In-Reply-To: <15c10f0d-2c05-4b84-a3f0-0c02fdbb15e2@gmail.com>
References: <5jst8ric3j9fg55fkwuhhlyk.1707061436584@email.android.com>
 <CA+jjkEbwGe-W-gSfds1=4Vzrf=LOitwiE=4Vx0+NCj4t2t09JA@mail.gmail.com>
 <lo01v1qa61gmseab9ma660ts.1707061568394@email.android.com>
 <5cb29a06-5b73-4fe4-b8dc-7aa9db6a2cff@gmail.com>
 <15c10f0d-2c05-4b84-a3f0-0c02fdbb15e2@gmail.com>
Message-ID: <6be852da-f101-4e0f-85f9-23679583f64a@gmail.com>

On 06/02/2024 2:17 p.m., Herv? Pag?s wrote:
> Thanks. Workarounds are interesting but... what's the point of the NOTE 
> in the first place?

Creating a function that can't be called could be an error.  Presumably 
you are careful and never try to call it with the wrong signature, but 
the check code isn't smart enough to follow every code path, so it gives 
the note to warn you that you might have something wrong.

You still have the same issue with my workaround, but the check code 
isn't smart enough to notice that.

Duncan Murdoch

> 
> H.
> 
> On 2/4/24 09:07, Duncan Murdoch wrote:
>> On 04/02/2024 10:55 a.m., Izmirlian, Grant (NIH/NCI) [E] via R-devel 
>> wrote:
>>> Well you can see that yeast is exactly weekday you have.? The way out 
>>> is to just not name the result
>>
>> I think something happened to your explanation...
>>
>>>
>>> toto <- function(mode)
>>> {
>>> ???? ifelse(mode == 1,
>>> ???????? function(a,b) a*b,
>>> ???????? function(u, v, w) (u + v) / w)
>>> }
>>
>> It's a bad idea to use ifelse() when you really want if() ... else ... 
>> . ?In this case it works, but it doesn't always.? So the workaround 
>> should be
>>
>>
>> toto <- function(mode)
>> {
>> ??? if(mode == 1)
>> ??????? function(a,b) a*b
>> ??? else
>> ??????? function(u, v, w) (u + v) / w
>> }
>>
>>
>>>
>>>
>>> ________________________________
>>> From: Grant Izmirlian <izmirlidroid at gmail.com>
>>> Date: Sun, Feb 4, 2024, 10:44 AM
>>> To: "Izmirlian, Grant (NIH/NCI) [E]" <izmirlig at mail.nih.gov>
>>> Subject: Fwd: [EXTERNAL] R-devel Digest, Vol 252, Issue 2
>>>
>>> Hi,
>>>
>>> I just ran into this 'R CMD check' NOTE for the first time:
>>>
>>> * checking R code for possible problems ... NOTE
>>> toto: multiple local function definitions for ?fun? with different
>>> ?? formal arguments
>>>
>>> The "offending" code is something like this (simplified from the real 
>>> code):
>>>
>>> toto <- function(mode)
>>> {
>>> ???? if (mode == 1)
>>> ???????? fun <- function(a, b) a*b
>>> ???? else
>>> ???????? fun <- function(u, v, w) (u + v) / w
>>> ???? fun
>>> }
>>>
>>> Is that NOTE really intended? Hard to see why this code would be
>>> considered "wrong".
>>>
>>> I know it's just a NOTE but still...
>>
>> I agree it's a false positive, but the issue is that you have a 
>> function object in your function which can't be called 
>> unconditionally.? The workaround doesn't create such an object.
>>
>> Recognizing that your function never tries to call fun requires global 
>> inspection of toto(), and most of the checks are based on local 
>> inspection.
>>
>> Duncan Murdoch
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> -- 
> Herv? Pag?s
> 
> Bioconductor Core Team
> hpages.on.github at gmail.com
>


From henr|k@bengt@@on @end|ng |rom gm@||@com  Tue Feb  6 22:29:49 2024
From: henr|k@bengt@@on @end|ng |rom gm@||@com (Henrik Bengtsson)
Date: Tue, 6 Feb 2024 13:29:49 -0800
Subject: [Rd] 
 [EXTERNAL] Re: NOTE: multiple local function definitions for
 ?fun? with different formal arguments
In-Reply-To: <SA0PR09MB69552A24686B60186A86BEC3E5462@SA0PR09MB6955.namprd09.prod.outlook.com>
References: <5jst8ric3j9fg55fkwuhhlyk.1707061436584@email.android.com>
 <CA+jjkEbwGe-W-gSfds1=4Vzrf=LOitwiE=4Vx0+NCj4t2t09JA@mail.gmail.com>
 <lo01v1qa61gmseab9ma660ts.1707061568394@email.android.com>
 <5cb29a06-5b73-4fe4-b8dc-7aa9db6a2cff@gmail.com>
 <15c10f0d-2c05-4b84-a3f0-0c02fdbb15e2@gmail.com>
 <SA0PR09MB6955A7EF8CD84520F2FA6D8AE5462@SA0PR09MB6955.namprd09.prod.outlook.com>
 <33b6ee55-1caa-461b-a132-42e22f41dd1a@gmail.com>
 <SA0PR09MB69552A24686B60186A86BEC3E5462@SA0PR09MB6955.namprd09.prod.outlook.com>
Message-ID: <CAFDcVCTsEMwRhR6qFw1m7g0852XdeeNKALXhGNd2ZVzaMutoVA@mail.gmail.com>

Here's a dummy example that I think illustrates the problem:

toto <- function() {
  if (runif(1) < 0.5)
    function(a) a
  else
    function(a,b) a+b
}

> fcn <- toto()
> fcn(1,2)
[1] 3
> fcn <- toto()
> fcn(1,2)
[1] 3
> fcn <- toto()
> fcn(1,2)
Error in fcn(1, 2) : unused argument (2)

How can you use the returned function, if you get different arguments?

In your example, you cannot use the returned function without knowing
'mode', or by inspecting the returned function.  So, the warning is
there to alert you to a potential bug.  Anecdotally, I'm pretty sure
this R CMD check NOTE has caught at least one such bug in one of
my/our packages.

If you want to keep the current design pattern, one approach could be
to add ... to your function definitions:

toto <- function(mode)
{
     if (mode == 1)
         fun <- function(a, b, ...) a*b
     else
         fun <- function(u, v, w) (u + v) / w
     fun
}

to make sure that toto() returns functions that accept the same
minimal number of arguments.

/Henrik

On Tue, Feb 6, 2024 at 1:15?PM Izmirlian, Grant (NIH/NCI) [E] via
R-devel <r-devel at r-project.org> wrote:
>
> Because functions get called and therefore, the calling sequence matters. It?s just protecting you from yourself, but as someone pointed out, there?s a way to silence such notes.
> G
>
>
> From: Herv? Pag?s <hpages.on.github at gmail.com>
> Sent: Tuesday, February 6, 2024 2:40 PM
> To: Izmirlian, Grant (NIH/NCI) [E] <izmirlig at mail.nih.gov>; Duncan Murdoch <murdoch.duncan at gmail.com>; r-devel at r-project.org
> Subject: Re: [EXTERNAL] Re: [Rd] NOTE: multiple local function definitions for ?fun? with different formal arguments
>
>
> On 2/6/24 11:19, Izmirlian, Grant (NIH/NCI) [E] wrote:
> The note refers to the fact that the function named ?fun? appears to be defined in two different ways.
>
> Sure I get that. But how is that any different from a variable being defined in two different ways like in
>
>     if (mode == 1)
>         x <- -8
>     else
>         x <- 55
>
> This is such a common and perfectly fine pattern. Why would this be considered a potential hazard when the variable is a function?
>
> H.
>
> From: Herv? Pag?s <hpages.on.github at gmail.com><mailto:hpages.on.github at gmail.com>
> Sent: Tuesday, February 6, 2024 2:17 PM
> To: Duncan Murdoch <murdoch.duncan at gmail.com><mailto:murdoch.duncan at gmail.com>; Izmirlian, Grant (NIH/NCI) [E] <izmirlig at mail.nih.gov><mailto:izmirlig at mail.nih.gov>; r-devel at r-project.org<mailto:r-devel at r-project.org>
> Subject: [EXTERNAL] Re: [Rd] NOTE: multiple local function definitions for ?fun? with different formal arguments
>
>
> Thanks. Workarounds are interesting but... what's the point of the NOTE in the first place?
>
> H.
> On 2/4/24 09:07, Duncan Murdoch wrote:
> On 04/02/2024 10:55 a.m., Izmirlian, Grant (NIH/NCI) [E] via R-devel wrote:
>
>
> Well you can see that yeast is exactly weekday you have.  The way out is to just not name the result
>
> I think something happened to your explanation...
>
>
>
>
> toto <- function(mode)
> {
>      ifelse(mode == 1,
>          function(a,b) a*b,
>          function(u, v, w) (u + v) / w)
> }
>
> It's a bad idea to use ifelse() when you really want if() ... else ... .  In this case it works, but it doesn't always.  So the workaround should be
>
>
> toto <- function(mode)
> {
>     if(mode == 1)
>         function(a,b) a*b
>     else
>         function(u, v, w) (u + v) / w
> }
>
>
>
>
>
>
> ________________________________
> From: Grant Izmirlian <izmirlidroid at gmail.com><mailto:izmirlidroid at gmail.com>
> Date: Sun, Feb 4, 2024, 10:44 AM
> To: "Izmirlian, Grant (NIH/NCI) [E]" <izmirlig at mail.nih.gov><mailto:izmirlig at mail.nih.gov>
> Subject: Fwd: [EXTERNAL] R-devel Digest, Vol 252, Issue 2
>
> Hi,
>
> I just ran into this 'R CMD check' NOTE for the first time:
>
> * checking R code for possible problems ... NOTE
> toto: multiple local function definitions for ?fun? with different
>    formal arguments
>
> The "offending" code is something like this (simplified from the real code):
>
> toto <- function(mode)
> {
>      if (mode == 1)
>          fun <- function(a, b) a*b
>      else
>          fun <- function(u, v, w) (u + v) / w
>      fun
> }
>
> Is that NOTE really intended? Hard to see why this code would be
> considered "wrong".
>
> I know it's just a NOTE but still...
>
> I agree it's a false positive, but the issue is that you have a function object in your function which can't be called unconditionally.  The workaround doesn't create such an object.
>
> Recognizing that your function never tries to call fun requires global inspection of toto(), and most of the checks are based on local inspection.
>
> Duncan Murdoch
>
> ______________________________________________
> R-devel at r-project.org<mailto:R-devel at r-project.org> mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
> --
>
> Herv? Pag?s
>
>
>
> Bioconductor Core Team
>
> hpages.on.github at gmail.com<mailto:hpages.on.github at gmail.com>
> CAUTION: This email originated from outside of the organization. Do not click links or open attachments unless you recognize the sender and are confident the content is safe.
>
>
> --
>
> Herv? Pag?s
>
>
>
> Bioconductor Core Team
>
> hpages.on.github at gmail.com<mailto:hpages.on.github at gmail.com>
> CAUTION: This email originated from outside of the organization. Do not click links or open attachments unless you recognize the sender and are confident the content is safe.
>
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From murdoch@dunc@n @end|ng |rom gm@||@com  Tue Feb  6 22:31:10 2024
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Tue, 6 Feb 2024 16:31:10 -0500
Subject: [Rd] Get list of active calling handlers?
Message-ID: <e5f12cfa-7efa-41e8-b152-6e9ef8af39b9@gmail.com>

The SO post https://stackoverflow.com/q/77943180 tried to call 
globalCallingHandlers() from a function, and it failed with the error 
message "should not be called with handlers on the stack".  A much 
simpler illustration of the same error comes from this line:

   try(globalCallingHandlers(warning = function(e) e))

The problem here is that try() sets an error handler, and 
globalCallingHandlers() sees it and aborts.

If I call globalCallingHandlers() with no arguments, I get a list of 
currently active global handlers.  Is there also a way to get a list of 
active handlers, including non-global ones (like the one try() added in 
the line above)?

Duncan Murdoch


From mtmorg@n@xyz @end|ng |rom gm@||@com  Wed Feb  7 00:17:03 2024
From: mtmorg@n@xyz @end|ng |rom gm@||@com (Martin Morgan)
Date: Tue, 6 Feb 2024 23:17:03 +0000
Subject: [Rd] 
 [EXTERNAL] Re: NOTE: multiple local function definitions for
 ?fun? with different formal arguments
In-Reply-To: <CAFDcVCTsEMwRhR6qFw1m7g0852XdeeNKALXhGNd2ZVzaMutoVA@mail.gmail.com>
References: <5jst8ric3j9fg55fkwuhhlyk.1707061436584@email.android.com>
 <CA+jjkEbwGe-W-gSfds1=4Vzrf=LOitwiE=4Vx0+NCj4t2t09JA@mail.gmail.com>
 <lo01v1qa61gmseab9ma660ts.1707061568394@email.android.com>
 <5cb29a06-5b73-4fe4-b8dc-7aa9db6a2cff@gmail.com>
 <15c10f0d-2c05-4b84-a3f0-0c02fdbb15e2@gmail.com>
 <SA0PR09MB6955A7EF8CD84520F2FA6D8AE5462@SA0PR09MB6955.namprd09.prod.outlook.com>
 <33b6ee55-1caa-461b-a132-42e22f41dd1a@gmail.com>
 <SA0PR09MB69552A24686B60186A86BEC3E5462@SA0PR09MB6955.namprd09.prod.outlook.com>
 <CAFDcVCTsEMwRhR6qFw1m7g0852XdeeNKALXhGNd2ZVzaMutoVA@mail.gmail.com>
Message-ID: <DS7PR10MB727772ADF2D69B769FC88A1BFA462@DS7PR10MB7277.namprd10.prod.outlook.com>

I went looking and found this in codetools, where it's been for 20 years

https://gitlab.com/luke-tierney/codetools/-/blame/master/R/codetools.R?ref_type=heads#L951

I think the call stack in codetools is checkUsagePackage -> checkUsageEnv -> checkUsage, and these are similarly established. The call from the tools package https://github.com/wch/r-source/blame/95146f0f366a36899e4277a6a722964a51b93603/src/library/tools/R/QC.R#L4585 is also quite old.

I'm not sure this had been said explicitly, but perhaps the original intent was to protect against accidentally redefining a local function. Obviously one could do this with a local variable too, though that might less often be an error?

toto <- function(mode) {
    tata <- function(a, b) a * b  # intended
    tata <- function(a, b) a / b  # oops
    ?
}

Another workaround is to actually name the local functions

toto <- function(mode) {
    tata <- function(a, b) a * b
    titi <- function(u, v, w) (u + v) / w
    if (mode == 1)
        tata
    else
        titi
}

? or to use a switch statement

toto <- function(mode) {
    ## fun <- switch(?) for use of `fun()` in toto
    switch(
        mode,
        tata = function(a, b) a * b,
        titi = function(u, v, w) (u + v) / w,
        stop("unknown `mode = '", mode, "'`")
    )
}

? or similarly to write `fun <- if ? else ?`, assigning the result of the `if` to `fun`. I guess this last formulation points to the fact that a more careful analysis of Herv?'s original code means that `fun` can only take one value (only one branch of the `if` can be taken) so there can only be one version of `fun` in any invocation of `toto()`.

Perhaps the local names (and string-valued 'mode') are suggestive of special case, so serve as implicit documentation?

Adding `?` to `tata` doesn't seem like a good idea; toto(1)(3, 5, 7) no longer signals an error.

There seems to be a lot in common with S3 and S4 methods, where `toto` corresponds to the generic, `tata` and `titi` to methods. This 'dispatch' is brought out by using `switch()`. There is plenty of opportunity for thinking that you're invoking one method but actually you're invoking the other. For instance with dplyr, I like that I can tbl |> print(n = 2) so much that I find myself doing this with data.frame df |> print(n = 2), which is an error (`n` partially matches `na.print`, and 2 is not a valid value); both methods silently ignore the typo print(m = 2).

Martin Morgan

From: R-devel <r-devel-bounces at r-project.org> on behalf of Henrik Bengtsson <henrik.bengtsson at gmail.com>
Date: Tuesday, February 6, 2024 at 4:34?PM
To: Izmirlian, Grant (NIH/NCI) [E] <izmirlig at mail.nih.gov>
Cc: r-devel at r-project.org <r-devel at r-project.org>
Subject: Re: [Rd] [EXTERNAL] Re: NOTE: multiple local function definitions for ?fun? with different formal arguments
Here's a dummy example that I think illustrates the problem:

toto <- function() {
  if (runif(1) < 0.5)
    function(a) a
  else
    function(a,b) a+b
}

> fcn <- toto()
> fcn(1,2)
[1] 3
> fcn <- toto()
> fcn(1,2)
[1] 3
> fcn <- toto()
> fcn(1,2)
Error in fcn(1, 2) : unused argument (2)

How can you use the returned function, if you get different arguments?

In your example, you cannot use the returned function without knowing
'mode', or by inspecting the returned function.  So, the warning is
there to alert you to a potential bug.  Anecdotally, I'm pretty sure
this R CMD check NOTE has caught at least one such bug in one of
my/our packages.

If you want to keep the current design pattern, one approach could be
to add ... to your function definitions:

toto <- function(mode)
{
     if (mode == 1)
         fun <- function(a, b, ...) a*b
     else
         fun <- function(u, v, w) (u + v) / w
     fun
}

to make sure that toto() returns functions that accept the same
minimal number of arguments.

/Henrik

On Tue, Feb 6, 2024 at 1:15?PM Izmirlian, Grant (NIH/NCI) [E] via
R-devel <r-devel at r-project.org> wrote:
>
> Because functions get called and therefore, the calling sequence matters. It?s just protecting you from yourself, but as someone pointed out, there?s a way to silence such notes.
> G
>
>
> From: Herv? Pag?s <hpages.on.github at gmail.com>
> Sent: Tuesday, February 6, 2024 2:40 PM
> To: Izmirlian, Grant (NIH/NCI) [E] <izmirlig at mail.nih.gov>; Duncan Murdoch <murdoch.duncan at gmail.com>; r-devel at r-project.org
> Subject: Re: [EXTERNAL] Re: [Rd] NOTE: multiple local function definitions for ?fun? with different formal arguments
>
>
> On 2/6/24 11:19, Izmirlian, Grant (NIH/NCI) [E] wrote:
> The note refers to the fact that the function named ?fun? appears to be defined in two different ways.
>
> Sure I get that. But how is that any different from a variable being defined in two different ways like in
>
>     if (mode == 1)
>         x <- -8
>     else
>         x <- 55
>
> This is such a common and perfectly fine pattern. Why would this be considered a potential hazard when the variable is a function?
>
> H.
>
> From: Herv? Pag?s <hpages.on.github at gmail.com><mailto:hpages.on.github at gmail.com>
> Sent: Tuesday, February 6, 2024 2:17 PM
> To: Duncan Murdoch <murdoch.duncan at gmail.com><mailto:murdoch.duncan at gmail.com>; Izmirlian, Grant (NIH/NCI) [E] <izmirlig at mail.nih.gov><mailto:izmirlig at mail.nih.gov>; r-devel at r-project.org<mailto:r-devel at r-project.org>
> Subject: [EXTERNAL] Re: [Rd] NOTE: multiple local function definitions for ?fun? with different formal arguments
>
>
> Thanks. Workarounds are interesting but... what's the point of the NOTE in the first place?
>
> H.
> On 2/4/24 09:07, Duncan Murdoch wrote:
> On 04/02/2024 10:55 a.m., Izmirlian, Grant (NIH/NCI) [E] via R-devel wrote:
>
>
> Well you can see that yeast is exactly weekday you have.  The way out is to just not name the result
>
> I think something happened to your explanation...
>
>
>
>
> toto <- function(mode)
> {
>      ifelse(mode == 1,
>          function(a,b) a*b,
>          function(u, v, w) (u + v) / w)
> }
>
> It's a bad idea to use ifelse() when you really want if() ... else ... .  In this case it works, but it doesn't always.  So the workaround should be
>
>
> toto <- function(mode)
> {
>     if(mode == 1)
>         function(a,b) a*b
>     else
>         function(u, v, w) (u + v) / w
> }
>
>
>
>
>
>
> ________________________________
> From: Grant Izmirlian <izmirlidroid at gmail.com><mailto:izmirlidroid at gmail.com>
> Date: Sun, Feb 4, 2024, 10:44 AM
> To: "Izmirlian, Grant (NIH/NCI) [E]" <izmirlig at mail.nih.gov><mailto:izmirlig at mail.nih.gov>
> Subject: Fwd: [EXTERNAL] R-devel Digest, Vol 252, Issue 2
>
> Hi,
>
> I just ran into this 'R CMD check' NOTE for the first time:
>
> * checking R code for possible problems ... NOTE
> toto: multiple local function definitions for ?fun? with different
>    formal arguments
>
> The "offending" code is something like this (simplified from the real code):
>
> toto <- function(mode)
> {
>      if (mode == 1)
>          fun <- function(a, b) a*b
>      else
>          fun <- function(u, v, w) (u + v) / w
>      fun
> }
>
> Is that NOTE really intended? Hard to see why this code would be
> considered "wrong".
>
> I know it's just a NOTE but still...
>
> I agree it's a false positive, but the issue is that you have a function object in your function which can't be called unconditionally.  The workaround doesn't create such an object.
>
> Recognizing that your function never tries to call fun requires global inspection of toto(), and most of the checks are based on local inspection.
>
> Duncan Murdoch
>
> ______________________________________________
> R-devel at r-project.org<mailto:R-devel at r-project.org> mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
> --
>
> Herv? Pag?s
>
>
>
> Bioconductor Core Team
>
> hpages.on.github at gmail.com<mailto:hpages.on.github at gmail.com>
> CAUTION: This email originated from outside of the organization. Do not click links or open attachments unless you recognize the sender and are confident the content is safe.
>
>
> --
>
> Herv? Pag?s
>
>
>
> Bioconductor Core Team
>
> hpages.on.github at gmail.com<mailto:hpages.on.github at gmail.com>
> CAUTION: This email originated from outside of the organization. Do not click links or open attachments unless you recognize the sender and are confident the content is safe.
>
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

______________________________________________
R-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-devel

	[[alternative HTML version deleted]]


From @|mon@urb@nek @end|ng |rom R-project@org  Wed Feb  7 01:34:09 2024
From: @|mon@urb@nek @end|ng |rom R-project@org (Simon Urbanek)
Date: Wed, 7 Feb 2024 13:34:09 +1300
Subject: [Rd] Advice debugging M1Mac check errors
In-Reply-To: <90026864-f81c-4663-8cfe-6ae99d23307b@stats.ox.ac.uk>
References: <CAFDswJu2aDQzCZHJT7RqyBP-J8DLcj6PLzRBHbcStfxBJvw5Mg@mail.gmail.com>
 <90026864-f81c-4663-8cfe-6ae99d23307b@stats.ox.ac.uk>
Message-ID: <60EB5C3D-794E-4583-A838-0827EA357A94@R-project.org>



> On 7/02/2024, at 5:06 AM, Prof Brian Ripley via R-devel <r-devel at r-project.org> wrote:
> 
> On 04/02/2024 19:41, Holger Hoefling wrote:
>> Hi,
>> I wanted to ask if people have good advice on how to debug M1Mac package
>> check errors when you don?t have a Mac? Is a cloud machine the best option
>> or is there something else?
> 
> I presumed this was about a CRAN package, possibly hdf5r which has a R-devel-only warning from the Apple clang compiler.  And that is not a 'check error' and not something to 'debug'.
> 
> The original poster had errors for his package flsa until yesterday on fedora-clang and M1mac, which were compilation errors with recent LLVM and Apple compilers.  Again, not really something to 'debug' -- the compiler messages were clear and the CRAN notification contained advice on where in our manual to look this up.
> 
> The mac-builder service offers checks for R 4.3.0, the 'development' option being (last time I tried) the same as the 'release' option. (When I asked, Simon said that 'development' checks were only available in the run up to a x.y.0 when he starts package building and checks for R-devel.)
> 


Just to clarify, the above is outdated information - ever since the R-devel packages binaries are on CRAN the "development" option in the mac-builder is available.

Cheers,
Simon



> 
> We were left to guess, but I doubt this has to do with the lack of 'extended precision' nor long doubles longer than doubles on arm64 macOS.  And issues with that are rather rare (much rarer than numerical issues for non-reference x86_64 BLAS/LAPACKs).  Of the 20,300 CRAN packages just 18 have M1mac-specific errors, none obviously from numerical inaccuracy.  A quick look back suggests we get about 20 a year with M1mac numerical issues, about half of which were mirrored on the x86_64 'noLD' checks.
> 
> -- 
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Emeritus Professor of Applied Statistics, University of Oxford
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 


