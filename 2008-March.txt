From mtmorgan at fhcrc.org  Sat Mar  1 14:49:54 2008
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Sat, 01 Mar 2008 05:49:54 -0800
Subject: [Rd] Problems initializing an extended S4 class
In-Reply-To: <47C7B7B0.6070406@nceas.ucsb.edu> (Jim Regetz's message of
	"Thu, 28 Feb 2008 23:43:44 -0800")
References: <47C7B7B0.6070406@nceas.ucsb.edu>
Message-ID: <6phy792o8ot.fsf@gopher4.fhcrc.org>

Hi Jim --

I think your problems have to do with the way 'initialize' and
'validObject' work together. At some point in it's code, validObject
converts an instance 'b' of a derived class (e.g., B) into that of the
base class (e.g., A). It does this, by calling a = new("A"), and then
copying the relevant slots from the instance of b to new a. So...

> 1. Why is initialize invoked *twice* for A during instantiation of B?

...the initialize method for A gets invoked twice, once when B is
being created originally, and once when B is being checked for
validity and is being converted to A.

> 2. The second time initialize is invoked for A, it appears .Object at x is 
> only bound to its implicit prototype value of numeric(0). Why? Of 

...and this is because of how A is being constructed from B -- with a
called to new("A"), with no additional arguments.

Practically, this means that your classes have to be valid when
created with new("A"). This imposes constraints on the prototype,and
on the initialize method, and in the end I've found myself writing
'constructors' that process user-friendly arguments into a format that
can be passed to 'new' as slots, e.g.,

A <- function(x=numeric(0), ...) {
    x <- ifelse(log(x)<0, 1, x)
    new("A", x=x, ...)
}

In some ways I think this is the right thing to do anyway (a layer of
abstraction between the user and implementation), even if the
motivation might not be so pure.

Martin


Jim Regetz <regetz at nceas.ucsb.edu> writes:

> Hi all,
>
> I am having trouble extending S4 classes in cases where I'm using both 
> validity and initialize methods. I've read as much S4 information as I 
> can find, but I've yet to have that "a-ha" moment.
>
> In my application, I am using validity methods to guard against 
> inappropriate input data that my code has no way of handling, and 
> initialize methods to detect and deal with fixable problems. As a toy 
> example, consider classes A and B and associated methods as defined 
> below. I use a validity method for A to complain about negative values, 
> and an initialize method to "correct" small input values. B should 
> simply extend A by adding an extra slot. The example is contrived, but 
> it illustrates a key behavior that I also encounter in my real code:
>
> setClass("A", representation(x="numeric"))
> setClass("B", representation(y="character"), contains="A")
>
> setValidity("A", function(object) {
>      message("start validate A")
>      retval <- NULL
>      if (any(object at x<0))
>          retval <- c(retval, "x must be positive")
>      message("done validate A")
>      if(is.null(retval)) return(TRUE) else return(retval)
> })
>
> setMethod("initialize", "A", function(.Object, ...) {
>      message("start init A")
>      .Object <- callNextMethod()
>      x <- .Object at x
>      .Object at x <- ifelse(log(x)<0, 1, x)
>      message("done init A")
>      .Object
> })
>
> setMethod("initialize", "B", function(.Object, ...) {
>      message("start init B")
>      callNextMethod()
> })
>
>
> # Creating an instance of A works just as I would expect
>> a <- new("A", x=c(0.5, 2))
> start init A
> start validate A
> done validate A
> done init A
>> a
> An object of class ?A?
> Slot "x":
> [1] 1 2
>
> # But subsequently creating a derived B object fails!
>> new("B", a, y="foo")
> start init B
> start init A
> start validate A
> start init A
> Error in checkSlotAssignment(object, name, value) :
>    assignment of an object of class "logical" is not valid for slot "x"
> in an object of class "A"; is(value, "numeric") is not TRUE
>
> The two things I haven't quite figured out are:
>
> 1. Why is initialize invoked *twice* for A during instantiation of B?
>
> 2. The second time initialize is invoked for A, it appears .Object at x is 
> only bound to its implicit prototype value of numeric(0). Why? Of 
> course, this leads to an error because the ifelse expression 
> subsequently evaluates to logical(0) rather than a numeric vector as 
> intended. Again, this is a contrived example, but a very real problem in 
> my code.
>
> I suppose I could define a prototype for A that I know won't break my 
> initialize method, but that seems inelegant and hard to maintain. Is 
> there a better way to code this so that I can reliably instantiate B 
> using a valid A object? Hopefully I've just got something wrong in the 
> formals for my initialize methods or in my use of getNextMethod(), but 
> I've had no luck trying some alternatives -- and ultimately I'd prefer 
> to better understand the underlying behavior rather than stumble onto 
> something that merely appears to work.
>
> I'd be grateful for any suggestions...
>
> Thanks,
> Jim
>
> ------------------------------
> James Regetz, Ph.D.
> Scientific Programmer/Analyst
> National Center for Ecological Analysis & Synthesis
> 735 State St, Suite 300
> Santa Barbara, CA 93101
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Martin Morgan
Computational Biology / Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N.
PO Box 19024 Seattle, WA 98109

Location: Arnold Building M2 B169
Phone: (206) 667-2793


From cstrato at aon.at  Sun Mar  2 23:02:04 2008
From: cstrato at aon.at (cstrato)
Date: Sun, 02 Mar 2008 23:02:04 +0100
Subject: [Rd] Problem creating Makefile.win to build package using Visual C++
Message-ID: <47CB23DC.9080209@aon.at>

Dear all,

For testing purposes I have created a package "MyClass" containing C++ 
classes, which runs "R CMD check" on MacOS X and Linux w/o warnings. Now 
I want to create a Windows binary using MS Visual C++.

Using the "Makefile.win" shown below, I can compile the source code with 
Visual C++ using:
 >NMAKE /f "Makefile.win" CFG="Release"

However, when I modified the $(MYDLL) part to include "MyClass.def", and 
did:
 >R CMD INSTALL -l C:/home/CRAN/myRlib MyClass_0.3.2.tar.gz
I got the build error:
---------- Making package MyClass ------------
  adding build stamp to DESCRIPTION
  installing NAMESPACE file and metadata
  running src/Makefile.win ...
Makefile.win:3: *** missing separator.  Stop.
make[2]: *** [srcDynlib] Error 2
make[1]: *** [all] Error 2
make: *** [pkg-MyClass] Error 2

I have tried the following modification to include "MyClass.def":
$(MYDLL):     $(MYOBJ) $(RLIB) $(MAINR).def
              $(LD) $(SOFLAGS) $(LDFLAGS) $(MYOBJ) $(OutPutOpt)$@

Please can someone tell me what might be wrong?

I know from the readme file that I need to do something like:
   link /dll /def:mypkg.def /out:mypkg.dll *.obj Rdll.lib
but it is not clear to me how to convert this example to my makefile?

Thank you in advance
Best regards
Christian
_._._._._._._._._._._._._._._._
C.h.i.s.t.i.a.n S.t.r.a.t.o.w.a
V.i.e.n.n.a       A.u.s.t.r.i.a
e.m.a.i.l:    cstrato at aon.at
_._._._._._._._._._._._._._._._


Makefile.win (adapted from another program):
!IF "$(CFG)" != "Release" && "$(CFG)" != "Debug"
!MESSAGE Invalid configuration "$(CFG)" specified.
!ENDIF

ObjSuf        = obj
SrcSuf        = cxx
ExeSuf        = .exe
DllSuf        = dll
OutPutOpt     = -out:

# Win32 system with Microsoft Visual C/C++
!include <win32.mak>
CC            = $(cc)
CXX           = $(cc)
CXXFLAGS      = $(cvarsdll) -EHsc -nologo -GR -DWIN32 \
                -DVISUAL_CPLUSPLUS -D_WINDOWS
LD            = $(link)

!IF  "$(CFG)" == "Release"
CXXOPT        = -O2 -MD
LDOPT         = -opt:ref
!ELSEIF  "$(CFG)" == "Debug"
CXXOPT        = -Z7 -MDd
LDOPT         = -debug
!ENDIF

!if ("$(_NMAKE_VER)" == "8.00.50727.42") || ("$(_NMAKE_VER)" == 
"8.00.50727.762") || ("$(_NMAKE_VER)" == "9.00.21022.08")
MT_EXE        = mt -nologo -manifest $@.manifest -outputresource:$@;1
MT_DLL        = mt -nologo -manifest $@.manifest -outputresource:$@;2
EXTRAFLAGS    = -D_CRT_SECURE_NO_DEPRECATE
!else
MT_EXE        =
MT_DLL        =
EXTRAFLAGS    = -G5
!endif

LDFLAGS       = $(LDOPT) $(conlflags) -nologo
SOFLAGS       = $(dlllflags:-pdb:none=)

#------------------------------------------------------------------------------

R_HOME       = C:\\PROGRA~1\\R\\R-2.6.2
R_INCLUDES   = $(R_HOME)\\include         
RLIB         = $(R_HOME)\\src\\gnuwin32\\Rdll.lib

#------------------------------------------------------------------------------

MAIN  = MyClassA
MAINR = MyClass

MYHDR       = $(MAIN).h rwrapper.h
MYOBJ       = $(MAIN).$(ObjSuf) rwrapper.$(ObjSuf)
MYSRC       = $(MAIN).$(SrcSuf) rwrapper.$(SrcSuf)
MYDLL       = $(MAINR).$(DllSuf)

OBJS        = $(MYOBJ)
PROGRAMS    = $(MYDLL)

all:          $(PROGRAMS)

$(MYDLL):     $(MYOBJ)
              $(LD) $(SOFLAGS) $(LDFLAGS) $(MYOBJ) $(OutPutOpt)$@
              $(MT_DLL)

$(MAIN).$(ObjSuf): $(MYHDR)

.$(SrcSuf).$(ObjSuf):
        $(CXX) $(CXXFLAGS) $(EXTRAFLAGS) $(CXXOPT) -c $<

clean:
              @del *.obj  *.def *.exp *.d *.log .def *.pdb *.ilk *.manifest

distclean:      clean
       @del *.exe *.ps *.lib *.dll


From maechler at stat.math.ethz.ch  Mon Mar  3 10:16:45 2008
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Mon, 3 Mar 2008 10:16:45 +0100
Subject: [Rd] patch for random.c
In-Reply-To: <20080229181940.457c9bf7@berwin-nus1>
References: <20080229181940.457c9bf7@berwin-nus1>
Message-ID: <18379.49661.242974.779574@stat.math.ethz.ch>

>>>>> "BAT" == Berwin A Turlach <statba at nus.edu.sg>
>>>>>     on Fri, 29 Feb 2008 18:19:40 +0800 writes:

    BAT> Dear all,
    BAT> while looking for some inspiration of how to organise some code, I
    BAT> studied the code of random.c and noticed that for distributions with
    BAT> 2 or 3 parameters the user is not warned if NAs are created while such
    BAT> a warning is issued for distributions with 1 parameter.  E.g:

    BAT> R version 2.7.0 Under development (unstable) (2008-02-29 r44639)

    BAT> [...]

    >> rexp(2, rate=Inf)
    BAT> [1] NaN NaN
    BAT> Warning message:
    BAT> In rexp(2, rate = Inf) : NAs produced
    >> rnorm(2, mean=Inf)
    BAT> [1] NaN NaN

    BAT> Surprisingly, the code for issuing warnings for distributions with 2 or
    BAT> 3 parameters is essentially there, but does not seem to be used.  The
    BAT> attached patch rectifies this.  With the patch the above command produce
    BAT> the following output:

    >> rexp(2, rate=Inf)
    BAT> [1] NaN NaN
    BAT> Warning message:
    BAT> In rexp(2, rate = Inf) : NAs produced
    >> rnorm(2, mean=Inf)
    BAT> [1] NaN NaN
    BAT> Warning message:
    BAT> In rnorm(2, mean = Inf) : NAs produced

    BAT> Please ignore the patch if the code that was designed to produce the
    BAT> warning had been removed on purpose.  

I cannot imagine a design reason for that.  If there was, it
should have been mentioned as a comment in the C code.

I'll commit your patch (if it passes the checks).

    BAT> BTW, there are other places in the code were NAs can be created but no
    BAT> warning is issued.  E.g:

    >> rexp(2, rate=numeric())
    BAT> [1] NA NA
    >> rnorm(2, mean=numeric())
    BAT> [1] NA NA

    BAT> I wonder whether a warning should be issued in this case too.  

Yes, "should in principle".

If you feel like finding another elegant patch...

Thank you Berwin,
for your contribution!

Martin

    BAT> Best wishes,

    BAT> Berwin

    BAT> Index: src/main/random.c
    BAT> ===================================================================
    BAT> --- src/main/random.c	(revision 44639)
    BAT> +++ src/main/random.c	(working copy)
    BAT> @@ -123,7 +123,7 @@
 
    BAT> #define RAND2(num,name) \
    BAT> case num: \
    BAT> -		random2(name, REAL(a), na, REAL(b), nb, REAL(x), n); \
    BAT> +		naflag = random2(name, REAL(a), na, REAL(b), nb, REAL(x), n); \
    BAT> break
 
    BAT> /* "do_random2" - random sampling from 2 parameter families. */
    BAT> @@ -207,7 +207,7 @@
 
    BAT> #define RAND3(num,name) \
    BAT> case num: \
    BAT> -		random3(name, REAL(a), na, REAL(b), nb, REAL(c), nc, REAL(x), n); \
    BAT> +		naflag = random3(name, REAL(a), na, REAL(b), nb, REAL(c), nc, REAL(x), n); \
    BAT> break
 
 
    BAT> ______________________________________________
    BAT> R-devel at r-project.org mailing list
    BAT> https://stat.ethz.ch/mailman/listinfo/r-devel


From regetz at nceas.ucsb.edu  Mon Mar  3 11:51:14 2008
From: regetz at nceas.ucsb.edu (Jim Regetz)
Date: Mon, 03 Mar 2008 02:51:14 -0800
Subject: [Rd] Problems initializing an extended S4 class
In-Reply-To: <6phy792o8ot.fsf@gopher4.fhcrc.org>
References: <47C7B7B0.6070406@nceas.ucsb.edu>
	<6phy792o8ot.fsf@gopher4.fhcrc.org>
Message-ID: <47CBD822.7040907@nceas.ucsb.edu>

Hi Martin,

Many thanks for the reply, that really helps a lot. Some follow-up 
observations below.

Martin Morgan wrote:
> Hi Jim --
> 
> I think your problems have to do with the way 'initialize' and
> 'validObject' work together. At some point in it's code, validObject
> converts an instance 'b' of a derived class (e.g., B) into that of the
> base class (e.g., A). It does this, by calling a = new("A"), and then
> copying the relevant slots from the instance of b to new a. So...
> 

With your comments as context, I stepped more carefully through relevant 
source code in the methods package. As you indicated, my trouble arises 
in the 'validObject' function. In particular, it's when 'as' is called 
to coerce the nascent B object into its superclass A. [For reference, 
it's in line 456 of the SClasses.R in the R-2.6.2 source tarball.]

This led me to try defining a simple B -> A coercion method:
setAs("B", "A", function(from, to) new(to, x=from at x))

Indeed, after doing this, I can successfully create an instance of B.

It still seems peculiar that the initialize and validity methods are 
both called twice for A when B is instantiated -- particularly given 
that the 'a' object itself was already initialized and checked for 
validity. There may well be a good reason for all this, but I still 
wonder if I'm doing something inefficiently.

In any case, although I haven't tested it, I'm optimistic that defining 
'coerce' methods in this fashion will also solve the problem in my real 
code without my needing to redesign the initialize and validity methods.

>> 1. Why is initialize invoked *twice* for A during instantiation of B?
> 
> ...the initialize method for A gets invoked twice, once when B is
> being created originally, and once when B is being checked for
> validity and is being converted to A.
> 
>> 2. The second time initialize is invoked for A, it appears .Object at x is 
>> only bound to its implicit prototype value of numeric(0). Why? Of 
> 
> ...and this is because of how A is being constructed from B -- with a
> called to new("A"), with no additional arguments.
> 
> Practically, this means that your classes have to be valid when
> created with new("A"). This imposes constraints on the prototype,and
> on the initialize method, and in the end I've found myself writing
> 'constructors' that process user-friendly arguments into a format that
> can be passed to 'new' as slots, e.g.,
> 
> A <- function(x=numeric(0), ...) {
>     x <- ifelse(log(x)<0, 1, x)
>     new("A", x=x, ...)
> }
> 
> In some ways I think this is the right thing to do anyway (a layer of
> abstraction between the user and implementation), even if the
> motivation might not be so pure.

Agreed, and I actually do have such user-level constructors. However, 
precisely in the interests of abstraction, I'd prefer not to expose the 
innards of my initialize methods in these functions. I admit this is 
partly on purity grounds, but more practical issues are (1) I may have 
several variants of the user-level constructors and don't want to repeat 
the common initialization code in each one, and (2) the operations I 
have in my initialize methods are only sensible for valid objects (and 
thus not meaningfully executed before 'new' is called). Hopefully this 
is all in the true spirit of the S4 object system...

Thanks again for the clear and helpful reply!

Cheers,
Jim


> Martin
> 
> 
> Jim Regetz <regetz at nceas.ucsb.edu> writes:
> 
>> Hi all,
>>
>> I am having trouble extending S4 classes in cases where I'm using both 
>> validity and initialize methods. I've read as much S4 information as I 
>> can find, but I've yet to have that "a-ha" moment.
>>
>> In my application, I am using validity methods to guard against 
>> inappropriate input data that my code has no way of handling, and 
>> initialize methods to detect and deal with fixable problems. As a toy 
>> example, consider classes A and B and associated methods as defined 
>> below. I use a validity method for A to complain about negative values, 
>> and an initialize method to "correct" small input values. B should 
>> simply extend A by adding an extra slot. The example is contrived, but 
>> it illustrates a key behavior that I also encounter in my real code:
>>
>> setClass("A", representation(x="numeric"))
>> setClass("B", representation(y="character"), contains="A")
>>
>> setValidity("A", function(object) {
>>      message("start validate A")
>>      retval <- NULL
>>      if (any(object at x<0))
>>          retval <- c(retval, "x must be positive")
>>      message("done validate A")
>>      if(is.null(retval)) return(TRUE) else return(retval)
>> })
>>
>> setMethod("initialize", "A", function(.Object, ...) {
>>      message("start init A")
>>      .Object <- callNextMethod()
>>      x <- .Object at x
>>      .Object at x <- ifelse(log(x)<0, 1, x)
>>      message("done init A")
>>      .Object
>> })
>>
>> setMethod("initialize", "B", function(.Object, ...) {
>>      message("start init B")
>>      callNextMethod()
>> })
>>
>>
>> # Creating an instance of A works just as I would expect
>>> a <- new("A", x=c(0.5, 2))
>> start init A
>> start validate A
>> done validate A
>> done init A
>>> a
>> An object of class ?A?
>> Slot "x":
>> [1] 1 2
>>
>> # But subsequently creating a derived B object fails!
>>> new("B", a, y="foo")
>> start init B
>> start init A
>> start validate A
>> start init A
>> Error in checkSlotAssignment(object, name, value) :
>>    assignment of an object of class "logical" is not valid for slot "x"
>> in an object of class "A"; is(value, "numeric") is not TRUE
>>
>> The two things I haven't quite figured out are:
>>
>> 1. Why is initialize invoked *twice* for A during instantiation of B?
>>
>> 2. The second time initialize is invoked for A, it appears .Object at x is 
>> only bound to its implicit prototype value of numeric(0). Why? Of 
>> course, this leads to an error because the ifelse expression 
>> subsequently evaluates to logical(0) rather than a numeric vector as 
>> intended. Again, this is a contrived example, but a very real problem in 
>> my code.
>>
>> I suppose I could define a prototype for A that I know won't break my 
>> initialize method, but that seems inelegant and hard to maintain. Is 
>> there a better way to code this so that I can reliably instantiate B 
>> using a valid A object? Hopefully I've just got something wrong in the 
>> formals for my initialize methods or in my use of getNextMethod(), but 
>> I've had no luck trying some alternatives -- and ultimately I'd prefer 
>> to better understand the underlying behavior rather than stumble onto 
>> something that merely appears to work.
>>
>> I'd be grateful for any suggestions...
>>
>> Thanks,
>> Jim
>>
>> ------------------------------
>> James Regetz, Ph.D.
>> Scientific Programmer/Analyst
>> National Center for Ecological Analysis & Synthesis
>> 735 State St, Suite 300
>> Santa Barbara, CA 93101
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From gunter.berton at gene.com  Mon Mar  3 17:25:09 2008
From: gunter.berton at gene.com (gunter.berton at gene.com)
Date: Mon,  3 Mar 2008 17:25:09 +0100 (CET)
Subject: [Rd] Losing attributes in data.frame() (PR#10873)
Message-ID: <20080303162509.3A8FE282EF48@mail.pubhealth.ku.dk>

 
Folks:

Problem: [<-.data,frame()  is losing attributes under certain curcumstances
shown below.

I think this is a bug, at least in documentation, as I was unable to find
explicit documentation of the behavior. Indeed, the only documentation I
found told me attributes are preserved. Here is a detailed description:

> df <- data.frame(a=1:3, b=letters[1:3])
> attr(df,"foo") <- 10
> df
  a b
1 1 a
2 2 b
3 3 c
> attributes(df)
$names
[1] "a" "b"

$row.names
[1] 1 2 3

$class
[1] "data.frame"

$foo
[1] 10

## But now we add a new column using matrix-type indexing

> df[,"c"] <- 10:12
> df
  a b  c
1 1 a 10
2 2 b 11
3 3 c 12
> attributes(df)
$names
[1] "a" "b" "c"

$row.names
[1] 1 2 3

$class
[1] "data.frame"

> ## Note that "foo" attribute is lost; however...


> df <- data.frame(a=1:3, b=letters[1:3])
> attr(df,"foo") <- 10
> df[["c"]] <- 10:12
> attributes(df)
$names
[1] "a" "b" "c"

$row.names
[1] 1 2 3

$foo
[1] 10

$class
[1] "data.frame"

## The foo attribute has been kept this time.

## Details:

> sessionInfo()
R version 2.6.2 (2008-02-08) 
i386-pc-mingw32 

locale:
LC_COLLATE=English_United States.1252;LC_CTYPE=English_United
States.1252;LC_MONETARY=English_United
States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252

attached base packages:
[1] graphics  grDevices datasets  grid      tcltk     stats     utils
methods   base     

other attached packages:
[1] svSocket_0.9-5    svIO_0.9-5        svIDE_0.9-5       R2HTML_1.58
svMisc_0.9-5      lme4_0.99875-9   
[7] Matrix_0.999375-4 lattice_0.17-6   
> 


Cheers,

Bert Gunter
Genentech Nonclinical Statistics


From termcc at googlemail.com  Mon Mar  3 21:10:53 2008
From: termcc at googlemail.com (Tom McCallum)
Date: Mon, 03 Mar 2008 20:10:53 -0000
Subject: [Rd] DataTime field when converting between database formats
Message-ID: <op.t7gicfmwcsmg07@localhost.localdomain>

I was recently converting a MS-Access database to MySQL when I came across  
this error:

Error in fromchar(unclass(x)) :
   character string is not in a standard unambiguous format

The error occurs because the NULL value of a DateTime field, if not  
properly setup or on export to a CSV, can be set to '0000-00-00 00:00:00'  
which fails the NA test in R-2.6.2/src/library/base/R/datetime.R on line  
32.

Can I recommend that this either raises a more specific error, or that it  
automatically converts this value to NA and perhaps outputs a warning.

For now I have fixed the incoming data, but thought I would register this  
behaviour in case anyone else came across it.

Best,

Tom


From Greg.Snow at imail.org  Mon Mar  3 21:54:25 2008
From: Greg.Snow at imail.org (Greg Snow)
Date: Mon, 3 Mar 2008 13:54:25 -0700
Subject: [Rd] Clipping using par(plt=..., xpd=FALSE) inconsistencies
In-Reply-To: <alpine.LFD.1.00.0802252103290.18007@gannet.stats.ox.ac.uk>
References: <07E228A5BE53C24CAD490193A7381BBBEE1114@LP-EXCHVS07.CO.IHC.COM>
	<Pine.LNX.4.64.0802222050040.11702@auk.stats>
	<alpine.LFD.1.00.0802252103290.18007@gannet.stats.ox.ac.uk>
Message-ID: <07E228A5BE53C24CAD490193A7381BBBF2ACFD@LP-EXCHVS07.CO.IHC.COM>

Thanks,

Sorry I waited so long to get back, I wanted to test it out and waited
for the update to the windows port that includes this.

This is certainly a better approach.  The hist example works great, but
the behaivior of points still has me a bit confused.

> # trying to get a plot with top half blue and bottom half red
> x <- 1:25
> y <- rnorm(25,(x-10)/5)
> plot(x,y, type='b', col='red')
> usr <- par('usr')
> clip( usr[1], usr[2], 0, usr[4] )
> points(x,y,type='b', col='blue')

This does not work, everything is blue. 

But if we do:

> clip( usr[1], usr[2], usr[3], 0 )
> points(x,y,type='b', col='red')

Then only the bottom half gets colored red.  Why does this work with the
second call to clip and points, but not the first?

 From the documentation it says that lines (and I assume points) only
resets the clipping region if  par("xpd") has changed, since xpd has not
been changed I would have expected either both pairs of clip and points
to work, or both not work.

Also when it says that lines and texts "reset it" does this mean that
the clipping region set by clip is only honored when "reset"? or that
these functions reset the clipping region to match the plot region?

(my tests were done using the latest windows port and a default graphics
window)

Thanks,

-- 
Gregory (Greg) L. Snow Ph.D.
Statistical Data Center
Intermountain Healthcare
greg.snow at imail.org
(801) 408-8111
 
 

> -----Original Message-----
> From: Prof Brian Ripley [mailto:ripley at stats.ox.ac.uk] 
> Sent: Monday, February 25, 2008 2:06 PM
> To: Greg Snow
> Cc: r-devel at r-project.org
> Subject: Re: [Rd] Clipping using par(plt=..., xpd=FALSE) 
> inconsistencies
> 
> The following works in R-devel
> 
>       x <- rnorm(1000)
>       hist(x, xlim=c(-4,4))
>       usr <- par("usr")
>       clip(usr[1], -2, usr[3], usr[4])
>       hist(x, col = 'red', add = TRUE)
>       clip(2, usr[2], usr[3], usr[4])
>       hist(x, col = 'blue', add = TRUE)
>       do.call("clip", as.list(usr))  # reset to plot region
> 
> I think that is a general enough mechanism -- see its help 
> page for how long one can expect a clipping region to persist.
> 
> On Fri, 22 Feb 2008, Prof Brian Ripley wrote:
> 
> > I think you misunderstand what par("plt") is supposed to do.  The 
> > documentation says
> >
> >     'plt' A vector of the form 'c(x1, x2, y1, y2)' giving the
> >          coordinates of the plot region as fractions of the current
> >          figure region.
> >
> > You haven't subsequently made a new plot, so why do you expect the 
> > clipping region to be changed to that you indicated for the 
> next plot?
> >
> > I'd say the bug was that box() changed it, and that happens 
> because it 
> > internally sets xpd and so resetting xpd sets the clipping 
> region next 
> > time it is used.  Because of
> >
> > void GClip(pGEDevDesc dd)
> > {
> >    if (gpptr(dd)->xpd != gpptr(dd)->oldxpd) {
> > 	double x1, y1, x2, y2;
> > 	setClipRect(&x1, &y1, &x2, &y2, DEVICE, dd);
> > 	GESetClip(x1, y1, x2, y2, dd);
> > 	gpptr(dd)->oldxpd = gpptr(dd)->xpd;
> >    }
> > }
> >
> > Maybe we should have user-level code to set the clipping region?
> >
> >
> > On Fri, 22 Feb 2008, Greg Snow wrote:
> >
> >> Here is a demonstration of behaviour that is probably an 
> optimization 
> >> by someone far smarter than me that did not anticipate 
> anyone wanting 
> >> to do this, but for my purposes it looks more like a bug 
> than a feature.
> >> 
> >> I have tested this with R2.6.2 on Windows, no additional packages 
> >> loaded (beyond the default), I have tested using the 
> default graphics 
> >> object, pdf, jpeg, and cairoDevice (ok I loaded a package 
> for that) 
> >> and all show the same behavior.
> >> 
> >> Run the following set of commands:
> >> 
> >> x <- rnorm(1000)
> >> hist(x, xlim=c(-4,4))
> >> 
> >> tmp <- par('plt')
> >> 
> >> box(col='#00000000')
> >> tmp2 <- tmp
> >> tmp2[2] <- tmp2[1] + 0.3
> >> par(xpd = FALSE, plt=tmp2)
> >> hist(x, col='red', add=TRUE)
> >> 
> >> box(col='#00000000')
> >> tmp3 <- tmp
> >> tmp3[1] <- tmp3[2] - 0.3
> >> par(xpd=FALSE, plt=tmp3)
> >> hist(x, col='blue', add=TRUE)
> >> par(plt=tmp)
> >> 
> >> 
> >> This gives me the plot that I want and expect (a histogram 
> with the 
> >> left section red, the middle white/background, and the right blue).
> >> 
> >> Now comment out or delete the 2 box commands and rerun 
> everything.  
> >> The clipping does not happen this time and the final 
> result is a full 
> >> blue histogram.
> >> 
> >> Is this a bug? Feature? Something else?
> >> Does anyone have a better work around than drawing 
> transparent boxes?
> >> 
> >> Thanks,
> >> 
> >> 
> >> 
> >> 
> >
> > -- 
> > Brian D. Ripley,                  ripley at stats.ox.ac.uk
> > Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> > University of Oxford,             Tel:  +44 1865 272861 (self)
> > 1 South Parks Road,                     +44 1865 272866 (PA)
> > Oxford OX1 3TG, UK                Fax:  +44 1865 272595
> >
> 
> -- 
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
> 


From xyz007student at yahoo.com  Tue Mar  4 02:46:29 2008
From: xyz007student at yahoo.com (Frank Feng)
Date: Mon, 3 Mar 2008 17:46:29 -0800 (PST)
Subject: [Rd] using Chi-square test with a certain number of degrees of
	freedom ?
Message-ID: <457594.729.qm@web46004.mail.sp1.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20080303/bb404ed4/attachment.pl 

From ripley at stats.ox.ac.uk  Tue Mar  4 09:45:14 2008
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Tue,  4 Mar 2008 09:45:14 +0100 (CET)
Subject: [Rd] Losing attributes in data.frame() (PR#10873)
Message-ID: <20080304084514.E39CB282EF48@mail.pubhealth.ku.dk>

This is a delicate balance.  The crucial part (which you didn't mention) 
is that this only happens if you add a column by df[, "c"] <- value ; if 
you replace the contents of a column then attributes are preserved.

Clearly some attributes like names are invalidated when you extend a list, 
and others may or may not be.  Some parts of R copy all attributes which 
are not obviously invalidated (see mostattributes<-) and others only copy 
those that are obviously valid (and the balance has swung over the years 
towards the first camp).

I'm in the camp that says we are too generous in copying over attributes, 
but here I will make [<- consistent with [[<- and $<-.

Note that e.g. df[, 1:2] drops the attribute, whereas df[,] does not, 
something inherited from lists (and vectors):
> x <- structure(list(a=1,b=2), foo=10)
> attributes(x[1:2])
$names
[1] "a" "b"

> attributes(x[])
$names
[1] "a" "b"

$foo
[1] 10



On Mon, 3 Mar 2008, gunter.berton at gene.com wrote:

>
> Folks:
>
> Problem: [<-.data,frame()  is losing attributes under certain curcumstances
> shown below.
>
> I think this is a bug, at least in documentation, as I was unable to find
> explicit documentation of the behavior. Indeed, the only documentation I
> found told me attributes are preserved.

I don't think you can expect such detailed documentation -- given how 
little use is made of the documentation we do write no one is going to 
volunteer to write up (and maintain the write up of) such details.

> Here is a detailed description:
>
>> df <- data.frame(a=1:3, b=letters[1:3])
>> attr(df,"foo") <- 10
>> df
>  a b
> 1 1 a
> 2 2 b
> 3 3 c
>> attributes(df)
> $names
> [1] "a" "b"
>
> $row.names
> [1] 1 2 3
>
> $class
> [1] "data.frame"
>
> $foo
> [1] 10
>
> ## But now we add a new column using matrix-type indexing
>
>> df[,"c"] <- 10:12
>> df
>  a b  c
> 1 1 a 10
> 2 2 b 11
> 3 3 c 12
>> attributes(df)
> $names
> [1] "a" "b" "c"
>
> $row.names
> [1] 1 2 3
>
> $class
> [1] "data.frame"
>
>> ## Note that "foo" attribute is lost; however...
>
>
>> df <- data.frame(a=1:3, b=letters[1:3])
>> attr(df,"foo") <- 10
>> df[["c"]] <- 10:12
>> attributes(df)
> $names
> [1] "a" "b" "c"
>
> $row.names
> [1] 1 2 3
>
> $foo
> [1] 10
>
> $class
> [1] "data.frame"
>
> ## The foo attribute has been kept this time.
>
> ## Details:
>
>> sessionInfo()
> R version 2.6.2 (2008-02-08)
> i386-pc-mingw32
>
> locale:
> LC_COLLATE=English_United States.1252;LC_CTYPE=English_United
> States.1252;LC_MONETARY=English_United
> States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252
>
> attached base packages:
> [1] graphics  grDevices datasets  grid      tcltk     stats     utils
> methods   base
>
> other attached packages:
> [1] svSocket_0.9-5    svIO_0.9-5        svIDE_0.9-5       R2HTML_1.58
> svMisc_0.9-5      lme4_0.99875-9
> [7] Matrix_0.999375-4 lattice_0.17-6
>>
>
>
> Cheers,
>
> Bert Gunter
> Genentech Nonclinical Statistics
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From statba at nus.edu.sg  Wed Mar  5 13:26:24 2008
From: statba at nus.edu.sg (Berwin A Turlach)
Date: Wed, 5 Mar 2008 20:26:24 +0800
Subject: [Rd] patch for random.c
In-Reply-To: <18379.49661.242974.779574@stat.math.ethz.ch>
References: <20080229181940.457c9bf7@berwin-nus1>
	<18379.49661.242974.779574@stat.math.ethz.ch>
Message-ID: <20080305202624.7f1c54ea@berwin-nus1>

G'day Martin,

On Mon, 3 Mar 2008 10:16:45 +0100
Martin Maechler <maechler at stat.math.ethz.ch> wrote:

> >>>>> "BAT" == Berwin A Turlach <statba at nus.edu.sg>
> >>>>>     on Fri, 29 Feb 2008 18:19:40 +0800 writes:
>
>     BAT> while looking for some inspiration of how to organise some
>     BAT> code, I studied the code of random.c and noticed that for
>     BAT> distributions with 2 or 3 parameters the user is not warned
>     BAT> if NAs are created while such a warning is issued for
>     BAT> distributions with 1 parameter. [...] The attached patch
>     BAT> rectifies this.  [...]
>
> I cannot imagine a design reason for that.  If there was, it
> should have been mentioned as a comment in the C code.
> 
> I'll commit your patch (if it passes the checks).

Sorry, I was a bit in a hurry when writing the e-mail, so I forgot to
mention that the source code modified by this patch compiles and passes
"make check FORCE=FORCE" on my machine.

And in my hurry, I also posted from my NUS account, without realising
it, which forced you to intervene as moderator and to approve the
posting.  My apologies for the extra work.  But this gave me the idea
to also subscribe to r-devel with my NUS account and configure the
subscriptions so that I only receive e-mail at my UWA account.  Thus,
hopefully, you will not have to intervene again.  (Which this e-mail
should test.)
 
>     BAT> BTW, there are other places in the code were NAs can be
>     BAT> created but no warning is issued.  E.g:
> 
>     >> rexp(2, rate=numeric())
>     BAT> [1] NA NA
>     >> rnorm(2, mean=numeric())
>     BAT> [1] NA NA
> 
>     BAT> I wonder whether a warning should be issued in this case
>     BAT> too.  
> 
> Yes, "should in principle".
> 
> If you feel like finding another elegant patch...

Well, elegance is in the eye of the beholder. :-)  I attach two
patches.  One that adds warning messages at the other places where NAs
can be generated.

The second one in additiona rearranges the code a bit such that in the
case when all the "vectors" that contain the parameter values of the
distribution, from which one wants to simulate, are of length one some
unnecessary calculations is taken out of the for loop.  I am not sure
how much time is actually saved in this situation, but I belong to the
school that things such kind of optimisation should be done. :)  If you
think it bloats the code too much (or duplicates things too much
leading to hard to maintain code), then feel free to ignore this second
patch. 


> Thank you Berwin, for your contribution!

My pleasure.

Cheers,

	Berwin
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: R-patch2
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20080305/d21ea9a8/attachment.pl 
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: R-patch3
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20080305/d21ea9a8/attachment-0001.pl 

From tw at deciph.com  Wed Mar  5 00:41:04 2008
From: tw at deciph.com (tw at deciph.com)
Date: Wed,  5 Mar 2008 00:41:04 +0100 (CET)
Subject: [Rd] Problems in builtin editor -- memory leak? graphics plugin?
	(PR#10887)
Message-ID: <20080304234104.8B1B3282EFF6@mail.pubhealth.ku.dk>

Full_Name: Timothy Wyant
Version: R 2.6.0 GUI 1.21 (4815) (4815)
OS: mac osx 10.4.11
Submission from: (NULL) (64.202.127.110)


Intermittently when in an interactive R session I get the following, or
similar:

>    
2008-03-04 18:19:18.807 R[1103] CFLog (21): dyld returns 2 when trying to load
/Users/timothywyant/Library/Contextual Menu
Items/GraphicConverterCMI.plugin/Contents/MacOS/GraphicConverterCMI
2008-03-04 18:19:18.808 R[1103] CFLog (22): Cannot find function pointer
GraphicConverterCMIFactory for factory E3F3BEA1-3194-11D9-87A7-000A95874F98 in
CFBundle/CFPlugIn 0x1631a310 </Users/timothywyant/Library/Contextual Menu
Items/GraphicConverterCMI.plugin> (bundle, not loaded)
2008-03-04 18:19:18.817 R[1103] CFLog (21): dyld returns 2 when trying to load
/Library/Contextual Menu Items/StuffItCM.plugin/Contents/MacOS/StuffItCM
2008-03-04 18:19:18.817 R[1103] CFLog (22): Cannot find function pointer
MyCMPluginFactory for factory 02E3F072-9CCB-11D5-A0B2-00306575F8A2 in
CFBundle/CFPlugIn 0x1631f8f0 </Library/Contextual Menu Items/StuffItCM.plugin>
(bundle, not loaded)
> 

Occasionally, the mouse stops working until I exit the session.  Other times I
can continue without apparent prolem.


From statba at nus.edu.sg  Wed Mar  5 14:02:34 2008
From: statba at nus.edu.sg (Berwin A Turlach)
Date: Wed, 5 Mar 2008 21:02:34 +0800
Subject: [Rd] A patch
Message-ID: <20080305210234.744e0885@berwin-nus1>

Dear all,

since a day or two "make dvi" and "make pdf" fails on my machine when I
try to install the latest version of R from scratch.  The attached
patch seems to solve this problem.

Cheers,

	Berwin

=========================== Full address =============================
Berwin A Turlach                            Tel.: +65 6515 4416 (secr)
Dept of Statistics and Applied Probability        +65 6515 6650 (self)
Faculty of Science                          FAX : +65 6872 3919       
National University of Singapore     
6 Science Drive 2, Blk S16, Level 7          e-mail: statba at nus.edu.sg
Singapore 117546                    http://www.stat.nus.edu.sg/~statba

From berwin at maths.uwa.edu.au  Wed Mar  5 14:16:43 2008
From: berwin at maths.uwa.edu.au (Berwin A Turlach)
Date: Wed, 5 Mar 2008 21:16:43 +0800
Subject: [Rd] A patch
In-Reply-To: <20080305210234.744e0885@berwin-nus1>
References: <20080305210234.744e0885@berwin-nus1>
Message-ID: <20080305211643.09358a14@berwin-nus1>

On Wed, 5 Mar 2008 21:02:34 +0800
Berwin A Turlach <statba at nus.edu.sg> wrote:

> since a day or two "make dvi" and "make pdf" fails on my machine when
> I try to install the latest version of R from scratch.  The attached
> patch seems to solve this problem.

Sorry, forgot to change the attachment from application/octet-stream to
text/plain and it got scrubbed.  Patch is attached now.

Cheers,

	Berwin
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: R-patch1
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20080305/f747e127/attachment.pl 

From simon.urbanek at r-project.org  Wed Mar  5 15:52:30 2008
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Wed, 5 Mar 2008 09:52:30 -0500
Subject: [Rd] Problems in builtin editor -- memory leak? graphics
	plugin? (PR#10887)
In-Reply-To: <20080304234104.8B1B3282EFF6@mail.pubhealth.ku.dk>
References: <20080304234104.8B1B3282EFF6@mail.pubhealth.ku.dk>
Message-ID: <2BDFC820-3664-4B6B-B9C6-3BF83BADCD8A@r-project.org>

Timothy,

those are problems in 3rd partly haxxies you are using (see R for Mac  
FAQ). You should remove them and/or get a fixed version.

Please read the posting guide and do not fill R bug reports on broken  
3rd party software.

Thanks,
Simon


On Mar 4, 2008, at 6:41 PM, tw at deciph.com wrote:

> Full_Name: Timothy Wyant
> Version: R 2.6.0 GUI 1.21 (4815) (4815)
> OS: mac osx 10.4.11
> Submission from: (NULL) (64.202.127.110)
>
>
> Intermittently when in an interactive R session I get the following,  
> or
> similar:
>
>>
> 2008-03-04 18:19:18.807 R[1103] CFLog (21): dyld returns 2 when  
> trying to load
> /Users/timothywyant/Library/Contextual Menu
> Items/GraphicConverterCMI.plugin/Contents/MacOS/GraphicConverterCMI
> 2008-03-04 18:19:18.808 R[1103] CFLog (22): Cannot find function  
> pointer
> GraphicConverterCMIFactory for factory  
> E3F3BEA1-3194-11D9-87A7-000A95874F98 in
> CFBundle/CFPlugIn 0x1631a310 </Users/timothywyant/Library/Contextual  
> Menu
> Items/GraphicConverterCMI.plugin> (bundle, not loaded)
> 2008-03-04 18:19:18.817 R[1103] CFLog (21): dyld returns 2 when  
> trying to load
> /Library/Contextual Menu Items/StuffItCM.plugin/Contents/MacOS/ 
> StuffItCM
> 2008-03-04 18:19:18.817 R[1103] CFLog (22): Cannot find function  
> pointer
> MyCMPluginFactory for factory 02E3F072-9CCB-11D5-A0B2-00306575F8A2 in
> CFBundle/CFPlugIn 0x1631f8f0 </Library/Contextual Menu Items/ 
> StuffItCM.plugin>
> (bundle, not loaded)
>>
>
> Occasionally, the mouse stops working until I exit the session.   
> Other times I
> can continue without apparent prolem.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From dankoc at gmail.com  Wed Mar  5 16:56:35 2008
From: dankoc at gmail.com (Charles Danko)
Date: Wed, 5 Mar 2008 10:56:35 -0500
Subject: [Rd] SEXP size management.
Message-ID: <8adccabf0803050756j50ec2022nf9a028f39d8aedfd@mail.gmail.com>

Hi,

Trying to decrease the size of a SEXP variable without reassigning
values individually in a loop.

So far, I've tried using Realloc, as the follow source demonstrates:
SEXP dothis() {
	SEXP Rblah;
	PROTECT(Rblah = NEW_INTEGER(6));

	int* blah = INTEGER(Rblah);
	blah[0] = 1;
	blah[1] = 2;
	blah[2] = 3;

	Realloc(Rblah, 3, INTEGER);

	UNPROTECT(1);
	return(Rblah);
}

According to the documentation, I think that this should work, however
it returns an error on compile: "test.c:17: error: expected expression
before ')' token" (line 17 refers to the Realloc line).

Another solution that will suit my needs is managing the variable in C
and assigning the pointer to an R type in the end.  The following code
gets at this, but int* and SEXP, INTEGER are incompatible:
SEXP dothat() {
	int* blah = malloc(3);// = INTEGER(Rblah);
	blah[0] = 1;
	blah[1] = 2;
	blah[2] = 3;

	SEXP Rblah;
	PROTECT(Rblah = blah);

	UNPROTECT(1);
	return(Rblah);
}

Any suggestions for someone still new to SEXP memory management?

Thanks,
Charles


From osklyar at ebi.ac.uk  Wed Mar  5 17:14:19 2008
From: osklyar at ebi.ac.uk (Oleg Sklyar)
Date: Wed, 05 Mar 2008 16:14:19 +0000
Subject: [Rd] SEXP size management.
In-Reply-To: <8adccabf0803050756j50ec2022nf9a028f39d8aedfd@mail.gmail.com>
References: <8adccabf0803050756j50ec2022nf9a028f39d8aedfd@mail.gmail.com>
Message-ID: <47CEC6DB.1030309@ebi.ac.uk>

Rblah in your example is a SEXP structure. Realloc is an interface to C 
realloc and is not intended to resize SEXP structures -- it is used to 
resize user-controlled memory (which is generally not created by 
allocVector/INTEGER).

You would expect a call like:

int * val;
...
Realloc(val, 20, int);

Best,
Oleg

Charles Danko wrote:
> Hi,
> 
> Trying to decrease the size of a SEXP variable without reassigning
> values individually in a loop.
> 
> So far, I've tried using Realloc, as the follow source demonstrates:
> SEXP dothis() {
> 	SEXP Rblah;
> 	PROTECT(Rblah = NEW_INTEGER(6));
> 
> 	int* blah = INTEGER(Rblah);
> 	blah[0] = 1;
> 	blah[1] = 2;
> 	blah[2] = 3;
> 
> 	Realloc(Rblah, 3, INTEGER);
> 
> 	UNPROTECT(1);
> 	return(Rblah);
> }
> 
> According to the documentation, I think that this should work, however
> it returns an error on compile: "test.c:17: error: expected expression
> before ')' token" (line 17 refers to the Realloc line).
> 
> Another solution that will suit my needs is managing the variable in C
> and assigning the pointer to an R type in the end.  The following code
> gets at this, but int* and SEXP, INTEGER are incompatible:
> SEXP dothat() {
> 	int* blah = malloc(3);// = INTEGER(Rblah);
> 	blah[0] = 1;
> 	blah[1] = 2;
> 	blah[2] = 3;
> 
> 	SEXP Rblah;
> 	PROTECT(Rblah = blah);
> 
> 	UNPROTECT(1);
> 	return(Rblah);
> }
> 
> Any suggestions for someone still new to SEXP memory management?
> 
> Thanks,
> Charles
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Dr Oleg Sklyar * EBI-EMBL, Cambridge CB10 1SD, UK * +44-1223-494466


From dankoc at gmail.com  Wed Mar  5 17:33:36 2008
From: dankoc at gmail.com (Charles Danko)
Date: Wed, 5 Mar 2008 11:33:36 -0500
Subject: [Rd] SEXP size management.
In-Reply-To: <47CEC6DB.1030309@ebi.ac.uk>
References: <8adccabf0803050756j50ec2022nf9a028f39d8aedfd@mail.gmail.com>
	<47CEC6DB.1030309@ebi.ac.uk>
Message-ID: <8adccabf0803050833y408da46fu6f09bdc993121c1f@mail.gmail.com>

Hi, Oleg,

Thanks very much for your answer!  I was indeed confused; thinking
that Realloc was intended to be an analog to realloc (except for SEXP
variables).

Is there a way to do either of the following:
-- resize the SEXP directly (for my purpose, I ONLY need to decrease
the size), or
-- assign it to to a C pointer that was allocated and used previously
in the function (and can thus be resized with realloc).

Thanks again,
Charles

On Wed, Mar 5, 2008 at 11:14 AM, Oleg Sklyar <osklyar at ebi.ac.uk> wrote:
> Rblah in your example is a SEXP structure. Realloc is an interface to C
>  realloc and is not intended to resize SEXP structures -- it is used to
>  resize user-controlled memory (which is generally not created by
>  allocVector/INTEGER).
>
>  You would expect a call like:
>
>  int * val;
>  ...
>  Realloc(val, 20, int);
>
>  Best,
>  Oleg
>
>
>
>  Charles Danko wrote:
>  > Hi,
>  >
>  > Trying to decrease the size of a SEXP variable without reassigning
>  > values individually in a loop.
>  >
>  > So far, I've tried using Realloc, as the follow source demonstrates:
>  > SEXP dothis() {
>  >       SEXP Rblah;
>  >       PROTECT(Rblah = NEW_INTEGER(6));
>  >
>  >       int* blah = INTEGER(Rblah);
>  >       blah[0] = 1;
>  >       blah[1] = 2;
>  >       blah[2] = 3;
>  >
>  >       Realloc(Rblah, 3, INTEGER);
>  >
>  >       UNPROTECT(1);
>  >       return(Rblah);
>  > }
>  >
>  > According to the documentation, I think that this should work, however
>  > it returns an error on compile: "test.c:17: error: expected expression
>  > before ')' token" (line 17 refers to the Realloc line).
>  >
>  > Another solution that will suit my needs is managing the variable in C
>  > and assigning the pointer to an R type in the end.  The following code
>  > gets at this, but int* and SEXP, INTEGER are incompatible:
>  > SEXP dothat() {
>  >       int* blah = malloc(3);// = INTEGER(Rblah);
>  >       blah[0] = 1;
>  >       blah[1] = 2;
>  >       blah[2] = 3;
>  >
>  >       SEXP Rblah;
>  >       PROTECT(Rblah = blah);
>  >
>  >       UNPROTECT(1);
>  >       return(Rblah);
>  > }
>  >
>  > Any suggestions for someone still new to SEXP memory management?
>  >
>  > Thanks,
>  > Charles
>  >
>  > ______________________________________________
>  > R-devel at r-project.org mailing list
>  > https://stat.ethz.ch/mailman/listinfo/r-devel
>
>  --
>  Dr Oleg Sklyar * EBI-EMBL, Cambridge CB10 1SD, UK * +44-1223-494466
>


From osklyar at ebi.ac.uk  Wed Mar  5 17:40:50 2008
From: osklyar at ebi.ac.uk (Oleg Sklyar)
Date: Wed, 05 Mar 2008 16:40:50 +0000
Subject: [Rd] SEXP size management.
In-Reply-To: <8adccabf0803050833y408da46fu6f09bdc993121c1f@mail.gmail.com>
References: <8adccabf0803050756j50ec2022nf9a028f39d8aedfd@mail.gmail.com>	
	<47CEC6DB.1030309@ebi.ac.uk>
	<8adccabf0803050833y408da46fu6f09bdc993121c1f@mail.gmail.com>
Message-ID: <47CECD12.3070804@ebi.ac.uk>



Charles Danko wrote:
> Hi, Oleg,
> 
> Thanks very much for your answer!  I was indeed confused; thinking
> that Realloc was intended to be an analog to realloc (except for SEXP
> variables).
> 
> Is there a way to do either of the following:
> -- resize the SEXP directly (for my purpose, I ONLY need to decrease
> the size), or
Not that I know.

> -- assign it to to a C pointer that was allocated and used previously
> in the function (and can thus be resized with realloc).
Well you can get a pointer to the underlying data, basically with 
INTEGER, REAL etc macros, but resizing that vector is not a good idea as 
you do not know about underlying processes in R connected with memory 
management etc.

I think that whether you want to increase or decrease the size, you will 
end up with recreating a SEXP var. Well, you can keep your data outside 
of SEXP's, like in STL vectors etc and then move it to SEXP at the end.

> 
> Thanks again,
> Charles
> 
> On Wed, Mar 5, 2008 at 11:14 AM, Oleg Sklyar <osklyar at ebi.ac.uk> wrote:
>> Rblah in your example is a SEXP structure. Realloc is an interface to C
>>  realloc and is not intended to resize SEXP structures -- it is used to
>>  resize user-controlled memory (which is generally not created by
>>  allocVector/INTEGER).
>>
>>  You would expect a call like:
>>
>>  int * val;
>>  ...
>>  Realloc(val, 20, int);
>>
>>  Best,
>>  Oleg
>>
>>
>>
>>  Charles Danko wrote:
>>  > Hi,
>>  >
>>  > Trying to decrease the size of a SEXP variable without reassigning
>>  > values individually in a loop.
>>  >
>>  > So far, I've tried using Realloc, as the follow source demonstrates:
>>  > SEXP dothis() {
>>  >       SEXP Rblah;
>>  >       PROTECT(Rblah = NEW_INTEGER(6));
>>  >
>>  >       int* blah = INTEGER(Rblah);
>>  >       blah[0] = 1;
>>  >       blah[1] = 2;
>>  >       blah[2] = 3;
>>  >
>>  >       Realloc(Rblah, 3, INTEGER);
>>  >
>>  >       UNPROTECT(1);
>>  >       return(Rblah);
>>  > }
>>  >
>>  > According to the documentation, I think that this should work, however
>>  > it returns an error on compile: "test.c:17: error: expected expression
>>  > before ')' token" (line 17 refers to the Realloc line).
>>  >
>>  > Another solution that will suit my needs is managing the variable in C
>>  > and assigning the pointer to an R type in the end.  The following code
>>  > gets at this, but int* and SEXP, INTEGER are incompatible:
>>  > SEXP dothat() {
>>  >       int* blah = malloc(3);// = INTEGER(Rblah);
>>  >       blah[0] = 1;
>>  >       blah[1] = 2;
>>  >       blah[2] = 3;
>>  >
>>  >       SEXP Rblah;
>>  >       PROTECT(Rblah = blah);
>>  >
>>  >       UNPROTECT(1);
>>  >       return(Rblah);
>>  > }
>>  >
>>  > Any suggestions for someone still new to SEXP memory management?
>>  >
>>  > Thanks,
>>  > Charles
>>  >
>>  > ______________________________________________
>>  > R-devel at r-project.org mailing list
>>  > https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>  --
>>  Dr Oleg Sklyar * EBI-EMBL, Cambridge CB10 1SD, UK * +44-1223-494466
>>

-- 
Dr Oleg Sklyar * EBI-EMBL, Cambridge CB10 1SD, UK * +44-1223-494466


From edd at debian.org  Thu Mar  6 00:26:40 2008
From: edd at debian.org (Dirk Eddelbuettel)
Date: Wed, 5 Mar 2008 17:26:40 -0600
Subject: [Rd] embedFonts() side-effect under 2.6.2 ?
Message-ID: <18383.11312.484162.606729@ron.nulle.part>


I received the following as a Debain bug report (cf
http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=469560) 

   To reproduce:

   1) Run the following commands:

   filename <- 'test.pdf'
   pdf(filename)
   plot(1:10)
   dev.off()
   
   2) Open test.pdf (I use Evince, but the same with Adobe Acrobat). Make
      sure there are ten hollow points in the plot. This is correct.
   
   3) Run command
   
   embedFonts(filename)
   
   4) Open test.pdf again. The points are now solid.
   
   The bug was introduced in one of the recent versions (I think in
   2.6.x). I'm ready to provide any additional info.

I don;t have r-devel (or r-patched) handy right now. Could someone kindly
confirm / deny is this is still an open issue?
   
Thanks, Dirk

-- 
Three out of two people have difficulties with fractions.


From hb at stat.berkeley.edu  Thu Mar  6 02:56:27 2008
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Wed, 5 Mar 2008 17:56:27 -0800
Subject: [Rd] invalid regular expression '[a-Z]'
Message-ID: <59d7961d0803051756s307dcab1kbaffc4eeb9d308cf@mail.gmail.com>

Hi,

just curious, but does anyone know the source/reason of observing the
following error on OSX but not on WinXP and Linux?  I've tried with a
few different versions of R (v2.5.1, v2.6.1, v2.6.2, v2.7.0devel).
The locale does not seem to affect the error, i.e. I've tested a few
different and it is still only OSX that gives the error but not the
other two.

> regexpr("[a-Z]", "foo")
Error in regexpr(pattern, text, extended, fixed, useBytes) :
        invalid regular expression '[a-Z]'
> regexpr("[a-zA-Z]", "foo")
[1] 1
attr(,"match.length")
[1] 1
> regexpr("[A-z]", "foo")
[1] 1
attr(,"match.length")
[1] 1

At least now I know it that the safest is to use '[a-zA-Z]' (or
possibly '[[:alpha:]]').

/Henrik


From murdoch at stats.uwo.ca  Thu Mar  6 03:18:34 2008
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Wed, 05 Mar 2008 21:18:34 -0500
Subject: [Rd] invalid regular expression '[a-Z]'
In-Reply-To: <59d7961d0803051756s307dcab1kbaffc4eeb9d308cf@mail.gmail.com>
References: <59d7961d0803051756s307dcab1kbaffc4eeb9d308cf@mail.gmail.com>
Message-ID: <47CF547A.5020203@stats.uwo.ca>

On 05/03/2008 8:56 PM, Henrik Bengtsson wrote:
> Hi,
> 
> just curious, but does anyone know the source/reason of observing the
> following error on OSX but not on WinXP and Linux? 

Presumably in the locale you're using on OSX, "a" < "Z" is false.  This 
is the ascii sort order used in the C locale.  On my Windows box, "a" < 
"Z" is true, because it uses the English_Canada.1252 collation order.

Duncan Murdoch

  I've tried with a
> few different versions of R (v2.5.1, v2.6.1, v2.6.2, v2.7.0devel).
> The locale does not seem to affect the error, i.e. I've tested a few
> different and it is still only OSX that gives the error but not the
> other two.
> 
>> regexpr("[a-Z]", "foo")
> Error in regexpr(pattern, text, extended, fixed, useBytes) :
>         invalid regular expression '[a-Z]'
>> regexpr("[a-zA-Z]", "foo")
> [1] 1
> attr(,"match.length")
> [1] 1
>> regexpr("[A-z]", "foo")
> [1] 1
> attr(,"match.length")
> [1] 1
> 
> At least now I know it that the safest is to use '[a-zA-Z]' (or
> possibly '[[:alpha:]]').
> 
> /Henrik
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From edd at debian.org  Thu Mar  6 03:26:14 2008
From: edd at debian.org (Dirk Eddelbuettel)
Date: Wed, 5 Mar 2008 20:26:14 -0600
Subject: [Rd] embedFonts() side-effect under 2.6.2 ?
In-Reply-To: <18383.11312.484162.606729@ron.nulle.part>
References: <18383.11312.484162.606729@ron.nulle.part>
Message-ID: <18383.22086.937059.1631@ron.nulle.part>


On 5 March 2008 at 17:26, Dirk Eddelbuettel wrote:
| 
| I received the following as a Debain bug report (cf
| http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=469560) 
| 
|    To reproduce:
| 
|    1) Run the following commands:
| 
|    filename <- 'test.pdf'
|    pdf(filename)
|    plot(1:10)
|    dev.off()
|    
|    2) Open test.pdf (I use Evince, but the same with Adobe Acrobat). Make
|       sure there are ten hollow points in the plot. This is correct.
|    
|    3) Run command
|    
|    embedFonts(filename)
|    
|    4) Open test.pdf again. The points are now solid.
|    
|    The bug was introduced in one of the recent versions (I think in
|    2.6.x). I'm ready to provide any additional info.
| 
| I don;t have r-devel (or r-patched) handy right now. 

Now I do. With the tarball of R-devel aka the future R 2.7.0 (svn r44677), we

  a) the same result of a bad R / gs interaction turning the bullets if we
     use pdf() and the embedFonts()

  b) however, using the shiny new cairo_pdf() device, no such problem arises.

So, given the bug report against R 2.6.2 and the continued problem under R
2.7.0, is this a valid problem?  Or is it just a side-effect of ghostscript
manipulating the file ?

Dirk

| Could someone kindly confirm / deny is this is still an open issue?
|    
| Thanks, Dirk
| 
| -- 
| Three out of two people have difficulties with fractions.
| 
| ______________________________________________
| R-devel at r-project.org mailing list
| https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Three out of two people have difficulties with fractions.


From hb at stat.berkeley.edu  Thu Mar  6 03:40:48 2008
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Wed, 5 Mar 2008 18:40:48 -0800
Subject: [Rd] invalid regular expression '[a-Z]'
In-Reply-To: <47CF547A.5020203@stats.uwo.ca>
References: <59d7961d0803051756s307dcab1kbaffc4eeb9d308cf@mail.gmail.com>
	<47CF547A.5020203@stats.uwo.ca>
Message-ID: <59d7961d0803051840l2101de5dj92fe33676f591947@mail.gmail.com>

On Wed, Mar 5, 2008 at 6:18 PM, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
> On 05/03/2008 8:56 PM, Henrik Bengtsson wrote:
>  > Hi,
>  >
>  > just curious, but does anyone know the source/reason of observing the
>  > following error on OSX but not on WinXP and Linux?
>
>  Presumably in the locale you're using on OSX, "a" < "Z" is false.  This
>  is the ascii sort order used in the C locale.  On my Windows box, "a" <
>  "Z" is true, because it uses the English_Canada.1252 collation order.

That's it indeed.  The person who first reported the error had
sessionInfo() locale
'en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8' and I
missed that 'C' in the middle, which I guess his system falls back to
if none of the previous ones exist?!?

Now I can reproduce it on both Windows and Linux:

> Sys.setlocale("LC_ALL", "C")
[1] "C"
> regexpr("[a-Z]", "foo")
Error in regexpr("[a-Z]", "foo") : invalid regular expression '[a-Z]'
> Sys.setlocale("LC_ALL", "en")
[1] "LC_COLLATE=English_United States.1252;LC_CTYPE=English_United States.1252;L
C_MONETARY=English_United States.1252;LC_NUMERIC=C;LC_TIME=English_United States
.1252"
> regexpr("[a-Z]", "foo")
[1] 1
attr(,"match.length")
[1] 1

Case almost closed, but then the question is why don't you get an
error in one of the two cases '[a-Z]' and '[A-z]' then with the other
locale(s)?

> Sys.setlocale("LC_ALL", "en")
[1] "LC_COLLATE=English_United States.1252;LC_CTYPE=English_United States.1252;L
C_MONETARY=English_United States.1252;LC_NUMERIC=C;LC_TIME=English_United States
.1252"
> regexpr("[a-Z]", "foo")
[1] 1
attr(,"match.length")
[1] 1
> regexpr("[A-z]", "foo")
[1] 1
attr(,"match.length")
[1] 1
> "a" < "Z"
[1] TRUE
> "a" > "Z"
[1] FALSE

Thanks

/Henrik

>
>  Duncan Murdoch
>
>
>   I've tried with a
>  > few different versions of R (v2.5.1, v2.6.1, v2.6.2, v2.7.0devel).
>  > The locale does not seem to affect the error, i.e. I've tested a few
>  > different and it is still only OSX that gives the error but not the
>  > other two.
>  >
>  >> regexpr("[a-Z]", "foo")
>  > Error in regexpr(pattern, text, extended, fixed, useBytes) :
>  >         invalid regular expression '[a-Z]'
>  >> regexpr("[a-zA-Z]", "foo")
>  > [1] 1
>  > attr(,"match.length")
>  > [1] 1
>  >> regexpr("[A-z]", "foo")
>  > [1] 1
>  > attr(,"match.length")
>  > [1] 1
>  >
>  > At least now I know it that the safest is to use '[a-zA-Z]' (or
>  > possibly '[[:alpha:]]').
>  >
>  > /Henrik
>  >
>  > ______________________________________________
>  > R-devel at r-project.org mailing list
>  > https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From hb at stat.berkeley.edu  Thu Mar  6 03:42:51 2008
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Wed, 5 Mar 2008 18:42:51 -0800
Subject: [Rd] invalid regular expression '[a-Z]'
In-Reply-To: <59d7961d0803051840l2101de5dj92fe33676f591947@mail.gmail.com>
References: <59d7961d0803051756s307dcab1kbaffc4eeb9d308cf@mail.gmail.com>
	<47CF547A.5020203@stats.uwo.ca>
	<59d7961d0803051840l2101de5dj92fe33676f591947@mail.gmail.com>
Message-ID: <59d7961d0803051842i7a832140k31a97254806dded1@mail.gmail.com>

On Wed, Mar 5, 2008 at 6:40 PM, Henrik Bengtsson <hb at stat.berkeley.edu> wrote:
> On Wed, Mar 5, 2008 at 6:18 PM, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
>  > On 05/03/2008 8:56 PM, Henrik Bengtsson wrote:
>  >  > Hi,
>  >  >
>  >  > just curious, but does anyone know the source/reason of observing the
>  >  > following error on OSX but not on WinXP and Linux?
>  >
>  >  Presumably in the locale you're using on OSX, "a" < "Z" is false.  This
>  >  is the ascii sort order used in the C locale.  On my Windows box, "a" <
>  >  "Z" is true, because it uses the English_Canada.1252 collation order.
>
>  That's it indeed.  The person who first reported the error had
>  sessionInfo() locale
>  'en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8' and I
>  missed that 'C' in the middle, which I guess his system falls back to
>  if none of the previous ones exist?!?
>
>  Now I can reproduce it on both Windows and Linux:
>
>  > Sys.setlocale("LC_ALL", "C")
>  [1] "C"
>  > regexpr("[a-Z]", "foo")
>  Error in regexpr("[a-Z]", "foo") : invalid regular expression '[a-Z]'
>  > Sys.setlocale("LC_ALL", "en")
>  [1] "LC_COLLATE=English_United States.1252;LC_CTYPE=English_United States.1252;L
>  C_MONETARY=English_United States.1252;LC_NUMERIC=C;LC_TIME=English_United States
>  .1252"
>  > regexpr("[a-Z]", "foo")
>
> [1] 1
>  attr(,"match.length")
>  [1] 1
>
>  Case almost closed, but then the question is why don't you get an
>  error in one of the two cases '[a-Z]' and '[A-z]' then with the other
>  locale(s)?
>
>  > Sys.setlocale("LC_ALL", "en")
>  [1] "LC_COLLATE=English_United States.1252;LC_CTYPE=English_United States.1252;L
>  C_MONETARY=English_United States.1252;LC_NUMERIC=C;LC_TIME=English_United States
>  .1252"
>  > regexpr("[a-Z]", "foo")
>
> [1] 1
>  attr(,"match.length")
>  [1] 1
>  > regexpr("[A-z]", "foo")
>  [1] 1
>  attr(,"match.length")
>  [1] 1
>  > "a" < "Z"
>  [1] TRUE
>  > "a" > "Z"
>  [1] FALSE

My bad...

> "A" < "z"
[1] TRUE
>  > regexpr("[A-z]", "foo")
>  [1] 1
>  attr(,"match.length")
>  [1] 1
> "z" < "A"
[1] FALSE
> regexpr("[z-A]", "foo")
Error in regexpr("[z-A]", "foo") : invalid regular expression '[z-A]'

Case closed

/Henrik

>
>  Thanks
>
>  /Henrik
>
>
>
>  >
>  >  Duncan Murdoch
>  >
>  >
>  >   I've tried with a
>  >  > few different versions of R (v2.5.1, v2.6.1, v2.6.2, v2.7.0devel).
>  >  > The locale does not seem to affect the error, i.e. I've tested a few
>  >  > different and it is still only OSX that gives the error but not the
>  >  > other two.
>  >  >
>  >  >> regexpr("[a-Z]", "foo")
>  >  > Error in regexpr(pattern, text, extended, fixed, useBytes) :
>  >  >         invalid regular expression '[a-Z]'
>  >  >> regexpr("[a-zA-Z]", "foo")
>  >  > [1] 1
>  >  > attr(,"match.length")
>  >  > [1] 1
>  >  >> regexpr("[A-z]", "foo")
>  >  > [1] 1
>  >  > attr(,"match.length")
>  >  > [1] 1
>  >  >
>  >  > At least now I know it that the safest is to use '[a-zA-Z]' (or
>  >  > possibly '[[:alpha:]]').
>  >  >
>  >  > /Henrik
>  >  >
>  >  > ______________________________________________
>  >  > R-devel at r-project.org mailing list
>  >  > https://stat.ethz.ch/mailman/listinfo/r-devel
>  >
>  >
>


From ripley at stats.ox.ac.uk  Thu Mar  6 08:09:27 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 6 Mar 2008 07:09:27 +0000 (GMT)
Subject: [Rd] invalid regular expression '[a-Z]'
In-Reply-To: <59d7961d0803051840l2101de5dj92fe33676f591947@mail.gmail.com>
References: <59d7961d0803051756s307dcab1kbaffc4eeb9d308cf@mail.gmail.com>
	<47CF547A.5020203@stats.uwo.ca>
	<59d7961d0803051840l2101de5dj92fe33676f591947@mail.gmail.com>
Message-ID: <alpine.LFD.1.00.0803060648380.15154@gannet.stats.ox.ac.uk>

On Wed, 5 Mar 2008, Henrik Bengtsson wrote:

> On Wed, Mar 5, 2008 at 6:18 PM, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
>> On 05/03/2008 8:56 PM, Henrik Bengtsson wrote:
>> > Hi,
>> >
>> > just curious, but does anyone know the source/reason of observing the
>> > following error on OSX but not on WinXP and Linux?
>>
>>  Presumably in the locale you're using on OSX, "a" < "Z" is false.  This
>>  is the ascii sort order used in the C locale.  On my Windows box, "a" <
>>  "Z" is true, because it uses the English_Canada.1252 collation order.
>
> That's it indeed.  The person who first reported the error had
> sessionInfo() locale
> 'en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8' and I
> missed that 'C' in the middle, which I guess his system falls back to
> if none of the previous ones exist?!?

No.  Those are settings for various categories, just as you showed for 
Window.  The first setting appears to be LC_COLLATE, but what they mean is 
not documented on the system man page for setlocale.

It's just that MacOS uses C collation order in English locales, even 
though almost everyone else uses aAbB or AaBb (the latter being what the 
English actually use, as do almost all book indices in dialects of 
English).  But then there is no surprise that MacOS has to be different 
... its implementaton of locales is idiosyncratic (to be generous).

Note that even [A-Za-z] is unsafe -- as I recall Z is in the middle of the 
alphabet in Estonian locales.  If you want alphabetic characters, use 
[[:alpha:]].  If you want ASCII alphabetic characters, write out the 
ranges as [AB...Zab...z]

E.g. (F8 Linux)

> Sys.setlocale("LC_COLLATE", "et_EE.utf8")
[1] "et_EE.utf8"
> paste(sort(c(letters,LETTERS)), collapse="")
[1] "AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsZzTtUuVvWwXxYy"


[...]

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From hb at stat.berkeley.edu  Thu Mar  6 09:52:58 2008
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Thu, 6 Mar 2008 00:52:58 -0800
Subject: [Rd] invalid regular expression '[a-Z]'
In-Reply-To: <alpine.LFD.1.00.0803060648380.15154@gannet.stats.ox.ac.uk>
References: <59d7961d0803051756s307dcab1kbaffc4eeb9d308cf@mail.gmail.com>
	<47CF547A.5020203@stats.uwo.ca>
	<59d7961d0803051840l2101de5dj92fe33676f591947@mail.gmail.com>
	<alpine.LFD.1.00.0803060648380.15154@gannet.stats.ox.ac.uk>
Message-ID: <59d7961d0803060052u3d89dba2tf5475d04cfad44c5@mail.gmail.com>

On Wed, Mar 5, 2008 at 11:09 PM, Prof Brian Ripley
<ripley at stats.ox.ac.uk> wrote:
> On Wed, 5 Mar 2008, Henrik Bengtsson wrote:
>
>  > On Wed, Mar 5, 2008 at 6:18 PM, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
>  >> On 05/03/2008 8:56 PM, Henrik Bengtsson wrote:
>  >> > Hi,
>  >> >
>  >> > just curious, but does anyone know the source/reason of observing the
>  >> > following error on OSX but not on WinXP and Linux?
>  >>
>  >>  Presumably in the locale you're using on OSX, "a" < "Z" is false.  This
>  >>  is the ascii sort order used in the C locale.  On my Windows box, "a" <
>  >>  "Z" is true, because it uses the English_Canada.1252 collation order.
>  >
>  > That's it indeed.  The person who first reported the error had
>  > sessionInfo() locale
>  > 'en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8' and I
>  > missed that 'C' in the middle, which I guess his system falls back to
>  > if none of the previous ones exist?!?
>
>  No.  Those are settings for various categories, just as you showed for
>  Window.  The first setting appears to be LC_COLLATE, but what they mean is
>  not documented on the system man page for setlocale.
>
>  It's just that MacOS uses C collation order in English locales, even
>  though almost everyone else uses aAbB or AaBb (the latter being what the
>  English actually use, as do almost all book indices in dialects of
>  English).  But then there is no surprise that MacOS has to be different
>  ... its implementaton of locales is idiosyncratic (to be generous).
>
>  Note that even [A-Za-z] is unsafe -- as I recall Z is in the middle of the
>  alphabet in Estonian locales.  If you want alphabetic characters, use
>  [[:alpha:]].  If you want ASCII alphabetic characters, write out the
>  ranges as [AB...Zab...z]
>
>  E.g. (F8 Linux)
>
>  > Sys.setlocale("LC_COLLATE", "et_EE.utf8")
>  [1] "et_EE.utf8"
>  > paste(sort(c(letters,LETTERS)), collapse="")
>  [1] "AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsZzTtUuVvWwXxYy"

Alpha and Omega - you said it all.

Thanks for the clarifications.

/Henrik

>
>
>  [...]
>
>  --
>  Brian D. Ripley,                  ripley at stats.ox.ac.uk
>  Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
>  University of Oxford,             Tel:  +44 1865 272861 (self)
>  1 South Parks Road,                     +44 1865 272866 (PA)
>  Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>


From hb at stat.berkeley.edu  Thu Mar  6 11:27:49 2008
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Thu, 6 Mar 2008 02:27:49 -0800
Subject: [Rd] Argument "nomatch" matched by multiple actual arguments ...
	%in% -> match?!?
Message-ID: <59d7961d0803060227o44eae581m385bf8168b1b56d4@mail.gmail.com>

When I run R CMD check R.oo on R v2.7.0 devel (2008-03-04 r44677) on
WinXP I get the following error while testing examples:

Error in match(x, table, nomatch = 0) :
  formal argument "nomatch" matched by multiple actual arguments
Calls: setMethodS3 -> setMethodS3.default -> %in% -> match
Execution halted

How is that even possible with:

> get("%in%")
function (x, table)
match(x, table, nomatch = 0) > 0
<environment: namespace:base>

All '%in' statements in setMethodS3.default are of kind (foo %in%
bar).   The error does not happen if I run the example(Object)
explicitly.

/Henrik


From org.r-project at pooryorick.com  Wed Mar  5 19:35:41 2008
From: org.r-project at pooryorick.com (org.r-project at pooryorick.com)
Date: Wed,  5 Mar 2008 19:35:41 +0100 (CET)
Subject: [Rd] Press delete key three times in R-2.6.1 to get segmentation
	fault (PR#10892)
Message-ID: <20080305183541.24BB9282EFF0@mail.pubhealth.ku.dk>

Full_Name: Poor Yorick
Version: R-2.6.1
OS: 2.4.21-50.ELhugemem #1 SMP Tue May 8 17:10:31 EDT 2007 i686 i686 i386 GNU/Linux
Submission from: (NULL) (148.168.40.4)


After compiling R-2.6.1 with gcc-4.2.1 pressing the 'delete' key three times in
an interactive session causes R to malfunction, spitting out an infinite stream
of errors.  I have also replicated the issue in R-2.5.1:


	R version 2.6.1 (2007-11-26)
	Copyright (C) 2007 The R Foundation for Statistical Computing
	ISBN 3-900051-07-0

	R is free software and comes with ABSOLUTELY NO WARRANTY.
	You are welcome to redistribute it under certain conditions.
	Type 'license()' or 'licence()' for distribution details.

	R is a collaborative project with many contributors.
	Type 'contributors()' for more information and
	'citation()' on how to cite R or R packages in publications.

	Type 'demo()' for some demos, 'help()' for on-line help, or
	'help.start()' for an HTML browser interface to help.
	Type 'q()' to quit R.

	> (HERE I PRESS DELETE KEY 3 TIMES)

	 *** caught segfault ***
	address (nil), cause 'memory not mapped'

	Possible actions:
	1: abort (with core dump, if enabled)
	2: normal R exit
	3: exit R without saving workspace
	4: exit R saving workspace
	Selection: 
	 *** caught segfault ***
	address (nil), cause 'memory not mapped'


	Possible actions:
	1: abort (with core dump, if enabled)
	2: normal R exit
	3: exit R without saving workspace
	4: exit R saving workspace
	Selection: 
	 *** caught segfault ***
	address (nil), cause 'memory not mapped'

	( SAME MESSAGE 32 more times )


	Possible actions:
	1: abort (with core dump, if enabled)
	2: normal R exit
	3: exit R without saving workspace
	4: exit R saving workspace
	Error in structure(list(name = name, exit = NULL, handler = handler, "t??" =
`t??`,  : 
	  Value of SET_STRING_ELT() must be a 'CHARSXP' not a 'character'
	In addition: There were 24 warnings (use warnings() to see them)
	Error: value of 'SET_CXTAIL' must be a char or NULL, not a 'char'
	Error: value of 'SET_CXTAIL' must be a char or NULL, not a 'char'
	Error: value of 'SET_CXTAIL' must be a char or NULL, not a 'char'
	Error: value of 'SET_CXTAIL' must be a char or NULL, not a 'char'
	Error: value of 'SET_CXTAIL' must be a char or NULL, not a 'char'
	Error: value of 'SET_CXTAIL' must be a char or NULL, not a 'char'
	Error: value of 'SET_CXTAIL' must be a char or NULL, not a 'char'
	Error: value of 'SET_CXTAIL' must be a char or NULL, not a 'char'
	Error: value of 'SET_CXTAIL' must be a char or NULL, not a 'char'

	(REPEATS INFINITELY)




Here is the xev record of a 'delete' key press in my terminal

	KeyPress event, serial 20, synthetic NO, window 0xe00001,
	    root 0x3e, subw 0x0, time 443263949, (167,-11), root:(213,54),
	    state 0x0, keycode 107 (keysym 0xffff, Delete), same_screen YES,
	    XLookupString gives 1 bytes:  ""

	KeyRelease event, serial 20, synthetic NO, window 0xe00001,
	    root 0x3e, subw 0x0, time 443264060, (167,-11), root:(213,54),
	    state 0x0, keycode 107 (keysym 0xffff, Delete), same_screen YES,
	    XLookupString gives 1 bytes:  ""

Here are the specs for the gcc that compiled R:

	$ gcc -dumpspecs
	*asm:
	%{v:-V} %{Qy:} %{!Qn:-Qy} %{n} %{T} %{Ym,*} %{Yd,*} %{Wa,*:%*}

	*asm_debug:
	%{gstabs*:--gstabs}%{!gstabs*:%{g*:--gdwarf2}}

	*asm_final:


	*asm_options:
	%a %Y %{c:%W{o*}%{!o*:-o %w%b%O}}%{!c:-o %d%w%u%O}

	*invoke_as:
	%{!S:-o %|.s |
	 as %(asm_options) %|.s %A }

	*cpp:
	%{posix:-D_POSIX_SOURCE} %{pthread:-D_REENTRANT}

	*cpp_options:
	%(cpp_unique_options) %1 %{m*} %{std*&ansi&trigraphs} %{W*&pedantic*} %{w}
%{f*} %{g*:%{!g0:%{!fno-working-directory:-fworking-directory}}} %{O*} %{undef}
%{save-temps:-fpch-preprocess}

	*cpp_debug_options:
	%{d*}

	*cpp_unique_options:
	%{C|CC:%{!E:%eGCC does not support -C or -CC without -E}} %{!Q:-quiet}
%{nostdinc*} %{C} %{CC} %{v} %{I*&F*} %{P} %I %{MD:-MD %{!o:%b.d}%{o*:%.d%*}}
%{MMD:-MMD %{!o:%b.d}%{o*:%.d%*}} %{M} %{MM} %{MF*} %{MG} %{MP} %{MQ*} %{MT*}
%{!E:%{!M:%{!MM:%{MD|MMD:%{o*:-MQ %*}}}}} %{remap} %{g3:-dD} %{H} %C %{D*&U*&A*}
%{i*} %Z %i %{fmudflap:-D_MUDFLAP -include mf-runtime.h} %{fmudflapth:-D_MUDFLAP
-D_MUDFLAPTH -include mf-runtime.h} %{E|M|MM:%W{o*}}

	*trad_capable_cpp:
	cc1 -E %{traditional|ftraditional|traditional-cpp:-traditional-cpp}

	*cc1:
	%(cc1_cpu) %{profile:-p}

	*cc1_options:
	%{pg:%{fomit-frame-pointer:%e-pg and -fomit-frame-pointer are incompatible}} %1
%{!Q:-quiet} -dumpbase %B %{d*} %{m*} %{a*} %{c|S:%{o*:-auxbase-strip
%*}%{!o*:-auxbase %b}}%{!c:%{!S:-auxbase %b}} %{g*} %{O*} %{W*&pedantic*} %{w}
%{std*&ansi&trigraphs} %{v:-version} %{pg:-p} %{p} %{f*} %{undef}
%{Qn:-fno-ident} %{--help:--help} %{--target-help:--target-help}
%{!fsyntax-only:%{S:%W{o*}%{!o*:-o %b.s}}} %{fsyntax-only:-o %j} %{-param*}
%{fmudflap|fmudflapth:-fno-builtin -fno-merge-constants}
%{coverage:-fprofile-arcs -ftest-coverage}

	*cc1plus:


	*link_gcc_c_sequence:
	%{static:--start-group} %G %L %{static:--end-group}%{!static:%G}

	*link_ssp:
	%{fstack-protector|fstack-protector-all:-lssp_nonshared -lssp}

	*endfile:
	%{ffast-math|funsafe-math-optimizations:crtfastmath.o%s}   
%{shared|pie:crtendS.o%s;:crtend.o%s} crtn.o%s

	*link:
	%{!static:--eh-frame-hdr} -m %(link_emulation) %{shared:-shared}   %{!shared:  
  %{!ibcs:       %{!static:     %{rdynamic:-export-dynamic}    
%{!dynamic-linker:-dynamic-linker %(dynamic_linker)}}   %{static:-static}}}

	*lib:
	%{pthread:-lpthread}    %{shared:-lc}    %{!shared:%{mieee-fp:-lieee}
%{profile:-lc_p}%{!profile:-lc}}

	*mfwrap:
	 %{static: %{fmudflap|fmudflapth:  --wrap=malloc --wrap=free --wrap=calloc
--wrap=realloc --wrap=mmap --wrap=munmap --wrap=alloca} %{fmudflapth:
--wrap=pthread_create}} %{fmudflap|fmudflapth: --wrap=main}

	*mflib:
	%{fmudflap|fmudflapth: -export-dynamic}

	*link_gomp:


	*libgcc:
	%{static|static-libgcc:-lgcc
-lgcc_eh}%{!static:%{!static-libgcc:%{!shared-libgcc:-lgcc --as-needed -lgcc_s
--no-as-needed}%{shared-libgcc:-lgcc_s%{!shared: -lgcc}}}}

	*startfile:
	%{!shared: %{pg|p|profile:gcrt1.o%s;pie:Scrt1.o%s;:crt1.o%s}}    crti.o%s
%{static:crtbeginT.o%s;shared|pie:crtbeginS.o%s;:crtbegin.o%s}

	*switches_need_spaces:


	*cross_compile:
	0

	*version:
	4.2.2

	*multilib:
	. ;

	*multilib_defaults:


	*multilib_extra:


	*multilib_matches:


	*multilib_exclusions:


	*multilib_options:


	*linker:
	collect2

	*link_libgcc:
	%D

	*md_exec_prefix:


	*md_startfile_prefix:


	*md_startfile_prefix_1:


	*startfile_prefix_spec:


	*sysroot_spec:
	--sysroot=%R

	*sysroot_suffix_spec:


	*sysroot_hdrs_suffix_spec:


	*cc1_cpu:
	%{!mtune*: %{m386:mtune=i386 %n`-m386' is deprecated. Use `-march=i386' or
`-mtune=i386' instead.
	} %{m486:-mtune=i486 %n`-m486' is deprecated. Use `-march=i486' or
`-mtune=i486' instead.
	} %{mpentium:-mtune=pentium %n`-mpentium' is deprecated. Use `-march=pentium'
or `-mtune=pentium' instead.
	} %{mpentiumpro:-mtune=pentiumpro %n`-mpentiumpro' is deprecated. Use
`-march=pentiumpro' or `-mtune=pentiumpro' instead.
	} %{mcpu=*:-mtune=%* %n`-mcpu=' is deprecated. Use `-mtune=' or '-march='
instead.
	}} %<mcpu=* %{mintel-syntax:-masm=intel %n`-mintel-syntax' is deprecated. Use
`-masm=intel' instead.
	} %{mno-intel-syntax:-masm=att %n`-mno-intel-syntax' is deprecated. Use
`-masm=att' instead.
	}%{march=native:%<march=native %:local_cpu_detect(arch)  
%{!mtune=*:%<mtune=native %:local_cpu_detect(tune)}}
%{mtune=native:%<mtune=native %:local_cpu_detect(tune)}

	*link_emulation:
	elf_i386

	*dynamic_linker:
	%{muclibc:%{mglibc:%e-mglibc and -muclibc used
together}/lib/ld-uClibc.so.0;:/lib/ld-linux.so.2}

	*link_command:
	%{!fsyntax-only:%{!c:%{!M:%{!MM:%{!E:%{!S:    %(linker) %l %{pie:-pie} %X %{o*}
%{A} %{d} %{e*} %{m} %{N} %{n} %{r}    %{s} %{t} %{u*} %{x} %{z} %{Z}
%{!A:%{!nostdlib:%{!nostartfiles:%S}}}    %{static:} %{L*} %(mfwrap)
%(link_libgcc) %o    %{fopenmp:%:include(libgomp.spec)%(link_gomp)} %(mflib)   
%{fprofile-arcs|fprofile-generate|coverage:-lgcov}   
%{!nostdlib:%{!nodefaultlibs:%(link_ssp) %(link_gcc_c_sequence)}}   
%{!A:%{!nostdlib:%{!nostartfiles:%E}}} %{T*} }}}}}




-- 
yorick


From marc_schwartz at comcast.net  Thu Mar  6 15:15:07 2008
From: marc_schwartz at comcast.net (marc_schwartz at comcast.net)
Date: Thu,  6 Mar 2008 15:15:07 +0100 (CET)
Subject: [Rd] Press delete key three times in R-2.6.1 to get
	segmentation (PR#10898)
Message-ID: <20080306141507.89D53282EFF8@mail.pubhealth.ku.dk>

org.r-project at pooryorick.com wrote:
> Full_Name: Poor Yorick
> Version: R-2.6.1
> OS: 2.4.21-50.ELhugemem #1 SMP Tue May 8 17:10:31 EDT 2007 i686 i686 i386 GNU/Linux
> Submission from: (NULL) (148.168.40.4)
> 
> 
> After compiling R-2.6.1 with gcc-4.2.1 pressing the 'delete' key three times in
> an interactive session causes R to malfunction, spitting out an infinite stream
> of errors.  I have also replicated the issue in R-2.5.1:

<snip>

You are specifically asked to not report bugs on obsolete versions of R 
and to check for prior similar reports.

R 2.6.2 is the current version.

This has been reported previously (over 2 years ago on R version 2.2.1) 
and was associated with a bug in readline, which is the underlying 
functionality that handles getting input from the user in the console.

Since you are running a 2.4 series kernel, it suggests that you may also 
be running an older Linux distribution.

Be sure that your system is updated, including the readline libraries, 
the current version of which is 5.2.

HTH,

Marc Schwartz


From org.r-project at pooryorick.com  Thu Mar  6 17:45:08 2008
From: org.r-project at pooryorick.com (org.r-project at pooryorick.com)
Date: Thu,  6 Mar 2008 17:45:08 +0100 (CET)
Subject: [Rd] Press delete key three times in R-2.6.1 to get
	segmentation (PR#10899)
Message-ID: <20080306164508.A3957283416D@mail.pubhealth.ku.dk>

Marc Schwartz wrote:
> org.r-project at pooryorick.com wrote:
[SNIP]
> 
> This has been reported previously (over 2 years ago on R version 2.2.1) 
> and was associated with a bug in readline, which is the underlying 
> functionality that handles getting input from the user in the console.
> 

Sorry about the redundant submission.  FWIW, I attempted to do a search on the
R Bug Tracking System, but a user interface issue led me to believe that the
search had turned up no results.  It seems to me that pressing the 'Enter' key
when the focus is on the 'Regular Expression' field should activate the 'Select
Messages' submit button.  However, I believe it activates the 'New Bug Report'
button, which led me to believe that no results had been returned.


-- 
Yorick


From revitalyr at yandex.ru  Thu Mar  6 18:25:09 2008
From: revitalyr at yandex.ru (revitalyr at yandex.ru)
Date: Thu,  6 Mar 2008 18:25:09 +0100 (CET)
Subject: [Rd] parser failed on correct formula (PR#10901)
Message-ID: <20080306172509.DEDD6282EFF6@mail.pubhealth.ku.dk>

Full_Name: Vitaly Reshetyuk
Version: 2.6.2
OS: Windows XP SP2
Submission from: (NULL) (92.112.140.118)


> as.formula ("Something~
Ps_1+GIs_1+Es_1+RPs_1+Cs_1+IGs_1+Vs_1+Rs_1+MCs_1+TRs_1+VBs_1+Fs_1+Pd_1+GId_1+Ed_1+RPd_1+Cd_1+IGd_1+Vd_1+Rd_1+MCd_1+TRd_1+VBd_1+Fd_1+Ps_2+GIs_2+Es_2+RPs_2+Cs_2+IGs_2+Vs_2+Rs_2+MCs_2+TRs_2+VBs_2+Fs_2+Pd_2+GId_2+Ed_2+RPd_2+Cd_2+IGd_2+Vd_2+Rd_2+MCd_2+TRd_2+VBd_2+Fd_2+COM1_median+H1_median+H1E_median+H1I_median+H1D_median+H1DI_median+H1DE_median+H1S_median+H1SI_median+H1SE_median+F1_median+F1I_median+F1E_median+F1D_median+F1DI_median+F1DE_median+F1S_median+F1SI_median+F1SE_median+COM2_median+H2_median+H2E_median+H2I_median+H2D_median+H2DI_median+H2DE_median+H2S_median+H2SI_median+H2SE_median+F2_median+F2I_median+F2E_median+F2D_median+F2DI_median+F2DE_median+F2S_median+F2SI_median+F2SE_median+1I_median+D1I_median+S1I_median+2I_median+D2I_median+S2I_median+D1_median+S1_median+D2_median+S2_median+1E_median+D1E_median+S1E_median+2E_median+D2E_median+S2E_median+MCOM1_mean+MH1_mean+MH1D_mean+MH1DI_mean+MH1DE_mean+MH1S_mean+MH1SI_mean+MH1SE_mean+MF1_mean+MF1D_mean+MF1DI_mean+MF1DE_mean+M
 F1S_mean
+ +MF1SI_mean+MF1SE_mean+MCOM2_mean+MH2_mean+MH2D_mean+MH2DI_mean+MH2DE_mean+MH2S_mean+MH2SI_mean+MH2SE_mean+MF2_mean+MF2D_mean+MF2DI_mean+MF2DE_mean+MF2S_mean+MF2SI_mean+MF2SE_mean+M1I_mean+MD1I_mean+MS1I_mean+M2I_mean+MD2I_mean+MS2I_mean+MD1_mean+MS1_mean+MD2_mean+MS2_mean+M1E_mean+MD1E_mean+MS1E_mean+M2E_mean+MD2E_mean+MS2E_mean+Pd_1diff+Ps_1diff+Pd_2diff+Ps_2diff+Pd_1Hdiff+Ps_1Hdiff+Pd_2Hdiff+Ps_2Hdiff+MCd_1diff+MCs_1diff+MCd_2diff+MCs_2diff+MCd_1Hdiff+MCs_1Hdiff+MCd_2Hdiff+MCs_2Hdiff+Cd_1diff+Cs_1diff+Cd_2diff+Cs_2diff+Cd_1Hdiff+Cs_1Hdiff+Cd_2Hdiff+Cs_2Hdiff+IGd_1diff+IGs_1diff+IGd_2diff+IGs_2diff+IGd_1Hdiff+IGs_1Hdiff+IGd_2Hdiff+IGs_2Hdiff+TRd_1diff+TRs_1diff+TRd_2diff+TRs_2diff+TRd_1Hdiff+TRs_1Hdiff+TRd_2Hdiff+TRs_2Hdiff+GId_1diff+GIs_1diff+GId_2diff+GIs_2diff+GId_1Hdiff+GIs_1Hdiff+GId_2Hdiff+GIs_2Hdiff+RPd_1diff+RPs_1diff+RPd_2diff+RPs_2diff+RPd_1Fdiff+RPs_1Fdiff+RPd_2Fdiff+RPs_2Fdiff+Fd_1diff+Fs_1diff+Fd_2diff+Fs_2diff+Fd_1Fdiff+Fs_1Fdiff+Fd_2Fdiff+Fs_2Fdiff+Rd_1diff
 +Rs_1diff+Rd_2diff+Rs_2diff+Rd_1Fd
+ iff+Rs_1Fdiff+Rd_2Fdiff+Rs_2Fdiff+Vd_1diff+Vs_1diff+Vd_2diff+Vs_2diff+Vd_1Fdiff+Vs_1Fdiff+Vd_2Fdiff+Vs_2Fdiff+VBd_1diff+VBs_1diff+VBd_2diff+VBs_2diff+VBd_1Fdiff+VBs_1Fdiff+VBd_2Fdiff+VBs_2Fdiff+Ed_1diff+Es_1diff+Ed_2diff+Es_2diff+Ed_1Fdiff+Es_1Fdiff+Ed_2Fdiff+Es_2Fdiff+COM_diff+HF_1diff+HFD_1diff+HFS_1diff+HFDI_1diff+HFSI_1diff+HFDE_1diff+HFSE_1diff+HFDS_1diff+HFSD_1diff+HFI_1diff+HFE_1diff+HFDSI_1diff+HFSDI_1diff+HFDSE_1diff+HFSDE_1diff+HF_2diff+HFD_2diff+HFS_2diff+HFDI_2diff+HFSI_2diff+HFDE_2diff+HFSE_2diff+HFDS_2diff+HFSD_2diff+HFI_2diff+HFE_2diff+HFDSI_2diff+HFSDI_2diff+HFDSE_2diff+HFSDE_2diff+HH_diff+HHE_diff+HHI_diff+HHD_diff+HHS_diff+HHDI_diff+HHSI_diff+HHDE_diff+HHSE_diff+FF_diff+FFE_diff+FFI_diff+FFD_diff+FFS_diff+FFDI_diff+FFSI_diff+FFDE_diff+FFSE_diff+HF+HFD+HFS+HFDI+HFSI+HFDE+HFSE+HFDS+HFSD+HFI_1+HFE_1+HFDSI+HFSDI+HFDSE+HFSDE+HH1IE_diff+HH1DIE_diff+HH1SIE_diff+FF1IE_diff+FF1DIE_diff+FF1SIE_diff+1IE_diff+DD1IE_diff+SS1IE_diff+HH2IE_diff+HH2DIE_diff+HH2SIE_diff+FF
 2IE_diff+FF2DIE_diff+FF2SIE_diff+2
+ IE_diff+DD2IE_diff+SS2IE_diff+DS_1diff+DS_2diff+DD_diff+DDE_diff+DDI_diff+SS_diff+SSE_diff+SSI_diff+EE_diff+II_diff+HHIE_diff+HHDIE_diff+HHSIE_diff+FFIE_diff+FFDIE_diff+FFSIE_diff+IE_diff+DDIE_diff+SSIE_diff+Pd_1rate+Ps_1rate+Pd_2rate+Ps_2rate+Pd_1Hrate+Ps_1Hrate+Pd_2Hrate+Ps_2Hrate+MCd_1rate+MCs_1rate+MCd_2rate+MCs_2rate+MCd_1Hrate+MCs_1Hrate+MCd_2Hrate+MCs_2Hrate+Cd_1rate+Cs_1rate+Cd_2rate+Cs_2rate+Cd_1Hrate+Cs_1Hrate+Cd_2Hrate+Cs_2Hrate+IGd_1rate+IGs_1rate+IGd_2rate+IGs_2rate+IGd_1Hrate+IGs_1Hrate+IGd_2Hrate+IGs_2Hrate+TRd_1rate+TRs_1rate+TRd_2rate+TRs_2rate+TRd_1Hrate+TRs_1Hrate+TRd_2Hrate+TRs_2Hrate+GId_1rate+GIs_1rate+GId_2rate+GIs_2rate+GId_1Hrate+GIs_1Hrate+GId_2Hrate+GIs_2Hrate+RPd_1rate+RPs_1rate+RPd_2rate+RPs_2rate+RPd_1Frate+RPs_1Frate+RPd_2Frate+RPs_2Frate+Fd_1rate+Fs_1rate+Fd_2rate+Fs_2rate+Fd_1Frate+Fs_1Frate+Fd_2Frate+Fs_2Frate+Rd_1rate+Rs_1rate+Rd_2rate+Rs_2rate+Rd_1Frate+Rs_1Frate+Rd_2Frate+Rs_2Frate+Vd_1rate+Vs_1rate+Vd_2rate+Vs_2rate+Vd_1Frate+Vs_1Frate+
 Vd_2Frate+Vs_2Frate+VBd_1rate+VBs_
+ 1rate+VBd_2rate+VBs_2rate+VBd_1Frate+VBs_1Frate+VBd_2Frate+VBs_2Frate+Ed_1rate+Es_1rate+Ed_2rate+Es_2rate+Ed_1Frate+Es_1Frate+Ed_2Frate+Es_2Frate+COM_rate+HF_1rate+HFD_1rate+HFS_1rate+HFDI_1rate+HFSI_1rate+HFDE_1rate+HFSE_1rate+HFDS_1rate+HFSD_1rate+HFI_1rate+HFE_1rate+HFDSI_1rate+HFSDI_1rate+HFDSE_1rate+HFSDE_1rate+HF_2rate+HFD_2rate+HFS_2rate+HFDI_2rate+HFSI_2rate+HFDE_2rate+HFSE_2rate+HFDS_2rate+HFSD_2rate+HFI_2rate+HFE_2rate+HFDSI_2rate+HFSDI_2rate+HFDSE_2rate+HFSDE_2rate+HH_rate+HHE_rate+HHI_rate+HHD_rate+HHS_rate+HHDI_rate+HHSI_rate+HHDE_rate+HHSE_rate+FF_rate+FFE_rate+FFI_rate+FFD_rate+FFS_rate+FFDI_rate+FFSI_rate+FFDE_rate+FFSE_rate+HF+HFD+HFS+HFDI+HFSI+HFDE+HFSE+HFDS+HFSD+HFI_1+HFE_1+HFDSI+HFSDI+HFDSE+HFSDE+HH1IE_rate+HH1DIE_rate+HH1SIE_rate+FF1IE_rate+FF1DIE_rate+FF1SIE_rate+1IE_rate+DD1IE_rate+SS1IE_rate+HH2IE_rate+HH2DIE_rate+HH2SIE_rate+FF2IE_rate+FF2DIE_rate+FF2SIE_rate+2IE_rate+DD2IE_rate+SS2IE_rate+DS_1rate+DS_2rate+DD_rate+DDE_rate+DDI_rate+SS_rate+SSE_rate
 +SSI_rate+EE_rate+II_rate+HHIE_rat
+ e+HHDIE_rate+HHSIE_rate+FFIE_rate+FFDIE_rate+FFSIE_rate+IE_rate+DDIE_rate+SSIE_rate")
&#206;&#248;&#232;&#225;&#234;&#224; &#226; parse(text = x) : 
  &#237;&#229;&#238;&#230;&#232;&#228;&#224;&#237;&#237;&#251;&#233;
&#241;&#232;&#236;&#226;&#238;&#235; &#226;
"n+H2E_median+H2I_median+H2D_median+H2DI_median+H2DE_median+H2S_median+H2SI_median+H2SE_median+F2_median+F2I_median+F2E_median+F2D_median+F2DI_median+F2DE_median+F2S_median+F2SI_median+F2SE_median+1I_median"
> 
BTW: "n+H2E_median+H..." starts on position 512


From timh at insightful.com  Thu Mar  6 18:45:16 2008
From: timh at insightful.com (timh at insightful.com)
Date: Thu,  6 Mar 2008 18:45:16 +0100 (CET)
Subject: [Rd] apply(x, 2,
	mean) fails if x is a data frame containing a matrix (PR#10902)
Message-ID: <20080306174516.9186C282EFF6@mail.pubhealth.ku.dk>

> data <- data.frame(a=1:5, b=I(matrix(6:15,5)))
> apply(data, 2, mean)
Error in dim(newX) <- c(prod(d.call), d2) : 
  dims [product 10] do not match the length of object [15]


--please do not edit the information below--

Version:
 platform = i386-pc-mingw32
 arch = i386
 os = mingw32
 system = i386, mingw32
 status = 
 major = 2
 minor = 6.2
 year = 2008
 month = 02
 day = 08
 svn rev = 44383
 language = R
 version.string = R version 2.6.2 (2008-02-08)

Windows XP (build 2600) Service Pack 2

Locale:
LC_COLLATE=English_United States.1252;LC_CTYPE=English_United States.1252;LC_MONETARY=English_United States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252

Search Path:
 .GlobalEnv, package:stats, package:graphics, package:grDevices, package:utils, package:datasets, package:methods, Autoloads, package:base


From murdoch at stats.uwo.ca  Thu Mar  6 18:59:06 2008
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Thu, 06 Mar 2008 12:59:06 -0500
Subject: [Rd] parser failed on correct formula (PR#10901)
In-Reply-To: <20080306172509.DEDD6282EFF6@mail.pubhealth.ku.dk>
References: <20080306172509.DEDD6282EFF6@mail.pubhealth.ku.dk>
Message-ID: <47D030EA.7000802@stats.uwo.ca>

On 3/6/2008 12:25 PM, revitalyr at yandex.ru wrote:
> Full_Name: Vitaly Reshetyuk
> Version: 2.6.2
> OS: Windows XP SP2
> Submission from: (NULL) (92.112.140.118)

I don't know if your message got messed up on posting, but that 
certainly isn't a legal formula.  It contains a line break in the middle 
of the name "Rd_1Fdiff" at the end of the second line.

If you post it again, could you please insert enough line breaks by hand 
so the lines aren't so wide?  Or if the wide lines are necessary to 
trigger the "bug", code to generate the text (e.g. using paste( , 
collapse="+") would be a lot easier to work with.

Duncan Murdoch

> 
>> as.formula ("Something~
> Ps_1+GIs_1+Es_1+RPs_1+Cs_1+IGs_1+Vs_1+Rs_1+MCs_1+TRs_1+VBs_1+Fs_1+Pd_1+GId_1+Ed_1+RPd_1+Cd_1+IGd_1+Vd_1+Rd_1+MCd_1+TRd_1+VBd_1+Fd_1+Ps_2+GIs_2+Es_2+RPs_2+Cs_2+IGs_2+Vs_2+Rs_2+MCs_2+TRs_2+VBs_2+Fs_2+Pd_2+GId_2+Ed_2+RPd_2+Cd_2+IGd_2+Vd_2+Rd_2+MCd_2+TRd_2+VBd_2+Fd_2+COM1_median+H1_median+H1E_median+H1I_median+H1D_median+H1DI_median+H1DE_median+H1S_median+H1SI_median+H1SE_median+F1_median+F1I_median+F1E_median+F1D_median+F1DI_median+F1DE_median+F1S_median+F1SI_median+F1SE_median+COM2_median+H2_median+H2E_median+H2I_median+H2D_median+H2DI_median+H2DE_median+H2S_median+H2SI_median+H2SE_median+F2_median+F2I_median+F2E_median+F2D_median+F2DI_median+F2DE_median+F2S_median+F2SI_median+F2SE_median+1I_median+D1I_median+S1I_median+2I_median+D2I_median+S2I_median+D1_median+S1_median+D2_median+S2_median+1E_median+D1E_median+S1E_median+2E_median+D2E_median+S2E_median+MCOM1_mean+MH1_mean+MH1D_mean+MH1DI_mean+MH1DE_mean+MH1S_mean+MH1SI_mean+MH1SE_mean+MF1_mean+MF1D_mean+MF1DI_mean+MF1DE_mea
n+M
>  F1S_mean
> + +MF1SI_mean+MF1SE_mean+MCOM2_mean+MH2_mean+MH2D_mean+MH2DI_mean+MH2DE_mean+MH2S_mean+MH2SI_mean+MH2SE_mean+MF2_mean+MF2D_mean+MF2DI_mean+MF2DE_mean+MF2S_mean+MF2SI_mean+MF2SE_mean+M1I_mean+MD1I_mean+MS1I_mean+M2I_mean+MD2I_mean+MS2I_mean+MD1_mean+MS1_mean+MD2_mean+MS2_mean+M1E_mean+MD1E_mean+MS1E_mean+M2E_mean+MD2E_mean+MS2E_mean+Pd_1diff+Ps_1diff+Pd_2diff+Ps_2diff+Pd_1Hdiff+Ps_1Hdiff+Pd_2Hdiff+Ps_2Hdiff+MCd_1diff+MCs_1diff+MCd_2diff+MCs_2diff+MCd_1Hdiff+MCs_1Hdiff+MCd_2Hdiff+MCs_2Hdiff+Cd_1diff+Cs_1diff+Cd_2diff+Cs_2diff+Cd_1Hdiff+Cs_1Hdiff+Cd_2Hdiff+Cs_2Hdiff+IGd_1diff+IGs_1diff+IGd_2diff+IGs_2diff+IGd_1Hdiff+IGs_1Hdiff+IGd_2Hdiff+IGs_2Hdiff+TRd_1diff+TRs_1diff+TRd_2diff+TRs_2diff+TRd_1Hdiff+TRs_1Hdiff+TRd_2Hdiff+TRs_2Hdiff+GId_1diff+GIs_1diff+GId_2diff+GIs_2diff+GId_1Hdiff+GIs_1Hdiff+GId_2Hdiff+GIs_2Hdiff+RPd_1diff+RPs_1diff+RPd_2diff+RPs_2diff+RPd_1Fdiff+RPs_1Fdiff+RPd_2Fdiff+RPs_2Fdiff+Fd_1diff+Fs_1diff+Fd_2diff+Fs_2diff+Fd_1Fdiff+Fs_1Fdiff+Fd_2Fdiff+Fs_2Fdiff+Rd_1d
iff
>  +Rs_1diff+Rd_2diff+Rs_2diff+Rd_1Fd
> + iff+Rs_1Fdiff+Rd_2Fdiff+Rs_2Fdiff+Vd_1diff+Vs_1diff+Vd_2diff+Vs_2diff+Vd_1Fdiff+Vs_1Fdiff+Vd_2Fdiff+Vs_2Fdiff+VBd_1diff+VBs_1diff+VBd_2diff+VBs_2diff+VBd_1Fdiff+VBs_1Fdiff+VBd_2Fdiff+VBs_2Fdiff+Ed_1diff+Es_1diff+Ed_2diff+Es_2diff+Ed_1Fdiff+Es_1Fdiff+Ed_2Fdiff+Es_2Fdiff+COM_diff+HF_1diff+HFD_1diff+HFS_1diff+HFDI_1diff+HFSI_1diff+HFDE_1diff+HFSE_1diff+HFDS_1diff+HFSD_1diff+HFI_1diff+HFE_1diff+HFDSI_1diff+HFSDI_1diff+HFDSE_1diff+HFSDE_1diff+HF_2diff+HFD_2diff+HFS_2diff+HFDI_2diff+HFSI_2diff+HFDE_2diff+HFSE_2diff+HFDS_2diff+HFSD_2diff+HFI_2diff+HFE_2diff+HFDSI_2diff+HFSDI_2diff+HFDSE_2diff+HFSDE_2diff+HH_diff+HHE_diff+HHI_diff+HHD_diff+HHS_diff+HHDI_diff+HHSI_diff+HHDE_diff+HHSE_diff+FF_diff+FFE_diff+FFI_diff+FFD_diff+FFS_diff+FFDI_diff+FFSI_diff+FFDE_diff+FFSE_diff+HF+HFD+HFS+HFDI+HFSI+HFDE+HFSE+HFDS+HFSD+HFI_1+HFE_1+HFDSI+HFSDI+HFDSE+HFSDE+HH1IE_diff+HH1DIE_diff+HH1SIE_diff+FF1IE_diff+FF1DIE_diff+FF1SIE_diff+1IE_diff+DD1IE_diff+SS1IE_diff+HH2IE_diff+HH2DIE_diff+HH2SIE_diff
+FF
>  2IE_diff+FF2DIE_diff+FF2SIE_diff+2
> + IE_diff+DD2IE_diff+SS2IE_diff+DS_1diff+DS_2diff+DD_diff+DDE_diff+DDI_diff+SS_diff+SSE_diff+SSI_diff+EE_diff+II_diff+HHIE_diff+HHDIE_diff+HHSIE_diff+FFIE_diff+FFDIE_diff+FFSIE_diff+IE_diff+DDIE_diff+SSIE_diff+Pd_1rate+Ps_1rate+Pd_2rate+Ps_2rate+Pd_1Hrate+Ps_1Hrate+Pd_2Hrate+Ps_2Hrate+MCd_1rate+MCs_1rate+MCd_2rate+MCs_2rate+MCd_1Hrate+MCs_1Hrate+MCd_2Hrate+MCs_2Hrate+Cd_1rate+Cs_1rate+Cd_2rate+Cs_2rate+Cd_1Hrate+Cs_1Hrate+Cd_2Hrate+Cs_2Hrate+IGd_1rate+IGs_1rate+IGd_2rate+IGs_2rate+IGd_1Hrate+IGs_1Hrate+IGd_2Hrate+IGs_2Hrate+TRd_1rate+TRs_1rate+TRd_2rate+TRs_2rate+TRd_1Hrate+TRs_1Hrate+TRd_2Hrate+TRs_2Hrate+GId_1rate+GIs_1rate+GId_2rate+GIs_2rate+GId_1Hrate+GIs_1Hrate+GId_2Hrate+GIs_2Hrate+RPd_1rate+RPs_1rate+RPd_2rate+RPs_2rate+RPd_1Frate+RPs_1Frate+RPd_2Frate+RPs_2Frate+Fd_1rate+Fs_1rate+Fd_2rate+Fs_2rate+Fd_1Frate+Fs_1Frate+Fd_2Frate+Fs_2Frate+Rd_1rate+Rs_1rate+Rd_2rate+Rs_2rate+Rd_1Frate+Rs_1Frate+Rd_2Frate+Rs_2Frate+Vd_1rate+Vs_1rate+Vd_2rate+Vs_2rate+Vd_1Frate+Vs_1Fra
te+
>  Vd_2Frate+Vs_2Frate+VBd_1rate+VBs_
> + 1rate+VBd_2rate+VBs_2rate+VBd_1Frate+VBs_1Frate+VBd_2Frate+VBs_2Frate+Ed_1rate+Es_1rate+Ed_2rate+Es_2rate+Ed_1Frate+Es_1Frate+Ed_2Frate+Es_2Frate+COM_rate+HF_1rate+HFD_1rate+HFS_1rate+HFDI_1rate+HFSI_1rate+HFDE_1rate+HFSE_1rate+HFDS_1rate+HFSD_1rate+HFI_1rate+HFE_1rate+HFDSI_1rate+HFSDI_1rate+HFDSE_1rate+HFSDE_1rate+HF_2rate+HFD_2rate+HFS_2rate+HFDI_2rate+HFSI_2rate+HFDE_2rate+HFSE_2rate+HFDS_2rate+HFSD_2rate+HFI_2rate+HFE_2rate+HFDSI_2rate+HFSDI_2rate+HFDSE_2rate+HFSDE_2rate+HH_rate+HHE_rate+HHI_rate+HHD_rate+HHS_rate+HHDI_rate+HHSI_rate+HHDE_rate+HHSE_rate+FF_rate+FFE_rate+FFI_rate+FFD_rate+FFS_rate+FFDI_rate+FFSI_rate+FFDE_rate+FFSE_rate+HF+HFD+HFS+HFDI+HFSI+HFDE+HFSE+HFDS+HFSD+HFI_1+HFE_1+HFDSI+HFSDI+HFDSE+HFSDE+HH1IE_rate+HH1DIE_rate+HH1SIE_rate+FF1IE_rate+FF1DIE_rate+FF1SIE_rate+1IE_rate+DD1IE_rate+SS1IE_rate+HH2IE_rate+HH2DIE_rate+HH2SIE_rate+FF2IE_rate+FF2DIE_rate+FF2SIE_rate+2IE_rate+DD2IE_rate+SS2IE_rate+DS_1rate+DS_2rate+DD_rate+DDE_rate+DDI_rate+SS_rate+SSE_r
ate
>  +SSI_rate+EE_rate+II_rate+HHIE_rat
> + e+HHDIE_rate+HHSIE_rate+FFIE_rate+FFDIE_rate+FFSIE_rate+IE_rate+DDIE_rate+SSIE_rate")
> &#206;&#248;&#232;&#225;&#234;&#224; &#226; parse(text = x) : 
>   &#237;&#229;&#238;&#230;&#232;&#228;&#224;&#237;&#237;&#251;&#233;
> &#241;&#232;&#236;&#226;&#238;&#235; &#226;
> "n+H2E_median+H2I_median+H2D_median+H2DI_median+H2DE_median+H2S_median+H2SI_median+H2SE_median+F2_median+F2I_median+F2E_median+F2D_median+F2DI_median+F2DE_median+F2S_median+F2SI_median+F2SE_median+1I_median"
>> 
> BTW: "n+H2E_median+H..." starts on position 512
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From bosap at metro.dst.or.us  Thu Mar  6 19:10:08 2008
From: bosap at metro.dst.or.us (bosap at metro.dst.or.us)
Date: Thu,  6 Mar 2008 19:10:08 +0100 (CET)
Subject: [Rd] Memory allocation error in 2.6.2 (PR#10903)
Message-ID: <20080306181008.59C34282EFF6@mail.pubhealth.ku.dk>

Full_Name: Peter Bosa
Version: 2.6.2
OS: RHES 4.2 - 4.5
Submission from: (NULL) (67.138.101.226)


I am experiencing a memory allocation error with R 2.6.2 which was not present
in previous versions of R (2.4 and 2.2). I have several Linux machines with
various Redhat OS versions loaded on them, ranging from 4.2 through 4.5. Each
machine has 6 GB of RAM and 2 to 4 GB of virtual memory.

The processes I am running include calculations on large matrices (1,015 x
2,029). While the programs are large users of memory, they were stable (i.e. no
memory crashes with the earlier versions of R) on all machines. However, running
the same programs using R 2.6.2, I consistently get the error message "Cannot
allocate vector of size 15.7kb". I am calling the programs with the
--max-vsize=3G command...no difference. Using a garbage collection command, I
can see that the programs never use more heap than 2.5 GB. And, as stated
before, this was not an issue when the same machines were loaded with R 2.4 or
2.2.

I have verified that the OS settings are exactly the same as before (unlimited
allocation of memory to programs). Also, when I re-install R 2.4, the programs
run correctly. I have not been able to test R 2.5 or R 2.6.0, since I cannot
find binary packages of these versions, and I have yet to compile the source
code.

Any thoughts?


From hb at stat.berkeley.edu  Thu Mar  6 20:38:40 2008
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Thu, 6 Mar 2008 11:38:40 -0800
Subject: [Rd] Memory allocation error in 2.6.2 (PR#10903)
In-Reply-To: <20080306181008.59C34282EFF6@mail.pubhealth.ku.dk>
References: <20080306181008.59C34282EFF6@mail.pubhealth.ku.dk>
Message-ID: <59d7961d0803061138r524a308ancadf5b2990bbc349@mail.gmail.com>

Before submitting a bug report, it is probably wise to bring it up on
r-devel first.  Remember, someone has to clean out all those false bug
reports manually.

There are so many potential reasons for your problem, which indicates
fragmented memory allocations.  One obvious one is that one of the
packages you are using have been updated.  In order for anyone to say
anything about your problem, the minimum you can do is post your
sessionInfo():s.  Then maybe one of the authors of those packages
reads this and know exactly what is going on.  Also, some kind of
script is also useful, because maybe it is obvious from your code.
You might simply have "been lucky" in previously.

My $0.02

/Henrik


On Thu, Mar 6, 2008 at 10:10 AM,  <bosap at metro.dst.or.us> wrote:
> Full_Name: Peter Bosa
>  Version: 2.6.2
>  OS: RHES 4.2 - 4.5
>  Submission from: (NULL) (67.138.101.226)
>
>
>  I am experiencing a memory allocation error with R 2.6.2 which was not present
>  in previous versions of R (2.4 and 2.2). I have several Linux machines with
>  various Redhat OS versions loaded on them, ranging from 4.2 through 4.5. Each
>  machine has 6 GB of RAM and 2 to 4 GB of virtual memory.
>
>  The processes I am running include calculations on large matrices (1,015 x
>  2,029). While the programs are large users of memory, they were stable (i.e. no
>  memory crashes with the earlier versions of R) on all machines. However, running
>  the same programs using R 2.6.2, I consistently get the error message "Cannot
>  allocate vector of size 15.7kb". I am calling the programs with the
>  --max-vsize=3G command...no difference. Using a garbage collection command, I
>  can see that the programs never use more heap than 2.5 GB. And, as stated
>  before, this was not an issue when the same machines were loaded with R 2.4 or
>  2.2.
>
>  I have verified that the OS settings are exactly the same as before (unlimited
>  allocation of memory to programs). Also, when I re-install R 2.4, the programs
>  run correctly. I have not been able to test R 2.5 or R 2.6.0, since I cannot
>  find binary packages of these versions, and I have yet to compile the source
>  code.
>
>  Any thoughts?
>
>  ______________________________________________
>  R-devel at r-project.org mailing list
>  https://stat.ethz.ch/mailman/listinfo/r-devel
>


From hb at stat.berkeley.edu  Thu Mar  6 21:12:59 2008
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Thu, 6 Mar 2008 12:12:59 -0800
Subject: [Rd] Argument "nomatch" matched by multiple actual arguments
	... %in% -> match?!?
In-Reply-To: <59d7961d0803060227o44eae581m385bf8168b1b56d4@mail.gmail.com>
References: <59d7961d0803060227o44eae581m385bf8168b1b56d4@mail.gmail.com>
Message-ID: <59d7961d0803061212v41934cccoad9b5b5a1ab56cfa@mail.gmail.com>

Hi,

a follow up.  If I replace all 'foo %in% bar' in setMethodS3.default()
with is.element(foo, bar) the error goes away.  Here is is.element():

> is.element
function (el, set)
match(el, set, 0) > 0
<environment: namespace:base>

Not much of a difference compared to "%in%"(),

> get("%in%")
function (x, table)
match(x, table, nomatch = 0) > 0
<environment: namespace:base>

except that the 'nomatch' argument is not named in is.element().
Also, none of calls used variable names 'x', 'table', 'el', 'set', or
'nomatch'.

/Henrik

On Thu, Mar 6, 2008 at 2:27 AM, Henrik Bengtsson <hb at stat.berkeley.edu> wrote:
> When I run R CMD check R.oo on R v2.7.0 devel (2008-03-04 r44677) on
>  WinXP I get the following error while testing examples:
>
>  Error in match(x, table, nomatch = 0) :
>   formal argument "nomatch" matched by multiple actual arguments
>  Calls: setMethodS3 -> setMethodS3.default -> %in% -> match
>  Execution halted
>
>  How is that even possible with:
>
>  > get("%in%")
>  function (x, table)
>  match(x, table, nomatch = 0) > 0
>  <environment: namespace:base>
>
>  All '%in' statements in setMethodS3.default are of kind (foo %in%
>  bar).   The error does not happen if I run the example(Object)
>  explicitly.
>
>  /Henrik
>


From Vic.Bancroft at Choicepoint.Com  Thu Mar  6 22:55:07 2008
From: Vic.Bancroft at Choicepoint.Com (Vic.Bancroft at Choicepoint.Com)
Date: Thu,  6 Mar 2008 22:55:07 +0100 (CET)
Subject: [Rd] javareconf (PR#10905)
Message-ID: <20080306215507.22BB6282EFF6@mail.pubhealth.ku.dk>

Full_Name: Vic.Bancroft
Version: 2.6.2
OS: Red Hat Enterprise Linux ES release 4 (Nahant Update 6)
Submission from: (NULL) (66.241.32.158)


Running the script, javareconf, output intended for /dev/null is generating an
error . . . 

Here is a patch for the java reconfiguration shell script,

Index: src/scripts/javareconf
===================================================================
--- src/scripts/javareconf      (revision 44691)
+++ src/scripts/javareconf      (working copy)
@@ -230,7 +230,7 @@
            done
            if test -z "${jmdinc}"; then
              # ultima-ratio: use find and pray that it works
-             jmdinc=`find "${jinc}/" -name jni_md.h 2>dev/null |head -n 1
2>/dev/null`
+             jmdinc=`find "${jinc}/" -name jni_md.h 2>/dev/null |head -n 1
2>/dev/null`
              if test -n "${jmdinc}"; then jmdinc=`dirname "${jmdinc}"`; fi
            fi
            if test -n "${jmdinc}"; then


From cgenolin at u-paris10.fr  Thu Mar  6 23:37:24 2008
From: cgenolin at u-paris10.fr (Christophe Genolini)
Date: Thu, 6 Mar 2008 14:37:24 -0800 (PST)
Subject: [Rd] Great tool
In-Reply-To: <971536df0801211003xfcb3004pff0cddfa31f83a85@mail.gmail.com>
References: <59d7961d0801202002l1cc15962xe6a2f623d52ccd05@mail.gmail.com>
	<971536df0801202019o5f5b63b4td2c58a1d3717c98e@mail.gmail.com>
	<Pine.LNX.4.64.0801210936540.10823@tajo.ucsd.edu>
	<971536df0801211003xfcb3004pff0cddfa31f83a85@mail.gmail.com>
Message-ID: <15885369.post@talk.nabble.com>


I believe that codetools is "incredibly usefull", but it is very difficult to
learn how to use it...
Anythink else thant reading the code available ?

For exemple, how to track down free varaible ? I try

findGlobals(get(functionNames),FALSE)$variables

but it does not work...

Christophe


Gabor Grothendieck wrote:
> 
> Tracking down the free variables in a function when
> reworking old code.
> 
> On Jan 21, 2008 12:41 PM, Charles C. Berry <cberry at tajo.ucsd.edu> wrote:
>> On Sun, 20 Jan 2008, Gabor Grothendieck wrote:
>>
>> > I agree.  Its incredibly useful.
>>
>> OK gentlemen, you have piqued my curiosity.
>>
>> Can you give an example or two of situations you encountered in which a
>> codetools function was so helpful?
>>
>> Chuck
>>
>>
>>
>> >
>> > On Jan 20, 2008 11:02 PM, Henrik Bengtsson <hb at stat.berkeley.edu>
>> wrote:
>> >> Hi,
>> >>
>> >> I just have drop a note to say that the 'codetools' (and the part of R
>> >> CMD check that use it) is a pleasure to use and saves me from hours of
>> >> troubleshooting.  Each time it finds something I am amazed how
>> >> accurate it is.  Thanks to Luke T. and everyone else involved in
>> >> creating it.
>> >>
>> >> Cheers,
>> >>
>> >> Henrik
>> >>
>> >> ______________________________________________
>> >> R-devel at r-project.org mailing list
>> >> https://stat.ethz.ch/mailman/listinfo/r-devel
>> >>
>> >
>> > ______________________________________________
>> > R-devel at r-project.org mailing list
>> > https://stat.ethz.ch/mailman/listinfo/r-devel
>> >
>>
>> Charles C. Berry                            (858) 534-2098
>>                                             Dept of Family/Preventive
>> Medicine
>> E mailto:cberry at tajo.ucsd.edu               UC San Diego
>> http://famprevmed.ucsd.edu/faculty/cberry/  La Jolla, San Diego
>> 92093-0901
>>
>>
>>
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 

-- 
View this message in context: http://www.nabble.com/Great-tool-tp14990920p15885369.html
Sent from the R devel mailing list archive at Nabble.com.


From Royomopito at nchecr.unsw.edu.au  Fri Mar  7 03:35:13 2008
From: Royomopito at nchecr.unsw.edu.au (Royomopito at nchecr.unsw.edu.au)
Date: Fri,  7 Mar 2008 03:35:13 +0100 (CET)
Subject: [Rd] Installing latest version under Windows (PR#10908)
Message-ID: <20080307023514.9137D282EFF0@mail.pubhealth.ku.dk>

Dear Debuggers,

=20

I'm trying to install R for the first time, however, the exe file
referred to does not exist: Installation is via the installer
R-2.6.2-win32.exe

=20

I've downloaded R several times and the file does not exist.

=20

I've tried renaming Rgui.exe.manifest and Rterm.exe.manifest to have
only the .exe extension and but this doesn't work.=20

=20

What are your suggestions?

=20

Regards

=20

Rebecca


3 Installing R under Windows


The bin/windows directory of a CRAN site contains binaries for a base
distribution and a large number of add-on packages from CRAN to run on
Windows 95, 98, NT4, 2000, ME, XP, 2003 Server and Vista (at least) on
Intel x86 and clones (including AMD64/EM64T chips and Windows x64).=20

Your file system must allow long file names (as is likely except perhaps
for some network-mounted systems).=20

Installation is via the installer R-2.6.2-win32.exe. Just double-click
on the icon and follow the instructions. You can uninstall R from the
Control Panel. (Note that you will probably (depending on the Windows
language settings) be asked to choose a language for installation, and
that choice applies to both installation and un-installation but not to
running R itself.)=20

See the R Windows FAQ
<http://CRAN.R-project.org/bin/windows/base/rw-FAQ.html>  for more
details.=20

=20

__________________________________________________



Rebecca Oyomopito [royomopito at nchecr.unsw.edu.au]
TASER Surveillance and Monitoring Study Coordinator=20
Biostatistics and Databases Program
National Centre in HIV Epidemiology and Clinical Research (NCHECR)
The University of New South Wales
376 Victoria Street Sydney NSW  2010 AUSTRALIA
Phone: + 61 (0) 2 9385 0900
Fax:     + 61 (0) 2 9385 0920
http://web.med.unsw.edu.au/nchecr/




	[[alternative HTML version deleted]]


From murdoch at stats.uwo.ca  Fri Mar  7 14:59:17 2008
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Fri, 07 Mar 2008 08:59:17 -0500
Subject: [Rd] Installing latest version under Windows (PR#10908)
In-Reply-To: <20080307023514.9137D282EFF0@mail.pubhealth.ku.dk>
References: <20080307023514.9137D282EFF0@mail.pubhealth.ku.dk>
Message-ID: <47D14A35.8070707@stats.uwo.ca>

On 3/6/2008 9:35 PM, Royomopito at nchecr.unsw.edu.au wrote:
> Dear Debuggers,
> 
> =20
> 
> I'm trying to install R for the first time, however, the exe file
> referred to does not exist: Installation is via the installer
> R-2.6.2-win32.exe
> 
> =20
> 
> I've downloaded R several times and the file does not exist.

This statement doesn't make sense.  Either you downloaded it and it does 
exist, or it does not exist because you failed to download it.

What URL are you using?  I see that file at

http://cran.r-project.org/bin/windows/base/R-2.6.2-win32.exe

Is that what you're downloading?

Duncan Murdoch

> 
> =20
> 
> I've tried renaming Rgui.exe.manifest and Rterm.exe.manifest to have
> only the .exe extension and but this doesn't work.=20
> 
> =20
> 
> What are your suggestions?
> 
> =20
> 
> Regards
> 
> =20
> 
> Rebecca
> 
> 
> 3 Installing R under Windows
> 
> 
> The bin/windows directory of a CRAN site contains binaries for a base
> distribution and a large number of add-on packages from CRAN to run on
> Windows 95, 98, NT4, 2000, ME, XP, 2003 Server and Vista (at least) on
> Intel x86 and clones (including AMD64/EM64T chips and Windows x64).=20
> 
> Your file system must allow long file names (as is likely except perhaps
> for some network-mounted systems).=20
> 
> Installation is via the installer R-2.6.2-win32.exe. Just double-click
> on the icon and follow the instructions. You can uninstall R from the
> Control Panel. (Note that you will probably (depending on the Windows
> language settings) be asked to choose a language for installation, and
> that choice applies to both installation and un-installation but not to
> running R itself.)=20
> 
> See the R Windows FAQ
> <http://CRAN.R-project.org/bin/windows/base/rw-FAQ.html>  for more
> details.=20
> 
> =20
> 
> __________________________________________________
> 
> 
> 
> Rebecca Oyomopito [royomopito at nchecr.unsw.edu.au]
> TASER Surveillance and Monitoring Study Coordinator=20
> Biostatistics and Databases Program
> National Centre in HIV Epidemiology and Clinical Research (NCHECR)
> The University of New South Wales
> 376 Victoria Street Sydney NSW  2010 AUSTRALIA
> Phone: + 61 (0) 2 9385 0900
> Fax:     + 61 (0) 2 9385 0920
> http://web.med.unsw.edu.au/nchecr/
> 
> 
> 
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From maechler at stat.math.ethz.ch  Fri Mar  7 15:01:26 2008
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Fri, 7 Mar 2008 15:01:26 +0100
Subject: [Rd] NA warnings for r<distr>() {aka "patch for random.c"}
In-Reply-To: <20080305202624.7f1c54ea@berwin-nus1>
References: <20080229181940.457c9bf7@berwin-nus1>
	<18379.49661.242974.779574@stat.math.ethz.ch>
	<20080305202624.7f1c54ea@berwin-nus1>
Message-ID: <18385.19126.4852.755058@stat.math.ethz.ch>

Hi Berwin (and "listeners"),

>>>>> "BAT" == Berwin A Turlach <statba at nus.edu.sg>
>>>>>     on Wed, 5 Mar 2008 20:26:24 +0800 writes:

    BAT> G'day Martin, On Mon, 3 Mar 2008 10:16:45 +0100 Martin
    BAT> Maechler <maechler at stat.math.ethz.ch> wrote:

    >> >>>>> "BAT" == Berwin A Turlach <statba at nus.edu.sg> >>>>>
    >> on Fri, 29 Feb 2008 18:19:40 +0800 writes:
    >> 
    BAT> while looking for some inspiration of how to organise
    BAT> some code, I studied the code of random.c and noticed
    BAT> that for distributions with 2 or 3 parameters the user
    BAT> is not warned if NAs are created while such a warning
    BAT> is issued for distributions with 1 parameter. [...] The
    BAT> attached patch rectifies this.  [...]
    >> 
    >> I cannot imagine a design reason for that.  If there was,
    >> it should have been mentioned as a comment in the C code.
    >> 
    >> I'll commit your patch (if it passes the checks).

    BAT> Sorry, I was a bit in a hurry when writing the e-mail,
    BAT> so I forgot to mention that the source code modified by
    BAT> this patch compiles and passes "make check FORCE=FORCE"
    BAT> on my machine.

ok.

    BAT> And in my hurry, I also posted from my NUS account,
    BAT> without realising it, which forced you to intervene as
    BAT> moderator and to approve the posting.  My apologies for
    BAT> the extra work.  But this gave me the idea to also
    BAT> subscribe to r-devel with my NUS account and configure
    BAT> the subscriptions so that I only receive e-mail at my
    BAT> UWA account.  Thus, hopefully, you will not have to
    BAT> intervene again.  (Which this e-mail should test.)

(and it succeeded)
 
    BAT> BTW, there are other places in the code were NAs can be
    BAT> created but no warning is issued.  E.g:
    >> 
    >> >> rexp(2, rate=numeric())
    BAT> [1] NA NA
    >> >> rnorm(2, mean=numeric())
    BAT> [1] NA NA
    >> 
    BAT> I wonder whether a warning should be issued in this
    BAT> case too.
    >> 
    >> Yes, "should in principle".
    >> 
    >> If you feel like finding another elegant patch...

    BAT> Well, elegance is in the eye of the beholder. :-) 

    BAT> I attach two patches.  One that adds warning messages at
    BAT> the other places where NAs can be generated.

ok. The result is very simple ``hence elegant''.

But actually, part of the changed behavior may be considered
undesirable:

  rnorm(2, mean = NA)

which gives two NaN's  would now produce a warning,
where I could argue that 
   'arithmetic with NAs should give NAs without a warning'
since
  1:2 + NA
also gives NAs without a warning.

So we could argue that a warning should *only* be produced in a
case where the parameters of the distribution are not NA.

What do others (particularly R-core !) think?

    BAT> The second one in additiona rearranges the code a bit
    BAT> such that in the case when all the "vectors" that
    BAT> contain the parameter values of the distribution, from
    BAT> which one wants to simulate, are of length one some
    BAT> unnecessary calculations is taken out of the for loop.

    BAT> I am not sure how much time is actually saved in this
    BAT> situation, but I belong to the school that things such
    BAT> kind of optimisation should be done. :) 

I understand, but I think most of R-core are "from the school" 
that teaches
     "if you want to optimize, first *measure*"

    BAT> If you think it bloats the code too much (or duplicates
    BAT> things too much leading to hard to maintain code), then
    BAT> feel free to ignore this second patch.

For now, I will ignore this second patch.

 - it does bloat the code slightly  (as you conceded)
 - it uses an if(<Simple>) test which makes the code slightly
   *slower* for the (probably rare) case when the <Simple> is false.

but most importantly:

 - we have no idea if the speedup (when <Simple> is TRUE)
   is in the order of  10%, 1% or 0.1%
 
   My guess would be '0.1%' for rnorm(), and that would
   definitely not warrant the extra check.

    >> Thank you Berwin, for your contribution!

and thanks again!
Martin

    BAT> My pleasure.

    BAT> Cheers,
    BAT> 	Berwin


From statba at nus.edu.sg  Fri Mar  7 16:54:06 2008
From: statba at nus.edu.sg (Berwin A Turlach)
Date: Fri, 7 Mar 2008 23:54:06 +0800
Subject: [Rd] NA warnings for r<distr>() {aka "patch for random.c"}
In-Reply-To: <18385.19126.4852.755058@stat.math.ethz.ch>
References: <20080229181940.457c9bf7@berwin-nus1>
	<18379.49661.242974.779574@stat.math.ethz.ch>
	<20080305202624.7f1c54ea@berwin-nus1>
	<18385.19126.4852.755058@stat.math.ethz.ch>
Message-ID: <20080307235406.21f5649b@absentia>

G'day Martin (and "listeners"),

On Fri, 7 Mar 2008 15:01:26 +0100
Martin Maechler <maechler at stat.math.ethz.ch> wrote:

[...]
>     >> If you feel like finding another elegant patch...
> 
>     BAT> Well, elegance is in the eye of the beholder. :-) 
> 
>     BAT> I attach two patches.  One that adds warning messages at
>     BAT> the other places where NAs can be generated.
> 
> ok. The result is very simple ``hence elegant''.
> 
> But actually, part of the changed behavior may be considered
> undesirable:
> 
>   rnorm(2, mean = NA)
> 
> which gives two NaN's  would now produce a warning,
> where I could argue that 
>    'arithmetic with NAs should give NAs without a warning'
> since
>   1:2 + NA
> also gives NAs without a warning.
> 
> So we could argue that a warning should *only* be produced in a
> case where the parameters of the distribution are not NA.
> 
> What do others (particularly R-core !) think?

I can agree with that point of view.  But then, should a warning not
be issued only if one of the parameters of the distribution is NA, or
should it also not be issued if any non-finite parameter is
encountered?  After all, 

> 1:2 + Inf
[1] Inf Inf

does not create any warning either.  In that case, a patch as the
attached should do, it checks all parameters for finiteness and then
checks whether the generated number is not finite.  

Thus, with the patch applied I see the following behaviour:

> rnorm(2, mean=NA)
[1] NaN NaN
> rnorm(5, mean=c(0,Inf, -Inf, NA, NaN))
[1] 1.897874      NaN      NaN      NaN      NaN
> rbinom(2, size=20, p=1.2)
[1] NaN NaN
Warning message:
In rbinom(2, size = 20, p = 1.2) : NAs produced
> rexp(2, rate=-2)
[1] NaN NaN
Warning message:
In rexp(2, rate = -2) : NAs produced


Without the patch:

> rnorm(2, mean=NA)
[1] NaN NaN
> rnorm(5, mean=c(0,Inf, -Inf, NA, NaN))
[1] -0.1719657        NaN        NaN        NaN        NaN
> rbinom(2, size=20, p=1.2)
[1] NaN NaN
> rexp(2, rate=-2)
[1] NaN NaN
Warning message:
In rexp(2, rate = -2) : NAs produced

On my machine, "make check FORCE=FORCE" passes with this patch.

[...]
> For now, I will ignore this second patch.
> 
>  - it does bloat the code slightly  (as you conceded)

Fair enough. :)  I also proved my point that more complicated code is
harder to maintain.  In the two parameter case I was testing twice na
for being one instead of testing na and nb.......

[...]
> but most importantly:
> 
>  - we have no idea if the speedup (when <Simple> is TRUE)
>    is in the order of  10%, 1% or 0.1%
>  
>    My guess would be '0.1%' for rnorm(), and that would
>    definitely not warrant the extra check.

I would not bet against this.  Probably even with all the additional
checks for finiteness of parameters there would be not much speed
difference.  The question might be whether you want to replace the
(new) R_FINITE()'s rather by ISNA()'s (or something else).  One could
also discuss in which order the checks should be made (first generated
number then parameters of distribution or vice versa).  But I will
leave this to R-core to decide. :)

>     >> Thank you Berwin, for your contribution!
> 
> and thanks again!

Still my pleasure. :)

Cheers,

	Berwin
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: R-patch4
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20080307/bdbf223b/attachment.pl 

From b.rowlingson at lancaster.ac.uk  Fri Mar  7 16:56:26 2008
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Fri, 07 Mar 2008 15:56:26 +0000
Subject: [Rd] [R] R-Logo
In-Reply-To: <20080307152120.GC26602@localdomain>
References: <mailman.15.1204887605.28313.r-help@r-project.org>	<p06002003c3f702dbc2a9@[192.168.1.10]>
	<20080307152120.GC26602@localdomain>
Message-ID: <47D165AA.6020001@lancaster.ac.uk>


[Think this is more R-devel than R-help now]

Gabor Csardi wrote:
> Jean,
> 
> this is nice, but 1) the logo is a bitmap, it is ugly if you 
> resize it, 2) you don't need a pdf version for pdflatex, it 
> handles jpg (and maybe also png as well), so you can 
> just use the logos at the R developer site. 
> 
> It would be really nice to have a non-bitmap version, though.
> If it exists.

  I was pondering this the other day, and decided to have a play at 
making a new R logo. Drawing inspiration from the original, and playing 
with the numbers 0, 1 and 2, I produced this:

http://www.maths.lancs.ac.uk/~rowlings/Graphics/Logo/R/logos.svg

[PNG version: 
http://www.maths.lancs.ac.uk/~rowlings/Graphics/Logo/R/logos.png ]

  - I think I've refined it a bit since then, but that has the basic 
idea and some examples of how it looks on different backgrounds. With a 
purely optional '3.0' power flash.

  As an SVG file it's purely vector and scalable.

  If the powers that be like it then I'll find my other versions (prob 
on my PC at home) and make them available.

Barry


From zentz at bios.unc.edu  Fri Mar  7 17:20:27 2008
From: zentz at bios.unc.edu (Scott Zentz)
Date: Fri, 07 Mar 2008 11:20:27 -0500
Subject: [Rd] Build options for R
Message-ID: <47D16B4B.3030803@bios.unc.edu>

Hello Everyone,

I had posted the message below to the r-help listserv...

 >Recently I was given a Java servlet based web calculator that will
 >call R (libR.so to be exact) but I am having trouble trying to disable R
 >from requiring --save, --no-save or --vanilla... Is there any way to
 >build R on linux and disable R from asking --save, --no-save or 
--vanilla??

I received this reply from someone...

 >If you are calling libR.so, it is an option set when you initialize R.
 >See Rf_initEmbeddedR in 'Writing R Extensions' and the examples in the 
tests/Embedded directory in the sources.
 >BTW, discussion of embedded R is definitely off topic for R-help: use 
the R-devel list.

Now my question is. Is there any way to modify the source so that I can 
force R to use the --no-save option? If so, would someone be kind enough 
to show me what code I would modify to force the --no-save option?

Thanks!

-scz


From simon.urbanek at r-project.org  Fri Mar  7 17:33:12 2008
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Fri, 7 Mar 2008 11:33:12 -0500
Subject: [Rd] Build options for R
In-Reply-To: <47D16B4B.3030803@bios.unc.edu>
References: <47D16B4B.3030803@bios.unc.edu>
Message-ID: <0AE8E805-0318-46AA-8954-DB207B58BC67@r-project.org>


On Mar 7, 2008, at 11:20 AM, Scott Zentz wrote:

> Hello Everyone,
>
> I had posted the message below to the r-help listserv...
>
>> Recently I was given a Java servlet based web calculator that will
>> call R (libR.so to be exact) but I am having trouble trying to  
>> disable R
>> from requiring --save, --no-save or --vanilla... Is there any way to
>> build R on linux and disable R from asking --save, --no-save or
> --vanilla??
>
> I received this reply from someone...
>
>> If you are calling libR.so, it is an option set when you initialize  
>> R.
>> See Rf_initEmbeddedR in 'Writing R Extensions' and the examples in  
>> the
> tests/Embedded directory in the sources.
>> BTW, discussion of embedded R is definitely off topic for R-help: use
> the R-devel list.
>
> Now my question is. Is there any way to modify the source so that I  
> can
> force R to use the --no-save option? If so, would someone be kind  
> enough
> to show me what code I would modify to force the --no-save option?
>

Simply specify it:

char *args[]={ "R", "--no-save", 0 };
Rf_initialize_R(2, args);

Cheers,
S


From bolker at zoo.ufl.edu  Fri Mar  7 20:02:02 2008
From: bolker at zoo.ufl.edu (Ben Bolker)
Date: Fri, 07 Mar 2008 14:02:02 -0500
Subject: [Rd] merging environments
Message-ID: <47D1912A.3010802@zoo.ufl.edu>


   Despite the spirited arguments of various R-core folks
who feel that mle() doesn't need a "data" argument, and
that users would be better off learning to deal with function
closures, I am *still* trying to make such things work
in a reasonably smooth fashion ...

   Is there a standard idiom for "merging" environments?
i.e., suppose a function has an environment that I want
to preserve, but _add_ the contents of a data list --
would something like this do it? Is there a less ugly
way?

x <- 0
y <- 1
z <- 2

f <- function() {
     x+y+z
}

f2 <- function(fun,data) {
     L <- ls(pos=environment(fun))
     mapply(assign,names(data),data,
                      MoreArgs=list(envir=environment(fun)))
     print(ls(pos=environment(fun)))
}

f2(f,list(a=1))


-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 252 bytes
Desc: OpenPGP digital signature
Url : https://stat.ethz.ch/pipermail/r-devel/attachments/20080307/beda69c0/attachment.bin 

From murdoch at stats.uwo.ca  Fri Mar  7 20:23:40 2008
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Fri, 07 Mar 2008 14:23:40 -0500
Subject: [Rd] merging environments
In-Reply-To: <47D1912A.3010802@zoo.ufl.edu>
References: <47D1912A.3010802@zoo.ufl.edu>
Message-ID: <47D1963C.5010503@stats.uwo.ca>

On 3/7/2008 2:02 PM, Ben Bolker wrote:
>    Despite the spirited arguments of various R-core folks
> who feel that mle() doesn't need a "data" argument, and
> that users would be better off learning to deal with function
> closures, I am *still* trying to make such things work
> in a reasonably smooth fashion ...
> 
>    Is there a standard idiom for "merging" environments?

One way is to set one as the parent of the other.  If they both already 
have non-empty parents, you're out of luck.

> i.e., suppose a function has an environment that I want
> to preserve, but _add_ the contents of a data list --
> would something like this do it? Is there a less ugly
> way?
> 
> x <- 0
> y <- 1
> z <- 2
> 
> f <- function() {
>      x+y+z
> }
> 
> f2 <- function(fun,data) {
>      L <- ls(pos=environment(fun))
>      mapply(assign,names(data),data,
>                       MoreArgs=list(envir=environment(fun)))
>      print(ls(pos=environment(fun)))
> }
> 
> f2(f,list(a=1))

Luckily lists and data.frames don't have parents, so you can make a new 
environment, put the elements of data into it, and set the old 
environment as its parent.  That's sort of like what you did, but 
slightly different, and with fewer bad side effects:

bothenvs <- function(fun,data) {
      newenv <- new.env(hash=TRUE, parent=environment(fun))
      mapply(assign,names(data),data,
                       MoreArgs=list(envir=newenv))
      newenv
}

It would sure be nice if as.environment() took a list as an arg and 
turned it into an environment, but no such luck.

Duncan Murdoch

> 
> 
> 
> 
> ------------------------------------------------------------------------
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From ggrothendieck at gmail.com  Fri Mar  7 21:02:20 2008
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Fri, 7 Mar 2008 15:02:20 -0500
Subject: [Rd] merging environments
In-Reply-To: <47D1912A.3010802@zoo.ufl.edu>
References: <47D1912A.3010802@zoo.ufl.edu>
Message-ID: <971536df0803071202y72ca7b84nc3a3e25fe4560d8e@mail.gmail.com>

You can either use the facilities of environments or
the proto package can do this if you take advantage of the fact
that a proto object is an environment:

> library(proto)
> f <- function() {}
> # put a into the environment of f
> do.call(proto, c(list(a = 1), envir = environment(f)))
<environment: R_GlobalEnv>
attr(,"class")
[1] "proto"       "environment"
> ls(environment(f))
[1] "a" "f"

which does what you ask although you might prefer to create
a new environment/proto object with f in it to avoid explicit
environment manipulation:

# create proto object, i.e. environment, with a and f in it
p <- proto(a = 1, f = function(.) {})

# and you can add more variables later:
p$b <- 2
p[["c"]] <- 3
ls(p)
with(p, ls(environment(f))) # same

or with environments not using proto:

# create an unnamed environment and put a and f in
# adding b and c to it later
f <- local({ a <- 1; function(){} })
environment(f)$b <- 2
environment(f)[["c"]] <- 3

ls(environment(f))

2008/3/7 Ben Bolker <bolker at zoo.ufl.edu>:
>
>   Despite the spirited arguments of various R-core folks
> who feel that mle() doesn't need a "data" argument, and
> that users would be better off learning to deal with function
> closures, I am *still* trying to make such things work
> in a reasonably smooth fashion ...
>
>   Is there a standard idiom for "merging" environments?
> i.e., suppose a function has an environment that I want
> to preserve, but _add_ the contents of a data list --
> would something like this do it? Is there a less ugly
> way?
>
> x <- 0
> y <- 1
> z <- 2
>
> f <- function() {
>     x+y+z
> }
>
> f2 <- function(fun,data) {
>     L <- ls(pos=environment(fun))
>     mapply(assign,names(data),data,
>                      MoreArgs=list(envir=environment(fun)))
>     print(ls(pos=environment(fun)))
> }
>
> f2(f,list(a=1))
>
>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From h.wickham at gmail.com  Fri Mar  7 21:15:26 2008
From: h.wickham at gmail.com (hadley wickham)
Date: Fri, 7 Mar 2008 14:15:26 -0600
Subject: [Rd] merging environments
In-Reply-To: <47D1912A.3010802@zoo.ufl.edu>
References: <47D1912A.3010802@zoo.ufl.edu>
Message-ID: <f8e6ff050803071215t60361eacqba698d332a574e20@mail.gmail.com>

2008/3/7 Ben Bolker <bolker at zoo.ufl.edu>:
>
>    Despite the spirited arguments of various R-core folks
>  who feel that mle() doesn't need a "data" argument, and
>  that users would be better off learning to deal with function
>  closures, I am *still* trying to make such things work
>  in a reasonably smooth fashion ...
>
>    Is there a standard idiom for "merging" environments?
>  i.e., suppose a function has an environment that I want
>  to preserve, but _add_ the contents of a data list --
>  would something like this do it? Is there a less ugly
>  way?
>
>  x <- 0
>  y <- 1
>  z <- 2
>
>  f <- function() {
>      x+y+z
>  }
>
>  f2 <- function(fun,data) {
>      L <- ls(pos=environment(fun))
>      mapply(assign,names(data),data,
>                       MoreArgs=list(envir=environment(fun)))
>      print(ls(pos=environment(fun)))
>  }
>
>  f2(f,list(a=1))

I think you're doomed to be ugly if you don't use closures - I think
any explicit manipulation of environments is worse than the implicit
manipulation by closures.

f <- function(data) with(data, x + y + z)
f2 <- function(fun, data) function() fun(data)

f2(f, list(x = 10))()

Although it would be even nicer if you could do:

f <- function()  x + y + z
f2 <- function(fun, data) function() with(data, fun())

but I think that's confusing different types of scoping.

Hadley
-- 
http://had.co.nz/


From ggrothendieck at gmail.com  Fri Mar  7 21:47:17 2008
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Fri, 7 Mar 2008 15:47:17 -0500
Subject: [Rd] merging environments
In-Reply-To: <f8e6ff050803071215t60361eacqba698d332a574e20@mail.gmail.com>
References: <47D1912A.3010802@zoo.ufl.edu>
	<f8e6ff050803071215t60361eacqba698d332a574e20@mail.gmail.com>
Message-ID: <971536df0803071247i585ba6a3g37c9cb6d2985c1ac@mail.gmail.com>

On Fri, Mar 7, 2008 at 3:15 PM, hadley wickham <h.wickham at gmail.com> wrote:
> 2008/3/7 Ben Bolker <bolker at zoo.ufl.edu>:
> >
>
> >    Despite the spirited arguments of various R-core folks
> >  who feel that mle() doesn't need a "data" argument, and
> >  that users would be better off learning to deal with function
> >  closures, I am *still* trying to make such things work
> >  in a reasonably smooth fashion ...
> >
> >    Is there a standard idiom for "merging" environments?
> >  i.e., suppose a function has an environment that I want
> >  to preserve, but _add_ the contents of a data list --
> >  would something like this do it? Is there a less ugly
> >  way?
> >
> >  x <- 0
> >  y <- 1
> >  z <- 2
> >
> >  f <- function() {
> >      x+y+z
> >  }
> >
> >  f2 <- function(fun,data) {
> >      L <- ls(pos=environment(fun))
> >      mapply(assign,names(data),data,
> >                       MoreArgs=list(envir=environment(fun)))
> >      print(ls(pos=environment(fun)))
> >  }
> >
> >  f2(f,list(a=1))
>
> I think you're doomed to be ugly if you don't use closures - I think
> any explicit manipulation of environments is worse than the implicit
> manipulation by closures.
>
> f <- function(data) with(data, x + y + z)
> f2 <- function(fun, data) function() fun(data)
>
> f2(f, list(x = 10))()
>
> Although it would be even nicer if you could do:
>
> f <- function()  x + y + z
> f2 <- function(fun, data) function() with(data, fun())


This last one is close to what you can do with proto and is referred
to as the method of proxies here:
http://r-proto.googlecode.com/files/prototype_approaches.pdf

f <- function() x + y + z
f2 <- function(fun, ...) with(proto(environment(fun), ..., g = fun), g())
f2(f, x = 1, y = 2, z = 3)

The proto call creates an anonymous proto object whose parent is
the parent of fun.  The anonymous proto object contains the ...
arguments to f2 and g.    g is just fun with its environment reset to
the anonymous proto object. We then call g.


From pburns at pburns.seanet.com  Sat Mar  8 10:43:44 2008
From: pburns at pburns.seanet.com (Patrick Burns)
Date: Sat, 08 Mar 2008 09:43:44 +0000
Subject: [Rd] NA warnings for r<distr>() {aka "patch for random.c"}
In-Reply-To: <18385.19126.4852.755058@stat.math.ethz.ch>
References: <20080229181940.457c9bf7@berwin-nus1>	<18379.49661.242974.779574@stat.math.ethz.ch>	<20080305202624.7f1c54ea@berwin-nus1>
	<18385.19126.4852.755058@stat.math.ethz.ch>
Message-ID: <47D25FD0.4000705@pburns.seanet.com>

Martin Maechler wrote:

> [ ... ]
>
>But actually, part of the changed behavior may be considered
>undesirable:
>
>  rnorm(2, mean = NA)
>
>which gives two NaN's  would now produce a warning,
>where I could argue that 
>   'arithmetic with NAs should give NAs without a warning'
>since
>  1:2 + NA
>also gives NAs without a warning.
>
>So we could argue that a warning should *only* be produced in a
>case where the parameters of the distribution are not NA.
>
>What do others (particularly R-core !) think? 
>  
>

I think the answer depends on the probability that
the user realizes that the parameter is NA.  Obviously
the user should know if 'rnorm' is used directly.  If it
is used inside a function, then the user probably doesn't
know.  Not warning in such a case means that tracking
down the ultimate cause of the problem could be harder.
However, it seems to me that the function calling 'rnorm'
is really the one responsible for warning the user.

Pat


[ ... ]


From cmr.pent at gmail.com  Fri Mar  7 18:54:33 2008
From: cmr.pent at gmail.com (=?UTF-8?B?0JDQvdC00YDQtdC5INCf0LDRgNCw0LzQvtC90L7Qsg==?=)
Date: Fri, 7 Mar 2008 20:54:33 +0300
Subject: [Rd] embedFonts() side-effect under 2.6.2 ?
In-Reply-To: <18383.22086.937059.1631@ron.nulle.part>
References: <18383.11312.484162.606729@ron.nulle.part>
	<18383.22086.937059.1631@ron.nulle.part>
Message-ID: <5f0660120803070954v5bf377d5w94509b575c9ab879@mail.gmail.com>

Hi!

Upon some investigation it turned out that the bug is *not* actually
in R. I've uninstalled "ghostscript" Debian package and reverted back
to "gs-gpl" Debian package, and the problem gone.

That means that the bug is either in new ghostscript or in the way R
interacts with it. Reassigning the bug accordingly.

Andrey


From clausen at econ.upenn.edu  Sun Mar  9 04:11:19 2008
From: clausen at econ.upenn.edu (Andrew Clausen)
Date: Sat, 8 Mar 2008 22:11:19 -0500
Subject: [Rd] [patch] add=TRUE in plot.default()
Message-ID: <20080309031119.GC23544@econ.upenn.edu>

Hi all,

As long as I've used R, add=TRUE hasn't worked in contexts like this:

	f <- function(x) x^2
	X <- seq(0, 1, by=1/4)
	plot(f, col="blue")
	plot(X, f(X), col="red", type="l", add=TRUE)

I attached a fix for version 2.6.2.

Cheers,
Andrew

-------------- next part --------------
diff --git a/src/library/graphics/R/plot.R b/src/library/graphics/R/plot.R
index 233b11e..ad3529e 100644
--- a/src/library/graphics/R/plot.R
+++ b/src/library/graphics/R/plot.R
@@ -46,16 +46,24 @@ plot.default <-
     function(x, y = NULL, type = "p", xlim = NULL, ylim = NULL,
              log = "", main = NULL, sub = NULL, xlab = NULL, ylab = NULL,
              ann = par("ann"), axes = TRUE, frame.plot = axes,
-             panel.first = NULL, panel.last = NULL, asp = NA, ...)
+             panel.first = NULL, panel.last = NULL, asp = NA, add=FALSE, ...)
 {
+    xlabel <- if (!missing(x)) deparse(substitute(x))
+    ylabel <- if (!missing(y)) deparse(substitute(y))
+    if (add) {
+	log <- paste(ifelse(unlist(par("xlog", "ylog")), c("x", "y"), ""),
+		     collapse="")
+	xy <- xy.coords(x, y, xlabel, ylabel, log=log)
+	plot.xy(xy, type, ...)
+	return(invisible())
+    }
+
     ## These col, bg, pch, cex can be vectors, so exclude them
     ## Also, axis and box accept some of these
     localAxis <- function(..., col, bg, pch, cex, lty, lwd) Axis(...)
     localBox <- function(..., col, bg, pch, cex, lty, lwd) box(...)
     localWindow <- function(..., col, bg, pch, cex, lty, lwd) plot.window(...)
     localTitle <- function(..., col, bg, pch, cex, lty, lwd) title(...)
-    xlabel <- if (!missing(x)) deparse(substitute(x))
-    ylabel <- if (!missing(y)) deparse(substitute(y))
     xy <- xy.coords(x, y, xlabel, ylabel, log)
     xlab <- if (is.null(xlab)) xy$xlab else xlab
     ylab <- if (is.null(ylab)) xy$ylab else ylab

From lgautier at gmail.com  Sun Mar  9 10:05:56 2008
From: lgautier at gmail.com (Laurent Gautier)
Date: Sun, 9 Mar 2008 17:05:56 +0800
Subject: [Rd] extract function "[" and empty index
Message-ID: <27d1e6020803090105u744f961ahc7900d79618566a1@mail.gmail.com>

Dear list,

I am having a question regarding the extract function "[".

The man page says that one usage with k-dimensional arrays is to
specify k indices to "[", with an empty index indicating that all
entries in that dimension are selected.

The question is the following: is there an R object qualifying as an
"empty index" ? I understand that the lazy evaluation of parameters
allows one to
have genuinely missing parameters, but I would like to have an object
instead. I understand that one can always have an if/else workaround,
but I thought should ask, just in case.

I tried with NULL but with little success, as it appears to give the
same results
as an empty vector.
> m = matrix(1, 2, 2)
> m[1, NULL]
numeric(0)
> m[1, integer(0)]
numeric(0)

Since I was at it, I noted that the result obtained with "numeric(0)"
definitely makes sense but could as well be seen as challenging the
concept of an empty index presented in the man page (One could somehow
expect the presence of an object  meaning "everything" rather than
"missingness" meaning it).


Thanks,


Laurent


From ggrothendieck at gmail.com  Sun Mar  9 13:18:17 2008
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sun, 9 Mar 2008 08:18:17 -0400
Subject: [Rd] extract function "[" and empty index
In-Reply-To: <27d1e6020803090105u744f961ahc7900d79618566a1@mail.gmail.com>
References: <27d1e6020803090105u744f961ahc7900d79618566a1@mail.gmail.com>
Message-ID: <971536df0803090518w70ca393dw7898a11b2f8cba62@mail.gmail.com>

Use TRUE.

On Sun, Mar 9, 2008 at 5:05 AM, Laurent Gautier <lgautier at gmail.com> wrote:
> Dear list,
>
> I am having a question regarding the extract function "[".
>
> The man page says that one usage with k-dimensional arrays is to
> specify k indices to "[", with an empty index indicating that all
> entries in that dimension are selected.
>
> The question is the following: is there an R object qualifying as an
> "empty index" ? I understand that the lazy evaluation of parameters
> allows one to
> have genuinely missing parameters, but I would like to have an object
> instead. I understand that one can always have an if/else workaround,
> but I thought should ask, just in case.
>
> I tried with NULL but with little success, as it appears to give the
> same results
> as an empty vector.
> > m = matrix(1, 2, 2)
> > m[1, NULL]
> numeric(0)
> > m[1, integer(0)]
> numeric(0)
>
> Since I was at it, I noted that the result obtained with "numeric(0)"
> definitely makes sense but could as well be seen as challenging the
> concept of an empty index presented in the man page (One could somehow
> expect the presence of an object  meaning "everything" rather than
> "missingness" meaning it).
>
>
> Thanks,
>
>
> Laurent
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From wwwhsd at gmail.com  Sun Mar  9 16:08:59 2008
From: wwwhsd at gmail.com (Henrique Dallazuanna)
Date: Sun, 9 Mar 2008 12:08:59 -0300
Subject: [Rd] [patch] add=TRUE in plot.default()
In-Reply-To: <20080309031119.GC23544@econ.upenn.edu>
References: <20080309031119.GC23544@econ.upenn.edu>
Message-ID: <da79af330803090808udf285ffqa0bbaac5bc5f9a99@mail.gmail.com>

I think you can use par(new = T) here:

f <- function(x) x^2
X <- seq(0, 1, by=1/4)
plot(f, col="blue")
par(new = T)
plot(X, f(X), col="red", type="l", xlab="", ylab="")

On 09/03/2008, Andrew Clausen <clausen at econ.upenn.edu> wrote:
> Hi all,
>
> As long as I've used R, add=TRUE hasn't worked in contexts like this:
>
> 	f <- function(x) x^2
> 	X <- seq(0, 1, by=1/4)
> 	plot(f, col="blue")
> 	plot(X, f(X), col="red", type="l", add=TRUE)
>
> I attached a fix for version 2.6.2.
>
> Cheers,
> Andrew
>
>


-- 
Henrique Dallazuanna
Curitiba-Paran?-Brasil
25? 25' 40" S 49? 16' 22" O


From murdoch at stats.uwo.ca  Sun Mar  9 17:11:45 2008
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Sun, 09 Mar 2008 12:11:45 -0400
Subject: [Rd] [patch] add=TRUE in plot.default()
In-Reply-To: <20080309031119.GC23544@econ.upenn.edu>
References: <20080309031119.GC23544@econ.upenn.edu>
Message-ID: <47D40C41.1000202@stats.uwo.ca>

On 08/03/2008 10:11 PM, Andrew Clausen wrote:
> Hi all,
> 
> As long as I've used R, add=TRUE hasn't worked in contexts like this:
> 
> 	f <- function(x) x^2
> 	X <- seq(0, 1, by=1/4)
> 	plot(f, col="blue")
> 	plot(X, f(X), col="red", type="l", add=TRUE)
> 
> I attached a fix for version 2.6.2.

It has never been claimed that it would work, and as far as I can see, 
it doesn't make anything easier:  the last line could be replaced by

lines(X, f(X), col="red")

for more clarity from less typing.  So why would you want add=TRUE in 
plot.default?

Duncan Murdoch


From clausen at econ.upenn.edu  Sun Mar  9 17:30:12 2008
From: clausen at econ.upenn.edu (Andrew Clausen)
Date: Sun, 9 Mar 2008 12:30:12 -0400
Subject: [Rd] [patch] add=TRUE in plot.default()
In-Reply-To: <da79af330803090808udf285ffqa0bbaac5bc5f9a99@mail.gmail.com>
References: <20080309031119.GC23544@econ.upenn.edu>
	<da79af330803090808udf285ffqa0bbaac5bc5f9a99@mail.gmail.com>
Message-ID: <20080309163012.GD23544@econ.upenn.edu>

Hi Henrique,

Sorry I wasn't very clear.  I should have said that I think it's nice that
add=TRUE works for some things, like

	plot(f)
	plot(g, add=TRUE)

I think it's a convenient and simple way of adding things to a plot.  But this
add=TRUE trick doesn't work for everything, and I think it would be convenient
if it did.

In the past, I've used

	f <- function(x) x^2
	X <- seq(0, 1, by=1/4)
	plot(f, col="blue")
	lines(X, f(X), col="red")

which I think is clumsy.

I didn't know about "new".  Why is new back-to-front?  If you specify
"new=TRUE", it does NOT create a new graph.  Why does it require you
to specify empty xlab and ylab?  Why doesn't this work:

	f <- function(x) x^2
	X <- seq(0, 1, by=1/4)
	plot(f, col="blue")
	plot(X, f(X), col="red", type="l", xlab="", ylab="", new=TRUE)

It seems like we can't solve the first problem with new=TRUE (that it's
back-to-front) without breaking backward compatibility.  So I think add=TRUE
should be encouraged instead, as in my patch.

But, there is one extra thing to think about.  Sometimes, it's useful to
have a for-loop for putting several functions on a graph.  For example,

	f <- function(a) function(x) a * x^2
	plot.new()
	for (a in c(1,2,3))
		plot(f(a), add=TRUE, col=a)

This doesn't work well.  For example, it doesn't draw the axes.  Is there
a user-friendly way of doing this properly, short of

	f <- function(a) function(x) a * x^2
	plot(f(3), col=3)
	for (a in 1:3)
		plot(f(a), add=TRUE, col=a)

For instance, is there a command that can tell you if the axes have been
drawn?  If there were, then you could do something like

	f <- function(a) function(x) a * x^2
	plot.new()
	for (a in c(1,2,3))
		plot(f(a), add=(TRUE & par("axes.already.drawn")), col=a)

Cheers,
Andrew

On Sun, Mar 09, 2008 at 12:08:59PM -0300, Henrique Dallazuanna wrote:
> I think you can use par(new = T) here:
> 
> f <- function(x) x^2
> X <- seq(0, 1, by=1/4)
> plot(f, col="blue")
> par(new = T)
> plot(X, f(X), col="red", type="l", xlab="", ylab="")
> 
> On 09/03/2008, Andrew Clausen <clausen at econ.upenn.edu> wrote:
> > Hi all,
> >
> > As long as I've used R, add=TRUE hasn't worked in contexts like this:
> >
> > 	f <- function(x) x^2
> > 	X <- seq(0, 1, by=1/4)
> > 	plot(f, col="blue")
> > 	plot(X, f(X), col="red", type="l", add=TRUE)
> >
> > I attached a fix for version 2.6.2.
> >
> > Cheers,
> > Andrew
> >
> >
> 
> 
> -- 
> Henrique Dallazuanna
> Curitiba-Paran?-Brasil
> 25? 25' 40" S 49? 16' 22" O


From clausen at econ.upenn.edu  Sun Mar  9 17:46:40 2008
From: clausen at econ.upenn.edu (Andrew Clausen)
Date: Sun, 9 Mar 2008 12:46:40 -0400
Subject: [Rd] [patch] add=TRUE in plot.default()
In-Reply-To: <47D40C41.1000202@stats.uwo.ca>
References: <20080309031119.GC23544@econ.upenn.edu>
	<47D40C41.1000202@stats.uwo.ca>
Message-ID: <20080309164639.GF23544@econ.upenn.edu>

Hi Duncan,

On Sun, Mar 09, 2008 at 12:11:45PM -0400, Duncan Murdoch wrote:
> It has never been claimed that it would work, and as far as I can see, 
> it doesn't make anything easier:  the last line could be replaced by
> 
> lines(X, f(X), col="red")
> 
> for more clarity from less typing.  So why would you want add=TRUE in 
> plot.default?

I don't like lines() because it ONLY allows you to add to plots.  I could
send a patch for that too...

But I also like how plot() is polymorphic.  It's nice how you can do some
computation -- a regression, a histogram or whatever, and then just call plot()
on it, and you have a nice graphical representation of it.  But why stop
there... wouldn't it be nice if you could stack them on top of each other?
It's often useful to compare things by putting them on top of each other.
(Are 2 regression lines the same or similar?  Are two utility functions the
same? etc.)

Cheers,
Andrew


From ggrothendieck at gmail.com  Sun Mar  9 18:23:44 2008
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sun, 9 Mar 2008 13:23:44 -0400
Subject: [Rd] [patch] add=TRUE in plot.default()
In-Reply-To: <20080309164639.GF23544@econ.upenn.edu>
References: <20080309031119.GC23544@econ.upenn.edu>
	<47D40C41.1000202@stats.uwo.ca>
	<20080309164639.GF23544@econ.upenn.edu>
Message-ID: <971536df0803091023v24c56a45xb209cfd74be33d2c@mail.gmail.com>

I agree with Andrew's viewpoint.  These changes would make
R easier to use.

On Sun, Mar 9, 2008 at 12:46 PM, Andrew Clausen <clausen at econ.upenn.edu> wrote:
> Hi Duncan,
>
> On Sun, Mar 09, 2008 at 12:11:45PM -0400, Duncan Murdoch wrote:
> > It has never been claimed that it would work, and as far as I can see,
> > it doesn't make anything easier:  the last line could be replaced by
> >
> > lines(X, f(X), col="red")
> >
> > for more clarity from less typing.  So why would you want add=TRUE in
> > plot.default?
>
> I don't like lines() because it ONLY allows you to add to plots.  I could
> send a patch for that too...
>
> But I also like how plot() is polymorphic.  It's nice how you can do some
> computation -- a regression, a histogram or whatever, and then just call plot()
> on it, and you have a nice graphical representation of it.  But why stop
> there... wouldn't it be nice if you could stack them on top of each other?
> It's often useful to compare things by putting them on top of each other.
> (Are 2 regression lines the same or similar?  Are two utility functions the
> same? etc.)
>
> Cheers,
> Andrew
>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From lgautier at gmail.com  Sun Mar  9 19:29:32 2008
From: lgautier at gmail.com (Laurent Gautier)
Date: Mon, 10 Mar 2008 02:29:32 +0800
Subject: [Rd] extract function "[" and empty index
In-Reply-To: <971536df0803090518w70ca393dw7898a11b2f8cba62@mail.gmail.com>
References: <27d1e6020803090105u744f961ahc7900d79618566a1@mail.gmail.com>
	<971536df0803090518w70ca393dw7898a11b2f8cba62@mail.gmail.com>
Message-ID: <27d1e6020803091129h19bbf3ffu1265ecd04b35993@mail.gmail.com>

Thanks, I was forgetting the recycling rule.


L.


2008/3/9, Gabor Grothendieck <ggrothendieck at gmail.com>:
> Use TRUE.
>
>
>  On Sun, Mar 9, 2008 at 5:05 AM, Laurent Gautier <lgautier at gmail.com> wrote:
>  > Dear list,
>  >
>  > I am having a question regarding the extract function "[".
>  >
>  > The man page says that one usage with k-dimensional arrays is to
>  > specify k indices to "[", with an empty index indicating that all
>  > entries in that dimension are selected.
>  >
>  > The question is the following: is there an R object qualifying as an
>  > "empty index" ? I understand that the lazy evaluation of parameters
>  > allows one to
>  > have genuinely missing parameters, but I would like to have an object
>  > instead. I understand that one can always have an if/else workaround,
>  > but I thought should ask, just in case.
>  >
>  > I tried with NULL but with little success, as it appears to give the
>  > same results
>  > as an empty vector.
>  > > m = matrix(1, 2, 2)
>  > > m[1, NULL]
>  > numeric(0)
>  > > m[1, integer(0)]
>  > numeric(0)
>  >
>  > Since I was at it, I noted that the result obtained with "numeric(0)"
>  > definitely makes sense but could as well be seen as challenging the
>  > concept of an empty index presented in the man page (One could somehow
>  > expect the presence of an object  meaning "everything" rather than
>  > "missingness" meaning it).
>  >
>  >
>  > Thanks,
>  >
>  >
>  > Laurent
>  >
>
> > ______________________________________________
>  > R-devel at r-project.org mailing list
>  > https://stat.ethz.ch/mailman/listinfo/r-devel
>  >
>


-- 
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)

iEYEARECAAYFAkYgwJ4ACgkQB/w/MLoyRDeQlgCeMp8v69/Wy24Q4IaBVhoG1M5R
2h4AoIOTvKbrFpTklRDjV7u8tEOeSQqt
=JPph
-----END PGP SIGNATURE-----


From murdoch at stats.uwo.ca  Sun Mar  9 21:04:08 2008
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Sun, 09 Mar 2008 16:04:08 -0400
Subject: [Rd] [patch] add=TRUE in plot.default()
In-Reply-To: <20080309164639.GF23544@econ.upenn.edu>
References: <20080309031119.GC23544@econ.upenn.edu>	<47D40C41.1000202@stats.uwo.ca>
	<20080309164639.GF23544@econ.upenn.edu>
Message-ID: <47D442B8.10501@stats.uwo.ca>

On 09/03/2008 12:46 PM, Andrew Clausen wrote:
> Hi Duncan,
> 
> On Sun, Mar 09, 2008 at 12:11:45PM -0400, Duncan Murdoch wrote:
>> It has never been claimed that it would work, and as far as I can see, 
>> it doesn't make anything easier:  the last line could be replaced by
>>
>> lines(X, f(X), col="red")
>>
>> for more clarity from less typing.  So why would you want add=TRUE in 
>> plot.default?
> 
> I don't like lines() because it ONLY allows you to add to plots.  I could
> send a patch for that too...
> 
> But I also like how plot() is polymorphic.  It's nice how you can do some
> computation -- a regression, a histogram or whatever, and then just call plot()
> on it, and you have a nice graphical representation of it.  But why stop
> there... wouldn't it be nice if you could stack them on top of each other?
> It's often useful to compare things by putting them on top of each other.
> (Are 2 regression lines the same or similar?  Are two utility functions the
> same? etc.)

Part of the reason I didn't like your patch is that it was incomplete: 
it didn't patch the plot.default.Rd file.  That function already has 
around 16 parameters; do we really want to add another one, that 
interacts with some of the ones that are there?

What you really seem to want is to add it to the generic plot(), but 
it's way too late to go modifying that particular generic.

Duncan Murdoch


From clausen at econ.upenn.edu  Sun Mar  9 22:58:33 2008
From: clausen at econ.upenn.edu (Andrew Clausen)
Date: Sun, 9 Mar 2008 17:58:33 -0400
Subject: [Rd] [patch] add=TRUE in plot.default()
In-Reply-To: <47D442B8.10501@stats.uwo.ca>
References: <20080309031119.GC23544@econ.upenn.edu>
	<47D40C41.1000202@stats.uwo.ca>
	<20080309164639.GF23544@econ.upenn.edu>
	<47D442B8.10501@stats.uwo.ca>
Message-ID: <20080309215833.GH23544@econ.upenn.edu>

On Sun, Mar 09, 2008 at 04:04:08PM -0400, Duncan Murdoch wrote:
> Part of the reason I didn't like your patch is that it was incomplete: 
> it didn't patch the plot.default.Rd file.

Fair enough -- I wasn't sure whether I was fixing a bug or not.  ("..."
spreads the documentation around a bit.)

> That function already has 
> around 16 parameters; do we really want to add another one, that 
> interacts with some of the ones that are there?

Yes.  The ability to plot things on top of each other is important.
The simplicity created by having a single interface for adding to plots
outweighs the complexity of yet another parameter.

The add parameter only interacts with other parameters superficially --
some parameters of "plot" (like log) are related to the shape of the axes,
and should be inherited from what is on the plot already.

> What you really seem to want is to add it to the generic plot(),

Agreed.

> but it's way too late to go modifying that particular generic.

I agree.  Adding an "add=FALSE" parameter to plot() would generate errors for
methods that don't implement it, so they would all have to be changed
simultaneously, including in private/unreleased code.

So I'd like to settle for second best: adding add=FALSE parameters to many plot
methods.

Cheers,
Andrew


From h.wickham at gmail.com  Sun Mar  9 23:27:50 2008
From: h.wickham at gmail.com (hadley wickham)
Date: Sun, 9 Mar 2008 17:27:50 -0500
Subject: [Rd] [patch] add=TRUE in plot.default()
In-Reply-To: <20080309215833.GH23544@econ.upenn.edu>
References: <20080309031119.GC23544@econ.upenn.edu>
	<47D40C41.1000202@stats.uwo.ca>
	<20080309164639.GF23544@econ.upenn.edu> <47D442B8.10501@stats.uwo.ca>
	<20080309215833.GH23544@econ.upenn.edu>
Message-ID: <f8e6ff050803091527j1e09dbe6qf298ef9e131e27ba@mail.gmail.com>

>  Yes.  The ability to plot things on top of each other is important.
>  The simplicity created by having a single interface for adding to plots
>  outweighs the complexity of yet another parameter.
>
>  The add parameter only interacts with other parameters superficially --
>  some parameters of "plot" (like log) are related to the shape of the axes,
>  and should be inherited from what is on the plot already.

But what about when the new data is outside the range of the current
plot?  Wouldn't you expect the axis ranges to expand automatically?
Instead of trying to shoehorn plot modification on top of base
graphics, you could try using ggplot2 (http://had.co.nz/ggplot2) which
has been built from the ground up to facilitate this kind of
manipulation.

Hadley


-- 
http://had.co.nz/


From ggrothendieck at gmail.com  Sun Mar  9 23:47:29 2008
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sun, 9 Mar 2008 18:47:29 -0400
Subject: [Rd] [patch] add=TRUE in plot.default()
In-Reply-To: <f8e6ff050803091527j1e09dbe6qf298ef9e131e27ba@mail.gmail.com>
References: <20080309031119.GC23544@econ.upenn.edu>
	<47D40C41.1000202@stats.uwo.ca>
	<20080309164639.GF23544@econ.upenn.edu> <47D442B8.10501@stats.uwo.ca>
	<20080309215833.GH23544@econ.upenn.edu>
	<f8e6ff050803091527j1e09dbe6qf298ef9e131e27ba@mail.gmail.com>
Message-ID: <971536df0803091547m526c144s47647f10f725def4@mail.gmail.com>

On Sun, Mar 9, 2008 at 6:27 PM, hadley wickham <h.wickham at gmail.com> wrote:
> >  Yes.  The ability to plot things on top of each other is important.
> >  The simplicity created by having a single interface for adding to plots
> >  outweighs the complexity of yet another parameter.
> >
> >  The add parameter only interacts with other parameters superficially --
> >  some parameters of "plot" (like log) are related to the shape of the axes,
> >  and should be inherited from what is on the plot already.
>
> But what about when the new data is outside the range of the current
> plot?

plot/lines/points already works that way so this is just an interface issue.


From h.wickham at gmail.com  Mon Mar 10 00:51:30 2008
From: h.wickham at gmail.com (hadley wickham)
Date: Sun, 9 Mar 2008 18:51:30 -0500
Subject: [Rd] [patch] add=TRUE in plot.default()
In-Reply-To: <971536df0803091547m526c144s47647f10f725def4@mail.gmail.com>
References: <20080309031119.GC23544@econ.upenn.edu>
	<47D40C41.1000202@stats.uwo.ca>
	<20080309164639.GF23544@econ.upenn.edu> <47D442B8.10501@stats.uwo.ca>
	<20080309215833.GH23544@econ.upenn.edu>
	<f8e6ff050803091527j1e09dbe6qf298ef9e131e27ba@mail.gmail.com>
	<971536df0803091547m526c144s47647f10f725def4@mail.gmail.com>
Message-ID: <f8e6ff050803091651q19aea05bg36126f7a562fef88@mail.gmail.com>

>  > But what about when the new data is outside the range of the current
>  > plot?
>
>  plot/lines/points already works that way so this is just an interface issue.

That may be the way it is, but I don't see how you could argue that
it's desirable behaviour.

Hadley


-- 
http://had.co.nz/


From ggrothendieck at gmail.com  Mon Mar 10 00:59:47 2008
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sun, 9 Mar 2008 19:59:47 -0400
Subject: [Rd] [patch] add=TRUE in plot.default()
In-Reply-To: <f8e6ff050803091651q19aea05bg36126f7a562fef88@mail.gmail.com>
References: <20080309031119.GC23544@econ.upenn.edu>
	<47D40C41.1000202@stats.uwo.ca>
	<20080309164639.GF23544@econ.upenn.edu> <47D442B8.10501@stats.uwo.ca>
	<20080309215833.GH23544@econ.upenn.edu>
	<f8e6ff050803091527j1e09dbe6qf298ef9e131e27ba@mail.gmail.com>
	<971536df0803091547m526c144s47647f10f725def4@mail.gmail.com>
	<f8e6ff050803091651q19aea05bg36126f7a562fef88@mail.gmail.com>
Message-ID: <971536df0803091659r566baafbr831aaf7f35465c94@mail.gmail.com>

Its not a matter of desirable or not -- its a matter that its a different point.

The par(new= ) to get an old graph is completely confusing
and its annoying that one has to suddenly switch to lines and points
and cannot consistently use plot.

That remains true whether or not there is auto expansion.

On Sun, Mar 9, 2008 at 7:51 PM, hadley wickham <h.wickham at gmail.com> wrote:
> >  > But what about when the new data is outside the range of the current
> >  > plot?
> >
> >  plot/lines/points already works that way so this is just an interface issue.
>
> That may be the way it is, but I don't see how you could argue that
> it's desirable behaviour.
>
>
> Hadley
>
>
> --
> http://had.co.nz/
>


From murdoch at stats.uwo.ca  Mon Mar 10 03:15:11 2008
From: murdoch at stats.uwo.ca (murdoch at stats.uwo.ca)
Date: Mon, 10 Mar 2008 03:15:11 +0100 (CET)
Subject: [Rd] source(echo=TRUE) bug (was: [R] source() behavior I don't
	understand) (PR#10923)
Message-ID: <20080310021511.C5D3E282EFF7@mail.pubhealth.ku.dk>

On 09/03/2008 10:01 PM, Richard M. Heiberger wrote:
> temp.ttt <- "ttt <- 1\nttt"
> conn.ttt <- textConnection(temp.ttt)
> source(conn.ttt, echo=TRUE)  ## name of variable is echoed
> close(conn.ttt)
> cat(file="c:/temp/temp.R", temp.ttt)  ## name of variable not echoed
> source("c:/temp/temp.R", echo=TRUE)
> 
> 
> temp.abc <- "abc <- 1\nabc"
> conn.abc <- textConnection(temp.abc)
> source(conn.abc, echo=TRUE)  ## name of variable is echoed
> close(conn.abc)
> cat(file="c:/temp/temp.R", temp.abc)  ## name of variable is echoed
> source("c:/temp/temp.R", echo=TRUE)
> 
> 
> The behavior I don't understand is why the variable name "ttt" is not echoed
> when sourced from a file.  It is echoed when sourced from a character string.
> The name is echoed in both situations when it begins with a letter other
> than "t".  Specifically I have tested "tt" and "ttt".

Looks like a bug in a regular expression.  R doesn't echo lines 
containing nothing but blanks and tabs, and I think the regular 
expression that is supposed to match tabs is matching t instead.  Thanks 
for the report, I'll fix it.

Duncan Murdoch


From rmh at temple.edu  Mon Mar 10 03:45:14 2008
From: rmh at temple.edu (rmh at temple.edu)
Date: Mon, 10 Mar 2008 03:45:14 +0100 (CET)
Subject: [Rd] source(echo=TRUE) bug (was: [R] source() (PR#10924)
Message-ID: <20080310024514.2F9C1282EFF7@mail.pubhealth.ku.dk>

Thanks Duncan,

While there, can you give a new optional argument that
will permit the echo of blanks and comments?

Rich


From maechler at stat.math.ethz.ch  Mon Mar 10 11:27:38 2008
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Mon, 10 Mar 2008 11:27:38 +0100
Subject: [Rd] Re Bessel functions of complex argument
In-Reply-To: <73ED823A-9F13-4852-A708-633BEA1BE235@noc.soton.ac.uk>
References: <2CFB86B5-515C-4968-811C-E2F8716D13DB@ex.ac.uk>
	<73ED823A-9F13-4852-A708-633BEA1BE235@noc.soton.ac.uk>
Message-ID: <18389.3354.944541.776906@stat.math.ethz.ch>

{Diverted from an R-help thread}

>>>>> "Robin" == Robin Hankin <r.hankin at noc.soton.ac.uk>
>>>>>     on Mon, 10 Mar 2008 08:49:06 +0000 writes:

    Robin> Hello Baptiste Bessel functions with complex
    Robin> arguments are not supported in R.

    Robin> Neither matlab nor the Gnu Scientific Library support
    Robin> them either.

    Robin> . . . but . . .

    Robin> the pari/gp system (released on the GPL) does:

    Robin> ? besselj(1+I,3)
    Robin> %3 = 0.6919067491368555819808728680 + 0.4484268613977010268818252591*I
    Robin> ?


    Robin> You can access some pari/gp functionality from within R
    Robin> by using the elliptic package, although unfortunately
    Robin> its wrapper function, P.pari(),  is not quite flexible enough
    Robin> to deal with besselj().

    Robin> I'd be happy to discuss this offline; P.pari() will need only
    Robin> minor changes to accommodate besselj().

Hi Robin,
have you looked at *how* pari/gp does this?
If they have a C routine, it might be worth considering to add
``the'' complex Bessel functionality to R.

We have seen several occasions where people had a clear usage
need for them.

{{I have a vague d?j?-vue feeling on this whole topic ....}}

Martin Maechler, ETH Zurich


From ripley at stats.ox.ac.uk  Mon Mar 10 12:03:04 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 10 Mar 2008 11:03:04 +0000 (GMT)
Subject: [Rd] Re Bessel functions of complex argument
In-Reply-To: <18389.3354.944541.776906@stat.math.ethz.ch>
References: <2CFB86B5-515C-4968-811C-E2F8716D13DB@ex.ac.uk>
	<73ED823A-9F13-4852-A708-633BEA1BE235@noc.soton.ac.uk>
	<18389.3354.944541.776906@stat.math.ethz.ch>
Message-ID: <alpine.LFD.1.00.0803101056320.6210@gannet.stats.ox.ac.uk>

On Mon, 10 Mar 2008, Martin Maechler wrote:

> {Diverted from an R-help thread}
>
>>>>>> "Robin" == Robin Hankin <r.hankin at noc.soton.ac.uk>
>>>>>>     on Mon, 10 Mar 2008 08:49:06 +0000 writes:
>
>    Robin> Hello Baptiste Bessel functions with complex
>    Robin> arguments are not supported in R.
>
>    Robin> Neither matlab nor the Gnu Scientific Library support
>    Robin> them either.
>
>    Robin> . . . but . . .
>
>    Robin> the pari/gp system (released on the GPL) does:
>
>    Robin> ? besselj(1+I,3)
>    Robin> %3 = 0.6919067491368555819808728680 + 0.4484268613977010268818252591*I
>    Robin> ?
>
>
>    Robin> You can access some pari/gp functionality from within R
>    Robin> by using the elliptic package, although unfortunately
>    Robin> its wrapper function, P.pari(),  is not quite flexible enough
>    Robin> to deal with besselj().
>
>    Robin> I'd be happy to discuss this offline; P.pari() will need only
>    Robin> minor changes to accommodate besselj().
>
> Hi Robin,
> have you looked at *how* pari/gp does this?
> If they have a C routine, it might be worth considering to add
> ``the'' complex Bessel functionality to R.

To an R package, surely?  They hardly seem important enough for base R.

There are C implementations in several places, e.g. ACM algorithm 644 
(also netlib.org/amos).

>
> We have seen several occasions where people had a clear usage
> need for them.
>
> {{I have a vague d?j?-vue feeling on this whole topic ....}}
>
> Martin Maechler, ETH Zurich

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From maechler at stat.math.ethz.ch  Mon Mar 10 12:06:01 2008
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Mon, 10 Mar 2008 12:06:01 +0100
Subject: [Rd] NA warnings for r<distr>() {aka "patch for random.c"}
In-Reply-To: <20080307235406.21f5649b@absentia>
References: <20080229181940.457c9bf7@berwin-nus1>
	<18379.49661.242974.779574@stat.math.ethz.ch>
	<20080305202624.7f1c54ea@berwin-nus1>
	<18385.19126.4852.755058@stat.math.ethz.ch>
	<20080307235406.21f5649b@absentia>
Message-ID: <18389.5657.301160.608130@stat.math.ethz.ch>

>>>>> "BAT" == Berwin A Turlach <statba at nus.edu.sg>
>>>>>     on Fri, 7 Mar 2008 23:54:06 +0800 writes:

    BAT> G'day Martin (and "listeners"), On Fri, 7 Mar 2008
    BAT> 15:01:26 +0100 Martin Maechler
    BAT> <maechler at stat.math.ethz.ch> wrote:

    BAT> [...]
    >> >> If you feel like finding another elegant patch...
    >> 
    BAT> Well, elegance is in the eye of the beholder. :-)
    >> 
    BAT> I attach two patches.  One that adds warning messages
    BAT> at the other places where NAs can be generated.
    >> 
    >> ok. The result is very simple ``hence elegant''.
    >> 
    >> But actually, part of the changed behavior may be
    >> considered undesirable:
    >> 
    >> rnorm(2, mean = NA)
    >> 
    >> which gives two NaN's would now produce a warning, where
    >> I could argue that 'arithmetic with NAs should give NAs
    >> without a warning' since 1:2 + NA also gives NAs without
    >> a warning.
    >> 
    >> So we could argue that a warning should *only* be
    >> produced in a case where the parameters of the
    >> distribution are not NA.
    >> 
    >> What do others (particularly R-core !) think?

    BAT> I can agree with that point of view.  But then, should
    BAT> a warning not be issued only if one of the parameters
    BAT> of the distribution is NA, or should it also not be
    BAT> issued if any non-finite parameter is encountered?
    BAT> After all,

    >> 1:2 + Inf
    BAT> [1] Inf Inf

    BAT> does not create any warning either.  

but it doesn't give NA either.
A bit more relevant (and I'm sure you meant implicitly)

  > Inf/Inf
  [1] NaN

However, I think we shouldn't go as far.

    BAT> In that case, a patch as the attached should do, it
    BAT> checks all parameters for finiteness and then checks
    BAT> whether the generated number is not finite.

    BAT> Thus, with the patch applied I see the following
    BAT> behaviour:

    >> rnorm(2, mean=NA)
    BAT> [1] NaN NaN
    >> rnorm(5, mean=c(0,Inf, -Inf, NA, NaN))
    BAT> [1] 1.897874 NaN NaN NaN NaN
    >> rbinom(2, size=20, p=1.2)
    BAT> [1] NaN NaN Warning message: In rbinom(2, size = 20, p
    BAT> = 1.2) : NAs produced
    >> rexp(2, rate=-2)
    BAT> [1] NaN NaN Warning message: In rexp(2, rate = -2) :
    BAT> NAs produced

I've committed a bit a different patch for now (svn rev 44715),
because I felt we were getting too sophisticated.

The current (since about 20 minutes) situation is to 
warn when the *result* is NA or NaN and not to warn in any other
cases.
This maybe not be perfect, but at least is very consistent and
in particular consistent to what the warning itself "says".

BTW, I've also found that I  
     rnorm(n, mu=Inf) |--> NA  was not ok, and changed that to
     rnorm(n, mu=Inf) |--> Inf

More feedback is welcome,
but please now "start" with R-devel rev >= 44715

Martin



    BAT> Without the patch:

    >> rnorm(2, mean=NA)
    BAT> [1] NaN NaN
    >> rnorm(5, mean=c(0,Inf, -Inf, NA, NaN))
    BAT> [1] -0.1719657 NaN NaN NaN NaN
    >> rbinom(2, size=20, p=1.2)
    BAT> [1] NaN NaN
    >> rexp(2, rate=-2)
    BAT> [1] NaN NaN Warning message: In rexp(2, rate = -2) :
    BAT> NAs produced

    BAT> On my machine, "make check FORCE=FORCE" passes with
    BAT> this patch.



    BAT> [...]
    >> For now, I will ignore this second patch.
    >> 
    >> - it does bloat the code slightly (as you conceded)

    BAT> Fair enough. :) I also proved my point that more
    BAT> complicated code is harder to maintain.  In the two
    BAT> parameter case I was testing twice na for being one
    BAT> instead of testing na and nb.......

    BAT> [...]
    >> but most importantly:
    >> 
    >> - we have no idea if the speedup (when <Simple> is TRUE)
    >> is in the order of 10%, 1% or 0.1%
    >> 
    >> My guess would be '0.1%' for rnorm(), and that would
    >> definitely not warrant the extra check.

    BAT> I would not bet against this.  Probably even with all
    BAT> the additional checks for finiteness of parameters
    BAT> there would be not much speed difference.  The question
    BAT> might be whether you want to replace the (new)
    BAT> R_FINITE()'s rather by ISNA()'s (or something else).
    BAT> One could also discuss in which order the checks should
    BAT> be made (first generated number then parameters of
    BAT> distribution or vice versa).  But I will leave this to
    BAT> R-core to decide. :)

    >> >> Thank you Berwin, for your contribution!
    >> 
    >> and thanks again!

    BAT> Still my pleasure. :)

    BAT> Cheers,

    BAT> 	Berwin Index: src/main/random.c
    BAT> ===================================================================
    BAT> --- src/main/random.c (revision 44693) +++
    BAT> src/main/random.c (working copy) @@ -44,7 +44,7 @@ for
    BAT> (i = 0; i < n; i++) { ai = a[i % na]; x[i] = f(ai); -
    BAT> if (!R_FINITE(x[i])) naflag = 1; + if (!R_FINITE(x[i])
    BAT> && R_FINITE(ai)) naflag = 1; } return(naflag); } @@
    BAT> -81,6 +81,7 @@ if (na < 1) { for (i = 0; i < n; i++)
    BAT> REAL(x)[i] = NA_REAL; + warning(_("NAs produced")); }
    BAT> else { PROTECT(a = coerceVector(CADR(args), REALSXP));
    BAT> @@ -116,14 +117,14 @@ ai = a[i % na]; bi = b[i % nb];
    BAT> x[i] = f(ai, bi); - if (!R_FINITE(x[i])) naflag = 1; +
    BAT> if (!R_FINITE(x[i]) && R_FINITE(ai) && R_FINITE(bi))
    BAT> naflag = 1; } return(naflag); }
 
    BAT>  #define RAND2(num,name) \ case num: \ - random2(name,
    BAT> REAL(a), na, REAL(b), nb, REAL(x), n); \ + naflag =
    BAT> random2(name, REAL(a), na, REAL(b), nb, REAL(x), n); \
    BAT> break
 
    BAT>  /* "do_random2" - random sampling from 2 parameter
    BAT> families. */ @@ -155,6 +156,7 @@ if (na < 1 || nb < 1)
    BAT> { for (i = 0; i < n; i++) REAL(x)[i] = NA_REAL; +
    BAT> warning(_("NAs produced")); } else { PROTECT(a =
    BAT> coerceVector(CADR(args), REALSXP)); @@ -200,14 +202,14
    BAT> @@ bi = b[i % nb]; ci = c[i % nc]; x[i] = f(ai, bi,
    BAT> ci); - if (!R_FINITE(x[i])) naflag = TRUE; + if
    BAT> (!R_FINITE(x[i]) && R_FINITE(ai) && R_FINITE(bi) &&
    BAT> R_FINITE(ci)) naflag = TRUE; } return(naflag); }
 
    BAT>  #define RAND3(num,name) \ case num: \ - random3(name,
    BAT> REAL(a), na, REAL(b), nb, REAL(c), nc, REAL(x), n); \ +
    BAT> naflag = random3(name, REAL(a), na, REAL(b), nb,
    BAT> REAL(c), nc, REAL(x), n); \ break
 
 
    BAT> @@ -244,6 +246,7 @@ if (na < 1 || nb < 1 || nc < 1) {
    BAT> for (i = 0; i < n; i++) REAL(x)[i] = NA_REAL; +
    BAT> warning(_("NAs produced")); } else { PROTECT(a =
    BAT> coerceVector(a, REALSXP));
    BAT> ______________________________________________
    BAT> R-devel at r-project.org mailing list
    BAT> https://stat.ethz.ch/mailman/listinfo/r-devel


From enrique.bengoechea at credit-suisse.com  Mon Mar 10 13:08:52 2008
From: enrique.bengoechea at credit-suisse.com (=?iso-8859-1?Q?Bengoechea_Bartolom=E9_Enrique_=28SIES_73=29?=)
Date: Mon, 10 Mar 2008 13:08:52 +0100
Subject: [Rd] extract function "[" and empty index
In-Reply-To: <mailman.17.1205146803.22205.r-devel@r-project.org>
References: <mailman.17.1205146803.22205.r-devel@r-project.org>
Message-ID: <19811401A1D8174CB3EAD7F6072E9B50012AA4C2@chsa1025.share.beluni.net>

Beware x[TRUE] returns the same as x[] only if x is NOT a zero-length vector (at least until R 2.5.1):

> numeric(0)[]
numeric(0)

> numeric(0)[TRUE]
[1] NA


Enrique

> -----Original Message-----
> ------------------------------
> 
> Message: 7
> Date: Mon, 10 Mar 2008 02:29:32 +0800
> From: "Laurent Gautier" <lgautier at gmail.com>
> Subject: Re: [Rd] extract function "[" and empty index
> To: "Gabor Grothendieck" <ggrothendieck at gmail.com>
> Cc: r-devel at r-project.org
> Message-ID:
> 	<27d1e6020803091129h19bbf3ffu1265ecd04b35993 at mail.gmail.com>
> Content-Type: text/plain; charset=ISO-8859-1
> 
> Thanks, I was forgetting the recycling rule.
> 
> 
> L.
> 
> 
> 2008/3/9, Gabor Grothendieck <ggrothendieck at gmail.com>:
> > Use TRUE.
> >
> >
> >  On Sun, Mar 9, 2008 at 5:05 AM, Laurent Gautier 
> <lgautier at gmail.com> wrote:
> >  > Dear list,
> >  >
> >  > I am having a question regarding the extract function "[".
> >  >
> >  > The man page says that one usage with k-dimensional arrays is to
> >  > specify k indices to "[", with an empty index indicating that all
> >  > entries in that dimension are selected.
> >  >
> >  > The question is the following: is there an R object 
> qualifying as an
> >  > "empty index" ? I understand that the lazy evaluation of 
> parameters
> >  > allows one to
> >  > have genuinely missing parameters, but I would like to 
> have an object
> >  > instead. I understand that one can always have an 
> if/else workaround,
> >  > but I thought should ask, just in case.
> >  >
> >  > I tried with NULL but with little success, as it appears 
> to give the
> >  > same results
> >  > as an empty vector.
> >  > > m = matrix(1, 2, 2)
> >  > > m[1, NULL]
> >  > numeric(0)
> >  > > m[1, integer(0)]
> >  > numeric(0)
> >  >
> >  > Since I was at it, I noted that the result obtained with 
> "numeric(0)"
> >  > definitely makes sense but could as well be seen as 
> challenging the
> >  > concept of an empty index presented in the man page (One 
> could somehow
> >  > expect the presence of an object  meaning "everything" 
> rather than
> >  > "missingness" meaning it).
> >  >
> >  >
> >  > Thanks,
> >  >
> >  >
> >  > Laurent
> >  >
> >
> > > ______________________________________________
> >  > R-devel at r-project.org mailing list
> >  > https://stat.ethz.ch/mailman/listinfo/r-devel
> >  >
> >
> 
> 
> -- 


From r.hankin at noc.soton.ac.uk  Mon Mar 10 13:17:32 2008
From: r.hankin at noc.soton.ac.uk (Robin Hankin)
Date: Mon, 10 Mar 2008 12:17:32 +0000
Subject: [Rd] Re Bessel functions of complex argument
In-Reply-To: <alpine.LFD.1.00.0803101056320.6210@gannet.stats.ox.ac.uk>
References: <2CFB86B5-515C-4968-811C-E2F8716D13DB@ex.ac.uk>
	<73ED823A-9F13-4852-A708-633BEA1BE235@noc.soton.ac.uk>
	<18389.3354.944541.776906@stat.math.ethz.ch>
	<alpine.LFD.1.00.0803101056320.6210@gannet.stats.ox.ac.uk>
Message-ID: <062CF2ED-7499-4CFE-8103-FA5C4C65DA99@noc.soton.ac.uk>


On 10 Mar 2008, at 11:03, Prof Brian Ripley wrote:

> On Mon, 10 Mar 2008, Martin Maechler wrote:
>
>> {Diverted from an R-help thread}
>>
>>>>>>> "Robin" == Robin Hankin <r.hankin at noc.soton.ac.uk>
>>>>>>>    on Mon, 10 Mar 2008 08:49:06 +0000 writes:
>>
>>   Robin> Hello Baptiste Bessel functions with complex
>>   Robin> arguments are not supported in R.
>>
>> Hi Robin,
>> have you looked at *how* pari/gp does this?
>> If they have a C routine, it might be worth considering to add
>> ``the'' complex Bessel functionality to R.
>
> To an R package, surely?  They hardly seem important enough for base  
> R.
>
> There are C implementations in several places, e.g. ACM algorithm  
> 644 (also netlib.org/amos).
>


Thanks for this.  I'll have a look at netlib.  Perhaps a wrapper for  
netlib,
  along the lines of  the gsl package, would be possible.  I also need
the gamma function with complex  arguments and I suspect
that this is included.

PARI/GP  is a large multi-developer effort, and provides an
environment not unlike R but geared towards pure mathematics rather
than statistics.  It includes arbitrary-precision arithmetic and many
pure maths constructs such as number theory and p-adic metrics.

(I must confess to being not terribly familiar with the
Bessel suite; I only  really know about PARI/GP's  elliptic  
functions).  There
is no easy way to access the  code  for any specific functionality
in isolation, AFAICS.

One of my "longer-term" plans is to write a package that includes
a wrapper for GP (PARI is the front end, a command line wrapper) but
this is not entirely straightforward. Implementing a useful wrapper  
proved
to be rather tricky.  I expected that  the methodology would
approximate the gsl package but this was not the case:
many of the features of PARI/GP are alien to the precepts and
tenets of R.   My attempts stalled a couple of years ago after
I finished the elliptic package which included a fit-for-purpose, but
very very basic, wrapper for two or three functions.

Notwithstanding this, I think that an R wrapper for PARI/GP would
be very desirable.   Comments anyone?





--
Robin Hankin
Uncertainty Analyst and Neutral Theorist,
National Oceanography Centre, Southampton
European Way, Southampton SO14 3ZH, UK
  tel  023-8059-7743


From murdoch at stats.uwo.ca  Mon Mar 10 13:51:23 2008
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Mon, 10 Mar 2008 08:51:23 -0400
Subject: [Rd] [patch] add=TRUE in plot.default()
In-Reply-To: <20080309215833.GH23544@econ.upenn.edu>
References: <20080309031119.GC23544@econ.upenn.edu>	<47D40C41.1000202@stats.uwo.ca>	<20080309164639.GF23544@econ.upenn.edu>	<47D442B8.10501@stats.uwo.ca>
	<20080309215833.GH23544@econ.upenn.edu>
Message-ID: <47D52ECB.8000709@stats.uwo.ca>

On 3/9/2008 5:58 PM, Andrew Clausen wrote:
> On Sun, Mar 09, 2008 at 04:04:08PM -0400, Duncan Murdoch wrote:
>> Part of the reason I didn't like your patch is that it was incomplete: 
>> it didn't patch the plot.default.Rd file.
> 
> Fair enough -- I wasn't sure whether I was fixing a bug or not.  ("..."
> spreads the documentation around a bit.)
> 
>> That function already has 
>> around 16 parameters; do we really want to add another one, that 
>> interacts with some of the ones that are there?
> 
> Yes.  The ability to plot things on top of each other is important.
> The simplicity created by having a single interface for adding to plots
> outweighs the complexity of yet another parameter.
> 
> The add parameter only interacts with other parameters superficially --
> some parameters of "plot" (like log) are related to the shape of the axes,
> and should be inherited from what is on the plot already.

I'd say causing some parameters to be completely ignored without a 
warning is more than a superficial interaction.  Really, add=TRUE is not 
a great design:  it would be better to say "plot methods draw a new 
plot" (so they need args for all the decorations like axes, titles, 
etc.), and have other ways to add things to plots.  Hadley was right on 
this, his ggplot2 has a better thought-out design than classic graphics. 
   However, we have what we have.

>> What you really seem to want is to add it to the generic plot(),
> 
> Agreed.
> 
>> but it's way too late to go modifying that particular generic.
> 
> I agree.  Adding an "add=FALSE" parameter to plot() would generate errors for
> methods that don't implement it, so they would all have to be changed
> simultaneously, including in private/unreleased code.
> 
> So I'd like to settle for second best: adding add=FALSE parameters to many plot
> methods.

I like that suggestion better than adding it here and there, one at a 
time.  So, to advance the discussion:  can you take a look at the plot 
methods that are in the base and recommended packages, and work out how 
many already have it, how many would be improved if it was added, and in 
how many cases it just wouldn't make sense?  (You could also do this on 
all the CRAN and Bioconductor packages, but that would be about 100 
times more work: about 50 times as many packages, and much less 
consistency in the programming and documentation standards.  Maybe on a 
subset of popular ones, e.g. those that Rcmdr suggests?)

Data like that could make a convincing argument that the effort of 
adding this to the base packages is worthwhile.  (To get it added to 
non-base packages will require you to convince their maintainers that 
it's a good idea.)  Another helpful part of the argument will be for you 
to volunteer to do the work of both code and documentation updates.

Duncan Murdoch


From ripley at stats.ox.ac.uk  Mon Mar 10 14:32:31 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 10 Mar 2008 13:32:31 +0000 (GMT)
Subject: [Rd] Bindings for updated widgets in Tk 8.5.x
Message-ID: <alpine.LFD.1.00.0803100915260.7453@gannet.stats.ox.ac.uk>

Tk 8.5.x is starting to trickle down to Linux distributions and the next 
release of R for Windows will ship with 8.5.1 (the binary builds of 
R-devel already do).

According to http://www.tkdocs.com the new themed widget set has much to 
recommend it, and it certainly looks much better on MacOS and Windows.

I've added bindings to package tcltk for R-devel, and taken a quick look 
at what would be needed to convert package Rcmdr to make use of them.  in 
many uses they are a drop-in replacement (e.g. ttkbutton for tkbutton), 
but some of the customizations (fg="red") have different names 
(foreground="red", which also works for tkbutton) and others are replaced 
by the theme.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From Peter.Rossi at chicagogsb.edu  Mon Mar 10 18:29:14 2008
From: Peter.Rossi at chicagogsb.edu (Rossi, Peter E.)
Date: Mon, 10 Mar 2008 12:29:14 -0500
Subject: [Rd] Check errors using R2.6.2
Message-ID: <FC7768358736E54AB330E0B99FFB5E1F567135@GSBHEX2V.gsb.uchicago.edu>

I can successfully "check" a package with source under 2.5.1, including
compiling source files and running examples with no errors or warnings.

when I try with R2.6.2, I get make errors:

making bayesmc.d from bayesmc.c
make[3]:gcc-sjlj: Command not found

etc.

my gcc is version 3.4.2

I'm using Windows XP.

Any thoughts?

thanks!

peter r


................................
 Peter E. Rossi
 Joseph T. and Bernice S. Lewis Professor of Marketing and Statistics
 Director, Kilts Center for Marketing
 Editor, Quantitative Marketing and Economics
 Rm 353, Graduate School of Business, U of Chicago
 5807 S. Woodlawn Ave, Chicago IL 60637
 Tel: (773) 702-7513   |   Fax: (773) 834-2081 
 WWW: http://ChicagoGsb.edu/fac/peter.rossi
 SSRN: http://ssrn.com/author=22862


From ligges at statistik.tu-dortmund.de  Mon Mar 10 18:38:33 2008
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Mon, 10 Mar 2008 18:38:33 +0100
Subject: [Rd] Check errors using R2.6.2
In-Reply-To: <FC7768358736E54AB330E0B99FFB5E1F567135@GSBHEX2V.gsb.uchicago.edu>
References: <FC7768358736E54AB330E0B99FFB5E1F567135@GSBHEX2V.gsb.uchicago.edu>
Message-ID: <47D57219.5010608@statistik.tu-dortmund.de>



Rossi, Peter E. wrote:
> I can successfully "check" a package with source under 2.5.1, including
> compiling source files and running examples with no errors or warnings.
> 
> when I try with R2.6.2, I get make errors:
> 
> making bayesmc.d from bayesmc.c
> make[3]:gcc-sjlj: Command not found
> 
> etc.
> 
> my gcc is version 3.4.2
> 
> I'm using Windows XP.
> 
> Any thoughts?

Yes: Upgrade gcc as the R Administration and Installation manual 
suggets. R >= 2.6.0 is built under gcc-4.2.1.

Uwe Ligges


> 
> thanks!
> 
> peter r
> 
> 
> ................................
>  Peter E. Rossi
>  Joseph T. and Bernice S. Lewis Professor of Marketing and Statistics
>  Director, Kilts Center for Marketing
>  Editor, Quantitative Marketing and Economics
>  Rm 353, Graduate School of Business, U of Chicago
>  5807 S. Woodlawn Ave, Chicago IL 60637
>  Tel: (773) 702-7513   |   Fax: (773) 834-2081 
>  WWW: http://ChicagoGsb.edu/fac/peter.rossi
>  SSRN: http://ssrn.com/author=22862
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From mtmorgan at fhcrc.org  Mon Mar 10 19:01:25 2008
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Mon, 10 Mar 2008 11:01:25 -0700
Subject: [Rd] write.table with row.names=FALSE unnecessarily slow?
Message-ID: <6phabl6jw5m.fsf@gopher4.fhcrc.org>

write.table with large data frames takes quite a long time

> system.time({
+     write.table(df, '/tmp/dftest.txt', row.names=FALSE)
+ }, gcFirst=TRUE)
   user  system elapsed 
 97.302   1.532  98.837 

A reason is because dimnames is always called, causing 'anonymous' row
names to be created as character vectors. Avoiding this in
src/library/utils, along the lines of

Index: write.table.R
===================================================================
--- write.table.R	(revision 44717)
+++ write.table.R	(working copy)
@@ -27,13 +27,18 @@
 
     if(!is.data.frame(x) && !is.matrix(x)) x <- data.frame(x)
 
+    makeRownames <- is.logical(row.names) && !is.na(row.names) &&
+                    row.names==TRUE
+    makeColnames <- is.logical(col.names) && !is.na(col.names) &&
+                    col.names==TRUE
     if(is.matrix(x)) {
         ## fix up dimnames as as.data.frame would
         p <- ncol(x)
         d <- dimnames(x)
         if(is.null(d)) d <- list(NULL, NULL)
-        if(is.null(d[[1]])) d[[1]] <- seq_len(nrow(x))
-        if(is.null(d[[2]]) && p > 0) d[[2]] <-  paste("V", 1:p, sep="")
+        if (is.null(d[[1]]) && makeRownames) d[[1]] <- seq_len(nrow(x))
+        if(is.null(d[[2]]) && p > 0 && makeColnames)
+            d[[2]] <-  paste("V", 1:p, sep="")
         if(is.logical(quote) && quote)
             quote <- if(is.character(x)) seq_len(p) else numeric(0)
     } else {
@@ -53,8 +58,8 @@
                 quote <- ord[quote]; quote <- quote[quote > 0]
             }
         }
-        d <- dimnames(x)
-        if(is.null(d[[1]])) d[[1]] <- seq_len(nrow(x))
+        d <- list(if (makeRownames==TRUE) row.names(x) else NULL,
+                  if (makeColnames==TRUE) names(x) else NULL)
         p <- ncol(x)
     }
     nocols <- p==0

improves performance at least in proportion to nrow(x):

> system.time({
+     write.table(df, '/tmp/dftest1.txt', row.names=FALSE)
+ }, gcFirst=TRUE)
   user  system elapsed 
  8.132   0.608   8.899 

Martin
-- 
Martin Morgan
Computational Biology / Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N.
PO Box 19024 Seattle, WA 98109

Location: Arnold Building M2 B169
Phone: (206) 667-2793


From mtmorgan at fhcrc.org  Mon Mar 10 19:07:54 2008
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Mon, 10 Mar 2008 11:07:54 -0700
Subject: [Rd] write.table with row.names=FALSE unnecessarily slow?
In-Reply-To: <6phabl6jw5m.fsf@gopher4.fhcrc.org> (Martin Morgan's message of
	"Mon, 10 Mar 2008 11:01:25 -0700")
References: <6phabl6jw5m.fsf@gopher4.fhcrc.org>
Message-ID: <6ph63vujvut.fsf@gopher4.fhcrc.org>

I neglected to include my test case,

> df <- data.frame(x=1:(10^7))

Martin

Martin Morgan <mtmorgan at fhcrc.org> writes:

> write.table with large data frames takes quite a long time
>
>> system.time({
> +     write.table(df, '/tmp/dftest.txt', row.names=FALSE)
> + }, gcFirst=TRUE)
>    user  system elapsed 
>  97.302   1.532  98.837 
>
> A reason is because dimnames is always called, causing 'anonymous' row
> names to be created as character vectors. Avoiding this in
> src/library/utils, along the lines of
>
> Index: write.table.R
> ===================================================================
> --- write.table.R	(revision 44717)
> +++ write.table.R	(working copy)
> @@ -27,13 +27,18 @@
>  
>      if(!is.data.frame(x) && !is.matrix(x)) x <- data.frame(x)
>  
> +    makeRownames <- is.logical(row.names) && !is.na(row.names) &&
> +                    row.names==TRUE
> +    makeColnames <- is.logical(col.names) && !is.na(col.names) &&
> +                    col.names==TRUE
>      if(is.matrix(x)) {
>          ## fix up dimnames as as.data.frame would
>          p <- ncol(x)
>          d <- dimnames(x)
>          if(is.null(d)) d <- list(NULL, NULL)
> -        if(is.null(d[[1]])) d[[1]] <- seq_len(nrow(x))
> -        if(is.null(d[[2]]) && p > 0) d[[2]] <-  paste("V", 1:p, sep="")
> +        if (is.null(d[[1]]) && makeRownames) d[[1]] <- seq_len(nrow(x))
> +        if(is.null(d[[2]]) && p > 0 && makeColnames)
> +            d[[2]] <-  paste("V", 1:p, sep="")
>          if(is.logical(quote) && quote)
>              quote <- if(is.character(x)) seq_len(p) else numeric(0)
>      } else {
> @@ -53,8 +58,8 @@
>                  quote <- ord[quote]; quote <- quote[quote > 0]
>              }
>          }
> -        d <- dimnames(x)
> -        if(is.null(d[[1]])) d[[1]] <- seq_len(nrow(x))
> +        d <- list(if (makeRownames==TRUE) row.names(x) else NULL,
> +                  if (makeColnames==TRUE) names(x) else NULL)
>          p <- ncol(x)
>      }
>      nocols <- p==0
>
> improves performance at least in proportion to nrow(x):
>
>> system.time({
> +     write.table(df, '/tmp/dftest1.txt', row.names=FALSE)
> + }, gcFirst=TRUE)
>    user  system elapsed 
>   8.132   0.608   8.899 
>
> Martin
> -- 
> Martin Morgan
> Computational Biology / Fred Hutchinson Cancer Research Center
> 1100 Fairview Ave. N.
> PO Box 19024 Seattle, WA 98109
>
> Location: Arnold Building M2 B169
> Phone: (206) 667-2793
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Martin Morgan
Computational Biology / Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N.
PO Box 19024 Seattle, WA 98109

Location: Arnold Building M2 B169
Phone: (206) 667-2793


From ripley at stats.ox.ac.uk  Mon Mar 10 19:11:46 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 10 Mar 2008 18:11:46 +0000 (GMT)
Subject: [Rd] Check errors using R2.6.2
In-Reply-To: <47D57219.5010608@statistik.tu-dortmund.de>
References: <FC7768358736E54AB330E0B99FFB5E1F567135@GSBHEX2V.gsb.uchicago.edu>
	<47D57219.5010608@statistik.tu-dortmund.de>
Message-ID: <alpine.LFD.1.00.0803101809370.17272@gannet.stats.ox.ac.uk>

On Mon, 10 Mar 2008, Uwe Ligges wrote:

>
>
> Rossi, Peter E. wrote:
>> I can successfully "check" a package with source under 2.5.1, including
>> compiling source files and running examples with no errors or warnings.
>>
>> when I try with R2.6.2, I get make errors:
>>
>> making bayesmc.d from bayesmc.c
>> make[3]:gcc-sjlj: Command not found
>>
>> etc.
>>
>> my gcc is version 3.4.2
>>
>> I'm using Windows XP.
>>
>> Any thoughts?
>
> Yes: Upgrade gcc as the R Administration and Installation manual
> suggets. R >= 2.6.0 is built under gcc-4.2.1.

Alternatively, read the MkRules file and set the macros as needed for your 
compiler (as the manual suggested).

However, gcc 3.4.2 is ancient and has known bugs that means it cannot even 
compile R correctly on Windows.  If you must use gcc 3, at least use 
3.4.5.


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From peter.rossi at chicagogsb.edu  Mon Mar 10 19:30:19 2008
From: peter.rossi at chicagogsb.edu (Rossi, Peter E.)
Date: Mon, 10 Mar 2008 13:30:19 -0500
Subject: [Rd] Check errors using R2.6.2
In-Reply-To: <alpine.LFD.1.00.0803101809370.17272@gannet.stats.ox.ac.uk>
References: <FC7768358736E54AB330E0B99FFB5E1F567135@GSBHEX2V.gsb.uchicago.edu>
	<47D57219.5010608@statistik.tu-dortmund.de>
	<alpine.LFD.1.00.0803101809370.17272@gannet.stats.ox.ac.uk>
Message-ID: <FC7768358736E54AB330E0B99FFB5E1F56714D@GSBHEX2V.gsb.uchicago.edu>

great. sorry to have bothered.

btw, the MinGW windows .exe installer installs 3.4.5 not 4.2.1 so you
have
to download the untar the files one by one from sourceforge.

moving to Leopard soon so, hopefully, this garbage will go away.

p

................................
 Peter E. Rossi
 Joseph T. and Bernice S. Lewis Professor of Marketing and Statistics
 Director, Kilts Center for Marketing
 Editor, Quantitative Marketing and Economics
 Rm 353, Graduate School of Business, U of Chicago
 5807 S. Woodlawn Ave, Chicago IL 60637
 Tel: (773) 702-7513   |   Fax: (773) 834-2081 
 WWW: http://ChicagoGsb.edu/fac/peter.rossi
 SSRN: http://ssrn.com/author=22862

-----Original Message-----
From: Prof Brian Ripley [mailto:ripley at stats.ox.ac.uk] 
Sent: Monday, March 10, 2008 1:12 PM
To: Uwe Ligges
Cc: Rossi, Peter E.; r-devel at r-project.org
Subject: Re: [Rd] Check errors using R2.6.2

On Mon, 10 Mar 2008, Uwe Ligges wrote:

>
>
> Rossi, Peter E. wrote:
>> I can successfully "check" a package with source under 2.5.1,
including
>> compiling source files and running examples with no errors or
warnings.
>>
>> when I try with R2.6.2, I get make errors:
>>
>> making bayesmc.d from bayesmc.c
>> make[3]:gcc-sjlj: Command not found
>>
>> etc.
>>
>> my gcc is version 3.4.2
>>
>> I'm using Windows XP.
>>
>> Any thoughts?
>
> Yes: Upgrade gcc as the R Administration and Installation manual
> suggets. R >= 2.6.0 is built under gcc-4.2.1.

Alternatively, read the MkRules file and set the macros as needed for
your 
compiler (as the manual suggested).

However, gcc 3.4.2 is ancient and has known bugs that means it cannot
even 
compile R correctly on Windows.  If you must use gcc 3, at least use 
3.4.5.


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Mon Mar 10 19:40:37 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 10 Mar 2008 18:40:37 +0000 (GMT)
Subject: [Rd] Check errors using R2.6.2
In-Reply-To: <FC7768358736E54AB330E0B99FFB5E1F56714D@GSBHEX2V.gsb.uchicago.edu>
References: <FC7768358736E54AB330E0B99FFB5E1F567135@GSBHEX2V.gsb.uchicago.edu>
	<47D57219.5010608@statistik.tu-dortmund.de>
	<alpine.LFD.1.00.0803101809370.17272@gannet.stats.ox.ac.uk>
	<FC7768358736E54AB330E0B99FFB5E1F56714D@GSBHEX2V.gsb.uchicago.edu>
Message-ID: <alpine.LFD.1.00.0803101839120.27382@gannet.stats.ox.ac.uk>

On Mon, 10 Mar 2008, Rossi, Peter E. wrote:

> great. sorry to have bothered.
>
> btw, the MinGW windows .exe installer installs 3.4.5 not 4.2.1 so you
> have

What installer?  *We* provide one with both in, and document it in the 
manual.

> to download the untar the files one by one from sourceforge.
>
> moving to Leopard soon so, hopefully, this garbage will go away.

No, Leopard also does not come with the tools you need (like a Fortran 
compiler).

> p
>
> ................................
> Peter E. Rossi
> Joseph T. and Bernice S. Lewis Professor of Marketing and Statistics
> Director, Kilts Center for Marketing
> Editor, Quantitative Marketing and Economics
> Rm 353, Graduate School of Business, U of Chicago
> 5807 S. Woodlawn Ave, Chicago IL 60637
> Tel: (773) 702-7513   |   Fax: (773) 834-2081
> WWW: http://ChicagoGsb.edu/fac/peter.rossi
> SSRN: http://ssrn.com/author=22862
>
> -----Original Message-----
> From: Prof Brian Ripley [mailto:ripley at stats.ox.ac.uk]
> Sent: Monday, March 10, 2008 1:12 PM
> To: Uwe Ligges
> Cc: Rossi, Peter E.; r-devel at r-project.org
> Subject: Re: [Rd] Check errors using R2.6.2
>
> On Mon, 10 Mar 2008, Uwe Ligges wrote:
>
>>
>>
>> Rossi, Peter E. wrote:
>>> I can successfully "check" a package with source under 2.5.1,
> including
>>> compiling source files and running examples with no errors or
> warnings.
>>>
>>> when I try with R2.6.2, I get make errors:
>>>
>>> making bayesmc.d from bayesmc.c
>>> make[3]:gcc-sjlj: Command not found
>>>
>>> etc.
>>>
>>> my gcc is version 3.4.2
>>>
>>> I'm using Windows XP.
>>>
>>> Any thoughts?
>>
>> Yes: Upgrade gcc as the R Administration and Installation manual
>> suggets. R >= 2.6.0 is built under gcc-4.2.1.
>
> Alternatively, read the MkRules file and set the macros as needed for
> your
> compiler (as the manual suggested).
>
> However, gcc 3.4.2 is ancient and has known bugs that means it cannot
> even
> compile R correctly on Windows.  If you must use gcc 3, at least use
> 3.4.5.
>
>
> --
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From statba at nus.edu.sg  Tue Mar 11 06:19:46 2008
From: statba at nus.edu.sg (Berwin A Turlach)
Date: Tue, 11 Mar 2008 13:19:46 +0800
Subject: [Rd] NA warnings for r<distr>() {aka "patch for random.c"}
In-Reply-To: <18389.5657.301160.608130@stat.math.ethz.ch>
References: <20080229181940.457c9bf7@berwin-nus1>
	<18379.49661.242974.779574@stat.math.ethz.ch>
	<20080305202624.7f1c54ea@berwin-nus1>
	<18385.19126.4852.755058@stat.math.ethz.ch>
	<20080307235406.21f5649b@absentia>
	<18389.5657.301160.608130@stat.math.ethz.ch>
Message-ID: <20080311131946.3e2b8945@berwin-nus1>

G'day Martin and others,

On Mon, 10 Mar 2008 12:06:01 +0100
Martin Maechler <maechler at stat.math.ethz.ch> wrote:

> >>>>> "BAT" == Berwin A Turlach <statba at nus.edu.sg>
> >>>>>     on Fri, 7 Mar 2008 23:54:06 +0800 writes:
>
>     BAT> After all,
> 
>     >> 1:2 + Inf
>     BAT> [1] Inf Inf
> 
>     BAT> does not create any warning either.  
> 
> but it doesn't give NA either.
> A bit more relevant (and I'm sure you meant implicitly)

You give me more credit than I deserve. :)
I was guided by what rexp() was doing when I chose that example, i.e.
(potentially) warning about NAs being created when actually +/- Infs
were created. In this thread I was already once or twice tempted to
comment on the appropriateness of the warning message but for various
reasonx always refrained from doing so.  

> BTW, I've also found that I  
>      rnorm(n, mu=Inf) |--> NA  was not ok, and changed that to
>      rnorm(n, mu=Inf) |--> Inf
> 
> More feedback is welcome,
> but please now "start" with R-devel rev >= 44715

While I agree with this change, I think it opens a whole can of worms,
since it invites a rethink about all distributions.  At the moment
we have:

<snip>
R version 2.7.0 Under development (unstable) (2008-03-10 r44730)
<snip>
> set.seed(1) ; exp(rnorm(2))
[1] 0.5344838 1.2015872
> set.seed(1) ; rlnorm(2)
[1] 0.5344838 1.2015872
> set.seed(1) ; exp(rnorm(2, mean=c(-Inf,Inf)))
[1]   0 Inf
> set.seed(1) ; rlnorm(2, mean=c(-Inf,Inf))
[1] NaN NaN
Warning message:
In rlnorm(2, mean = c(-Inf, Inf)) : NAs produced

The first two lines give identical results, as one could reasonably
expect.  But the other two do not and I would argue that a user could
reasonably expect that the commands in these two lines should lead to
identical results.

Likewise, coming back to the one-parameter distribution used in this
thread for illustration purposes, the *exp() functions in R are
parameterised by the rate and an exponential random variable with rate
r has mean (1/r) and variance (1/r^2).  Thus, I would argue that
rexp(2, Inf) should return 0's and not NaN's, since in the limit
a rate of Inf seems to refer to a variable with mean 0 and variance 0,
i.e. the constant 0.  And it would also be "more consistent" with the
behaviour of rexp() when the rate parameter is "large but finite".

Then one can argue about rgeom() when p=0.  But I guess in that case
the limit is a "random" variable with "infinite mean" and "infinite
variance" and hence it is o.k. to return NaNs and not Infs.  After all,
your comments in rnorm.c seem to indicate that you think that reporting
+/- Inf back is only o.k. if the mean is +/- Inf but the variance is
finite.

I did not look at (or think about) extreme cases for any other
distributions, but further discussion/feedback would indeed be helpful
it seems. :)

And the attached patch would address the behaviour of rlnorm() and
rexp() that I have raised above.  With these changes, on my machine,
"make check FORCE=FORCE" succeeds.

BTW, I was surprised to realise that the *exp() functions in the
underlying C code use the opposite parameterisation from the
corresponding functions at R level.  Perhaps it would be worthwhile to
point this out in section 6.7.1 of the Writing R extension manual?  In
particular since the manual states:

  Note that these argument sequences are (apart from the names and that
  @code{rnorm} has no @var{n}) exactly the same as the corresponding
  @R{} functions of the same name, so the documentation of the @R{}
  functions can be used.

Well, as I noticed the hard way, for *exp() the documentation of the
corresponding R functions cannot be used. ;-)

Thanks for you patience.

Cheers,
	
	Berwin


 
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: R-patch
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20080311/3aa1f5d2/attachment.pl 

From ripley at stats.ox.ac.uk  Tue Mar 11 11:28:26 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 11 Mar 2008 10:28:26 +0000 (GMT)
Subject: [Rd] write.table with row.names=FALSE unnecessarily slow?
In-Reply-To: <6ph63vujvut.fsf@gopher4.fhcrc.org>
References: <6phabl6jw5m.fsf@gopher4.fhcrc.org>
	<6ph63vujvut.fsf@gopher4.fhcrc.org>
Message-ID: <alpine.LFD.1.00.0803111013240.10997@gannet.stats.ox.ac.uk>

This is a pretty extreme case: why not use write() to write a single 
column?  (It's a bit faster than your patched timing.)

In a more realistic test of 10 columns of 1 million rows I see a speedup 
from 12.2 to 9.7 seconds.

So I'll add the patch, but think that significant speedups will be quite 
rare.

BTW, this seems to be one of the places where we are paying the price of 
the CHARSXP cache: system.time(as.character(1:1e7)) has got a lot slower.
Maybe some further tuning is called for.

On Mon, 10 Mar 2008, Martin Morgan wrote:

> I neglected to include my test case,
>
>> df <- data.frame(x=1:(10^7))
>
> Martin
>
> Martin Morgan <mtmorgan at fhcrc.org> writes:
>
>> write.table with large data frames takes quite a long time
>>
>>> system.time({
>> +     write.table(df, '/tmp/dftest.txt', row.names=FALSE)
>> + }, gcFirst=TRUE)
>>    user  system elapsed
>>  97.302   1.532  98.837
>>
>> A reason is because dimnames is always called, causing 'anonymous' row
>> names to be created as character vectors. Avoiding this in
>> src/library/utils, along the lines of
>>
>> Index: write.table.R
>> ===================================================================
>> --- write.table.R	(revision 44717)
>> +++ write.table.R	(working copy)
>> @@ -27,13 +27,18 @@
>>
>>      if(!is.data.frame(x) && !is.matrix(x)) x <- data.frame(x)
>>
>> +    makeRownames <- is.logical(row.names) && !is.na(row.names) &&
>> +                    row.names==TRUE
>> +    makeColnames <- is.logical(col.names) && !is.na(col.names) &&
>> +                    col.names==TRUE
>>      if(is.matrix(x)) {
>>          ## fix up dimnames as as.data.frame would
>>          p <- ncol(x)
>>          d <- dimnames(x)
>>          if(is.null(d)) d <- list(NULL, NULL)
>> -        if(is.null(d[[1]])) d[[1]] <- seq_len(nrow(x))
>> -        if(is.null(d[[2]]) && p > 0) d[[2]] <-  paste("V", 1:p, sep="")
>> +        if (is.null(d[[1]]) && makeRownames) d[[1]] <- seq_len(nrow(x))
>> +        if(is.null(d[[2]]) && p > 0 && makeColnames)
>> +            d[[2]] <-  paste("V", 1:p, sep="")
>>          if(is.logical(quote) && quote)
>>              quote <- if(is.character(x)) seq_len(p) else numeric(0)
>>      } else {
>> @@ -53,8 +58,8 @@
>>                  quote <- ord[quote]; quote <- quote[quote > 0]
>>              }
>>          }
>> -        d <- dimnames(x)
>> -        if(is.null(d[[1]])) d[[1]] <- seq_len(nrow(x))
>> +        d <- list(if (makeRownames==TRUE) row.names(x) else NULL,
>> +                  if (makeColnames==TRUE) names(x) else NULL)
>>          p <- ncol(x)
>>      }
>>      nocols <- p==0
>>
>> improves performance at least in proportion to nrow(x):
>>
>>> system.time({
>> +     write.table(df, '/tmp/dftest1.txt', row.names=FALSE)
>> + }, gcFirst=TRUE)
>>    user  system elapsed
>>   8.132   0.608   8.899
>>
>> Martin
>> --
>> Martin Morgan
>> Computational Biology / Fred Hutchinson Cancer Research Center
>> 1100 Fairview Ave. N.
>> PO Box 19024 Seattle, WA 98109
>>
>> Location: Arnold Building M2 B169
>> Phone: (206) 667-2793
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
> --
> Martin Morgan
> Computational Biology / Fred Hutchinson Cancer Research Center
> 1100 Fairview Ave. N.
> PO Box 19024 Seattle, WA 98109
>
> Location: Arnold Building M2 B169
> Phone: (206) 667-2793
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From OleF.Christensen at agrsci.dk  Mon Mar 10 09:25:28 2008
From: OleF.Christensen at agrsci.dk (Ole Fredslund Christensen)
Date: Mon, 10 Mar 2008 09:25:28 +0100
Subject: [Rd] crossprod is slower than t(AA)%*BB
Message-ID: <EA09C4B2B0F16E44B8F3311629493C0D03B26E69@DJFPOST01.djf.agrsci.dk>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20080310/cbeb4fa3/attachment.pl 

From uhkeller at web.de  Mon Mar 10 14:00:06 2008
From: uhkeller at web.de (uhkeller at web.de)
Date: Mon, 10 Mar 2008 14:00:06 +0100 (CET)
Subject: [Rd] Wishlist: Factor correlations in factanal (PR#10931)
Message-ID: <20080310130006.87CE62834157@mail.pubhealth.ku.dk>

Full_Name: Ulrich Keller
Version: 2.6.2
OS: Ubuntu 7.10
Submission from: (NULL) (158.64.77.190)


Most statistical packages report factor correlations for oblique factor
rotations. R's factanal() does not. John Fox posted some modifications to
R-devel back in 2005 that implement this, but unfortunately the changes were
never merged into the trunk. His post is here:

http://tolstoy.newcastle.edu.au/R/devel/05/06/1414.html


From ripley at stats.ox.ac.uk  Tue Mar 11 14:41:05 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 11 Mar 2008 13:41:05 +0000 (GMT)
Subject: [Rd] crossprod is slower than t(AA)%*BB
In-Reply-To: <EA09C4B2B0F16E44B8F3311629493C0D03B26E69@DJFPOST01.djf.agrsci.dk>
References: <EA09C4B2B0F16E44B8F3311629493C0D03B26E69@DJFPOST01.djf.agrsci.dk>
Message-ID: <alpine.LFD.1.00.0803111308020.14388@gannet.stats.ox.ac.uk>

Please, you can't compare calls starting with different memory settings
(and the garbage collector does adjust to recent usage).  Try 
them in the other order or in parallel sessions.

>From the times you quote it looks to me as if you would benefit from using 
an optimized BLAS.  Here are some results on a dual core 64-bit Linux 
system with the Goto BLAS and one thread, starting from the same point (a 
fresh session loading a saved workspace containing AA and BB)

> system.time(t(AA)%*%BB,gcFirst=TRUE)
    user  system elapsed
   4.304   0.046   4.351
> system.time(t(AA)%*%BB,gcFirst=TRUE)
    user  system elapsed
   5.026   0.053   5.082
> system.time(t(AA)%*%BB,gcFirst=TRUE)
    user  system elapsed
   4.992   0.033   5.028
> system.time(t(AA)%*%BB,gcFirst=TRUE)
    user  system elapsed
   4.979   0.043   5.026
> system.time(t(AA)%*%BB,gcFirst=TRUE)
    user  system elapsed
   5.012   0.030   5.046

and in another session

> system.time(crossprod(AA,BB),gcFirst=TRUE)
    user  system elapsed
   4.616   0.026   4.644
> system.time(crossprod(AA,BB),gcFirst=TRUE)
    user  system elapsed
   4.791   0.000   4.817
> system.time(crossprod(AA,BB),gcFirst=TRUE)
    user  system elapsed
   4.764   0.000   4.779
> system.time(crossprod(AA,BB),gcFirst=TRUE)
    user  system elapsed
   4.092   0.000   4.095
> system.time(crossprod(AA,BB),gcFirst=TRUE)
    user  system elapsed
   4.824   0.000   4.834

Note how there is a lot of variability depending on the initial memory 
state.  I would be surprised if the differences you are seeing exceed the 
reproducibilty spreads.

BTW: gcFirst=TRUE is the default, and I get a considerable speed up (but 
even more variability) by allowing multiple threads.


On Mon, 10 Mar 2008, Ole Fredslund Christensen wrote:

> Dear Rdevelopers
>
> The background for this email is that I was helping a PhD student to
> improve the speed of her R code. I suggested to replace calls like
> t(AA)%*% BB by crossprod(AA,BB) since I expected this to be faster. The
> surprising result to me was that this change actually made her code
> slower.
>
>
>> ## Examples :
>>
>> AA <- matrix(rnorm(3000*1000),3000,1000)
>> BB <- matrix(rnorm(3000^2),3000,3000)
>> system.time(crossprod(AA,BB),gcFirst=TRUE)
>   user  system elapsed
>  24.58    0.06   24.69
>> system.time(t(AA)%*%BB,gcFirst=TRUE)
>   user  system elapsed
>  23.25    0.04   23.32
>>
>>
>> AA <- matrix(rnorm(2000^2),2000,2000)
>> BB <- matrix(rnorm(2000^2),2000,2000)
>> system.time(crossprod(AA,BB),gcFirst=TRUE)
>   user  system elapsed
>  21.94    0.03   21.98
>> system.time(t(AA)%*%BB,gcFirst=TRUE)
>   user  system elapsed
>  21.16    0.02   21.19
>>
>>
>> version
>               _
> platform       i386-pc-mingw32
> arch           i386
> os             mingw32
> system         i386, mingw32
> status
> major          2
> minor          6.2
> year           2008
> month          02
> day            08
> svn rev        44383
> language       R
> version.string R version 2.6.2 (2008-02-08)
>
>
> Clearly there are many examples where crossprod is indeed faster than
> t(x)%*%y,
> but I suggest to change the wording in the help file for crossprod such
> that it says
> ".... formally equivalent (but often faster than) the call t(x)%*%y ...
> ".
>
>
> Yours
>
> Ole Christensen
>
>
>
>
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From maechler at stat.math.ethz.ch  Tue Mar 11 17:21:13 2008
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Tue, 11 Mar 2008 17:21:13 +0100
Subject: [Rd] write.table with row.names=FALSE unnecessarily slow?
In-Reply-To: <6phabl6jw5m.fsf@gopher4.fhcrc.org>
References: <6phabl6jw5m.fsf@gopher4.fhcrc.org>
Message-ID: <18390.45433.449059.151132@stat.math.ethz.ch>


    MartinMo> write.table with large data frames takes quite a long time
    MartinMo> system.time({
    MartinMo> +     write.table(df, '/tmp/dftest.txt', row.names=FALSE)
    MartinMo> + }, gcFirst=TRUE)
    MartinMo> user  system elapsed 
    MartinMo> 97.302   1.532  98.837 

    MartinMo> A reason is because dimnames is always called, causing 'anonymous' row
    MartinMo> names to be created as character vectors. Avoiding this in
    MartinMo> src/library/utils, along the lines of

Thank you, Martin.

Note that we needed to fix your patch 
(for the case where the dataframe has 'matrix column'),

and I'd like to further remark that I consider
 '.... == TRUE '
to be quite ugly (or inefficient) in all circumstances.

Martin Maechler, ETH Zurich



Index: write.table.R
===================================================================
--- write.table.R	(revision 44717)
+++ write.table.R	(working copy)
@@ -27,13 +27,18 @@
 
     if(!is.data.frame(x) && !is.matrix(x)) x <- data.frame(x)
 
+    makeRownames <- is.logical(row.names) && !is.na(row.names) &&
+                    row.names==TRUE
+    makeColnames <- is.logical(col.names) && !is.na(col.names) &&
+                    col.names==TRUE
     if(is.matrix(x)) {
         ## fix up dimnames as as.data.frame would
         p <- ncol(x)
         d <- dimnames(x)
         if(is.null(d)) d <- list(NULL, NULL)
-        if(is.null(d[[1]])) d[[1]] <- seq_len(nrow(x))
-        if(is.null(d[[2]]) && p > 0) d[[2]] <-  paste("V", 1:p, sep="")
+        if (is.null(d[[1]]) && makeRownames) d[[1]] <- seq_len(nrow(x))
+        if(is.null(d[[2]]) && p > 0 && makeColnames)
+            d[[2]] <-  paste("V", 1:p, sep="")
         if(is.logical(quote) && quote)
             quote <- if(is.character(x)) seq_len(p) else numeric(0)
     } else {
@@ -53,8 +58,8 @@
                 quote <- ord[quote]; quote <- quote[quote > 0]
             }
         }
-        d <- dimnames(x)
-        if(is.null(d[[1]])) d[[1]] <- seq_len(nrow(x))
+        d <- list(if (makeRownames==TRUE) row.names(x) else NULL,
+                  if (makeColnames==TRUE) names(x) else NULL)
         p <- ncol(x)
     }
     nocols <- p==0

> improves performance at least in proportion to nrow(x):

> > system.time({
> +     write.table(df, '/tmp/dftest1.txt', row.names=FALSE)
> + }, gcFirst=TRUE)
>    user  system elapsed 
>   8.132   0.608   8.899 

> Martin
> -- 
> Martin Morgan
> Computational Biology / Fred Hutchinson Cancer Research Center
> 1100 Fairview Ave. N.
> PO Box 19024 Seattle, WA 98109

> Location: Arnold Building M2 B169
> Phone: (206) 667-2793


From maechler at stat.math.ethz.ch  Tue Mar 11 18:07:35 2008
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Tue, 11 Mar 2008 18:07:35 +0100
Subject: [Rd] NA warnings for r<distr>() {aka "patch for random.c"}
In-Reply-To: <20080311131946.3e2b8945@berwin-nus1>
References: <20080229181940.457c9bf7@berwin-nus1>
	<18379.49661.242974.779574@stat.math.ethz.ch>
	<20080305202624.7f1c54ea@berwin-nus1>
	<18385.19126.4852.755058@stat.math.ethz.ch>
	<20080307235406.21f5649b@absentia>
	<18389.5657.301160.608130@stat.math.ethz.ch>
	<20080311131946.3e2b8945@berwin-nus1>
Message-ID: <18390.48215.303134.850917@stat.math.ethz.ch>

>>>>> "BAT" == Berwin A Turlach <statba at nus.edu.sg>
>>>>>     on Tue, 11 Mar 2008 13:19:46 +0800 writes:

    BAT> G'day Martin and others,
    BAT> On Mon, 10 Mar 2008 12:06:01 +0100
    BAT> Martin Maechler <maechler at stat.math.ethz.ch> wrote:

    >> >>>>> "BAT" == Berwin A Turlach <statba at nus.edu.sg>
    >> >>>>>     on Fri, 7 Mar 2008 23:54:06 +0800 writes:
    >> 
    BAT> After all,
    >> 
    >> >> 1:2 + Inf
    BAT> [1] Inf Inf
    >> 
    BAT> does not create any warning either.  
    >> 
    >> but it doesn't give NA either.
    >> A bit more relevant (and I'm sure you meant implicitly)

    BAT> You give me more credit than I deserve. :)
    BAT> I was guided by what rexp() was doing when I chose that example, i.e.
    BAT> (potentially) warning about NAs being created when actually +/- Infs
    BAT> were created. In this thread I was already once or twice tempted to
    BAT> comment on the appropriateness of the warning message but for various
    BAT> reasonx always refrained from doing so.  

    >> BTW, I've also found that I  
    >> rnorm(n, mu=Inf) |--> NA  was not ok, and changed that to
    >> rnorm(n, mu=Inf) |--> Inf
    >> 
    >> More feedback is welcome,
    >> but please now "start" with R-devel rev >= 44715

    BAT> While I agree with this change, I think it opens a whole can of worms,

not a big can, though ....

    BAT> since it invites a rethink about all distributions.  At the moment
    BAT> we have:

    BAT> <snip>
    BAT> R version 2.7.0 Under development (unstable) (2008-03-10 r44730)
    BAT> <snip>
    >> set.seed(1) ; exp(rnorm(2))
    BAT> [1] 0.5344838 1.2015872
    >> set.seed(1) ; rlnorm(2)
    BAT> [1] 0.5344838 1.2015872

    >> set.seed(1) ; exp(rnorm(2, mean=c(-Inf,Inf)))
    BAT> [1]   0 Inf
    >> set.seed(1) ; rlnorm(2, mean=c(-Inf,Inf))
    BAT> [1] NaN NaN
    BAT> Warning message:
    BAT> In rlnorm(2, mean = c(-Inf, Inf)) : NAs produced

    BAT> The first two lines give identical results, as one could reasonably
    BAT> expect.  

Yes, but I don't think a user should *rely* on the way R
generates these random number; though I agree for the very
specific case of rlnorm(..).

    BAT> But the other two do not and I would argue that a user could
    BAT> reasonably expect that the commands in these two lines should lead to
    BAT> identical results.

They now do.

    BAT> Likewise, coming back to the one-parameter distribution used in this
    BAT> thread for illustration purposes, the *exp() functions in R are
    BAT> parameterised by the rate and an exponential random variable with rate
    BAT> r has mean (1/r) and variance (1/r^2).  Thus, I would argue that
    BAT> rexp(2, Inf) should return 0's and not NaN's, since in the limit
    BAT> a rate of Inf seems to refer to a variable with mean 0 and variance 0,
    BAT> i.e. the constant 0.  And it would also be "more consistent" with the
    BAT> behaviour of rexp() when the rate parameter is "large but finite".

yes.  And that's *the* (only) case where 'Inf' parameters or 'scale = 0'
situations should work: when it is a natural limit behavior.

    BAT> Then one can argue about rgeom() when p=0.  But I guess in that case
    BAT> the limit is a "random" variable with "infinite mean" and "infinite
    BAT> variance" and hence it is o.k. to return NaNs and not Infs.  After all,
    BAT> your comments in rnorm.c seem to indicate that you think that reporting
    BAT> +/- Inf back is only o.k. if the mean is +/- Inf but the variance is
    BAT> finite.

    BAT> I did not look at (or think about) extreme cases for any other
    BAT> distributions, but further discussion/feedback would indeed be helpful
    BAT> it seems. :)

I looked at a few more, basically all  continuous
src/nmath/r<foo>.c  ones.

    BAT> And the attached patch would address the behaviour of rlnorm() and
    BAT> rexp() that I have raised above.  With these changes, on my machine,
    BAT> "make check FORCE=FORCE" succeeds.

I don't think your change to  .../R/distn.R  was good,
but the others I have more or less committed together with a few
more similar ones.

    BAT> BTW, I was surprised to realise that the *exp() functions in the
    BAT> underlying C code use the opposite parameterisation from the
    BAT> corresponding functions at R level.  Perhaps it would be worthwhile to
    BAT> point this out in section 6.7.1 of the Writing R extension manual?  In
    BAT> particular since the manual states:

    BAT> Note that these argument sequences are (apart from the names and that
    BAT> @code{rnorm} has no @var{n}) exactly the same as the corresponding
    BAT> @R{} functions of the same name, so the documentation of the @R{}
    BAT> functions can be used.

    BAT> Well, as I noticed the hard way, for *exp() the documentation of the
    BAT> corresponding R functions cannot be used. ;-)

We often also gratefully accept patches for the documentation 
...

    BAT> Thanks for you patience.
;-)

Regards,
Martin


From statba at nus.edu.sg  Tue Mar 11 18:23:10 2008
From: statba at nus.edu.sg (Berwin A Turlach)
Date: Wed, 12 Mar 2008 01:23:10 +0800
Subject: [Rd] NA warnings for r<distr>() {aka "patch for random.c"}
In-Reply-To: <18390.48215.303134.850917@stat.math.ethz.ch>
References: <20080229181940.457c9bf7@berwin-nus1> <18379.49661.242974.779574@
	stat.math.ethz.ch> <20080305202624.7f1c54ea@berwin-nus1>
	<18385.19126.4852.75 5058@stat.math.ethz.ch>
	<20080307235406.21f5649b@absentia> <18389.5657.301160
	.608130@stat.math.ethz.ch> <20080311131946.3e2b8945@berwin-nus1>
	<18390.48215.303134.850917@stat.math.ethz.ch>
Message-ID: <20080312012310.591dfe8c@absentia>

G'day Martin,

On Tue, 11 Mar 2008 18:07:35 +0100
Martin Maechler <maechler at stat.math.ethz.ch> wrote:

> >>>>> "BAT" == Berwin A Turlach <statba at nus.edu.sg>
> >>>>>     on Tue, 11 Mar 2008 13:19:46 +0800 writes:

[...]
>     BAT> The first two lines give identical results, as one could
>     BAT> reasonably expect.  
> 
> Yes, but I don't think a user should *rely* on the way R
> generates these random number; though I agree for the very
> specific case of rlnorm(..).
> 
>     BAT> But the other two do not and I would argue that a user could
>     BAT> reasonably expect that the commands in these two lines
>     BAT> should lead to identical results.
> 
> They now do.

Well, actually I forgot to mention one could also put another argument
forward.  As the log-mean parameter of the lognormal distribution
goes to -Inf, the distribution degenerates to something that has mean 0
and variance 0, i.e. could be taken as the constant zero and, hence,
one might expect that rlnorm(1, -Inf) returns 0.

But as the log-mean parameter goes to Inf, the distribution degenerates
to something with infinite mean and infinite variance.  Thus, perhaps
it is more sensible for rlnorm(1, Inf) to return NaN instead of Inf.....

> I don't think your change to  .../R/distn.R  was good,

I didn't like it either, but it was the simplest way I could think of
that would allow the C rexp() routine to realise that a scale parameter
of 0 actually came from a rate parameter of -Inf in the R code.  

> but the others I have more or less committed together with a few
> more similar ones.

Thanks.

>     BAT> BTW, I was surprised to realise that the *exp() functions in
>     BAT> the underlying C code use the opposite parameterisation from
>     BAT> the corresponding functions at R level.  Perhaps it would be
>     BAT> worthwhile to point this out in section 6.7.1 of the Writing
>     BAT> R extension manual?  In particular since the manual states:
> 
>     BAT> Note that these argument sequences are (apart from the names
>     BAT> and that @code{rnorm} has no @var{n}) exactly the same as
>     BAT> the corresponding @R{} functions of the same name, so the
>     BAT> documentation of the @R{} functions can be used.
> 
>     BAT> Well, as I noticed the hard way, for *exp() the
>     BAT> documentation of the corresponding R functions cannot be
>     BAT> used. ;-)
> 
> We often also gratefully accept patches for the documentation 

I know, and I am always amazed that despite this policy (or perhaps
because of it?) the documentation of R is not patchy.... ;-)

Cheers,
	
	Berwin


From ecjbosu at aol.com  Tue Mar 11 19:27:36 2008
From: ecjbosu at aol.com (Joe Byers)
Date: Tue, 11 Mar 2008 18:27:36 +0000 (UTC)
Subject: [Rd] Rtools and GCC4 problem
Message-ID: <loom.20080311T181515-595@post.gmane.org>


>>

I am trying to compile rseries from Whit Armstrong and a colleague of mine found
a problem with using GCC4

I get the following error when compiling rseries
g++-sjlj   -Ic:/R/include     -O2 -Wall  -c Rutils.cpp -o Rutils.o
Rutils.cpp: In function 'double* getColPointer(SEXPREC*, int)':
Rutils.cpp:406: warning: deprecated conversion from string constant to 'char*'
g++-sjlj   -Ic:/R/include     -O2 -Wall  -c array.cpp -o array.o
g++-sjlj   -Ic:/R/include     -O2 -Wall  -c interface.cpp -o interface.o
In file included from interface.hpp:1,
                 from interface.cpp:1:
tseries.hpp: In function 'tseries* cbind(Seq<T, std::allocator<_CharT> >&, bool)
':
tseries.hpp:533: error: no matching function for call to 'tseries::setDates(std:
:vector<double, std::allocator<double> >&)'
tseries.hpp:112: note: candidates are: void tseries::setDates(double*)


I changed the BUILD=GCC3 in MkRules and rseries will compile after fixing the
isnan declaration.  

I was wondering if anyone had experienced this type of problem in other packages
and what could be done to fix it here or if it is in Rtools.  The Rtools version
I downgraded to 26 from 27 to get the GCC3 compiler..

thank you
joe

The following the output from building
C:\src\R>r CMD install rseries
installing to 'c:/src/R/R-2.5.1/library'


---------- Making package rseries ------------
  adding build stamp to DESCRIPTION
  installing NAMESPACE file and metadata
  making DLL ...
g++   -Ic:/src/R/R-2.5.1/include  -Wall -O2   -c Rutils.cpp -o Rutils.o
c:/src/R/Rtools/MinGW/bin/../lib/gcc/mingw32/3.4.5/../../../../include/c++/
3.4.5/bits/stl_uninitiali
zed.h: In function `std::vector<std::string, std::allocator<std::string> >
listnames(SEXPREC*)':
c:/src/R/Rtools/MinGW/bin/../lib/gcc/mingw32/3.4.5/../../../../include/c++/
3.4.5/bits/stl_uninitiali
zed.h:82: warning: '__cur' might be used uninitialized in this function
c:/src/R/Rtools/MinGW/bin/../lib/gcc/mingw32/3.4.5/../../../../include/c++/
3.4.5/bits/stl_uninitiali
zed.h: In function `std::vector<std::string, std::allocator<std::string> >
rownames(SEXPREC*)':
c:/src/R/Rtools/MinGW/bin/../lib/gcc/mingw32/3.4.5/../../../../include/c++/
3.4.5/bits/stl_uninitiali
zed.h:82: warning: '__cur' might be used uninitialized in this function
c:/src/R/Rtools/MinGW/bin/../lib/gcc/mingw32/3.4.5/../../../../include/c++/
3.4.5/bits/stl_uninitiali
zed.h: In function `std::vector<std::string, std::allocator<std::string> >
colnames(SEXPREC*)':
c:/src/R/Rtools/MinGW/bin/../lib/gcc/mingw32/3.4.5/../../../../include/c++/
3.4.5/bits/stl_uninitiali
zed.h:82: warning: '__cur' might be used uninitialized in this function
g++   -Ic:/src/R/R-2.5.1/include  -Wall -O2   -c array.cpp -o array.o
g++   -Ic:/src/R/R-2.5.1/include  -Wall -O2   -c interface.cpp -o interface.o
g++   -Ic:/src/R/R-2.5.1/include  -Wall -O2   -c mask.cpp -o mask.o
g++   -Ic:/src/R/R-2.5.1/include  -Wall -O2   -c math_utils.cpp -o math_utils.o
g++   -Ic:/src/R/R-2.5.1/include  -Wall -O2   -c ts.data.cpp -o ts.data.o
g++   -Ic:/src/R/R-2.5.1/include  -Wall -O2   -c tseries.cpp -o tseries.o
tseries.cpp: In function `tseries linear_model(const tseries&, const tseries&)':
tseries.cpp:1058: warning: unused variable 'trans'
tseries.cpp:1059: warning: unused variable 'nrhs'
tseries.cpp:1060: warning: unused variable 'info'
c:/src/R/Rtools/MinGW/bin/../lib/gcc/mingw32/3.4.5/../../../../include/c++/
3.4.5/bits/stl_uninitiali
zed.h: In member function `std::vector<std::string, std::allocator<std::string>
> tseries::getColNam
es() const':
c:/src/R/Rtools/MinGW/bin/../lib/gcc/mingw32/3.4.5/../../../../include/c++/
3.4.5/bits/stl_uninitiali
zed.h:82: warning: '__cur' might be used uninitialized in this function
c:/src/R/Rtools/MinGW/bin/../lib/gcc/mingw32/3.4.5/../../../../include/c++/
3.4.5/bits/stl_vector.h:
In member function `std::vector<_Tp, _Alloc>& std::vector<_Tp,
_Alloc>::operator=(const std::vector< _Tp, _Alloc>&) [with _Tp = std::string,
_Alloc = std::allocator<std::string>]':
c:/src/R/Rtools/MinGW/bin/../lib/gcc/mingw32/3.4.5/../../../../include/c++/
3.4.5/bits/stl_vector.h:7
15: warning: '__result' might be used uninitialized in this function
c:/src/R/Rtools/MinGW/bin/../lib/gcc/mingw32/3.4.5/../../../../include/c++/
3.4.5/bits/stl_uninitiali
zed.h:82: warning: '__cur' might be used uninitialized in this function
c:/src/R/Rtools/MinGW/bin/../lib/gcc/mingw32/3.4.5/../../../../include/c++/
3.4.5/bits/stl_uninitiali
zed.h:82: warning: '__cur' might be used uninitialized in this function
g++   -Ic:/src/R/R-2.5.1/include  -Wall -O2   -c util.cpp -o util.o
windres -I c:/src/R/R-2.5.1/include  -i rseries_res.rc -o rseries_res.o
g++  -shared -s  -o rseries.dll rseries.def Rutils.o array.o interface.o
g++ mask.o math_utils.o ts.data
.o tseries.o util.o rseries_res.o  -Lc:/src/R/R-2.5.1/bin    -lR
  ... DLL made
  installing DLL
  installing R files
  no man files in this package
  installing indices
  installing help
  adding MD5 sums

* DONE (Rseries)


From lienert at karto.baug.ethz.ch  Tue Mar 11 21:04:55 2008
From: lienert at karto.baug.ethz.ch (Lienert  Christophe)
Date: Tue, 11 Mar 2008 21:04:55 +0100
Subject: [Rd] R-console vs. bash console (execution halted)
Message-ID: <A0C7AADAEF32A64696B51EC0F31A90E303E3CEF0@EX4.d.ethz.ch>

Dear Everyone,
I am using R 2.6.2 on my Redhat AS4. I installed the RPM offered on the cran website. I would like to use R from my bash console with the following command:
 
/path/to/R --vanilla --slave --args < /data/myscript.R
 
this script invokes a range of functions and tools, among others to process a bunch of raster images in a loop using GDAL. The thing is that releasing this command in the bash results in the following error
 
 
Error in function (handle)  :
        GDAL Error 1: TIFFReadDirectory:/tmp/RtmpPCALnL/file265f67a6: cannot handle zero scanline size
Calls: <Anonymous> -> .Call
Execution halted

The scripts halts, although there are more images to process. The question is why the script halts and why the script is not halted (but still "decorated" with errors) when releasing it within the R console like so
 
R CMD source("/data/myscript.R")
 
The result of this R CMD is shown below. Note that the script is doing what it is supposed to, despite the error it produces. The loop is completely finalized
 
Error in function (handle)  :
        GDAL Error 1: TIFFReadDirectory:/tmp/Rtmp6gXG5W/file67e9e074: cannot handle zero scanline size
[1] "/data/someimg1.tiff"
Error in function (handle)  :
        GDAL Error 1: TIFFReadDirectory:/tmp/Rtmp6gXG5W/file21e4ef74: cannot handle zero scanline size
[1] "/data/someimg2.tiff"
Error in function (handle)  :
        GDAL Error 1: TIFFReadDirectory:/tmp/Rtmp6gXG5W/file67e9e074: cannot handle zero scanline size
[1] "/data/someimg3.tiff"

etc.
 
Obviously, the tmp directory is being deleted before the stored image in it can be used. Does anybody know what to consider or provide when working in a external console like bash and/or does anybody know about such halted executions when working with GDAL?
Help is greatly appreciated,
 
Ciao,
Chris
 
_______________________________________________
Christophe Lienert  
ETH Zurich  
Institute of Cartography  
Wolfgang-Pauli-Str. 15  
HIL G 13.3  
CH-8093 Zurich
SWITZERLAND

Fon: +41-44-6333036  
Fax: +41-44-6331153 
www.karto.ethz.ch  
lienert at karto.baug.ethz.ch
<mailto:lienert at karto.baug.ethz.ch> 
   


From ripley at stats.ox.ac.uk  Tue Mar 11 21:35:55 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 11 Mar 2008 20:35:55 +0000 (GMT)
Subject: [Rd] R-console vs. bash console (execution halted)
In-Reply-To: <A0C7AADAEF32A64696B51EC0F31A90E303E3CEF0@EX4.d.ethz.ch>
References: <A0C7AADAEF32A64696B51EC0F31A90E303E3CEF0@EX4.d.ethz.ch>
Message-ID: <alpine.LFD.1.00.0803112031240.15769@gannet.stats.ox.ac.uk>

Your first use is non-interactive.  I have no idea what

R CMD source("/data/myscript.R")

is supposed to do (it does not work for me), but source() when run in RGui 
is interactive.

See ?options and in particular 'error' and the reference to ?stop for the 
different ways errors are handled in interactive and non-interactive use.



On Tue, 11 Mar 2008, Lienert  Christophe wrote:

> Dear Everyone,
> I am using R 2.6.2 on my Redhat AS4. I installed the RPM offered on the cran website. I would like to use R from my bash console with the following command:
>
> /path/to/R --vanilla --slave --args < /data/myscript.R
>
> this script invokes a range of functions and tools, among others to process a bunch of raster images in a loop using GDAL. The thing is that releasing this command in the bash results in the following error
>
>
> Error in function (handle)  :
>        GDAL Error 1: TIFFReadDirectory:/tmp/RtmpPCALnL/file265f67a6: cannot handle zero scanline size
> Calls: <Anonymous> -> .Call
> Execution halted
>
> The scripts halts, although there are more images to process. The question is why the script halts and why the script is not halted (but still "decorated" with errors) when releasing it within the R console like so
>
> R CMD source("/data/myscript.R")
>
> The result of this R CMD is shown below. Note that the script is doing what it is supposed to, despite the error it produces. The loop is completely finalized
>
> Error in function (handle)  :
>        GDAL Error 1: TIFFReadDirectory:/tmp/Rtmp6gXG5W/file67e9e074: cannot handle zero scanline size
> [1] "/data/someimg1.tiff"
> Error in function (handle)  :
>        GDAL Error 1: TIFFReadDirectory:/tmp/Rtmp6gXG5W/file21e4ef74: cannot handle zero scanline size
> [1] "/data/someimg2.tiff"
> Error in function (handle)  :
>        GDAL Error 1: TIFFReadDirectory:/tmp/Rtmp6gXG5W/file67e9e074: cannot handle zero scanline size
> [1] "/data/someimg3.tiff"
>
> etc.
>
> Obviously, the tmp directory is being deleted before the stored image in it can be used. Does anybody know what to consider or provide when working in a external console like bash and/or does anybody know about such halted executions when working with GDAL?
> Help is greatly appreciated,
>
> Ciao,
> Chris
>
> _______________________________________________
> Christophe Lienert
> ETH Zurich
> Institute of Cartography
> Wolfgang-Pauli-Str. 15
> HIL G 13.3
> CH-8093 Zurich
> SWITZERLAND
>
> Fon: +41-44-6333036
> Fax: +41-44-6331153
> www.karto.ethz.ch
> lienert at karto.baug.ethz.ch
> <mailto:lienert at karto.baug.ethz.ch>
>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From Roger.Bivand at nhh.no  Tue Mar 11 21:57:58 2008
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 11 Mar 2008 21:57:58 +0100 (CET)
Subject: [Rd] R-console vs. bash console (execution halted)
In-Reply-To: <alpine.LFD.1.00.0803112031240.15769@gannet.stats.ox.ac.uk>
References: <A0C7AADAEF32A64696B51EC0F31A90E303E3CEF0@EX4.d.ethz.ch>
	<alpine.LFD.1.00.0803112031240.15769@gannet.stats.ox.ac.uk>
Message-ID: <Pine.LNX.4.64.0803112148410.10193@reclus.nhh.no>

On Tue, 11 Mar 2008, Prof Brian Ripley wrote:

> Your first use is non-interactive.  I have no idea what
>
> R CMD source("/data/myscript.R")
>
> is supposed to do (it does not work for me), but source() when run in RGui
> is interactive.
>
> See ?options and in particular 'error' and the reference to ?stop for the
> different ways errors are handled in interactive and non-interactive use.
>

In addition, this is an error in external software accessed through the 
rgdal package. So the first thing would be to find out interactively why 
it is happening, and if necessary trap errors that the author of the 
script knows about and wishes to step over.

Could I suggest that you re-post to the R-sig-geo list to get help in 
resolving the underlying problem? As the GDAL error message says, there is 
a problem with a GTiff file, but whether you are reading from an external 
file, or copying from a created GDAL object is not known. In posting, 
please give a simplified example of your workflow. I'm not sure that your 
diagnosis is correct - GDAL typically gives a "file not found" error if 
the file is not present, but here it seems to indicate a corrupt file.

>
>
> On Tue, 11 Mar 2008, Lienert  Christophe wrote:
>
>> Dear Everyone,
>> I am using R 2.6.2 on my Redhat AS4. I installed the RPM offered on the cran website. I would like to use R from my bash console with the following command:
>>
>> /path/to/R --vanilla --slave --args < /data/myscript.R
>>
>> this script invokes a range of functions and tools, among others to process a bunch of raster images in a loop using GDAL. The thing is that releasing this command in the bash results in the following error
>>
>>
>> Error in function (handle)  :
>>        GDAL Error 1: TIFFReadDirectory:/tmp/RtmpPCALnL/file265f67a6: cannot handle zero scanline size
>> Calls: <Anonymous> -> .Call
>> Execution halted
>>
>> The scripts halts, although there are more images to process. The question is why the script halts and why the script is not halted (but still "decorated" with errors) when releasing it within the R console like so
>>
>> R CMD source("/data/myscript.R")
>>
>> The result of this R CMD is shown below. Note that the script is doing what it is supposed to, despite the error it produces. The loop is completely finalized
>>
>> Error in function (handle)  :
>>        GDAL Error 1: TIFFReadDirectory:/tmp/Rtmp6gXG5W/file67e9e074: cannot handle zero scanline size
>> [1] "/data/someimg1.tiff"
>> Error in function (handle)  :
>>        GDAL Error 1: TIFFReadDirectory:/tmp/Rtmp6gXG5W/file21e4ef74: cannot handle zero scanline size
>> [1] "/data/someimg2.tiff"
>> Error in function (handle)  :
>>        GDAL Error 1: TIFFReadDirectory:/tmp/Rtmp6gXG5W/file67e9e074: cannot handle zero scanline size
>> [1] "/data/someimg3.tiff"
>>
>> etc.
>>
>> Obviously, the tmp directory is being deleted before the stored image in it can be used. Does anybody know what to consider or provide when working in a external console like bash and/or does anybody know about such halted executions when working with GDAL?
>> Help is greatly appreciated,
>>
>> Ciao,
>> Chris
>>
>> _______________________________________________
>> Christophe Lienert
>> ETH Zurich
>> Institute of Cartography
>> Wolfgang-Pauli-Str. 15
>> HIL G 13.3
>> CH-8093 Zurich
>> SWITZERLAND
>>
>> Fon: +41-44-6333036
>> Fax: +41-44-6331153
>> www.karto.ethz.ch
>> lienert at karto.baug.ethz.ch
>> <mailto:lienert at karto.baug.ethz.ch>
>>
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From ripley at stats.ox.ac.uk  Wed Mar 12 08:28:05 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 12 Mar 2008 07:28:05 +0000 (GMT)
Subject: [Rd] Rtools and GCC4 problem
In-Reply-To: <loom.20080311T181515-595@post.gmane.org>
References: <loom.20080311T181515-595@post.gmane.org>
Message-ID: <alpine.LFD.1.00.0803120720550.24176@gannet.stats.ox.ac.uk>

You seem to be assuming that the C++ code is correct and the compiler is 
wrong.  It seems very much more plausible that the reverse is true.

Gcc3 was notoriously loose in its standards conformance in C++ and 
Fortran.  Gcc4 is better, but g++4 still allows at least 10 packages on 
CRAN to compile which contain invalid C++ code and which compilers such as 
Sun Studio 12 reject.


On Tue, 11 Mar 2008, Joe Byers wrote:

>
>>>
>
> I am trying to compile rseries from Whit Armstrong and a colleague of mine found
> a problem with using GCC4
>
> I get the following error when compiling rseries
> g++-sjlj   -Ic:/R/include     -O2 -Wall  -c Rutils.cpp -o Rutils.o
> Rutils.cpp: In function 'double* getColPointer(SEXPREC*, int)':
> Rutils.cpp:406: warning: deprecated conversion from string constant to 'char*'
> g++-sjlj   -Ic:/R/include     -O2 -Wall  -c array.cpp -o array.o
> g++-sjlj   -Ic:/R/include     -O2 -Wall  -c interface.cpp -o interface.o
> In file included from interface.hpp:1,
>                 from interface.cpp:1:
> tseries.hpp: In function 'tseries* cbind(Seq<T, std::allocator<_CharT> >&, bool)
> ':
> tseries.hpp:533: error: no matching function for call to 'tseries::setDates(std:
> :vector<double, std::allocator<double> >&)'
> tseries.hpp:112: note: candidates are: void tseries::setDates(double*)
>
>
> I changed the BUILD=GCC3 in MkRules and rseries will compile after fixing the
> isnan declaration.
>
> I was wondering if anyone had experienced this type of problem in other packages
> and what could be done to fix it here or if it is in Rtools.  The Rtools version
> I downgraded to 26 from 27 to get the GCC3 compiler..
>
> thank you
> joe
>
> The following the output from building
> C:\src\R>r CMD install rseries
> installing to 'c:/src/R/R-2.5.1/library'
>
>
> ---------- Making package rseries ------------
>  adding build stamp to DESCRIPTION
>  installing NAMESPACE file and metadata
>  making DLL ...
> g++   -Ic:/src/R/R-2.5.1/include  -Wall -O2   -c Rutils.cpp -o Rutils.o
> c:/src/R/Rtools/MinGW/bin/../lib/gcc/mingw32/3.4.5/../../../../include/c++/
> 3.4.5/bits/stl_uninitiali
> zed.h: In function `std::vector<std::string, std::allocator<std::string> >
> listnames(SEXPREC*)':
> c:/src/R/Rtools/MinGW/bin/../lib/gcc/mingw32/3.4.5/../../../../include/c++/
> 3.4.5/bits/stl_uninitiali
> zed.h:82: warning: '__cur' might be used uninitialized in this function
> c:/src/R/Rtools/MinGW/bin/../lib/gcc/mingw32/3.4.5/../../../../include/c++/
> 3.4.5/bits/stl_uninitiali
> zed.h: In function `std::vector<std::string, std::allocator<std::string> >
> rownames(SEXPREC*)':
> c:/src/R/Rtools/MinGW/bin/../lib/gcc/mingw32/3.4.5/../../../../include/c++/
> 3.4.5/bits/stl_uninitiali
> zed.h:82: warning: '__cur' might be used uninitialized in this function
> c:/src/R/Rtools/MinGW/bin/../lib/gcc/mingw32/3.4.5/../../../../include/c++/
> 3.4.5/bits/stl_uninitiali
> zed.h: In function `std::vector<std::string, std::allocator<std::string> >
> colnames(SEXPREC*)':
> c:/src/R/Rtools/MinGW/bin/../lib/gcc/mingw32/3.4.5/../../../../include/c++/
> 3.4.5/bits/stl_uninitiali
> zed.h:82: warning: '__cur' might be used uninitialized in this function
> g++   -Ic:/src/R/R-2.5.1/include  -Wall -O2   -c array.cpp -o array.o
> g++   -Ic:/src/R/R-2.5.1/include  -Wall -O2   -c interface.cpp -o interface.o
> g++   -Ic:/src/R/R-2.5.1/include  -Wall -O2   -c mask.cpp -o mask.o
> g++   -Ic:/src/R/R-2.5.1/include  -Wall -O2   -c math_utils.cpp -o math_utils.o
> g++   -Ic:/src/R/R-2.5.1/include  -Wall -O2   -c ts.data.cpp -o ts.data.o
> g++   -Ic:/src/R/R-2.5.1/include  -Wall -O2   -c tseries.cpp -o tseries.o
> tseries.cpp: In function `tseries linear_model(const tseries&, const tseries&)':
> tseries.cpp:1058: warning: unused variable 'trans'
> tseries.cpp:1059: warning: unused variable 'nrhs'
> tseries.cpp:1060: warning: unused variable 'info'
> c:/src/R/Rtools/MinGW/bin/../lib/gcc/mingw32/3.4.5/../../../../include/c++/
> 3.4.5/bits/stl_uninitiali
> zed.h: In member function `std::vector<std::string, std::allocator<std::string>
>> tseries::getColNam
> es() const':
> c:/src/R/Rtools/MinGW/bin/../lib/gcc/mingw32/3.4.5/../../../../include/c++/
> 3.4.5/bits/stl_uninitiali
> zed.h:82: warning: '__cur' might be used uninitialized in this function
> c:/src/R/Rtools/MinGW/bin/../lib/gcc/mingw32/3.4.5/../../../../include/c++/
> 3.4.5/bits/stl_vector.h:
> In member function `std::vector<_Tp, _Alloc>& std::vector<_Tp,
> _Alloc>::operator=(const std::vector< _Tp, _Alloc>&) [with _Tp = std::string,
> _Alloc = std::allocator<std::string>]':
> c:/src/R/Rtools/MinGW/bin/../lib/gcc/mingw32/3.4.5/../../../../include/c++/
> 3.4.5/bits/stl_vector.h:7
> 15: warning: '__result' might be used uninitialized in this function
> c:/src/R/Rtools/MinGW/bin/../lib/gcc/mingw32/3.4.5/../../../../include/c++/
> 3.4.5/bits/stl_uninitiali
> zed.h:82: warning: '__cur' might be used uninitialized in this function
> c:/src/R/Rtools/MinGW/bin/../lib/gcc/mingw32/3.4.5/../../../../include/c++/
> 3.4.5/bits/stl_uninitiali
> zed.h:82: warning: '__cur' might be used uninitialized in this function
> g++   -Ic:/src/R/R-2.5.1/include  -Wall -O2   -c util.cpp -o util.o
> windres -I c:/src/R/R-2.5.1/include  -i rseries_res.rc -o rseries_res.o
> g++  -shared -s  -o rseries.dll rseries.def Rutils.o array.o interface.o
> g++ mask.o math_utils.o ts.data
> .o tseries.o util.o rseries_res.o  -Lc:/src/R/R-2.5.1/bin    -lR
>  ... DLL made
>  installing DLL
>  installing R files
>  no man files in this package
>  installing indices
>  installing help
>  adding MD5 sums
>
> * DONE (Rseries)
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From maechler at stat.math.ethz.ch  Wed Mar 12 08:39:18 2008
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Wed, 12 Mar 2008 08:39:18 +0100
Subject: [Rd] NA warnings for r<distr>() {aka "patch for random.c"}
In-Reply-To: <20080312012310.591dfe8c@absentia>
References: <20080229181940.457c9bf7@berwin-nus1> <18379.49661.242974.779574@
	stat.math.ethz.ch> <20080305202624.7f1c54ea@berwin-nus1>
	<18385.19126.4852.75 5058@stat.math.ethz.ch>
	<20080307235406.21f5649b@absentia> <18389.5657.301160
	.608130@stat.math.ethz.ch> <20080311131946.3e2b8945@berwin-nus1>
	<18390.48215.303134.850917@stat.math.ethz.ch>
	<20080312012310.591dfe8c@absentia>
Message-ID: <18391.34982.523432.343806@stat.math.ethz.ch>

>>>>> "BAT" == Berwin A Turlach <statba at nus.edu.sg>
>>>>>     on Wed, 12 Mar 2008 01:23:10 +0800 writes:

    BAT> G'day Martin, On Tue, 11 Mar 2008 18:07:35 +0100 Martin
    BAT> Maechler <maechler at stat.math.ethz.ch> wrote:

    >> >>>>> "BAT" == Berwin A Turlach <statba at nus.edu.sg> >>>>>
    >> on Tue, 11 Mar 2008 13:19:46 +0800 writes:

    BAT> [...]  The first two lines give identical results, as
    BAT> one could reasonably expect.
    >> 
    >> Yes, but I don't think a user should *rely* on the way R
    >> generates these random number; though I agree for the
    >> very specific case of rlnorm(..).
    >> 
    BAT> But the other two do not and I would argue that a user
    BAT> could reasonably expect that the commands in these two
    BAT> lines should lead to identical results.
    >> 
    >> They now do.

    BAT> Well, actually I forgot to mention one could also put
    BAT> another argument forward.  As the log-mean parameter of
    BAT> the lognormal distribution goes to -Inf, the
    BAT> distribution degenerates to something that has mean 0
    BAT> and variance 0, i.e. could be taken as the constant
    BAT> zero and, hence, one might expect that rlnorm(1, -Inf)
    BAT> returns 0.

yes; and that has been a consequence of the changes I did yesterday.

    BAT> But as the log-mean parameter goes to Inf, the
    BAT> distribution degenerates to something with infinite
    BAT> mean and infinite variance.  Thus, perhaps it is more
    BAT> sensible for rlnorm(1, Inf) to return NaN instead of
    BAT> Inf.....

well.  We have pretty strictly tried to follow the principle
that 'Inf' or '-Inf'  should be used when there are clear limit

If     lim_{x \to x_0} f(x) =  +/- Inf =: M

we would set
		f(x_0) = M

for x_0 in   |R + {-Inf, Inf}

If we apply this principle here, clearly,

rlnorm(., Inf) :=  lim_{lmu -> Inf}   rlnorm(., lmu)   =
	        =  lim_{lmu -> Inf} exp(rnorm(., lmu)) =
	        =  exp(lim_{lmu -> Inf} rnorm(., lmu)) =
	        =  exp(Inf) = Inf

{ or you directly numerically see that already
  rlnorm(50, 1000)   gives all Inf }

Martin

    >> I don't think your change to .../R/distn.R was good,

    BAT> I didn't like it either, but it was the simplest way I
    BAT> could think of that would allow the C rexp() routine to
    BAT> realise that a scale parameter of 0 actually came from
    BAT> a rate parameter of -Inf in the R code.

    >> but the others I have more or less committed together
    >> with a few more similar ones.

    BAT> Thanks.

    BAT> BTW, I was surprised to realise that the *exp()
    BAT> functions in the underlying C code use the opposite
    BAT> parameterisation from the corresponding functions at R
    BAT> level.  Perhaps it would be worthwhile to point this
    BAT> out in section 6.7.1 of the Writing R extension manual?
    BAT> In particular since the manual states:
    >> 
    BAT> Note that these argument sequences are (apart from the
    BAT> names and that @code{rnorm} has no @var{n}) exactly the
    BAT> same as the corresponding @R{} functions of the same
    BAT> name, so the documentation of the @R{} functions can be
    BAT> used.
    >> 
    BAT> Well, as I noticed the hard way, for *exp() the
    BAT> documentation of the corresponding R functions cannot
    BAT> be used. ;-)
    >> 
    >> We often also gratefully accept patches for the
    >> documentation

    BAT> I know, and I am always amazed that despite this policy
    BAT> (or perhaps because of it?) the documentation of R is
    BAT> not patchy.... ;-)

    BAT> Cheers,
	
    BAT> 	Berwin


From dan.bolser at gmail.com  Wed Mar 12 12:23:31 2008
From: dan.bolser at gmail.com (dan.bolser at gmail.com)
Date: Wed, 12 Mar 2008 11:23:31 +0000
Subject: [Rd] dan.bolser has invited you to Spokeo
Message-ID: <47d7bd33368da_47881c1766dabf089563@mongrel2.tmail>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20080312/6c43e85c/attachment.pl 

From lgautier at gmail.com  Wed Mar 12 22:06:38 2008
From: lgautier at gmail.com (Laurent Gautier)
Date: Thu, 13 Mar 2008 05:06:38 +0800
Subject: [Rd] Subsetting vectors/arrays using factors can be seen as
	misleading
Message-ID: <27d1e6020803121406j1a532b63n352b235fdd986a8e@mail.gmail.com>

Dear list,

Subsetting vectors/arrays using factors can be seen as misleading, and
I was thinking that it could be discouraged (at least by issuing a
warning).
I could not find whether this was discussed earlier, but I can be
pointed to a reference if I missed any.

The "extract" operator "[" can take as arguments either vectors of
integers or vectors of characters in order to subset a data structure.
For example:
> x <- seq(1, 5)
> names(x) <- letters[1:5]
>
> x[1]
a
1
> x["a"]
a
1

Using a factor caused some confusion to someone here, and I have to
admit that it can indeed appear misleading:
> f <- factor("a", levels=c("b", "a", "c"))
> f
[1] a
Levels: b a c
> x[f]  # here the integer is used, rather than the level
b
2

The dual nature of the factor (vector of integers, with an attached
vector of levels), is not always clear to many users, especially since
factors are treated differently in other situations.
Example:
> f == 1
[1] FALSE
> f == "a" #here the level is used, not the integer
[1] TRUE

This is making me suggest that indexing using a factor could issue a
warning, and the user should explicitly wrap the vector with either
"as.integer" or "as.character".


L.

PS: All examples above were run with
platform       x86_64-unknown-linux-gnu
arch           x86_64
os             linux-gnu
system         x86_64, linux-gnu
status         Under development (unstable)
major          2
minor          7.0
year           2008
month          03
day            12
svn rev        44742
language       R
version.string R version 2.7.0 Under development (unstable) (2008-03-12 r44742)


From anais.khuong at gmail.com  Wed Mar 12 18:00:08 2008
From: anais.khuong at gmail.com (anais.khuong at gmail.com)
Date: Wed, 12 Mar 2008 18:00:08 +0100 (CET)
Subject: [Rd] bug with R CMP SHLIB (PR#10945)
Message-ID: <20080312170008.A31CB283415A@mail.pubhealth.ku.dk>

Hello,
I'm working with R, I try to call C from R.
When I try to compile my file.c to make file.so, with the command :
     R CMD SHLIB  foo.c
return the message :
gcc -arch i386 -isysroot /Developer/SDKs/MacOSX10.4u.sdk
-mmacosx-version-min=10.4 -std=gnu99 -dynamiclib
-Wl,-headerpad_max_install_names -Wl,-macosx_version_min -Wl,10.4 -undefined
dynamic_lookup -single_module -multiply_defined suppress -L/usr/local/lib -o
foo.so foo.o   -F/Library/Frameworks/R.framework/.. -framework R
/usr/bin/libtool: for architecture cputype (16777223) cpusubtype (3) object:
/usr/local/lib/libgcc_s.10.4.dylib malformed object (unknown load command 4)
make: *** [foo.so] Error 1


Can you help me ? I work on Mac os X. Thanks
-- 
Anais K

	[[alternative HTML version deleted]]


From csardi at rmki.kfki.hu  Thu Mar 13 10:24:11 2008
From: csardi at rmki.kfki.hu (Gabor Csardi)
Date: Thu, 13 Mar 2008 10:24:11 +0100
Subject: [Rd] Using a binary package built on 2.6.X with 2.7.0, on OSX
Message-ID: <20080313092411.GA19623@localdomain>

Dear All,

an OSX user of mine is trying to use a binary package (igraph) 
with R 2.7.0, but the package was built on R 2.6.2. R hangs at 
every .Call() function. 

I guess this is "normal", you cannot assume that it works for 2.7.0
if it was built for 2.6.x. Am i right? 

If yes, is there an online building system for OSX, just like there
is one for MS Windows? I guess not, but just in case....

Thanks, unfortunately i don't have access to a Mac to solve this on
my own...

Gabor

-- 
Csardi Gabor <csardi at rmki.kfki.hu>    UNIL DGM


From maechler at stat.math.ethz.ch  Thu Mar 13 11:28:00 2008
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Thu, 13 Mar 2008 11:28:00 +0100
Subject: [Rd] bug with R CMP SHLIB (PR#10945)
In-Reply-To: <20080312170008.A31CB283415A@mail.pubhealth.ku.dk>
References: <20080312170008.A31CB283415A@mail.pubhealth.ku.dk>
Message-ID: <18393.432.577459.249743@stat.math.ethz.ch>

Hi Anais,

>>>>> "ak" == anais khuong <anais.khuong at gmail.com>
>>>>>     on Wed, 12 Mar 2008 18:00:08 +0100 (CET) writes:

    ak> Hello,
    ak> I'm working with R, I try to call C from R.

    ak> When I try to compile my file.c to make file.so, with the command :
    ak> R CMD SHLIB  foo.c
    ak> return the message :

    ak> gcc -arch i386 -isysroot /Developer/SDKs/MacOSX10.4u.sdk
    ak> -mmacosx-version-min=10.4 -std=gnu99 -dynamiclib
    ak> -Wl,-headerpad_max_install_names -Wl,-macosx_version_min -Wl,10.4 -undefined
    ak> dynamic_lookup -single_module -multiply_defined suppress -L/usr/local/lib -o
    ak> foo.so foo.o   -F/Library/Frameworks/R.framework/.. -framework R
    ak> /usr/bin/libtool: for architecture cputype (16777223) cpusubtype (3) object:
    ak> /usr/local/lib/libgcc_s.10.4.dylib malformed object (unknown load command 4)
    ak> make: *** [foo.so] Error 1

this shows that your [R <-> Mac OS X]  setup is broken,
at least for *building* things like the one above.

Note that this is *NOT* a bug in R, and sending it to R-bugs was
not appropriate. Sending to 'R-devel' would have been
appropriate,
but really it is recommened to use the Mac specific mailing list,
R-SIG-Mac  (--> http://stat.ethz.ch/mailman/listinfo/r-sig-mac/
for problems like yours.

    ak> Can you help me ? 

Not more than that, 
but I am sure some of the reader of R-SIG-Mac  can help you.

Regards,
Martin Maechler

    ak> I work on Mac os X. Thanks
    ak> -- 
    ak> Anais K


From miguez at uiuc.edu  Thu Mar 13 14:03:35 2008
From: miguez at uiuc.edu (Fernando Miguez)
Date: Thu, 13 Mar 2008 08:03:35 -0500
Subject: [Rd] [Fwd: Re:  bug with R CMP SHLIB (PR#10945)]
Message-ID: <47D92627.8030305@uiuc.edu>


-- 
Fernando E. Miguez
Energy Biosciences Institute
http://netfiles.uiuc.edu/miguez/www/

-------------- next part --------------
An embedded message was scrubbed...
From: Fernando Miguez <miguez at uiuc.edu>
Subject: Re: [Rd] bug with R CMP SHLIB (PR#10945)
Date: Thu, 13 Mar 2008 08:02:14 -0500
Size: 1571
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20080313/d11f6060/attachment.eml 

From simon.urbanek at r-project.org  Thu Mar 13 14:42:32 2008
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Thu, 13 Mar 2008 09:42:32 -0400
Subject: [Rd] bug with R CMP SHLIB (PR#10945)
In-Reply-To: <20080312170008.A31CB283415A@mail.pubhealth.ku.dk>
References: <20080312170008.A31CB283415A@mail.pubhealth.ku.dk>
Message-ID: <EDC1FCF8-82E3-4765-A019-E86CF6EE8C4C@r-project.org>


On Mar 12, 2008, at 1:00 PM, anais.khuong at gmail.com wrote:

> Hello,
> I'm working with R, I try to call C from R.
> When I try to compile my file.c to make file.so, with the command :
>     R CMD SHLIB  foo.c
> return the message :
> gcc -arch i386 -isysroot /Developer/SDKs/MacOSX10.4u.sdk
> -mmacosx-version-min=10.4 -std=gnu99 -dynamiclib
> -Wl,-headerpad_max_install_names -Wl,-macosx_version_min -Wl,10.4 - 
> undefined
> dynamic_lookup -single_module -multiply_defined suppress -L/usr/ 
> local/lib -o
> foo.so foo.o   -F/Library/Frameworks/R.framework/.. -framework R
> /usr/bin/libtool: for architecture cputype (16777223) cpusubtype (3)  
> object:
> /usr/local/lib/libgcc_s.10.4.dylib malformed object (unknown load  
> command 4)
> make: *** [foo.so] Error 1
>
>
> Can you help me ? I work on Mac os X. Thanks

As Martin kindly pointed out this is not a bug, and thus should not be  
filed as such. Reading the R for Mac FAQ would help you in the first  
place and you're asked to do so before posting (see the posting guide).

Most likely your developer tools are way too old. As per FAQ you must  
use Xcode 2.4 or higher. Just in case that doesn't help, re-instal the  
full version of R.

Cheers,
Simon


From Trevor.L.Davis at frb.gov  Thu Mar 13 22:50:10 2008
From: Trevor.L.Davis at frb.gov (Trevor.L.Davis at frb.gov)
Date: Thu, 13 Mar 2008 17:50:10 -0400
Subject: [Rd] Making custom unary operators in R
Message-ID: <OFCCA59E6A.E6373F4C-ON8525740B.0074C70B-8525740B.0077F346@frbog.frb.gov>

Hello,

Is there a way to define a custom unary operator in R (other than making a 
class and 'overloading' the normal unary operators in R)?  The 
documentation seems to suggest that only custom binary operators are 
possible with the ``%abc%``construct but I was wondering whether any one 
has done so.  None of the RSiteSearch or RSeek queries I posed suggested 
that this question had been asked before but if it has, a link to the 
relevant discussion thread would be wonderful.

For example in the J language the ``! `` sign is a unary operator for the 
factorial function and a binary operator for the choose function so I 
would like to be able to define a similar operator like this::

    '%!%' <-  function(e1, e2) {
           if (missing(e2)) factorial(e1)
           else choose(e2, e1)
           }

The binary version of the operator works fine:

    > 2 %!% 4
    [1] 6

But the unary one doesn't (which is perfectly understandable since there 
is no indication in any documentation I have seen that suggests it 
should):::

    > %!% 4
    Error: unexpected SPECIAL in "%!%"

The source code for the '?' operator almost seems to suggest that a mixed 
unary / binary non-primitive R function is possible::

    > get('?')
    function (e1, e2)
    {
        e1Expr <- substitute(e1)
        if (missing(e2)) {
            if (is.call(e1Expr))
                return(.helpForCall(e1Expr, parent.frame()))
            if (is.name(e1Expr))
                e1 <- as.character(e1Expr)
            eval(substitute(help(TOPIC), list(TOPIC = e1)))
        }
        else {
            if (is.name(e1Expr))
                e1 <- as.character(e1Expr)
            e2Expr <- substitute(e2)
            if (is.name(e2Expr))
                e2 <- as.character(e2Expr)
            else if (is.call(e2Expr) && identical(e1, "method"))
               return(.helpForCall(e2Expr, parent.frame(), FALSE))
            topic <- topicName(e1, e2)
            doHelp <- .tryHelp(topic)
            if (inherits(doHelp, "try-error")) {
                stop(gettextf("no documentation of type '%s' and topic 
'%s' (or error in processing help)",
                    e1, e2), domain = NA)
            }
        }
    }
    <environment: namespace:utils>

I was playing around with the idea of the ways one could try build a J 
interpreter with R and it seemed like being able to define custom unary / 
binary operators like that could be convenient.

Thanks,

Trevor Davis
Federal Reserve Board of Governors


From bolker at zoo.ufl.edu  Thu Mar 13 23:04:34 2008
From: bolker at zoo.ufl.edu (Ben Bolker)
Date: Thu, 13 Mar 2008 18:04:34 -0400
Subject: [Rd] graphics defaults
Message-ID: <47D9A4F2.6030609@zoo.ufl.edu>


   Can someone point me to a justification for the design
decisions, which seem to be similar in lattice and
ggplot2, of (1) gray backgrounds and (2) filled points?
[I seem to remember seeing somewhere the opposite recommendation
for points, i.e. that open points make it much easier to
see if there are overlapping values -- and this would
be a reason that pch=1 gives an open circle ...]

   cheers
     Ben Bolker


-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 252 bytes
Desc: OpenPGP digital signature
Url : https://stat.ethz.ch/pipermail/r-devel/attachments/20080313/37b09855/attachment.bin 

From h.wickham at gmail.com  Thu Mar 13 23:15:12 2008
From: h.wickham at gmail.com (hadley wickham)
Date: Thu, 13 Mar 2008 17:15:12 -0500
Subject: [Rd] graphics defaults
In-Reply-To: <47D9A4F2.6030609@zoo.ufl.edu>
References: <47D9A4F2.6030609@zoo.ufl.edu>
Message-ID: <f8e6ff050803131515n29615162x8225050e787870e5@mail.gmail.com>

>    Can someone point me to a justification for the design
>  decisions, which seem to be similar in lattice and
>  ggplot2, of (1) gray backgrounds and (2) filled points?
>  [I seem to remember seeing somewhere the opposite recommendation
>  for points, i.e. that open points make it much easier to
>  see if there are overlapping values -- and this would
>  be a reason that pch=1 gives an open circle ...]

>From a paper I'm working on:

This follows from the advice of
\citet{tufte:2006,tufte:1990,tufte:2001,tufte:1997} and
\citet{brewer:1994,carr:2002,carr:1994,carr:1999}. We can still see
the gridlines to aid in judgement of position \citep{cleveland:1993a},
but they have little visual impact and we can easily ``tune'' them
out. The grey background gives the plot a similar colour (in a
typographical sense) to the remainder of the text, ensuring that the
graphics fit in with the flow of a text without jumping out with a
bright white background. Finally, the grey background creates a
continuous field of colour which ensures that the plot is perceived as
a single visual entity.

I can dig out the exact references if you need them.

Hadley

-- 
http://had.co.nz/


From ripley at stats.ox.ac.uk  Fri Mar 14 07:51:40 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 14 Mar 2008 06:51:40 +0000 (GMT)
Subject: [Rd] Making custom unary operators in R
In-Reply-To: <OFCCA59E6A.E6373F4C-ON8525740B.0074C70B-8525740B.0077F346@frbog.frb.gov>
References: <OFCCA59E6A.E6373F4C-ON8525740B.0074C70B-8525740B.0077F346@frbog.frb.gov>
Message-ID: <alpine.LFD.1.00.0803140648540.2165@gannet.stats.ox.ac.uk>

The issue here is the parser:  ? works because the parser knows about it. 
To allow further unary operators would need a parser change.

On Thu, 13 Mar 2008, Trevor.L.Davis at frb.gov wrote:

> Hello,
>
> Is there a way to define a custom unary operator in R (other than making a
> class and 'overloading' the normal unary operators in R)?  The
> documentation seems to suggest that only custom binary operators are
> possible with the ``%abc%``construct but I was wondering whether any one
> has done so.  None of the RSiteSearch or RSeek queries I posed suggested
> that this question had been asked before but if it has, a link to the
> relevant discussion thread would be wonderful.
>
> For example in the J language the ``! `` sign is a unary operator for the
> factorial function and a binary operator for the choose function so I
> would like to be able to define a similar operator like this::
>
>    '%!%' <-  function(e1, e2) {
>           if (missing(e2)) factorial(e1)
>           else choose(e2, e1)
>           }
>
> The binary version of the operator works fine:
>
>    > 2 %!% 4
>    [1] 6
>
> But the unary one doesn't (which is perfectly understandable since there
> is no indication in any documentation I have seen that suggests it
> should):::
>
>    > %!% 4
>    Error: unexpected SPECIAL in "%!%"
>
> The source code for the '?' operator almost seems to suggest that a mixed
> unary / binary non-primitive R function is possible::
>
>    > get('?')
>    function (e1, e2)
>    {
>        e1Expr <- substitute(e1)
>        if (missing(e2)) {
>            if (is.call(e1Expr))
>                return(.helpForCall(e1Expr, parent.frame()))
>            if (is.name(e1Expr))
>                e1 <- as.character(e1Expr)
>            eval(substitute(help(TOPIC), list(TOPIC = e1)))
>        }
>        else {
>            if (is.name(e1Expr))
>                e1 <- as.character(e1Expr)
>            e2Expr <- substitute(e2)
>            if (is.name(e2Expr))
>                e2 <- as.character(e2Expr)
>            else if (is.call(e2Expr) && identical(e1, "method"))
>               return(.helpForCall(e2Expr, parent.frame(), FALSE))
>            topic <- topicName(e1, e2)
>            doHelp <- .tryHelp(topic)
>            if (inherits(doHelp, "try-error")) {
>                stop(gettextf("no documentation of type '%s' and topic
> '%s' (or error in processing help)",
>                    e1, e2), domain = NA)
>            }
>        }
>    }
>    <environment: namespace:utils>
>
> I was playing around with the idea of the ways one could try build a J
> interpreter with R and it seemed like being able to define custom unary /
> binary operators like that could be convenient.
>
> Thanks,
>
> Trevor Davis
> Federal Reserve Board of Governors
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From deepayan.sarkar at r-project.org  Fri Mar 14 08:06:41 2008
From: deepayan.sarkar at r-project.org (Deepayan Sarkar)
Date: Fri, 14 Mar 2008 00:06:41 -0700
Subject: [Rd] graphics defaults
In-Reply-To: <47D9A4F2.6030609@zoo.ufl.edu>
References: <47D9A4F2.6030609@zoo.ufl.edu>
Message-ID: <eb555e660803140006t28177bd4o843c1c7383bd413a@mail.gmail.com>

On 3/13/08, Ben Bolker <bolker at zoo.ufl.edu> wrote:
>
>    Can someone point me to a justification for the design
>  decisions, which seem to be similar in lattice and
>  ggplot2, of

Disclaimer: I don't have strong personal preferences, I just went with
what Trellis had. That said,

> (1) gray backgrounds and

lattice's default background is now white, and this was partly because
many people seemed to dislike the grey background. My personal feeling
is that it looked good on a screen or when using a beamer, but not so
good when printed. ggplot's background is lighter, so this probably
does not apply.

> (2) filled points?
>  [I seem to remember seeing somewhere the opposite recommendation
>  for points, i.e. that open points make it much easier to
>  see if there are overlapping values -- and this would
>  be a reason that pch=1 gives an open circle ...]

lattice does have open circles by default, except in ungrouped dot
plots, where there is no possibility of overlapping.

-Deepayan


From ripley at stats.ox.ac.uk  Fri Mar 14 08:44:13 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 14 Mar 2008 07:44:13 +0000 (GMT)
Subject: [Rd] graphics defaults
In-Reply-To: <eb555e660803140006t28177bd4o843c1c7383bd413a@mail.gmail.com>
References: <47D9A4F2.6030609@zoo.ufl.edu>
	<eb555e660803140006t28177bd4o843c1c7383bd413a@mail.gmail.com>
Message-ID: <alpine.LFD.1.00.0803140725300.3530@gannet.stats.ox.ac.uk>

On Fri, 14 Mar 2008, Deepayan Sarkar wrote:

> On 3/13/08, Ben Bolker <bolker at zoo.ufl.edu> wrote:
>>
>>    Can someone point me to a justification for the design
>>  decisions, which seem to be similar in lattice and
>>  ggplot2, of
>
> Disclaimer: I don't have strong personal preferences, I just went with
> what Trellis had. That said,
>
>> (1) gray backgrounds and
>
> lattice's default background is now white, and this was partly because
> many people seemed to dislike the grey background. My personal feeling
> is that it looked good on a screen or when using a beamer, but not so
> good when printed. ggplot's background is lighter, so this probably
> does not apply.

My memory is that Trellis had different schemes for different devices, so 
the background was white for plots intended for a printer.  Also, the 
default scheme for postscript() was 'black and white', and few people had 
colour printers.

Viewing conditions do matter here.  I remember that in 1992 Trellis' grey 
looked horribly dark and muddy on Bill Venables' Sun monitor, something we 
were able to alleviate by adjusting it.  But there is dissent about the 
gamma to be used on viewing screens and how dark a particular mid grey 
appears do depends on the gamma.  [Most use ca 2.2, Macs have always been 
different at 1.8, and I believe the SGI systems used at Bell Labs at the 
time Trellis was developed were different again.  Beamers (computer 
projectors) are often way off in their colour accuracy.]


>> (2) filled points?
>>  [I seem to remember seeing somewhere the opposite recommendation
>>  for points, i.e. that open points make it much easier to
>>  see if there are overlapping values -- and this would
>>  be a reason that pch=1 gives an open circle ...]
>
> lattice does have open circles by default, except in ungrouped dot
> plots, where there is no possibility of overlapping.

There are choices between 'open' and 'closed', and I find using 
translucent fills makes overlap easier to detect.  As from R 2.7.0 most 
graphics devices are capable of handling semi-transparent colours (at 
least on an opaque background, which is what is needed here).

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Fri Mar 14 10:55:59 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 14 Mar 2008 09:55:59 +0000 (GMT)
Subject: [Rd] Subsetting vectors/arrays using factors can be seen as
 misleading
In-Reply-To: <27d1e6020803121406j1a532b63n352b235fdd986a8e@mail.gmail.com>
References: <27d1e6020803121406j1a532b63n352b235fdd986a8e@mail.gmail.com>
Message-ID: <alpine.LFD.1.00.0803122146290.4301@gannet.stats.ox.ac.uk>

This is long established and documented on the basic help page for '['.
Further, the convention is widely used in R itself: running 'make check' 
would give a few hundred warnings and then fail.  Working around those 
warnings would be inefficient (involving unnecessary copying of large 
objects).

One place where this matters is the advice to use levels(x)[x] as in 
as.character.factor() -- that construction is widespread, perhaps so 
widespread as to make it worthwhile making that an internal operation.

On Thu, 13 Mar 2008, Laurent Gautier wrote:

> Dear list,
>
> Subsetting vectors/arrays using factors can be seen as misleading, and
> I was thinking that it could be discouraged (at least by issuing a
> warning).
> I could not find whether this was discussed earlier, but I can be
> pointed to a reference if I missed any.
>
> The "extract" operator "[" can take as arguments either vectors of
> integers or vectors of characters in order to subset a data structure.
> For example:
>> x <- seq(1, 5)
>> names(x) <- letters[1:5]
>>
>> x[1]
> a
> 1
>> x["a"]
> a
> 1
>
> Using a factor caused some confusion to someone here, and I have to
> admit that it can indeed appear misleading:
>> f <- factor("a", levels=c("b", "a", "c"))
>> f
> [1] a
> Levels: b a c
>> x[f]  # here the integer is used, rather than the level
> b
> 2
>
> The dual nature of the factor (vector of integers, with an attached
> vector of levels), is not always clear to many users, especially since
> factors are treated differently in other situations.
> Example:
>> f == 1
> [1] FALSE
>> f == "a" #here the level is used, not the integer
> [1] TRUE
>
> This is making me suggest that indexing using a factor could issue a
> warning, and the user should explicitly wrap the vector with either
> "as.integer" or "as.character".
>
>
> L.
>
> PS: All examples above were run with
> platform       x86_64-unknown-linux-gnu
> arch           x86_64
> os             linux-gnu
> system         x86_64, linux-gnu
> status         Under development (unstable)
> major          2
> minor          7.0
> year           2008
> month          03
> day            12
> svn rev        44742
> language       R
> version.string R version 2.7.0 Under development (unstable) (2008-03-12 r44742)
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From lgautier at gmail.com  Fri Mar 14 11:24:53 2008
From: lgautier at gmail.com (Laurent Gautier)
Date: Fri, 14 Mar 2008 11:24:53 +0100
Subject: [Rd] Subsetting vectors/arrays using factors can be seen as
	misleading
In-Reply-To: <alpine.LFD.1.00.0803122146290.4301@gannet.stats.ox.ac.uk>
References: <27d1e6020803121406j1a532b63n352b235fdd986a8e@mail.gmail.com>
	<alpine.LFD.1.00.0803122146290.4301@gannet.stats.ox.ac.uk>
Message-ID: <27d1e6020803140324r41bbccddi47d4ac57244a0044@mail.gmail.com>

Thanks for your answer.

I understand that this is long established, but I would suspect that the
usage of extracting by names was then less common (I can easily
admit that this is pure speculation on my side, I have no data to support this).
As R evolves, sometimes things happen to be deprecated (a recent example
seems to be ''$" on atomic vectors).

I also understand that the behavior is documented, but I have seen it
causing trouble to someone that was not a complete beginner with R,
and I could only agree with the fact that this is somewhat misleading
after I helped solving the problem.

Suggesting a warning and keep the current behavior is just an idea
(that would not break existing code). Similarly, casting factors into
integers was just a way to illustrate the point. Something that would
not involve unnecessary copies of (potentially large) objects can be
considered (may be using "unclass()" does not involve making a copy
and could be used in place of "as.integer" ?).



2008/3/14, Prof Brian Ripley <ripley at stats.ox.ac.uk>:
> This is long established and documented on the basic help page for '['.
>  Further, the convention is widely used in R itself: running 'make check'
>  would give a few hundred warnings and then fail.  Working around those
>  warnings would be inefficient (involving unnecessary copying of large
>  objects).
>
>  One place where this matters is the advice to use levels(x)[x] as in
>  as.character.factor() -- that construction is widespread, perhaps so
>  widespread as to make it worthwhile making that an internal operation.
>
>
>  On Thu, 13 Mar 2008, Laurent Gautier wrote:
>
>  > Dear list,
>  >
>  > Subsetting vectors/arrays using factors can be seen as misleading, and
>  > I was thinking that it could be discouraged (at least by issuing a
>  > warning).
>  > I could not find whether this was discussed earlier, but I can be
>  > pointed to a reference if I missed any.
>  >
>  > The "extract" operator "[" can take as arguments either vectors of
>  > integers or vectors of characters in order to subset a data structure.
>  > For example:
>  >> x <- seq(1, 5)
>  >> names(x) <- letters[1:5]
>  >>
>  >> x[1]
>  > a
>  > 1
>  >> x["a"]
>  > a
>  > 1
>  >
>  > Using a factor caused some confusion to someone here, and I have to
>  > admit that it can indeed appear misleading:
>  >> f <- factor("a", levels=c("b", "a", "c"))
>  >> f
>  > [1] a
>  > Levels: b a c
>  >> x[f]  # here the integer is used, rather than the level
>  > b
>  > 2
>  >
>  > The dual nature of the factor (vector of integers, with an attached
>  > vector of levels), is not always clear to many users, especially since
>  > factors are treated differently in other situations.
>  > Example:
>  >> f == 1
>  > [1] FALSE
>  >> f == "a" #here the level is used, not the integer
>  > [1] TRUE
>  >
>  > This is making me suggest that indexing using a factor could issue a
>  > warning, and the user should explicitly wrap the vector with either
>  > "as.integer" or "as.character".
>  >
>  >
>  > L.
>  >
>  > PS: All examples above were run with
>  > platform       x86_64-unknown-linux-gnu
>  > arch           x86_64
>  > os             linux-gnu
>  > system         x86_64, linux-gnu
>  > status         Under development (unstable)
>  > major          2
>  > minor          7.0
>  > year           2008
>  > month          03
>  > day            12
>  > svn rev        44742
>  > language       R
>  > version.string R version 2.7.0 Under development (unstable) (2008-03-12 r44742)
>  >
>
> > ______________________________________________
>  > R-devel at r-project.org mailing list
>  > https://stat.ethz.ch/mailman/listinfo/r-devel
>  >
>
>
>  --
>  Brian D. Ripley,                  ripley at stats.ox.ac.uk
>  Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
>  University of Oxford,             Tel:  +44 1865 272861 (self)
>  1 South Parks Road,                     +44 1865 272866 (PA)
>  Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>


-- 
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)

iEYEARECAAYFAkYgwJ4ACgkQB/w/MLoyRDeQlgCeMp8v69/Wy24Q4IaBVhoG1M5R
2h4AoIOTvKbrFpTklRDjV7u8tEOeSQqt
=JPph
-----END PGP SIGNATURE-----


From efremov at mpiz-koeln.mpg.de  Fri Mar 14 11:45:05 2008
From: efremov at mpiz-koeln.mpg.de (efremov at mpiz-koeln.mpg.de)
Date: Fri, 14 Mar 2008 11:45:05 +0100 (CET)
Subject: [Rd] write function (PR#10953)
Message-ID: <20080314104505.DFB9B282EFF6@mail.pubhealth.ku.dk>

Full_Name: Alexander Yephremov
Version: R 2.6.2 GUI 1.23 (4932) (4932)
OS: Mac OS X 10.4 
Submission from: (NULL) (193.174.239.91)


Hi!

> array <- 0*1:50
> array
 [1] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0
> write(array, "array.file", sep=",")

This is how array.file looks:

0,0,0,0,0
0,0,0,0,0
0,0,0,0,0
0,0,0,0,0
0,0,0,0,0
0,0,0,0,0
0,0,0,0,0
0,0,0,0,0
0,0,0,0,0
0,0,0,0,0

As you see, the resulting array.file is organized in 5 columns although, I think
there must be a vector. It is the same with any sep.
Best regards,
Alexander


From hilmar.berger at imise.uni-leipzig.de  Fri Mar 14 15:45:40 2008
From: hilmar.berger at imise.uni-leipzig.de (Hilmar Berger)
Date: Fri, 14 Mar 2008 15:45:40 +0100
Subject: [Rd] write function (PR#10953)
In-Reply-To: <20080314104505.DFB9B282EFF6@mail.pubhealth.ku.dk>
References: <20080314104505.DFB9B282EFF6@mail.pubhealth.ku.dk>
Message-ID: <fre319$jfm$1@ger.gmane.org>

Hi Alexander,

from the Help page of write:


Usage
write(x, file = "data",
       ncolumns = if(is.character(x)) 1 else 5,
       append = FALSE, sep = " ")

Arguments

x the data to be written out.
file A connection, or a character string naming the file to write to. If 
"", print to the standard output connection.

ncolumns the number of columns to write the data in.

append if TRUE the data x are appended to the connection.
sep a string used to separate columns. Using sep = "\t" gives tab 
delimited output; default is " ".


So, set ncolumns to 1 for a one-column file. No bug AFAIKS.

Regards,
Hilmar



efremov at mpiz-koeln.mpg.de schrieb:
> Full_Name: Alexander Yephremov
> Version: R 2.6.2 GUI 1.23 (4932) (4932)
> OS: Mac OS X 10.4 
> Submission from: (NULL) (193.174.239.91)
> 
> 
> Hi!
> 
>> array <- 0*1:50
>> array
>  [1] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
> 0 0 0 0 0 0 0 0 0 0 0 0
>> write(array, "array.file", sep=",")
> 
> This is how array.file looks:
> 
> 0,0,0,0,0
> 0,0,0,0,0
> 0,0,0,0,0
> 0,0,0,0,0
> 0,0,0,0,0
> 0,0,0,0,0
> 0,0,0,0,0
> 0,0,0,0,0
> 0,0,0,0,0
> 0,0,0,0,0
> 
> As you see, the resulting array.file is organized in 5 columns although, I think
> there must be a vector. It is the same with any sep.
> Best regards,
> Alexander
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From murdoch at stats.uwo.ca  Fri Mar 14 15:46:46 2008
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Fri, 14 Mar 2008 10:46:46 -0400
Subject: [Rd] write function (PR#10953)
In-Reply-To: <20080314104505.DFB9B282EFF6@mail.pubhealth.ku.dk>
References: <20080314104505.DFB9B282EFF6@mail.pubhealth.ku.dk>
Message-ID: <47DA8FD6.3020700@stats.uwo.ca>

On 3/14/2008 6:45 AM, efremov at mpiz-koeln.mpg.de wrote:
> Full_Name: Alexander Yephremov
> Version: R 2.6.2 GUI 1.23 (4932) (4932)
> OS: Mac OS X 10.4 
> Submission from: (NULL) (193.174.239.91)
> 
> 
> Hi!
> 
>> array <- 0*1:50
>> array
>  [1] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
> 0 0 0 0 0 0 0 0 0 0 0 0
>> write(array, "array.file", sep=",")
> 
> This is how array.file looks:
> 
> 0,0,0,0,0
> 0,0,0,0,0
> 0,0,0,0,0
> 0,0,0,0,0
> 0,0,0,0,0
> 0,0,0,0,0
> 0,0,0,0,0
> 0,0,0,0,0
> 0,0,0,0,0
> 0,0,0,0,0
> 
> As you see, the resulting array.file is organized in 5 columns although, I think
> there must be a vector. It is the same with any sep.

I don't see a bug.  This is pretty clearly behaving as documented.  By 
default, it sets ncolumns to 5 for non-character data.

If you want it all on one line, set ncolumns to length(array).

Duncan Murdoch


From hb at stat.berkeley.edu  Fri Mar 14 15:54:46 2008
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Fri, 14 Mar 2008 07:54:46 -0700
Subject: [Rd] write function (PR#10953)
In-Reply-To: <20080314104505.DFB9B282EFF6@mail.pubhealth.ku.dk>
References: <20080314104505.DFB9B282EFF6@mail.pubhealth.ku.dk>
Message-ID: <59d7961d0803140754g4fa0882fma5f12d94fcf41944@mail.gmail.com>

First of all, it's not a bug.  Please don't report bugs before
bringing up the "issue" on r-devel.   FYI, there are people (not me),
who have to go through all bug reports, tag them, and clean them out
manually.

If you do print(write), your concerns are answered:

function (x, file = "data", ncolumns = if (is.character(x)) 1 else 5,
    append = FALSE, sep = " ")
cat(x, file = file, sep = c(rep.int(sep, ncolumns - 1), "\n"),
    append = append)
<environment: namespace:base>

You could also have inferred that from reading help(write).

Now, why there is this default rule for writing non-character values
in 5 columns I don't know.  There must be a historical reason for this
design.

Cheers

/Henrik

On Fri, Mar 14, 2008 at 3:45 AM,  <efremov at mpiz-koeln.mpg.de> wrote:
> Full_Name: Alexander Yephremov
>  Version: R 2.6.2 GUI 1.23 (4932) (4932)
>  OS: Mac OS X 10.4
>  Submission from: (NULL) (193.174.239.91)
>
>
>  Hi!
>
>  > array <- 0*1:50
>  > array
>   [1] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
>  0 0 0 0 0 0 0 0 0 0 0 0
>  > write(array, "array.file", sep=",")
>
>  This is how array.file looks:
>
>  0,0,0,0,0
>  0,0,0,0,0
>  0,0,0,0,0
>  0,0,0,0,0
>  0,0,0,0,0
>  0,0,0,0,0
>  0,0,0,0,0
>  0,0,0,0,0
>  0,0,0,0,0
>  0,0,0,0,0
>
>  As you see, the resulting array.file is organized in 5 columns although, I think
>  there must be a vector. It is the same with any sep.
>  Best regards,
>  Alexander
>
>  ______________________________________________
>  R-devel at r-project.org mailing list
>  https://stat.ethz.ch/mailman/listinfo/r-devel
>


From Trevor.L.Davis at frb.gov  Fri Mar 14 16:46:41 2008
From: Trevor.L.Davis at frb.gov (Trevor.L.Davis at frb.gov)
Date: Fri, 14 Mar 2008 11:46:41 -0400
Subject: [Rd] Making custom unary operators in R
In-Reply-To: <alpine.LFD.1.00.0803140648540.2165@gannet.stats.ox.ac.uk>
Message-ID: <OF59CB2A76.EF6906D1-ON8525740C.00568A11-8525740C.0056AC26@frbog.frb.gov>

Professor Ripley,

Thanks for answering my question.

Trevor


From anders at ebi.ac.uk  Fri Mar 14 18:16:38 2008
From: anders at ebi.ac.uk (Simon Anders)
Date: Fri, 14 Mar 2008 17:16:38 +0000
Subject: [Rd] 'merge' function: behavior w.r.t. NAs in the key column
Message-ID: <47DAB2F6.3050002@ebi.ac.uk>

Hi,

I recently ran into a problem with 'merge' that stems from the way how 
missing values in the key column (i.e., the column specified
in the "by" argument) are handled. I wonder whether the current behavior 
is fully consistent.

Please have a look at this example:

> x <- data.frame( key = c(1:3,3,NA,NA), val = 10+1:6 )
> y <- data.frame( key = c(NA,2:5,3,NA), val = 20+1:7 )

> x
   key val
1   1  11
2   2  12
3   3  13
4   3  14
5  NA  15
6  NA  16

> y
   key val
1  NA  21
2   2  22
3   3  23
4   4  24
5   5  25
6   3  26
7  NA  27

> merge( x, y, by="key" )
   key val.x val.y
1   2    12    22
2   3    13    23
3   3    13    26
4   3    14    23
5   3    14    26
6  NA    15    21
7  NA    15    27
8  NA    16    21
9  NA    16    27

As one should expect, there are now four lines with key value '3',
because the key '3' appears twice both in x and in y. According to the
logic of merge, a row should be produced in the output for each pairing
of a row from x and a row from y where the values of 'key' are equal.

However, the 'NA' values are treated exactly the same way. It seems that 
'merge' considers the pairing of lines with 'NA' in both 'key' columns 
an allowed match. IMHO, this runs against the convention that two NAs 
are not considered equal. ('NA==NA' does not evaluate to 'TRUE'.)

Is might be more consistent if merge did not include any rows into the 
output with an "NA" in the key column.

Maybe, one could add a flag argument to 'merge' to switch between this 
behaviour and the current one? A note in the help page might be nice, too.

Best regards
   Simon



+---
| Dr. Simon Anders, Dipl. Phys.
| European Bioinformatics Institute, Hinxton, Cambridgeshire, UK
| office phone +44-1223-494478, mobile phone +44-7505-841692
| preferred (permanent) e-mail: sanders at fs.tum.de


From MorozZbigniew at aster.pl  Fri Mar 14 15:20:24 2008
From: MorozZbigniew at aster.pl (MorozZbigniew at aster.pl)
Date: Fri, 14 Mar 2008 15:20:24 +0100 (CET)
Subject: [Rd] dump() function (PR#10954)
Message-ID: <20080314142024.49CD92834613@mail.pubhealth.ku.dk>

Full_Name: Moroz Zbigniew
Version: R 2.6.2
OS: 
Submission from: (NULL) (62.121.118.102)


Very elementary question:
In my R 2.6.2 version function dump() is reported to be not known.
Is it in one of packages? Which one ?


From somorcik at fmph.uniba.sk  Fri Mar 14 15:40:04 2008
From: somorcik at fmph.uniba.sk (somorcik at fmph.uniba.sk)
Date: Fri, 14 Mar 2008 15:40:04 +0100 (CET)
Subject: [Rd] crazy behavior after Error (PR#10956)
Message-ID: <20080314144004.D3929283460E@mail.pubhealth.ku.dk>

Full_Name: Jan Somorcik
Version: 2.6.0
OS: Windows XP HOME
Submission from: (NULL) (158.195.31.33)


I used to run a simulation with 5000 iterations. For a long time everything was
OK, but since yesterday R stops after 500-1500 iterations [never at the same
position] with an [random?] Error message [always something else, e.g.:

Error in ans[[i]] <- tmp : incorrect number of arguments to "<-"

And after that R gets crazy:
Most of the commands result in an Error message, just an example:

> d
[1] 3
> d<-7
Error: could not find function "<-"
> objects()
Error in objects() : 
  Value of SET_STRING_ELT() must be a 'CHARSXP' not a 'double'
> sum(c(1,2,3))
Error: could not find function "sum"


It's always different. The most crazy situation was:
the result of an ARBITRARY command was a STRING containing the call of the
previuos command :-)))

What is the problem?
Is it an issue of Windows XP? It's beeing updated regularly and the on-line
scanners [Panda, Symantec, Kaspersky... did not report infection]

Other applications running:
-Total Commander
-notepad
-AVG Free antivirus

The behaviour is not reproducible, it is always different.


From shli at stat.wvu.edu  Fri Mar 14 15:18:07 2008
From: shli at stat.wvu.edu (Shengqiao Li)
Date: Fri, 14 Mar 2008 09:18:07 -0500 (EST)
Subject: [Rd] Buggy Kinderman-Ramage (PR#2846)
Message-ID: <Pine.GSO.4.61.0803140910010.11648@bayes>


Unfortunately, RNGkind is buggy. It will not generate warnings 
except the full name "Buggy Kinderman-Ramage" is supplied for normal.kind.

match.arg is supposed to be called before "==" comparison.


========================================
Shengqiao Li

Research Associate
The Department of Statistics
PO Box 6330
West Virginia University
Morgantown, WV 26506-6330


From pgilbert at bank-banque-canada.ca  Fri Mar 14 20:23:03 2008
From: pgilbert at bank-banque-canada.ca (Paul Gilbert)
Date: Fri, 14 Mar 2008 15:23:03 -0400
Subject: [Rd] Buggy Kinderman-Ramage (PR#2846)
In-Reply-To: <Pine.GSO.4.61.0803140910010.11648@bayes>
References: <Pine.GSO.4.61.0803140910010.11648@bayes>
Message-ID: <47DAD097.7070200@bank-banque-canada.ca>

Could you please supply complete details, including an example to 
reproduce the error message you get.

The "Buggy Kinderman-Ramage" error message is produced when you try to 
force the use of an old RNG that is known to have bugs. Usually it 
should not appear, so I think you are doing something unusual.

Paul Gilbert

Shengqiao Li wrote:
> Unfortunately, RNGkind is buggy. It will not generate warnings 
> except the full name "Buggy Kinderman-Ramage" is supplied for normal.kind.
> 
> match.arg is supposed to be called before "==" comparison.
> 
> 
> ========================================
> Shengqiao Li
> 
> Research Associate
> The Department of Statistics
> PO Box 6330
> West Virginia University
> Morgantown, WV 26506-6330
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
====================================================================================

La version fran?aise suit le texte anglais.

------------------------------------------------------------------------------------

This email may contain privileged and/or confidential information, and the Bank of
Canada does not waive any related rights. Any distribution, use, or copying of this
email or the information it contains by other than the intended recipient is
unauthorized. If you received this email in error please delete it immediately from
your system and notify the sender promptly by email that you have done so. 

------------------------------------------------------------------------------------

Le pr?sent courriel peut contenir de l'information privil?gi?e ou confidentielle.
La Banque du Canada ne renonce pas aux droits qui s'y rapportent. Toute diffusion,
utilisation ou copie de ce courriel ou des renseignements qu'il contient par une
personne autre que le ou les destinataires d?sign?s est interdite. Si vous recevez
ce courriel par erreur, veuillez le supprimer imm?diatement et envoyer sans d?lai ?
l'exp?diteur un message ?lectronique pour l'aviser que vous avez ?limin? de votre
ordinateur toute copie du courriel re?u.

From Achim.Zeileis at wu-wien.ac.at  Fri Mar 14 20:37:35 2008
From: Achim.Zeileis at wu-wien.ac.at (Achim Zeileis)
Date: Fri, 14 Mar 2008 20:37:35 +0100 (CET)
Subject: [Rd] dump() function (PR#10954)
In-Reply-To: <20080314142024.49CD92834613@mail.pubhealth.ku.dk>
Message-ID: <Pine.LNX.4.44.0803142033160.3817-100000@disco.wu-wien.ac.at>

On Fri, 14 Mar 2008 MorozZbigniew at aster.pl wrote:

> Full_Name: Moroz Zbigniew
> Version: R 2.6.2
> OS:
> Submission from: (NULL) (62.121.118.102)
>
> Very elementary question:

Very elementary questions should not be reported as bugs!
Plese read:
  http://CRAN.R-project.org/doc/FAQ/R-FAQ.html#R-Bugs
  http://www.R-project.org/posting-guide.html

> In my R 2.6.2 version function dump() is reported to be not known.
> Is it in one of packages? Which one ?

It is in the "base" package.
Z


From ripley at stats.ox.ac.uk  Fri Mar 14 20:40:14 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 14 Mar 2008 19:40:14 +0000 (GMT)
Subject: [Rd] Buggy Kinderman-Ramage (PR#2846)
In-Reply-To: <47DAD097.7070200@bank-banque-canada.ca>
References: <Pine.GSO.4.61.0803140910010.11648@bayes>
	<47DAD097.7070200@bank-banque-canada.ca>
Message-ID: <alpine.LFD.1.00.0803141936180.22505@gannet.stats.ox.ac.uk>

On Fri, 14 Mar 2008, Paul Gilbert wrote:

> Could you please supply complete details, including an example to
> reproduce the error message you get.
>
> The "Buggy Kinderman-Ramage" error message is produced when you try to
> force the use of an old RNG that is known to have bugs. Usually it
> should not appear, so I think you are doing something unusual.

And undocumented -- "Buggy Kinderman-Ramage" is not a documented value for 
normal.kind, so what happens when you use it (or any other undocumented 
value) is undefined.  (It is not a bug to fail to pick up every user 
error.)

>
> Paul Gilbert
>
> Shengqiao Li wrote:
>> Unfortunately, RNGkind is buggy. It will not generate warnings
>> except the full name "Buggy Kinderman-Ramage" is supplied for normal.kind.
>>
>> match.arg is supposed to be called before "==" comparison.

Quote your authority for this, please!

>>
>> ========================================
>> Shengqiao Li
>>
>> Research Associate
>> The Department of Statistics
>> PO Box 6330
>> West Virginia University
>> Morgantown, WV 26506-6330
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
> ====================================================================================
>
> La version fran?aise suit le texte anglais.
>
> ------------------------------------------------------------------------------------
>
> This email may contain privileged and/or confidential information, and the Bank of
> Canada does not waive any related rights. Any distribution, use, or copying of this
> email or the information it contains by other than the intended recipient is
> unauthorized. If you received this email in error please delete it immediately from
> your system and notify the sender promptly by email that you have done so.
>
> ------------------------------------------------------------------------------------
>
> Le pr?sent courriel peut contenir de l'information privil?gi?e ou confidentielle.
> La Banque du Canada ne renonce pas aux droits qui s'y rapportent. Toute diffusion,
> utilisation ou copie de ce courriel ou des renseignements qu'il contient par une
> personne autre que le ou les destinataires d?sign?s est interdite. Si vous recevez
> ce courriel par erreur, veuillez le supprimer imm?diatement et envoyer sans d?lai ?
> l'exp?diteur un message ?lectronique pour l'aviser que vous avez ?limin? de votre
> ordinateur toute copie du courriel re?u.
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From DNADave at insightful.com  Sat Mar 15 00:23:17 2008
From: DNADave at insightful.com (David Henderson)
Date: Fri, 14 Mar 2008 16:23:17 -0700
Subject: [Rd] (no subject)
Message-ID: <1205536997.9779.10.camel@minime.insightful.com>

change r-devel dnadavenator at gmail.com


From bill at insightful.com  Sat Mar 15 00:57:42 2008
From: bill at insightful.com (Bill Dunlap)
Date: Fri, 14 Mar 2008 16:57:42 -0700 (PDT)
Subject: [Rd] 'merge' function: behavior w.r.t. NAs in the key column
In-Reply-To: <47DAB2F6.3050002@ebi.ac.uk>
References: <47DAB2F6.3050002@ebi.ac.uk>
Message-ID: <Pine.GSO.4.56.0803141649050.1946@devsun3201.insightful.com>

On Fri, 14 Mar 2008, Simon Anders wrote:

> I recently ran into a problem with 'merge' that stems from the way how
> missing values in the key column (i.e., the column specified
> in the "by" argument) are handled. I wonder whether the current behavior
> is fully consistent.
> ...
> > x <- data.frame( key = c(1:3,3,NA,NA), val = 10+1:6 )
> > y <- data.frame( key = c(NA,2:5,3,NA), val = 20+1:7 )
> ...
> > merge( x, y, by="key" )
>    key val.x val.y
> 1   2    12    22
> 2   3    13    23
> 3   3    13    26
> 4   3    14    23
> 5   3    14    26
> 6  NA    15    21
> 7  NA    15    27
> 8  NA    16    21
> 9  NA    16    27
>
> As one should expect, there are now four lines with key value '3',
> because the key '3' appears twice both in x and in y. According to the
> logic of merge, a row should be produced in the output for each pairing
> of a row from x and a row from y where the values of 'key' are equal.
>
> However, the 'NA' values are treated exactly the same way. It seems that
> 'merge' considers the pairing of lines with 'NA' in both 'key' columns
> an allowed match. IMHO, this runs against the convention that two NAs
> are not considered equal. ('NA==NA' does not evaluate to 'TRUE'.)
>
> Is might be more consistent if merge did not include any rows into the
> output with an "NA" in the key column.
>
> Maybe, one could add a flag argument to 'merge' to switch between this
> behaviour and the current one? A note in the help page might be nice, too.

Splus (versions 8.0, 7.0, and 6.2) gives:
   > merge( x, y, by="key" )
     key val.x val.y
   1   2    12    22
   2   3    13    23
   3   3    14    23
   4   3    13    26
   5   3    14    26
Is that what you expect?  There is no argument
to Splus's merge to make it include the NA's
in the way R's merge does.  Should there be such
an argument?

----------------------------------------------------------------------------
Bill Dunlap
Insightful Corporation
bill at insightful dot com

 "All statements in this message represent the opinions of the author and do
 not necessarily reflect Insightful Corporation policy or position."


From murdoch at stats.uwo.ca  Sat Mar 15 01:55:05 2008
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Fri, 14 Mar 2008 20:55:05 -0400
Subject: [Rd] crazy behavior after Error (PR#10956)
In-Reply-To: <20080314144004.D3929283460E@mail.pubhealth.ku.dk>
References: <20080314144004.D3929283460E@mail.pubhealth.ku.dk>
Message-ID: <47DB1E69.3060500@stats.uwo.ca>

somorcik at fmph.uniba.sk wrote:
> Full_Name: Jan Somorcik
> Version: 2.6.0
> OS: Windows XP HOME
> Submission from: (NULL) (158.195.31.33)
>
>
> I used to run a simulation with 5000 iterations. For a long time everything was
> OK, but since yesterday R stops after 500-1500 iterations [never at the same
> position] with an [random?] Error message [always something else, e.g.:
>
> Error in ans[[i]] <- tmp : incorrect number of arguments to "<-"
>
> And after that R gets crazy:
> Most of the commands result in an Error message, just an example:
>
>   
>> d
>>     
> [1] 3
>   
>> d<-7
>>     
> Error: could not find function "<-"
>   
>> objects()
>>     
> Error in objects() : 
>   Value of SET_STRING_ELT() must be a 'CHARSXP' not a 'double'
>   
>> sum(c(1,2,3))
>>     
> Error: could not find function "sum"
>
>
> It's always different. The most crazy situation was:
> the result of an ARBITRARY command was a STRING containing the call of the
> previuos command :-)))
>
> What is the problem?
> Is it an issue of Windows XP? It's beeing updated regularly and the on-line
> scanners [Panda, Symantec, Kaspersky... did not report infection]
>   

It sure looks as though whatever you are doing in your simulations is buggy.

Duncan Murdoch
> Other applications running:
> -Total Commander
> -notepad
> -AVG Free antivirus
>
> The behaviour is not reproducible, it is always different.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From luftanker at hotmail.de  Sat Mar 15 09:07:47 2008
From: luftanker at hotmail.de (Stefan Tomzeck)
Date: Sat, 15 Mar 2008 09:07:47 +0100
Subject: [Rd] get number of clusters
Message-ID: <BLU124-W22CA94038C9424C4E294D3D70B0@phx.gbl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20080315/8210cffc/attachment.pl 

From lgautier at gmail.com  Sat Mar 15 09:24:26 2008
From: lgautier at gmail.com (Laurent Gautier)
Date: Sat, 15 Mar 2008 16:24:26 +0800
Subject: [Rd] Experimental R_has_slot() utility
Message-ID: <27d1e6020803150124p4106244drff7baba434c6e264@mail.gmail.com>

Dear list,


The utility "R_has_slot" mentioned in the file NEWS
("Experimental  R_has_slot() utility supplementing R_do_slot()")
appears to be missing from a fresh checkout of the development branch.

$ svn up
At revision 44759.
$ grep -i has_slot `find include -name '*.h'`
$ grep -i _slot `find include -name '*.h'`
include/Rdefines.h:#define GET_SLOT(x, what)       R_do_slot(x, what)
include/Rdefines.h:#define SET_SLOT(x, what, value)
R_do_slot_assign(x, what, value)
include/Rinternals.h:SEXP R_do_slot(SEXP obj, SEXP name);
include/Rinternals.h:SEXP R_do_slot_assign(SEXP obj, SEXP name, SEXP value);


..or did I miss it ?

Thanks,


L.


From shli at stat.wvu.edu  Fri Mar 14 23:33:19 2008
From: shli at stat.wvu.edu (Shengqiao Li)
Date: Fri, 14 Mar 2008 17:33:19 -0500 (EST)
Subject: [Rd] Buggy Kinderman-Ramage (PR#2846)
In-Reply-To: <alpine.LFD.1.00.0803141936180.22505@gannet.stats.ox.ac.uk>
References: <Pine.GSO.4.61.0803140910010.11648@bayes>
	<47DAD097.7070200@bank-banque-canada.ca>
	<alpine.LFD.1.00.0803141936180.22505@gannet.stats.ox.ac.uk>
Message-ID: <Pine.GSO.4.61.0803141725340.12941@bayes>


I tested  "RNGkind" and  got the follwing output.
The firt command set the normal generator to the Buggy one without
warning.

I'm expecting the warning message will always be given whenever you set to 
the Buggy one.


> RNGkind(normal.kind="Buggy")
> RNGkind()
[1] "Mersenne-Twister"       "Buggy Kinderman-Ramage"
> RNGkind(normal.kind="Buggy Kinderman-Ramage")
Warning message:
In RNGkind(normal.kind = "Buggy Kinderman-Ramage") :
   Buggy version of Kinderman-Ramage generator used.
> RNGkind()
[1] "Mersenne-Twister"       "Buggy Kinderman-Ramage"
> version
                _
platform       i386-pc-mingw32
arch           i386
os             mingw32
system         i386, mingw32
status
major          2
minor          6.2
year           2008
month          02
day            08
svn rev        44383
language       R
version.string R version 2.6.2 (2008-02-08)


========================================
Shengqiao Li

Research Associate
The Department of Statistics
PO Box 6330
West Virginia University
Morgantown, WV 26506-6330
========================================

On Fri, 14 Mar 2008, Prof Brian Ripley wrote:

> On Fri, 14 Mar 2008, Paul Gilbert wrote:
>
>> Could you please supply complete details, including an example to
>> reproduce the error message you get.
>> 
>> The "Buggy Kinderman-Ramage" error message is produced when you try to
>> force the use of an old RNG that is known to have bugs. Usually it
>> should not appear, so I think you are doing something unusual.
>
> And undocumented -- "Buggy Kinderman-Ramage" is not a documented value for 
> normal.kind, so what happens when you use it (or any other undocumented 
> value) is undefined.  (It is not a bug to fail to pick up every user error.)
>
>> 
>> Paul Gilbert
>> 
>> Shengqiao Li wrote:
>>> Unfortunately, RNGkind is buggy. It will not generate warnings
>>> except the full name "Buggy Kinderman-Ramage" is supplied for normal.kind.
>>> 
>>> match.arg is supposed to be called before "==" comparison.
>
> Quote your authority for this, please!
>
>>> 
>>> ========================================
>>> Shengqiao Li
>>> 
>>> Research Associate
>>> The Department of Statistics
>>> PO Box 6330
>>> West Virginia University
>>> Morgantown, WV 26506-6330
>>> 
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>> ====================================================================================
>> 
>> La version fran??aise suit le texte anglais.
>> 
>> 
>> ------------------------------------------------------------------------------------
>> 
>> This email may contain privileged and/or confidential information, and the 
>> Bank of
>> Canada does not waive any related rights. Any distribution, use, or copying 
>> of this
>> email or the information it contains by other than the intended recipient 
>> is
>> unauthorized. If you received this email in error please delete it 
>> immediately from
>> your system and notify the sender promptly by email that you have done so.
>> 
>> 
>> ------------------------------------------------------------------------------------
>> 
>> Le pr??sent courriel peut contenir de l'information privil??gi??e ou 
>> confidentielle.
>> La Banque du Canada ne renonce pas aux droits qui s'y rapportent. Toute 
>> diffusion,
>> utilisation ou copie de ce courriel ou des renseignements qu'il contient 
>> par une
>> personne autre que le ou les destinataires d??sign??s est interdite. Si 
>> vous recevez
>> ce courriel par erreur, veuillez le supprimer imm??diatement et envoyer 
>> sans d??lai ??
>> l'exp??diteur un message ??lectronique pour l'aviser que vous avez 
>> ??limin?? de votre
>> ordinateur toute copie du courriel re??u.
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>> 
>
> -- 
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From maechler at stat.math.ethz.ch  Sat Mar 15 19:21:04 2008
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Sat, 15 Mar 2008 19:21:04 +0100
Subject: [Rd] Experimental R_has_slot() utility
In-Reply-To: <27d1e6020803150124p4106244drff7baba434c6e264@mail.gmail.com>
References: <27d1e6020803150124p4106244drff7baba434c6e264@mail.gmail.com>
Message-ID: <18396.5008.412749.30208@stat.math.ethz.ch>

>>>>> "LG" == Laurent Gautier <lgautier at gmail.com>
>>>>>     on Sat, 15 Mar 2008 16:24:26 +0800 writes:

    LG> Dear list, The utility "R_has_slot" mentioned in the
    LG> file NEWS ("Experimental R_has_slot() utility
    LG> supplementing R_do_slot()") appears to be missing from a
    LG> fresh checkout of the development branch.

    LG> $ svn up At revision 44759.  $ grep -i has_slot `find
    LG> include -name '*.h'` $ grep -i _slot `find include -name
    LG> '*.h'` include/Rdefines.h:#define GET_SLOT(x, what)
    LG> R_do_slot(x, what) include/Rdefines.h:#define
    LG> SET_SLOT(x, what, value) R_do_slot_assign(x, what,
    LG> value) include/Rinternals.h:SEXP R_do_slot(SEXP obj,
    LG> SEXP name); include/Rinternals.h:SEXP
    LG> R_do_slot_assign(SEXP obj, SEXP name, SEXP value);


    LG> ..or did I miss it ?

Yes.  It's been so much experimental as not even making it into
a header ... arguably an oversight.
It's in src/main/attrib.c

int R_has_slot(SEXP obj, SEXP name)

It's not used anywhere currently in our own code,
but I had seen interesting use cases more than once.

Would you want to use it in your own code?

Regards, Martin


From lgautier at gmail.com  Sat Mar 15 22:46:27 2008
From: lgautier at gmail.com (Laurent Gautier)
Date: Sun, 16 Mar 2008 05:46:27 +0800
Subject: [Rd] Experimental R_has_slot() utility
In-Reply-To: <18396.5008.412749.30208@stat.math.ethz.ch>
References: <27d1e6020803150124p4106244drff7baba434c6e264@mail.gmail.com>
	<18396.5008.412749.30208@stat.math.ethz.ch>
Message-ID: <27d1e6020803151446y2732ca73x9a7555635284a221@mail.gmail.com>

2008/3/16, Martin Maechler <maechler at stat.math.ethz.ch>:
> >>>>> "LG" == Laurent Gautier <lgautier at gmail.com>
>  >>>>>     on Sat, 15 Mar 2008 16:24:26 +0800 writes:
>
>     LG> Dear list, The utility "R_has_slot" mentioned in the
>     LG> file NEWS ("Experimental R_has_slot() utility
>     LG> supplementing R_do_slot()") appears to be missing from a
>     LG> fresh checkout of the development branch.
>
>     LG> $ svn up At revision 44759.  $ grep -i has_slot `find
>     LG> include -name '*.h'` $ grep -i _slot `find include -name
>     LG> '*.h'` include/Rdefines.h:#define GET_SLOT(x, what)
>     LG> R_do_slot(x, what) include/Rdefines.h:#define
>     LG> SET_SLOT(x, what, value) R_do_slot_assign(x, what,
>     LG> value) include/Rinternals.h:SEXP R_do_slot(SEXP obj,
>     LG> SEXP name); include/Rinternals.h:SEXP
>     LG> R_do_slot_assign(SEXP obj, SEXP name, SEXP value);
>
>
>     LG> ..or did I miss it ?
>
>  Yes.  It's been so much experimental as not even making it into
>  a header ... arguably an oversight.
>  It's in src/main/attrib.c
>
>  int R_has_slot(SEXP obj, SEXP name)
>
>  It's not used anywhere currently in our own code,
>  but I had seen interesting use cases more than once.
>
>  Would you want to use it in your own code?

Yes.
My use-case is with a Python-R interface. For the low-level part
of it I am trying to use C-level functions for the common/frequent operations
 - speed concerns-. With that function I can test whether the
attribute exists, and raise an exception if it does not.

Following your comment that it could have made it to a header, I
already started using it and it is doing what I am expecting from it
(according to my limited unit-tests).

Thanks,


L.


>  Regards, Martin
>


From clausen at econ.upenn.edu  Sun Mar 16 05:05:18 2008
From: clausen at econ.upenn.edu (Andrew Clausen)
Date: Sun, 16 Mar 2008 00:05:18 -0400
Subject: [Rd] [patch] add=TRUE in plot.default()
In-Reply-To: <47D52ECB.8000709@stats.uwo.ca>
References: <20080309031119.GC23544@econ.upenn.edu>
	<47D40C41.1000202@stats.uwo.ca>
	<20080309164639.GF23544@econ.upenn.edu>
	<47D442B8.10501@stats.uwo.ca>
	<20080309215833.GH23544@econ.upenn.edu>
	<47D52ECB.8000709@stats.uwo.ca>
Message-ID: <20080316040518.GG21820@econ.upenn.edu>

Hi Duncan,

On Mon, Mar 10, 2008 at 08:51:23AM -0400, Duncan Murdoch wrote:
> >The add parameter only interacts with other parameters superficially --
> >some parameters of "plot" (like log) are related to the shape of the axes,
> >and should be inherited from what is on the plot already.
> 
> I'd say causing some parameters to be completely ignored without a 
> warning is more than a superficial interaction.

Fair enough.  I suppose you could inadvertantly put leave "add=TRUE" in some
code, and wonder why axes aren't getting drawn.

> Really, add=TRUE is not 
> a great design:  it would be better to say "plot methods draw a new 
> plot" (so they need args for all the decorations like axes, titles, 
> etc.), and have other ways to add things to plots.

I don't like the idea of having a separate way to add to plots.
I like the look of this code:

	f <- function(x) x^2
	g <- function(x) 1/x - 1
	h <- function(x) x
	functions <- c(f, g, h)
	for (i in 1:length(functions))
		plot(functions[[i]], add=i>1, col=i)

Of course, I'd prefer something like

	plot.new()
	for (i in 1:length(functions))
		plot(functions[[i]], add=TRUE, col=i)

but that seems out of reach for compatibility reasons.

How would you write this code in R today?

>  Hadley was right on 
> this, his ggplot2 has a better thought-out design than classic graphics. 
>   However, we have what we have.

I'm sure ggplot2 is vastly better, although I couldn't find a quick intro.
(Typing "ggplot2 examples" into Google didn't help me.)  Since plot() isn't
deprecated yet, it's worth making cheap useful improvements.

> >I agree.  Adding an "add=FALSE" parameter to plot() would generate errors 
> >for
> >methods that don't implement it, so they would all have to be changed
> >simultaneously, including in private/unreleased code.
> >
> >So I'd like to settle for second best: adding add=FALSE parameters to many 
> >plot
> >methods.
> 
> I like that suggestion better than adding it here and there, one at a 
> time.  So, to advance the discussion:  can you take a look at the plot 
> methods that are in the base and recommended packages, and work out how 
> many already have it, how many would be improved if it was added, and in 
> how many cases it just wouldn't make sense?  (You could also do this on 
> all the CRAN and Bioconductor packages, but that would be about 100 
> times more work: about 50 times as many packages, and much less 
> consistency in the programming and documentation standards.  Maybe on a 
> subset of popular ones, e.g. those that Rcmdr suggests?)

I had a quick look at the base packages.  (I did a crude search with find and
grep on the R source tarball.)  I attached the full list.  There were 40 files
containing plot methods.   Of these, 9 already implemented add=TRUE explicitly
and a further 9 inherited it from other plot methods that could or already do
implement it.  There were 2 methods for which it clearly makes no sense.  For
example, plot.lm makes no sense because it does several separate plots, one
after the other.

It looks reasonably straightforward to implement most of the remaining methods.
I must confess I don't understand what all of these plots are doing from a
statistics point of view, but I suppose this shouldn't matter.  (Econometrics
uses different language...)

> Data like that could make a convincing argument that the effort of 
> adding this to the base packages is worthwhile.  (To get it added to 
> non-base packages will require you to convince their maintainers that 
> it's a good idea.)  Another helpful part of the argument will be for you 
> to volunteer to do the work of both code and documentation updates.

I'm not very excited about doing work outside of base.  I can do the base
code + documentation though.  Any volunteers?

Cheers,
Andrew

-------------- next part --------------
graphics/R/barplot.R		already implemented
graphics/R/spineplot.R
graphics/R/boxplot.R		already implemented
graphics/R/mosaicplot.R
graphics/R/sunflowerplot.R	already implemented
graphics/R/datetime.R
graphics/R/coplot.R
graphics/R/hist.R		implemented for plot.histogram, but not hist
graphics/R/plot.design.R
graphics/R/matplot.R		already implemented
graphics/R/plot.R		my patch :)
graphics/R/fourfoldplot.R
graphics/R/assocplot.R
graphics/R/cdplot.R
stats/R/ts.R			has plot.type="multiple"
stats/R/biplot.R		
stats/R/acf.R
stats/R/ppr.R			inherited
stats/R/stl.R
stats/R/plot.lm.R		multiple plots -- no sense
stats/R/qqplot.R		inherited
stats/R/stepfun.R		already implemented
stats/R/TukeyHSD.R
stats/R/dendrogram.R
stats/R/interaction.plot.R
stats/R/lag.plot.R
stats/R/monthplot.R		already implemented
stats/R/ecdf.R			already implemented (inherited from stepfun)
stats/R/spectrum.R		already implemented
stats/R/nls-profile.R	
stats/R/prcomp.R		inherited
stats/R/termplot.R		multiple plots -- no sense
stats/R/princomp-add.R
stats/R/isoreg.R
stats/R/hclust.R
stats/R/kernel.R		inherited
stats/R/medpolish.R		inherited
stats/R/HoltWinters.R		inherited
stats/R/density.R		inherited
splines/R/splineClasses.R	inherited

From christos.hatzis at nuverabio.com  Sun Mar 16 05:40:25 2008
From: christos.hatzis at nuverabio.com (Christos Hatzis)
Date: Sun, 16 Mar 2008 00:40:25 -0400
Subject: [Rd] [patch] add=TRUE in plot.default()
In-Reply-To: <20080316040518.GG21820@econ.upenn.edu>
References: <20080309031119.GC23544@econ.upenn.edu><47D40C41.1000202@stats.uwo.ca><20080309164639.GF23544@econ.upenn.edu><47D442B8.10501@stats.uwo.ca><20080309215833.GH23544@econ.upenn.edu><47D52ECB.8000709@stats.uwo.ca>
	<20080316040518.GG21820@econ.upenn.edu>
Message-ID: <002301c8871f$daa08cf0$0202a8c0@headquarters.silicoinsights>

Andrew,

Here's is a way how your example could be coded with the current
implementation of plot.  You can always start with an empty plot and then
add lines or points (or both) using the corresponding functions.  

> x <- seq(-2, 2, 0.1)
> plot(x, x, type="n")
> mapply(function(f, i) lines(x, f(x), col=i), functions, 1:3)

The current approach saves specification of a couple of parameters that
would otherwise had to be specified, since lines(...) would be equivalent to
plot(..., type="l", add=TRUE), and I think that this adds to clarity.

-Christos
 
> -----Original Message-----
> From: r-devel-bounces at r-project.org 
> [mailto:r-devel-bounces at r-project.org] On Behalf Of Andrew Clausen
> Sent: Sunday, March 16, 2008 12:05 AM
> To: Duncan Murdoch
> Cc: R-devel at r-project.org
> Subject: Re: [Rd] [patch] add=TRUE in plot.default()
> 
> Hi Duncan,
> 
> On Mon, Mar 10, 2008 at 08:51:23AM -0400, Duncan Murdoch wrote:
> > >The add parameter only interacts with other parameters 
> superficially 
> > >-- some parameters of "plot" (like log) are related to the 
> shape of 
> > >the axes, and should be inherited from what is on the plot already.
> > 
> > I'd say causing some parameters to be completely ignored without a 
> > warning is more than a superficial interaction.
> 
> Fair enough.  I suppose you could inadvertantly put leave 
> "add=TRUE" in some code, and wonder why axes aren't getting drawn.
> 
> > Really, add=TRUE is not
> > a great design:  it would be better to say "plot methods draw a new 
> > plot" (so they need args for all the decorations like axes, titles, 
> > etc.), and have other ways to add things to plots.
> 
> I don't like the idea of having a separate way to add to plots.
> I like the look of this code:
> 
> 	f <- function(x) x^2
> 	g <- function(x) 1/x - 1
> 	h <- function(x) x
> 	functions <- c(f, g, h)
> 	for (i in 1:length(functions))
> 		plot(functions[[i]], add=i>1, col=i)
> 
> Of course, I'd prefer something like
> 
> 	plot.new()
> 	for (i in 1:length(functions))
> 		plot(functions[[i]], add=TRUE, col=i)
> 
> but that seems out of reach for compatibility reasons.
> 
> How would you write this code in R today?
> 
> >  Hadley was right on
> > this, his ggplot2 has a better thought-out design than 
> classic graphics. 
> >   However, we have what we have.
> 
> I'm sure ggplot2 is vastly better, although I couldn't find a 
> quick intro.
> (Typing "ggplot2 examples" into Google didn't help me.)  
> Since plot() isn't deprecated yet, it's worth making cheap 
> useful improvements.
> 
> > >I agree.  Adding an "add=FALSE" parameter to plot() would generate 
> > >errors for methods that don't implement it, so they would 
> all have to 
> > >be changed simultaneously, including in private/unreleased code.
> > >
> > >So I'd like to settle for second best: adding add=FALSE 
> parameters to 
> > >many plot methods.
> > 
> > I like that suggestion better than adding it here and 
> there, one at a 
> > time.  So, to advance the discussion:  can you take a look 
> at the plot 
> > methods that are in the base and recommended packages, and work out 
> > how many already have it, how many would be improved if it 
> was added, 
> > and in how many cases it just wouldn't make sense?  (You 
> could also do 
> > this on all the CRAN and Bioconductor packages, but that would be 
> > about 100 times more work: about 50 times as many packages, 
> and much 
> > less consistency in the programming and documentation standards.  
> > Maybe on a subset of popular ones, e.g. those that Rcmdr suggests?)
> 
> I had a quick look at the base packages.  (I did a crude 
> search with find and grep on the R source tarball.)  I 
> attached the full list.  There were 40 files
> containing plot methods.   Of these, 9 already implemented 
> add=TRUE explicitly
> and a further 9 inherited it from other plot methods that 
> could or already do implement it.  There were 2 methods for 
> which it clearly makes no sense.  For example, plot.lm makes 
> no sense because it does several separate plots, one after the other.
> 
> It looks reasonably straightforward to implement most of the 
> remaining methods.
> I must confess I don't understand what all of these plots are 
> doing from a statistics point of view, but I suppose this 
> shouldn't matter.  (Econometrics uses different language...)
> 
> > Data like that could make a convincing argument that the effort of 
> > adding this to the base packages is worthwhile.  (To get it 
> added to 
> > non-base packages will require you to convince their 
> maintainers that 
> > it's a good idea.)  Another helpful part of the argument 
> will be for 
> > you to volunteer to do the work of both code and 
> documentation updates.
> 
> I'm not very excited about doing work outside of base.  I can 
> do the base code + documentation though.  Any volunteers?
> 
> Cheers,
> Andrew
> 
>


From Thomas.Petzoldt at TU-Dresden.de  Sun Mar 16 13:50:55 2008
From: Thomas.Petzoldt at TU-Dresden.de (Thomas Petzoldt)
Date: Sun, 16 Mar 2008 13:50:55 +0100
Subject: [Rd] optim: why is REPORT not used in SANN?
Message-ID: <47DD17AF.5030606@TU-Dresden.de>

Hello,

I wonder why the control parameter REPORT is not supported by method 
SANN. Looking into optim.c I found an internal constant:

#define STEPS 100

... and decreasing this to 10 helped me fine-tuning the annealing 
parameters in an actual problem.

Is there any reason why not passing nREPORT to samin and setting 
something like:

STEPS = nREPORT / tmax


Thomas P.



-- 
Thomas Petzoldt
Technische Universitaet Dresden
Institut fuer Hydrobiologie        thomas.petzoldt at tu-dresden.de
01062 Dresden                      http://tu-dresden.de/hydrobiologie/
GERMANY


From detlef.steuer at hsu-hamburg.de  Mon Mar 17 11:13:13 2008
From: detlef.steuer at hsu-hamburg.de (Detlef Steuer)
Date: Mon, 17 Mar 2008 11:13:13 +0100
Subject: [Rd] Problems building rpm for R-2.6.2 on Opensuse Factory
Message-ID: <20080317111313.65aa0b1a@renner>

Hi,

make check fails in the way shown below when I try to build
R-2.6.2 on OpenSuSE Factory x86_64. It builds fine on i586.
(and on all older Versions of Opensuse)

Is there something I can do?
Are there known problems with some gcc versions?
(Factory uses 4.3.0)

Output from ./configure is
-------------------------------------------------------------
R is now configured for x86_64-unknown-linux-gnu

Source directory: .
Installation directory: /usr

C compiler: gcc -std=gnu99 -g -O2
Fortran 77 compiler: gfortran -g -O2

C++ compiler: g++ -g -O2
Fortran 90/95 compiler: gfortran -g -O2
Obj-C compiler:

Interfaces supported: X11, tcltk
External libraries: readline
Additional capabilities: PNG, JPEG, iconv, MBCS, NLS
Options enabled: shared R library, shared BLAS, R profiling

Recommended packages: yes
-------------------------------------------------------------

It may very well be an error on the Opensuse side, but I'm  just not
sure how to identify the true cause of the problem.
Any help appreciated.

Detlef

-----------------------------------------------------------------  
Error message:

running code in 'lapack.R' ... OK
comparing 'lapack.Rout' to './lapack.Rout.save' ... OK
make[3]: Leaving directory `/usr/src/packages/BUILD/R-2.6.2/tests'
make[2]: Leaving directory `/usr/src/packages/BUILD/R-2.6.2/tests'
make[2]: Entering directory `/usr/src/packages/BUILD/R-2.6.2/tests'
running regression tests
make[3]: Entering directory `/usr/src/packages/BUILD/R-2.6.2/tests'
running code in 'reg-tests-1.R' ... OK
running code in 'reg-tests-2.R' ... OK
comparing 'reg-tests-2.Rout' to './reg-tests-2.Rout.save' ...1318c1318
< 0.1230 -0.7187
---
> 0.1230 0.3170
1328c1328
< 0.1230 -0.7187
---
> 0.1230 0.3170
1356c1356
< -0.2364 -0.3594
---
> 0.2814 0.1585
1366c1366
< 0.62010 -0.55327 -0.15379 0.02127
---
> 0.49064 -0.68273 -0.02433 0.15074
1375c1375
< 1.17337 0.06683 -0.15379 0.02127
---
> 1.17337 -0.19209 -0.02433 0.15074
make[3]: *** [reg-tests-2.Rout] Error 1
make[3]: Leaving directory `/usr/src/packages/BUILD/R-2.6.2/tests'
make[2]: *** [test-Reg] Error 2
make[2]: Leaving directory `/usr/src/packages/BUILD/R-2.6.2/tests'
make[1]: *** [test-all-basics] Error 1
make[1]: Leaving directory `/usr/src/packages/BUILD/R-2.6.2/tests'
make: *** [check] Error 2
error: Bad exit status from /var/tmp/rpm-tmp.74662 (%build)


From ripley at stats.ox.ac.uk  Mon Mar 17 12:19:54 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 17 Mar 2008 11:19:54 +0000 (GMT)
Subject: [Rd] Problems building rpm for R-2.6.2 on Opensuse Factory
In-Reply-To: <20080317111313.65aa0b1a@renner>
References: <20080317111313.65aa0b1a@renner>
Message-ID: <alpine.LFD.1.00.0803171115390.28698@gannet.stats.ox.ac.uk>

On Mon, 17 Mar 2008, Detlef Steuer wrote:

> Hi,
>
> make check fails in the way shown below when I try to build
> R-2.6.2 on OpenSuSE Factory x86_64. It builds fine on i586.
> (and on all older Versions of Opensuse)
>
> Is there something I can do?
> Are there known problems with some gcc versions?
> (Factory uses 4.3.0)

Yes.  This happened for me with (vanilla released) gcc 4.3.0 on F8 x86_64 
too.  Turning optimization off for both C and Fortran solved it -- I've 
not yet had time to track down what you need not to optimize.  I'll try to 
do that this evening.

As I understand it, CRAN is successfully building R with a Debian x86_64 
build of gcc 4.3.0, but several packages are failing in that 
configuration.

>
> Output from ./configure is
> -------------------------------------------------------------
> R is now configured for x86_64-unknown-linux-gnu
>
> Source directory: .
> Installation directory: /usr
>
> C compiler: gcc -std=gnu99 -g -O2
> Fortran 77 compiler: gfortran -g -O2
>
> C++ compiler: g++ -g -O2
> Fortran 90/95 compiler: gfortran -g -O2
> Obj-C compiler:
>
> Interfaces supported: X11, tcltk
> External libraries: readline
> Additional capabilities: PNG, JPEG, iconv, MBCS, NLS
> Options enabled: shared R library, shared BLAS, R profiling
>
> Recommended packages: yes
> -------------------------------------------------------------
>
> It may very well be an error on the Opensuse side, but I'm  just not
> sure how to identify the true cause of the problem.
> Any help appreciated.
>
> Detlef
>
> -----------------------------------------------------------------
> Error message:
>
> running code in 'lapack.R' ... OK
> comparing 'lapack.Rout' to './lapack.Rout.save' ... OK
> make[3]: Leaving directory `/usr/src/packages/BUILD/R-2.6.2/tests'
> make[2]: Leaving directory `/usr/src/packages/BUILD/R-2.6.2/tests'
> make[2]: Entering directory `/usr/src/packages/BUILD/R-2.6.2/tests'
> running regression tests
> make[3]: Entering directory `/usr/src/packages/BUILD/R-2.6.2/tests'
> running code in 'reg-tests-1.R' ... OK
> running code in 'reg-tests-2.R' ... OK
> comparing 'reg-tests-2.Rout' to './reg-tests-2.Rout.save' ...1318c1318
> < 0.1230 -0.7187
> ---
>> 0.1230 0.3170
> 1328c1328
> < 0.1230 -0.7187
> ---
>> 0.1230 0.3170
> 1356c1356
> < -0.2364 -0.3594
> ---
>> 0.2814 0.1585
> 1366c1366
> < 0.62010 -0.55327 -0.15379 0.02127
> ---
>> 0.49064 -0.68273 -0.02433 0.15074
> 1375c1375
> < 1.17337 0.06683 -0.15379 0.02127
> ---
>> 1.17337 -0.19209 -0.02433 0.15074
> make[3]: *** [reg-tests-2.Rout] Error 1
> make[3]: Leaving directory `/usr/src/packages/BUILD/R-2.6.2/tests'
> make[2]: *** [test-Reg] Error 2
> make[2]: Leaving directory `/usr/src/packages/BUILD/R-2.6.2/tests'
> make[1]: *** [test-all-basics] Error 1
> make[1]: Leaving directory `/usr/src/packages/BUILD/R-2.6.2/tests'
> make: *** [check] Error 2
> error: Bad exit status from /var/tmp/rpm-tmp.74662 (%build)
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From amvargas at ismm.edu.cu  Mon Mar 17 18:06:02 2008
From: amvargas at ismm.edu.cu (=?iso-8859-1?Q?Adrian_Mart=EDnez_Vargas?=)
Date: Mon, 17 Mar 2008 12:06:02 -0500
Subject: [Rd] how to get access to C++ Objects
Message-ID: <008901c88851$36d0c800$21141c0a@revista2>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20080317/ac84534d/attachment.pl 

From murdoch at stats.uwo.ca  Mon Mar 17 20:03:27 2008
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Mon, 17 Mar 2008 15:03:27 -0400
Subject: [Rd] how to get access to C++ Objects
In-Reply-To: <008901c88851$36d0c800$21141c0a@revista2>
References: <008901c88851$36d0c800$21141c0a@revista2>
Message-ID: <47DEC07F.4020906@stats.uwo.ca>

On 3/17/2008 1:06 PM, Adrian Mart?nez Vargas wrote:
>  
> 
> In the "Writing R Extensions" manual appears this example, to get access to C++ function using the R commands:
> 
>  
> 
> R> dyn.load(paste("X", .Platform$dynlib.ext, sep = ""))
> 
> constructor Y
> 
> R> .C("X_main")
> 
> constructor X
> 
> destructor X
> 
> list()
> 
>  
> 
>  
> 
> That gives me access to the function "X_main", but how to get access to methods and properties like X.Z() and X.f, defined in the C++ files: 

You need to write C functions to access them.  For example,

void XdotZ(int* a, int* b) {
   X.Z(*a, *b);
}

all wrapped within your extern "C" block.

Duncan Murdoch


> 
>  
> 
> // X.hh
> 
> class X 
> 
> {
> 
> public: 
> 
>             int f;
> 
> X ();
> 
>  ~X ();
> 
> int Z(int a, int b);
> 
> };
> 
> class Y 
> 
> {
> 
> public: Y ();
> 
>  ~Y ();
> 
> }; 
> 
>  
> 
>  
> 
> // X.cc
> 
> #include <iostream>
> 
> #include "X.hh"
> 
> static Y y;
> 
> X::X() { std::cout << "constructor X" << std::endl; }
> 
> X::~X() { std::cout << "destructor X" << std::endl; }
> 
> Y::Y() { std::cout << "constructor Y" << std::endl; }
> 
> Y::~Y() { std::cout << "destructor Y" << std::endl; }
> 
> X::Z(int a, int b) {return a+b;}
> 
>  
> 
>  
> 
> // X_main.cc:
> 
> #include "X.hh"
> 
> extern "C" 
> 
> {
> 
> void X_main () 
> 
> {
> 
> X x;
> 
> }
> 
> } // extern "C"
> 
> 
> 
> Best regards 
> 
> Dr. Adrian Mart?nez Vargas 
> Revista Miner?a y Geolog?a (Editor Principal) 
> ISMM, Las Coloradas, s/n 
> Moa, Holgu?n, 
> Cuba 
> CP. 83329 
> http://www.ismm.edu.cu/revistamg/index.htm
> 
> 
> 	[[alternative HTML version deleted]]
> 
> 
> 
> ------------------------------------------------------------------------
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From dennis.walvoort at wur.nl  Mon Mar 17 14:20:06 2008
From: dennis.walvoort at wur.nl (dennis.walvoort at wur.nl)
Date: Mon, 17 Mar 2008 14:20:06 +0100 (CET)
Subject: [Rd] Accessing vector elements by a factor (PR#10971)
Message-ID: <20080317132006.E907D282EFF6@mail.pubhealth.ku.dk>

Full_Name: Dennis Walvoort
Version: 2.6.2
OS: MS Windows XP
Submission from: (NULL) (137.224.252.10)


I've encountered a problem when extracting vector elements by a factor.

Let's create a (named) character vector v:

i <- 1:10
v <- letters[i]
names(v) <- i

Let iInt, iChr, and iFac denote integer, character, and factor indices
respectively:

iInt <- i
iChr <- as.character(i)
iFac <- factor(iChr)

Now, consider the following tests:

all.equal(v, v[iInt]) # TRUE
all.equal(v, v[iChr]) # TRUE
all.equal(v, v[iFac]) # FALSE
all.equal(v, v[as.character(iFac)]) # TRUE

The third test returns FALSE. It seems that the internal factor coding is used
to extract vector elements and not the factor levels:

all.equal(v[iFac], v[as.integer(iFac)]) # TRUE

Is this intended behaviour?


Kind regards,

Dennis Walvoort



Version:
 platform = i386-pc-mingw32
 arch = i386
 os = mingw32
 system = i386, mingw32
 status = 
 major = 2
 minor = 6.2
 year = 2008
 month = 02
 day = 08
 svn rev = 44383
 language = R
 version.string = R version 2.6.2 (2008-02-08)

Windows XP (build 2600) Service Pack 2

Locale:
LC_COLLATE=English_United Kingdom.1252;LC_CTYPE=English_United
Kingdom.1252;LC_MONETARY=English_United
Kingdom.1252;LC_NUMERIC=C;LC_TIME=English_United Kingdom.1252

Search Path:
 .GlobalEnv, package:stats, package:graphics, package:grDevices, package:utils,
package:datasets, package:methods, Autoloads, package:base


From dgrove at scharp.org  Mon Mar 17 17:55:04 2008
From: dgrove at scharp.org (dgrove at scharp.org)
Date: Mon, 17 Mar 2008 17:55:04 +0100 (CET)
Subject: [Rd] Documentation of par, 'xaxs', (PR#10975)
Message-ID: <20080317165504.B5744282EF48@mail.pubhealth.ku.dk>

Full_Name: Doug Grove
Version: 2.7.0-dev (Feb 28)
OS: Linux
Submission from: (NULL) (140.107.164.65)


In the par() help page, for component 'xaxs' it says:

  "Style '"r"' (regular) first extends
   the data range by 4 percent and then ..."


Not quite correct, should say that the data range is extended by 4% IN EACH
DIRECTION. So total extension is 8%.

Not high priority but thought I'd pass it along.

Doug


From christian.buchta at wu-wien.ac.at  Mon Mar 17 21:55:12 2008
From: christian.buchta at wu-wien.ac.at (christian.buchta at wu-wien.ac.at)
Date: Mon, 17 Mar 2008 21:55:12 +0100 (CET)
Subject: [Rd] Inconsistency in gsub in R.2.6.2 (PR#10978)
Message-ID: <20080317205512.7D1C2282EF48@mail.pubhealth.ku.dk>

This is a multi-part message in MIME format.
--------------040104050805010601010607
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 8bit


Hi,

May this be an oversight?

R version 2.6.2 Patched (2008-03-13 r44783)
Copyright (C) 2008 The R Foundation for Statistical Computing
ISBN 3-900051-07-0

...

 > x <- "ab?"
 > Encoding(x)
[1] "latin1"
 > Encoding(gsub("?","", x))
[1] "unknown"
 > Encoding(gsub("?","", x, perl = TRUE))
[1] "latin1"

The code in src/main/pcre.c (see also do_tolower and do_strsplit in 
src/main/character.c) suggests to patch as attached.

 > x <- "ab?"
 > Encoding(gsub("?","", x))
[1] "latin1"


Happy Easter

Christian

-- 
Christian Buchta -> Institute for Tourism and Leisure Studies ->
Vienna University of Economics and Business Administration -> Vienna
-> Austria -> Europe. Visit us on http://www.wu-wien.ac.at/itf/.


--------------040104050805010601010607
Content-Type: text/plain;
 name="patch_44783"
Content-Transfer-Encoding: 7bit
Content-Disposition: inline;
 filename="patch_44783"

Index: src/main/character.c
===================================================================
--- src/main/character.c	(revision 44783)
+++ src/main/character.c	(working copy)
@@ -1281,7 +1281,7 @@
 		    strcat(u, t);
 		} while(global && (st = fgrep_one_bytes(spat, s, useBytes)) >= 0);
 		strcat(u, s);
-                SET_STRING_ELT(ans, i, mkChar(cbuf));
+                SET_STRING_ELT(ans, i, markKnown(cbuf, STRING_ELT(vec, i)));
                 Free(cbuf);
 	    }
 	} else {
@@ -1337,7 +1337,7 @@
 		    for (j = offset ; s[j] ; j++)
 			*u++ = s[j];
 		*u = '\0';
-                SET_STRING_ELT(ans, i, mkChar(cbuf));
+                SET_STRING_ELT(ans, i, markKnown(cbuf, STRING_ELT(vec, i)));
                 Free(cbuf);
 	    }
 	}

--------------040104050805010601010607--


From pcd at wikitex.org  Tue Mar 18 00:56:44 2008
From: pcd at wikitex.org (Peter Danenberg)
Date: Mon, 17 Mar 2008 18:56:44 -0500
Subject: [Rd] Roxygen
Message-ID: <20080317235644.GA24414@klutometis.wikitex.org>

Is this the appropriate place for GSoC conversations?

If I understand the proposal correctly, there should be a lexer
(written in R) that exposes an API; that API would be used by
segregated mini-parsers (Roclets) which do the dirty work of Roxygen
-> {html, LaTeX, DocBook, ...} translation.

The lexer should ship with a proof-of-concept Roclet. Have I missed
anything?


From ripley at stats.ox.ac.uk  Tue Mar 18 07:50:12 2008
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Tue, 18 Mar 2008 07:50:12 +0100 (CET)
Subject: [Rd] Inconsistency in gsub in R.2.6.2 (PR#10978)
Message-ID: <20080318065012.1F2AD282EFF0@mail.pubhealth.ku.dk>

  This message is in MIME format.  The first part should be readable text,
  while the remaining parts are likely unreadable without MIME-aware tools.

--27464147-1221975610-1205822844=:9482
Content-Type: TEXT/PLAIN; charset=iso-8859-1; format=flowed
Content-Transfer-Encoding: 8BIT

This has already been corrected in R-devel.  It was wrong to set the 
encoding to that of the element of 'x': gsub will have changed it (to 
native or UTF-8).

On Mon, 17 Mar 2008, christian.buchta at wu-wien.ac.at wrote:

> This is a multi-part message in MIME format.
> --------------040104050805010601010607
> Content-Type: text/plain; charset=ISO-8859-1; format=flowed
> Content-Transfer-Encoding: 8bit
>
>
> Hi,
>
> May this be an oversight?
>
> R version 2.6.2 Patched (2008-03-13 r44783)
> Copyright (C) 2008 The R Foundation for Statistical Computing
> ISBN 3-900051-07-0
>
> ...
>
> > x <- "ab?"
> > Encoding(x)
> [1] "latin1"
> > Encoding(gsub("?","", x))
> [1] "unknown"
> > Encoding(gsub("?","", x, perl = TRUE))
> [1] "latin1"
>
> The code in src/main/pcre.c (see also do_tolower and do_strsplit in
> src/main/character.c) suggests to patch as attached.
>
> > x <- "ab?"
> > Encoding(gsub("?","", x))
> [1] "latin1"
>
>
> Happy Easter
>
> Christian
>
> --
> Christian Buchta -> Institute for Tourism and Leisure Studies ->
> Vienna University of Economics and Business Administration -> Vienna
> -> Austria -> Europe. Visit us on http://www.wu-wien.ac.at/itf/.
>
>
> --------------040104050805010601010607
> Content-Type: text/plain;
> name="patch_44783"
> Content-Transfer-Encoding: 7bit
> Content-Disposition: inline;
> filename="patch_44783"
>
> Index: src/main/character.c
> ===================================================================
> --- src/main/character.c	(revision 44783)
> +++ src/main/character.c	(working copy)
> @@ -1281,7 +1281,7 @@
> 		    strcat(u, t);
> 		} while(global && (st = fgrep_one_bytes(spat, s, useBytes)) >= 0);
> 		strcat(u, s);
> -                SET_STRING_ELT(ans, i, mkChar(cbuf));
> +                SET_STRING_ELT(ans, i, markKnown(cbuf, STRING_ELT(vec, i)));
>                 Free(cbuf);
> 	    }
> 	} else {
> @@ -1337,7 +1337,7 @@
> 		    for (j = offset ; s[j] ; j++)
> 			*u++ = s[j];
> 		*u = '\0';
> -                SET_STRING_ELT(ans, i, mkChar(cbuf));
> +                SET_STRING_ELT(ans, i, markKnown(cbuf, STRING_ELT(vec, i)));
>                 Free(cbuf);
> 	    }
> 	}
>
> --------------040104050805010601010607--
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595
--27464147-1221975610-1205822844=:9482--


From claire.saraux at gmail.com  Tue Mar 18 10:35:03 2008
From: claire.saraux at gmail.com (claire.saraux at gmail.com)
Date: Tue, 18 Mar 2008 10:35:03 +0100 (CET)
Subject: [Rd] glm poisson, method='ML' (PR#10985)
Message-ID: <20080318093504.02B612834611@mail.pubhealth.ku.dk>

Full_Name: saraux
Version: 2.6.1
OS: Windows vista
Submission from: (NULL) (193.157.180.37)


I would like to compute a glm with a distribution of poisson, using a maximum of
likelihood method. But it seems not to work with a distribution of poisson. The
same code with another distrubution (binomial for example) works. 

Here is the command I typed:
nullrandmodel1<-glm(Arrival~(x+y),family=poisson,method='ML',data=dates)

and here is the error message returned:
Error in switch(method, model.frame = return(mf), glm.fit = 1, stop("invalid
'method': ",  : 
  invalid 'method': ML


From ripley at stats.ox.ac.uk  Tue Mar 18 11:30:14 2008
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Tue, 18 Mar 2008 11:30:14 +0100 (CET)
Subject: [Rd] glm poisson, method='ML' (PR#10985)
Message-ID: <20080318103014.7FB1E282EF48@mail.pubhealth.ku.dk>

Please read the documentation for glm:

   method: the method to be used in fitting the model. The default
           method '"glm.fit"' uses iteratively reweighted least squares
           (IWLS).  The only current alternative is '"model.frame"'
           which returns the model frame and does no fitting.

so the error message is correctly reporting user error.

For a Poisson (and for a binomial), the default fitting method computes 
the MLEs.


On Tue, 18 Mar 2008, claire.saraux at gmail.com wrote:

> Full_Name: saraux
> Version: 2.6.1
> OS: Windows vista
> Submission from: (NULL) (193.157.180.37)
>
>
> I would like to compute a glm with a distribution of poisson, using a maximum of
> likelihood method. But it seems not to work with a distribution of poisson. The
> same code with another distrubution (binomial for example) works.

But your code is not reproducible.  Similar code does not work for me

> library(MASS)
> example(birthwt)
...
> glm(low ~ ., binomial, bwt, method="ML")
Error in switch(method, model.frame = return(mf), glm.fit = 1, 
stop("invalid 'method': ",  :
   invalid 'method': ML

> Here is the command I typed:
> nullrandmodel1<-glm(Arrival~(x+y),family=poisson,method='ML',data=dates)
>
> and here is the error message returned:
> Error in switch(method, model.frame = return(mf), glm.fit = 1, stop("invalid
> 'method': ",  :
>  invalid 'method': ML
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Tue Mar 18 11:30:07 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 18 Mar 2008 10:30:07 +0000 (GMT)
Subject: [Rd] Problems building rpm for R-2.6.2 on Opensuse Factory
In-Reply-To: <alpine.LFD.1.00.0803171115390.28698@gannet.stats.ox.ac.uk>
References: <20080317111313.65aa0b1a@renner>
	<alpine.LFD.1.00.0803171115390.28698@gannet.stats.ox.ac.uk>
Message-ID: <alpine.LFD.1.00.0803171834090.1423@gannet.stats.ox.ac.uk>

This is proving elusive.  The same build that gave incorrect results last 
week gave correct results last night (and F8 has had about 50 updates 
since, including two kernel updates).

I'd still suggest trying lower levels of optimization, as that was 
definitely needed with some pre-releases of gcc 4.3.x.


On Mon, 17 Mar 2008, Prof Brian Ripley wrote:

> On Mon, 17 Mar 2008, Detlef Steuer wrote:
>
>> Hi,
>> 
>> make check fails in the way shown below when I try to build
>> R-2.6.2 on OpenSuSE Factory x86_64. It builds fine on i586.
>> (and on all older Versions of Opensuse)
>> 
>> Is there something I can do?
>> Are there known problems with some gcc versions?
>> (Factory uses 4.3.0)
>
> Yes.  This happened for me with (vanilla released) gcc 4.3.0 on F8 x86_64 
> too.  Turning optimization off for both C and Fortran solved it -- I've not 
> yet had time to track down what you need not to optimize.  I'll try to do 
> that this evening.
>
> As I understand it, CRAN is successfully building R with a Debian x86_64 
> build of gcc 4.3.0, but several packages are failing in that configuration.
>
>> 
>> Output from ./configure is
>> -------------------------------------------------------------
>> R is now configured for x86_64-unknown-linux-gnu
>> 
>> Source directory: .
>> Installation directory: /usr
>> 
>> C compiler: gcc -std=gnu99 -g -O2
>> Fortran 77 compiler: gfortran -g -O2
>> 
>> C++ compiler: g++ -g -O2
>> Fortran 90/95 compiler: gfortran -g -O2
>> Obj-C compiler:
>> 
>> Interfaces supported: X11, tcltk
>> External libraries: readline
>> Additional capabilities: PNG, JPEG, iconv, MBCS, NLS
>> Options enabled: shared R library, shared BLAS, R profiling
>> 
>> Recommended packages: yes
>> -------------------------------------------------------------
>> 
>> It may very well be an error on the Opensuse side, but I'm  just not
>> sure how to identify the true cause of the problem.
>> Any help appreciated.
>> 
>> Detlef
>> 
>> -----------------------------------------------------------------
>> Error message:
>> 
>> running code in 'lapack.R' ... OK
>> comparing 'lapack.Rout' to './lapack.Rout.save' ... OK
>> make[3]: Leaving directory `/usr/src/packages/BUILD/R-2.6.2/tests'
>> make[2]: Leaving directory `/usr/src/packages/BUILD/R-2.6.2/tests'
>> make[2]: Entering directory `/usr/src/packages/BUILD/R-2.6.2/tests'
>> running regression tests
>> make[3]: Entering directory `/usr/src/packages/BUILD/R-2.6.2/tests'
>> running code in 'reg-tests-1.R' ... OK
>> running code in 'reg-tests-2.R' ... OK
>> comparing 'reg-tests-2.Rout' to './reg-tests-2.Rout.save' ...1318c1318
>> < 0.1230 -0.7187
>> ---
>>> 0.1230 0.3170
>> 1328c1328
>> < 0.1230 -0.7187
>> ---
>>> 0.1230 0.3170
>> 1356c1356
>> < -0.2364 -0.3594
>> ---
>>> 0.2814 0.1585
>> 1366c1366
>> < 0.62010 -0.55327 -0.15379 0.02127
>> ---
>>> 0.49064 -0.68273 -0.02433 0.15074
>> 1375c1375
>> < 1.17337 0.06683 -0.15379 0.02127
>> ---
>>> 1.17337 -0.19209 -0.02433 0.15074
>> make[3]: *** [reg-tests-2.Rout] Error 1
>> make[3]: Leaving directory `/usr/src/packages/BUILD/R-2.6.2/tests'
>> make[2]: *** [test-Reg] Error 2
>> make[2]: Leaving directory `/usr/src/packages/BUILD/R-2.6.2/tests'
>> make[1]: *** [test-all-basics] Error 1
>> make[1]: Leaving directory `/usr/src/packages/BUILD/R-2.6.2/tests'
>> make: *** [check] Error 2
>> error: Bad exit status from /var/tmp/rpm-tmp.74662 (%build)
>> 
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>> 
>
> -- 
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From friedrich.leisch at stat.uni-muenchen.de  Tue Mar 18 11:39:09 2008
From: friedrich.leisch at stat.uni-muenchen.de (friedrich.leisch at stat.uni-muenchen.de)
Date: Tue, 18 Mar 2008 11:39:09 +0100 (CET)
Subject: [Rd] Google summer of Code
Message-ID: <39403.10.153.53.114.1205836749.squirrel@webmail.lrz-muenchen.de>

As you may have noticed from a previous email the R Foundation has been
accepted as a mentoring organization for the Google Summer of Code 2008,
see

  http://code.google.com/soc/2008/

for general information and

  http://www.r-project.org/SoC08/index.html

for our ideas page (which is still evolving a little bit). The R
Foundation has not acted as a mentoring organization before, so everything
is a little bit experimental for us (some R developers have participated
before through other organizations).

This email is mainly meant to inform you about the fact that we are in and
encourage you to pass on the information to talented students who may want
to participate (accepted students get a stipend of USD 4500 from Google
when they successfully finish the project).

Best,
Fritz Leisch


From pcd at wikitex.org  Tue Mar 18 11:51:04 2008
From: pcd at wikitex.org (Peter Danenberg)
Date: Tue, 18 Mar 2008 05:51:04 -0500
Subject: [Rd] Google summer of Code
In-Reply-To: <39403.10.153.53.114.1205836749.squirrel@webmail.lrz-muenchen.de>
References: <39403.10.153.53.114.1205836749.squirrel@webmail.lrz-muenchen.de>
Message-ID: <20080318105104.GA30574@klutometis.wikitex.org>

> The R Foundation has not acted as a mentoring organization before,
> so everything is a little bit experimental for us . . .

Is R-devel an appropriate place for GSoC communication, Fritz?  My
message specific to Roxygen went unanswered.*

-----------
* https://stat.ethz.ch/pipermail/r-devel/2008-March/048718.html


From friedrich.leisch at stat.uni-muenchen.de  Tue Mar 18 12:47:48 2008
From: friedrich.leisch at stat.uni-muenchen.de (friedrich.leisch at stat.uni-muenchen.de)
Date: Tue, 18 Mar 2008 12:47:48 +0100 (CET)
Subject: [Rd] Google summer of Code
In-Reply-To: <20080318105104.GA30574@klutometis.wikitex.org>
References: <39403.10.153.53.114.1205836749.squirrel@webmail.lrz-muenchen.de>
	<20080318105104.GA30574@klutometis.wikitex.org>
Message-ID: <50533.10.153.53.114.1205840868.squirrel@webmail.lrz-muenchen.de>

>> The R Foundation has not acted as a mentoring organization before,
>> so everything is a little bit experimental for us . . .
>
> Is R-devel an appropriate place for GSoC communication, Fritz?  My
> message specific to Roxygen went unanswered.*

Sorry for that, I already asked Manuel (one of my assistants and mentor of
the project) to answer your questions, but we are having network problems
due to a broken switch in our building and most computers do not work
(mine is one of the few exceptions ;-).

We hope that everything is up and running again in a few hours.

Best,
Fritz


From Manuel.Eugster at stat.uni-muenchen.de  Tue Mar 18 15:48:57 2008
From: Manuel.Eugster at stat.uni-muenchen.de (Manuel J. A. Eugster)
Date: Tue, 18 Mar 2008 15:48:57 +0100
Subject: [Rd] Roxygen
Message-ID: <47DFD659.40506@stat.uni-muenchen.de>

Hey Peter,

 > If I understand the proposal correctly, there should be a lexer
 > (written in R) that exposes an API; that API would be used by
 > segregated mini-parsers (Roclets) which do the dirty work of Roxygen
 > -> {html, LaTeX, DocBook, ...} translation.

you do not have to write the lexer/parser completely in R, you can
use C/C++ and call the functions from R.

In my thoughts, I do not see the Roclets as mini-parsers, but as small 
R programs working on the parse tree/list returned by one big
parser/lexer. They use the information in the parse tree and create
Rd-files, NAMESPACE file, caller/call graphs, .... But I do not know
if this is the best way and your API-idea sounds good too.


 > The lexer should ship with a proof-of-concept Roclet.

Hm, not only a proof-of-concept Roclet, but a small set of meaningful
ones. An important one is the Roclet for creating the Rd-files.

If you have created a meaningful internal structure of the parsed
code, the Roclets are not too hard to create. I think. :-)


 > Have I missed anything?

First point will be the creation of a list of document and development 
assistance tags which are useful in combination with R. It is
desirable that these tags and their syntax and semantics be compatible
with those used by Doxygen and Javadoc, but extended with tags
important for R specific things.


Hope I could help you,
Manuel Eugster.


From nsoranzo at tiscali.it  Tue Mar 18 13:05:04 2008
From: nsoranzo at tiscali.it (nsoranzo at tiscali.it)
Date: Tue, 18 Mar 2008 13:05:04 +0100 (CET)
Subject: [Rd] Wrong function name in R-ext manual (PR#10986)
Message-ID: <20080318120504.9617E2834611@mail.pubhealth.ku.dk>

Full_Name: Nicola Soranzo
Version: 2.6.2
OS: 
Submission from: (NULL) (147.122.2.166)


Section 8.1.5 "Threading issues" of "Writing R Extensions" says:

"These will be set when R_initialize_R is called, to values appropriate to the
main thread.
Stack-checking can be disabled by seting R_CStackLimit = (uintptr_t)-1, but it
is better to if possible set appropriate values."

R_initialize_R should be changed to Rf_initialize_R

Also I would modify the second sentence to "..., but it is better to set
appropriate values, if possible."


From bob.ohara at helsinki.fi  Tue Mar 18 13:20:04 2008
From: bob.ohara at helsinki.fi (bob.ohara at helsinki.fi)
Date: Tue, 18 Mar 2008 13:20:04 +0100 (CET)
Subject: [Rd] substitute with plots (PR#10987)
Message-ID: <20080318122004.918342834612@mail.pubhealth.ku.dk>

Full_Name: Bob O'Hara
Version: 2.6.2
OS: Windows
Submission from: (NULL) (128.214.72.197)


Wishlist: This is a documentation problem/complaint/whinge.

The help for substitute() tells us "The typical use of substitute is to create
informative labels for data sets and plots."  But the example given is trivial
and not a lot of use for the sorts of labels we usually require.  FAQ 7.13
explains how to substitute values into plot labels, so it would be useful to put
this as an example in the help page too.

Actually, a few more examples might be useful, so we don't have to guess what
order to put the substitute, paste, and expression (or eval, bquote and paste)!


From jmc at r-project.org  Tue Mar 18 17:51:36 2008
From: jmc at r-project.org (John Chambers)
Date: Tue, 18 Mar 2008 09:51:36 -0700
Subject: [Rd] Utilities for methods
Message-ID: <47DFF318.1030609@r-project.org>

The first implementation of the methods package used the  "MethodsList" 
class for method dispatch.  Objects from the class stored methods 
recursively by the separate arguments in the method signature.

That was a good structure for selecting a method, but not for most other 
utilities.  However, it was used for essentially everything in the 
beginning.  The methods list for a particular function in a particular 
package was stored in an object in the package's namespace or 
environment, under a mangled name.

For some time now this class has been replaced for method selection by 
environment tables that store methods by a string derived from the 
signature.  The tables provide faster and more flexible computations.  
These tables are now stored and used instead of methods lists, but we 
continue to compute and assign the old objects as well.

The time has come to get rid of the old objects, since there is some 
overhead in computing them and they can cause confusion or errors.

The first step, for 2.7.0, will be to introduce some new utilities that 
return simpler structures---additions, not replacements for any current 
utilities.  At the same time, we will deprecate the function that 
returns the mangled name for the old metadata objects---I very much hope 
no one is currently using this outside of the R code itself, in any case.

For this round, the old metadata objects will still be generated.  It's 
likely they will disappear in version 2.8.  Meanwhile, the R code itself 
will be modified to not use these objects for standard utilities.

With luck, the new code will be committed to r-devel within a few days.  
It should not cause any visible change except for those really digging 
into the innards, and not too likely even then.   If you have functions 
that manipulate MethodsList objects (e.g.,  from calling getMethods()), 
these should still work.  But you might consider changing to newer 
utilities that should be faster and more convenient, at least when more 
than one argument is involved.

The new utilities will be:  findMethods(), which returns a simple list 
of methods (replacement for getMethods()); findMethodSignatures(), which 
returns a character matrix of signatures; and hasMethods(), which tests 
for the existence of methods.

Cheers,
John


From ggrothendieck at gmail.com  Tue Mar 18 18:04:18 2008
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Tue, 18 Mar 2008 13:04:18 -0400
Subject: [Rd] cut.Date and cut.POSIXt problem
Message-ID: <971536df0803181004x5ebbe960q6879506089b3e428@mail.gmail.com>

cut.Date and cut.POSIXt indicate that the breaks argument
can be an integer followed by a space followed by "year", etc.
but it seems the integer is ignored.

For example, I assume that breaks = "3 months" is supposed
to cut it into quarters but, in fact, it cuts it into months as if
3 had not been there.

> d <- seq(Sys.Date(), length = 12, by = "month")
> cut(d, "3 months")
 [1] 2008-03-01 2008-04-01 2008-05-01 2008-06-01 2008-07-01 2008-08-01
2008-09-01 2008-10-01 2008-11-01 2008-12-01 2009-01-01 2009-02-01
Levels: 2008-03-01 2008-04-01 2008-05-01 2008-06-01 2008-07-01
2008-08-01 2008-09-01 2008-10-01 2008-11-01 2008-12-01 2009-01-01
2009-02-01
> cut(as.POSIXct(d), "3 months")
 [1] 2008-03-01 2008-04-01 2008-05-01 2008-06-01 2008-07-01 2008-08-01
2008-09-01 2008-10-01 2008-11-01 2008-12-01 2009-01-01 2009-02-01
Levels: 2008-03-01 2008-04-01 2008-05-01 2008-06-01 2008-07-01
2008-08-01 2008-09-01 2008-10-01 2008-11-01 2008-12-01 2009-01-01
2009-02-01
> cut(as.POSIXlt(d), "3 months")
 [1] 2008-03-01 2008-04-01 2008-05-01 2008-06-01 2008-07-01 2008-08-01
2008-09-01 2008-10-01 2008-11-01 2008-12-01 2009-01-01 2009-02-01
Levels: 2008-03-01 2008-04-01 2008-05-01 2008-06-01 2008-07-01
2008-08-01 2008-09-01 2008-10-01 2008-11-01 2008-12-01 2009-01-01
2009-02-01


From gginiu at gmail.com  Tue Mar 18 18:18:03 2008
From: gginiu at gmail.com (gginiu)
Date: Tue, 18 Mar 2008 18:18:03 +0100
Subject: [Rd] [GSoC] - few general questions
In-Reply-To: <f6d5b6a20803181015lee156d1ocaee8ea30c89c882@mail.gmail.com>
References: <f6d5b6a20803181015lee156d1ocaee8ea30c89c882@mail.gmail.com>
Message-ID: <f6d5b6a20803181018s3eebf86as5cef43bddcae0e33@mail.gmail.com>

 First of all hello to all and congratulations to r-project on passing
 requirements for mentoring organization!

 I'm interested in participating this year, and from proposed ideas I
 think last one - that's "Finite Mixture Models for Large Data Sets"
 fits me best... (but I don't freeze out some other, maybe new
 ideas)...

 What would be workflow for discussing possible other ideas or details
 of existing one? In case of existing ideas is mailing list preferred
 or direct mail contact with will-be-mentor - or maybe this should be
 better leaved for after-application period?

 I think that's all for now, but I will come up with many more probably
 in future - that's also mine first try at GSoC... thanks in advance
 for answers,

 regards,
 Andrzej Giniewicz.

 btw - I planned to drop by into IRC from time to time, for who should
 I look to know that there is someone that is not only-user?


From rpeng at jhsph.edu  Tue Mar 18 19:09:20 2008
From: rpeng at jhsph.edu (Roger D. Peng)
Date: Tue, 18 Mar 2008 14:09:20 -0400
Subject: [Rd] cut.Date and cut.POSIXt problem
In-Reply-To: <971536df0803181004x5ebbe960q6879506089b3e428@mail.gmail.com>
References: <971536df0803181004x5ebbe960q6879506089b3e428@mail.gmail.com>
Message-ID: <47E00550.8050602@jhsph.edu>

Seems it did work as advertised in R 2.6.0 but is still broken in R-devel.  Will 
take a look.

-roger

Gabor Grothendieck wrote:
> cut.Date and cut.POSIXt indicate that the breaks argument
> can be an integer followed by a space followed by "year", etc.
> but it seems the integer is ignored.
> 
> For example, I assume that breaks = "3 months" is supposed
> to cut it into quarters but, in fact, it cuts it into months as if
> 3 had not been there.
> 
>> d <- seq(Sys.Date(), length = 12, by = "month")
>> cut(d, "3 months")
>  [1] 2008-03-01 2008-04-01 2008-05-01 2008-06-01 2008-07-01 2008-08-01
> 2008-09-01 2008-10-01 2008-11-01 2008-12-01 2009-01-01 2009-02-01
> Levels: 2008-03-01 2008-04-01 2008-05-01 2008-06-01 2008-07-01
> 2008-08-01 2008-09-01 2008-10-01 2008-11-01 2008-12-01 2009-01-01
> 2009-02-01
>> cut(as.POSIXct(d), "3 months")
>  [1] 2008-03-01 2008-04-01 2008-05-01 2008-06-01 2008-07-01 2008-08-01
> 2008-09-01 2008-10-01 2008-11-01 2008-12-01 2009-01-01 2009-02-01
> Levels: 2008-03-01 2008-04-01 2008-05-01 2008-06-01 2008-07-01
> 2008-08-01 2008-09-01 2008-10-01 2008-11-01 2008-12-01 2009-01-01
> 2009-02-01
>> cut(as.POSIXlt(d), "3 months")
>  [1] 2008-03-01 2008-04-01 2008-05-01 2008-06-01 2008-07-01 2008-08-01
> 2008-09-01 2008-10-01 2008-11-01 2008-12-01 2009-01-01 2009-02-01
> Levels: 2008-03-01 2008-04-01 2008-05-01 2008-06-01 2008-07-01
> 2008-08-01 2008-09-01 2008-10-01 2008-11-01 2008-12-01 2009-01-01
> 2009-02-01
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 

-- 
Roger D. Peng  |  http://www.biostat.jhsph.edu/~rpeng/


From h.wickham at gmail.com  Tue Mar 18 19:21:41 2008
From: h.wickham at gmail.com (hadley wickham)
Date: Tue, 18 Mar 2008 18:21:41 +0000
Subject: [Rd] Roxygen
In-Reply-To: <20080317235644.GA24414@klutometis.wikitex.org>
References: <20080317235644.GA24414@klutometis.wikitex.org>
Message-ID: <f8e6ff050803181121t51bf5ed4qac2c0c67909d2494@mail.gmail.com>

On Mon, Mar 17, 2008 at 11:56 PM, Peter Danenberg <pcd at wikitex.org> wrote:
> Is this the appropriate place for GSoC conversations?
>
>  If I understand the proposal correctly, there should be a lexer
>  (written in R) that exposes an API; that API would be used by
>  segregated mini-parsers (Roclets) which do the dirty work of Roxygen
>  -> {html, LaTeX, DocBook, ...} translation.
>
>  The lexer should ship with a proof-of-concept Roclet. Have I missed
>  anything?

You should probably also survey existing attempts - I have written
something with ruby that suggest some ideas.  I also have a number of
packages documented with that format which could be used for testing -
I'd be happy to reformat my existing documentation if it meant I would
no longer have to maintain my quick and dirty (and buggy!) parser.

Hadley

-- 
http://had.co.nz/


From ggrothendieck at gmail.com  Tue Mar 18 19:29:53 2008
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Tue, 18 Mar 2008 14:29:53 -0400
Subject: [Rd] cut.Date and cut.POSIXt problem
In-Reply-To: <47E00550.8050602@jhsph.edu>
References: <971536df0803181004x5ebbe960q6879506089b3e428@mail.gmail.com>
	<47E00550.8050602@jhsph.edu>
Message-ID: <971536df0803181129h81e79e9m832adb01cf6ca373@mail.gmail.com>

I am using

[1] "R version 2.6.2 alpha (2008-01-26 r44181)"

and also get the same under:

"R version 2.7.0 Under development (unstable) (2008-03-13 r44752)"

On Tue, Mar 18, 2008 at 2:09 PM, Roger D. Peng <rpeng at jhsph.edu> wrote:
> Seems it did work as advertised in R 2.6.0 but is still broken in R-devel.  Will
> take a look.
>
> -roger
>
>
> Gabor Grothendieck wrote:
> > cut.Date and cut.POSIXt indicate that the breaks argument
> > can be an integer followed by a space followed by "year", etc.
> > but it seems the integer is ignored.
> >
> > For example, I assume that breaks = "3 months" is supposed
> > to cut it into quarters but, in fact, it cuts it into months as if
> > 3 had not been there.
> >
> >> d <- seq(Sys.Date(), length = 12, by = "month")
> >> cut(d, "3 months")
> >  [1] 2008-03-01 2008-04-01 2008-05-01 2008-06-01 2008-07-01 2008-08-01
> > 2008-09-01 2008-10-01 2008-11-01 2008-12-01 2009-01-01 2009-02-01
> > Levels: 2008-03-01 2008-04-01 2008-05-01 2008-06-01 2008-07-01
> > 2008-08-01 2008-09-01 2008-10-01 2008-11-01 2008-12-01 2009-01-01
> > 2009-02-01
> >> cut(as.POSIXct(d), "3 months")
> >  [1] 2008-03-01 2008-04-01 2008-05-01 2008-06-01 2008-07-01 2008-08-01
> > 2008-09-01 2008-10-01 2008-11-01 2008-12-01 2009-01-01 2009-02-01
> > Levels: 2008-03-01 2008-04-01 2008-05-01 2008-06-01 2008-07-01
> > 2008-08-01 2008-09-01 2008-10-01 2008-11-01 2008-12-01 2009-01-01
> > 2009-02-01
> >> cut(as.POSIXlt(d), "3 months")
> >  [1] 2008-03-01 2008-04-01 2008-05-01 2008-06-01 2008-07-01 2008-08-01
> > 2008-09-01 2008-10-01 2008-11-01 2008-12-01 2009-01-01 2009-02-01
> > Levels: 2008-03-01 2008-04-01 2008-05-01 2008-06-01 2008-07-01
> > 2008-08-01 2008-09-01 2008-10-01 2008-11-01 2008-12-01 2009-01-01
> > 2009-02-01
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >
>
> --
> Roger D. Peng  |  http://www.biostat.jhsph.edu/~rpeng/
>


From ggrothendieck at gmail.com  Tue Mar 18 19:32:37 2008
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Tue, 18 Mar 2008 14:32:37 -0400
Subject: [Rd] cut.Date and cut.POSIXt problem
In-Reply-To: <971536df0803181129h81e79e9m832adb01cf6ca373@mail.gmail.com>
References: <971536df0803181004x5ebbe960q6879506089b3e428@mail.gmail.com>
	<47E00550.8050602@jhsph.edu>
	<971536df0803181129h81e79e9m832adb01cf6ca373@mail.gmail.com>
Message-ID: <971536df0803181132h251d4d3aq8555dd23060277df@mail.gmail.com>

By the way, it would be nice if the breaks argument
accepted the word "quarter" directly since its quite a common
break to need when using dates.

On Tue, Mar 18, 2008 at 2:29 PM, Gabor Grothendieck
<ggrothendieck at gmail.com> wrote:
> I am using
>
> [1] "R version 2.6.2 alpha (2008-01-26 r44181)"
>
> and also get the same under:
>
> "R version 2.7.0 Under development (unstable) (2008-03-13 r44752)"
>
>
> On Tue, Mar 18, 2008 at 2:09 PM, Roger D. Peng <rpeng at jhsph.edu> wrote:
> > Seems it did work as advertised in R 2.6.0 but is still broken in R-devel.  Will
> > take a look.
> >
> > -roger
> >
> >
> > Gabor Grothendieck wrote:
> > > cut.Date and cut.POSIXt indicate that the breaks argument
> > > can be an integer followed by a space followed by "year", etc.
> > > but it seems the integer is ignored.
> > >
> > > For example, I assume that breaks = "3 months" is supposed
> > > to cut it into quarters but, in fact, it cuts it into months as if
> > > 3 had not been there.
> > >
> > >> d <- seq(Sys.Date(), length = 12, by = "month")
> > >> cut(d, "3 months")
> > >  [1] 2008-03-01 2008-04-01 2008-05-01 2008-06-01 2008-07-01 2008-08-01
> > > 2008-09-01 2008-10-01 2008-11-01 2008-12-01 2009-01-01 2009-02-01
> > > Levels: 2008-03-01 2008-04-01 2008-05-01 2008-06-01 2008-07-01
> > > 2008-08-01 2008-09-01 2008-10-01 2008-11-01 2008-12-01 2009-01-01
> > > 2009-02-01
> > >> cut(as.POSIXct(d), "3 months")
> > >  [1] 2008-03-01 2008-04-01 2008-05-01 2008-06-01 2008-07-01 2008-08-01
> > > 2008-09-01 2008-10-01 2008-11-01 2008-12-01 2009-01-01 2009-02-01
> > > Levels: 2008-03-01 2008-04-01 2008-05-01 2008-06-01 2008-07-01
> > > 2008-08-01 2008-09-01 2008-10-01 2008-11-01 2008-12-01 2009-01-01
> > > 2009-02-01
> > >> cut(as.POSIXlt(d), "3 months")
> > >  [1] 2008-03-01 2008-04-01 2008-05-01 2008-06-01 2008-07-01 2008-08-01
> > > 2008-09-01 2008-10-01 2008-11-01 2008-12-01 2009-01-01 2009-02-01
> > > Levels: 2008-03-01 2008-04-01 2008-05-01 2008-06-01 2008-07-01
> > > 2008-08-01 2008-09-01 2008-10-01 2008-11-01 2008-12-01 2009-01-01
> > > 2009-02-01
> > >
> > > ______________________________________________
> > > R-devel at r-project.org mailing list
> > > https://stat.ethz.ch/mailman/listinfo/r-devel
> > >
> >
> > --
> > Roger D. Peng  |  http://www.biostat.jhsph.edu/~rpeng/
> >
>


From ligges at statistik.tu-dortmund.de  Tue Mar 18 19:43:34 2008
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Tue, 18 Mar 2008 19:43:34 +0100
Subject: [Rd] Win-builder offline
Message-ID: <47E00D56.2080504@statistik.tu-dortmund.de>

FYI: the win-builder machine will be offline for roughly 24 hours due to 
some hardware failure.

Best,
Uwe Ligges


From rpeng at jhsph.edu  Tue Mar 18 19:58:21 2008
From: rpeng at jhsph.edu (Roger D. Peng)
Date: Tue, 18 Mar 2008 14:58:21 -0400
Subject: [Rd] cut.Date and cut.POSIXt problem
In-Reply-To: <971536df0803181004x5ebbe960q6879506089b3e428@mail.gmail.com>
References: <971536df0803181004x5ebbe960q6879506089b3e428@mail.gmail.com>
Message-ID: <47E010CD.6090200@jhsph.edu>

Seems changes in r44116 force the interval to be single months (or years) 
instead of whatever the user specified.  I think the attached patches correct this.

Interestingly, 'cut' and 'seq' allow for the 'breaks' specification to be 
something like "3 months" but the documentation for 'hist' does not allow for 
this type of specification.

-roger

Gabor Grothendieck wrote:
> cut.Date and cut.POSIXt indicate that the breaks argument
> can be an integer followed by a space followed by "year", etc.
> but it seems the integer is ignored.
> 
> For example, I assume that breaks = "3 months" is supposed
> to cut it into quarters but, in fact, it cuts it into months as if
> 3 had not been there.
> 
>> d <- seq(Sys.Date(), length = 12, by = "month")
>> cut(d, "3 months")
>  [1] 2008-03-01 2008-04-01 2008-05-01 2008-06-01 2008-07-01 2008-08-01
> 2008-09-01 2008-10-01 2008-11-01 2008-12-01 2009-01-01 2009-02-01
> Levels: 2008-03-01 2008-04-01 2008-05-01 2008-06-01 2008-07-01
> 2008-08-01 2008-09-01 2008-10-01 2008-11-01 2008-12-01 2009-01-01
> 2009-02-01
>> cut(as.POSIXct(d), "3 months")
>  [1] 2008-03-01 2008-04-01 2008-05-01 2008-06-01 2008-07-01 2008-08-01
> 2008-09-01 2008-10-01 2008-11-01 2008-12-01 2009-01-01 2009-02-01
> Levels: 2008-03-01 2008-04-01 2008-05-01 2008-06-01 2008-07-01
> 2008-08-01 2008-09-01 2008-10-01 2008-11-01 2008-12-01 2009-01-01
> 2009-02-01
>> cut(as.POSIXlt(d), "3 months")
>  [1] 2008-03-01 2008-04-01 2008-05-01 2008-06-01 2008-07-01 2008-08-01
> 2008-09-01 2008-10-01 2008-11-01 2008-12-01 2009-01-01 2009-02-01
> Levels: 2008-03-01 2008-04-01 2008-05-01 2008-06-01 2008-07-01
> 2008-08-01 2008-09-01 2008-10-01 2008-11-01 2008-12-01 2009-01-01
> 2009-02-01
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 

-- 
Roger D. Peng  |  http://www.biostat.jhsph.edu/~rpeng/
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: patch-dates.R
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20080318/46ce1eaf/attachment.pl 
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: patch-datetime.R
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20080318/46ce1eaf/attachment-0001.pl 

From alberto.labarga at googlemail.com  Wed Mar 19 10:16:43 2008
From: alberto.labarga at googlemail.com (Alberto Labarga)
Date: Wed, 19 Mar 2008 10:16:43 +0100
Subject: [Rd] installing R packages from command line in Windows
Message-ID: <f117943a0803190216x5a524e4al7ef1ced22e6ee365@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20080319/0bb7dbbb/attachment.pl 

From ripley at stats.ox.ac.uk  Wed Mar 19 10:26:35 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 19 Mar 2008 09:26:35 +0000 (GMT)
Subject: [Rd] installing R packages from command line in Windows
In-Reply-To: <f117943a0803190216x5a524e4al7ef1ced22e6ee365@mail.gmail.com>
References: <f117943a0803190216x5a524e4al7ef1ced22e6ee365@mail.gmail.com>
Message-ID: <alpine.LFD.1.00.0803190920370.4507@gannet.stats.ox.ac.uk>

On Wed, 19 Mar 2008, Alberto Labarga wrote:

> Hi,
>
> I would like to create an installer using NSIS (
> http://nsis.sourceforge.net/Main_Page) that installs R and some packages,
>
> I was expecting to use Rcmd.exe INSTALL package_name.zip, but it seems it
> is more complicated than that,

Hmm, INSTALL is clearly documented to install source packages.
Try Rcmd INSTALL --help, for example.

It's actually simpler: you just unzip the binary package in the library 
directory and (optionally) then run link.html.help() to update 
packages.html etc.

> I know I can try and build the source and create the installer myself, but
> I think this could be quicker, I can get some help
>
> any hint? anybody tried the same approach?

We document how to make a custom installer with Inno Setup, so why not 
use the documented approach?

>
> thank you very much,
>
> Alberto
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From anders at ebi.ac.uk  Tue Mar 18 18:22:34 2008
From: anders at ebi.ac.uk (Simon Anders)
Date: Tue, 18 Mar 2008 17:22:34 +0000
Subject: [Rd] 'merge' function: behavior w.r.t. NAs in the key column
In-Reply-To: <Pine.GSO.4.56.0803141649050.1946@devsun3201.insightful.com>
References: <47DAB2F6.3050002@ebi.ac.uk>
	<Pine.GSO.4.56.0803141649050.1946@devsun3201.insightful.com>
Message-ID: <47DFFA5A.7060909@ebi.ac.uk>

Hi Bill,

Bill Dunlap wrote:
> Splus (versions 8.0, 7.0, and 6.2) gives:
>    > merge( x, y, by="key" )
>      key val.x val.y
>    1   2    12    22
>    2   3    13    23
>    3   3    14    23
>    4   3    13    26
>    5   3    14    26
> Is that what you expect?  There is no argument
> to Splus's merge to make it include the NA's
> in the way R's merge does.  Should there be such
> an argument?

Yes, this is what I would expect.

Would it be reasonable to consider Splus's behavior as correct and R's 
behavior as inconsistent, and hence ask R's 'merge' function to be fixed?

Cheers
   Simon

> On Fri, 14 Mar 2008, Simon Anders wrote:
>> I recently ran into a problem with 'merge' that stems from the way how
>> missing values in the key column (i.e., the column specified
>> in the "by" argument) are handled. I wonder whether the current behavior
>> is fully consistent.
>> ...
>>> x <- data.frame( key = c(1:3,3,NA,NA), val = 10+1:6 )
>>> y <- data.frame( key = c(NA,2:5,3,NA), val = 20+1:7 )
>> ...
>>> merge( x, y, by="key" )
>>    key val.x val.y
>> 1   2    12    22
>> 2   3    13    23
>> 3   3    13    26
>> 4   3    14    23
>> 5   3    14    26
>> 6  NA    15    21
>> 7  NA    15    27
>> 8  NA    16    21
>> 9  NA    16    27
>>
>> As one should expect, there are now four lines with key value '3',
>> because the key '3' appears twice both in x and in y. According to the
>> logic of merge, a row should be produced in the output for each pairing
>> of a row from x and a row from y where the values of 'key' are equal.
>>
>> However, the 'NA' values are treated exactly the same way. It seems that
>> 'merge' considers the pairing of lines with 'NA' in both 'key' columns
>> an allowed match. IMHO, this runs against the convention that two NAs
>> are not considered equal. ('NA==NA' does not evaluate to 'TRUE'.)
>>
>> Is might be more consistent if merge did not include any rows into the
>> output with an "NA" in the key column.
>>
>> Maybe, one could add a flag argument to 'merge' to switch between this
>> behaviour and the current one? A note in the help page might be nice, too.


From nhorton at scinix.smith.edu  Tue Mar 18 20:00:36 2008
From: nhorton at scinix.smith.edu (nhorton at scinix.smith.edu)
Date: Tue, 18 Mar 2008 20:00:36 +0100 (CET)
Subject: [Rd] ambiguous example in as.Date() documentation (PR#10990)
Message-ID: <20080318190036.766112834159@mail.pubhealth.ku.dk>


<<insert bug report here>>

The note in the as.Date() documentation is ambiguous (is it referring
to February 3rd, 2001, or March 2nd, 2001?)  While it is certainly true
that one could peruse the ISO 8601 standard to determine which ordering
is correct, changing the example day to one where the day value is >12
would resolve the ambiguity.

Current Note:

     The default formats follow the rules of the ISO 8601 international
     standard which expresses a day as '"2001-02-03"'.

Proposed Note:

     The default formats follow the rules of the ISO 8601 international
     standard which expresses a day as '"2001-04-29"'.


--please do not edit the information below--

Version:
 platform = i386-redhat-linux-gnu
 arch = i386
 os = linux-gnu
 system = i386, linux-gnu
 status = 
 major = 2
 minor = 5.1
 year = 2007
 month = 06
 day = 27
 svn rev = 42083
 language = R
 version.string = R version 2.5.1 (2007-06-27)

Locale:
LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=en_US.UTF-8;LC_COLLATE=en_US.UTF-8;LC_MONETARY=en_US.UTF-8;LC_MESSAGES=en_US.UTF-8;LC_PAPER=en_US.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US.UTF-8;LC_IDENTIFICATION=C

Search Path:
 .GlobalEnv, package:stats, package:graphics, package:grDevices, package:utils, package:datasets, package:methods, Autoloads, package:base


From juryef at yahoo.com  Wed Mar 19 02:20:12 2008
From: juryef at yahoo.com (juryef at yahoo.com)
Date: Wed, 19 Mar 2008 02:20:12 +0100 (CET)
Subject: [Rd] The use of command 'file.choose' seems to make R console crash
	(PR#10994)
Message-ID: <20080319012012.53494282EFF6@mail.pubhealth.ku.dk>

--0-1806400484-1205889303=:37828
Content-Type: text/plain; charset=iso-8859-1
Content-Transfer-Encoding: 8bit
Content-Id: 
Content-Disposition: inline

Deat R-development team,

   I reported a problem with the R console closing by
itself a few weeks ago, but I think I have narrowed
down the problem to the use of the command
file.choose.

   I work on a HP  dc7600 computer, Windows XP and I
am using R 2.6.2 patched. I attached the script and
csv file I have been testing.

  This is what I do before the R console shuts down
without giving any error messages:

(Open the R console)
1.- I open the script in RWinEdt (version 5.5). Go to
the Edit menu and click 'Select all'.
2.- Click the R-paste icon of RWinEdt.
3.- The R console will pop-up and and new window will
appear asking you to select a file. Select the csv
file I am attaching.
4. R will read the csv file.
5. Now right-click the mouse on the R console, and
select paste. It will ask you to select a file again,
select the same csv file as in step 3.
6.-Repeat step 5, 2 or 4 times, then R will crash
whitout any notice.

  At this point I need to open the Windows Task
Manager and kill the RGui process that seems to be
running, even though the R console is not open. The
CPU usage will appear at a 100% until I kill the
process.

  R doesn't crash when instead of using file.choose I
just type the path where the file can be found. The
only reason why I started using 'file.choose' is
because people not familiar with R need to run the
scripts I write.

  I hope my report is clear enough, otherwise, please
let me know if I missed anything.

   I am very grateful to all the people who is so
generous with their time to provide us with such a
powerful language like R. Thank you!

Judith


      ____________________________________________________________________________________
Looking for last minute shopping deals?  

--0-1806400484-1205889303=:37828
Content-Type: application/octet-stream; name="for_test.csv"
Content-Transfer-Encoding: base64
Content-Description: 1952973407-for_test.csv
Content-Disposition: attachment; filename="for_test.csv"

dCxzLHRpLHRyLHYscHAscHBvLG1wLHIsYWMsayxmLHIsYSxuDQo4MSw3LjQ3
MzkxNDUwNSwtMSxWZWhpY2xlLDQ0OCwxMzgsMTU1LDE0Ni41LDIxLjc2ODgy
MjksNDQ2LE5vLHksLG4sNg0KODEsMTAuNzM3MDk4OTMsMixWZWhpY2xlLDU5
Miw3MywxMDUsODksMTcuMzg0NTk0Nyw1ODYsTm8seSwsbiw2DQo4MSwxMC4z
NTI3MTcxNiw2LFZlaGljbGUsNTcxLDEwMiwxMjksMTE1LjUsMjIuMjM0NDQz
LDU3OCxObyx5LCxuLDYNCjgxLDguMTMwNzczMDY1LDksVmVoaWNsZSwxMDg2
LDEwOCwxMzQsMTIxLDIzLjk5MTI2NzMsNTk1LFllcyx5LCxuLDYNCjgxLDEw
LjAzMzcwMDk1LDEzLFZlaGljbGUsMTM2MCwxMTAsMTI2LDExOCwyMC42NTM5
MzQ0LDUyNSxObyx5LCxuLDYNCjY1Niw3Ljk1MTM5ODEzNSwtMSxBLDQwMy40
MjcxODc1LDg5LDgxLDg1LDE2LjAyNjM5NzIsNTY2LE5vLHksLG4sNg0KNjU2
LDQuMjM5MTY5MDYsMixBLDQ0OCwxMjIsNTUsODguNSw4Ljc4ODEyMTEsMjk4
LE5vLHksLG4sNg0KNjU2LDQuODk1ODMzNDk1LDYsQSwyMzEsODgsNjAsNzQs
OC4yNjMxNzM2LDMzNSxObyx5LCx5LDYNCjY1Niw3LjIxNjg1NzY3Myw5LEEs
MjA2LDg0LDcwLDc3LDE0Ljk4NTUwMTMsNTg0LFllcyx5LCxuLDYNCjY1Niwx
MC43MDIzNzczMiwxMyxBLDQ0Nyw4Miw2MSw3MS41LDIxLjgzMDQ4MzQsOTE2
LE5vLHksLG4sNg0KNjYzLDkuOTQ0Mzc3NDIzLC0xLEEsMzYyLjAyODEyOCw4
Miw2NSw3My41LDE2LjY1MjAwMTMsNjgwLE5vLHksLG4sNg0KNjYzLDUuMDQx
ODQyMjIzLDIsQSw0NDYsOTcsODEsODksOC4xMTAxODg5LDI3MyxObyx5LCxu
LDYNCjY2Myw1LjYwNTI2NTczNSw2LEEsMTg4LDEwMCw1OCw3OSw5LjA4MTc1
ODQsMzQ1LE5vLHksLG4sNg0KNjYzLDE0LjIwNTY2MDU4LDksQSwxMDEsNzks
NjIsNzAuNSwyNC4zMjc5MDAzLDEwMzUsWWVzLHksLG4sNg0KNjYzLDEwLjQ4
OTc0Nzc2LDEzLEEsMzEzLDc0LDYwLDY3LDE2Ljk4ODk2NzYsNzYxLE5vLHks
LG4sNg0KNjczLDEzLjM4ODA0MTc0LC0xLFZlaGljbGUsNDU2LjcxOTQwNDUs
OTcsODksOTMsMjMuOTU1OTM3NSw3NzMsTm8seSwsbiw2DQo2NzMsMTIuMDQw
NzAwNjgsMixWZWhpY2xlLDc5NSw3Niw1Nyw2Ni41LDE4LjU0MTQ3OSw4Mzcs
Tm8seSwsbiw2DQo2NzMsMTEuNjc1MjQ4NjIsNixWZWhpY2xlLDExNzcsMTAy
LDc0LDg4LDIxLjU4NDg0MTMsNzM2LE5vLHksLHksNg0KNjczLDExLjcxMjY1
ODg4LDksVmVoaWNsZSwxMjkyLDExNyw2NCw5MC41LDIzLjU5MTk3MzksNzgy
LFllcyx5LCx5LDYNCjY3MywxMS40MTIwNTgzNiwxMyxWZWhpY2xlLDE0ODgs
MTEyLDY2LDg5LDMxLjY2NjE2NjQsMTA2OCxObyx5LCxuLDYNCjY3NSw4LjU3
MTA5MDY5OCwtMSxWZWhpY2xlLDMzOC4wNTExMTQsMTAzLDg4LDk1LjUsMjQu
MjM1MjQyOSw3NjEsTm8seSwsbiw2DQo2NzUsMTEuODM3MTk4NzMsMixWZWhp
Y2xlLDQ3MSw3OSw2OCw3My41LDIwLjMyMjMwMDksODMwLE5vLHksLG4sNg0K
Njc1LDguMjI4MzYxNjk2LDYsVmVoaWNsZSw5NTQsOTgsNzksODguNSwyMi43
NTYzOTA4LDc3MSxObyx5LCx5LDYNCjY3NSwxMS40MjUxMjkxOCw5LFZlaGlj
bGUsMTEyMiwxMDIsNzYsODksMjUuNjM4NDM1OSw4NjQsWWVzLHksLHksNg0K
Njc1LDEzLjIzNjA3MzAyLDEzLFZlaGljbGUsMTYyNCw5NSwxMDAsOTcuNSwy
NS4zOTkxMjY1LDc4MixObyx5LCxuLDYNCjcwNCw3Ljg3NzI2OTk4MywtMSxB
LDQ2Mi45MDIxMzc1LDEyMywxMzEsMTI3LDI5LjAwMDc2NjMsNjg1LE5vLHks
LG4sNg0KNzA0LDUuNjY4MDE0MTY4LDIsQSwzOTYsMTM1LDEwOSwxMjIsMTIu
MDY0NDYwMSwyOTcsTm8seSwsbiw2DQo3MDQsOC44MDU0MjgwMjgsNixBLDE1
NCwxMjYsODksMTA3LjUsMTguODkyMTEwNiw1MjcsTm8seSwsbiw2DQo3MDQs
OC41Nzc2MjI2NTMsOSxBLDEwOSwxNTIsMTA1LDEyOC41LDI4LjQyODE1Njks
NjY0LFllcyx5LCxuLDYNCjcwNCwxMC41ODM1ODA5NywxMyxBLDI3NiwxMzUs
MTA1LDEyMCwyNS43NDQ0MjUzLDY0NCxObyx5LCxuLDYNCjcxNCwxMy40NDM2
NjM4NCwtMSxBLDQ3Mi43MjYsMTUzLDExNiwxMzQuNSwyOC41MjI4MTQxLDYz
NixObyx5LCxuLDYNCjcxNCw0LjcwMzU5MDUxMywyLEEsMzk4LDEyOCw4MSwx
MDQuNSw4Ljg3NTQ0NTcsMjU1LE5vLHksLG4sNg0KNzE0LDcuMjkxMzg1MTcz
LDYsQSw5NSw3Nyw0Niw2MS41LDEwLjM0Nzk2NTEsNTA1LE5vLHksLG4sNg0K
NzE0LDEwLjQxNzc1MDM2LDksQSw4MSwxMjUsMTIzLDEyNCwzMC4wNjM2Niw3
MjcsWWVzLHksLG4sNg0KNzE0LDEzLjU2MDg3NTY2LDEzLEEsMjYxLDc5LDc1
LDc3LDI2LjI2NTcwNjUsMTAyMyxObyx5LCxuLDYNCjcxNyw1Ljk4MDg1NTk0
MywtMSxBLDMzNC43MjIwNTIsMTYxLDgyLDEyMS41LDE3LjA2MDYyNzEsNDIx
LE5vLHksLG4sNg0KNzE3LDMuOTk4NDcxOTE4LDIsQSwzMjcsMTAzLDcwLDg2
LjUsNS42ODk3NjQzLDE5NyxObyx5LCxuLDYNCjcxNyw0Ljk4OTc3MjY3OCw2
LEEsMTUxLDk2LDgwLDg4LDExLjg3MTgxMjcsNDA1LE5vLHksLG4sNg0KNzE3
LDkuMzQyMTQxMzg4LDEzLEEsNDEzLDEwMiw3Niw4OSwyNC40MTEyMjUzLDgy
MyxObyx5LCxuLDYNCjcxOSwxMS40ODc5NjcyNSwtMSxWZWhpY2xlLDM0MS41
MTkyLDc5LDk0LDg2LjUsMTguNTk0ODA3LDY0NSxObyx5LCxuLDYNCjcxOSwx
MS40Njg1ODU3MywyLFZlaGljbGUsNDU1LDg5LDY5LDc5LDE5LjkwODAwOSw3
NTYsTm8seSwsbiw2DQo3MTksMTMuNzg3MDAwOSw2LFZlaGljbGUsNTg5LDE1
MiwxMTMsMTMyLjUsMzQuNDkzNTUwMyw3ODEsTm8seSwsbiw2DQo3MTksMTQu
Njg4MzkzNTksOSxWZWhpY2xlLDYzOSwxNjAsMTM1LDE0Ny41LDQzLjkyMDI3
NDIsODkzLFllcyx5LCx5LDYNCjcyNywxMS40ODEyMjAyNSwtMSxWZWhpY2xl
LDQ2Ni4yNzQyODIsNzYsNDcsNjEuNSwxNS42MDA3NzMxLDc2MSxObyx5LCxu
LDYNCjcyNyw5Ljg5MjMyMTgyOCwyLFZlaGljbGUsNTYwLDU5LDM4LDQ4LjUs
MTMuNjQxNjM1Nyw4NDQsTm8seSwsbiw2DQo3MjcsMTEuNTM3OTQyODksNixW
ZWhpY2xlLDgwNiw3MCw0NSw1Ny41LDE2LjY2MDY2NzEsODY5LE5vLHksLG4s
Ng0KNzI3LDkuODg5OTg1MzIzLDksVmVoaWNsZSwxMDA3LDExMiw2MSw4Ni41
LDI0LjU4Mjg3NDgsODUzLFllcyx5LCx5LDYNCjcyNyw5LjM0MjE0MTM4OCwx
MyxWZWhpY2xlLDkyNiw3Nyw0Miw1OS41LDE4LjU3ODQ3NTMsOTM3LE5vLHks
LG4sNg0KNzMxLDkuNzI3MzMyNTkzLC0xLEEsMzM4LjMxMzg1NzUsMTEwLDk2
LDEwMywyMi43NTgwNTczLDY2MyxObyx5LCxuLDYNCjczMSw0LjgxMjMyMzU2
OCwyLEEsNDA3LDEzNSwxMTQsMTI0LjUsMTEuMDAwMjMzMiwyNjUsTm8seSws
biw2DQo3MzEsNS4xMDc0MTA3ODgsNixBLDE5OCwxMzcsOTgsMTE3LjUsMTAu
NDI0OTU3NCwyNjYsTm8seSwsbiw2DQo3MzEsNy42OTMxNjYzNzUsOSxBLDE5
MSwxMTIsMTE1LDExMy41LDI1LjM5NjEyNjgsNjcxLFllcyx5LCxuLDYNCjcz
MSwxMS4yNzk2MDExLDEzLEEsNTgyLDE2NCwxMDMsMTMzLjUsMzUuNjY2NDMz
LDgwMixObyx5LCxuLDYNCjczNSw5LjYzNjgxNzIxNSwtMSxBLDI4Ni45MTEw
NzIsMTA2LDg2LDk2LDE5LjI5NjczNjgsNjAzLE5vLHksLG4sNg0KNzM1LDQu
NTE2Njc4MzMzLDIsQSwzNDUsMTE3LDk4LDEwNy41LDguMTczMTgyNiwyMjgs
Tm8seSwsbiw2DQo3MzUsNi4zMDI5OTExNSw2LEEsMTYyLDEyNSwxMDEsMTEz
LDEwLjYxODI3MTQsMjgyLE5vLHksLG4sNg0KNzM1LDcuNzk3MzA4NTY1LDks
QSwxODMsMTQwLDEzOCwxMzksMjIuMjIxMTExLDQ4MCxZZXMseSwsbiw2DQo3
MzUsMTIuNTUyNTgwMTIsMTMsQSwzODYsMTE0LDk4LDEwNiwyNy43NzI4ODkx
LDc4NixObyx5LCxuLDYNCjczOCwxNS4wNzcwODIxNiwtMSxWZWhpY2xlLDI5
My42MjIwMiw4Myw3MCw3Ni41LDIyLjA1MTEyOCw4NjUsTm8seSwsbiw2DQo3
MzgsMTQuMjcxNDk0ODcsMixWZWhpY2xlLDQ5Myw3NSw2NSw3MCwyMS4yOTQ1
MzcsOTEzLE5vLHksLG4sNg0KNzM4LDEwLjgyNTQ2NTY4LDYsVmVoaWNsZSw3
MjYsMTA0LDUyLDc4LDE5LjIyNDQxMDcsNzM5LE5vLHksLG4sNg0KNzM4LDEx
Ljc5OTk0OTY1LDksVmVoaWNsZSw4NzQsOTksNjQsODEuNSwyMi4wNDk0NjE1
LDgxMixZZXMseSwsbiw2DQo3MzgsMTYuNTg4NDM2ODQsMTMsVmVoaWNsZSwx
MjA5LDE1OSw5NiwxMjcuNSwzOC42MTMxMzgzLDkwOSxObyx5LCxuLDYNCjc0
MiwxMi4xNzkzOTM3NywtMSxBLDQ1Mi4wNjM1Mjk1LDkyLDg3LDg5LjUsMTcu
NzI2NTYwNSw1OTQsTm8seSwsbiw2DQo3NDIsNi4zMDIyNjQyMTMsMixBLDUw
OSw3NSw2OCw3MS41LDUuOTQ1NzM4NywyNTAsTm8seSwsbiw2DQo3NDIsOC40
NDM0NTI2MjcsNixBLDEzOSw0OCw0OCw0OCw2LjczOTAxMSw0MjEsTm8seSws
biw2DQo3NDQsMTEuMTczNDU2MTksLTEsVmVoaWNsZSwzMjkuMTgwMDE2LDgx
LDY4LDc0LjUsMTQuOTE5ODQxMiw2MDEsTm8seSwsbiw2DQo3NDQsMTQuMDIz
NTM5MDcsMixWZWhpY2xlLDQ2Niw4MSw1Nyw2OSwxOS4yNDMwNzU1LDgzNyxO
byx5LCxuLDYNCjc0NCwxMy4xNDU1Mjg4LDYsVmVoaWNsZSw2NjUsNjYsODIs
NzQsMTcuNDM0MjU2NCw3MDcsTm8seSwsbiw2DQo3NDQsMTUuMDU3MDkxLDks
VmVoaWNsZSw4MTQsNzksNzgsNzguNSwyNC45ODE1MDE2LDk1NSxZZXMseSws
biw2DQo3NDQsMTYuNjA0NjcyNjcsMTMsVmVoaWNsZSwxMTU2LDkzLDg0LDg4
LjUsMjYuOTQxMzA1Niw5MTMsTm8seSwsbiw2DQo3NDcsMTIuMzMyMTA5OTMs
LTEsQSwzNTYuNzA4Miw2NSw2OCw2Ni41LDE4LjA4OTUyNDIsODE2LE5vLHks
LG4sNg0KNzQ3LDUuMjQ5Nzc4OTg4LDIsQSw0NTMsMTEzLDY2LDg5LjUsOS40
Mzc3MjI4LDMxNixObyx5LCxuLDYNCjc0Nyw2LjI5NTIyMDk3Myw2LEEsMTkw
LDEwNSw1NCw3OS41LDEzLjAyOTY5NjksNDkyLE5vLHksLG4sNg0KNzQ3LDE4
LjYzMzU0ODI2LDksQSwxNDgsODAsNTYsNjgsMzQuMzc4ODk1MSwxNTE3LFll
cyx5LCxuLDYNCjc0NywxNi41NjQ5OTg2MywxMyxBLDEwMiw4MSw2Nyw3NCwz
My44NTk5NDcsMTM3MyxObyx5LCxuLDYNCjc0OSwxNC44MjY3NTI0MiwtMSxW
ZWhpY2xlLDM1NS4wMjcyLDUzLDU3LDU1LDE0LjY5OTg2MzIsODAyLE5vLHks
LG4sNg0KNzQ5LDE1LjQ1NDE0NjE1LDIsVmVoaWNsZSw2NDksNzksNjcsNzMs
MjEuMjAwNTQ2NCw4NzEsTm8seSwsbiw2DQo3NDksMTMuNjI1MzU4MzQsNixW
ZWhpY2xlLDg3MCwxMjAsOTgsMTA5LDI0LjI1MzI0MTEsNjY4LE5vLHksLG4s
Ng0KNzQ5LDE0LjkwODExMjc3LDksVmVoaWNsZSw4MDUsOTksNjAsNzkuNSwy
MS4wNDgyMjgzLDc5NCxZZXMseSwsbiw2DQo3NTMsMTIuMzk2NjYxMDQsLTEs
QSwzNjguOTc5Njk1NSw3OSw1MCw2NC41LDE3LjQyNTI1NzMsODExLE5vLHks
LG4sNg0KNzUzLDYuNjU5NjY0Mjc1LDIsQSw0NjMsNzIsMzgsNTUsOC4zMzU0
OTk3LDQ1NSxObyx5LCxuLDYNCjc1Myw2LjE2MDIxMjg3Myw2LEEsMTQ0LDcx
LDQwLDU1LjUsOS42NjEwMzM4LDUyMixObyx5LCxuLDYNCjc1MywxMC43Mzk5
NjQyNSw5LEEsNTYsNDcsNDIsNDQuNSwxMi45NDc3MDUxLDg3MyxZZXMseSws
biw2DQo3NTMsMjEuNDY5NTI0MzgsMTMsQSwxMzMsMTA2LDY0LDg1LDUwLjEx
ODY1NDMsMTc2OSxObyx5LCxuLDYNCjc2MSw5LjU2NTcwNjQ5LC0xLFZlaGlj
bGUsNTMzLjIxMzY0NDUsODUsNTcsNzEsMTMuODMyOTQ5OSw1ODUsTm8seSws
biw2DQo3NjEsNS40OTQ1NTEwNjUsMixWZWhpY2xlLDY5MSw3NCw0MSw1Ny41
LDE3LjExMzI4ODUsODkzLE5vLHksLG4sNg0KNzYxLDkuNDY5NjM4ODI1LDYs
VmVoaWNsZSw5ODcsMTYwLDc5LDExOS41LDI4LjU4MjgwODEsNzE4LE5vLHks
LG4sNg0KNzY4LDkuMDQ1NDc2Njc1LC0xLFZlaGljbGUsMzc4LjI0MTIzNSwx
MjUsODEsMTAzLDIyLjEwMTQ1NjMsNjQ0LE5vLHksLG4sNg0KNzY4LDEzLjUz
NjM1MzgzLDIsVmVoaWNsZSw1NDUsNzgsNjAsNjksMjEuMDc0MjI1Nyw5MTYs
Tm8seSwsbiw2DQo3NjgsMTQuMDc5OTgyNTIsNixWZWhpY2xlLDgwNiwxMDEs
NzYsODguNSwyOC41MzA4MTMzLDk2NyxObyx5LCxuLDYNCjc2OCw4LjMyOTI3
OTA2OCw5LFZlaGljbGUsNzMwLDU2LDAsMjgsNS45MjAwNzQ2LDYzNCxZZXMs
eSwsbiw2DQo3NzEsOS43OTYyOTE4MjUsLTEsVmVoaWNsZSwzNjAuOTMwODE2
LDYyLDQ0LDUzLDExLjQ2NjE4NjYsNjQ5LE5vLHksLG4sNg0KNzcxLDEwLjY4
MjQ2NTc5LDIsVmVoaWNsZSw0NjIsOTQsNDcsNzAuNSwxOC43MTY0NjE1LDc5
NyxObyx5LCxuLDYNCjc3MSwxMS40MTMwNjMwNSw2LFZlaGljbGUsNjI0LDEy
Miw3Nyw5OS41LDI2LjA3NTM5MjIsNzg2LE5vLHksLG4sNg0KNzcxLDExLjAz
NTE5ODY5LDksVmVoaWNsZSw1NjksNzgsNDQsNjEsMTUuOTg0NDAxNCw3ODYs
WWVzLHksLG4sNg0KNzcyLDEwLjE0MTI0NjMyLC0xLEEsMzA2LjMyOTA4OCw3
OCw0Miw2MCwxMy41NzgzMDg3LDY3OSxObyx5LCxuLDYNCjc3Miw0Ljc2NTQ0
OTE2NSwyLEEsNDY0LDkwLDM0LDYyLDcuNjcyNTY2LDM3MSxObyx5LCxuLDYN
Cjc3MiwzLjAwMzQwOTg2Myw2LEEsMTUyLDY2LDQzLDU0LjUsNy4yNDM5NDIy
LDM5OSxObyx5LCxuLDYNCjc3MiwxMC42NDgyMTYwMSw5LEEsMjE0LDY0LDM5
LDUxLjUsMTcuODQzODgyMSwxMDQwLFllcyx5LCxuLDYNCjc3MiwxMS4yOTU4
MTY0MiwxMyxBLDY0MiwxMjAsNjAsOTAsMjkuMjIxMDc3Niw5NzQsTm8seSws
biw2DQo3ODgsNy4wMTk0NTIyMTMsLTEsVmVoaWNsZSwzNjMuNzY3NzY4LDcy
LDU0LDYzLDkuODEyMDE4Nyw0NjcsTm8seSwsbiw2DQo3ODgsOC42NTM4OTU4
NTMsMixWZWhpY2xlLDYxMCw5OCw1NCw3NiwxNi42ODE2NjUsNjU5LE5vLHks
LG4sNg0KNzg4LDExLjU1NzI3ODE2LDYsVmVoaWNsZSw1NjYsMTk3LDE4OSwx
OTMsNDUuNjY5MDk5Myw3MTAsTm8seSwsbiw2DQo3OTksMTAuNzQ1NTMxMzIs
LTEsQSwzNTMuMTk2OTI0NSw4MCw3Niw3OCwxNC44Njc1MTMxLDU3MixObyx5
LCxuLDYNCjc5OSw1Ljc2NjQ5NjMwMywyLEEsNDAxLDc5LDM2LDU3LjUsNy42
MjU5MDQsMzk4LE5vLHksLG4sNg0KNzk5LDUuNjkyMDE4ODY1LDYsQSwxMTcs
NzgsMzIsNTUsNy44NzMyMTI2LDQyOSxObyx5LCxuLDYNCjc5OSw4Ljg2MDIz
OTk4Myw5LEEsNzMsOTYsNTAsNzMsMTcuMDU1NjI3Niw3MDEsWWVzLHksLG4s
Ng0KNzk5LDEwLjU4ODQ4NjQzLDEzLEEsMjA1LDEwOCw3Niw5MiwyMy40MTcz
MjQ3LDc2NCxObyx5LCxuLDYNCg==

--0-1806400484-1205889303=:37828
Content-Type: text/plain; name="test.R"
Content-Description: 2319129426-test.R
Content-Disposition: inline; filename="test.R"



filename<-file.choose()


dat<-read.csv(filename)
names(dat)<-c("tag","suv","timep","tx","tv","preg","postg","meang","mr","ki","hfd","fast","bw","dm","td")
dat<-dat[,1:15]

--0-1806400484-1205889303=:37828--


From ripley at stats.ox.ac.uk  Wed Mar 19 13:38:11 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 19 Mar 2008 12:38:11 +0000 (GMT)
Subject: [Rd] 'merge' function: behavior w.r.t. NAs in the key column
In-Reply-To: <Pine.GSO.4.56.0803141649050.1946@devsun3201.insightful.com>
References: <47DAB2F6.3050002@ebi.ac.uk>
	<Pine.GSO.4.56.0803141649050.1946@devsun3201.insightful.com>
Message-ID: <alpine.LFD.1.00.0803191225040.23625@gannet.stats.ox.ac.uk>

merge() in R behaves in exactly the same way as match() (which it uses), 
and not as Mr Anders claims is 'the convention'.  (Note that == and match 
are not the same concept, nor is 'identical'.)

This was discussed at length for match() some years ago (AFAIR when NA 
xharacter strings were formalized), and documented.  Hopefully merge() in 
S-PLUS does the same as its match().

I'll add an explicit link to help those who don't believe that 'match' is 
a documented concept.


On Fri, 14 Mar 2008, Bill Dunlap wrote:

> On Fri, 14 Mar 2008, Simon Anders wrote:
>
>> I recently ran into a problem with 'merge' that stems from the way how
>> missing values in the key column (i.e., the column specified
>> in the "by" argument) are handled. I wonder whether the current behavior
>> is fully consistent.
>> ...
>>> x <- data.frame( key = c(1:3,3,NA,NA), val = 10+1:6 )
>>> y <- data.frame( key = c(NA,2:5,3,NA), val = 20+1:7 )
>> ...
>>> merge( x, y, by="key" )
>>    key val.x val.y
>> 1   2    12    22
>> 2   3    13    23
>> 3   3    13    26
>> 4   3    14    23
>> 5   3    14    26
>> 6  NA    15    21
>> 7  NA    15    27
>> 8  NA    16    21
>> 9  NA    16    27
>>
>> As one should expect, there are now four lines with key value '3',
>> because the key '3' appears twice both in x and in y. According to the
>> logic of merge, a row should be produced in the output for each pairing
>> of a row from x and a row from y where the values of 'key' are equal.
>>
>> However, the 'NA' values are treated exactly the same way. It seems that
>> 'merge' considers the pairing of lines with 'NA' in both 'key' columns
>> an allowed match. IMHO, this runs against the convention that two NAs
>> are not considered equal. ('NA==NA' does not evaluate to 'TRUE'.)
>>
>> Is might be more consistent if merge did not include any rows into the
>> output with an "NA" in the key column.
>>
>> Maybe, one could add a flag argument to 'merge' to switch between this
>> behaviour and the current one? A note in the help page might be nice, too.
>
> Splus (versions 8.0, 7.0, and 6.2) gives:
>   > merge( x, y, by="key" )
>     key val.x val.y
>   1   2    12    22
>   2   3    13    23
>   3   3    14    23
>   4   3    13    26
>   5   3    14    26
> Is that what you expect?  There is no argument
> to Splus's merge to make it include the NA's
> in the way R's merge does.  Should there be such
> an argument?
>
> ----------------------------------------------------------------------------
> Bill Dunlap
> Insightful Corporation
> bill at insightful dot com
>
> "All statements in this message represent the opinions of the author and do
> not necessarily reflect Insightful Corporation policy or position."
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From andy_liaw at merck.com  Wed Mar 19 14:46:22 2008
From: andy_liaw at merck.com (Liaw, Andy)
Date: Wed, 19 Mar 2008 09:46:22 -0400
Subject: [Rd] how to exclude terms preceded by - from model frame
Message-ID: <39B6DDB9048D0F4DAD42CB26AAFF0AFA056BA9F7@usctmx1106.merck.com>

[I believe few users manipulate formulae and model frames like this, so
I'm posting here instead of R-help.]

I just found out that model.frame() includes all terms, including those
preceded by "-" in the formula, in its output (as mentioned on its help
page).  Is there a recommended way of excluding "negative" terms?  My
guess is that I can use info in the terms attribute to figure this out,
but that doesn't seem very straightforward.  Any pointer would be much
appreciated.

Best,
Andy

Andy Liaw, PhD
Biometrics Research    PO Box 2000 RY33-300
Merck Research Labs        Rahway, NJ 07065
andy_liaw(a)merck.com          732-594-0820



------------------------------------------------------------------------------
Notice:  This e-mail message, together with any attachme...{{dropped:15}}


From tchiang at fhcrc.org  Wed Mar 19 15:05:23 2008
From: tchiang at fhcrc.org (Tony Chiang)
Date: Wed, 19 Mar 2008 14:05:23 +0000
Subject: [Rd] Error in code2LazyLoadDB
Message-ID: <52f663c40803190705j736e795ck15f01e90a4e867f4@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20080319/d299e7af/attachment.pl 

From ripley at stats.ox.ac.uk  Wed Mar 19 15:40:23 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 19 Mar 2008 14:40:23 +0000 (GMT)
Subject: [Rd] Error in code2LazyLoadDB
In-Reply-To: <52f663c40803190705j736e795ck15f01e90a4e867f4@mail.gmail.com>
References: <52f663c40803190705j736e795ck15f01e90a4e867f4@mail.gmail.com>
Message-ID: <alpine.LFD.1.00.0803191435290.5404@gannet.stats.ox.ac.uk>

It means that when trying to prepare this "anonymous" package (ppiStats?) 
for lazy loading, it is already loaded.

Most likely you have a dependency cycle amongst the namespaces.

The ppiStats on BioC 2.2 has a very long list of dependencies, but does 
load under R-devel.

On Wed, 19 Mar 2008, Tony Chiang wrote:

> Hi all,
>
> While the package with which I am working is apart of the Bioconductor
> project, I think that this might be a better forum to ask my question. I
> have recently updated one of my packages, and then tried to build it using
> R-devel, but I get the following error message:
>
> ################
> -----snip----
> Loading required package: lattice
> Loading required package: RColorBrewer
> Error in code2LazyLoadDB(package, lib.loc = lib.loc, keep.source =
> keep.source,  :
>  name space must not be loaded.
> Calls: <Anonymous> -> code2LazyLoadDB
> Execution halted
> ERROR: lazy loading failed for package 'ppiStats'
>
>
>> sessionInfo()
> R version 2.7.0 Under development (unstable) (2008-02-10 r44415)
> i386-apple-darwin8.11.1
>
> locale:
> C
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
> ##################
>
> I can build the package with R 2.6.2 Patched and also install. The error
> message is not too helpful to let me figure out what is happening, but the
> only obvious thing that I can see is that my RColorBrewer packages are
> different for R patched (RColorBrewer_1.0-1) and R devel
> (RColorBrewer_1.0-2).  Does anyone have any suggestions or ideas on how to
> fix this ?
>
> Best,
> --Tony
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Wed Mar 19 15:42:40 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 19 Mar 2008 14:42:40 +0000 (GMT)
Subject: [Rd] how to exclude terms preceded by - from model frame
In-Reply-To: <39B6DDB9048D0F4DAD42CB26AAFF0AFA056BA9F7@usctmx1106.merck.com>
References: <39B6DDB9048D0F4DAD42CB26AAFF0AFA056BA9F7@usctmx1106.merck.com>
Message-ID: <alpine.LFD.1.00.0803191440530.5404@gannet.stats.ox.ac.uk>

On Wed, 19 Mar 2008, Liaw, Andy wrote:

> [I believe few users manipulate formulae and model frames like this, so
> I'm posting here instead of R-help.]
>
> I just found out that model.frame() includes all terms, including those
> preceded by "-" in the formula, in its output (as mentioned on its help
> page).  Is there a recommended way of excluding "negative" terms?  My
> guess is that I can use info in the terms attribute to figure this out,
> but that doesn't seem very straightforward.  Any pointer would be much
> appreciated.

?terms.formula, argument 'simplify', if I understand you aright.


>
> Best,
> Andy
>
> Andy Liaw, PhD
> Biometrics Research    PO Box 2000 RY33-300
> Merck Research Labs        Rahway, NJ 07065
> andy_liaw(a)merck.com          732-594-0820


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From jerry.lewis at biogenidec.com  Wed Mar 19 14:25:33 2008
From: jerry.lewis at biogenidec.com (jerry.lewis at biogenidec.com)
Date: Wed, 19 Mar 2008 14:25:33 +0100 (CET)
Subject: [Rd] choose incorrect for fractional and some negative integer
	values (PR#10766)
Message-ID: <20080319132533.E961D282EFF6@mail.pubhealth.ku.dk>

choose(-5,-7) uses integer arguments (as specified in Help)  and returns a 
numeric value that is incorrect.  Either the function or the documentation 
should be fixed.  If the function is not fixed, a warning or an error 
would be helpful.

The fact that choose(n,k) usually returns choose(n,round(k,0)) is not 
obvious from either the output or the documentation.  I suggest issuing a 
warning when k is not an integer; a user might easily expect that choose 
would coerce both arguments to integers, but only coercing k to an integer 
is unusual and potentially misleading.

The fact that choose(n,k) always rounds .5 up in k (contrary to the round 
function documentation) is nowhere documented.

Help for coerce would lead a reader to expect k to be truncated toward 
zero (as.integer), instead of rounding it.

Jerry
	[[alternative HTML version deleted]]


From prokaj at cs.elte.hu  Wed Mar 19 15:50:04 2008
From: prokaj at cs.elte.hu (prokaj at cs.elte.hu)
Date: Wed, 19 Mar 2008 15:50:04 +0100 (CET)
Subject: [Rd] pdf device problem (PR#10995)
Message-ID: <20080319145004.72996282EFF6@mail.pubhealth.ku.dk>

Full_Name: Vilmos Prokaj
Version: 2.6.2
OS: windows
Submission from: (NULL) (157.181.227.218)


I dont know wether my problem is specific to R or not. Using the pdf and
postscript device I realized that the spacing around  some accented letter
letter is not correct.
The same problem does not occur with the eps device. For testing I have used the
following simple code.

str<-"-|&#337;|-|&#336;|-|&#369;|-|&#368;|-"
pdf()
plot(0:1,0:1,main=str,sub=str,xlab=str,ylab=str)
text(0.5,0.5,str)
dev.off()


postscript()
plot(0:1,0:1,main=str,sub=str,xlab=str,ylab=str)
text(0.5,0.5,str)
dev.off()

Here str contains some hungarian umlaut. The result in the case of pdf device
looks
like as if the letters were crossing with a vertical lines. So my suspect is,
that somethings is worng in the font metrics files.

Vilmos Prokaj


From pcd at wikitex.org  Wed Mar 19 16:15:21 2008
From: pcd at wikitex.org (Peter Danenberg)
Date: Wed, 19 Mar 2008 10:15:21 -0500
Subject: [Rd] Roxygen
In-Reply-To: <f8e6ff050803181121t51bf5ed4qac2c0c67909d2494@mail.gmail.com>
References: <20080317235644.GA24414@klutometis.wikitex.org>
	<f8e6ff050803181121t51bf5ed4qac2c0c67909d2494@mail.gmail.com>
Message-ID: <20080319151521.GA15511@klutometis.wikitex.org>

> You should probably also survey existing attempts - I have written
> something with ruby that suggest some ideas.

Fascinating, Hadley; do you have a link to the source, by any chance?

I imagine doing it in Scheme, Ruby or any language, for that matter,
where creating DSLs is cheap; would be a joy.


From tchiang at fhcrc.org  Wed Mar 19 16:17:57 2008
From: tchiang at fhcrc.org (Tony Chiang)
Date: Wed, 19 Mar 2008 15:17:57 +0000
Subject: [Rd] Error in code2LazyLoadDB
In-Reply-To: <alpine.LFD.1.00.0803191435290.5404@gannet.stats.ox.ac.uk>
References: <52f663c40803190705j736e795ck15f01e90a4e867f4@mail.gmail.com>
	<alpine.LFD.1.00.0803191435290.5404@gannet.stats.ox.ac.uk>
Message-ID: <52f663c40803190817h26401ebfwa445f18339731973@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20080319/c8f71a5b/attachment.pl 

From pcd at wikitex.org  Wed Mar 19 16:18:41 2008
From: pcd at wikitex.org (Peter Danenberg)
Date: Wed, 19 Mar 2008 10:18:41 -0500
Subject: [Rd] Roxygen
In-Reply-To: <47DFD659.40506@stat.uni-muenchen.de>
References: <47DFD659.40506@stat.uni-muenchen.de>
Message-ID: <20080319151841.GB15511@klutometis.wikitex.org>

> I do not see the Roclets as mini-parsers, but as small R programs
> working on the parse tree/list returned by one big parser/lexer.

So I imagine that coming up with the intermediate parse-tree
representation would be part of the contract.

What would you think, by the way, of writing the parser in a
higher-order language; e.g. Scheme?


From ripley at stats.ox.ac.uk  Wed Mar 19 16:27:12 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 19 Mar 2008 15:27:12 +0000 (GMT)
Subject: [Rd] pdf device problem (PR#10995)
In-Reply-To: <20080319145004.72996282EFF6@mail.pubhealth.ku.dk>
References: <20080319145004.72996282EFF6@mail.pubhealth.ku.dk>
Message-ID: <alpine.LFD.1.00.0803191525320.9859@gannet.stats.ox.ac.uk>

On Wed, 19 Mar 2008, prokaj at cs.elte.hu wrote:

> Full_Name: Vilmos Prokaj
> Version: 2.6.2
> OS: windows
> Submission from: (NULL) (157.181.227.218)
>
>
> I dont know wether my problem is specific to R or not. Using the pdf and
> postscript device I realized that the spacing around  some accented letter
> letter is not correct.
> The same problem does not occur with the eps device. For testing I have used the
> following simple code.
>
> str<-"-|&#337;|-|&#336;|-|&#369;|-|&#368;|-"

And what is that is a reproducible form, in what locale?

> pdf()
> plot(0:1,0:1,main=str,sub=str,xlab=str,ylab=str)
> text(0.5,0.5,str)
> dev.off()
>
>
> postscript()
> plot(0:1,0:1,main=str,sub=str,xlab=str,ylab=str)
> text(0.5,0.5,str)
> dev.off()
>
> Here str contains some hungarian umlaut. The result in the case of pdf device
> looks
> like as if the letters were crossing with a vertical lines. So my suspect is,
> that somethings is worng in the font metrics files.

What viewer are you using?

Hint: Acrobat does not use the specified fonts unless embedded -- see ?pdf

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From khansen at stat.Berkeley.EDU  Wed Mar 19 16:33:35 2008
From: khansen at stat.Berkeley.EDU (Kasper Daniel Hansen)
Date: Wed, 19 Mar 2008 08:33:35 -0700
Subject: [Rd] Roxygen
In-Reply-To: <20080319151521.GA15511@klutometis.wikitex.org>
References: <20080317235644.GA24414@klutometis.wikitex.org>
	<f8e6ff050803181121t51bf5ed4qac2c0c67909d2494@mail.gmail.com>
	<20080319151521.GA15511@klutometis.wikitex.org>
Message-ID: <209D89F4-DBAC-46D3-B034-E3CE9E14DFA0@stat.berkeley.edu>

You might also want to look at the Rdoc setup in the R.oo package.  
While my 30 secs glance at Roxygen suggests that it is a more flexible  
system, Rdoc always you to keep the help inside the function source  
file.

Kasper

On Mar 19, 2008, at 8:15 AM, Peter Danenberg wrote:

>> You should probably also survey existing attempts - I have written
>> something with ruby that suggest some ideas.
>
> Fascinating, Hadley; do you have a link to the source, by any chance?
>
> I imagine doing it in Scheme, Ruby or any language, for that matter,
> where creating DSLs is cheap; would be a joy.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From bill at insightful.com  Wed Mar 19 18:01:27 2008
From: bill at insightful.com (Bill Dunlap)
Date: Wed, 19 Mar 2008 10:01:27 -0700 (PDT)
Subject: [Rd] 'merge' function: behavior w.r.t. NAs in the key column
In-Reply-To: <alpine.LFD.1.00.0803191225040.23625@gannet.stats.ox.ac.uk>
References: <47DAB2F6.3050002@ebi.ac.uk>
	<Pine.GSO.4.56.0803141649050.1946@devsun3201.insightful.com>
	<alpine.LFD.1.00.0803191225040.23625@gannet.stats.ox.ac.uk>
Message-ID: <Pine.GSO.4.56.0803190943180.29942@devsun3201.insightful.com>

On Wed, 19 Mar 2008, Prof Brian Ripley wrote:

> merge() in R behaves in exactly the same way as match() (which it uses),
> and not as Mr Anders claims is 'the convention'.  (Note that == and match
> are not the same concept, nor is 'identical'.)

Splus's merge works more like x.key==y.key (or match(incomparables=NA)):
rows with NA's in the key columns are not included in the output.
I am not familiar with how 'conventional' databases deal with missing
entries in join keys.  Should we each add an argument to tell how
to deal with such rows?

This was discussed at length for match() some years ago (AFAIR when NA
character strings were formalized), and documented.  Hopefully merge() in
S-PLUS does the same as its match().

   RS> x<-data.frame(k1=c(NA,NA,3,4,5),k2=c(1,NA,NA,4,5),data=1:5)
   RS> y<-data.frame(k1=c(NA,2,NA,4,5),k2=c(NA,NA,3,4,5),data=1:5)
   RS> merge(x,y,by=c("k1","k2"))
   Splus:   k1 k2 data.x data.y
   Splus: 1  4  4      4      4
   Splus: 2  5  5      5      5
   R    :   k1 k2 data.x data.y
   R    : 1  4  4      4      4
   R    : 2  5  5      5      5
   R    : 3 NA NA      2      1
   RS> merge(x,y,by=c("k1"))
   Splus:   k1 k2.x data.x k2.y data.y
   Splus: 1  4    4      4    4      4
   Splus: 2  5    5      5    5      5
   R    :   k1 k2.x data.x k2.y data.y
   R    : 1  4    4      4    4      4
   R    : 2  5    5      5    5      5
   R    : 3 NA    1      1   NA      1
   R    : 4 NA    1      1    3      3
   R    : 5 NA   NA      2   NA      1
   R    : 6 NA   NA      2    3      3
   RS> merge(x,y,by=c("k2"))
   Splus:   k2 k1.x data.x k1.y data.y
   Splus: 1  4    4      4    4      4
   Splus: 2  5    5      5    5      5
   R    :   k2 k1.x data.x k1.y data.y
   R    : 1  4    4      4    4      4
   R    : 2  5    5      5    5      5
   R    : 3 NA   NA      2   NA      1
   R    : 4 NA   NA      2    2      2
   R    : 5 NA    3      3   NA      1
   R    : 6 NA    3      3    2      2

> I'll add an explicit link to help those who don't believe that 'match' is
> a documented concept.
>
>
> On Fri, 14 Mar 2008, Bill Dunlap wrote:
>
> > On Fri, 14 Mar 2008, Simon Anders wrote:
> >
> >> I recently ran into a problem with 'merge' that stems from the way how
> >> missing values in the key column (i.e., the column specified
> >> in the "by" argument) are handled. I wonder whether the current behavior
> >> is fully consistent.
> >> ...
> >>> x <- data.frame( key = c(1:3,3,NA,NA), val = 10+1:6 )
> >>> y <- data.frame( key = c(NA,2:5,3,NA), val = 20+1:7 )
> >> ...
> >>> merge( x, y, by="key" )
> >>    key val.x val.y
> >> 1   2    12    22
> >> 2   3    13    23
> >> 3   3    13    26
> >> 4   3    14    23
> >> 5   3    14    26
> >> 6  NA    15    21
> >> 7  NA    15    27
> >> 8  NA    16    21
> >> 9  NA    16    27
> >>
> >> As one should expect, there are now four lines with key value '3',
> >> because the key '3' appears twice both in x and in y. According to the
> >> logic of merge, a row should be produced in the output for each pairing
> >> of a row from x and a row from y where the values of 'key' are equal.
> >>
> >> However, the 'NA' values are treated exactly the same way. It seems that
> >> 'merge' considers the pairing of lines with 'NA' in both 'key' columns
> >> an allowed match. IMHO, this runs against the convention that two NAs
> >> are not considered equal. ('NA==NA' does not evaluate to 'TRUE'.)
> >>
> >> Is might be more consistent if merge did not include any rows into the
> >> output with an "NA" in the key column.
> >>
> >> Maybe, one could add a flag argument to 'merge' to switch between this
> >> behaviour and the current one? A note in the help page might be nice, too.
> >
> > Splus (versions 8.0, 7.0, and 6.2) gives:
> >   > merge( x, y, by="key" )
> >     key val.x val.y
> >   1   2    12    22
> >   2   3    13    23
> >   3   3    14    23
> >   4   3    13    26
> >   5   3    14    26
> > Is that what you expect?  There is no argument
> > to Splus's merge to make it include the NA's
> > in the way R's merge does.  Should there be such
> > an argument?
> >
> > ----------------------------------------------------------------------------
> > Bill Dunlap
> > Insightful Corporation
> > bill at insightful dot com
> >
> > "All statements in this message represent the opinions of the author and do
> > not necessarily reflect Insightful Corporation policy or position."
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >
>
> --
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>

----------------------------------------------------------------------------
Bill Dunlap
Insightful Corporation
bill at insightful dot com
360-428-8146

 "All statements in this message represent the opinions of the author and do
 not necessarily reflect Insightful Corporation policy or position."


From Manuel.Eugster at stat.uni-muenchen.de  Wed Mar 19 18:29:02 2008
From: Manuel.Eugster at stat.uni-muenchen.de (Manuel J. A. Eugster)
Date: Wed, 19 Mar 2008 18:29:02 +0100
Subject: [Rd] Roxygen
In-Reply-To: <20080319151841.GB15511@klutometis.wikitex.org>
References: <47DFD659.40506@stat.uni-muenchen.de>
	<20080319151841.GB15511@klutometis.wikitex.org>
Message-ID: <47E14D5E.7090105@stat.uni-muenchen.de>

Hey Peter,

>> I do not see the Roclets as mini-parsers, but as small R programs
>> working on the parse tree/list returned by one big parser/lexer.
> 
> So I imagine that coming up with the intermediate parse-tree
> representation would be part of the contract.

Yes, sure.


> What would you think, by the way, of writing the parser in a
> higher-order language; e.g. Scheme?

No, we want a solution in R. I know that there are lots of other
languages which are more suitable for writing a parser and designing
a DSL, but the advantage of a R solution is that everything is
installed and available on the system :-) No additional dependences!


Manuel.


From h.wickham at gmail.com  Wed Mar 19 21:35:45 2008
From: h.wickham at gmail.com (hadley wickham)
Date: Wed, 19 Mar 2008 21:35:45 +0100
Subject: [Rd] Roxygen
In-Reply-To: <20080319151521.GA15511@klutometis.wikitex.org>
References: <20080317235644.GA24414@klutometis.wikitex.org>
	<f8e6ff050803181121t51bf5ed4qac2c0c67909d2494@mail.gmail.com>
	<20080319151521.GA15511@klutometis.wikitex.org>
Message-ID: <f8e6ff050803191335n7edfa837l8421b05ce0e7c264@mail.gmail.com>

On Wed, Mar 19, 2008 at 4:15 PM, Peter Danenberg <pcd at wikitex.org> wrote:
> > You should probably also survey existing attempts - I have written
>  > something with ruby that suggest some ideas.
>
>  Fascinating, Hadley; do you have a link to the source, by any chance?

It's completely local.  I'll send you a copy off list.

Hadley



-- 
http://had.co.nz/


From bolker at ufl.edu  Wed Mar 19 23:15:27 2008
From: bolker at ufl.edu (Ben Bolker)
Date: Wed, 19 Mar 2008 22:15:27 +0000 (UTC)
Subject: [Rd]
	=?utf-8?q?choose_incorrect_for_fractional_and_some_negative_?=
	=?utf-8?q?integer=09values_=28PR=2310766=29?=
References: <20080319132533.E961D282EFF6@mail.pubhealth.ku.dk>
Message-ID: <loom.20080319T220841-857@post.gmane.org>

 <jerry.lewis <at> biogenidec.com> writes:

> 
> choose(-5,-7) uses integer arguments (as specified in Help)  and returns a 
> numeric value that is incorrect.  Either the function or the documentation 
> should be fixed.  If the function is not fixed, a warning or an error 
> would be helpful.
> 
> The fact that choose(n,k) usually returns choose(n,round(k,0)) is not 
> obvious from either the output or the documentation.  I suggest issuing a 
> warning when k is not an integer; a user might easily expect that choose 
> would coerce both arguments to integers, but only coercing k to an integer 
> is unusual and potentially misleading.

  Although perhaps (?) expected from a close reading of the documentation, which
says that n is real and k must be integer ...

> 
> The fact that choose(n,k) always rounds .5 up in k (contrary to the round 
> function documentation) is nowhere documented.
> 
> Help for coerce would lead a reader to expect k to be truncated toward 
> zero (as.integer), instead of rounding it.
> 

   Not being an R-core member I can't say it would be accepted, but since your
arguments seem to make sense it would be helpful if you could provide patches to
implement your suggested changes -- and perhaps a set of test code to
demonstrate the range of behaviors you are proposing.  

   The rounding behavior (   return R_IS_INT(n) ? floor(r + 0.5) : r; in C code)
is commented as "/* might have got rounding errors */", so I think it's intended
as a way to get the desired answer when a little bit of numeric fuzz is present
-- but I agree it seems like overkill.  I don't know whether R-core members have
on the top of their heads the standard ways of dealing with this situation ...

  Ben Bolker


From pcd at wikitex.org  Thu Mar 20 01:25:26 2008
From: pcd at wikitex.org (Peter Danenberg)
Date: Wed, 19 Mar 2008 19:25:26 -0500
Subject: [Rd] Roxygen
In-Reply-To: <47DFD659.40506@stat.uni-muenchen.de>
References: <47DFD659.40506@stat.uni-muenchen.de>
Message-ID: <20080320002526.GA20903@klutometis.wikitex.org>

> It is desirable that these tags and their syntax and semantics be
> compatible with those used by Doxygen and Javadoc, but extended with
> tags important for R specific things.

Doxygen, in particular, has some tags that are meaningless in R
(@category and @protocol come to mind); wouldn't it be worthwhile,
therefore, to start with a subset of Rd?

Thinks like @name and @format could be gleaned from the code; and it
seems like preserving other Rd names would uphold the "principle of
least surprise."


From pcd at wikitex.org  Thu Mar 20 02:51:00 2008
From: pcd at wikitex.org (Peter Danenberg)
Date: Wed, 19 Mar 2008 20:51:00 -0500
Subject: [Rd] Roxygen
In-Reply-To: <209D89F4-DBAC-46D3-B034-E3CE9E14DFA0@stat.berkeley.edu>
References: <20080317235644.GA24414@klutometis.wikitex.org>
	<f8e6ff050803181121t51bf5ed4qac2c0c67909d2494@mail.gmail.com>
	<20080319151521.GA15511@klutometis.wikitex.org>
	<209D89F4-DBAC-46D3-B034-E3CE9E14DFA0@stat.berkeley.edu>
Message-ID: <20080320015100.GA21875@klutometis.wikitex.org>

> You might also want to look at the Rdoc setup in the R.oo package.

Hmm; Rdoc seems thorough enough. What remains to be desired?


From Manuel.Eugster at stat.uni-muenchen.de  Thu Mar 20 08:12:32 2008
From: Manuel.Eugster at stat.uni-muenchen.de (Manuel.Eugster at stat.uni-muenchen.de)
Date: Thu, 20 Mar 2008 08:12:32 +0100 (CET)
Subject: [Rd] Roxygen
In-Reply-To: <20080320002526.GA20903@klutometis.wikitex.org>
References: <47DFD659.40506@stat.uni-muenchen.de>
	<20080320002526.GA20903@klutometis.wikitex.org>
Message-ID: <1505.194.208.139.117.1205997152.squirrel@webmail.lrz-muenchen.de>

>> It is desirable that these tags and their syntax and semantics be
>> compatible with those used by Doxygen and Javadoc, but extended with
>> tags important for R specific things.
>
> Doxygen, in particular, has some tags that are meaningless in R
> (@category and @protocol come to mind); wouldn't it be worthwhile,
> therefore, to start with a subset of Rd?
>
> Thinks like @name and @format could be gleaned from the code; and it
> seems like preserving other Rd names would uphold the "principle of
> least surprise."
>

Yes, actually I did not meant that you have to take the union of Javadoc
and Doxygen keywords and try to fit it into R. Start with the things
from R documentation, extend it with usefull R-specific keywords (like
@export). And keep in mind that there may be users which use Doxygen
and Javadoc and we want to uphold the "principle of least surprise". :-)


Manuel.


From detlef.steuer at hsu-hamburg.de  Thu Mar 20 10:33:42 2008
From: detlef.steuer at hsu-hamburg.de (Detlef Steuer)
Date: Thu, 20 Mar 2008 10:33:42 +0100
Subject: [Rd] Problems building rpm for R-2.6.2 on Opensuse Factory
In-Reply-To: <alpine.LFD.1.00.0803171834090.1423@gannet.stats.ox.ac.uk>
References: <20080317111313.65aa0b1a@renner>
	<alpine.LFD.1.00.0803171115390.28698@gannet.stats.ox.ac.uk>
	<alpine.LFD.1.00.0803171834090.1423@gannet.stats.ox.ac.uk>
Message-ID: <20080320103342.0779f614@renner>

On Tue, 18 Mar 2008 10:30:07 +0000 (GMT)
Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:

> This is proving elusive.  The same build that gave incorrect results last 
> week gave correct results last night (and F8 has had about 50 updates 
> since, including two kernel updates).
> 
> I'd still suggest trying lower levels of optimization, as that was 
> definitely needed with some pre-releases of gcc 4.3.x.

For the record:
CFLAGS="-O" did it this time.

detlef

> 
> 
> On Mon, 17 Mar 2008, Prof Brian Ripley wrote:
> 
> > On Mon, 17 Mar 2008, Detlef Steuer wrote:
> >
> >> Hi,
> >> 
> >> make check fails in the way shown below when I try to build
> >> R-2.6.2 on OpenSuSE Factory x86_64. It builds fine on i586.
> >> (and on all older Versions of Opensuse)
> >> 
> >> Is there something I can do?
> >> Are there known problems with some gcc versions?
> >> (Factory uses 4.3.0)
> >
> > Yes.  This happened for me with (vanilla released) gcc 4.3.0 on F8 x86_64 
> > too.  Turning optimization off for both C and Fortran solved it -- I've not 
> > yet had time to track down what you need not to optimize.  I'll try to do 
> > that this evening.
> >
> > As I understand it, CRAN is successfully building R with a Debian x86_64 
> > build of gcc 4.3.0, but several packages are failing in that configuration.
> >
> >> 
> >> Output from ./configure is
> >> -------------------------------------------------------------
> >> R is now configured for x86_64-unknown-linux-gnu
> >> 
> >> Source directory: .
> >> Installation directory: /usr
> >> 
> >> C compiler: gcc -std=gnu99 -g -O2
> >> Fortran 77 compiler: gfortran -g -O2
> >> 
> >> C++ compiler: g++ -g -O2
> >> Fortran 90/95 compiler: gfortran -g -O2
> >> Obj-C compiler:
> >> 
> >> Interfaces supported: X11, tcltk
> >> External libraries: readline
> >> Additional capabilities: PNG, JPEG, iconv, MBCS, NLS
> >> Options enabled: shared R library, shared BLAS, R profiling
> >> 
> >> Recommended packages: yes
> >> -------------------------------------------------------------
> >> 
> >> It may very well be an error on the Opensuse side, but I'm  just not
> >> sure how to identify the true cause of the problem.
> >> Any help appreciated.
> >> 
> >> Detlef
> >> 
> >> -----------------------------------------------------------------
> >> Error message:
> >> 
> >> running code in 'lapack.R' ... OK
> >> comparing 'lapack.Rout' to './lapack.Rout.save' ... OK
> >> make[3]: Leaving directory `/usr/src/packages/BUILD/R-2.6.2/tests'
> >> make[2]: Leaving directory `/usr/src/packages/BUILD/R-2.6.2/tests'
> >> make[2]: Entering directory `/usr/src/packages/BUILD/R-2.6.2/tests'
> >> running regression tests
> >> make[3]: Entering directory `/usr/src/packages/BUILD/R-2.6.2/tests'
> >> running code in 'reg-tests-1.R' ... OK
> >> running code in 'reg-tests-2.R' ... OK
> >> comparing 'reg-tests-2.Rout' to './reg-tests-2.Rout.save' ...1318c1318
> >> < 0.1230 -0.7187
> >> ---
> >>> 0.1230 0.3170
> >> 1328c1328
> >> < 0.1230 -0.7187
> >> ---
> >>> 0.1230 0.3170
> >> 1356c1356
> >> < -0.2364 -0.3594
> >> ---
> >>> 0.2814 0.1585
> >> 1366c1366
> >> < 0.62010 -0.55327 -0.15379 0.02127
> >> ---
> >>> 0.49064 -0.68273 -0.02433 0.15074
> >> 1375c1375
> >> < 1.17337 0.06683 -0.15379 0.02127
> >> ---
> >>> 1.17337 -0.19209 -0.02433 0.15074
> >> make[3]: *** [reg-tests-2.Rout] Error 1
> >> make[3]: Leaving directory `/usr/src/packages/BUILD/R-2.6.2/tests'
> >> make[2]: *** [test-Reg] Error 2
> >> make[2]: Leaving directory `/usr/src/packages/BUILD/R-2.6.2/tests'
> >> make[1]: *** [test-all-basics] Error 1
> >> make[1]: Leaving directory `/usr/src/packages/BUILD/R-2.6.2/tests'
> >> make: *** [check] Error 2
> >> error: Bad exit status from /var/tmp/rpm-tmp.74662 (%build)
> >> 
> >> ______________________________________________
> >> R-devel at r-project.org mailing list
> >> https://stat.ethz.ch/mailman/listinfo/r-devel
> >> 
> >
> > -- 
> > Brian D. Ripley,                  ripley at stats.ox.ac.uk
> > Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> > University of Oxford,             Tel:  +44 1865 272861 (self)
> > 1 South Parks Road,                     +44 1865 272866 (PA)
> > Oxford OX1 3TG, UK                Fax:  +44 1865 272595
> >
> 
> -- 
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From roland.boubela at gmail.com  Wed Mar 19 17:22:44 2008
From: roland.boubela at gmail.com (Roland Boubela)
Date: Wed, 19 Mar 2008 17:22:44 +0100
Subject: [Rd] R_ParseVector problem: it's cutting off after the decimal point
Message-ID: <ced86deb0803190922u6c54585as2cad7fb053ba9fdf@mail.gmail.com>

Dear all,

my aim is to integrate R in an interactive visualisation software
called Bulk Analyzer developed by VrVis (http://www.vrvis.at).

the code:

SEXP e, tmp;
ParseStatus status;

PROTECT(tmp = mkString("x <- c(1.234,-3.45)"));
PrintValue(tmp);
PROTECT(e = R_ParseVector(tmp, -1, &status, R_NilValue));
PrintValue(e);
UNPROTECT(2);

produces the following output:

[1] "x <- c(1.234,-3.45)"

expression(x <- c(1, -3))


I'm using MS Visual C++. The code works fine in a small test project
with the same R startup settings (attached) as in the Bulk Analyzer
project.
Is there any setting or condition for this parser behaviour?

Kind regards,
Roland N. Boubela


> sessionInfo()
R version 2.6.2 (2008-02-08)
i386-pc-mingw32

locale:
German_Austria.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base
================================================
    // init R
    Rf_initEmbeddedR(0, NULL);

    Rstart Rp = &rp;
    R_DefParams(Rp);

    // root of the R installation
    Rp->rhome = get_R_HOME();

    // root of the users directory
    Rp->home = getRUser();

    // UImode: RGui, RTerm, LinkDLL
    Rp->CharacterMode = LinkDLL;

    // function which reads input for R from a console
    Rp->ReadConsole = myReadConsole;

    // function which writes output from R to a console
    Rp->WriteConsole = NULL;
    Rp->WriteConsoleEx = myWriteConsoleEx;

    // called during i/o, eval, graphics in ProcessEvents
    Rp->CallBack = myCallBack;

    // handles messages for the user from R
    Rp->ShowMessage = myShowconcise Message;

    // user interaction: a user is asked a question an should answer
with YesNoCancel (maybe dialog)
    Rp->YesNoCancel = myYesNoCancel;

    // on R state changed: busy(=1)/idle(=0)
    Rp->Busy = myBusy;

    Rp->home = getRUser();

    // R-Settings...
    Rp->R_Quiet        = (Rboolean)FALSE;
    Rp->R_Interactive    = (Rboolean)TRUE;
    Rp->RestoreAction    = SA_RESTORE;
    Rp->SaveAction        = SA_NOSAVE;

    // our parameters
    R_SetParams(Rp);
    R_set_command_line_arguments(0, NULL);

    GA_initapp(0, NULL);
    readconsolecfg();

    /// run_Rmainloop() starting in a different thread


From isailnski at yahoo.com  Thu Mar 20 12:03:13 2008
From: isailnski at yahoo.com (m jacobson)
Date: Thu, 20 Mar 2008 04:03:13 -0700 (PDT)
Subject: [Rd] code optimization,analysis
Message-ID: <423981.16599.qm@web37113.mail.mud.yahoo.com>

Hi,

After having used S+ in commercial setting and then R
in non-commerical (but still supporting my commercial
interests), I would like to give back, if possible.

Where I can contribute:
1.  SCAN / PREVENT Stability and Threat analysis (big
open source presence supported by coverity)
2.  Intel Threaded Building Blocks library support to
leverage multicore CPUs (plan now for 8-way)
3.  VTune analysis/cache optimization for
identification of loop unrolls, etc.

All this would be on linux (Fed8 at present), except I
do have an Intel compiler on Win if it was needed,
would need to find fortran compiler, make lots of
adjustments, I suspect.
 
I've already started on #3 and would only take on #1
if someone in the R project blessed, because David
Miller at coverity likes to support the broader
projects over lone-cowboy stuff.

P.S. What an easy build, as far as open src goes, your
build person deserves credit.  I'm currently setting
up to compare gcc to intel compiler on the R base and
rerunning the timing benchmarks.

  Thanks.

M Jacobson
http://www.ihaveyoga.com
ph. 415.515.3333



      ____________________________________________________________________________________
Be a better friend, newshound, and


From kzembowe at jhuccp.org  Thu Mar 20 20:15:08 2008
From: kzembowe at jhuccp.org (kzembowe at jhuccp.org)
Date: Thu, 20 Mar 2008 20:15:08 +0100 (CET)
Subject: [Rd] Installation error message with 2.6.2-win32 (PR#11007)
Message-ID: <20080320191508.A8854282EFF6@mail.pubhealth.ku.dk>

Full_Name: Kevin Zembower
Version: 2.6.2
OS: Windows XP Pro, ver 2002 SP2
Submission from: (NULL) (162.129.44.50)


Noticed the following errors and artifacts when trying to install R
2.6.2-win32.exe on my Windows XP Pro version 2002 Service Pack 2 workstation. I
first attempted to install it as the 'Administrator'. More than once, I got the
message, "Internal Error: Fialed to expand shell folder constant 'userdocs'".
Note that this is a networked PC at my work. I am not certain that the
Administrator has a home directory or that it is accessible. I noticed that
there was no entry for R itself in the Start->Programs->R folder, just ones for
Help and Uninstall.

Next, I tried installing the same file as a normal user on my system. I turned
off all registry entries, as I thought this was the problem the normal user
failed to install R the last time I tried this. This time, I got the error
"Setup was unable to create the directory "Y:\Start Menu\Programs\R" Error 5:
Access is denied." However, it did create Quick Launch and Desktop icons, that
seem to work correctly. R 2.6.2 seems to run correctly. As the error message
indicates, however, there is still no R entry itself in Start->Programs->R.

Please let me know if I can provide more information.

-Kevin Zembower


From marc_schwartz at comcast.net  Thu Mar 20 22:14:35 2008
From: marc_schwartz at comcast.net (Marc Schwartz)
Date: Thu, 20 Mar 2008 16:14:35 -0500
Subject: [Rd] cut.Date and cut.POSIXt problem
In-Reply-To: <47E010CD.6090200@jhsph.edu>
References: <971536df0803181004x5ebbe960q6879506089b3e428@mail.gmail.com>
	<47E010CD.6090200@jhsph.edu>
Message-ID: <47E2D3BB.2080106@comcast.net>

Hi all,

Apologies for the delay in my engaging in this thread. I was traveling 
this week.

The problem that Gabor raised was caused by the patch that I submitted 
to fix a problem with the referenced functions when using 'months' and 
'years' as the interval. The prior versions were problematic:

   https://stat.ethz.ch/pipermail/r-devel/2008-January/048004.html

The patch fixed the error, but since I used hist.Date() as the reference 
model and did not note the subtle difference in cut.Date() relative to 
specifying the breaks increment value, this functionality was lost when 
the same modification was made to the code in cut.Date().

Roger's patch helps, but does not totally remedy the situation. One also 
needs to modify the method used for specifying the max value 'end' for 
the breaks in order to include the max 'x' Date value in the result.

Hence, I am attaching proposed patches against R-devel for 
base:::dates.R and base:::datetime.R.

I am also attaching a patch for tests:::reg-tests-1.R to add a check for 
this situation to the regression tests that were also added subsequent 
to that prior set of patches that I had submitted.

If perhaps Roger and Gabor could so some testing on these patches before 
they are considered for inclusion into the R-devel tree, it would be 
helpful to check to see if I have missed something else here.

Thanks for raising this issue.

Regards,

Marc Schwartz

Roger D. Peng wrote:
> Seems changes in r44116 force the interval to be single months (or 
> years) instead of whatever the user specified.  I think the attached 
> patches correct this.
> 
> Interestingly, 'cut' and 'seq' allow for the 'breaks' specification to 
> be something like "3 months" but the documentation for 'hist' does not 
> allow for this type of specification.
> 
> -roger
> 
> Gabor Grothendieck wrote:
>> cut.Date and cut.POSIXt indicate that the breaks argument
>> can be an integer followed by a space followed by "year", etc.
>> but it seems the integer is ignored.
>>
>> For example, I assume that breaks = "3 months" is supposed
>> to cut it into quarters but, in fact, it cuts it into months as if
>> 3 had not been there.
>>
>>> d <- seq(Sys.Date(), length = 12, by = "month")
>>> cut(d, "3 months")
>>  [1] 2008-03-01 2008-04-01 2008-05-01 2008-06-01 2008-07-01 2008-08-01
>> 2008-09-01 2008-10-01 2008-11-01 2008-12-01 2009-01-01 2009-02-01
>> Levels: 2008-03-01 2008-04-01 2008-05-01 2008-06-01 2008-07-01
>> 2008-08-01 2008-09-01 2008-10-01 2008-11-01 2008-12-01 2009-01-01
>> 2009-02-01
>>> cut(as.POSIXct(d), "3 months")
>>  [1] 2008-03-01 2008-04-01 2008-05-01 2008-06-01 2008-07-01 2008-08-01
>> 2008-09-01 2008-10-01 2008-11-01 2008-12-01 2009-01-01 2009-02-01
>> Levels: 2008-03-01 2008-04-01 2008-05-01 2008-06-01 2008-07-01
>> 2008-08-01 2008-09-01 2008-10-01 2008-11-01 2008-12-01 2009-01-01
>> 2009-02-01
>>> cut(as.POSIXlt(d), "3 months")
>>  [1] 2008-03-01 2008-04-01 2008-05-01 2008-06-01 2008-07-01 2008-08-01
>> 2008-09-01 2008-10-01 2008-11-01 2008-12-01 2009-01-01 2009-02-01
>> Levels: 2008-03-01 2008-04-01 2008-05-01 2008-06-01 2008-07-01
>> 2008-08-01 2008-09-01 2008-10-01 2008-11-01 2008-12-01 2009-01-01
>> 2009-02-01
>>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: dates.R.patch
Type: text/x-patch
Size: 1082 bytes
Desc: not available
Url : https://stat.ethz.ch/pipermail/r-devel/attachments/20080320/0de154b9/attachment.bin 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: datetime.R.patch
Type: text/x-patch
Size: 1037 bytes
Desc: not available
Url : https://stat.ethz.ch/pipermail/r-devel/attachments/20080320/0de154b9/attachment-0001.bin 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: reg-tests-1.R.patch
Type: text/x-patch
Size: 1935 bytes
Desc: not available
Url : https://stat.ethz.ch/pipermail/r-devel/attachments/20080320/0de154b9/attachment-0002.bin 

From ripley at stats.ox.ac.uk  Thu Mar 20 22:37:12 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 20 Mar 2008 21:37:12 +0000 (GMT)
Subject: [Rd] R_ParseVector problem: it's cutting off after the decimal
 point
In-Reply-To: <ced86deb0803190922u6c54585as2cad7fb053ba9fdf@mail.gmail.com>
References: <ced86deb0803190922u6c54585as2cad7fb053ba9fdf@mail.gmail.com>
Message-ID: <alpine.LFD.1.00.0803202105330.4358@gannet.stats.ox.ac.uk>

There are so many things that might be going on here that I at least can't 
do more than guess pretty blindly.

First, you are assuming that this is a parser issue, but that's not proved 
by your test -- it might be a printing issue, which potentially involves 
deparsing. So I would have at least evaluated the expression and printed 
the result (via printf, not PrintValue).

I noticed that you did not check the parse status so we don't know if this 
parsed completely.

This could well be a locale issue: we don't have a complete program and 
you are in a non-English locale.  The setting of the locale category 
LC_NUMERIC does affect this, and I would not expect embedded R to work 
unless that was 'C'.

Here's a test that points to the locale issue:

> Sys.setlocale("LC_NUMERIC", "german")
[1] "German_Germany.1252"
Warning message:
In Sys.setlocale("LC_NUMERIC", "german") :
   setting 'LC_NUMERIC' may cause R to function strangely
> foo <- parse(text="x <- c(1.234,-3.45)")
> attributes(foo) <- NULL
> foo
expression(x <- c(1, -3))

So my guess it is an error in the environment you are using for embedded 
R.


On Wed, 19 Mar 2008, Roland Boubela wrote:

> Dear all,
>
> my aim is to integrate R in an interactive visualisation software
> called Bulk Analyzer developed by VrVis (http://www.vrvis.at).
>
> the code:
>
> SEXP e, tmp;
> ParseStatus status;
>
> PROTECT(tmp = mkString("x <- c(1.234,-3.45)"));
> PrintValue(tmp);
> PROTECT(e = R_ParseVector(tmp, -1, &status, R_NilValue));
> PrintValue(e);
> UNPROTECT(2);
>
> produces the following output:
>
> [1] "x <- c(1.234,-3.45)"
>
> expression(x <- c(1, -3))
>
>
> I'm using MS Visual C++. The code works fine in a small test project
> with the same R startup settings (attached) as in the Bulk Analyzer
> project.
> Is there any setting or condition for this parser behaviour?
>
> Kind regards,
> Roland N. Boubela
>
>
>> sessionInfo()
> R version 2.6.2 (2008-02-08)
> i386-pc-mingw32
>
> locale:
> German_Austria.1252
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
> ================================================
>    // init R
>    Rf_initEmbeddedR(0, NULL);
>
>    Rstart Rp = &rp;
>    R_DefParams(Rp);
>
>    // root of the R installation
>    Rp->rhome = get_R_HOME();
>
>    // root of the users directory
>    Rp->home = getRUser();
>
>    // UImode: RGui, RTerm, LinkDLL
>    Rp->CharacterMode = LinkDLL;
>
>    // function which reads input for R from a console
>    Rp->ReadConsole = myReadConsole;
>
>    // function which writes output from R to a console
>    Rp->WriteConsole = NULL;
>    Rp->WriteConsoleEx = myWriteConsoleEx;
>
>    // called during i/o, eval, graphics in ProcessEvents
>    Rp->CallBack = myCallBack;
>
>    // handles messages for the user from R
>    Rp->ShowMessage = myShowconcise Message;
>
>    // user interaction: a user is asked a question an should answer
> with YesNoCancel (maybe dialog)
>    Rp->YesNoCancel = myYesNoCancel;
>
>    // on R state changed: busy(=1)/idle(=0)
>    Rp->Busy = myBusy;
>
>    Rp->home = getRUser();
>
>    // R-Settings...
>    Rp->R_Quiet        = (Rboolean)FALSE;
>    Rp->R_Interactive    = (Rboolean)TRUE;
>    Rp->RestoreAction    = SA_RESTORE;
>    Rp->SaveAction        = SA_NOSAVE;
>
>    // our parameters
>    R_SetParams(Rp);
>    R_set_command_line_arguments(0, NULL);
>
>    GA_initapp(0, NULL);
>    readconsolecfg();
>
>    /// run_Rmainloop() starting in a different thread
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From murdoch at stats.uwo.ca  Fri Mar 21 01:22:58 2008
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Thu, 20 Mar 2008 20:22:58 -0400
Subject: [Rd] code optimization,analysis
In-Reply-To: <423981.16599.qm@web37113.mail.mud.yahoo.com>
References: <423981.16599.qm@web37113.mail.mud.yahoo.com>
Message-ID: <47E2FFE2.9000008@stats.uwo.ca>

On 20/03/2008 7:03 AM, m jacobson wrote:
> Hi,
> 
> After having used S+ in commercial setting and then R
> in non-commerical (but still supporting my commercial
> interests), I would like to give back, if possible.
> 
> Where I can contribute:
> 1.  SCAN / PREVENT Stability and Threat analysis (big
> open source presence supported by coverity)
> 2.  Intel Threaded Building Blocks library support to
> leverage multicore CPUs (plan now for 8-way)
> 3.  VTune analysis/cache optimization for
> identification of loop unrolls, etc.
> 
> All this would be on linux (Fed8 at present), except I
> do have an Intel compiler on Win if it was needed,
> would need to find fortran compiler, make lots of
> adjustments, I suspect.
>  
> I've already started on #3 and would only take on #1
> if someone in the R project blessed, because David
> Miller at coverity likes to support the broader
> projects over lone-cowboy stuff.

You didn't mention this, but putting together (and maintaining) a tool 
chain for 64 bit Windows builds would be appreciated.

> P.S. What an easy build, as far as open src goes, your
> build person deserves credit.  I'm currently setting
> up to compare gcc to intel compiler on the R base and
> rerunning the timing benchmarks.

That's largely due to Brian Ripley's efforts, but there are many other 
contributors to it.

Duncan Murdoch


From pcd at wikitex.org  Fri Mar 21 07:09:28 2008
From: pcd at wikitex.org (Peter Danenberg)
Date: Fri, 21 Mar 2008 01:09:28 -0500
Subject: [Rd] Roxygen
In-Reply-To: <47E14D5E.7090105@stat.uni-muenchen.de>
References: <47DFD659.40506@stat.uni-muenchen.de>
	<20080319151841.GB15511@klutometis.wikitex.org>
	<47E14D5E.7090105@stat.uni-muenchen.de>
Message-ID: <20080321060928.GA1283@klutometis.wikitex.org>

> No, we want a solution in R.

Would it suffice, by the way, to source() a file and introspect upon
its objects with ls(), formals(), typeof(), mode(), and the like; or
should we formalize, say, a BNF and write the accompanying automaton?


From murdoch at stats.uwo.ca  Fri Mar 21 11:36:59 2008
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Fri, 21 Mar 2008 06:36:59 -0400
Subject: [Rd] Roxygen
In-Reply-To: <20080321060928.GA1283@klutometis.wikitex.org>
References: <47DFD659.40506@stat.uni-muenchen.de>	<20080319151841.GB15511@klutometis.wikitex.org>	<47E14D5E.7090105@stat.uni-muenchen.de>
	<20080321060928.GA1283@klutometis.wikitex.org>
Message-ID: <47E38FCB.2050104@stats.uwo.ca>

On 21/03/2008 2:09 AM, Peter Danenberg wrote:
>> No, we want a solution in R.
> 
> Would it suffice, by the way, to source() a file and introspect upon
> its objects with ls(), formals(), typeof(), mode(), and the like; or
> should we formalize, say, a BNF and write the accompanying automaton?

I don't know Manuel's intentions, but I'd say you should make use of the 
parse() function, not source.  parse() converts source into unevaluated 
expressions.  If you start writing your own parser of R code, it will be 
hard to validate, and hard to maintain, because there are occasional 
tweaks to the R definition.

parse() currently does nothing with comments, but it does tell you where 
each parsed expression came from, so your code could use that 
information to look again through the source for the bits that interest you.

Duncan Murdoch


From pcd at wikitex.org  Fri Mar 21 12:08:32 2008
From: pcd at wikitex.org (Peter Danenberg)
Date: Fri, 21 Mar 2008 06:08:32 -0500
Subject: [Rd] Roxygen
In-Reply-To: <47E38FCB.2050104@stats.uwo.ca>
References: <47DFD659.40506@stat.uni-muenchen.de>
	<20080319151841.GB15511@klutometis.wikitex.org>
	<47E14D5E.7090105@stat.uni-muenchen.de>
	<20080321060928.GA1283@klutometis.wikitex.org>
	<47E38FCB.2050104@stats.uwo.ca>
Message-ID: <20080321110832.GA4160@klutometis.wikitex.org>

> parse() currently does nothing with comments, but it does tell you
> where each parsed expression came from . . .

That's exactly what I was looking for, Duncan; thanks. In fact, I used
parse() recently to write a telnet frontend to R.


From cstrato at aon.at  Fri Mar 21 14:47:18 2008
From: cstrato at aon.at (cstrato)
Date: Fri, 21 Mar 2008 14:47:18 +0100
Subject: [Rd] Problem with Makefile.win and environment variable
Message-ID: <47E3BC66.5070906@aon.at>


Dear all,

When porting my package to WinXP I have the following problem:
I need to create an environment variable "MYVAR=c:\mypath" which I have 
saved in the control panel "System->My Computer" (under the `Advanced' tab).

I have two files which need to access MYVAR: config.win, Makefile.win

While "config.win" does recognize MYVAR correctly, "Makefile.win" is not 
able to recognize MYVAR, when I do:
"R CMD INSTALL mypkg".
I need to add the line "MYVAR=C:\\mypath" to "Makefile.win" for "R CMD 
INSTALL" to work.

Interestingly, when I "cd ./src" and call from the DOS command line:
"NMAKE /f "Makefile.win" CFG="Release"
then "Makefile.win" does recognize MYVAR correctly.

Do you know what I need to do so that "Makefile.win" recognizes MYVAR?

P.S.: If you think that this is the wrong mailing list for these type of 
questions please let me know which mailinglist I should contact.

Best regards
Christian
_._._._._._._._._._._._._._._._
C.h.i.s.t.i.a.n S.t.r.a.t.o.w.a
V.i.e.n.n.a       A.u.s.t.r.i.a
_._._._._._._._._._._._._._._._


From ripley at stats.ox.ac.uk  Fri Mar 21 15:20:33 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 21 Mar 2008 14:20:33 +0000 (GMT)
Subject: [Rd] Problem with Makefile.win and environment variable
In-Reply-To: <47E3BC66.5070906@aon.at>
References: <47E3BC66.5070906@aon.at>
Message-ID: <alpine.LFD.1.00.0803211412350.14566@gannet.stats.ox.ac.uk>

On Fri, 21 Mar 2008, cstrato wrote:

>
> Dear all,
>
> When porting my package to WinXP I have the following problem:
> I need to create an environment variable "MYVAR=c:\mypath" which I have
> saved in the control panel "System->My Computer" (under the `Advanced' tab).
>
> I have two files which need to access MYVAR: config.win, Makefile.win
>
> While "config.win" does recognize MYVAR correctly, "Makefile.win" is not
> able to recognize MYVAR, when I do:
> "R CMD INSTALL mypkg".
> I need to add the line "MYVAR=C:\\mypath" to "Makefile.win" for "R CMD
> INSTALL" to work.
>
> Interestingly, when I "cd ./src" and call from the DOS command line:
> "NMAKE /f "Makefile.win" CFG="Release"
> then "Makefile.win" does recognize MYVAR correctly.
>
> Do you know what I need to do so that "Makefile.win" recognizes MYVAR?

Well, how are you asking it to recognize it?  (We do expect you to provide 
enough details to avoid such questions.)  $(MYVAR) is a make variable, and 
${MYVAR} is an environment variable.  Quite possibly

MYVAR=${MYVAR}

is all you need to add.

BTW, there are dozens of examples in the packages on CRAN -- RGtk2 is one.
And we strongly discourage the use of Makefile.win: Makevars.win suffices 
for all but expert developers.


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From h.wickham at gmail.com  Fri Mar 21 16:29:31 2008
From: h.wickham at gmail.com (hadley wickham)
Date: Fri, 21 Mar 2008 16:29:31 +0100
Subject: [Rd] Roxygen
In-Reply-To: <47E38FCB.2050104@stats.uwo.ca>
References: <47DFD659.40506@stat.uni-muenchen.de>
	<20080319151841.GB15511@klutometis.wikitex.org>
	<47E14D5E.7090105@stat.uni-muenchen.de>
	<20080321060928.GA1283@klutometis.wikitex.org>
	<47E38FCB.2050104@stats.uwo.ca>
Message-ID: <f8e6ff050803210829l20cd5617ga57e45ef25e8b7cb@mail.gmail.com>

On Fri, Mar 21, 2008 at 11:36 AM, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
> On 21/03/2008 2:09 AM, Peter Danenberg wrote:
>  >> No, we want a solution in R.
>  >
>  > Would it suffice, by the way, to source() a file and introspect upon
>  > its objects with ls(), formals(), typeof(), mode(), and the like; or
>  > should we formalize, say, a BNF and write the accompanying automaton?
>
>  I don't know Manuel's intentions, but I'd say you should make use of the
>  parse() function, not source.  parse() converts source into unevaluated
>  expressions.  If you start writing your own parser of R code, it will be
>  hard to validate, and hard to maintain, because there are occasional
>  tweaks to the R definition.
>
>  parse() currently does nothing with comments, but it does tell you where
>  each parsed expression came from, so your code could use that
>  information to look again through the source for the bits that interest you.

But you'll still need a formal grammar for the documentation comments.
 Borrowing the basic style of javadoc should suffice, although there
are some tricky issues with line-endings etc.

Hadley

-- 
http://had.co.nz/


From cstrato at aon.at  Fri Mar 21 17:11:43 2008
From: cstrato at aon.at (cstrato)
Date: Fri, 21 Mar 2008 17:11:43 +0100
Subject: [Rd] Problem with Makefile.win and environment variable
In-Reply-To: <alpine.LFD.1.00.0803211412350.14566@gannet.stats.ox.ac.uk>
References: <47E3BC66.5070906@aon.at>
	<alpine.LFD.1.00.0803211412350.14566@gannet.stats.ox.ac.uk>
Message-ID: <47E3DE3F.7040307@aon.at>

Dear Prof. Ripley

Thank you for your fast reply and sorry for being not specific enough.

My problem is that I need to use MS VC++ for the WinXP port of my 
package (xps at BioC):

Here is my concrete problem and what I did:
- installed MS Visual Studio Express 2008
- installed binary of ROOT framework compiled with VC++ (thus the need 
for VC++)
- set ROOT environment variable: ROOTSYS=C:\root  (the default install dir)
- installed Rtools
- installed binary of R-2.6.2
- created Makefile.win for VC++ which compiles my source code and 
includes ROOT libraries
- created config.win to check for presence of VC++, ROOT, ROOTSYS

Everything works fine, I can install my package on WinXP as long as 
"Makefile.win" contains the line "ROOTSYS=C:\\root"

When I follow your suggestion "ROOTSYS=${ROOTSYS}" (which I tried 
already before) I get the following error:
  running src/Makefile.win ...
Makefile.win:64: *** Recursive variable `ROOTSYS' references itself 
(eventually).  Stop.
make[2]: *** [srcDynlib] Error 2
make[1]: *** [all] Error 2

When I try "ROOTSYSX=${ROOTSYS}" I get the usual error:
  running src/Makefile.win ...
cl /Ic:\root/include /MT /EHsc /Ox /D "MSVC" /D "WIN32" /c TMLMath.cxx
Microsoft (R) 32-bit C/C++ Optimizing Compiler Version 15.00.21022.08 
for 80x86
Copyright (C) Microsoft Corporation.  All rights reserved.
TMLMath.cxx
TMLMath.cxx(51) : fatal error C1083: Cannot open include file: 
'TMath.h': No such file or
directory
make[3]: *** [TMLMath.obj] Error 2
make[2]: *** [srcDynlib] Error 2
make[1]: *** [all] Error 2

As you see, everything works but this final problem.
I have checked the examples in  a couple of R packages, e.g. ROracle 
which also reqires VC++, but I could not find any solution to this last 
problem.
Do you have some other ideas which I could test?

Thank you.
Best regards
Christian
_._._._._._._._._._._._._._._._
C.h.i.s.t.i.a.n S.t.r.a.t.o.w.a
V.i.e.n.n.a       A.u.s.t.r.i.a
_._._._._._._._._._._._._._._._


Prof Brian Ripley wrote:
> On Fri, 21 Mar 2008, cstrato wrote:
>
>>
>> Dear all,
>>
>> When porting my package to WinXP I have the following problem:
>> I need to create an environment variable "MYVAR=c:\mypath" which I have
>> saved in the control panel "System->My Computer" (under the 
>> `Advanced' tab).
>>
>> I have two files which need to access MYVAR: config.win, Makefile.win
>>
>> While "config.win" does recognize MYVAR correctly, "Makefile.win" is not
>> able to recognize MYVAR, when I do:
>> "R CMD INSTALL mypkg".
>> I need to add the line "MYVAR=C:\\mypath" to "Makefile.win" for "R CMD
>> INSTALL" to work.
>>
>> Interestingly, when I "cd ./src" and call from the DOS command line:
>> "NMAKE /f "Makefile.win" CFG="Release"
>> then "Makefile.win" does recognize MYVAR correctly.
>>
>> Do you know what I need to do so that "Makefile.win" recognizes MYVAR?
>
> Well, how are you asking it to recognize it?  (We do expect you to 
> provide enough details to avoid such questions.)  $(MYVAR) is a make 
> variable, and ${MYVAR} is an environment variable.  Quite possibly
>
> MYVAR=${MYVAR}
>
> is all you need to add.
>
> BTW, there are dozens of examples in the packages on CRAN -- RGtk2 is 
> one.
> And we strongly discourage the use of Makefile.win: Makevars.win 
> suffices for all but expert developers.
>
>


From ripley at stats.ox.ac.uk  Fri Mar 21 17:21:17 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 21 Mar 2008 16:21:17 +0000 (GMT)
Subject: [Rd] Problem with Makefile.win and environment variable
In-Reply-To: <47E3DE3F.7040307@aon.at>
References: <47E3BC66.5070906@aon.at>
	<alpine.LFD.1.00.0803211412350.14566@gannet.stats.ox.ac.uk>
	<47E3DE3F.7040307@aon.at>
Message-ID: <alpine.LFD.1.00.0803211615130.32302@gannet.stats.ox.ac.uk>

> cl /Ic:\root/include /MT /EHsc /Ox /D "MSVC" /D "WIN32" /c TMLMath.cxx

will AFAIK not work when passed to the shell used (which is ash), and in 
any case will not work for paths with spaces in.

You still haven't shown us the Makefile.win, but probably you need

cl /I"${ROOTSYS}/include" /MT /EHsc /Ox /D MSVC /D WIN32 /c TMLMath.cxx


On Fri, 21 Mar 2008, cstrato wrote:

> Dear Prof. Ripley
>
> Thank you for your fast reply and sorry for being not specific enough.
>
> My problem is that I need to use MS VC++ for the WinXP port of my package 
> (xps at BioC):
>
> Here is my concrete problem and what I did:
> - installed MS Visual Studio Express 2008
> - installed binary of ROOT framework compiled with VC++ (thus the need for 
> VC++)
> - set ROOT environment variable: ROOTSYS=C:\root  (the default install dir)
> - installed Rtools
> - installed binary of R-2.6.2
> - created Makefile.win for VC++ which compiles my source code and includes 
> ROOT libraries
> - created config.win to check for presence of VC++, ROOT, ROOTSYS
>
> Everything works fine, I can install my package on WinXP as long as 
> "Makefile.win" contains the line "ROOTSYS=C:\\root"
>
> When I follow your suggestion "ROOTSYS=${ROOTSYS}" (which I tried already 
> before) I get the following error:
> running src/Makefile.win ...
> Makefile.win:64: *** Recursive variable `ROOTSYS' references itself 
> (eventually).  Stop.
> make[2]: *** [srcDynlib] Error 2
> make[1]: *** [all] Error 2
>
> When I try "ROOTSYSX=${ROOTSYS}" I get the usual error:
> running src/Makefile.win ...
> cl /Ic:\root/include /MT /EHsc /Ox /D "MSVC" /D "WIN32" /c TMLMath.cxx
> Microsoft (R) 32-bit C/C++ Optimizing Compiler Version 15.00.21022.08 for 
> 80x86
> Copyright (C) Microsoft Corporation.  All rights reserved.
> TMLMath.cxx
> TMLMath.cxx(51) : fatal error C1083: Cannot open include file: 'TMath.h': No 
> such file or
> directory
> make[3]: *** [TMLMath.obj] Error 2
> make[2]: *** [srcDynlib] Error 2
> make[1]: *** [all] Error 2
>
> As you see, everything works but this final problem.
> I have checked the examples in  a couple of R packages, e.g. ROracle which 
> also reqires VC++, but I could not find any solution to this last problem.
> Do you have some other ideas which I could test?
>
> Thank you.
> Best regards
> Christian
> _._._._._._._._._._._._._._._._
> C.h.i.s.t.i.a.n S.t.r.a.t.o.w.a
> V.i.e.n.n.a       A.u.s.t.r.i.a
> _._._._._._._._._._._._._._._._
>
>
> Prof Brian Ripley wrote:
>> On Fri, 21 Mar 2008, cstrato wrote:
>> 
>>> 
>>> Dear all,
>>> 
>>> When porting my package to WinXP I have the following problem:
>>> I need to create an environment variable "MYVAR=c:\mypath" which I have
>>> saved in the control panel "System->My Computer" (under the `Advanced' 
>>> tab).
>>> 
>>> I have two files which need to access MYVAR: config.win, Makefile.win
>>> 
>>> While "config.win" does recognize MYVAR correctly, "Makefile.win" is not
>>> able to recognize MYVAR, when I do:
>>> "R CMD INSTALL mypkg".
>>> I need to add the line "MYVAR=C:\\mypath" to "Makefile.win" for "R CMD
>>> INSTALL" to work.
>>> 
>>> Interestingly, when I "cd ./src" and call from the DOS command line:
>>> "NMAKE /f "Makefile.win" CFG="Release"
>>> then "Makefile.win" does recognize MYVAR correctly.
>>> 
>>> Do you know what I need to do so that "Makefile.win" recognizes MYVAR?
>> 
>> Well, how are you asking it to recognize it?  (We do expect you to provide 
>> enough details to avoid such questions.)  $(MYVAR) is a make variable, and 
>> ${MYVAR} is an environment variable.  Quite possibly
>> 
>> MYVAR=${MYVAR}
>> 
>> is all you need to add.
>> 
>> BTW, there are dozens of examples in the packages on CRAN -- RGtk2 is one.
>> And we strongly discourage the use of Makefile.win: Makevars.win suffices 
>> for all but expert developers.
>> 
>> 
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From antonio.fabio at gmail.com  Fri Mar 21 17:56:45 2008
From: antonio.fabio at gmail.com (Antonio, Fabio Di Narzo)
Date: Fri, 21 Mar 2008 17:56:45 +0100
Subject: [Rd] idea for GSoC: an R package for fitting Bayesian Hierarchical
	Models
Message-ID: <b0808fdc0803210956k5b967d6paa9e572f72482df@mail.gmail.com>

Dear R developers,
these days I'm working on some R code for fitting completely generic
Bayesian Hierarchical Models in R, a la OpenBUGS and JAGS.

A key feature of OpenBUGS and JAGS is that they automatically build an
appropriate MCMC sampler from a generic model, specified as a directed
acyclic graph (DAG).
The spirit of my (would-be) implementation is instead more focused on
experimentation and prototyping, i.e. is the user who explicitely
assign samplers for each model variable after specifying the model.
The sampler can be chosed in a set of predefined samplers, as well as
customly specified by the user as an R or C function in a very
flexible way.

Now I have a prototype scheleton implementation (a bounch of R and C
files, together with some base testing scripts) which works at decent
speed (w.r.t. JAGS) on some example models, and I'm writing a
proof-of-concept, reproducible Sweave file about it, to be published
online shortly.

What do you think about it in general?
What do you think about developing an R package of it as a GSoC project?

Best regards,
Antonio, Fabio Di Narzo.

-- 
Antonio, Fabio Di Narzo
Ph.D. student at
Department of Statistical Sciences
University of Bologna, Italy


From cstrato at aon.at  Fri Mar 21 18:41:11 2008
From: cstrato at aon.at (cstrato)
Date: Fri, 21 Mar 2008 18:41:11 +0100
Subject: [Rd] Problem with Makefile.win and environment variable
In-Reply-To: <alpine.LFD.1.00.0803211615130.32302@gannet.stats.ox.ac.uk>
References: <47E3BC66.5070906@aon.at>
	<alpine.LFD.1.00.0803211412350.14566@gannet.stats.ox.ac.uk>
	<47E3DE3F.7040307@aon.at>
	<alpine.LFD.1.00.0803211615130.32302@gannet.stats.ox.ac.uk>
Message-ID: <47E3F337.4030105@aon.at>

Dear Prof. Ripley

Here is the Makefile.win, which contains already your suggestion for 
spaces (thank you), but contains only 3 of 14 header files:

#------------------------------------------------------------------------------

ROOTSYS       = C:\\root
#ROOTSYS       = ${ROOTSYS}

LDOPT         = -opt:noref
LDFLAGS       = $(LDOPT) $(conlflags) -nologo 
-include:_G__cpp_setupG__Hist \
                -include:_G__cpp_setupG__Graf1 
-include:_G__cpp_setupG__G3D \
                -include:_G__cpp_setupG__GPad 
-include:_G__cpp_setupG__Tree \
                -include:_G__cpp_setupG__Rint 
-include:_G__cpp_setupG__PostScript \
                -include:_G__cpp_setupG__Matrix 
-include:_G__cpp_setupG__Physics
SOFLAGS       = $(dlllflags:-pdb:none=)
ROOTLIBS      = "$(ROOTSYS)/lib/libCore.lib" \
                "$(ROOTSYS)/lib/libCint.lib" "$(ROOTSYS)/lib/libHist.lib" \
                "$(ROOTSYS)/lib/libGraf.lib" 
"$(ROOTSYS)/lib/libGraf3d.lib" \
                "$(ROOTSYS)/lib/libGpad.lib" "$(ROOTSYS)/lib/libTree.lib" \
                "$(ROOTSYS)/lib/libRint.lib" 
"$(ROOTSYS)/lib/libPostscript.lib" \
                "$(ROOTSYS)/lib/libMatrix.lib" 
"$(ROOTSYS)/lib/libPhysics.lib" \
                "$(ROOTSYS)/lib/libNet.lib" "$(ROOTSYS)/lib/libRIO.lib"
LIBS          = $(ROOTLIBS)
GLIBS         = $(LIBS) "$(ROOTSYS)/lib/libGui.lib" 
"$(ROOTSYS)/lib/libGraf.lib" \
                "$(ROOTSYS)/lib/libGpad.lib"
LIBSALL       = $(ROOTLIBS)

#------------------------------------------------------------------------------

MYHDR       = TMLMath.h TStat.h StatUtils.h
MYSRC       = TMLMath.cxx TStat.cxx StatUtils.cxx
MYOBJ       = TMLMath.obj TStat.obj StatUtils.obj xpsDict.obj

xps.dll:  $(MYOBJ)
    link /dll /def:xps.def /out:xps.dll fp10.obj $(SOFLAGS) $(LDFLAGS) 
$(GLIBS) *.obj
   
TMLMath.obj: TMLMath.h TMLMath.cxx
    cl /I"$(ROOTSYS)/include" /MT /EHsc /Ox /D "MSVC" /D "WIN32" /c 
TMLMath.cxx

TStat.obj: TStat.h TStat.cxx
    cl /I"$(ROOTSYS)/include" /MT /EHsc /Ox /D "MSVC" /D "WIN32" /c 
TStat.cxx
   
StatUtils.obj: StatUtils.h StatUtils.cxx
    cl /I"$(ROOTSYS)/include" /MT /EHsc /Ox /D "MSVC" /D "WIN32" /c 
StatUtils.cxx
   
xpsDict.cxx: $(MYHDR) xpsLinkDef.h
    @echo "Generating dictionary $@..."
    @rootcint -f $@ -c $(MYHDR) xpsLinkDef.h
   
xpsDict.obj: xpsDict.cxx xpsDict.h
    cl /I"$(ROOTSYS)/include" /MT /EHsc /Ox /D "MSVC" /D "WIN32" /c 
xpsDict.cxx

clean:
    rm -f $(MYOBJ) *.a *.d *.rc

clobber:
    rm -f $(RLIB) $(MYOBJ) *.a *.d *.rc *.dll
#------------------------------------------------------------------------------

Uncommenting "ROOTSYS = ${ROOTSYS}" results still in the self-reference 
error, but it works definitely with "ROOTSYS = C:\\root".

I forgot to mention that I use the DOS command shell on WinXP to run "R 
CMD INSTALL".
Could this be the problem?

Thank you.
Best regards
Christian
_._._._._._._._._._._._._._._._
C.h.i.s.t.i.a.n S.t.r.a.t.o.w.a
V.i.e.n.n.a       A.u.s.t.r.i.a
_._._._._._._._._._._._._._._._


Prof Brian Ripley wrote:
>> cl /Ic:\root/include /MT /EHsc /Ox /D "MSVC" /D "WIN32" /c TMLMath.cxx
>
> will AFAIK not work when passed to the shell used (which is ash), and 
> in any case will not work for paths with spaces in.
>
> You still haven't shown us the Makefile.win, but probably you need
>
> cl /I"${ROOTSYS}/include" /MT /EHsc /Ox /D MSVC /D WIN32 /c TMLMath.cxx
>
>
> On Fri, 21 Mar 2008, cstrato wrote:
>
>> Dear Prof. Ripley
>>
>> Thank you for your fast reply and sorry for being not specific enough.
>>
>> My problem is that I need to use MS VC++ for the WinXP port of my 
>> package (xps at BioC):
>>
>> Here is my concrete problem and what I did:
>> - installed MS Visual Studio Express 2008
>> - installed binary of ROOT framework compiled with VC++ (thus the 
>> need for VC++)
>> - set ROOT environment variable: ROOTSYS=C:\root  (the default 
>> install dir)
>> - installed Rtools
>> - installed binary of R-2.6.2
>> - created Makefile.win for VC++ which compiles my source code and 
>> includes ROOT libraries
>> - created config.win to check for presence of VC++, ROOT, ROOTSYS
>>
>> Everything works fine, I can install my package on WinXP as long as 
>> "Makefile.win" contains the line "ROOTSYS=C:\\root"
>>
>> When I follow your suggestion "ROOTSYS=${ROOTSYS}" (which I tried 
>> already before) I get the following error:
>> running src/Makefile.win ...
>> Makefile.win:64: *** Recursive variable `ROOTSYS' references itself 
>> (eventually).  Stop.
>> make[2]: *** [srcDynlib] Error 2
>> make[1]: *** [all] Error 2
>>
>> When I try "ROOTSYSX=${ROOTSYS}" I get the usual error:
>> running src/Makefile.win ...
>> cl /Ic:\root/include /MT /EHsc /Ox /D "MSVC" /D "WIN32" /c TMLMath.cxx
>> Microsoft (R) 32-bit C/C++ Optimizing Compiler Version 15.00.21022.08 
>> for 80x86
>> Copyright (C) Microsoft Corporation.  All rights reserved.
>> TMLMath.cxx
>> TMLMath.cxx(51) : fatal error C1083: Cannot open include file: 
>> 'TMath.h': No such file or
>> directory
>> make[3]: *** [TMLMath.obj] Error 2
>> make[2]: *** [srcDynlib] Error 2
>> make[1]: *** [all] Error 2
>>
>> As you see, everything works but this final problem.
>> I have checked the examples in  a couple of R packages, e.g. ROracle 
>> which also reqires VC++, but I could not find any solution to this 
>> last problem.
>> Do you have some other ideas which I could test?
>>
>> Thank you.
>> Best regards
>> Christian
>> _._._._._._._._._._._._._._._._
>> C.h.i.s.t.i.a.n S.t.r.a.t.o.w.a
>> V.i.e.n.n.a       A.u.s.t.r.i.a
>> _._._._._._._._._._._._._._._._
>>
>>
>> Prof Brian Ripley wrote:
>>> On Fri, 21 Mar 2008, cstrato wrote:
>>>
>>>>
>>>> Dear all,
>>>>
>>>> When porting my package to WinXP I have the following problem:
>>>> I need to create an environment variable "MYVAR=c:\mypath" which I 
>>>> have
>>>> saved in the control panel "System->My Computer" (under the 
>>>> `Advanced' tab).
>>>>
>>>> I have two files which need to access MYVAR: config.win, Makefile.win
>>>>
>>>> While "config.win" does recognize MYVAR correctly, "Makefile.win" 
>>>> is not
>>>> able to recognize MYVAR, when I do:
>>>> "R CMD INSTALL mypkg".
>>>> I need to add the line "MYVAR=C:\\mypath" to "Makefile.win" for "R CMD
>>>> INSTALL" to work.
>>>>
>>>> Interestingly, when I "cd ./src" and call from the DOS command line:
>>>> "NMAKE /f "Makefile.win" CFG="Release"
>>>> then "Makefile.win" does recognize MYVAR correctly.
>>>>
>>>> Do you know what I need to do so that "Makefile.win" recognizes MYVAR?
>>>
>>> Well, how are you asking it to recognize it?  (We do expect you to 
>>> provide enough details to avoid such questions.)  $(MYVAR) is a make 
>>> variable, and ${MYVAR} is an environment variable.  Quite possibly
>>>
>>> MYVAR=${MYVAR}
>>>
>>> is all you need to add.
>>>
>>> BTW, there are dozens of examples in the packages on CRAN -- RGtk2 
>>> is one.
>>> And we strongly discourage the use of Makefile.win: Makevars.win 
>>> suffices for all but expert developers.
>>>
>>>
>>
>


From ripley at stats.ox.ac.uk  Fri Mar 21 18:55:15 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 21 Mar 2008 17:55:15 +0000 (GMT)
Subject: [Rd] Problem with Makefile.win and environment variable
In-Reply-To: <47E3F337.4030105@aon.at>
References: <47E3BC66.5070906@aon.at>
	<alpine.LFD.1.00.0803211412350.14566@gannet.stats.ox.ac.uk>
	<47E3DE3F.7040307@aon.at>
	<alpine.LFD.1.00.0803211615130.32302@gannet.stats.ox.ac.uk>
	<47E3F337.4030105@aon.at>
Message-ID: <alpine.LFD.1.00.0803211743400.10761@gannet.stats.ox.ac.uk>

You have $(ROOTSYS), not ${ROOTSYS} as I had.

Also, the output you show is missing the quotes, which is unlikely if this 
was the Makefile.win version used.

To summarize:

1) Use ${ROOTSYS} (with braces).
2) Either use forward slashes and no spaces or ensure the path is quoted 
in the cl call.

The error from the example you showed is the second.

The shell you use to can  Rcmd INSTALL is not relevant: our software 
ensures that a POSIX shell is used for the make.  (This is quite different 
from nmake.)



On Fri, 21 Mar 2008, cstrato wrote:

> Dear Prof. Ripley
>
> Here is the Makefile.win, which contains already your suggestion for spaces 
> (thank you), but contains only 3 of 14 header files:
>
> #------------------------------------------------------------------------------
>
> ROOTSYS       = C:\\root
> #ROOTSYS       = ${ROOTSYS}
>
> LDOPT         = -opt:noref
> LDFLAGS       = $(LDOPT) $(conlflags) -nologo -include:_G__cpp_setupG__Hist \
>               -include:_G__cpp_setupG__Graf1 -include:_G__cpp_setupG__G3D \
>               -include:_G__cpp_setupG__GPad -include:_G__cpp_setupG__Tree \
>               -include:_G__cpp_setupG__Rint 
> -include:_G__cpp_setupG__PostScript \
>               -include:_G__cpp_setupG__Matrix 
> -include:_G__cpp_setupG__Physics
> SOFLAGS       = $(dlllflags:-pdb:none=)
> ROOTLIBS      = "$(ROOTSYS)/lib/libCore.lib" \
>               "$(ROOTSYS)/lib/libCint.lib" "$(ROOTSYS)/lib/libHist.lib" \
>               "$(ROOTSYS)/lib/libGraf.lib" "$(ROOTSYS)/lib/libGraf3d.lib" \
>               "$(ROOTSYS)/lib/libGpad.lib" "$(ROOTSYS)/lib/libTree.lib" \
>               "$(ROOTSYS)/lib/libRint.lib" 
> "$(ROOTSYS)/lib/libPostscript.lib" \
>               "$(ROOTSYS)/lib/libMatrix.lib" "$(ROOTSYS)/lib/libPhysics.lib" 
> \
>               "$(ROOTSYS)/lib/libNet.lib" "$(ROOTSYS)/lib/libRIO.lib"
> LIBS          = $(ROOTLIBS)
> GLIBS         = $(LIBS) "$(ROOTSYS)/lib/libGui.lib" 
> "$(ROOTSYS)/lib/libGraf.lib" \
>               "$(ROOTSYS)/lib/libGpad.lib"
> LIBSALL       = $(ROOTLIBS)
>
> #------------------------------------------------------------------------------
>
> MYHDR       = TMLMath.h TStat.h StatUtils.h
> MYSRC       = TMLMath.cxx TStat.cxx StatUtils.cxx
> MYOBJ       = TMLMath.obj TStat.obj StatUtils.obj xpsDict.obj
>
> xps.dll:  $(MYOBJ)
>   link /dll /def:xps.def /out:xps.dll fp10.obj $(SOFLAGS) $(LDFLAGS) 
> $(GLIBS) *.obj
>  TMLMath.obj: TMLMath.h TMLMath.cxx
>   cl /I"$(ROOTSYS)/include" /MT /EHsc /Ox /D "MSVC" /D "WIN32" /c 
> TMLMath.cxx
>
> TStat.obj: TStat.h TStat.cxx
>   cl /I"$(ROOTSYS)/include" /MT /EHsc /Ox /D "MSVC" /D "WIN32" /c TStat.cxx
>  StatUtils.obj: StatUtils.h StatUtils.cxx
>   cl /I"$(ROOTSYS)/include" /MT /EHsc /Ox /D "MSVC" /D "WIN32" /c 
> StatUtils.cxx
>  xpsDict.cxx: $(MYHDR) xpsLinkDef.h
>   @echo "Generating dictionary $@..."
>   @rootcint -f $@ -c $(MYHDR) xpsLinkDef.h
>  xpsDict.obj: xpsDict.cxx xpsDict.h
>   cl /I"$(ROOTSYS)/include" /MT /EHsc /Ox /D "MSVC" /D "WIN32" /c 
> xpsDict.cxx
>
> clean:
>   rm -f $(MYOBJ) *.a *.d *.rc
>
> clobber:
>   rm -f $(RLIB) $(MYOBJ) *.a *.d *.rc *.dll
> #------------------------------------------------------------------------------
>
> Uncommenting "ROOTSYS = ${ROOTSYS}" results still in the self-reference 
> error, but it works definitely with "ROOTSYS = C:\\root".
>
> I forgot to mention that I use the DOS command shell on WinXP to run "R CMD 
> INSTALL".
> Could this be the problem?
>
> Thank you.
> Best regards
> Christian
> _._._._._._._._._._._._._._._._
> C.h.i.s.t.i.a.n S.t.r.a.t.o.w.a
> V.i.e.n.n.a       A.u.s.t.r.i.a
> _._._._._._._._._._._._._._._._
>
>
> Prof Brian Ripley wrote:
>>> cl /Ic:\root/include /MT /EHsc /Ox /D "MSVC" /D "WIN32" /c TMLMath.cxx
>> 
>> will AFAIK not work when passed to the shell used (which is ash), and in 
>> any case will not work for paths with spaces in.
>> 
>> You still haven't shown us the Makefile.win, but probably you need
>> 
>> cl /I"${ROOTSYS}/include" /MT /EHsc /Ox /D MSVC /D WIN32 /c TMLMath.cxx
>> 
>> 
>> On Fri, 21 Mar 2008, cstrato wrote:
>> 
>>> Dear Prof. Ripley
>>> 
>>> Thank you for your fast reply and sorry for being not specific enough.
>>> 
>>> My problem is that I need to use MS VC++ for the WinXP port of my package 
>>> (xps at BioC):
>>> 
>>> Here is my concrete problem and what I did:
>>> - installed MS Visual Studio Express 2008
>>> - installed binary of ROOT framework compiled with VC++ (thus the need for 
>>> VC++)
>>> - set ROOT environment variable: ROOTSYS=C:\root  (the default install 
>>> dir)
>>> - installed Rtools
>>> - installed binary of R-2.6.2
>>> - created Makefile.win for VC++ which compiles my source code and includes 
>>> ROOT libraries
>>> - created config.win to check for presence of VC++, ROOT, ROOTSYS
>>> 
>>> Everything works fine, I can install my package on WinXP as long as 
>>> "Makefile.win" contains the line "ROOTSYS=C:\\root"
>>> 
>>> When I follow your suggestion "ROOTSYS=${ROOTSYS}" (which I tried already 
>>> before) I get the following error:
>>> running src/Makefile.win ...
>>> Makefile.win:64: *** Recursive variable `ROOTSYS' references itself 
>>> (eventually).  Stop.
>>> make[2]: *** [srcDynlib] Error 2
>>> make[1]: *** [all] Error 2
>>> 
>>> When I try "ROOTSYSX=${ROOTSYS}" I get the usual error:
>>> running src/Makefile.win ...
>>> cl /Ic:\root/include /MT /EHsc /Ox /D "MSVC" /D "WIN32" /c TMLMath.cxx
>>> Microsoft (R) 32-bit C/C++ Optimizing Compiler Version 15.00.21022.08 for 
>>> 80x86
>>> Copyright (C) Microsoft Corporation.  All rights reserved.
>>> TMLMath.cxx
>>> TMLMath.cxx(51) : fatal error C1083: Cannot open include file: 'TMath.h': 
>>> No such file or
>>> directory
>>> make[3]: *** [TMLMath.obj] Error 2
>>> make[2]: *** [srcDynlib] Error 2
>>> make[1]: *** [all] Error 2
>>> 
>>> As you see, everything works but this final problem.
>>> I have checked the examples in  a couple of R packages, e.g. ROracle which 
>>> also reqires VC++, but I could not find any solution to this last problem.
>>> Do you have some other ideas which I could test?
>>> 
>>> Thank you.
>>> Best regards
>>> Christian
>>> _._._._._._._._._._._._._._._._
>>> C.h.i.s.t.i.a.n S.t.r.a.t.o.w.a
>>> V.i.e.n.n.a       A.u.s.t.r.i.a
>>> _._._._._._._._._._._._._._._._
>>> 
>>> 
>>> Prof Brian Ripley wrote:
>>>> On Fri, 21 Mar 2008, cstrato wrote:
>>>> 
>>>>> 
>>>>> Dear all,
>>>>> 
>>>>> When porting my package to WinXP I have the following problem:
>>>>> I need to create an environment variable "MYVAR=c:\mypath" which I have
>>>>> saved in the control panel "System->My Computer" (under the `Advanced' 
>>>>> tab).
>>>>> 
>>>>> I have two files which need to access MYVAR: config.win, Makefile.win
>>>>> 
>>>>> While "config.win" does recognize MYVAR correctly, "Makefile.win" is not
>>>>> able to recognize MYVAR, when I do:
>>>>> "R CMD INSTALL mypkg".
>>>>> I need to add the line "MYVAR=C:\\mypath" to "Makefile.win" for "R CMD
>>>>> INSTALL" to work.
>>>>> 
>>>>> Interestingly, when I "cd ./src" and call from the DOS command line:
>>>>> "NMAKE /f "Makefile.win" CFG="Release"
>>>>> then "Makefile.win" does recognize MYVAR correctly.
>>>>> 
>>>>> Do you know what I need to do so that "Makefile.win" recognizes MYVAR?
>>>> 
>>>> Well, how are you asking it to recognize it?  (We do expect you to 
>>>> provide enough details to avoid such questions.)  $(MYVAR) is a make 
>>>> variable, and ${MYVAR} is an environment variable.  Quite possibly
>>>> 
>>>> MYVAR=${MYVAR}
>>>> 
>>>> is all you need to add.
>>>> 
>>>> BTW, there are dozens of examples in the packages on CRAN -- RGtk2 is 
>>>> one.
>>>> And we strongly discourage the use of Makefile.win: Makevars.win suffices 
>>>> for all but expert developers.
>>>> 
>>>> 
>>> 
>> 
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From cstrato at aon.at  Fri Mar 21 19:14:32 2008
From: cstrato at aon.at (cstrato)
Date: Fri, 21 Mar 2008 19:14:32 +0100
Subject: [Rd] Problem with Makefile.win and environment variable
In-Reply-To: <alpine.LFD.1.00.0803211743400.10761@gannet.stats.ox.ac.uk>
References: <47E3BC66.5070906@aon.at>
	<alpine.LFD.1.00.0803211412350.14566@gannet.stats.ox.ac.uk>
	<47E3DE3F.7040307@aon.at>
	<alpine.LFD.1.00.0803211615130.32302@gannet.stats.ox.ac.uk>
	<47E3F337.4030105@aon.at>
	<alpine.LFD.1.00.0803211743400.10761@gannet.stats.ox.ac.uk>
Message-ID: <47E3FB08.2040106@aon.at>

Dear Prof. Ripley

Prof Brian Ripley wrote:
> You have $(ROOTSYS), not ${ROOTSYS} as I had.
Thank you very much, changing the braces did the trick, now everything 
works!
>
> Also, the output you show is missing the quotes, which is unlikely if 
> this was the Makefile.win version used.
This is correct, since I did add the quote only after receiving your 
mail suggesting this correction.
>
> To summarize:
>
> 1) Use ${ROOTSYS} (with braces).
> 2) Either use forward slashes and no spaces or ensure the path is 
> quoted in the cl call.
>
> The error from the example you showed is the second.
>
> The shell you use to can  Rcmd INSTALL is not relevant: our software 
> ensures that a POSIX shell is used for the make.  (This is quite 
> different from nmake.)
>
>
Thank you once again and "Happy Eastern"
Best regards
Christian
>
> On Fri, 21 Mar 2008, cstrato wrote:
>
>> Dear Prof. Ripley
>>
>> Here is the Makefile.win, which contains already your suggestion for 
>> spaces (thank you), but contains only 3 of 14 header files:
>>
>> #------------------------------------------------------------------------------ 
>>
>>
>> ROOTSYS       = C:\\root
>> #ROOTSYS       = ${ROOTSYS}
>>
>> LDOPT         = -opt:noref
>> LDFLAGS       = $(LDOPT) $(conlflags) -nologo 
>> -include:_G__cpp_setupG__Hist \
>>               -include:_G__cpp_setupG__Graf1 
>> -include:_G__cpp_setupG__G3D \
>>               -include:_G__cpp_setupG__GPad 
>> -include:_G__cpp_setupG__Tree \
>>               -include:_G__cpp_setupG__Rint 
>> -include:_G__cpp_setupG__PostScript \
>>               -include:_G__cpp_setupG__Matrix 
>> -include:_G__cpp_setupG__Physics
>> SOFLAGS       = $(dlllflags:-pdb:none=)
>> ROOTLIBS      = "$(ROOTSYS)/lib/libCore.lib" \
>>               "$(ROOTSYS)/lib/libCint.lib" 
>> "$(ROOTSYS)/lib/libHist.lib" \
>>               "$(ROOTSYS)/lib/libGraf.lib" 
>> "$(ROOTSYS)/lib/libGraf3d.lib" \
>>               "$(ROOTSYS)/lib/libGpad.lib" 
>> "$(ROOTSYS)/lib/libTree.lib" \
>>               "$(ROOTSYS)/lib/libRint.lib" 
>> "$(ROOTSYS)/lib/libPostscript.lib" \
>>               "$(ROOTSYS)/lib/libMatrix.lib" 
>> "$(ROOTSYS)/lib/libPhysics.lib" \
>>               "$(ROOTSYS)/lib/libNet.lib" "$(ROOTSYS)/lib/libRIO.lib"
>> LIBS          = $(ROOTLIBS)
>> GLIBS         = $(LIBS) "$(ROOTSYS)/lib/libGui.lib" 
>> "$(ROOTSYS)/lib/libGraf.lib" \
>>               "$(ROOTSYS)/lib/libGpad.lib"
>> LIBSALL       = $(ROOTLIBS)
>>
>> #------------------------------------------------------------------------------ 
>>
>>
>> MYHDR       = TMLMath.h TStat.h StatUtils.h
>> MYSRC       = TMLMath.cxx TStat.cxx StatUtils.cxx
>> MYOBJ       = TMLMath.obj TStat.obj StatUtils.obj xpsDict.obj
>>
>> xps.dll:  $(MYOBJ)
>>   link /dll /def:xps.def /out:xps.dll fp10.obj $(SOFLAGS) $(LDFLAGS) 
>> $(GLIBS) *.obj
>>  TMLMath.obj: TMLMath.h TMLMath.cxx
>>   cl /I"$(ROOTSYS)/include" /MT /EHsc /Ox /D "MSVC" /D "WIN32" /c 
>> TMLMath.cxx
>>
>> TStat.obj: TStat.h TStat.cxx
>>   cl /I"$(ROOTSYS)/include" /MT /EHsc /Ox /D "MSVC" /D "WIN32" /c 
>> TStat.cxx
>>  StatUtils.obj: StatUtils.h StatUtils.cxx
>>   cl /I"$(ROOTSYS)/include" /MT /EHsc /Ox /D "MSVC" /D "WIN32" /c 
>> StatUtils.cxx
>>  xpsDict.cxx: $(MYHDR) xpsLinkDef.h
>>   @echo "Generating dictionary $@..."
>>   @rootcint -f $@ -c $(MYHDR) xpsLinkDef.h
>>  xpsDict.obj: xpsDict.cxx xpsDict.h
>>   cl /I"$(ROOTSYS)/include" /MT /EHsc /Ox /D "MSVC" /D "WIN32" /c 
>> xpsDict.cxx
>>
>> clean:
>>   rm -f $(MYOBJ) *.a *.d *.rc
>>
>> clobber:
>>   rm -f $(RLIB) $(MYOBJ) *.a *.d *.rc *.dll
>> #------------------------------------------------------------------------------ 
>>
>>
>> Uncommenting "ROOTSYS = ${ROOTSYS}" results still in the 
>> self-reference error, but it works definitely with "ROOTSYS = C:\\root".
>>
>> I forgot to mention that I use the DOS command shell on WinXP to run 
>> "R CMD INSTALL".
>> Could this be the problem?
>>
>> Thank you.
>> Best regards
>> Christian
>> _._._._._._._._._._._._._._._._
>> C.h.i.s.t.i.a.n S.t.r.a.t.o.w.a
>> V.i.e.n.n.a       A.u.s.t.r.i.a
>> _._._._._._._._._._._._._._._._
>>
>>
>> Prof Brian Ripley wrote:
>>>> cl /Ic:\root/include /MT /EHsc /Ox /D "MSVC" /D "WIN32" /c TMLMath.cxx
>>>
>>> will AFAIK not work when passed to the shell used (which is ash), 
>>> and in any case will not work for paths with spaces in.
>>>
>>> You still haven't shown us the Makefile.win, but probably you need
>>>
>>> cl /I"${ROOTSYS}/include" /MT /EHsc /Ox /D MSVC /D WIN32 /c TMLMath.cxx
>>>
>>>
>>> On Fri, 21 Mar 2008, cstrato wrote:
>>>
>>>> Dear Prof. Ripley
>>>>
>>>> Thank you for your fast reply and sorry for being not specific enough.
>>>>
>>>> My problem is that I need to use MS VC++ for the WinXP port of my 
>>>> package (xps at BioC):
>>>>
>>>> Here is my concrete problem and what I did:
>>>> - installed MS Visual Studio Express 2008
>>>> - installed binary of ROOT framework compiled with VC++ (thus the 
>>>> need for VC++)
>>>> - set ROOT environment variable: ROOTSYS=C:\root  (the default 
>>>> install dir)
>>>> - installed Rtools
>>>> - installed binary of R-2.6.2
>>>> - created Makefile.win for VC++ which compiles my source code and 
>>>> includes ROOT libraries
>>>> - created config.win to check for presence of VC++, ROOT, ROOTSYS
>>>>
>>>> Everything works fine, I can install my package on WinXP as long as 
>>>> "Makefile.win" contains the line "ROOTSYS=C:\\root"
>>>>
>>>> When I follow your suggestion "ROOTSYS=${ROOTSYS}" (which I tried 
>>>> already before) I get the following error:
>>>> running src/Makefile.win ...
>>>> Makefile.win:64: *** Recursive variable `ROOTSYS' references itself 
>>>> (eventually).  Stop.
>>>> make[2]: *** [srcDynlib] Error 2
>>>> make[1]: *** [all] Error 2
>>>>
>>>> When I try "ROOTSYSX=${ROOTSYS}" I get the usual error:
>>>> running src/Makefile.win ...
>>>> cl /Ic:\root/include /MT /EHsc /Ox /D "MSVC" /D "WIN32" /c TMLMath.cxx
>>>> Microsoft (R) 32-bit C/C++ Optimizing Compiler Version 
>>>> 15.00.21022.08 for 80x86
>>>> Copyright (C) Microsoft Corporation.  All rights reserved.
>>>> TMLMath.cxx
>>>> TMLMath.cxx(51) : fatal error C1083: Cannot open include file: 
>>>> 'TMath.h': No such file or
>>>> directory
>>>> make[3]: *** [TMLMath.obj] Error 2
>>>> make[2]: *** [srcDynlib] Error 2
>>>> make[1]: *** [all] Error 2
>>>>
>>>> As you see, everything works but this final problem.
>>>> I have checked the examples in  a couple of R packages, e.g. 
>>>> ROracle which also reqires VC++, but I could not find any solution 
>>>> to this last problem.
>>>> Do you have some other ideas which I could test?
>>>>
>>>> Thank you.
>>>> Best regards
>>>> Christian
>>>> _._._._._._._._._._._._._._._._
>>>> C.h.i.s.t.i.a.n S.t.r.a.t.o.w.a
>>>> V.i.e.n.n.a       A.u.s.t.r.i.a
>>>> _._._._._._._._._._._._._._._._
>>>>
>>>>
>>>> Prof Brian Ripley wrote:
>>>>> On Fri, 21 Mar 2008, cstrato wrote:
>>>>>
>>>>>>
>>>>>> Dear all,
>>>>>>
>>>>>> When porting my package to WinXP I have the following problem:
>>>>>> I need to create an environment variable "MYVAR=c:\mypath" which 
>>>>>> I have
>>>>>> saved in the control panel "System->My Computer" (under the 
>>>>>> `Advanced' tab).
>>>>>>
>>>>>> I have two files which need to access MYVAR: config.win, 
>>>>>> Makefile.win
>>>>>>
>>>>>> While "config.win" does recognize MYVAR correctly, "Makefile.win" 
>>>>>> is not
>>>>>> able to recognize MYVAR, when I do:
>>>>>> "R CMD INSTALL mypkg".
>>>>>> I need to add the line "MYVAR=C:\\mypath" to "Makefile.win" for 
>>>>>> "R CMD
>>>>>> INSTALL" to work.
>>>>>>
>>>>>> Interestingly, when I "cd ./src" and call from the DOS command line:
>>>>>> "NMAKE /f "Makefile.win" CFG="Release"
>>>>>> then "Makefile.win" does recognize MYVAR correctly.
>>>>>>
>>>>>> Do you know what I need to do so that "Makefile.win" recognizes 
>>>>>> MYVAR?
>>>>>
>>>>> Well, how are you asking it to recognize it?  (We do expect you to 
>>>>> provide enough details to avoid such questions.)  $(MYVAR) is a 
>>>>> make variable, and ${MYVAR} is an environment variable.  Quite 
>>>>> possibly
>>>>>
>>>>> MYVAR=${MYVAR}
>>>>>
>>>>> is all you need to add.
>>>>>
>>>>> BTW, there are dozens of examples in the packages on CRAN -- RGtk2 
>>>>> is one.
>>>>> And we strongly discourage the use of Makefile.win: Makevars.win 
>>>>> suffices for all but expert developers.
>>>>>
>>>>>
>>>>
>>>
>>
>


From antonio.fabio at gmail.com  Sat Mar 22 12:10:24 2008
From: antonio.fabio at gmail.com (Antonio, Fabio Di Narzo)
Date: Sat, 22 Mar 2008 12:10:24 +0100
Subject: [Rd] idea for GSoC: an R package for fitting Bayesian
	Hierarchical Models
In-Reply-To: <b0808fdc0803210956k5b967d6paa9e572f72482df@mail.gmail.com>
References: <b0808fdc0803210956k5b967d6paa9e572f72482df@mail.gmail.com>
Message-ID: <b0808fdc0803220410n1b3fbc08k4f837a3355d04096@mail.gmail.com>

I've put online a temp web page with some more info (and sources):

http://antonio.fabio.googlepages.com/rgs%3Athergibbssampler

Bests,
Antonio.

2008/3/21, Antonio, Fabio Di Narzo <antonio.fabio at gmail.com>:
> Dear R developers,
>  these days I'm working on some R code for fitting completely generic
>  Bayesian Hierarchical Models in R, a la OpenBUGS and JAGS.
>
>  A key feature of OpenBUGS and JAGS is that they automatically build an
>  appropriate MCMC sampler from a generic model, specified as a directed
>  acyclic graph (DAG).
>  The spirit of my (would-be) implementation is instead more focused on
>  experimentation and prototyping, i.e. is the user who explicitely
>  assign samplers for each model variable after specifying the model.
>  The sampler can be chosed in a set of predefined samplers, as well as
>  customly specified by the user as an R or C function in a very
>  flexible way.
>
>  Now I have a prototype scheleton implementation (a bounch of R and C
>  files, together with some base testing scripts) which works at decent
>  speed (w.r.t. JAGS) on some example models, and I'm writing a
>  proof-of-concept, reproducible Sweave file about it, to be published
>  online shortly.
>
>  What do you think about it in general?
>  What do you think about developing an R package of it as a GSoC project?
>
>  Best regards,
>  Antonio, Fabio Di Narzo.
>


From spencer.graves at pdf.com  Sun Mar 23 19:32:34 2008
From: spencer.graves at pdf.com (Spencer Graves)
Date: Sun, 23 Mar 2008 11:32:34 -0700
Subject: [Rd] problem with 'install.packages'
Message-ID: <47E6A242.4000602@pdf.com>

Hi, All: 

      Is there a way to identify whether any users are using a 
particular package in a shared network R installation? 

      I ask, because we have such a multiple-user installation and when 
I tried to install a package using Rgui that was in use by Rterm on a 
single-user installation, 'install.packages' deleted the existing 
package but failed to install the new version;  see below. 

      I'm concerned especially about the following multiple user 
scenario:  User A on terminalServer1 tries "install.packages('mvtnorm')" 
when user B on terminalServer2 was using 'mvtnorm';  both are using the 
same network installation.  If the results match my experience on a 
single-user installation, the existing version will be deleted but the 
new version will NOT be installed.  Any subsequent new attempt to access 
'mvtnorm' will fail until all current users of 'mvtnorm' quit those 
sessions and someone subsequently invokes 
"install.packages('mvtnorm')".  In fact, user B could have disconnected 
from that session a month ago, and may have long forgotten the R session 
that is still officially active, though perhaps consuming 0 CPU seconds 
in the past month! 

      Thanks,
      Spencer
#######################################
##
## Rgui
##
#######################################
R version 2.6.2 (2008-02-08)
<snip>
 > utils:::menuInstallPkgs()
trying URL 
'http://cran.cnr.berkeley.edu/bin/windows/contrib/2.6/mvtnorm_0.8-3.zip'
Content type 'application/zip' length 214769 bytes (209 Kb)
opened URL
downloaded 209 Kb

package 'mvtnorm' successfully unpacked and MD5 sums checked
Warning: cannot remove prior installation of package 'mvtnorm'

The downloaded packages are in
        C:\Documents and Settings\spencerg\Local 
Settings\Temp\RtmpghgskA\downloaded_packages
updating HTML package descriptions
 > library(mvtnorm)
Error in library(mvtnorm) : there is no package called 'mvtnorm'

 > sessionInfo()
R version 2.6.2 (2008-02-08)
i386-pc-mingw32

locale:
LC_COLLATE=English_United States.1252;LC_CTYPE=English_United 
States.1252;LC_MONETARY=English_United 
States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base    

loaded via a namespace (and not attached):
Error in x[["Version"]] : subscript out of bounds
In addition: Warning message:
In FUN(c("mvtnorm", "tools")[[2L]], ...) :
  DESCRIPTION file of package 'mvtnorm' is missing or broken
 >
#######################################
##
## Concurrent Rterm session
##
#######################################
R version 2.6.2 (2008-02-08)

<snip>

 > dmvnorm(1:2)
[1] 0.01306423
[1] ".GlobalEnv"        "package:mvtnorm"   "package:stats"   
 [4] "package:graphics"  "package:grDevices" "package:utils"   
 [7] "package:datasets"  "package:methods"   "Autoloads"       
[10] "package:base"    
 > detach()
 > dmvnorm(1:2)
Error: could not find function "dmvnorm"
 > library(mvtnorm)
Error in library(mvtnorm) : there is no package called 'mvtnorm'
 > sessionInfo()
R version 2.6.2 (2008-02-08)
i386-pc-mingw32

locale:
LC_COLLATE=English_United States.1252;LC_CTYPE=English_United 
States.1252;LC_MONETARY=English_United 
States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base    

loaded via a namespace (and not attached):
Error in x[["Version"]] : subscript out of bounds
In addition: Warning message:
In FUN(c("mvtnorm", "stepAICc")[[2L]], ...) :
  DESCRIPTION file of package 'mvtnorm' is missing or broken
 >


From ligges at statistik.tu-dortmund.de  Sun Mar 23 19:43:11 2008
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Sun, 23 Mar 2008 19:43:11 +0100
Subject: [Rd] problem with 'install.packages'
In-Reply-To: <47E6A242.4000602@pdf.com>
References: <47E6A242.4000602@pdf.com>
Message-ID: <47E6A4BF.90104@statistik.tu-dortmund.de>

Spencer Graves wrote:
> Hi, All: 
> 
>       Is there a way to identify whether any users are using a 
> particular package in a shared network R installation? 
> 
>       I ask, because we have such a multiple-user installation and when 
> I tried to install a package using Rgui that was in use by Rterm on a 
> single-user installation, 'install.packages' deleted the existing 
> package but failed to install the new version;  see below. 
> 
>       I'm concerned especially about the following multiple user 
> scenario:  User A on terminalServer1 tries "install.packages('mvtnorm')" 
> when user B on terminalServer2 was using 'mvtnorm';  both are using the 
> same network installation.  If the results match my experience on a 
> single-user installation, the existing version will be deleted but the 
> new version will NOT be installed.  Any subsequent new attempt to access 
> 'mvtnorm' will fail until all current users of 'mvtnorm' quit those 
> sessions and someone subsequently invokes 

Spencer,

I am using a script that asks Windows if a file is opened in a 
subdirectory of the R library I am going to install or update packages 
in, which basically uses the Windows shell command
   net file

Then simply grep for the package name you want to install...


> "install.packages('mvtnorm')".  In fact, user B could have disconnected 
> from that session a month ago, and may have long forgotten the R session 
> that is still officially active, though perhaps consuming 0 CPU seconds 
> in the past month! 

That's worse and really hard to deal with, I fear.

Best wishes,
Uwe



>       Thanks,
>       Spencer
> #######################################
> ##
> ## Rgui
> ##
> #######################################
> R version 2.6.2 (2008-02-08)
> <snip>
>  > utils:::menuInstallPkgs()
> trying URL 
> 'http://cran.cnr.berkeley.edu/bin/windows/contrib/2.6/mvtnorm_0.8-3.zip'
> Content type 'application/zip' length 214769 bytes (209 Kb)
> opened URL
> downloaded 209 Kb
> 
> package 'mvtnorm' successfully unpacked and MD5 sums checked
> Warning: cannot remove prior installation of package 'mvtnorm'
> 
> The downloaded packages are in
>         C:\Documents and Settings\spencerg\Local 
> Settings\Temp\RtmpghgskA\downloaded_packages
> updating HTML package descriptions
>  > library(mvtnorm)
> Error in library(mvtnorm) : there is no package called 'mvtnorm'
> 
>  > sessionInfo()
> R version 2.6.2 (2008-02-08)
> i386-pc-mingw32
> 
> locale:
> LC_COLLATE=English_United States.1252;LC_CTYPE=English_United 
> States.1252;LC_MONETARY=English_United 
> States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252
> 
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base    
> 
> loaded via a namespace (and not attached):
> Error in x[["Version"]] : subscript out of bounds
> In addition: Warning message:
> In FUN(c("mvtnorm", "tools")[[2L]], ...) :
>   DESCRIPTION file of package 'mvtnorm' is missing or broken
>  >
> #######################################
> ##
> ## Concurrent Rterm session
> ##
> #######################################
> R version 2.6.2 (2008-02-08)
> 
> <snip>
> 
>  > dmvnorm(1:2)
> [1] 0.01306423
> [1] ".GlobalEnv"        "package:mvtnorm"   "package:stats"   
>  [4] "package:graphics"  "package:grDevices" "package:utils"   
>  [7] "package:datasets"  "package:methods"   "Autoloads"       
> [10] "package:base"    
>  > detach()
>  > dmvnorm(1:2)
> Error: could not find function "dmvnorm"
>  > library(mvtnorm)
> Error in library(mvtnorm) : there is no package called 'mvtnorm'
>  > sessionInfo()
> R version 2.6.2 (2008-02-08)
> i386-pc-mingw32
> 
> locale:
> LC_COLLATE=English_United States.1252;LC_CTYPE=English_United 
> States.1252;LC_MONETARY=English_United 
> States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252
> 
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base    
> 
> loaded via a namespace (and not attached):
> Error in x[["Version"]] : subscript out of bounds
> In addition: Warning message:
> In FUN(c("mvtnorm", "stepAICc")[[2L]], ...) :
>   DESCRIPTION file of package 'mvtnorm' is missing or broken
>  >
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From bolker at ufl.edu  Mon Mar 24 02:33:24 2008
From: bolker at ufl.edu (Ben Bolker)
Date: Mon, 24 Mar 2008 01:33:24 +0000 (UTC)
Subject: [Rd]
	=?utf-8?q?idea_for_GSoC=3A_an_R_package_for_fitting_Bayesian?=
	=?utf-8?q?=09Hierarchical_Models?=
References: <b0808fdc0803210956k5b967d6paa9e572f72482df@mail.gmail.com>
	<b0808fdc0803220410n1b3fbc08k4f837a3355d04096@mail.gmail.com>
Message-ID: <loom.20080324T013004-719@post.gmane.org>

Antonio, Fabio Di Narzo <antonio.fabio <at> gmail.com> writes:

> 
> I've put online a temp web page with some more info (and sources):
> 
> http://antonio.fabio.googlepages.com/rgs%3Athergibbssampler
> 
> Bests,
> Antonio.
> 

  Have you seen Jouni Kerman's Umacs package?  It sounds similar
in spirit.

  Something I would love to see done (not that I have the time
and energy to supervise someone to do it right now) would be
an R (or Python/etc.: R wouldn't necessarily be the best tool)
to translate lmer/nlme syntax (Wilkinson-Rogers with extensions
for specifying random factors, correlation structures, etc.)
into a BUGS file.  It strikes me that it would be a really nice
way to bridge the gap between what mixed-model code can do
and what requires BUGS/MCMC.  Such models could also serve as
(1) a way to cross-check the results of mixed model code;
(2) a way to get started in relaxing the assumptions of mixed
models (e.g. allowing for non-normal random effects distributions).

  Ben Bolker


From antonio.fabio at gmail.com  Mon Mar 24 10:47:21 2008
From: antonio.fabio at gmail.com (Antonio, Fabio Di Narzo)
Date: Mon, 24 Mar 2008 10:47:21 +0100
Subject: [Rd] idea for GSoC: an R package for fitting Bayesian
	Hierarchical Models
In-Reply-To: <loom.20080324T013004-719@post.gmane.org>
References: <b0808fdc0803210956k5b967d6paa9e572f72482df@mail.gmail.com>
	<b0808fdc0803220410n1b3fbc08k4f837a3355d04096@mail.gmail.com>
	<loom.20080324T013004-719@post.gmane.org>
Message-ID: <b0808fdc0803240247j767614ebm116100a9e8944f2e@mail.gmail.com>

Above all,
tnx Ben for taking time to read about my proposal!

2008/3/24, Ben Bolker <bolker at ufl.edu>:
> Antonio, Fabio Di Narzo <antonio.fabio <at> gmail.com> writes:
>
>  >
>  > I've put online a temp web page with some more info (and sources):
>  >
>  > http://antonio.fabio.googlepages.com/rgs%3Athergibbssampler
>  >
>  > Bests,
>  > Antonio.
>  >
>
>
>   Have you seen Jouni Kerman's Umacs package?  It sounds similar
>  in spirit.

Ya. But speeds are rather different.
I admittely missed a comparison with Umacs in my short demo.
However, from some early experiments (I'm doing while I'm writing), as
I suspected, my approach results being many times faster than Umacs,
even if one doesn't specify samplers as C code. Things goes even
better for my demo implementation if one tries to plug in samplers
specified as pure C code, which would further eliminate a lot of
memory allocations/deallocations behind those "rnorm()".

My aim is to obtain something which achieves decent speed, compared
with JAGS. I mean, I can easily experiment new samplers by using an
interpreted language, but if at the end I obtain something which is
*many* times slower than JAGS (which is moreover much more robust and
easier to work with), the whole stuff results being of little pratical
interest.

More: how can one really experiment a new custom sampler if doing some
thousands iterations takes forever, so that checking your sampler
pratical behaviour is a pain (I speak about my personal experience)?
That's why I want to always keep attention on speed, and give the
possibility to the user to either use R or C code at his choice, with
the ability to modify model node values in place, without unneeded
'malloc's. Ya, I would abandon pure functional style...

I will try to add a reproducible benchmark comparing my demo
implementation with JAGS and Umacs. However, I see that the problem
here is still finding someone interested in it at all.

>
>   Something I would love to see done (not that I have the time
>  and energy to supervise someone to do it right now) would be
>  an R (or Python/etc.: R wouldn't necessarily be the best tool)
>  to translate lmer/nlme syntax (Wilkinson-Rogers with extensions
>  for specifying random factors, correlation structures, etc.)
>  into a BUGS file.  It strikes me that it would be a really nice
>  way to bridge the gap between what mixed-model code can do
>  and what requires BUGS/MCMC.  Such models could also serve as
>  (1) a way to cross-check the results of mixed model code;
>  (2) a way to get started in relaxing the assumptions of mixed
>  models (e.g. allowing for non-normal random effects distributions).

That sounds interesting. However, I currenlty don't have enough
know-how to work at something like it now.

Antonio.

>
>
>   Ben Bolker
>
>
>  ______________________________________________
>  R-devel at r-project.org mailing list
>  https://stat.ethz.ch/mailman/listinfo/r-devel
>


From bolker at ufl.edu  Mon Mar 24 12:39:06 2008
From: bolker at ufl.edu (Ben Bolker)
Date: Mon, 24 Mar 2008 11:39:06 +0000 (UTC)
Subject: [Rd]
	=?utf-8?q?idea_for_GSoC=3A_an_R_package_for_fitting_Bayesian?=
	=?utf-8?q?=09Hierarchical_Models?=
References: <b0808fdc0803210956k5b967d6paa9e572f72482df@mail.gmail.com>
	<b0808fdc0803220410n1b3fbc08k4f837a3355d04096@mail.gmail.com>
	<loom.20080324T013004-719@post.gmane.org>
	<b0808fdc0803240247j767614ebm116100a9e8944f2e@mail.gmail.com>
Message-ID: <loom.20080324T112620-362@post.gmane.org>

Antonio, Fabio Di Narzo <antonio.fabio <at> gmail.com> writes:

  
>

  I agree that quantitative differences in speed can make
a qualitative difference in the way one works.

  Well, I'm somewhat interested, but don't feel that I'm
necessarily appropriate as a mentor. I don't think it would
be terrible if you contacted particular people (Gelman, Plummer,
O'Hara?) to see if they were interested ... they could always
say no ...

> >
> >   Something I would love to see done (not that I have the time
> >  and energy to supervise someone to do it right now) would be
> >  an R (or Python/etc.: R wouldn't necessarily be the best tool)
> >  to translate lmer/nlme syntax (Wilkinson-Rogers with extensions
> >  for specifying random factors, correlation structures, etc.)
> >  into a BUGS file.  It strikes me that it would be a really nice
> >  way to bridge the gap between what mixed-model code can do
> >  and what requires BUGS/MCMC.  Such models could also serve as
> >  (1) a way to cross-check the results of mixed model code;
> >  (2) a way to get started in relaxing the assumptions of mixed
> >  models (e.g. allowing for non-normal random effects distributions).
> 
> That sounds interesting. However, I currenlty don't have enough
> know-how to work at something like it now.

   Do you think so?  I don't think it would be too hard,
if you were interested ...

  Ben


From h.wickham at gmail.com  Mon Mar 24 13:45:50 2008
From: h.wickham at gmail.com (hadley wickham)
Date: Mon, 24 Mar 2008 07:45:50 -0500
Subject: [Rd] idea for GSoC: an R package for fitting Bayesian
	Hierarchical Models
In-Reply-To: <b0808fdc0803240247j767614ebm116100a9e8944f2e@mail.gmail.com>
References: <b0808fdc0803210956k5b967d6paa9e572f72482df@mail.gmail.com>
	<b0808fdc0803220410n1b3fbc08k4f837a3355d04096@mail.gmail.com>
	<loom.20080324T013004-719@post.gmane.org>
	<b0808fdc0803240247j767614ebm116100a9e8944f2e@mail.gmail.com>
Message-ID: <f8e6ff050803240545u1413608ek2dbeb5238d6f47bb@mail.gmail.com>

>  Ya. But speeds are rather different.
>  I admittely missed a comparison with Umacs in my short demo.
>  However, from some early experiments (I'm doing while I'm writing), as
>  I suspected, my approach results being many times faster than Umacs,
>  even if one doesn't specify samplers as C code. Things goes even
>  better for my demo implementation if one tries to plug in samplers
>  specified as pure C code, which would further eliminate a lot of
>  memory allocations/deallocations behind those "rnorm()".
>
>  My aim is to obtain something which achieves decent speed, compared
>  with JAGS. I mean, I can easily experiment new samplers by using an
>  interpreted language, but if at the end I obtain something which is
>  *many* times slower than JAGS (which is moreover much more robust and
>  easier to work with), the whole stuff results being of little pratical
>  interest.
>
>  More: how can one really experiment a new custom sampler if doing some
>  thousands iterations takes forever, so that checking your sampler
>  pratical behaviour is a pain (I speak about my personal experience)?
>  That's why I want to always keep attention on speed, and give the
>  possibility to the user to either use R or C code at his choice, with
>  the ability to modify model node values in place, without unneeded
>  'malloc's. Ya, I would abandon pure functional style...

There is some interesting work being done on this topic in computer
science - e.g.

@inproceedings{keller:2008,
	Author = {Keller, Gabriele and Chaffey-Millar, Hugh and Chakravarty,
Manuel M. T. and Stewart, Don and Barner-Kowollik, Christopher},
	Booktitle = {Proceedings of the Tenth International Symposium on
Practical Aspects of Declarative Languages},
	Title = {Specialising Simulator Generators for High-Performance
Monte-Carlo Methods},
        Url = {http://www.cse.unsw.edu.au/~chak/project/polysim/},
	Year = {2008}
}

which explores a way to define a simulation at a high-level and then
compile it down to fast low-level primitives.  This seems like an
interesting approach, but I suspect you would struggle to find
students with the requisite statistical and computational backgrounds.

Hadley


-- 
http://had.co.nz/


From antonio.fabio at gmail.com  Mon Mar 24 14:16:00 2008
From: antonio.fabio at gmail.com (Antonio, Fabio Di Narzo)
Date: Mon, 24 Mar 2008 14:16:00 +0100
Subject: [Rd] idea for GSoC: an R package for fitting Bayesian
	Hierarchical Models
In-Reply-To: <f8e6ff050803240545u1413608ek2dbeb5238d6f47bb@mail.gmail.com>
References: <b0808fdc0803210956k5b967d6paa9e572f72482df@mail.gmail.com>
	<b0808fdc0803220410n1b3fbc08k4f837a3355d04096@mail.gmail.com>
	<loom.20080324T013004-719@post.gmane.org>
	<b0808fdc0803240247j767614ebm116100a9e8944f2e@mail.gmail.com>
	<f8e6ff050803240545u1413608ek2dbeb5238d6f47bb@mail.gmail.com>
Message-ID: <b0808fdc0803240616m52ae6cxf609394523d72284@mail.gmail.com>

2008/3/24, hadley wickham <h.wickham at gmail.com>:
> >  Ya. But speeds are rather different.
>  >  I admittely missed a comparison with Umacs in my short demo.
>  >  However, from some early experiments (I'm doing while I'm writing), as
>  >  I suspected, my approach results being many times faster than Umacs,
>  >  even if one doesn't specify samplers as C code. Things goes even
>  >  better for my demo implementation if one tries to plug in samplers
>  >  specified as pure C code, which would further eliminate a lot of
>  >  memory allocations/deallocations behind those "rnorm()".
>  >
>
> There is some interesting work being done on this topic in computer
>  science - e.g.
>
>  @inproceedings{keller:2008,
>         Author = {Keller, Gabriele and Chaffey-Millar, Hugh and Chakravarty,
>  Manuel M. T. and Stewart, Don and Barner-Kowollik, Christopher},
>         Booktitle = {Proceedings of the Tenth International Symposium on
>  Practical Aspects of Declarative Languages},
>         Title = {Specialising Simulator Generators for High-Performance
>  Monte-Carlo Methods},
>         Url = {http://www.cse.unsw.edu.au/~chak/project/polysim/},
>         Year = {2008}
>  }
>
>  which explores a way to define a simulation at a high-level and then
>  compile it down to fast low-level primitives.  This seems like an
>  interesting approach, but I suspect you would struggle to find
>  students with the requisite statistical and computational backgrounds.
>
>  Hadley

Tnx for the reference: that's surely an interesting reading.

Instead of inventing a specialised meta-language for this kind of task
(I don't ever have the knowledge for doing something like that) I've
explored in the recent past the direct use of higher level languages
that can be compiled into native code. I've got most interesting
results in Steel Bank Common Lisp and OCaml. They really seem to do
what they claim :-)

However, writing something like a general purpose Gibbs sampler
framework in these languages seems to be a waste of time, as one
misses a lot of things which are already available in R. Not least:
random number generators from a lot of common distributions! Ok, one
can write wrapper code to the R standalone library, but this all looks
as extra-work.

So, waiting for an R-to-native code compiler, I think a feasible
approach can be to write R functions with pass-by-reference semantics
and a bounch of small C routines. In that respect, I was inspired by
the lush project:
http://lush.sourceforge.net
where mix of high level and C code is encouraged (note that lush at
the end has a native code compiler too).

Antonio.


From Manuel.Eugster at stat.uni-muenchen.de  Mon Mar 24 17:23:08 2008
From: Manuel.Eugster at stat.uni-muenchen.de (Manuel.Eugster at stat.uni-muenchen.de)
Date: Mon, 24 Mar 2008 17:23:08 +0100 (CET)
Subject: [Rd] Roxygen
In-Reply-To: <20080321060928.GA1283@klutometis.wikitex.org>
References: <47DFD659.40506@stat.uni-muenchen.de>
	<20080319151841.GB15511@klutometis.wikitex.org>
	<47E14D5E.7090105@stat.uni-muenchen.de>
	<20080321060928.GA1283@klutometis.wikitex.org>
Message-ID: <1223.85.181.132.44.1206375788.squirrel@webmail.lrz-muenchen.de>

Hey Peter,

sorry for the delay, I was on easter holiday.

> Would it suffice, by the way, to source() a file and introspect upon
> its objects with ls(), formals(), typeof(), mode(), and the like; or
> should we formalize, say, a BNF and write the accompanying automaton?

I agree with Duncan and Hadley. I think, a good way is to write a parser
for the comments and use the parse() function for R code.


Manuel.


From murdoch at stats.uwo.ca  Mon Mar 24 18:35:20 2008
From: murdoch at stats.uwo.ca (murdoch at stats.uwo.ca)
Date: Mon, 24 Mar 2008 18:35:20 +0100 (CET)
Subject: [Rd] Inaccurate qgamma() (PR#11030)
Message-ID: <20080324173520.E9438282EFF8@mail.pubhealth.ku.dk>

I haven't looked inside to see what is causing this, but there's a big 
discontinuity in qgamma:

  curve(qgamma(x, shape=19), from=1e-10, to=2e-10)

This appears in both R-patched and R-devel.

Duncan Murdoch


From suraaga.kulkarni at gmail.com  Mon Mar 24 18:40:35 2008
From: suraaga.kulkarni at gmail.com (Suraaga Kulkarni)
Date: Mon, 24 Mar 2008 13:40:35 -0400
Subject: [Rd] resampling from string when it runs across multiple lines
Message-ID: <faecd66a0803241040m69e080cdk1a76803fe45e7e2b@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20080324/f842e961/attachment.pl 

From Dimitris.Rizopoulos at med.kuleuven.be  Mon Mar 24 19:10:36 2008
From: Dimitris.Rizopoulos at med.kuleuven.be (Dimitris Rizopoulos)
Date: Mon, 24 Mar 2008 19:10:36 +0100
Subject: [Rd] resampling from string when it runs across multiple lines
In-Reply-To: <faecd66a0803241040m69e080cdk1a76803fe45e7e2b@mail.gmail.com>
References: <faecd66a0803241040m69e080cdk1a76803fe45e7e2b@mail.gmail.com>
Message-ID: <20080324191036.kus65ztzwof4o0gc@webmail5.kuleuven.be>

try this:

y <- as.matrix(read.table(textConnection(
"A     C     G     T     T     G     C     A     G      C
A     C     G     F     F     F     F     F     F      G
A     C     G     S     S     S     S     S     G      A
A     C     G     T     T     G     C     A     G      G
A     B     B     B     B     B     B     A     G      T"
), stringsAsFactors = FALSE))

ind <- sample(length(y), 20, TRUE)
y[ind]

I hope it helps.

Best,
Dimitris

ps, it would be best that you send that kind of e-mails in R-help not  
R-devel; check http://www.r-project.org/mail.html for more info  
regarding the different R-mailing-lists.

----
Dimitris Rizopoulos
Biostatistical Centre
School of Public Health
Catholic University of Leuven

Address: Kapucijnenvoer 35, Leuven, Belgium
Tel: +32/(0)16/336899
Fax: +32/(0)16/337015
Web: http://med.kuleuven.be/biostat/
      http://www.student.kuleuven.be/~m0390867/dimitris.htm


Quoting Suraaga Kulkarni <suraaga.kulkarni at gmail.com>:

> Hi,
>
> I need to resample from a long string, which is written in many lines with
> carriage-return marks at the end of each line.  Perhaps because the data
> looks like a matrix, using the code: sample(data, 25, replace=T) gives me 25
> columns of characters from the data because it is resampling whole columns.
> What I would like it to do is to treat the data as a vector that has just
> been spread across many lines, and pick single characters from random
> positions in randomly chosen lines.
>
> I am reproducing a sample dataset, the command and the output here:
>
>> y
>      X..1. X..2. X..3. X..4. X..5. X..6. X..7. X..8. X..9. X..10.
> [1,]     A     C     G     T     T     G     C     A     G      C
> [2,]     A     C     G     F     F     F     F     F      F      G
> [3,]     A     C     G    S     S     S     S     S     G      A
> [4,]     A     C     G     T     T     G     C     A     G      G
> [5,]     A     B     B     B     B     B     B     A     G      T
>
>> sample(y, 20, replace=T)
>      X..9. X..4. X..2. X..7. X..9..1 X..3. X..3..1 X..9..2 X..9..3 X..4..1
> X..3..2 X..8. X..9..4 X..3..3 X..6. X..7..1
> [1,]     G     T     C     C       G     G       G       G       G
> T       G     A       G       G     G       C
> [2,]     F      F    C     F        F     G       G       F       F
> F       G     F       F       G      F       F
> [3,]     G     S    C     S       G     G       G       G       G
> S       G     S       G       G     S       S
> [4,]     G     T     C     C       G     G       G       G       G
> T       G     A       G       G     G       C
> [5,]     G     B     B     B       G     B       B       G       G
> B       B     A       G       B     B       B
>
>      X..6..1 X..3..4 X..7..2 X..10.
> [1,]       G       G       C      C
> [2,]       F       G        F      G
> [3,]       S       G       S      A
> [4,]       G       G       C      G
> [5,]       B       B       B       T
>
> I wanted to try the bootstrap approach (since that's what I am doing -
> resampling with replacement) but that requires a "statistic" and I don't
> know what sense that makes for character data.
>
> Any help will be greatly appreciated.
>
> Thanks,
>
> S.
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>



Disclaimer: http://www.kuleuven.be/cwis/email_disclaimer.htm


From lawremi at iastate.edu  Mon Mar 24 22:44:12 2008
From: lawremi at iastate.edu (Michael Lawrence)
Date: Mon, 24 Mar 2008 14:44:12 -0700
Subject: [Rd] revision 44805 breaks promptMethods()
Message-ID: <509e0620803241444l440ec293u2ec62b3a8ae52faa@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20080324/5f507cb5/attachment.pl 

From murdoch at stats.uwo.ca  Mon Mar 24 23:52:54 2008
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Mon, 24 Mar 2008 18:52:54 -0400
Subject: [Rd] Inaccurate qgamma() (PR#11030)
In-Reply-To: <20080324173520.E9438282EFF8@mail.pubhealth.ku.dk>
References: <20080324173520.E9438282EFF8@mail.pubhealth.ku.dk>
Message-ID: <47E830C6.3030603@stats.uwo.ca>

On 24/03/2008 1:35 PM, murdoch at stats.uwo.ca wrote:
> I haven't looked inside to see what is causing this, but there's a big 
> discontinuity in qgamma:
> 
>   curve(qgamma(x, shape=19), from=1e-10, to=2e-10)
> 
> This appears in both R-patched and R-devel.

With debugging turned on, the inaccurate value prints this:

 > qgamma(1.2e-10, shape=19)
qgamma(p=1.2e-10, alpha=     19, scale=      1, l.t.= 1, log_p= 0):  nu 
 > .32: Wilson-Hilferty; x = -6.33328
         ==> ch =    5.03581: Ph.II iter; ch=5.03581, p2=8.8438e-11
      it=2,  ch=-0.635427, p2=4.94066e-324
      it=3,  ch=1.2e-10, p2=4.94066e-324
      it=4,  ch=nan, p2=4.94066e-324

  it=1: p=1.2e-10, x = 2.51791, p.=3.1562e-11; p1:=D{p}=-8.8438e-11
no Newton step done since delta{p} >= last delta
[1] 2.517907

Things are fine if I use log.p=TRUE:

 > qgamma(log(1.2e-10), shape=19, log.p=TRUE)
qgamma(p=-22.8435, alpha=     19, scale=      1, l.t.= 1, log_p= 1):  nu 
 > .32: Wilson-Hilferty; x = -6.33328
         ==> ch =    5.03581: Ph.II iter; ch=5.03581, p2=8.8438e-11
      it=2,  ch=-0.635427, p2=4.94066e-324
      it=3,  ch=1.2e-10, p2=4.94066e-324
      it=4,  ch=nan, p2=4.94066e-324

  it=1: p=-22.8435, x = 2.51791, p.=-24.1791; p1:=D{p}=-1.33554
          it=2,  d{p}=-0.0581595
          it=3,  d{p}=-0.00011856
          it=4,  d{p}=-4.9439e-10
          it=5,  d{p}=1.42247e-15
[1] 2.729837

Maybe we should switch to this scale when the first try fails?

Duncan Murdoch


From jmc at r-project.org  Tue Mar 25 00:58:21 2008
From: jmc at r-project.org (John Chambers)
Date: Mon, 24 Mar 2008 16:58:21 -0700
Subject: [Rd] revision 44805 breaks promptMethods()
In-Reply-To: <509e0620803241444l440ec293u2ec62b3a8ae52faa@mail.gmail.com>
References: <509e0620803241444l440ec293u2ec62b3a8ae52faa@mail.gmail.com>
Message-ID: <47E8401D.4060705@r-project.org>

I think, as of just 2 revisions later (44863) anyway, that problem has 
been fixed.  Sitting in the methods/R directory:

grep -nH -e "isGenericFunction" *.R

Grep finished with no matches found at Mon Mar 24 16:55:39

Try updating & see if all is well.  (r-devel is a moving target, 
particularly a month before release!)

John

Michael Lawrence wrote:
> Hi,
>
> It seems that promptMethods() was changed in revision 44805 to include a
> call to "isGenericFunction" that at least as of revision 44861 does not
> exist as far as I can tell.
>
> This results in:
> could not find function "isGenericFunction"
>
> when evaluating e.g. promptMethods("myGeneric")
>
> Thanks,
> Michael
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From mark.bravington at csiro.au  Tue Mar 25 05:50:04 2008
From: mark.bravington at csiro.au (mark.bravington at csiro.au)
Date: Tue, 25 Mar 2008 05:50:04 +0100 (CET)
Subject: [Rd] regexp with [:upper:] (PR#11032)
Message-ID: <20080325045005.090392834611@mail.pubhealth.ku.dk>

Full_Name: Mark Bravington
Version: 2.6.2 patched
OS: Windows XP Pro
Submission from: (NULL) (140.79.22.104)


> grep( '[:upper:]', letters, val=T) # shurely shouldn't match anything ??
[1] "e" "p" "r" "u"

The converse ( '[:lower:]' and LETTERS) seems to work OK.

--please do not edit the information below--

Version:
 platform = i386-pc-mingw32
 arch = i386
 os = mingw32
 system = i386, mingw32
 status = Patched
 major = 2
 minor = 6.2
 year = 2008
 month = 03
 day = 21
 svn rev = 44836
 language = R
 version.string = R version 2.6.2 Patched (2008-03-21 r44836)

Windows XP (build 2600) Service Pack 2

Locale:
LC_COLLATE=English_Australia.1252;LC_CTYPE=English_Australia.1252;LC_MONETARY=English_Australia.1252;LC_NUMERIC=C;LC_TIME=English_Australia.1252

Search Path:
 .GlobalEnv, package:stats, package:graphics, package:grDevices, package:utils,
package:datasets, package:methods, Autoloads, pa


From ripley at stats.ox.ac.uk  Tue Mar 25 06:43:21 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 25 Mar 2008 05:43:21 +0000 (GMT)
Subject: [Rd] regexp with [:upper:] (PR#11032)
In-Reply-To: <20080325045005.090392834611@mail.pubhealth.ku.dk>
References: <20080325045005.090392834611@mail.pubhealth.ku.dk>
Message-ID: <alpine.LFD.1.00.0803250538400.25477@gannet.stats.ox.ac.uk>

That is correct: I suspect you meant the character class [[:upper:]]

> grep( '[[:upper:]]', letters, val=TRUE)
character(0)

You asked for matches amongst :upper:, and that is what you got.
As ?rexexp does say

      (Note that the
      brackets in these class names are part of the symbolic names, and
      must be included in addition to the brackets delimiting the
      bracket list.)

this appears to be a homework failure.

On Tue, 25 Mar 2008, mark.bravington at csiro.au wrote:

> Full_Name: Mark Bravington
> Version: 2.6.2 patched
> OS: Windows XP Pro
> Submission from: (NULL) (140.79.22.104)
>
>
>> grep( '[:upper:]', letters, val=T) # shurely shouldn't match anything ??
> [1] "e" "p" "r" "u"
>
> The converse ( '[:lower:]' and LETTERS) seems to work OK.
>
> --please do not edit the information below--
>
> Version:
> platform = i386-pc-mingw32
> arch = i386
> os = mingw32
> system = i386, mingw32
> status = Patched
> major = 2
> minor = 6.2
> year = 2008
> month = 03
> day = 21
> svn rev = 44836
> language = R
> version.string = R version 2.6.2 Patched (2008-03-21 r44836)
>
> Windows XP (build 2600) Service Pack 2
>
> Locale:
> LC_COLLATE=English_Australia.1252;LC_CTYPE=English_Australia.1252;LC_MONETARY=English_Australia.1252;LC_NUMERIC=C;LC_TIME=English_Australia.1252
>
> Search Path:
> .GlobalEnv, package:stats, package:graphics, package:grDevices, package:utils,
> package:datasets, package:methods, Autoloads, pa
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From Mark.Bravington at csiro.au  Tue Mar 25 06:47:17 2008
From: Mark.Bravington at csiro.au (Mark.Bravington at csiro.au)
Date: Tue, 25 Mar 2008 16:47:17 +1100
Subject: [Rd] regexp with [:upper:] (PR#11032)
References: <20080325045005.090392834611@mail.pubhealth.ku.dk>
	<alpine.LFD.1.00.0803250538400.25477@gannet.stats.ox.ac.uk>
Message-ID: <7EDC0EE19405664899D1647A6C9FF6D9073C5E@extas4-hba.tas.csiro.au>

Aaargh, sorry. I thought it might be to do with Australian English...

Prof Brian Ripley wrote:
> That is correct: I suspect you meant the character class [[:upper:]]
> 
>> grep( '[[:upper:]]', letters, val=TRUE) character(0)
> 
> You asked for matches amongst :upper:, and that is what you got.
> As ?rexexp does say
> 
>       (Note that the
>       brackets in these class names are part of the symbolic
> names, and
>       must be included in addition to the brackets delimiting the    
> bracket list.) 
> 
> this appears to be a homework failure.
> 
> On Tue, 25 Mar 2008, mark.bravington at csiro.au wrote:
> 
>> Full_Name: Mark Bravington
>> Version: 2.6.2 patched
>> OS: Windows XP Pro
>> Submission from: (NULL) (140.79.22.104)
>> 
>> 
>>> grep( '[:upper:]', letters, val=T) # shurely shouldn't
> match anything ??
>> [1] "e" "p" "r" "u"
>> 
>> The converse ( '[:lower:]' and LETTERS) seems to work OK.
>> 
>> --please do not edit the information below--
>> 
>> Version:
>> platform = i386-pc-mingw32
>> arch = i386
>> os = mingw32
>> system = i386, mingw32
>> status = Patched
>> major = 2
>> minor = 6.2
>> year = 2008
>> month = 03
>> day = 21
>> svn rev = 44836
>> language = R
>> version.string = R version 2.6.2 Patched (2008-03-21 r44836)
>> 
>> Windows XP (build 2600) Service Pack 2
>> 
>> Locale:
>> 
> LC_COLLATE=English_Australia.1252;LC_CTYPE=English_Australia.1252;LC_M
>> 
> ONETARY=English_Australia.1252;LC_NUMERIC=C;LC_TIME=English_Australia.
>> 1252
>> 
>> Search Path:
>> .GlobalEnv, package:stats, package:graphics, package:grDevices,
>> package:utils, package:datasets, package:methods, Autoloads, pa
>> 
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel



-- 
Mark Bravington
CSIRO Mathematical & Information Sciences
Marine Laboratory
Castray Esplanade
Hobart 7001
TAS

ph (+61) 3 6232 5118
fax (+61) 3 6232 5012
mob (+61) 438 315 623


From P.Dalgaard at biostat.ku.dk  Tue Mar 25 16:18:13 2008
From: P.Dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Tue, 25 Mar 2008 16:18:13 +0100
Subject: [Rd] R 2.7.0 scheduled for April 22, prereleases in progress
Message-ID: <47E917B5.6070202@biostat.ku.dk>

This is to announce that we plan to release R version 2.7.0 on Tuesday
April 22, 2008. The following information is mainly for developers,
package maintainers and repository maintainers.

The planned procedure is

Mar 25: "Grand Feature" Freeze  2.7.0 alpha
Apr  8: Feature Freeze          2.7.0 beta
Apr 15: Code Freeze             2.7.0 RC
Apr 22: Release                 2.7.0

GFF: No major restructuring past this point
FF:  Feature set complete, only bugfixing from now on
CF:  Only critical bugfixes and platform build issues

Maintainers of recommended packages should notice that as they become
part of the final R tarball, we expect them to follow a similar freeze
pattern (and beware of potential CRAN delays, so please do not cut it
too close to the deadlines).

Notice that the main structural discontinuities occurs at GFF:

The SVN repository is affected as follows
    The trunk version is set to "2.8.0 Under development (unstable)".
    A new branch, R-2-7-branch is created.

This also implies new version numbers for "r-devel" and
"r-release-branch", in the sense of

http://developer.r-project.org/SVNtips.html 

Also, "r-release-branch" needs to have its tag updated.

Repository maintainers may need to revise directory structures
accordingly.

"R 2.6.2 Patched" will be closed to further development at GFF (as all
the release branches, it can be reopened if the need arises, we just
don't anticipate such a need.)

The source alpha/beta/RC tarballs will be made available daily
(barring build troubles) by a cron job running at 4AM CET, and the
tarballs can be picked up at

http://cran.r-project.org/src/base-prerelease/

a little later.

The various freeze points are marked by changes to the VERSION file
this is also done automatically by a cron job which runs just after
midnight on the relevant days.

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907


From marentos at gmail.com  Tue Mar 25 22:03:01 2008
From: marentos at gmail.com (Georgios Marentakis)
Date: Tue, 25 Mar 2008 17:03:01 -0400
Subject: [Rd] R 64 on Intel Mac check problem
Message-ID: <3ba562220803251403r7ebded28qa751421030a6ae59@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20080325/be515943/attachment.pl 

From tplate at acm.org  Tue Mar 25 22:08:01 2008
From: tplate at acm.org (Tony Plate)
Date: Tue, 25 Mar 2008 15:08:01 -0600
Subject: [Rd] problem with 'install.packages'
In-Reply-To: <47E6A242.4000602@pdf.com>
References: <47E6A242.4000602@pdf.com>
Message-ID: <47E969B1.9030409@acm.org>

I'm also interested in a solution to this problem of how to update R 
packages without disturbing sessions that may be using them.

For S-PLUS I've been successfully using a system that always creates a 
new directory for an update of a library, eg., there could be multiple 
directories mylib.c0, mylib.c1, mylib.c2, etc.  A single file contains 
the current mapping with lines like "mylib: mylib.c2".  When a new 
library is published, the mapping file is updated.  When a library is 
attached, the custom "attach" function consults the mapping file to find 
the latest version.  This means that different sessions could have 
different versions of the library attached depending on when they 
attached it, and no in-use library will be overwritten.  Obsolete unused 
version of libraries can be cleaned out periodically.

I've been wondering whether "versioned installs" of packages could be 
used to achieve the same goals in R, e.g., with a system to 
automatically bump the third number in the version on each re-install.  
Could this work?  I read that "versioned installs" are not widely used 
and should be used with caution, and notes like "NB: versioned installs 
are not installs of a named package." in ?install.packages make me wary.

-- Tony Plate

Spencer Graves wrote:
> Hi, All: 
>
>       Is there a way to identify whether any users are using a 
> particular package in a shared network R installation? 
>
>       I ask, because we have such a multiple-user installation and when 
> I tried to install a package using Rgui that was in use by Rterm on a 
> single-user installation, 'install.packages' deleted the existing 
> package but failed to install the new version;  see below. 
>
>       I'm concerned especially about the following multiple user 
> scenario:  User A on terminalServer1 tries "install.packages('mvtnorm')" 
> when user B on terminalServer2 was using 'mvtnorm';  both are using the 
> same network installation.  If the results match my experience on a 
> single-user installation, the existing version will be deleted but the 
> new version will NOT be installed.  Any subsequent new attempt to access 
> 'mvtnorm' will fail until all current users of 'mvtnorm' quit those 
> sessions and someone subsequently invokes 
> "install.packages('mvtnorm')".  In fact, user B could have disconnected 
> from that session a month ago, and may have long forgotten the R session 
> that is still officially active, though perhaps consuming 0 CPU seconds 
> in the past month! 
>
>       Thanks,
>       Spencer
> #######################################
> ##
> ## Rgui
> ##
> #######################################
> R version 2.6.2 (2008-02-08)
> <snip>
>  > utils:::menuInstallPkgs()
> trying URL 
> 'http://cran.cnr.berkeley.edu/bin/windows/contrib/2.6/mvtnorm_0.8-3.zip'
> Content type 'application/zip' length 214769 bytes (209 Kb)
> opened URL
> downloaded 209 Kb
>
> package 'mvtnorm' successfully unpacked and MD5 sums checked
> Warning: cannot remove prior installation of package 'mvtnorm'
>
> The downloaded packages are in
>         C:\Documents and Settings\spencerg\Local 
> Settings\Temp\RtmpghgskA\downloaded_packages
> updating HTML package descriptions
>  > library(mvtnorm)
> Error in library(mvtnorm) : there is no package called 'mvtnorm'
>
>  > sessionInfo()
> R version 2.6.2 (2008-02-08)
> i386-pc-mingw32
>
> locale:
> LC_COLLATE=English_United States.1252;LC_CTYPE=English_United 
> States.1252;LC_MONETARY=English_United 
> States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base    
>
> loaded via a namespace (and not attached):
> Error in x[["Version"]] : subscript out of bounds
> In addition: Warning message:
> In FUN(c("mvtnorm", "tools")[[2L]], ...) :
>   DESCRIPTION file of package 'mvtnorm' is missing or broken
>  >
> #######################################
> ##
> ## Concurrent Rterm session
> ##
> #######################################
> R version 2.6.2 (2008-02-08)
>
> <snip>
>
>  > dmvnorm(1:2)
> [1] 0.01306423
> [1] ".GlobalEnv"        "package:mvtnorm"   "package:stats"   
>  [4] "package:graphics"  "package:grDevices" "package:utils"   
>  [7] "package:datasets"  "package:methods"   "Autoloads"       
> [10] "package:base"    
>  > detach()
>  > dmvnorm(1:2)
> Error: could not find function "dmvnorm"
>  > library(mvtnorm)
> Error in library(mvtnorm) : there is no package called 'mvtnorm'
>  > sessionInfo()
> R version 2.6.2 (2008-02-08)
> i386-pc-mingw32
>
> locale:
> LC_COLLATE=English_United States.1252;LC_CTYPE=English_United 
> States.1252;LC_MONETARY=English_United 
> States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base    
>
> loaded via a namespace (and not attached):
> Error in x[["Version"]] : subscript out of bounds
> In addition: Warning message:
> In FUN(c("mvtnorm", "stepAICc")[[2L]], ...) :
>   DESCRIPTION file of package 'mvtnorm' is missing or broken
>  >
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From John.Carson at shawgrp.com  Tue Mar 25 15:43:07 2008
From: John.Carson at shawgrp.com (Carson, John)
Date: Tue, 25 Mar 2008 09:43:07 -0500
Subject: [Rd] DLL problem
Message-ID: <79911294E2D6B14087F5AC36345A50BB44D789@entbtrxmb01.shawgrp.com>


I am using R version 2.6.2 (2008-02-08) on an XP Pro (version 2002 SP2). When I try to load the R library 'gtools', I get the following error:

>library(gtools)
Error in .Call("R_lazyLoadDBfetch", key, file, compressed, hook, PACKAGE = "base") : 
  C symbol name "R_lazyLoadDBfetch" not in DLL for package "base"

Any help or suggestions would be greatly appreciated.

Best wishes,
John



Carson, John, Ph.D.
Senior Statistician
Federal Applied Science and Engineering
Shaw Environmental & Infrastructure Group
16406 US Rte. 224 East
Findlay OH 45840
419-425-6156 direct
419-425-6085 fax
Shaw(tm) a world of Solutions(tm)?
www.shawgrp.com 
?

****Internet Email Confidentiality Footer****
Privileged/Confidential Information may be contained in this
message. If you are not the addressee indicated in this message (or
responsible for delivery of the message to such person), you may
not copy or deliver this message to anyone. In such case, you
should destroy this message and notify the sender by reply email.
Please advise immediately if you or your employer do not consent to
Internet email for messages of this kind. Opinions, conclusions and
other information in this message that do not relate to the
official business of The Shaw Group Inc. or its subsidiaries shall
be understood as neither given nor endorsed by it.
______________________________________ The Shaw Group Inc.
http://www.shawgrp.com


From Jerry.Lewis at biogenidec.com  Tue Mar 25 17:25:25 2008
From: Jerry.Lewis at biogenidec.com (Jerry.Lewis at biogenidec.com)
Date: Tue, 25 Mar 2008 17:25:25 +0100 (CET)
Subject: [Rd] wishlist: add functions to calculate noncentrality parameters
	(PR#11033)
Message-ID: <20080325162525.C0617282EFF7@mail.pubhealth.ku.dk>

Full_Name: Jerry W. Lewis
Version: 2.6.2
OS: Windows XP Professional
Submission from: (NULL) (198.180.131.16)


Some methods (sample size calculations, for instance) are based upon calculating
the noncentrality parameter needed to achieve a pre-specified value of the
noncentral cdf.  None of the distributions that support noncentrality parameters
have functions to return the noncentrality parameter given p.


From lodewijk.bonebakker at sun.com  Tue Mar 25 22:15:06 2008
From: lodewijk.bonebakker at sun.com (lodewijk.bonebakker at sun.com)
Date: Tue, 25 Mar 2008 22:15:06 +0100 (CET)
Subject: [Rd] Incorrect behavior in 64-bit version (PR#11034)
Message-ID: <20080325211506.B0292282EFF6@mail.pubhealth.ku.dk>

Full_Name: Lodewijk Bonebakker
Version: v2.6.2
OS: Solaris, x86, snv_80
Submission from: (NULL) (192.18.43.225)


when I build R in 32-bit mode on my 64-bit OS, R works as expected:

R version 2.6.2 (2008-02-08)
...
Type 'q()' to quit R.

> m <- matrix(ncol=2,c(1:6))
> 
> m
     [,1] [,2]
[1,]    1    4
[2,]    2    5
[3,]    3    6
> n <- log10(m)
> n
          [,1]      [,2]
[1,] 0.0000000 0.6020600
[2,] 0.3010300 0.6989700
[3,] 0.4771213 0.7781513
> 


On a 64-bit build, uisng *only* the "-m64" to instruct the sun compilers to
generate a 64 bit binary, the following happens (there are no compilation
errors)


R version 2.6.2 (2008-02-08)
...
Type 'q()' to quit R.

> 
>  m <- matrix(ncol=2,c(1:6))
> m
     [,1] [,2]
[1,]    1    4
[2,]    2    5
[3,]    3    6
> n <- log10(m)
Warning message:
In log(1:6, 10) : NaNs produced
> n
            [,1] [,2]
[1,]   0.1428914    0
[2,]  -1.1834403    0
[3,]         NaN    0
>


From p.dalgaard at biostat.ku.dk  Tue Mar 25 23:09:47 2008
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Tue, 25 Mar 2008 23:09:47 +0100
Subject: [Rd] Incorrect behavior in 64-bit version (PR#11034)
In-Reply-To: <20080325211506.B0292282EFF6@mail.pubhealth.ku.dk>
References: <20080325211506.B0292282EFF6@mail.pubhealth.ku.dk>
Message-ID: <47E9782B.1060608@biostat.ku.dk>

lodewijk.bonebakker at sun.com wrote:
> Full_Name: Lodewijk Bonebakker
> Version: v2.6.2
> OS: Solaris, x86, snv_80
> Submission from: (NULL) (192.18.43.225)
>
>
> when I build R in 32-bit mode on my 64-bit OS, R works as expected:
>
> R version 2.6.2 (2008-02-08)
> ...
> Type 'q()' to quit R.
>
>   
>> m <- matrix(ncol=2,c(1:6))
>>
>> m
>>     
>      [,1] [,2]
> [1,]    1    4
> [2,]    2    5
> [3,]    3    6
>   
>> n <- log10(m)
>> n
>>     
>           [,1]      [,2]
> [1,] 0.0000000 0.6020600
> [2,] 0.3010300 0.6989700
> [3,] 0.4771213 0.7781513
>   
>
>
> On a 64-bit build, uisng *only* the "-m64" to instruct the sun compilers to
> generate a 64 bit binary, the following happens (there are no compilation
> errors)
>
>
> R version 2.6.2 (2008-02-08)
> ...
> Type 'q()' to quit R.
>
>   
>>  m <- matrix(ncol=2,c(1:6))
>> m
>>     
>      [,1] [,2]
> [1,]    1    4
> [2,]    2    5
> [3,]    3    6
>   
>> n <- log10(m)
>>     
> Warning message:
> In log(1:6, 10) : NaNs produced
>   
>> n
>>     
>             [,1] [,2]
> [1,]   0.1428914    0
> [2,]  -1.1834403    0
> [3,]         NaN    0
>   
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>   
There is not sufficient information to go on here (with a sun.com 
address you could be expected to know better). R works fine as a 64 bit 
program on several platforms, as far as I know including Solaris, so the 
issue has to be specific to your compiler and library setup.

This has all the hallmarks of a math header file error (either args or 
return value declared of the wrong type), or a linker issue (log not 
really log). I surely hope it fails "make check"!

So, exactly what did you do, which compiler and build tools and which 
version?
Did you read the http://cran.r-project.org/doc/manuals/R-admin.html, 
including Appendix C?
(Please keep R-bugs in the recipient list. I'm not the resident expert.)

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907


From ripley at stats.ox.ac.uk  Tue Mar 25 23:39:01 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 25 Mar 2008 22:39:01 +0000 (GMT)
Subject: [Rd] R 64 on Intel Mac check problem
In-Reply-To: <3ba562220803251403r7ebded28qa751421030a6ae59@mail.gmail.com>
References: <3ba562220803251403r7ebded28qa751421030a6ae59@mail.gmail.com>
Message-ID: <alpine.LFD.1.00.0803252231230.29859@gannet.stats.ox.ac.uk>

I saw this yesterday, on my newly reinstalled iMac (10.5.2), with the 
Xcode compiler + gfortran from R 2.6.2.

It looks very like a compiler bug: if I insert a printf statement in 
stem.c I get the correct answer, and if I compile src/appl/stem.c without 
optimization I get the correct answer.

So, I suggest lowering the optimization level, but the worry always is 
that if you have one piece of code miscompiled there may be others.

On Tue, 25 Mar 2008, Georgios Marentakis wrote:

> Dear all, I have been following the instructions on
> http://cran.stat.sfu.ca/with the intention to install R with 64 bits
> support on an 8 core Intel Mac
> with 6 GB of memory. I am doing this so I can run an analysis that requires
> 1.6 gB of memory allocation and would not run on 32 bit version of R as I
> was advised and experienced.
> I have installed gcc 4.2 and gfortran 4.2 from the available sources on the
> web page and am using the copy and paste guide on the page.
>
> Now everything seems to be going fine until the point where the R packages
> are tested. In particular when the regression tests are run I get the
> following.
>
> running regression tests
> running code in 'reg-tests-1.R' ...\c
> OK
> running code in 'reg-tests-2.R' ...\c
> OK
> comparing 'reg-tests-2.Rout' to './reg-tests-2.Rout.save' ...\c
> 3756c3756
> <   The decimal point is 1 digit(s) to the right of the |
> ---
>>   The decimal point is at the |
> 3762c3762
> <   The decimal point is 1 digit(s) to the right of the |
> ---
>>   The decimal point is 1 digit(s) to the left of the |
> 3764c3764
> <   0 | 1111111111
> ---
>>   1 | 0000000000
> make[3]: *** [reg-tests-2.Rout] Error 1
> make[2]: *** [test-Reg] Error 2
> make[1]: *** [test-all-basics] Error 1
> make: *** [check] Error 2
>
> Would any of you be able to point me to what is the reason for this?
> thanks,
> georgios
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Wed Mar 26 00:20:14 2008
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Wed, 26 Mar 2008 00:20:14 +0100 (CET)
Subject: [Rd] Incorrect behavior in 64-bit version (PR#11034)
Message-ID: <20080325232014.3DFF6282EFF6@mail.pubhealth.ku.dk>

  This message is in MIME format.  The first part should be readable text,
  while the remaining parts are likely unreadable without MIME-aware tools.

--27495890-661127544-1206487153=:18251
Content-Type: TEXT/PLAIN; charset=iso-8859-1; format=flowed
Content-Transfer-Encoding: 8BIT

Yes, R has been built in 64-bit mode on amd64 Solaris 10 (and it is not 
going to work on x86, is it?).  As far as I can see I used the SunStudio 
11 compilers (which the box shipped with: there is also SunStudio 12 on 
there) with

blackhawk% cat config.site
CC="cc -xc99 -xarch=amd64"
CFLAGS=-'O -xlibmieee'
F77="f95 -xarch=amd64"
FFLAGS=-O4
...

> m <- matrix(ncol=2, 1:6)
> log10(m)
           [,1]      [,2]
[1,] 0.0000000 0.6020600
[2,] 0.3010300 0.6989700
[3,] 0.4771213 0.7781513

(It's a pretty bare build, without either readline or GNU iconv.)

blackhawk% cc -V
cc: Sun C 5.8 Patch 121016-07 2007/10/03
blackhawk% f95 -V
f95: Sun Fortran 95 8.2 Patch 121020-08 2008/02/05

I suppose we are just supposed to know that '5.8'  and '8.2' mean 11.
As I recall there was a good reason why I reduced the optimization level 
-- I used -xO5 and -O5 on Sparc Solaris and the SunStudio x86_64 Linux 
compilers so I suspect that something did not work at those levels.

On Tue, 25 Mar 2008, Peter Dalgaard wrote:

> lodewijk.bonebakker at sun.com wrote:
>> Full_Name: Lodewijk Bonebakker
>> Version: v2.6.2
>> OS: Solaris, x86, snv_80
>> Submission from: (NULL) (192.18.43.225)
>>
>>
>> when I build R in 32-bit mode on my 64-bit OS, R works as expected:
>>
>> R version 2.6.2 (2008-02-08)
>> ...
>> Type 'q()' to quit R.
>>
>>
>>> m <- matrix(ncol=2,c(1:6))
>>>
>>> m
>>>
>>      [,1] [,2]
>> [1,]    1    4
>> [2,]    2    5
>> [3,]    3    6
>>
>>> n <- log10(m)
>>> n
>>>
>>           [,1]      [,2]
>> [1,] 0.0000000 0.6020600
>> [2,] 0.3010300 0.6989700
>> [3,] 0.4771213 0.7781513
>>
>>
>>
>> On a 64-bit build, uisng *only* the "-m64" to instruct the sun compilers to
>> generate a 64 bit binary, the following happens (there are no compilation
>> errors)
>>
>>
>> R version 2.6.2 (2008-02-08)
>> ...
>> Type 'q()' to quit R.
>>
>>
>>>  m <- matrix(ncol=2,c(1:6))
>>> m
>>>
>>      [,1] [,2]
>> [1,]    1    4
>> [2,]    2    5
>> [3,]    3    6
>>
>>> n <- log10(m)
>>>
>> Warning message:
>> In log(1:6, 10) : NaNs produced
>>
>>> n
>>>
>>             [,1] [,2]
>> [1,]   0.1428914    0
>> [2,]  -1.1834403    0
>> [3,]         NaN    0
>>
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
> There is not sufficient information to go on here (with a sun.com
> address you could be expected to know better). R works fine as a 64 bit
> program on several platforms, as far as I know including Solaris, so the
> issue has to be specific to your compiler and library setup.
>
> This has all the hallmarks of a math header file error (either args or
> return value declared of the wrong type), or a linker issue (log not
> really log). I surely hope it fails "make check"!
>
> So, exactly what did you do, which compiler and build tools and which
> version?
> Did you read the http://cran.r-project.org/doc/manuals/R-admin.html,
> including Appendix C?
> (Please keep R-bugs in the recipient list. I'm not the resident expert.)
>
> --
>   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
>  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
> (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
> ~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595
--27495890-661127544-1206487153=:18251--


From marentos at gmail.com  Wed Mar 26 01:41:40 2008
From: marentos at gmail.com (Georgios Marentakis)
Date: Tue, 25 Mar 2008 20:41:40 -0400
Subject: [Rd] R 64 on Intel Mac check problem
In-Reply-To: <alpine.LFD.1.00.0803252231230.29859@gannet.stats.ox.ac.uk>
References: <3ba562220803251403r7ebded28qa751421030a6ae59@mail.gmail.com>
	<alpine.LFD.1.00.0803252231230.29859@gannet.stats.ox.ac.uk>
Message-ID: <3ba562220803251741q3387d377w3692d975e2cbb7b2@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20080325/502a162d/attachment.pl 

From ripley at stats.ox.ac.uk  Wed Mar 26 08:39:31 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 26 Mar 2008 07:39:31 +0000 (GMT)
Subject: [Rd] R 64 on Intel Mac check problem
In-Reply-To: <3ba562220803251741q3387d377w3692d975e2cbb7b2@mail.gmail.com>
References: <3ba562220803251403r7ebded28qa751421030a6ae59@mail.gmail.com>
	<alpine.LFD.1.00.0803252231230.29859@gannet.stats.ox.ac.uk>
	<3ba562220803251741q3387d377w3692d975e2cbb7b2@mail.gmail.com>
Message-ID: <alpine.LFD.1.00.0803260731020.26496@auk.stats.ox.ac.uk>

On Tue, 25 Mar 2008, Georgios Marentakis wrote:

> many thanks for the response.
> I tried compiling without optimization and it still gives me the same
> problem.
> Would you think it is something related to the package? Could it be that I
> should use another version  of the particular package than the one included?
> Or could it be something with the way the results are compared?
> Would you suggest I can trust this version of R for performing the
> statistical analysis I am after?

Note that your compiler is not the same as mine (from Xcode 3.0).  If it 
fails without optimization, I would not trust it. I don't know though 
which it is: http://cran.stat.sfu.ca/with is not a valid URL, and I don't 
know which instructions you followed (assuming they are somewhere on 
CRAN).

Simon Urbanek is making available quad-arch experimental builds of 
R-devel, and I suggest you try one of those.  (I haven't, but then I have 
other, reliable, 64-bit platforms and am only doing this to test changes 
to R.)

> many thanks,
> georgios
>
>
> On Tue, Mar 25, 2008 at 6:39 PM, Prof Brian Ripley <ripley at stats.ox.ac.uk>
> wrote:
>
>> I saw this yesterday, on my newly reinstalled iMac (10.5.2), with the
>> Xcode compiler + gfortran from R 2.6.2.
>>
>> It looks very like a compiler bug: if I insert a printf statement in
>> stem.c I get the correct answer, and if I compile src/appl/stem.c without
>> optimization I get the correct answer.
>>
>> So, I suggest lowering the optimization level, but the worry always is
>> that if you have one piece of code miscompiled there may be others.
>>
>> On Tue, 25 Mar 2008, Georgios Marentakis wrote:
>>
>>> Dear all, I have been following the instructions on
>>> http://cran.stat.sfu.ca/with the intention to install R with 64 bits
>>> support on an 8 core Intel Mac
>>> with 6 GB of memory. I am doing this so I can run an analysis that
>> requires
>>> 1.6 gB of memory allocation and would not run on 32 bit version of R as
>> I
>>> was advised and experienced.
>>> I have installed gcc 4.2 and gfortran 4.2 from the available sources on
>> the
>>> web page and am using the copy and paste guide on the page.
>>>
>>> Now everything seems to be going fine until the point where the R
>> packages
>>> are tested. In particular when the regression tests are run I get the
>>> following.
>>>
>>> running regression tests
>>> running code in 'reg-tests-1.R' ...\c
>>> OK
>>> running code in 'reg-tests-2.R' ...\c
>>> OK
>>> comparing 'reg-tests-2.Rout' to './reg-tests-2.Rout.save' ...\c
>>> 3756c3756
>>> <   The decimal point is 1 digit(s) to the right of the |
>>> ---
>>>>   The decimal point is at the |
>>> 3762c3762
>>> <   The decimal point is 1 digit(s) to the right of the |
>>> ---
>>>>   The decimal point is 1 digit(s) to the left of the |
>>> 3764c3764
>>> <   0 | 1111111111
>>> ---
>>>>   1 | 0000000000
>>> make[3]: *** [reg-tests-2.Rout] Error 1
>>> make[2]: *** [test-Reg] Error 2
>>> make[1]: *** [test-all-basics] Error 1
>>> make: *** [check] Error 2
>>>
>>> Would any of you be able to point me to what is the reason for this?
>>> thanks,
>>> georgios
>>>
>>>       [[alternative HTML version deleted]]
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>
>> --
>> Brian D. Ripley,                  ripley at stats.ox.ac.uk
>> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/<http://www.stats.ox.ac.uk/%7Eripley/>
>> University of Oxford,             Tel:  +44 1865 272861 (self)
>> 1 South Parks Road,                     +44 1865 272866 (PA)
>> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>>
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From Jerry.Lewis at biogenidec.com  Wed Mar 26 05:10:04 2008
From: Jerry.Lewis at biogenidec.com (Jerry.Lewis at biogenidec.com)
Date: Wed, 26 Mar 2008 05:10:04 +0100 (CET)
Subject: [Rd] choose fails a fundamental property of binomial coefficients
	(PR#11035)
Message-ID: <20080326041004.4AD94282EFF6@mail.pubhealth.ku.dk>

Full_Name: Jerry W. Lewis
Version: 2.7.0 (2008-03-23 r44847)
OS: Windows XP Professional
Submission from: (NULL) (71.184.230.48)


choose(n,k) = choose(n,n-k) is not satisfied if either

1. n is a negative integer with k a positive integer (due to automatically
returning 0 for n-k<0)

2. n is not an integer with k a positive integer (due to rounding n-k to an
integer, compounded by automatically returning 0 if n<0 which implies n-k<0)

Both are easily fixed, as discussed in PR# 10766


From richardwreed at gmail.com  Wed Mar 26 05:15:03 2008
From: richardwreed at gmail.com (richardwreed at gmail.com)
Date: Wed, 26 Mar 2008 05:15:03 +0100 (CET)
Subject: [Rd] Misc/List Search Path from keyboard (PR#11036)
Message-ID: <20080326041503.4FD16282EFF6@mail.pubhealth.ku.dk>

Full_Name: Richard Reed
Version: 2.6.2
OS: MS Windows XP Pro
Submission from: (NULL) (76.121.170.35)


Pressing Alt-M+s doesn't search path. It just generates another ">". It does
this in "vanilla" too. However, Alt-M+click "list search path" does work. Note
that when I press Alt-M (and the "Misc" menu drops down) the second "s" in "list
search way" is underlined indicating the "s" should complete the command.

> version
platform       i386-pc-mingw32             
arch           i386                        
os             mingw32                     
system         i386, mingw32               
status                                     
major          2                           
minor          6.2                         
year           2008                        
month          02                          
day            08                          
svn rev        44383                       
language       R                           
version.string R version 2.6.2 (2008-02-08)


From Lodewijk.Bonebakker at sun.com  Wed Mar 26 00:21:24 2008
From: Lodewijk.Bonebakker at sun.com (Lodewijk Bonebakker)
Date: Tue, 25 Mar 2008 16:21:24 -0700
Subject: [Rd] Incorrect behavior in 64-bit version (PR#11034) (solved)
In-Reply-To: <47E9782B.1060608@biostat.ku.dk>
References: <20080325211506.B0292282EFF6@mail.pubhealth.ku.dk>
	<47E9782B.1060608@biostat.ku.dk>
Message-ID: <F53A7F3B-8F03-47B5-B250-C8FC55D99351@sun.com>

Peter,

thank you for your reply, the provided link had the answer:

The problem is the Sun cc compiler not following the C99 syntax  
standard. Adding -xc99 to compiler flags fixed the problem.

My incorrect assumption was that configure.in would contain most of  
the recommended flags for compilation, combined with using the same  
wrapper script for compilation that has worked successfully since  
version 1.9. Obviously it is no longer current and I have added 'make  
check' as additional safety.

Thank you again,

Lodewijk Bonebakker


For general interest (since this is going to be public anyway), here  
is my wrapper script:

#!/bin/bash
## quick-buildR,64
##
## build R, libiconv and readline should be installed in /usr/sfw/lib/ 
amd64
##
export CC="cc -xc99"
export CPP=""
export CXX=CC
export FC=f95
export F77=f95
##
export BASEFLAGS="-m64 -I/usr/sfw/include"
# export FPICFLAGS="-Bdynamic -G"
# export CXXPICFLAGS="-pic"
# export SHLIB_CXXFLAGS="-Bdynamic -G"
# export MAIN_CFLAGS="-m64 -I/usr/sfw/include"
# export SHLIB_CFLAGS="-m64"
# export MAIN_FFLAGS="-m64"
# export SHLIB_FFLAGS="-m64"
##
export CFLAGS="${BASEFLAGS} -O -xO5 -xc99 -xlibmieee -xlibmil -nofstore"
export FFLAGS="${BASEFLAGS} -O5 -libmil -nofstore"
export CXXFLAGS="${BASEFLAGS} -O -xO5 -xlibmil -nofstore"
export FCFLAGS=${FFLAGS}
export SHLIB_CXXLDFLAGS="-G -lCstd"
export SAFE_FFLAGS="-O5 -libmil -fstore"
##
export LDFLAGS="-m64 -L/usr/sfw/lib/amd64  -L/usr/sfw/lib"

##
./configure --prefix=/opt/R/v2.6.2,64 --with-blas=sunperf --with-lapack

RESULT=$?
if [ $RESULT -eq 0 ]; then
         gmake
         RESULT=$?
fi
if [ $RESULT -eq 0 ]; then
         gmake check
	RESULT=$?
fi
if [ $RESULT -eq 0 ]; then
         gmake install
         RESULT=$?
fi
echo "RESULT $RESULT"

## end of script



On Mar 25, 2008, at 15:09, Peter Dalgaard wrote:

> lodewijk.bonebakker at sun.com wrote:
>> Full_Name: Lodewijk Bonebakker
>> Version: v2.6.2
>> OS: Solaris, x86, snv_80
>> Submission from: (NULL) (192.18.43.225)
>>
>>
>> when I build R in 32-bit mode on my 64-bit OS, R works as expected:
>>
>> R version 2.6.2 (2008-02-08)
>> ...
>> Type 'q()' to quit R.
>>
>>
>>> m <- matrix(ncol=2,c(1:6))
>>>
>>> m
>>>
>>     [,1] [,2]
>> [1,]    1    4
>> [2,]    2    5
>> [3,]    3    6
>>
>>> n <- log10(m)
>>> n
>>>
>>          [,1]      [,2]
>> [1,] 0.0000000 0.6020600
>> [2,] 0.3010300 0.6989700
>> [3,] 0.4771213 0.7781513
>>
>>
>> On a 64-bit build, uisng *only* the "-m64" to instruct the sun  
>> compilers to
>> generate a 64 bit binary, the following happens (there are no  
>> compilation
>> errors)
>>
>>
>> R version 2.6.2 (2008-02-08)
>> ...
>> Type 'q()' to quit R.
>>
>>
>>> m <- matrix(ncol=2,c(1:6))
>>> m
>>>
>>     [,1] [,2]
>> [1,]    1    4
>> [2,]    2    5
>> [3,]    3    6
>>
>>> n <- log10(m)
>>>
>> Warning message:
>> In log(1:6, 10) : NaNs produced
>>
>>> n
>>>
>>            [,1] [,2]
>> [1,]   0.1428914    0
>> [2,]  -1.1834403    0
>> [3,]         NaN    0
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
> There is not sufficient information to go on here (with a sun.com  
> address you could be expected to know better). R works fine as a 64  
> bit program on several platforms, as far as I know including  
> Solaris, so the issue has to be specific to your compiler and  
> library setup.
>
> This has all the hallmarks of a math header file error (either args  
> or return value declared of the wrong type), or a linker issue (log  
> not really log). I surely hope it fails "make check"!
>
> So, exactly what did you do, which compiler and build tools and  
> which version?
> Did you read the http://cran.r-project.org/doc/manuals/R-admin.html,  
> including Appendix C?
> (Please keep R-bugs in the recipient list. I'm not the resident  
> expert.)
>
> -- 
>  O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
> c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
> (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45)  
> 35327918
> ~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45)  
> 35327907
>
>


From osklyar at maninvestments.com  Wed Mar 26 10:35:40 2008
From: osklyar at maninvestments.com (Sklyar, Oleg (MI London))
Date: Wed, 26 Mar 2008 09:35:40 -0000
Subject: [Rd] as.POSIXct/as.POSIXlt generics
Message-ID: <1A68FCB28DE72F4BA3B967E6506CCE43022947F1@mildnpexmb01.maninvestments.ad.man.com>

Hi,

I am trying to define the as.POSIXct as an S4 method for one of my
classes. Trying to define a generic, I am getting an error that it is
already differently defined in base. However, if I query for it, there
is no definition. Being in base, I also cannot really import it. If I
define methods without definig a generic, they will work but with a
warning that a new generic will be automatically created. See the code
chunk below. Any idea how to make it work w/o warnings?

All the same for as.POSIXlt.

Using S3 definition instead works for the parent class, but seems to
require an additional definition for derived ones, well, I'd rather
avoid S3.

Thanks, Oleg

Help page definition: 

> ?as.POSIXct
Usage:
as.POSIXct(x, tz = "")

osklyar:R > R
*** R version 2.6.2 (2008-02-08) ***
> getGeneric("as.POSIXct")
NULL

> setGeneric("as.POSIXct", function(x, tz)
standardGeneric("as.POSIXct"))
New generic for "as.POSIXct" does not agree with implicit generic from
package "base"; a new generic will be assigned with package ".GlobalEnv"
[1] "as.POSIXct"

osklyar:R > R
*** R version 2.6.2 (2008-02-08) ***
> source("TimeDate.R")
Creating a new generic function for "as.POSIXct" in ".GlobalEnv"
Creating a new generic function for "as.POSIXlt" in ".GlobalEnv"

The latter executes: setMethod("as.POSIXct", w/o setGeneric

> sessionInfo()
R version 2.6.2 (2008-02-08)
x86_64-unknown-linux-gnu

locale:
LC_CTYPE=en_GB.UTF-8;LC_NUMERIC=C;LC_TIME=en_GB.UTF-8;LC_COLLATE=C;LC_MO
NETARY=en_GB.UTF-8;LC_MESSAGES=en_GB.UTF-8;LC_PAPER=en_GB.UTF-8;LC_NAME=
C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_GB.UTF-8;LC_IDENTIFICATI
ON=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

Dr Oleg Sklyar
Technology Group
Man Investments Ltd
+44 (0)20 7144 3803
osklyar at maninvestments.com


**********************************************************************
The contents of this email are for the named addressee(s) only.
It contains information which may be confidential and privileged.
If you are not the intended recipient, please notify the sender
immediately, destroy this email and any attachments and do not
otherwise disclose or use them. Email transmission is not a
secure method of communication and Man Investments cannot accept
responsibility for the completeness or accuracy of this email or
any attachments. Whilst Man Investments makes every effort to keep
its network free from viruses, it does not accept responsibility
for any computer virus which might be transferred by way of this
email or any attachments. This email does not constitute a request,
offer, recommendation or solicitation of any kind to buy, subscribe,
sell or redeem any investment instruments or to perform other such
transactions of any kind. Man Investments reserves the right to
monitor, record and retain all electronic communications through
its network to ensure the integrity of its systems, for record
keeping and regulatory purposes. 

Visit us at: www.maninvestments.com


From maechler at stat.math.ethz.ch  Wed Mar 26 11:02:37 2008
From: maechler at stat.math.ethz.ch (maechler at stat.math.ethz.ch)
Date: Wed, 26 Mar 2008 11:02:37 +0100 (CET)
Subject: [Rd] choose fails a fundamental property of binomial
	coefficients (PR#11035)
Message-ID: <20080326100237.8B9F42834619@mail.pubhealth.ku.dk>

>>>>> "JL" == Jerry Lewis <Jerry.Lewis at biogenidec.com>
>>>>>     on Wed, 26 Mar 2008 05:10:04 +0100 (CET) writes:

    JL> Full_Name: Jerry W. Lewis Version: 2.7.0 (2008-03-23
    JL> r44847) OS: Windows XP Professional Submission from:
    JL> (NULL) (71.184.230.48)


    JL> choose(n,k) = choose(n,n-k) is not satisfied if either

    JL> 1. n is a negative integer with k a positive integer
    JL> (due to automatically returning 0 for n-k<0)


    JL> 2. n is not an integer with k a positive integer (due to
    JL> rounding n-k to an integer, compounded by automatically
    JL> returning 0 if n<0 which implies n-k<0)


I think you have not really understood from help(choose)
that we have

     choose(n,k) :=  n(n-1)...(n-k+1) / k!

defined for non-negative integer k and arbitrary real n

This definition has the very important property that it is used
in the 'binomial theorem' and everything depending on that
theorem,

   (1 + x) ^ \alpha =  \sum_{k=0}^\infty  choose(x,k) x^k

which holds   for all |x| < 1   for all \alpha \in \R

-------

Your "fundamental" property does only hold when  n is
non-negative integer.

Definitely no bug in R here!

Martin Maechler, ETH Zurich


From ligges at statistik.tu-dortmund.de  Wed Mar 26 11:20:12 2008
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Wed, 26 Mar 2008 11:20:12 +0100
Subject: [Rd] DLL problem
In-Reply-To: <79911294E2D6B14087F5AC36345A50BB44D789@entbtrxmb01.shawgrp.com>
References: <79911294E2D6B14087F5AC36345A50BB44D789@entbtrxmb01.shawgrp.com>
Message-ID: <47EA235C.6090908@statistik.tu-dortmund.de>



Carson, John wrote:
> I am using R version 2.6.2 (2008-02-08) on an XP Pro (version 2002 SP2). When I try to load the R library 'gtools', I get the following error:
> 
>> library(gtools)
> Error in .Call("R_lazyLoadDBfetch", key, file, compressed, hook, PACKAGE = "base") : 
>   C symbol name "R_lazyLoadDBfetch" not in DLL for package "base"


I guess your version of gtools has been compiled for R < 2.6.0.
Please start R without loading packages and run
   update.packages(checkBuilt = TRUE)
Then try again.

Best wishes,
Uwe Ligges



> Any help or suggestions would be greatly appreciated.
> 
> Best wishes,
> John
> 
> 
> 
> Carson, John, Ph.D.
> Senior Statistician
> Federal Applied Science and Engineering
> Shaw Environmental & Infrastructure Group
> 16406 US Rte. 224 East
> Findlay OH 45840
> 419-425-6156 direct
> 419-425-6085 fax
> Shaw(tm) a world of Solutions(tm) 
> www.shawgrp.com 
>  
> 
> ****Internet Email Confidentiality Footer****
> Privileged/Confidential Information may be contained in this
> message. If you are not the addressee indicated in this message (or
> responsible for delivery of the message to such person), you may
> not copy or deliver this message to anyone. In such case, you
> should destroy this message and notify the sender by reply email.
> Please advise immediately if you or your employer do not consent to
> Internet email for messages of this kind. Opinions, conclusions and
> other information in this message that do not relate to the
> official business of The Shaw Group Inc. or its subsidiaries shall
> be understood as neither given nor endorsed by it.
> ______________________________________ The Shaw Group Inc.
> http://www.shawgrp.com
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From maechler at stat.math.ethz.ch  Wed Mar 26 12:10:15 2008
From: maechler at stat.math.ethz.ch (maechler at stat.math.ethz.ch)
Date: Wed, 26 Mar 2008 12:10:15 +0100 (CET)
Subject: [Rd] choose fails a fundamental property of binomial
	coefficients (PR#11035)
Message-ID: <20080326111015.9B584283416C@mail.pubhealth.ku.dk>

>>>>> "MM" == Martin Maechler <maechler at stat.math.ethz.ch>
>>>>>     on Wed, 26 Mar 2008 11:02:37 +0100 (CET) writes:

>>>>> "JL" == Jerry Lewis <Jerry.Lewis at biogenidec.com>
>>>>>     on Wed, 26 Mar 2008 05:10:04 +0100 (CET) writes:

      JL> Full_Name: Jerry W. Lewis Version: 2.7.0 (2008-03-23
      JL> r44847) OS: Windows XP Professional Submission from:
      JL> (NULL) (71.184.230.48)


      JL> choose(n,k) = choose(n,n-k) is not satisfied if either

      JL> 1. n is a negative integer with k a positive integer
      JL> (due to automatically returning 0 for n-k<0)


      JL> 2. n is not an integer with k a positive integer (due to
      JL> rounding n-k to an integer, compounded by automatically
      JL> returning 0 if n<0 which implies n-k<0)


    MM> I think you have not really understood from help(choose)
    MM> that we have

    MM> choose(n,k) :=  n(n-1)...(n-k+1) / k!

    MM> defined for non-negative integer k and arbitrary real n

    MM> This definition has the very important property that it is used
    MM> in the 'binomial theorem' and everything depending on that
    MM> theorem,

    MM> (1 + x) ^ \alpha =  \sum_{k=0}^\infty  choose(x,k) x^k

Oops!  "Of course", I meant   'choose(\alpha,k)' , not 'choose(x,k)'

    MM> which holds   for all |x| < 1   for all \alpha \in \R

    MM> -------

    MM> Your "fundamental" property does only hold when  n is
    MM> non-negative integer.

    MM> Definitely no bug in R here!

Martin Maechler, ETH Zurich


From rpeng at jhsph.edu  Wed Mar 26 14:18:19 2008
From: rpeng at jhsph.edu (Roger D. Peng)
Date: Wed, 26 Mar 2008 09:18:19 -0400
Subject: [Rd] cut.Date and cut.POSIXt problem
In-Reply-To: <47E2D3BB.2080106@comcast.net>
References: <971536df0803181004x5ebbe960q6879506089b3e428@mail.gmail.com>
	<47E010CD.6090200@jhsph.edu> <47E2D3BB.2080106@comcast.net>
Message-ID: <47EA4D1B.3050903@jhsph.edu>

I have applied these patches to R-devel and in my limited testing they appear to 
work as desired.  I have to say that I never ran into the problem these patches 
were meant to solve so I may not be the best person to do the testing.

-roger

Marc Schwartz wrote:
> Hi all,
> 
> Apologies for the delay in my engaging in this thread. I was traveling 
> this week.
> 
> The problem that Gabor raised was caused by the patch that I submitted 
> to fix a problem with the referenced functions when using 'months' and 
> 'years' as the interval. The prior versions were problematic:
> 
>   https://stat.ethz.ch/pipermail/r-devel/2008-January/048004.html
> 
> The patch fixed the error, but since I used hist.Date() as the reference 
> model and did not note the subtle difference in cut.Date() relative to 
> specifying the breaks increment value, this functionality was lost when 
> the same modification was made to the code in cut.Date().
> 
> Roger's patch helps, but does not totally remedy the situation. One also 
> needs to modify the method used for specifying the max value 'end' for 
> the breaks in order to include the max 'x' Date value in the result.
> 
> Hence, I am attaching proposed patches against R-devel for 
> base:::dates.R and base:::datetime.R.
> 
> I am also attaching a patch for tests:::reg-tests-1.R to add a check for 
> this situation to the regression tests that were also added subsequent 
> to that prior set of patches that I had submitted.
> 
> If perhaps Roger and Gabor could so some testing on these patches before 
> they are considered for inclusion into the R-devel tree, it would be 
> helpful to check to see if I have missed something else here.
> 
> Thanks for raising this issue.
> 
> Regards,
> 
> Marc Schwartz
> 
> Roger D. Peng wrote:
>> Seems changes in r44116 force the interval to be single months (or 
>> years) instead of whatever the user specified.  I think the attached 
>> patches correct this.
>>
>> Interestingly, 'cut' and 'seq' allow for the 'breaks' specification to 
>> be something like "3 months" but the documentation for 'hist' does not 
>> allow for this type of specification.
>>
>> -roger
>>
>> Gabor Grothendieck wrote:
>>> cut.Date and cut.POSIXt indicate that the breaks argument
>>> can be an integer followed by a space followed by "year", etc.
>>> but it seems the integer is ignored.
>>>
>>> For example, I assume that breaks = "3 months" is supposed
>>> to cut it into quarters but, in fact, it cuts it into months as if
>>> 3 had not been there.
>>>
>>>> d <- seq(Sys.Date(), length = 12, by = "month")
>>>> cut(d, "3 months")
>>>  [1] 2008-03-01 2008-04-01 2008-05-01 2008-06-01 2008-07-01 2008-08-01
>>> 2008-09-01 2008-10-01 2008-11-01 2008-12-01 2009-01-01 2009-02-01
>>> Levels: 2008-03-01 2008-04-01 2008-05-01 2008-06-01 2008-07-01
>>> 2008-08-01 2008-09-01 2008-10-01 2008-11-01 2008-12-01 2009-01-01
>>> 2009-02-01
>>>> cut(as.POSIXct(d), "3 months")
>>>  [1] 2008-03-01 2008-04-01 2008-05-01 2008-06-01 2008-07-01 2008-08-01
>>> 2008-09-01 2008-10-01 2008-11-01 2008-12-01 2009-01-01 2009-02-01
>>> Levels: 2008-03-01 2008-04-01 2008-05-01 2008-06-01 2008-07-01
>>> 2008-08-01 2008-09-01 2008-10-01 2008-11-01 2008-12-01 2009-01-01
>>> 2009-02-01
>>>> cut(as.POSIXlt(d), "3 months")
>>>  [1] 2008-03-01 2008-04-01 2008-05-01 2008-06-01 2008-07-01 2008-08-01
>>> 2008-09-01 2008-10-01 2008-11-01 2008-12-01 2009-01-01 2009-02-01
>>> Levels: 2008-03-01 2008-04-01 2008-05-01 2008-06-01 2008-07-01
>>> 2008-08-01 2008-09-01 2008-10-01 2008-11-01 2008-12-01 2009-01-01
>>> 2009-02-01
>>>
> 
> ------------------------------------------------------------------------
> 
> --- datesORIG.R	2008-03-20 14:25:13.000000000 -0500
> +++ dates.R	2008-03-20 14:38:21.000000000 -0500
> @@ -322,17 +322,19 @@
>  	if(valid == 3) {
>          start$mday <- 1
>          end <- as.POSIXlt(max(x, na.rm = TRUE))
> -        end <- as.POSIXlt(end + (31 * 86400))
> +        step <- ifelse(length(by2) == 2, as.integer(by2[1]), 1)
> +        end <- as.POSIXlt(end + (31 * step * 86400))
>          end$mday <- 1
> -        breaks <- as.Date(seq(start, end, "months"))
> +        breaks <- as.Date(seq(start, end, breaks))
>      } else if(valid == 4) {
>          start$mon <- 0
>          start$mday <- 1
>          end <- as.POSIXlt(max(x, na.rm = TRUE))
> -        end <- as.POSIXlt(end + (366 * 86400))
> +        step <- ifelse(length(by2) == 2, as.integer(by2[1]), 1)
> +        end <- as.POSIXlt(end + (366 * step * 86400))
>          end$mon <- 0
>          end$mday <- 1
> -        breaks <- as.Date(seq(start, end, "years"))
> +        breaks <- as.Date(seq(start, end, breaks))
>      } else {
>          start <- .Internal(POSIXlt2Date(start))
>          if (length(by2) == 2) incr <- incr * as.integer(by2[1])
> 
> 
> ------------------------------------------------------------------------
> 
> --- datetimeORIG.R	2008-03-20 14:25:20.000000000 -0500
> +++ datetime.R	2008-03-20 15:25:49.000000000 -0500
> @@ -727,17 +727,19 @@
>  	if(valid == 6) {
>          start$mday <- 1
>          end <- as.POSIXlt(max(x, na.rm = TRUE))
> -        end <- as.POSIXlt(end + (31 * 86400))
> +        step <- ifelse(length(by2) == 2, as.integer(by2[1]), 1)
> +        end <- as.POSIXlt(end + (31 * step * 86400))
>          end$mday <- 1
> -        breaks <- seq(start, end, "months")
> +        breaks <- seq(start, end, breaks)
>      } else if(valid == 7) {
>          start$mon <- 0
>          start$mday <- 1
>          end <- as.POSIXlt(max(x, na.rm = TRUE))
> -        end <- as.POSIXlt(end + (366 * 86400))
> +        step <- ifelse(length(by2) == 2, as.integer(by2[1]), 1)
> +        end <- as.POSIXlt(end + (366 * step* 86400))
>          end$mon <- 0
>          end$mday <- 1
> -        breaks <- seq(start, end, "years")
> +        breaks <- seq(start, end, breaks)
>      } else {
>          if (length(by2) == 2) incr <- incr * as.integer(by2[1])
>  	    maxx <- max(x, na.rm = TRUE)
> 
> 
> ------------------------------------------------------------------------
> 
> --- reg-tests-1ORIG.R	2008-03-20 09:18:19.000000000 -0500
> +++ reg-tests-1.R	2008-03-20 15:15:56.000000000 -0500
> @@ -5025,7 +5025,7 @@
>  ## was about 0.0005 in 2.6.1 patched
>  
>  
> -## tests of problems fixed by Marc Schwarz's patch for
> +## tests of problems fixed by Marc Schwartz's patch for
>  ## cut/hist for Dates and POSIXt
>  Dates <- seq(as.Date("2005/01/01"), as.Date("2009/01/01"), "day")
>  months <- format(Dates, format = "%m")
> @@ -5036,20 +5036,32 @@
>  stopifnot(identical(hist(Dates, "month", plot = FALSE)$counts, mn))
>  # Test cut.Date() for months
>  stopifnot(identical(as.vector(table(cut(Dates, "month"))), mn))
> +# Test cut.Date() for 3 months
> +stopifnot(identical(as.vector(table(cut(Dates, "3 months"))),
> +                    as.integer(colSums(matrix(c(mn, 0, 0), nrow = 3)))))
>  # Test hist.Date() for years
>  stopifnot(identical(hist(Dates, "year", plot = FALSE)$counts, ty))
>  # Test cut.Date() for years
>  stopifnot(identical(as.vector(table(cut(Dates, "years"))),ty))
> +# Test cut.Date() for 3 years
> +stopifnot(identical(as.vector(table(cut(Dates, "3 years"))),
> +                    as.integer(colSums(matrix(c(ty, 0), nrow = 3)))))
>  
>  Dtimes <- as.POSIXlt(Dates)
>  # Test hist.POSIXt() for months
>  stopifnot(identical(hist(Dtimes, "month", plot = FALSE)$counts, mn))
>  # Test cut.POSIXt() for months
>  stopifnot(identical(as.vector(table(cut(Dtimes, "month"))), mn))
> +# Test cut.POSIXt() for 3 months
> +stopifnot(identical(as.vector(table(cut(Dtimes, "3 months"))),
> +                    as.integer(colSums(matrix(c(mn, 0, 0), nrow = 3)))))
>  # Test hist.POSIXt() for years
>  stopifnot(identical(hist(Dtimes, "year", plot = FALSE)$counts, ty))
>  # Test cut.POSIXt() for years
>  stopifnot(identical(as.vector(table(cut(Dtimes, "years"))), ty))
> +# Test cut.POSIXt() for 3 years
> +stopifnot(identical(as.vector(table(cut(Dtimes, "3 years"))),
> +                    as.integer(colSums(matrix(c(ty, 0), nrow = 3)))))
>  ## changed in 2.6.2
>  
>  

-- 
Roger D. Peng  |  http://www.biostat.jhsph.edu/~rpeng/


From maechler at stat.math.ethz.ch  Wed Mar 26 15:37:45 2008
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Wed, 26 Mar 2008 15:37:45 +0100
Subject: [Rd] cut.Date and cut.POSIXt problem
In-Reply-To: <47EA4D1B.3050903@jhsph.edu>
References: <971536df0803181004x5ebbe960q6879506089b3e428@mail.gmail.com>
	<47E010CD.6090200@jhsph.edu> <47E2D3BB.2080106@comcast.net>
	<47EA4D1B.3050903@jhsph.edu>
Message-ID: <18410.24505.406774.245502@stat.math.ethz.ch>

>>>>> "RDP" == Roger D Peng <rpeng at jhsph.edu>
>>>>>     on Wed, 26 Mar 2008 09:18:19 -0400 writes:

    RDP> I have applied these patches to R-devel and in my limited testing they appear to 
    RDP> work as desired.  I have to say that I never ran into the problem these patches 
    RDP> were meant to solve so I may not be the best person to do the testing.

that must have been an old version of R-devel, since Marc's
patches had made it "officially" into R-devel on Monday,
and subsequently also into  R-2.7.0 alpha.

With thanks to Marc, Brian, Roger and other contributors,
Martin


From marc_schwartz at comcast.net  Wed Mar 26 16:03:29 2008
From: marc_schwartz at comcast.net (Marc Schwartz)
Date: Wed, 26 Mar 2008 10:03:29 -0500
Subject: [Rd] cut.Date and cut.POSIXt problem
In-Reply-To: <18410.24505.406774.245502@stat.math.ethz.ch>
References: <971536df0803181004x5ebbe960q6879506089b3e428@mail.gmail.com>	<47E010CD.6090200@jhsph.edu>
	<47E2D3BB.2080106@comcast.net>	<47EA4D1B.3050903@jhsph.edu>
	<18410.24505.406774.245502@stat.math.ethz.ch>
Message-ID: <47EA65C1.5030802@comcast.net>

Martin Maechler wrote:
>>>>>> "RDP" == Roger D Peng <rpeng at jhsph.edu>
>>>>>>     on Wed, 26 Mar 2008 09:18:19 -0400 writes:
> 
>     RDP> I have applied these patches to R-devel and in my limited testing they appear to 
>     RDP> work as desired.  I have to say that I never ran into the problem these patches 
>     RDP> were meant to solve so I may not be the best person to do the testing.
> 
> that must have been an old version of R-devel, since Marc's
> patches had made it "officially" into R-devel on Monday,
> and subsequently also into  R-2.7.0 alpha.
> 
> With thanks to Marc, Brian, Roger and other contributors,
> Martin

Thanks Martin and thanks to Roger, Gabor and Prof. Ripley for taking the 
time to review and commit the patches.

Also note that patches were included to add "quarter[s]" as a defined 
break interval to cut.Date() and cut.POSIXt() and that these patches 
were also made to hist.Date() and hist.POSIXt() so that those functions 
support the new break intervals as well.

The help files for these have also been updated.

Lastly, a patch was added to tests/reg-tests-1.R for the original issue 
raised by Gabor.

Thanks again to everyone.

Regards,

Marc


From r.hankin at noc.soton.ac.uk  Wed Mar 26 17:04:11 2008
From: r.hankin at noc.soton.ac.uk (Robin Hankin)
Date: Wed, 26 Mar 2008 16:04:11 +0000
Subject: [Rd] S4 slot with NA default
Message-ID: <00025495-F390-4A46-885E-5FAD2B4B66A7@noc.soton.ac.uk>

Hi

How do I specify an S4 class with a slot that is potentially numeric,  
but NA
by default?  I   want the slot to be NA until I calculate its value
  (an expensive operation, not needed for all applications).   When  
its value is
known, I  will create a new object with the correct value inserted in  
the slot.

I want "NA" to signify "not known".

My attempt fails because NA is not numeric:

 >  
setClass 
("foo",representation=representation(x="numeric"),prototype=list(x=NA))
Error in makePrototypeFromClassDef(properties, ClassDef, immediate,  
where) :
   in making the prototype for class "foo" elements of the prototype  
failed to match the corresponding slot class: x (class ?numeric? )
 >

(the real application has other slots too).   I can
use "NaN", which is numeric:

 >  
setClass 
("foo",representation=representation(x="numeric"),prototype=list(x=NaN))
[1] "foo"
 >

But this is not the correct sense: to me "NaN" means "not a number"  
and I want
the sense to be "not available".



Any advice?





--
Robin Hankin
Uncertainty Analyst and Neutral Theorist,
National Oceanography Centre, Southampton
European Way, Southampton SO14 3ZH, UK
  tel  023-8059-7743


From vdergachev at rcgardis.com  Wed Mar 26 17:23:56 2008
From: vdergachev at rcgardis.com (Vladimir Dergachev)
Date: Wed, 26 Mar 2008 12:23:56 -0400
Subject: [Rd] S4 slot with NA default
In-Reply-To: <00025495-F390-4A46-885E-5FAD2B4B66A7@noc.soton.ac.uk>
References: <00025495-F390-4A46-885E-5FAD2B4B66A7@noc.soton.ac.uk>
Message-ID: <200803261223.56963.vdergachev@rcgardis.com>

On Wednesday 26 March 2008 12:04:11 pm Robin Hankin wrote:
> Hi
>
> How do I specify an S4 class with a slot that is potentially numeric,
> but NA
> by default?  I   want the slot to be NA until I calculate its value
>   (an expensive operation, not needed for all applications).   When
> its value is
> known, I  will create a new object with the correct value inserted in
> the slot.
>
> I want "NA" to signify "not known".
>
> My attempt fails because NA is not numeric:
>

Try as.numeric(NA) - by default, plain NA is of type "logical"

                  best

                    Vladimir Dergachev

>
>
>
> --
> Robin Hankin
> Uncertainty Analyst and Neutral Theorist,
> National Oceanography Centre, Southampton
> European Way, Southampton SO14 3ZH, UK
>   tel  023-8059-7743
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel



-- 
Vladimir Dergachev            RCG Ardis Capital LLC


From Roger.Bivand at nhh.no  Wed Mar 26 17:24:00 2008
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 26 Mar 2008 17:24:00 +0100 (CET)
Subject: [Rd] S4 slot with NA default
In-Reply-To: <00025495-F390-4A46-885E-5FAD2B4B66A7@noc.soton.ac.uk>
References: <00025495-F390-4A46-885E-5FAD2B4B66A7@noc.soton.ac.uk>
Message-ID: <Pine.LNX.4.64.0803261717220.11431@reclus.nhh.no>

On Wed, 26 Mar 2008, Robin Hankin wrote:

> Hi
>
> How do I specify an S4 class with a slot that is potentially numeric,
> but NA
> by default?  I   want the slot to be NA until I calculate its value
>  (an expensive operation, not needed for all applications).   When
> its value is
> known, I  will create a new object with the correct value inserted in
> the slot.
>
> I want "NA" to signify "not known".
>
> My attempt fails because NA is not numeric:

setClass("foo",
  representation=representation(x="numeric"),
  prototype=list(x=as.numeric(NA)))
new("foo")

is OK, we have a character NA prototype in an sp CRS class, and it's never 
been any trouble.

Roger

>
> >
> setClass
> ("foo",representation=representation(x="numeric"),prototype=list(x=NA))
> Error in makePrototypeFromClassDef(properties, ClassDef, immediate,
> where) :
>   in making the prototype for class "foo" elements of the prototype
> failed to match the corresponding slot class: x (class ?numeric? )
> >
>
> (the real application has other slots too).   I can
> use "NaN", which is numeric:
>
> >
> setClass
> ("foo",representation=representation(x="numeric"),prototype=list(x=NaN))
> [1] "foo"
> >
>
> But this is not the correct sense: to me "NaN" means "not a number"
> and I want
> the sense to be "not available".
>
>
>
> Any advice?
>
>
>
>
>
> --
> Robin Hankin
> Uncertainty Analyst and Neutral Theorist,
> National Oceanography Centre, Southampton
> European Way, Southampton SO14 3ZH, UK
>  tel  023-8059-7743
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From Christian.Kohler at klinik.uni-regensburg.de  Wed Mar 26 17:24:44 2008
From: Christian.Kohler at klinik.uni-regensburg.de (Christian Kohler)
Date: Wed, 26 Mar 2008 17:24:44 +0100
Subject: [Rd] S4 slot with NA default
In-Reply-To: <00025495-F390-4A46-885E-5FAD2B4B66A7@noc.soton.ac.uk>
References: <00025495-F390-4A46-885E-5FAD2B4B66A7@noc.soton.ac.uk>
Message-ID: <47EA78CC.5040903@klinik.uni-regensburg.de>

Hi Robin,

you could try this:
> setClass("foo",
representation=representation(x="numeric"),prototype=list(x=as.numeric(NA)))
> test<-new("foo")
> test
>An object of class "foo"
>Slot "x":
>[1] NA


Cheers,
Christian


Robin Hankin wrote:
> Hi
>
> How do I specify an S4 class with a slot that is potentially numeric,  
> but NA
> by default?  I   want the slot to be NA until I calculate its value
>   (an expensive operation, not needed for all applications).   When  
> its value is
> known, I  will create a new object with the correct value inserted in  
> the slot.
>
> I want "NA" to signify "not known".
>
> My attempt fails because NA is not numeric:
>
>  >  
> setClass 
> ("foo",representation=representation(x="numeric"),prototype=list(x=NA))
> Error in makePrototypeFromClassDef(properties, ClassDef, immediate,  
> where) :
>    in making the prototype for class "foo" elements of the prototype  
> failed to match the corresponding slot class: x (class ?numeric? )
>  >
>
> (the real application has other slots too).   I can
> use "NaN", which is numeric:
>
>  >  
> setClass 
> ("foo",representation=representation(x="numeric"),prototype=list(x=NaN))
> [1] "foo"
>  >
>
> But this is not the correct sense: to me "NaN" means "not a number"  
> and I want
> the sense to be "not available".
>
>
>
> Any advice?
>
>
>
>
>
> --
> Robin Hankin
> Uncertainty Analyst and Neutral Theorist,
> National Oceanography Centre, Southampton
> European Way, Southampton SO14 3ZH, UK
>   tel  023-8059-7743
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>   


-- 

Christian Kohler
Institute of Functional Genomics
Computational Diagnostics
University of Regensburg (BioPark I)
D-93147 Regensburg (Germany)

Tel. +49 941 943 5055
Fax  +49 941 943 5020
christian.kohler at klinik.uni-regensburg.de


From simon.urbanek at r-project.org  Wed Mar 26 17:24:53 2008
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Wed, 26 Mar 2008 12:24:53 -0400
Subject: [Rd] S4 slot with NA default
In-Reply-To: <00025495-F390-4A46-885E-5FAD2B4B66A7@noc.soton.ac.uk>
References: <00025495-F390-4A46-885E-5FAD2B4B66A7@noc.soton.ac.uk>
Message-ID: <3798E3A1-24F8-41FE-A1E4-5812AFC839D5@r-project.org>


On Mar 26, 2008, at 12:04 PM, Robin Hankin wrote:

> Hi
>
> How do I specify an S4 class with a slot that is potentially numeric,
> but NA
> by default?  I   want the slot to be NA until I calculate its value
>  (an expensive operation, not needed for all applications).   When
> its value is
> known, I  will create a new object with the correct value inserted in
> the slot.
>
> I want "NA" to signify "not known".
>
> My attempt fails because NA is not numeric:
>
>>
> setClass
> ("foo
> ",representation=representation(x="numeric"),prototype=list(x=NA))
> Error in makePrototypeFromClassDef(properties, ClassDef, immediate,
> where) :
>   in making the prototype for class "foo" elements of the prototype
> failed to match the corresponding slot class: x (class ?numeric? )
>>
>

Why don't you just initialize x with the correct type then? NA is  
logical, so either use as.numeric(NA) or NA_real_ (see ?NA)

Cheers,
S


> (the real application has other slots too).   I can
> use "NaN", which is numeric:
>
>>
> setClass
> ("foo 
> ",representation=representation(x="numeric"),prototype=list(x=NaN))
> [1] "foo"
>>
>
> But this is not the correct sense: to me "NaN" means "not a number"
> and I want
> the sense to be "not available".
>
>
>
> Any advice?
>
>
>
>
>
> --
> Robin Hankin
> Uncertainty Analyst and Neutral Theorist,
> National Oceanography Centre, Southampton
> European Way, Southampton SO14 3ZH, UK
>  tel  023-8059-7743
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From P.Dalgaard at biostat.ku.dk  Wed Mar 26 17:28:58 2008
From: P.Dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Wed, 26 Mar 2008 17:28:58 +0100
Subject: [Rd] S4 slot with NA default
In-Reply-To: <00025495-F390-4A46-885E-5FAD2B4B66A7@noc.soton.ac.uk>
References: <00025495-F390-4A46-885E-5FAD2B4B66A7@noc.soton.ac.uk>
Message-ID: <47EA79CA.1030208@biostat.ku.dk>

Robin Hankin wrote:
> Hi
>
> How do I specify an S4 class with a slot that is potentially numeric,  
> but NA
> by default?  I   want the slot to be NA until I calculate its value
>   (an expensive operation, not needed for all applications).   When  
> its value is
> known, I  will create a new object with the correct value inserted in  
> the slot.
>
> I want "NA" to signify "not known".
>
> My attempt fails because NA is not numeric:
>
>  >  
> setClass 
> ("foo",representation=representation(x="numeric"),prototype=list(x=NA))
> Error in makePrototypeFromClassDef(properties, ClassDef, immediate,  
> where) :
>    in making the prototype for class "foo" elements of the prototype  
> failed to match the corresponding slot class: x (class ?numeric? )
>  >
>
> (the real application has other slots too).   I can
> use "NaN", which is numeric:
>
>  >  
> setClass 
> ("foo",representation=representation(x="numeric"),prototype=list(x=NaN))
> [1] "foo"
>  >
>
> But this is not the correct sense: to me "NaN" means "not a number"  
> and I want
> the sense to be "not available".
>
>
>
> Any advice?
>
>
>
>   
How about NA_real_ or NA_integer_?


-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907


From ripley at stats.ox.ac.uk  Wed Mar 26 17:58:37 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 26 Mar 2008 16:58:37 +0000 (GMT)
Subject: [Rd] S4 slot with NA default
In-Reply-To: <Pine.LNX.4.64.0803261717220.11431@reclus.nhh.no>
References: <00025495-F390-4A46-885E-5FAD2B4B66A7@noc.soton.ac.uk>
	<Pine.LNX.4.64.0803261717220.11431@reclus.nhh.no>
Message-ID: <alpine.LFD.1.00.0803261656140.28049@gannet.stats.ox.ac.uk>

Several people have suggested as.numeric(NA).  That evaluates to NA_real_, 
so provided you don't want to support R < 2.5.0 it is (slightly) more 
efficient in several ways to use NA_real_ .

On Wed, 26 Mar 2008, Roger Bivand wrote:

> On Wed, 26 Mar 2008, Robin Hankin wrote:
>
>> Hi
>>
>> How do I specify an S4 class with a slot that is potentially numeric,
>> but NA
>> by default?  I   want the slot to be NA until I calculate its value
>>  (an expensive operation, not needed for all applications).   When
>> its value is
>> known, I  will create a new object with the correct value inserted in
>> the slot.
>>
>> I want "NA" to signify "not known".
>>
>> My attempt fails because NA is not numeric:
>
> setClass("foo",
>  representation=representation(x="numeric"),
>  prototype=list(x=as.numeric(NA)))
> new("foo")
>
> is OK, we have a character NA prototype in an sp CRS class, and it's never
> been any trouble.
>
> Roger
>
>>
>>>
>> setClass
>> ("foo",representation=representation(x="numeric"),prototype=list(x=NA))
>> Error in makePrototypeFromClassDef(properties, ClassDef, immediate,
>> where) :
>>   in making the prototype for class "foo" elements of the prototype
>> failed to match the corresponding slot class: x (class ?numeric? )
>>>
>>
>> (the real application has other slots too).   I can
>> use "NaN", which is numeric:
>>
>>>
>> setClass
>> ("foo",representation=representation(x="numeric"),prototype=list(x=NaN))
>> [1] "foo"
>>>
>>
>> But this is not the correct sense: to me "NaN" means "not a number"
>> and I want
>> the sense to be "not available".
>>
>>
>>
>> Any advice?
>>
>>
>>
>>
>>
>> --
>> Robin Hankin
>> Uncertainty Analyst and Neutral Theorist,
>> National Oceanography Centre, Southampton
>> European Way, Southampton SO14 3ZH, UK
>>  tel  023-8059-7743
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School of
> Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From rpeng at jhsph.edu  Wed Mar 26 20:19:52 2008
From: rpeng at jhsph.edu (Roger D. Peng)
Date: Wed, 26 Mar 2008 15:19:52 -0400
Subject: [Rd] suppressing 'download.file' progress window
Message-ID: <47EAA1D8.8050001@jhsph.edu>

In Windows, 'download.file' pops up a separate window indicating the progress of 
the download (even when 'quiet = TRUE').  This is useful and informative when 
downloading a single (large) file.  However, when downloading multiple (smaller) 
files in sucession, the constant flashing of the progress window can be a little 
disorienting (at least for me).

Is there a way to suppress this progress window?  Or is it an operating system 
feature?

-roger
-- 
Roger D. Peng  |  http://www.biostat.jhsph.edu/~rpeng/


From ripley at stats.ox.ac.uk  Wed Mar 26 22:13:53 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 26 Mar 2008 21:13:53 +0000 (GMT)
Subject: [Rd] suppressing 'download.file' progress window
In-Reply-To: <47EAA1D8.8050001@jhsph.edu>
References: <47EAA1D8.8050001@jhsph.edu>
Message-ID: <alpine.LFD.1.00.0803262000360.458@gannet.stats.ox.ac.uk>

On Wed, 26 Mar 2008, Roger D. Peng wrote:

> In Windows, 'download.file' pops up a separate window indicating the 
> progress of the download (even when 'quiet = TRUE').  This is useful and 
> informative when downloading a single (large) file.  However, when 
> downloading multiple (smaller) files in sucession, the constant flashing 
> of the progress window can be a little disorienting (at least for me).
>
> Is there a way to suppress this progress window?  Or is it an operating system
> feature?

The write up was somewhat confusing.  'quiet=TRUE' suppresses the status 
messages on all platforms, and the (text) progress bar.  Only in R-devel 
does it suppress the progress bar widget on Windows.

That said, the main time I download many files is via update.packages() or 
install.packages(), and there was no provision to set quiet=TRUE from 
those: I've just added ... to allow that.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From rpeng at jhsph.edu  Wed Mar 26 22:31:59 2008
From: rpeng at jhsph.edu (Roger D. Peng)
Date: Wed, 26 Mar 2008 17:31:59 -0400
Subject: [Rd] suppressing 'download.file' progress window
In-Reply-To: <alpine.LFD.1.00.0803262000360.458@gannet.stats.ox.ac.uk>
References: <47EAA1D8.8050001@jhsph.edu>
	<alpine.LFD.1.00.0803262000360.458@gannet.stats.ox.ac.uk>
Message-ID: <47EAC0CF.6060805@jhsph.edu>

Thanks!  The patch to src/modules/internet/internet.c in r44937 was just what I 
was looking for.

-roger

Prof Brian Ripley wrote:
> On Wed, 26 Mar 2008, Roger D. Peng wrote:
> 
>> In Windows, 'download.file' pops up a separate window indicating the 
>> progress of the download (even when 'quiet = TRUE').  This is useful 
>> and informative when downloading a single (large) file.  However, when 
>> downloading multiple (smaller) files in sucession, the constant 
>> flashing of the progress window can be a little disorienting (at least 
>> for me).
>>
>> Is there a way to suppress this progress window?  Or is it an 
>> operating system
>> feature?
> 
> The write up was somewhat confusing.  'quiet=TRUE' suppresses the status 
> messages on all platforms, and the (text) progress bar.  Only in R-devel 
> does it suppress the progress bar widget on Windows.
> 
> That said, the main time I download many files is via update.packages() 
> or install.packages(), and there was no provision to set quiet=TRUE from 
> those: I've just added ... to allow that.
> 

-- 
Roger D. Peng  |  http://www.biostat.jhsph.edu/~rpeng/


From bolker at zoo.ufl.edu  Thu Mar 27 01:38:49 2008
From: bolker at zoo.ufl.edu (Ben Bolker)
Date: Wed, 26 Mar 2008 20:38:49 -0400
Subject: [Rd] Google Summer of Code: cross-listing
Message-ID: <47EAEC99.7020302@zoo.ufl.edu>


   Dear R/Google Summer of Code people,

    NESCent (the National Evolutionary Synthesis Center) is a Google SoC
organization and has a couple of R-specific projects on its list (I'm
one of the mentors), specifically for phylogenetic/evolutionary biology
problems in R (in fact, the first two projects listed on
http://phyloinformatics.net/Phyloinformatics_Summer_of_Code_2008 )
Would it be possible to
include a link to them on the R project SoC page \
(http://www.r-project.org/SoC08/ ), as that might help people 
specifically looking for R projects to better find it ?
(They are quite different from those listed for R, so  this
shouldn't mean any competition.)

   sincerely
     Ben Bolker


From w.northcott at unsw.edu.au  Thu Mar 27 01:05:40 2008
From: w.northcott at unsw.edu.au (Bill Northcott)
Date: Thu, 27 Mar 2008 11:05:40 +1100
Subject: [Rd] R 64 on Intel Mac check problem
In-Reply-To: <mailman.21.1206529204.25461.r-devel@r-project.org>
References: <mailman.21.1206529204.25461.r-devel@r-project.org>
Message-ID: <487BB358-F115-451A-85C8-491AF824C0AF@unsw.edu.au>

On 26/03/2008, at 10:00 PM, Georgios wrote:
> I have installed gcc 4.2 and gfortran 4.2 from the available sources  
> on the
> web page and am using the copy and paste guide on the page.
>
> Now everything seems to be going fine until the point where the R  
> packages
> are tested. In particular when the regression tests are run I get the
> following.
>
> running regression tests
> running code in 'reg-tests-1.R' ...\c
> OK
> running code in 'reg-tests-2.R' ...\c
> OK
> comparing 'reg-tests-2.Rout' to './reg-tests-2.Rout.save' ...\c
> 3756c3756
> <   The decimal point is 1 digit(s) to the right of the |
> ---
>>  The decimal point is at the |
> 3762c3762

It may or may not be relevant, but there is a catastrophic bug in  
log10() in 10.5.2 for x86_64: it returns 0 for all arguments.  This  
has been discussed on the Scitech list.  Apple think they have fixed  
it, but I am sure they would want to hear of other cases or possible  
compiler issues, if it is their compiler you are using.

So if you can get a minimal test case it would be very good to submit  
a bug.  It may be worth doing even if you cannot get a minimal case  
because all the sources are readily available.

Finally last time I looked a few days back Simon's 64 bit Intel builds  
were failing.

Bill Northcott


From simon.urbanek at r-project.org  Thu Mar 27 01:51:18 2008
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Wed, 26 Mar 2008 20:51:18 -0400
Subject: [Rd] R 64 on Intel Mac check problem
In-Reply-To: <487BB358-F115-451A-85C8-491AF824C0AF@unsw.edu.au>
References: <mailman.21.1206529204.25461.r-devel@r-project.org>
	<487BB358-F115-451A-85C8-491AF824C0AF@unsw.edu.au>
Message-ID: <C09A9027-5B47-48CC-AC34-E7B9ABB9D636@r-project.org>


On Mar 26, 2008, at 8:05 PM, Bill Northcott wrote:

> On 26/03/2008, at 10:00 PM, Georgios wrote:
>> I have installed gcc 4.2 and gfortran 4.2 from the available sources
>> on the
>> web page and am using the copy and paste guide on the page.
>>
>> Now everything seems to be going fine until the point where the R
>> packages
>> are tested. In particular when the regression tests are run I get the
>> following.
>>
>> running regression tests
>> running code in 'reg-tests-1.R' ...\c
>> OK
>> running code in 'reg-tests-2.R' ...\c
>> OK
>> comparing 'reg-tests-2.Rout' to './reg-tests-2.Rout.save' ...\c
>> 3756c3756
>> <   The decimal point is 1 digit(s) to the right of the |
>> ---
>>> The decimal point is at the |
>> 3762c3762
>
> It may or may not be relevant, but there is a catastrophic bug in
> log10() in 10.5.2 for x86_64: it returns 0 for all arguments.  This
> has been discussed on the Scitech list.  Apple think they have fixed
> it, but I am sure they would want to hear of other cases or possible
> compiler issues, if it is their compiler you are using.
>
> So if you can get a minimal test case it would be very good to submit
> a bug.  It may be worth doing even if you cannot get a minimal case
> because all the sources are readily available.
>
> Finally last time I looked a few days back Simon's 64 bit Intel builds
> were failing.
>

Yes, the gcc-4.2 is known to be broken for x86_64 as you describe  
above (or in fact it miscompiles a few other things, too).  
Interestingly llvm-gcc-4.2 suffers from the same problem. That is the  
reason why the 64-bit binaries are currently not offered.
Switching to gcc-4.0 breaks other things on other targets, so there is  
no universal (and maintainable) solution that I'm aware of.

Thanks,
Simon


From w.northcott at unsw.edu.au  Thu Mar 27 02:20:06 2008
From: w.northcott at unsw.edu.au (Bill Northcott)
Date: Thu, 27 Mar 2008 12:20:06 +1100
Subject: [Rd] R 64 on Intel Mac check problem
In-Reply-To: <C09A9027-5B47-48CC-AC34-E7B9ABB9D636@r-project.org>
References: <mailman.21.1206529204.25461.r-devel@r-project.org>
	<487BB358-F115-451A-85C8-491AF824C0AF@unsw.edu.au>
	<C09A9027-5B47-48CC-AC34-E7B9ABB9D636@r-project.org>
Message-ID: <8DA6E367-BD14-4FFE-A0F2-9C31EE48B5F4@unsw.edu.au>

On 27/03/2008, at 11:51 AM, Simon Urbanek wrote:
> Yes, the gcc-4.2 is known to be broken for x86_64 as you describe  
> above (or in fact it miscompiles a few other things, too).  
> Interestingly llvm-gcc-4.2 suffers from the same problem. That is  
> the reason why the 64-bit binaries are currently not offered.
> Switching to gcc-4.0 breaks other things on other targets, so there  
> is no universal (and maintainable) solution that I'm aware of.

Perhaps we could all file an enhancement bug request to release an  
updated version of the compiler.

Do Apple know that llvm-gcc is affected?

Bill


From p.dalgaard at biostat.ku.dk  Thu Mar 27 10:01:13 2008
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Thu, 27 Mar 2008 10:01:13 +0100
Subject: [Rd] Misc/List Search Path from keyboard (PR#11036)
In-Reply-To: <20080326041503.4FD16282EFF6@mail.pubhealth.ku.dk>
References: <20080326041503.4FD16282EFF6@mail.pubhealth.ku.dk>
Message-ID: <47EB6259.4070005@biostat.ku.dk>

richardwreed at gmail.com wrote:
> Full_Name: Richard Reed
> Version: 2.6.2
> OS: MS Windows XP Pro
> Submission from: (NULL) (76.121.170.35)
>
>
> Pressing Alt-M+s doesn't search path. It just generates another ">". It does
> this in "vanilla" too. However, Alt-M+click "list search path" does work. Note
> that when I press Alt-M (and the "Misc" menu drops down) the second "s" in "list
> search way" is underlined indicating the "s" should complete the command.
>
>   
Yes. There's another S earlier in the misc menu ("_S_top current 
computation"), so presumably the search path should move to another key 
(P, say).


-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907


From ripley at stats.ox.ac.uk  Thu Mar 27 11:40:14 2008
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Thu, 27 Mar 2008 11:40:14 +0100 (CET)
Subject: [Rd] Misc/List Search Path from keyboard (PR#11036)
Message-ID: <20080327104014.B2BC8282EFF7@mail.pubhealth.ku.dk>

  This message is in MIME format.  The first part should be readable text,
  while the remaining parts are likely unreadable without MIME-aware tools.

--27464147-934395014-1206614168=:3302
Content-Type: TEXT/PLAIN; charset=iso-8859-1; format=flowed
Content-Transfer-Encoding: 8BIT

Yes, thanks but there is a bit more to it than that. Actually Alt-M plus 
'i' works, the issue being that graphapp is underlining the wrong letter.

I know how to get the correct letter underlined, but not yet how to get 
it specified differently.


On Thu, 27 Mar 2008, Peter Dalgaard wrote:

> richardwreed at gmail.com wrote:
>> Full_Name: Richard Reed
>> Version: 2.6.2
>> OS: MS Windows XP Pro
>> Submission from: (NULL) (76.121.170.35)
>>
>>
>> Pressing Alt-M+s doesn't search path. It just generates another ">". It does
>> this in "vanilla" too. However, Alt-M+click "list search path" does work. Note
>> that when I press Alt-M (and the "Misc" menu drops down) the second "s" in "list
>> search way" is underlined indicating the "s" should complete the command.
>>
>>
> Yes. There's another S earlier in the misc menu ("_S_top current
> computation"), so presumably the search path should move to another key
> (P, say).
>
>
> --
>   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
>  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
> (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
> ~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595
--27464147-934395014-1206614168=:3302--


From ripley at stats.ox.ac.uk  Thu Mar 27 16:00:14 2008
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Thu, 27 Mar 2008 16:00:14 +0100 (CET)
Subject: [Rd] Misc/List Search Path from keyboard (PR#11036)
Message-ID: <20080327150015.04E59282EF48@mail.pubhealth.ku.dk>

  This message is in MIME format.  The first part should be readable text,
  while the remaining parts are likely unreadable without MIME-aware tools.

--27464147-424409593-1206629856=:11528
Content-Type: TEXT/PLAIN; charset=iso-8859-1; format=flowed
Content-Transfer-Encoding: 8BIT

OK, so it is Windows idiosyncracy!

If there is more than one '&' in menu item string, Windows (at least XP) 
underlines the last one and takes the first one as the shortcut key.
I've had to add code to ensure that there is at most one.

Given that this once worked (say in 1999), I suspect earlier versions of 
Windows did something different.  (Those versions used to display 
underlines are all times.)

Fixed in 2.7.0 alpha shortly (and I've forced this one to 'p' rather than 
'i').

On Thu, 27 Mar 2008, ripley at stats.ox.ac.uk wrote:

>  This message is in MIME format.  The first part should be readable text,
>  while the remaining parts are likely unreadable without MIME-aware tools.
>
> --27464147-934395014-1206614168=:3302
> Content-Type: TEXT/PLAIN; charset=iso-8859-1; format=flowed
> Content-Transfer-Encoding: 8BIT
>
> Yes, thanks but there is a bit more to it than that. Actually Alt-M plus
> 'i' works, the issue being that graphapp is underlining the wrong letter.
>
> I know how to get the correct letter underlined, but not yet how to get
> it specified differently.
>
>
> On Thu, 27 Mar 2008, Peter Dalgaard wrote:
>
>> richardwreed at gmail.com wrote:
>>> Full_Name: Richard Reed
>>> Version: 2.6.2
>>> OS: MS Windows XP Pro
>>> Submission from: (NULL) (76.121.170.35)
>>>
>>>
>>> Pressing Alt-M+s doesn't search path. It just generates another ">". It does
>>> this in "vanilla" too. However, Alt-M+click "list search path" does work. Note
>>> that when I press Alt-M (and the "Misc" menu drops down) the second "s" in "list
>>> search way" is underlined indicating the "s" should complete the command.
>>>
>>>
>> Yes. There's another S earlier in the misc menu ("_S_top current
>> computation"), so presumably the search path should move to another key
>> (P, say).
>>
>>
>> --
>>   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
>>  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
>> (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
>> ~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
> --
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
> --27464147-934395014-1206614168=:3302--
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595
--27464147-424409593-1206629856=:11528--


From marentos at gmail.com  Thu Mar 27 17:15:14 2008
From: marentos at gmail.com (Georgios Marentakis)
Date: Thu, 27 Mar 2008 12:15:14 -0400
Subject: [Rd] R 64 on Intel Mac check problem
In-Reply-To: <487BB358-F115-451A-85C8-491AF824C0AF@unsw.edu.au>
References: <mailman.21.1206529204.25461.r-devel@r-project.org>
	<487BB358-F115-451A-85C8-491AF824C0AF@unsw.edu.au>
Message-ID: <3ba562220803270915m5221b5c9s2c8c5d712332206a@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20080327/944b2931/attachment.pl 

From ripley at stats.ox.ac.uk  Thu Mar 27 17:24:06 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 27 Mar 2008 16:24:06 +0000 (GMT)
Subject: [Rd] R 64 on Intel Mac check problem
In-Reply-To: <3ba562220803270915m5221b5c9s2c8c5d712332206a@mail.gmail.com>
References: <mailman.21.1206529204.25461.r-devel@r-project.org>
	<487BB358-F115-451A-85C8-491AF824C0AF@unsw.edu.au>
	<3ba562220803270915m5221b5c9s2c8c5d712332206a@mail.gmail.com>
Message-ID: <alpine.LFD.1.00.0803271621010.14703@auk.stats.ox.ac.uk>

On Thu, 27 Mar 2008, Georgios Marentakis wrote:

> thanks for all the responses,
> just to mention that I have also experimented with quite a few versions of
> the compiler and there was  always a failure at a different test, filing a
> bug report is a good idea. Does the 64 version work as expected in Linux?

Yes, and Solaris (both x86_64).  (Since x86_64 Linux is the main platform 
used by the developers, you hardly need to ask.)


> thanks,
> georgios
>
>
> On Wed, Mar 26, 2008 at 8:05 PM, Bill Northcott <w.northcott at unsw.edu.au>
> wrote:
>
>> On 26/03/2008, at 10:00 PM, Georgios wrote:
>>> I have installed gcc 4.2 and gfortran 4.2 from the available sources
>>> on the
>>> web page and am using the copy and paste guide on the page.
>>>
>>> Now everything seems to be going fine until the point where the R
>>> packages
>>> are tested. In particular when the regression tests are run I get the
>>> following.
>>>
>>> running regression tests
>>> running code in 'reg-tests-1.R' ...\c
>>> OK
>>> running code in 'reg-tests-2.R' ...\c
>>> OK
>>> comparing 'reg-tests-2.Rout' to './reg-tests-2.Rout.save' ...\c
>>> 3756c3756
>>> <   The decimal point is 1 digit(s) to the right of the |
>>> ---
>>>>  The decimal point is at the |
>>> 3762c3762
>>
>> It may or may not be relevant, but there is a catastrophic bug in
>> log10() in 10.5.2 for x86_64: it returns 0 for all arguments.  This
>> has been discussed on the Scitech list.  Apple think they have fixed
>> it, but I am sure they would want to hear of other cases or possible
>> compiler issues, if it is their compiler you are using.
>>
>> So if you can get a minimal test case it would be very good to submit
>> a bug.  It may be worth doing even if you cannot get a minimal case
>> because all the sources are readily available.
>>
>> Finally last time I looked a few days back Simon's 64 bit Intel builds
>> were failing.
>>
>> Bill Northcott
>>
>>
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From seanpor at acm.org  Fri Mar 28 17:05:29 2008
From: seanpor at acm.org (seanpor at acm.org)
Date: Fri, 28 Mar 2008 17:05:29 +0100 (CET)
Subject: [Rd] cpu usage high with windows change dir / winDialogString
	(PR#11045)
Message-ID: <20080328160529.717BA282EFF8@mail.pubhealth.ku.dk>

Good afternoon,

This is possibly a windows only bug, definitely of comparatively low
importance - but for the sake of completeness here we go.  I've
searched http://bugs.R-project.org/ etc., but can find no mention.

For RGui.exe, the CPU usage goes to 100% for certain dialog boxes for
the duration that the dialog box is visible, e.g.

* check CPU usage is low
* On the RGui.exe menu chose File / Change dir...
* the CPU usage goes to 100%
* hit OK
* the CPU usage goes back down again

This also occurs when I incant Help / Apropos or Help / Search help...
or at the "command prompt"

> winDialogString("hello", "nonsense")

Note the latter also applies to R.exe inside a cmd window.

I've checked this with a few windows machines for 2.6.2 & 2.6.1 -
including with --vanilla.  This machine here has the following...
> sessionInfo()
R version 2.6.2 (2008-02-08)
i386-pc-mingw32

locale:
LC_COLLATE=English_Ireland.1252;LC_CTYPE=English_Ireland.1252;LC_MONETARY=English_Ireland.1252;LC_NUMERIC=C;LC_TIME=English_Ireland.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base
> version
               _
platform       i386-pc-mingw32
arch           i386
os             mingw32
system         i386, mingw32
status
major          2
minor          6.2
year           2008
month          02
day            08
svn rev        44383
language       R
version.string R version 2.6.2 (2008-02-08)

I am not familiar with the R sources, so the following should be taken
with a large grain of salt... to my uninitiated eyes it appears to be
something to do with askstring() in src\extra\graphapp\dialogs.c
or possibly handle_message_dialog() - I'm afraid I have never
programmed windows at a low level so I'm not sure what's going on
here...

I am of course available to help pin this down - but unfortunately I
don't have a development environment here.

Best Regards,
Sean O'Riordain
Dublin, Ireland
not affiliated...
seanpor A T acm D ot org


From murdoch at stats.uwo.ca  Sat Mar 29 17:06:36 2008
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Sat, 29 Mar 2008 12:06:36 -0400
Subject: [Rd] cpu usage high with windows change dir / winDialogString
 (PR#11045)
In-Reply-To: <20080328160529.717BA282EFF8@mail.pubhealth.ku.dk>
References: <20080328160529.717BA282EFF8@mail.pubhealth.ku.dk>
Message-ID: <47EE690C.6070300@stats.uwo.ca>

On 28/03/2008 12:05 PM, seanpor at acm.org wrote:
> Good afternoon,
> 
> This is possibly a windows only bug, definitely of comparatively low
> importance - but for the sake of completeness here we go.  I've
> searched http://bugs.R-project.org/ etc., but can find no mention.
> 
> For RGui.exe, the CPU usage goes to 100% for certain dialog boxes for
> the duration that the dialog box is visible, e.g.
> 
> * check CPU usage is low
> * On the RGui.exe menu chose File / Change dir...
> * the CPU usage goes to 100%
> * hit OK
> * the CPU usage goes back down again

What is the bug here?  I'd guess it's not R using the cpu, rather some 
other process hooked to the dialog, but even if it really is R, why is 
this a bug?

Duncan Murdoch

> This also occurs when I incant Help / Apropos or Help / Search help...
> or at the "command prompt"
> 
>> winDialogString("hello", "nonsense")
> 
> Note the latter also applies to R.exe inside a cmd window.
> 
> I've checked this with a few windows machines for 2.6.2 & 2.6.1 -
> including with --vanilla.  This machine here has the following...
>> sessionInfo()
> R version 2.6.2 (2008-02-08)
> i386-pc-mingw32
> 
> locale:
> LC_COLLATE=English_Ireland.1252;LC_CTYPE=English_Ireland.1252;LC_MONETARY=English_Ireland.1252;LC_NUMERIC=C;LC_TIME=English_Ireland.1252
> 
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>> version
>                _
> platform       i386-pc-mingw32
> arch           i386
> os             mingw32
> system         i386, mingw32
> status
> major          2
> minor          6.2
> year           2008
> month          02
> day            08
> svn rev        44383
> language       R
> version.string R version 2.6.2 (2008-02-08)
> 
> I am not familiar with the R sources, so the following should be taken
> with a large grain of salt... to my uninitiated eyes it appears to be
> something to do with askstring() in src\extra\graphapp\dialogs.c
> or possibly handle_message_dialog() - I'm afraid I have never
> programmed windows at a low level so I'm not sure what's going on
> here...
> 
> I am of course available to help pin this down - but unfortunately I
> don't have a development environment here.
> 
> Best Regards,
> Sean O'Riordain
> Dublin, Ireland
> not affiliated...
> seanpor A T acm D ot org
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From murdoch at stats.uwo.ca  Sat Mar 29 17:10:07 2008
From: murdoch at stats.uwo.ca (murdoch at stats.uwo.ca)
Date: Sat, 29 Mar 2008 17:10:07 +0100 (CET)
Subject: [Rd] cpu usage high with windows change dir / winDialogString
	(PR#11051)
Message-ID: <20080329161007.0AC14282EFF8@mail.pubhealth.ku.dk>

On 28/03/2008 12:05 PM, seanpor at acm.org wrote:
> Good afternoon,
> 
> This is possibly a windows only bug, definitely of comparatively low
> importance - but for the sake of completeness here we go.  I've
> searched http://bugs.R-project.org/ etc., but can find no mention.
> 
> For RGui.exe, the CPU usage goes to 100% for certain dialog boxes for
> the duration that the dialog box is visible, e.g.
> 
> * check CPU usage is low
> * On the RGui.exe menu chose File / Change dir...
> * the CPU usage goes to 100%
> * hit OK
> * the CPU usage goes back down again

What is the bug here?  I'd guess it's not R using the cpu, rather some 
other process hooked to the dialog, but even if it really is R, why is 
this a bug?

Duncan Murdoch

> This also occurs when I incant Help / Apropos or Help / Search help...
> or at the "command prompt"
> 
>> winDialogString("hello", "nonsense")
> 
> Note the latter also applies to R.exe inside a cmd window.
> 
> I've checked this with a few windows machines for 2.6.2 & 2.6.1 -
> including with --vanilla.  This machine here has the following...
>> sessionInfo()
> R version 2.6.2 (2008-02-08)
> i386-pc-mingw32
> 
> locale:
> LC_COLLATE=English_Ireland.1252;LC_CTYPE=English_Ireland.1252;LC_MONETARY=English_Ireland.1252;LC_NUMERIC=C;LC_TIME=English_Ireland.1252
> 
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>> version
>                _
> platform       i386-pc-mingw32
> arch           i386
> os             mingw32
> system         i386, mingw32
> status
> major          2
> minor          6.2
> year           2008
> month          02
> day            08
> svn rev        44383
> language       R
> version.string R version 2.6.2 (2008-02-08)
> 
> I am not familiar with the R sources, so the following should be taken
> with a large grain of salt... to my uninitiated eyes it appears to be
> something to do with askstring() in src\extra\graphapp\dialogs.c
> or possibly handle_message_dialog() - I'm afraid I have never
> programmed windows at a low level so I'm not sure what's going on
> here...
> 
> I am of course available to help pin this down - but unfortunately I
> don't have a development environment here.
> 
> Best Regards,
> Sean O'Riordain
> Dublin, Ireland
> not affiliated...
> seanpor A T acm D ot org
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From ggrothendieck at gmail.com  Sat Mar 29 17:23:19 2008
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sat, 29 Mar 2008 12:23:19 -0400
Subject: [Rd] cpu usage high with windows change dir / winDialogString
	(PR#11045)
In-Reply-To: <47EE690C.6070300@stats.uwo.ca>
References: <20080328160529.717BA282EFF8@mail.pubhealth.ku.dk>
	<47EE690C.6070300@stats.uwo.ca>
Message-ID: <971536df0803290923t4c6ef40axc7176141f959a67f@mail.gmail.com>

On Sat, Mar 29, 2008 at 12:06 PM, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
> On 28/03/2008 12:05 PM, seanpor at acm.org wrote:
> > Good afternoon,
> >
> > This is possibly a windows only bug, definitely of comparatively low
> > importance - but for the sake of completeness here we go.  I've
> > searched http://bugs.R-project.org/ etc., but can find no mention.
> >
> > For RGui.exe, the CPU usage goes to 100% for certain dialog boxes for
> > the duration that the dialog box is visible, e.g.
> >
> > * check CPU usage is low
> > * On the RGui.exe menu chose File / Change dir...
> > * the CPU usage goes to 100%
> > * hit OK
> > * the CPU usage goes back down again
>
> What is the bug here?  I'd guess it's not R using the cpu, rather some
> other process hooked to the dialog, but even if it really is R, why is
> this a bug?

Maybe R is sitting in a loop consuming all the resources of the system?


From murdoch at stats.uwo.ca  Sat Mar 29 17:32:39 2008
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Sat, 29 Mar 2008 12:32:39 -0400
Subject: [Rd] cpu usage high with windows change dir / winDialogString
 (PR#11045)
In-Reply-To: <971536df0803290923t4c6ef40axc7176141f959a67f@mail.gmail.com>
References: <20080328160529.717BA282EFF8@mail.pubhealth.ku.dk>	
	<47EE690C.6070300@stats.uwo.ca>
	<971536df0803290923t4c6ef40axc7176141f959a67f@mail.gmail.com>
Message-ID: <47EE6F27.6010706@stats.uwo.ca>

On 29/03/2008 12:23 PM, Gabor Grothendieck wrote:
> On Sat, Mar 29, 2008 at 12:06 PM, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
>> On 28/03/2008 12:05 PM, seanpor at acm.org wrote:
>>> Good afternoon,
>>>
>>> This is possibly a windows only bug, definitely of comparatively low
>>> importance - but for the sake of completeness here we go.  I've
>>> searched http://bugs.R-project.org/ etc., but can find no mention.
>>>
>>> For RGui.exe, the CPU usage goes to 100% for certain dialog boxes for
>>> the duration that the dialog box is visible, e.g.
>>>
>>> * check CPU usage is low
>>> * On the RGui.exe menu chose File / Change dir...
>>> * the CPU usage goes to 100%
>>> * hit OK
>>> * the CPU usage goes back down again
>> What is the bug here?  I'd guess it's not R using the cpu, rather some
>> other process hooked to the dialog, but even if it really is R, why is
>> this a bug?
> 
> Maybe R is sitting in a loop consuming all the resources of the system?

It's a SHBrowseForFolder call, with a callback.  If there's a bug, it 
looks to me as though it's in Windows.

Duncan Murdoch


From ggrothendieck at gmail.com  Sat Mar 29 17:47:07 2008
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sat, 29 Mar 2008 12:47:07 -0400
Subject: [Rd] cpu usage high with windows change dir / winDialogString
	(PR#11045)
In-Reply-To: <47EE6F27.6010706@stats.uwo.ca>
References: <20080328160529.717BA282EFF8@mail.pubhealth.ku.dk>
	<47EE690C.6070300@stats.uwo.ca>
	<971536df0803290923t4c6ef40axc7176141f959a67f@mail.gmail.com>
	<47EE6F27.6010706@stats.uwo.ca>
Message-ID: <971536df0803290947v926065avf1992dcaa91281cc@mail.gmail.com>

On Sat, Mar 29, 2008 at 12:32 PM, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
>
> On 29/03/2008 12:23 PM, Gabor Grothendieck wrote:
> > On Sat, Mar 29, 2008 at 12:06 PM, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
> >> On 28/03/2008 12:05 PM, seanpor at acm.org wrote:
> >>> Good afternoon,
> >>>
> >>> This is possibly a windows only bug, definitely of comparatively low
> >>> importance - but for the sake of completeness here we go.  I've
> >>> searched http://bugs.R-project.org/ etc., but can find no mention.
> >>>
> >>> For RGui.exe, the CPU usage goes to 100% for certain dialog boxes for
> >>> the duration that the dialog box is visible, e.g.
> >>>
> >>> * check CPU usage is low
> >>> * On the RGui.exe menu chose File / Change dir...
> >>> * the CPU usage goes to 100%
> >>> * hit OK
> >>> * the CPU usage goes back down again
> >> What is the bug here?  I'd guess it's not R using the cpu, rather some
> >> other process hooked to the dialog, but even if it really is R, why is
> >> this a bug?
> >
> > Maybe R is sitting in a loop consuming all the resources of the system?
>
> It's a SHBrowseForFolder call, with a callback.  If there's a bug, it
> looks to me as though it's in Windows.
>
> Duncan Murdoch
>

I wonder if any of the numerous settings in the _browseinfo
structure might be impacting this such as looking for networking
folders and if the user's networking setup impacts this since it
could start performing some network functions to find files over
a network.


From murdoch at stats.uwo.ca  Sat Mar 29 18:21:45 2008
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Sat, 29 Mar 2008 13:21:45 -0400
Subject: [Rd] cpu usage high with windows change dir / winDialogString
 (PR#11045)
In-Reply-To: <8ed68eed0803291010x47e9aaa1y41d1b36d3a021e14@mail.gmail.com>
References: <20080328160529.717BA282EFF8@mail.pubhealth.ku.dk>	
	<47EE690C.6070300@stats.uwo.ca>	
	<971536df0803290923t4c6ef40axc7176141f959a67f@mail.gmail.com>	
	<47EE6F27.6010706@stats.uwo.ca>
	<8ed68eed0803291010x47e9aaa1y41d1b36d3a021e14@mail.gmail.com>
Message-ID: <47EE7AA9.5030400@stats.uwo.ca>

On 29/03/2008 1:10 PM, Sean O'Riordain wrote:
> Hi Duncan,
> 
> I suspect that it's not the SHBrowseForFolder call as it seems fine
> once the Browse button is pressed - the problem occurs *before* the
> Browse button is pressed.

The Change Dir dialog in R 2.7.0 no longer uses the 
winDialogString()-like dialog, so the problem will go away in that one 
case, but any other user of the underlying code will still have the 
problem.  It's because that function sets up a loop to poll for results. 
  Doesn't really seem worth the trouble to fix.

Duncan Murdoch


From murdoch at stats.uwo.ca  Sat Mar 29 18:41:39 2008
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Sat, 29 Mar 2008 13:41:39 -0400
Subject: [Rd] cpu usage high with windows change dir / winDialogString
 (PR#11045)
In-Reply-To: <47EE7AA9.5030400@stats.uwo.ca>
References: <20080328160529.717BA282EFF8@mail.pubhealth.ku.dk>		<47EE690C.6070300@stats.uwo.ca>		<971536df0803290923t4c6ef40axc7176141f959a67f@mail.gmail.com>		<47EE6F27.6010706@stats.uwo.ca>	<8ed68eed0803291010x47e9aaa1y41d1b36d3a021e14@mail.gmail.com>
	<47EE7AA9.5030400@stats.uwo.ca>
Message-ID: <47EE7F53.3010207@stats.uwo.ca>

On 29/03/2008 1:21 PM, Duncan Murdoch wrote:
> On 29/03/2008 1:10 PM, Sean O'Riordain wrote:
>> Hi Duncan,
>>
>> I suspect that it's not the SHBrowseForFolder call as it seems fine
>> once the Browse button is pressed - the problem occurs *before* the
>> Browse button is pressed.
> 
> The Change Dir dialog in R 2.7.0 no longer uses the 
> winDialogString()-like dialog, so the problem will go away in that one 
> case, but any other user of the underlying code will still have the 
> problem.  It's because that function sets up a loop to poll for results. 
>   Doesn't really seem worth the trouble to fix.

... but it turned out to be not much trouble at all.  So, this will be 
fixed in 2.7.0.  Thanks for pointing this out.

Duncan Murdoch


From seanpor at acm.org  Sat Mar 29 18:42:15 2008
From: seanpor at acm.org (Sean O'Riordain)
Date: Sat, 29 Mar 2008 17:42:15 +0000
Subject: [Rd] cpu usage high with windows change dir / winDialogString
	(PR#11045)
In-Reply-To: <47EE7AA9.5030400@stats.uwo.ca>
References: <20080328160529.717BA282EFF8@mail.pubhealth.ku.dk>
	<47EE690C.6070300@stats.uwo.ca>
	<971536df0803290923t4c6ef40axc7176141f959a67f@mail.gmail.com>
	<47EE6F27.6010706@stats.uwo.ca>
	<8ed68eed0803291010x47e9aaa1y41d1b36d3a021e14@mail.gmail.com>
	<47EE7AA9.5030400@stats.uwo.ca>
Message-ID: <8ed68eed0803291042t7d81821ekefb2371b13de0c7d@mail.gmail.com>

I did a few other places where askstring() is used, e.g. Help /
apropos... and friends.

No problem Duncan if you decide not to fix.  It's one of those "it'd
be nice if it was fixed - but it's not a problem if it doesn't"
bugs... :-)  and now that I have a modern (i.e. 5 year old Linux
machine) at home I'm no longer reliant on the ancient laptop for
everyday use!

All the best,
Sean


On 29/03/2008, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
> On 29/03/2008 1:10 PM, Sean O'Riordain wrote:
>  > Hi Duncan,
>  >
>  > I suspect that it's not the SHBrowseForFolder call as it seems fine
>  > once the Browse button is pressed - the problem occurs *before* the
>  > Browse button is pressed.
>
>
> The Change Dir dialog in R 2.7.0 no longer uses the
>  winDialogString()-like dialog, so the problem will go away in that one
>  case, but any other user of the underlying code will still have the
>  problem.  It's because that function sets up a loop to poll for results.
>   Doesn't really seem worth the trouble to fix.
>
>
>  Duncan Murdoch
>
>


From tadakado at gmail.com  Sat Mar 29 19:08:37 2008
From: tadakado at gmail.com (Tadashi Kadowaki)
Date: Sun, 30 Mar 2008 03:08:37 +0900
Subject: [Rd] A patch for extending pdf device to embed popup text and web
	links
Message-ID: <dcb3073c0803291108m57c4ef6fh22dac712e6a60ddb@mail.gmail.com>

Dear all,

I am sending a patch for extending pdf device to embed popup text and web links.
I implemented this feature by using annotation object, a interactive
feature of pdf.
You can see a sample code for using this feature in the following, and
sample pdf is in
http://www.okada.jp.org/RWiki/?plugin=attach&pcmd=open&file=sample.pdf&refer=PDF%A4%CB%A5%E1%A5%E2%A4%E4URL%A4%CE%A5%EA%A5%F3%A5%AF%A4%F2%CB%E4%A4%E1%B9%FE%A4%E0%A5%D1%A5%C3%A5%C1
In the pdf, boxes in cyan are  web links, and each point has popup text.
If you know about pdf a lot, you can embed any annotation object by calling
PDFAnnotBox directly. I think this patch helps R generate more interactive pdf.

Regards,

Tadashi Kadowaki

--------------------------------------------------------------------------------
sample script
--------------------------------------------------------------------------------
pdf("sample.pdf")
par(oma=c(2,2,2,2))

plot(1:10)

pdf.link.on.box(1, 5, 3, 8, url="http://www.r-project.org")

for(i in 1:10)
    pdf.text.on.box(i-0.1, i-0.1, i+0.1, i+0.1, LETTERS[i], border=c(0,0,0))

text(5, 9, "mouse over points!", col=2)

text(5, 2, "text test")
pdf.link.on.text("http://www.google.com")

mtext("mtext test 1", cex=2)
pdf.link.on.text("http://www.apple.com")

mtext("mtext test 2", side = 2, line=2)
pdf.link.on.text("http://www.vmware.com")

mtext("mtext test 3", outer=T, side = 1)
pdf.link.on.text("http://www.playstation.com")

mtext("mtext test 4", outer=T, side = 4, cex=3)
pdf.link.on.text("http://www.bioconductor.org")

dev.off()
--------------------------------------------------------------------------------
patch to Revision: 44977 Last Changed Date: 2008-03-29
--------------------------------------------------------------------------------
diff -r -c R.org/src/library/grDevices/NAMESPACE
R/src/library/grDevices/NAMESPACE
*** R.org/src/library/grDevices/NAMESPACE	2008-03-29 23:36:12.000000000 +0900
--- R/src/library/grDevices/NAMESPACE	2008-03-30 01:40:49.000000000 +0900
***************
*** 4,10 ****

  if(tools:::.OStype() == "windows") {
      useDynLib(grDevices, R_chull,
!               PicTeX, PostScript, XFig, PDF,
                Cdevga=devga, CsavePlot=savePlot,
                Type1FontInUse, CIDFontInUse, R_GD_nullDevice)
  } else {
--- 4,10 ----

  if(tools:::.OStype() == "windows") {
      useDynLib(grDevices, R_chull,
!               PicTeX, PostScript, XFig, PDF, PDFAnnotBox, PDFTextBoxInfo,
                Cdevga=devga, CsavePlot=savePlot,
                Type1FontInUse, CIDFontInUse, R_GD_nullDevice)
  } else {
***************
*** 23,28 ****
--- 23,30 ----
         extendrange, getGraphicsEvent, graphics.off, gray, grey,
         gray.colors, grey.colors, heat.colors, hsv, hcl, make.rgb,
         n2mfrow, nclass.Sturges, nclass.FD, nclass.scott, palette, pdf,
+        pdf.annot.box, pdf.text.box.info, pdf.link.on.box, pdf.text.on.box,
+        pdf.link.on.text, pdf.text.on.text,
         pdf.options, pdfFonts, pictex, postscript, postscriptFont,
         postscriptFonts, ps.options, rainbow, recordGraphics,
         recordPlot, replayPlot, rgb, rgb2hsv, savePlot, setEPS, setPS,
diff -r -c R.org/src/library/grDevices/R/postscript.R
R/src/library/grDevices/R/postscript.R
*** R.org/src/library/grDevices/R/postscript.R	2008-03-29
23:36:12.000000000 +0900
--- R/src/library/grDevices/R/postscript.R	2008-03-30 01:41:13.000000000 +0900
***************
*** 344,349 ****
--- 344,420 ----
      invisible()
  }

+ pdf.annot.box <- function(x0, y0, x1, y1, annotation_text, coord="USER")
+ {
+     ## is the device pdf?
+     if (names(dev.cur())[1] == "pdf") {
+ 	.External("PDFAnnotBox", x0, y0, x1, y1,
+ 		  as.character(annotation_text[1]), as.character(coord[1]))
+     }
+ }
+
+ pdf.text.box.info <- function()
+ {
+     ## is the device pdf?
+     if (names(dev.cur())[1] == "pdf") {
+ 	.External("PDFTextBoxInfo")
+     }
+ }
+
+ pdf.link.on.box <- function(x0, y0, x1, y1, url, col=c(0,1,1),
+ 			    border=c(0,0,1), coord="USER")
+ {
+     col <- as.numeric(abs(col))[1:3]
+     if (max(col)>1) {
+ 	col <- col / max(col)
+     }
+     border <- as.integer(abs(border))[1:3]
+     annotation_text <-
+ 	paste(paste(c("/C [", col, "]"), collapse=" "),
+ 	      paste(c("/Border [", border, "]"), collapse=" "),
+ 	      paste("/Subtype /Link /A << /Type /Action /S /URI /URI(",
+ 		    as.character(url[1]), ")>>", sep=""), sep="\n")
+     pdf.annot.box(x0, y0, x1, y1, annotation_text, coord)
+ }
+
+ pdf.text.on.box <- function(x0, y0, x1, y1, text, col=NULL,
+ 			    border=c(0,0,0), coord="USER")
+ {
+     if (length(col)>=1 && max(col)>1) {
+ 	col <- col / max(col)
+     }
+     border <- as.integer(abs(border))[1:3]
+     annotation_text <-
+ 	paste(paste(c("/C [", col, "]"), collapse=" "),
+ 	      paste(c("/Border [", border, "]"), collapse=" "),
+ 	      "/Subtype /Square",
+ 	      paste("/Contents (", paste(text, collapse="\r"), ")", sep=""),
+ 	      "/BS << /Type /Border /W 0 >>", sep="\n")
+     pdf.annot.box(x0, y0, x1, y1, annotation_text, coord)
+ }
+
+ pdf.link.on.text <- function(url, col=c(0,1,1), border=c(0,0,1))
+ {
+     geo <- pdf.text.box.info()
+     m <- matrix(c(geo[2], geo[3], -geo[3], geo[2]), nrow=2)/geo[1]
+     x <- cbind(c(0, -geo[8]), c(0, geo[7]),
+                c(geo[6], -geo[8]), c(geo[6], geo[7]))
+     xx <- m %*% x + c(geo[4], geo[5])
+     pdf.link.on.box(min(xx[1,]), min(xx[2,]), max(xx[1,]), max(xx[2,]), url,
+ 		    col, border, "DEVICE")
+ }
+
+ pdf.text.on.text <- function(text, col=c(0,1,1), border=c(0,0,1))
+ {
+     geo <- pdf.text.box.info()
+     m <- matrix(c(geo[2], geo[3], -geo[3], geo[2]), nrow=2)/geo[1]
+     x <- cbind(c(0, -geo[8]), c(0, geo[7]),
+                c(geo[6], -geo[8]), c(geo[6], geo[7]))
+     xx <- m %*% x + c(geo[4], geo[5])
+     pdf.text.on.box(min(xx[1,]), min(xx[2,]), max(xx[1,]), max(xx[2,]), text,
+ 		    col, border, "DEVICE")
+ }
+
  .ps.prolog <- c(
  "/gs  { gsave } def",
  "/gr  { grestore } def",
diff -r -c R.org/src/library/grDevices/src/devPS.c
R/src/library/grDevices/src/devPS.c
*** R.org/src/library/grDevices/src/devPS.c	2008-03-29 23:36:12.000000000 +0900
--- R/src/library/grDevices/src/devPS.c	2008-03-30 01:44:20.000000000 +0900
***************
*** 49,54 ****
--- 49,55 ----
  #include <R_ext/Error.h>
  #include "Fileio.h"
  #include "grDevices.h"
+ #include <Rgraphics.h>          /* for GConvert and GUnit */

  #ifdef HAVE_ERRNO_H
  #include <errno.h>
***************
*** 5136,5141 ****
--- 5137,5146 ----
      Rboolean inText;
      char title[1024];

+     char **annots; /* annotations in a page */
+     int annotsmax; /* allocated size */
+     int annotspos; /* nubmer of annotations */
+
      /*
       * Fonts and encodings used on the device
       */
***************
*** 5149,5154 ****
--- 5154,5166 ----
      cidfontfamily   defaultCIDFont;
      /* Record if fonts are used */
      Rboolean fontUsed[100];
+
+     /*
+      * Current text geometry information (stored in PDF_Text)
+      */
+     int text_size;
+     double text_a, text_b, text_x, text_y;
+     double text_ascent, text_descent, text_width;
  }
  PDFDesc;

***************
*** 5188,5197 ****
--- 5200,5217 ----
  static double PDF_StrWidth(const char *str,
  			   const pGEcontext gc,
  			   pDevDesc dd);
+ static void PDF_StrSize(const char *str,
+ 			const pGEcontext gc,
+ 			pDevDesc dd,
+ 			double *ascent_max,
+ 			double *descent_max,
+ 			double *width_sum);
  static void PDF_Text(double x, double y, const char *str,
  		     double rot, double hadj,
  		     const pGEcontext gc,
  		     pDevDesc dd);
+ static void PDF_free_annots(PDFDesc *pd);
+ static void PDF_add_annot(PDFDesc *pd, char *str);
  #ifdef SUPPORT_MBCS
  static double PDF_StrWidthUTF8(const char *str,
  			       const pGEcontext gc,
***************
*** 5315,5320 ****
--- 5335,5348 ----
      }
      pd->pagemax = 100;

+     pd->annots = (char **) calloc(100, sizeof(char *));
+     if(!pd->annots) {
+ 	free(pd->pos); free(pd->pageobj); free(pd); free(dd);
+ 	error(_("cannot allocate pd->annots"));
+     }
+     pd->annotsmax = 100;
+     pd->annotspos = 0;
+

      /* initialize PDF device description */
      strcpy(pd->filename, file);
***************
*** 5328,5334 ****

      if(strlen(encoding) > PATH_MAX - 1) {
  	free(dd);
! 	free(pd->pos); free(pd->pageobj); free(pd);
  	error(_("encoding path is too long"));
      }
      /*
--- 5356,5362 ----

      if(strlen(encoding) > PATH_MAX - 1) {
  	free(dd);
! 	free(pd->pos); free(pd->pageobj); PDF_free_annots(pd); free(pd);
  	error(_("encoding path is too long"));
      }
      /*
***************
*** 5344,5349 ****
--- 5372,5378 ----
  	pd->encodings = enclist;
      } else {
  	free(dd);
+ 	PDF_free_annots(pd);
  	free(pd);
  	error(_("failed to load default encoding"));
      }
***************
*** 5410,5415 ****
--- 5439,5445 ----
      }
      if (!gotFont) {
  	free(dd);
+ 	PDF_free_annots(pd);
  	free(pd);
  	error(_("Failed to initialise default PostScript font"));
      }
***************
*** 5469,5474 ****
--- 5499,5505 ----
  	    pd->fonts = NULL;
  	    pd->encodings = NULL;
  	    free(dd);
+ 	    PDF_free_annots(pd);
  	    free(pd);
  	    error(_("Failed to initialise additional PostScript fonts"));
  	}
***************
*** 5540,5545 ****
--- 5571,5577 ----
  	pd->fonts = NULL;
  	pd->cidfonts = NULL;
  	free(dd);
+ 	PDF_free_annots(pd);
  	free(pd);
  	error(_("invalid paper type '%s' (pdf)"), pd->papername);
      }
***************
*** 5570,5576 ****
  	pd->cidfonts = NULL;
  	pd->encodings = NULL;
  	free(dd);
! 	free(pd->pos); free(pd->pageobj); free(pd);
  	error(_("invalid foreground/background color (pdf)"));
      }

--- 5602,5608 ----
  	pd->cidfonts = NULL;
  	pd->encodings = NULL;
  	free(dd);
! 	free(pd->pos); free(pd->pageobj); PDF_free_annots(pd); free(pd);
  	error(_("invalid foreground/background color (pdf)"));
      }

***************
*** 5631,5637 ****
  	pd->cidfonts = NULL;
  	pd->encodings = NULL;
  	free(dd);
! 	free(pd->pos); free(pd->pageobj); free(pd);
  	return 0;
      }

--- 5663,5669 ----
  	pd->cidfonts = NULL;
  	pd->encodings = NULL;
  	free(dd);
! 	free(pd->pos); free(pd->pageobj); PDF_free_annots(pd); free(pd);
  	return 0;
      }

***************
*** 6336,6341 ****
--- 6368,6374 ----
  static void PDF_endpage(PDFDesc *pd)
  {
      int here;
+     int i;
      if(pd->inText) textoff(pd);
      fprintf(pd->pdffp, "Q\n");
      here = (int) ftell(pd->pdffp);
***************
*** 6343,6348 ****
--- 6376,6397 ----
      pd->pos[++pd->nobjs] = (int) ftell(pd->pdffp);
      fprintf(pd->pdffp, "%d 0 obj\n%d\nendobj\n", pd->nobjs,
  	    here - pd->startstream);
+     pd->pos[++pd->nobjs] = (int) ftell(pd->pdffp);
+     fprintf(pd->pdffp, "%d 0 obj\n<<\n/Type /Page\n/Parent 3 0
R\n/Contents %d 0 R\n/Resources 4 0 R\n",
+ 	    pd->nobjs, pd->nobjs-2);
+     if(pd->annotspos) {
+ 	fprintf(pd->pdffp, "/Annots [");
+ 	for(i = 0 ; i < pd->annotspos ; i++)
+ 	  fprintf(pd->pdffp, " %d 0 R", pd->nobjs+1+i);
+ 	fprintf(pd->pdffp, " ]\n");
+     }
+     fprintf(pd->pdffp, ">>\nendobj\n");
+     for(i = 0 ; i < pd->annotspos ; i++) {
+ 	pd->pos[++pd->nobjs] = (int) ftell(pd->pdffp);
+ 	fprintf(pd->pdffp, "%d %s", pd->nobjs, pd->annots[i]);
+ 	free(pd->annots[i]);
+     }
+     pd->annotspos = 0;
  }

  #define R_VIS(col) (R_ALPHA(col) > 0)
***************
*** 6352,6357 ****
--- 6401,6407 ----
  {
      PDFDesc *pd = (PDFDesc *) dd->deviceSpecific;
      char buf[512];
+     int i;

      if(pd->pageno >= pd->pagemax || pd->nobjs >= 3*pd->pagemax) {
  	pd->pageobj = (int *)
***************
*** 6377,6386 ****
  	}
      }

!     pd->pos[++pd->nobjs] = (int) ftell(pd->pdffp);
!     pd->pageobj[pd->pageno++] = pd->nobjs;
!     fprintf(pd->pdffp, "%d 0 obj\n<<\n/Type /Page\n/Parent 3 0
R\n/Contents %d 0 R\n/Resources 4 0 R\n>>\nendobj\n",
! 	    pd->nobjs, pd->nobjs+1);
      pd->pos[++pd->nobjs] = (int) ftell(pd->pdffp);
      fprintf(pd->pdffp, "%d 0 obj\n<<\n/Length %d 0 R\n>>\nstream\r\n",
  	    pd->nobjs, pd->nobjs + 1);
--- 6427,6433 ----
  	}
      }

!     pd->pageobj[pd->pageno++] = pd->nobjs+3;
      pd->pos[++pd->nobjs] = (int) ftell(pd->pdffp);
      fprintf(pd->pdffp, "%d 0 obj\n<<\n/Length %d 0 R\n>>\nstream\r\n",
  	    pd->nobjs, pd->nobjs + 1);
***************
*** 6411,6417 ****
      freeDeviceEncList(pd->encodings);
      pd->fonts = NULL;
      pd->encodings = NULL;
!     free(pd->pos); free(pd->pageobj); free(pd);
  }

  static void PDF_Activate(pDevDesc dd) {}
--- 6458,6464 ----
      freeDeviceEncList(pd->encodings);
      pd->fonts = NULL;
      pd->encodings = NULL;
!     free(pd->pos); free(pd->pageobj); PDF_free_annots(pd); free(pd);
  }

  static void PDF_Activate(pDevDesc dd) {}
***************
*** 6663,6668 ****
--- 6710,6716 ----
      int face = gc->fontface;
      double a, b, rot1;
      const char *str1 = str;
+     double ascent, descent, width;

      if(!R_VIS(gc->col)) return;

***************
*** 6683,6688 ****
--- 6731,6745 ----
  	    a, b, -b, a, x, y);
      PostScriptWriteString(pd->pdffp, str1);
      fprintf(pd->pdffp, " Tj\n");
+     pd->text_size = size;
+     pd->text_a = a;
+     pd->text_b = b;
+     pd->text_x = x;
+     pd->text_y = y;
+     PDF_StrSize(str1, gc, dd, &ascent, &descent, &width);
+     pd->text_ascent = ascent;
+     pd->text_descent = descent;
+     pd->text_width = width;
  }

  #ifndef SUPPORT_MBCS
***************
*** 6711,6716 ****
--- 6768,6774 ----
      double a, b, rot1;
      const char *str1 = str;
      char *buff;
+     double ascent, descent, width;

      if(!R_VIS(gc->col)) return;

***************
*** 6732,6737 ****
--- 6790,6805 ----
      if(fabs(b) < 0.01) b = 0.0;
      if(!pd->inText) texton(pd);

+     pd->text_size = size;
+     pd->text_a = a;
+     pd->text_b = b;
+     pd->text_x = x;
+     pd->text_y = y;
+     PDF_StrSize(str1, gc, dd, &ascent, &descent, &width);
+     pd->text_ascent = ascent;
+     pd->text_descent = descent;
+     pd->text_width = width;
+
      if(isCIDFont(gc->fontfamily, PDFFonts, pd->defaultCIDFont) && face != 5) {
  	/* NB we could be in a SBCS here */
          unsigned char *buf = NULL /* -Wall */;
***************
*** 7048,7053 ****
--- 7116,7146 ----
  }
  #endif

+ static void PDF_StrSize(const char *str,
+ 			R_GE_gcontext *gc,
+ 			NewDevDesc *dd,
+ 			double* ascent_max,
+ 			double* descent_max,
+ 			double* width_sum)
+ {
+     PDFDesc *pd = (PDFDesc *) dd->deviceSpecific;
+     int face = gc->fontface;
+     double ascent, descent, width;
+     int i, n;
+
+     *ascent_max = 0.0;
+     *descent_max = 0.0;
+     *width_sum = 0.0;
+
+     n = (int) strlen(str);
+     for(i=0; i<n; i++) {
+ 	PDF_MetricInfo((int) str[i], gc, &ascent, &descent, &width, dd);
+ 	if (*ascent_max < ascent) *ascent_max = ascent;
+ 	if (*descent_max < descent) *descent_max = descent;
+ 	*width_sum += width;
+     }
+ }
+
  static void PDF_MetricInfo(int c,
  			   const pGEcontext gc,
  			   double* ascent, double* descent,
***************
*** 7076,7081 ****
--- 7169,7205 ----
      *width = floor(gc->cex * gc->ps + 0.5) * *width;
  }

+ static void PDF_free_annots(PDFDesc *pd)
+ {
+     int i;
+     for (i = 0; i < pd->annotspos; i++) free(pd->annots[i]);
+     free(pd->annots);
+ }
+
+ static void PDF_add_annot(PDFDesc *pd, char *str)
+ {
+     char **annots;
+     char *annot_str;
+     int nchar;
+
+     if (pd->annotspos >= pd->annotsmax) {
+ 	annots = realloc(pd->annots, pd->annotsmax + 100);
+ 	if (annots) {
+ 	    pd->annots = annots;
+ 	    pd->annotsmax += 100;
+ 	} else {
+ 	    error(_("unable to increase annotation limit"));
+ 	}
+     }
+     nchar = strlen(str);
+     annot_str = (char *) calloc(nchar+1, sizeof(char));
+     if(!annot_str) {
+ 	error(_("cannot allocate pd->annots[i]"));
+     }
+     strncpy(annot_str, str, nchar+1);
+     pd->annots[pd->annotspos++] = annot_str;
+ }
+

  /*  PostScript Device Driver Parameters:
   *  ------------------------
***************
*** 7302,7304 ****
--- 7426,7496 ----
      vmaxset(vmax);
      return R_NilValue;
  }
+
+
+ /* PDFAnnotBox(x0, y0, x1, y1, text, coord) */
+
+ SEXP PDFAnnotBox(SEXP args)
+ {
+     pGEDevDesc gdd = GEcurrentDevice();
+     PDFDesc *pd = (PDFDesc *) gdd->dev->deviceSpecific;
+     double x0, y0, x1, y1;
+     char *text, *coord;
+     GUnit from, to;
+     char annot_text[1024] = "";
+
+     args = CDR(args);
+     x0 = asReal(CAR(args)); args = CDR(args);
+     y0 = asReal(CAR(args)); args = CDR(args);
+     x1 = asReal(CAR(args)); args = CDR(args);
+     y1 = asReal(CAR(args)); args = CDR(args);
+     text = (char *)CHAR(asChar(CAR(args))); args = CDR(args);
+     coord = (char *)CHAR(asChar(CAR(args)));
+
+     if (strcmp("DEVICE", coord) == 0) { from = DEVICE; }
+     if (strcmp("NDC",    coord) == 0) { from = NDC; }
+     if (strcmp("INCHES", coord) == 0) { from = INCHES; }
+     if (strcmp("OMA1",   coord) == 0) { from = OMA1; }
+     if (strcmp("OMA2",   coord) == 0) { from = OMA2; }
+     if (strcmp("OMA3",   coord) == 0) { from = OMA3; }
+     if (strcmp("OMA4",   coord) == 0) { from = OMA4; }
+     if (strcmp("NIC",    coord) == 0) { from = NIC; }
+     if (strcmp("NFC",    coord) == 0) { from = NFC; }
+     if (strcmp("MAR1",   coord) == 0) { from = MAR1; }
+     if (strcmp("MAR2",   coord) == 0) { from = MAR2; }
+     if (strcmp("MAR3",   coord) == 0) { from = MAR3; }
+     if (strcmp("MAR4",   coord) == 0) { from = MAR4; }
+     if (strcmp("NPC",    coord) == 0) { from = NPC; }
+     if (strcmp("USER",   coord) == 0) { from = USER; }
+     to = DEVICE;
+
+     GConvert(&x0, &y0, from, to, gdd);
+     GConvert(&x1, &y1, from, to, gdd);
+
+     snprintf(annot_text, 1024,
+            "0 obj <<\n/Type /Annot\n/Rect [ %.2f %.2f %.2f %.2f
]\n%s\n>> endobj\n",
+           x0, y0, x1, y1, text);
+     PDF_add_annot(pd, annot_text);
+     return R_NilValue;
+ }
+
+
+ /* PDFTextBoxInfo() */
+
+ SEXP PDFTextBoxInfo(SEXP args)
+ {
+     PDFDesc *pd = GEcurrentDevice()->dev->deviceSpecific;
+     SEXP out;
+
+     out = allocVector(REALSXP, 8);
+     REAL(out)[0] = pd->text_size;
+     REAL(out)[1] = pd->text_a;
+     REAL(out)[2] = pd->text_b;
+     REAL(out)[3] = pd->text_x;
+     REAL(out)[4] = pd->text_y;
+     REAL(out)[5] = pd->text_width;
+     REAL(out)[6] = pd->text_ascent;
+     REAL(out)[7] = pd->text_descent;
+
+     return out;
+ }
diff -r -c R.org/src/library/grDevices/src/grDevices.h
R/src/library/grDevices/src/grDevices.h
*** R.org/src/library/grDevices/src/grDevices.h	2008-03-29
23:36:12.000000000 +0900
--- R/src/library/grDevices/src/grDevices.h	2008-03-30 00:30:24.000000000 +0900
***************
*** 43,48 ****
--- 43,51 ----

  SEXP Quartz(SEXP);

+ SEXP PDFAnnotBox(SEXP);
+ SEXP PDFTextBoxInfo(SEXP);
+
  SEXP R_GD_nullDevice();

  Rboolean
diff -r -c R.org/src/library/grDevices/src/init.c
R/src/library/grDevices/src/init.c
*** R.org/src/library/grDevices/src/init.c	2008-03-29 23:36:12.000000000 +0900
--- R/src/library/grDevices/src/init.c	2008-03-30 00:31:03.000000000 +0900
***************
*** 62,67 ****
--- 62,69 ----
  #else
      EXTDEF(Quartz, 12),
  #endif
+     EXTDEF(PDFAnnotBox, 6),
+     EXTDEF(PDFTextBoxInfo, 0),
      {NULL, NULL, 0}
  };


From tadakado at gmail.com  Sat Mar 29 19:36:53 2008
From: tadakado at gmail.com (Tadashi Kadowaki)
Date: Sun, 30 Mar 2008 03:36:53 +0900
Subject: [Rd] A patch for extending pdf device to embed popup text and
	web links
In-Reply-To: <dcb3073c0803291108m57c4ef6fh22dac712e6a60ddb@mail.gmail.com>
References: <dcb3073c0803291108m57c4ef6fh22dac712e6a60ddb@mail.gmail.com>
Message-ID: <dcb3073c0803291136m2329e6c2ida453dc1a90060f1@mail.gmail.com>

Dear all,

I am sorry that the patch in the previous mail was broken.
Gmail broke lines of the patch...
I uploaded correct one on
http://d.hatena.ne.jp/tadakado/20080329

Regards,

Tadashi Kadowaki


From cgenolin at u-paris10.fr  Sat Mar 29 19:15:14 2008
From: cgenolin at u-paris10.fr (cgenolin at u-paris10.fr)
Date: Sat, 29 Mar 2008 19:15:14 +0100 (CET)
Subject: [Rd] S4: dumpMethod (PR#11053)
Message-ID: <20080329181514.92769282EFF8@mail.pubhealth.ku.dk>

Full_Name: Christophe Genolini
Version: 2.6.2
OS: Windows XP
Submission from: (NULL) (82.225.59.146)


*This is a mail that I post on r-help: *

>> It seems that the dumpMethod does not work.

setClass("A",representation(a="numeric"))
setMethod("plot","A",function(x,y,...){cat("AAAAA\n")})
dumpMethod("plot","A",file="")
#setMethod("plot", "A",
#NULL
#)
#[1] ""

> Answer from Martin Maechler

> dumpMethod() has not been updated when the internal method
> definition (and storage) code has been changed.
> Consequently, it looks pretty broken to me, as well.
>
> OTOH, I have never seen any need to use it,
> since I only work with *.R files which I write and comment and ..
> and never would want to replace with anything dumped...
>
> Do you want to submit a (legitimate (!)) bug report to R-bugs ?

Well, I did not submit a bug concerning a (may be) useless method... 
But today, I find it usefull: "package.skeleton" use dump.
So a "package.skeleton.S4" might need dumpMethod...

Christophe


From seanpor at acm.org  Sat Mar 29 18:04:26 2008
From: seanpor at acm.org (Sean O'Riordain)
Date: Sat, 29 Mar 2008 17:04:26 +0000
Subject: [Rd] cpu usage high with windows change dir / winDialogString
	(PR#11045)
In-Reply-To: <47EE690C.6070300@stats.uwo.ca>
References: <20080328160529.717BA282EFF8@mail.pubhealth.ku.dk>
	<47EE690C.6070300@stats.uwo.ca>
Message-ID: <8ed68eed0803291004v64ed0e37oeac73ae5aeed003a@mail.gmail.com>

Good afternoon Duncan,

Thanks for that.  See below for my reply.

Best Regards,
Sean

On 29/03/2008, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
> On 28/03/2008 12:05 PM, seanpor at acm.org wrote:
>  > Good afternoon,
>  >
>  > This is possibly a windows only bug, definitely of comparatively low
>  > importance - but for the sake of completeness here we go.  I've
>  > searched http://bugs.R-project.org/ etc., but can find no mention.
>  >
>  > For RGui.exe, the CPU usage goes to 100% for certain dialog boxes for
>  > the duration that the dialog box is visible, e.g.
>  >
>  > * check CPU usage is low
>  > * On the RGui.exe menu chose File / Change dir...
>  > * the CPU usage goes to 100%
>  > * hit OK
>  > * the CPU usage goes back down again
>
>  What is the bug here?  I'd guess it's not R using the cpu, rather some
>  other process hooked to the dialog, but even if it really is R, why is
>  this a bug?

Using Taskmanager it shows that RGui.exe is using 92-95% CPU while the
winDialogString() is open and 0% when the dialog is closed or a
different R dialog is used e.g. winDialog("yesnocancel", "Do you
agree?").  The bug is that the cpu usage is unusually high - by
comparison for other dialogs e.g. File / Open script... the cpu usage
stays low - for other windows applications it is not "normal" for cpu
usage to be at 100% while waiting for user input - on slower machines
(e.g. my ancient laptop) this can bring the machine to its' knees
(almost) for the short duration that the dialog is open!  If I select
the "Browse" button, the cpu usage for RGui.exe falls away to 0% so it
is only during the period that R is waiting for the user to fill in
the dialog.  Not an important bug by any means!

Best regards,
Sean


From seanpor at acm.org  Sat Mar 29 18:10:11 2008
From: seanpor at acm.org (Sean O'Riordain)
Date: Sat, 29 Mar 2008 17:10:11 +0000
Subject: [Rd] cpu usage high with windows change dir / winDialogString
	(PR#11045)
In-Reply-To: <47EE6F27.6010706@stats.uwo.ca>
References: <20080328160529.717BA282EFF8@mail.pubhealth.ku.dk>
	<47EE690C.6070300@stats.uwo.ca>
	<971536df0803290923t4c6ef40axc7176141f959a67f@mail.gmail.com>
	<47EE6F27.6010706@stats.uwo.ca>
Message-ID: <8ed68eed0803291010x47e9aaa1y41d1b36d3a021e14@mail.gmail.com>

Hi Duncan,

I suspect that it's not the SHBrowseForFolder call as it seems fine
once the Browse button is pressed - the problem occurs *before* the
Browse button is pressed.

Regards,
Sean


On 29/03/2008, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
> On 29/03/2008 12:23 PM, Gabor Grothendieck wrote:
>  > On Sat, Mar 29, 2008 at 12:06 PM, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
>  >> On 28/03/2008 12:05 PM, seanpor at acm.org wrote:
>  >>> Good afternoon,
>  >>>
>  >>> This is possibly a windows only bug, definitely of comparatively low
>  >>> importance - but for the sake of completeness here we go.  I've
>  >>> searched http://bugs.R-project.org/ etc., but can find no mention.
>  >>>
>  >>> For RGui.exe, the CPU usage goes to 100% for certain dialog boxes for
>  >>> the duration that the dialog box is visible, e.g.
>  >>>
>  >>> * check CPU usage is low
>  >>> * On the RGui.exe menu chose File / Change dir...
>  >>> * the CPU usage goes to 100%
>  >>> * hit OK
>  >>> * the CPU usage goes back down again
>  >> What is the bug here?  I'd guess it's not R using the cpu, rather some
>  >> other process hooked to the dialog, but even if it really is R, why is
>  >> this a bug?
>  >
>  > Maybe R is sitting in a loop consuming all the resources of the system?
>
>
> It's a SHBrowseForFolder call, with a callback.  If there's a bug, it
>  looks to me as though it's in Windows.
>
>
>  Duncan Murdoch
>


From katie.cheon at gmail.com  Sun Mar 30 06:09:00 2008
From: katie.cheon at gmail.com (Kyeongmi Cheon)
Date: Sat, 29 Mar 2008 23:09:00 -0500
Subject: [Rd] norm_rand() in R-extension vs rnorm in R ---which is better?
Message-ID: <d9ad173c0803292109u1438c3bep1b58ab2e6bc31555@mail.gmail.com>

I need to generate good quality of random numbers from univariate
normal distribution for further transformation. I tried rnorm in R but
it was not good sometimes. Someone said C++ standard library or
Fortran's built-in functions for that are good. I found that there is
double norm_rand() in R-extension.  Does this function, norm_rand()
use the same algorithm as rnorm in R or something similar in C/C++? Or
does anyone know which one between norm_rand() in R-extension and
rnorm in R is better?  If anyone could help, I would appreciate it.
Kyeongmi

University of Memphis


From lobry at biomserv.univ-lyon1.fr  Sun Mar 30 11:52:06 2008
From: lobry at biomserv.univ-lyon1.fr (Jean lobry)
Date: Sun, 30 Mar 2008 10:52:06 +0100
Subject: [Rd] data(lh) time serie parameters
In-Reply-To: <mailman.25.1206702006.15065.r-devel@r-project.org>
References: <mailman.25.1206702006.15065.r-devel@r-project.org>
Message-ID: <p06002005c4150f9d2903@[192.168.1.10]>

Dear all,

I'm confused by the time serie parameters in data(lh) :

sueoka:~ lobry$ R --vanilla --quiet
>  tsp(lh)
[1]  1 48  1

because documentation says:

QUOTE
A regular time series giving the luteinizing hormone in blood
samples at 10 mins intervals from a human female, 48 samples.
UNQUOTE

So that I would expect the time serie to end at 480 minutes
or 8 hours. Shouldn't we have something like:

>  tsp(lh) <- c(10, 480, 0.1) # in Minutes

or

>  tsp(lh) <- c(1/6, 8, 6)    # in Hours

Best,

Jean

>  sessionInfo()
R version 2.6.2 (2008-02-08)
i386-apple-darwin8.10.1

locale:
C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

loaded via a namespace (and not attached):
[1] rcompgen_0.1-17

-- 
Jean R. Lobry            (lobry at biomserv.univ-lyon1.fr)
Laboratoire BBE-CNRS-UMR-5558, Univ. C. Bernard - LYON I,
43 Bd 11/11/1918, F-69622 VILLEURBANNE CEDEX, FRANCE
allo  : +33 472 43 27 56     fax    : +33 472 43 13 88
http://pbil.univ-lyon1.fr/members/lobry/


From ggrothendieck at gmail.com  Sun Mar 30 13:36:23 2008
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sun, 30 Mar 2008 07:36:23 -0400
Subject: [Rd] data(lh) time serie parameters
In-Reply-To: <p06002005c4150f9d2903@192.168.1.10>
References: <mailman.25.1206702006.15065.r-devel@r-project.org>
	<p06002005c4150f9d2903@192.168.1.10>
Message-ID: <971536df0803300436r6615feb2hc445b9e143edba14@mail.gmail.com>

On Sun, Mar 30, 2008 at 5:52 AM, Jean lobry
<lobry at biomserv.univ-lyon1.fr> wrote:
> Dear all,
>
> I'm confused by the time serie parameters in data(lh) :
>
> sueoka:~ lobry$ R --vanilla --quiet
> >  tsp(lh)
> [1]  1 48  1
>
> because documentation says:
>
> QUOTE
> A regular time series giving the luteinizing hormone in blood
> samples at 10 mins intervals from a human female, 48 samples.
> UNQUOTE
>
> So that I would expect the time serie to end at 480 minutes
> or 8 hours. Shouldn't we have something like:
>
> >  tsp(lh) <- c(10, 480, 0.1) # in Minutes
>
> or
>
> >  tsp(lh) <- c(1/6, 8, 6)    # in Hours

It seems they are using 10 minutes as the unit of measurement.
If you wish to change it to hours you might want to use this instead:

   lh.hr <- ts(lh, start = 0, frequency = 6)

so that

   cycle(lh.hr)

starts out at 1.


From ggrothendieck at gmail.com  Sun Mar 30 16:10:53 2008
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sun, 30 Mar 2008 10:10:53 -0400
Subject: [Rd] callCC in 2.7.0
Message-ID: <971536df0803300710t40f61256x78b9889a5c323924@mail.gmail.com>

Would anyone like to explain if callCC in R 2.7.0 gives
anything that on.exit does not already provide?

It seems that the exit condition once defined cannot
be added to overridden whereas with on.exit multiple
on.exit's add additional on.exits rather than being ignored.

Is this important?


From h.wickham at gmail.com  Sun Mar 30 18:04:25 2008
From: h.wickham at gmail.com (h.wickham at gmail.com)
Date: Sun, 30 Mar 2008 11:04:25 -0500
Subject: [Rd] callCC in 2.7.0
In-Reply-To: <971536df0803300710t40f61256x78b9889a5c323924@mail.gmail.com>
References: <971536df0803300710t40f61256x78b9889a5c323924@mail.gmail.com>
Message-ID: <f8e6ff050803300904i1a950ed5r58738fb4184ccad0@mail.gmail.com>

> Would anyone like to explain if callCC in R 2.7.0 gives
> anything that on.exit does not already provide?
>
> It seems that the exit condition once defined cannot
> be added to overridden whereas with on.exit multiple
> on.exit's add additional on.exits rather than being ignored.
>
> Is this important?

It facilitates a completely different style of programming - see
http://en.wikipedia.org/wiki/Continuation-passing_style

--
http://had.co.nz/


From ggrothendieck at gmail.com  Sun Mar 30 18:34:42 2008
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sun, 30 Mar 2008 12:34:42 -0400
Subject: [Rd] callCC in 2.7.0
In-Reply-To: <f8e6ff050803300904i1a950ed5r58738fb4184ccad0@mail.gmail.com>
References: <971536df0803300710t40f61256x78b9889a5c323924@mail.gmail.com>
	<f8e6ff050803300904i1a950ed5r58738fb4184ccad0@mail.gmail.com>
Message-ID: <971536df0803300934t4f354132od131d1f567652fd0@mail.gmail.com>

I think the only relationship to that is the name since
it does not appear to allow one to leave a function
in the middle of its processing and re-enter it back
at that point -- which is what would be needed.

On Sun, Mar 30, 2008 at 12:04 PM,  <h.wickham at gmail.com> wrote:
>
> > Would anyone like to explain if callCC in R 2.7.0 gives
> > anything that on.exit does not already provide?
> >
> > It seems that the exit condition once defined cannot
> > be added to overridden whereas with on.exit multiple
> > on.exit's add additional on.exits rather than being ignored.
> >
> > Is this important?
>
> It facilitates a completely different style of programming - see
> http://en.wikipedia.org/wiki/Continuation-passing_style
>
> --
> http://had.co.nz/
>


From ggrothendieck at gmail.com  Sun Mar 30 18:58:08 2008
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sun, 30 Mar 2008 12:58:08 -0400
Subject: [Rd] callCC in 2.7.0
In-Reply-To: <971536df0803300934t4f354132od131d1f567652fd0@mail.gmail.com>
References: <971536df0803300710t40f61256x78b9889a5c323924@mail.gmail.com>
	<f8e6ff050803300904i1a950ed5r58738fb4184ccad0@mail.gmail.com>
	<971536df0803300934t4f354132od131d1f567652fd0@mail.gmail.com>
Message-ID: <971536df0803300958t2cca7f07w59746a388c0b488f@mail.gmail.com>

Also in trying it out again it seems that its not like
on.exit but more like return:

F <- function(f) { f(10); print(2); f(20); 3}
callCC(F)

acts the same as:

F <- function() { return(10); print(2); f(20); 3}
F()

and there is no documented way to restart F
at the point it left off so I assume it can't.

On Sun, Mar 30, 2008 at 12:34 PM, Gabor Grothendieck
<ggrothendieck at gmail.com> wrote:
> I think the only relationship to that is the name since
> it does not appear to allow one to leave a function
> in the middle of its processing and re-enter it back
> at that point -- which is what would be needed.
>
>
> On Sun, Mar 30, 2008 at 12:04 PM,  <h.wickham at gmail.com> wrote:
> >
> > > Would anyone like to explain if callCC in R 2.7.0 gives
> > > anything that on.exit does not already provide?
> > >
> > > It seems that the exit condition once defined cannot
> > > be added to overridden whereas with on.exit multiple
> > > on.exit's add additional on.exits rather than being ignored.
> > >
> > > Is this important?
> >
> > It facilitates a completely different style of programming - see
> > http://en.wikipedia.org/wiki/Continuation-passing_style
> >
> > --
> > http://had.co.nz/
> >
>


From luke at stat.uiowa.edu  Sun Mar 30 19:14:58 2008
From: luke at stat.uiowa.edu (Luke Tierney)
Date: Sun, 30 Mar 2008 12:14:58 -0500 (CDT)
Subject: [Rd] callCC in 2.7.0
In-Reply-To: <971536df0803300958t2cca7f07w59746a388c0b488f@mail.gmail.com>
References: <971536df0803300710t40f61256x78b9889a5c323924@mail.gmail.com>
	<f8e6ff050803300904i1a950ed5r58738fb4184ccad0@mail.gmail.com>
	<971536df0803300934t4f354132od131d1f567652fd0@mail.gmail.com>
	<971536df0803300958t2cca7f07w59746a388c0b488f@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0803301202310.6663@itasca2.wildberry.org>

On Sun, 30 Mar 2008, Gabor Grothendieck wrote:

> Also in trying it out again it seems that its not like
> on.exit but more like return:

Yes -- if you can point out what in the documentation ever gave the
idea it might be like on.exit then we can fix the documentation.

>
> F <- function(f) { f(10); print(2); f(20); 3}
> callCC(F)
>
> acts the same as:
>
> F <- function() { return(10); print(2); f(20); 3}
> F()
>
> and there is no documented way to restart F
> at the point it left off so I assume it can't.

The documentation descriped this as a downward-only version -- that is
standard terminology for a callCC that produces continuations that are
no longer valid after the callCC call exits.

Not sure why your original question was about "callCC in 2.7.0" -- I
believe callCC was added in 2.5.0, the same time as codetools became
recommended, and hasn't changed since.  It is not a function every R
user needs to have in their repertoire, but it can be very useful in
some situations.

luke

> On Sun, Mar 30, 2008 at 12:34 PM, Gabor Grothendieck
> <ggrothendieck at gmail.com> wrote:
>> I think the only relationship to that is the name since
>> it does not appear to allow one to leave a function
>> in the middle of its processing and re-enter it back
>> at that point -- which is what would be needed.
>>
>>
>> On Sun, Mar 30, 2008 at 12:04 PM,  <h.wickham at gmail.com> wrote:
>>>
>>>> Would anyone like to explain if callCC in R 2.7.0 gives
>>>> anything that on.exit does not already provide?
>>>>
>>>> It seems that the exit condition once defined cannot
>>>> be added to overridden whereas with on.exit multiple
>>>> on.exit's add additional on.exits rather than being ignored.
>>>>
>>>> Is this important?
>>>
>>> It facilitates a completely different style of programming - see
>>> http://en.wikipedia.org/wiki/Continuation-passing_style
>>>
>>> --
>>> http://had.co.nz/
>>>
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Luke Tierney
Chair, Statistics and Actuarial Science
Ralph E. Wareham Professor of Mathematical Sciences
University of Iowa                  Phone:             319-335-3386
Department of Statistics and        Fax:               319-335-3017
    Actuarial Science
241 Schaeffer Hall                  email:      luke at stat.uiowa.edu
Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu


From ggrothendieck at gmail.com  Sun Mar 30 19:30:23 2008
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sun, 30 Mar 2008 13:30:23 -0400
Subject: [Rd] callCC in 2.7.0
In-Reply-To: <Pine.LNX.4.64.0803301202310.6663@itasca2.wildberry.org>
References: <971536df0803300710t40f61256x78b9889a5c323924@mail.gmail.com>
	<f8e6ff050803300904i1a950ed5r58738fb4184ccad0@mail.gmail.com>
	<971536df0803300934t4f354132od131d1f567652fd0@mail.gmail.com>
	<971536df0803300958t2cca7f07w59746a388c0b488f@mail.gmail.com>
	<Pine.LNX.4.64.0803301202310.6663@itasca2.wildberry.org>
Message-ID: <971536df0803301030t117f810an69b3f3dc299827e5@mail.gmail.com>

I came across this in googling for continuations and was surprised when
I found it in R 2.7.0 and since I had not come across it before  I assumed
it was added just now.

Can you explain how its intended to be used with an example
that is more realistic than in the example section.

On Sun, Mar 30, 2008 at 1:14 PM, Luke Tierney <luke at stat.uiowa.edu> wrote:
> On Sun, 30 Mar 2008, Gabor Grothendieck wrote:
>
> > Also in trying it out again it seems that its not like
> > on.exit but more like return:
>
> Yes -- if you can point out what in the documentation ever gave the
> idea it might be like on.exit then we can fix the documentation.
>
> >
> > F <- function(f) { f(10); print(2); f(20); 3}
> > callCC(F)
> >
> > acts the same as:
> >
> > F <- function() { return(10); print(2); f(20); 3}
> > F()
> >
> > and there is no documented way to restart F
> > at the point it left off so I assume it can't.
>
> The documentation descriped this as a downward-only version -- that is
> standard terminology for a callCC that produces continuations that are
> no longer valid after the callCC call exits.
>
> Not sure why your original question was about "callCC in 2.7.0" -- I
> believe callCC was added in 2.5.0, the same time as codetools became
> recommended, and hasn't changed since.  It is not a function every R
> user needs to have in their repertoire, but it can be very useful in
> some situations.
>
> luke
>
> > On Sun, Mar 30, 2008 at 12:34 PM, Gabor Grothendieck
> > <ggrothendieck at gmail.com> wrote:
> >> I think the only relationship to that is the name since
> >> it does not appear to allow one to leave a function
> >> in the middle of its processing and re-enter it back
> >> at that point -- which is what would be needed.
> >>
> >>
> >> On Sun, Mar 30, 2008 at 12:04 PM,  <h.wickham at gmail.com> wrote:
> >>>
> >>>> Would anyone like to explain if callCC in R 2.7.0 gives
> >>>> anything that on.exit does not already provide?
> >>>>
> >>>> It seems that the exit condition once defined cannot
> >>>> be added to overridden whereas with on.exit multiple
> >>>> on.exit's add additional on.exits rather than being ignored.
> >>>>
> >>>> Is this important?
> >>>
> >>> It facilitates a completely different style of programming - see
> >>> http://en.wikipedia.org/wiki/Continuation-passing_style
> >>>
> >>> --
> >>> http://had.co.nz/
> >>>
> >>
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >
>
> --
> Luke Tierney
> Chair, Statistics and Actuarial Science
> Ralph E. Wareham Professor of Mathematical Sciences
> University of Iowa                  Phone:             319-335-3386
> Department of Statistics and        Fax:               319-335-3017
>    Actuarial Science
> 241 Schaeffer Hall                  email:      luke at stat.uiowa.edu
> Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu
>


From luke at stat.uiowa.edu  Sun Mar 30 19:31:11 2008
From: luke at stat.uiowa.edu (Luke Tierney)
Date: Sun, 30 Mar 2008 12:31:11 -0500 (CDT)
Subject: [Rd] callCC in 2.7.0
In-Reply-To: <971536df0803300934t4f354132od131d1f567652fd0@mail.gmail.com>
References: <971536df0803300710t40f61256x78b9889a5c323924@mail.gmail.com>
	<f8e6ff050803300904i1a950ed5r58738fb4184ccad0@mail.gmail.com>
	<971536df0803300934t4f354132od131d1f567652fd0@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0803301215380.6663@itasca2.wildberry.org>

On Sun, 30 Mar 2008, Gabor Grothendieck wrote:

> I think the only relationship to that is the name since
> it does not appear to allow one to leave a function
> in the middle of its processing and re-enter it back
> at that point -- which is what would be needed.

The article conflates basic CPS with having first class continuations
as in Scheme. The discussion about compilers and tail calls only
requires downward-only continuations of the kind provided by R's
current callCC.  The user interface and coroutine discussion requires
continuations that can be run outside of their creating context.  The
most sophisticated variant, as provided in Scheme, also allows
continuations to be run more than once.  I don't think any of the
examples in the Wikipedia article need that, but there is some
interesting work on using that to model web browsing behavior.

At any rate, there is plenty of precedent for using callCC as the name
for the construct here even when the continuation is no longer valid
outside of the creating callCC call. So the relationship is more than
just the name.

luke

>
> On Sun, Mar 30, 2008 at 12:04 PM,  <h.wickham at gmail.com> wrote:
>>
>>> Would anyone like to explain if callCC in R 2.7.0 gives
>>> anything that on.exit does not already provide?
>>>
>>> It seems that the exit condition once defined cannot
>>> be added to overridden whereas with on.exit multiple
>>> on.exit's add additional on.exits rather than being ignored.
>>>
>>> Is this important?
>>
>> It facilitates a completely different style of programming - see
>> http://en.wikipedia.org/wiki/Continuation-passing_style
>>
>> --
>> http://had.co.nz/
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Luke Tierney
Chair, Statistics and Actuarial Science
Ralph E. Wareham Professor of Mathematical Sciences
University of Iowa                  Phone:             319-335-3386
Department of Statistics and        Fax:               319-335-3017
    Actuarial Science
241 Schaeffer Hall                  email:      luke at stat.uiowa.edu
Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu


From ggrothendieck at gmail.com  Sun Mar 30 19:42:38 2008
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sun, 30 Mar 2008 13:42:38 -0400
Subject: [Rd] callCC in 2.7.0
In-Reply-To: <Pine.LNX.4.64.0803301215380.6663@itasca2.wildberry.org>
References: <971536df0803300710t40f61256x78b9889a5c323924@mail.gmail.com>
	<f8e6ff050803300904i1a950ed5r58738fb4184ccad0@mail.gmail.com>
	<971536df0803300934t4f354132od131d1f567652fd0@mail.gmail.com>
	<Pine.LNX.4.64.0803301215380.6663@itasca2.wildberry.org>
Message-ID: <971536df0803301042m5fcb786bkbfa239d22ee73049@mail.gmail.com>

OK. Can you show code to implement the tail recursive version of
fib using callCC in R, say.

Here it is transformed to tail recursive style:

fib <- function(i, a = 0, b = 1) {
  if (i == 0) a else fib(i-1, b, a+b)

Now, how do I add callCC to all this so that the fib call
presumably does not create a new stack instance?

On Sun, Mar 30, 2008 at 1:31 PM, Luke Tierney <luke at stat.uiowa.edu> wrote:
> On Sun, 30 Mar 2008, Gabor Grothendieck wrote:
>
> > I think the only relationship to that is the name since
> > it does not appear to allow one to leave a function
> > in the middle of its processing and re-enter it back
> > at that point -- which is what would be needed.
>
> The article conflates basic CPS with having first class continuations
> as in Scheme. The discussion about compilers and tail calls only
> requires downward-only continuations of the kind provided by R's
> current callCC.  The user interface and coroutine discussion requires
> continuations that can be run outside of their creating context.  The
> most sophisticated variant, as provided in Scheme, also allows
> continuations to be run more than once.  I don't think any of the
> examples in the Wikipedia article need that, but there is some
> interesting work on using that to model web browsing behavior.
>
> At any rate, there is plenty of precedent for using callCC as the name
> for the construct here even when the continuation is no longer valid
> outside of the creating callCC call. So the relationship is more than
> just the name.
>
> luke
>
> >
> > On Sun, Mar 30, 2008 at 12:04 PM,  <h.wickham at gmail.com> wrote:
> >>
> >>> Would anyone like to explain if callCC in R 2.7.0 gives
> >>> anything that on.exit does not already provide?
> >>>
> >>> It seems that the exit condition once defined cannot
> >>> be added to overridden whereas with on.exit multiple
> >>> on.exit's add additional on.exits rather than being ignored.
> >>>
> >>> Is this important?
> >>
> >> It facilitates a completely different style of programming - see
> >> http://en.wikipedia.org/wiki/Continuation-passing_style
> >>
> >> --
> >> http://had.co.nz/
> >>
> >
>
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >
>
> --
> Luke Tierney
> Chair, Statistics and Actuarial Science
> Ralph E. Wareham Professor of Mathematical Sciences
> University of Iowa                  Phone:             319-335-3386
> Department of Statistics and        Fax:               319-335-3017
>    Actuarial Science
> 241 Schaeffer Hall                  email:      luke at stat.uiowa.edu
> Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu
>


From ggrothendieck at gmail.com  Sun Mar 30 19:51:45 2008
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sun, 30 Mar 2008 13:51:45 -0400
Subject: [Rd] callCC in 2.7.0
In-Reply-To: <971536df0803301042m5fcb786bkbfa239d22ee73049@mail.gmail.com>
References: <971536df0803300710t40f61256x78b9889a5c323924@mail.gmail.com>
	<f8e6ff050803300904i1a950ed5r58738fb4184ccad0@mail.gmail.com>
	<971536df0803300934t4f354132od131d1f567652fd0@mail.gmail.com>
	<Pine.LNX.4.64.0803301215380.6663@itasca2.wildberry.org>
	<971536df0803301042m5fcb786bkbfa239d22ee73049@mail.gmail.com>
Message-ID: <971536df0803301051t65629860i31f1a724b5b72c3f@mail.gmail.com>

Sorry it should be as follows:

fib <- function(i, a = 0, b = 1) {
  if (i == 0) b else fib(i-1, b, a+b)
}

Now, how do we transform that to use callCC?


On Sun, Mar 30, 2008 at 1:42 PM, Gabor Grothendieck
<ggrothendieck at gmail.com> wrote:
> OK. Can you show code to implement the tail recursive version of
> fib using callCC in R, say.
>
> Here it is transformed to tail recursive style:
>
> fib <- function(i, a = 0, b = 1) {
>  if (i == 0) a else fib(i-1, b, a+b)
>
> Now, how do I add callCC to all this so that the fib call
> presumably does not create a new stack instance?
>
>
> On Sun, Mar 30, 2008 at 1:31 PM, Luke Tierney <luke at stat.uiowa.edu> wrote:
> > On Sun, 30 Mar 2008, Gabor Grothendieck wrote:
> >
> > > I think the only relationship to that is the name since
> > > it does not appear to allow one to leave a function
> > > in the middle of its processing and re-enter it back
> > > at that point -- which is what would be needed.
> >
> > The article conflates basic CPS with having first class continuations
> > as in Scheme. The discussion about compilers and tail calls only
> > requires downward-only continuations of the kind provided by R's
> > current callCC.  The user interface and coroutine discussion requires
> > continuations that can be run outside of their creating context.  The
> > most sophisticated variant, as provided in Scheme, also allows
> > continuations to be run more than once.  I don't think any of the
> > examples in the Wikipedia article need that, but there is some
> > interesting work on using that to model web browsing behavior.
> >
> > At any rate, there is plenty of precedent for using callCC as the name
> > for the construct here even when the continuation is no longer valid
> > outside of the creating callCC call. So the relationship is more than
> > just the name.
> >
> > luke
> >
> > >
> > > On Sun, Mar 30, 2008 at 12:04 PM,  <h.wickham at gmail.com> wrote:
> > >>
> > >>> Would anyone like to explain if callCC in R 2.7.0 gives
> > >>> anything that on.exit does not already provide?
> > >>>
> > >>> It seems that the exit condition once defined cannot
> > >>> be added to overridden whereas with on.exit multiple
> > >>> on.exit's add additional on.exits rather than being ignored.
> > >>>
> > >>> Is this important?
> > >>
> > >> It facilitates a completely different style of programming - see
> > >> http://en.wikipedia.org/wiki/Continuation-passing_style
> > >>
> > >> --
> > >> http://had.co.nz/
> > >>
> > >
> >
> > > ______________________________________________
> > > R-devel at r-project.org mailing list
> > > https://stat.ethz.ch/mailman/listinfo/r-devel
> > >
> >
> > --
> > Luke Tierney
> > Chair, Statistics and Actuarial Science
> > Ralph E. Wareham Professor of Mathematical Sciences
> > University of Iowa                  Phone:             319-335-3386
> > Department of Statistics and        Fax:               319-335-3017
> >    Actuarial Science
> > 241 Schaeffer Hall                  email:      luke at stat.uiowa.edu
> > Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu
> >
>


From luke at stat.uiowa.edu  Sun Mar 30 22:22:50 2008
From: luke at stat.uiowa.edu (Luke Tierney)
Date: Sun, 30 Mar 2008 15:22:50 -0500 (CDT)
Subject: [Rd] callCC in 2.7.0
In-Reply-To: <971536df0803301051t65629860i31f1a724b5b72c3f@mail.gmail.com>
References: <971536df0803300710t40f61256x78b9889a5c323924@mail.gmail.com> 
	<f8e6ff050803300904i1a950ed5r58738fb4184ccad0@mail.gmail.com> 
	<971536df0803300934t4f354132od131d1f567652fd0@mail.gmail.com> 
	<Pine.LNX.4.64.0803301215380.6663@itasca2.wildberry.org> 
	<971536df0803301042m5fcb786bkbfa239d22ee73049@mail.gmail.com>
	<971536df0803301051t65629860i31f1a724b5b72c3f@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0803301436320.6663@itasca2.wildberry.org>

On Sun, 30 Mar 2008, Gabor Grothendieck wrote:

> Sorry it should be as follows:
>
> fib <- function(i, a = 0, b = 1) {
>  if (i == 0) b else fib(i-1, b, a+b)
> }
>
> Now, how do we transform that to use callCC?
>
>
> On Sun, Mar 30, 2008 at 1:42 PM, Gabor Grothendieck
> <ggrothendieck at gmail.com> wrote:
>> OK. Can you show code to implement the tail recursive version of
>> fib using callCC in R, say.
>>
>> Here it is transformed to tail recursive style:
>>
>> fib <- function(i, a = 0, b = 1) {
>>  if (i == 0) a else fib(i-1, b, a+b)
>>
>> Now, how do I add callCC to all this so that the fib call
>> presumably does not create a new stack instance?

What makes you think callCC has anything to contribute here?

The Wikipedia article Hadley cited says that using CPS effectively is
difficult without tail call optimization, which R does not have and
can't, at least not without some restrictions, because the stack is
avialable via sys.xyz functions.  It does _not_ say that having
explicit continuations implies having tail call optimization.

If you want to, you can rewrite your fib in CPS, something like

     fibCPS <- function(k, i, a = 0, b = 1) {
       if (i == 0) k(b) else fibCPS(k, i-1, b, a+b)
     }

and you can then use callCC to bridge between the nonCPS and CPS
world, e.g. with

     fib <- function(i) callCC(function(k) fibCPS(k, i, 0, 1))

This will grow the stack just like any other recursion in R.  A
(minor) difference compared to your original fib is that the final
exit happens in a single jump rather than a sequence of returns.

The point of adding the current downward-only callCC to R is to
provide a clean, lexically scoped non-local exit mechanism for exiting
from complex, possibly recursive function calls. Dylan provides this
as part of its 'block' construct (also as an exit or continuation
function); Common Lisp has 'block'/'return-from' constructs that use
lexically scoped block name symbols.

For a slightly more realistic example than the ones currently in the
help page: Here is some code that implements a simple binary tree data
structure, and a function that visits the nodes of the tree and calls
a specified function on the value in each node:

     mkTree <- function(value, left, right)
 	list(isLeaf = FALSE, value = value, left = left, right = right)
     mkLeaf <- function(value) list(isLeaf = TRUE, value = value)

     visit <- function(node, fun) {
 	if (node$isLeaf) fun(node$value)
 	else {
 	    visit(node$left, fun)
 	    visit(node$right, fun)
 	    fun(node$value)
 	}
     }

A simple example tree:

     x <- mkTree(1, mkTree(2, mkLeaf(3), mkLeaf(4)),
                    mkTree(5, mkLeaf(6), mkLeaf(7)))

You can use visit() to print out the node values with

     > visit(x, print)
     [1] 3
     [1] 4
     [1] 2
     [1] 6
     [1] 7
     [1] 5
     [1] 1
     >

If you want to use a function like visit() to traverse the tree but
want the traversal to stop when some condition is met then you can
either rewrite visit to allow for this, making it more complicated, or
you can use a non-local exit.  That is where callCC comes in.  To
print all values until you find one equal to 7 you can use

     > callCC(function(exit) {
     +     fun <- function(value) {
     +         if (value == 7) exit(NULL)
     +         else print(value)
     +     }
     +     visit(x, fun)
     + })
     [1] 3
     [1] 4
     [1] 2
     [1] 6
     NULL
     >

One can also imagine situations where this might be useful in a
function passed to an optimizer like optim.  Given that our 'break'
only breaks out of one loop level, callCC can also be useful for
breaking out of a set of nested loops.

I first wrote this particular version of callCC when prototyping the
tryCatch mechanism in pure R code where one needs a means to jump from
a point where a condition is signaled to the point where the handler
is established.  The current tryCatch implementation does things
differently because it needs to integrate with the error handling at
the C level. Currently I use callCC in the constantFold function in
codetools (which is why callCC was added when codetools became
recommended).  This use is similar to the tree example.

luke

>>
>>
>> On Sun, Mar 30, 2008 at 1:31 PM, Luke Tierney <luke at stat.uiowa.edu> wrote:
>>> On Sun, 30 Mar 2008, Gabor Grothendieck wrote:
>>>
>>>> I think the only relationship to that is the name since
>>>> it does not appear to allow one to leave a function
>>>> in the middle of its processing and re-enter it back
>>>> at that point -- which is what would be needed.
>>>
>>> The article conflates basic CPS with having first class continuations
>>> as in Scheme. The discussion about compilers and tail calls only
>>> requires downward-only continuations of the kind provided by R's
>>> current callCC.  The user interface and coroutine discussion requires
>>> continuations that can be run outside of their creating context.  The
>>> most sophisticated variant, as provided in Scheme, also allows
>>> continuations to be run more than once.  I don't think any of the
>>> examples in the Wikipedia article need that, but there is some
>>> interesting work on using that to model web browsing behavior.
>>>
>>> At any rate, there is plenty of precedent for using callCC as the name
>>> for the construct here even when the continuation is no longer valid
>>> outside of the creating callCC call. So the relationship is more than
>>> just the name.
>>>
>>> luke
>>>
>>>>
>>>> On Sun, Mar 30, 2008 at 12:04 PM,  <h.wickham at gmail.com> wrote:
>>>>>
>>>>>> Would anyone like to explain if callCC in R 2.7.0 gives
>>>>>> anything that on.exit does not already provide?
>>>>>>
>>>>>> It seems that the exit condition once defined cannot
>>>>>> be added to overridden whereas with on.exit multiple
>>>>>> on.exit's add additional on.exits rather than being ignored.
>>>>>>
>>>>>> Is this important?
>>>>>
>>>>> It facilitates a completely different style of programming - see
>>>>> http://en.wikipedia.org/wiki/Continuation-passing_style
>>>>>
>>>>> --
>>>>> http://had.co.nz/
>>>>>
>>>>
>>>
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>
>>>
>>> --
>>> Luke Tierney
>>> Chair, Statistics and Actuarial Science
>>> Ralph E. Wareham Professor of Mathematical Sciences
>>> University of Iowa                  Phone:             319-335-3386
>>> Department of Statistics and        Fax:               319-335-3017
>>>    Actuarial Science
>>> 241 Schaeffer Hall                  email:      luke at stat.uiowa.edu
>>> Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu
>>>
>>
>

-- 
Luke Tierney
Chair, Statistics and Actuarial Science
Ralph E. Wareham Professor of Mathematical Sciences
University of Iowa                  Phone:             319-335-3386
Department of Statistics and        Fax:               319-335-3017
    Actuarial Science
241 Schaeffer Hall                  email:      luke at stat.uiowa.edu
Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu


From ggrothendieck at gmail.com  Sun Mar 30 22:31:22 2008
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sun, 30 Mar 2008 16:31:22 -0400
Subject: [Rd] callCC in 2.7.0
In-Reply-To: <Pine.LNX.4.64.0803301436320.6663@itasca2.wildberry.org>
References: <971536df0803300710t40f61256x78b9889a5c323924@mail.gmail.com>
	<f8e6ff050803300904i1a950ed5r58738fb4184ccad0@mail.gmail.com>
	<971536df0803300934t4f354132od131d1f567652fd0@mail.gmail.com>
	<Pine.LNX.4.64.0803301215380.6663@itasca2.wildberry.org>
	<971536df0803301042m5fcb786bkbfa239d22ee73049@mail.gmail.com>
	<971536df0803301051t65629860i31f1a724b5b72c3f@mail.gmail.com>
	<Pine.LNX.4.64.0803301436320.6663@itasca2.wildberry.org>
Message-ID: <971536df0803301331m35354echb5859361a824aaa9@mail.gmail.com>

Thanks.  So its intended to jump straight out of deeply nested
calls without having to manage the unwinding.

On Sun, Mar 30, 2008 at 4:22 PM, Luke Tierney <luke at stat.uiowa.edu> wrote:
> On Sun, 30 Mar 2008, Gabor Grothendieck wrote:
>
> > Sorry it should be as follows:
> >
> > fib <- function(i, a = 0, b = 1) {
> >  if (i == 0) b else fib(i-1, b, a+b)
> > }
> >
> > Now, how do we transform that to use callCC?
> >
> >
> > On Sun, Mar 30, 2008 at 1:42 PM, Gabor Grothendieck
> > <ggrothendieck at gmail.com> wrote:
> >> OK. Can you show code to implement the tail recursive version of
> >> fib using callCC in R, say.
> >>
> >> Here it is transformed to tail recursive style:
> >>
> >> fib <- function(i, a = 0, b = 1) {
> >>  if (i == 0) a else fib(i-1, b, a+b)
> >>
> >> Now, how do I add callCC to all this so that the fib call
> >> presumably does not create a new stack instance?
>
> What makes you think callCC has anything to contribute here?
>
> The Wikipedia article Hadley cited says that using CPS effectively is
> difficult without tail call optimization, which R does not have and
> can't, at least not without some restrictions, because the stack is
> avialable via sys.xyz functions.  It does _not_ say that having
> explicit continuations implies having tail call optimization.
>
> If you want to, you can rewrite your fib in CPS, something like
>
>     fibCPS <- function(k, i, a = 0, b = 1) {
>       if (i == 0) k(b) else fibCPS(k, i-1, b, a+b)
>     }
>
> and you can then use callCC to bridge between the nonCPS and CPS
> world, e.g. with
>
>     fib <- function(i) callCC(function(k) fibCPS(k, i, 0, 1))
>
> This will grow the stack just like any other recursion in R.  A
> (minor) difference compared to your original fib is that the final
> exit happens in a single jump rather than a sequence of returns.
>
> The point of adding the current downward-only callCC to R is to
> provide a clean, lexically scoped non-local exit mechanism for exiting
> from complex, possibly recursive function calls. Dylan provides this
> as part of its 'block' construct (also as an exit or continuation
> function); Common Lisp has 'block'/'return-from' constructs that use
> lexically scoped block name symbols.
>
> For a slightly more realistic example than the ones currently in the
> help page: Here is some code that implements a simple binary tree data
> structure, and a function that visits the nodes of the tree and calls
> a specified function on the value in each node:
>
>     mkTree <- function(value, left, right)
>        list(isLeaf = FALSE, value = value, left = left, right = right)
>     mkLeaf <- function(value) list(isLeaf = TRUE, value = value)
>
>     visit <- function(node, fun) {
>        if (node$isLeaf) fun(node$value)
>        else {
>            visit(node$left, fun)
>            visit(node$right, fun)
>            fun(node$value)
>        }
>     }
>
> A simple example tree:
>
>     x <- mkTree(1, mkTree(2, mkLeaf(3), mkLeaf(4)),
>                    mkTree(5, mkLeaf(6), mkLeaf(7)))
>
> You can use visit() to print out the node values with
>
>     > visit(x, print)
>     [1] 3
>     [1] 4
>     [1] 2
>     [1] 6
>     [1] 7
>     [1] 5
>     [1] 1
>     >
>
> If you want to use a function like visit() to traverse the tree but
> want the traversal to stop when some condition is met then you can
> either rewrite visit to allow for this, making it more complicated, or
> you can use a non-local exit.  That is where callCC comes in.  To
> print all values until you find one equal to 7 you can use
>
>     > callCC(function(exit) {
>     +     fun <- function(value) {
>     +         if (value == 7) exit(NULL)
>     +         else print(value)
>     +     }
>     +     visit(x, fun)
>     + })
>     [1] 3
>     [1] 4
>     [1] 2
>     [1] 6
>     NULL
>     >
>
> One can also imagine situations where this might be useful in a
> function passed to an optimizer like optim.  Given that our 'break'
> only breaks out of one loop level, callCC can also be useful for
> breaking out of a set of nested loops.
>
> I first wrote this particular version of callCC when prototyping the
> tryCatch mechanism in pure R code where one needs a means to jump from
> a point where a condition is signaled to the point where the handler
> is established.  The current tryCatch implementation does things
> differently because it needs to integrate with the error handling at
> the C level. Currently I use callCC in the constantFold function in
> codetools (which is why callCC was added when codetools became
> recommended).  This use is similar to the tree example.
>
>
> luke
>
> >>
> >>
> >> On Sun, Mar 30, 2008 at 1:31 PM, Luke Tierney <luke at stat.uiowa.edu> wrote:
> >>> On Sun, 30 Mar 2008, Gabor Grothendieck wrote:
> >>>
> >>>> I think the only relationship to that is the name since
> >>>> it does not appear to allow one to leave a function
> >>>> in the middle of its processing and re-enter it back
> >>>> at that point -- which is what would be needed.
> >>>
> >>> The article conflates basic CPS with having first class continuations
> >>> as in Scheme. The discussion about compilers and tail calls only
> >>> requires downward-only continuations of the kind provided by R's
> >>> current callCC.  The user interface and coroutine discussion requires
> >>> continuations that can be run outside of their creating context.  The
> >>> most sophisticated variant, as provided in Scheme, also allows
> >>> continuations to be run more than once.  I don't think any of the
> >>> examples in the Wikipedia article need that, but there is some
> >>> interesting work on using that to model web browsing behavior.
> >>>
> >>> At any rate, there is plenty of precedent for using callCC as the name
> >>> for the construct here even when the continuation is no longer valid
> >>> outside of the creating callCC call. So the relationship is more than
> >>> just the name.
> >>>
> >>> luke
> >>>
> >>>>
> >>>> On Sun, Mar 30, 2008 at 12:04 PM,  <h.wickham at gmail.com> wrote:
> >>>>>
> >>>>>> Would anyone like to explain if callCC in R 2.7.0 gives
> >>>>>> anything that on.exit does not already provide?
> >>>>>>
> >>>>>> It seems that the exit condition once defined cannot
> >>>>>> be added to overridden whereas with on.exit multiple
> >>>>>> on.exit's add additional on.exits rather than being ignored.
> >>>>>>
> >>>>>> Is this important?
> >>>>>
> >>>>> It facilitates a completely different style of programming - see
> >>>>> http://en.wikipedia.org/wiki/Continuation-passing_style
> >>>>>
> >>>>> --
> >>>>> http://had.co.nz/
> >>>>>
> >>>>
> >>>
> >>>> ______________________________________________
> >>>> R-devel at r-project.org mailing list
> >>>> https://stat.ethz.ch/mailman/listinfo/r-devel
> >>>>
> >>>
> >>> --
> >>> Luke Tierney
> >>> Chair, Statistics and Actuarial Science
> >>> Ralph E. Wareham Professor of Mathematical Sciences
> >>> University of Iowa                  Phone:             319-335-3386
> >>> Department of Statistics and        Fax:               319-335-3017
> >>>    Actuarial Science
> >>> 241 Schaeffer Hall                  email:      luke at stat.uiowa.edu
> >>> Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu
> >>>
> >>
> >
>
> --
>
> Luke Tierney
> Chair, Statistics and Actuarial Science
> Ralph E. Wareham Professor of Mathematical Sciences
> University of Iowa                  Phone:             319-335-3386
> Department of Statistics and        Fax:               319-335-3017
>    Actuarial Science
> 241 Schaeffer Hall                  email:      luke at stat.uiowa.edu
> Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu
>


From res90sx5 at verizon.net  Sun Mar 30 08:48:18 2008
From: res90sx5 at verizon.net (Daniel Nordlund)
Date: Sat, 29 Mar 2008 23:48:18 -0700
Subject: [Rd] norm_rand() in R-extension vs rnorm in R ---which is
	better?
In-Reply-To: <d9ad173c0803292109u1438c3bep1b58ab2e6bc31555@mail.gmail.com>
References: <d9ad173c0803292109u1438c3bep1b58ab2e6bc31555@mail.gmail.com>
Message-ID: <00a201c89232$09e43530$0201a8c0@Aragorn>

> -----Original Message-----
> From: r-devel-bounces at r-project.org [mailto:r-devel-bounces at r-project.org] On Behalf
> Of Kyeongmi Cheon
> Sent: Saturday, March 29, 2008 9:09 PM
> To: r-devel at r-project.org
> Subject: [Rd] norm_rand() in R-extension vs rnorm in R ---which is better?
> 
> I need to generate good quality of random numbers from univariate
> normal distribution for further transformation. I tried rnorm in R but
> it was not good sometimes. Someone said C++ standard library or
> Fortran's built-in functions for that are good. I found that there is
> double norm_rand() in R-extension.  Does this function, norm_rand()
> use the same algorithm as rnorm in R or something similar in C/C++? Or
> does anyone know which one between norm_rand() in R-extension and
> rnorm in R is better?  If anyone could help, I would appreciate it.
> Kyeongmi
> 

What do you mean when you write that rnorm "was not good sometimes"?  Can you provide an example which demonstrates that rnorm performs poorly?  Enquiring minds would like to know.

Dan

Daniel Nordlund
Bothell, WA USA


From sanders at fs.tum.de  Sun Mar 30 00:40:09 2008
From: sanders at fs.tum.de (sanders at fs.tum.de)
Date: Sun, 30 Mar 2008 00:40:09 +0100 (CET)
Subject: [Rd] "Writing R Extensions": bad example with CAR / CDR as lvalues
	(PR#11054)
Message-ID: <20080329234009.7D36F282EFF8@mail.pubhealth.ku.dk>

Full_Name: Simon Anders
Version: 2.6.2
OS: Ubuntu Linux 
Submission from: (NULL) (86.22.75.91)


This is a rather minor "documentation bug", certainly not at all urgent.

The manual "Writing R extensions" explains in section 5.10 ("Evaluating R
expressions from C") how to use the eval function. Without going into much
details, an example is given how to build up a LANGSXP pairlist to represent an
expression.

This example is taken at verbatim from src/main/print.c, and uses CAR and CDR as
l-values, e.g.
   CAR(t) = install("print")

This has just confused me quite a bit, as my own code, which I wrote following
this example, did not compile, complaining about 'CAR(t)' being illegal as
l-value.

After a while I figured out the reason, which is (as you probably have spotted
immediatly) that the example is taken from a code snipped that imports
Rinternals.h with defined USE_RINTERNALS, while I followed the manual's advice
to not define USE_RINTERNALS for extensions.

Maybe you could add a note in this section of the manual that one should use
SETCAR and SETCDR instead. A more illustrative example would be even better.


Just in case you want to use it as example, here is my code. I hope it is
correct in your expert eyes.

   /* Remove the variable with name s from the environment ev, 
      i.e. construct the call: rm( list=s, envir=ev ) */

   SEXP call;
   PROTECT( call = Rf_allocList( 3 ) );
   SET_TYPEOF( call, LANGSXP );
   
   SETCAR( call, install( "rm" ) );
   
   SETCAR( CDR(call), allocVector( STRSXP, 1 ) );
   SET_STRING_ELT( CAR( CDR(call) ), 0, mkChar( s ) );
   SET_TAG( CDR(call), install("list") );
   
   SETCAR( CDDR(call), ev );
   SET_TAG( CDDR(call), install("envir") );

   eval( call, R_GlobalEnv );
   UNPROTECT( 1 );


From cgenolin at u-paris10.fr  Sun Mar 30 15:49:23 2008
From: cgenolin at u-paris10.fr (Christophe Genolini)
Date: Sun, 30 Mar 2008 15:49:23 +0200
Subject: [Rd] package.skeleton.S4
Message-ID: <47EF9A63.3070609@u-paris10.fr>

Hi the devel list.

I am adapting the package.skeleton to S4 classes and methods
I would have been very proud to post a new working function on this list.
Unfortunately, I do not manage to solve all the problems. Mainly

 - sys.source does not compile a file with setClass
 - dumpMethod does not exists yet

In the following code, thise two problems are notified by a line 
#################

Still with this two issues, it is possible to use package.skeleton.S4 in 
the following way:
 - first run package.skeleton (in the classical way, on a file or in the 
console).
    This creates the directories and the files
 - then run package.skeleton.S4.
     It has to be done
      * using the code_files option (since dumpMethod does not exists)
      * providing the list of the class (since sys.source does not 
compile setClass)
      * using the same path than package.skeleton

At this three conditions, package.skeleton.S4 will :
 - modify the DESCRIPTION package,
 - run promptClass on the classes gived in the list,
 - run promptMethod on all the methods related to the classes gives in 
the list.

I tryed to solve the sys.source problem, but I am not good enough in R 
to do it myself.
I do not even know if it is something hard to do or very easy. So I post 
this uncompleted function...
If someone is interested in fixing it and then adding it somewhere,
I then will write the package.skeleton.S4.Rd

sincerly

Christophe


--- 8< ----------------- package.skeleton.S4 ---------------------------

package.skeleton.S4 <- function(name = "anRpackage", list, environment = 
.GlobalEnv,
    path = ".", force = FALSE, namespace = FALSE, code_files = 
character(),S4=FALSE)
{
    cat(missing(list)," EEE\n")
    ### If pakage.skeleton has not been run, run it on false data
    dir <- file.path(path, name)
    code_dir <- file.path(dir, "R")
    docs_dir <- file.path(dir, "man")
    data_dir <- file.path(dir, "data")
    if (!file.exists(dir)){
        environment <- new.env()
        assign("falseData-ToErase",NULL,environment)
        
package.skeleton(name=name,environment=environment,path=path,namespace=namespace)
    }else{}

    ### Build up the list_S4
    ###   If list_S4 is empty :
    ###      If code_files_S4 is not empty, the file in code_file_S4 are 
source.
    ###      then list receive ls() after removing ".__C__" (either if 
code_files is empty or not)
    if (!is.character(code_files)){stop("'code_files S4' should be a 
character vector")}else{}
    use_code_files <- length(code_files) > 0

    if (missing(list)){
################################################################################
# Has to be false
# since sys.source does not work :-(
        if (use_code_files){
            environment <- new.env()
            for (cf in code_files){sys.source(cf, envir = environment)}
        }else{}
        list <- ls(pattern=".__C__",all.names=TRUE)
        list <- substr(list,7,nchar(list))
    }else{}

    ### Check that the parameters are of correct type
    if (!is.character(list)){stop("'list' should be a character vector 
naming R objects")}else{}
    if (!is.logical(namespace) || (length(namespace) != 
1)){stop("'namespace' should be a single logical")}else{}
    curLocale <- Sys.getlocale("LC_CTYPE")
    on.exit(Sys.setlocale("LC_CTYPE", curLocale), add = TRUE)
    if (Sys.setlocale("LC_CTYPE", "C") != "C"){warning("cannot turn off 
locale-specific chars via LC_CTYPE")}else{}

    ### Remove non existing object from the list
    have <- sapply(list, isClass, where = environment)
    if (any(!have))
        warning(sprintf(ngettext(sum(!have), "class '%s' not found",
            "class '%s' not found"), paste(sQuote(list[!have]),
            collapse = ", ")), domain = NA)
    list <- list[have]
    if (!length(list))
        stop("no R classes specified or available")
    
    ### Addition to DESCRIPTION
    message("Adding to DESCRIPTION ...")
    description <- file(file.path(dir, "DESCRIPTION"), "a+b")
    cat("\nDepends: methods\nLazyLoad: yes\nCollate: gives the order in 
which file shall be sourced\n",append=TRUE,file = description,sep = "")
    close(description)

    ### Remove elements starting with "." from the list
    internalObjInds <- grep("^\\.", list)
    internalObjs <- list[internalObjInds]
    if (any(internalObjInds)){list <- list[-internalObjInds]}else{}

    ### Remplace strange char by "_" and check the name validity (but 
only if code_file is user define)
    if (!use_code_files){
        list0 <- gsub("[[:cntrl:]\"*/:<>?\\|]", "_", list)
        wrong <- 
grep("^(con|prn|aux|clock\\$|nul|lpt[1-3]|com[1-4])(\\..*|)$",list0)
        if (length(wrong)){list0[wrong] <- paste("zz", list0[wrong], sep 
= "")}else{}
        ok <- grep("^[[:alnum:]]", list0)
        if (length(ok) < length(list0)){list0[-ok] <- paste("z", 
list0[-ok], sep = "")}else{}
        list1 <- tolower(list0)
        list2 <- make.unique(list1, sep = "_")
        changed <- (list2 != list1)
        list0[changed] <- list2[changed]
    }else{
        list0 <- list
    }
    names(list0) <- list

    ### If code_file is empty, it save all invisible in pack-internal.R 
and all the function one by one in its file
    ### If code_file is not empty, is save the code_file
    if (!use_code_files){
        message("Saving functions and data ...")
        warning("*** Does not work: dumpClass and dumpMethod are not 
implemented yet ***")
        warning("*** Use code_file instead ***")
###########################################################################
#        if (any(internalObjInds)){dump(internalObjs, file = 
file.path(code_dir, sprintf("%s-internal.R",name)))}else{}
#        for (item in list) {
#        if (is.function(get(item, envir = environment))){
#            dump(item, file = file.path(code_dir, 
sprintf("%s.R",list0[item])))
#        }else{
#            try(save(list = item, file = 
file.path(data_dir,sprintf("%s.rda", item))))
#        }
    }else{
        message("Copying code files ...")
        file.copy(code_files, code_dir)
    }

    ### Help file
    ### For all the internal, a single help file saying "not for user"
    message("Making help files ...")
    if (any(internalObjInds)) {
        Rdfile <- file(file.path(docs_dir, 
sprintf("%s-internal-S4.Rd",name)), "wt")
        cat("\\name{", name, "-internal}\n", "\\title{Internal ",name, " 
objects}\n", file = Rdfile, sep = "")
        for (item in internalObjs) {cat("\\alias{", item, "}\n", file = 
Rdfile, sep = "")}

        cat("\\description{Internal ", name, " classes.}\n",
            "\\details{These are not to be called by the user.}\n",
            "\\keyword{internal}", file = Rdfile, sep = "")
        close(Rdfile)
    }
    yy <- try(suppressMessages({
        sapply(list,function(item){
            promptClass(item,filename = file.path(docs_dir, 
sprintf("%s.Rd",list0[item])))
        })
        
        listMethod <- unclass(getGenerics())
        sapply(listMethod,function(metho){
            if(any(sapply(list,function(lis){existsMethod(metho,lis)}))){
                promptMethods(metho,filename = file.path(docs_dir, 
sprintf("%s.Rd",metho)))
            }else{}
            return(invisible())
        })
        
        
    }))
    
    if (inherits(yy, "try-error")){stop(yy)}else{}
    if (length(list.files(code_dir)) == 0){unlink(code_dir, recursive = 
TRUE)}else{}
    if (length(list.files(data_dir)) == 0){unlink(data_dir, recursive = 
TRUE)}else{}
    message("Done.")
    message(gettextf("Further steps are described in 
'%s'.",file.path(dir, "Read-and-delete-me")), domain = NA)
}

    
# Example
# Save in myPack.r    
---- 8< ---------------File myPack.r -----------------
    
`f1` <- function(x){cat("\nXXX F1 = ",x,"XXX\n")}
`.f2` <- function(x){cat("\nXXX F2 = ",f1(x^2),"XXX\n")}


# Save in myPackS4.r    
---- 8< ---------------File myPackS4.r ---------------

setClass("AA",representation(a="numeric"))
setGeneric("aze",function(z){standardGeneric("aze")})
setMethod("print","AA",function(x){cat("C'est cool")})
setMethod("aze","AA",function(z){cat("C'est hyper cool")})



setClass("BB",representation(b="numeric"),validity=function(object){object at b>0})
setMethod("plot","BB",function(x,y){cat("CCC'est cool")})
setMethod("aze","BB",function(z){cat("CCC'est hyper cool")})

---- 8< -----------------------------------------------


# Example of use :

package.skeleton("pack",code_files="pack.r")
package.skeleton.S4("pack",list=c("AA","BB"),code_files="packS4.r")


From cgenolin at u-paris10.fr  Mon Mar 31 00:31:55 2008
From: cgenolin at u-paris10.fr (Christophe Genolini)
Date: Mon, 31 Mar 2008 00:31:55 +0200
Subject: [Rd] tests Rin and Rout
Message-ID: <47F014DB.6040000@u-paris10.fr>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20080331/9d931c30/attachment.pl 

From ripley at stats.ox.ac.uk  Mon Mar 31 08:49:50 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 31 Mar 2008 07:49:50 +0100 (BST)
Subject: [Rd] tests Rin and Rout
In-Reply-To: <47F014DB.6040000@u-paris10.fr>
References: <47F014DB.6040000@u-paris10.fr>
Message-ID: <alpine.LFD.1.00.0803310747400.7538@gannet.stats.ox.ac.uk>

Recommended packages cluster codetools foreign lattice nlme and rpart
have tests, for example.  (As do standard packages grDevices, grid and 
stats.)

On Mon, 31 Mar 2008, Christophe Genolini wrote:

>
>>
>> Generally I find it's good to look at examples that work.  For
>> examples of packages using tests, look at source packages on CRAN.
>> Run the tests on them (using R CMD check), and see what gets produced.
>>
> Do you have the name of a package that use it ? I try the 10 first
> package, and 10 other at random, but none of them use tests...
>>>> Create tests/myPack.R with those lines in it plus lines to actually
>>>> run the code.
>>> Does it mean that each time I change the code, I will have to change
>>> it twice, once in R/ and once in tests/
>>
>> There shouldn't be any duplication.  Just put tests in the tests
>> directory.  That code will be run with your package loaded when you
>> run R CMD check.  If it fails, your package will fail the check.
> Sorry, this is very unclear to me. What do you call "tests" that I have
> to put in the tests directory ?
> Let's take an example : My package is a single function that take the
> square of only positive number. I make a mistake and I forget that it
> has to reject negative number :
>
> sq <- function(x){return(x2)}
>
> Fortunately, I am very conscientious (!) and I did prepare some test :
> - sq(2) should be 4
> - sq(Inf) should be Inf
> - sq(-2) should be NA (on this example, this last test will fail)
>
> At his point :
> sq <- function(x){return(x2)} is in R/main.r
>
> 1) What shall I put in the test file ?
> 2) Cann't I build a Rout file containning the expected results 4 ; Inf;
> NA ?
>
> Thanks for helping
>
> Christophe
>>>   If the code generates errors, your test will fail.  If you want to
>>> see reports of changes to the output, also include
>>> tests/myPack.Rout.save with the known correct versions of the output.
>>>
>> What should the Rout.save looks like ? I mean, what is the syntax of
>> this file ?
>
> It should just be a copy of the Rout file produced from a previous
> trusted run.  R CMD check will ignore certain differences (like changes
> to the date or R version at the top of the file), but will report on
> others.
>
> Duncan Murdoch
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Mon Mar 31 09:00:19 2008
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Mon, 31 Mar 2008 09:00:19 +0200 (CEST)
Subject: [Rd] S4: dumpMethod (PR#11053)
Message-ID: <20080331070020.088E1282EFF8@mail.pubhealth.ku.dk>

This was already addressed in the current version of R (2.7.0 alpha).
You probably also want to look at how package.skeleton() handles S4 
objects in that version of R.

Please read up on what the FAQ asks you to do before submitting a bug, and 
in particular it says

   Third, if possible try the current r-patched or r-devel version of R.
   If a bug has already been reported or fixed, please do not submit
   further bug reports on it.


On Sat, 29 Mar 2008, cgenolin at u-paris10.fr wrote:

> Full_Name: Christophe Genolini
> Version: 2.6.2
> OS: Windows XP
> Submission from: (NULL) (82.225.59.146)
>
>
> *This is a mail that I post on r-help: *

Not recently.

>>> It seems that the dumpMethod does not work.
>
> setClass("A",representation(a="numeric"))
> setMethod("plot","A",function(x,y,...){cat("AAAAA\n")})
> dumpMethod("plot","A",file="")
> #setMethod("plot", "A",
> #NULL
> #)
> #[1] ""
>
>> Answer from Martin Maechler
>
>> dumpMethod() has not been updated when the internal method
>> definition (and storage) code has been changed.
>> Consequently, it looks pretty broken to me, as well.
>>
>> OTOH, I have never seen any need to use it,
>> since I only work with *.R files which I write and comment and ..
>> and never would want to replace with anything dumped...
>>
>> Do you want to submit a (legitimate (!)) bug report to R-bugs ?
>
> Well, I did not submit a bug concerning a (may be) useless method...
> But today, I find it usefull: "package.skeleton" use dump.
> So a "package.skeleton.S4" might need dumpMethod...
>
> Christophe
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Mon Mar 31 10:10:10 2008
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Mon, 31 Mar 2008 10:10:10 +0200 (CEST)
Subject: [Rd] (PR#11054) "Writing R Extensions": bad example with CAR /
Message-ID: <20080331081010.201FB282EFF8@mail.pubhealth.ku.dk>

But it is not taken 'verbatim from src/main/print.c' (at least not in that 
version of R), and the code is not run with USE_RINTERNALS defined when 
write-barrier checking is enabled.

The example has been updated to match the current code in 2.7.0 alpha.


On Sun, 30 Mar 2008, sanders at fs.tum.de wrote:

> Full_Name: Simon Anders
> Version: 2.6.2
> OS: Ubuntu Linux
> Submission from: (NULL) (86.22.75.91)
>
>
> This is a rather minor "documentation bug", certainly not at all urgent.
>
> The manual "Writing R extensions" explains in section 5.10 ("Evaluating R
> expressions from C") how to use the eval function. Without going into much
> details, an example is given how to build up a LANGSXP pairlist to represent an
> expression.
>
> This example is taken at verbatim from src/main/print.c, and uses CAR and CDR as
> l-values, e.g.
>   CAR(t) = install("print")
>
> This has just confused me quite a bit, as my own code, which I wrote following
> this example, did not compile, complaining about 'CAR(t)' being illegal as
> l-value.
>
> After a while I figured out the reason, which is (as you probably have spotted
> immediatly) that the example is taken from a code snipped that imports
> Rinternals.h with defined USE_RINTERNALS, while I followed the manual's advice
> to not define USE_RINTERNALS for extensions.
>
> Maybe you could add a note in this section of the manual that one should use
> SETCAR and SETCDR instead. A more illustrative example would be even better.
>
>
> Just in case you want to use it as example, here is my code. I hope it is
> correct in your expert eyes.
>
>   /* Remove the variable with name s from the environment ev,
>      i.e. construct the call: rm( list=s, envir=ev ) */
>
>   SEXP call;
>   PROTECT( call = Rf_allocList( 3 ) );
>   SET_TYPEOF( call, LANGSXP );
>
>   SETCAR( call, install( "rm" ) );
>
>   SETCAR( CDR(call), allocVector( STRSXP, 1 ) );
>   SET_STRING_ELT( CAR( CDR(call) ), 0, mkChar( s ) );
>   SET_TAG( CDR(call), install("list") );
>
>   SETCAR( CDDR(call), ev );
>   SET_TAG( CDDR(call), install("envir") );
>
>   eval( call, R_GlobalEnv );
>   UNPROTECT( 1 );
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From maechler at stat.math.ethz.ch  Mon Mar 31 10:16:59 2008
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Mon, 31 Mar 2008 10:16:59 +0200
Subject: [Rd] tests Rin and Rout
In-Reply-To: <47F014DB.6040000@u-paris10.fr>
References: <47F014DB.6040000@u-paris10.fr>
Message-ID: <18416.40443.244387.473214@stat.math.ethz.ch>

>>>>> "CG" == Christophe Genolini <cgenolin at u-paris10.fr>
>>>>>     on Mon, 31 Mar 2008 00:31:55 +0200 writes:

    >> 
    >> Generally I find it's good to look at examples that work.
    >> For examples of packages using tests, look at source
    >> packages on CRAN.  Run the tests on them (using R CMD
    >> check), and see what gets produced.
    >> 
    CG> Do you have the name of a package that use it ? I try
    CG> the 10 first package, and 10 other at random, but none
    CG> of them use tests...

hmm, I see 219 out 1378 CRAN packages having a 'tests'
subdirectory, so it seems you have been a bit unlucky. ;-)

Also note that 'R CMD check' runs all the examples in the help
files and hence does some testing already without extra tests in ./tests/

Isn't all this is explained nicely in the "Writing R Extensions"
Manual?  Or are there sections we should expand ?
For answering your subsequent questions, you should probably
both look at an example package *and* read the 'Writing R
Extensions' manual a bit more "closely".

BTW: There's an extension to simple regression tests in the
     ./tests/ directory, namely using the 'RUnit' package for
     unit tests **IN CONJUNCTION** with ./tests/ :

  The R Wiki has had a note on that for many months,
     http://wiki.r-project.org/rwiki/doku.php?id=developers:runit

and we have recently nicely implemented a version of this
approach in most Rmetrics R packages, e.g.  'fCalendar' as one
example.  It builds on a simple tests/doRunit.R file and then on
content in inst/unitTests/

Martin Maechler, ETH Zurich


From r.hankin at noc.soton.ac.uk  Mon Mar 31 10:37:28 2008
From: r.hankin at noc.soton.ac.uk (Robin Hankin)
Date: Mon, 31 Mar 2008 09:37:28 +0100
Subject: [Rd] tests Rin and Rout
In-Reply-To: <18416.40443.244387.473214@stat.math.ethz.ch>
References: <47F014DB.6040000@u-paris10.fr>
	<18416.40443.244387.473214@stat.math.ethz.ch>
Message-ID: <F6B20CA9-4E06-4759-99A8-6F572B3CBCFC@noc.soton.ac.uk>


On 31 Mar 2008, at 09:16, Martin Maechler wrote:

>>>>>> "CG" == Christophe Genolini <cgenolin at u-paris10.fr>
>>>>>>    on Mon, 31 Mar 2008 00:31:55 +0200 writes:
>
>>>
>>> Generally I find it's good to look at examples that work.
>>> For examples of packages using tests, look at source
>>> packages on CRAN.  Run the tests on them (using R CMD
>>> check), and see what gets produced.
>>>
>    CG> Do you have the name of a package that use it ? I try
>    CG> the 10 first package, and 10 other at random, but none
>    CG> of them use tests...
>
> hmm, I see 219 out 1378 CRAN packages having a 'tests'
> subdirectory, so it seems you have been a bit unlucky. ;-)



How unlucky exactly?


 > fisher.test(matrix(c(0,20,219,1159),2,2))

	Fisher's Exact Test for Count Data

data:  matrix(c(0, 20, 219, 1159), 2, 2)
p-value = 0.05867
alternative hypothesis: true odds ratio is not equal to 1
95 percent confidence interval:
  0.000000 1.082225
sample estimates:
odds ratio
          0

 >


*just* shy of the magic 5% . . .







--
Robin Hankin
Uncertainty Analyst and Neutral Theorist,
National Oceanography Centre, Southampton
European Way, Southampton SO14 3ZH, UK
  tel  023-8059-7743


From maechler at stat.math.ethz.ch  Mon Mar 31 11:32:33 2008
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Mon, 31 Mar 2008 11:32:33 +0200
Subject: [Rd] tests Rin and Rout
In-Reply-To: <20080331105833.hg2cj67g6c84c8k0@icare.u-paris10.fr>
References: <47F014DB.6040000@u-paris10.fr>
	<18416.40443.244387.473214@stat.math.ethz.ch>
	<20080331105833.hg2cj67g6c84c8k0@icare.u-paris10.fr>
Message-ID: <18416.44977.144597.422309@stat.math.ethz.ch>

>>>>> "ChrG" == cgenolin  <cgenolin at u-paris10.fr>
>>>>>     on Mon, 31 Mar 2008 10:58:33 +0200 writes:

    ChrG> Martin Maechler <maechler at stat.math.ethz.ch> a ??crit?
    ChrG> :
    >>>>>>> "CG" == Christophe Genolini <cgenolin at u-paris10.fr>
    >>>>>>> on Mon, 31 Mar 2008 00:31:55 +0200 writes:
    >> 
    >> >>
    >> >> Generally I find it's good to look at examples that
    >> work.  >> For examples of packages using tests, look at
    >> source >> packages on CRAN.  Run the tests on them (using
    >> R CMD >> check), and see what gets produced.
    >> >>
    CG> Do you have the name of a package that use it ? I try
    CG> the 10 first package, and 10 other at random, but none
    CG> of them use tests...
    >> 
    >> hmm, I see 219 out 1378 CRAN packages having a 'tests'
    >> subdirectory, so it seems you have been a bit
    >> unlucky. ;-)

    ChrG> Do you imply that I say I try and I did not ?  

not at all!  I am sorry if you (or anyone) got this impression!

    ChrG> Well, lets check that :

    ChrG> P_unluck_1 <- 1-(219/1379) 
    ChrG> (P_unluck_10 <- P_unluck_1^10) [1] 0.1773933

    ChrG> So P>0.05, once can not say that I am not a liar.
    ChrG> Further investigation are needed :-)

:-)

    >> Isn't all this is explained nicely in the "Writing R
    >> Extensions" Manual?

    ChrG> NO ! There is 8 lines on it, and the structure of the
    ChrG> Rin and Rout is not given. The writing R Ext. say "the
    ChrG> Test code can be in .R or in .Rin" but I do not know
    ChrG> what "test code" is suppose to be. I try simple things
    ChrG> like some function with argument, but it does not
    ChrG> works. I try more complicated things, I did not manage
    ChrG> to find the right things to do.

Ok; so we should expand the part in the manual.

First:  '.Rin' are typically only used very rarely; so, normally
the input file is 'foo.R' and hence (well ``hence'') must be
valid R code, typically starting by 
library(<mypackage>).

    ChrG> It also say ".Rin file containing code which in turn
    ChrG> in .R", but there is also no information about the
    ChrG> what the .Rin should be. May be it is obvious for some
    ChrG> people, but not for me.

    >> Or are there sections we should expand ?

    ChrG> I do not know, if there is only few people using it,
    ChrG> may be it is not worth. I guess you have so many other
    ChrG> thinks to do...  On the other hand, if some tool are
    ChrG> to difficult to understand, it is normal that people
    ChrG> do not use them... I don't know.

    ChrG> I will work on package example that Pr Ripley point to
    ChrG> me. Then when I will have understand the way it works,
    ChrG> would you like me to add little paragraph in "Writing
    ChrG> R extention" ? I mean, not an paragraph by expert but
    ChrG> a paragraph by a regular medium level user for some
    ChrG> other regular medium level user.

That maybe very useful, thank you for the offer!
Note that the manual source is in
  https://svn.r-project.org/R/trunk/doc/manual/R-exts.texi

    >> For answering your subsequent questions, you should
    >> probably both look at an example package *and* read the
    >> 'Writing R Extensions' manual a bit more "closely".

    ChrG> Well, I try to not disturb people for little obvious
    ChrG> thinks. I can tell you I did work hard before asking,
    ChrG> specialy before asking on r-devel...

Okay, I apologize for having misjudged your efforts.

Martin


From lobry at biomserv.univ-lyon1.fr  Mon Mar 31 18:18:20 2008
From: lobry at biomserv.univ-lyon1.fr (Jean lobry)
Date: Mon, 31 Mar 2008 18:18:20 +0200
Subject: [Rd] data(lh) time serie parameters
In-Reply-To: <971536df0803300436r6615feb2hc445b9e143edba14@mail.gmail.com>
References: <mailman.25.1206702006.15065.r-devel@r-project.org>	
	<p06002005c4150f9d2903@192.168.1.10>
	<971536df0803300436r6615feb2hc445b9e143edba14@mail.gmail.com>
Message-ID: <p06002003c416b509ee4c@[134.214.236.111]>

>
>It seems they are using 10 minutes as the unit of measurement.
>If you wish to change it to hours you might want to use this instead:
>
>    lh.hr <- ts(lh, start = 0, frequency = 6)
>
>so that
>
>    cycle(lh.hr)
>
>starts out at 1.

Dear Gabor,

yes, it is very likely that the original dataset was with a 10 minutes
unit of measurement because plot(lh[1:44]) yields the same curve as
figure 1b in:

@article{DigglePJ1991,
     title = {Nonparametric comparison of cumulative periodograms},
     author = {Diggle, P.J. and Fisher, N.I.},
     journal = {Applied Statistics},
     volume = {40},
     pages = {423-434},
     year = {1991}
}

whose legend reads:

QUOTE
Fig. 1. Four time series of LH concentrations in blood samples: each
series consists of $n = 44$ values derived from blood samples taken at
10-min intervals from a healthy adult female (data collected by Dr A.
Murdoch): a) early follicular phase, first cycle; (b) early follicular
phase, second cycle; (c) late follicular phase, first cycle; (d) late
follicular phase, second cycle
UNQUOTE

The complete multiple time series with 48 values as in data(lh) was
deposited in statlib by P.J. Diggle himself:
http://lib.stat.cmu.edu/datasets/diggle
(note that the first one has 4 trailling 0 that look like NA which
may explain why there were only 44 values in the 1991 paper).

What I found confusing is that

plot(lh)

ends at 48 when the doc says that lh is a "regular time series".
That would be OK for me if lh was a simple vector, but lh is a
time series so I would expect it to have different tsp() parameters
to fit the doc.

Best,

Jean
-- 
Jean R. Lobry            (lobry at biomserv.univ-lyon1.fr)
Laboratoire BBE-CNRS-UMR-5558, Univ. C. Bernard - LYON I,
43 Bd 11/11/1918, F-69622 VILLEURBANNE CEDEX, FRANCE
allo  : +33 472 43 27 56     fax    : +33 472 43 13 88
http://pbil.univ-lyon1.fr/members/lobry/


From jmc at r-project.org  Mon Mar 31 19:04:12 2008
From: jmc at r-project.org (John Chambers)
Date: Mon, 31 Mar 2008 10:04:12 -0700
Subject: [Rd] package.skeleton.S4
In-Reply-To: <47EF9A63.3070609@u-paris10.fr>
References: <47EF9A63.3070609@u-paris10.fr>
Message-ID: <47F1198C.7070407@r-project.org>

Christophe,

Thanks for your work; unfortunately,  at the same time you were 
developing your version, the original function was being extended in the 
same direction.

The version of package.skeleton() to be included in the 2.7.0 release of 
R will deal with S4 classes and methods.

When you have a chance, it would be helpful if you would try out this 
version, and let us know whether it deals with your examples.

Version 2.7 of R is currently in alpha testing, meaning that you would 
have to compile R from source, so you might prefer to wait.  See the 
pointer from the main R web page.  The projected release date for 2.7.0 
is April 22.

John

Christophe Genolini wrote:
> Hi the devel list.
>
> I am adapting the package.skeleton to S4 classes and methods
> I would have been very proud to post a new working function on this list.
> Unfortunately, I do not manage to solve all the problems. Mainly
>
>  - sys.source does not compile a file with setClass
>  - dumpMethod does not exists yet
>
> In the following code, thise two problems are notified by a line 
> #################
>
> Still with this two issues, it is possible to use package.skeleton.S4 in 
> the following way:
>  - first run package.skeleton (in the classical way, on a file or in the 
> console).
>     This creates the directories and the files
>  - then run package.skeleton.S4.
>      It has to be done
>       * using the code_files option (since dumpMethod does not exists)
>       * providing the list of the class (since sys.source does not 
> compile setClass)
>       * using the same path than package.skeleton
>
> At this three conditions, package.skeleton.S4 will :
>  - modify the DESCRIPTION package,
>  - run promptClass on the classes gived in the list,
>  - run promptMethod on all the methods related to the classes gives in 
> the list.
>
> I tryed to solve the sys.source problem, but I am not good enough in R 
> to do it myself.
> I do not even know if it is something hard to do or very easy. So I post 
> this uncompleted function...
> If someone is interested in fixing it and then adding it somewhere,
> I then will write the package.skeleton.S4.Rd
>
> sincerly
>
> Christophe
>
>
> --- 8< ----------------- package.skeleton.S4 ---------------------------
>
> package.skeleton.S4 <- function(name = "anRpackage", list, environment = 
> .GlobalEnv,
>     path = ".", force = FALSE, namespace = FALSE, code_files = 
> character(),S4=FALSE)
> {
>     cat(missing(list)," EEE\n")
>     ### If pakage.skeleton has not been run, run it on false data
>     dir <- file.path(path, name)
>     code_dir <- file.path(dir, "R")
>     docs_dir <- file.path(dir, "man")
>     data_dir <- file.path(dir, "data")
>     if (!file.exists(dir)){
>         environment <- new.env()
>         assign("falseData-ToErase",NULL,environment)
>         
> package.skeleton(name=name,environment=environment,path=path,namespace=namespace)
>     }else{}
>
>     ### Build up the list_S4
>     ###   If list_S4 is empty :
>     ###      If code_files_S4 is not empty, the file in code_file_S4 are 
> source.
>     ###      then list receive ls() after removing ".__C__" (either if 
> code_files is empty or not)
>     if (!is.character(code_files)){stop("'code_files S4' should be a 
> character vector")}else{}
>     use_code_files <- length(code_files) > 0
>
>     if (missing(list)){
> ################################################################################
> # Has to be false
> # since sys.source does not work :-(
>         if (use_code_files){
>             environment <- new.env()
>             for (cf in code_files){sys.source(cf, envir = environment)}
>         }else{}
>         list <- ls(pattern=".__C__",all.names=TRUE)
>         list <- substr(list,7,nchar(list))
>     }else{}
>
>     ### Check that the parameters are of correct type
>     if (!is.character(list)){stop("'list' should be a character vector 
> naming R objects")}else{}
>     if (!is.logical(namespace) || (length(namespace) != 
> 1)){stop("'namespace' should be a single logical")}else{}
>     curLocale <- Sys.getlocale("LC_CTYPE")
>     on.exit(Sys.setlocale("LC_CTYPE", curLocale), add = TRUE)
>     if (Sys.setlocale("LC_CTYPE", "C") != "C"){warning("cannot turn off 
> locale-specific chars via LC_CTYPE")}else{}
>
>     ### Remove non existing object from the list
>     have <- sapply(list, isClass, where = environment)
>     if (any(!have))
>         warning(sprintf(ngettext(sum(!have), "class '%s' not found",
>             "class '%s' not found"), paste(sQuote(list[!have]),
>             collapse = ", ")), domain = NA)
>     list <- list[have]
>     if (!length(list))
>         stop("no R classes specified or available")
>     
>     ### Addition to DESCRIPTION
>     message("Adding to DESCRIPTION ...")
>     description <- file(file.path(dir, "DESCRIPTION"), "a+b")
>     cat("\nDepends: methods\nLazyLoad: yes\nCollate: gives the order in 
> which file shall be sourced\n",append=TRUE,file = description,sep = "")
>     close(description)
>
>     ### Remove elements starting with "." from the list
>     internalObjInds <- grep("^\\.", list)
>     internalObjs <- list[internalObjInds]
>     if (any(internalObjInds)){list <- list[-internalObjInds]}else{}
>
>     ### Remplace strange char by "_" and check the name validity (but 
> only if code_file is user define)
>     if (!use_code_files){
>         list0 <- gsub("[[:cntrl:]\"*/:<>?\\|]", "_", list)
>         wrong <- 
> grep("^(con|prn|aux|clock\\$|nul|lpt[1-3]|com[1-4])(\\..*|)$",list0)
>         if (length(wrong)){list0[wrong] <- paste("zz", list0[wrong], sep 
> = "")}else{}
>         ok <- grep("^[[:alnum:]]", list0)
>         if (length(ok) < length(list0)){list0[-ok] <- paste("z", 
> list0[-ok], sep = "")}else{}
>         list1 <- tolower(list0)
>         list2 <- make.unique(list1, sep = "_")
>         changed <- (list2 != list1)
>         list0[changed] <- list2[changed]
>     }else{
>         list0 <- list
>     }
>     names(list0) <- list
>
>     ### If code_file is empty, it save all invisible in pack-internal.R 
> and all the function one by one in its file
>     ### If code_file is not empty, is save the code_file
>     if (!use_code_files){
>         message("Saving functions and data ...")
>         warning("*** Does not work: dumpClass and dumpMethod are not 
> implemented yet ***")
>         warning("*** Use code_file instead ***")
> ###########################################################################
> #        if (any(internalObjInds)){dump(internalObjs, file = 
> file.path(code_dir, sprintf("%s-internal.R",name)))}else{}
> #        for (item in list) {
> #        if (is.function(get(item, envir = environment))){
> #            dump(item, file = file.path(code_dir, 
> sprintf("%s.R",list0[item])))
> #        }else{
> #            try(save(list = item, file = 
> file.path(data_dir,sprintf("%s.rda", item))))
> #        }
>     }else{
>         message("Copying code files ...")
>         file.copy(code_files, code_dir)
>     }
>
>     ### Help file
>     ### For all the internal, a single help file saying "not for user"
>     message("Making help files ...")
>     if (any(internalObjInds)) {
>         Rdfile <- file(file.path(docs_dir, 
> sprintf("%s-internal-S4.Rd",name)), "wt")
>         cat("\\name{", name, "-internal}\n", "\\title{Internal ",name, " 
> objects}\n", file = Rdfile, sep = "")
>         for (item in internalObjs) {cat("\\alias{", item, "}\n", file = 
> Rdfile, sep = "")}
>
>         cat("\\description{Internal ", name, " classes.}\n",
>             "\\details{These are not to be called by the user.}\n",
>             "\\keyword{internal}", file = Rdfile, sep = "")
>         close(Rdfile)
>     }
>     yy <- try(suppressMessages({
>         sapply(list,function(item){
>             promptClass(item,filename = file.path(docs_dir, 
> sprintf("%s.Rd",list0[item])))
>         })
>         
>         listMethod <- unclass(getGenerics())
>         sapply(listMethod,function(metho){
>             if(any(sapply(list,function(lis){existsMethod(metho,lis)}))){
>                 promptMethods(metho,filename = file.path(docs_dir, 
> sprintf("%s.Rd",metho)))
>             }else{}
>             return(invisible())
>         })
>         
>         
>     }))
>     
>     if (inherits(yy, "try-error")){stop(yy)}else{}
>     if (length(list.files(code_dir)) == 0){unlink(code_dir, recursive = 
> TRUE)}else{}
>     if (length(list.files(data_dir)) == 0){unlink(data_dir, recursive = 
> TRUE)}else{}
>     message("Done.")
>     message(gettextf("Further steps are described in 
> '%s'.",file.path(dir, "Read-and-delete-me")), domain = NA)
> }
>
>     
> # Example
> # Save in myPack.r    
> ---- 8< ---------------File myPack.r -----------------
>     
> `f1` <- function(x){cat("\nXXX F1 = ",x,"XXX\n")}
> `.f2` <- function(x){cat("\nXXX F2 = ",f1(x^2),"XXX\n")}
>
>
> # Save in myPackS4.r    
> ---- 8< ---------------File myPackS4.r ---------------
>
> setClass("AA",representation(a="numeric"))
> setGeneric("aze",function(z){standardGeneric("aze")})
> setMethod("print","AA",function(x){cat("C'est cool")})
> setMethod("aze","AA",function(z){cat("C'est hyper cool")})
>
>
>
> setClass("BB",representation(b="numeric"),validity=function(object){object at b>0})
> setMethod("plot","BB",function(x,y){cat("CCC'est cool")})
> setMethod("aze","BB",function(z){cat("CCC'est hyper cool")})
>
> ---- 8< -----------------------------------------------
>
>
> # Example of use :
>
> package.skeleton("pack",code_files="pack.r")
> package.skeleton.S4("pack",list=c("AA","BB"),code_files="packS4.r")
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From ripley at stats.ox.ac.uk  Mon Mar 31 20:40:18 2008
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Mon, 31 Mar 2008 20:40:18 +0200 (CEST)
Subject: [Rd] (PR#11054) "Writing R Extensions": bad example with CAR /
Message-ID: <20080331184018.DF7C2282EFF7@mail.pubhealth.ku.dk>

On Mon, 31 Mar 2008, Simon Anders wrote:

> Dear Prof Ripley,
>
> Prof Brian Ripley wrote:

>> But it is not taken 'verbatim from src/main/print.c' (at least not in that 
>> version of R), and the code is not run with USE_RINTERNALS defined when 
>> write-barrier checking is enabled.
>> 
>> The example has been updated to match the current code in 2.7.0 alpha.
>
> I just assumed that it is copied verbatim without checking because it says so 
> in the sentence above the code ("As a more comprehensive example of 
> constructing an R call in C code and evaluating, consider the following 
> fragment of printAttributes in src/main/print.c.")

That was true once, long ago.

> I don't understand, however, what you mean by stating that USE_RINTERNALS is 
> not needed (and I have to admit that I have no knowledge of this 
> 'write-barrier checking' mechanism.)

I didn't say 'USE_RINTERNALS is not needed' for your code: I said it was 
not used for the code that was run.

...

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From pgilbert at bank-banque-canada.ca  Mon Mar 31 21:09:51 2008
From: pgilbert at bank-banque-canada.ca (Paul Gilbert)
Date: Mon, 31 Mar 2008 15:09:51 -0400
Subject: [Rd] tests Rin and Rout
In-Reply-To: <18416.44977.144597.422309@stat.math.ethz.ch>
References: <47F014DB.6040000@u-paris10.fr>	<18416.40443.244387.473214@stat.math.ethz.ch>	<20080331105833.hg2cj67g6c84c8k0@icare.u-paris10.fr>
	<18416.44977.144597.422309@stat.math.ethz.ch>
Message-ID: <47F136FF.9060407@bank-banque-canada.ca>

Martin Maechler wrote:
>>>>>> "ChrG" == cgenolin  <cgenolin at u-paris10.fr>
>>>>>>     on Mon, 31 Mar 2008 10:58:33 +0200 writes:
>>>>>>             
>
>     ChrG> Martin Maechler <maechler at stat.math.ethz.ch> a ??crit?
>     ChrG> :
>     >>>>>>> "CG" == Christophe Genolini <cgenolin at u-paris10.fr>
>     >>>>>>> on Mon, 31 Mar 2008 00:31:55 +0200 writes:
>     >> 
>     >> >>
>     >> >> Generally I find it's good to look at examples that
>     >> work.  >> For examples of packages using tests, look at
>     >> source >> packages on CRAN.  Run the tests on them (using
>     >> R CMD >> check), and see what gets produced.
>     >> >>
>     CG> Do you have the name of a package that use it ? I try
>     CG> the 10 first package, and 10 other at random, but none
>     CG> of them use tests...
>     >> 
>     >> hmm, I see 219 out 1378 CRAN packages having a 'tests'
>     >> subdirectory, so it seems you have been a bit
>     >> unlucky. ;-)
>   
Hmmm. Well, since I have several of the 219, and I suspect a handful of 
other developers also individually have several,  it looks a bit like 
most developers are not using them. Perhaps there needs to be more 
encouragement.

More specifically on the question:
- You might look at the package numDeriv, which is fairly small and does 
testing in the way I have more recently found to be most convenient. In 
some of my older packages my mechanism was a bit awkward until the 
package settled down.

-I now find it is generally simpler to have several small test files 
rather than one big one.

-If there is a logical order for running the tests then this can be 
arranged using a naming convention. I think tests are run in lexical 
order by filename, which can be different on different systems but, it 
can be made to work by putting numbers n the beginning of the filenames.

-If one of the functions that you run actually fails to exit properly, 
then the test will fail.

-If numerical results rather than printed output is what you want to 
test, then .R files are probably preferred.  In the test file you should 
check a value and stop() if it is not good, something like
   fuzz <- 1e-14
   if (fuzz < abs(sq(2) -  4)) stop("sq(2) test failed.")

-If you just check the printed value using the Rin / Rout mechanism, the 
rounding in print() will hide errors that you should catch. If you try 
to fix this by printing to higher precision, the tests will fail on 
different architectures and with different compilers.

- For some calculations, fuzz may need to be somewhat larger than you 
might expect, in order to accommodate different architectures and 
compilers. (This can be an indication that the algorithm or the specific 
problem is a bit unstable).

- It is nice to have test values (4 in the above example) that are known 
theoretically, but I usually have to use a value that came from an 
initial run of the program (so I am just testing if the program results 
have changed). In this case it is useful to print the test value to a 
high precision, say digits=18, just before you do the test, so you know 
what the new/wrong result is when the test fails. This is also useful 
for tracing down how big the fuzz needs to be to accommodate different 
architectures.

- If you use random numbers then you need to set the random number 
generator to a known state in each test file. The package setRNG may be 
helpful for this. (The logical here is that you are testing the code for 
changes and errors, not running a random experiment.)

-If you use random numbers then you may want to run the program 
random.number.test() in setRNG as one of your first tests. This function 
checks that the RNG and normal generator have not been changed.  (They 
have not changed in a long time, but I am a bit sensitive to this point, 
having wasted a lot of time after a small change between two versions of 
Splus.)

-If  you use the Rin / Rout mechanism, be careful about what you print, 
otherwise you may have a high maintenance problem because the printed 
output can change a bit for reasons you may not anticipate. (It may be 
possible  to make this robust in ways I don't understand - so if someone 
can add to this I would appreciate hearing. I'm especially curious how 
language support works with this.)

-You can test error checking and warnings in your functions using try() 
in the test files, but you might consider leaving this until you have 
mastered some of the other pieces.

- Graphics output can be put in files (I think in Rplot.ps by default) 
but I don't know of any way to automatically check the graphs to see if 
they are good.  As far as I know, you have to actually look at them. If 
anyone knows of an automatic mechanism I would really like to hear about it.

-Each test file needs to attach any needed packages, including the one 
being tested.

-Be a bit careful about what gets found in your default search path. 
This can be especially important if you are checking the tests files 
outside of the  R CMD check environment, and after you have installed 
your package and are testing a new revised version.

-If you are testing multiple packages that are inter-related, then you 
may need to be careful about some additional things, like not picking up 
one of the test packages from the site library rather than your testing 
library.

HTH
Paul Gilbert
>     ChrG> Do you imply that I say I try and I did not ?  
>
> not at all!  I am sorry if you (or anyone) got this impression!
>
>     ChrG> Well, lets check that :
>
>     ChrG> P_unluck_1 <- 1-(219/1379) 
>     ChrG> (P_unluck_10 <- P_unluck_1^10) [1] 0.1773933
>
>     ChrG> So P>0.05, once can not say that I am not a liar.
>     ChrG> Further investigation are needed :-)
>
> :-)
>
>     >> Isn't all this is explained nicely in the "Writing R
>     >> Extensions" Manual?
>
>     ChrG> NO ! There is 8 lines on it, and the structure of the
>     ChrG> Rin and Rout is not given. The writing R Ext. say "the
>     ChrG> Test code can be in .R or in .Rin" but I do not know
>     ChrG> what "test code" is suppose to be. I try simple things
>     ChrG> like some function with argument, but it does not
>     ChrG> works. I try more complicated things, I did not manage
>     ChrG> to find the right things to do.
>
> Ok; so we should expand the part in the manual.
>
> First:  '.Rin' are typically only used very rarely; so, normally
> the input file is 'foo.R' and hence (well ``hence'') must be
> valid R code, typically starting by 
> library(<mypackage>).
>
>     ChrG> It also say ".Rin file containing code which in turn
>     ChrG> in .R", but there is also no information about the
>     ChrG> what the .Rin should be. May be it is obvious for some
>     ChrG> people, but not for me.
>
>     >> Or are there sections we should expand ?
>
>     ChrG> I do not know, if there is only few people using it,
>     ChrG> may be it is not worth. I guess you have so many other
>     ChrG> thinks to do...  On the other hand, if some tool are
>     ChrG> to difficult to understand, it is normal that people
>     ChrG> do not use them... I don't know.
>
>     ChrG> I will work on package example that Pr Ripley point to
>     ChrG> me. Then when I will have understand the way it works,
>     ChrG> would you like me to add little paragraph in "Writing
>     ChrG> R extention" ? I mean, not an paragraph by expert but
>     ChrG> a paragraph by a regular medium level user for some
>     ChrG> other regular medium level user.
>
> That maybe very useful, thank you for the offer!
> Note that the manual source is in
>   https://svn.r-project.org/R/trunk/doc/manual/R-exts.texi
>
>     >> For answering your subsequent questions, you should
>     >> probably both look at an example package *and* read the
>     >> 'Writing R Extensions' manual a bit more "closely".
>
>     ChrG> Well, I try to not disturb people for little obvious
>     ChrG> thinks. I can tell you I did work hard before asking,
>     ChrG> specialy before asking on r-devel...
>
> Okay, I apologize for having misjudged your efforts.
>
> Martin
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>   
====================================================================================

La version fran?aise suit le texte anglais.

------------------------------------------------------------------------------------

This email may contain privileged and/or confidential in...{{dropped:26}}


From pavlidisp2 at simon.rochester.edu  Mon Mar 31 22:59:29 2008
From: pavlidisp2 at simon.rochester.edu (Pavlidis, Polykarpos)
Date: Mon, 31 Mar 2008 16:59:29 -0400
Subject: [Rd] Compile dll in Windows XP
Message-ID: <46F9F96760FD9A48AF99A8855DA6B59101100708@ITS-EXC8.UR.Rochester.edu>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20080331/6e925233/attachment.pl 

From murdoch at stats.uwo.ca  Mon Mar 31 23:51:43 2008
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Mon, 31 Mar 2008 17:51:43 -0400
Subject: [Rd] Compile dll in Windows XP
In-Reply-To: <46F9F96760FD9A48AF99A8855DA6B59101100708@ITS-EXC8.UR.Rochester.edu>
References: <46F9F96760FD9A48AF99A8855DA6B59101100708@ITS-EXC8.UR.Rochester.edu>
Message-ID: <47F15CEF.2030302@stats.uwo.ca>

On 31/03/2008 4:59 PM, Pavlidis, Polykarpos wrote:
> This is my first attempt to call a C function from R. I have installed Rtools,MinGW and Perl and I have included them in my system path. I am trying to compile a toy function that can be called in R but when I type "RCMD SHLIB foo.c" I receive the following message in my Command prompt:

Show us your path.  "Including" the tools is not good enough; the order 
matters.  Rtools needs to be first.  (See the instructions that come 
with the Rtools.)

> 
> making foo.d from foo.c
> make: [foo.d] Error 255 (ignored)
> cat: foo.d: No such file or directory
> make: [makeMakedeps] Error 1 (ignored)
> windres --preprocessor = "gcc-sjlj -E -xc -DRC_INVOKED" -I C:/Progra~1/R/R-26~1.2/
> include -i foo_res.rc -o foo_res.o
> c:\MinGW\bin\windres.exe: unknown format type 'C:/PROGRA~1/R/R-26~1.2/include'
> c:\MinGW\bin\windres.exe: supported formats: rc res coff

Rtools wouldn't normally put MinGW there.  Are you sure you're using a 
current version?

Duncan Murdoch

> make: ***[foo_res.o] Error 1
> 
> Could someone please help me with what's going wrong? Thank you in advance.
> 
> 
> *-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-
> 
> Polykarpos Pavlidis
> William E. Simon Graduate School of Business 
> University of Rochester
> PhD Candidate, Marketing
> Carol Simon Bld 4-339
> 585-2753702
> 
> 
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From cgenolin at u-paris10.fr  Mon Mar 31 10:58:33 2008
From: cgenolin at u-paris10.fr (cgenolin at u-paris10.fr)
Date: Mon, 31 Mar 2008 10:58:33 +0200
Subject: [Rd] tests Rin and Rout
In-Reply-To: <18416.40443.244387.473214@stat.math.ethz.ch>
References: <47F014DB.6040000@u-paris10.fr>
	<18416.40443.244387.473214@stat.math.ethz.ch>
Message-ID: <20080331105833.hg2cj67g6c84c8k0@icare.u-paris10.fr>

Martin Maechler <maechler at stat.math.ethz.ch> a ??crit? :

>>>>>> "CG" == Christophe Genolini <cgenolin at u-paris10.fr>
>>>>>>     on Mon, 31 Mar 2008 00:31:55 +0200 writes:
>
>    >>
>    >> Generally I find it's good to look at examples that work.
>    >> For examples of packages using tests, look at source
>    >> packages on CRAN.  Run the tests on them (using R CMD
>    >> check), and see what gets produced.
>    >>
>    CG> Do you have the name of a package that use it ? I try
>    CG> the 10 first package, and 10 other at random, but none
>    CG> of them use tests...
>
> hmm, I see 219 out 1378 CRAN packages having a 'tests'
> subdirectory, so it seems you have been a bit unlucky. ;-)

Do you imply that I say I try and I did not ?
Well, lets check that :

P_unluck_1   <- 1-(219/1379)
(P_unluck_10 <- P_unluck_1^10)
[1] 0.1773933

So P>0.05, once can not say that I am not a liar.
Further investigation are needed :-)

> Isn't all this is explained nicely in the "Writing R Extensions" Manual?

NO ! There is 8 lines on it, and the structure of the Rin and Rout is 
not given. The writing R Ext. say "the Test code can be in .R or in 
.Rin" but I do not know what "test code" is suppose to be. I try simple 
things like some function with argument, but it does not works. I try 
more complicated things, I did not manage to find the right things to 
do.

It also say ".Rin file containing code which in turn in .R", but there 
is also no information about the what the .Rin should be. May be it is 
obvious for some people, but not for me.

> Or are there sections we should expand ?

I do not know, if there is only few people using it, may be it is not 
worth. I guess you have so many other thinks to do...
On the other hand, if some tool are to difficult to understand, it is 
normal that people do not use them... I don't know.

I will work on package example that Pr Ripley point to me. Then when I 
will have understand the way it works, would you like me to add little 
paragraph in "Writing R extention" ? I mean, not an paragraph by expert 
but a paragraph by a regular medium level user for some other regular 
medium level user.

> For answering your subsequent questions, you should probably
> both look at an example package *and* read the 'Writing R
> Extensions' manual a bit more "closely".

Well, I try to not disturb people for little obvious thinks. I can tell 
you I did work hard before asking, specialy before asking on r-devel...

Christophe




----------------------------------------------------------------
Ce message a ete envoye par IMP, grace a l'Universite Paris 10 Nanterre


From cgenolin at u-paris10.fr  Mon Mar 31 11:05:28 2008
From: cgenolin at u-paris10.fr (cgenolin at u-paris10.fr)
Date: Mon, 31 Mar 2008 11:05:28 +0200
Subject: [Rd] tests Rin and Rout
In-Reply-To: <F6B20CA9-4E06-4759-99A8-6F572B3CBCFC@noc.soton.ac.uk>
References: <47F014DB.6040000@u-paris10.fr>
	<18416.40443.244387.473214@stat.math.ethz.ch>
	<F6B20CA9-4E06-4759-99A8-6F572B3CBCFC@noc.soton.ac.uk>
Message-ID: <20080331110528.ndj4ou8fdw40o8wo@icare.u-paris10.fr>

>> hmm, I see 219 out 1378 CRAN packages having a 'tests'
>> subdirectory, so it seems you have been a bit unlucky. ;-)
>
>
>
> How unlucky exactly?
>
>
> > fisher.test(matrix(c(0,20,219,1159),2,2))
>

Hey, no, I desagree ! I random 10, the 10 first I take the ten first 
package. So this in not random.
May be the people that chose a name package starting with 'a' does not 
like using 'tests'...

So we have to do fisher.test(matrix(c(0,10,219,1159),2,2))


        Fisher's Exact Test for Count Data

data:  matrix(c(0, 10, 219, 1159), 2, 2) p-value = 0.3783
alternative hypothesis: true odds ratio is not equal to 1 95 percent 
confidence interval:
0.000000 2.380931 sample estimates:
odds ratio

I am not *that* unlucky

Christophe

----------------------------------------------------------------
Ce message a ete envoye par IMP, grace a l'Universite Paris 10 Nanterre


From f.jamitzky at gmail.com  Mon Mar 31 12:39:55 2008
From: f.jamitzky at gmail.com (f.jamitzky)
Date: Mon, 31 Mar 2008 03:39:55 -0700 (PDT)
Subject: [Rd] callCC in 2.7.0
In-Reply-To: <971536df0803300710t40f61256x78b9889a5c323924@mail.gmail.com>
References: <971536df0803300710t40f61256x78b9889a5c323924@mail.gmail.com>
Message-ID: <16395614.post@talk.nabble.com>


callcc is similar to the "yield" keyword in python and c#
it lets you define e.g. a generator of lists of numbers.




Gabor Grothendieck wrote:
> 
> Would anyone like to explain if callCC in R 2.7.0 gives
> anything that on.exit does not already provide?
> 
> It seems that the exit condition once defined cannot
> be added to overridden whereas with on.exit multiple
> on.exit's add additional on.exits rather than being ignored.
> 
> Is this important?
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 

-- 
View this message in context: http://www.nabble.com/callCC-in-2.7.0-tp16382578p16395614.html
Sent from the R devel mailing list archive at Nabble.com.


From anders at ebi.ac.uk  Mon Mar 31 19:45:18 2008
From: anders at ebi.ac.uk (anders at ebi.ac.uk)
Date: Mon, 31 Mar 2008 19:45:18 +0200 (CEST)
Subject: [Rd] (PR#11054) "Writing R Extensions": bad example with CAR
Message-ID: <20080331174518.ECEC4282EFF0@mail.pubhealth.ku.dk>

Dear Prof Ripley,

Prof Brian Ripley wrote:
> But it is not taken 'verbatim from src/main/print.c' (at least not in 
> that version of R), and the code is not run with USE_RINTERNALS defined 
> when write-barrier checking is enabled.
> 
> The example has been updated to match the current code in 2.7.0 alpha.

I just assumed that it is copied verbatim without checking because it 
says so in the sentence above the code ("As a more comprehensive example 
of constructing an R call in C code and evaluating, consider the 
following fragment of printAttributes in src/main/print.c.")

I don't understand, however, what you mean by stating that 
USE_RINTERNALS is not needed (and I have to admit that I have no 
knowledge of this 'write-barrier checking' mechanism.)

May I ask you to have a look at the following code snippet?

--8<-- file foo.c ---
#import <R.h>
#import <Rinternals.h>

int main() {
    SEXP a, b;
    // ...
    CAR(a) = b;
}
--8<---

If I compile this with "gcc -I <path to R 2.6.2> foo.c", I get the error 
"invalid lvalue in assignment", while it compiles without error if I 
specify the compiler option "-DUSE_RINTERNALS".

Looking at the output of the preprocessor output reveals that without 
USE_RINTERNALS, the line "CAR(a)=b" stays as it is, i.e. presents the 
compiler with a function call as l-value, while with USE-RINTERNALS, it 
gets macro-expanded to "((a)->u.listsxp.carval) = b", which is now a 
valid expression.

 From this observation, I assumed that CAR is implemented as a function 
usually and as a macro only when USE_RINTERNALS is defined. Further, I 
assumed that the proper way for extensions to set car values is to write 
"SETCAR(a,b)", while R internal code, compiled with USE_RINTERNALS, may 
use "CAR(a)=b", which expands to the more efficient macro.

Now, you say that this should have nothing to do with R_USEINTERNALS, 
and that the code snippet in the manual should compile without it as well.

This leaves me confused. Should the code in the manual really compile 
without setting any compiler options? If so, what obvious point am I 
overlooking?

Best regards
   Simon Anders




+---
| Dr. Simon Anders, Dipl. Phys.
| European Bioinformatics Institute, Hinxton, Cambridgeshire, UK
| office phone +44-1223-494478, mobile phone +44-7505-841692
| preferred (permanent) e-mail: sanders at fs.tum.de


From anders at ebi.ac.uk  Mon Mar 31 22:55:08 2008
From: anders at ebi.ac.uk (anders at ebi.ac.uk)
Date: Mon, 31 Mar 2008 22:55:08 +0200 (CEST)
Subject: [Rd] (PR#11054) "Writing R Extensions": bad example with CAR
Message-ID: <20080331205508.B861D282EFF7@mail.pubhealth.ku.dk>

Prof Brian Ripley wrote:
> I didn't say 'USE_RINTERNALS is not needed' for your code: I said it was 
> not used for the code that was run.

I see. My original point was that the text of the "Writing R extension" 
manual advises against using 'USE_RINTERNALS' but then gives an example 
that only works when this macro is defined, without even pointing out 
this requirement. I merely wanted to suggest adding a little note to the 
manual at this point to make the matter easier for the reader.

Best regards
   Simon Anders


