From dgrove at fhcrc.org  Mon Aug  1 06:19:02 2005
From: dgrove at fhcrc.org (Douglas Grove)
Date: Sun, 31 Jul 2005 21:19:02 -0700 (PDT)
Subject: [Rd] R_BATCHSAVE setting in config.site
In-Reply-To: <Pine.LNX.4.61.0507291833090.12432@gannet.stats>
References: <Pine.LNX.4.58.0507291004080.407@echidna.fhcrc.org>
	<Pine.LNX.4.61.0507291833090.12432@gannet.stats>
Message-ID: <Pine.LNX.4.58.0507312109410.2905@bear.fhcrc.org>

On Sun, 31 Jul 2005, Prof Brian Ripley wrote:

> R is case-sensitive!
> 
> 'batch mode' does not refer to using the utility `R CMD BATCH' (which you 
> called 'BATCH mode' but is not actually running R but running a utility 
> that runs R), and which is documented to set --save.
> 
> Something like R < input.R is not interactive use, and in Unix parlance is 
> 'batch' use.  It is the opposite of 'interactive' (see ?interactive). EOF 
> is ignored in interactive use of R, but this setting does affect 
> interactive use in that you will no longer be asked it you want to save 
> the workspace.

Sorry, I was under the impression (obviously mistaken) that 'batch'
referred to non-interactive use of R, either via R < input.R or 
via the CMD BATCH utility.  It *is* called 'BATCH' after all, so it's
not a great leap to assume it would be considered a 'batch' mode.


> This setting should probably be described in the R-admin manual, perhaps 
> with a better name.

It would be good to mention somewhere (probably in ?quit) that setting
R_SAVEBATCH to --no-save will mess with the default of the 'save'
argument of quit().


Thanks for help,
Doug


> 
> 
> On Fri, 29 Jul 2005, Douglas Grove wrote:
> 
> > Hi,
> >
> > I just downloaded and installed last nights version of R-patched
> > and decided that I'd set R_BATCHSAVE=--no-save in config.site,
> > which I haven't done before.
> >
> > Since the comment above R_BATCHSAVE in config.site says:
> >  ## The default behavior of R if it encounters EOF in batch mode.
> >  ## Set this to one of '--save' or '--no-save' depending whether you
> >  ## want automatic saving of '.RData' or not.
> > so I assumed it should only affect BATCH mode.  However, I'm finding
> > the opposite, it only affects interactive mode, and *not* BATCH mode.
> >
> > I configured and made R two different ways, one with R_BATCHSAVE set
> > to --no-save and one with it left unset (defaulting to --save).
> 
> No, unset is not --save.
> 
> > I compared the resulting scripts to one another.  I found that
> > there was no difference in the ${R_HOME}/bin/BATCH scripts but there was
> > a difference in the ${R_HOME}/bin/R scripts.  When I set R_BATCHSAVE
> > to --no-save I got:
> >  exec "${R_binary}" --no-save ${args}
> > rather instead of:
> >  exec "${R_binary}"  ${args}
> > one line 175 of /bin/R.
> >
> > Am I missing something (certainly not an uncommon occurrance) or
> > is this a mistake?
> 
> A misreading.
> 
> -- 
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>


From murdoch at stats.uwo.ca  Mon Aug  1 14:48:39 2005
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Mon, 01 Aug 2005 08:48:39 -0400
Subject: [Rd] Most accurate timing?
Message-ID: <42EE1A27.7050803@stats.uwo.ca>

For a graphics display, I'd like a high resolution timer, something like 
Sys.time(), but it is only accurate to a second.  Is there a clock in R 
that gives a finer value?

Duncan Murdoch


From maechler at stat.math.ethz.ch  Mon Aug  1 15:09:23 2005
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Mon, 1 Aug 2005 15:09:23 +0200
Subject: [Rd] Most accurate timing?
In-Reply-To: <42EE1A27.7050803@stats.uwo.ca>
References: <42EE1A27.7050803@stats.uwo.ca>
Message-ID: <17134.7939.686794.549905@stat.math.ethz.ch>

>>>>> "Duncan" == Duncan Murdoch <murdoch at stats.uwo.ca>
>>>>>     on Mon, 01 Aug 2005 08:48:39 -0400 writes:

    Duncan> For a graphics display, I'd like a high resolution
    Duncan> timer, something like Sys.time(), but it is only
    Duncan> accurate to a second.  Is there a clock in R that
    Duncan> gives a finer value?

Why can't use  proc.time()  ?

It's help file says

     The resolution of the times will be system-specific; it is
     common for them to be recorded to of the order of 1/100
     second, and elapsed time is rounded to the nearest 1/100.

Martin Maechler


From murdoch at stats.uwo.ca  Mon Aug  1 16:00:45 2005
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Mon, 01 Aug 2005 10:00:45 -0400
Subject: [Rd] Most accurate timing?
In-Reply-To: <17134.7939.686794.549905@stat.math.ethz.ch>
References: <42EE1A27.7050803@stats.uwo.ca>
	<17134.7939.686794.549905@stat.math.ethz.ch>
Message-ID: <42EE2B0D.9060200@stats.uwo.ca>

On 8/1/2005 9:09 AM, Martin Maechler wrote:
>>>>>> "Duncan" == Duncan Murdoch <murdoch at stats.uwo.ca>
>>>>>>     on Mon, 01 Aug 2005 08:48:39 -0400 writes:
> 
>     Duncan> For a graphics display, I'd like a high resolution
>     Duncan> timer, something like Sys.time(), but it is only
>     Duncan> accurate to a second.  Is there a clock in R that
>     Duncan> gives a finer value?
> 
> Why can't use  proc.time()  ?
> 
> It's help file says
> 
>      The resolution of the times will be system-specific; it is
>      common for them to be recorded to of the order of 1/100
>      second, and elapsed time is rounded to the nearest 1/100.
> 

proc.time()[3] is what I want; I had forgotten about it.

Duncan Murdoch


From jfox at mcmaster.ca  Mon Aug  1 16:20:41 2005
From: jfox at mcmaster.ca (John Fox)
Date: Mon, 1 Aug 2005 10:20:41 -0400
Subject: [Rd] Testing for English locale
Message-ID: <20050801142041.KCML26102.tomts10-srv.bellnexxia.net@JohnDesktop8300>

Dear r-devel list members,

Is there a platform-independent way to test whether R is running in an
English locale?

Thanks,
 John

--------------------------------
John Fox
Department of Sociology
McMaster University
Hamilton, Ontario
Canada L8S 4M4
905-525-9140x23604
http://socserv.mcmaster.ca/jfox


From simon.urbanek at r-project.org  Mon Aug  1 17:35:43 2005
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Mon, 1 Aug 2005 11:35:43 -0400
Subject: [Rd] Testing for English locale
In-Reply-To: <20050801142041.KCML26102.tomts10-srv.bellnexxia.net@JohnDesktop8300>
References: <20050801142041.KCML26102.tomts10-srv.bellnexxia.net@JohnDesktop8300>
Message-ID: <AB974D83-2494-48BD-9A7F-1BC134BE81FE@r-project.org>

On Aug 1, 2005, at 10:20 AM, John Fox wrote:

> Is there a platform-independent way to test whether R is running in  
> an English locale?

I suppose the following should work:

Sys.getlocale("LC_CTYPE")=="C" || length(grep("^en",Sys.getlocale 
("LC_CTYPE"),TRUE))>0

Basically unix platforms will have "C" or "en_..."; Windows has  
"English...". You could make the check more strict depending on the  
platform if desired ..

Cheers,
Simon


From gavin.simpson at ucl.ac.uk  Mon Aug  1 19:04:16 2005
From: gavin.simpson at ucl.ac.uk (Gavin Simpson)
Date: Mon, 01 Aug 2005 18:04:16 +0100
Subject: [Rd] Follow-Up: R on FC4
Message-ID: <1122915856.23831.43.camel@gsimpson.geog.ucl.ac.uk>

Dear List,

A few weeks ago a discussion took place regarding Fedora Core 4 and
compiling R on that platform using the new version 4 of gcc and its
gfortran compiler.

gcc was recently updated to 4.0.1 on FC4 (4.0.1-5 in Red Hat Land) so I
thought I'd give compiling R a go on my laptop which needed updating
anyway. I've had trouble using the optimisation flags I used to use
under FC3 with FC4 and the compatibility version of g77, so I wanted to
see if I could compile with the flags I was used to (under FC3) with
gfortran on FC4. I was compiling with no extra flags on g77 to get it to
compile at all on my FC4 desktop.

R-patched compiles and make check-all succeeds on FC with gcc/g+
+/gfortran using these options at least: -g -O3 -m32 -pipe -mcpu=i386 -
mtune=pentium3m

R-devel compiles without error (same set of flags as above) but fails
make check-all in p-r-random-tests.R - the relevant section of p-r-
random-tests.Rout.fail is:

...
> dkwtest("norm")
norm() PASSED
[1] TRUE
> dkwtest("norm",mean = 5,sd = 3)
norm(mean = 5, sd = 3) PASSED
[1] TRUE
> 
> dkwtest("gamma",shape =  0.1)
gamma(shape = 0.1) PASSED
[1] TRUE
> dkwtest("gamma",shape =  0.2)
gamma(shape = 0.2) PASSED
[1] TRUE
> dkwtest("gamma",shape = 10)
gamma(shape = 10) FAILED
Error in dkwtest("gamma", shape = 10) : dkwtest failed
Execution halted

Is this a tolerance setting in R's tests not being met or is this
indicative of a bad compilation of R-Devel on FC4 with gfortran?

Both these compilations was using the svn-acquired sources from this
afternoon:
R-patched = revision 35098
R-Devel = revision 35098

HTH

G
-- 
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
Gavin Simpson                     [T] +44 (0)20 7679 5522
ENSIS Research Fellow             [F] +44 (0)20 7679 7565
ENSIS Ltd. & ECRC                 [E] gavin.simpsonATNOSPAMucl.ac.uk
UCL Department of Geography       [W] http://www.ucl.ac.uk/~ucfagls/cv/
26 Bedford Way                    [W] http://www.ucl.ac.uk/~ucfagls/
London.  WC1H 0AP.
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%


From ggrothendieck at gmail.com  Mon Aug  1 19:10:49 2005
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Mon, 1 Aug 2005 13:10:49 -0400
Subject: [Rd] fifo on Windows
Message-ID: <971536df05080110104b457079@mail.gmail.com>

Are there any plans to support fifo on Windows?  On my XP
system ("R version 2.1.1, 2005-06-23")

   R> capabilities("fifo")

gives FALSE.

Note that Windows does support named pipes as shown
in the utility:

   http://gearbox.maem.umr.edu/fwu/pipeslot.zip


From tlumley at u.washington.edu  Mon Aug  1 19:16:10 2005
From: tlumley at u.washington.edu (Thomas Lumley)
Date: Mon, 1 Aug 2005 10:16:10 -0700 (PDT)
Subject: [Rd] Follow-Up: R on FC4
In-Reply-To: <1122915856.23831.43.camel@gsimpson.geog.ucl.ac.uk>
References: <1122915856.23831.43.camel@gsimpson.geog.ucl.ac.uk>
Message-ID: <Pine.A41.4.61b.0508011013500.226770@homer10.u.washington.edu>

On Mon, 1 Aug 2005, Gavin Simpson wrote:
> R-devel compiles without error (same set of flags as above) but fails
> make check-all in p-r-random-tests.R - the relevant section of p-r-
> random-tests.Rout.fail is:
>
> ...
>> dkwtest("norm")
> norm() PASSED
> [1] TRUE
>> dkwtest("norm",mean = 5,sd = 3)
> norm(mean = 5, sd = 3) PASSED
> [1] TRUE
>>
>> dkwtest("gamma",shape =  0.1)
> gamma(shape = 0.1) PASSED
> [1] TRUE
>> dkwtest("gamma",shape =  0.2)
> gamma(shape = 0.2) PASSED
> [1] TRUE
>> dkwtest("gamma",shape = 10)
> gamma(shape = 10) FAILED
> Error in dkwtest("gamma", shape = 10) : dkwtest failed
> Execution halted
>
> Is this a tolerance setting in R's tests not being met or is this
> indicative of a bad compilation of R-Devel on FC4 with gfortran?
>

Try this again -- it is a random test.  If it fails again then something 
is wrong.  The tolerance on these tests is not very tight, certainly 
nowhere near rounding error.

 	-thomas


From gavin.simpson at ucl.ac.uk  Mon Aug  1 20:09:14 2005
From: gavin.simpson at ucl.ac.uk (Gavin Simpson)
Date: Mon, 01 Aug 2005 19:09:14 +0100
Subject: [Rd] Follow-Up: R on FC4
In-Reply-To: <Pine.A41.4.61b.0508011013500.226770@homer10.u.washington.edu>
References: <1122915856.23831.43.camel@gsimpson.geog.ucl.ac.uk>
	<Pine.A41.4.61b.0508011013500.226770@homer10.u.washington.edu>
Message-ID: <1122919754.23831.45.camel@gsimpson.geog.ucl.ac.uk>

On Mon, 2005-08-01 at 10:16 -0700, Thomas Lumley wrote:
> On Mon, 1 Aug 2005, Gavin Simpson wrote:
> > R-devel compiles without error (same set of flags as above) but fails
> > make check-all in p-r-random-tests.R - the relevant section of p-r-
> > random-tests.Rout.fail is:
> >
> > ...
> >> dkwtest("norm")
> > norm() PASSED
> > [1] TRUE
> >> dkwtest("norm",mean = 5,sd = 3)
> > norm(mean = 5, sd = 3) PASSED
> > [1] TRUE
> >>
> >> dkwtest("gamma",shape =  0.1)
> > gamma(shape = 0.1) PASSED
> > [1] TRUE
> >> dkwtest("gamma",shape =  0.2)
> > gamma(shape = 0.2) PASSED
> > [1] TRUE
> >> dkwtest("gamma",shape = 10)
> > gamma(shape = 10) FAILED
> > Error in dkwtest("gamma", shape = 10) : dkwtest failed
> > Execution halted
> >
> > Is this a tolerance setting in R's tests not being met or is this
> > indicative of a bad compilation of R-Devel on FC4 with gfortran?
> >
> 
> Try this again -- it is a random test.  If it fails again then something 
> is wrong.  The tolerance on these tests is not very tight, certainly 
> nowhere near rounding error.

Thanks Thomas,

A re-compile with the same options of R-Devel went through without
error.

So far so good with FC4, gcc4, gfortran and R!

All the best,

G

> 
>  	-thomas
-- 
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
Gavin Simpson                     [T] +44 (0)20 7679 5522
ENSIS Research Fellow             [F] +44 (0)20 7679 7565
ENSIS Ltd. & ECRC                 [E] gavin.simpsonATNOSPAMucl.ac.uk
UCL Department of Geography       [W] http://www.ucl.ac.uk/~ucfagls/cv/
26 Bedford Way                    [W] http://www.ucl.ac.uk/~ucfagls/
London.  WC1H 0AP.
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%


From murdoch at stats.uwo.ca  Mon Aug  1 20:19:35 2005
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Mon, 01 Aug 2005 14:19:35 -0400
Subject: [Rd] fifo on Windows
In-Reply-To: <971536df05080110104b457079@mail.gmail.com>
References: <971536df05080110104b457079@mail.gmail.com>
Message-ID: <42EE67B7.2000406@stats.uwo.ca>

Gabor Grothendieck wrote:
> Are there any plans to support fifo on Windows?  On my XP
> system ("R version 2.1.1, 2005-06-23")
> 
>    R> capabilities("fifo")
> 
> gives FALSE.
> 
> Note that Windows does support named pipes as shown
> in the utility:
> 
>    http://gearbox.maem.umr.edu/fwu/pipeslot.zip

I think named pipes are only supported on the NT descendants.  We will 
need to drop support for Win9x soon, but I think we still have a number 
of users using Win98 and maybe WinME.

I guess we could add support for features that only work on some Windows 
platforms, but I'd rather not do that until we're not officially saying 
that R runs on Win9x.

Duncan Murdoch


From p.dalgaard at biostat.ku.dk  Mon Aug  1 20:43:55 2005
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: 01 Aug 2005 20:43:55 +0200
Subject: [Rd] Follow-Up: R on FC4
In-Reply-To: <1122919754.23831.45.camel@gsimpson.geog.ucl.ac.uk>
References: <1122915856.23831.43.camel@gsimpson.geog.ucl.ac.uk>
	<Pine.A41.4.61b.0508011013500.226770@homer10.u.washington.edu>
	<1122919754.23831.45.camel@gsimpson.geog.ucl.ac.uk>
Message-ID: <x2slxtlcpg.fsf@turmalin.kubism.ku.dk>

Gavin Simpson <gavin.simpson at ucl.ac.uk> writes:

> > Try this again -- it is a random test.  If it fails again then something 
> > is wrong.  The tolerance on these tests is not very tight, certainly 
> > nowhere near rounding error.
> 
> Thanks Thomas,
> 
> A re-compile with the same options of R-Devel went through without
> error.
> 
> So far so good with FC4, gcc4, gfortran and R!

The problem affecting the Fedora Extras RPM is still there with the
new compilers though:

 -Wp,-D_FORTIFY_SOURCE=2 

combined with -O or -O2 causes a strange printing bug:

> matrix(list(pi))
     [,1]
[1,]

(You don't have to use that option of course, but it suggests that not
all is well with the optimizer. And the Fedora maintainer seem set on
using it, which is a bit of a problem.)

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From ggrothendieck at gmail.com  Mon Aug  1 21:19:51 2005
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Mon, 1 Aug 2005 15:19:51 -0400
Subject: [Rd] fifo on Windows
In-Reply-To: <42EE67B7.2000406@stats.uwo.ca>
References: <971536df05080110104b457079@mail.gmail.com>
	<42EE67B7.2000406@stats.uwo.ca>
Message-ID: <971536df050801121967148366@mail.gmail.com>

fifo already works on UNIX, I assume, so it seems its already
the situation that fifos are supported on some machines running 
R but not on others.  If they were supported on those Windows 
platforms that can handle them then that would simply increase
the proportion of machines running R that can handle them 
(thinking in terms of across all machines running R rather than
thinking in terms of across all machines running R and Windows).
Note that one does have the capabilities command in any case
so the code could query that at the beginning and give an
error if its FALSE so no change to the code would be required 
in the future since it would never run in that situation anyways.

On 8/1/05, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
> Gabor Grothendieck wrote:
> > Are there any plans to support fifo on Windows?  On my XP
> > system ("R version 2.1.1, 2005-06-23")
> >
> >    R> capabilities("fifo")
> >
> > gives FALSE.
> >
> > Note that Windows does support named pipes as shown
> > in the utility:
> >
> >    http://gearbox.maem.umr.edu/fwu/pipeslot.zip
> 
> I think named pipes are only supported on the NT descendants.  We will
> need to drop support for Win9x soon, but I think we still have a number
> of users using Win98 and maybe WinME.
> 
> I guess we could add support for features that only work on some Windows
> platforms, but I'd rather not do that until we're not officially saying
> that R runs on Win9x.
> 
> Duncan Murdoch
>


From charlie at stat.umn.edu  Mon Aug  1 23:25:27 2005
From: charlie at stat.umn.edu (charlie@stat.umn.edu)
Date: Mon,  1 Aug 2005 23:25:27 +0200 (CEST)
Subject: [Rd] valgrind complains about regex.c (PR#8043)
Message-ID: <20050801212527.C2689A75B@slim.kubism.ku.dk>

I think I am using objects according to the man page.
This seems to be a valid regular expression.  But whether
I know what I'm doing or no, it still shouldn't be doing
what valgrind seems to be saying it's doing.  (IMHO)
---------- start of script ----------
Script started on Mon 01 Aug 2005 02:09:00 PM PDT
linux$ printenv VALGRIND_OPTS
--tool=3Dmemcheck
linux$ cat bar.R

 foo <- 1
 bar <- 2:3
 baz <- 4:6
 qux <- matrix(7:10, 2)

 ls()
 rm(list =3D objects(pattern =3D "^[a-pr-z]"))
 ls()

linux$ R --version
R 2.1.1 (2005-06-20).
Copyright (C) 2005 R Development Core Team

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under the terms of the GNU
General Public License.  For more information about these matters,
see http://www.gnu.org/copyleft/gpl.html.
linux$ gcc --version
=1B[0mgcc (GCC) 3.3.5 20050117 (prerelease) (SUSE Linux)
=1B[0mCopyright (C) 2003 Free Software Foundation, Inc.
=1B[0mThis is free software; see the source for copying conditions.  There =
is NO
=1B[0mwarranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PU=
RPOSE.
=1B[0m
linux$ cat /etc/SuSE-release=20
SuSE Linux 9.3 (i586)
VERSION =3D 9.3
linux$ R --vanilla --debugger=3Dvalgrind < bar.R >| bar.Rout
=3D=3D22324=3D=3D Memcheck, a memory error detector for x86-linux.
=3D=3D22324=3D=3D Copyright (C) 2002-2004, and GNU GPL'd, by Julian Seward =
et al.
=3D=3D22324=3D=3D Using valgrind-2.2.0, a program supervision framework for=
 x86-linux.
=3D=3D22324=3D=3D Copyright (C) 2000-2004, and GNU GPL'd, by Julian Seward =
et al.
=3D=3D22324=3D=3D For more details, rerun with: -v
=3D=3D22324=3D=3D=20
=3D=3D22324=3D=3D Invalid read of size 4
=3D=3D22324=3D=3D    at 0x81255AD: parse_expression (regex.c:5045)
=3D=3D22324=3D=3D    by 0x8125868: parse_branch (regex.c:4475)
=3D=3D22324=3D=3D    by 0x8125913: parse_reg_exp (regex.c:4420)
=3D=3D22324=3D=3D    by 0x81261B3: Rf_regcomp (regex.c:4384)
=3D=3D22324=3D=3D  Address 0x1C1E23A8 is 0 bytes after a block of size 32 a=
lloc'd
=3D=3D22324=3D=3D    at 0x1B90650D: calloc (in /usr/lib/valgrind/vgpreload_=
memcheck.so)
=3D=3D22324=3D=3D    by 0x81247B5: parse_expression (regex.c:5406)
=3D=3D22324=3D=3D    by 0x8125868: parse_branch (regex.c:4475)
=3D=3D22324=3D=3D    by 0x8125913: parse_reg_exp (regex.c:4420)
=3D=3D22324=3D=3D=20
=3D=3D22324=3D=3D Invalid write of size 4
=3D=3D22324=3D=3D    at 0x81255B2: parse_expression (regex.c:5045)
=3D=3D22324=3D=3D    by 0x8125868: parse_branch (regex.c:4475)
=3D=3D22324=3D=3D    by 0x8125913: parse_reg_exp (regex.c:4420)
=3D=3D22324=3D=3D    by 0x81261B3: Rf_regcomp (regex.c:4384)
=3D=3D22324=3D=3D  Address 0x1C1E23A8 is 0 bytes after a block of size 32 a=
lloc'd
=3D=3D22324=3D=3D    at 0x1B90650D: calloc (in /usr/lib/valgrind/vgpreload_=
memcheck.so)
=3D=3D22324=3D=3D    by 0x81247B5: parse_expression (regex.c:5406)
=3D=3D22324=3D=3D    by 0x8125868: parse_branch (regex.c:4475)
=3D=3D22324=3D=3D    by 0x8125913: parse_reg_exp (regex.c:4420)
=3D=3D22324=3D=3D=20
=3D=3D22324=3D=3D ERROR SUMMARY: 2 errors from 2 contexts (suppressed: 39 f=
rom 2)
=3D=3D22324=3D=3D malloc/free: in use at exit: 12691882 bytes in 6426 block=
s.
=3D=3D22324=3D=3D malloc/free: 32534 allocs, 26108 frees, 33105500 bytes al=
located.
=3D=3D22324=3D=3D For a detailed leak analysis,  rerun with: --leak-check=
=3Dyes
=3D=3D22324=3D=3D For counts of detected errors, rerun with: -v
linux$ exit

Script done on Mon 01 Aug 2005 02:10:42 PM PDT
---------- end of script ----------
--=20
Charles Geyer
Professor, School of Statistics
University of Minnesota
charlie at stat.umn.edu


From ripley at stats.ox.ac.uk  Tue Aug  2 08:13:54 2005
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 2 Aug 2005 07:13:54 +0100 (BST)
Subject: [Rd] valgrind complains about regex.c (PR#8043)
In-Reply-To: <20050801212527.C2689A75B@slim.kubism.ku.dk>
References: <20050801212527.C2689A75B@slim.kubism.ku.dk>
Message-ID: <Pine.LNX.4.61.0508020704180.19394@gannet.stats>

Did you compile R without optimization?  Such reads are often the result 
of read-aheads produced by the optimizer in an attempt to keep 
pipelines full (and are harmless).

On an un-optimized build of R I am unable to reproduce this.  (I also was 
unable to reproduce it on my optimized build of 2.1.1 using gcc 3.4.4, 
although I did get a report on other read-aheads.)

On Mon, 1 Aug 2005 charlie at stat.umn.edu wrote:

> I think I am using objects according to the man page.
> This seems to be a valid regular expression.  But whether
> I know what I'm doing or no, it still shouldn't be doing
> what valgrind seems to be saying it's doing.  (IMHO)

I think you need to take that up with compiler designers: it is common 
practice.

> ---------- start of script ----------
> Script started on Mon 01 Aug 2005 02:09:00 PM PDT
> linux$ printenv VALGRIND_OPTS
> --tool=3Dmemcheck
> linux$ cat bar.R
>
> foo <- 1
> bar <- 2:3
> baz <- 4:6
> qux <- matrix(7:10, 2)
>
> ls()
> rm(list =3D objects(pattern =3D "^[a-pr-z]"))
> ls()
>
> linux$ R --version
> R 2.1.1 (2005-06-20).
> Copyright (C) 2005 R Development Core Team
>
> R is free software and comes with ABSOLUTELY NO WARRANTY.
> You are welcome to redistribute it under the terms of the GNU
> General Public License.  For more information about these matters,
> see http://www.gnu.org/copyleft/gpl.html.
> linux$ gcc --version
> =1B[0mgcc (GCC) 3.3.5 20050117 (prerelease) (SUSE Linux)
> =1B[0mCopyright (C) 2003 Free Software Foundation, Inc.
> =1B[0mThis is free software; see the source for copying conditions.  There =
> is NO
> =1B[0mwarranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PU=
> RPOSE.
> =1B[0m
> linux$ cat /etc/SuSE-release=20
> SuSE Linux 9.3 (i586)
> VERSION =3D 9.3
> linux$ R --vanilla --debugger=3Dvalgrind < bar.R >| bar.Rout
> =3D=3D22324=3D=3D Memcheck, a memory error detector for x86-linux.
> =3D=3D22324=3D=3D Copyright (C) 2002-2004, and GNU GPL'd, by Julian Seward =
> et al.
> =3D=3D22324=3D=3D Using valgrind-2.2.0, a program supervision framework for=
> x86-linux.
> =3D=3D22324=3D=3D Copyright (C) 2000-2004, and GNU GPL'd, by Julian Seward =
> et al.
> =3D=3D22324=3D=3D For more details, rerun with: -v
> =3D=3D22324=3D=3D=20
> =3D=3D22324=3D=3D Invalid read of size 4
> =3D=3D22324=3D=3D    at 0x81255AD: parse_expression (regex.c:5045)
> =3D=3D22324=3D=3D    by 0x8125868: parse_branch (regex.c:4475)
> =3D=3D22324=3D=3D    by 0x8125913: parse_reg_exp (regex.c:4420)
> =3D=3D22324=3D=3D    by 0x81261B3: Rf_regcomp (regex.c:4384)
> =3D=3D22324=3D=3D  Address 0x1C1E23A8 is 0 bytes after a block of size 32 a=
> lloc'd
> =3D=3D22324=3D=3D    at 0x1B90650D: calloc (in /usr/lib/valgrind/vgpreload_=
> memcheck.so)
> =3D=3D22324=3D=3D    by 0x81247B5: parse_expression (regex.c:5406)
> =3D=3D22324=3D=3D    by 0x8125868: parse_branch (regex.c:4475)
> =3D=3D22324=3D=3D    by 0x8125913: parse_reg_exp (regex.c:4420)
> =3D=3D22324=3D=3D=20
> =3D=3D22324=3D=3D Invalid write of size 4
> =3D=3D22324=3D=3D    at 0x81255B2: parse_expression (regex.c:5045)
> =3D=3D22324=3D=3D    by 0x8125868: parse_branch (regex.c:4475)
> =3D=3D22324=3D=3D    by 0x8125913: parse_reg_exp (regex.c:4420)
> =3D=3D22324=3D=3D    by 0x81261B3: Rf_regcomp (regex.c:4384)
> =3D=3D22324=3D=3D  Address 0x1C1E23A8 is 0 bytes after a block of size 32 a=
> lloc'd
> =3D=3D22324=3D=3D    at 0x1B90650D: calloc (in /usr/lib/valgrind/vgpreload_=
> memcheck.so)
> =3D=3D22324=3D=3D    by 0x81247B5: parse_expression (regex.c:5406)
> =3D=3D22324=3D=3D    by 0x8125868: parse_branch (regex.c:4475)
> =3D=3D22324=3D=3D    by 0x8125913: parse_reg_exp (regex.c:4420)
> =3D=3D22324=3D=3D=20
> =3D=3D22324=3D=3D ERROR SUMMARY: 2 errors from 2 contexts (suppressed: 39 f=
> rom 2)
> =3D=3D22324=3D=3D malloc/free: in use at exit: 12691882 bytes in 6426 block=
> s.
> =3D=3D22324=3D=3D malloc/free: 32534 allocs, 26108 frees, 33105500 bytes al=
> located.
> =3D=3D22324=3D=3D For a detailed leak analysis,  rerun with: --leak-check=
> =3Dyes
> =3D=3D22324=3D=3D For counts of detected errors, rerun with: -v
> linux$ exit
>
> Script done on Mon 01 Aug 2005 02:10:42 PM PDT
> ---------- end of script ----------
> --=20
> Charles Geyer
> Professor, School of Statistics
> University of Minnesota
> charlie at stat.umn.edu
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From murdoch at stats.uwo.ca  Tue Aug  2 13:50:54 2005
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Tue, 02 Aug 2005 07:50:54 -0400
Subject: [Rd] valgrind complains about regex.c (PR#8043)
In-Reply-To: <Pine.LNX.4.61.0508020704180.19394@gannet.stats>
References: <20050801212527.C2689A75B@slim.kubism.ku.dk>
	<Pine.LNX.4.61.0508020704180.19394@gannet.stats>
Message-ID: <42EF5E1E.30105@stats.uwo.ca>

Prof Brian Ripley wrote:
> Did you compile R without optimization?  Such reads are often the result 
> of read-aheads produced by the optimizer in an attempt to keep 
> pipelines full (and are harmless).

There were both a read and a write.  I can see the read being harmless, 
but is the write harmless?  I suspect this may be the bug I fixed on 
July 16, since it had to do with character classes including ranges 
(like Charlie's "[a-pr-z]").

Charlie, have you tried a recent version of R-patched?

Duncan Murdoch

> 
> On an un-optimized build of R I am unable to reproduce this.  (I also was 
> unable to reproduce it on my optimized build of 2.1.1 using gcc 3.4.4, 
> although I did get a report on other read-aheads.)
> 
> On Mon, 1 Aug 2005 charlie at stat.umn.edu wrote:
> 
> 
>>I think I am using objects according to the man page.
>>This seems to be a valid regular expression.  But whether
>>I know what I'm doing or no, it still shouldn't be doing
>>what valgrind seems to be saying it's doing.  (IMHO)
> 
> 
> I think you need to take that up with compiler designers: it is common 
> practice.
> 
> 
>>---------- start of script ----------
>>Script started on Mon 01 Aug 2005 02:09:00 PM PDT
>>linux$ printenv VALGRIND_OPTS
>>--tool=3Dmemcheck
>>linux$ cat bar.R
>>
>>foo <- 1
>>bar <- 2:3
>>baz <- 4:6
>>qux <- matrix(7:10, 2)
>>
>>ls()
>>rm(list =3D objects(pattern =3D "^[a-pr-z]"))
>>ls()
>>
>>linux$ R --version
>>R 2.1.1 (2005-06-20).
>>Copyright (C) 2005 R Development Core Team
>>
>>R is free software and comes with ABSOLUTELY NO WARRANTY.
>>You are welcome to redistribute it under the terms of the GNU
>>General Public License.  For more information about these matters,
>>see http://www.gnu.org/copyleft/gpl.html.
>>linux$ gcc --version
>>=1B[0mgcc (GCC) 3.3.5 20050117 (prerelease) (SUSE Linux)
>>=1B[0mCopyright (C) 2003 Free Software Foundation, Inc.
>>=1B[0mThis is free software; see the source for copying conditions.  There =
>>is NO
>>=1B[0mwarranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PU=
>>RPOSE.
>>=1B[0m
>>linux$ cat /etc/SuSE-release=20
>>SuSE Linux 9.3 (i586)
>>VERSION =3D 9.3
>>linux$ R --vanilla --debugger=3Dvalgrind < bar.R >| bar.Rout
>>=3D=3D22324=3D=3D Memcheck, a memory error detector for x86-linux.
>>=3D=3D22324=3D=3D Copyright (C) 2002-2004, and GNU GPL'd, by Julian Seward =
>>et al.
>>=3D=3D22324=3D=3D Using valgrind-2.2.0, a program supervision framework for=
>>x86-linux.
>>=3D=3D22324=3D=3D Copyright (C) 2000-2004, and GNU GPL'd, by Julian Seward =
>>et al.
>>=3D=3D22324=3D=3D For more details, rerun with: -v
>>=3D=3D22324=3D=3D=20
>>=3D=3D22324=3D=3D Invalid read of size 4
>>=3D=3D22324=3D=3D    at 0x81255AD: parse_expression (regex.c:5045)
>>=3D=3D22324=3D=3D    by 0x8125868: parse_branch (regex.c:4475)
>>=3D=3D22324=3D=3D    by 0x8125913: parse_reg_exp (regex.c:4420)
>>=3D=3D22324=3D=3D    by 0x81261B3: Rf_regcomp (regex.c:4384)
>>=3D=3D22324=3D=3D  Address 0x1C1E23A8 is 0 bytes after a block of size 32 a=
>>lloc'd
>>=3D=3D22324=3D=3D    at 0x1B90650D: calloc (in /usr/lib/valgrind/vgpreload_=
>>memcheck.so)
>>=3D=3D22324=3D=3D    by 0x81247B5: parse_expression (regex.c:5406)
>>=3D=3D22324=3D=3D    by 0x8125868: parse_branch (regex.c:4475)
>>=3D=3D22324=3D=3D    by 0x8125913: parse_reg_exp (regex.c:4420)
>>=3D=3D22324=3D=3D=20
>>=3D=3D22324=3D=3D Invalid write of size 4
>>=3D=3D22324=3D=3D    at 0x81255B2: parse_expression (regex.c:5045)
>>=3D=3D22324=3D=3D    by 0x8125868: parse_branch (regex.c:4475)
>>=3D=3D22324=3D=3D    by 0x8125913: parse_reg_exp (regex.c:4420)
>>=3D=3D22324=3D=3D    by 0x81261B3: Rf_regcomp (regex.c:4384)
>>=3D=3D22324=3D=3D  Address 0x1C1E23A8 is 0 bytes after a block of size 32 a=
>>lloc'd
>>=3D=3D22324=3D=3D    at 0x1B90650D: calloc (in /usr/lib/valgrind/vgpreload_=
>>memcheck.so)
>>=3D=3D22324=3D=3D    by 0x81247B5: parse_expression (regex.c:5406)
>>=3D=3D22324=3D=3D    by 0x8125868: parse_branch (regex.c:4475)
>>=3D=3D22324=3D=3D    by 0x8125913: parse_reg_exp (regex.c:4420)
>>=3D=3D22324=3D=3D=20
>>=3D=3D22324=3D=3D ERROR SUMMARY: 2 errors from 2 contexts (suppressed: 39 f=
>>rom 2)
>>=3D=3D22324=3D=3D malloc/free: in use at exit: 12691882 bytes in 6426 block=
>>s.
>>=3D=3D22324=3D=3D malloc/free: 32534 allocs, 26108 frees, 33105500 bytes al=
>>located.
>>=3D=3D22324=3D=3D For a detailed leak analysis,  rerun with: --leak-check=
>>=3Dyes
>>=3D=3D22324=3D=3D For counts of detected errors, rerun with: -v
>>linux$ exit
>>
>>Script done on Mon 01 Aug 2005 02:10:42 PM PDT
>>---------- end of script ----------
>>--=20
>>Charles Geyer
>>Professor, School of Statistics
>>University of Minnesota
>>charlie at stat.umn.edu
>>
>>______________________________________________
>>R-devel at r-project.org mailing list
>>https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
> 
>


From murdoch at stats.uwo.ca  Tue Aug  2 13:50:59 2005
From: murdoch at stats.uwo.ca (murdoch@stats.uwo.ca)
Date: Tue,  2 Aug 2005 13:50:59 +0200 (CEST)
Subject: [Rd] valgrind complains about regex.c (PR#8043)
Message-ID: <20050802115059.B324710DE5@slim.kubism.ku.dk>

Prof Brian Ripley wrote:
> Did you compile R without optimization?  Such reads are often the result 
> of read-aheads produced by the optimizer in an attempt to keep 
> pipelines full (and are harmless).

There were both a read and a write.  I can see the read being harmless, 
but is the write harmless?  I suspect this may be the bug I fixed on 
July 16, since it had to do with character classes including ranges 
(like Charlie's "[a-pr-z]").

Charlie, have you tried a recent version of R-patched?

Duncan Murdoch

> 
> On an un-optimized build of R I am unable to reproduce this.  (I also was 
> unable to reproduce it on my optimized build of 2.1.1 using gcc 3.4.4, 
> although I did get a report on other read-aheads.)
> 
> On Mon, 1 Aug 2005 charlie at stat.umn.edu wrote:
> 
> 
>>I think I am using objects according to the man page.
>>This seems to be a valid regular expression.  But whether
>>I know what I'm doing or no, it still shouldn't be doing
>>what valgrind seems to be saying it's doing.  (IMHO)
> 
> 
> I think you need to take that up with compiler designers: it is common 
> practice.
> 
> 
>>---------- start of script ----------
>>Script started on Mon 01 Aug 2005 02:09:00 PM PDT
>>linux$ printenv VALGRIND_OPTS
>>--tool=3Dmemcheck
>>linux$ cat bar.R
>>
>>foo <- 1
>>bar <- 2:3
>>baz <- 4:6
>>qux <- matrix(7:10, 2)
>>
>>ls()
>>rm(list =3D objects(pattern =3D "^[a-pr-z]"))
>>ls()
>>
>>linux$ R --version
>>R 2.1.1 (2005-06-20).
>>Copyright (C) 2005 R Development Core Team
>>
>>R is free software and comes with ABSOLUTELY NO WARRANTY.
>>You are welcome to redistribute it under the terms of the GNU
>>General Public License.  For more information about these matters,
>>see http://www.gnu.org/copyleft/gpl.html.
>>linux$ gcc --version
>>=1B[0mgcc (GCC) 3.3.5 20050117 (prerelease) (SUSE Linux)
>>=1B[0mCopyright (C) 2003 Free Software Foundation, Inc.
>>=1B[0mThis is free software; see the source for copying conditions.  There =
>>is NO
>>=1B[0mwarranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PU=
>>RPOSE.
>>=1B[0m
>>linux$ cat /etc/SuSE-release=20
>>SuSE Linux 9.3 (i586)
>>VERSION =3D 9.3
>>linux$ R --vanilla --debugger=3Dvalgrind < bar.R >| bar.Rout
>>=3D=3D22324=3D=3D Memcheck, a memory error detector for x86-linux.
>>=3D=3D22324=3D=3D Copyright (C) 2002-2004, and GNU GPL'd, by Julian Seward =
>>et al.
>>=3D=3D22324=3D=3D Using valgrind-2.2.0, a program supervision framework for=
>>x86-linux.
>>=3D=3D22324=3D=3D Copyright (C) 2000-2004, and GNU GPL'd, by Julian Seward =
>>et al.
>>=3D=3D22324=3D=3D For more details, rerun with: -v
>>=3D=3D22324=3D=3D=20
>>=3D=3D22324=3D=3D Invalid read of size 4
>>=3D=3D22324=3D=3D    at 0x81255AD: parse_expression (regex.c:5045)
>>=3D=3D22324=3D=3D    by 0x8125868: parse_branch (regex.c:4475)
>>=3D=3D22324=3D=3D    by 0x8125913: parse_reg_exp (regex.c:4420)
>>=3D=3D22324=3D=3D    by 0x81261B3: Rf_regcomp (regex.c:4384)
>>=3D=3D22324=3D=3D  Address 0x1C1E23A8 is 0 bytes after a block of size 32 a=
>>lloc'd
>>=3D=3D22324=3D=3D    at 0x1B90650D: calloc (in /usr/lib/valgrind/vgpreload_=
>>memcheck.so)
>>=3D=3D22324=3D=3D    by 0x81247B5: parse_expression (regex.c:5406)
>>=3D=3D22324=3D=3D    by 0x8125868: parse_branch (regex.c:4475)
>>=3D=3D22324=3D=3D    by 0x8125913: parse_reg_exp (regex.c:4420)
>>=3D=3D22324=3D=3D=20
>>=3D=3D22324=3D=3D Invalid write of size 4
>>=3D=3D22324=3D=3D    at 0x81255B2: parse_expression (regex.c:5045)
>>=3D=3D22324=3D=3D    by 0x8125868: parse_branch (regex.c:4475)
>>=3D=3D22324=3D=3D    by 0x8125913: parse_reg_exp (regex.c:4420)
>>=3D=3D22324=3D=3D    by 0x81261B3: Rf_regcomp (regex.c:4384)
>>=3D=3D22324=3D=3D  Address 0x1C1E23A8 is 0 bytes after a block of size 32 a=
>>lloc'd
>>=3D=3D22324=3D=3D    at 0x1B90650D: calloc (in /usr/lib/valgrind/vgpreload_=
>>memcheck.so)
>>=3D=3D22324=3D=3D    by 0x81247B5: parse_expression (regex.c:5406)
>>=3D=3D22324=3D=3D    by 0x8125868: parse_branch (regex.c:4475)
>>=3D=3D22324=3D=3D    by 0x8125913: parse_reg_exp (regex.c:4420)
>>=3D=3D22324=3D=3D=20
>>=3D=3D22324=3D=3D ERROR SUMMARY: 2 errors from 2 contexts (suppressed: 39 f=
>>rom 2)
>>=3D=3D22324=3D=3D malloc/free: in use at exit: 12691882 bytes in 6426 block=
>>s.
>>=3D=3D22324=3D=3D malloc/free: 32534 allocs, 26108 frees, 33105500 bytes al=
>>located.
>>=3D=3D22324=3D=3D For a detailed leak analysis,  rerun with: --leak-check=
>>=3Dyes
>>=3D=3D22324=3D=3D For counts of detected errors, rerun with: -v
>>linux$ exit
>>
>>Script done on Mon 01 Aug 2005 02:10:42 PM PDT
>>---------- end of script ----------
>>--=20
>>Charles Geyer
>>Professor, School of Statistics
>>University of Minnesota
>>charlie at stat.umn.edu
>>
>>______________________________________________
>>R-devel at r-project.org mailing list
>>https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
> 
>


From ripley at stats.ox.ac.uk  Tue Aug  2 14:22:50 2005
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 2 Aug 2005 13:22:50 +0100 (BST)
Subject: [Rd] valgrind complains about regex.c (PR#8043)
In-Reply-To: <42EF5E1E.30105@stats.uwo.ca>
References: <20050801212527.C2689A75B@slim.kubism.ku.dk>
	<Pine.LNX.4.61.0508020704180.19394@gannet.stats>
	<42EF5E1E.30105@stats.uwo.ca>
Message-ID: <Pine.LNX.4.61.0508021315010.31827@gannet.stats>

Yes, optimization sometimes results in writes that are apparently 
harmless and go away if optimization is removed.

It could be the bug you found (and glibc-2.3.5 had fixed) but it isn't in 
exactly the right place.  But then, valgrind on my system does not have a 
problem with that one, optimized or not.

On Tue, 2 Aug 2005, Duncan Murdoch wrote:

> Prof Brian Ripley wrote:
>> Did you compile R without optimization?  Such reads are often the result of 
>> read-aheads produced by the optimizer in an attempt to keep pipelines full 
>> (and are harmless).
>
> There were both a read and a write.  I can see the read being harmless, but 
> is the write harmless?  I suspect this may be the bug I fixed on July 16, 
> since it had to do with character classes including ranges (like Charlie's 
> "[a-pr-z]").
>
> Charlie, have you tried a recent version of R-patched?
>
> Duncan Murdoch
>
>> 
>> On an un-optimized build of R I am unable to reproduce this.  (I also was 
>> unable to reproduce it on my optimized build of 2.1.1 using gcc 3.4.4, 
>> although I did get a report on other read-aheads.)
>> 
>> On Mon, 1 Aug 2005 charlie at stat.umn.edu wrote:
>> 
>> 
>>> I think I am using objects according to the man page.
>>> This seems to be a valid regular expression.  But whether
>>> I know what I'm doing or no, it still shouldn't be doing
>>> what valgrind seems to be saying it's doing.  (IMHO)
>> 
>> 
>> I think you need to take that up with compiler designers: it is common 
>> practice.
>> 
>> 
>>> ---------- start of script ----------
>>> Script started on Mon 01 Aug 2005 02:09:00 PM PDT
>>> linux$ printenv VALGRIND_OPTS
>>> --tool=3Dmemcheck
>>> linux$ cat bar.R
>>> 
>>> foo <- 1
>>> bar <- 2:3
>>> baz <- 4:6
>>> qux <- matrix(7:10, 2)
>>> 
>>> ls()
>>> rm(list =3D objects(pattern =3D "^[a-pr-z]"))
>>> ls()
>>> 
>>> linux$ R --version
>>> R 2.1.1 (2005-06-20).
>>> Copyright (C) 2005 R Development Core Team
>>> 
>>> R is free software and comes with ABSOLUTELY NO WARRANTY.
>>> You are welcome to redistribute it under the terms of the GNU
>>> General Public License.  For more information about these matters,
>>> see http://www.gnu.org/copyleft/gpl.html.
>>> linux$ gcc --version
>>> =1B[0mgcc (GCC) 3.3.5 20050117 (prerelease) (SUSE Linux)
>>> =1B[0mCopyright (C) 2003 Free Software Foundation, Inc.
>>> =1B[0mThis is free software; see the source for copying conditions.  There 
>>> =
>>> is NO
>>> =1B[0mwarranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR 
>>> PU=
>>> RPOSE.
>>> =1B[0m
>>> linux$ cat /etc/SuSE-release=20
>>> SuSE Linux 9.3 (i586)
>>> VERSION =3D 9.3
>>> linux$ R --vanilla --debugger=3Dvalgrind < bar.R >| bar.Rout
>>> =3D=3D22324=3D=3D Memcheck, a memory error detector for x86-linux.
>>> =3D=3D22324=3D=3D Copyright (C) 2002-2004, and GNU GPL'd, by Julian Seward 
>>> =
>>> et al.
>>> =3D=3D22324=3D=3D Using valgrind-2.2.0, a program supervision framework 
>>> for=
>>> x86-linux.
>>> =3D=3D22324=3D=3D Copyright (C) 2000-2004, and GNU GPL'd, by Julian Seward 
>>> =
>>> et al.
>>> =3D=3D22324=3D=3D For more details, rerun with: -v
>>> =3D=3D22324=3D=3D=20
>>> =3D=3D22324=3D=3D Invalid read of size 4
>>> =3D=3D22324=3D=3D    at 0x81255AD: parse_expression (regex.c:5045)
>>> =3D=3D22324=3D=3D    by 0x8125868: parse_branch (regex.c:4475)
>>> =3D=3D22324=3D=3D    by 0x8125913: parse_reg_exp (regex.c:4420)
>>> =3D=3D22324=3D=3D    by 0x81261B3: Rf_regcomp (regex.c:4384)
>>> =3D=3D22324=3D=3D  Address 0x1C1E23A8 is 0 bytes after a block of size 32 
>>> a=
>>> lloc'd
>>> =3D=3D22324=3D=3D    at 0x1B90650D: calloc (in 
>>> /usr/lib/valgrind/vgpreload_=
>>> memcheck.so)
>>> =3D=3D22324=3D=3D    by 0x81247B5: parse_expression (regex.c:5406)
>>> =3D=3D22324=3D=3D    by 0x8125868: parse_branch (regex.c:4475)
>>> =3D=3D22324=3D=3D    by 0x8125913: parse_reg_exp (regex.c:4420)
>>> =3D=3D22324=3D=3D=20
>>> =3D=3D22324=3D=3D Invalid write of size 4
>>> =3D=3D22324=3D=3D    at 0x81255B2: parse_expression (regex.c:5045)
>>> =3D=3D22324=3D=3D    by 0x8125868: parse_branch (regex.c:4475)
>>> =3D=3D22324=3D=3D    by 0x8125913: parse_reg_exp (regex.c:4420)
>>> =3D=3D22324=3D=3D    by 0x81261B3: Rf_regcomp (regex.c:4384)
>>> =3D=3D22324=3D=3D  Address 0x1C1E23A8 is 0 bytes after a block of size 32 
>>> a=
>>> lloc'd
>>> =3D=3D22324=3D=3D    at 0x1B90650D: calloc (in 
>>> /usr/lib/valgrind/vgpreload_=
>>> memcheck.so)
>>> =3D=3D22324=3D=3D    by 0x81247B5: parse_expression (regex.c:5406)
>>> =3D=3D22324=3D=3D    by 0x8125868: parse_branch (regex.c:4475)
>>> =3D=3D22324=3D=3D    by 0x8125913: parse_reg_exp (regex.c:4420)
>>> =3D=3D22324=3D=3D=20
>>> =3D=3D22324=3D=3D ERROR SUMMARY: 2 errors from 2 contexts (suppressed: 39 
>>> f=
>>> rom 2)
>>> =3D=3D22324=3D=3D malloc/free: in use at exit: 12691882 bytes in 6426 
>>> block=
>>> s.
>>> =3D=3D22324=3D=3D malloc/free: 32534 allocs, 26108 frees, 33105500 bytes 
>>> al=
>>> located.
>>> =3D=3D22324=3D=3D For a detailed leak analysis,  rerun with: --leak-check=
>>> =3Dyes
>>> =3D=3D22324=3D=3D For counts of detected errors, rerun with: -v
>>> linux$ exit
>>> 
>>> Script done on Mon 01 Aug 2005 02:10:42 PM PDT
>>> ---------- end of script ----------
>>> --=20
>>> Charles Geyer
>>> Professor, School of Statistics
>>> University of Minnesota
>>> charlie at stat.umn.edu
>>> 
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>> 
>>> 
>> 
>> 
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From charlie at stat.umn.edu  Wed Aug  3 01:34:36 2005
From: charlie at stat.umn.edu (Charles Geyer)
Date: Tue, 2 Aug 2005 18:34:36 -0500
Subject: [Rd] valgrind complains about regex.c (PR#8043)
In-Reply-To: <42EF5E1E.30105@stats.uwo.ca>
References: <20050801212527.C2689A75B@slim.kubism.ku.dk>
	<Pine.LNX.4.61.0508020704180.19394@gannet.stats>
	<42EF5E1E.30105@stats.uwo.ca>
Message-ID: <20050802233436.GC5604@stat.umn.edu>

On Tue, Aug 02, 2005 at 07:50:54AM -0400, Duncan Murdoch wrote:
> Prof Brian Ripley wrote:
> >Did you compile R without optimization?  Such reads are often the result 
> >of read-aheads produced by the optimizer in an attempt to keep 
> >pipelines full (and are harmless).
> 
> There were both a read and a write.  I can see the read being harmless, 
> but is the write harmless?  I suspect this may be the bug I fixed on 
> July 16, since it had to do with character classes including ranges 
> (like Charlie's "[a-pr-z]").
> 
> Charlie, have you tried a recent version of R-patched?

No.  And I can't do it right away.  I'm packing up to move back to
Minneapolis after my sabbatical year in Seattle.  Maybe in a few days.
Sorry to not be more helpful.  Maybe I'll try it on the plane if I can.

> Duncan Murdoch
> 
> >
> >On an un-optimized build of R I am unable to reproduce this.  (I also was 
> >unable to reproduce it on my optimized build of 2.1.1 using gcc 3.4.4, 
> >although I did get a report on other read-aheads.)
> >
> >On Mon, 1 Aug 2005 charlie at stat.umn.edu wrote:
> >
> >
> >>I think I am using objects according to the man page.
> >>This seems to be a valid regular expression.  But whether
> >>I know what I'm doing or no, it still shouldn't be doing
> >>what valgrind seems to be saying it's doing.  (IMHO)
> >
> >
> >I think you need to take that up with compiler designers: it is common 
> >practice.
> >
> >
> >>---------- start of script ----------
> >>Script started on Mon 01 Aug 2005 02:09:00 PM PDT
> >>linux$ printenv VALGRIND_OPTS
> >>--tool=3Dmemcheck
> >>linux$ cat bar.R
> >>
> >>foo <- 1
> >>bar <- 2:3
> >>baz <- 4:6
> >>qux <- matrix(7:10, 2)
> >>
> >>ls()
> >>rm(list =3D objects(pattern =3D "^[a-pr-z]"))
> >>ls()
> >>
> >>linux$ R --version
> >>R 2.1.1 (2005-06-20).
> >>Copyright (C) 2005 R Development Core Team
> >>
> >>R is free software and comes with ABSOLUTELY NO WARRANTY.
> >>You are welcome to redistribute it under the terms of the GNU
> >>General Public License.  For more information about these matters,
> >>see http://www.gnu.org/copyleft/gpl.html.
> >>linux$ gcc --version
> >>=1B[0mgcc (GCC) 3.3.5 20050117 (prerelease) (SUSE Linux)
> >>=1B[0mCopyright (C) 2003 Free Software Foundation, Inc.
> >>=1B[0mThis is free software; see the source for copying conditions.  
> >>There =
> >>is NO
> >>=1B[0mwarranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR 
> >>PU=
> >>RPOSE.
> >>=1B[0m
> >>linux$ cat /etc/SuSE-release=20
> >>SuSE Linux 9.3 (i586)
> >>VERSION =3D 9.3
> >>linux$ R --vanilla --debugger=3Dvalgrind < bar.R >| bar.Rout
> >>=3D=3D22324=3D=3D Memcheck, a memory error detector for x86-linux.
> >>=3D=3D22324=3D=3D Copyright (C) 2002-2004, and GNU GPL'd, by Julian 
> >>Seward =
> >>et al.
> >>=3D=3D22324=3D=3D Using valgrind-2.2.0, a program supervision framework 
> >>for=
> >>x86-linux.
> >>=3D=3D22324=3D=3D Copyright (C) 2000-2004, and GNU GPL'd, by Julian 
> >>Seward =
> >>et al.
> >>=3D=3D22324=3D=3D For more details, rerun with: -v
> >>=3D=3D22324=3D=3D=20
> >>=3D=3D22324=3D=3D Invalid read of size 4
> >>=3D=3D22324=3D=3D    at 0x81255AD: parse_expression (regex.c:5045)
> >>=3D=3D22324=3D=3D    by 0x8125868: parse_branch (regex.c:4475)
> >>=3D=3D22324=3D=3D    by 0x8125913: parse_reg_exp (regex.c:4420)
> >>=3D=3D22324=3D=3D    by 0x81261B3: Rf_regcomp (regex.c:4384)
> >>=3D=3D22324=3D=3D  Address 0x1C1E23A8 is 0 bytes after a block of size 32 
> >>a=
> >>lloc'd
> >>=3D=3D22324=3D=3D    at 0x1B90650D: calloc (in 
> >>/usr/lib/valgrind/vgpreload_=
> >>memcheck.so)
> >>=3D=3D22324=3D=3D    by 0x81247B5: parse_expression (regex.c:5406)
> >>=3D=3D22324=3D=3D    by 0x8125868: parse_branch (regex.c:4475)
> >>=3D=3D22324=3D=3D    by 0x8125913: parse_reg_exp (regex.c:4420)
> >>=3D=3D22324=3D=3D=20
> >>=3D=3D22324=3D=3D Invalid write of size 4
> >>=3D=3D22324=3D=3D    at 0x81255B2: parse_expression (regex.c:5045)
> >>=3D=3D22324=3D=3D    by 0x8125868: parse_branch (regex.c:4475)
> >>=3D=3D22324=3D=3D    by 0x8125913: parse_reg_exp (regex.c:4420)
> >>=3D=3D22324=3D=3D    by 0x81261B3: Rf_regcomp (regex.c:4384)
> >>=3D=3D22324=3D=3D  Address 0x1C1E23A8 is 0 bytes after a block of size 32 
> >>a=
> >>lloc'd
> >>=3D=3D22324=3D=3D    at 0x1B90650D: calloc (in 
> >>/usr/lib/valgrind/vgpreload_=
> >>memcheck.so)
> >>=3D=3D22324=3D=3D    by 0x81247B5: parse_expression (regex.c:5406)
> >>=3D=3D22324=3D=3D    by 0x8125868: parse_branch (regex.c:4475)
> >>=3D=3D22324=3D=3D    by 0x8125913: parse_reg_exp (regex.c:4420)
> >>=3D=3D22324=3D=3D=20
> >>=3D=3D22324=3D=3D ERROR SUMMARY: 2 errors from 2 contexts (suppressed: 39 
> >>f=
> >>rom 2)
> >>=3D=3D22324=3D=3D malloc/free: in use at exit: 12691882 bytes in 6426 
> >>block=
> >>s.
> >>=3D=3D22324=3D=3D malloc/free: 32534 allocs, 26108 frees, 33105500 bytes 
> >>al=
> >>located.
> >>=3D=3D22324=3D=3D For a detailed leak analysis,  rerun with: --leak-check=
> >>=3Dyes
> >>=3D=3D22324=3D=3D For counts of detected errors, rerun with: -v
> >>linux$ exit
> >>
> >>Script done on Mon 01 Aug 2005 02:10:42 PM PDT
> >>---------- end of script ----------
> >>--=20
> >>Charles Geyer
> >>Professor, School of Statistics
> >>University of Minnesota
> >>charlie at stat.umn.edu
> >>
> >>______________________________________________
> >>R-devel at r-project.org mailing list
> >>https://stat.ethz.ch/mailman/listinfo/r-devel
> >>
> >>
> >
> >

-- 
Charles Geyer
Professor, School of Statistics
University of Minnesota
charlie at stat.umn.edu


From charlie at stat.umn.edu  Wed Aug  3 01:34:56 2005
From: charlie at stat.umn.edu (charlie@stat.umn.edu)
Date: Wed,  3 Aug 2005 01:34:56 +0200 (CEST)
Subject: [Rd] valgrind complains about regex.c (PR#8043)
Message-ID: <20050802233456.31AE310DD6@slim.kubism.ku.dk>

On Tue, Aug 02, 2005 at 07:50:54AM -0400, Duncan Murdoch wrote:
> Prof Brian Ripley wrote:
> >Did you compile R without optimization?  Such reads are often the result 
> >of read-aheads produced by the optimizer in an attempt to keep 
> >pipelines full (and are harmless).
> 
> There were both a read and a write.  I can see the read being harmless, 
> but is the write harmless?  I suspect this may be the bug I fixed on 
> July 16, since it had to do with character classes including ranges 
> (like Charlie's "[a-pr-z]").
> 
> Charlie, have you tried a recent version of R-patched?

No.  And I can't do it right away.  I'm packing up to move back to
Minneapolis after my sabbatical year in Seattle.  Maybe in a few days.
Sorry to not be more helpful.  Maybe I'll try it on the plane if I can.

> Duncan Murdoch
> 
> >
> >On an un-optimized build of R I am unable to reproduce this.  (I also was 
> >unable to reproduce it on my optimized build of 2.1.1 using gcc 3.4.4, 
> >although I did get a report on other read-aheads.)
> >
> >On Mon, 1 Aug 2005 charlie at stat.umn.edu wrote:
> >
> >
> >>I think I am using objects according to the man page.
> >>This seems to be a valid regular expression.  But whether
> >>I know what I'm doing or no, it still shouldn't be doing
> >>what valgrind seems to be saying it's doing.  (IMHO)
> >
> >
> >I think you need to take that up with compiler designers: it is common 
> >practice.
> >
> >
> >>---------- start of script ----------
> >>Script started on Mon 01 Aug 2005 02:09:00 PM PDT
> >>linux$ printenv VALGRIND_OPTS
> >>--tool=3Dmemcheck
> >>linux$ cat bar.R
> >>
> >>foo <- 1
> >>bar <- 2:3
> >>baz <- 4:6
> >>qux <- matrix(7:10, 2)
> >>
> >>ls()
> >>rm(list =3D objects(pattern =3D "^[a-pr-z]"))
> >>ls()
> >>
> >>linux$ R --version
> >>R 2.1.1 (2005-06-20).
> >>Copyright (C) 2005 R Development Core Team
> >>
> >>R is free software and comes with ABSOLUTELY NO WARRANTY.
> >>You are welcome to redistribute it under the terms of the GNU
> >>General Public License.  For more information about these matters,
> >>see http://www.gnu.org/copyleft/gpl.html.
> >>linux$ gcc --version
> >>=1B[0mgcc (GCC) 3.3.5 20050117 (prerelease) (SUSE Linux)
> >>=1B[0mCopyright (C) 2003 Free Software Foundation, Inc.
> >>=1B[0mThis is free software; see the source for copying conditions.  
> >>There =
> >>is NO
> >>=1B[0mwarranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR 
> >>PU=
> >>RPOSE.
> >>=1B[0m
> >>linux$ cat /etc/SuSE-release=20
> >>SuSE Linux 9.3 (i586)
> >>VERSION =3D 9.3
> >>linux$ R --vanilla --debugger=3Dvalgrind < bar.R >| bar.Rout
> >>=3D=3D22324=3D=3D Memcheck, a memory error detector for x86-linux.
> >>=3D=3D22324=3D=3D Copyright (C) 2002-2004, and GNU GPL'd, by Julian 
> >>Seward =
> >>et al.
> >>=3D=3D22324=3D=3D Using valgrind-2.2.0, a program supervision framework 
> >>for=
> >>x86-linux.
> >>=3D=3D22324=3D=3D Copyright (C) 2000-2004, and GNU GPL'd, by Julian 
> >>Seward =
> >>et al.
> >>=3D=3D22324=3D=3D For more details, rerun with: -v
> >>=3D=3D22324=3D=3D=20
> >>=3D=3D22324=3D=3D Invalid read of size 4
> >>=3D=3D22324=3D=3D    at 0x81255AD: parse_expression (regex.c:5045)
> >>=3D=3D22324=3D=3D    by 0x8125868: parse_branch (regex.c:4475)
> >>=3D=3D22324=3D=3D    by 0x8125913: parse_reg_exp (regex.c:4420)
> >>=3D=3D22324=3D=3D    by 0x81261B3: Rf_regcomp (regex.c:4384)
> >>=3D=3D22324=3D=3D  Address 0x1C1E23A8 is 0 bytes after a block of size 32 
> >>a=
> >>lloc'd
> >>=3D=3D22324=3D=3D    at 0x1B90650D: calloc (in 
> >>/usr/lib/valgrind/vgpreload_=
> >>memcheck.so)
> >>=3D=3D22324=3D=3D    by 0x81247B5: parse_expression (regex.c:5406)
> >>=3D=3D22324=3D=3D    by 0x8125868: parse_branch (regex.c:4475)
> >>=3D=3D22324=3D=3D    by 0x8125913: parse_reg_exp (regex.c:4420)
> >>=3D=3D22324=3D=3D=20
> >>=3D=3D22324=3D=3D Invalid write of size 4
> >>=3D=3D22324=3D=3D    at 0x81255B2: parse_expression (regex.c:5045)
> >>=3D=3D22324=3D=3D    by 0x8125868: parse_branch (regex.c:4475)
> >>=3D=3D22324=3D=3D    by 0x8125913: parse_reg_exp (regex.c:4420)
> >>=3D=3D22324=3D=3D    by 0x81261B3: Rf_regcomp (regex.c:4384)
> >>=3D=3D22324=3D=3D  Address 0x1C1E23A8 is 0 bytes after a block of size 32 
> >>a=
> >>lloc'd
> >>=3D=3D22324=3D=3D    at 0x1B90650D: calloc (in 
> >>/usr/lib/valgrind/vgpreload_=
> >>memcheck.so)
> >>=3D=3D22324=3D=3D    by 0x81247B5: parse_expression (regex.c:5406)
> >>=3D=3D22324=3D=3D    by 0x8125868: parse_branch (regex.c:4475)
> >>=3D=3D22324=3D=3D    by 0x8125913: parse_reg_exp (regex.c:4420)
> >>=3D=3D22324=3D=3D=20
> >>=3D=3D22324=3D=3D ERROR SUMMARY: 2 errors from 2 contexts (suppressed: 39 
> >>f=
> >>rom 2)
> >>=3D=3D22324=3D=3D malloc/free: in use at exit: 12691882 bytes in 6426 
> >>block=
> >>s.
> >>=3D=3D22324=3D=3D malloc/free: 32534 allocs, 26108 frees, 33105500 bytes 
> >>al=
> >>located.
> >>=3D=3D22324=3D=3D For a detailed leak analysis,  rerun with: --leak-check=
> >>=3Dyes
> >>=3D=3D22324=3D=3D For counts of detected errors, rerun with: -v
> >>linux$ exit
> >>
> >>Script done on Mon 01 Aug 2005 02:10:42 PM PDT
> >>---------- end of script ----------
> >>--=20
> >>Charles Geyer
> >>Professor, School of Statistics
> >>University of Minnesota
> >>charlie at stat.umn.edu
> >>
> >>______________________________________________
> >>R-devel at r-project.org mailing list
> >>https://stat.ethz.ch/mailman/listinfo/r-devel
> >>
> >>
> >
> >

-- 
Charles Geyer
Professor, School of Statistics
University of Minnesota
charlie at stat.umn.edu


From charlie at stat.umn.edu  Wed Aug  3 02:03:34 2005
From: charlie at stat.umn.edu (Charles Geyer)
Date: Tue, 2 Aug 2005 19:03:34 -0500
Subject: [Rd] valgrind complains about regex.c (PR#8043)
In-Reply-To: <Pine.LNX.4.61.0508020704180.19394@gannet.stats>
References: <20050801212527.C2689A75B@slim.kubism.ku.dk>
	<Pine.LNX.4.61.0508020704180.19394@gannet.stats>
Message-ID: <20050803000334.GB6364@stat.umn.edu>

On Tue, Aug 02, 2005 at 07:13:54AM +0100, Prof Brian Ripley wrote:
> Did you compile R without optimization?  Such reads are often the result 
> of read-aheads produced by the optimizer in an attempt to keep 
> pipelines full (and are harmless).

    linux$ R CMD config CFLAGS
    -g -O2

so no.  I just took the defaults.  I'll try that too along with R-patched.

> 
> On an un-optimized build of R I am unable to reproduce this.  (I also was 
> unable to reproduce it on my optimized build of 2.1.1 using gcc 3.4.4, 
> although I did get a report on other read-aheads.)
> 
> On Mon, 1 Aug 2005 charlie at stat.umn.edu wrote:
> 
> >I think I am using objects according to the man page.
> >This seems to be a valid regular expression.  But whether
> >I know what I'm doing or no, it still shouldn't be doing
> >what valgrind seems to be saying it's doing.  (IMHO)
> 
> I think you need to take that up with compiler designers: it is common 
> practice.
> 
> >---------- start of script ----------
> >Script started on Mon 01 Aug 2005 02:09:00 PM PDT
> >linux$ printenv VALGRIND_OPTS
> >--tool=3Dmemcheck
> >linux$ cat bar.R
> >
> >foo <- 1
> >bar <- 2:3
> >baz <- 4:6
> >qux <- matrix(7:10, 2)
> >
> >ls()
> >rm(list =3D objects(pattern =3D "^[a-pr-z]"))
> >ls()
> >
> >linux$ R --version
> >R 2.1.1 (2005-06-20).
> >Copyright (C) 2005 R Development Core Team
> >
> >R is free software and comes with ABSOLUTELY NO WARRANTY.
> >You are welcome to redistribute it under the terms of the GNU
> >General Public License.  For more information about these matters,
> >see http://www.gnu.org/copyleft/gpl.html.
> >linux$ gcc --version
> >=1B[0mgcc (GCC) 3.3.5 20050117 (prerelease) (SUSE Linux)
> >=1B[0mCopyright (C) 2003 Free Software Foundation, Inc.
> >=1B[0mThis is free software; see the source for copying conditions.  There 
> >=
> >is NO
> >=1B[0mwarranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR 
> >PU=
> >RPOSE.
> >=1B[0m
> >linux$ cat /etc/SuSE-release=20
> >SuSE Linux 9.3 (i586)
> >VERSION =3D 9.3
> >linux$ R --vanilla --debugger=3Dvalgrind < bar.R >| bar.Rout
> >=3D=3D22324=3D=3D Memcheck, a memory error detector for x86-linux.
> >=3D=3D22324=3D=3D Copyright (C) 2002-2004, and GNU GPL'd, by Julian Seward 
> >=
> >et al.
> >=3D=3D22324=3D=3D Using valgrind-2.2.0, a program supervision framework 
> >for=
> >x86-linux.
> >=3D=3D22324=3D=3D Copyright (C) 2000-2004, and GNU GPL'd, by Julian Seward 
> >=
> >et al.
> >=3D=3D22324=3D=3D For more details, rerun with: -v
> >=3D=3D22324=3D=3D=20
> >=3D=3D22324=3D=3D Invalid read of size 4
> >=3D=3D22324=3D=3D    at 0x81255AD: parse_expression (regex.c:5045)
> >=3D=3D22324=3D=3D    by 0x8125868: parse_branch (regex.c:4475)
> >=3D=3D22324=3D=3D    by 0x8125913: parse_reg_exp (regex.c:4420)
> >=3D=3D22324=3D=3D    by 0x81261B3: Rf_regcomp (regex.c:4384)
> >=3D=3D22324=3D=3D  Address 0x1C1E23A8 is 0 bytes after a block of size 32 
> >a=
> >lloc'd
> >=3D=3D22324=3D=3D    at 0x1B90650D: calloc (in 
> >/usr/lib/valgrind/vgpreload_=
> >memcheck.so)
> >=3D=3D22324=3D=3D    by 0x81247B5: parse_expression (regex.c:5406)
> >=3D=3D22324=3D=3D    by 0x8125868: parse_branch (regex.c:4475)
> >=3D=3D22324=3D=3D    by 0x8125913: parse_reg_exp (regex.c:4420)
> >=3D=3D22324=3D=3D=20
> >=3D=3D22324=3D=3D Invalid write of size 4
> >=3D=3D22324=3D=3D    at 0x81255B2: parse_expression (regex.c:5045)
> >=3D=3D22324=3D=3D    by 0x8125868: parse_branch (regex.c:4475)
> >=3D=3D22324=3D=3D    by 0x8125913: parse_reg_exp (regex.c:4420)
> >=3D=3D22324=3D=3D    by 0x81261B3: Rf_regcomp (regex.c:4384)
> >=3D=3D22324=3D=3D  Address 0x1C1E23A8 is 0 bytes after a block of size 32 
> >a=
> >lloc'd
> >=3D=3D22324=3D=3D    at 0x1B90650D: calloc (in 
> >/usr/lib/valgrind/vgpreload_=
> >memcheck.so)
> >=3D=3D22324=3D=3D    by 0x81247B5: parse_expression (regex.c:5406)
> >=3D=3D22324=3D=3D    by 0x8125868: parse_branch (regex.c:4475)
> >=3D=3D22324=3D=3D    by 0x8125913: parse_reg_exp (regex.c:4420)
> >=3D=3D22324=3D=3D=20
> >=3D=3D22324=3D=3D ERROR SUMMARY: 2 errors from 2 contexts (suppressed: 39 
> >f=
> >rom 2)
> >=3D=3D22324=3D=3D malloc/free: in use at exit: 12691882 bytes in 6426 
> >block=
> >s.
> >=3D=3D22324=3D=3D malloc/free: 32534 allocs, 26108 frees, 33105500 bytes 
> >al=
> >located.
> >=3D=3D22324=3D=3D For a detailed leak analysis,  rerun with: --leak-check=
> >=3Dyes
> >=3D=3D22324=3D=3D For counts of detected errors, rerun with: -v
> >linux$ exit
> >
> >Script done on Mon 01 Aug 2005 02:10:42 PM PDT
> >---------- end of script ----------
> >--=20
> >Charles Geyer
> >Professor, School of Statistics
> >University of Minnesota
> >charlie at stat.umn.edu
> >
> >______________________________________________
> >R-devel at r-project.org mailing list
> >https://stat.ethz.ch/mailman/listinfo/r-devel
> >
> >
> 
> -- 
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-- 
Charles Geyer
Professor, School of Statistics
University of Minnesota
charlie at stat.umn.edu


From p.dalgaard at biostat.ku.dk  Wed Aug  3 02:55:53 2005
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: 03 Aug 2005 02:55:53 +0200
Subject: [Rd] Follow-Up: R on FC4
In-Reply-To: <x2slxtlcpg.fsf@turmalin.kubism.ku.dk>
References: <1122915856.23831.43.camel@gsimpson.geog.ucl.ac.uk>
	<Pine.A41.4.61b.0508011013500.226770@homer10.u.washington.edu>
	<1122919754.23831.45.camel@gsimpson.geog.ucl.ac.uk>
	<x2slxtlcpg.fsf@turmalin.kubism.ku.dk>
Message-ID: <x2slxrrg86.fsf@turmalin.kubism.ku.dk>

Peter Dalgaard <p.dalgaard at biostat.ku.dk> writes:

> Gavin Simpson <gavin.simpson at ucl.ac.uk> writes:
....
> > So far so good with FC4, gcc4, gfortran and R!
> 
> The problem affecting the Fedora Extras RPM is still there with the
> new compilers though:
> 
>  -Wp,-D_FORTIFY_SOURCE=2 
> 
> combined with -O or -O2 causes a strange printing bug:
> 
> > matrix(list(pi))
>      [,1]
> [1,]
> 
> (You don't have to use that option of course, but it suggests that not
> all is well with the optimizer. And the Fedora maintainer seem set on
> using it, which is a bit of a problem.)

I'm fairly sure by now that this is actually a bug in R, not gcc. We
have the same internal buffer structure used in EncodeReal and in
Rsprintf, and the return value of the former is buffer->data
which is reallocated by the latter.

That means that constructions of the form

pbuf = Rsprintf("%s", EncodeReal(REAL(tmp)[0], w, d, e, OutDec));

are playing with fire. There are quite a few other similar
constructions involving Encode*.

I suspect is is necessary to copy the result of
EncodeReal(REAL(tmp)[0], w, d, e, OutDec) to temp storage, or -
probably easier - use a separate buffer for Rsprintf.

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From robert.dodier at gmail.com  Wed Aug  3 04:34:07 2005
From: robert.dodier at gmail.com (Robert Dodier)
Date: Tue, 2 Aug 2005 20:34:07 -0600
Subject: [Rd] possibility of R/Maxima linking
Message-ID: <eb9c4b9a05080219344f9443ba@mail.gmail.com>

Hello,

I'm aware that recently there has been discussion of R joining forces with
an algebra system in some way. Here is my $0.02.

I suggest linking R with Maxima (http://maxima.sf.net).
Maxima is written in Lisp. Maxima objects are pretty simple.
Maxima works on expressions, and almost every expression
is a Lisp list of the form ((op) arg1 arg2 arg3 ...) which 
associates an operator and its arguments. Every kind of
operation is cast in this form -- infix, prefix, postfix, function
calls, array references, lists, and even control structures
such as if-then-else and do-loops. 

Maxima usually parses an input written in the Maxima language
(yet another Algol derivative) and then calls MEVAL,
the main evaluation function, with the Lisp representation
of the input as its argument. However, if R could construct
a suitable Lisp object, R could bypass the parsing
and just call MEVAL directly.

Although several interfaces which are based on sockets
have been created, I believe it should be possible to directly
link Maxima with R, if Maxima is compiled with a Lisp 
variety which is implemented in C. I believe direct linkage
is possible with Clisp, and maybe with GCL as well.

Whether or not this scheme works depends pretty strongly
on how much effort is needed to munge R objects into Lisp.
Maybe someone has some comments about that.

There is more that can be said but I'll let this be enough for now.

all the best,
Robert Dodier


From atp at piskorski.com  Wed Aug  3 11:38:53 2005
From: atp at piskorski.com (Andrew Piskorski)
Date: Wed, 3 Aug 2005 05:38:53 -0400
Subject: [Rd] tree/graph data structure APIs?
Message-ID: <20050803093853.GA88167@piskorski.com>

What is the best code available for simple general purpose
manipulation of tree (and/or directed graph) data structures in R?

Looking through CRAN, I see a bunch of packages for stastical
regression trees, but nothing that seems to provide an API for
manipulating tree data structures.  What I'm looking for is something
along the lines of an R version of the Tcllib ::struct::tree API
available for Tcl:

  http://wiki.tcl.tk/210
  http://tcllib.sourceforge.net/doc/struct_tree.html
  http://tcllib.sourceforge.net/doc/graph.html

Thanks!

-- 
Andrew Piskorski <atp at piskorski.com>
http://www.piskorski.com/


From ligges at statistik.uni-dortmund.de  Wed Aug  3 11:46:47 2005
From: ligges at statistik.uni-dortmund.de (Uwe Ligges)
Date: Wed, 03 Aug 2005 11:46:47 +0200
Subject: [Rd] tree/graph data structure APIs?
In-Reply-To: <20050803093853.GA88167@piskorski.com>
References: <20050803093853.GA88167@piskorski.com>
Message-ID: <42F09287.2040606@statistik.uni-dortmund.de>

Andrew Piskorski wrote:

> What is the best code available for simple general purpose
> manipulation of tree (and/or directed graph) data structures in R?
> 
> Looking through CRAN, I see a bunch of packages for stastical
> regression trees, but nothing that seems to provide an API for
> manipulating tree data structures.  What I'm looking for is something
> along the lines of an R version of the Tcllib ::struct::tree API
> available for Tcl:
> 
>   http://wiki.tcl.tk/210
>   http://tcllib.sourceforge.net/doc/struct_tree.html
>   http://tcllib.sourceforge.net/doc/graph.html
> 
> Thanks!
> 

Maybe the people working on graphical models have something you are 
looking for, see http://www.r-project.org/gR/.
Have you looked at the "dynamicGraph" package?

Uwe Ligges


From blindglobe at gmail.com  Wed Aug  3 11:48:50 2005
From: blindglobe at gmail.com (A.J. Rossini)
Date: Wed, 3 Aug 2005 11:48:50 +0200
Subject: [Rd] tree/graph data structure APIs?
In-Reply-To: <42F09287.2040606@statistik.uni-dortmund.de>
References: <20050803093853.GA88167@piskorski.com>
	<42F09287.2040606@statistik.uni-dortmund.de>
Message-ID: <1abe3fa9050803024831041f5a@mail.gmail.com>

On 8/3/05, Uwe Ligges <ligges at statistik.uni-dortmund.de> wrote:
> Andrew Piskorski wrote:
> 
> > What is the best code available for simple general purpose
> > manipulation of tree (and/or directed graph) data structures in R?
> >
> > Looking through CRAN, I see a bunch of packages for stastical
> > regression trees, but nothing that seems to provide an API for
> > manipulating tree data structures.  What I'm looking for is something
> > along the lines of an R version of the Tcllib ::struct::tree API
> > available for Tcl:
> >
> >   http://wiki.tcl.tk/210
> >   http://tcllib.sourceforge.net/doc/struct_tree.html
> >   http://tcllib.sourceforge.net/doc/graph.html
> >
> > Thanks!
> >
> 
> Maybe the people working on graphical models have something you are
> looking for, see http://www.r-project.org/gR/.
> Have you looked at the "dynamicGraph" package?
> 

might also look at the graph packages (graph, RBGL, etc) in BioConductor.

best,
-tony

"Commit early,commit often, and commit in a repository from which we can easily
roll-back your mistakes" (AJR, 4Jan05).

A.J. Rossini
blindglobe at gmail.com


From gavin.simpson at ucl.ac.uk  Wed Aug  3 17:28:17 2005
From: gavin.simpson at ucl.ac.uk (Gavin Simpson)
Date: Wed, 03 Aug 2005 16:28:17 +0100
Subject: [Rd] deparse(substitute(x)) and S3 methods
Message-ID: <1123082897.29499.10.camel@gsimpson.geog.ucl.ac.uk>

Dear List,

I have the following function:

coca <- function(x, ...)
  {
    if(is.null(class(x))) class(x) <- data.class(x)
    UseMethod("coca", x)
  }

and a default method

coca.default <- function(x, y, method = c("predictive", "symmetric"),
                         reg.method = c("simpls", "eigen"), weights =
NULL,
                         n.axes = NULL, symmetric = FALSE, ...)
  {
    ##some checking code here removed###
    nam.dat <- list(namY = deparse(substitute(y)),
                    namX = deparse(substitute(x)))
    method <- match.arg(method)
    if(method == "predictive")
      {
        reg.method <- match.arg(reg.method)
        retval <- switch(reg.method,
                         simpls = predcoca.simpls(y, x, R0 = weights,
                           n.axes = n.axes, nam.dat),
                         eigen = predcoca.eigen(y, x, R0 = weights,
                           n.axes = n.axes, nam.dat))
      } else {
        retval <- symcoca(y, x, n.axes = n.axes, R0 = weights,
                          symmetric = symmetric, nam.dat)
      }
    return(retval)
  }

My problem is with :
    nam.dat <- list(namY = deparse(substitute(y)),
                    namX = deparse(substitute(x)))

deparse(subsitute(x)) and deparse(subsitute(y)) return a textual
representation of x and y.

x and y are both data.frames. I assume this is because they are being
evaluated in coca() and passed on as something different to
coca.default.

I also have coca.formula() so I want to do method dispatch on whether x
is a formula or not, but I want to retain the ability to grab the names
of x and y as specified in the original call.

Can anyone suggest a way round this problem?

Thanks in advance,

Gavin
-- 
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
Gavin Simpson                     [T] +44 (0)20 7679 5522
ENSIS Research Fellow             [F] +44 (0)20 7679 7565
ENSIS Ltd. & ECRC                 [E] gavin.simpsonATNOSPAMucl.ac.uk
UCL Department of Geography       [W] http://www.ucl.ac.uk/~ucfagls/cv/
26 Bedford Way                    [W] http://www.ucl.ac.uk/~ucfagls/
London.  WC1H 0AP.
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%


From gavin.simpson at ucl.ac.uk  Wed Aug  3 17:56:00 2005
From: gavin.simpson at ucl.ac.uk (Gavin Simpson)
Date: Wed, 03 Aug 2005 16:56:00 +0100
Subject: [Rd] deparse(substitute(x)) and S3 methods
In-Reply-To: <1123082897.29499.10.camel@gsimpson.geog.ucl.ac.uk>
References: <1123082897.29499.10.camel@gsimpson.geog.ucl.ac.uk>
Message-ID: <1123084560.29499.23.camel@gsimpson.geog.ucl.ac.uk>

On Wed, 2005-08-03 at 16:28 +0100, Gavin Simpson wrote:
> Dear List,
> 
> I have the following function:

Thanks to Tony Plate (and his simple example - message to self: "follow
the posting guide's advice next time!!!"), I realised that deparse
(substitute( )) was taking place *after* I had modified x and y in
situations where some columns contained all zero values. Moving the
offending lines above the modifying if() statements solves the problem.

So - not a problem with method dispatch at all, except perhaps within my
brain just now...

All the best,

Gav
-- 
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
Gavin Simpson                     [T] +44 (0)20 7679 5522
ENSIS Research Fellow             [F] +44 (0)20 7679 7565
ENSIS Ltd. & ECRC                 [E] gavin.simpsonATNOSPAMucl.ac.uk
UCL Department of Geography       [W] http://www.ucl.ac.uk/~ucfagls/cv/
26 Bedford Way                    [W] http://www.ucl.ac.uk/~ucfagls/
London.  WC1H 0AP.
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%


From procedure at crtc.gc.ca  Wed Aug  3 19:07:34 2005
From: procedure at crtc.gc.ca (Procedure)
Date: Wed, 3 Aug 2005 13:07:34 -0400
Subject: [Rd] [AV-Repaired]Xhazzensgg
Message-ID: <EAA7D60B0A40D04EAF6BB6D115902D657A89EF@XCHNG2.corp.crtc.gc.ca>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20050803/913e5faa/attachment.pl

From deepayan.sarkar at gmail.com  Wed Aug  3 20:52:32 2005
From: deepayan.sarkar at gmail.com (Deepayan Sarkar)
Date: Wed, 3 Aug 2005 13:52:32 -0500
Subject: [Rd] R CMD check failing to warn when it should
Message-ID: <eb555e660508031152696cd9fd@mail.gmail.com>

Hi,

I recently made changes to lattice code which needed changes in many
man pages as well. Before I made the appropriate changes, R CMD check
was flagging most of the problems correctly, except for the man page
for tmd. I have created a toy package that shows this, available at

http://www.stat.wisc.edu/~deepayan/R/tmdprob_0.12-2.tar.gz

This passes R CMD check on R 2.1.0 and r-devel from August 1, but it
shouldn't because the code and documentation are inconsistent.

Deepayan


From charlie at stat.umn.edu  Wed Aug  3 22:08:30 2005
From: charlie at stat.umn.edu (Charles Geyer)
Date: Wed, 3 Aug 2005 15:08:30 -0500
Subject: [Rd] valgrind complains about regex.c (PR#8043)
In-Reply-To: <42EF5E1E.30105@stats.uwo.ca>
References: <20050801212527.C2689A75B@slim.kubism.ku.dk>
	<Pine.LNX.4.61.0508020704180.19394@gannet.stats>
	<42EF5E1E.30105@stats.uwo.ca>
Message-ID: <20050803200830.GB17555@stat.umn.edu>

On Tue, Aug 02, 2005 at 07:50:54AM -0400, Duncan Murdoch wrote:
> Prof Brian Ripley wrote:
> >Did you compile R without optimization?  Such reads are often the result 
> >of read-aheads produced by the optimizer in an attempt to keep 
> >pipelines full (and are harmless).
> 
> There were both a read and a write.  I can see the read being harmless, 
> but is the write harmless?  I suspect this may be the bug I fixed on 
> July 16, since it had to do with character classes including ranges 
> (like Charlie's "[a-pr-z]").
> 
> Charlie, have you tried a recent version of R-patched?

Now I have.  The computer is my laptop and not connected to the net
so I can't upload details, but R-1.2.1-patched as of yesterday does
NOT exhibit the same bug.  So I guess you are right.  Sorry for wasting
your time.  I'm still a newbie at this R stuff.  Next time I'll check
against R-*-patched before submitting a bug report.
-- 
Charles Geyer
Professor, School of Statistics
University of Minnesota
charlie at stat.umn.edu


From charlie at stat.umn.edu  Wed Aug  3 22:08:51 2005
From: charlie at stat.umn.edu (charlie@stat.umn.edu)
Date: Wed,  3 Aug 2005 22:08:51 +0200 (CEST)
Subject: [Rd] valgrind complains about regex.c (PR#8043)
Message-ID: <20050803200851.1C241A75C@slim.kubism.ku.dk>

On Tue, Aug 02, 2005 at 07:50:54AM -0400, Duncan Murdoch wrote:
> Prof Brian Ripley wrote:
> >Did you compile R without optimization?  Such reads are often the result 
> >of read-aheads produced by the optimizer in an attempt to keep 
> >pipelines full (and are harmless).
> 
> There were both a read and a write.  I can see the read being harmless, 
> but is the write harmless?  I suspect this may be the bug I fixed on 
> July 16, since it had to do with character classes including ranges 
> (like Charlie's "[a-pr-z]").
> 
> Charlie, have you tried a recent version of R-patched?

Now I have.  The computer is my laptop and not connected to the net
so I can't upload details, but R-1.2.1-patched as of yesterday does
NOT exhibit the same bug.  So I guess you are right.  Sorry for wasting
your time.  I'm still a newbie at this R stuff.  Next time I'll check
against R-*-patched before submitting a bug report.
-- 
Charles Geyer
Professor, School of Statistics
University of Minnesota
charlie at stat.umn.edu


From p.dalgaard at biostat.ku.dk  Wed Aug  3 22:25:02 2005
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: 03 Aug 2005 22:25:02 +0200
Subject: [Rd] valgrind complains about regex.c (PR#8043)
In-Reply-To: <20050803200851.1C241A75C@slim.kubism.ku.dk>
References: <20050803200851.1C241A75C@slim.kubism.ku.dk>
Message-ID: <x2r7dau5sx.fsf@turmalin.kubism.ku.dk>

charlie at stat.umn.edu writes:

> On Tue, Aug 02, 2005 at 07:50:54AM -0400, Duncan Murdoch wrote:

> > Charlie, have you tried a recent version of R-patched?
> 
> Now I have.  The computer is my laptop and not connected to the net
> so I can't upload details, but R-1.2.1-patched as of yesterday does
                                 ###############

This email has been a LONG time underway? ;-)

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From sebastiendurand at videotron.ca  Wed Aug  3 22:29:13 2005
From: sebastiendurand at videotron.ca (=?ISO-8859-1?Q?S=E9bastien_Durand?=)
Date: Wed, 3 Aug 2005 16:29:13 -0400
Subject: [Rd] call fortran in R
Message-ID: <E2197479-19D7-4C89-9E0D-DF0419209387@videotron.ca>

Hello,

I used a mac G5, R.2.1.1, and G77 3.4.4 and I would like to use and  
call a fortran subroutine.
The trouble is that it seems I am not able to correctly load the  
compiled code.

Here is what I have done:

In the terminal this how I compiled my fortran code:

         R CMD SHLIB  ~/Desktop/Fortan_kmeans/kmeans3.f

There is the wrapper I have paste inside de kmeans3.f file:

         c THIS IS THE WRAPPER
               subroutine wrapper(n, p, nran, mat, ishort, w, z,
             + ntran, istand, k1, k2, iassign, iseed)
               integer n,p,kmax
               real*8 mat(n,p),sx(kmax,p),sx2(kmax,p),vect(p),
             +     xbar(kmax,p),var(kmax,p),mean(p),coord(10)
               real*8 D1,Dref,SSE,SSEref,Dvec(kmax),w(p),SST
               real*8 CH,CHr(kmax),SSEr(kmax),temp
               integer list(n),howmany(kmax),no(n),nobest(kmax)
               integer listr(kmax,n),howmanyr(kmax,kmax),nnitr(kmax)
               integer ishort(p)
               double precision kmeans,
               external kmeans

               call kmeans(n, p, nran, mat, ishort, w,
             + ntran, istand, k1, k2, iassign, iseed)
               end
             c THIS IS THE BEGINNING OF THE ORIGINAL FORTRAN CODE
               subroutine kmeans(n, p, nran, mat, ishort, w,
             + ntran, istand, k1, k2, iassign, iseed, CHr, SSEr)
              ......

Once compiled, in R, I get the following:

 > dyn.load("/Users/sebas/Desktop/Fortan_kmeans/K-means3.so")
 > getLoadedDLLs()
                                                                         
   Filename
1                                                                        
     base
2  /Library/Frameworks/R.framework/Resources/library/grDevices/libs/ 
grDevices.so
3          /Library/Frameworks/R.framework/Resources/library/stats/ 
libs/stats.so
4      /Library/Frameworks/R.framework/Resources/library/methods/libs/ 
methods.so
5   /Users/sebas/Desktop/Fortan_kmeans/kmeans3.so

    Dynamic.Lookup
1           FALSE
2           FALSE
3           FALSE
4           FALSE
5            TRUE
 >
 > is.loaded(symbol.For("/Users/sebas/Desktop/Fortan_kmeans/ 
kmeans3.so"))
[1] FALSE
 > is.loaded(symbol.For("kmeans3"))
[1] FALSE
 > is.loaded(symbol.For("wrapper"))
[1] FALSE

Then whatever I write in .Fortran("",...), I always get :
Erreur in .Fortran("/Users/sebas/Desktop/Fortan_kmeans/kmeans3.so",... :
     the function name "Fortran" is absent of the allocation table
     (this warning was translated from french)


So if anyone got a clue, please let me know.

I would be more than happy to find and understand what I am doing wrong!

Cheers
S?bastien Durand


From roebuck at odin.mdacc.tmc.edu  Thu Aug  4 00:07:10 2005
From: roebuck at odin.mdacc.tmc.edu (Paul Roebuck)
Date: Wed, 3 Aug 2005 17:07:10 -0500 (CDT)
Subject: [Rd] call fortran in R
In-Reply-To: <E2197479-19D7-4C89-9E0D-DF0419209387@videotron.ca>
References: <E2197479-19D7-4C89-9E0D-DF0419209387@videotron.ca>
Message-ID: <Pine.OSF.4.58.0508031659140.143402@odin.mdacc.tmc.edu>

On Wed, 3 Aug 2005, =?iso-8859-1?Q?S=E9bastien_Durand_ wrote:

> I used a mac G5, R.2.1.1, and G77 3.4.4 and I would like to use and
> call a fortran subroutine.
> The trouble is that it seems I am not able to correctly load the
> compiled code.
>
> Here is what I have done:
>
> In the terminal this how I compiled my fortran code:
>
>          R CMD SHLIB  ~/Desktop/Fortan_kmeans/kmeans3.f
>
> There is the wrapper I have paste inside de kmeans3.f file:
>
>          c THIS IS THE WRAPPER
>                subroutine wrapper(n, p, nran, mat, ishort, w, z,
>              + ntran, istand, k1, k2, iassign, iseed)
>                integer n,p,kmax
>                real*8 mat(n,p),sx(kmax,p),sx2(kmax,p),vect(p),
>              +     xbar(kmax,p),var(kmax,p),mean(p),coord(10)
>                real*8 D1,Dref,SSE,SSEref,Dvec(kmax),w(p),SST
>                real*8 CH,CHr(kmax),SSEr(kmax),temp
>                integer list(n),howmany(kmax),no(n),nobest(kmax)
>                integer listr(kmax,n),howmanyr(kmax,kmax),nnitr(kmax)
>                integer ishort(p)
>                double precision kmeans,
>                external kmeans
>
>                call kmeans(n, p, nran, mat, ishort, w,
>              + ntran, istand, k1, k2, iassign, iseed)
>                end
>              c THIS IS THE BEGINNING OF THE ORIGINAL FORTRAN CODE
>                subroutine kmeans(n, p, nran, mat, ishort, w,
>              + ntran, istand, k1, k2, iassign, iseed, CHr, SSEr)
>               ......
>
> Once compiled, in R, I get the following:
>
>  > dyn.load("/Users/sebas/Desktop/Fortan_kmeans/K-means3.so")
>  > getLoadedDLLs()
>
>    Filename
> 1
>      base
> 2  /Library/Frameworks/R.framework/Resources/library/grDevices/libs/
> grDevices.so
> 3          /Library/Frameworks/R.framework/Resources/library/stats/
> libs/stats.so
> 4      /Library/Frameworks/R.framework/Resources/library/methods/libs/
> methods.so
> 5   /Users/sebas/Desktop/Fortan_kmeans/kmeans3.so
>
>     Dynamic.Lookup
> 1           FALSE
> 2           FALSE
> 3           FALSE
> 4           FALSE
> 5            TRUE
>  >
>  > is.loaded(symbol.For("/Users/sebas/Desktop/Fortan_kmeans/
> kmeans3.so"))
> [1] FALSE
>  > is.loaded(symbol.For("kmeans3"))
> [1] FALSE
>  > is.loaded(symbol.For("wrapper"))
> [1] FALSE
>
> Then whatever I write in .Fortran("",...), I always get :
> Erreur in .Fortran("/Users/sebas/Desktop/Fortan_kmeans/kmeans3.so",... :
>      the function name "Fortran" is absent of the allocation table
>      (this warning was translated from french)

Shouldn't that be .Fortran("wrapper", <arglist>) or something
to that effect? I'm surprised that a null string didn't
crash the program.

Might want to look into R's registration tables as well.
That way you might get some additional debugging help.

----------------------------------------------------------
SIGSIG -- signature too long (core dumped)


From sebastiendurand at videotron.ca  Thu Aug  4 01:51:08 2005
From: sebastiendurand at videotron.ca (Sebastien Durand)
Date: Wed, 3 Aug 2005 19:51:08 -0400
Subject: [Rd] call fortran in R
In-Reply-To: <Pine.OSF.4.58.0508031659140.143402@odin.mdacc.tmc.edu>
References: <E2197479-19D7-4C89-9E0D-DF0419209387@videotron.ca>
	<Pine.OSF.4.58.0508031659140.143402@odin.mdacc.tmc.edu>
Message-ID: <a06200700bf1705775cc6@[192.168.2.3]>

Hi Paul,

In fact, I used the three points just hide the 
long and exhaustive serie of parameters.

>From what I understood of the error warnings, my 
serie of parameters didn't even had the chance to 
be properly read and shall not be the cause of 
what we are seeing.
Even so I change the function name in 
.Fortran("name",....), I get the same error 
message.  It is like if it couldn't find the 
library I have dynamically loaded using dyn.load.
And I don't understand why, or where shall I look to fix such issue.

By the way you spoke about R's registration 
tables, could you tell me where should I look to 
find such info?

Thanks.

S?bastien

>On Wed, 3 Aug 2005, =?iso-8859-1?Q?S=E9bastien_Durand_ wrote:
>
>>  I used a mac G5, R.2.1.1, and G77 3.4.4 and I would like to use and
>>  call a fortran subroutine.
>>  The trouble is that it seems I am not able to correctly load the
>>  compiled code.
>>
>>  Here is what I have done:
>>
>>  In the terminal this how I compiled my fortran code:
>>
>>           R CMD SHLIB  ~/Desktop/Fortan_kmeans/kmeans3.f
>>
>>  There is the wrapper I have paste inside de kmeans3.f file:
>>
>>           c THIS IS THE WRAPPER
>>                 subroutine wrapper(n, p, nran, mat, ishort, w, z,
>>               + ntran, istand, k1, k2, iassign, iseed)
>>                 integer n,p,kmax
>>                 real*8 mat(n,p),sx(kmax,p),sx2(kmax,p),vect(p),
>>               +     xbar(kmax,p),var(kmax,p),mean(p),coord(10)
>>                 real*8 D1,Dref,SSE,SSEref,Dvec(kmax),w(p),SST
>>                 real*8 CH,CHr(kmax),SSEr(kmax),temp
>>                 integer list(n),howmany(kmax),no(n),nobest(kmax)
>>                 integer listr(kmax,n),howmanyr(kmax,kmax),nnitr(kmax)
>>                 integer ishort(p)
>>                 double precision kmeans,
>>                 external kmeans
>>
>>                 call kmeans(n, p, nran, mat, ishort, w,
>>               + ntran, istand, k1, k2, iassign, iseed)
>>                 end
>>               c THIS IS THE BEGINNING OF THE ORIGINAL FORTRAN CODE
>>                 subroutine kmeans(n, p, nran, mat, ishort, w,
>>               + ntran, istand, k1, k2, iassign, iseed, CHr, SSEr)
>>                ......
>>
>>  Once compiled, in R, I get the following:
>>
>>   > dyn.load("/Users/sebas/Desktop/Fortan_kmeans/K-means3.so")
>>   > getLoadedDLLs()
>>
>>     Filename
>>  1
>>       base
>>  2  /Library/Frameworks/R.framework/Resources/library/grDevices/libs/
>>  grDevices.so
>>  3          /Library/Frameworks/R.framework/Resources/library/stats/
>>  libs/stats.so
>>  4      /Library/Frameworks/R.framework/Resources/library/methods/libs/
>>  methods.so
>>  5   /Users/sebas/Desktop/Fortan_kmeans/kmeans3.so
>>
>>      Dynamic.Lookup
>>  1           FALSE
>>  2           FALSE
>>  3           FALSE
>>  4           FALSE
>>  5            TRUE
>>   >
>>   > is.loaded(symbol.For("/Users/sebas/Desktop/Fortan_kmeans/
>>  kmeans3.so"))
>>  [1] FALSE
>>   > is.loaded(symbol.For("kmeans3"))
>>  [1] FALSE
>>   > is.loaded(symbol.For("wrapper"))
>>  [1] FALSE
>>
>>  Then whatever I write in .Fortran("",...), I always get :
>>  Erreur in .Fortran("/Users/sebas/Desktop/Fortan_kmeans/kmeans3.so",... :
>>       the function name "Fortran" is absent of the allocation table
>>       (this warning was translated from french)
>
>Shouldn't that be .Fortran("wrapper", <arglist>) or something
>to that effect? I'm surprised that a null string didn't
>crash the program.
>
>Might want to look into R's registration tables as well.
>That way you might get some additional debugging help.
>
>----------------------------------------------------------
>SIGSIG -- signature too long (core dumped)
>
>______________________________________________
>R-devel at r-project.org mailing list
>https://stat.ethz.ch/mailman/listinfo/r-devel


From roebuck at odin.mdacc.tmc.edu  Thu Aug  4 07:29:03 2005
From: roebuck at odin.mdacc.tmc.edu (Paul Roebuck)
Date: Thu, 4 Aug 2005 00:29:03 -0500 (CDT)
Subject: [Rd] object.size() bug?
Message-ID: <Pine.OSF.4.58.0508040019540.201601@odin.mdacc.tmc.edu>

Can someone confirm the following as a problem:

R> setClass("Foo", representation(.handle = "externalptr"))
R> object.size(new("Foo"))
Error in object.size(new("Foo")) : object.size: unknown type 22
R> R.version.string
[1] "R version 2.1.1, 2005-06-20"

R-2.1.1/src/include/Rinternals.h
#define EXTPTRSXP   22    /* external pointer */

R-2.1.1/src/main/size.c:
objectsize(SEXP s) has no case for external pointers

----------------------------------------------------------
SIGSIG -- signature too long (core dumped)


From aleszib at gmail.com  Thu Aug  4 13:45:19 2005
From: aleszib at gmail.com (Ales Ziberna)
Date: Thu, 4 Aug 2005 13:45:19 +0200
Subject: [Rd] call fortran in R
References: <E2197479-19D7-4C89-9E0D-DF0419209387@videotron.ca><Pine.OSF.4.58.0508031659140.143402@odin.mdacc.tmc.edu>
	<a06200700bf1705775cc6@[192.168.2.3]>
Message-ID: <004f01c598e9$fee8d1c0$0100a8c0@ales>

If I understand correctly, you used
.Fortran("wrapper",....)

The problem might be that the function name ("wrapper") was changed in the 
compilation of the code! See the mail bellow for clues (a previous post on 
R-help by Duncan Murdoch)

Natalie Hawkins wrote:
> Using R 2.0.1 on Windows XP, I am getting an error
> msg:
>
> Error in .Fortran("conic", nxy = nxy, npt = npt, CP =
> cp, EP1 = ep1, EP2 = ep2,  :
>
> Fortran function name not in load table
>
> I am wondering if there is a way to see what function
> names are in the load table?  Maybe the function name
> has been altered?

You need to look at the DLL to see what name it is exporting. I believe
R would be looking for "conic_".  If your Fortran compiler doesn't
append underscores, you'll get this error.

You might want to look at this page

http://www.stats.uwo.ca/faculty/murdoch/software/compilingDLLs/index.html#badname

or this one

http://www.stats.uwo.ca/faculty/murdoch/software/compilingDLLs/fortran.html

for more help.

Duncan Murdoch


From sebastien.durand at umontreal.ca  Thu Aug  4 16:04:04 2005
From: sebastien.durand at umontreal.ca (=?ISO-8859-1?Q?S=E9bastien_Durand?=)
Date: Thu, 4 Aug 2005 10:04:04 -0400
Subject: [Rd] call fortran in R
Message-ID: <3E09512F-55AC-46B5-B333-5153FC29646C@umontreal.ca>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20050804/4cf6d767/attachment.pl

From sebastien.durand at UMontreal.CA  Thu Aug  4 16:24:25 2005
From: sebastien.durand at UMontreal.CA (=?ISO-8859-1?Q?S=E9bastien_Durand?=)
Date: Thu, 4 Aug 2005 10:24:25 -0400
Subject: [Rd] call fortran in R
Message-ID: <7516EE1A-1D64-43B1-946E-9D06FB49B094@UMontreal.CA>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20050804/2f0bd33d/attachment.pl

From murdoch at stats.uwo.ca  Thu Aug  4 16:22:42 2005
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Thu, 04 Aug 2005 10:22:42 -0400
Subject: [Rd] call fortran in R
In-Reply-To: <3E09512F-55AC-46B5-B333-5153FC29646C@umontreal.ca>
References: <3E09512F-55AC-46B5-B333-5153FC29646C@umontreal.ca>
Message-ID: <42F224B2.5070308@stats.uwo.ca>

S?bastien Durand wrote:
> Thanks for your help,
> 
> I had read those web pages already, and the post you referred to  
> already.
> 
> So I will try to give more details to what I have done till now
> 
> First I must mention again that I am using a mac under tiger.  So I  
> am using .so files.
> 
> My fortran file is called kmeans.f, and my subroutine or wrapper I  
> named  it "wrapper"
> 
> There is my first line of code
> 
>      subroutine wrapper(n, p, nran, mat, ishort, w, z, ntran, istand,  
> k1, k2, iassign, iseed)
> 
> In the terminal:
>      R CMD SHLIB  ~/Desktop/Fortan_kmeans/kmeans3.fg77
>          -fno-common  -g -O2 -c /Users/sebas/Desktop/Fortan_kmeans/ 
> kmeans3.f -o /Users/sebas/Desktop/Fortan_kmeans/kmeans3.o
>          gcc-3.3 -bundle -flat_namespace -undefined suppress -L/usr/ 
> local/lib -o
>          /Users/sebas/Desktop/Fortan_kmeans/kmeans3.so /Users/sebas/ 
> Desktop/Fortan_kmeans/kmeans3.o
>          -L/usr/local/lib/gcc/powerpc-apple-darwin6.8/3.4.2 -lg2c - 
> lSystem -framework R
> 
> The files append to compile without any warnings.
> 
> In R:
> 
>  > dyn.load("/Users/sebas/Desktop/Fortan_kmeans/kmeans3.so")
>  > getLoadedDLLs()
> 
> Filename
> base                                                                     
>             base
> grDevices /Library/Frameworks/R.framework/Resources/library/grDevices/ 
> libs/grDevices.so
> stats             /Library/Frameworks/R.framework/Resources/library/ 
> stats/libs/stats.so
> methods       /Library/Frameworks/R.framework/Resources/library/ 
> methods/libs/methods.so
> kmeans3                                   /Users/sebas/Desktop/ 
> Fortan_kmeans/kmeans3.so
>            Dynamic.Lookup
> base               FALSE
> grDevices          FALSE
> stats              FALSE
> methods            FALSE
> kmeans3             TRUE
> 
> 
> Dyn.load seems to work since if I type in getLoadedDLLs()  I can see  
> the link.
> 
>  > zozo=.Fortran(symbol.For("wrapper"),n=as.integer(n), p=as.integer 
> (p), nran=as.integer(nran), mat=as.matrix(mat), ishort=as.vector 
> (ishort), w=as.vector(w),ntran=as.integer(ntran), istand=as.integer 
> (istand), k1=as.integer(k1), k2=as.integer(k2), iassign=as.integer 
> (iassign), iseed=as.integer(iseed))
> Erreur dans .Fortran(symbol.For("wrapper"), n = as.integer(n), p =  
> as.integer(p),  :
>      nom de fonction "Fortran" absent de la table d'allocation
> 
> Even so I am using in the name parameter of the .Fortran function,  
> "wrapper", "kmeans3", "wrapper_" or "kmeans3_"
> 
> I always get the same error call telling me that the fonction  
> "Fortran" is not in the allocation table

That message could be more useful, couldn't it?

I think your problem is using symbol.For().  .Fortran uses that (or some 
internal equivalent), so it will end up being used twice, and R is 
probably looking for wrapper__, when the real name is wrapper_.

Duncan Murdoch


> 
> That is where I am at now, it has been 4 days I am digging into docs  
> but I haven't been able to find what I am doing wrong.
> 
> R is so great, I got tons of Fortran lines and subroutine to  
> implement in R but I guess I am missing a little thing to make it  
> work and now I really don't have a cue how to solve that problem.
> 
> Cheers
> 
> I will be anxiously waiting for any reply
> 
> S?bastien
> 
> 
> 
>>If I understand correctly, you used
>>.Fortran("wrapper",....)
>>
>>The problem might be that the function name ("wrapper") was changed  
>>in the
>>compilation of the code! See the mail bellow for clues (a previous  
>>post on
>>R-help by Duncan Murdoch)
>>
>>Natalie Hawkins wrote:
>>
>>>Using R 2.0.1 on Windows XP, I am getting an error
>>>msg:
>>>
>>>Error in .Fortran("conic", nxy = nxy, npt = npt, CP =
>>>cp, EP1 = ep1, EP2 = ep2,  :
>>>
>>>Fortran function name not in load table
>>>
>>>I am wondering if there is a way to see what function
>>>names are in the load table?  Maybe the function name
>>>has been altered?
>>
>>You need to look at the DLL to see what name it is exporting. I  
>>believe
>>R would be looking for "conic_".  If your Fortran compiler doesn't
>>append underscores, you'll get this error.
>>
>>You might want to look at this page
>>
>>http://www.stats.uwo.ca/faculty/murdoch/software/compilingDLLs/ 
>>index.html#badname
>>
>>or this one
>>
>>http://www.stats.uwo.ca/faculty/murdoch/software/compilingDLLs/ 
>>fortran.html
>>
>>for more help.
>>
>>Duncan Murdoch
> 
> 
> 	[[alternative HTML version deleted]]
> 
> 
> 
> ------------------------------------------------------------------------
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From murdoch at stats.uwo.ca  Thu Aug  4 16:44:07 2005
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Thu, 04 Aug 2005 10:44:07 -0400
Subject: [Rd] call fortran in R
In-Reply-To: <7516EE1A-1D64-43B1-946E-9D06FB49B094@UMontreal.CA>
References: <7516EE1A-1D64-43B1-946E-9D06FB49B094@UMontreal.CA>
Message-ID: <42F229B7.6010809@stats.uwo.ca>

S?bastien Durand wrote:
> At the beginning I was not using symbol.For(), and whatever I add a  
> "_" or not
> 
> e.g.:
> 
> .Fortran("wrapper",...
> 
> I get the same error

You could look at symbol.For("wrapper"), and see if the name it prints 
is exported from your .so.  I don't know how to see the exports of a 
.so, I use Windows.

Alternatively (and probably better overall), you could get your DLL to 
register its exports with R.  This is explained in the "Writing R 
Extensions" manual.  It should help to prevent any odd naming 
conventions of your compiler from causing trouble, and you'll only have 
to worry about odd parameter passing conventions (and how to create the 
C language registration function).

Duncan Murdoch
> 
> Sebastien
> 
> 
> 
> 
>>You want to just say:
>>
>>.Fortran("wrapper", ...
>>
>>not
>>
>>.Fortran(symbol.For("wrapper"), ...
>>
>>Patrick Burns
>>patrick at burns-stat.com
>>+44 (0)20 8525 0696
>>http://www.burns-stat.com
>>(home of S Poetry and "A Guide for the Unwilling S User")
>>
>>S?bastien Durand wrote:
>>
>>
>>
>>>Thanks for your help,
>>>
>>>I had read those web pages already, and the post you referred to   
>>>already.
>>>
>>>So I will try to give more details to what I have done till now
>>>
>>>First I must mention again that I am using a mac under tiger.  So  
>>>I  am using .so files.
>>>
>>>My fortran file is called kmeans.f, and my subroutine or wrapper  
>>>I  named  it "wrapper"
>>>
>>>There is my first line of code
>>>
>>>    subroutine wrapper(n, p, nran, mat, ishort, w, z, ntran,  
>>>istand,  k1, k2, iassign, iseed)
>>>
>>>In the terminal:
>>>    R CMD SHLIB  ~/Desktop/Fortan_kmeans/kmeans3.fg77
>>>        -fno-common  -g -O2 -c /Users/sebas/Desktop/Fortan_kmeans/  
>>>kmeans3.f -o /Users/sebas/Desktop/Fortan_kmeans/kmeans3.o
>>>        gcc-3.3 -bundle -flat_namespace -undefined suppress -L/ 
>>>usr/ local/lib -o
>>>        /Users/sebas/Desktop/Fortan_kmeans/kmeans3.so /Users/ 
>>>sebas/ Desktop/Fortan_kmeans/kmeans3.o
>>>        -L/usr/local/lib/gcc/powerpc-apple-darwin6.8/3.4.2 -lg2c -  
>>>lSystem -framework R
>>>
>>>The files append to compile without any warnings.
>>>
>>>In R:
>>>
>>>
>>>>dyn.load("/Users/sebas/Desktop/Fortan_kmeans/kmeans3.so")
>>>>getLoadedDLLs()
>>>
>>>Filename
>>>base                                                                  
>>>               base
>>>grDevices /Library/Frameworks/R.framework/Resources/library/ 
>>>grDevices/ libs/grDevices.so
>>>stats             /Library/Frameworks/R.framework/Resources/ 
>>>library/ stats/libs/stats.so
>>>methods       /Library/Frameworks/R.framework/Resources/library/  
>>>methods/libs/methods.so
>>>kmeans3                                   /Users/sebas/Desktop/  
>>>Fortan_kmeans/kmeans3.so
>>>          Dynamic.Lookup
>>>base               FALSE
>>>grDevices          FALSE
>>>stats              FALSE
>>>methods            FALSE
>>>kmeans3             TRUE
>>>
>>>
>>>Dyn.load seems to work since if I type in getLoadedDLLs()  I can  
>>>see  the link.
>>>
>>>
>>>>zozo=.Fortran(symbol.For("wrapper"),n=as.integer(n),  
>>>
>>>p=as.integer (p), nran=as.integer(nran), mat=as.matrix(mat),  
>>>ishort=as.vector (ishort), w=as.vector(w),ntran=as.integer(ntran),  
>>>istand=as.integer (istand), k1=as.integer(k1), k2=as.integer(k2),  
>>>iassign=as.integer (iassign), iseed=as.integer(iseed))
>>>Erreur dans .Fortran(symbol.For("wrapper"), n = as.integer(n), p  
>>>=  as.integer(p),  :
>>>    nom de fonction "Fortran" absent de la table d'allocation
>>>
>>>Even so I am using in the name parameter of the .Fortran  
>>>function,  "wrapper", "kmeans3", "wrapper_" or "kmeans3_"
>>>
>>>I always get the same error call telling me that the fonction   
>>>"Fortran" is not in the allocation table
>>>
>>>That is where I am at now, it has been 4 days I am digging into  
>>>docs  but I haven't been able to find what I am doing wrong.
>>>
>>>R is so great, I got tons of Fortran lines and subroutine to   
>>>implement in R but I guess I am missing a little thing to make it   
>>>work and now I really don't have a cue how to solve that problem.
>>>
>>>Cheers
>>>
>>>I will be anxiously waiting for any reply
>>>
>>>S?bastien
>>>
>>>
>>>
>>>
>>>
>>>>If I understand correctly, you used
>>>>.Fortran("wrapper",....)
>>>>
>>>>The problem might be that the function name ("wrapper") was  
>>>>changed  in the
>>>>compilation of the code! See the mail bellow for clues (a  
>>>>previous  post on
>>>>R-help by Duncan Murdoch)
>>>>
>>>>Natalie Hawkins wrote:
>>>>
>>>>
>>>>
>>>>>Using R 2.0.1 on Windows XP, I am getting an error
>>>>>msg:
>>>>>
>>>>>Error in .Fortran("conic", nxy = nxy, npt = npt, CP =
>>>>>cp, EP1 = ep1, EP2 = ep2,  :
>>>>>
>>>>>Fortran function name not in load table
>>>>>
>>>>>I am wondering if there is a way to see what function
>>>>>names are in the load table?  Maybe the function name
>>>>>has been altered?
>>>>>
>>>>>
>>>>
>>>>You need to look at the DLL to see what name it is exporting. I   
>>>>believe
>>>>R would be looking for "conic_".  If your Fortran compiler doesn't
>>>>append underscores, you'll get this error.
>>>>
>>>>You might want to look at this page
>>>>
>>>>http://www.stats.uwo.ca/faculty/murdoch/software/compilingDLLs/  
>>>>index.html#badname
>>>>
>>>>or this one
>>>>
>>>>http://www.stats.uwo.ca/faculty/murdoch/software/compilingDLLs/  
>>>>fortran.html
>>>>
>>>>for more help.
>>>>
>>>>Duncan Murdoch
>>>>
>>>>
>>>
>>>    [[alternative HTML version deleted]]
>>>
>>>
>>>--------------------------------------------------------------------- 
>>>---
>>>
>>>______________________________________________
>>>R-devel at r-project.org mailing list
>>>https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>>
>>
>>
> 
> 	[[alternative HTML version deleted]]
> 
> 
> 
> ------------------------------------------------------------------------
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From ripley at stats.ox.ac.uk  Thu Aug  4 16:51:09 2005
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 4 Aug 2005 15:51:09 +0100 (BST)
Subject: [Rd] call fortran in R
In-Reply-To: <42F229B7.6010809@stats.uwo.ca>
References: <7516EE1A-1D64-43B1-946E-9D06FB49B094@UMontreal.CA>
	<42F229B7.6010809@stats.uwo.ca>
Message-ID: <Pine.LNX.4.61.0508041549210.8772@gannet.stats>

On Thu, 4 Aug 2005, Duncan Murdoch wrote:

> S?bastien Durand wrote:
>> At the beginning I was not using symbol.For(), and whatever I add a
>> "_" or not
>>
>> e.g.:
>>
>> .Fortran("wrapper",...
>>
>> I get the same error
>
> You could look at symbol.For("wrapper"), and see if the name it prints
> is exported from your .so.  I don't know how to see the exports of a
> .so, I use Windows.

On a Unix-alike, nm -g foo.so.  (This looks like MacOS X, although that 
was never stated.)

> Alternatively (and probably better overall), you could get your DLL to
> register its exports with R.  This is explained in the "Writing R
> Extensions" manual.  It should help to prevent any odd naming
> conventions of your compiler from causing trouble, and you'll only have
> to worry about odd parameter passing conventions (and how to create the
> C language registration function).
>
> Duncan Murdoch
>>
>> Sebastien
>>
>>
>>
>>
>>> You want to just say:
>>>
>>> .Fortran("wrapper", ...
>>>
>>> not
>>>
>>> .Fortran(symbol.For("wrapper"), ...
>>>
>>> Patrick Burns
>>> patrick at burns-stat.com
>>> +44 (0)20 8525 0696
>>> http://www.burns-stat.com
>>> (home of S Poetry and "A Guide for the Unwilling S User")
>>>
>>> S?bastien Durand wrote:
>>>
>>>
>>>
>>>> Thanks for your help,
>>>>
>>>> I had read those web pages already, and the post you referred to
>>>> already.
>>>>
>>>> So I will try to give more details to what I have done till now
>>>>
>>>> First I must mention again that I am using a mac under tiger.  So
>>>> I  am using .so files.
>>>>
>>>> My fortran file is called kmeans.f, and my subroutine or wrapper
>>>> I  named  it "wrapper"
>>>>
>>>> There is my first line of code
>>>>
>>>>    subroutine wrapper(n, p, nran, mat, ishort, w, z, ntran,
>>>> istand,  k1, k2, iassign, iseed)
>>>>
>>>> In the terminal:
>>>>    R CMD SHLIB  ~/Desktop/Fortan_kmeans/kmeans3.fg77
>>>>        -fno-common  -g -O2 -c /Users/sebas/Desktop/Fortan_kmeans/
>>>> kmeans3.f -o /Users/sebas/Desktop/Fortan_kmeans/kmeans3.o
>>>>        gcc-3.3 -bundle -flat_namespace -undefined suppress -L/
>>>> usr/ local/lib -o
>>>>        /Users/sebas/Desktop/Fortan_kmeans/kmeans3.so /Users/
>>>> sebas/ Desktop/Fortan_kmeans/kmeans3.o
>>>>        -L/usr/local/lib/gcc/powerpc-apple-darwin6.8/3.4.2 -lg2c -
>>>> lSystem -framework R
>>>>
>>>> The files append to compile without any warnings.
>>>>
>>>> In R:
>>>>
>>>>
>>>>> dyn.load("/Users/sebas/Desktop/Fortan_kmeans/kmeans3.so")
>>>>> getLoadedDLLs()
>>>>
>>>> Filename
>>>> base
>>>>               base
>>>> grDevices /Library/Frameworks/R.framework/Resources/library/
>>>> grDevices/ libs/grDevices.so
>>>> stats             /Library/Frameworks/R.framework/Resources/
>>>> library/ stats/libs/stats.so
>>>> methods       /Library/Frameworks/R.framework/Resources/library/
>>>> methods/libs/methods.so
>>>> kmeans3                                   /Users/sebas/Desktop/
>>>> Fortan_kmeans/kmeans3.so
>>>>          Dynamic.Lookup
>>>> base               FALSE
>>>> grDevices          FALSE
>>>> stats              FALSE
>>>> methods            FALSE
>>>> kmeans3             TRUE
>>>>
>>>>
>>>> Dyn.load seems to work since if I type in getLoadedDLLs()  I can
>>>> see  the link.
>>>>
>>>>
>>>>> zozo=.Fortran(symbol.For("wrapper"),n=as.integer(n),
>>>>
>>>> p=as.integer (p), nran=as.integer(nran), mat=as.matrix(mat),
>>>> ishort=as.vector (ishort), w=as.vector(w),ntran=as.integer(ntran),
>>>> istand=as.integer (istand), k1=as.integer(k1), k2=as.integer(k2),
>>>> iassign=as.integer (iassign), iseed=as.integer(iseed))
>>>> Erreur dans .Fortran(symbol.For("wrapper"), n = as.integer(n), p
>>>> =  as.integer(p),  :
>>>>    nom de fonction "Fortran" absent de la table d'allocation
>>>>
>>>> Even so I am using in the name parameter of the .Fortran
>>>> function,  "wrapper", "kmeans3", "wrapper_" or "kmeans3_"
>>>>
>>>> I always get the same error call telling me that the fonction
>>>> "Fortran" is not in the allocation table
>>>>
>>>> That is where I am at now, it has been 4 days I am digging into
>>>> docs  but I haven't been able to find what I am doing wrong.
>>>>
>>>> R is so great, I got tons of Fortran lines and subroutine to
>>>> implement in R but I guess I am missing a little thing to make it
>>>> work and now I really don't have a cue how to solve that problem.
>>>>
>>>> Cheers
>>>>
>>>> I will be anxiously waiting for any reply
>>>>
>>>> S?bastien
>>>>
>>>>
>>>>
>>>>
>>>>
>>>>> If I understand correctly, you used
>>>>> .Fortran("wrapper",....)
>>>>>
>>>>> The problem might be that the function name ("wrapper") was
>>>>> changed  in the
>>>>> compilation of the code! See the mail bellow for clues (a
>>>>> previous  post on
>>>>> R-help by Duncan Murdoch)
>>>>>
>>>>> Natalie Hawkins wrote:
>>>>>
>>>>>
>>>>>
>>>>>> Using R 2.0.1 on Windows XP, I am getting an error
>>>>>> msg:
>>>>>>
>>>>>> Error in .Fortran("conic", nxy = nxy, npt = npt, CP =
>>>>>> cp, EP1 = ep1, EP2 = ep2,  :
>>>>>>
>>>>>> Fortran function name not in load table
>>>>>>
>>>>>> I am wondering if there is a way to see what function
>>>>>> names are in the load table?  Maybe the function name
>>>>>> has been altered?
>>>>>>
>>>>>>
>>>>>
>>>>> You need to look at the DLL to see what name it is exporting. I
>>>>> believe
>>>>> R would be looking for "conic_".  If your Fortran compiler doesn't
>>>>> append underscores, you'll get this error.
>>>>>
>>>>> You might want to look at this page
>>>>>
>>>>> http://www.stats.uwo.ca/faculty/murdoch/software/compilingDLLs/
>>>>> index.html#badname
>>>>>
>>>>> or this one
>>>>>
>>>>> http://www.stats.uwo.ca/faculty/murdoch/software/compilingDLLs/
>>>>> fortran.html
>>>>>
>>>>> for more help.
>>>>>
>>>>> Duncan Murdoch
>>>>>
>>>>>
>>>>
>>>>    [[alternative HTML version deleted]]
>>>>
>>>>
>>>> ---------------------------------------------------------------------
>>>> ---
>>>>
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>
>>>>
>>>
>>>
>>
>> 	[[alternative HTML version deleted]]
>>
>>
>>
>> ------------------------------------------------------------------------
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From sebastien.durand at UMontreal.CA  Thu Aug  4 17:05:40 2005
From: sebastien.durand at UMontreal.CA (=?ISO-8859-1?Q?S=E9bastien_Durand?=)
Date: Thu, 4 Aug 2005 11:05:40 -0400
Subject: [Rd] call fortran in R
Message-ID: <CADF0312-4070-40A2-A054-F38084A20FC1@UMontreal.CA>

Ok,

Dear all,

I have state previously, I am using mac os X tiger on a g5, using the  
last version of R 2.1.1

When I type in the terminal

nm -g ~/Desktop/Fortan_kmeans/kmeans3.so
or
nm /Users/sebas/Desktop/Fortan_kmeans/kmeans3.so | grep ' T '

Nothing appears on my screen

When I type

nm  ~/Desktop/Fortan_kmeans/kmeans3.so

this is what I get:

00000fe0 t __dyld_func_lookup
00000000 t __mh_bundle_header
00001000 d dyld__mh_bundle_header
00001008 s dyld_func_lookup_pointer
00001004 s dyld_lazy_symbol_binding_entry_point
00000fb0 t dyld_stub_binding_helper


By the way, yes I have tried
     is.loaded("wrapper") ?
And is always return FALSE

S.


From sebastien.durand at UMontreal.CA  Thu Aug  4 17:25:24 2005
From: sebastien.durand at UMontreal.CA (=?ISO-8859-1?Q?S=E9bastien_Durand?=)
Date: Thu, 4 Aug 2005 11:25:24 -0400
Subject: [Rd] call fortran in R
Message-ID: <BB026B1E-17AE-42A2-B86E-6C74337202D1@UMontreal.CA>

Dear all,

Since the command you ask me to type doesn't show anything
Here some more information, on my system and on the foo.so compiled file

I am using g77 version 3.4.4  Configured with: ../gcc/configure -- 
enable-threads=posix --enable-languages=f77

I am using gcc version 4.0.0 20041026 (Apple Computer, Inc. build 4061)
         Configured with: /private/var/tmp/gcc/gcc-4061.obj~8/src/ 
configure --disable-checking --prefix=/usr --mandir=/share/man -- 
enable-languages=c,objc,c++,obj-c++ --program-transform-name=/^[cg][^ 
+.-]*$/s/$/-4.0/
         --with-gxx-include-dir=/include/gcc/darwin/4.0/c++ -- 
build=powerpc-apple-darwin8 --host=powerpc-apple-darwin8 -- 
target=powerpc-apple-darwin8

I don't know if this can be of any help to you but there is again how  
I compile the foo.f

Double-G5:~ sebas$ R CMD SHLIB  ~/Desktop/Fortan_kmeans/kmeans3.f
         g77   -fno-common  -g -O2 -c /Users/sebas/Desktop/ 
Fortan_kmeans/kmeans3.f -o /Users/sebas/Desktop/Fortan_kmeans/kmeans3.o
         gcc-3.3 -bundle -flat_namespace -undefined suppress -L/usr/ 
local/lib -o /Users/sebas/Desktop/Fortan_kmeans/kmeans3.so /Users/ 
sebas/Desktop/Fortan_kmeans/kmeans3.o  -L/usr/local/lib/gcc/powerpc- 
apple-darwin6.8/3.4.2 -lg2c -lSystem -framework R


There is all the info about the foo.so file using nm -a option  
instead of -g:


Double-G5:~ sebas$ nm -a ~/Desktop/Fortan_kmeans/kmeans3.so
00000fe4 - 01 0114 SLINE
00000fb0 - 01 0000    SO
00000fd8 - 01 010d SLINE
00000fdc - 01 010e SLINE
00000fe0 - 01 010f SLINE
00000fec - 01 0116 SLINE
00000fe8 - 01 0115 SLINE
00001000 - 01 0000    SO
00001000 - 01 011b SLINE
00000ffc - 01 011a SLINE
00000ff8 - 01 0119 SLINE
00000fb4 - 01 0104 SLINE
00000fb8 - 01 0105 SLINE
00000fbc - 01 0106 SLINE
00000fc0 - 01 0107 SLINE
00000fc4 - 01 0108 SLINE
00000ff4 - 01 0118 SLINE
00000fc8 - 01 0109 SLINE
00000fcc - 01 010a SLINE
00000fd0 - 01 010b SLINE
00000fd4 - 01 010c SLINE
00000ff0 - 01 0117 SLINE
00000fb0 - 01 0000   SOL /SourceCache/Csu/Csu-57//
00000fb0 - 01 0000   SOL /SourceCache/Csu/Csu-57/bundle1.s
00000fb0 - 01 0000   SOL /SourceCache/Csu/Csu-57/bundle1.s
00000fb0 - 01 0000   SOL /SourceCache/Csu/Csu-57/bundle1.s
00000fb0 - 01 0000    SO /Users/sebas/
00000fb0 - 01 0000    SO /Users/sebas/Desktop/Fortan_kmeans/kmeans3.f
00000fb0 - 01 0000   SOL <built-in>
00000fb0 - 01 0000   SOL <command line>
00000fe0 t __dyld_func_lookup
00000fe0 - 01 0113   FUN __dyld_func_lookup:F3
00000000 - 00 0000  LSYM __g77_f2c_address:t(0,10)=*(0,11)=@s8;r 
(0,11);-128;127;
00000000 - 00 0000  LSYM __g77_f2c_complex:t(0,7)=R3;8;0;
00000000 - 00 0000  LSYM __g77_f2c_doublecomplex:t(0,6)=R3;16;0;
00000000 - 00 0000  LSYM __g77_f2c_doublereal:t(0,8)=r(0,0);8;0;
00000000 - 00 0000  LSYM __g77_f2c_flag:t(0,3)=r 
(0,3);-2147483648;2147483647;
00000000 - 00 0000  LSYM __g77_f2c_ftnint:t(0,1)=r 
(0,1);-2147483648;2147483647;
00000000 - 00 0000  LSYM __g77_f2c_ftnlen:t(0,2)=r 
(0,2);-2147483648;2147483647;
00000000 - 00 0000  LSYM __g77_f2c_integer:t(0,12)=r 
(0,12);-2147483648;2147483647;
00000000 - 00 0000  LSYM __g77_f2c_logical:t(0,4)=r 
(0,4);-2147483648;2147483647;
00000000 - 00 0000  LSYM __g77_f2c_longint:t(0,5)=@s64;r(0,5); 
001000000000000000000000;000777777777777777777777;
00000000 - 00 0000  LSYM __g77_f2c_real:t(0,9)=r(0,0);4;0;
00000000 t __mh_bundle_header
00000000 - 00 0000  LSYM byte:t(0,26)=@s8;r(0,26);-128;127;
00000000 - 00 0000  LSYM char:t(0,46)=@s8;r(0,46);0;255;
00000000 - 00 0000  LSYM char:t2=r2;0;127;
00000000 - 00 0000  LSYM complex double:t(0,31)=R3;16;0;
00000000 - 00 0000  LSYM complex float:t(0,32)=R3;8;0;
00000000 - 00 0000  LSYM complex int:t(0,33)=s8real:(0,34)=r 
(0,34);-2147483648;2147483647;,0,32;imag:(0,34),32,32;;
00000000 - 00 0000  LSYM complex long double:t(0,30)=R3;16;0;
00000000 - 00 0000  LSYM complex:t(0,14)=R3;8;0;
00000000 - 00 0000  LSYM double complex:t(0,13)=R3;16;0;
00000000 - 00 0000  LSYM double precision:t(0,15)=r(0,0);8;0;
00000000 - 00 0000  LSYM double:t(0,36)=r(0,34);8;0;
00001000 d dyld__mh_bundle_header
00001008 s dyld_func_lookup_pointer
00001004 s dyld_lazy_symbol_binding_entry_point
00000fb0 t dyld_stub_binding_helper
00000fb0 - 01 0103   FUN dyld_stub_binding_helper:F3
00000000 - 00 0000  LSYM float:t(0,37)=r(0,34);4;0;
00000000 - 00 0000   OPT gcc2_compiled.
00000000 - 00 0000  LSYM int:t(0,34)
00000000 - 00 0000  LSYM int:t1=r1;-2147483648;2147483647;
00000000 - 00 0000  LSYM integer4:t(0,22)=@s64;r(0,22); 
001000000000000000000000;000777777777777777777777;
00000000 - 00 0000  LSYM integer:t(0,28)=r(0,28);-2147483648;2147483647;
00000000 - 00 0000  LSYM logical2:t(0,19)=@s8;r(0,19);-128;127;
00000000 - 00 0000  LSYM logical3:t(0,18)=@s16;r(0,18);-32768;32767;
00000000 - 00 0000  LSYM logical4:t(0,17)=@s64;r(0,17); 
001000000000000000000000;000777777777777777777777;
00000000 - 00 0000  LSYM logical:t(0,20)=r(0,20);-2147483648;2147483647;
00000000 - 00 0000  LSYM long double:t(0,35)=r(0,34);8;0;
00000000 - 00 0000  LSYM long int:t(0,45)=r 
(0,45);-2147483648;2147483647;
00000000 - 00 0000  LSYM long long int:t(0,42)=@s64;r(0,42); 
001000000000000000000000;000777777777777777777777;
00000000 - 00 0000  LSYM long long unsigned int:t(0,41)=@s64;r(0,41); 
000000000000000000000000;001777777777777777777777;
00000000 - 00 0000  LSYM long unsigned int:t(0,43)=r(0,43); 
000000000000000000000000;000000000000037777777777;
00000000 - 00 0000  LSYM real:t(0,16)=r(0,0);4;0;
00000000 - 00 0000  LSYM short int:t(0,40)=@s16;r(0,40);-32768;32767;
00000000 - 00 0000  LSYM short unsigned int:t(0,39)=@s16;r(0,39); 
0;65535;
00000000 - 00 0000  LSYM signed char:t(0,11)
00000000 - 00 0000  LSYM unsigned byte:t(0,25)=@s8;r(0,25);0;255;
00000000 - 00 0000  LSYM unsigned char:t(0,38)=@s8;r(0,38);0;255;
00000000 - 00 0000  LSYM unsigned int:t(0,44)=r(0,44); 
000000000000000000000000;000000000000037777777777;
00000000 - 00 0000  LSYM unsigned word:t(0,23)=@s16;r(0,23);0;65535;
00000000 - 00 0000  LSYM unsigned4:t(0,21)=@s64;r(0,21); 
000000000000000000000000;001777777777777777777777;
00000000 - 00 0000  LSYM unsigned:t(0,27)=r(0,27); 
000000000000000000000000;000000000000037777777777;
00000000 - 00 0000  LSYM void:t(0,29)=(0,29)
00000000 - 00 0000  LSYM void:t3=3
00000000 - 00 0000  LSYM word:t(0,24)=@s16;r(0,24);-32768;32767;
00000fb0 - 01 0000    SO {standard input}
Double-G5:~ sebas$

S.


From jeff.horner at vanderbilt.edu  Thu Aug  4 17:23:24 2005
From: jeff.horner at vanderbilt.edu (Jeffrey Horner)
Date: Thu, 04 Aug 2005 10:23:24 -0500
Subject: [Rd] call fortran in R
In-Reply-To: <CADF0312-4070-40A2-A054-F38084A20FC1@UMontreal.CA>
References: <CADF0312-4070-40A2-A054-F38084A20FC1@UMontreal.CA>
Message-ID: <42F232EC.7080802@vanderbilt.edu>

S?bastien Durand wrote:
> Ok,
> 
> Dear all,
> 
> I have state previously, I am using mac os X tiger on a g5, using the  
> last version of R 2.1.1

Well, to Prof. Ripley's point, you never stated that you were running OS 
X, just a mac G5. Linux also runs on a G5.

Learn much, you will, from Master Ripley...

-- 
Jeffrey Horner       Computer Systems Analyst         School of Medicine
615-322-8606         Department of Biostatistics   Vanderbilt University


From ripley at stats.ox.ac.uk  Thu Aug  4 17:30:16 2005
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 4 Aug 2005 16:30:16 +0100 (BST)
Subject: [Rd] call fortran in R
In-Reply-To: <CADF0312-4070-40A2-A054-F38084A20FC1@UMontreal.CA>
References: <CADF0312-4070-40A2-A054-F38084A20FC1@UMontreal.CA>
Message-ID: <Pine.LNX.4.61.0508041629020.9820@gannet.stats>

So the problem IS that your symbol is not exported by your shared object, 
and you need advice on the tools you are using (not R).

On Thu, 4 Aug 2005, S?bastien Durand wrote:

> Ok,
>
> Dear all,
>
> I have state previously, I am using mac os X tiger on a g5, using the
> last version of R 2.1.1
>
> When I type in the terminal
>
> nm -g ~/Desktop/Fortan_kmeans/kmeans3.so
> or
> nm /Users/sebas/Desktop/Fortan_kmeans/kmeans3.so | grep ' T '
>
> Nothing appears on my screen
>
> When I type
>
> nm  ~/Desktop/Fortan_kmeans/kmeans3.so
>
> this is what I get:
>
> 00000fe0 t __dyld_func_lookup
> 00000000 t __mh_bundle_header
> 00001000 d dyld__mh_bundle_header
> 00001008 s dyld_func_lookup_pointer
> 00001004 s dyld_lazy_symbol_binding_entry_point
> 00000fb0 t dyld_stub_binding_helper
>
>
> By the way, yes I have tried
>     is.loaded("wrapper") ?
> And is always return FALSE
>
> S.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From sebastiendurand at videotron.ca  Thu Aug  4 17:47:12 2005
From: sebastiendurand at videotron.ca (=?ISO-8859-1?Q?S=E9bastien_Durand?=)
Date: Thu, 4 Aug 2005 11:47:12 -0400
Subject: [Rd] call fortran in R
In-Reply-To: <42F232EC.7080802@vanderbilt.edu>
References: <CADF0312-4070-40A2-A054-F38084A20FC1@UMontreal.CA>
	<42F232EC.7080802@vanderbilt.edu>
Message-ID: <E4D4571E-8411-4CD2-A0A7-95926A99B240@videotron.ca>

You are totally write I will learn and already did learn more than  
much with master Ripley replies.

Thus I do still state that I mentionned that I was using mac os x in  
a message that was scrubbed (???) see Duncan Murdoch reply for  
proof...  ;)

Any how next time I will make sure it shows in the initial message.

Meanwhile I will still look around to find an answer to my problem.

Thanks

> S?bastien Durand wrote:
>
>> Ok,
>>
>> Dear all,
>>
>> I have state previously, I am using mac os X tiger on a g5, using the
>> last version of R 2.1.1
>>
>
> Well, to Prof. Ripley's point, you never stated that you were  
> running OS
> X, just a mac G5. Linux also runs on a G5.
>
> Learn much, you will, from Master Ripley...
>
> -- 
> Jeffrey Horner       Computer Systems Analyst         School of  
> Medicine
> 615-322-8606         Department of Biostatistics   Vanderbilt  
> University
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From d.firth at warwick.ac.uk  Thu Aug  4 17:50:28 2005
From: d.firth at warwick.ac.uk (d.firth@warwick.ac.uk)
Date: Thu,  4 Aug 2005 17:50:28 +0200 (CEST)
Subject: [Rd] add1.lm and add1.glm not handling weights and offsets properly
	(PR#8049)
Message-ID: <20050804155028.4D291A75C@slim.kubism.ku.dk>

I am using R 2.1.1 under Mac OS 10.3.9.

Two related problems (see notes 1. and 2. below) are illustrated by 
results of the following:

y <- rnorm(10)
x <- z <- 1:10
is.na(x[9]) <- TRUE

lm0 <- lm(y ~ 1)
lm1 <- lm(y ~ 1, weights = rep(1, 10))

add1(lm0, scope = ~ x)  ## works ok
add1(lm1, scope = ~ x)  ## error

lm2 <- lm(y ~ 1, offset = 1:10)

add1(lm0, scope = ~ z)  ## works ok
add1(lm2, scope = ~ z)  ## gives incorrect results (ignores the offset)

glm0 <- glm(y ~ 1)
glm1 <- glm(y ~ 1, weights = rep(1, 10))
glm2 <- glm(y ~ 1, offset = rep(0, 10))

add1(glm0, scope = ~ x)  ## error
add1(glm1, scope = ~ x)  ## error
add1(glm2, scope = ~ x)  ## error



As I see it, the two problems are:

1.  add1.lm ignores any offset present in its "object" argument.

2.  add1.lm and add1.glm both take weights directly from their "object" 
argument, and add1.glm also does the same for any offset that is 
present.  But this does not work when the upper scope includes missing 
values and na.omit is used: the weights (and offset) then have the 
wrong length.  They should presumably be extracted instead from the 
reduced model frame.


If I can be of help in fixing these things, please let me know.  But I 
don't want to make things worse, or to duplicate anyone else's work.  I 
don't see this fixed in the bug-fix list at
   https://svn.r-project.org/R/trunk/NEWS
but I haven't checked whether the same problems are in the current 
r-devel.

David


From sebastien.durand at UMontreal.CA  Thu Aug  4 19:38:12 2005
From: sebastien.durand at UMontreal.CA (=?ISO-8859-1?Q?S=E9bastien_Durand?=)
Date: Thu, 4 Aug 2005 13:38:12 -0400
Subject: [Rd] call fortran in R
In-Reply-To: <834774B3-26D3-4600-9B48-DF6626F8FAC6@frazmtn.com>
References: <BB026B1E-17AE-42A2-B86E-6C74337202D1@UMontreal.CA>
	<834774B3-26D3-4600-9B48-DF6626F8FAC6@frazmtn.com>
Message-ID: <77DED4C1-017A-4A60-8B81-0E991C97E020@UMontreal.CA>

Ok,  I am presently updating my system.

How do you set
      setenv gcc /usr/local/bin/gfortran.

Using bash.

Then I will the command to compile the foo.f file been the same!

I guess so

S.
>
> also gcc 4061 is a bit old -- the tiger update in 10.4.2 was
> 50xx, i think, cvs is up to apple build 5217 and is now
> gcc-4.0.1.
>
> -- jan
>
> On Aug 4, 2005, at 8:25 , S?bastien Durand wrote:
>
>
>> Dear all,
>>
>> Since the command you ask me to type doesn't show anything
>> Here some more information, on my system and on the foo.so  
>> compiled file
>>
>> I am using g77 version 3.4.4  Configured with: ../gcc/configure --
>> enable-threads=posix --enable-languages=f77
>>
>> I am using gcc version 4.0.0 20041026 (Apple Computer, Inc. build  
>> 4061)
>>          Configured with: /private/var/tmp/gcc/gcc-4061.obj~8/src/
>> configure --disable-checking --prefix=/usr --mandir=/share/man --
>> enable-languages=c,objc,c++,obj-c++ --program-transform-name=/^[cg][^
>> +.-]*$/s/$/-4.0/
>>          --with-gxx-include-dir=/include/gcc/darwin/4.0/c++ --
>> build=powerpc-apple-darwin8 --host=powerpc-apple-darwin8 --
>> target=powerpc-apple-darwin8
>>
>> I don't know if this can be of any help to you but there is again how
>> I compile the foo.f
>>
>> Double-G5:~ sebas$ R CMD SHLIB  ~/Desktop/Fortan_kmeans/kmeans3.f
>>          g77   -fno-common  -g -O2 -c /Users/sebas/Desktop/
>> Fortan_kmeans/kmeans3.f -o /Users/sebas/Desktop/Fortan_kmeans/ 
>> kmeans3.o
>>          gcc-3.3 -bundle -flat_namespace -undefined suppress -L/usr/
>> local/lib -o /Users/sebas/Desktop/Fortan_kmeans/kmeans3.so /Users/
>> sebas/Desktop/Fortan_kmeans/kmeans3.o  -L/usr/local/lib/gcc/powerpc-
>> apple-darwin6.8/3.4.2 -lg2c -lSystem -framework R
>>
>>
>> There is all the info about the foo.so file using nm -a option
>> instead of -g:
>>
>>
>> Double-G5:~ sebas$ nm -a ~/Desktop/Fortan_kmeans/kmeans3.so
>> 00000fe4 - 01 0114 SLINE
>> 00000fb0 - 01 0000    SO
>> 00000fd8 - 01 010d SLINE
>> 00000fdc - 01 010e SLINE
>> 00000fe0 - 01 010f SLINE
>> 00000fec - 01 0116 SLINE
>> 00000fe8 - 01 0115 SLINE
>> 00001000 - 01 0000    SO
>> 00001000 - 01 011b SLINE
>> 00000ffc - 01 011a SLINE
>> 00000ff8 - 01 0119 SLINE
>> 00000fb4 - 01 0104 SLINE
>> 00000fb8 - 01 0105 SLINE
>> 00000fbc - 01 0106 SLINE
>> 00000fc0 - 01 0107 SLINE
>> 00000fc4 - 01 0108 SLINE
>> 00000ff4 - 01 0118 SLINE
>> 00000fc8 - 01 0109 SLINE
>> 00000fcc - 01 010a SLINE
>> 00000fd0 - 01 010b SLINE
>> 00000fd4 - 01 010c SLINE
>> 00000ff0 - 01 0117 SLINE
>> 00000fb0 - 01 0000   SOL /SourceCache/Csu/Csu-57//
>> 00000fb0 - 01 0000   SOL /SourceCache/Csu/Csu-57/bundle1.s
>> 00000fb0 - 01 0000   SOL /SourceCache/Csu/Csu-57/bundle1.s
>> 00000fb0 - 01 0000   SOL /SourceCache/Csu/Csu-57/bundle1.s
>> 00000fb0 - 01 0000    SO /Users/sebas/
>> 00000fb0 - 01 0000    SO /Users/sebas/Desktop/Fortan_kmeans/kmeans3.f
>> 00000fb0 - 01 0000   SOL <built-in>
>> 00000fb0 - 01 0000   SOL <command line>
>> 00000fe0 t __dyld_func_lookup
>> 00000fe0 - 01 0113   FUN __dyld_func_lookup:F3
>> 00000000 - 00 0000  LSYM __g77_f2c_address:t(0,10)=*(0,11)=@s8;r
>> (0,11);-128;127;
>> 00000000 - 00 0000  LSYM __g77_f2c_complex:t(0,7)=R3;8;0;
>> 00000000 - 00 0000  LSYM __g77_f2c_doublecomplex:t(0,6)=R3;16;0;
>> 00000000 - 00 0000  LSYM __g77_f2c_doublereal:t(0,8)=r(0,0);8;0;
>> 00000000 - 00 0000  LSYM __g77_f2c_flag:t(0,3)=r
>> (0,3);-2147483648;2147483647;
>> 00000000 - 00 0000  LSYM __g77_f2c_ftnint:t(0,1)=r
>> (0,1);-2147483648;2147483647;
>> 00000000 - 00 0000  LSYM __g77_f2c_ftnlen:t(0,2)=r
>> (0,2);-2147483648;2147483647;
>> 00000000 - 00 0000  LSYM __g77_f2c_integer:t(0,12)=r
>> (0,12);-2147483648;2147483647;
>> 00000000 - 00 0000  LSYM __g77_f2c_logical:t(0,4)=r
>> (0,4);-2147483648;2147483647;
>> 00000000 - 00 0000  LSYM __g77_f2c_longint:t(0,5)=@s64;r(0,5);
>> 001000000000000000000000;000777777777777777777777;
>> 00000000 - 00 0000  LSYM __g77_f2c_real:t(0,9)=r(0,0);4;0;
>> 00000000 t __mh_bundle_header
>> 00000000 - 00 0000  LSYM byte:t(0,26)=@s8;r(0,26);-128;127;
>> 00000000 - 00 0000  LSYM char:t(0,46)=@s8;r(0,46);0;255;
>> 00000000 - 00 0000  LSYM char:t2=r2;0;127;
>> 00000000 - 00 0000  LSYM complex double:t(0,31)=R3;16;0;
>> 00000000 - 00 0000  LSYM complex float:t(0,32)=R3;8;0;
>> 00000000 - 00 0000  LSYM complex int:t(0,33)=s8real:(0,34)=r
>> (0,34);-2147483648;2147483647;,0,32;imag:(0,34),32,32;;
>> 00000000 - 00 0000  LSYM complex long double:t(0,30)=R3;16;0;
>> 00000000 - 00 0000  LSYM complex:t(0,14)=R3;8;0;
>> 00000000 - 00 0000  LSYM double complex:t(0,13)=R3;16;0;
>> 00000000 - 00 0000  LSYM double precision:t(0,15)=r(0,0);8;0;
>> 00000000 - 00 0000  LSYM double:t(0,36)=r(0,34);8;0;
>> 00001000 d dyld__mh_bundle_header
>> 00001008 s dyld_func_lookup_pointer
>> 00001004 s dyld_lazy_symbol_binding_entry_point
>> 00000fb0 t dyld_stub_binding_helper
>> 00000fb0 - 01 0103   FUN dyld_stub_binding_helper:F3
>> 00000000 - 00 0000  LSYM float:t(0,37)=r(0,34);4;0;
>> 00000000 - 00 0000   OPT gcc2_compiled.
>> 00000000 - 00 0000  LSYM int:t(0,34)
>> 00000000 - 00 0000  LSYM int:t1=r1;-2147483648;2147483647;
>> 00000000 - 00 0000  LSYM integer4:t(0,22)=@s64;r(0,22);
>> 001000000000000000000000;000777777777777777777777;
>> 00000000 - 00 0000  LSYM integer:t(0,28)=r 
>> (0,28);-2147483648;2147483647;
>> 00000000 - 00 0000  LSYM logical2:t(0,19)=@s8;r(0,19);-128;127;
>> 00000000 - 00 0000  LSYM logical3:t(0,18)=@s16;r(0,18);-32768;32767;
>> 00000000 - 00 0000  LSYM logical4:t(0,17)=@s64;r(0,17);
>> 001000000000000000000000;000777777777777777777777;
>> 00000000 - 00 0000  LSYM logical:t(0,20)=r 
>> (0,20);-2147483648;2147483647;
>> 00000000 - 00 0000  LSYM long double:t(0,35)=r(0,34);8;0;
>> 00000000 - 00 0000  LSYM long int:t(0,45)=r
>> (0,45);-2147483648;2147483647;
>> 00000000 - 00 0000  LSYM long long int:t(0,42)=@s64;r(0,42);
>> 001000000000000000000000;000777777777777777777777;
>> 00000000 - 00 0000  LSYM long long unsigned int:t(0,41)=@s64;r(0,41);
>> 000000000000000000000000;001777777777777777777777;
>> 00000000 - 00 0000  LSYM long unsigned int:t(0,43)=r(0,43);
>> 000000000000000000000000;000000000000037777777777;
>> 00000000 - 00 0000  LSYM real:t(0,16)=r(0,0);4;0;
>> 00000000 - 00 0000  LSYM short int:t(0,40)=@s16;r(0,40);-32768;32767;
>> 00000000 - 00 0000  LSYM short unsigned int:t(0,39)=@s16;r(0,39);
>> 0;65535;
>> 00000000 - 00 0000  LSYM signed char:t(0,11)
>> 00000000 - 00 0000  LSYM unsigned byte:t(0,25)=@s8;r(0,25);0;255;
>> 00000000 - 00 0000  LSYM unsigned char:t(0,38)=@s8;r(0,38);0;255;
>> 00000000 - 00 0000  LSYM unsigned int:t(0,44)=r(0,44);
>> 000000000000000000000000;000000000000037777777777;
>> 00000000 - 00 0000  LSYM unsigned word:t(0,23)=@s16;r(0,23);0;65535;
>> 00000000 - 00 0000  LSYM unsigned4:t(0,21)=@s64;r(0,21);
>> 000000000000000000000000;001777777777777777777777;
>> 00000000 - 00 0000  LSYM unsigned:t(0,27)=r(0,27);
>> 000000000000000000000000;000000000000037777777777;
>> 00000000 - 00 0000  LSYM void:t(0,29)=(0,29)
>> 00000000 - 00 0000  LSYM void:t3=3
>> 00000000 - 00 0000  LSYM word:t(0,24)=@s16;r(0,24);-32768;32767;
>> 00000fb0 - 01 0000    SO {standard input}
>> Double-G5:~ sebas$
>>
>> S.
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
>>
>
> ==========================================================
> Jan de Leeuw, 11667 Steinhoff Rd, Frazier Park, CA 93225, 661-245-1725
> ==========================================================
>                                      Und die Einen sind im Dunkeln
>                                      Und die Andern sind im Licht
>                                      Und man siehe die im Lichte
>                                      Die im Dunklen sieht man nicht
>                                                                        
>                                   Brecht
>
>
>
>


From sebastiendurand at videotron.ca  Thu Aug  4 19:42:07 2005
From: sebastiendurand at videotron.ca (=?ISO-8859-1?Q?S=E9bastien_Durand?=)
Date: Thu, 4 Aug 2005 13:42:07 -0400
Subject: [Rd] call fortran in R
In-Reply-To: <77DED4C1-017A-4A60-8B81-0E991C97E020@UMontreal.CA>
References: <BB026B1E-17AE-42A2-B86E-6C74337202D1@UMontreal.CA>
	<834774B3-26D3-4600-9B48-DF6626F8FAC6@frazmtn.com>
	<77DED4C1-017A-4A60-8B81-0E991C97E020@UMontreal.CA>
Message-ID: <FA2C6D13-A635-44BC-88D8-A0B9E93705DA@videotron.ca>

Forget that last reply!

I found how to set the environment!

Le 05-08-04 ? 13:38, S?bastien Durand a ?crit :

> Ok,  I am presently updating my system.
>
> How do you set
>       setenv gcc /usr/local/bin/gfortran.
>
> Using bash.
>
> Then I will the command to compile the foo.f file been the same!
>
> I guess so
>
> S.
>
>>
>> also gcc 4061 is a bit old -- the tiger update in 10.4.2 was
>> 50xx, i think, cvs is up to apple build 5217 and is now
>> gcc-4.0.1.
>>
>> -- jan
>>
>> On Aug 4, 2005, at 8:25 , S?bastien Durand wrote:
>>
>>
>>
>>> Dear all,
>>>
>>> Since the command you ask me to type doesn't show anything
>>> Here some more information, on my system and on the foo.so
>>> compiled file
>>>
>>> I am using g77 version 3.4.4  Configured with: ../gcc/configure --
>>> enable-threads=posix --enable-languages=f77
>>>
>>> I am using gcc version 4.0.0 20041026 (Apple Computer, Inc. build
>>> 4061)
>>>          Configured with: /private/var/tmp/gcc/gcc-4061.obj~8/src/
>>> configure --disable-checking --prefix=/usr --mandir=/share/man --
>>> enable-languages=c,objc,c++,obj-c++ --program-transform-name=/^ 
>>> [cg][^
>>> +.-]*$/s/$/-4.0/
>>>          --with-gxx-include-dir=/include/gcc/darwin/4.0/c++ --
>>> build=powerpc-apple-darwin8 --host=powerpc-apple-darwin8 --
>>> target=powerpc-apple-darwin8
>>>
>>> I don't know if this can be of any help to you but there is again  
>>> how
>>> I compile the foo.f
>>>
>>> Double-G5:~ sebas$ R CMD SHLIB  ~/Desktop/Fortan_kmeans/kmeans3.f
>>>          g77   -fno-common  -g -O2 -c /Users/sebas/Desktop/
>>> Fortan_kmeans/kmeans3.f -o /Users/sebas/Desktop/Fortan_kmeans/
>>> kmeans3.o
>>>          gcc-3.3 -bundle -flat_namespace -undefined suppress -L/usr/
>>> local/lib -o /Users/sebas/Desktop/Fortan_kmeans/kmeans3.so /Users/
>>> sebas/Desktop/Fortan_kmeans/kmeans3.o  -L/usr/local/lib/gcc/powerpc-
>>> apple-darwin6.8/3.4.2 -lg2c -lSystem -framework R
>>>
>>>
>>> There is all the info about the foo.so file using nm -a option
>>> instead of -g:
>>>
>>>
>>> Double-G5:~ sebas$ nm -a ~/Desktop/Fortan_kmeans/kmeans3.so
>>> 00000fe4 - 01 0114 SLINE
>>> 00000fb0 - 01 0000    SO
>>> 00000fd8 - 01 010d SLINE
>>> 00000fdc - 01 010e SLINE
>>> 00000fe0 - 01 010f SLINE
>>> 00000fec - 01 0116 SLINE
>>> 00000fe8 - 01 0115 SLINE
>>> 00001000 - 01 0000    SO
>>> 00001000 - 01 011b SLINE
>>> 00000ffc - 01 011a SLINE
>>> 00000ff8 - 01 0119 SLINE
>>> 00000fb4 - 01 0104 SLINE
>>> 00000fb8 - 01 0105 SLINE
>>> 00000fbc - 01 0106 SLINE
>>> 00000fc0 - 01 0107 SLINE
>>> 00000fc4 - 01 0108 SLINE
>>> 00000ff4 - 01 0118 SLINE
>>> 00000fc8 - 01 0109 SLINE
>>> 00000fcc - 01 010a SLINE
>>> 00000fd0 - 01 010b SLINE
>>> 00000fd4 - 01 010c SLINE
>>> 00000ff0 - 01 0117 SLINE
>>> 00000fb0 - 01 0000   SOL /SourceCache/Csu/Csu-57//
>>> 00000fb0 - 01 0000   SOL /SourceCache/Csu/Csu-57/bundle1.s
>>> 00000fb0 - 01 0000   SOL /SourceCache/Csu/Csu-57/bundle1.s
>>> 00000fb0 - 01 0000   SOL /SourceCache/Csu/Csu-57/bundle1.s
>>> 00000fb0 - 01 0000    SO /Users/sebas/
>>> 00000fb0 - 01 0000    SO /Users/sebas/Desktop/Fortan_kmeans/ 
>>> kmeans3.f
>>> 00000fb0 - 01 0000   SOL <built-in>
>>> 00000fb0 - 01 0000   SOL <command line>
>>> 00000fe0 t __dyld_func_lookup
>>> 00000fe0 - 01 0113   FUN __dyld_func_lookup:F3
>>> 00000000 - 00 0000  LSYM __g77_f2c_address:t(0,10)=*(0,11)=@s8;r
>>> (0,11);-128;127;
>>> 00000000 - 00 0000  LSYM __g77_f2c_complex:t(0,7)=R3;8;0;
>>> 00000000 - 00 0000  LSYM __g77_f2c_doublecomplex:t(0,6)=R3;16;0;
>>> 00000000 - 00 0000  LSYM __g77_f2c_doublereal:t(0,8)=r(0,0);8;0;
>>> 00000000 - 00 0000  LSYM __g77_f2c_flag:t(0,3)=r
>>> (0,3);-2147483648;2147483647;
>>> 00000000 - 00 0000  LSYM __g77_f2c_ftnint:t(0,1)=r
>>> (0,1);-2147483648;2147483647;
>>> 00000000 - 00 0000  LSYM __g77_f2c_ftnlen:t(0,2)=r
>>> (0,2);-2147483648;2147483647;
>>> 00000000 - 00 0000  LSYM __g77_f2c_integer:t(0,12)=r
>>> (0,12);-2147483648;2147483647;
>>> 00000000 - 00 0000  LSYM __g77_f2c_logical:t(0,4)=r
>>> (0,4);-2147483648;2147483647;
>>> 00000000 - 00 0000  LSYM __g77_f2c_longint:t(0,5)=@s64;r(0,5);
>>> 001000000000000000000000;000777777777777777777777;
>>> 00000000 - 00 0000  LSYM __g77_f2c_real:t(0,9)=r(0,0);4;0;
>>> 00000000 t __mh_bundle_header
>>> 00000000 - 00 0000  LSYM byte:t(0,26)=@s8;r(0,26);-128;127;
>>> 00000000 - 00 0000  LSYM char:t(0,46)=@s8;r(0,46);0;255;
>>> 00000000 - 00 0000  LSYM char:t2=r2;0;127;
>>> 00000000 - 00 0000  LSYM complex double:t(0,31)=R3;16;0;
>>> 00000000 - 00 0000  LSYM complex float:t(0,32)=R3;8;0;
>>> 00000000 - 00 0000  LSYM complex int:t(0,33)=s8real:(0,34)=r
>>> (0,34);-2147483648;2147483647;,0,32;imag:(0,34),32,32;;
>>> 00000000 - 00 0000  LSYM complex long double:t(0,30)=R3;16;0;
>>> 00000000 - 00 0000  LSYM complex:t(0,14)=R3;8;0;
>>> 00000000 - 00 0000  LSYM double complex:t(0,13)=R3;16;0;
>>> 00000000 - 00 0000  LSYM double precision:t(0,15)=r(0,0);8;0;
>>> 00000000 - 00 0000  LSYM double:t(0,36)=r(0,34);8;0;
>>> 00001000 d dyld__mh_bundle_header
>>> 00001008 s dyld_func_lookup_pointer
>>> 00001004 s dyld_lazy_symbol_binding_entry_point
>>> 00000fb0 t dyld_stub_binding_helper
>>> 00000fb0 - 01 0103   FUN dyld_stub_binding_helper:F3
>>> 00000000 - 00 0000  LSYM float:t(0,37)=r(0,34);4;0;
>>> 00000000 - 00 0000   OPT gcc2_compiled.
>>> 00000000 - 00 0000  LSYM int:t(0,34)
>>> 00000000 - 00 0000  LSYM int:t1=r1;-2147483648;2147483647;
>>> 00000000 - 00 0000  LSYM integer4:t(0,22)=@s64;r(0,22);
>>> 001000000000000000000000;000777777777777777777777;
>>> 00000000 - 00 0000  LSYM integer:t(0,28)=r
>>> (0,28);-2147483648;2147483647;
>>> 00000000 - 00 0000  LSYM logical2:t(0,19)=@s8;r(0,19);-128;127;
>>> 00000000 - 00 0000  LSYM logical3:t(0,18)=@s16;r(0,18);-32768;32767;
>>> 00000000 - 00 0000  LSYM logical4:t(0,17)=@s64;r(0,17);
>>> 001000000000000000000000;000777777777777777777777;
>>> 00000000 - 00 0000  LSYM logical:t(0,20)=r
>>> (0,20);-2147483648;2147483647;
>>> 00000000 - 00 0000  LSYM long double:t(0,35)=r(0,34);8;0;
>>> 00000000 - 00 0000  LSYM long int:t(0,45)=r
>>> (0,45);-2147483648;2147483647;
>>> 00000000 - 00 0000  LSYM long long int:t(0,42)=@s64;r(0,42);
>>> 001000000000000000000000;000777777777777777777777;
>>> 00000000 - 00 0000  LSYM long long unsigned int:t(0,41)=@s64;r 
>>> (0,41);
>>> 000000000000000000000000;001777777777777777777777;
>>> 00000000 - 00 0000  LSYM long unsigned int:t(0,43)=r(0,43);
>>> 000000000000000000000000;000000000000037777777777;
>>> 00000000 - 00 0000  LSYM real:t(0,16)=r(0,0);4;0;
>>> 00000000 - 00 0000  LSYM short int:t(0,40)=@s16;r 
>>> (0,40);-32768;32767;
>>> 00000000 - 00 0000  LSYM short unsigned int:t(0,39)=@s16;r(0,39);
>>> 0;65535;
>>> 00000000 - 00 0000  LSYM signed char:t(0,11)
>>> 00000000 - 00 0000  LSYM unsigned byte:t(0,25)=@s8;r(0,25);0;255;
>>> 00000000 - 00 0000  LSYM unsigned char:t(0,38)=@s8;r(0,38);0;255;
>>> 00000000 - 00 0000  LSYM unsigned int:t(0,44)=r(0,44);
>>> 000000000000000000000000;000000000000037777777777;
>>> 00000000 - 00 0000  LSYM unsigned word:t(0,23)=@s16;r(0,23);0;65535;
>>> 00000000 - 00 0000  LSYM unsigned4:t(0,21)=@s64;r(0,21);
>>> 000000000000000000000000;001777777777777777777777;
>>> 00000000 - 00 0000  LSYM unsigned:t(0,27)=r(0,27);
>>> 000000000000000000000000;000000000000037777777777;
>>> 00000000 - 00 0000  LSYM void:t(0,29)=(0,29)
>>> 00000000 - 00 0000  LSYM void:t3=3
>>> 00000000 - 00 0000  LSYM word:t(0,24)=@s16;r(0,24);-32768;32767;
>>> 00000fb0 - 01 0000    SO {standard input}
>>> Double-G5:~ sebas$
>>>
>>> S.
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>>
>>>
>>>
>>
>> ==========================================================
>> Jan de Leeuw, 11667 Steinhoff Rd, Frazier Park, CA 93225,  
>> 661-245-1725
>> ==========================================================
>>                                      Und die Einen sind im Dunkeln
>>                                      Und die Andern sind im Licht
>>                                      Und man siehe die im Lichte
>>                                      Die im Dunklen sieht man nicht
>>
>>                                   Brecht
>>
>>
>>
>>
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From simon.urbanek at r-project.org  Thu Aug  4 20:18:04 2005
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Thu, 4 Aug 2005 14:18:04 -0400
Subject: [Rd] call fortran in R
In-Reply-To: <77DED4C1-017A-4A60-8B81-0E991C97E020@UMontreal.CA>
References: <BB026B1E-17AE-42A2-B86E-6C74337202D1@UMontreal.CA>
	<834774B3-26D3-4600-9B48-DF6626F8FAC6@frazmtn.com>
	<77DED4C1-017A-4A60-8B81-0E991C97E020@UMontreal.CA>
Message-ID: <FFA817C4-8C2B-4854-8C4B-5A338307D455@r-project.org>

On Aug 4, 2005, at 1:38 PM, S?bastien Durand wrote:

> Ok,  I am presently updating my system.
>
> How do you set
>       setenv gcc /usr/local/bin/gfortran.

That won't help even if you do it in bash - this is wrong!  
(F77=gfortran is what may help if you want to re-compile R with gcc4).

If you are using CRAN binary, you cannot use gfortran! gcc3 and 4 are  
not compatible.

With stock CRAN binary and the supplied g77 (Tiger on a G5) a simple  
(silly) example:

gammu:urbanek$ cat fts.f
       subroutine ffoo(a)
       double precision a(1)

       a(1) = 1.0d0
       return
       end

gammu:urbanek$ R CMD SHLIB fts.f
g77   -fno-common  -g -O2 -c fts.f -o fts.o
gcc-3.3 -bundle -flat_namespace -undefined suppress -L/usr/local/lib - 
o fts.so fts.o  -L/usr/local/lib/gcc/powerpc-apple-darwin6.8/3.4.2 - 
lg2c -lSystem -lcc_dynamic -framework R

gammu:urbanek$ nm fts.so |grep T
00000fec T _ffoo_

R> dyn.load("fts.so")
R> .Fortran("ffoo",as.double(10))
[[1]]
[1] 1

R> is.loaded(symbol.For("ffoo"))
[1] TRUE
R> symbol.For("ffoo")
[1] "ffoo_"

So ... there must be something fundamentally wrong with your setup,  
otherwise I see no reason why you should have any problems. Maybe you  
should  send us the code pus exact transcript of your attempt...

Cheers,
Simon


From charlie at stat.umn.edu  Thu Aug  4 21:41:01 2005
From: charlie at stat.umn.edu (Charles Geyer)
Date: Thu, 4 Aug 2005 14:41:01 -0500
Subject: [Rd] valgrind complains about regex.c (PR#8043)
In-Reply-To: <x2r7dau5sx.fsf@turmalin.kubism.ku.dk>
References: <20050803200851.1C241A75C@slim.kubism.ku.dk>
	<x2r7dau5sx.fsf@turmalin.kubism.ku.dk>
Message-ID: <20050804194101.GA27965@stat.umn.edu>

On Wed, Aug 03, 2005 at 10:25:02PM +0200, Peter Dalgaard wrote:
> charlie at stat.umn.edu writes:
> 
> > On Tue, Aug 02, 2005 at 07:50:54AM -0400, Duncan Murdoch wrote:
> 
> > > Charlie, have you tried a recent version of R-patched?
> > 
> > Now I have.  The computer is my laptop and not connected to the net
> > so I can't upload details, but R-1.2.1-patched as of yesterday does
>                                  ###############
> 
> This email has been a LONG time underway? ;-)

No.  I have "numerical dyslexia".  I just typed it rather than cut and
paste (I was just using someone else's account to send mail when I couldn't
connect my laptop).  Makes it hell teaching intro stats.  I have to have
all numerical examples worked in advance.  I tell people I went into math
so I could work with letters instead of numbers.

-- 
Charles Geyer
Professor, School of Statistics
University of Minnesota
charlie at stat.umn.edu


From Weigand.Stephen at mayo.edu  Fri Aug  5 00:14:20 2005
From: Weigand.Stephen at mayo.edu (Weigand.Stephen@mayo.edu)
Date: Fri,  5 Aug 2005 00:14:20 +0200 (CEST)
Subject: [Rd] Documentation bug in libPaths.Rd (PR#8050)
Message-ID: <20050804221420.E789EE7E2@slim.kubism.ku.dk>

The Details section of the help for .Library / .libPaths 
has:

  "the library search path is set to the
  existing files in 'unique(new, .Library)' 
  and this is returned."

I think 'unique(new, .Library)' should be be changed 
to 'unique(c(new, .Library))'.

Thank you,

Stephen

platform sparc-sun-solaris2.9
arch     sparc               
os       solaris2.9          
system   sparc, solaris2.9   
status                       
major    2                   
minor    1.0                 
year     2005                
month    04                  
day      18                  
language R


From jago at mclink.it  Fri Aug  5 00:17:52 2005
From: jago at mclink.it (stefano iacus)
Date: Fri, 5 Aug 2005 00:17:52 +0200
Subject: [Rd] call fortran in R
In-Reply-To: <BB026B1E-17AE-42A2-B86E-6C74337202D1@UMontreal.CA>
References: <BB026B1E-17AE-42A2-B86E-6C74337202D1@UMontreal.CA>
Message-ID: <EF6A9FD1-53BE-4DE3-81B5-E2634E91D7AF@mclink.it>

please don't mix gcc 4.0 and g77. Also don't mix R binary which is  
gcc-3.3/g77-3.4.2 with gcc4 or gfortran.
stefano

On 04/ago/05, at 17:25, S?bastien Durand wrote:

> Dear all,
>
> Since the command you ask me to type doesn't show anything
> Here some more information, on my system and on the foo.so compiled  
> file
>
> I am using g77 version 3.4.4  Configured with: ../gcc/configure --
> enable-threads=posix --enable-languages=f77
>
> I am using gcc version 4.0.0 20041026 (Apple Computer, Inc. build  
> 4061)
>          Configured with: /private/var/tmp/gcc/gcc-4061.obj~8/src/
> configure --disable-checking --prefix=/usr --mandir=/share/man --
> enable-languages=c,objc,c++,obj-c++ --program-transform-name=/^[cg][^
> +.-]*$/s/$/-4.0/
>          --with-gxx-include-dir=/include/gcc/darwin/4.0/c++ --
> build=powerpc-apple-darwin8 --host=powerpc-apple-darwin8 --
> target=powerpc-apple-darwin8
>
> I don't know if this can be of any help to you but there is again how
> I compile the foo.f
>
> Double-G5:~ sebas$ R CMD SHLIB  ~/Desktop/Fortan_kmeans/kmeans3.f
>          g77   -fno-common  -g -O2 -c /Users/sebas/Desktop/
> Fortan_kmeans/kmeans3.f -o /Users/sebas/Desktop/Fortan_kmeans/ 
> kmeans3.o
>          gcc-3.3 -bundle -flat_namespace -undefined suppress -L/usr/
> local/lib -o /Users/sebas/Desktop/Fortan_kmeans/kmeans3.so /Users/
> sebas/Desktop/Fortan_kmeans/kmeans3.o  -L/usr/local/lib/gcc/powerpc-
> apple-darwin6.8/3.4.2 -lg2c -lSystem -framework R
>
>
> There is all the info about the foo.so file using nm -a option
> instead of -g:
>
>
> Double-G5:~ sebas$ nm -a ~/Desktop/Fortan_kmeans/kmeans3.so
> 00000fe4 - 01 0114 SLINE
> 00000fb0 - 01 0000    SO
> 00000fd8 - 01 010d SLINE
> 00000fdc - 01 010e SLINE
> 00000fe0 - 01 010f SLINE
> 00000fec - 01 0116 SLINE
> 00000fe8 - 01 0115 SLINE
> 00001000 - 01 0000    SO
> 00001000 - 01 011b SLINE
> 00000ffc - 01 011a SLINE
> 00000ff8 - 01 0119 SLINE
> 00000fb4 - 01 0104 SLINE
> 00000fb8 - 01 0105 SLINE
> 00000fbc - 01 0106 SLINE
> 00000fc0 - 01 0107 SLINE
> 00000fc4 - 01 0108 SLINE
> 00000ff4 - 01 0118 SLINE
> 00000fc8 - 01 0109 SLINE
> 00000fcc - 01 010a SLINE
> 00000fd0 - 01 010b SLINE
> 00000fd4 - 01 010c SLINE
> 00000ff0 - 01 0117 SLINE
> 00000fb0 - 01 0000   SOL /SourceCache/Csu/Csu-57//
> 00000fb0 - 01 0000   SOL /SourceCache/Csu/Csu-57/bundle1.s
> 00000fb0 - 01 0000   SOL /SourceCache/Csu/Csu-57/bundle1.s
> 00000fb0 - 01 0000   SOL /SourceCache/Csu/Csu-57/bundle1.s
> 00000fb0 - 01 0000    SO /Users/sebas/
> 00000fb0 - 01 0000    SO /Users/sebas/Desktop/Fortan_kmeans/kmeans3.f
> 00000fb0 - 01 0000   SOL <built-in>
> 00000fb0 - 01 0000   SOL <command line>
> 00000fe0 t __dyld_func_lookup
> 00000fe0 - 01 0113   FUN __dyld_func_lookup:F3
> 00000000 - 00 0000  LSYM __g77_f2c_address:t(0,10)=*(0,11)=@s8;r
> (0,11);-128;127;
> 00000000 - 00 0000  LSYM __g77_f2c_complex:t(0,7)=R3;8;0;
> 00000000 - 00 0000  LSYM __g77_f2c_doublecomplex:t(0,6)=R3;16;0;
> 00000000 - 00 0000  LSYM __g77_f2c_doublereal:t(0,8)=r(0,0);8;0;
> 00000000 - 00 0000  LSYM __g77_f2c_flag:t(0,3)=r
> (0,3);-2147483648;2147483647;
> 00000000 - 00 0000  LSYM __g77_f2c_ftnint:t(0,1)=r
> (0,1);-2147483648;2147483647;
> 00000000 - 00 0000  LSYM __g77_f2c_ftnlen:t(0,2)=r
> (0,2);-2147483648;2147483647;
> 00000000 - 00 0000  LSYM __g77_f2c_integer:t(0,12)=r
> (0,12);-2147483648;2147483647;
> 00000000 - 00 0000  LSYM __g77_f2c_logical:t(0,4)=r
> (0,4);-2147483648;2147483647;
> 00000000 - 00 0000  LSYM __g77_f2c_longint:t(0,5)=@s64;r(0,5);
> 001000000000000000000000;000777777777777777777777;
> 00000000 - 00 0000  LSYM __g77_f2c_real:t(0,9)=r(0,0);4;0;
> 00000000 t __mh_bundle_header
> 00000000 - 00 0000  LSYM byte:t(0,26)=@s8;r(0,26);-128;127;
> 00000000 - 00 0000  LSYM char:t(0,46)=@s8;r(0,46);0;255;
> 00000000 - 00 0000  LSYM char:t2=r2;0;127;
> 00000000 - 00 0000  LSYM complex double:t(0,31)=R3;16;0;
> 00000000 - 00 0000  LSYM complex float:t(0,32)=R3;8;0;
> 00000000 - 00 0000  LSYM complex int:t(0,33)=s8real:(0,34)=r
> (0,34);-2147483648;2147483647;,0,32;imag:(0,34),32,32;;
> 00000000 - 00 0000  LSYM complex long double:t(0,30)=R3;16;0;
> 00000000 - 00 0000  LSYM complex:t(0,14)=R3;8;0;
> 00000000 - 00 0000  LSYM double complex:t(0,13)=R3;16;0;
> 00000000 - 00 0000  LSYM double precision:t(0,15)=r(0,0);8;0;
> 00000000 - 00 0000  LSYM double:t(0,36)=r(0,34);8;0;
> 00001000 d dyld__mh_bundle_header
> 00001008 s dyld_func_lookup_pointer
> 00001004 s dyld_lazy_symbol_binding_entry_point
> 00000fb0 t dyld_stub_binding_helper
> 00000fb0 - 01 0103   FUN dyld_stub_binding_helper:F3
> 00000000 - 00 0000  LSYM float:t(0,37)=r(0,34);4;0;
> 00000000 - 00 0000   OPT gcc2_compiled.
> 00000000 - 00 0000  LSYM int:t(0,34)
> 00000000 - 00 0000  LSYM int:t1=r1;-2147483648;2147483647;
> 00000000 - 00 0000  LSYM integer4:t(0,22)=@s64;r(0,22);
> 001000000000000000000000;000777777777777777777777;
> 00000000 - 00 0000  LSYM integer:t(0,28)=r 
> (0,28);-2147483648;2147483647;
> 00000000 - 00 0000  LSYM logical2:t(0,19)=@s8;r(0,19);-128;127;
> 00000000 - 00 0000  LSYM logical3:t(0,18)=@s16;r(0,18);-32768;32767;
> 00000000 - 00 0000  LSYM logical4:t(0,17)=@s64;r(0,17);
> 001000000000000000000000;000777777777777777777777;
> 00000000 - 00 0000  LSYM logical:t(0,20)=r 
> (0,20);-2147483648;2147483647;
> 00000000 - 00 0000  LSYM long double:t(0,35)=r(0,34);8;0;
> 00000000 - 00 0000  LSYM long int:t(0,45)=r
> (0,45);-2147483648;2147483647;
> 00000000 - 00 0000  LSYM long long int:t(0,42)=@s64;r(0,42);
> 001000000000000000000000;000777777777777777777777;
> 00000000 - 00 0000  LSYM long long unsigned int:t(0,41)=@s64;r(0,41);
> 000000000000000000000000;001777777777777777777777;
> 00000000 - 00 0000  LSYM long unsigned int:t(0,43)=r(0,43);
> 000000000000000000000000;000000000000037777777777;
> 00000000 - 00 0000  LSYM real:t(0,16)=r(0,0);4;0;
> 00000000 - 00 0000  LSYM short int:t(0,40)=@s16;r(0,40);-32768;32767;
> 00000000 - 00 0000  LSYM short unsigned int:t(0,39)=@s16;r(0,39);
> 0;65535;
> 00000000 - 00 0000  LSYM signed char:t(0,11)
> 00000000 - 00 0000  LSYM unsigned byte:t(0,25)=@s8;r(0,25);0;255;
> 00000000 - 00 0000  LSYM unsigned char:t(0,38)=@s8;r(0,38);0;255;
> 00000000 - 00 0000  LSYM unsigned int:t(0,44)=r(0,44);
> 000000000000000000000000;000000000000037777777777;
> 00000000 - 00 0000  LSYM unsigned word:t(0,23)=@s16;r(0,23);0;65535;
> 00000000 - 00 0000  LSYM unsigned4:t(0,21)=@s64;r(0,21);
> 000000000000000000000000;001777777777777777777777;
> 00000000 - 00 0000  LSYM unsigned:t(0,27)=r(0,27);
> 000000000000000000000000;000000000000037777777777;
> 00000000 - 00 0000  LSYM void:t(0,29)=(0,29)
> 00000000 - 00 0000  LSYM void:t3=3
> 00000000 - 00 0000  LSYM word:t(0,24)=@s16;r(0,24);-32768;32767;
> 00000fb0 - 01 0000    SO {standard input}
> Double-G5:~ sebas$
>
> S.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From ripley at stats.ox.ac.uk  Fri Aug  5 09:06:18 2005
From: ripley at stats.ox.ac.uk (ripley@stats.ox.ac.uk)
Date: Fri,  5 Aug 2005 09:06:18 +0200 (CEST)
Subject: [Rd] (PR#8049) add1.lm and add1.glm not handling weights and
Message-ID: <20050805070618.A3044B21B@slim.kubism.ku.dk>

David,

Thanks.

The reason add1.lm (and drop1.lm) do not support offsets is that lm did 
not when they were written, and the person who added offsets to lm did not 
change them. (I do wish they had not added an offset arg and just used the 
formula as in S's glm.)  That is easy to add.

For the other point, some care is needed if 'x' is supplied and the upper 
scope reduces the number of points.  We can try harder, but your usage 
does give a warning and perhaps that needs to be an error in this case.

Brian


On Thu, 4 Aug 2005 d.firth at warwick.ac.uk wrote:

> I am using R 2.1.1 under Mac OS 10.3.9.
>
> Two related problems (see notes 1. and 2. below) are illustrated by
> results of the following:
>
> y <- rnorm(10)
> x <- z <- 1:10
> is.na(x[9]) <- TRUE
>
> lm0 <- lm(y ~ 1)
> lm1 <- lm(y ~ 1, weights = rep(1, 10))
>
> add1(lm0, scope = ~ x)  ## works ok
> add1(lm1, scope = ~ x)  ## error
>
> lm2 <- lm(y ~ 1, offset = 1:10)
>
> add1(lm0, scope = ~ z)  ## works ok
> add1(lm2, scope = ~ z)  ## gives incorrect results (ignores the offset)
>
> glm0 <- glm(y ~ 1)
> glm1 <- glm(y ~ 1, weights = rep(1, 10))
> glm2 <- glm(y ~ 1, offset = rep(0, 10))
>
> add1(glm0, scope = ~ x)  ## error
> add1(glm1, scope = ~ x)  ## error
> add1(glm2, scope = ~ x)  ## error
>
>
>
> As I see it, the two problems are:
>
> 1.  add1.lm ignores any offset present in its "object" argument.
>
> 2.  add1.lm and add1.glm both take weights directly from their "object"
> argument, and add1.glm also does the same for any offset that is
> present.  But this does not work when the upper scope includes missing
> values and na.omit is used: the weights (and offset) then have the
> wrong length.  They should presumably be extracted instead from the
> reduced model frame.
>
>
> If I can be of help in fixing these things, please let me know.  But I
> don't want to make things worse, or to duplicate anyone else's work.  I
> don't see this fixed in the bug-fix list at
>   https://svn.r-project.org/R/trunk/NEWS
> but I haven't checked whether the same problems are in the current
> r-devel.
>
> David
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From w.northcott at unsw.edu.au  Fri Aug  5 09:56:46 2005
From: w.northcott at unsw.edu.au (Bill Northcott)
Date: Fri, 5 Aug 2005 17:56:46 +1000
Subject: [Rd] call fortran in R
In-Reply-To: <mailman.11.1123149601.14118.r-devel@r-project.org>
References: <mailman.11.1123149601.14118.r-devel@r-project.org>
Message-ID: <57C920C7-A752-4794-A299-6FB91179C5BD@unsw.edu.au>

On 04/08/2005, at 8:00 PM, Sebastien Durand wrote:
> I used a mac G5, R.2.1.1, and G77 3.4.4 and I would like to use and
> call a fortran subroutine.
> The trouble is that it seems I am not able to correctly load the
> compiled code.

.................

>      base
> 2  /Library/Frameworks/R.framework/Resources/library/grDevices/libs/
> grDevices.so
> 3          /Library/Frameworks/R.framework/Resources/library/stats/
> libs/stats.so
> 4      /Library/Frameworks/R.framework/Resources/library/methods/libs/
> methods.so
> 5   /Users/sebas/Desktop/Fortan_kmeans/kmeans3.so
>
>     Dynamic.Lookup
> 1           FALSE
> 2           FALSE
> 3           FALSE
> 4           FALSE
> 5            TRUE

I really wish someone would make these issues clear in MacOS R  
documentation.

MacOS X 10.3 Panther uses gcc-3.3 as its default compiler.  The R  
binary is built with gcc-3.3 and g77 3.4 so that it will run on Panther.

MacOS X 10.4 Tiger uses gcc-4.00 as its default compiler.  This  
causes two problems.
1.  Fortran objects built with g77 cannot be linked with C/C++  
objects built with gcc-4.0.  So an R package with a mixture of C and  
Fortran code will very likely fail at some point.
2.  Even if you specifically invoke gcc-3.3 and g77 the code will  
still fail to link because it needs a symlink /usr/lib/ 
libcc_dynamic.dylib which points to libgcc.a.  This link is missing  
if the default gcc-4.0 is the selected compiler.  (It is missing  
because it does not work with gcc-4).

If you want to build Fortran source packages on Tiger using the R  
binary distribution, you need to to do
'sudo gcc_select 3.3'

That command will make gcc-3.3 the default compiler and reinstate the  
symlink, which recreates the environment in which the R binary was  
built.   You can always go back to gcc-4.0 with 'sudo gcc_select 4.0'.

Bill Northcott


From roebuck at odin.mdacc.tmc.edu  Fri Aug  5 10:09:51 2005
From: roebuck at odin.mdacc.tmc.edu (Paul Roebuck)
Date: Fri, 5 Aug 2005 03:09:51 -0500 (CDT)
Subject: [Rd] S4 generating function
Message-ID: <Pine.OSF.4.58.0508050253370.278029@odin.mdacc.tmc.edu>

Can someone explain what the problem is when I use the
generating function? And how to get debug() to stop in
the Superclass initialize method?


---- source -----
setClass("Superclass",
         representation(id = "character"),
         contains = "VIRTUAL")

setMethod("initialize",
          signature(.Object = "Superclass"),
          function(.Object, id = "") {
              cat("initialize (Superclass)", "\n")
              if (length(id) > 0) {
                  cat("\tid =", id, "\n")
                  .Object at id <- id
              }
              .Object
          })

setClass("Subclass",
         contains = "Superclass")

setMethod("initialize",
          signature(.Object = "Subclass"),
          function(.Object, ...) {
              cat("initialize (Subclass)", "\n")
              cat("\t... =");str(list(...));cat("\n")
              callNextMethod(.Object, ...)
          })

Subclass <- function(id = "") {
    new("Subclass", id = id)
}

cat("*** Create class using new() ***\n")
str(new("Subclass", id = "test1"))

cat("*** Create class using generating function ***\n")
str(Subclass(id = "test2"))


---- output -----
*** Create class using new() ***
initialize (Subclass)
        ... =List of 1
 $ id: chr "test1"

initialize (Superclass)
        id = test1
Formal class 'Subclass' [package ".GlobalEnv"] with 1 slots
  ..@ id: chr "test1"
*** Create class using generating function ***
initialize (Subclass)
        ... =List of 1
 $ id: chr "test2"

initialize (Superclass)
Error in .local(.Object, ...) : Object "id" not found


Thanks

----------------------------------------------------------
SIGSIG -- signature too long (core dumped)


From maechler at stat.math.ethz.ch  Fri Aug  5 14:18:48 2005
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Fri, 5 Aug 2005 14:18:48 +0200
Subject: [Rd] R CMD check failing to warn when it should
In-Reply-To: <eb555e660508031152696cd9fd@mail.gmail.com>
References: <eb555e660508031152696cd9fd@mail.gmail.com>
Message-ID: <17139.22824.74202.313633@stat.math.ethz.ch>

>>>>> "DeepS" == Deepayan Sarkar <deepayan.sarkar at gmail.com>
>>>>>     on Wed, 3 Aug 2005 13:52:32 -0500 writes:

    DeepS> Hi, I recently made changes to lattice code which
    DeepS> needed changes in many man pages as well. Before I
    DeepS> made the appropriate changes, R CMD check was
    DeepS> flagging most of the problems correctly, except for
    DeepS> the man page for tmd. I have created a toy package
    DeepS> that shows this, available at

    DeepS> http://www.stat.wisc.edu/~deepayan/R/tmdprob_0.12-2.tar.gz

    DeepS> This passes R CMD check on R 2.1.0 and r-devel from
    DeepS> August 1, but it shouldn't because the code and
    DeepS> documentation are inconsistent.

It's because you use \synopsis{}.  
This basically breaks all 'codoc' checking and is the reason
we (mainly Kurt, but I completely agree with him) have been
thinking about deprecating its use -- possibly using a
substitute for the few cases that might need something like it.

Kurt and I (at least) would very strongly advocate not to use
\synopsis{}, and hence writing functions and methods in a way
that can be well documented with exact \usage{....}.

Martin


From maechler at stat.math.ethz.ch  Fri Aug  5 14:21:17 2005
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Fri, 5 Aug 2005 14:21:17 +0200
Subject: [Rd] object.size() bug?
In-Reply-To: <Pine.OSF.4.58.0508040019540.201601@odin.mdacc.tmc.edu>
References: <Pine.OSF.4.58.0508040019540.201601@odin.mdacc.tmc.edu>
Message-ID: <17139.22973.592057.275242@stat.math.ethz.ch>

>>>>> "Paul" == Paul Roebuck <roebuck at odin.mdacc.tmc.edu>
>>>>>     on Thu, 4 Aug 2005 00:29:03 -0500 (CDT) writes:

    Paul> Can someone confirm the following as a problem:

Yes, I can.  No promiss for a fix in the very near future
though.

Martin Maechler, ETH Zurich

>> Can someone confirm the following as a problem:
>> 
>> R> setClass("Foo", representation(.handle = "externalptr"))
>> R> object.size(new("Foo"))
>> Error in object.size(new("Foo")) : object.size: unknown type 22
>> R> R.version.string
>> [1] "R version 2.1.1, 2005-06-20"
>> 
>> R-2.1.1/src/include/Rinternals.h
>> #define EXTPTRSXP   22    /* external pointer */
>> 
>> R-2.1.1/src/main/size.c:
>> objectsize(SEXP s) has no case for external pointers


From rpeng at jhsph.edu  Fri Aug  5 14:39:49 2005
From: rpeng at jhsph.edu (Roger D. Peng)
Date: Fri, 05 Aug 2005 08:39:49 -0400
Subject: [Rd] object.size() bug?
In-Reply-To: <17139.22973.592057.275242@stat.math.ethz.ch>
References: <Pine.OSF.4.58.0508040019540.201601@odin.mdacc.tmc.edu>
	<17139.22973.592057.275242@stat.math.ethz.ch>
Message-ID: <42F35E15.4000105@jhsph.edu>

Would it make sense for 'object.size()' to do the same thing for 
external pointers as it does for environments?

-roger

Martin Maechler wrote:
>>>>>>"Paul" == Paul Roebuck <roebuck at odin.mdacc.tmc.edu>
>>>>>>    on Thu, 4 Aug 2005 00:29:03 -0500 (CDT) writes:
> 
> 
>     Paul> Can someone confirm the following as a problem:
> 
> Yes, I can.  No promiss for a fix in the very near future
> though.
> 
> Martin Maechler, ETH Zurich
> 
> 
>>>Can someone confirm the following as a problem:
>>>
>>>R> setClass("Foo", representation(.handle = "externalptr"))
>>>R> object.size(new("Foo"))
>>>Error in object.size(new("Foo")) : object.size: unknown type 22
>>>R> R.version.string
>>>[1] "R version 2.1.1, 2005-06-20"
>>>
>>>R-2.1.1/src/include/Rinternals.h
>>>#define EXTPTRSXP   22    /* external pointer */
>>>
>>>R-2.1.1/src/main/size.c:
>>>objectsize(SEXP s) has no case for external pointers
> 
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 

-- 
Roger D. Peng
http://www.biostat.jhsph.edu/~rpeng/


From murdoch at stats.uwo.ca  Fri Aug  5 14:53:56 2005
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Fri, 05 Aug 2005 08:53:56 -0400
Subject: [Rd] object.size() bug?
In-Reply-To: <42F35E15.4000105@jhsph.edu>
References: <Pine.OSF.4.58.0508040019540.201601@odin.mdacc.tmc.edu>	<17139.22973.592057.275242@stat.math.ethz.ch>
	<42F35E15.4000105@jhsph.edu>
Message-ID: <42F36164.6070106@stats.uwo.ca>

On 8/5/2005 8:39 AM, Roger D. Peng wrote:
> Would it make sense for 'object.size()' to do the same thing for 
> external pointers as it does for environments?

I would think so.  For those who haven't looked, this returns the size 
of the SEXP for the environment and its attributes, but does not attempt 
to work out the size of the contents of the environment.  This makes 
sense, because environments are references.  External pointers are also 
references, so their object size should be the size of the pointer 
(which is probably 28 bytes; R pointers carry a lot of baggage!), with 
no attempt to say anything about the external thing they point to.

Duncan Murdoch


> -roger
> 
> Martin Maechler wrote:
>>>>>>>"Paul" == Paul Roebuck <roebuck at odin.mdacc.tmc.edu>
>>>>>>>    on Thu, 4 Aug 2005 00:29:03 -0500 (CDT) writes:
>> 
>> 
>>     Paul> Can someone confirm the following as a problem:
>> 
>> Yes, I can.  No promiss for a fix in the very near future
>> though.
>> 
>> Martin Maechler, ETH Zurich
>> 
>> 
>>>>Can someone confirm the following as a problem:
>>>>
>>>>R> setClass("Foo", representation(.handle = "externalptr"))
>>>>R> object.size(new("Foo"))
>>>>Error in object.size(new("Foo")) : object.size: unknown type 22
>>>>R> R.version.string
>>>>[1] "R version 2.1.1, 2005-06-20"
>>>>
>>>>R-2.1.1/src/include/Rinternals.h
>>>>#define EXTPTRSXP   22    /* external pointer */
>>>>
>>>>R-2.1.1/src/main/size.c:
>>>>objectsize(SEXP s) has no case for external pointers
>> 
>> 
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>> 
>


From jmc at R-project.org  Fri Aug  5 15:39:31 2005
From: jmc at R-project.org (John Chambers)
Date: Fri, 05 Aug 2005 09:39:31 -0400
Subject: [Rd] S4 generating function
In-Reply-To: <Pine.OSF.4.58.0508050253370.278029@odin.mdacc.tmc.edu>
References: <Pine.OSF.4.58.0508050253370.278029@odin.mdacc.tmc.edu>
Message-ID: <42F36C13.5060803@R-project.org>

First, anyone planning to debug methods should consider the general form 
of the trace() function with signature= to say what method to trace, and 
some suitable interactive function such as "browser" or "recover" to 
examine the computations. See ?trace

In this example, something like:
   trace("initialize", sig="Superclass", browser)

Now, the specific example.  There are 3 special features used:
1. Nonstandard arguments for the initialize method (its official 
arguments are (.Object, ...))

2. callNextMethod

3. within callNextMethod, providing explicit arguments.  The simple case 
is callNextMethod(), which passes on the arguments to the current method.

Turns out that it's the third step that finds a bug in the heuristics 
used by callNextMethod to construct the actual call.

In your example, you don't need the explicit arguments since they just 
replicate the formal arguments to initialize().  If you omit them, the 
computation is simpler & works.

The bug can probably be fixed, but until 2.2 comes out at least, you 
need to stick to the simpler callNextMethod().


Removing the extraneous cat() and str() calls, the revised example is:
------------
R> setClass("Superclass", representation(id = "character"),
     contains = "VIRTUAL")
[1] "Superclass"

R> setMethod("initialize", signature(.Object = "Superclass"),
     function(.Object, id = "") {
         if (length(id) > 0) {
             .Object at id <- i .... [TRUNCATED]
[1] "initialize"

R> setClass("Subclass", contains = "Superclass")
[1] "Subclass"

R> setMethod("initialize", signature(.Object = "Subclass"),
     function(.Object, ...) {
         callNextMethod()
     })
[1] "initialize"

R> Subclass <- function(id = "") {
     new("Subclass", id = id)
}

R> new("Subclass", id = "test1")
An object of class ?Subclass?
Slot "id":
[1] "test1"


R> Subclass(id = "test2")
An object of class ?Subclass?
Slot "id":
[1] "test2"
-----------------------
Paul Roebuck wrote:

> Can someone explain what the problem is when I use the
> generating function? And how to get debug() to stop in
> the Superclass initialize method?
> 
> 
> ---- source -----
> setClass("Superclass",
>          representation(id = "character"),
>          contains = "VIRTUAL")
> 
> setMethod("initialize",
>           signature(.Object = "Superclass"),
>           function(.Object, id = "") {
>               cat("initialize (Superclass)", "\n")
>               if (length(id) > 0) {
>                   cat("\tid =", id, "\n")
>                   .Object at id <- id
>               }
>               .Object
>           })
> 
> setClass("Subclass",
>          contains = "Superclass")
> 
> setMethod("initialize",
>           signature(.Object = "Subclass"),
>           function(.Object, ...) {
>               cat("initialize (Subclass)", "\n")
>               cat("\t... =");str(list(...));cat("\n")
>               callNextMethod(.Object, ...)
>           })
> 
> Subclass <- function(id = "") {
>     new("Subclass", id = id)
> }
> 
> cat("*** Create class using new() ***\n")
> str(new("Subclass", id = "test1"))
> 
> cat("*** Create class using generating function ***\n")
> str(Subclass(id = "test2"))
> 
> 
> ---- output -----
> *** Create class using new() ***
> initialize (Subclass)
>         ... =List of 1
>  $ id: chr "test1"
> 
> initialize (Superclass)
>         id = test1
> Formal class 'Subclass' [package ".GlobalEnv"] with 1 slots
>   ..@ id: chr "test1"
> *** Create class using generating function ***
> initialize (Subclass)
>         ... =List of 1
>  $ id: chr "test2"
> 
> initialize (Superclass)
> Error in .local(.Object, ...) : Object "id" not found
> 
> 
> Thanks
> 
> ----------------------------------------------------------
> SIGSIG -- signature too long (core dumped)
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From ripley at stats.ox.ac.uk  Fri Aug  5 15:46:42 2005
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 5 Aug 2005 14:46:42 +0100 (BST)
Subject: [Rd] object.size() bug?
In-Reply-To: <42F36164.6070106@stats.uwo.ca>
References: <Pine.OSF.4.58.0508040019540.201601@odin.mdacc.tmc.edu>
	<17139.22973.592057.275242@stat.math.ethz.ch>
	<42F35E15.4000105@jhsph.edu> <42F36164.6070106@stats.uwo.ca>
Message-ID: <Pine.LNX.4.61.0508051446060.26821@gannet.stats>

On Fri, 5 Aug 2005, Duncan Murdoch wrote:

> On 8/5/2005 8:39 AM, Roger D. Peng wrote:
>> Would it make sense for 'object.size()' to do the same thing for
>> external pointers as it does for environments?
>
> I would think so.  For those who haven't looked, this returns the size
> of the SEXP for the environment and its attributes, but does not attempt
> to work out the size of the contents of the environment.  This makes
> sense, because environments are references.  External pointers are also
> references, so their object size should be the size of the pointer
> (which is probably 28 bytes; R pointers carry a lot of baggage!), with
> no attempt to say anything about the external thing they point to.

I think it might also make sense for the code to warn this had been done.

>
> Duncan Murdoch
>
>
>> -roger
>>
>> Martin Maechler wrote:
>>>>>>>> "Paul" == Paul Roebuck <roebuck at odin.mdacc.tmc.edu>
>>>>>>>>    on Thu, 4 Aug 2005 00:29:03 -0500 (CDT) writes:
>>>
>>>
>>>     Paul> Can someone confirm the following as a problem:
>>>
>>> Yes, I can.  No promiss for a fix in the very near future
>>> though.
>>>
>>> Martin Maechler, ETH Zurich
>>>
>>>
>>>>> Can someone confirm the following as a problem:
>>>>>
>>>>> R> setClass("Foo", representation(.handle = "externalptr"))
>>>>> R> object.size(new("Foo"))
>>>>> Error in object.size(new("Foo")) : object.size: unknown type 22
>>>>> R> R.version.string
>>>>> [1] "R version 2.1.1, 2005-06-20"
>>>>>
>>>>> R-2.1.1/src/include/Rinternals.h
>>>>> #define EXTPTRSXP   22    /* external pointer */
>>>>>
>>>>> R-2.1.1/src/main/size.c:
>>>>> objectsize(SEXP s) has no case for external pointers
>>>
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From jmf at atmosinfo.com  Fri Aug  5 17:17:13 2005
From: jmf at atmosinfo.com (jmf@atmosinfo.com)
Date: Fri,  5 Aug 2005 17:17:13 +0200 (CEST)
Subject: [Rd] unable to start pdf, postscript devices (PR#8052)
Message-ID: <20050805151713.4491413F87@slim.kubism.ku.dk>

Full_Name: Jeffrey Freedman
Version: 2.1.1
OS: Mac 10.4.2
Submission from: (NULL) (169.226.95.21)


All of a sudden, I cannot generate pdf, postscript, jpeg, png graphics. I get
the following error:

R(273) malloc: ***  Deallocation of a pointer not malloced: 0x113e870; This
could be a double free(), or free() called with the middle of an allocated
block; Try setting environment variable MallocHelp to see tools to help debug
Error in pdf(psfile) : unable to start device pdf

This originally happened running R version 2.1.0. I upgraded to 2.1.1 and the
same problem still occurs. No other changes to the operating system and no new
software installation has occurred on the computer running R, which is an Apple
Dual 2 GHz Power PC G5.

Thank you for your attention to this matter.


From ripley at stats.ox.ac.uk  Fri Aug  5 17:49:14 2005
From: ripley at stats.ox.ac.uk (ripley@stats.ox.ac.uk)
Date: Fri,  5 Aug 2005 17:49:14 +0200 (CEST)
Subject: [Rd] unable to start pdf, postscript devices (PR#8052)
Message-ID: <20050805154914.A44CA13F86@slim.kubism.ku.dk>

The following in NEWS is probably relevant:

                 CHANGES IN R VERSION 2.1.1 patched

     o   File creation errors in pdf(), postscript(), xfig() resulted
         in a pointer being freed twice.  (Reported by Matt McCall)

So,

1) Please try R-patched as we do ask you to (before sending a bug report).

2) You probably do not have permission to open the files in the current 
directory, hence the error that is being handled twice.


On Fri, 5 Aug 2005 jmf at atmosinfo.com wrote:

> Full_Name: Jeffrey Freedman
> Version: 2.1.1
> OS: Mac 10.4.2
> Submission from: (NULL) (169.226.95.21)
>
>
> All of a sudden, I cannot generate pdf, postscript, jpeg, png graphics. I get
> the following error:
>
> R(273) malloc: ***  Deallocation of a pointer not malloced: 0x113e870; This
> could be a double free(), or free() called with the middle of an allocated
> block; Try setting environment variable MallocHelp to see tools to help debug
> Error in pdf(psfile) : unable to start device pdf
>
> This originally happened running R version 2.1.0. I upgraded to 2.1.1 and the
> same problem still occurs. No other changes to the operating system and no new
> software installation has occurred on the computer running R, which is an Apple
> Dual 2 GHz Power PC G5.
>
> Thank you for your attention to this matter.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From roebuck at odin.mdacc.tmc.edu  Fri Aug  5 18:06:44 2005
From: roebuck at odin.mdacc.tmc.edu (Paul Roebuck)
Date: Fri, 5 Aug 2005 11:06:44 -0500 (CDT)
Subject: [Rd] S4 generating function
In-Reply-To: <42F36C13.5060803@R-project.org>
References: <Pine.OSF.4.58.0508050253370.278029@odin.mdacc.tmc.edu>
	<42F36C13.5060803@R-project.org>
Message-ID: <Pine.OSF.4.58.0508051031080.304121@odin.mdacc.tmc.edu>

On Fri, 5 Aug 2005, John Chambers wrote:

> Paul Roebuck wrote:
>
> > Can someone explain what the problem is when I use the
> > generating function? And how to get debug() to stop in
> > the Superclass initialize method?
> > [SNIP code & output]
>
> Now, the specific example.  There are 3 special features used:
> 1. Nonstandard arguments for the initialize method (its official
> arguments are (.Object, ...))
>
> 2. callNextMethod
>
> 3. within callNextMethod, providing explicit arguments.  The simple case
> is callNextMethod(), which passes on the arguments to the current method.
>
> Turns out that it's the third step that finds a bug in the heuristics
> used by callNextMethod to construct the actual call.
>
> In your example, you don't need the explicit arguments since they just
> replicate the formal arguments to initialize().  If you omit them, the
> computation is simpler & works.
>
> The bug can probably be fixed, but until 2.2 comes out at least, you
> need to stick to the simpler callNextMethod().
> [SNIP modified code]

Thank you for your help. Unfortunately, this is a case where
posting the simplest code necessary to display the bug works
against the poster. Actual code uses external pointers but
this revision shows more of the general concept.

If I understand your description correctly, the problem is
passing both named and unnamed arguments to callNextMethod().
Can I [easily] do either of these things to avoid the bug?

  1) somehow add an argument to 'dots' and invoke callNextMethod()
     without arguments?
  2) parse 'dots' and invoke callNextMethod() with a completely
     named argument list?


------ revised source -------
setClass("Superclass",
         representation(.values = "integer",
                        id      = "character"),
         contains = "VIRTUAL")

setMethod("initialize",
          signature(.Object = "Superclass"),
          function(.Object, .values = NULL, id = "") {
              cat("initialize (Superclass)", "\n")
              if (!is.null(.values)) {
                  cat("\t.values =", .values, "\n")
                  .Object at .values <- .values
              }
              if (length(id) > 0) {
                  cat("\tid =", id, "\n")
                  .Object at id <- id
              }
              .Object
          })

setClass("Subclass",
         contains = "Superclass")

setMethod("initialize",
          signature(.Object = "Subclass"),
          function(.Object, count = 1, ...) {
              cat("initialize (Subclass)", "\n")
              dots <- list(...)
              cat("\t... =");str(dots);cat("\n")
              .values = integer(count)
              callNextMethod(.Object, .values = .values, ...)
          })

Subclass <- function(count, id = "") {
    new("Subclass", count, id = id)
}

cat("*** Create class using new() ***\n")
str(new("Subclass", id = "test0"))
str(new("Subclass", count = 3, id = "test1"))

cat("*** Create class using generating function ***\n")
#trace("initialize", signature = "Subclass", browser)
str(Subclass(count = 3, id = "test2"))

----------------------------------------------------------
SIGSIG -- signature too long (core dumped)


From gunter.berton at gene.com  Fri Aug  5 19:07:08 2005
From: gunter.berton at gene.com (gunter.berton@gene.com)
Date: Fri,  5 Aug 2005 19:07:08 +0200 (CEST)
Subject: [Rd] S4 setClass with prototypes " issues" (PR#8053)
Message-ID: <20050805170708.8A81E11F34@slim.kubism.ku.dk>

To R-Developers:

I wish to report what I believe are inconsistencies between Green Book
descriptions and R methods behaviors. I **realize** that R does not
guarantee total consistency with the Green Book; therefore I leave it to you
to decide whether any of this is a bug, design choice, or a need for
additional documentation -- or whether I have simply misread or overlooked
existing explanations. If the latter, I apologize for the error, but it was
not for a want of effort.

The issues all revolve around the setClass('xxx',prototype=...) without any
slots construction. All references are to the Green Book. R 2.1.1 (on
Windows)

1. Classes so defined (with protype, no slots) are not instantiated as
described on the bottom of p.289. In particular, the following example from
the book fails:

> setClass('sequence',prototype=numeric(3))
[1] "sequence"
> new('sequence',c(1,51,10))
Error in initialize(value, ...) : cannot use object of class "numeric" in
new():  class "sequence" does not extend that class
 
2. I have been unable to find any Help documentation about the proper method
to instantiate classes defined by prototypes without slots. Experimentation
showed that only one of the two approaches on the bottom of p.289 worked:

> setClass('foo',prototype=numeric())
[1] "foo"
> z<-new('foo')
## new() works as it should
> z
An object of class "foo"
numeric(0)

## But now try this ...
> z<-1:3
> is(z,'numeric')
[1] TRUE
## Hence, if R followed the book's statement that "For this to work,
'object' must either be suitable as a prototype for 'myClass or belong to a
class that can be coerced to 'myClass.'" (Note, I interpret this to mean
that either of these conditions are sufficient for either of the approaches
shown).

> as(z,'foo')
Error in as(z, "foo") : no method or default for coercing "integer" to "foo"

## But
> class(z)<-'foo'
> z
An object of class "foo"
[1] 1 2 3

I was unable to find documentation for this behavior in R, assuming that
this is not a bug. If it's a bug, it should be fixed, of course; if not, I
think the behavior should be documented, perhaps in setClass.

3. Finally, and most disconcertingly, The Green Book says (p.288):

"... We do NOT want a 'sequence' object to be interpreted as a numeric
vector ... Doing arbitrary arithmetic on the object, for example would be
disastrous...

The use of prototypes without representations allows the class designer to
limit the legal computations on objects made up of numeric data..."

As I read this, this should mean that the following should fail, but it
doesn't (continuing the above example):

> z+1
An object of class "foo"
[1] 2 3 4

Again, if this is not a bug, I think that this lack of adherence to the
Green book should be documented in R. May I say, however, that I wish R had
implemented the book's prescription.


-- Bert Gunter
Genentech Non-Clinical Statistics
South San Francisco, CA
 
"The business of the statistician is to catalyze the scientific learning
process."  - George E. P. Box


From jmc at R-project.org  Fri Aug  5 21:06:55 2005
From: jmc at R-project.org (John Chambers)
Date: Fri, 05 Aug 2005 15:06:55 -0400
Subject: [Rd] S4 setClass with prototypes " issues" (PR#8053)
In-Reply-To: <20050805170708.8A81E11F34@slim.kubism.ku.dk>
References: <20050805170708.8A81E11F34@slim.kubism.ku.dk>
Message-ID: <42F3B8CF.9090104@R-project.org>

Well, let's say R is currently picky when only a prototype is supplied.

The following is either a workaround or a revised, fussier requirement 
for the example mentioned, depending on your interpretation.

R> setClass("sequence", representation(.Data="numeric"), 
prototype=numeric(3))
[1] "sequence"
R> xx <- new('sequence',c(1,51,10))
R> xx
An object of class ?sequence?
[1]  1 51 10
R> is(xx, "numeric")
[1] FALSE

So far, so good.  But there are a couple of catches.

The resolution of prototype and representation is currently somewhat of 
a mess in the R implementation.  There's been some discussion of 
cleaning it up, hopefully moving ahead from the Green Book description 
to a more coherent definition.  So whether eventually one could (or 
should) omit the representation() part remains to be seen.

The other relevant flaw currently is that S4 objects have no special 
internal representation in R, so there's effectively no way to keep 
primitive operations from working on them. (The general & notorious 
example is that xx[] always returns something on an S4 object, even when 
it shouldn't.)  In the current case, the problem is that, in spite of 
not extending "numeric", low-level arithmetic is still done.

R> xx+1
An object of class ?sequence?
[1]  2 52 11

Something basic is needed here, in the code for primitives, but so far 
objections re efficiency have prevented doing anything.

Meanwhile, those more interested in getting something done than 
discussing, would need to implement explicit methods for the new class 
that either re-interpret or block the primitives that shouldn't happen 
in the standard way.


gunter.berton at gene.com wrote:

> To R-Developers:
> 
> I wish to report what I believe are inconsistencies between Green Book
> descriptions and R methods behaviors. I **realize** that R does not
> guarantee total consistency with the Green Book; therefore I leave it to you
> to decide whether any of this is a bug, design choice, or a need for
> additional documentation -- or whether I have simply misread or overlooked
> existing explanations. If the latter, I apologize for the error, but it was
> not for a want of effort.
> 
> The issues all revolve around the setClass('xxx',prototype=...) without any
> slots construction. All references are to the Green Book. R 2.1.1 (on
> Windows)
> 
> 1. Classes so defined (with protype, no slots) are not instantiated as
> described on the bottom of p.289. In particular, the following example from
> the book fails:
> 
> 
>>setClass('sequence',prototype=numeric(3))
> 
> [1] "sequence"
> 
>>new('sequence',c(1,51,10))
> 
> Error in initialize(value, ...) : cannot use object of class "numeric" in
> new():  class "sequence" does not extend that class
>  
> 2. I have been unable to find any Help documentation about the proper method
> to instantiate classes defined by prototypes without slots. Experimentation
> showed that only one of the two approaches on the bottom of p.289 worked:
> 
> 
>>setClass('foo',prototype=numeric())
> 
> [1] "foo"
> 
>>z<-new('foo')
> 
> ## new() works as it should
> 
>>z
> 
> An object of class "foo"
> numeric(0)
> 
> ## But now try this ...
> 
>>z<-1:3
>>is(z,'numeric')
> 
> [1] TRUE
> ## Hence, if R followed the book's statement that "For this to work,
> 'object' must either be suitable as a prototype for 'myClass or belong to a
> class that can be coerced to 'myClass.'" (Note, I interpret this to mean
> that either of these conditions are sufficient for either of the approaches
> shown).
> 
> 
>>as(z,'foo')
> 
> Error in as(z, "foo") : no method or default for coercing "integer" to "foo"
> 
> ## But
> 
>>class(z)<-'foo'
>>z
> 
> An object of class "foo"
> [1] 1 2 3
> 
> I was unable to find documentation for this behavior in R, assuming that
> this is not a bug. If it's a bug, it should be fixed, of course; if not, I
> think the behavior should be documented, perhaps in setClass.
> 
> 3. Finally, and most disconcertingly, The Green Book says (p.288):
> 
> "... We do NOT want a 'sequence' object to be interpreted as a numeric
> vector ... Doing arbitrary arithmetic on the object, for example would be
> disastrous...
> 
> The use of prototypes without representations allows the class designer to
> limit the legal computations on objects made up of numeric data..."
> 
> As I read this, this should mean that the following should fail, but it
> doesn't (continuing the above example):
> 
> 
>>z+1
> 
> An object of class "foo"
> [1] 2 3 4
> 
> Again, if this is not a bug, I think that this lack of adherence to the
> Green book should be documented in R. May I say, however, that I wish R had
> implemented the book's prescription.
> 
> 
> -- Bert Gunter
> Genentech Non-Clinical Statistics
> South San Francisco, CA
>  
> "The business of the statistician is to catalyze the scientific learning
> process."  - George E. P. Box
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From jmc at R-project.org  Fri Aug  5 21:18:50 2005
From: jmc at R-project.org (John Chambers)
Date: Fri, 05 Aug 2005 15:18:50 -0400
Subject: [Rd] S4 generating function
In-Reply-To: <Pine.OSF.4.58.0508051031080.304121@odin.mdacc.tmc.edu>
References: <Pine.OSF.4.58.0508050253370.278029@odin.mdacc.tmc.edu>
	<42F36C13.5060803@R-project.org>
	<Pine.OSF.4.58.0508051031080.304121@odin.mdacc.tmc.edu>
Message-ID: <42F3BB9A.2080609@R-project.org>

Re:
 > If I understand your description correctly, the problem is
 > passing both named and unnamed arguments to callNextMethod().

No, as I said the distinction is a potential bug in callNextMethod 
_whenever_ it gets explicit arguments.  (At the moment, it seems to be a 
bug in substitute() or else a different interpretation of that function 
from the one in the Blue Book.  But I've only looked a little.)

So to work around it you have to be able to do callNextMethod() with no 
arguments.

Just at a guess, you may be able to do that if you avoid redefining the 
formal arguments for the initialize() method.  Leave them as .Object, 
... and extract the id= component.
   dotArgs <- list(...)
   id <- dotArgs$id

Or, wait for a fix.  There should at least be one in r-devel sometime 
fairly soon.


Paul Roebuck wrote:

> On Fri, 5 Aug 2005, John Chambers wrote:
> 
> 
>>Paul Roebuck wrote:
>>
>>
>>>Can someone explain what the problem is when I use the
>>>generating function? And how to get debug() to stop in
>>>the Superclass initialize method?
>>>[SNIP code & output]
>>
>>Now, the specific example.  There are 3 special features used:
>>1. Nonstandard arguments for the initialize method (its official
>>arguments are (.Object, ...))
>>
>>2. callNextMethod
>>
>>3. within callNextMethod, providing explicit arguments.  The simple case
>>is callNextMethod(), which passes on the arguments to the current method.
>>
>>Turns out that it's the third step that finds a bug in the heuristics
>>used by callNextMethod to construct the actual call.
>>
>>In your example, you don't need the explicit arguments since they just
>>replicate the formal arguments to initialize().  If you omit them, the
>>computation is simpler & works.
>>
>>The bug can probably be fixed, but until 2.2 comes out at least, you
>>need to stick to the simpler callNextMethod().
>>[SNIP modified code]
> 
> 
> Thank you for your help. Unfortunately, this is a case where
> posting the simplest code necessary to display the bug works
> against the poster. Actual code uses external pointers but
> this revision shows more of the general concept.
> 
> If I understand your description correctly, the problem is
> passing both named and unnamed arguments to callNextMethod().
> Can I [easily] do either of these things to avoid the bug?
> 
>   1) somehow add an argument to 'dots' and invoke callNextMethod()
>      without arguments?
>   2) parse 'dots' and invoke callNextMethod() with a completely
>      named argument list?
> 
> 
> ------ revised source -------
> setClass("Superclass",
>          representation(.values = "integer",
>                         id      = "character"),
>          contains = "VIRTUAL")
> 
> setMethod("initialize",
>           signature(.Object = "Superclass"),
>           function(.Object, .values = NULL, id = "") {
>               cat("initialize (Superclass)", "\n")
>               if (!is.null(.values)) {
>                   cat("\t.values =", .values, "\n")
>                   .Object at .values <- .values
>               }
>               if (length(id) > 0) {
>                   cat("\tid =", id, "\n")
>                   .Object at id <- id
>               }
>               .Object
>           })
> 
> setClass("Subclass",
>          contains = "Superclass")
> 
> setMethod("initialize",
>           signature(.Object = "Subclass"),
>           function(.Object, count = 1, ...) {
>               cat("initialize (Subclass)", "\n")
>               dots <- list(...)
>               cat("\t... =");str(dots);cat("\n")
>               .values = integer(count)
>               callNextMethod(.Object, .values = .values, ...)
>           })
> 
> Subclass <- function(count, id = "") {
>     new("Subclass", count, id = id)
> }
> 
> cat("*** Create class using new() ***\n")
> str(new("Subclass", id = "test0"))
> str(new("Subclass", count = 3, id = "test1"))
> 
> cat("*** Create class using generating function ***\n")
> #trace("initialize", signature = "Subclass", browser)
> str(Subclass(count = 3, id = "test2"))
> 
> ----------------------------------------------------------
> SIGSIG -- signature too long (core dumped)
>


From sebastien.durand at UMontreal.CA  Fri Aug  5 21:38:39 2005
From: sebastien.durand at UMontreal.CA (=?ISO-8859-1?Q?S=E9bastien_Durand?=)
Date: Fri, 5 Aug 2005 15:38:39 -0400
Subject: [Rd] call fortran in R
In-Reply-To: <EF6A9FD1-53BE-4DE3-81B5-E2634E91D7AF@mclink.it>
References: <BB026B1E-17AE-42A2-B86E-6C74337202D1@UMontreal.CA>
	<EF6A9FD1-53BE-4DE3-81B5-E2634E91D7AF@mclink.it>
Message-ID: <83DE413D-C09B-4FB6-B3FC-BB68E7192AD8@UMontreal.CA>

I am starting to get confused,

What should I used to make sure I got the corrected and most recent  
setup that will allow me to correctly compile and run fortran routine  
under R.2.1.1

Please note that I am using the last version of MAC OS X, TIGER which  
is 10.4.2

And that I have presently installed Developer tools (XCODE), 2.2.


For your own information what I have presently installed is :

Double-G5:~ sebas$ gfortran -v
Using built-in specs.
Target: powerpc-apple-darwin8.1.0
Configured with: ../gcc-4.1-20050611/configure --enable-threads=posix  
--enable-languages=c++,f95
Thread model: posix
gcc version 4.1.0 20050611 (experimental)

Double-G5:~ sebas$ gcc -v
Using built-in specs.
Target: powerpc-apple-darwin8
Configured with: /private/var/tmp/gcc/gcc-5026.obj~19/src/configure -- 
disable-checking --prefix=/usr --mandir=/share/man --enable- 
languages=c,objc,c++,obj-c++ --program-transform-name=/^[cg][^+.-]*$/ 
s/$/-4.0/ --with-gxx-include-dir=/include/gcc/darwin/4.0/c++ -- 
build=powerpc-apple-darwin8 --host=powerpc-apple-darwin8 -- 
target=powerpc-apple-darwin8
Thread model: posix

gcc version 4.0.0 (Apple Computer, Inc. build 5026)
Double-G5:~ sebas$ g77 -v
Reading specs from /usr/local/lib/gcc/powerpc-apple-darwin6.8/3.4.2/ 
specs
Configured with: ../gcc/configure --enable-threads=posix --enable- 
languages=f77 --disable-shared --enable-static
Thread model: posix
gcc version 3.4.2

Thanks in advance



> please don't mix gcc 4.0 and g77. Also don't mix R binary which is  
> gcc-3.3/g77-3.4.2 with gcc4 or gfortran.
> stefano
>
> On 04/ago/05, at 17:25, S?bastien Durand wrote:
>
>
>> Dear all,
>>
>> Since the command you ask me to type doesn't show anything
>> Here some more information, on my system and on the foo.so  
>> compiled file
>>
>> I am using g77 version 3.4.4  Configured with: ../gcc/configure --
>> enable-threads=posix --enable-languages=f77
>>
>> I am using gcc version 4.0.0 20041026 (Apple Computer, Inc. build  
>> 4061)
>>          Configured with: /private/var/tmp/gcc/gcc-4061.obj~8/src/
>> configure --disable-checking --prefix=/usr --mandir=/share/man --
>> enable-languages=c,objc,c++,obj-c++ --program-transform-name=/^[cg][^
>> +.-]*$/s/$/-4.0/
>>          --with-gxx-include-dir=/include/gcc/darwin/4.0/c++ --
>> build=powerpc-apple-darwin8 --host=powerpc-apple-darwin8 --
>> target=powerpc-apple-darwin8
>>
>> I don't know if this can be of any help to you but there is again how
>> I compile the foo.f
>>
>> Double-G5:~ sebas$ R CMD SHLIB  ~/Desktop/Fortan_kmeans/kmeans3.f
>>          g77   -fno-common  -g -O2 -c /Users/sebas/Desktop/
>> Fortan_kmeans/kmeans3.f -o /Users/sebas/Desktop/Fortan_kmeans/ 
>> kmeans3.o
>>          gcc-3.3 -bundle -flat_namespace -undefined suppress -L/usr/
>> local/lib -o /Users/sebas/Desktop/Fortan_kmeans/kmeans3.so /Users/
>> sebas/Desktop/Fortan_kmeans/kmeans3.o  -L/usr/local/lib/gcc/powerpc-
>> apple-darwin6.8/3.4.2 -lg2c -lSystem -framework R
>>
>>
>> There is all the info about the foo.so file using nm -a option
>> instead of -g:
>>
>>
>> Double-G5:~ sebas$ nm -a ~/Desktop/Fortan_kmeans/kmeans3.so
>> 00000fe4 - 01 0114 SLINE
>> 00000fb0 - 01 0000    SO
>> 00000fd8 - 01 010d SLINE
>> 00000fdc - 01 010e SLINE
>> 00000fe0 - 01 010f SLINE
>> 00000fec - 01 0116 SLINE
>> 00000fe8 - 01 0115 SLINE
>> 00001000 - 01 0000    SO
>> 00001000 - 01 011b SLINE
>> 00000ffc - 01 011a SLINE
>> 00000ff8 - 01 0119 SLINE
>> 00000fb4 - 01 0104 SLINE
>> 00000fb8 - 01 0105 SLINE
>> 00000fbc - 01 0106 SLINE
>> 00000fc0 - 01 0107 SLINE
>> 00000fc4 - 01 0108 SLINE
>> 00000ff4 - 01 0118 SLINE
>> 00000fc8 - 01 0109 SLINE
>> 00000fcc - 01 010a SLINE
>> 00000fd0 - 01 010b SLINE
>> 00000fd4 - 01 010c SLINE
>> 00000ff0 - 01 0117 SLINE
>> 00000fb0 - 01 0000   SOL /SourceCache/Csu/Csu-57//
>> 00000fb0 - 01 0000   SOL /SourceCache/Csu/Csu-57/bundle1.s
>> 00000fb0 - 01 0000   SOL /SourceCache/Csu/Csu-57/bundle1.s
>> 00000fb0 - 01 0000   SOL /SourceCache/Csu/Csu-57/bundle1.s
>> 00000fb0 - 01 0000    SO /Users/sebas/
>> 00000fb0 - 01 0000    SO /Users/sebas/Desktop/Fortan_kmeans/kmeans3.f
>> 00000fb0 - 01 0000   SOL <built-in>
>> 00000fb0 - 01 0000   SOL <command line>
>> 00000fe0 t __dyld_func_lookup
>> 00000fe0 - 01 0113   FUN __dyld_func_lookup:F3
>> 00000000 - 00 0000  LSYM __g77_f2c_address:t(0,10)=*(0,11)=@s8;r
>> (0,11);-128;127;
>> 00000000 - 00 0000  LSYM __g77_f2c_complex:t(0,7)=R3;8;0;
>> 00000000 - 00 0000  LSYM __g77_f2c_doublecomplex:t(0,6)=R3;16;0;
>> 00000000 - 00 0000  LSYM __g77_f2c_doublereal:t(0,8)=r(0,0);8;0;
>> 00000000 - 00 0000  LSYM __g77_f2c_flag:t(0,3)=r
>> (0,3);-2147483648;2147483647;
>> 00000000 - 00 0000  LSYM __g77_f2c_ftnint:t(0,1)=r
>> (0,1);-2147483648;2147483647;
>> 00000000 - 00 0000  LSYM __g77_f2c_ftnlen:t(0,2)=r
>> (0,2);-2147483648;2147483647;
>> 00000000 - 00 0000  LSYM __g77_f2c_integer:t(0,12)=r
>> (0,12);-2147483648;2147483647;
>> 00000000 - 00 0000  LSYM __g77_f2c_logical:t(0,4)=r
>> (0,4);-2147483648;2147483647;
>> 00000000 - 00 0000  LSYM __g77_f2c_longint:t(0,5)=@s64;r(0,5);
>> 001000000000000000000000;000777777777777777777777;
>> 00000000 - 00 0000  LSYM __g77_f2c_real:t(0,9)=r(0,0);4;0;
>> 00000000 t __mh_bundle_header
>> 00000000 - 00 0000  LSYM byte:t(0,26)=@s8;r(0,26);-128;127;
>> 00000000 - 00 0000  LSYM char:t(0,46)=@s8;r(0,46);0;255;
>> 00000000 - 00 0000  LSYM char:t2=r2;0;127;
>> 00000000 - 00 0000  LSYM complex double:t(0,31)=R3;16;0;
>> 00000000 - 00 0000  LSYM complex float:t(0,32)=R3;8;0;
>> 00000000 - 00 0000  LSYM complex int:t(0,33)=s8real:(0,34)=r
>> (0,34);-2147483648;2147483647;,0,32;imag:(0,34),32,32;;
>> 00000000 - 00 0000  LSYM complex long double:t(0,30)=R3;16;0;
>> 00000000 - 00 0000  LSYM complex:t(0,14)=R3;8;0;
>> 00000000 - 00 0000  LSYM double complex:t(0,13)=R3;16;0;
>> 00000000 - 00 0000  LSYM double precision:t(0,15)=r(0,0);8;0;
>> 00000000 - 00 0000  LSYM double:t(0,36)=r(0,34);8;0;
>> 00001000 d dyld__mh_bundle_header
>> 00001008 s dyld_func_lookup_pointer
>> 00001004 s dyld_lazy_symbol_binding_entry_point
>> 00000fb0 t dyld_stub_binding_helper
>> 00000fb0 - 01 0103   FUN dyld_stub_binding_helper:F3
>> 00000000 - 00 0000  LSYM float:t(0,37)=r(0,34);4;0;
>> 00000000 - 00 0000   OPT gcc2_compiled.
>> 00000000 - 00 0000  LSYM int:t(0,34)
>> 00000000 - 00 0000  LSYM int:t1=r1;-2147483648;2147483647;
>> 00000000 - 00 0000  LSYM integer4:t(0,22)=@s64;r(0,22);
>> 001000000000000000000000;000777777777777777777777;
>> 00000000 - 00 0000  LSYM integer:t(0,28)=r 
>> (0,28);-2147483648;2147483647;
>> 00000000 - 00 0000  LSYM logical2:t(0,19)=@s8;r(0,19);-128;127;
>> 00000000 - 00 0000  LSYM logical3:t(0,18)=@s16;r(0,18);-32768;32767;
>> 00000000 - 00 0000  LSYM logical4:t(0,17)=@s64;r(0,17);
>> 001000000000000000000000;000777777777777777777777;
>> 00000000 - 00 0000  LSYM logical:t(0,20)=r 
>> (0,20);-2147483648;2147483647;
>> 00000000 - 00 0000  LSYM long double:t(0,35)=r(0,34);8;0;
>> 00000000 - 00 0000  LSYM long int:t(0,45)=r
>> (0,45);-2147483648;2147483647;
>> 00000000 - 00 0000  LSYM long long int:t(0,42)=@s64;r(0,42);
>> 001000000000000000000000;000777777777777777777777;
>> 00000000 - 00 0000  LSYM long long unsigned int:t(0,41)=@s64;r(0,41);
>> 000000000000000000000000;001777777777777777777777;
>> 00000000 - 00 0000  LSYM long unsigned int:t(0,43)=r(0,43);
>> 000000000000000000000000;000000000000037777777777;
>> 00000000 - 00 0000  LSYM real:t(0,16)=r(0,0);4;0;
>> 00000000 - 00 0000  LSYM short int:t(0,40)=@s16;r(0,40);-32768;32767;
>> 00000000 - 00 0000  LSYM short unsigned int:t(0,39)=@s16;r(0,39);
>> 0;65535;
>> 00000000 - 00 0000  LSYM signed char:t(0,11)
>> 00000000 - 00 0000  LSYM unsigned byte:t(0,25)=@s8;r(0,25);0;255;
>> 00000000 - 00 0000  LSYM unsigned char:t(0,38)=@s8;r(0,38);0;255;
>> 00000000 - 00 0000  LSYM unsigned int:t(0,44)=r(0,44);
>> 000000000000000000000000;000000000000037777777777;
>> 00000000 - 00 0000  LSYM unsigned word:t(0,23)=@s16;r(0,23);0;65535;
>> 00000000 - 00 0000  LSYM unsigned4:t(0,21)=@s64;r(0,21);
>> 000000000000000000000000;001777777777777777777777;
>> 00000000 - 00 0000  LSYM unsigned:t(0,27)=r(0,27);
>> 000000000000000000000000;000000000000037777777777;
>> 00000000 - 00 0000  LSYM void:t(0,29)=(0,29)
>> 00000000 - 00 0000  LSYM void:t3=3
>> 00000000 - 00 0000  LSYM word:t(0,24)=@s16;r(0,24);-32768;32767;
>> 00000fb0 - 01 0000    SO {standard input}
>> Double-G5:~ sebas$
>>
>> S.
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
>>
>
>


From ripley at stats.ox.ac.uk  Fri Aug  5 22:01:02 2005
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 5 Aug 2005 21:01:02 +0100 (BST)
Subject: [Rd] Tests of gcc-4.0.1
Message-ID: <Pine.LNX.4.61.0508051512210.30020@gannet.stats>

I had promised to report on tests of gcc-4.0.1, and have now tracked down 
all the outstanding issues.

I am comparing gcc3 (gcc-3.4.4 including g77) and gcc4 (gcc-4.0.1 
including gfortran) on FC3, both i686 and x86_64 (the latter both 64-bit 
and 32-bit builds).  All compiled from the sources (the FC3 update to 
3.4.4 was not out when I started this).

The bottom line is that 4.0.1 shows none of the serious errors that 4.0.0 
showed, but was always slower (usually 4-10% slower) than gcc3 and (see 
below) about 25 CRAN packages fail only about half of which are 
attributable to deficiences in the packages.

The differences between the outputs has shown some places where R is more 
sensitive to rounding errors than might have been thought.  Amongst these 
are

- ppr (that was known)
- lowess, which can be extremely sensitive to the number of iterations
   allowed, as shown by panel 8 in example(attenu).
- contouring, in particular the exact place contour labels are placed.
- str, which depended on a test ob == signif(ob, digits.d), and signif()
   was unnecessarily causing rounding error by dividing by a negative power
   of 10 (now fixed).
- the extreme test in example(smooth.spline), which showed quite large
   differences.

Amongst CRAN packages:

RSvgDevice is said to have invalid C

acepack, deldir, fMultivar, fOptions, fSeries, frailtypack, gap, gcmrec, 
hmm.discnp, labdsv, survrec

have invalid Fortran. (Most of these have been reported to the maintainers 
some time ago.)

Geneland infinite loops
NISTnls, gss, relsurv fail their tests
SparseM, asypow, mvtnorm, party, subselect  segfault
ade4 has an LAPACK error (similar to those seen before)

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From jago at mclink.it  Fri Aug  5 23:07:18 2005
From: jago at mclink.it (stefano iacus)
Date: Fri, 5 Aug 2005 23:07:18 +0200
Subject: [Rd] call fortran in R
In-Reply-To: <83DE413D-C09B-4FB6-B3FC-BB68E7192AD8@UMontreal.CA>
References: <BB026B1E-17AE-42A2-B86E-6C74337202D1@UMontreal.CA>
	<EF6A9FD1-53BE-4DE3-81B5-E2634E91D7AF@mclink.it>
	<83DE413D-C09B-4FB6-B3FC-BB68E7192AD8@UMontreal.CA>
Message-ID: <2167AC92-5265-4ECB-B251-3F849D20615C@mclink.it>

Sebastien,

if you want to use the R binary from CRAN, then you should assume gcc  
3.3 and g77 3.4.2 (which comes with the installer for this reason).
You can force gcc to default to 3.3 using sudo gcc_select 3.3
and sudo gg_select 4.0 to restore the new compiler.


If you want to use gcc 4.0 and gfortran, then you need to rebuild  
ALSO R from sources.
If you are developing a package you probably want to build R from r- 
devel sources (we have recently fixed some configuration issues).

I suggest you to read R for Mac OS X FAQ and also http:// 
wiki.urbanek.info/index.cgi?TigeR

stefano


On 05/ago/05, at 21:38, S?bastien Durand wrote:

> I am starting to get confused,
>
> What should I used to make sure I got the corrected and most recent
> setup that will allow me to correctly compile and run fortran routine
> under R.2.1.1
>
> Please note that I am using the last version of MAC OS X, TIGER which
> is 10.4.2
>
> And that I have presently installed Developer tools (XCODE), 2.2.
>
>
> For your own information what I have presently installed is :
>
> Double-G5:~ sebas$ gfortran -v
> Using built-in specs.
> Target: powerpc-apple-darwin8.1.0
> Configured with: ../gcc-4.1-20050611/configure --enable-threads=posix
> --enable-languages=c++,f95
> Thread model: posix
> gcc version 4.1.0 20050611 (experimental)
>
> Double-G5:~ sebas$ gcc -v
> Using built-in specs.
> Target: powerpc-apple-darwin8
> Configured with: /private/var/tmp/gcc/gcc-5026.obj~19/src/configure --
> disable-checking --prefix=/usr --mandir=/share/man --enable-
> languages=c,objc,c++,obj-c++ --program-transform-name=/^[cg][^+.-]*$/
> s/$/-4.0/ --with-gxx-include-dir=/include/gcc/darwin/4.0/c++ --
> build=powerpc-apple-darwin8 --host=powerpc-apple-darwin8 --
> target=powerpc-apple-darwin8
> Thread model: posix
>
> gcc version 4.0.0 (Apple Computer, Inc. build 5026)
> Double-G5:~ sebas$ g77 -v
> Reading specs from /usr/local/lib/gcc/powerpc-apple-darwin6.8/3.4.2/
> specs
> Configured with: ../gcc/configure --enable-threads=posix --enable-
> languages=f77 --disable-shared --enable-static
> Thread model: posix
> gcc version 3.4.2
>
> Thanks in advance
>
>
>
>
>> please don't mix gcc 4.0 and g77. Also don't mix R binary which is
>> gcc-3.3/g77-3.4.2 with gcc4 or gfortran.
>> stefano
>>
>> On 04/ago/05, at 17:25, S?bastien Durand wrote:
>>
>>
>>
>>> Dear all,
>>>
>>> Since the command you ask me to type doesn't show anything
>>> Here some more information, on my system and on the foo.so
>>> compiled file
>>>
>>> I am using g77 version 3.4.4  Configured with: ../gcc/configure --
>>> enable-threads=posix --enable-languages=f77
>>>
>>> I am using gcc version 4.0.0 20041026 (Apple Computer, Inc. build
>>> 4061)
>>>          Configured with: /private/var/tmp/gcc/gcc-4061.obj~8/src/
>>> configure --disable-checking --prefix=/usr --mandir=/share/man --
>>> enable-languages=c,objc,c++,obj-c++ --program-transform-name=/^ 
>>> [cg][^
>>> +.-]*$/s/$/-4.0/
>>>          --with-gxx-include-dir=/include/gcc/darwin/4.0/c++ --
>>> build=powerpc-apple-darwin8 --host=powerpc-apple-darwin8 --
>>> target=powerpc-apple-darwin8
>>>
>>> I don't know if this can be of any help to you but there is again  
>>> how
>>> I compile the foo.f
>>>
>>> Double-G5:~ sebas$ R CMD SHLIB  ~/Desktop/Fortan_kmeans/kmeans3.f
>>>          g77   -fno-common  -g -O2 -c /Users/sebas/Desktop/
>>> Fortan_kmeans/kmeans3.f -o /Users/sebas/Desktop/Fortan_kmeans/
>>> kmeans3.o
>>>          gcc-3.3 -bundle -flat_namespace -undefined suppress -L/usr/
>>> local/lib -o /Users/sebas/Desktop/Fortan_kmeans/kmeans3.so /Users/
>>> sebas/Desktop/Fortan_kmeans/kmeans3.o  -L/usr/local/lib/gcc/powerpc-
>>> apple-darwin6.8/3.4.2 -lg2c -lSystem -framework R
>>>
>>>
>>> There is all the info about the foo.so file using nm -a option
>>> instead of -g:
>>>
>>>
>>> Double-G5:~ sebas$ nm -a ~/Desktop/Fortan_kmeans/kmeans3.so
>>> 00000fe4 - 01 0114 SLINE
>>> 00000fb0 - 01 0000    SO
>>> 00000fd8 - 01 010d SLINE
>>> 00000fdc - 01 010e SLINE
>>> 00000fe0 - 01 010f SLINE
>>> 00000fec - 01 0116 SLINE
>>> 00000fe8 - 01 0115 SLINE
>>> 00001000 - 01 0000    SO
>>> 00001000 - 01 011b SLINE
>>> 00000ffc - 01 011a SLINE
>>> 00000ff8 - 01 0119 SLINE
>>> 00000fb4 - 01 0104 SLINE
>>> 00000fb8 - 01 0105 SLINE
>>> 00000fbc - 01 0106 SLINE
>>> 00000fc0 - 01 0107 SLINE
>>> 00000fc4 - 01 0108 SLINE
>>> 00000ff4 - 01 0118 SLINE
>>> 00000fc8 - 01 0109 SLINE
>>> 00000fcc - 01 010a SLINE
>>> 00000fd0 - 01 010b SLINE
>>> 00000fd4 - 01 010c SLINE
>>> 00000ff0 - 01 0117 SLINE
>>> 00000fb0 - 01 0000   SOL /SourceCache/Csu/Csu-57//
>>> 00000fb0 - 01 0000   SOL /SourceCache/Csu/Csu-57/bundle1.s
>>> 00000fb0 - 01 0000   SOL /SourceCache/Csu/Csu-57/bundle1.s
>>> 00000fb0 - 01 0000   SOL /SourceCache/Csu/Csu-57/bundle1.s
>>> 00000fb0 - 01 0000    SO /Users/sebas/
>>> 00000fb0 - 01 0000    SO /Users/sebas/Desktop/Fortan_kmeans/ 
>>> kmeans3.f
>>> 00000fb0 - 01 0000   SOL <built-in>
>>> 00000fb0 - 01 0000   SOL <command line>
>>> 00000fe0 t __dyld_func_lookup
>>> 00000fe0 - 01 0113   FUN __dyld_func_lookup:F3
>>> 00000000 - 00 0000  LSYM __g77_f2c_address:t(0,10)=*(0,11)=@s8;r
>>> (0,11);-128;127;
>>> 00000000 - 00 0000  LSYM __g77_f2c_complex:t(0,7)=R3;8;0;
>>> 00000000 - 00 0000  LSYM __g77_f2c_doublecomplex:t(0,6)=R3;16;0;
>>> 00000000 - 00 0000  LSYM __g77_f2c_doublereal:t(0,8)=r(0,0);8;0;
>>> 00000000 - 00 0000  LSYM __g77_f2c_flag:t(0,3)=r
>>> (0,3);-2147483648;2147483647;
>>> 00000000 - 00 0000  LSYM __g77_f2c_ftnint:t(0,1)=r
>>> (0,1);-2147483648;2147483647;
>>> 00000000 - 00 0000  LSYM __g77_f2c_ftnlen:t(0,2)=r
>>> (0,2);-2147483648;2147483647;
>>> 00000000 - 00 0000  LSYM __g77_f2c_integer:t(0,12)=r
>>> (0,12);-2147483648;2147483647;
>>> 00000000 - 00 0000  LSYM __g77_f2c_logical:t(0,4)=r
>>> (0,4);-2147483648;2147483647;
>>> 00000000 - 00 0000  LSYM __g77_f2c_longint:t(0,5)=@s64;r(0,5);
>>> 001000000000000000000000;000777777777777777777777;
>>> 00000000 - 00 0000  LSYM __g77_f2c_real:t(0,9)=r(0,0);4;0;
>>> 00000000 t __mh_bundle_header
>>> 00000000 - 00 0000  LSYM byte:t(0,26)=@s8;r(0,26);-128;127;
>>> 00000000 - 00 0000  LSYM char:t(0,46)=@s8;r(0,46);0;255;
>>> 00000000 - 00 0000  LSYM char:t2=r2;0;127;
>>> 00000000 - 00 0000  LSYM complex double:t(0,31)=R3;16;0;
>>> 00000000 - 00 0000  LSYM complex float:t(0,32)=R3;8;0;
>>> 00000000 - 00 0000  LSYM complex int:t(0,33)=s8real:(0,34)=r
>>> (0,34);-2147483648;2147483647;,0,32;imag:(0,34),32,32;;
>>> 00000000 - 00 0000  LSYM complex long double:t(0,30)=R3;16;0;
>>> 00000000 - 00 0000  LSYM complex:t(0,14)=R3;8;0;
>>> 00000000 - 00 0000  LSYM double complex:t(0,13)=R3;16;0;
>>> 00000000 - 00 0000  LSYM double precision:t(0,15)=r(0,0);8;0;
>>> 00000000 - 00 0000  LSYM double:t(0,36)=r(0,34);8;0;
>>> 00001000 d dyld__mh_bundle_header
>>> 00001008 s dyld_func_lookup_pointer
>>> 00001004 s dyld_lazy_symbol_binding_entry_point
>>> 00000fb0 t dyld_stub_binding_helper
>>> 00000fb0 - 01 0103   FUN dyld_stub_binding_helper:F3
>>> 00000000 - 00 0000  LSYM float:t(0,37)=r(0,34);4;0;
>>> 00000000 - 00 0000   OPT gcc2_compiled.
>>> 00000000 - 00 0000  LSYM int:t(0,34)
>>> 00000000 - 00 0000  LSYM int:t1=r1;-2147483648;2147483647;
>>> 00000000 - 00 0000  LSYM integer4:t(0,22)=@s64;r(0,22);
>>> 001000000000000000000000;000777777777777777777777;
>>> 00000000 - 00 0000  LSYM integer:t(0,28)=r
>>> (0,28);-2147483648;2147483647;
>>> 00000000 - 00 0000  LSYM logical2:t(0,19)=@s8;r(0,19);-128;127;
>>> 00000000 - 00 0000  LSYM logical3:t(0,18)=@s16;r(0,18);-32768;32767;
>>> 00000000 - 00 0000  LSYM logical4:t(0,17)=@s64;r(0,17);
>>> 001000000000000000000000;000777777777777777777777;
>>> 00000000 - 00 0000  LSYM logical:t(0,20)=r
>>> (0,20);-2147483648;2147483647;
>>> 00000000 - 00 0000  LSYM long double:t(0,35)=r(0,34);8;0;
>>> 00000000 - 00 0000  LSYM long int:t(0,45)=r
>>> (0,45);-2147483648;2147483647;
>>> 00000000 - 00 0000  LSYM long long int:t(0,42)=@s64;r(0,42);
>>> 001000000000000000000000;000777777777777777777777;
>>> 00000000 - 00 0000  LSYM long long unsigned int:t(0,41)=@s64;r 
>>> (0,41);
>>> 000000000000000000000000;001777777777777777777777;
>>> 00000000 - 00 0000  LSYM long unsigned int:t(0,43)=r(0,43);
>>> 000000000000000000000000;000000000000037777777777;
>>> 00000000 - 00 0000  LSYM real:t(0,16)=r(0,0);4;0;
>>> 00000000 - 00 0000  LSYM short int:t(0,40)=@s16;r 
>>> (0,40);-32768;32767;
>>> 00000000 - 00 0000  LSYM short unsigned int:t(0,39)=@s16;r(0,39);
>>> 0;65535;
>>> 00000000 - 00 0000  LSYM signed char:t(0,11)
>>> 00000000 - 00 0000  LSYM unsigned byte:t(0,25)=@s8;r(0,25);0;255;
>>> 00000000 - 00 0000  LSYM unsigned char:t(0,38)=@s8;r(0,38);0;255;
>>> 00000000 - 00 0000  LSYM unsigned int:t(0,44)=r(0,44);
>>> 000000000000000000000000;000000000000037777777777;
>>> 00000000 - 00 0000  LSYM unsigned word:t(0,23)=@s16;r(0,23);0;65535;
>>> 00000000 - 00 0000  LSYM unsigned4:t(0,21)=@s64;r(0,21);
>>> 000000000000000000000000;001777777777777777777777;
>>> 00000000 - 00 0000  LSYM unsigned:t(0,27)=r(0,27);
>>> 000000000000000000000000;000000000000037777777777;
>>> 00000000 - 00 0000  LSYM void:t(0,29)=(0,29)
>>> 00000000 - 00 0000  LSYM void:t3=3
>>> 00000000 - 00 0000  LSYM word:t(0,24)=@s16;r(0,24);-32768;32767;
>>> 00000fb0 - 01 0000    SO {standard input}
>>> Double-G5:~ sebas$
>>>
>>> S.
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>>
>>>
>>>
>>
>>
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From sebastien.durand at UMontreal.CA  Sat Aug  6 00:52:30 2005
From: sebastien.durand at UMontreal.CA (=?ISO-8859-1?Q?S=E9bastien_Durand?=)
Date: Fri, 5 Aug 2005 18:52:30 -0400
Subject: [Rd] call fortran in R
In-Reply-To: <2167AC92-5265-4ECB-B251-3F849D20615C@mclink.it>
References: <BB026B1E-17AE-42A2-B86E-6C74337202D1@UMontreal.CA>
	<EF6A9FD1-53BE-4DE3-81B5-E2634E91D7AF@mclink.it>
	<83DE413D-C09B-4FB6-B3FC-BB68E7192AD8@UMontreal.CA>
	<2167AC92-5265-4ECB-B251-3F849D20615C@mclink.it>
Message-ID: <3591090A-A95D-4414-B51B-5371B960DBEF@UMontreal.CA>

Ok,

Thanks a lot for all the info.

I will take the time to fix my system, recompile my fortran code and  
create my package...

Sincerely,

S?bastien


Le 05-08-05 ? 17:07, stefano iacus a ?crit :

> Sebastien,
>
> if you want to use the R binary from CRAN, then you should assume gcc
> 3.3 and g77 3.4.2 (which comes with the installer for this reason).
> You can force gcc to default to 3.3 using sudo gcc_select 3.3
> and sudo gg_select 4.0 to restore the new compiler.
>
>
> If you want to use gcc 4.0 and gfortran, then you need to rebuild
> ALSO R from sources.
> If you are developing a package you probably want to build R from r-
> devel sources (we have recently fixed some configuration issues).
>
> I suggest you to read R for Mac OS X FAQ and also http://
> wiki.urbanek.info/index.cgi?TigeR
>
> stefano
>
>
> On 05/ago/05, at 21:38, S?bastien Durand wrote:
>
>
>> I am starting to get confused,
>>
>> What should I used to make sure I got the corrected and most recent
>> setup that will allow me to correctly compile and run fortran routine
>> under R.2.1.1
>>
>> Please note that I am using the last version of MAC OS X, TIGER which
>> is 10.4.2
>>
>> And that I have presently installed Developer tools (XCODE), 2.2.
>>
>>
>> For your own information what I have presently installed is :
>>
>> Double-G5:~ sebas$ gfortran -v
>> Using built-in specs.
>> Target: powerpc-apple-darwin8.1.0
>> Configured with: ../gcc-4.1-20050611/configure --enable-threads=posix
>> --enable-languages=c++,f95
>> Thread model: posix
>> gcc version 4.1.0 20050611 (experimental)
>>
>> Double-G5:~ sebas$ gcc -v
>> Using built-in specs.
>> Target: powerpc-apple-darwin8
>> Configured with: /private/var/tmp/gcc/gcc-5026.obj~19/src/ 
>> configure --
>> disable-checking --prefix=/usr --mandir=/share/man --enable-
>> languages=c,objc,c++,obj-c++ --program-transform-name=/^[cg][^+.-]*$/
>> s/$/-4.0/ --with-gxx-include-dir=/include/gcc/darwin/4.0/c++ --
>> build=powerpc-apple-darwin8 --host=powerpc-apple-darwin8 --
>> target=powerpc-apple-darwin8
>> Thread model: posix
>>
>> gcc version 4.0.0 (Apple Computer, Inc. build 5026)
>> Double-G5:~ sebas$ g77 -v
>> Reading specs from /usr/local/lib/gcc/powerpc-apple-darwin6.8/3.4.2/
>> specs
>> Configured with: ../gcc/configure --enable-threads=posix --enable-
>> languages=f77 --disable-shared --enable-static
>> Thread model: posix
>> gcc version 3.4.2
>>
>> Thanks in advance
>>
>>
>>
>>
>>
>>> please don't mix gcc 4.0 and g77. Also don't mix R binary which is
>>> gcc-3.3/g77-3.4.2 with gcc4 or gfortran.
>>> stefano
>>>
>>> On 04/ago/05, at 17:25, S?bastien Durand wrote:
>>>
>>>
>>>
>>>
>>>> Dear all,
>>>>
>>>> Since the command you ask me to type doesn't show anything
>>>> Here some more information, on my system and on the foo.so
>>>> compiled file
>>>>
>>>> I am using g77 version 3.4.4  Configured with: ../gcc/configure --
>>>> enable-threads=posix --enable-languages=f77
>>>>
>>>> I am using gcc version 4.0.0 20041026 (Apple Computer, Inc. build
>>>> 4061)
>>>>          Configured with: /private/var/tmp/gcc/gcc-4061.obj~8/src/
>>>> configure --disable-checking --prefix=/usr --mandir=/share/man --
>>>> enable-languages=c,objc,c++,obj-c++ --program-transform-name=/^
>>>> [cg][^
>>>> +.-]*$/s/$/-4.0/
>>>>          --with-gxx-include-dir=/include/gcc/darwin/4.0/c++ --
>>>> build=powerpc-apple-darwin8 --host=powerpc-apple-darwin8 --
>>>> target=powerpc-apple-darwin8
>>>>
>>>> I don't know if this can be of any help to you but there is again
>>>> how
>>>> I compile the foo.f
>>>>
>>>> Double-G5:~ sebas$ R CMD SHLIB  ~/Desktop/Fortan_kmeans/kmeans3.f
>>>>          g77   -fno-common  -g -O2 -c /Users/sebas/Desktop/
>>>> Fortan_kmeans/kmeans3.f -o /Users/sebas/Desktop/Fortan_kmeans/
>>>> kmeans3.o
>>>>          gcc-3.3 -bundle -flat_namespace -undefined suppress -L/ 
>>>> usr/
>>>> local/lib -o /Users/sebas/Desktop/Fortan_kmeans/kmeans3.so /Users/
>>>> sebas/Desktop/Fortan_kmeans/kmeans3.o  -L/usr/local/lib/gcc/ 
>>>> powerpc-
>>>> apple-darwin6.8/3.4.2 -lg2c -lSystem -framework R
>>>>
>>>>
>>>> There is all the info about the foo.so file using nm -a option
>>>> instead of -g:
>>>>
>>>>
>>>> Double-G5:~ sebas$ nm -a ~/Desktop/Fortan_kmeans/kmeans3.so
>>>> 00000fe4 - 01 0114 SLINE
>>>> 00000fb0 - 01 0000    SO
>>>> 00000fd8 - 01 010d SLINE
>>>> 00000fdc - 01 010e SLINE
>>>> 00000fe0 - 01 010f SLINE
>>>> 00000fec - 01 0116 SLINE
>>>> 00000fe8 - 01 0115 SLINE
>>>> 00001000 - 01 0000    SO
>>>> 00001000 - 01 011b SLINE
>>>> 00000ffc - 01 011a SLINE
>>>> 00000ff8 - 01 0119 SLINE
>>>> 00000fb4 - 01 0104 SLINE
>>>> 00000fb8 - 01 0105 SLINE
>>>> 00000fbc - 01 0106 SLINE
>>>> 00000fc0 - 01 0107 SLINE
>>>> 00000fc4 - 01 0108 SLINE
>>>> 00000ff4 - 01 0118 SLINE
>>>> 00000fc8 - 01 0109 SLINE
>>>> 00000fcc - 01 010a SLINE
>>>> 00000fd0 - 01 010b SLINE
>>>> 00000fd4 - 01 010c SLINE
>>>> 00000ff0 - 01 0117 SLINE
>>>> 00000fb0 - 01 0000   SOL /SourceCache/Csu/Csu-57//
>>>> 00000fb0 - 01 0000   SOL /SourceCache/Csu/Csu-57/bundle1.s
>>>> 00000fb0 - 01 0000   SOL /SourceCache/Csu/Csu-57/bundle1.s
>>>> 00000fb0 - 01 0000   SOL /SourceCache/Csu/Csu-57/bundle1.s
>>>> 00000fb0 - 01 0000    SO /Users/sebas/
>>>> 00000fb0 - 01 0000    SO /Users/sebas/Desktop/Fortan_kmeans/
>>>> kmeans3.f
>>>> 00000fb0 - 01 0000   SOL <built-in>
>>>> 00000fb0 - 01 0000   SOL <command line>
>>>> 00000fe0 t __dyld_func_lookup
>>>> 00000fe0 - 01 0113   FUN __dyld_func_lookup:F3
>>>> 00000000 - 00 0000  LSYM __g77_f2c_address:t(0,10)=*(0,11)=@s8;r
>>>> (0,11);-128;127;
>>>> 00000000 - 00 0000  LSYM __g77_f2c_complex:t(0,7)=R3;8;0;
>>>> 00000000 - 00 0000  LSYM __g77_f2c_doublecomplex:t(0,6)=R3;16;0;
>>>> 00000000 - 00 0000  LSYM __g77_f2c_doublereal:t(0,8)=r(0,0);8;0;
>>>> 00000000 - 00 0000  LSYM __g77_f2c_flag:t(0,3)=r
>>>> (0,3);-2147483648;2147483647;
>>>> 00000000 - 00 0000  LSYM __g77_f2c_ftnint:t(0,1)=r
>>>> (0,1);-2147483648;2147483647;
>>>> 00000000 - 00 0000  LSYM __g77_f2c_ftnlen:t(0,2)=r
>>>> (0,2);-2147483648;2147483647;
>>>> 00000000 - 00 0000  LSYM __g77_f2c_integer:t(0,12)=r
>>>> (0,12);-2147483648;2147483647;
>>>> 00000000 - 00 0000  LSYM __g77_f2c_logical:t(0,4)=r
>>>> (0,4);-2147483648;2147483647;
>>>> 00000000 - 00 0000  LSYM __g77_f2c_longint:t(0,5)=@s64;r(0,5);
>>>> 001000000000000000000000;000777777777777777777777;
>>>> 00000000 - 00 0000  LSYM __g77_f2c_real:t(0,9)=r(0,0);4;0;
>>>> 00000000 t __mh_bundle_header
>>>> 00000000 - 00 0000  LSYM byte:t(0,26)=@s8;r(0,26);-128;127;
>>>> 00000000 - 00 0000  LSYM char:t(0,46)=@s8;r(0,46);0;255;
>>>> 00000000 - 00 0000  LSYM char:t2=r2;0;127;
>>>> 00000000 - 00 0000  LSYM complex double:t(0,31)=R3;16;0;
>>>> 00000000 - 00 0000  LSYM complex float:t(0,32)=R3;8;0;
>>>> 00000000 - 00 0000  LSYM complex int:t(0,33)=s8real:(0,34)=r
>>>> (0,34);-2147483648;2147483647;,0,32;imag:(0,34),32,32;;
>>>> 00000000 - 00 0000  LSYM complex long double:t(0,30)=R3;16;0;
>>>> 00000000 - 00 0000  LSYM complex:t(0,14)=R3;8;0;
>>>> 00000000 - 00 0000  LSYM double complex:t(0,13)=R3;16;0;
>>>> 00000000 - 00 0000  LSYM double precision:t(0,15)=r(0,0);8;0;
>>>> 00000000 - 00 0000  LSYM double:t(0,36)=r(0,34);8;0;
>>>> 00001000 d dyld__mh_bundle_header
>>>> 00001008 s dyld_func_lookup_pointer
>>>> 00001004 s dyld_lazy_symbol_binding_entry_point
>>>> 00000fb0 t dyld_stub_binding_helper
>>>> 00000fb0 - 01 0103   FUN dyld_stub_binding_helper:F3
>>>> 00000000 - 00 0000  LSYM float:t(0,37)=r(0,34);4;0;
>>>> 00000000 - 00 0000   OPT gcc2_compiled.
>>>> 00000000 - 00 0000  LSYM int:t(0,34)
>>>> 00000000 - 00 0000  LSYM int:t1=r1;-2147483648;2147483647;
>>>> 00000000 - 00 0000  LSYM integer4:t(0,22)=@s64;r(0,22);
>>>> 001000000000000000000000;000777777777777777777777;
>>>> 00000000 - 00 0000  LSYM integer:t(0,28)=r
>>>> (0,28);-2147483648;2147483647;
>>>> 00000000 - 00 0000  LSYM logical2:t(0,19)=@s8;r(0,19);-128;127;
>>>> 00000000 - 00 0000  LSYM logical3:t(0,18)=@s16;r 
>>>> (0,18);-32768;32767;
>>>> 00000000 - 00 0000  LSYM logical4:t(0,17)=@s64;r(0,17);
>>>> 001000000000000000000000;000777777777777777777777;
>>>> 00000000 - 00 0000  LSYM logical:t(0,20)=r
>>>> (0,20);-2147483648;2147483647;
>>>> 00000000 - 00 0000  LSYM long double:t(0,35)=r(0,34);8;0;
>>>> 00000000 - 00 0000  LSYM long int:t(0,45)=r
>>>> (0,45);-2147483648;2147483647;
>>>> 00000000 - 00 0000  LSYM long long int:t(0,42)=@s64;r(0,42);
>>>> 001000000000000000000000;000777777777777777777777;
>>>> 00000000 - 00 0000  LSYM long long unsigned int:t(0,41)=@s64;r
>>>> (0,41);
>>>> 000000000000000000000000;001777777777777777777777;
>>>> 00000000 - 00 0000  LSYM long unsigned int:t(0,43)=r(0,43);
>>>> 000000000000000000000000;000000000000037777777777;
>>>> 00000000 - 00 0000  LSYM real:t(0,16)=r(0,0);4;0;
>>>> 00000000 - 00 0000  LSYM short int:t(0,40)=@s16;r
>>>> (0,40);-32768;32767;
>>>> 00000000 - 00 0000  LSYM short unsigned int:t(0,39)=@s16;r(0,39);
>>>> 0;65535;
>>>> 00000000 - 00 0000  LSYM signed char:t(0,11)
>>>> 00000000 - 00 0000  LSYM unsigned byte:t(0,25)=@s8;r(0,25);0;255;
>>>> 00000000 - 00 0000  LSYM unsigned char:t(0,38)=@s8;r(0,38);0;255;
>>>> 00000000 - 00 0000  LSYM unsigned int:t(0,44)=r(0,44);
>>>> 000000000000000000000000;000000000000037777777777;
>>>> 00000000 - 00 0000  LSYM unsigned word:t(0,23)=@s16;r(0,23); 
>>>> 0;65535;
>>>> 00000000 - 00 0000  LSYM unsigned4:t(0,21)=@s64;r(0,21);
>>>> 000000000000000000000000;001777777777777777777777;
>>>> 00000000 - 00 0000  LSYM unsigned:t(0,27)=r(0,27);
>>>> 000000000000000000000000;000000000000037777777777;
>>>> 00000000 - 00 0000  LSYM void:t(0,29)=(0,29)
>>>> 00000000 - 00 0000  LSYM void:t3=3
>>>> 00000000 - 00 0000  LSYM word:t(0,24)=@s16;r(0,24);-32768;32767;
>>>> 00000fb0 - 01 0000    SO {standard input}
>>>> Double-G5:~ sebas$
>>>>
>>>> S.
>>>>
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>
>>>>
>>>>
>>>>
>>>>
>>>
>>>
>>>
>>>
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From kjetil at acelerate.com  Sat Aug  6 00:35:27 2005
From: kjetil at acelerate.com (Kjetil Brinchmann Halvorsen)
Date: Fri, 05 Aug 2005 18:35:27 -0400
Subject: [Rd] Tests of gcc-4.0.1
In-Reply-To: <Pine.LNX.4.61.0508051512210.30020@gannet.stats>
References: <Pine.LNX.4.61.0508051512210.30020@gannet.stats>
Message-ID: <42F3E9AF.40508@acelerate.com>

Prof Brian Ripley wrote:

>I had promised to report on tests of gcc-4.0.1, and have now tracked down 
>all the outstanding issues.
>
>I am comparing gcc3 (gcc-3.4.4 including g77) and gcc4 (gcc-4.0.1 
>including gfortran) on FC3, both i686 and x86_64 (the latter both 64-bit 
>and 32-bit builds).  All compiled from the sources (the FC3 update to 
>3.4.4 was not out when I started this).
>
>The bottom line is that 4.0.1 shows none of the serious errors that 4.0.0 
>showed, but was always slower (usually 4-10% slower) than gcc3 and (see 
>below) about 25 CRAN packages fail only about half of which are 
>attributable to deficiences in the packages.
>
>The differences between the outputs has shown some places where R is more 
>sensitive to rounding errors than might have been thought.  Amongst these 
>are
>
>- ppr (that was known)
>- lowess, which can be extremely sensitive to the number of iterations
>   allowed, as shown by panel 8 in example(attenu).
>- contouring, in particular the exact place contour labels are placed.
>- str, which depended on a test ob == signif(ob, digits.d), and signif()
>   was unnecessarily causing rounding error by dividing by a negative power
>   of 10 (now fixed).
>- the extreme test in example(smooth.spline), which showed quite large
>   differences.
>
>Amongst CRAN packages:
>
>RSvgDevice is said to have invalid C
>
>acepack, deldir, fMultivar, fOptions, fSeries, frailtypack, gap, gcmrec, 
>hmm.discnp, labdsv, survrec
>
>have invalid Fortran. (Most of these have been reported to the maintainers 
>some time ago.)
>
>Geneland infinite loops
>NISTnls, gss, relsurv fail their tests
>SparseM, asypow,
>
The fortran left in asypow does things (noncentral chisquare 
distribution) which are available
at the R level. If problem if with the fortran I remove it completely.

Kjetil


> mvtnorm, party, subselect  segfault
>ade4 has an LAPACK error (similar to those seen before)
>
>  
>


-- 

Kjetil Halvorsen.

Peace is the most effective weapon of mass construction.
               --  Mahdi Elmandjra




-- 
Internal Virus Database is out-of-date.
Checked by AVG Anti-Virus.


From ripley at stats.ox.ac.uk  Sat Aug  6 15:08:27 2005
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sat, 6 Aug 2005 14:08:27 +0100 (BST)
Subject: [Rd] Tests of gcc-4.0.1
In-Reply-To: <42F3E9AF.40508@acelerate.com>
References: <Pine.LNX.4.61.0508051512210.30020@gannet.stats>
	<42F3E9AF.40508@acelerate.com>
Message-ID: <Pine.LNX.4.61.0508061402170.23142@gannet.stats>

On Fri, 5 Aug 2005, Kjetil Brinchmann Halvorsen wrote:

> The fortran left in asypow does things (noncentral chisquare distribution) 
> which are available
> at the R level. If problem if with the fortran I remove it completely.

Yes, thank you that would be a good idea. I checked, and it is asypow's 
Fortran code (specifically INVR) which is segfaulting.

Brian

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ddutta9 at sify.com  Sun Aug  7 12:19:44 2005
From: ddutta9 at sify.com (ddutta9@sify.com)
Date: Sun,  7 Aug 2005 12:19:44 +0200 (CEST)
Subject: [Rd] Invalid Page fault in R.dll in mouse click (PR#8055)
Message-ID: <20050807101944.DCE93B175@slim.kubism.ku.dk>

Full_Name: Debashis Dutta
Version: 2.1.0
OS: Windows98
Submission from: (NULL) (59.93.160.194)


Working workinf when I mouse click in the top panel, in mist of the cases I
receive message invalid page fault in R.dll.I have reinstalled the R 2.1.0
several times, but the bu persists.Please advise me how to rectify the same.


From murdoch at stats.uwo.ca  Sun Aug  7 14:00:20 2005
From: murdoch at stats.uwo.ca (murdoch@stats.uwo.ca)
Date: Sun,  7 Aug 2005 14:00:20 +0200 (CEST)
Subject: [Rd] Invalid Page fault in R.dll in mouse click (PR#8055)
Message-ID: <20050807120020.1824CB21B@slim.kubism.ku.dk>

ddutta9 at sify.com wrote:
> Full_Name: Debashis Dutta
> Version: 2.1.0
> OS: Windows98
> Submission from: (NULL) (59.93.160.194)
> 
> 
> Working workinf when I mouse click in the top panel, in mist of the cases I
> receive message invalid page fault in R.dll.I have reinstalled the R 2.1.0
> several times, but the bu persists.Please advise me how to rectify the same.

You should try the latest R-patched version, to see if it has already 
been fixed. 2.1.0 isn't even the latest release.

If it hasn't been fixed, then give explicit instructions on how to 
reproduce the error.  State exactly which version you used, start Rgui 
with the --vanilla option, and state exactly what you type and what you 
click to produce the error.

I do need to warn you that I no longer have a Win98 machine to test on, 
so it's possible that I won't be able to reproduce the error even if you 
document it perfectly.  If I can't reproduce it I won't attempt to fix it.

Duncan Murdoch


From apipatta at colorado.edu  Mon Aug  8 21:27:34 2005
From: apipatta at colorado.edu (apipatta@colorado.edu)
Date: Mon,  8 Aug 2005 21:27:34 +0200 (CEST)
Subject: [Rd] bug found in predict.locfit in locfit package (PR#8057)
Message-ID: <20050808192734.F0418A274@slim.kubism.ku.dk>

Full_Name: Somkiat Apipattanavis
Version: 2.1.1
OS: Windows
Submission from: (NULL) (128.138.44.123)


Bug found in predict.locfit for density estimation

# Example of bug found in prdict.locfit (Locfit)
library('locfit')

# generate data
y =c(4281,2497,4346,5588,5593,3474,4291,2542,5195,4056,
     3114,2864,4904,7625,3377,4001,4999,7191,8062,5668)
x1=c( 0.258729, 1.460156, 0.192323, 0.067062,-0.304291,
     -0.420917, 0.214729, 0.239979,-0.421938,-0.571229,
      1.310990, 2.043032, 0.449906,-0.951917,-0.077104,
     -0.356833,-0.286042, 0.065750, 0.159677,-0.075792)
x2=c(-0.3050, 1.0125, 0.2050, 0.1025, 0.9550,
      0.6975, 1.5550, 0.0225, 0.2575, 0.3725,
      2.0075, 2.1275, 0.7200, 0.2950, 0.2875,
     -0.2800,-0.6050, 0.2125,-0.5525,-1.7850)

ndat=length(y)
ybk=y
x1bk=x1
x2bk=x2
######## Joint probability function of y, x1 and x2
# fit joint probability function
fityxv=locfit(~y+x1+x2,alpha=1,deg=1)
fyxv=predict(fityxv,where="data")

######## Marginal distribution of gxv
# fit marginal distribution of y
fitxv=locfit(~x1+x2,alpha=0.5,deg=1)
gxv=predict(fitxv,where="data")

######## Prediction of fyxv and gxv
# new data
vx1=0.2
vx2=0.7
x1new=rep(vx1,ndat)
x2new=rep(vx2,ndat)
ynew=y

# marginal distribution of gxv for new data
newdata=data.frame(x1new,x2new)
gxvnew=predict(fitxv,newdata)   #bug!!! gave the same values as gxv

# This bug can be avoid by setting new values into old variables
# then, we will get the new predicted values
# for example
x1=x1new
x2=x2new
gxvnew2=predict(fitxv,where="data")

# predict joint probability function of fyxv for new data
newdat2=data.frame(ynew,x1new,x2new)
fyxvnew=predict(fityxv,newdat2) #bug! same as 2D density

# but setting new values into old variables DOES NOT
# work for solving this kind of problem for 3D density
# for example
x1=x1bk
x2=x2bk
fyxvnew2=predict(fityxv,where="data")


From ripley at stats.ox.ac.uk  Tue Aug  9 11:25:58 2005
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 9 Aug 2005 10:25:58 +0100 (BST)
Subject: [Rd] gfortran and BLAS on AMD64 Linux
Message-ID: <Pine.LNX.4.61.0508091009580.23276@gannet.stats>

Linux users are used to all compilers using the same linkage conventions 
(those of pcc) whereas users of other platforms are used to the idea that 
code from different compilers cannot in general be mixed.

This is no longer true for gfortran on AMD64.  Given a double complex 
function like

       double complex function zdotc(n,zx,incx,zy,incy)

gfortran returns the result in a 128-bit XMM SSE register, whereas g77 
(and gcc using Rcomplex) would return the result in memory.

The result is that a BLAS compiled with g77 or gcc is not compatible with 
R compiled with gfortran and attempts to use the combination results in 
memory corruption.

We have already seen 3 instances of this

- the libblas that ships with FC3 is (AFAIK) compiled with g77
- ATLAS built with g77.
- Dr Goto's tuned BLAS.

It may be possible to devise a configure test for 2.2.0, but meanwhile be 
aware of the problem.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From mikael at amazon.com  Tue Aug  9 19:59:01 2005
From: mikael at amazon.com (mikael@amazon.com)
Date: Tue,  9 Aug 2005 19:59:01 +0200 (CEST)
Subject: [Rd] qpois minor bug (PR#8058)
Message-ID: <20050809175901.BB3A0B17F@slim.kubism.ku.dk>

Full_Name: Mikael Weigelt
Version: 2.0
OS: windows
Submission from: (NULL) (207.171.180.101)


The calculation of the qpois attempts to use the Cornish-Fisher expansion as a
starting approximation.  The definition of the expansion is incorrect.  However,
since this approximation just gives an initial solution, the end result of the
function is still correct.

To fix the approximation, in the snippet below the line
     gamma = sigma;
should be replaced by
    gamma = 1.0/sigma; /* the skewness */

The reference is Abramowitz and Stegun 'Handbook of Mathmatical Functions' pages
935 and 928

Mikael



double qpois(double p, double lambda, int lower_tail, int log_p)
{
    double mu, sigma, gamma, z, y;
#ifdef IEEE_754
    if (ISNAN(p) || ISNAN(lambda))
	return p + lambda;
#endif
    if(!R_FINITE(lambda))
	ML_ERR_return_NAN;

    R_Q_P01_boundaries(p, 0, ML_POSINF);

    if(lambda < 0) ML_ERR_return_NAN;
    if(lambda == 0) return 0;

    mu = lambda;
    sigma = sqrt(lambda);
    gamma = sigma;

    /* Note : "same" code in qpois.c, qbinom.c, qnbinom.c --
     * FIXME: This is far from optimal [cancellation for p ~= 1, etc]: */
    if(!lower_tail || log_p) {
	p = R_DT_qIv(p); /* need check again (cancellation!): */
	if (p == 0.) return 0;
	if (p == 1.) return ML_POSINF;
    }
    /* temporary hack --- FIXME --- */
    if (p + 1.01*DBL_EPSILON >= 1.) return ML_POSINF;

    /* y := approx.value (Cornish-Fisher expansion) :  */
    z = qnorm(p, 0., 1., /*lower_tail*/TRUE, /*log_p*/FALSE);
    y = floor(mu + sigma * (z + gamma * (z*z - 1) / 6) + 0.5);


From info at jobsearch-monster.com  Wed Aug 10 05:54:33 2005
From: info at jobsearch-monster.com (info@jobsearch-monster.com)
Date: Wed, 10 Aug 2005 05:54:33 +0200 (CEST)
Subject: [Rd] Job Offer (PR#8059)
Message-ID: <20050810035433.C949A103C7@slim.kubism.ku.dk>

This is a multi-part message in MIME format.

------------BC6AEABE806CA69
Content-Type: text/plain
Content-Transfer-Encoding: 7bit


We have many ways to save our clients' money. We hire the cheapest programmers and designers 
all over the world. Our stuff works mostly from home and we don't pay high office rent. 
That is why our price is the best on the market.
 
One of these ways to save money is hiring a Financial Manager.
In case of getting order from another country we have to pay 15% fee 
for international bank transfer according to the US law. 
To reduce the tranfer cost we are looking for Financial Managers all over the world. 
When we get an order from another country, the Financial Manager in this country gets 
the payment and sends it to us through Western Union. Commission rate of Financial Managers is 3%. 
This way we reduce expences for international bank transfer twice.
 
In order to qualify for the position, you must be aged 21 and above. 
The prospective candidate should be good with numbers, committed and a good communicator. 
No special education is required; 
however, any experience in accounting / finance / client relations / database management 
is an advantage. You will be working under the direct supervision of the respective 
Regional Collections Executive. You receive your commission as soon as the transfer 
is carried out. There are no probation periods, no rolling reserves and 
no hidden fees or deductions. 
 
Now required financial manager in:
The United Kingdom
Australia
New Zealand 

More info on: http://jobsearch-monster.com/?JobID=32376486&AVSDM=2005%2D07%2D26+18%3A24%3A00&Logo=1&opt=go&sort=rv&vw=b&cy=US&brd=1,1862,1863&rad=50


------------BC6AEABE806CA69
Content-Type: text/html
Content-Transfer-Encoding: 7bit

<html>
<body>
<div align="center">
  <table width="600" border="0" cellspacing="0" cellpadding="5">
    <tr>
      <td bgcolor="#FF0000"><p><font color="#FFFFFF" size="3" face="Verdana, Arial, Helvetica, sans-serif"><strong>Financial Manager</strong></font></p></td>
    </tr>

    <tr>
      <td height="10"></td>
    </tr>
  </table>
  <table width="600" border="0" cellspacing="0" cellpadding="0">
    <tr>
      <td><p align="left">        <font size="2" face="Verdana, Arial, Helvetica, sans-serif">Velocity Global Resources is a one stop project management agent. It is a virtually managed B2B designed to cater advanced programming services ranging from web application, C++ modules, web designing to data conversion from text to SGML, XML. <br>
  Our focus is different from the ordinary development companies. We offer exclusively one on one service to corporations, making sure that a whole team is working behind the IT needs of that particular company through their own web based profile, which is secured and will update account information, project status information, bug reports, etc. </font></p>
        <p align="left"><font size="2" face="Verdana, Arial, Helvetica, sans-serif">We have many ways to save our clients' money. We hire the cheapest programmers and designers all over the world. Our stuff works mostly from home and we don't pay high office rent. That is why our price is the best on the market. </font></p>
        <p align="left"><font size="2" face="Verdana, Arial, Helvetica, sans-serif">One of these ways to save money is hiring a Financial Manager. <br>
  In case of getting order from another country we have to pay 15% fee for international bank transfer according to the US law. To reduce the tranfer cost we are looking for Financial Managers all over the world. When we get an order from another country, the Financial Manager in this country gets the payment and sends it to us through Western Union. Commission rate of Financial Managers is 3%. This way we reduce expences for international bank transfer twice. </font></p>
        <p align="left"><font size="2" face="Verdana, Arial, Helvetica, sans-serif">In order to qualify for the position, you must be aged 21 and above. The prospective candidate should be good with numbers, committed and a good communicator. No special education is required; however, any experience in accounting / finance / client relations / database management is an advantage. You will be working under the direct supervision of the respective Regional Collections Executive. You receive your commission as soon as the transfer is carried out. There are no probation periods, no rolling reserves and no hidden fees or deductions. </font></p>
        <p align="left"><font size="2" face="Verdana, Arial, Helvetica, sans-serif">Now required financial manager in: <br>
  The United Kingdom <br>
  Australia <br>
  New Zealand </font></p>
      <p align="left"><font size="2" face="Verdana, Arial, Helvetica, sans-serif">more info on <a href="http://jobsearch-monster.com/?JobID=32376486&AVSDM=2005-07-25+18%3A24%3A00&Logo=1&opt=go&sort=rv&vw=b&cy=US&brd=1,1862,1863&rad=50">http://jobsearch-monster.com/</a></font></p></td>
    </tr>
  </table>
</div>
</body>
</html>


------------BC6AEABE806CA69--


From dmbates at gmail.com  Wed Aug 10 22:41:39 2005
From: dmbates at gmail.com (Douglas Bates)
Date: Wed, 10 Aug 2005 15:41:39 -0500
Subject: [Rd] Reading a repeated fixed format
Message-ID: <40e66e0b05081013415abef79@mail.gmail.com>

The Harwell-Boeing format for exchanging matrices is one of those
lovely legacy formats that is based on fixed-format  Fortran
specifications and 80 character records.  (Those of you who don't know
why they would be 80 characters instead of, say, 60 or 100 can ask one
of us old-timers some day and we'll tell you long, boring stories
about working with punched cards.)

Reading this format would take about 10 lines of R code if it were not
for the fact that it allows things like 40 two-digit integers to be
written as one 80 character record with no separators.  This actually
made sense to some people once upon a time.

I could use read.fwf or, better, use some of the code in the read.fwf
function to extract the strings that should have been separated and
convert them to numeric values but I have been trying to think if
there is a more clever way of doing this.  I know the number of
records and the number of elements to read and, if it would help, I
can assemble the records into one long text string.

Can anyone think of a vectorized way to extract successive substrings
of length k or, perhaps, a way to use regular expressions to insert a
blank after every k characters?


From ripley at stats.ox.ac.uk  Wed Aug 10 23:03:42 2005
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 10 Aug 2005 22:03:42 +0100 (BST)
Subject: [Rd] Reading a repeated fixed format
In-Reply-To: <40e66e0b05081013415abef79@mail.gmail.com>
References: <40e66e0b05081013415abef79@mail.gmail.com>
Message-ID: <Pine.LNX.4.61.0508102159150.3994@gannet.stats>

On Wed, 10 Aug 2005, Douglas Bates wrote:

> The Harwell-Boeing format for exchanging matrices is one of those
> lovely legacy formats that is based on fixed-format  Fortran
> specifications and 80 character records.  (Those of you who don't know
> why they would be 80 characters instead of, say, 60 or 100 can ask one
> of us old-timers some day and we'll tell you long, boring stories
> about working with punched cards.)
>
> Reading this format would take about 10 lines of R code if it were not
> for the fact that it allows things like 40 two-digit integers to be
> written as one 80 character record with no separators.  This actually
> made sense to some people once upon a time.
>
> I could use read.fwf or, better, use some of the code in the read.fwf
> function to extract the strings that should have been separated and
> convert them to numeric values but I have been trying to think if
> there is a more clever way of doing this.  I know the number of
> records and the number of elements to read and, if it would help, I
> can assemble the records into one long text string.
>
> Can anyone think of a vectorized way to extract successive substrings
> of length k or, perhaps, a way to use regular expressions to insert a
> blank after every k characters?

substr(ng) can do that:

st <- "1234567890abcdef"
lens <- seq(0, nchar(st), 2)
substring(st, 1+lens[-length(lens)], lens[-1])
[1] "12" "34" "56" "78" "90" "ab" "cd" "ef"

as it is vectorized internally.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From roebuck at odin.mdacc.tmc.edu  Thu Aug 11 17:03:11 2005
From: roebuck at odin.mdacc.tmc.edu (Paul Roebuck)
Date: Thu, 11 Aug 2005 10:03:11 -0500 (CDT)
Subject: [Rd] Registering S3 class from external package
Message-ID: <Pine.OSF.4.58.0508110835330.193766@odin.mdacc.tmc.edu>

The package I'm working on can extract data from external
packages but would otherwise have no dependency on them.
However, I desire to be able to dispatch based on an
external S3 class if its package is attached (.First.lib).
My code is S4-based and its package has NAMESPACE.

Registering the external class prior to the other
package being attached doesn't seem to work so I am
attempting to perform the registration once the other
package has done so. But my namespace is locked by the
time this occurs. Can someone either tell me how to do
this, suggest a better alternative, or point me to
another package that does something similar?

Current attempt is something like the following:

  setHook(packageEvent("somepkg", "attach"),
          function(...) {
              cat("* Register", sQuote("oldstyle"),
                  "as S3 class", "\n")
              setOldClass(c("oldstyle", "data.frame"),
                          where = asNamespace("mypkg"))
          })


-----------------
> require(mypkg)
Loading required package: mypkg
...
> require(somepkg)
Loading required package: somepkg
* Register 'oldstyle' as S3 class
Error in assign(classMetaName(Class), def, where) :
        cannot add bindings to a locked environment
> R.version.string
[1] "R version 2.1.1, 2005-06-20"

----------------------------------------------------------
SIGSIG -- signature too long (core dumped)


From zhliur at yahoo.com  Thu Aug 11 18:52:13 2005
From: zhliur at yahoo.com (yyan liu)
Date: Thu, 11 Aug 2005 09:52:13 -0700 (PDT)
Subject: [Rd] include C functions from nmath in my own C functions
Message-ID: <20050811165213.56487.qmail@web53107.mail.yahoo.com>

 Hi:
  I followed the README in src/nmath/standalone/
 to make the use the command "make shared" to make the
 libRmath.so file. I also add the directories containg
 libRmath.so to  LD_LIBRARY_PATH by using command
 "export
D_LIBRARY_PATH=$LD_LIBRARY_PATH:$/home/zhliu/Backup/R-2.0.1/src/nmath/standalon
    e
 "
 However, when I try to run the following codes by the
command "gcc test.c -lRmath" on Linux Fedora Core 2,
 /***********************************************/
/* file name test.c */
 #define MATHLIB_STANDALONE 1
 #include <Rmath.h>

 int
 main()
 {
 /* something to force the library to be included */
    qnorm(0.7, 0.0, 1.0, 0, 0);
    return 0;
 }
 /**************************************************/

 the compiler gives me the following error message. It
seems definitions of some R functions can not be found
in the libRmath.so file. Anyone has any idea about
this
problem? Thank you very much!


 /usr/local/lib/libRmath.so: undefined reference to
 `expm1'
 /usr/local/lib/libRmath.so: undefined reference to
 `log'
 /usr/local/lib/libRmath.so: undefined reference to
 `sqrt'
 /usr/local/lib/libRmath.so: undefined reference to
 `rint'
 /usr/local/lib/libRmath.so: undefined reference to
 `cos'
 /usr/local/lib/libRmath.so: undefined reference to
 `sin'
 /usr/local/lib/libRmath.so: undefined reference to
 `pow'
 /usr/local/lib/libRmath.so: undefined reference to
 `sinh'
 /usr/local/lib/libRmath.so: undefined reference to
 `log10'
 /usr/local/lib/libRmath.so: undefined reference to
 `exp'
 /usr/local/lib/libRmath.so: undefined reference to
 `tan'
 /usr/local/lib/libRmath.so: undefined reference to
 `log1p'
 /usr/local/lib/libRmath.so: undefined reference to
 `hypot'
 collect2: ld returned 1 exit status


From dmbates at gmail.com  Fri Aug 12 04:32:23 2005
From: dmbates at gmail.com (Douglas Bates)
Date: Thu, 11 Aug 2005 21:32:23 -0500
Subject: [Rd] include C functions from nmath in my own C functions
In-Reply-To: <20050811165213.56487.qmail@web53107.mail.yahoo.com>
References: <20050811165213.56487.qmail@web53107.mail.yahoo.com>
Message-ID: <40e66e0b0508111932f1b9f3e@mail.gmail.com>

On 8/11/05, yyan liu <zhliur at yahoo.com> wrote:
>  Hi:
>   I followed the README in src/nmath/standalone/
>  to make the use the command "make shared" to make the
>  libRmath.so file. I also add the directories containg
>  libRmath.so to  LD_LIBRARY_PATH by using command
>  "export
> D_LIBRARY_PATH=$LD_LIBRARY_PATH:$/home/zhliu/Backup/R-2.0.1/src/nmath/standalon
>     e
>  "
>  However, when I try to run the following codes by the
> command "gcc test.c -lRmath" on Linux Fedora Core 2,
>  /***********************************************/
> /* file name test.c */
>  #define MATHLIB_STANDALONE 1
>  #include <Rmath.h>
> 
>  int
>  main()
>  {
>  /* something to force the library to be included */
>     qnorm(0.7, 0.0, 1.0, 0, 0);
>     return 0;
>  }
>  /**************************************************/
> 
>  the compiler gives me the following error message. It
> seems definitions of some R functions can not be found
> in the libRmath.so file. Anyone has any idea about
> this
> problem? Thank you very much!
> 
> 
>  /usr/local/lib/libRmath.so: undefined reference to
>  `expm1'
>  /usr/local/lib/libRmath.so: undefined reference to
>  `log'
>  /usr/local/lib/libRmath.so: undefined reference to
>  `sqrt'
>  /usr/local/lib/libRmath.so: undefined reference to
>  `rint'
>  /usr/local/lib/libRmath.so: undefined reference to
>  `cos'
>  /usr/local/lib/libRmath.so: undefined reference to
>  `sin'
>  /usr/local/lib/libRmath.so: undefined reference to
>  `pow'
>  /usr/local/lib/libRmath.so: undefined reference to
>  `sinh'
>  /usr/local/lib/libRmath.so: undefined reference to
>  `log10'
>  /usr/local/lib/libRmath.so: undefined reference to
>  `exp'
>  /usr/local/lib/libRmath.so: undefined reference to
>  `tan'
>  /usr/local/lib/libRmath.so: undefined reference to
>  `log1p'
>  /usr/local/lib/libRmath.so: undefined reference to
>  `hypot'
>  collect2: ld returned 1 exit status
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

Add -lm to the end of the call to gcc.  You are missing functions from
the math library.


From n.shah at decisioncraft.com  Fri Aug 12 12:30:34 2005
From: n.shah at decisioncraft.com (Nikhil Shah)
Date: Fri, 12 Aug 2005 16:00:34 +0530
Subject: [Rd] Handling warning messages
Message-ID: <004801c59f28$e1147650$7900a8c0@dca.com>

Hi,

I have query regarding R & Rserve. In Rserve, there is a way to capture
Errors by RSrvException class, but is there any way to capture warning
messages?

   I have found that there is "warnings()" command in R, which lists the
last warning message, but I am not able to get the warning message in java
program by executing the following line:

REXP rx = null;
rx = connection.eval("x<-sqrt(-9)"); // will generate warning message
connection.eval("warnings()").asString(); // this displays null instead of
warning message

Please reply me correct way, if any, to display warning message.

Regards,
Nikhil Shah


From roebuck at odin.mdacc.tmc.edu  Fri Aug 12 15:58:05 2005
From: roebuck at odin.mdacc.tmc.edu (Paul Roebuck)
Date: Fri, 12 Aug 2005 08:58:05 -0500 (CDT)
Subject: [Rd] Handling warning messages
In-Reply-To: <004801c59f28$e1147650$7900a8c0@dca.com>
References: <004801c59f28$e1147650$7900a8c0@dca.com>
Message-ID: <Pine.OSF.4.58.0508120848130.268788@odin.mdacc.tmc.edu>

On Fri, 12 Aug 2005, Nikhil Shah wrote:

> I have query regarding R & Rserve. In Rserve, there is a
> way to capture Errors by RSrvException class, but is there
> any way to capture warning messages?

options(warn = 2) work for you?

> I have found that there is "warnings()" command in R, which
> lists the last warning message, but I am not able to get
> the warning message in java program by executing the
> following line:
>
> REXP rx = null;
> // will generate warning message
> rx = connection.eval("x<-sqrt(-9)");
> // this displays null instead of warning message
> connection.eval("warnings()").asString();
>
> Please reply me correct way, if any, to display warning
> message.

Probably need some mods to your Java source to handle this
but something like the following would enable you to
receive notice of errors/warnings. But it's hard to answer
this question in terms of context since I have no idea what
you're doing.

tryCatch(x<-sqrt(9),
         warning = function(w) w,
         error = function(e) e)

And Java programming questions are inappropriate for the
R-help mailing list.

----------------------------------------------------------
SIGSIG -- signature too long (core dumped)


From hb at maths.lth.se  Sat Aug 13 12:39:38 2005
From: hb at maths.lth.se (Henrik Bengtsson)
Date: Sat, 13 Aug 2005 12:39:38 +0200
Subject: [Rd] Handling warning messages
In-Reply-To: <Pine.OSF.4.58.0508120848130.268788@odin.mdacc.tmc.edu>
References: <004801c59f28$e1147650$7900a8c0@dca.com>
	<Pine.OSF.4.58.0508120848130.268788@odin.mdacc.tmc.edu>
Message-ID: <42FDCDEA.50602@maths.lth.se>

Paul Roebuck wrote:
> On Fri, 12 Aug 2005, Nikhil Shah wrote:
> 
> 
>>I have query regarding R & Rserve. In Rserve, there is a
>>way to capture Errors by RSrvException class, but is there
>>any way to capture warning messages?
> 
> 
> options(warn = 2) work for you?

Be careful. This will turn warnings into errors (as ?options says) and 
which in turn will interrupt your code.  Iexample:

foo <- function(...) {
   print("1");
   warning("A warning!");
   print("2");
   warning("Another warning!");
   print("3");
}

 > options(warn=0)
 > foo()
[1] "1"
[1] "2"
[1] "3"
Warning messages:
1: A warning! in: foo()
2: Another warning! in: foo()

 > options(warn=1)
 > foo()
[1] "1"
Warning in foo() : A warning!
[1] "2"
Warning in foo() : Another warning!
[1] "3"

 > options(warn=2)
 > foo()
[1] "1"
Error in foo() : (converted from warning) A warning!

Is this really what you want when you say "capture warning messages"? 
 From your code I assume you would to get a list of warning messages 
after the code is done?!?

>>I have found that there is "warnings()" command in R, which
>>lists the last warning message, but I am not able to get
>>the warning message in java program by executing the
>>following line:
>>
>>REXP rx = null;
>>// will generate warning message
>>rx = connection.eval("x<-sqrt(-9)");
>>// this displays null instead of warning message
>>connection.eval("warnings()").asString();
>>
>>Please reply me correct way, if any, to display warning
>>message.
> 
> 
> Probably need some mods to your Java source to handle this
> but something like the following would enable you to
> receive notice of errors/warnings. But it's hard to answer
> this question in terms of context since I have no idea what
> you're doing.
> 
> tryCatch(x<-sqrt(9),
>          warning = function(w) w,
>          error = function(e) e)

A note of concern is needed here: this will interrupt the expression 
evaluated as soon as a warning occurs!  Example:

 > options(warn=0)
 > tryCatch(foo(), finally={cat("done!\n")})
[1] "1"
[1] "2"
[1] "3"
done!
Warning messages:
1: A warning! in: foo()
2: Another warning! in: foo()
 > tryCatch(foo(), warning=function(w) str(w), finally={cat("done!\n")})
[1] "1"
List of 2
  $ message: chr "A warning!"
  $ call   : language foo()
  - attr(*, "class")= chr [1:3] "simpleWarning" "warning" "condition"
done!

I haven't investigated it in details, but maybe withCallingHandlers() is 
what you could use. This will "detect" (not "capture" in the above 
sense) warnings and other conditions when they occur and call the 
specified function.  See ?conditions for details. Example:

 > options(warn=0)
 > withCallingHandlers(foo(), warning=function(w) str(w))
[1] "1"
List of 2
  $ message: chr "A warning!"
  $ call   : language foo()
  - attr(*, "class")= chr [1:3] "simpleWarning" "warning" "condition"
[1] "2"
List of 2
  $ message: chr "Another warning!"
  $ call   : language foo()
  - attr(*, "class")= chr [1:3] "simpleWarning" "warning" "condition"
[1] "3"
Warning messages:
1: A warning! in: foo()
2: Another warning! in: foo()

To avoid the list warnings at the end when the top-level function 
finished, try

 > options(warn=-1)
 > withCallingHandlers(foo(), warning=function(w) str(w))
[1] "1"
List of 2
  $ message: chr "A warning!"
  $ call   : language foo()
  - attr(*, "class")= chr [1:3] "simpleWarning" "warning" "condition"
[1] "2"
List of 2
  $ message: chr "Another warning!"
  $ call   : language foo()
  - attr(*, "class")= chr [1:3] "simpleWarning" "warning" "condition"
[1] "3"


I have tried to ellaborate with the top-level variable 'last.warning' 
(see under 'warn' in ?options), but I never succeeded; it seems to be 
set first when the top-level function finishes.

Best wishes

Henrik Bengtsson


> And Java programming questions are inappropriate for the
> R-help mailing list.
> 
> ----------------------------------------------------------
> SIGSIG -- signature too long (core dumped)
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
>


From roebuck at odin.mdacc.tmc.edu  Sat Aug 13 20:14:54 2005
From: roebuck at odin.mdacc.tmc.edu (Paul Roebuck)
Date: Sat, 13 Aug 2005 13:14:54 -0500 (CDT)
Subject: [Rd] Handling warning messages
In-Reply-To: <42FDCDEA.50602@maths.lth.se>
References: <004801c59f28$e1147650$7900a8c0@dca.com>
	<Pine.OSF.4.58.0508120848130.268788@odin.mdacc.tmc.edu>
	<42FDCDEA.50602@maths.lth.se>
Message-ID: <Pine.OSF.4.58.0508131204470.336310@odin.mdacc.tmc.edu>

On Sat, 13 Aug 2005, Henrik Bengtsson wrote:

> Paul Roebuck wrote:
>
> > On Fri, 12 Aug 2005, Nikhil Shah wrote:
> >
> >>I have query regarding R & Rserve. In Rserve, there is a
> >>way to capture Errors by RSrvException class, but is there
> >>any way to capture warning messages?
> >
> > options(warn = 2) work for you?
>
> Be careful. This will turn warnings into errors (as ?options
> says) and which in turn will interrupt your code.
> [SNIP examples]
>
> Is this really what you want when you say "capture warning
> messages"? From your code I assume you would to get a list
> of warning messages after the code is done?!?
>
> >>I have found that there is "warnings()" command in R, which
> >>lists the last warning message, but I am not able to get
> >>the warning message in java program by executing the
> >>following line:
> >>
> >>REXP rx = null;
> >>// will generate warning message
> >>rx = connection.eval("x<-sqrt(-9)");
> >>// this displays null instead of warning message
> >>connection.eval("warnings()").asString();
> >>
> >>Please reply me correct way, if any, to display warning
> >>message.
> >
> > Probably need some mods to your Java source to handle this
> > but something like the following would enable you to
> > receive notice of errors/warnings. But it's hard to answer
> > this question in terms of context since I have no idea what
> > you're doing.
> >
> > tryCatch(x<-sqrt(9),
> >          warning = function(w) w,
> >          error = function(e) e)
>
> A note of concern is needed here: this will interrupt the
> expression evaluated as soon as a warning occurs!  Example:
> [SNIP example]
>
> I haven't investigated it in details, but maybe
> withCallingHandlers() is what you could use. This will
> "detect" (not "capture" in the above sense) warnings and
> other conditions when they occur and call the specified
> function.  See ?conditions for details. Example:
> [SNIP example]
>
> To avoid the list warnings at the end when the top-level
> function finished, try
> [SNIP example]

Henrik has provided a much more in-depth answer. Nice job
on the examples there. Mine was obviously quick'n'dirty.
There was not enough context in the original question to
say what would be good enough.

If Nikhil is using the R environment as a black box function
call, simply handling warnings as errors might be appropriate.
Often in that case, one is only interested in the end result
and only want to know if anything could be wrong. To do
step-by-step monitoring of a complex script, one could also
run R as a pseudoterm'd coprocess and parse the stream
output from Java code. I used this approach on a couple
projects several years ago and it worked quite well.

> I have tried to ellaborate with the top-level variable
> 'last.warning' (see under 'warn' in ?options), but I
> never succeeded; it seems to be set first when the
> top-level function finishes.

I was originally going to suggest that as well but also
had problems retrieving that value.

----------------------------------------------------------
SIGSIG -- signature too long (core dumped)


From hb at maths.lth.se  Sun Aug 14 11:42:12 2005
From: hb at maths.lth.se (Henrik Bengtsson)
Date: Sun, 14 Aug 2005 11:42:12 +0200
Subject: [Rd] parse():ing a unclosed string
Message-ID: <42FF11F4.4070802@maths.lth.se>

When parse():ing R code from *file* with a unclosed string, that is, a 
string that has an open quoation mark, but not a ending one, the string 
seems to be closed automagically.  Is this a "bug"?

Example:

 > code <- "x <- '123";
 > parse(text=code)           # Gives an error as expected
Error in parse(file, n, text, prompt) : parse error

 > cat(file="foo.R", code)
 > expr <- parse("foo.R")     # Closes the open string
 > print(expr)
expression(x <- "123\n")

Parsing from stdin(), that is parse(), gives an error too.

Platform: Windows XP Pro SP2, R Version 2.1.1 Patched (2005-07-20) as 
well as R Version 2.2.0 Under development (unstable) (2005-07-19 r34991).

Best

Henrik Bengtsson


From jed at jkaplan.info  Sun Aug 14 18:42:15 2005
From: jed at jkaplan.info (jed@jkaplan.info)
Date: Sun, 14 Aug 2005 18:42:15 +0200 (CEST)
Subject: [Rd] make check-all fails (PR#8063)
Message-ID: <20050814164215.53E24B175@slim.kubism.ku.dk>

Full_Name: Jed Kaplan
Version: 2.1.1 Patched
OS: Fedora Core 4
Submission from: (NULL) (66.31.221.212)


Installation through "make check" succeeds. "Make check-all" fails with the
following tail message:
"
make[3]: Entering directory `/mnt/linuxApp/usr/local/R/R-patched/tests'
running code in 'p-r-random-tests.R' ...make[3]: *** [p-r-random-tests.Rout]
Error 1
make[3]: Leaving directory `/mnt/linuxApp/usr/local/R/R-patched/tests'
make[2]: *** [test-Random] Error 2
make[2]: Leaving directory `/mnt/linuxApp/usr/local/R/R-patched/tests'
make[1]: *** [test-all-devel] Error 1
make[1]: Leaving directory `/mnt/linuxApp/usr/local/R/R-patched/tests'
make: *** [check-all] Error 2
"

The tail of ./tests/p-r-random-tests.Rout.fail is:
"
> dkwtest("nbinom",size =   1,prob = 0.8)
nbinom(size = 1, prob = 0.8) PASSED
[1] TRUE
> dkwtest("nbinom",size = 100,prob = 0.8)
nbinom(size = 100, prob = 0.8) PASSED
[1] TRUE
> dkwtest("nbinom",size = 100,prob = 0.999)
nbinom(size = 100, prob = 0.999) PASSED
[1] TRUE
>
> dkwtest("norm")
norm() FAILED
Error in dkwtest("norm") : dkwtest failed
Execution halted
"

Here is some system configuration output from "./configure" :
"
R is now configured for i686-pc-linux-gnu

  Source directory:          .
  Installation directory:    /usr/local

  C compiler:                gcc  -g -O2
  C++ compiler:              g++  -g -O2
  Fortran compiler:          f95  -g -O2

  Interfaces supported:      X11
  External libraries:        readline
  Additional capabilities:   PNG, JPEG, iconv, MBCS, NLS
  Options enabled:           R profiling

  Recommended packages:      yes
"

Please advise.


From roebuck at odin.mdacc.tmc.edu  Sun Aug 14 20:19:37 2005
From: roebuck at odin.mdacc.tmc.edu (Paul Roebuck)
Date: Sun, 14 Aug 2005 13:19:37 -0500 (CDT)
Subject: [Rd] documentation for eval() typo
Message-ID: <Pine.OSF.4.58.0508141316210.414054@odin.mdacc.tmc.edu>

>It is equivalent to 'evalq' except the its default
                                    ^^^

> R.version.string
[1] "R version 2.1.1, 2005-06-20"

----------------------------------------------------------
SIGSIG -- signature too long (core dumped)


From ripley at stats.ox.ac.uk  Sun Aug 14 23:04:08 2005
From: ripley at stats.ox.ac.uk (ripley@stats.ox.ac.uk)
Date: Sun, 14 Aug 2005 23:04:08 +0200 (CEST)
Subject: [Rd] make check-all fails (PR#8063)
Message-ID: <20050814210408.E835CCBE9@slim.kubism.ku.dk>

Please do read the docs: this test is randomm and will fail about 1 in 50 
and if you have already run make check, you have already passed it.

Definitely no bug in R.

On Sun, 14 Aug 2005 jed at jkaplan.info wrote:

> Full_Name: Jed Kaplan
> Version: 2.1.1 Patched
> OS: Fedora Core 4
> Submission from: (NULL) (66.31.221.212)
>
>
> Installation through "make check" succeeds. "Make check-all" fails with the
> following tail message:
> "
> make[3]: Entering directory `/mnt/linuxApp/usr/local/R/R-patched/tests'
> running code in 'p-r-random-tests.R' ...make[3]: *** [p-r-random-tests.Rout]
> Error 1
> make[3]: Leaving directory `/mnt/linuxApp/usr/local/R/R-patched/tests'
> make[2]: *** [test-Random] Error 2
> make[2]: Leaving directory `/mnt/linuxApp/usr/local/R/R-patched/tests'
> make[1]: *** [test-all-devel] Error 1
> make[1]: Leaving directory `/mnt/linuxApp/usr/local/R/R-patched/tests'
> make: *** [check-all] Error 2
> "
>
> The tail of ./tests/p-r-random-tests.Rout.fail is:
> "
>> dkwtest("nbinom",size =   1,prob = 0.8)
> nbinom(size = 1, prob = 0.8) PASSED
> [1] TRUE
>> dkwtest("nbinom",size = 100,prob = 0.8)
> nbinom(size = 100, prob = 0.8) PASSED
> [1] TRUE
>> dkwtest("nbinom",size = 100,prob = 0.999)
> nbinom(size = 100, prob = 0.999) PASSED
> [1] TRUE
>>
>> dkwtest("norm")
> norm() FAILED
> Error in dkwtest("norm") : dkwtest failed
> Execution halted
> "
>
> Here is some system configuration output from "./configure" :
> "
> R is now configured for i686-pc-linux-gnu
>
>  Source directory:          .
>  Installation directory:    /usr/local
>
>  C compiler:                gcc  -g -O2
>  C++ compiler:              g++  -g -O2
>  Fortran compiler:          f95  -g -O2
>
>  Interfaces supported:      X11
>  External libraries:        readline
>  Additional capabilities:   PNG, JPEG, iconv, MBCS, NLS
>  Options enabled:           R profiling
>
>  Recommended packages:      yes
> "
>
> Please advise.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Sun Aug 14 23:24:28 2005
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sun, 14 Aug 2005 22:24:28 +0100 (BST)
Subject: [Rd] parse():ing a unclosed string
In-Reply-To: <42FF11F4.4070802@maths.lth.se>
References: <42FF11F4.4070802@maths.lth.se>
Message-ID: <Pine.LNX.4.61.0508141303280.32176@gannet.stats>

On Sun, 14 Aug 2005, Henrik Bengtsson wrote:

> When parse():ing R code from *file* with a unclosed string, that is, a
> string that has an open quoation mark, but not a ending one, the string
> seems to be closed automagically.  Is this a "bug"?

It's clearly intentional from the comments in the sources: EOF during 
parsing is treated specially.

Generally the parser has not been written to find all syntactic errors: in 
any case one would need a formal language definition to do that.  Prior to 
R-devel quite a few mal-formed constants were accepted, for example.

> Example:
>
> > code <- "x <- '123";
> > parse(text=code)           # Gives an error as expected
> Error in parse(file, n, text, prompt) : parse error
>
> > cat(file="foo.R", code)

What exactly is in this file?

> > expr <- parse("foo.R")     # Closes the open string
> > print(expr)
> expression(x <- "123\n")
>
> Parsing from stdin(), that is parse(), gives an error too.

Those are _not_ the same thing.  I am not clear what you actually tried, 
as you cannot generate an EOF this way.

> Platform: Windows XP Pro SP2, R Version 2.1.1 Patched (2005-07-20) as
> well as R Version 2.2.0 Under development (unstable) (2005-07-19 r34991).

These are rather old for non-released versions: there have been many 
changes since then (especially in R-devel).

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Sun Aug 14 23:17:24 2005
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sun, 14 Aug 2005 22:17:24 +0100 (BST)
Subject: [Rd] documentation for eval() typo
In-Reply-To: <Pine.OSF.4.58.0508141316210.414054@odin.mdacc.tmc.edu>
References: <Pine.OSF.4.58.0508141316210.414054@odin.mdacc.tmc.edu>
Message-ID: <Pine.LNX.4.61.0508142215240.13790@gannet.stats>

Thank you.  It would be easier to deal with thes reports if in future you 
could provide a patch against the source file (here eval.Rd).

On Sun, 14 Aug 2005, Paul Roebuck wrote:

>> It is equivalent to 'evalq' except the its default

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From hb at maths.lth.se  Mon Aug 15 13:44:02 2005
From: hb at maths.lth.se (Henrik Bengtsson)
Date: Mon, 15 Aug 2005 13:44:02 +0200
Subject: [Rd] parse():ing a unclosed string
In-Reply-To: <Pine.LNX.4.61.0508141303280.32176@gannet.stats>
References: <42FF11F4.4070802@maths.lth.se>
	<Pine.LNX.4.61.0508141303280.32176@gannet.stats>
Message-ID: <43008002.7060508@maths.lth.se>

Prof Brian Ripley wrote:
> On Sun, 14 Aug 2005, Henrik Bengtsson wrote:
> 
>> When parse():ing R code from *file* with a unclosed string, that is, a
>> string that has an open quoation mark, but not a ending one, the string
>> seems to be closed automagically.  Is this a "bug"?
> 
> 
> It's clearly intentional from the comments in the sources: EOF during 
> parsing is treated specially.
> 
> Generally the parser has not been written to find all syntactic errors: 
> in any case one would need a formal language definition to do that.  
> Prior to R-devel quite a few mal-formed constants were accepted, for 
> example.
> 
>> Example:
>>
>> > code <- "x <- '123";
>> > parse(text=code)           # Gives an error as expected
>> Error in parse(file, n, text, prompt) : parse error
>>
>> > cat(file="foo.R", code)
> 
> 
> What exactly is in this file?

I'm write the contents of character variable 'code' to file 'foo.R', 
that is, I'm generating a file containing the nine characters "x <- 
'123", then parsing it below.

> 
>> > expr <- parse("foo.R")     # Closes the open string
>> > print(expr)
>> expression(x <- "123\n")
>>
>> Parsing from stdin(), that is parse(), gives an error too.
> 
> 
> Those are _not_ the same thing.  I am not clear what you actually tried, 
> as you cannot generate an EOF this way.

 > parse()
?x <- '123
Error in parse(file, n, text, prompt) : parse error
 >

where press ENTER directly after "123". I'm not exactly sure what is 
happen when I press enter and when or if a EOF is generated, but this 
was the only test I did for stdin().

> 
>> Platform: Windows XP Pro SP2, R Version 2.1.1 Patched (2005-07-20) as
>> well as R Version 2.2.0 Under development (unstable) (2005-07-19 r34991).
> 
> 
> These are rather old for non-released versions: there have been many 
> changes since then (especially in R-devel).

I know, but behind a 56k-modem (again) ;( and though was better to 
report anything than nothing.

/Henrik


From gemachtenest at gmx.de  Mon Aug 15 15:36:02 2005
From: gemachtenest at gmx.de (gemachtenest@gmx.de)
Date: Mon, 15 Aug 2005 15:36:02 +0200 (CEST)
Subject: [Rd] Shutdown by to much data (PR#8065)
Message-ID: <20050815133602.9FF67A27D@slim.kubism.ku.dk>

Full_Name: Jan Bentlage
Version: 2.1.1
OS: Windows
Submission from: (NULL) (212.62.93.226)


I loaded a huge database (textfile, semikolon seperated) by read.csv2. The data
already appeared in the list (by ls()). When I want to view the data in the
editor, R completly crashes.


From ripley at stats.ox.ac.uk  Mon Aug 15 15:58:09 2005
From: ripley at stats.ox.ac.uk (ripley@stats.ox.ac.uk)
Date: Mon, 15 Aug 2005 15:58:09 +0200 (CEST)
Subject: [Rd] Shutdown by to much data (PR#8065)
Message-ID: <20050815135809.84B4C18B8B@slim.kubism.ku.dk>

This is probably a bug in the editor, but you have given us no way to 
reproduce it.  Please see the posting guide and FAQ and give us a 
reproducible example.

On Mon, 15 Aug 2005 gemachtenest at gmx.de wrote:

> Full_Name: Jan Bentlage
> Version: 2.1.1
> OS: Windows
> Submission from: (NULL) (212.62.93.226)
>
>
> I loaded a huge database (textfile, semikolon seperated) by read.csv2. The data
> already appeared in the list (by ls()). When I want to view the data in the
> editor, R completly crashes.

Which means what, exactly?  Again, see the posting guide.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From kkrueger at einthal.de  Mon Aug 15 16:25:53 2005
From: kkrueger at einthal.de (kkrueger@einthal.de)
Date: Mon, 15 Aug 2005 16:25:53 +0200 (CEST)
Subject: [Rd] png and resolution (PR#8066)
Message-ID: <20050815142553.2D12718B8B@slim.kubism.ku.dk>

Full_Name: Knut krueger
Version: 2.1.1
OS: xp Home
Submission from: (NULL) (149.225.134.34)


In the png function the value res seems to be inactive:

bmp(filename = "c:/r/Rplot%03d.bmp", width = 1920, height = 1920, pointsize =
48, bg = "white", res = 2400)
result: 
witdh/heigth  = 1920  <> 20.32 mm
ppi=2400
Results as expected


png(filename = "c:/r/Rplot%03d.png", width = 1920, height = 1920, pointsize =
48, bg = "white", res = 2400)

witdh/heigth  = 1920  <> 20.32 mm
ppi=150
Result not as expected.


From ripley at stats.ox.ac.uk  Mon Aug 15 16:49:25 2005
From: ripley at stats.ox.ac.uk (ripley@stats.ox.ac.uk)
Date: Mon, 15 Aug 2005 16:49:25 +0200 (CEST)
Subject: [Rd] png and resolution (PR#8066)
Message-ID: <20050815144925.4EF8BA27D@slim.kubism.ku.dk>

Where did you get `result' from?  (What program spells that badly and 
where does ppi come from?)

Your last example gives for me (using ImageMagick)

identify  -format "%wx%h res: %x" Rplot001.png
1920x1920 res: 944.88 PixelsPerCentimeter

which is correct.

I believe it is your PNG reader that is buggy, not R.


On Mon, 15 Aug 2005 kkrueger at einthal.de wrote:

> Full_Name: Knut krueger
> Version: 2.1.1
> OS: xp Home
> Submission from: (NULL) (149.225.134.34)
>
>
> In the png function the value res seems to be inactive:
>
> bmp(filename = "c:/r/Rplot%03d.bmp", width = 1920, height = 1920, pointsize =
> 48, bg = "white", res = 2400)
> result:
> witdh/heigth  = 1920  <> 20.32 mm
> ppi=2400
> Results as expected
>
>
> png(filename = "c:/r/Rplot%03d.png", width = 1920, height = 1920, pointsize =
> 48, bg = "white", res = 2400)
>
> witdh/heigth  = 1920  <> 20.32 mm
> ppi=150
> Result not as expected.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From murdoch at stats.uwo.ca  Mon Aug 15 17:04:27 2005
From: murdoch at stats.uwo.ca (murdoch@stats.uwo.ca)
Date: Mon, 15 Aug 2005 17:04:27 +0200 (CEST)
Subject: [Rd] Shutdown by to much data (PR#8065)
Message-ID: <20050815150427.971E518811@slim.kubism.ku.dk>

gemachtenest at gmx.de wrote:
> Full_Name: Jan Bentlage
> Version: 2.1.1
> OS: Windows
> Submission from: (NULL) (212.62.93.226)
> 
> 
> I loaded a huge database (textfile, semikolon seperated) by read.csv2. The data
> already appeared in the list (by ls()). When I want to view the data in the
> editor, R completly crashes.

Please put together a reproducible example.  This might be a data editor 
bug or a bug in read.csv2 or something specific to your system.

For example, create a data.frame of the same size containing simulated 
values, then see if you can edit that.  If you can, write it out to a 
file, and see if you can read it in.

A bug report that is as vague as yours isn't likely to be acted on.

Duncan Murdoch


From roebuck at odin.mdacc.tmc.edu  Mon Aug 15 17:10:04 2005
From: roebuck at odin.mdacc.tmc.edu (Paul Roebuck)
Date: Mon, 15 Aug 2005 10:10:04 -0500 (CDT)
Subject: [Rd] Patches (was Re:  documentation for eval() typo)
In-Reply-To: <Pine.LNX.4.61.0508142215240.13790@gannet.stats>
References: <Pine.OSF.4.58.0508141316210.414054@odin.mdacc.tmc.edu>
	<Pine.LNX.4.61.0508142215240.13790@gannet.stats>
Message-ID: <Pine.OSF.4.58.0508150944260.460227@odin.mdacc.tmc.edu>

On Sun, 14 Aug 2005, Prof Brian Ripley wrote:

> On Sun, 14 Aug 2005, Paul Roebuck wrote:
>
> >> It is equivalent to 'evalq' except the its default
>
> It would be easier to deal with thes reports if in future you
> could provide a patch against the source file (here eval.Rd).

I normally download a copy of the current binary and the
matching source distribution for performing searches, so
would not be tracking r-devel or r-patched updates.

Would the following have been palatable as annotated?


R-2.1.1/src/library/base/man/eval.Rd:
59c59
<   equivalent to \code{evalq} except that its default argument creates a
---
>   equivalent to \code{evalq} except the its default argument creates a

----------------------------------------------------------
SIGSIG -- signature too long (core dumped)


From ripley at stats.ox.ac.uk  Mon Aug 15 17:32:30 2005
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 15 Aug 2005 16:32:30 +0100 (BST)
Subject: [Rd] Patches (was Re:  documentation for eval() typo)
In-Reply-To: <Pine.OSF.4.58.0508150944260.460227@odin.mdacc.tmc.edu>
References: <Pine.OSF.4.58.0508141316210.414054@odin.mdacc.tmc.edu>
	<Pine.LNX.4.61.0508142215240.13790@gannet.stats>
	<Pine.OSF.4.58.0508150944260.460227@odin.mdacc.tmc.edu>
Message-ID: <Pine.LNX.4.61.0508151631190.8126@gannet.stats>

On Mon, 15 Aug 2005, Paul Roebuck wrote:

> On Sun, 14 Aug 2005, Prof Brian Ripley wrote:
>
>> On Sun, 14 Aug 2005, Paul Roebuck wrote:
>>
>>>> It is equivalent to 'evalq' except the its default
>>
>> It would be easier to deal with thes reports if in future you
>> could provide a patch against the source file (here eval.Rd).
>
> I normally download a copy of the current binary and the
> matching source distribution for performing searches, so
> would not be tracking r-devel or r-patched updates.
>
> Would the following have been palatable as annotated?

Yes, it would have been easy to incorporate.

> R-2.1.1/src/library/base/man/eval.Rd:
> 59c59
> <   equivalent to \code{evalq} except that its default argument creates a
> ---
>>   equivalent to \code{evalq} except the its default argument creates a

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From u9126801 at stat.nctu.edu.tw  Tue Aug 16 11:10:28 2005
From: u9126801 at stat.nctu.edu.tw (u9126801@stat.nctu.edu.tw)
Date: Tue, 16 Aug 2005 11:10:28 +0200 (CEST)
Subject: [Rd] missing sh.exe file when running "R CMD INSTALL test" (PR#8068)
Message-ID: <20050816091028.9F886183A2@slim.kubism.ku.dk>

I am trying to learn how to make a simple package that contains no C
or Fortran code.  I used package.skeleton(...) to make a package
called "test".  The directory and files look good.  I downloaded and
installed Rtools (www.murdoch-sutherland.com/Rtools/tools.zip).  I
added the path and from the dos prompt I can verify that make.exe and
sh.exe both exist, but when I try to run "R CMD INSTALL test" I get an
error "make: sh.exe: Command not found"  and "make: *** [pkg-test]
Error 127".  I get the same error message if a try the command "make
pkg-test".

I saw in an old FAQ a suggestion to move sh.eve to the C:\bin\ folder,
but my C: root does not have a "bin" folder.  Nonetheless, I created
one and put sh.exe there and it provided no help (I didn't expect it
too).

Can anyone help me?


	[[alternative HTML version deleted]]


From gavin.simpson at ucl.ac.uk  Tue Aug 16 17:15:18 2005
From: gavin.simpson at ucl.ac.uk (Gavin Simpson)
Date: Tue, 16 Aug 2005 16:15:18 +0100
Subject: [Rd] problem using model.frame()
Message-ID: <1124205318.8689.45.camel@gsimpson.geog.ucl.ac.uk>

Hi I'm having a problem with model.frame, encapsulated in this example:

y1 <- matrix(c(3,1,0,1,0,1,1,0,0,0,1,0,0,0,1,1,0,1,1,1),
             nrow = 5, byrow = TRUE)
y1 <- as.data.frame(y1)
rownames(y1) <- paste("site", 1:5, sep = "")
colnames(y1) <- paste("spp", 1:4, sep = "")
y1

model.frame(~ y1)
Error in model.frame(formula, rownames, variables, varnames, extras, extranames,  : 
	invalid variable type

temp <- as.matrix(y1)
model.frame(~ temp)
  temp.spp1 temp.spp2 temp.spp3 temp.spp4
1         3         1         0         1
2         0         1         1         0
3         0         0         1         0
4         0         0         1         1
5         0         1         1         1

Ideally the above wouldn't have names like temp.var1, temp.var2, but one
could deal with that later.

I have tracked down the source of the error message to line 1330 in
model.c - here I'm stumped as I don't know any C, but it looks as if the
code is looping over the variables in the formula and checking of they
are the right "type". So a matrix of variables gets through, but a
data.frame doesn't.

It would be good if model.frame could cope with data.frames in formulae,
but seeing as I am incapable of providing a patch, is there a way around
this problem?

Below is the head of the function I am currently using, including the
function for parsing the formula - borrowed and hacked from
ordiParseFormula() in package vegan.

I can work out the class of the rhs of the forumla. Is there a way to
create a suitable environment for the data argument of parseFormula()
such that it contains the rhs dataframe coerced to a matrix, which then
should get through model.frame.default without error? How would I go
about manipulating/creating such an environment? Any other ideas?

Thanks in advance

Gav

coca.formula <- function(formula, method = c("predictive", "symmetric"),
                         reg.method = c("simpls", "eigen"), weights = NULL,
                         n.axes = NULL, symmetric = FALSE, data)
  {
    parseFormula <- function (formula, data)
      {
        browser()
        Terms <- terms(formula, "Condition", data = data)
        flapart <- fla <- formula <- formula(Terms, width.cutoff = 500)
        specdata <- formula[[2]]
        X <- eval(specdata, data, parent.frame())
        X <- as.matrix(X)
        formula[[2]] <- NULL
        if (formula[[2]] == "1" || formula[[2]] == "0")
          Y <- NULL
        else {
          mf <- model.frame(formula, data, na.action = na.fail)
          Y <- model.matrix(formula, mf)
          if (any(colnames(Y) == "(Intercept)")) {
            xint <- which(colnames(Y) == "(Intercept)")
            Y <- Y[, -xint, drop = FALSE]
          }
        }
        list(X = X, Y = Y)
      }
    if (missing(data))
      data <- parent.frame()
    #browser()
    dat <- parseFormula(formula, data)

-- 
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
Gavin Simpson                     [T] +44 (0)20 7679 5522
ENSIS Research Fellow             [F] +44 (0)20 7679 7565
ENSIS Ltd. & ECRC                 [E] gavin.simpsonATNOSPAMucl.ac.uk
UCL Department of Geography       [W] http://www.ucl.ac.uk/~ucfagls/cv/
26 Bedford Way                    [W] http://www.ucl.ac.uk/~ucfagls/
London.  WC1H 0AP.
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%


From ggrothendieck at gmail.com  Tue Aug 16 17:25:01 2005
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Tue, 16 Aug 2005 11:25:01 -0400
Subject: [Rd] problem using model.frame()
In-Reply-To: <1124205318.8689.45.camel@gsimpson.geog.ucl.ac.uk>
References: <1124205318.8689.45.camel@gsimpson.geog.ucl.ac.uk>
Message-ID: <971536df05081608254fe12843@mail.gmail.com>

It can handle data frames like this:

	model.frame(y1)
or
	model.frame(~., y1)


On 8/16/05, Gavin Simpson <gavin.simpson at ucl.ac.uk> wrote:
> Hi I'm having a problem with model.frame, encapsulated in this example:
> 
> y1 <- matrix(c(3,1,0,1,0,1,1,0,0,0,1,0,0,0,1,1,0,1,1,1),
>             nrow = 5, byrow = TRUE)
> y1 <- as.data.frame(y1)
> rownames(y1) <- paste("site", 1:5, sep = "")
> colnames(y1) <- paste("spp", 1:4, sep = "")
> y1
> 
> model.frame(~ y1)
> Error in model.frame(formula, rownames, variables, varnames, extras, extranames,  :
>        invalid variable type
> 
> temp <- as.matrix(y1)
> model.frame(~ temp)
>  temp.spp1 temp.spp2 temp.spp3 temp.spp4
> 1         3         1         0         1
> 2         0         1         1         0
> 3         0         0         1         0
> 4         0         0         1         1
> 5         0         1         1         1
> 
> Ideally the above wouldn't have names like temp.var1, temp.var2, but one
> could deal with that later.
> 
> I have tracked down the source of the error message to line 1330 in
> model.c - here I'm stumped as I don't know any C, but it looks as if the
> code is looping over the variables in the formula and checking of they
> are the right "type". So a matrix of variables gets through, but a
> data.frame doesn't.
> 
> It would be good if model.frame could cope with data.frames in formulae,
> but seeing as I am incapable of providing a patch, is there a way around
> this problem?
> 
> Below is the head of the function I am currently using, including the
> function for parsing the formula - borrowed and hacked from
> ordiParseFormula() in package vegan.
> 
> I can work out the class of the rhs of the forumla. Is there a way to
> create a suitable environment for the data argument of parseFormula()
> such that it contains the rhs dataframe coerced to a matrix, which then
> should get through model.frame.default without error? How would I go
> about manipulating/creating such an environment? Any other ideas?
> 
> Thanks in advance
> 
> Gav
> 
> coca.formula <- function(formula, method = c("predictive", "symmetric"),
>                         reg.method = c("simpls", "eigen"), weights = NULL,
>                         n.axes = NULL, symmetric = FALSE, data)
>  {
>    parseFormula <- function (formula, data)
>      {
>        browser()
>        Terms <- terms(formula, "Condition", data = data)
>        flapart <- fla <- formula <- formula(Terms, width.cutoff = 500)
>        specdata <- formula[[2]]
>        X <- eval(specdata, data, parent.frame())
>        X <- as.matrix(X)
>        formula[[2]] <- NULL
>        if (formula[[2]] == "1" || formula[[2]] == "0")
>          Y <- NULL
>        else {
>          mf <- model.frame(formula, data, na.action = na.fail)
>          Y <- model.matrix(formula, mf)
>          if (any(colnames(Y) == "(Intercept)")) {
>            xint <- which(colnames(Y) == "(Intercept)")
>            Y <- Y[, -xint, drop = FALSE]
>          }
>        }
>        list(X = X, Y = Y)
>      }
>    if (missing(data))
>      data <- parent.frame()
>    #browser()
>    dat <- parseFormula(formula, data)
> 
> --
> %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
> Gavin Simpson                     [T] +44 (0)20 7679 5522
> ENSIS Research Fellow             [F] +44 (0)20 7679 7565
> ENSIS Ltd. & ECRC                 [E] gavin.simpsonATNOSPAMucl.ac.uk
> UCL Department of Geography       [W] http://www.ucl.ac.uk/~ucfagls/cv/
> 26 Bedford Way                    [W] http://www.ucl.ac.uk/~ucfagls/
> London.  WC1H 0AP.
> %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From gavin.simpson at ucl.ac.uk  Tue Aug 16 17:39:29 2005
From: gavin.simpson at ucl.ac.uk (Gavin Simpson)
Date: Tue, 16 Aug 2005 16:39:29 +0100
Subject: [Rd] problem using model.frame()
In-Reply-To: <971536df05081608254fe12843@mail.gmail.com>
References: <1124205318.8689.45.camel@gsimpson.geog.ucl.ac.uk>
	<971536df05081608254fe12843@mail.gmail.com>
Message-ID: <1124206769.8689.65.camel@gsimpson.geog.ucl.ac.uk>

On Tue, 2005-08-16 at 11:25 -0400, Gabor Grothendieck wrote:
> It can handle data frames like this:
> 
> 	model.frame(y1)
> or
> 	model.frame(~., y1)

Thanks Gabor,

Yes, I know that works, but I want the function coca.formula to accept a
formula like this y2 ~ y1, with both y1 and y2 being data frames. It is
more intuitive, to my mind at least for this particular example and
analysis, to specify the formula with a data frame on the rhs.

model.frame doesn't work with the formula "~ y1" if the object y1, in
the environment when model.frame evaluates the formula, is a data.frame.
It works if y1 is a matrix, however. I'd like to work around this
problem, say by creating an environment in which y1 is modified to be a
matrix, if possible. Can this be done?

At the moment I have something working by grabbing the bits of the
formula and then using get() to grab the named object. Of course, this
won't work if someone wants to use R's formula interface with the
following formula y2 ~ var1 + var2 + var3, data = y1, or to use the
subset argument common to many formula implementations. I'd like to have
the function work in as general a manner as possible, so I'm fishing
around for potential solutions.

All the best,

Gav 

> 
> On 8/16/05, Gavin Simpson <gavin.simpson at ucl.ac.uk> wrote:
> > Hi I'm having a problem with model.frame, encapsulated in this example:
> > 
> > y1 <- matrix(c(3,1,0,1,0,1,1,0,0,0,1,0,0,0,1,1,0,1,1,1),
> >             nrow = 5, byrow = TRUE)
> > y1 <- as.data.frame(y1)
> > rownames(y1) <- paste("site", 1:5, sep = "")
> > colnames(y1) <- paste("spp", 1:4, sep = "")
> > y1
> > 
> > model.frame(~ y1)
> > Error in model.frame(formula, rownames, variables, varnames, extras, extranames,  :
> >        invalid variable type
> > 
> > temp <- as.matrix(y1)
> > model.frame(~ temp)
> >  temp.spp1 temp.spp2 temp.spp3 temp.spp4
> > 1         3         1         0         1
> > 2         0         1         1         0
> > 3         0         0         1         0
> > 4         0         0         1         1
> > 5         0         1         1         1
> > 
> > Ideally the above wouldn't have names like temp.var1, temp.var2, but one
> > could deal with that later.
> > 
> > I have tracked down the source of the error message to line 1330 in
> > model.c - here I'm stumped as I don't know any C, but it looks as if the
> > code is looping over the variables in the formula and checking of they
> > are the right "type". So a matrix of variables gets through, but a
> > data.frame doesn't.
> > 
> > It would be good if model.frame could cope with data.frames in formulae,
> > but seeing as I am incapable of providing a patch, is there a way around
> > this problem?
> > 
> > Below is the head of the function I am currently using, including the
> > function for parsing the formula - borrowed and hacked from
> > ordiParseFormula() in package vegan.
> > 
> > I can work out the class of the rhs of the forumla. Is there a way to
> > create a suitable environment for the data argument of parseFormula()
> > such that it contains the rhs dataframe coerced to a matrix, which then
> > should get through model.frame.default without error? How would I go
> > about manipulating/creating such an environment? Any other ideas?
> > 
> > Thanks in advance
> > 
> > Gav
> > 
> > coca.formula <- function(formula, method = c("predictive", "symmetric"),
> >                         reg.method = c("simpls", "eigen"), weights = NULL,
> >                         n.axes = NULL, symmetric = FALSE, data)
> >  {
> >    parseFormula <- function (formula, data)
> >      {
> >        browser()
> >        Terms <- terms(formula, "Condition", data = data)
> >        flapart <- fla <- formula <- formula(Terms, width.cutoff = 500)
> >        specdata <- formula[[2]]
> >        X <- eval(specdata, data, parent.frame())
> >        X <- as.matrix(X)
> >        formula[[2]] <- NULL
> >        if (formula[[2]] == "1" || formula[[2]] == "0")
> >          Y <- NULL
> >        else {
> >          mf <- model.frame(formula, data, na.action = na.fail)
> >          Y <- model.matrix(formula, mf)
> >          if (any(colnames(Y) == "(Intercept)")) {
> >            xint <- which(colnames(Y) == "(Intercept)")
> >            Y <- Y[, -xint, drop = FALSE]
> >          }
> >        }
> >        list(X = X, Y = Y)
> >      }
> >    if (missing(data))
> >      data <- parent.frame()
> >    #browser()
> >    dat <- parseFormula(formula, data)
> > 
> > --
> > %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
> > Gavin Simpson                     [T] +44 (0)20 7679 5522
> > ENSIS Research Fellow             [F] +44 (0)20 7679 7565
> > ENSIS Ltd. & ECRC                 [E] gavin.simpsonATNOSPAMucl.ac.uk
> > UCL Department of Geography       [W] http://www.ucl.ac.uk/~ucfagls/cv/
> > 26 Bedford Way                    [W] http://www.ucl.ac.uk/~ucfagls/
> > London.  WC1H 0AP.
> > %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
> > 
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >
-- 
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
Gavin Simpson                     [T] +44 (0)20 7679 5522
ENSIS Research Fellow             [F] +44 (0)20 7679 7565
ENSIS Ltd. & ECRC                 [E] gavin.simpsonATNOSPAMucl.ac.uk
UCL Department of Geography       [W] http://www.ucl.ac.uk/~ucfagls/cv/
26 Bedford Way                    [W] http://www.ucl.ac.uk/~ucfagls/
London.  WC1H 0AP.
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%


From ggrothendieck at gmail.com  Tue Aug 16 18:35:36 2005
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Tue, 16 Aug 2005 12:35:36 -0400
Subject: [Rd] problem using model.frame()
In-Reply-To: <1124206769.8689.65.camel@gsimpson.geog.ucl.ac.uk>
References: <1124205318.8689.45.camel@gsimpson.geog.ucl.ac.uk>
	<971536df05081608254fe12843@mail.gmail.com>
	<1124206769.8689.65.camel@gsimpson.geog.ucl.ac.uk>
Message-ID: <971536df050816093559c40389@mail.gmail.com>

On 8/16/05, Gavin Simpson <gavin.simpson at ucl.ac.uk> wrote:
> On Tue, 2005-08-16 at 11:25 -0400, Gabor Grothendieck wrote:
> > It can handle data frames like this:
> >
> >       model.frame(y1)
> > or
> >       model.frame(~., y1)
> 
> Thanks Gabor,
> 
> Yes, I know that works, but I want the function coca.formula to accept a
> formula like this y2 ~ y1, with both y1 and y2 being data frames. It is

The expressions I gave work generally (i.e. lm, glm, ...), not just in 
model.matrix, so would it be ok if the user just does this?

yourfunction(y2 ~., y1)

If it really is important to do it the way you describe, are the data 
frames necessarily numeric? If so you could preprocess your formula 
by placing as.matrix around all the variables representing data frames 
using something like this:

https://www.stat.math.ethz.ch/pipermail/r-help/2004-December/061485.html

Of course, if they are necessarily numeric maybe they can be matrices in
the first place?

> more intuitive, to my mind at least for this particular example and
> analysis, to specify the formula with a data frame on the rhs.
> 
> model.frame doesn't work with the formula "~ y1" if the object y1, in
> the environment when model.frame evaluates the formula, is a data.frame.
> It works if y1 is a matrix, however. I'd like to work around this
> problem, say by creating an environment in which y1 is modified to be a
> matrix, if possible. Can this be done?
> 
> At the moment I have something working by grabbing the bits of the
> formula and then using get() to grab the named object. Of course, this
> won't work if someone wants to use R's formula interface with the
> following formula y2 ~ var1 + var2 + var3, data = y1, or to use the
> subset argument common to many formula implementations. I'd like to have
> the function work in as general a manner as possible, so I'm fishing
> around for potential solutions.
> 
> All the best,
> 
> Gav
> 
> >
> > On 8/16/05, Gavin Simpson <gavin.simpson at ucl.ac.uk> wrote:
> > > Hi I'm having a problem with model.frame, encapsulated in this example:
> > >
> > > y1 <- matrix(c(3,1,0,1,0,1,1,0,0,0,1,0,0,0,1,1,0,1,1,1),
> > >             nrow = 5, byrow = TRUE)
> > > y1 <- as.data.frame(y1)
> > > rownames(y1) <- paste("site", 1:5, sep = "")
> > > colnames(y1) <- paste("spp", 1:4, sep = "")
> > > y1
> > >
> > > model.frame(~ y1)
> > > Error in model.frame(formula, rownames, variables, varnames, extras, extranames,  :
> > >        invalid variable type
> > >
> > > temp <- as.matrix(y1)
> > > model.frame(~ temp)
> > >  temp.spp1 temp.spp2 temp.spp3 temp.spp4
> > > 1         3         1         0         1
> > > 2         0         1         1         0
> > > 3         0         0         1         0
> > > 4         0         0         1         1
> > > 5         0         1         1         1
> > >
> > > Ideally the above wouldn't have names like temp.var1, temp.var2, but one
> > > could deal with that later.
> > >
> > > I have tracked down the source of the error message to line 1330 in
> > > model.c - here I'm stumped as I don't know any C, but it looks as if the
> > > code is looping over the variables in the formula and checking of they
> > > are the right "type". So a matrix of variables gets through, but a
> > > data.frame doesn't.
> > >
> > > It would be good if model.frame could cope with data.frames in formulae,
> > > but seeing as I am incapable of providing a patch, is there a way around
> > > this problem?
> > >
> > > Below is the head of the function I am currently using, including the
> > > function for parsing the formula - borrowed and hacked from
> > > ordiParseFormula() in package vegan.
> > >
> > > I can work out the class of the rhs of the forumla. Is there a way to
> > > create a suitable environment for the data argument of parseFormula()
> > > such that it contains the rhs dataframe coerced to a matrix, which then
> > > should get through model.frame.default without error? How would I go
> > > about manipulating/creating such an environment? Any other ideas?
> > >
> > > Thanks in advance
> > >
> > > Gav
> > >
> > > coca.formula <- function(formula, method = c("predictive", "symmetric"),
> > >                         reg.method = c("simpls", "eigen"), weights = NULL,
> > >                         n.axes = NULL, symmetric = FALSE, data)
> > >  {
> > >    parseFormula <- function (formula, data)
> > >      {
> > >        browser()
> > >        Terms <- terms(formula, "Condition", data = data)
> > >        flapart <- fla <- formula <- formula(Terms, width.cutoff = 500)
> > >        specdata <- formula[[2]]
> > >        X <- eval(specdata, data, parent.frame())
> > >        X <- as.matrix(X)
> > >        formula[[2]] <- NULL
> > >        if (formula[[2]] == "1" || formula[[2]] == "0")
> > >          Y <- NULL
> > >        else {
> > >          mf <- model.frame(formula, data, na.action = na.fail)
> > >          Y <- model.matrix(formula, mf)
> > >          if (any(colnames(Y) == "(Intercept)")) {
> > >            xint <- which(colnames(Y) == "(Intercept)")
> > >            Y <- Y[, -xint, drop = FALSE]
> > >          }
> > >        }
> > >        list(X = X, Y = Y)
> > >      }
> > >    if (missing(data))
> > >      data <- parent.frame()
> > >    #browser()
> > >    dat <- parseFormula(formula, data)
> > >
> > > --
> > > %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
> > > Gavin Simpson                     [T] +44 (0)20 7679 5522
> > > ENSIS Research Fellow             [F] +44 (0)20 7679 7565
> > > ENSIS Ltd. & ECRC                 [E] gavin.simpsonATNOSPAMucl.ac.uk
> > > UCL Department of Geography       [W] http://www.ucl.ac.uk/~ucfagls/cv/
> > > 26 Bedford Way                    [W] http://www.ucl.ac.uk/~ucfagls/
> > > London.  WC1H 0AP.
> > > %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
> > >
> > > ______________________________________________
> > > R-devel at r-project.org mailing list
> > > https://stat.ethz.ch/mailman/listinfo/r-devel
> > >
> --
> %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
> Gavin Simpson                     [T] +44 (0)20 7679 5522
> ENSIS Research Fellow             [F] +44 (0)20 7679 7565
> ENSIS Ltd. & ECRC                 [E] gavin.simpsonATNOSPAMucl.ac.uk
> UCL Department of Geography       [W] http://www.ucl.ac.uk/~ucfagls/cv/
> 26 Bedford Way                    [W] http://www.ucl.ac.uk/~ucfagls/
> London.  WC1H 0AP.
> %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
> 
> 
>


From gavin.simpson at ucl.ac.uk  Tue Aug 16 19:44:23 2005
From: gavin.simpson at ucl.ac.uk (Gavin Simpson)
Date: Tue, 16 Aug 2005 18:44:23 +0100
Subject: [Rd] problem using model.frame()
In-Reply-To: <971536df050816093559c40389@mail.gmail.com>
References: <1124205318.8689.45.camel@gsimpson.geog.ucl.ac.uk>
	<971536df05081608254fe12843@mail.gmail.com>
	<1124206769.8689.65.camel@gsimpson.geog.ucl.ac.uk>
	<971536df050816093559c40389@mail.gmail.com>
Message-ID: <1124214263.8689.108.camel@gsimpson.geog.ucl.ac.uk>

On Tue, 2005-08-16 at 12:35 -0400, Gabor Grothendieck wrote:
> On 8/16/05, Gavin Simpson <gavin.simpson at ucl.ac.uk> wrote:
> > On Tue, 2005-08-16 at 11:25 -0400, Gabor Grothendieck wrote:
> > > It can handle data frames like this:
> > >
> > >       model.frame(y1)
> > > or
> > >       model.frame(~., y1)
> > 
> > Thanks Gabor,
> > 
> > Yes, I know that works, but I want the function coca.formula to accept a
> > formula like this y2 ~ y1, with both y1 and y2 being data frames. It is
> 
> The expressions I gave work generally (i.e. lm, glm, ...), not just in 
> model.matrix, so would it be ok if the user just does this?
> 
> yourfunction(y2 ~., y1)

Thanks again Gabor for your comments,

I'd prefer the y1 ~ y2 as data frames - as this is the most natural way
of doing things. I'd like to have (y2 ~., y1) as well, and (y2 ~ spp1 +
spp2 + spp3, y1) also work - silently without any trouble.

> If it really is important to do it the way you describe, are the data 
> frames necessarily numeric? If so you could preprocess your formula 
> by placing as.matrix around all the variables representing data frames 
> using something like this:
> 
> https://www.stat.math.ethz.ch/pipermail/r-help/2004-December/061485.html

Yes, they are numeric matrices (as data frames). I've looked at this,
but I'd prefer to not have to do too much messing with the formula.

> Of course, if they are necessarily numeric maybe they can be matrices in
> the first place?

Because read.table etc. produce data.frames and this is the natural way
to work with data in R.

Following your suggestions, I altered my code to evaluate the rhs of the
formula and check if it was of class "data.frame". If it is then I stop
processing and return it as a data.frame as this point. If not, it
eventually gets passed on to model.frame() for it to deal with it.

So far - limited testing - it seems to do what I wanted all along. I'm
sure there's a gotcha in there somewhere but at least the code runs so I
can check for problems against my examples.

Right, back to writing documentation...

G

> > more intuitive, to my mind at least for this particular example and
> > analysis, to specify the formula with a data frame on the rhs.
> > 
> > model.frame doesn't work with the formula "~ y1" if the object y1, in
> > the environment when model.frame evaluates the formula, is a data.frame.
> > It works if y1 is a matrix, however. I'd like to work around this
> > problem, say by creating an environment in which y1 is modified to be a
> > matrix, if possible. Can this be done?
> > 
> > At the moment I have something working by grabbing the bits of the
> > formula and then using get() to grab the named object. Of course, this
> > won't work if someone wants to use R's formula interface with the
> > following formula y2 ~ var1 + var2 + var3, data = y1, or to use the
> > subset argument common to many formula implementations. I'd like to have
> > the function work in as general a manner as possible, so I'm fishing
> > around for potential solutions.
> > 
> > All the best,
> > 
> > Gav
> > 
> > >
> > > On 8/16/05, Gavin Simpson <gavin.simpson at ucl.ac.uk> wrote:
> > > > Hi I'm having a problem with model.frame, encapsulated in this example:
> > > >
> > > > y1 <- matrix(c(3,1,0,1,0,1,1,0,0,0,1,0,0,0,1,1,0,1,1,1),
> > > >             nrow = 5, byrow = TRUE)
> > > > y1 <- as.data.frame(y1)
> > > > rownames(y1) <- paste("site", 1:5, sep = "")
> > > > colnames(y1) <- paste("spp", 1:4, sep = "")
> > > > y1
> > > >
> > > > model.frame(~ y1)
> > > > Error in model.frame(formula, rownames, variables, varnames, extras, extranames,  :
> > > >        invalid variable type
> > > >
> > > > temp <- as.matrix(y1)
> > > > model.frame(~ temp)
> > > >  temp.spp1 temp.spp2 temp.spp3 temp.spp4
> > > > 1         3         1         0         1
> > > > 2         0         1         1         0
> > > > 3         0         0         1         0
> > > > 4         0         0         1         1
> > > > 5         0         1         1         1
> > > >
> > > > Ideally the above wouldn't have names like temp.var1, temp.var2, but one
> > > > could deal with that later.
> > > >
> > > > I have tracked down the source of the error message to line 1330 in
> > > > model.c - here I'm stumped as I don't know any C, but it looks as if the
> > > > code is looping over the variables in the formula and checking of they
> > > > are the right "type". So a matrix of variables gets through, but a
> > > > data.frame doesn't.
> > > >
> > > > It would be good if model.frame could cope with data.frames in formulae,
> > > > but seeing as I am incapable of providing a patch, is there a way around
> > > > this problem?
> > > >
> > > > Below is the head of the function I am currently using, including the
> > > > function for parsing the formula - borrowed and hacked from
> > > > ordiParseFormula() in package vegan.
> > > >
> > > > I can work out the class of the rhs of the forumla. Is there a way to
> > > > create a suitable environment for the data argument of parseFormula()
> > > > such that it contains the rhs dataframe coerced to a matrix, which then
> > > > should get through model.frame.default without error? How would I go
> > > > about manipulating/creating such an environment? Any other ideas?
> > > >
> > > > Thanks in advance
> > > >
> > > > Gav
> > > >
> > > > coca.formula <- function(formula, method = c("predictive", "symmetric"),
> > > >                         reg.method = c("simpls", "eigen"), weights = NULL,
> > > >                         n.axes = NULL, symmetric = FALSE, data)
> > > >  {
> > > >    parseFormula <- function (formula, data)
> > > >      {
> > > >        browser()
> > > >        Terms <- terms(formula, "Condition", data = data)
> > > >        flapart <- fla <- formula <- formula(Terms, width.cutoff = 500)
> > > >        specdata <- formula[[2]]
> > > >        X <- eval(specdata, data, parent.frame())
> > > >        X <- as.matrix(X)
> > > >        formula[[2]] <- NULL
> > > >        if (formula[[2]] == "1" || formula[[2]] == "0")
> > > >          Y <- NULL
> > > >        else {
> > > >          mf <- model.frame(formula, data, na.action = na.fail)
> > > >          Y <- model.matrix(formula, mf)
> > > >          if (any(colnames(Y) == "(Intercept)")) {
> > > >            xint <- which(colnames(Y) == "(Intercept)")
> > > >            Y <- Y[, -xint, drop = FALSE]
> > > >          }
> > > >        }
> > > >        list(X = X, Y = Y)
> > > >      }
> > > >    if (missing(data))
> > > >      data <- parent.frame()
> > > >    #browser()
> > > >    dat <- parseFormula(formula, data)
> > > >
> > > > --
> > > > %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
> > > > Gavin Simpson                     [T] +44 (0)20 7679 5522
> > > > ENSIS Research Fellow             [F] +44 (0)20 7679 7565
> > > > ENSIS Ltd. & ECRC                 [E] gavin.simpsonATNOSPAMucl.ac.uk
> > > > UCL Department of Geography       [W] http://www.ucl.ac.uk/~ucfagls/cv/
> > > > 26 Bedford Way                    [W] http://www.ucl.ac.uk/~ucfagls/
> > > > London.  WC1H 0AP.
> > > > %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
> > > >
> > > > ______________________________________________
> > > > R-devel at r-project.org mailing list
> > > > https://stat.ethz.ch/mailman/listinfo/r-devel
> > > >
> > --
> > %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
> > Gavin Simpson                     [T] +44 (0)20 7679 5522
> > ENSIS Research Fellow             [F] +44 (0)20 7679 7565
> > ENSIS Ltd. & ECRC                 [E] gavin.simpsonATNOSPAMucl.ac.uk
> > UCL Department of Geography       [W] http://www.ucl.ac.uk/~ucfagls/cv/
> > 26 Bedford Way                    [W] http://www.ucl.ac.uk/~ucfagls/
> > London.  WC1H 0AP.
> > %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
> > 
> > 
> >
-- 
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
Gavin Simpson                     [T] +44 (0)20 7679 5522
ENSIS Research Fellow             [F] +44 (0)20 7679 7565
ENSIS Ltd. & ECRC                 [E] gavin.simpsonATNOSPAMucl.ac.uk
UCL Department of Geography       [W] http://www.ucl.ac.uk/~ucfagls/cv/
26 Bedford Way                    [W] http://www.ucl.ac.uk/~ucfagls/
London.  WC1H 0AP.
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%


From cpaulse at aecom.yu.edu  Tue Aug 16 21:11:51 2005
From: cpaulse at aecom.yu.edu (cpaulse@aecom.yu.edu)
Date: Tue, 16 Aug 2005 21:11:51 +0200 (CEST)
Subject: [Rd] quirky behavior from rbinom (PR#8071)
Message-ID: <20050816191151.1F50B18B97@slim.kubism.ku.dk>

Full_Name: Chris Paulse
Version: 2.1.1
OS: WinXP
Submission from: (NULL) (129.98.60.134)


This seems strange.  I have a small block of code that repeatedly calls rbinom. 
I put a break in there in case it returns NaN, as I've been having problems with
this.  Here is a transcript from the debug session:

Browse[1]> theP
[1] 1
Browse[1]> yleft[dataIndex]
[1] 3
Browse[1]> rbinom(1,3,1)
[1] 3
Browse[1]> rbinom(1,yleft[dataIndex], theP)
[1] NaN

Strange, huh?


From arnima at u.washington.edu  Tue Aug 16 21:26:21 2005
From: arnima at u.washington.edu (arnima@u.washington.edu)
Date: Tue, 16 Aug 2005 21:26:21 +0200 (CEST)
Subject: [Rd] yaxs in bxp() (PR#8072)
Message-ID: <20050816192621.B3A5F18B9D@slim.kubism.ku.dk>

It would be easy to add 'yaxs' support to bxp(), which can aid visual 
comparison when the lower limit is zero. The two lines from boxplot.R that 
would change are:


  plot.window(ylim=c(0.5,n+0.5), xlim=ylim, log=log)
to
  plot.window(ylim=c(0.5,n+0.5), xlim=ylim, xaxs=pars$yaxs, log=log)

and

  plot.window(xlim=c(0.5,n+0.5), ylim=ylim, log=log)
to
  plot.window(xlim=c(0.5,n+0.5), ylim=ylim, yaxs=pars$yaxs, log=log)


Boxplots already respond to a global par(yaxs="i"), and I think users 
would appreciate support for the local graphical parameter as well.

Thanks,
Arni

R 2.1.1-patched on WinXP


From arnima at u.washington.edu  Tue Aug 16 21:26:43 2005
From: arnima at u.washington.edu (arnima@u.washington.edu)
Date: Tue, 16 Aug 2005 21:26:43 +0200 (CEST)
Subject: [Rd] pch=NA in bxp.Rd (PR#8073)
Message-ID: <20050816192643.9810D18B9D@slim.kubism.ku.dk>

I'd like to iterate my earlier request (#7737) to change the documentation 
for bxp().

The argument outpch=" " needs to be replaced with outpch=NA in two places.

I actually wrote this part of the documentation myself at one point, but 
have now realized that pch=NA and pch=" " are not the same:

   x <- split(rlnorm(26e4), letters)
   ## NA generates small file
   postscript("na.ps");    boxplot(x,outpch=NA);  dev.off()
   ## Space generates large file
   postscript("space.ps"); boxplot(x,outpch=" "); dev.off()

Thank you,
Arni

R 2.1.1-patched on WinXP


From ripley at stats.ox.ac.uk  Tue Aug 16 21:52:21 2005
From: ripley at stats.ox.ac.uk (ripley@stats.ox.ac.uk)
Date: Tue, 16 Aug 2005 21:52:21 +0200 (CEST)
Subject: [Rd] quirky behavior from rbinom (PR#8071)
Message-ID: <20050816195221.85EB218B9E@slim.kubism.ku.dk>

Please supply a reproducible example as both the FAQ and the posting 
guide do ask.

On Tue, 16 Aug 2005 cpaulse at aecom.yu.edu wrote:

> Full_Name: Chris Paulse
> Version: 2.1.1
> OS: WinXP
> Submission from: (NULL) (129.98.60.134)
>
>
> This seems strange.  I have a small block of code that repeatedly calls rbinom.
> I put a break in there in case it returns NaN, as I've been having problems with
> this.  Here is a transcript from the debug session:
>
> Browse[1]> theP
> [1] 1
> Browse[1]> yleft[dataIndex]
> [1] 3
> Browse[1]> rbinom(1,3,1)
> [1] 3
> Browse[1]> rbinom(1,yleft[dataIndex], theP)
> [1] NaN
>
> Strange, huh?
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From p.dalgaard at biostat.ku.dk  Tue Aug 16 21:53:26 2005
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: 16 Aug 2005 21:53:26 +0200
Subject: [Rd] quirky behavior from rbinom (PR#8071)
In-Reply-To: <20050816191151.1F50B18B97@slim.kubism.ku.dk>
References: <20050816191151.1F50B18B97@slim.kubism.ku.dk>
Message-ID: <x2oe7xr749.fsf@turmalin.kubism.ku.dk>

cpaulse at aecom.yu.edu writes:

> Full_Name: Chris Paulse
> Version: 2.1.1
> OS: WinXP
> Submission from: (NULL) (129.98.60.134)
> 
> 
> This seems strange.  I have a small block of code that repeatedly calls rbinom. 
> I put a break in there in case it returns NaN, as I've been having problems with
> this.  Here is a transcript from the debug session:
> 
> Browse[1]> theP
> [1] 1
> Browse[1]> yleft[dataIndex]
> [1] 3
> Browse[1]> rbinom(1,3,1)
> [1] 3
> Browse[1]> rbinom(1,yleft[dataIndex], theP)
> [1] NaN
> 
> Strange, huh?

What is "theP - 1"?

> rbinom(1,3,1+1e-10)
[1] NaN
> 1+1e-10
[1] 1



-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From apjaworski at mmm.com  Tue Aug 16 22:21:32 2005
From: apjaworski at mmm.com (apjaworski@mmm.com)
Date: Tue, 16 Aug 2005 15:21:32 -0500
Subject: [Rd] small typo in "An Introduction to R"
Message-ID: <OF9EB4A26C.5F5678BE-ON8625705F.006E9570-8625705F.006FD5FB@mmm.com>

Hi,

I am not sure if this is the right place to report a small typo in one of
the manuals.  It is not really a bug, is it?.

In any case, at the end of section 11.6.2 (the glm() function) in the
Quasi-likelihhod models subsection there is an example of using the glm
procedure to fit a particular nonlinear model, which involves model
reparametrization.  The typo is in the definition of the second variable.
It should be x_2 = -1/z_1 and not x_2 = -1/x_1.  This appears in two places
in the R-intro.texi file in both the R-patched and the R-devel.
Fortunately the file diffs are the same for both versions:

5034c5034
< x_1 = z_2/z_1, x_2 = -1/z_1, beta_1 = 1/theta_1, and beta_2 =
---
> x_1 = z_2/z_1, x_2 = -1/x_1, beta_1 = 1/theta_1, and beta_2 =
5038c5038
< $x_1 = z_2/z_1$, $x_2=-1/z_1$, $\beta_1=1/\theta_1$ and
---
> $x_1 = z_2/z_1$, $x_2=-1/x_1$, $\beta_1=1/\theta_1$ and

Hope this helps,

Andy

__________________________________
Andy Jaworski
518-1-01
Process Laboratory
3M Corporate Research Laboratory
-----
E-mail: apjaworski at mmm.com
Tel:  (651) 733-6092
Fax:  (651) 736-3122


From pmosquin at hotmail.com  Wed Aug 17 00:12:30 2005
From: pmosquin at hotmail.com (pmosquin@hotmail.com)
Date: Wed, 17 Aug 2005 00:12:30 +0200 (CEST)
Subject: [Rd] bug? (PR#8074)
Message-ID: <20050816221230.4027D18B97@slim.kubism.ku.dk>

Full_Name: Paul Mosquin
Version: 2.1.1
OS: Windows XP
Submission from: (NULL) (24.225.66.48)


I just don't understand this:

>(2*2)==4
[1] TRUE
> .2*.2
[1] 0.04
> (.2*.2)==.04
[1] FALSE

or

> x=.04
> x
[1] 0.04
> y=.2*.2
> y
[1] 0.04
> y==x
[1] FALSE


From ch-r-devel at bobobeach.com  Wed Aug 17 00:54:18 2005
From: ch-r-devel at bobobeach.com (Cyrus Harmon)
Date: Tue, 16 Aug 2005 15:54:18 -0700
Subject: [Rd] MacOS specific framework install problem
Message-ID: <07B09C6F-921F-42EF-86A1-7A790AEE750F@bobobeach.com>

Dear r-devel,

Using the latest R-devel from SVN, when doing a make install, even  
from a build directory, there is a recursive copy that attempts to  
copy the .svn file to the framework include directory. The problem is  
due to the fact that there is a reference to $srcdir in Makefile.in  
that should probably be $top_builddir. The following patch (also  
attached) fixes this:

Index: Makefile.in
===================================================================
--- Makefile.in (revision 35301)
+++ Makefile.in (working copy)
@@ -234,7 +234,7 @@
           ln -f -s -n Versions/Current/Resources Resources)
         @(cd "$(R_FRAMEWORK_DIR)/Resources/lib" && \
           install_name_tool -id "$(R_FRAMEWORK_DIR)/Versions/$ 
(VERSION)/Resources/lib/libR.dylib" ../lib/libR.dylib)
-       @(cp -R $(srcdir)/src/include $(R_FRAMEWORK_DIR)/Versions/ 
Current/PrivateHeaders)
+       @(cp -R $(top_builddir)/src/include $(R_FRAMEWORK_DIR)/ 
Versions/Current/PrivateHeaders)
         @(install_name_tool -change libR.dylib "$(R_FRAMEWORK_DIR)/ 
Versions/$(VERSION)/Resources/lib/libR.dylib" \
           $(R_FRAMEWORK_DIR)/Resources/bin/exec/R)
         @(find "$(R_FRAMEWORK_DIR)/Resources/" -name '*.so' -exec  
install_name_tool \


I would be pleased if someone who understands the build system better  
than idea would review this and check it in if it's the right thing  
to do.

Thanks,

Cyrus


-------------- next part --------------


From tlumley at u.washington.edu  Wed Aug 17 01:06:48 2005
From: tlumley at u.washington.edu (Thomas Lumley)
Date: Tue, 16 Aug 2005 16:06:48 -0700 (PDT)
Subject: [Rd] bug? (PR#8074)
In-Reply-To: <20050816221230.4027D18B97@slim.kubism.ku.dk>
References: <20050816221230.4027D18B97@slim.kubism.ku.dk>
Message-ID: <Pine.A41.4.61b.0508161605490.213406@homer08.u.washington.edu>

On Wed, 17 Aug 2005 pmosquin at hotmail.com wrote:
> I just don't understand this:
>
>> (2*2)==4
> [1] TRUE
>> .2*.2
> [1] 0.04
>> (.2*.2)==.04
> [1] FALSE

It's a FAQ, not a bug. Consider:

> (.2*.2) - .04
[1] 6.938894e-18

and read the FAQ

 	-thomas


> or
>
>> x=.04
>> x
> [1] 0.04
>> y=.2*.2
>> y
> [1] 0.04
>> y==x
> [1] FALSE
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

Thomas Lumley			Assoc. Professor, Biostatistics
tlumley at u.washington.edu	University of Washington, Seattle


From pmosquin at hotmail.com  Wed Aug 17 03:33:13 2005
From: pmosquin at hotmail.com (Paul Mosquin)
Date: Tue, 16 Aug 2005 21:33:13 -0400
Subject: [Rd] bug? (PR#8074)
In-Reply-To: <Pine.A41.4.61b.0508161605490.213406@homer08.u.washington.edu>
Message-ID: <BAY105-F4177524FBD782B41AA91BDCDB30@phx.gbl>

Thomas,

Thank you for your response.  I checked the FAQ and it provides an example 
using sqrt(2) where you'd expect numerical precision to be an issue.

I guess that I expect R to act pretty much as C or C++ would do if I were to 
program the same code.  It's a bit of a surprise that assignment of 
rationals, well within precision, followed by multiplication leading to a 
result well within precision picks up those extra bits along the way.  
Something to watch out for, to be sure.

Thanks again for your help

Paul


>From: Thomas Lumley <tlumley at u.washington.edu>
>To: pmosquin at hotmail.com
>CC: r-devel at stat.math.ethz.ch, R-bugs at biostat.ku.dk
>Subject: Re: [Rd] bug? (PR#8074)
>Date: Tue, 16 Aug 2005 16:06:48 -0700 (PDT)
>
>On Wed, 17 Aug 2005 pmosquin at hotmail.com wrote:
>>I just don't understand this:
>>
>>>(2*2)==4
>>[1] TRUE
>>>.2*.2
>>[1] 0.04
>>>(.2*.2)==.04
>>[1] FALSE
>
>It's a FAQ, not a bug. Consider:
>
>>(.2*.2) - .04
>[1] 6.938894e-18
>
>and read the FAQ
>
>	-thomas
>
>
>>or
>>
>>>x=.04
>>>x
>>[1] 0.04
>>>y=.2*.2
>>>y
>>[1] 0.04
>>>y==x
>>[1] FALSE
>>
>>______________________________________________
>>R-devel at r-project.org mailing list
>>https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
>Thomas Lumley			Assoc. Professor, Biostatistics
>tlumley at u.washington.edu	University of Washington, Seattle


From berwin at maths.uwa.edu.au  Wed Aug 17 04:59:18 2005
From: berwin at maths.uwa.edu.au (berwin@maths.uwa.edu.au)
Date: Wed, 17 Aug 2005 04:59:18 +0200 (CEST)
Subject: [Rd] bug? (PR#8074)
Message-ID: <20050817025918.0F70418B8B@slim.kubism.ku.dk>

G'day Paul,

>>>>> "PM" == Paul Mosquin <pmosquin at hotmail.com> writes:

    PM> Thomas, Thank you for your response.  I checked the FAQ and it
    PM> provides an example using sqrt(2) where you'd expect numerical
    PM> precision to be an issue.
You should expect numerical precision issues in all calculations
involving "real" numbers in finite precision arithmetic.  Perhaps the
FAQ should include a link to, say:
        http://docs.sun.com/source/806-3568/ncg_goldberg.html

(A copy of Goldberg's "What Every Computer Scientist Should Know About
Floating-Point Arithmetic".)

    PM> I guess that I expect R to act pretty much as C or C++ would
    PM> do if I were to program the same code.
Well, did you?  I am pretty sure that you would have the same results
in C or C++, at least I do (see below).  But please, don't go and fill
another bug report for your C or C++ compiler when you see that it
behaves the same way as R. :-)

[bossiaea:test]$ cat test1.c
#include<stdlib.h>
#include<stdio.h>

int
main()
{
  double x = 0.2;

  if( x*x == 0.04)
    printf("The numbers are equal\n");
  else
    printf("The numbers are *NOT* equal\n");

  return EXIT_SUCCESS;
}
[bossiaea:test]$ gcc -o test1 test1.c
[bossiaea:test]$ ./test1
The numbers are *NOT* equal

    PM> It's a bit of a surprise that assignment of rationals, well
    PM> within precision, followed by multiplication leading to a
    PM> result well within precision picks up those extra bits along
    PM> the way.  Something to watch out for, to be sure.
No surprise at all for anybody who learned about how numbers are
represented in a computer and how finite precision arithmetic works.
Big hint, 0.2 is not exactly representable in a binary basis (and
there have been function posted to the R mailing lists that show you
the binary representation of real numbers on your machine).  

Read the link above or a book on numerical analysis, e.g. Chapter 1 in 

@Book{gentle:98:na,
  author =       {Gentle, J. E.},
  title =        {Numerical Linear Algebra with Applications in Statistics},
  publisher =    {Springer-Verlag},
  year =         1998,
  series =       {Statistics and Computing},
  address =      {New York}
}

Cheers,

        Berwin

========================== Full address ============================
Berwin A Turlach                      Tel.: +61 (8) 6488 3338 (secr)   
School of Mathematics and Statistics        +61 (8) 6488 3383 (self)      
The University of Western Australia   FAX : +61 (8) 6488 1028
35 Stirling Highway                   
Crawley WA 6009                e-mail: berwin at maths.uwa.edu.au
Australia                        http://www.maths.uwa.edu.au/~berwin


From tlumley at u.washington.edu  Wed Aug 17 06:01:33 2005
From: tlumley at u.washington.edu (Thomas Lumley)
Date: Tue, 16 Aug 2005 21:01:33 -0700 (PDT)
Subject: [Rd] bug? (PR#8074)
In-Reply-To: <BAY105-F4177524FBD782B41AA91BDCDB30@phx.gbl>
References: <BAY105-F4177524FBD782B41AA91BDCDB30@phx.gbl>
Message-ID: <Pine.A41.4.61b.0508162049490.313852@homer05.u.washington.edu>

On Tue, 16 Aug 2005, Paul Mosquin wrote:
> I guess that I expect R to act pretty much as C or C++ would do if I were to 
> program the same code.  It's a bit of a surprise that assignment of 
> rationals, well within precision, followed by multiplication leading to a 
> result well within precision picks up those extra bits along the way. 
> Something to watch out for, to be sure.

But those rationals are *not* well within precision. 0.2 is a infinite 
repeating binary fraction (in base 16 it is 0.333....) so it is not stored 
precisely. 0.04 is also not stored precisely, and it so happens that the 
error in representing 0.04 is not the same as the error in representing 
0.02*0.02.

Of course this will still happen in C: R is written in C.
For example, on my computer the following C program
-----------------------
#include <stdio.h>

int main(){
   double d=0.2;
   double dd;

   dd=d*d;
   if(dd==d)
      printf("Equal\n");
   else
      printf("Difference=%20.18f\n",0.04-dd);
}
----------------------
prints
[al:~] thomas% ./a.out
Difference=-0.000000000000000007

which happens to agree with the result R gives, though this isn't 
guaranteed.  You simply cannot rely on floating point equality unless you 
know how the last bit rounding errors are handled.

 	-thomas


From natty at hornfans.com  Wed Aug 17 01:19:00 2005
From: natty at hornfans.com (ignacio gerundo)
Date: Tue, 16 Aug 2005 22:19:00 -0100
Subject: [Rd] adelaide
Message-ID: <36B28948.A3FFE23@hornfans.com>

shanel

http://uk.geocities.com/Clemente_Addison/?EM8=This_is_a.good_chance.for.you
_t


From mmmm at st.jyu.fi  Wed Aug 17 08:48:32 2005
From: mmmm at st.jyu.fi (Markku Mielityinen)
Date: Wed, 17 Aug 2005 09:48:32 +0300
Subject: [Rd] About R variable references
Message-ID: <000001c5a2f7$b2407e00$e101a8c0@MARKKUNOTEBOOK>

Hello Group,

I could use an advice on how SEXP handles work. My aim is to implement a
system where I initially set a few global variables that are used for
communication between C and R code. Then I do some work with R code and
periodically call a function of my own that will update the system
state. Such a design is useful for many purposes (for GUIs to name one).
I am not entirely sure that R can handle such a design but at the moment
I cannot see any reasons why it could not. The problem I have is that
the initially set global variables are not stable. Everything works for
a while but eventually the system gets confused. It seems that the SEXP
references to the state variables and to the callback functions may get
altered and become pointing to some other variables. This will then
rightfully give me the error messages like "attempt to apply
non-function". My (maybe uneducated) guess is that this might have
something to do with R memory management. The variables are connected to
the namespace so a do not think they are removed. Maybe they are moved
is such a way that my SEXP references are not able to follow. As you can
see I am on thin ice here so please feel welcome to step in...

My librtary contains ~20k lines of C code so I would not consider a bug
here out of the question. I have tried to look for one but until now
without success.

My question is: can you see a design flaw here or is everything done
according to R requirements and hence it is likely that there is a bug
in my own code?

One dirty correction I can see but have not tried is to use object names
and findVar but this would make it less flexible (at least IMHO).

I have quickly browsed the forums and the documentation I was able to
find but found no answers.

My system is FC3 with R version >= 2.

There are two snippets of code that hopefully make clear what I am
trying to achieve. The code is provided for illustration purposes only
and I did not try to compile it.

Best regards,
        Markku Mielityinen


#  C CODE
#####################################################################

SEXP myrho = R_GlobalEnv;
SEXP myvariable = R_NilValue;
SEXP myfunction = R_NilValue;

SEXP myinit(SEXP var, SEXP func) {
	myvariable = var;
	myfunction = func;
	return R_NilValue;
}

SEXP myexec(/* probably has some parameters that are omitted in this
example */) {
	int state;
	SEXP thecall;
	
	/* do some work, then set the state and call a callback function
if necessary */
	
	PROTECT(myvariable);
	INTEGER(myvariable)[0] = state;
	UNPROTECT(1);
	if(state) {
		PROTECT(thecall = LCONS(myfunction, LCONS(myvariable,
R_NilValue)));
		eval(thecall, myrho);
		UNPROTECT(1);
	}

	return R_NilValue;
}

########################################################################
########

#  R CODE
#####################################################################

myinit<-function(var,func) .Call("myinit",var,func)
myexec<-function() .Call("myexec")

state<-as.integer(1)
callback<-function(state) { cat(sprintf("You got state %s\n",state)) }

myinit()
# do some work here and call myexec() periodically...

########################################################################
########


From ripley at stats.ox.ac.uk  Wed Aug 17 09:50:53 2005
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 17 Aug 2005 08:50:53 +0100 (BST)
Subject: [Rd] About R variable references
In-Reply-To: <000001c5a2f7$b2407e00$e101a8c0@MARKKUNOTEBOOK>
References: <000001c5a2f7$b2407e00$e101a8c0@MARKKUNOTEBOOK>
Message-ID: <Pine.LNX.4.61.0508170831060.16535@gannet.stats>

R never moves objects in memory, but it may garbage collect them.

What is not clear to me is that you can guarantee that the objects you 
pass in are not copies subject to garbage collection, but then I don't 
know how you are calling your functions.  A way to make sure that your 
pointers remain valid is to PROTECT them etc on assignment.

Using gctorture(TRUE) will probably ensure things break very quickly if 
gc-ing is the problem.

On Wed, 17 Aug 2005, Markku Mielityinen wrote:

> Hello Group,
>
> I could use an advice on how SEXP handles work. My aim is to implement a
> system where I initially set a few global variables that are used for
> communication between C and R code. Then I do some work with R code and
> periodically call a function of my own that will update the system
> state. Such a design is useful for many purposes (for GUIs to name one).
> I am not entirely sure that R can handle such a design but at the moment
> I cannot see any reasons why it could not. The problem I have is that
> the initially set global variables are not stable. Everything works for
> a while but eventually the system gets confused. It seems that the SEXP
> references to the state variables and to the callback functions may get
> altered and become pointing to some other variables. This will then
> rightfully give me the error messages like "attempt to apply
> non-function". My (maybe uneducated) guess is that this might have
> something to do with R memory management. The variables are connected to
> the namespace so a do not think they are removed. Maybe they are moved
> is such a way that my SEXP references are not able to follow. As you can
> see I am on thin ice here so please feel welcome to step in...
>
> My librtary contains ~20k lines of C code so I would not consider a bug
> here out of the question. I have tried to look for one but until now
> without success.
>
> My question is: can you see a design flaw here or is everything done
> according to R requirements and hence it is likely that there is a bug
> in my own code?
>
> One dirty correction I can see but have not tried is to use object names
> and findVar but this would make it less flexible (at least IMHO).
>
> I have quickly browsed the forums and the documentation I was able to
> find but found no answers.
>
> My system is FC3 with R version >= 2.
>
> There are two snippets of code that hopefully make clear what I am
> trying to achieve. The code is provided for illustration purposes only
> and I did not try to compile it.
>
> Best regards,
>        Markku Mielityinen
>
>
> #  C CODE
> #####################################################################
>
> SEXP myrho = R_GlobalEnv;
> SEXP myvariable = R_NilValue;
> SEXP myfunction = R_NilValue;
>
> SEXP myinit(SEXP var, SEXP func) {
> 	myvariable = var;
> 	myfunction = func;
> 	return R_NilValue;
> }
>
> SEXP myexec(/* probably has some parameters that are omitted in this
> example */) {
> 	int state;
> 	SEXP thecall;
>
> 	/* do some work, then set the state and call a callback function
> if necessary */
>
> 	PROTECT(myvariable);
> 	INTEGER(myvariable)[0] = state;
> 	UNPROTECT(1);
> 	if(state) {
> 		PROTECT(thecall = LCONS(myfunction, LCONS(myvariable,
> R_NilValue)));
> 		eval(thecall, myrho);
> 		UNPROTECT(1);
> 	}
>
> 	return R_NilValue;
> }
>
> ########################################################################
> ########
>
> #  R CODE
> #####################################################################
>
> myinit<-function(var,func) .Call("myinit",var,func)
> myexec<-function() .Call("myexec")
>
> state<-as.integer(1)
> callback<-function(state) { cat(sprintf("You got state %s\n",state)) }
>
> myinit()
> # do some work here and call myexec() periodically...
>
> ########################################################################
> ########
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From arlettaifill at performingartsfan.com  Wed Aug 17 03:10:53 2005
From: arlettaifill at performingartsfan.com (ralph covington)
Date: Wed, 17 Aug 2005 02:10:53 +0100
Subject: [Rd] marcia
Message-ID: <B4EAE265.C9DB056@performingartsfan.com>

shirely

http://uk.geocities.com/Roosevelt_Ramiro/?Xk=It_is_an_easy_and_legitimate_w
ay_to_decrease_your_expenses_on_curative_mediciines.


From ch-r-devel at bobobeach.com  Wed Aug 17 18:13:05 2005
From: ch-r-devel at bobobeach.com (Cyrus Harmon)
Date: Wed, 17 Aug 2005 09:13:05 -0700
Subject: [Rd] PATCH to Makefile.in w/ Makeconf LIBR variable update to allow
	builds within R to find Framework
Message-ID: <0A03695D-156F-4E36-801D-634A8E9B972E@bobobeach.com>

Dear r-devel,

When R has been installed in a non-standard location (or any location  
where Apple's version of gcc isn't going to, by default, look for  
frameworks specified with the -framework arg), builds of R packages  
fail because the linker can't find the framework. The following patch  
to Makefile.in enables Makefile to patch Makeconf appropriately to  
drop in the -F argument to the appropriate place.

Thanks for considering this,

Cyrus

Index: Makefile.in
===================================================================
--- Makefile.in (revision 35301)
+++ Makefile.in (working copy)
@@ -84,7 +84,7 @@
           $(INSTALL_DATA) $${f} "$(rhome)"; \
         done
@WANT_R_FRAMEWORK_TRUE@                $(MAKE) install-R-framework
- at WANT_R_FRAMEWORK_TRUE@                @(sed 's/^LIBR =.*/LIBR = - 
framework R/' \
+ at WANT_R_FRAMEWORK_TRUE@                @(sed 's|^LIBR =.*|LIBR = -F$ 
(R_FRAMEWORK_DIR)/.. -framework R|' \
@WANT_R_FRAMEWORK_TRUE@                  $(top_builddir)/etc/Makeconf  
 > "$(rhome)/etc/Makeconf")
@WANT_R_FRAMEWORK_TRUE@                @(sed 's/Versions\/$(VERSION)\/ 
Resources/Resources/' \
@WANT_R_FRAMEWORK_TRUE@                  $(R_FRAMEWORK_DIR)/Resources/ 
bin/R > \


From maechler at stat.math.ethz.ch  Wed Aug 17 20:24:12 2005
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Wed, 17 Aug 2005 20:24:12 +0200
Subject: [Rd] problem using model.frame()
In-Reply-To: <1124214263.8689.108.camel@gsimpson.geog.ucl.ac.uk>
References: <1124205318.8689.45.camel@gsimpson.geog.ucl.ac.uk>
	<971536df05081608254fe12843@mail.gmail.com>
	<1124206769.8689.65.camel@gsimpson.geog.ucl.ac.uk>
	<971536df050816093559c40389@mail.gmail.com>
	<1124214263.8689.108.camel@gsimpson.geog.ucl.ac.uk>
Message-ID: <17155.32972.298699.821499@stat.math.ethz.ch>

>>>>> "GS" == Gavin Simpson <gavin.simpson at ucl.ac.uk>
>>>>>     on Tue, 16 Aug 2005 18:44:23 +0100 writes:

    GS> On Tue, 2005-08-16 at 12:35 -0400, Gabor Grothendieck
    GS> wrote:
    >> On 8/16/05, Gavin Simpson <gavin.simpson at ucl.ac.uk>
    >> wrote: > On Tue, 2005-08-16 at 11:25 -0400, Gabor
    >> Grothendieck wrote: > > It can handle data frames like
    >> this:
    >> > >
    >> > > model.frame(y1) > > or > > model.frame(~., y1)
    >> > 
    >> > Thanks Gabor,
    >> > 
    >> > Yes, I know that works, but I want the function
    >> coca.formula to accept a > formula like this y2 ~ y1,
    >> with both y1 and y2 being data frames. It is
    >> 
    >> The expressions I gave work generally (i.e. lm, glm,
    >> ...), not just in model.matrix, so would it be ok if the
    >> user just does this?
    >> 
    >> yourfunction(y2 ~., y1)

    GS> Thanks again Gabor for your comments,

    GS> I'd prefer the y1 ~ y2 as data frames - as this is the
    GS> most natural way of doing things. I'd like to have (y2
    GS> ~., y1) as well, and (y2 ~ spp1 + spp2 + spp3, y1) also
    GS> work - silently without any trouble.

I'm sorry, Gavin, I tend to disagree quite a bit.

The formula notation has quite a history in the S language, and
AFAIK never was the idea to use data.frames as formula
components, but rather as "environments" in which formula
components are looked up --- exactly as Gabor has explained.

To break with such a deeply rooted principle, 
you should have very very good reasons, because you're breaking
the concepts on which all other uses of formulae are based.
And this would potentially lead to much confusion of your users,
at least in the way they should learn to think about what
formulae mean.

Martin


    >> If it really is important to do it the way you describe,
    >> are the data frames necessarily numeric? If so you could
    >> preprocess your formula by placing as.matrix around all
    >> the variables representing data frames using something
    >> like this:
    >> 
    >> https://www.stat.math.ethz.ch/pipermail/r-help/2004-December/061485.html

    GS> Yes, they are numeric matrices (as data frames). I've
    GS> looked at this, but I'd prefer to not have to do too
    GS> much messing with the formula.

    >> Of course, if they are necessarily numeric maybe they can
    >> be matrices in the first place?

    GS> Because read.table etc. produce data.frames and this is
    GS> the natural way to work with data in R.

but it is also slightly inefficient if they are numeric.
There are places for data frames and for matrices.

Why should it be a problem to use 
    M <- as.matrix(read.table(..))
?

For large files, it could be quite a bit more efficient,
needing a bit more of code, to
use scan() to read the numeric data directly :

      h1 <- scan(..., n=1) ## <read variable names>
      nc <- length(h1)
      a <- matrix(scan(...., what = numeric(), ...),  
                  ncol = nc, dimnames = list(NULL, h1))

maybe this would be useful to be packaged into
a small utility with usage

      read.matrix(...,  type = numeric(), ...)      


    GS> Following your suggestions, I altered my code to
    GS> evaluate the rhs of the formula and check if it was of
    GS> class "data.frame". If it is then I stop processing and
    GS> return it as a data.frame as this point. If not, it
    GS> eventually gets passed on to model.frame() for it to
    GS> deal with it.

    GS> So far - limited testing - it seems to do what I wanted
    GS> all along. I'm sure there's a gotcha in there somewhere
    GS> but at least the code runs so I can check for problems
    GS> against my examples.

    GS> Right, back to writing documentation...

    GS> G

    >> > more intuitive, to my mind at least for this particular
    >> example and > analysis, to specify the formula with a
    >> data frame on the rhs.
    >> > 
    >> > model.frame doesn't work with the formula "~ y1" if the
    >> object y1, in > the environment when model.frame
    >> evaluates the formula, is a data.frame.  > It works if y1
    >> is a matrix, however. I'd like to work around this >
    >> problem, say by creating an environment in which y1 is
    >> modified to be a > matrix, if possible. Can this be done?
    >> > 
    >> > At the moment I have something working by grabbing the
    >> bits of the > formula and then using get() to grab the
    >> named object. Of course, this > won't work if someone
    >> wants to use R's formula interface with the > following
    >> formula y2 ~ var1 + var2 + var3, data = y1, or to use the
    >> > subset argument common to many formula
    >> implementations. I'd like to have > the function work in
    >> as general a manner as possible, so I'm fishing > around
    >> for potential solutions.
    >> > 
    >> > All the best,
    >> > 
    >> > Gav
    >> > 
    >> > >
    >> > > On 8/16/05, Gavin Simpson <gavin.simpson at ucl.ac.uk>
    >> wrote: > > > Hi I'm having a problem with model.frame,
    >> encapsulated in this example:
    >> > > >
    >> > > > y1 <-
    >> matrix(c(3,1,0,1,0,1,1,0,0,0,1,0,0,0,1,1,0,1,1,1), > > >
    >> nrow = 5, byrow = TRUE) > > > y1 <- as.data.frame(y1) > >
    >> > rownames(y1) <- paste("site", 1:5, sep = "") > > >
    >> colnames(y1) <- paste("spp", 1:4, sep = "") > > > y1
    >> > > >
    >> > > > model.frame(~ y1) > > > Error in
    >> model.frame(formula, rownames, variables, varnames,
    >> extras, extranames, : > > > invalid variable type
    >> > > >
    >> > > > temp <- as.matrix(y1) > > > model.frame(~ temp) > >
    >> > temp.spp1 temp.spp2 temp.spp3 temp.spp4 > > > 1 3 1 0 1
    >> > > > 2 0 1 1 0 > > > 3 0 0 1 0 > > > 4 0 0 1 1 > > > 5 0
    >> 1 1 1
    >> > > >
    >> > > > Ideally the above wouldn't have names like
    >> temp.var1, temp.var2, but one > > > could deal with that
    >> later.
    >> > > >
    >> > > > I have tracked down the source of the error message
    >> to line 1330 in > > > model.c - here I'm stumped as I
    >> don't know any C, but it looks as if the > > > code is
    >> looping over the variables in the formula and checking of
    >> they > > > are the right "type". So a matrix of variables
    >> gets through, but a > > > data.frame doesn't.
    >> > > >
    >> > > > It would be good if model.frame could cope with
    >> data.frames in formulae, > > > but seeing as I am
    >> incapable of providing a patch, is there a way around > >
    >> > this problem?
    >> > > >
    >> > > > Below is the head of the function I am currently
    >> using, including the > > > function for parsing the
    >> formula - borrowed and hacked from > > >
    >> ordiParseFormula() in package vegan.
    >> > > >
    >> > > > I can work out the class of the rhs of the
    >> forumla. Is there a way to > > > create a suitable
    >> environment for the data argument of parseFormula() > > >
    >> such that it contains the rhs dataframe coerced to a
    >> matrix, which then > > > should get through
    >> model.frame.default without error? How would I go > > >
    >> about manipulating/creating such an environment? Any
    >> other ideas?
    >> > > >
    >> > > > Thanks in advance
    >> > > >
    >> > > > Gav
    >> > > >
    >> > > > coca.formula <- function(formula, method =
    >> c("predictive", "symmetric"), > > > reg.method =
    >> c("simpls", "eigen"), weights = NULL, > > > n.axes =
    >> NULL, symmetric = FALSE, data) > > > { > > > parseFormula
    >> <- function (formula, data) > > > { > > > browser() > > >
    >> Terms <- terms(formula, "Condition", data = data) > > >
    >> flapart <- fla <- formula <- formula(Terms, width.cutoff
    >> = 500) > > > specdata <- formula[[2]] > > > X <-
    >> eval(specdata, data, parent.frame()) > > > X <-
    >> as.matrix(X) > > > formula[[2]] <- NULL > > > if
    >> (formula[[2]] == "1" || formula[[2]] == "0") > > > Y <-
    >> NULL > > > else { > > > mf <- model.frame(formula, data,
    >> na.action = na.fail) > > > Y <- model.matrix(formula, mf)
    >> > > > if (any(colnames(Y) == "(Intercept)")) { > > > xint
    >> <- which(colnames(Y) == "(Intercept)") > > > Y <- Y[,
    >> -xint, drop = FALSE] > > > } > > > } > > > list(X = X, Y
    >> = Y) > > > } > > > if (missing(data)) > > > data <-
    >> parent.frame() > > > #browser() > > > dat <-
    >> parseFormula(formula, data)
    >> > > >
    >> > > > --
    >> > > >
    >> %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
    >> > > > Gavin Simpson [T] +44 (0)20 7679 5522 > > > ENSIS
    >> Research Fellow [F] +44 (0)20 7679 7565 > > > ENSIS
    >> Ltd. & ECRC [E] gavin.simpsonATNOSPAMucl.ac.uk > > > UCL
    >> Department of Geography [W]
    >> http://www.ucl.ac.uk/~ucfagls/cv/ > > > 26 Bedford Way
    >> [W] http://www.ucl.ac.uk/~ucfagls/ > > > London.  WC1H
    >> 0AP.  > > >
    >> %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
    >> > > >
    >> > > > ______________________________________________ > >
    >> > R-devel at r-project.org mailing list > > >
    >> https://stat.ethz.ch/mailman/listinfo/r-devel
    >> > > >
    >> > --
    >> >
    >> %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
    >> > Gavin Simpson [T] +44 (0)20 7679 5522 > ENSIS Research
    >> Fellow [F] +44 (0)20 7679 7565 > ENSIS Ltd. & ECRC [E]
    >> gavin.simpsonATNOSPAMucl.ac.uk > UCL Department of
    >> Geography [W] http://www.ucl.ac.uk/~ucfagls/cv/ > 26
    >> Bedford Way [W] http://www.ucl.ac.uk/~ucfagls/ > London.
    >> WC1H 0AP.  >
    >> %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
    >> > 
    >> > 
    >> >
    GS> --
    GS> %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
    GS> Gavin Simpson [T] +44 (0)20 7679 5522 ENSIS Research
    GS> Fellow [F] +44 (0)20 7679 7565 ENSIS Ltd. & ECRC [E]
    GS> gavin.simpsonATNOSPAMucl.ac.uk UCL Department of
    GS> Geography [W] http://www.ucl.ac.uk/~ucfagls/cv/ 26
    GS> Bedford Way [W] http://www.ucl.ac.uk/~ucfagls/ London.
    GS> WC1H 0AP.
    GS> %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%

    GS> ______________________________________________
    GS> R-devel at r-project.org mailing list
    GS> https://stat.ethz.ch/mailman/listinfo/r-devel


From gavin.simpson at ucl.ac.uk  Thu Aug 18 00:49:26 2005
From: gavin.simpson at ucl.ac.uk (Gavin Simpson)
Date: Wed, 17 Aug 2005 23:49:26 +0100
Subject: [Rd] problem using model.frame()
In-Reply-To: <17155.32972.298699.821499@stat.math.ethz.ch>
References: <1124205318.8689.45.camel@gsimpson.geog.ucl.ac.uk>
	<971536df05081608254fe12843@mail.gmail.com>
	<1124206769.8689.65.camel@gsimpson.geog.ucl.ac.uk>
	<971536df050816093559c40389@mail.gmail.com>
	<1124214263.8689.108.camel@gsimpson.geog.ucl.ac.uk>
	<17155.32972.298699.821499@stat.math.ethz.ch>
Message-ID: <1124318966.2718.38.camel@dsl-217-155-166-107.zen.co.uk>

On Wed, 2005-08-17 at 20:24 +0200, Martin Maechler wrote:
> >>>>> "GS" == Gavin Simpson <gavin.simpson at ucl.ac.uk>
> >>>>>     on Tue, 16 Aug 2005 18:44:23 +0100 writes:
> 
>     GS> On Tue, 2005-08-16 at 12:35 -0400, Gabor Grothendieck
>     GS> wrote:
>     >> On 8/16/05, Gavin Simpson <gavin.simpson at ucl.ac.uk>
>     >> wrote: > On Tue, 2005-08-16 at 11:25 -0400, Gabor
>     >> Grothendieck wrote: > > It can handle data frames like
>     >> this:
>     >> > >
>     >> > > model.frame(y1) > > or > > model.frame(~., y1)
>     >> > 
>     >> > Thanks Gabor,
>     >> > 
>     >> > Yes, I know that works, but I want the function
>     >> coca.formula to accept a > formula like this y2 ~ y1,
>     >> with both y1 and y2 being data frames. It is
>     >> 
>     >> The expressions I gave work generally (i.e. lm, glm,
>     >> ...), not just in model.matrix, so would it be ok if the
>     >> user just does this?
>     >> 
>     >> yourfunction(y2 ~., y1)
> 
>     GS> Thanks again Gabor for your comments,
> 
>     GS> I'd prefer the y1 ~ y2 as data frames - as this is the
>     GS> most natural way of doing things. I'd like to have (y2
>     GS> ~., y1) as well, and (y2 ~ spp1 + spp2 + spp3, y1) also
>     GS> work - silently without any trouble.
> 
> I'm sorry, Gavin, I tend to disagree quite a bit.
> 
> The formula notation has quite a history in the S language, and
> AFAIK never was the idea to use data.frames as formula
> components, but rather as "environments" in which formula
> components are looked up --- exactly as Gabor has explained.

Hi Martin, thanks for your comments,

But then one could have a matrix of variables on the rhs of the formula
and it would work - whether this is a documented feature or un-intended
side-effect of matrices being stored as vectors with dims, I don't know.

And whilst the formula may have a long history, a number of packages
have extended the interface to implement a specific feature, which don't
work with standard functions like lm, glm and friends. I don't see how
what I wanted to achieve is greatly different to that or using a matrix.

> To break with such a deeply rooted principle, 
> you should have very very good reasons, because you're breaking
> the concepts on which all other uses of formulae are based.
> And this would potentially lead to much confusion of your users,
> at least in the way they should learn to think about what
> formulae mean.

In the end I managed to treat y1 ~ y2 (both data frames) as a special
case, which allows the existing formula notation to work as well, so I
can use y1 ~ y2, y1 ~ ., data = y2, or y1 ~ var + var2, data = y2. This
is what I wanted all along, to extend my interface (not do anything to
R's formulae), but to also work in the traditional sense.

The model I am writing code for really is modelling the relationship
between two matrices of data. In one version of the method, there is
real equivalence between both sides of the formula so it would seem odd
to treat the two sides of the formula differently. At least to me ;-)

> Martin
> 
> 
>     >> If it really is important to do it the way you describe,
>     >> are the data frames necessarily numeric? If so you could
>     >> preprocess your formula by placing as.matrix around all
>     >> the variables representing data frames using something
>     >> like this:
>     >> 
>     >> https://www.stat.math.ethz.ch/pipermail/r-help/2004-December/061485.html
> 
>     GS> Yes, they are numeric matrices (as data frames). I've
>     GS> looked at this, but I'd prefer to not have to do too
>     GS> much messing with the formula.
> 
>     >> Of course, if they are necessarily numeric maybe they can
>     >> be matrices in the first place?
> 
>     GS> Because read.table etc. produce data.frames and this is
>     GS> the natural way to work with data in R.
> 
> but it is also slightly inefficient if they are numeric.
> There are places for data frames and for matrices.

I agree - and in the code I've written, y1 and y2 quickly get coerced to
matrices before the real number crunching begins.

However, all the other R modelling functions I have used work with
data.frames. Arguably, it could cause more confusion to write a function
that looked, walked and quacked like an R modelling function but needed
the user to apply an extra step to use - a step not usually required
under normal R usage.

All the best,

Gav

> Why should it be a problem to use 
>     M <- as.matrix(read.table(..))
> ?
> 
> For large files, it could be quite a bit more efficient,
> needing a bit more of code, to
> use scan() to read the numeric data directly :
> 
>       h1 <- scan(..., n=1) ## <read variable names>
>       nc <- length(h1)
>       a <- matrix(scan(...., what = numeric(), ...),  
>                   ncol = nc, dimnames = list(NULL, h1))
> 
> maybe this would be useful to be packaged into
> a small utility with usage
> 
>       read.matrix(...,  type = numeric(), ...)      
> 
> 
>     GS> Following your suggestions, I altered my code to
>     GS> evaluate the rhs of the formula and check if it was of
>     GS> class "data.frame". If it is then I stop processing and
>     GS> return it as a data.frame as this point. If not, it
>     GS> eventually gets passed on to model.frame() for it to
>     GS> deal with it.
> 
>     GS> So far - limited testing - it seems to do what I wanted
>     GS> all along. I'm sure there's a gotcha in there somewhere
>     GS> but at least the code runs so I can check for problems
>     GS> against my examples.
> 
>     GS> Right, back to writing documentation...
> 
>     GS> G
> 
>     >> > more intuitive, to my mind at least for this particular
>     >> example and > analysis, to specify the formula with a
>     >> data frame on the rhs.
>     >> > 
>     >> > model.frame doesn't work with the formula "~ y1" if the
>     >> object y1, in > the environment when model.frame
>     >> evaluates the formula, is a data.frame.  > It works if y1
>     >> is a matrix, however. I'd like to work around this >
>     >> problem, say by creating an environment in which y1 is
>     >> modified to be a > matrix, if possible. Can this be done?
>     >> > 
>     >> > At the moment I have something working by grabbing the
>     >> bits of the > formula and then using get() to grab the
>     >> named object. Of course, this > won't work if someone
>     >> wants to use R's formula interface with the > following
>     >> formula y2 ~ var1 + var2 + var3, data = y1, or to use the
>     >> > subset argument common to many formula
>     >> implementations. I'd like to have > the function work in
>     >> as general a manner as possible, so I'm fishing > around
>     >> for potential solutions.
>     >> > 
>     >> > All the best,
>     >> > 
>     >> > Gav
>     >> > 
>     >> > >
>     >> > > On 8/16/05, Gavin Simpson <gavin.simpson at ucl.ac.uk>
>     >> wrote: > > > Hi I'm having a problem with model.frame,
>     >> encapsulated in this example:
>     >> > > >
>     >> > > > y1 <-
>     >> matrix(c(3,1,0,1,0,1,1,0,0,0,1,0,0,0,1,1,0,1,1,1), > > >
>     >> nrow = 5, byrow = TRUE) > > > y1 <- as.data.frame(y1) > >
>     >> > rownames(y1) <- paste("site", 1:5, sep = "") > > >
>     >> colnames(y1) <- paste("spp", 1:4, sep = "") > > > y1
>     >> > > >
>     >> > > > model.frame(~ y1) > > > Error in
>     >> model.frame(formula, rownames, variables, varnames,
>     >> extras, extranames, : > > > invalid variable type
>     >> > > >
>     >> > > > temp <- as.matrix(y1) > > > model.frame(~ temp) > >
>     >> > temp.spp1 temp.spp2 temp.spp3 temp.spp4 > > > 1 3 1 0 1
>     >> > > > 2 0 1 1 0 > > > 3 0 0 1 0 > > > 4 0 0 1 1 > > > 5 0
>     >> 1 1 1
>     >> > > >
>     >> > > > Ideally the above wouldn't have names like
>     >> temp.var1, temp.var2, but one > > > could deal with that
>     >> later.
>     >> > > >
>     >> > > > I have tracked down the source of the error message
>     >> to line 1330 in > > > model.c - here I'm stumped as I
>     >> don't know any C, but it looks as if the > > > code is
>     >> looping over the variables in the formula and checking of
>     >> they > > > are the right "type". So a matrix of variables
>     >> gets through, but a > > > data.frame doesn't.
>     >> > > >
>     >> > > > It would be good if model.frame could cope with
>     >> data.frames in formulae, > > > but seeing as I am
>     >> incapable of providing a patch, is there a way around > >
>     >> > this problem?
>     >> > > >
>     >> > > > Below is the head of the function I am currently
>     >> using, including the > > > function for parsing the
>     >> formula - borrowed and hacked from > > >
>     >> ordiParseFormula() in package vegan.
>     >> > > >
>     >> > > > I can work out the class of the rhs of the
>     >> forumla. Is there a way to > > > create a suitable
>     >> environment for the data argument of parseFormula() > > >
>     >> such that it contains the rhs dataframe coerced to a
>     >> matrix, which then > > > should get through
>     >> model.frame.default without error? How would I go > > >
>     >> about manipulating/creating such an environment? Any
>     >> other ideas?
>     >> > > >
>     >> > > > Thanks in advance
>     >> > > >
>     >> > > > Gav
>     >> > > >
>     >> > > > coca.formula <- function(formula, method =
>     >> c("predictive", "symmetric"), > > > reg.method =
>     >> c("simpls", "eigen"), weights = NULL, > > > n.axes =
>     >> NULL, symmetric = FALSE, data) > > > { > > > parseFormula
>     >> <- function (formula, data) > > > { > > > browser() > > >
>     >> Terms <- terms(formula, "Condition", data = data) > > >
>     >> flapart <- fla <- formula <- formula(Terms, width.cutoff
>     >> = 500) > > > specdata <- formula[[2]] > > > X <-
>     >> eval(specdata, data, parent.frame()) > > > X <-
>     >> as.matrix(X) > > > formula[[2]] <- NULL > > > if
>     >> (formula[[2]] == "1" || formula[[2]] == "0") > > > Y <-
>     >> NULL > > > else { > > > mf <- model.frame(formula, data,
>     >> na.action = na.fail) > > > Y <- model.matrix(formula, mf)
>     >> > > > if (any(colnames(Y) == "(Intercept)")) { > > > xint
>     >> <- which(colnames(Y) == "(Intercept)") > > > Y <- Y[,
>     >> -xint, drop = FALSE] > > > } > > > } > > > list(X = X, Y
>     >> = Y) > > > } > > > if (missing(data)) > > > data <-
>     >> parent.frame() > > > #browser() > > > dat <-
>     >> parseFormula(formula, data)
>     >> > > >
>     >> > > > --
>     >> > > >
>     >> %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
>     >> > > > Gavin Simpson [T] +44 (0)20 7679 5522 > > > ENSIS
>     >> Research Fellow [F] +44 (0)20 7679 7565 > > > ENSIS
>     >> Ltd. & ECRC [E] gavin.simpsonATNOSPAMucl.ac.uk > > > UCL
>     >> Department of Geography [W]
>     >> http://www.ucl.ac.uk/~ucfagls/cv/ > > > 26 Bedford Way
>     >> [W] http://www.ucl.ac.uk/~ucfagls/ > > > London.  WC1H
>     >> 0AP.  > > >
>     >> %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
>     >> > > >
>     >> > > > ______________________________________________ > >
>     >> > R-devel at r-project.org mailing list > > >
>     >> https://stat.ethz.ch/mailman/listinfo/r-devel
>     >> > > >
>     >> > --
>     >> >
>     >> %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
>     >> > Gavin Simpson [T] +44 (0)20 7679 5522 > ENSIS Research
>     >> Fellow [F] +44 (0)20 7679 7565 > ENSIS Ltd. & ECRC [E]
>     >> gavin.simpsonATNOSPAMucl.ac.uk > UCL Department of
>     >> Geography [W] http://www.ucl.ac.uk/~ucfagls/cv/ > 26
>     >> Bedford Way [W] http://www.ucl.ac.uk/~ucfagls/ > London.
>     >> WC1H 0AP.  >
>     >> %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
>     >> > 
>     >> > 
>     >> >
>     GS> --
>     GS> %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
>     GS> Gavin Simpson [T] +44 (0)20 7679 5522 ENSIS Research
>     GS> Fellow [F] +44 (0)20 7679 7565 ENSIS Ltd. & ECRC [E]
>     GS> gavin.simpsonATNOSPAMucl.ac.uk UCL Department of
>     GS> Geography [W] http://www.ucl.ac.uk/~ucfagls/cv/ 26
>     GS> Bedford Way [W] http://www.ucl.ac.uk/~ucfagls/ London.
>     GS> WC1H 0AP.
>     GS> %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
> 
>     GS> ______________________________________________
>     GS> R-devel at r-project.org mailing list
>     GS> https://stat.ethz.ch/mailman/listinfo/r-devel
-- 
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
Gavin Simpson                     [T] +44 (0)20 7679 5522
ENSIS Research Fellow             [F] +44 (0)20 7679 7565
ENSIS Ltd. & ECRC                 [E] gavin.simpsonATNOSPAMucl.ac.uk
UCL Department of Geography       [W] http://www.ucl.ac.uk/~ucfagls/cv/
26 Bedford Way                    [W] http://www.ucl.ac.uk/~ucfagls/
London.  WC1H 0AP.
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%


From ggrothendieck at gmail.com  Thu Aug 18 03:48:40 2005
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Wed, 17 Aug 2005 21:48:40 -0400
Subject: [Rd] problem using model.frame()
In-Reply-To: <1124318966.2718.38.camel@dsl-217-155-166-107.zen.co.uk>
References: <1124205318.8689.45.camel@gsimpson.geog.ucl.ac.uk>
	<971536df05081608254fe12843@mail.gmail.com>
	<1124206769.8689.65.camel@gsimpson.geog.ucl.ac.uk>
	<971536df050816093559c40389@mail.gmail.com>
	<1124214263.8689.108.camel@gsimpson.geog.ucl.ac.uk>
	<17155.32972.298699.821499@stat.math.ethz.ch>
	<1124318966.2718.38.camel@dsl-217-155-166-107.zen.co.uk>
Message-ID: <971536df050817184842ae3749@mail.gmail.com>

If its just a matter of specifying two data frames how about just
letting the user specify them as the first two arguments without
injecting formulas into it so that any of these are allowed but
data frames are still not allowed in formulas other than in the
data argument:

yourfunction(df1, df2)
yourfunction(y ~ sp1 + sp2)
yourfunction(y ~., df)

This could easily be implemented by having yourfunction be
generic in which case the first one would dispatch
yourfunction.data.frame and the second and third would
dispatch yourfunction.formula .  

On 8/17/05, Gavin Simpson <gavin.simpson at ucl.ac.uk> wrote:
> On Wed, 2005-08-17 at 20:24 +0200, Martin Maechler wrote:
> > >>>>> "GS" == Gavin Simpson <gavin.simpson at ucl.ac.uk>
> > >>>>>     on Tue, 16 Aug 2005 18:44:23 +0100 writes:
> >
> >     GS> On Tue, 2005-08-16 at 12:35 -0400, Gabor Grothendieck
> >     GS> wrote:
> >     >> On 8/16/05, Gavin Simpson <gavin.simpson at ucl.ac.uk>
> >     >> wrote: > On Tue, 2005-08-16 at 11:25 -0400, Gabor
> >     >> Grothendieck wrote: > > It can handle data frames like
> >     >> this:
> >     >> > >
> >     >> > > model.frame(y1) > > or > > model.frame(~., y1)
> >     >> >
> >     >> > Thanks Gabor,
> >     >> >
> >     >> > Yes, I know that works, but I want the function
> >     >> coca.formula to accept a > formula like this y2 ~ y1,
> >     >> with both y1 and y2 being data frames. It is
> >     >>
> >     >> The expressions I gave work generally (i.e. lm, glm,
> >     >> ...), not just in model.matrix, so would it be ok if the
> >     >> user just does this?
> >     >>
> >     >> yourfunction(y2 ~., y1)
> >
> >     GS> Thanks again Gabor for your comments,
> >
> >     GS> I'd prefer the y1 ~ y2 as data frames - as this is the
> >     GS> most natural way of doing things. I'd like to have (y2
> >     GS> ~., y1) as well, and (y2 ~ spp1 + spp2 + spp3, y1) also
> >     GS> work - silently without any trouble.
> >
> > I'm sorry, Gavin, I tend to disagree quite a bit.
> >
> > The formula notation has quite a history in the S language, and
> > AFAIK never was the idea to use data.frames as formula
> > components, but rather as "environments" in which formula
> > components are looked up --- exactly as Gabor has explained.
> 
> Hi Martin, thanks for your comments,
> 
> But then one could have a matrix of variables on the rhs of the formula
> and it would work - whether this is a documented feature or un-intended
> side-effect of matrices being stored as vectors with dims, I don't know.
> 
> And whilst the formula may have a long history, a number of packages
> have extended the interface to implement a specific feature, which don't
> work with standard functions like lm, glm and friends. I don't see how
> what I wanted to achieve is greatly different to that or using a matrix.
> 
> > To break with such a deeply rooted principle,
> > you should have very very good reasons, because you're breaking
> > the concepts on which all other uses of formulae are based.
> > And this would potentially lead to much confusion of your users,
> > at least in the way they should learn to think about what
> > formulae mean.
> 
> In the end I managed to treat y1 ~ y2 (both data frames) as a special
> case, which allows the existing formula notation to work as well, so I
> can use y1 ~ y2, y1 ~ ., data = y2, or y1 ~ var + var2, data = y2. This
> is what I wanted all along, to extend my interface (not do anything to
> R's formulae), but to also work in the traditional sense.
> 
> The model I am writing code for really is modelling the relationship
> between two matrices of data. In one version of the method, there is
> real equivalence between both sides of the formula so it would seem odd
> to treat the two sides of the formula differently. At least to me ;-)
> 
> > Martin
> >
> >
> >     >> If it really is important to do it the way you describe,
> >     >> are the data frames necessarily numeric? If so you could
> >     >> preprocess your formula by placing as.matrix around all
> >     >> the variables representing data frames using something
> >     >> like this:
> >     >>
> >     >> https://www.stat.math.ethz.ch/pipermail/r-help/2004-December/061485.html
> >
> >     GS> Yes, they are numeric matrices (as data frames). I've
> >     GS> looked at this, but I'd prefer to not have to do too
> >     GS> much messing with the formula.
> >
> >     >> Of course, if they are necessarily numeric maybe they can
> >     >> be matrices in the first place?
> >
> >     GS> Because read.table etc. produce data.frames and this is
> >     GS> the natural way to work with data in R.
> >
> > but it is also slightly inefficient if they are numeric.
> > There are places for data frames and for matrices.
> 
> I agree - and in the code I've written, y1 and y2 quickly get coerced to
> matrices before the real number crunching begins.
> 
> However, all the other R modelling functions I have used work with
> data.frames. Arguably, it could cause more confusion to write a function
> that looked, walked and quacked like an R modelling function but needed
> the user to apply an extra step to use - a step not usually required
> under normal R usage.
> 
> All the best,
> 
> Gav
> 
> > Why should it be a problem to use
> >     M <- as.matrix(read.table(..))
> > ?
> >
> > For large files, it could be quite a bit more efficient,
> > needing a bit more of code, to
> > use scan() to read the numeric data directly :
> >
> >       h1 <- scan(..., n=1) ## <read variable names>
> >       nc <- length(h1)
> >       a <- matrix(scan(...., what = numeric(), ...),
> >                   ncol = nc, dimnames = list(NULL, h1))
> >
> > maybe this would be useful to be packaged into
> > a small utility with usage
> >
> >       read.matrix(...,  type = numeric(), ...)
> >
> >
> >     GS> Following your suggestions, I altered my code to
> >     GS> evaluate the rhs of the formula and check if it was of
> >     GS> class "data.frame". If it is then I stop processing and
> >     GS> return it as a data.frame as this point. If not, it
> >     GS> eventually gets passed on to model.frame() for it to
> >     GS> deal with it.
> >
> >     GS> So far - limited testing - it seems to do what I wanted
> >     GS> all along. I'm sure there's a gotcha in there somewhere
> >     GS> but at least the code runs so I can check for problems
> >     GS> against my examples.
> >
> >     GS> Right, back to writing documentation...
> >
> >     GS> G
> >
> >     >> > more intuitive, to my mind at least for this particular
> >     >> example and > analysis, to specify the formula with a
> >     >> data frame on the rhs.
> >     >> >
> >     >> > model.frame doesn't work with the formula "~ y1" if the
> >     >> object y1, in > the environment when model.frame
> >     >> evaluates the formula, is a data.frame.  > It works if y1
> >     >> is a matrix, however. I'd like to work around this >
> >     >> problem, say by creating an environment in which y1 is
> >     >> modified to be a > matrix, if possible. Can this be done?
> >     >> >
> >     >> > At the moment I have something working by grabbing the
> >     >> bits of the > formula and then using get() to grab the
> >     >> named object. Of course, this > won't work if someone
> >     >> wants to use R's formula interface with the > following
> >     >> formula y2 ~ var1 + var2 + var3, data = y1, or to use the
> >     >> > subset argument common to many formula
> >     >> implementations. I'd like to have > the function work in
> >     >> as general a manner as possible, so I'm fishing > around
> >     >> for potential solutions.
> >     >> >
> >     >> > All the best,
> >     >> >
> >     >> > Gav
> >     >> >
> >     >> > >
> >     >> > > On 8/16/05, Gavin Simpson <gavin.simpson at ucl.ac.uk>
> >     >> wrote: > > > Hi I'm having a problem with model.frame,
> >     >> encapsulated in this example:
> >     >> > > >
> >     >> > > > y1 <-
> >     >> matrix(c(3,1,0,1,0,1,1,0,0,0,1,0,0,0,1,1,0,1,1,1), > > >
> >     >> nrow = 5, byrow = TRUE) > > > y1 <- as.data.frame(y1) > >
> >     >> > rownames(y1) <- paste("site", 1:5, sep = "") > > >
> >     >> colnames(y1) <- paste("spp", 1:4, sep = "") > > > y1
> >     >> > > >
> >     >> > > > model.frame(~ y1) > > > Error in
> >     >> model.frame(formula, rownames, variables, varnames,
> >     >> extras, extranames, : > > > invalid variable type
> >     >> > > >
> >     >> > > > temp <- as.matrix(y1) > > > model.frame(~ temp) > >
> >     >> > temp.spp1 temp.spp2 temp.spp3 temp.spp4 > > > 1 3 1 0 1
> >     >> > > > 2 0 1 1 0 > > > 3 0 0 1 0 > > > 4 0 0 1 1 > > > 5 0
> >     >> 1 1 1
> >     >> > > >
> >     >> > > > Ideally the above wouldn't have names like
> >     >> temp.var1, temp.var2, but one > > > could deal with that
> >     >> later.
> >     >> > > >
> >     >> > > > I have tracked down the source of the error message
> >     >> to line 1330 in > > > model.c - here I'm stumped as I
> >     >> don't know any C, but it looks as if the > > > code is
> >     >> looping over the variables in the formula and checking of
> >     >> they > > > are the right "type". So a matrix of variables
> >     >> gets through, but a > > > data.frame doesn't.
> >     >> > > >
> >     >> > > > It would be good if model.frame could cope with
> >     >> data.frames in formulae, > > > but seeing as I am
> >     >> incapable of providing a patch, is there a way around > >
> >     >> > this problem?
> >     >> > > >
> >     >> > > > Below is the head of the function I am currently
> >     >> using, including the > > > function for parsing the
> >     >> formula - borrowed and hacked from > > >
> >     >> ordiParseFormula() in package vegan.
> >     >> > > >
> >     >> > > > I can work out the class of the rhs of the
> >     >> forumla. Is there a way to > > > create a suitable
> >     >> environment for the data argument of parseFormula() > > >
> >     >> such that it contains the rhs dataframe coerced to a
> >     >> matrix, which then > > > should get through
> >     >> model.frame.default without error? How would I go > > >
> >     >> about manipulating/creating such an environment? Any
> >     >> other ideas?
> >     >> > > >
> >     >> > > > Thanks in advance
> >     >> > > >
> >     >> > > > Gav
> >     >> > > >
> >     >> > > > coca.formula <- function(formula, method =
> >     >> c("predictive", "symmetric"), > > > reg.method =
> >     >> c("simpls", "eigen"), weights = NULL, > > > n.axes =
> >     >> NULL, symmetric = FALSE, data) > > > { > > > parseFormula
> >     >> <- function (formula, data) > > > { > > > browser() > > >
> >     >> Terms <- terms(formula, "Condition", data = data) > > >
> >     >> flapart <- fla <- formula <- formula(Terms, width.cutoff
> >     >> = 500) > > > specdata <- formula[[2]] > > > X <-
> >     >> eval(specdata, data, parent.frame()) > > > X <-
> >     >> as.matrix(X) > > > formula[[2]] <- NULL > > > if
> >     >> (formula[[2]] == "1" || formula[[2]] == "0") > > > Y <-
> >     >> NULL > > > else { > > > mf <- model.frame(formula, data,
> >     >> na.action = na.fail) > > > Y <- model.matrix(formula, mf)
> >     >> > > > if (any(colnames(Y) == "(Intercept)")) { > > > xint
> >     >> <- which(colnames(Y) == "(Intercept)") > > > Y <- Y[,
> >     >> -xint, drop = FALSE] > > > } > > > } > > > list(X = X, Y
> >     >> = Y) > > > } > > > if (missing(data)) > > > data <-
> >     >> parent.frame() > > > #browser() > > > dat <-
> >     >> parseFormula(formula, data)
> >     >> > > >
> >     >> > > > --
> >     >> > > >
> >     >> %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
> >     >> > > > Gavin Simpson [T] +44 (0)20 7679 5522 > > > ENSIS
> >     >> Research Fellow [F] +44 (0)20 7679 7565 > > > ENSIS
> >     >> Ltd. & ECRC [E] gavin.simpsonATNOSPAMucl.ac.uk > > > UCL
> >     >> Department of Geography [W]
> >     >> http://www.ucl.ac.uk/~ucfagls/cv/ > > > 26 Bedford Way
> >     >> [W] http://www.ucl.ac.uk/~ucfagls/ > > > London.  WC1H
> >     >> 0AP.  > > >
> >     >> %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
> >     >> > > >
> >     >> > > > ______________________________________________ > >
> >     >> > R-devel at r-project.org mailing list > > >
> >     >> https://stat.ethz.ch/mailman/listinfo/r-devel
> >     >> > > >
> >     >> > --
> >     >> >
> >     >> %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
> >     >> > Gavin Simpson [T] +44 (0)20 7679 5522 > ENSIS Research
> >     >> Fellow [F] +44 (0)20 7679 7565 > ENSIS Ltd. & ECRC [E]
> >     >> gavin.simpsonATNOSPAMucl.ac.uk > UCL Department of
> >     >> Geography [W] http://www.ucl.ac.uk/~ucfagls/cv/ > 26
> >     >> Bedford Way [W] http://www.ucl.ac.uk/~ucfagls/ > London.
> >     >> WC1H 0AP.  >
> >     >> %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
> >     >> >
> >     >> >
> >     >> >
> >     GS> --
> >     GS> %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
> >     GS> Gavin Simpson [T] +44 (0)20 7679 5522 ENSIS Research
> >     GS> Fellow [F] +44 (0)20 7679 7565 ENSIS Ltd. & ECRC [E]
> >     GS> gavin.simpsonATNOSPAMucl.ac.uk UCL Department of
> >     GS> Geography [W] http://www.ucl.ac.uk/~ucfagls/cv/ 26
> >     GS> Bedford Way [W] http://www.ucl.ac.uk/~ucfagls/ London.
> >     GS> WC1H 0AP.
> >     GS> %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
> >
> >     GS> ______________________________________________
> >     GS> R-devel at r-project.org mailing list
> >     GS> https://stat.ethz.ch/mailman/listinfo/r-devel
> --
> %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
> Gavin Simpson                     [T] +44 (0)20 7679 5522
> ENSIS Research Fellow             [F] +44 (0)20 7679 7565
> ENSIS Ltd. & ECRC                 [E] gavin.simpsonATNOSPAMucl.ac.uk
> UCL Department of Geography       [W] http://www.ucl.ac.uk/~ucfagls/cv/
> 26 Bedford Way                    [W] http://www.ucl.ac.uk/~ucfagls/
> London.  WC1H 0AP.
> %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
> 
>


From jari.oksanen at oulu.fi  Thu Aug 18 06:57:39 2005
From: jari.oksanen at oulu.fi (Jari Oksanen)
Date: Thu, 18 Aug 2005 07:57:39 +0300
Subject: [Rd] problem using model.frame()
In-Reply-To: <1124318966.2718.38.camel@dsl-217-155-166-107.zen.co.uk>
References: <1124205318.8689.45.camel@gsimpson.geog.ucl.ac.uk>
	<971536df05081608254fe12843@mail.gmail.com>
	<1124206769.8689.65.camel@gsimpson.geog.ucl.ac.uk>
	<971536df050816093559c40389@mail.gmail.com>
	<1124214263.8689.108.camel@gsimpson.geog.ucl.ac.uk>
	<17155.32972.298699.821499@stat.math.ethz.ch>
	<1124318966.2718.38.camel@dsl-217-155-166-107.zen.co.uk>
Message-ID: <b1afcc8ead241983653e8f8800c05566@oulu.fi>


On 18 Aug 2005, at 1:49, Gavin Simpson wrote:

> On Wed, 2005-08-17 at 20:24 +0200, Martin Maechler wrote:
>>>>>>> "GS" == Gavin Simpson <gavin.simpson at ucl.ac.uk>
>>>>>>>     on Tue, 16 Aug 2005 18:44:23 +0100 writes:
>>
>>     GS> On Tue, 2005-08-16 at 12:35 -0400, Gabor Grothendieck
>>     GS> wrote:
>>>> On 8/16/05, Gavin Simpson <gavin.simpson at ucl.ac.uk>
>>>> wrote: > On Tue, 2005-08-16 at 11:25 -0400, Gabor
>>>> Grothendieck wrote: > > It can handle data frames like
>>>> this:
>>>>>>
>>>>>> model.frame(y1) > > or > > model.frame(~., y1)
>>>>>
>>>>> Thanks Gabor,
>>>>>
>>>>> Yes, I know that works, but I want the function
>>>> coca.formula to accept a > formula like this y2 ~ y1,
>>>> with both y1 and y2 being data frames. It is
>>>>
>>>> The expressions I gave work generally (i.e. lm, glm,
>>>> ...), not just in model.matrix, so would it be ok if the
>>>> user just does this?
>>>>
>>>> yourfunction(y2 ~., y1)
>>
>>     GS> Thanks again Gabor for your comments,
>>
>>     GS> I'd prefer the y1 ~ y2 as data frames - as this is the
>>     GS> most natural way of doing things. I'd like to have (y2
>>     GS> ~., y1) as well, and (y2 ~ spp1 + spp2 + spp3, y1) also
>>     GS> work - silently without any trouble.
>>
>> I'm sorry, Gavin, I tend to disagree quite a bit.
>>
>> The formula notation has quite a history in the S language, and
>> AFAIK never was the idea to use data.frames as formula
>> components, but rather as "environments" in which formula
>> components are looked up --- exactly as Gabor has explained.
>
> Hi Martin, thanks for your comments,
>
> But then one could have a matrix of variables on the rhs of the formula
> and it would work - whether this is a documented feature or un-intended
> side-effect of matrices being stored as vectors with dims, I don't 
> know.
>
> And whilst the formula may have a long history, a number of packages
> have extended the interface to implement a specific feature, which 
> don't
> work with standard functions like lm, glm and friends. I don't see how
> what I wanted to achieve is greatly different to that or using a 
> matrix.
>
>> To break with such a deeply rooted principle,
>> you should have very very good reasons, because you're breaking
>> the concepts on which all other uses of formulae are based.
>> And this would potentially lead to much confusion of your users,
>> at least in the way they should learn to think about what
>> formulae mean.
>
> In the end I managed to treat y1 ~ y2 (both data frames) as a special
> case, which allows the existing formula notation to work as well, so I
> can use y1 ~ y2, y1 ~ ., data = y2, or y1 ~ var + var2, data = y2. This
> is what I wanted all along, to extend my interface (not do anything to
> R's formulae), but to also work in the traditional sense.
>
> The model I am writing code for really is modelling the relationship
> between two matrices of data. In one version of the method, there is
> real equivalence between both sides of the formula so it would seem odd
> to treat the two sides of the formula differently. At least to me ;-)

It seems that I may be responsible for one of these extensions (lhs as 
a data.frame in cca and rda in vegan package). There the response (lhs) 
is multivariate or a multispecies community, and you must take that as 
a whole without manipulation (and if you tried using VGAM you see there 
really is painful to define lhs with, say, 127 elements). However, in 
general you shouldn't use models where you use all the 'explanatory' 
variables (rhs) that yo happen to have by accident. So much bad science 
has been created with that approach even in your field, Gav. The whole 
idea of formula is the ability to choose from candidate variables. That 
is: to build a model. Therefore you have one-sided formulae in prcomp() 
and princomp(): you can say prcomp(~ x1 + log(x2) +x4, data) or 
prcomp(~ . - x3, data). I think you should try to keep it so. Do 
instead like Gabor suggested: you could have a function coca.default or 
coca.matrix with interface:

coca.matrix(matx, maty, matz) -- or you can name this as coca.default.

and coca.formula which essentially parses your formula and returns a 
list of matrices you need:

coca.formula <- function(formula, data)
{
      matricesout <- parsemyformula(formula, data)
     coca(matricesout$matx, matricesout$maty, matricesoutz)
}
Then you need the generic: coca <- function(...) UseMethod("coca") and 
it's done (but fails in R CMD check unless you add "..." in all 
specific functions...). The real work is always done in coca.matrix (or 
coca.default), and the others just chew your data into suitable form 
for your workhorse.

If then somebody thinks that they need all possible variables as 
'explanatory' variables (or perhaps constraints in your case), they 
just call the function as

coca(matx, maty, matz)

And if you have coca.data.frame they don't need 'quacking' with extra 
steps:

coca.data.frame <- function(dfx, dfy dfz) coca(as.matrix(dfx), 
as.matrix(dfy), as.matrix(dfz)).

This you call as coca(dfx, dfy, dfz) and there you go.

The essential feature in formula is the ability to define the model. 
Don't give it away.

cheers, jazza
--
Jari Oksanen, Oulu, Finland


From gavin.simpson at ucl.ac.uk  Thu Aug 18 08:53:05 2005
From: gavin.simpson at ucl.ac.uk (Gavin Simpson)
Date: Thu, 18 Aug 2005 07:53:05 +0100
Subject: [Rd] problem using model.frame()
In-Reply-To: <971536df050817184842ae3749@mail.gmail.com>
References: <1124205318.8689.45.camel@gsimpson.geog.ucl.ac.uk>
	<971536df05081608254fe12843@mail.gmail.com>
	<1124206769.8689.65.camel@gsimpson.geog.ucl.ac.uk>
	<971536df050816093559c40389@mail.gmail.com>
	<1124214263.8689.108.camel@gsimpson.geog.ucl.ac.uk>
	<17155.32972.298699.821499@stat.math.ethz.ch>
	<1124318966.2718.38.camel@dsl-217-155-166-107.zen.co.uk>
	<971536df050817184842ae3749@mail.gmail.com>
Message-ID: <1124347985.2753.6.camel@dsl-217-155-166-107.zen.co.uk>

On Wed, 2005-08-17 at 21:48 -0400, Gabor Grothendieck wrote:
> If its just a matter of specifying two data frames how about just
> letting the user specify them as the first two arguments without
> injecting formulas into it so that any of these are allowed but
> data frames are still not allowed in formulas other than in the
> data argument:
> 
> yourfunction(df1, df2)
> yourfunction(y ~ sp1 + sp2)
> yourfunction(y ~., df)
> 
> This could easily be implemented by having yourfunction be
> generic in which case the first one would dispatch
> yourfunction.data.frame and the second and third would
> dispatch yourfunction.formula .  

Hi Gabor,

yourfunction() is already generic, I have .default and .formula methods.
The default implementation of the method (Co-correspondence analysis) is
akin to a regression and uses a form of multivariate PLS. So one data
matrix plays the role of the response and one the predictor. Which is
the reason for wanting to use a formula interface.

Cheers,

G

> On 8/17/05, Gavin Simpson <gavin.simpson at ucl.ac.uk> wrote:
> > On Wed, 2005-08-17 at 20:24 +0200, Martin Maechler wrote:
> > > >>>>> "GS" == Gavin Simpson <gavin.simpson at ucl.ac.uk>
> > > >>>>>     on Tue, 16 Aug 2005 18:44:23 +0100 writes:
> > >
> > >     GS> On Tue, 2005-08-16 at 12:35 -0400, Gabor Grothendieck
> > >     GS> wrote:
> > >     >> On 8/16/05, Gavin Simpson <gavin.simpson at ucl.ac.uk>
> > >     >> wrote: > On Tue, 2005-08-16 at 11:25 -0400, Gabor
> > >     >> Grothendieck wrote: > > It can handle data frames like
> > >     >> this:
> > >     >> > >
> > >     >> > > model.frame(y1) > > or > > model.frame(~., y1)
> > >     >> >
> > >     >> > Thanks Gabor,
> > >     >> >
> > >     >> > Yes, I know that works, but I want the function
> > >     >> coca.formula to accept a > formula like this y2 ~ y1,
> > >     >> with both y1 and y2 being data frames. It is
> > >     >>
> > >     >> The expressions I gave work generally (i.e. lm, glm,
> > >     >> ...), not just in model.matrix, so would it be ok if the
> > >     >> user just does this?
> > >     >>
> > >     >> yourfunction(y2 ~., y1)
> > >
> > >     GS> Thanks again Gabor for your comments,
> > >
> > >     GS> I'd prefer the y1 ~ y2 as data frames - as this is the
> > >     GS> most natural way of doing things. I'd like to have (y2
> > >     GS> ~., y1) as well, and (y2 ~ spp1 + spp2 + spp3, y1) also
> > >     GS> work - silently without any trouble.
> > >
> > > I'm sorry, Gavin, I tend to disagree quite a bit.
> > >
> > > The formula notation has quite a history in the S language, and
> > > AFAIK never was the idea to use data.frames as formula
> > > components, but rather as "environments" in which formula
> > > components are looked up --- exactly as Gabor has explained.
> > 
> > Hi Martin, thanks for your comments,
> > 
> > But then one could have a matrix of variables on the rhs of the formula
> > and it would work - whether this is a documented feature or un-intended
> > side-effect of matrices being stored as vectors with dims, I don't know.
> > 
> > And whilst the formula may have a long history, a number of packages
> > have extended the interface to implement a specific feature, which don't
> > work with standard functions like lm, glm and friends. I don't see how
> > what I wanted to achieve is greatly different to that or using a matrix.
> > 
> > > To break with such a deeply rooted principle,
> > > you should have very very good reasons, because you're breaking
> > > the concepts on which all other uses of formulae are based.
> > > And this would potentially lead to much confusion of your users,
> > > at least in the way they should learn to think about what
> > > formulae mean.
> > 
> > In the end I managed to treat y1 ~ y2 (both data frames) as a special
> > case, which allows the existing formula notation to work as well, so I
> > can use y1 ~ y2, y1 ~ ., data = y2, or y1 ~ var + var2, data = y2. This
> > is what I wanted all along, to extend my interface (not do anything to
> > R's formulae), but to also work in the traditional sense.
> > 
> > The model I am writing code for really is modelling the relationship
> > between two matrices of data. In one version of the method, there is
> > real equivalence between both sides of the formula so it would seem odd
> > to treat the two sides of the formula differently. At least to me ;-)
> > 
> > > Martin
> > >
> > >
> > >     >> If it really is important to do it the way you describe,
> > >     >> are the data frames necessarily numeric? If so you could
> > >     >> preprocess your formula by placing as.matrix around all
> > >     >> the variables representing data frames using something
> > >     >> like this:
> > >     >>
> > >     >> https://www.stat.math.ethz.ch/pipermail/r-help/2004-December/061485.html
> > >
> > >     GS> Yes, they are numeric matrices (as data frames). I've
> > >     GS> looked at this, but I'd prefer to not have to do too
> > >     GS> much messing with the formula.
> > >
> > >     >> Of course, if they are necessarily numeric maybe they can
> > >     >> be matrices in the first place?
> > >
> > >     GS> Because read.table etc. produce data.frames and this is
> > >     GS> the natural way to work with data in R.
> > >
> > > but it is also slightly inefficient if they are numeric.
> > > There are places for data frames and for matrices.
> > 
> > I agree - and in the code I've written, y1 and y2 quickly get coerced to
> > matrices before the real number crunching begins.
> > 
> > However, all the other R modelling functions I have used work with
> > data.frames. Arguably, it could cause more confusion to write a function
> > that looked, walked and quacked like an R modelling function but needed
> > the user to apply an extra step to use - a step not usually required
> > under normal R usage.
> > 
> > All the best,
> > 
> > Gav
> > 
> > > Why should it be a problem to use
> > >     M <- as.matrix(read.table(..))
> > > ?
> > >
> > > For large files, it could be quite a bit more efficient,
> > > needing a bit more of code, to
> > > use scan() to read the numeric data directly :
> > >
> > >       h1 <- scan(..., n=1) ## <read variable names>
> > >       nc <- length(h1)
> > >       a <- matrix(scan(...., what = numeric(), ...),
> > >                   ncol = nc, dimnames = list(NULL, h1))
> > >
> > > maybe this would be useful to be packaged into
> > > a small utility with usage
> > >
> > >       read.matrix(...,  type = numeric(), ...)
> > >
> > >
> > >     GS> Following your suggestions, I altered my code to
> > >     GS> evaluate the rhs of the formula and check if it was of
> > >     GS> class "data.frame". If it is then I stop processing and
> > >     GS> return it as a data.frame as this point. If not, it
> > >     GS> eventually gets passed on to model.frame() for it to
> > >     GS> deal with it.
> > >
> > >     GS> So far - limited testing - it seems to do what I wanted
> > >     GS> all along. I'm sure there's a gotcha in there somewhere
> > >     GS> but at least the code runs so I can check for problems
> > >     GS> against my examples.
> > >
> > >     GS> Right, back to writing documentation...
> > >
> > >     GS> G
> > >
> > >     >> > more intuitive, to my mind at least for this particular
> > >     >> example and > analysis, to specify the formula with a
> > >     >> data frame on the rhs.
> > >     >> >
> > >     >> > model.frame doesn't work with the formula "~ y1" if the
> > >     >> object y1, in > the environment when model.frame
> > >     >> evaluates the formula, is a data.frame.  > It works if y1
> > >     >> is a matrix, however. I'd like to work around this >
> > >     >> problem, say by creating an environment in which y1 is
> > >     >> modified to be a > matrix, if possible. Can this be done?
> > >     >> >
> > >     >> > At the moment I have something working by grabbing the
> > >     >> bits of the > formula and then using get() to grab the
> > >     >> named object. Of course, this > won't work if someone
> > >     >> wants to use R's formula interface with the > following
> > >     >> formula y2 ~ var1 + var2 + var3, data = y1, or to use the
> > >     >> > subset argument common to many formula
> > >     >> implementations. I'd like to have > the function work in
> > >     >> as general a manner as possible, so I'm fishing > around
> > >     >> for potential solutions.
> > >     >> >
> > >     >> > All the best,
> > >     >> >
> > >     >> > Gav
> > >     >> >
> > >     >> > >
> > >     >> > > On 8/16/05, Gavin Simpson <gavin.simpson at ucl.ac.uk>
> > >     >> wrote: > > > Hi I'm having a problem with model.frame,
> > >     >> encapsulated in this example:
> > >     >> > > >
> > >     >> > > > y1 <-
> > >     >> matrix(c(3,1,0,1,0,1,1,0,0,0,1,0,0,0,1,1,0,1,1,1), > > >
> > >     >> nrow = 5, byrow = TRUE) > > > y1 <- as.data.frame(y1) > >
> > >     >> > rownames(y1) <- paste("site", 1:5, sep = "") > > >
> > >     >> colnames(y1) <- paste("spp", 1:4, sep = "") > > > y1
> > >     >> > > >
> > >     >> > > > model.frame(~ y1) > > > Error in
> > >     >> model.frame(formula, rownames, variables, varnames,
> > >     >> extras, extranames, : > > > invalid variable type
> > >     >> > > >
> > >     >> > > > temp <- as.matrix(y1) > > > model.frame(~ temp) > >
> > >     >> > temp.spp1 temp.spp2 temp.spp3 temp.spp4 > > > 1 3 1 0 1
> > >     >> > > > 2 0 1 1 0 > > > 3 0 0 1 0 > > > 4 0 0 1 1 > > > 5 0
> > >     >> 1 1 1
> > >     >> > > >
> > >     >> > > > Ideally the above wouldn't have names like
> > >     >> temp.var1, temp.var2, but one > > > could deal with that
> > >     >> later.
> > >     >> > > >
> > >     >> > > > I have tracked down the source of the error message
> > >     >> to line 1330 in > > > model.c - here I'm stumped as I
> > >     >> don't know any C, but it looks as if the > > > code is
> > >     >> looping over the variables in the formula and checking of
> > >     >> they > > > are the right "type". So a matrix of variables
> > >     >> gets through, but a > > > data.frame doesn't.
> > >     >> > > >
> > >     >> > > > It would be good if model.frame could cope with
> > >     >> data.frames in formulae, > > > but seeing as I am
> > >     >> incapable of providing a patch, is there a way around > >
> > >     >> > this problem?
> > >     >> > > >
> > >     >> > > > Below is the head of the function I am currently
> > >     >> using, including the > > > function for parsing the
> > >     >> formula - borrowed and hacked from > > >
> > >     >> ordiParseFormula() in package vegan.
> > >     >> > > >
> > >     >> > > > I can work out the class of the rhs of the
> > >     >> forumla. Is there a way to > > > create a suitable
> > >     >> environment for the data argument of parseFormula() > > >
> > >     >> such that it contains the rhs dataframe coerced to a
> > >     >> matrix, which then > > > should get through
> > >     >> model.frame.default without error? How would I go > > >
> > >     >> about manipulating/creating such an environment? Any
> > >     >> other ideas?
> > >     >> > > >
> > >     >> > > > Thanks in advance
> > >     >> > > >
> > >     >> > > > Gav
> > >     >> > > >
> > >     >> > > > coca.formula <- function(formula, method =
> > >     >> c("predictive", "symmetric"), > > > reg.method =
> > >     >> c("simpls", "eigen"), weights = NULL, > > > n.axes =
> > >     >> NULL, symmetric = FALSE, data) > > > { > > > parseFormula
> > >     >> <- function (formula, data) > > > { > > > browser() > > >
> > >     >> Terms <- terms(formula, "Condition", data = data) > > >
> > >     >> flapart <- fla <- formula <- formula(Terms, width.cutoff
> > >     >> = 500) > > > specdata <- formula[[2]] > > > X <-
> > >     >> eval(specdata, data, parent.frame()) > > > X <-
> > >     >> as.matrix(X) > > > formula[[2]] <- NULL > > > if
> > >     >> (formula[[2]] == "1" || formula[[2]] == "0") > > > Y <-
> > >     >> NULL > > > else { > > > mf <- model.frame(formula, data,
> > >     >> na.action = na.fail) > > > Y <- model.matrix(formula, mf)
> > >     >> > > > if (any(colnames(Y) == "(Intercept)")) { > > > xint
> > >     >> <- which(colnames(Y) == "(Intercept)") > > > Y <- Y[,
> > >     >> -xint, drop = FALSE] > > > } > > > } > > > list(X = X, Y
> > >     >> = Y) > > > } > > > if (missing(data)) > > > data <-
> > >     >> parent.frame() > > > #browser() > > > dat <-
> > >     >> parseFormula(formula, data)
> > >     >> > > >
> > >     >> > > > --
> > >     >> > > >
> > >     >> %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
> > >     >> > > > Gavin Simpson [T] +44 (0)20 7679 5522 > > > ENSIS
> > >     >> Research Fellow [F] +44 (0)20 7679 7565 > > > ENSIS
> > >     >> Ltd. & ECRC [E] gavin.simpsonATNOSPAMucl.ac.uk > > > UCL
> > >     >> Department of Geography [W]
> > >     >> http://www.ucl.ac.uk/~ucfagls/cv/ > > > 26 Bedford Way
> > >     >> [W] http://www.ucl.ac.uk/~ucfagls/ > > > London.  WC1H
> > >     >> 0AP.  > > >
> > >     >> %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
> > >     >> > > >
> > >     >> > > > ______________________________________________ > >
> > >     >> > R-devel at r-project.org mailing list > > >
> > >     >> https://stat.ethz.ch/mailman/listinfo/r-devel
> > >     >> > > >
> > >     >> > --
> > >     >> >
> > >     >> %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
> > >     >> > Gavin Simpson [T] +44 (0)20 7679 5522 > ENSIS Research
> > >     >> Fellow [F] +44 (0)20 7679 7565 > ENSIS Ltd. & ECRC [E]
> > >     >> gavin.simpsonATNOSPAMucl.ac.uk > UCL Department of
> > >     >> Geography [W] http://www.ucl.ac.uk/~ucfagls/cv/ > 26
> > >     >> Bedford Way [W] http://www.ucl.ac.uk/~ucfagls/ > London.
> > >     >> WC1H 0AP.  >
> > >     >> %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
> > >     >> >
> > >     >> >
> > >     >> >
> > >     GS> --
> > >     GS> %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
> > >     GS> Gavin Simpson [T] +44 (0)20 7679 5522 ENSIS Research
> > >     GS> Fellow [F] +44 (0)20 7679 7565 ENSIS Ltd. & ECRC [E]
> > >     GS> gavin.simpsonATNOSPAMucl.ac.uk UCL Department of
> > >     GS> Geography [W] http://www.ucl.ac.uk/~ucfagls/cv/ 26
> > >     GS> Bedford Way [W] http://www.ucl.ac.uk/~ucfagls/ London.
> > >     GS> WC1H 0AP.
> > >     GS> %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
> > >
> > >     GS> ______________________________________________
> > >     GS> R-devel at r-project.org mailing list
> > >     GS> https://stat.ethz.ch/mailman/listinfo/r-devel
> > --
> > %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
> > Gavin Simpson                     [T] +44 (0)20 7679 5522
> > ENSIS Research Fellow             [F] +44 (0)20 7679 7565
> > ENSIS Ltd. & ECRC                 [E] gavin.simpsonATNOSPAMucl.ac.uk
> > UCL Department of Geography       [W] http://www.ucl.ac.uk/~ucfagls/cv/
> > 26 Bedford Way                    [W] http://www.ucl.ac.uk/~ucfagls/
> > London.  WC1H 0AP.
> > %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
> > 
> >
-- 
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
Gavin Simpson                     [T] +44 (0)20 7679 5522
ENSIS Research Fellow             [F] +44 (0)20 7679 7565
ENSIS Ltd. & ECRC                 [E] gavin.simpsonATNOSPAMucl.ac.uk
UCL Department of Geography       [W] http://www.ucl.ac.uk/~ucfagls/cv/
26 Bedford Way                    [W] http://www.ucl.ac.uk/~ucfagls/
London.  WC1H 0AP.
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%


From gavin.simpson at ucl.ac.uk  Thu Aug 18 09:26:54 2005
From: gavin.simpson at ucl.ac.uk (Gavin Simpson)
Date: Thu, 18 Aug 2005 08:26:54 +0100
Subject: [Rd] problem using model.frame()
In-Reply-To: <b1afcc8ead241983653e8f8800c05566@oulu.fi>
References: <1124205318.8689.45.camel@gsimpson.geog.ucl.ac.uk>
	<971536df05081608254fe12843@mail.gmail.com>
	<1124206769.8689.65.camel@gsimpson.geog.ucl.ac.uk>
	<971536df050816093559c40389@mail.gmail.com>
	<1124214263.8689.108.camel@gsimpson.geog.ucl.ac.uk>
	<17155.32972.298699.821499@stat.math.ethz.ch>
	<1124318966.2718.38.camel@dsl-217-155-166-107.zen.co.uk>
	<b1afcc8ead241983653e8f8800c05566@oulu.fi>
Message-ID: <1124350014.2753.40.camel@dsl-217-155-166-107.zen.co.uk>

On Thu, 2005-08-18 at 07:57 +0300, Jari Oksanen wrote:
> On 18 Aug 2005, at 1:49, Gavin Simpson wrote:
> 
> > On Wed, 2005-08-17 at 20:24 +0200, Martin Maechler wrote:
> >>>>>>> "GS" == Gavin Simpson <gavin.simpson at ucl.ac.uk>
> >>>>>>>     on Tue, 16 Aug 2005 18:44:23 +0100 writes:
> >>
> >>     GS> On Tue, 2005-08-16 at 12:35 -0400, Gabor Grothendieck
> >>     GS> wrote:
> >>>> On 8/16/05, Gavin Simpson <gavin.simpson at ucl.ac.uk>
> >>>> wrote: > On Tue, 2005-08-16 at 11:25 -0400, Gabor
> >>>> Grothendieck wrote: > > It can handle data frames like
> >>>> this:
> >>>>>>
> >>>>>> model.frame(y1) > > or > > model.frame(~., y1)
> >>>>>
> >>>>> Thanks Gabor,
> >>>>>
> >>>>> Yes, I know that works, but I want the function
> >>>> coca.formula to accept a > formula like this y2 ~ y1,
> >>>> with both y1 and y2 being data frames. It is
> >>>>
> >>>> The expressions I gave work generally (i.e. lm, glm,
> >>>> ...), not just in model.matrix, so would it be ok if the
> >>>> user just does this?
> >>>>
> >>>> yourfunction(y2 ~., y1)
> >>
> >>     GS> Thanks again Gabor for your comments,
> >>
> >>     GS> I'd prefer the y1 ~ y2 as data frames - as this is the
> >>     GS> most natural way of doing things. I'd like to have (y2
> >>     GS> ~., y1) as well, and (y2 ~ spp1 + spp2 + spp3, y1) also
> >>     GS> work - silently without any trouble.
> >>
> >> I'm sorry, Gavin, I tend to disagree quite a bit.
> >>
> >> The formula notation has quite a history in the S language, and
> >> AFAIK never was the idea to use data.frames as formula
> >> components, but rather as "environments" in which formula
> >> components are looked up --- exactly as Gabor has explained.
> >
> > Hi Martin, thanks for your comments,
> >
> > But then one could have a matrix of variables on the rhs of the formula
> > and it would work - whether this is a documented feature or un-intended
> > side-effect of matrices being stored as vectors with dims, I don't 
> > know.
> >
> > And whilst the formula may have a long history, a number of packages
> > have extended the interface to implement a specific feature, which 
> > don't
> > work with standard functions like lm, glm and friends. I don't see how
> > what I wanted to achieve is greatly different to that or using a 
> > matrix.
> >
> >> To break with such a deeply rooted principle,
> >> you should have very very good reasons, because you're breaking
> >> the concepts on which all other uses of formulae are based.
> >> And this would potentially lead to much confusion of your users,
> >> at least in the way they should learn to think about what
> >> formulae mean.
> >
> > In the end I managed to treat y1 ~ y2 (both data frames) as a special
> > case, which allows the existing formula notation to work as well, so I
> > can use y1 ~ y2, y1 ~ ., data = y2, or y1 ~ var + var2, data = y2. This
> > is what I wanted all along, to extend my interface (not do anything to
> > R's formulae), but to also work in the traditional sense.
> >
> > The model I am writing code for really is modelling the relationship
> > between two matrices of data. In one version of the method, there is
> > real equivalence between both sides of the formula so it would seem odd
> > to treat the two sides of the formula differently. At least to me ;-)
> 
> It seems that I may be responsible for one of these extensions (lhs as 
> a data.frame in cca and rda in vegan package). There the response (lhs) 
> is multivariate or a multispecies community, and you must take that as 
> a whole without manipulation (and if you tried using VGAM you see there 
> really is painful to define lhs with, say, 127 elements). 

Hi Jari,

Thanks for reminding me about this - I'd forgotten about not normally
being able to have a data.frame on the lhs of the formula either - I'm
surprised no-one pulled me up on that one before, either ;-) 

I guess what I'm proposing is really pushing the formula representation
too far for some people. I'm coming round to the y1 ~ ., data = y2 way
of doing things - still prefer y1 ~ y2 though ;-)

Also, both y1 and y2 are community matrices (i.e. both have many, many
species, aka variables for the non-community ecologists reading this).
I'm not sure that it makes sense to treat the two sides differently. In
the predictive co-correspondence mode (the default), multivariate pls is
used to regress one matrix on another, with the number of pls components
being chosen by cross-validation or a permutation test.

> However, in 
> general you shouldn't use models where you use all the 'explanatory' 
> variables (rhs) that yo happen to have by accident. So much bad science 
> has been created with that approach even in your field, Gav. 

Well, I agree with you there...

> The whole 
> idea of formula is the ability to choose from candidate variables. That 
> is: to build a model. Therefore you have one-sided formulae in prcomp() 
> and princomp(): you can say prcomp(~ x1 + log(x2) +x4, data) or 
> prcomp(~ . - x3, data). I think you should try to keep it so. Do 
> instead like Gabor suggested: you could have a function coca.default or 
> coca.matrix with interface:
> 
> coca.matrix(matx, maty, matz) -- or you can name this as coca.default.
> 
> and coca.formula which essentially parses your formula and returns a 
> list of matrices you need:
> 
> coca.formula <- function(formula, data)
> {
>       matricesout <- parsemyformula(formula, data)
>      coca(matricesout$matx, matricesout$maty, matricesoutz)
> }
> Then you need the generic: coca <- function(...) UseMethod("coca") and 
> it's done (but fails in R CMD check unless you add "..." in all 
> specific functions...). The real work is always done in coca.matrix (or 
> coca.default), and the others just chew your data into suitable form 
> for your workhorse.
> 
> If then somebody thinks that they need all possible variables as 
> 'explanatory' variables (or perhaps constraints in your case), they 
> just call the function as
> 
> coca(matx, maty, matz)

My functions are already generic with coca.default and coca.formula. The
issue with matrices/data.frames was only a problem in the formula
interface.

> And if you have coca.data.frame they don't need 'quacking' with extra 
> steps:
> 
> coca.data.frame <- function(dfx, dfy dfz) coca(as.matrix(dfx), 
> as.matrix(dfy), as.matrix(dfz)).
> 
> This you call as coca(dfx, dfy, dfz) and there you go.
> 
> The essential feature in formula is the ability to define the model. 
> Don't give it away.

I think the point I'm trying to make is that I don't think what I'm
trying to do is any different than doing lm(y ~ x, data), (where y, x
are vectors) - it is just that my x and y happen to be multivariate. I
think it is easier to think of each community as a single entity in this
regard - the relationship *is* between community 1 and community 2, not
parts of community 2, or some parsimonious model of community 2 - but
that might just be semantics - unlike your cca/rda functions which
really are a (weighted) multivariate multiple regression. Happy to be
convinced otherwise though.

Also, it is worth re-iterating that I haven't broken the traditional way
of working with formulae with my function - you can still do y1 ~ .,
data = y2, or y1 ~ spp1 + spp2 + spp3, data = y2, for maximum
flexibility. All I wanted (and worked out how) to do was treat the rhs
in a special way if it were a data frame, just like Jari treats a
data.frame on the lhs of formulae in package vegan as a special case.

Thanks everyone for your ideas and comments - lots of food for thought.
I wavering between both camps on this - still time to be convinced and
change it before I finish the package.

All the best,

G

> 
> cheers, jazza
> --
> Jari Oksanen, Oulu, Finland
> 
-- 
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
Gavin Simpson                     [T] +44 (0)20 7679 5522
ENSIS Research Fellow             [F] +44 (0)20 7679 7565
ENSIS Ltd. & ECRC                 [E] gavin.simpsonATNOSPAMucl.ac.uk
UCL Department of Geography       [W] http://www.ucl.ac.uk/~ucfagls/cv/
26 Bedford Way                    [W] http://www.ucl.ac.uk/~ucfagls/
London.  WC1H 0AP.
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%


From dkoschuetzki at gmx.de  Thu Aug 18 13:43:29 2005
From: dkoschuetzki at gmx.de (dkoschuetzki@gmx.de)
Date: Thu, 18 Aug 2005 13:43:29 +0200 (CEST)
Subject: [Rd] kendall tau correlation test for ties: Potential error
	(PR#8076)
Message-ID: <20050818114329.DA54218B9E@slim.kubism.ku.dk>

Full_Name: Dirk Koschuetzki
Version: 2.1.1
OS: source code
Submission from: (NULL) (194.94.136.34)


Hello,

>From the source code (R-2.1.1, file: .../R-2.1.1/src/library/stats/R/)

******************************
cor.test.default <-
function(x, y, alternative = c("two.sided", "less", "greater"),
         method = c("pearson", "kendall", "spearman"), exact = NULL,
         conf.level = 0.95, ...)
{
    alternative <- match.arg(alternative)
    method <- match.arg(method)
    DNAME <- paste(deparse(substitute(x)), "and", deparse(substitute(y)))

    if(length(x) != length(y))
	stop("'x' and 'y' must have the same length")
    OK <- complete.cases(x, y)
    x <- x[OK]
    y <- y[OK]
    n <- length(x)

    PVAL <- NULL
    NVAL <- 0
    conf.int <- FALSE

    if(method == "pearson") {
	// Omitted
    }
    else {
	if(n < 2)
	    stop("not enough finite observations")
	PARAMETER <- NULL
	TIES <- (min(length(unique(x)), length(unique(y))) < n)
	if(method == "kendall") {
	    method <- "Kendall's rank correlation tau"
	    names(NVAL) <- "tau"
	    r <- cor(x,y, method = "kendall")
            ESTIMATE <- c(tau = r)

            if(!is.finite(ESTIMATE)) {  # all x or all y the same
                ESTIMATE[] <- NA
                STATISTIC <- c(T = NA)
                PVAL <- NA
            }
            else {
                if(is.null(exact))
                    exact <- (n < 50)
                if(exact && !TIES) {
                    q <- round((r + 1) * n * (n - 1) / 4)
                    pkendall <- function(q, n) {
                        .C("pkendall",
                           length(q),
                           p = as.double(q),
                           as.integer(n),
                           PACKAGE = "stats")$p
                    }
                    PVAL <-
                        switch(alternative,
                               "two.sided" = {
                                   if(q > n * (n - 1) / 4)
                                       p <- 1 - pkendall(q - 1, n)
                                   else
                                       p <- pkendall(q, n)
                                   min(2 * p, 1)
                               },
                               "greater" = 1 - pkendall(q - 1, n),
                               "less" = pkendall(q, n))
                    STATISTIC <- c(T = q)
                } else {
                    STATISTIC <- c(z = r / sqrt((4 * n + 10) / (9 * n*(n-1))))
                    p <- pnorm(STATISTIC)
                    if(exact && TIES)
                        warning("Cannot compute exact p-value with ties")
                }
            }
	} else {
	// OMITTED
        }
    }

    if(is.null(PVAL)) # for "pearson" only, currently
	PVAL <- switch(alternative,
		       "less" = p,
		       "greater" = 1 - p,
		       "two.sided" = 2 * min(p, 1 - p))

    RVAL <- list(statistic = STATISTIC,
                 parameter = PARAMETER,
                 p.value = as.numeric(PVAL),
                 estimate = ESTIMATE,
                 null.value = NVAL,
                 alternative = alternative,
                 method = method,
                 data.name = DNAME)
    if(conf.int)
        RVAL <- c(RVAL, list(conf.int = cint))
    class(RVAL) <- "htest"
    RVAL
}
*************

Please look at the computation of the p-value for Kendalls tau. There is an
assignment to "p" right above the warning. In the bottom of the function there
is a comment that for the pearson case we have to use the modification and set
PVAL. 

The problem is: 
* Either the comment is wrong because the modification should be done with
kendall too, or
* The variable PVAL has to be assigned in the kendall block.

I hope this is clear so far.

Please send me some comments, because I'm not sure if my observation is ok. And
currently I try to figure out the significance in the biserial case which of
course makes heavy use of the tied case.

Cheers,
Dirk


From p.dalgaard at biostat.ku.dk  Thu Aug 18 15:07:07 2005
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: 18 Aug 2005 15:07:07 +0200
Subject: [Rd] kendall tau correlation test for ties: Potential error
	(PR#8076)
In-Reply-To: <20050818114329.DA54218B9E@slim.kubism.ku.dk>
References: <20050818114329.DA54218B9E@slim.kubism.ku.dk>
Message-ID: <x2ek8rv1fo.fsf@turmalin.kubism.ku.dk>

dkoschuetzki at gmx.de writes:

>                 } else {
>                     STATISTIC <- c(z = r / sqrt((4 * n + 10) / (9 * n*(n-1))))
>                     p <- pnorm(STATISTIC)
>                     if(exact && TIES)
>                         warning("Cannot compute exact p-value with ties")
>                 }
>             }
> 	} else {
> 	// OMITTED
>         }
>     }
> 
>     if(is.null(PVAL)) # for "pearson" only, currently
> 	PVAL <- switch(alternative,
> 		       "less" = p,
> 		       "greater" = 1 - p,
> 		       "two.sided" = 2 * min(p, 1 - p))
...
> 
> Please look at the computation of the p-value for Kendalls tau. There is an
> assignment to "p" right above the warning. In the bottom of the function there
> is a comment that for the pearson case we have to use the modification and set
> PVAL. 
> 
> The problem is: 
> * Either the comment is wrong because the modification should be done with
> kendall too, or
> * The variable PVAL has to be assigned in the kendall block.
> 
> I hope this is clear so far.

I think it is the comment that is wrong. The calculation of
opposite-side one-sided and two-sided alternatives make OK sense when
the normal approximation of the test statistic is being used. It's
when you use a discrete distribution that you need to be careful.

(As brought up recently, the normal approximation itself is not too
hot in the tied case, but that's another matter.)

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From jmc at R-project.org  Thu Aug 18 23:23:34 2005
From: jmc at R-project.org (John Chambers)
Date: Thu, 18 Aug 2005 17:23:34 -0400
Subject: [Rd] Registering S3 class from external package
In-Reply-To: <Pine.OSF.4.58.0508110835330.193766@odin.mdacc.tmc.edu>
References: <Pine.OSF.4.58.0508110835330.193766@odin.mdacc.tmc.edu>
Message-ID: <4304FC56.9060006@R-project.org>

Your description is a bit too vague to be sure, but it sounds as if 
you're trying to do something that breaks the basic namespace idea.

Paul Roebuck wrote:

> The package I'm working on can extract data from external
> packages but would otherwise have no dependency on them.
> However, I desire to be able to dispatch based on an
> external S3 class if its package is attached (.First.lib).

Dispatch from where?  If you mean from a generic function inside your 
package's namespace, then the corresponding class definitions need to be 
defined in or imported into that namespace when it's constructed.  One 
of the main virtues of the namespace mechanism is that the known classes 
(& therefore the dispatch behavior) are fixed by the package source + 
its imports.  This means that the behavior of the package is insulated 
against effects from attaching other packages.

OTOH, if you mean dispatch from a generic function in the global 
environment or another (non-NAMESPACE) package, then you need to ensure 
that the setOldClass() takes place in the appropriate environment; e.g. 
if the generic is in the global environment,
   setOldClass(c("foo", "bar"), where = .GlobalEnv)
If you're dispatching from a generic in "somepkg", the setOldClass call 
should just be a part of the source for that package.
But, again, these will not help if you're dispatching from the mypkg 
namespace; that's just what the mechanism is trying to avoid.

In case it's not clear, the setOldClass() call defines a special kind of 
  S4 class for each of the S3 classes.  Therefore it's subject to the 
same locking rules as setClass() or any other call that needs to do an 
assignment as a side effect.


> My code is S4-based and its package has NAMESPACE.
> 
> Registering the external class prior to the other
> package being attached doesn't seem to work so I am
> attempting to perform the registration once the other
> package has done so. But my namespace is locked by the
> time this occurs. Can someone either tell me how to do
> this, suggest a better alternative, or point me to
> another package that does something similar?
> 
> Current attempt is something like the following:
> 
>   setHook(packageEvent("somepkg", "attach"),
>           function(...) {
>               cat("* Register", sQuote("oldstyle"),
>                   "as S3 class", "\n")
>               setOldClass(c("oldstyle", "data.frame"),
>                           where = asNamespace("mypkg"))
>           })
> 
> 
> -----------------
> 
>>require(mypkg)
> 
> Loading required package: mypkg
> ...
> 
>>require(somepkg)
> 
> Loading required package: somepkg
> * Register 'oldstyle' as S3 class
> Error in assign(classMetaName(Class), def, where) :
>         cannot add bindings to a locked environment
> 
>>R.version.string
> 
> [1] "R version 2.1.1, 2005-06-20"
> 
> ----------------------------------------------------------
> SIGSIG -- signature too long (core dumped)
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 
> !DSPAM:42fb68c222117714262142!
>


From jussi.jousimo at ktl.fi  Fri Aug 19 09:07:16 2005
From: jussi.jousimo at ktl.fi (jussi.jousimo@ktl.fi)
Date: Fri, 19 Aug 2005 09:07:16 +0200 (CEST)
Subject: [Rd] PS driver crashes when no permissions (PR#8078)
Message-ID: <20050819070716.2216A103CB@slim.kubism.ku.dk>

Full_Name: Jussi Jousimo
Version: 2.1.1
OS: Linux
Submission from: (NULL) (193.167.195.60)


R 2.1.1 crashes when it is trying to write a file with the postscript driver to
a directory, where the user has no permission to write. For example,
postscript("foo.ps") gives an error message: *** glibc detected *** free():
invalid pointer: 0x08a469b0 ***. The problem is at the PSDeviceDriver function
in the devPS.c file on line 2357 (free(dd);), where the same memory block is
tried to free the first time and then the second time at line 5138 (free(dev);).
I'd suggest to remove the first free function.


From ripley at stats.ox.ac.uk  Fri Aug 19 09:47:46 2005
From: ripley at stats.ox.ac.uk (ripley@stats.ox.ac.uk)
Date: Fri, 19 Aug 2005 09:47:46 +0200 (CEST)
Subject: [Rd] PS driver crashes when no permissions (PR#8078)
Message-ID: <20050819074746.ABB4110470@slim.kubism.ku.dk>

This is already fixed in 2.1.1 patched: please see the resources the 
posting guide and FAQ ask you to consult _before_ sending a bug report!

     o	File creation errors in pdf(), postscript(), xfig() resulted
 	in a pointer being freed twice.	 (Reported by Matt McCall)

As the FAQ says

   If a bug has already been reported or fixed, please do not submit
   further bug reports on it.


On Fri, 19 Aug 2005 jussi.jousimo at ktl.fi wrote:

> Full_Name: Jussi Jousimo
> Version: 2.1.1
> OS: Linux
> Submission from: (NULL) (193.167.195.60)
>
>
> R 2.1.1 crashes when it is trying to write a file with the postscript driver to
> a directory, where the user has no permission to write. For example,
> postscript("foo.ps") gives an error message: *** glibc detected *** free():
> invalid pointer: 0x08a469b0 ***. The problem is at the PSDeviceDriver function
> in the devPS.c file on line 2357 (free(dd);), where the same memory block is
> tried to free the first time and then the second time at line 5138 (free(dev);).
> I'd suggest to remove the first free function.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From gavin.simpson at ucl.ac.uk  Thu Aug 18 15:22:59 2005
From: gavin.simpson at ucl.ac.uk (Gavin Simpson)
Date: Thu, 18 Aug 2005 14:22:59 +0100
Subject: [Rd] problem using model.frame()
In-Reply-To: <971536df050818060014beeb3@mail.gmail.com>
References: <1124205318.8689.45.camel@gsimpson.geog.ucl.ac.uk>
	<971536df05081608254fe12843@mail.gmail.com>
	<1124206769.8689.65.camel@gsimpson.geog.ucl.ac.uk>
	<971536df050816093559c40389@mail.gmail.com>
	<1124214263.8689.108.camel@gsimpson.geog.ucl.ac.uk>
	<17155.32972.298699.821499@stat.math.ethz.ch>
	<1124318966.2718.38.camel@dsl-217-155-166-107.zen.co.uk>
	<b1afcc8ead241983653e8f8800c05566@oulu.fi>
	<1124350014.2753.40.camel@dsl-217-155-166-107.zen.co.uk>
	<971536df050818060014beeb3@mail.gmail.com>
Message-ID: <1124371379.21043.46.camel@gsimpson.geog.ucl.ac.uk>

On Thu, 2005-08-18 at 09:00 -0400, Gabor Grothendieck wrote:
> I think this one is a hard call.  Designing software is a
> series of tradeoffs. Its nice to maintain consistency with
> the R base, but in case of extensions (rather than changing
> behavior) as in this case, the argument against the change
> carries less weight.
> 
> The main problems with extensions are (1) that one has to
> remember which functions/packages have which extensions if
> one is to use them and (2) they can interfere with other
> future extensions.
> 
> On the other hand, if one is using a particular package a
> lot then convenience features like this may be attractive.
> Also, packages are where authors have the freedom to try out 
> new ideas and new functionality without being constrained.
> 
> Perhaps, if the extension in question is added there could be 
> a warning in the help file that this is a convenience feature 
> of this particular package and is not generally available 
> throughout R.

Thanks again Gabor for another useful contribution to this debate. Also
thanks to Martin, Gabor and Jari for their comments, ideas, suggestions
and viewpoints.

I still like y1 ~ y2 (both data frames), but during my bike ride to work
this morning I considered both sides of the argument and my position has
moved towards the R way of doing things - far be it for little old me to
go against years of S-formula tradition. So I'll revert the code back to
accepting y1 ~ ., data = y2 and leave it to throw an error for the rhs
being a data frame case.

Once again, thank you for helping me work through this dilemma.

All the best,

Gav

> On 8/18/05, Gavin Simpson <gavin.simpson at ucl.ac.uk> wrote:
> > On Thu, 2005-08-18 at 07:57 +0300, Jari Oksanen wrote:
> > > On 18 Aug 2005, at 1:49, Gavin Simpson wrote:
> > >
> > > > On Wed, 2005-08-17 at 20:24 +0200, Martin Maechler wrote:
> > > >>>>>>> "GS" == Gavin Simpson <gavin.simpson at ucl.ac.uk>
> > > >>>>>>>     on Tue, 16 Aug 2005 18:44:23 +0100 writes:
> > > >>
> > > >>     GS> On Tue, 2005-08-16 at 12:35 -0400, Gabor Grothendieck
> > > >>     GS> wrote:
> > > >>>> On 8/16/05, Gavin Simpson <gavin.simpson at ucl.ac.uk>
> > > >>>> wrote: > On Tue, 2005-08-16 at 11:25 -0400, Gabor
> > > >>>> Grothendieck wrote: > > It can handle data frames like
> > > >>>> this:
> > > >>>>>>
> > > >>>>>> model.frame(y1) > > or > > model.frame(~., y1)
> > > >>>>>
> > > >>>>> Thanks Gabor,
> > > >>>>>
> > > >>>>> Yes, I know that works, but I want the function
> > > >>>> coca.formula to accept a > formula like this y2 ~ y1,
> > > >>>> with both y1 and y2 being data frames. It is
> > > >>>>
> > > >>>> The expressions I gave work generally (i.e. lm, glm,
> > > >>>> ...), not just in model.matrix, so would it be ok if the
> > > >>>> user just does this?
> > > >>>>
> > > >>>> yourfunction(y2 ~., y1)
> > > >>
> > > >>     GS> Thanks again Gabor for your comments,
> > > >>
> > > >>     GS> I'd prefer the y1 ~ y2 as data frames - as this is the
> > > >>     GS> most natural way of doing things. I'd like to have (y2
> > > >>     GS> ~., y1) as well, and (y2 ~ spp1 + spp2 + spp3, y1) also
> > > >>     GS> work - silently without any trouble.
> > > >>
> > > >> I'm sorry, Gavin, I tend to disagree quite a bit.
> > > >>
> > > >> The formula notation has quite a history in the S language, and
> > > >> AFAIK never was the idea to use data.frames as formula
> > > >> components, but rather as "environments" in which formula
> > > >> components are looked up --- exactly as Gabor has explained.
> > > >
> > > > Hi Martin, thanks for your comments,
> > > >
> > > > But then one could have a matrix of variables on the rhs of the formula
> > > > and it would work - whether this is a documented feature or un-intended
> > > > side-effect of matrices being stored as vectors with dims, I don't
> > > > know.
> > > >
> > > > And whilst the formula may have a long history, a number of packages
> > > > have extended the interface to implement a specific feature, which
> > > > don't
> > > > work with standard functions like lm, glm and friends. I don't see how
> > > > what I wanted to achieve is greatly different to that or using a
> > > > matrix.
> > > >
> > > >> To break with such a deeply rooted principle,
> > > >> you should have very very good reasons, because you're breaking
> > > >> the concepts on which all other uses of formulae are based.
> > > >> And this would potentially lead to much confusion of your users,
> > > >> at least in the way they should learn to think about what
> > > >> formulae mean.
> > > >
> > > > In the end I managed to treat y1 ~ y2 (both data frames) as a special
> > > > case, which allows the existing formula notation to work as well, so I
> > > > can use y1 ~ y2, y1 ~ ., data = y2, or y1 ~ var + var2, data = y2. This
> > > > is what I wanted all along, to extend my interface (not do anything to
> > > > R's formulae), but to also work in the traditional sense.
> > > >
> > > > The model I am writing code for really is modelling the relationship
> > > > between two matrices of data. In one version of the method, there is
> > > > real equivalence between both sides of the formula so it would seem odd
> > > > to treat the two sides of the formula differently. At least to me ;-)
> > >
> > > It seems that I may be responsible for one of these extensions (lhs as
> > > a data.frame in cca and rda in vegan package). There the response (lhs)
> > > is multivariate or a multispecies community, and you must take that as
> > > a whole without manipulation (and if you tried using VGAM you see there
> > > really is painful to define lhs with, say, 127 elements).
> > 
> > Hi Jari,
> > 
> > Thanks for reminding me about this - I'd forgotten about not normally
> > being able to have a data.frame on the lhs of the formula either - I'm
> > surprised no-one pulled me up on that one before, either ;-)
> > 
> > I guess what I'm proposing is really pushing the formula representation
> > too far for some people. I'm coming round to the y1 ~ ., data = y2 way
> > of doing things - still prefer y1 ~ y2 though ;-)
> > 
> > Also, both y1 and y2 are community matrices (i.e. both have many, many
> > species, aka variables for the non-community ecologists reading this).
> > I'm not sure that it makes sense to treat the two sides differently. In
> > the predictive co-correspondence mode (the default), multivariate pls is
> > used to regress one matrix on another, with the number of pls components
> > being chosen by cross-validation or a permutation test.
> > 
> > > However, in
> > > general you shouldn't use models where you use all the 'explanatory'
> > > variables (rhs) that yo happen to have by accident. So much bad science
> > > has been created with that approach even in your field, Gav.
> > 
> > Well, I agree with you there...
> > 
> > > The whole
> > > idea of formula is the ability to choose from candidate variables. That
> > > is: to build a model. Therefore you have one-sided formulae in prcomp()
> > > and princomp(): you can say prcomp(~ x1 + log(x2) +x4, data) or
> > > prcomp(~ . - x3, data). I think you should try to keep it so. Do
> > > instead like Gabor suggested: you could have a function coca.default or
> > > coca.matrix with interface:
> > >
> > > coca.matrix(matx, maty, matz) -- or you can name this as coca.default.
> > >
> > > and coca.formula which essentially parses your formula and returns a
> > > list of matrices you need:
> > >
> > > coca.formula <- function(formula, data)
> > > {
> > >       matricesout <- parsemyformula(formula, data)
> > >      coca(matricesout$matx, matricesout$maty, matricesoutz)
> > > }
> > > Then you need the generic: coca <- function(...) UseMethod("coca") and
> > > it's done (but fails in R CMD check unless you add "..." in all
> > > specific functions...). The real work is always done in coca.matrix (or
> > > coca.default), and the others just chew your data into suitable form
> > > for your workhorse.
> > >
> > > If then somebody thinks that they need all possible variables as
> > > 'explanatory' variables (or perhaps constraints in your case), they
> > > just call the function as
> > >
> > > coca(matx, maty, matz)
> > 
> > My functions are already generic with coca.default and coca.formula. The
> > issue with matrices/data.frames was only a problem in the formula
> > interface.
> > 
> > > And if you have coca.data.frame they don't need 'quacking' with extra
> > > steps:
> > >
> > > coca.data.frame <- function(dfx, dfy dfz) coca(as.matrix(dfx),
> > > as.matrix(dfy), as.matrix(dfz)).
> > >
> > > This you call as coca(dfx, dfy, dfz) and there you go.
> > >
> > > The essential feature in formula is the ability to define the model.
> > > Don't give it away.
> > 
> > I think the point I'm trying to make is that I don't think what I'm
> > trying to do is any different than doing lm(y ~ x, data), (where y, x
> > are vectors) - it is just that my x and y happen to be multivariate. I
> > think it is easier to think of each community as a single entity in this
> > regard - the relationship *is* between community 1 and community 2, not
> > parts of community 2, or some parsimonious model of community 2 - but
> > that might just be semantics - unlike your cca/rda functions which
> > really are a (weighted) multivariate multiple regression. Happy to be
> > convinced otherwise though.
> > 
> > Also, it is worth re-iterating that I haven't broken the traditional way
> > of working with formulae with my function - you can still do y1 ~ .,
> > data = y2, or y1 ~ spp1 + spp2 + spp3, data = y2, for maximum
> > flexibility. All I wanted (and worked out how) to do was treat the rhs
> > in a special way if it were a data frame, just like Jari treats a
> > data.frame on the lhs of formulae in package vegan as a special case.
> > 
> > Thanks everyone for your ideas and comments - lots of food for thought.
> > I wavering between both camps on this - still time to be convinced and
> > change it before I finish the package.
> > 
> > All the best,
> > 
> > G
> > 
> > >
> > > cheers, jazza
> > > --
> > > Jari Oksanen, Oulu, Finland
> > >
> > --
> > %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
> > Gavin Simpson                     [T] +44 (0)20 7679 5522
> > ENSIS Research Fellow             [F] +44 (0)20 7679 7565
> > ENSIS Ltd. & ECRC                 [E] gavin.simpsonATNOSPAMucl.ac.uk
> > UCL Department of Geography       [W] http://www.ucl.ac.uk/~ucfagls/cv/
> > 26 Bedford Way                    [W] http://www.ucl.ac.uk/~ucfagls/
> > London.  WC1H 0AP.
> > %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
> > 
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >
-- 
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
Gavin Simpson                     [T] +44 (0)20 7679 5522
ENSIS Research Fellow             [F] +44 (0)20 7679 7565
ENSIS Ltd. & ECRC                 [E] gavin.simpsonATNOSPAMucl.ac.uk
UCL Department of Geography       [W] http://www.ucl.ac.uk/~ucfagls/cv/
26 Bedford Way                    [W] http://www.ucl.ac.uk/~ucfagls/
London.  WC1H 0AP.
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%


From haydin at karaelmas.edu.tr  Fri Aug 19 13:16:46 2005
From: haydin at karaelmas.edu.tr (haydin@karaelmas.edu.tr)
Date: Fri, 19 Aug 2005 13:16:46 +0200 (CEST)
Subject: [Rd] SciViews-R v8.7 and Rcmdr v1.0-2 (PR#8079)
Message-ID: <20050819111646.2846C19057@slim.kubism.ku.dk>

Full_Name: Hamit AYDIN
Version: R v2.1.1
OS: winxp
Submission from: (NULL) (194.27.40.230)


When I try to run sciviews the consol opens but when I try to import text,
spss... it tries to load rmcdr pakage gives me "the pakage can not be find inthe
Package or bundle 'Rcmdr' was not found in C:\PROGRA~1\R\rw2011\library.  Would
you like to install it now?" I know the pakage in ther and it runs in R.


Sciview consol
Loading required package: datasets
Loading required package: utils
Loading required package: grDevices
Loading required package: graphics
Loading required package: stats
Loading required package: methods
Loading required package: tcltk
Loading Tcl/Tk interface ... done
Loading required package: R2HTML
Loading required package: svMisc
Loading required package: svIO
Loading required package: svViews
Loading required package: Rcmdr
Loading required package: rgl
Loading required package: zoo
Loading required package: strucchange
Loading required package: sandwich
Loading required package: relimp
Loading required package: nnet
Loading required package: nlme
Loading required package: mvtnorm
Loading required package: multcomp
Loading required package: mgcv
This is mgcv 1.3-5 
Loading required package: MASS
Loading required package: lmtest
Loading required package: lattice
Loading required package: grid
Loading required package: foreign
Loading required package: effects
Loading required package: car
Loading required package: abind
Error in get(x, envir, mode, inherits) : variable "version" was not found
Error: .onAttach failed in 'attachNamespace'
Warning in Require(Rcmdr) : Missing package or bundle 'Rcmdr' was neither
installed nor loaded
Error in get(x, envir, mode, inherits) : variable "crisp.dialogs" was not found
?


From pburns at pburns.seanet.com  Fri Aug 19 14:08:49 2005
From: pburns at pburns.seanet.com (Patrick Burns)
Date: Fri, 19 Aug 2005 13:08:49 +0100
Subject: [Rd] minor typo in Writing R Extensions
Message-ID: <4305CBD1.7090400@pburns.seanet.com>

On page 10 (section 1.1.4) of Writing R Extensions
version 2.1.1 the following two phrases appear:

define these function in a file

after the packages is

The 's' from 'functions' fell down the page and attached
itself to 'package'.

Patrick Burns
patrick at burns-stat.com
+44 (0)20 8525 0696
http://www.burns-stat.com
(home of S Poetry and "A Guide for the Unwilling S User")


From phgrosjean at sciviews.org  Fri Aug 19 19:22:07 2005
From: phgrosjean at sciviews.org (Philippe Grosjean)
Date: Fri, 19 Aug 2005 19:22:07 +0200
Subject: [Rd] SciViews-R v8.7 and Rcmdr v1.0-2 (PR#8079)
In-Reply-To: <20050819111646.2846C19057@slim.kubism.ku.dk>
References: <20050819111646.2846C19057@slim.kubism.ku.dk>
Message-ID: <4306153F.8040405@sciviews.org>

Hello,

I am currently finishing version 0.8-8 of SciViews, which correct these 
bug and is now completely compatible with R 2.1.1 and Rcmdr 1.1-1.
This new version will be available within one week at 
http://www.sciviews.org/SciViews-R
Best,

Philippe Grosjean

..............................................<?}))><........
  ) ) ) ) )
( ( ( ( (    Prof. Philippe Grosjean
  ) ) ) ) )
( ( ( ( (    Numerical Ecology of Aquatic Systems
  ) ) ) ) )   Mons-Hainaut University, Pentagone (3D08)
( ( ( ( (    Academie Universitaire Wallonie-Bruxelles
  ) ) ) ) )   8, av du Champ de Mars, 7000 Mons, Belgium
( ( ( ( (
  ) ) ) ) )   phone: + 32.65.37.34.97, fax: + 32.65.37.30.54
( ( ( ( (    email: Philippe.Grosjean at umh.ac.be
  ) ) ) ) )
( ( ( ( (    web:   http://www.umh.ac.be/~econum
  ) ) ) ) )          http://www.sciviews.org
( ( ( ( (
..............................................................

haydin at karaelmas.edu.tr wrote:
> Full_Name: Hamit AYDIN
> Version: R v2.1.1
> OS: winxp
> Submission from: (NULL) (194.27.40.230)
> 
> 
> When I try to run sciviews the consol opens but when I try to import text,
> spss... it tries to load rmcdr pakage gives me "the pakage can not be find inthe
> Package or bundle 'Rcmdr' was not found in C:\PROGRA~1\R\rw2011\library.  Would
> you like to install it now?" I know the pakage in ther and it runs in R.
> 
> 
> Sciview consol
> Loading required package: datasets
> Loading required package: utils
> Loading required package: grDevices
> Loading required package: graphics
> Loading required package: stats
> Loading required package: methods
> Loading required package: tcltk
> Loading Tcl/Tk interface ... done
> Loading required package: R2HTML
> Loading required package: svMisc
> Loading required package: svIO
> Loading required package: svViews
> Loading required package: Rcmdr
> Loading required package: rgl
> Loading required package: zoo
> Loading required package: strucchange
> Loading required package: sandwich
> Loading required package: relimp
> Loading required package: nnet
> Loading required package: nlme
> Loading required package: mvtnorm
> Loading required package: multcomp
> Loading required package: mgcv
> This is mgcv 1.3-5 
> Loading required package: MASS
> Loading required package: lmtest
> Loading required package: lattice
> Loading required package: grid
> Loading required package: foreign
> Loading required package: effects
> Loading required package: car
> Loading required package: abind
> Error in get(x, envir, mode, inherits) : variable "version" was not found
> Error: .onAttach failed in 'attachNamespace'
> Warning in Require(Rcmdr) : Missing package or bundle 'Rcmdr' was neither
> installed nor loaded
> Error in get(x, envir, mode, inherits) : variable "crisp.dialogs" was not found
> ?
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
>


From colin at colinsmith.org  Sat Aug 20 08:38:42 2005
From: colin at colinsmith.org (Colin A. Smith)
Date: Fri, 19 Aug 2005 23:38:42 -0700
Subject: [Rd] Implementing a single-precision class with raw
Message-ID: <c06c608685a92cf22b59f0420a179ccc@colinsmith.org>

A package that I develop (xcms) sometimes needs to read and process 
vectors several hundreds of megabytes in size. (They only represent 
parts of a large data sets which can approach nearly 100GB.) 
Unfortunately, R sometimes hits the 2GB memory limit of Win32. To help 
cut the memory footprint in half, I'm implementing a "float" class as a 
subclass of "raw". Because almost all the computation on the large 
vectors is done in C code, having a somewhat limited single-precision 
data type is okay.

I've run into a limitation with the .C() function where it does not 
handle raw vectors, which it will do in 2.2.0. In the meantime, I'm 
using the .Call() function to access the raw vectors. However, there 
don't seem to be any macros for handling raw vectors in Rdefines.h. 
I've made a guess at what those macros would be and was wondering 
whether my guesses were correct and/or might be included in 2.2.0:

#define NEW_RAW(n) allocVector(RAWSXP,n)
#define RAW_POINTER(x) (RAW(x))
#define AS_RAW(x) coerceVector(x,RAWSXP)

I'm not sure whether coerceVector(x,RAWSXP) will actually work. Also, 
there isn't an Rf_isRaw() function, which would be useful for an 
IS_RAW(x) macro.

Another issue with the "float" class is that it will run into endian 
issues if it ever gets saved to disk and moved cross-platform. I don't 
really anticipate that happening but it might be nice to incorporate 
serialization hooks if possible. Are there any facilities in R for 
doing that?

Thanks for any feedback or suggestions.

-Colin

http://abagyan.scripps.edu/~csmith/float.R
http://abagyan.scripps.edu/~csmith/float.c



From gb at stat.umu.se  Sat Aug 20 13:54:20 2005
From: gb at stat.umu.se (=?iso-8859-1?Q?G=F6ran_Brostr=F6m?=)
Date: Sat, 20 Aug 2005 13:54:20 +0200
Subject: [Rd] Different gcc versions
Message-ID: <20050820115420.GA3706@stat.umu.se>

I have both gcc-3.4 and gcc-4.0(.1) installed on my system 
(debian-amd64 unstable), with links /usr/bin/gcc, g77, etc. to
the 3.4 versions. When I build R, the 3.4 version is picked up, 
which is fine.

However, when I 'install.packages("xyz")', R uses gcc-4.0 and
gfortran-4.0! Should I accept this or do something about it?
And if so, what? Of course, removing all 4.0 versions would 
help, but what if I don't want to do that?

 > version
         _
platform x86_64-unknown-linux-gnu
arch     x86_64
os       linux-gnu
system   x86_64, linux-gnu
status
major    2
minor    1.1
year     2005
month    06
day      20
language R
 
-- 
G?ran Brostr?m                    tel: +46 90 786 5223
Department of Statistics          fax: +46 90 786 6614
Ume? University                   http://www.stat.umu.se/~goran.brostrom/
SE-90187 Ume?, Sweden             e-mail: gb at stat.umu.se


From sfalcon at fhcrc.org  Sat Aug 20 16:07:54 2005
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Sat, 20 Aug 2005 07:07:54 -0700
Subject: [Rd] Questions on "\" vs "/" on Windows
Message-ID: <m2hddkhfb9.fsf@fhcrc.org>

A recent thread on R-help reminded me of some questions I have
regarding the path separator on Windows.

The thread: [R] using paste and "\" to create a valid filename

The question:

What are the use-cases where "\" is required for paths passed as
character vectors from within R?

My experience has been that "/" always works and "\" often fails due
to escaping issues (the user's fault).  A pathalogical example
that I _have_ encountered due to temp file naming on Windows:

  > badpath <- "foo\\2\\bar"
  > root <- "c:\\HERE\\file.txt"
  > gsub("HERE", badpath, root)
  Error in gsub("HERE", badpath, root) : invalid backreference 2 in regular expression

Using file.path is recommended as a best practice, but AFAICT, it
forces "\" on Windows.  

Why not have file.path dynamically read .Platform$file.sep
so that in code that uses file.path one could modify
.Platform$file.sep and change the behavior of all subsequent file.path
calls?

Python's os.path.join function behaves similarly to R's: changing
os.sep doesn't change the behavior of os.path.join.  
.Platform$file.sep = "/" and change the behavior of all subsequent
calls.

With both languages, I've found that for glue-code type tasks,
sticking to "/" on Windows is much easier and I've been frustrated by
the built-in path handling function.

+ seth


From edd at debian.org  Sat Aug 20 16:09:21 2005
From: edd at debian.org (Dirk Eddelbuettel)
Date: Sat, 20 Aug 2005 09:09:21 -0500
Subject: [Rd] Different gcc versions
In-Reply-To: <20050820115420.GA3706@stat.umu.se>
References: <20050820115420.GA3706@stat.umu.se>
Message-ID: <17159.14737.562207.948435@basebud.nulle.part>


G?ran,

On 20 August 2005 at 13:54, G?ran Brostr?m wrote:
| I have both gcc-3.4 and gcc-4.0(.1) installed on my system 
| (debian-amd64 unstable), with links /usr/bin/gcc, g77, etc. to
| the 3.4 versions. When I build R, the 3.4 version is picked up, 
| which is fine.
| 
| However, when I 'install.packages("xyz")', R uses gcc-4.0 and
| gfortran-4.0! Should I accept this or do something about it?
| And if so, what? Of course, removing all 4.0 versions would 
| help, but what if I don't want to do that?

There are several way about it. 

The first would be to actually use one of Debian's packages -- unstable
currently uses gcc 4.0.1 / g77 3.4.*. That seems to work well. You'd get the
same released version for amd64 as well. I'd do that.

The second would be to continue building on your own, but to make sure the
generated Makeconf (which the Debian package copies into /etc/R/) has the
right settings.

Hope this helps, Dirk

-- 
Statistics: The (futile) attempt to offer certainty about uncertainty.
         -- Roger Koenker, 'Dictionary of Received Ideas of Statistics'


From ggrothendieck at gmail.com  Sat Aug 20 16:13:35 2005
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sat, 20 Aug 2005 10:13:35 -0400
Subject: [Rd] Questions on "\" vs "/" on Windows
In-Reply-To: <m2hddkhfb9.fsf@fhcrc.org>
References: <m2hddkhfb9.fsf@fhcrc.org>
Message-ID: <971536df0508200713608b075b@mail.gmail.com>

On 8/20/05, Seth Falcon <sfalcon at fhcrc.org> wrote:
> A recent thread on R-help reminded me of some questions I have
> regarding the path separator on Windows.
> 
> The thread: [R] using paste and "\" to create a valid filename
> 
> The question:
> 
> What are the use-cases where "\" is required for paths passed as
> character vectors from within R?

I think Windows itself allows / but some programs require \.

> 
> My experience has been that "/" always works and "\" often fails due
> to escaping issues (the user's fault).  A pathalogical example
> that I _have_ encountered due to temp file naming on Windows:
> 
>  > badpath <- "foo\\2\\bar"
>  > root <- "c:\\HERE\\file.txt"
>  > gsub("HERE", badpath, root)
>  Error in gsub("HERE", badpath, root) : invalid backreference 2 in regular expression
> 
> Using file.path is recommended as a best practice, but AFAICT, it
> forces "\" on Windows.

Actually it uses /. On my Windows XP system:

> file.path("a", "b")
[1] "a/b"
> R.version.string
[1] "R version 2.1.1, 2005-06-23"
 

> 
> Why not have file.path dynamically read .Platform$file.sep
> so that in code that uses file.path one could modify
> .Platform$file.sep and change the behavior of all subsequent file.path
> calls?
> 
> Python's os.path.join function behaves similarly to R's: changing
> os.sep doesn't change the behavior of os.path.join.
> .Platform$file.sep = "/" and change the behavior of all subsequent
> calls.
> 
> With both languages, I've found that for glue-code type tasks,
> sticking to "/" on Windows is much easier and I've been frustrated by
> the built-in path handling function.
> 
> + seth


From ripley at stats.ox.ac.uk  Sat Aug 20 16:54:45 2005
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sat, 20 Aug 2005 15:54:45 +0100 (BST)
Subject: [Rd] Questions on "\" vs "/" on Windows
In-Reply-To: <m2hddkhfb9.fsf@fhcrc.org>
References: <m2hddkhfb9.fsf@fhcrc.org>
Message-ID: <Pine.LNX.4.61.0508201537520.5575@gannet.stats>

On Sat, 20 Aug 2005, Seth Falcon wrote:

> A recent thread on R-help reminded me of some questions I have
> regarding the path separator on Windows.
>
> The thread: [R] using paste and "\" to create a valid filename
>
> The question:
>
> What are the use-cases where "\" is required for paths passed as
> character vectors from within R?

1) A few Windows utilities require \, so we try to always use \ in paths 
exported e.g. when using system()/shell().  No Windows API call does, it 
appears.

Uwe Ligges reported that on his system Mozilla 1.7.3 did in file:// URLs, 
(although it did not on mine) so we altered the HTML help print method

2) Some Windows users file bug reports when they see / in a path.  So to 
keep them happy (or at least out of our hair) we tend to use \ in 
messages, and in normalizePath().

> My experience has been that "/" always works and "\" often fails due
> to escaping issues (the user's fault).  A pathalogical example
> that I _have_ encountered due to temp file naming on Windows:
>
>  > badpath <- "foo\\2\\bar"
>  > root <- "c:\\HERE\\file.txt"
>  > gsub("HERE", badpath, root)
>  Error in gsub("HERE", badpath, root) : invalid backreference 2 in regular expression
>
> Using file.path is recommended as a best practice, but AFAICT, it
> forces "\" on Windows.

Wrong (how did you 'T'?).  On Windows:

> file.path("foo", "bar")
[1] "foo/bar"

> Why not have file.path dynamically read .Platform$file.sep
> so that in code that uses file.path one could modify
> .Platform$file.sep and change the behavior of all subsequent file.path
> calls?

It _does_ dynamically read .Platform$file.sep, and it has an fsep argument 
so you can do

file.path("foo", "bar", fsep="\\")

Beware though of namespaces: you would need to change .Platform$file.sep 
in the base namespace (which you can do):

> .Platform$file.sep <- ":"
> assignInNamespace(".Platform", .Platform, "base")
> file.path("foo", "bar")
[1] "foo:bar"

> Python's os.path.join function behaves similarly to R's: changing
> os.sep doesn't change the behavior of os.path.join.
> .Platform$file.sep = "/" and change the behavior of all subsequent
> calls.
>
> With both languages, I've found that for glue-code type tasks,
> sticking to "/" on Windows is much easier and I've been frustrated by
> the built-in path handling function.

Why, as R's uses "/"?  I wonder if you did consult the help pages before 
posting ....

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From sfalcon at fhcrc.org  Sat Aug 20 17:51:11 2005
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Sat, 20 Aug 2005 08:51:11 -0700
Subject: [Rd] Questions on "\" vs "/" on Windows
In-Reply-To: <Pine.LNX.4.61.0508201537520.5575@gannet.stats> (Brian Ripley's
	message of "Sat, 20 Aug 2005 15:54:45 +0100 (BST)")
References: <m2hddkhfb9.fsf@fhcrc.org>
	<Pine.LNX.4.61.0508201537520.5575@gannet.stats>
Message-ID: <m27jeghaj4.fsf@fhcrc.org>

On 20 Aug 2005, ripley at stats.ox.ac.uk wrote:
> It _does_ dynamically read .Platform$file.sep, and it has an fsep
> argument so you can do
>
> file.path("foo", "bar", fsep="\\")
>
> Beware though of namespaces: you would need to change
> .Platform$file.sep in the base namespace (which you can do):
>
>> .Platform$file.sep <- ":"
>> assignInNamespace(".Platform", .Platform, "base")
>> file.path("foo", "bar")
> [1] "foo:bar"

That's the piece I was missing, thanks.

Clearly I misremembered other details as well.  Thanks for the
reminders.

+ seth


From murdoch at stats.uwo.ca  Sun Aug 21 03:35:32 2005
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Sat, 20 Aug 2005 21:35:32 -0400
Subject: [Rd] missing sh.exe file when running "R CMD INSTALL test"
	(PR#8068)
In-Reply-To: <20050816091028.9F886183A2@slim.kubism.ku.dk>
References: <20050816091028.9F886183A2@slim.kubism.ku.dk>
Message-ID: <4307DA64.6010204@stats.uwo.ca>

u9126801 at stat.nctu.edu.tw wrote:
> I am trying to learn how to make a simple package that contains no C
> or Fortran code.  I used package.skeleton(...) to make a package
> called "test".  The directory and files look good.  I downloaded and
> installed Rtools (www.murdoch-sutherland.com/Rtools/tools.zip).  I
> added the path and from the dos prompt I can verify that make.exe and
> sh.exe both exist, but when I try to run "R CMD INSTALL test" I get an
> error "make: sh.exe: Command not found"  and "make: *** [pkg-test]
> Error 127".  I get the same error message if a try the command "make
> pkg-test".

You need to make sure the tools directory (wherever you put it) is on 
your path.  Type PATH at a command prompt to see the current path; type

PATH= blah blah blah

to set a new one.  See the R Admin manual for advice on what to put  in it.

Duncan Murdoch
> 
> I saw in an old FAQ a suggestion to move sh.eve to the C:\bin\ folder,
> but my C: root does not have a "bin" folder.  Nonetheless, I created
> one and put sh.exe there and it provided no help (I didn't expect it
> too).
> 
> Can anyone help me?
> 
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From nigel.sim at jcu.edu.au  Sun Aug 21 14:46:22 2005
From: nigel.sim at jcu.edu.au (Nigel Sim)
Date: Sun, 21 Aug 2005 22:46:22 +1000
Subject: [Rd] IPC
Message-ID: <1124628383.20671.49.camel@schrodinger>

Hi, I need to somehow make R communicate with another remote JAVA
process which provides compute services. I have control over the
communications protocol, but I would like to keep it to a standardised
protocol, such as SOAP, CORBA, etc. 

What I would like to know is, what do other people use to do this? The
nature of the communications will be low bandwidth procedure calls, with
little data. (The data is stored in a DBMS). To date I have tried the
RCORBA and SSOAP packages. Corba I couldn't get to compile, and soap I
couldn't get to talk properly to soapanywhere (the embedded soap
implementation I am trialing). 

I'm sure with persistence I can get both working, but I would like to
hear others experiences before I invest the time.

Thank you for your time.
-- 
Nigel Sim

PhD Candidate
School of Mathematics and Physical Sciences
James Cook University
+61 7 4781 4247
+61 409 277 641


From sean.oriordain at gmail.com  Sun Aug 21 15:11:56 2005
From: sean.oriordain at gmail.com (Sean O'Riordain)
Date: Sun, 21 Aug 2005 14:11:56 +0100
Subject: [Rd] IPC
In-Reply-To: <1124628383.20671.49.camel@schrodinger>
References: <1124628383.20671.49.camel@schrodinger>
Message-ID: <8ed68eed05082106117545e667@mail.gmail.com>

for very low bandwidth IPC I'd just use a standard web page form using
a GET... so all you have to do is call a URL with the parameters
embedded in the URL, e.g.

http://silly.name.for.server.com/javaServlet?a=42&b=394&c=1982&d=complex

If your bandwidth requirements are a bit higher then you have to start
using POST which is a bit more complicated though... so at that stage
I might use SOAP.

cheers!
Sean

On 21/08/05, Nigel Sim <nigel.sim at jcu.edu.au> wrote:
> Hi, I need to somehow make R communicate with another remote JAVA
> process which provides compute services. I have control over the
> communications protocol, but I would like to keep it to a standardised
> protocol, such as SOAP, CORBA, etc.
> 
> What I would like to know is, what do other people use to do this? The
> nature of the communications will be low bandwidth procedure calls, with
> little data. (The data is stored in a DBMS). To date I have tried the
> RCORBA and SSOAP packages. Corba I couldn't get to compile, and soap I
> couldn't get to talk properly to soapanywhere (the embedded soap
> implementation I am trialing).
> 
> I'm sure with persistence I can get both working, but I would like to
> hear others experiences before I invest the time.
> 
> Thank you for your time.
> --
> Nigel Sim
> 
> PhD Candidate
> School of Mathematics and Physical Sciences
> James Cook University
> +61 7 4781 4247
> +61 409 277 641
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From sean.oriordain at gmail.com  Sun Aug 21 18:46:49 2005
From: sean.oriordain at gmail.com (Sean O'Riordain)
Date: Sun, 21 Aug 2005 17:46:49 +0100
Subject: [Rd] IPC
In-Reply-To: <20050821154001.GC21511@wald.ucdavis.edu>
References: <1124628383.20671.49.camel@schrodinger>
	<8ed68eed05082106117545e667@mail.gmail.com>
	<20050821154001.GC21511@wald.ucdavis.edu>
Message-ID: <8ed68eed05082109462f63e371@mail.gmail.com>

Absolutely - only the simplest of requests with the lowest of
bandwidth requirements should use plain GET requests.

Beyond that you must use some form of detail encapsulation.  SOAP is
layer ontop of HTTP POST requests which is semi-standardized - ie how
a number is encoded is standardized, you still have to code what
parameters are going across the gap at both ends.  There is a lot of
hype about how standard SOAP is... you are still left with a lot of
work to do! :-)

Sometimes it is useful not to have too many dependancies on other
packages or outside software, ie, if you can get away with a simple
GET request in plain R, go for it, but as Duncan says, you need to
beware of character encoding.

s/

On 21/08/05, Duncan Temple Lang <duncan at wald.ucdavis.edu> wrote:
> Sean O'Riordain wrote:
> > for very low bandwidth IPC I'd just use a standard web page form using
> > a GET... so all you have to do is call a URL with the parameters
> > embedded in the URL, e.g.
> >
> > http://silly.name.for.server.com/javaServlet?a=42&b=394&c=1982&d=complex
> >
> > If your bandwidth requirements are a bit higher then you have to start
> > using POST which is a bit more complicated though... so at that stage
> > I might use SOAP.
> 
> POST is not equivalent to SOAP.  SOAP uses POST.
> 
> In order to avoid all the details dealing with HTTP requests
> such as escaping characters, SSL, passwords, POST/GET, etc., it is simplest
> to use something that already takes care of  these.
> The RCurl package (www.omegahat.org/RCurl) is in interface libcurl which takes care of
> so many of these details.  httpRequest (regular CRAN package) is implemented entirely
> within R, but doesn't handle as many of these extra details.
> 
>   D.
> 
> >
> > cheers!
> > Sean
> >
> > On 21/08/05, Nigel Sim <nigel.sim at jcu.edu.au> wrote:
> > > Hi, I need to somehow make R communicate with another remote JAVA
> > > process which provides compute services. I have control over the
> > > communications protocol, but I would like to keep it to a standardised
> > > protocol, such as SOAP, CORBA, etc.
> > >
> > > What I would like to know is, what do other people use to do this? The
> > > nature of the communications will be low bandwidth procedure calls, with
> > > little data. (The data is stored in a DBMS). To date I have tried the
> > > RCORBA and SSOAP packages. Corba I couldn't get to compile, and soap I
> > > couldn't get to talk properly to soapanywhere (the embedded soap
> > > implementation I am trialing).
> > >
> > > I'm sure with persistence I can get both working, but I would like to
> > > hear others experiences before I invest the time.
> > >
> > > Thank you for your time.
> > > --
> > > Nigel Sim
> > >
> > > PhD Candidate
> > > School of Mathematics and Physical Sciences
> > > James Cook University
> > > +61 7 4781 4247
> > > +61 409 277 641
> > >
> > > ______________________________________________
> > > R-devel at r-project.org mailing list
> > > https://stat.ethz.ch/mailman/listinfo/r-devel
> > >
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> --
> Duncan Temple Lang                duncan at wald.ucdavis.edu
> Department of Statistics          work:  (530) 752-4782
> 371 Kerr Hall                     fax:   (530) 752-7099
> One Shields Ave.
> University of California at Davis
> Davis, CA 95616, USA
> 
> 
> 
> 
> 
>


From erich.neuwirth at univie.ac.at  Sun Aug 21 18:51:20 2005
From: erich.neuwirth at univie.ac.at (Erich Neuwirth)
Date: Sun, 21 Aug 2005 18:51:20 +0200
Subject: [Rd] weigths in boxplot
In-Reply-To: <20050808192734.F0418A274@slim.kubism.ku.dk>
References: <20050808192734.F0418A274@slim.kubism.ku.dk>
Message-ID: <4308B108.7030003@univie.ac.at>

In R 2.2.0 density now can work with weighted obesrvations.
It would be nice if boxplot also would
accept a weight parameter,
then one could produce consistent density estimators and boxplots.

Could the developers consider adding this feature?

-- 
Erich Neuwirth, Didactic Center for Computer Science
University of Vienna
Visit our SunSITE at http://sunsite.univie.ac.at
Phone: +43-1-4277-39902 Fax: +43-1-4277-9399


From savicky at cs.cas.cz  Sun Aug 21 23:21:23 2005
From: savicky at cs.cas.cz (savicky@cs.cas.cz)
Date: Sun, 21 Aug 2005 23:21:23 +0200 (CEST)
Subject: [Rd] segmentation fault in R-patched-2005-08-21 (PR#8081)
Message-ID: <20050821212123.8596E18DFA@slim.kubism.ku.dk>

This report describes two similar, but different scripts causing
segmentation fault in R-2.1.1 and R-patched_2005-08-21.

The first is a script that causes segmentation fault in R-2.1.1.
Although the script runs correctly under R-patched_2005-08-12 and
R-patched_2005-08-21, there is still a reason to investigate
the bug in more detail.

The second is a slightly different script that causes segmentation fault
in R-patched_2005-08-12 and R-patched_2005-08-21 (I did not try the
intermediate versions).

Both bugs were observed under two different installations of RedHat:
1. Fedora Core release 2 (Tettnang)
   with gcc (GCC) 3.3.3 20040412 (Red Hat Linux 3.3.3-7),
2. Red Hat Linux release 9 (Shrike)
   with gcc (GCC) 3.2.2 20030222 (Red Hat Linux 3.2.2-5)

In both cases, the compilation used the default settings.
If the compilation used ./configure --with-readline=no --with-x=no
then the bugs did not appear.

I did not succeed to reproduce any of the bugs under SuSE 8.2 with
gcc (GCC) 3.3 20030226 (prerelease) (SuSE Linux).

In the installations, where the bugs occur, they are reproducible
deterministically.

More information including the discussed scripts and the data (36M),
which they require are in
  http://www.cs.cas.cz/~savicky/archive/r_segfault-0.tar.gz

Petr Savicky


From nigel.sim at jcu.edu.au  Mon Aug 22 00:31:05 2005
From: nigel.sim at jcu.edu.au (Nigel Sim)
Date: Mon, 22 Aug 2005 08:31:05 +1000
Subject: [Rd] IPC
In-Reply-To: <20050821154748.GD21511@wald.ucdavis.edu>
References: <1124628383.20671.49.camel@schrodinger>
	<20050821154748.GD21511@wald.ucdavis.edu>
Message-ID: <1124663466.16164.14.camel@schrodinger>

Firstly, thanks for all the quick replies.

> Can you let me know what went wrong with SSOAP? It would be
> good to fix this and I am about to turn my attention to it anyway.
Well, I could not get SSOAP to pass the xmlns which specifies the set of
services being requested in the place where soapanywhere expected it.
SSOAP namespaced the actual function call <ns1:fun1 xmlns:ns1="service">
while soapanywhere wanted it declared in the envelope namespace
declarations. SO, I don't really think it is a problem with the SSOAP
implementation, rather it is probably an incomplete implementation of
soap in soapanywhere.

If anyone knows of a more complete, embedded java soap implementation
please let me know. AXIS would be nice, but I've not found how to deploy
it without a tomcat style container.

> 
> As for the "RCORBA" package - what precisely are you referring to?
> I don't think there is a package named RCORBA, perhaps you mean
> RSCORBA.  If so, yes it is quite old. It can be updated
> and indeed I have a plan that I might connect it to Orbit.
> But if RSCORBA didn't compile, you might want to mention which
> CORBA implementation you were trying to use: it was setup to use 
> 3.
And yes, RSCORBA is what I was referring to, and I was trying to compile
it against orbit (a la Gnome). 

> 
> 
> 
> As for what people typically use to connect to Java.
> There is Rserve. There is RSJava.
> I think your desire to use a standard protocol is a very 
> good one. There are far too many ad hoc solutions that don't
> do have limited functionality, such as callbacks.
> On Windows, DCOM client and server  and event packages are available.
> And there are MPI or PVM packages which implement a form of IPC.
> 
> Do you absolutely need to have a middle-tier of going through
> the server to get to the DBMS?  It is often a good design,
> but if you can go straight to the DBMS, then that would be
> esier and more efficient.
The architecture is that both R and Java directly access the DB for data
storage and retrieval. R calls to Java are simply to invoke some
datamining function (from the WEKA package), and to query where
execution is up to. There is no proxying of data.

R -----> Java
\         /
_\/     |/_
   DBMS
> 
> Please let me know what went wrong with the SSOAP package.
> 
>  D.
> 
> 
> > 
> > I'm sure with persistence I can get both working, but I would like to
> > hear others experiences before I invest the time.
> > 
> > Thank you for your time.
> > -- 
> > Nigel Sim
> > 
> > PhD Candidate
> > School of Mathematics and Physical Sciences
> > James Cook University
> > +61 7 4781 4247
> > +61 409 277 641
> > 
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> 
-- 
Nigel Sim

PhD Candidate
School of Mathematics and Physical Sciences
James Cook University
+61 7 4781 4247
+61 409 277 641


From charlie at stat.umn.edu  Mon Aug 22 01:55:04 2005
From: charlie at stat.umn.edu (Charles Geyer)
Date: Sun, 21 Aug 2005 18:55:04 -0500
Subject: [Rd] bizarre signif stars in Sweave latex
In-Reply-To: <mailman.9.1124618400.6983.r-devel@r-project.org>
References: <mailman.9.1124618400.6983.r-devel@r-project.org>
Message-ID: <20050821235504.GB32730@stat.umn.edu>

OK.  I give up.  I'll ask a stupid question.
How do I get the $!#@*$ signif stars line printed by summaries
to not look extremely bizarre in the latex produced by Sweave?
For example, see p. 7 of

    http://www.stat.umn.edu/geyer/aster/library/aster/doc/tutor.pdf

I can see what the problem is.  R emits non-ascii characters (as it
is supposed to do), Sweave puts them in the tex file, and latex can't
handle them.  But I don't see the solution.

Hmmmm.  Well I just discovered a kludge

<<foo,include=FALSE,echo=FALSE>>=
Sys.setlocale(category = "LC_ALL", locale = "C")
@

at the beginning of the Rnw file.  But is that TRT (the Right Thing)?

-- 
Charles Geyer
Professor, School of Statistics
University of Minnesota
charlie at stat.umn.edu


From jfox at mcmaster.ca  Mon Aug 22 03:00:09 2005
From: jfox at mcmaster.ca (John Fox)
Date: Sun, 21 Aug 2005 21:00:09 -0400
Subject: [Rd] Internationalization questions
Message-ID: <20050822010008.NOGU1799.tomts40-srv.bellnexxia.net@JohnDesktop8300>

Dear R-devel list members:

I have two internationalization questions, related to questions that I posed
previously. These pertain to Windows (I've tried under Win XP but assume the
issue is more general) and R 2.1.1 patched and 2.2.0 devel.

(1) I've noticed that the standard Windows dialogs in R -- whether initiated
from the Rgui menus, from winDialog(), or from tcltk functions such as
tkmessageBox() -- do not have button labels translated when running in a
non-English locale. For example, when running in a French locale, the
command

  winDialog(type="yesnocancel", message=gettext("Save workspace image?",
domain="RGui"))

produces a dialog box with the message translated to "Sauver une image de la
session?", but the buttons still read "Yes", "No", and "Cancel".

Is this the intended behaviour?  Is there any way to get the button text
translated? I've implemented a partial solution that uses a substitute for
tkmessageBox(), but it is a bit awkward.

(2) I'm still looking for a reliable way to determine whether R is using
English. Currently, I have the function

English <- function() {
    env <- Sys.getenv()
    names(env) <- toupper(names(env))
    LANG <- env["LANGUAGE"]
    LC_CTYPE <- Sys.getlocale("LC_CTYPE")
    if (!is.na(LANG)) length(grep("^en", LANG, ignore.case=TRUE)) > 0
    else LC_CTYPE == "C" || length(grep("^en", LC_CTYPE, ignore.case=TRUE))
> 0
    }
    
    
(adapting and extending a suggestion by Simon Urbanek) which checks not just
the locale but also for an environment variable named LANGUAGE. Is this
sufficient?

Any help would be appreciated.

John


--------------------------------
John Fox
Department of Sociology
McMaster University
Hamilton, Ontario
Canada L8S 4M4
905-525-9140x23604
http://socserv.mcmaster.ca/jfox


From ripley at stats.ox.ac.uk  Mon Aug 22 08:42:21 2005
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 22 Aug 2005 07:42:21 +0100 (BST)
Subject: [Rd] bizarre signif stars in Sweave latex
In-Reply-To: <20050821235504.GB32730@stat.umn.edu>
References: <mailman.9.1124618400.6983.r-devel@r-project.org>
	<20050821235504.GB32730@stat.umn.edu>
Message-ID: <Pine.LNX.4.61.0508220737470.31614@gannet.stats>

What locale is this?

My guess is that this is a UTF-8 locale.  If so, you need to tell latex 
the input is in UTF-8, which you can do in the current LaTeX release
(you need 2003/12/01).  As I recall you do this by

\usepackage[utf8]{inputenc}


On Sun, 21 Aug 2005, Charles Geyer wrote:

> OK.  I give up.  I'll ask a stupid question.
> How do I get the $!#@*$ signif stars line printed by summaries
> to not look extremely bizarre in the latex produced by Sweave?
> For example, see p. 7 of
>
>    http://www.stat.umn.edu/geyer/aster/library/aster/doc/tutor.pdf
>
> I can see what the problem is.  R emits non-ascii characters (as it
> is supposed to do), Sweave puts them in the tex file, and latex can't
> handle them.  But I don't see the solution.
>
> Hmmmm.  Well I just discovered a kludge
>
> <<foo,include=FALSE,echo=FALSE>>=
> Sys.setlocale(category = "LC_ALL", locale = "C")
> @
>
> at the beginning of the Rnw file.  But is that TRT (the Right Thing)?
>
> -- 
> Charles Geyer
> Professor, School of Statistics
> University of Minnesota
> charlie at stat.umn.edu
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Mon Aug 22 08:47:13 2005
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 22 Aug 2005 07:47:13 +0100 (BST)
Subject: [Rd] Internationalization questions
In-Reply-To: <20050822010008.NOGU1799.tomts40-srv.bellnexxia.net@JohnDesktop8300>
References: <20050822010008.NOGU1799.tomts40-srv.bellnexxia.net@JohnDesktop8300>
Message-ID: <Pine.LNX.4.61.0508220729430.31504@gannet.stats>

On Sun, 21 Aug 2005, John Fox wrote:

> Dear R-devel list members:
>
> I have two internationalization questions, related to questions that I posed
> previously. These pertain to Windows (I've tried under Win XP but assume the
> issue is more general) and R 2.1.1 patched and 2.2.0 devel.
>
> (1) I've noticed that the standard Windows dialogs in R -- whether initiated
> from the Rgui menus, from winDialog(), or from tcltk functions such as
> tkmessageBox() -- do not have button labels translated when running in a
> non-English locale. For example, when running in a French locale, the
> command
>
>  winDialog(type="yesnocancel", message=gettext("Save workspace image?",
> domain="RGui"))
>
> produces a dialog box with the message translated to "Sauver une image de la
> session?", but the buttons still read "Yes", "No", and "Cancel".
>
> Is this the intended behaviour?  Is there any way to get the button text
> translated? I've implemented a partial solution that uses a substitute for
> tkmessageBox(), but it is a bit awkward.

You need to have Windows set to be in French dialogs, not just the locale 
set to French.  This is on the second page of the Regional settings 
doalogs in WinXP.  It is intended, as it makes all Windows dialogs work 
consistently.  (You can have different settings on the three pages, but 
not all combinations work successfully -- the current rw-FAQ has some 
comments.)

> (2) I'm still looking for a reliable way to determine whether R is using
> English. Currently, I have the function
>
> English <- function() {
>    env <- Sys.getenv()
>    names(env) <- toupper(names(env))
>    LANG <- env["LANGUAGE"]
>    LC_CTYPE <- Sys.getlocale("LC_CTYPE")
>    if (!is.na(LANG)) length(grep("^en", LANG, ignore.case=TRUE)) > 0
>    else LC_CTYPE == "C" || length(grep("^en", LC_CTYPE, ignore.case=TRUE))
>> 0
>    }
>
>
> (adapting and extending a suggestion by Simon Urbanek) which checks not just
> the locale but also for an environment variable named LANGUAGE. Is this
> sufficient?

Using English for what?  (See my comments above.)   For messages, yes, it 
covers all the quirks we know about in the major OSes.

Brian

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From Erik.Jorgensen at agrsci.dk  Mon Aug 22 09:05:47 2005
From: Erik.Jorgensen at agrsci.dk (Erik.Jorgensen@agrsci.dk)
Date: Mon, 22 Aug 2005 09:05:47 +0200 (CEST)
Subject: [Rd] Example in pdf() help file (PR#8083)
Message-ID: <20050822070547.BEC6E19058@slim.kubism.ku.dk>


The example in the help file for pdf() plots the characters outside
the plotting area in this for loop:

    for(i in c(32:255)) {
         x <- i
         y <- i
         points(x, y, pch=i)
     }

The following loop seems to be working as intended

     for(i in c(32:255)) {
         x <- (i-31)%%16
         y <- (i-31)%/%16
         points(x, y, pch=i)
     }

As an extra observation, with code page ISOLatin2, the pdf-file fails to 
open in Ghostview 4.7 using ghostscript 8.51. Error message below. In 
Acrobat Reader 7.0 it opens without problems. It is quite possible that 
it is the settings on my computer that causes the error,
but I include the dump of the error message, just in case anybody was 
interested

Best regards

Erik J?rgensen
Danish Institute of Agricultural Sciences

--please do not edit the information below--

Version:
  platform = i386-pc-mingw32
  arch = i386
  os = mingw32
  system = i386, mingw32
  status =
  major = 2
  minor = 1.1
  year = 2005
  month = 06
  day = 20
  language = R

Windows XP Professional (build 2600) Service Pack 2.0

Locale:
LC_COLLATE=Danish_Denmark.1252;LC_CTYPE=Danish_Denmark.1252;LC_MONETARY=Danish_Denmark.1252;LC_NUMERIC=C;LC_TIME=Danish_Denmark.1252

Search Path:
  .GlobalEnv, package:lattice, package:methods, package:stats, 
package:graphics, package:grDevices, package:utils, package:datasets, 
Autoloads, package:base



-------------------

GSview 4.7 2005-03-26
AFPL Ghostscript 8.51 (2005-04-18)
Copyright (C) 2005 artofcode LLC, Benicia, CA.  All rights reserved.
This software comes with NO WARRANTY: see the file PUBLIC for details.
Scanning PDF file
%GSVIEW_PDF_PAGES: 1 1
Displaying PDF page 1
%GSVIEW_PDF_PAGE: 1
%GSVIEW_PDF_MEDIA: [0 0 432 432]
%GSVIEW_PDF_ROTATE: 0
Loading NimbusSanL-Regu font from c:\gs\fonts/n019003l.pfb... 2291320 
946479 1594968 288125 3 done.
Error: /typecheck in --lt--
Operand stack:
    --dict:4/4(L)--   F2   1   --dict:5/5(L)--   --dict:5/5(L)-- 
--dict:15/16(ro)(G)--   --nostringval--   --nostringval--   1 
--nostringval--   1   --nostringval--
Execution stack:
    %interp_exit   .runexec2   --nostringval--   --nostringval-- 
--nostringval--   2   %stopped_push   --nostringval--   --nostringval-- 
   false   1   %stopped_push   1   3   %oparray_pop   1   3 
%oparray_pop   1   3   %oparray_pop   1   3   %oparray_pop   .runexec2 
  --nostringval--   --nostringval--   --nostringval--   2 
%stopped_push   --nostringval--   --nostringval--   --nostringval-- 
--nostringval--   --nostringval--   %array_continue   --nostringval-- 
false   1   %stopped_push   --nostringval--   %loop_continue 
--nostringval--   --nostringval--   --nostringval--   --nostringval-- 
--nostringval--   --nostringval--   %array_continue   --nostringval--
Dictionary stack:
    --dict:1129/1686(ro)(G)--   --dict:0/20(G)--   --dict:79/200(L)-- 
--dict:105/127(ro)(G)--   --dict:251/347(ro)(G)--   --dict:21/24(L)-- 
--dict:4/6(L)--   --dict:20/20(L)--   --dict:10/13(L)--
Current allocation mode is local
pdf_page failed


From ripley at stats.ox.ac.uk  Mon Aug 22 09:47:45 2005
From: ripley at stats.ox.ac.uk (ripley@stats.ox.ac.uk)
Date: Mon, 22 Aug 2005 09:47:45 +0200 (CEST)
Subject: [Rd] Example in pdf() help file (PR#8083)
Message-ID: <20050822074745.D88BA18B91@slim.kubism.ku.dk>

  This message is in MIME format.  The first part should be readable text,
  while the remaining parts are likely unreadable without MIME-aware tools.

--27464147-1188682158-1124696849=:32369
Content-Type: TEXT/PLAIN; charset=iso-8859-1; format=flowed
Content-Transfer-Encoding: QUOTED-PRINTABLE

Please consult the help _file_!  This is correct in the file, but has been=
=20
incorrectly marked for conversion (now fixed).

On Mon, 22 Aug 2005 Erik.Jorgensen at agrsci.dk wrote:

>
> The example in the help file for pdf() plots the characters outside
> the plotting area in this for loop:
>
>    for(i in c(32:255)) {
>         x <- i
>         y <- i
>         points(x, y, pch=3Di)
>     }
>
> The following loop seems to be working as intended
>
>     for(i in c(32:255)) {
>         x <- (i-31)%%16
>         y <- (i-31)%/%16
>         points(x, y, pch=3Di)
>     }

No, i%%16 etc was intended.

> As an extra observation, with code page ISOLatin2, the pdf-file fails to
> open in Ghostview 4.7 using ghostscript 8.51. Error message below. In
> Acrobat Reader 7.0 it opens without problems. It is quite possible that
> it is the settings on my computer that causes the error,

It's nothing to do with R, but to do with how your computer is set.
BTW, I am pretty sure this is GSView 4.7, a different program.

> but I include the dump of the error message, just in case anybody was
> interested
>
> Best regards
>
> Erik J=F8rgensen
> Danish Institute of Agricultural Sciences
>
> --please do not edit the information below--
>
> Version:
>  platform =3D i386-pc-mingw32
>  arch =3D i386
>  os =3D mingw32
>  system =3D i386, mingw32
>  status =3D
>  major =3D 2
>  minor =3D 1.1
>  year =3D 2005
>  month =3D 06
>  day =3D 20
>  language =3D R
>
> Windows XP Professional (build 2600) Service Pack 2.0
>
> Locale:
> LC_COLLATE=3DDanish_Denmark.1252;LC_CTYPE=3DDanish_Denmark.1252;LC_MONETA=
RY=3DDanish_Denmark.1252;LC_NUMERIC=3DC;LC_TIME=3DDanish_Denmark.1252
>
> Search Path:
>  .GlobalEnv, package:lattice, package:methods, package:stats,
> package:graphics, package:grDevices, package:utils, package:datasets,
> Autoloads, package:base
>
>
>
> -------------------
>
> GSview 4.7 2005-03-26
> AFPL Ghostscript 8.51 (2005-04-18)
> Copyright (C) 2005 artofcode LLC, Benicia, CA.  All rights reserved.
> This software comes with NO WARRANTY: see the file PUBLIC for details.
> Scanning PDF file
> %GSVIEW_PDF_PAGES: 1 1
> Displaying PDF page 1
> %GSVIEW_PDF_PAGE: 1
> %GSVIEW_PDF_MEDIA: [0 0 432 432]
> %GSVIEW_PDF_ROTATE: 0
> Loading NimbusSanL-Regu font from c:\gs\fonts/n019003l.pfb... 2291320
> 946479 1594968 288125 3 done.
> Error: /typecheck in --lt--
> Operand stack:
>    --dict:4/4(L)--   F2   1   --dict:5/5(L)--   --dict:5/5(L)--
> --dict:15/16(ro)(G)--   --nostringval--   --nostringval--   1
> --nostringval--   1   --nostringval--
> Execution stack:
>    %interp_exit   .runexec2   --nostringval--   --nostringval--
> --nostringval--   2   %stopped_push   --nostringval--   --nostringval--
>   false   1   %stopped_push   1   3   %oparray_pop   1   3
> %oparray_pop   1   3   %oparray_pop   1   3   %oparray_pop   .runexec2
>  --nostringval--   --nostringval--   --nostringval--   2
> %stopped_push   --nostringval--   --nostringval--   --nostringval--
> --nostringval--   --nostringval--   %array_continue   --nostringval--
> false   1   %stopped_push   --nostringval--   %loop_continue
> --nostringval--   --nostringval--   --nostringval--   --nostringval--
> --nostringval--   --nostringval--   %array_continue   --nostringval--
> Dictionary stack:
>    --dict:1129/1686(ro)(G)--   --dict:0/20(G)--   --dict:79/200(L)--
> --dict:105/127(ro)(G)--   --dict:251/347(ro)(G)--   --dict:21/24(L)--
> --dict:4/6(L)--   --dict:20/20(L)--   --dict:10/13(L)--
> Current allocation mode is local
> pdf_page failed
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>

--=20
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595
--27464147-1188682158-1124696849=:32369--


From SecuriQ at hondabr.com.br  Mon Aug 22 12:32:06 2005
From: SecuriQ at hondabr.com.br (SecuriQ@hondabr.com.br)
Date: Mon, 22 Aug 2005 07:32:06 -0300
Subject: [Rd] [Virus Check]
Message-ID: <OF5C9C35F7.C06BF08C-ON03257065.0039DEE8@hondasmtp.com.br>


GROUP Watchdog
Server: HONDASMTP2
-----------------------------------------------------------------------

Sua mensagem nao foi entregue pois continha virus.

Your mail item contained attachments that have been virus infected.
-----------------------------------------------------------------------

Mail-Info

From:              r-devel at r-project.org
To:                robson_ouvidio at hondabr.com.br
Rec.: robson_ouvidio at hondabr.com.br
Date:              22/08/2005 07:40:45
Subject:           massas!

-----------------------------------------------------------------------
file contains virus:                    botao.zip


From ripley at stats.ox.ac.uk  Mon Aug 22 12:38:08 2005
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 22 Aug 2005 11:38:08 +0100 (BST)
Subject: [Rd] Implementing a single-precision class with raw
In-Reply-To: <c06c608685a92cf22b59f0420a179ccc@colinsmith.org>
References: <c06c608685a92cf22b59f0420a179ccc@colinsmith.org>
Message-ID: <Pine.LNX.4.61.0508200836330.25528@gannet.stats>

On Fri, 19 Aug 2005, Colin A. Smith wrote:

> A package that I develop (xcms) sometimes needs to read and process
> vectors several hundreds of megabytes in size. (They only represent
> parts of a large data sets which can approach nearly 100GB.)
> Unfortunately, R sometimes hits the 2GB memory limit of Win32.

The rw-FAQ explains why that is _not_ the limit!

> To help cut the memory footprint in half, I'm implementing a "float" 
> class as a subclass of "raw".

Why via "raw"?

I believe the intention is that this sort of thing be done via external 
references, but as float and int are the same size on all current 
platforms, I would have considered R integers for storage. Then for 
example subsetting would work and you had a 4x larger size limit on 64-bit 
platforms.  (You would also have got automatic handling of endianness.)

> Because almost all the computation on the large vectors is done in C 
> code, having a somewhat limited single-precision data type is okay.
>
> I've run into a limitation with the .C() function where it does not
> handle raw vectors, which it will do in 2.2.0.

That is just not true!

> In the meantime, I'm using the .Call() function to access the raw 
> vectors. However, there don't seem to be any macros for handling raw 
> vectors in Rdefines.h.

So?  We recommend using Rinternals.h: Rdefines.h is a compatibility 
wrapper for macros from S4.  The raw type has not attempted to be 
compatible with S4, and we are not aware of any user who has compiled S4 
code using raw vectors that (s)he wishes to port to R.

(The R-exts.texi manual has been rather too optimistic about Rdefines.h: 
as you need to use SET_STRING_ELT and SET_VECTOR_ELT in R, you are rather 
limited as to what you can do in S4 style.  This has been so since R 1.2.0 
and Rdefines.h has hardly been updated since.)

> I've made a guess at what those macros would be and was wondering
> whether my guesses were correct and/or might be included in 2.2.0:
>
> #define NEW_RAW(n) allocVector(RAWSXP,n)
> #define RAW_POINTER(x) (RAW(x))
> #define AS_RAW(x) coerceVector(x,RAWSXP)
>
> I'm not sure whether coerceVector(x,RAWSXP) will actually work.

You should have read the code to find out (people answering your comment 
would have had to).  It will `actually work', but it may not do whatever 
it is that you expect.  (It interprets its input as integer (decimal if a 
string) representations of the bytes.)

This is in contrast to S, where I have no idea precisely what AS_RAW is 
supposed to do and no code to read.  (as(, "raw") seems to do wierd and 
unpredictable things, though, and the Green Book suggests that coercion 
probably is not intended to work.)

For completeness I have added my (informed) guesses to Rdefines.h in 
R-devel.

> Also, there isn't an Rf_isRaw() function, which would be useful for an 
> IS_RAW(x) macro.

Why would this be necessary?  TYPEOF(x) == RAWSXP is all that is needed.

> Another issue with the "float" class is that it will run into endian
> issues if it ever gets saved to disk and moved cross-platform. I don't
> really anticipate that happening but it might be nice to incorporate
> serialization hooks if possible. Are there any facilities in R for
> doing that?

See the comment above.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From jfox at mcmaster.ca  Mon Aug 22 14:32:44 2005
From: jfox at mcmaster.ca (John Fox)
Date: Mon, 22 Aug 2005 08:32:44 -0400
Subject: [Rd] Internationalization questions
In-Reply-To: <Pine.LNX.4.61.0508220729430.31504@gannet.stats>
Message-ID: <20050822123244.VKJP27508.tomts16-srv.bellnexxia.net@JohnDesktop8300>

Dear Brian,

> -----Original Message-----
> From: Prof Brian Ripley [mailto:ripley at stats.ox.ac.uk] 
> Sent: 22 ao?t 2005 01:47
> To: John Fox
> Cc: r-devel at stat.math.ethz.ch
> Subject: Re: [Rd] Internationalization questions
> 
> On Sun, 21 Aug 2005, John Fox wrote:
> 
> > Dear R-devel list members:
> >
> > I have two internationalization questions, related to 
> questions that I 
> > posed previously. These pertain to Windows (I've tried under Win XP 
> > but assume the issue is more general) and R 2.1.1 patched 
> and 2.2.0 devel.
> >
> > (1) I've noticed that the standard Windows dialogs in R -- whether 
> > initiated from the Rgui menus, from winDialog(), or from tcltk 
> > functions such as
> > tkmessageBox() -- do not have button labels translated when 
> running in 
> > a non-English locale. For example, when running in a French locale, 
> > the command
> >
> >  winDialog(type="yesnocancel", message=gettext("Save workspace 
> > image?",
> > domain="RGui"))
> >
> > produces a dialog box with the message translated to 
> "Sauver une image 
> > de la session?", but the buttons still read "Yes", "No", 
> and "Cancel".
> >
> > Is this the intended behaviour?  Is there any way to get the button 
> > text translated? I've implemented a partial solution that uses a 
> > substitute for tkmessageBox(), but it is a bit awkward.
> 
> You need to have Windows set to be in French dialogs, not 
> just the locale set to French.  This is on the second page of 
> the Regional settings doalogs in WinXP.  It is intended, as 
> it makes all Windows dialogs work consistently.  (You can 
> have different settings on the three pages, but not all 
> combinations work successfully -- the current rw-FAQ has some
> comments.)
> 

On my XP system, the tabs are (in order) Regional Options, Languages, and
Advanced. I have now set all three to "French (Canada)" -- including in the
subdialog produced by the Details button under Languages, and rebooted. I
still get English button labels. 

I've just read over the rw-FAQ from R 2.2.0 devel, but will read it more
carefully. 

I guess that I'm willing to accept that Windows users who use languages
other than English know how to set up their systems properly.

> > (2) I'm still looking for a reliable way to determine whether R is 
> > using English. Currently, I have the function
> >
> > English <- function() {
> >    env <- Sys.getenv()
> >    names(env) <- toupper(names(env))
> >    LANG <- env["LANGUAGE"]
> >    LC_CTYPE <- Sys.getlocale("LC_CTYPE")
> >    if (!is.na(LANG)) length(grep("^en", LANG, ignore.case=TRUE)) > 0
> >    else LC_CTYPE == "C" || length(grep("^en", LC_CTYPE, 
> > ignore.case=TRUE))
> >> 0
> >    }
> >
> >
> > (adapting and extending a suggestion by Simon Urbanek) which checks 
> > not just the locale but also for an environment variable named 
> > LANGUAGE. Is this sufficient?
> 
> Using English for what?  (See my comments above.)   For 
> messages, yes, it 
> covers all the quirks we know about in the major OSes.
> 

Checking for English messages is sufficient for my purposes.

Thanks for your help,
 John

> Brian


From toedling at ebi.ac.uk  Mon Aug 15 19:07:22 2005
From: toedling at ebi.ac.uk (toedling@ebi.ac.uk)
Date: Mon, 15 Aug 2005 19:07:22 +0200 (CEST)
Subject: [Rd] is.numeric (PR#8067)
Message-ID: <20050815170722.34DDA18B8F@slim.kubism.ku.dk>

Full_Name: Joern Toedling
Version: 2.1.0
OS: Linux
Submission from: (NULL) (193.62.198.2)


Maybe, it's supposed to be a feature rather than a bug, but I find it quite
strange that 
> is.numeric(NaN)
returns TRUE, when NaN means 'Not a Number'


From jcperry at jcperry.com  Tue Aug 16 12:20:36 2005
From: jcperry at jcperry.com (jcperry@jcperry.com)
Date: Tue, 16 Aug 2005 12:20:36 +0200 (CEST)
Subject: [Rd] doc - matrix multiplication (PR#8069)
Message-ID: <20050816102036.762FA18B9F@slim.kubism.ku.dk>

Full_Name: John Perry
Version: 2.1.1
OS: Windows
Submission from: (NULL) (155.140.122.227)



help("*")

Could you add the following?


See Also:

'%*%' for matrix multiplication


From ripley at stats.ox.ac.uk  Mon Aug 22 15:02:17 2005
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 22 Aug 2005 14:02:17 +0100 (BST)
Subject: [Rd] Internationalization questions
In-Reply-To: <20050822123244.VKJP27508.tomts16-srv.bellnexxia.net@JohnDesktop8300>
References: <20050822123244.VKJP27508.tomts16-srv.bellnexxia.net@JohnDesktop8300>
Message-ID: <Pine.LNX.4.61.0508221357390.2134@gannet.stats>

On Mon, 22 Aug 2005, John Fox wrote:

> Dear Brian,
>
>> -----Original Message-----
>> From: Prof Brian Ripley [mailto:ripley at stats.ox.ac.uk]
>> Sent: 22 ao?t 2005 01:47
>> To: John Fox
>> Cc: r-devel at stat.math.ethz.ch
>> Subject: Re: [Rd] Internationalization questions
>>
>> On Sun, 21 Aug 2005, John Fox wrote:
>>
>>> Dear R-devel list members:
>>>
>>> I have two internationalization questions, related to
>> questions that I
>>> posed previously. These pertain to Windows (I've tried under Win XP
>>> but assume the issue is more general) and R 2.1.1 patched
>> and 2.2.0 devel.
>>>
>>> (1) I've noticed that the standard Windows dialogs in R -- whether
>>> initiated from the Rgui menus, from winDialog(), or from tcltk
>>> functions such as
>>> tkmessageBox() -- do not have button labels translated when
>> running in
>>> a non-English locale. For example, when running in a French locale,
>>> the command
>>>
>>>  winDialog(type="yesnocancel", message=gettext("Save workspace
>>> image?",
>>> domain="RGui"))
>>>
>>> produces a dialog box with the message translated to
>> "Sauver une image
>>> de la session?", but the buttons still read "Yes", "No",
>> and "Cancel".
>>>
>>> Is this the intended behaviour?  Is there any way to get the button
>>> text translated? I've implemented a partial solution that uses a
>>> substitute for tkmessageBox(), but it is a bit awkward.
>>
>> You need to have Windows set to be in French dialogs, not
>> just the locale set to French.  This is on the second page of
>> the Regional settings doalogs in WinXP.  It is intended, as
>> it makes all Windows dialogs work consistently.  (You can
>> have different settings on the three pages, but not all
>> combinations work successfully -- the current rw-FAQ has some
>> comments.)
>>
>
> On my XP system, the tabs are (in order) Regional Options, Languages, and
> Advanced. I have now set all three to "French (Canada)" -- including in the
> subdialog produced by the Details button under Languages, and rebooted. I
> still get English button labels.

At the bottom of the Languages tab there is a setting for `menus and 
dialogs'.  I got a short list of languages, e.g. 'francais' for that item. 
You have to log out and log in again to make a change stick (and it tells 
you that.)  That does work for me (and I tested it again before answering 
you, and have also tested Italian in the past).  I wonder if you have had 
to have used that language in a past reboot to make this work ....

Brian

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From ripley at stats.ox.ac.uk  Mon Aug 22 15:05:35 2005
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 22 Aug 2005 14:05:35 +0100 (BST)
Subject: [Rd] is.numeric (PR#8067)
In-Reply-To: <20050815170722.34DDA18B8F@slim.kubism.ku.dk>
References: <20050815170722.34DDA18B8F@slim.kubism.ku.dk>
Message-ID: <Pine.LNX.4.61.0508221402410.2134@gannet.stats>

Please do read the help page before firing off a bug report, as we do ask 
in several places.  It says

      'is.numeric' returns 'TRUE' if its argument is of type numeric or
      type integer and 'FALSE' otherwise.

and

> typeof(NaN)
[1] "double"

(numeric and double are synonyms for types).

Working as documented is a not a bug.

On Mon, 15 Aug 2005 toedling at ebi.ac.uk wrote:

> Full_Name: Joern Toedling
> Version: 2.1.0

We do ask for reports to be made on the current version of R.

> OS: Linux
> Submission from: (NULL) (193.62.198.2)
>
>
> Maybe, it's supposed to be a feature rather than a bug, but I find it quite
> strange that
>> is.numeric(NaN)
> returns TRUE, when NaN means 'Not a Number'


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From jfox at mcmaster.ca  Mon Aug 22 15:11:33 2005
From: jfox at mcmaster.ca (John Fox)
Date: Mon, 22 Aug 2005 09:11:33 -0400
Subject: [Rd] Internationalization questions
In-Reply-To: <Pine.LNX.4.61.0508221357390.2134@gannet.stats>
Message-ID: <20050822131135.SFIG26128.tomts5-srv.bellnexxia.net@JohnDesktop8300>

Dear Brian,


> -----Original Message-----
> From: Prof Brian Ripley [mailto:ripley at stats.ox.ac.uk] 
> Sent: Monday, August 22, 2005 8:02 AM
> To: John Fox
> Cc: r-devel at stat.math.ethz.ch
> Subject: RE: [Rd] Internationalization questions
> 
> On Mon, 22 Aug 2005, John Fox wrote:
> 
> > Dear Brian,
> >
> >> -----Original Message-----
> >> From: Prof Brian Ripley [mailto:ripley at stats.ox.ac.uk]
> >> Sent: 22 ao?t 2005 01:47
> >> To: John Fox
> >> Cc: r-devel at stat.math.ethz.ch
> >> Subject: Re: [Rd] Internationalization questions
> >>
> >> On Sun, 21 Aug 2005, John Fox wrote:
> >>
> >>> Dear R-devel list members:
> >>>
> >>> I have two internationalization questions, related to
> >> questions that I
> >>> posed previously. These pertain to Windows (I've tried 
> under Win XP 
> >>> but assume the issue is more general) and R 2.1.1 patched
> >> and 2.2.0 devel.
> >>>
> >>> (1) I've noticed that the standard Windows dialogs in R 
> -- whether 
> >>> initiated from the Rgui menus, from winDialog(), or from tcltk 
> >>> functions such as
> >>> tkmessageBox() -- do not have button labels translated when
> >> running in
> >>> a non-English locale. For example, when running in a 
> French locale, 
> >>> the command
> >>>
> >>>  winDialog(type="yesnocancel", message=gettext("Save workspace 
> >>> image?",
> >>> domain="RGui"))
> >>>
> >>> produces a dialog box with the message translated to
> >> "Sauver une image
> >>> de la session?", but the buttons still read "Yes", "No",
> >> and "Cancel".
> >>>
> >>> Is this the intended behaviour?  Is there any way to get 
> the button 
> >>> text translated? I've implemented a partial solution that uses a 
> >>> substitute for tkmessageBox(), but it is a bit awkward.
> >>
> >> You need to have Windows set to be in French dialogs, not just the 
> >> locale set to French.  This is on the second page of the Regional 
> >> settings doalogs in WinXP.  It is intended, as it makes 
> all Windows 
> >> dialogs work consistently.  (You can have different 
> settings on the 
> >> three pages, but not all combinations work successfully -- the 
> >> current rw-FAQ has some
> >> comments.)
> >>
> >
> > On my XP system, the tabs are (in order) Regional Options, 
> Languages, 
> > and Advanced. I have now set all three to "French (Canada)" -- 
> > including in the subdialog produced by the Details button under 
> > Languages, and rebooted. I still get English button labels.
> 
> At the bottom of the Languages tab there is a setting for 
> `menus and dialogs'.  I got a short list of languages, e.g. 
> 'francais' for that item. 
> You have to log out and log in again to make a change stick 
> (and it tells you that.)  That does work for me (and I tested 
> it again before answering you, and have also tested Italian 
> in the past).  I wonder if you have had to have used that 
> language in a past reboot to make this work ....
> 

There is no such setting on the Languages tab on my system (XP Pro Version
2002 SP2), even though I've now rebooted using French. The tab has only
"Text services and input languages" with a Details button, and "Supplemental
language support" with two check boxes for "Install files for complex script
etc." and "Install files for East Asian languages."

I'm reluctant to waste more of your time -- this is clearly a Windows issue
and not an R issue.

Thanks again for your help,
 John


From kwang-youn-kim at uiowa.edu  Mon Aug 22 17:02:53 2005
From: kwang-youn-kim at uiowa.edu (kwang-youn-kim@uiowa.edu)
Date: Mon, 22 Aug 2005 17:02:53 +0200 (CEST)
Subject: [Rd] Copy and paste with X11 (PR#8085)
Message-ID: <20050822150253.9C413103CB@slim.kubism.ku.dk>

Full_Name: Kwang-Youn Kim
Version: 2.1.1
OS: OS X 10.4
Submission from: (NULL) (128.255.125.51)


When running R 2.1.1 under Mac OS X 10.4.2 X11, copying and pasting a large
segment of code from vi, typically more than 10 lines at a time will paste some
garbage information rendering incorrect code to be pasted. The current hardware
that I am running is a Power Mac Dual 2.3Ghz with 4.5 GB of memory.


From n.shah at decisioncraft.com  Mon Aug 22 17:26:59 2005
From: n.shah at decisioncraft.com (Nikhil Shah)
Date: Mon, 22 Aug 2005 20:56:59 +0530
Subject: [Rd] Fetching Warning Messages
Message-ID: <003301c5a72d$f1badf50$7900a8c0@dca.com>

Hi,

    I am facing one problem of fetching R warning messages in Java Code
using Rserve. It is easier to trap R Error messages by using catching
RSrvException. I came to know one way of fetching R Warning messages, i.e.
using "withCallingHandlers", below is my Java Program, which uses
withCallingHandlers of R :
import org.rosuda.JRclient.*;

---------------------------RWarning.java-----------------------
class RWarning
{
   public static void main(String args[])
  {
     try
     {
       String hostName = null;
       hostName = args[0];
       Rconnection c = new Rconnection(hostName);
       c.voidEval("lastWarning <- NULL");
       c.voidEval("withCallingHandlers(
{x<-sqrt(-9);y<-matrix(1:9,ncol=4);z<-sqrt(4)} , warning = function (w) {
lastWarning <<- paste(lastWarning,as.character(w))})"); //This will generate
warning message[sqrt(-9)], another warning message [ matrix(1:9,ncol=4) ]
and successful completion [ sqrt(4) ]
        System.out.println(c.eval("z").asDouble());
        System.out.println(c.eval("lastWarning").asString());
        c.close();
        System.out.println("DONE");
      }
      catch(RSrvException  e)
      {
         System.out.println("Error : " + e.getMessage());
         e.printStackTrace();
      }
   }
}
---------------------------End Of RWarning.java-----------------------

Output of above program is (as expected) :

2.0
simpleWarning in sqrt(-9): NaNs produced
simpleWarning: data length [9] is not a sub-multiple or multiple of the
number of columns [4] in matrix

DONE



     Now my query is that if there is any way of using warnings() function
in Java Program to fetch all warnings. I used it in my program but returns
me NULL instead of warning messages. I also used last.warning but it Java
Program gives an error saying that last.warning object is not found. I have
pasted both the java code below :

This is the java program that I have written to use "last.warning" object of
R. Please explain me where the error could be.

------------Code of RWarning1.java----------------

import org.rosuda.JRclient.*;

class RWarning1
{
  public static void main(String args[])
  {
    try
    {
      String hostName = null;
      hostName = args[0];
      Rconnection c = new Rconnection(hostName);
      System.out.println(c.eval("x<-sqrt(-9)").asString());
      System.out.println(c.eval("last.warning").asString());
      c.close();
      System.out.println("DONE");
    }
    catch(RSrvException  e)
    {
      System.out.println("Error : " + e.getMessage());
      e.printStackTrace();
    }
  }
}
------------End of code of RWarning1.java------------------

output of RWarning1.class

null
Error : Request return code: 127 [request status: Error (127)]
org.rosuda.JRclient.RSrvException: Request return code: 127 [request status:
Err
or (127)]
        at org.rosuda.JRclient.Rconnection.eval(Rconnection.java:190)
        at RWarning.main(RWarning.java:13)

In other words, when I use "last.warning" in eval method, I simply get an
exception, instead of value of last.warning.


Below is the java code of using warnings() function.

------------Code of RWarning2.java----------------

import org.rosuda.JRclient.*;

class RWarning2
{
  public static void main(String args[])
  {
  try
  {
    String hostName = null;
    hostName = args[0];
    Rconnection c = new Rconnection(hostName);
    System.out.println(c.eval("x<-sqrt(-9)").asString());

System.out.println(c.eval("paste(capture.output(warnings()),collapse='\n')")
.asString());
    c.close();
    System.out.println("DONE");
  }
  catch(RSrvException  e)
  {
    System.out.println("Error : " + e.getMessage());
    e.printStackTrace();
  }
}
}
------------End of code of RWarning2.java------------------
output of RWarning2.class

null
NULL
DONE


  Please let me know where I am making mistake.

Regards,

Nikhil Shah


From ripley at stats.ox.ac.uk  Mon Aug 22 17:53:42 2005
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 22 Aug 2005 16:53:42 +0100 (BST)
Subject: [Rd] Fetching Warning Messages
In-Reply-To: <003301c5a72d$f1badf50$7900a8c0@dca.com>
References: <003301c5a72d$f1badf50$7900a8c0@dca.com>
Message-ID: <Pine.LNX.4.61.0508221634470.16868@gannet.stats>

Please read the help page on options("warn") and see what warnings() 
does. (I am pretty sure you have asked this and been told before.)

There should not be an object called last.warning in your example.

On Mon, 22 Aug 2005, Nikhil Shah wrote:

> Hi,
>
>    I am facing one problem of fetching R warning messages in Java Code
> using Rserve. It is easier to trap R Error messages by using catching
> RSrvException. I came to know one way of fetching R Warning messages, i.e.
> using "withCallingHandlers", below is my Java Program, which uses
> withCallingHandlers of R :
> import org.rosuda.JRclient.*;
>
> ---------------------------RWarning.java-----------------------
> class RWarning
> {
>   public static void main(String args[])
>  {
>     try
>     {
>       String hostName = null;
>       hostName = args[0];
>       Rconnection c = new Rconnection(hostName);
>       c.voidEval("lastWarning <- NULL");
>       c.voidEval("withCallingHandlers(
> {x<-sqrt(-9);y<-matrix(1:9,ncol=4);z<-sqrt(4)} , warning = function (w) {
> lastWarning <<- paste(lastWarning,as.character(w))})"); //This will generate
> warning message[sqrt(-9)], another warning message [ matrix(1:9,ncol=4) ]
> and successful completion [ sqrt(4) ]
>        System.out.println(c.eval("z").asDouble());
>        System.out.println(c.eval("lastWarning").asString());
>        c.close();
>        System.out.println("DONE");
>      }
>      catch(RSrvException  e)
>      {
>         System.out.println("Error : " + e.getMessage());
>         e.printStackTrace();
>      }
>   }
> }
> ---------------------------End Of RWarning.java-----------------------
>
> Output of above program is (as expected) :
>
> 2.0
> simpleWarning in sqrt(-9): NaNs produced
> simpleWarning: data length [9] is not a sub-multiple or multiple of the
> number of columns [4] in matrix
>
> DONE
>
>
>
>     Now my query is that if there is any way of using warnings() function
> in Java Program to fetch all warnings. I used it in my program but returns
> me NULL instead of warning messages. I also used last.warning but it Java
> Program gives an error saying that last.warning object is not found. I have
> pasted both the java code below :
>
> This is the java program that I have written to use "last.warning" object of
> R. Please explain me where the error could be.
>
> ------------Code of RWarning1.java----------------
>
> import org.rosuda.JRclient.*;
>
> class RWarning1
> {
>  public static void main(String args[])
>  {
>    try
>    {
>      String hostName = null;
>      hostName = args[0];
>      Rconnection c = new Rconnection(hostName);
>      System.out.println(c.eval("x<-sqrt(-9)").asString());
>      System.out.println(c.eval("last.warning").asString());
>      c.close();
>      System.out.println("DONE");
>    }
>    catch(RSrvException  e)
>    {
>      System.out.println("Error : " + e.getMessage());
>      e.printStackTrace();
>    }
>  }
> }
> ------------End of code of RWarning1.java------------------
>
> output of RWarning1.class
>
> null
> Error : Request return code: 127 [request status: Error (127)]
> org.rosuda.JRclient.RSrvException: Request return code: 127 [request status:
> Err
> or (127)]
>        at org.rosuda.JRclient.Rconnection.eval(Rconnection.java:190)
>        at RWarning.main(RWarning.java:13)
>
> In other words, when I use "last.warning" in eval method, I simply get an
> exception, instead of value of last.warning.
>
>
> Below is the java code of using warnings() function.
>
> ------------Code of RWarning2.java----------------
>
> import org.rosuda.JRclient.*;
>
> class RWarning2
> {
>  public static void main(String args[])
>  {
>  try
>  {
>    String hostName = null;
>    hostName = args[0];
>    Rconnection c = new Rconnection(hostName);
>    System.out.println(c.eval("x<-sqrt(-9)").asString());
>
> System.out.println(c.eval("paste(capture.output(warnings()),collapse='\n')")
> .asString());
>    c.close();
>    System.out.println("DONE");
>  }
>  catch(RSrvException  e)
>  {
>    System.out.println("Error : " + e.getMessage());
>    e.printStackTrace();
>  }
> }
> }
> ------------End of code of RWarning2.java------------------
> output of RWarning2.class
>
> null
> NULL
> DONE
>
>
>  Please let me know where I am making mistake.
>
> Regards,
>
> Nikhil Shah
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From h.wickham at gmail.com  Mon Aug 22 18:29:05 2005
From: h.wickham at gmail.com (hadley wickham)
Date: Mon, 22 Aug 2005 11:29:05 -0500
Subject: [Rd] Package tests: best practices
Message-ID: <f8e6ff050508220929295cad3e@mail.gmail.com>

I'm writing some tests for a package and I have a few questions
regarding best practices.  I've read "tests subdirectory" paragraph in
writing R extension, but I'm left wanting more.
Firstly, can I assume that the document root will always be set to the
test directory? (that what a couple of quick tests seemed to show)

Obviously, I want to test the code in my package - how do I load it? 
I assume I can't use library(XXX) because that will load the currently
installed version - should I source in all ../R/*.r instead?

Thanks for your advice,

Hadley


From ripley at stats.ox.ac.uk  Mon Aug 22 18:56:52 2005
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 22 Aug 2005 17:56:52 +0100 (BST)
Subject: [Rd] Package tests: best practices
In-Reply-To: <f8e6ff050508220929295cad3e@mail.gmail.com>
References: <f8e6ff050508220929295cad3e@mail.gmail.com>
Message-ID: <Pine.LNX.4.61.0508221734270.17656@gannet.stats>

On Mon, 22 Aug 2005, hadley wickham wrote:

> I'm writing some tests for a package and I have a few questions
> regarding best practices.  I've read "tests subdirectory" paragraph in
> writing R extension, but I'm left wanting more.
> Firstly, can I assume that the document root will always be set to the
> test directory? (that what a couple of quick tests seemed to show)

The working directory will be the tests directory as used, and all the 
tests subdirectory in the sources is copied there.

R does not have `document root', AFAIK.

> Obviously, I want to test the code in my package - how do I load it?
> I assume I can't use library(XXX) because that will load the currently
> installed version - should I source in all ../R/*.r instead?

You assume wrong: you should use the version installed for checking by 
library(xxx): R_LIBS is explicitly set to point to it first.

I've added some further comments to R-exts, but it seems that quite a few 
people have worked this out from the existing info and there are several 
examples in the R sources and recommended packages.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From dmbates at gmail.com  Mon Aug 22 19:57:20 2005
From: dmbates at gmail.com (Douglas Bates)
Date: Mon, 22 Aug 2005 12:57:20 -0500
Subject: [Rd] An lgrind definition for the S language
Message-ID: <40e66e0b050822105765020933@mail.gmail.com>

I seem to recall discussion of an language definition file for S for
use with the lgrind utility but I can't find any trace of it in an R
Site Search.  The lgrind utility takes a file of code in a particular
programming language and prepares it for "pretty printing" in LaTeX. 
In my version the available language definitions are

$ lgrind -s
When specifying a language case is insignificant. You can use the
name of the language, or, where available, one of the synonyms in
parantheses. Thus the following are legal and mark Tcl/Tk, Pascal
and Fortran input, respectively:
   lgrind -ltcl/tk ...
   lgrind -lpaSCAL ...
   lgrind -lf ...
The list of languages currently available in your lgrindef file:
    Ada                               MLisp  (Emacs Mock Lisp)
    Asm                               SML/NJ  (ML)
    Asm68                             Scheme  (scm)
    BASIC                             model
    Batch  (bat)                      Modula2  (mod2, m2)
    C                                 Pascal  (pas, p, bp)
    C++  (CC)                         PERL  (pl)
    csh                               PostScript  (ps)
    FORTRAN  (f77, f)                 PROLOG
    Gnuplot                           Python  (py)
    Icon                              RATFOR
    IDL                               RLaB
    ISP                               Russell
    Java                              SAS
    Kimwitu++  (kimw)                 SDL
    LaTeX                             sh
    LDL                               SICStus
    Lex                               src
    Linda                             SQL
    make                              Tcl/Tk  (tcl, tk)
    MASM                              VisualBasic  (vbasic)
    MATLAB                            VMSasm
    Mercury                           yacc  (y)

Does anyone know of a similar facility for S code?


From mschwartz at mn.rr.com  Mon Aug 22 21:17:16 2005
From: mschwartz at mn.rr.com (Marc Schwartz (via MN))
Date: Mon, 22 Aug 2005 14:17:16 -0500
Subject: [Rd] An lgrind definition for the S language
In-Reply-To: <40e66e0b050822105765020933@mail.gmail.com>
References: <40e66e0b050822105765020933@mail.gmail.com>
Message-ID: <1124738237.4627.50.camel@localhost.localdomain>

On Mon, 2005-08-22 at 12:57 -0500, Douglas Bates wrote:
> I seem to recall discussion of an language definition file for S for
> use with the lgrind utility but I can't find any trace of it in an R
> Site Search.  The lgrind utility takes a file of code in a particular
> programming language and prepares it for "pretty printing" in LaTeX. 
> In my version the available language definitions are
> 
> $ lgrind -s
> When specifying a language case is insignificant. You can use the
> name of the language, or, where available, one of the synonyms in
> parantheses. Thus the following are legal and mark Tcl/Tk, Pascal
> and Fortran input, respectively:
>    lgrind -ltcl/tk ...
>    lgrind -lpaSCAL ...
>    lgrind -lf ...
> The list of languages currently available in your lgrindef file:
>     Ada                               MLisp  (Emacs Mock Lisp)
>     Asm                               SML/NJ  (ML)
>     Asm68                             Scheme  (scm)
>     BASIC                             model
>     Batch  (bat)                      Modula2  (mod2, m2)
>     C                                 Pascal  (pas, p, bp)
>     C++  (CC)                         PERL  (pl)
>     csh                               PostScript  (ps)
>     FORTRAN  (f77, f)                 PROLOG
>     Gnuplot                           Python  (py)
>     Icon                              RATFOR
>     IDL                               RLaB
>     ISP                               Russell
>     Java                              SAS
>     Kimwitu++  (kimw)                 SDL
>     LaTeX                             sh
>     LDL                               SICStus
>     Lex                               src
>     Linda                             SQL
>     make                              Tcl/Tk  (tcl, tk)
>     MASM                              VisualBasic  (vbasic)
>     MATLAB                            VMSasm
>     Mercury                           yacc  (y)
> 
> Does anyone know of a similar facility for S code?

Doug,

A search using Jon Baron's page came up with the following thread:

https://stat.ethz.ch/pipermail/r-help/2000-April/004898.html

by Kjetil Kjernsmo

and the following post by Torsten Hothorn:

https://stat.ethz.ch/pipermail/r-help/2000-March/004345.html

I checked "Rhelp 1997-2001" on Jon's search page, otherwise these would
be missed.

Another approach would be to use Google with the following:

   lgrind site:https://stat.ethz.ch

which would search the archives, including r-devel.

HTH,

Marc


From erich.neuwirth at univie.ac.at  Mon Aug 22 23:38:55 2005
From: erich.neuwirth at univie.ac.at (Erich Neuwirth)
Date: Mon, 22 Aug 2005 23:38:55 +0200
Subject: [Rd] boxplot.formula and questions about calls and formulas
Message-ID: <430A45EF.5060608@univie.ac.at>

I am trying to adapt boxplot.formula (in graphics) to accept an
additional parameter, weights.
I already managed to adapt boxplot.default to do this.

boxplot.formula prepares the data for a call to boxplot.default and to
achieve that does the following: It takes a formula like

    x~g*h

as the first argument, and then by using

    m <- match.call(expand.dots = FALSE)

saves the call. It transforms the call

    m$na.action <- na.action # force use of default for this method
    m[[1]] <- as.name("model.frame")

and then  evaluates the modified call
    mf <- eval(m, parent.frame())

    print(m)
gives
    model.frame(formula = x ~ g * h)

Then it uses components of mf for the call to boxplot.default.

m has a component m$formula containing the parsed model formula.
mode(m$formula) is "call".
In our case, deparse(m$formula) gives a string representation of the
formula: "x~g*h".
I want to replace the response variable (in our case x) by the weights
variable, which in the string expression can be done easily with
strsplit and paste. Then I need to reconvert the modified string to a call.

So I create newmodelstring<-"weights~g*h" and try

    m$formula<-as.call(parse(newmodelstring))

    print(m)
gives
    model.frame(formula = weights ~ g * h())


When I try to evaluate the modified m this does not work. When I try to
evaluate m with this modification I get

Error in model.frame(formula = weights ~ g * h()) :
        attempt to apply non-function

Is there a way to get rid of the empty parentheses at the
end of the formula? I think then my code could work.

-- 
Erich Neuwirth, Didactic Center for Computer Science
University of Vienna
Visit our SunSITE at http://sunsite.univie.ac.at
Phone: +43-1-4277-39902 Fax: +43-1-4277-9399


From erich.neuwirth at univie.ac.at  Mon Aug 22 23:39:53 2005
From: erich.neuwirth at univie.ac.at (Erich Neuwirth)
Date: Mon, 22 Aug 2005 23:39:53 +0200
Subject: [Rd] Questions about calls and formulas
Message-ID: <430A4629.8010506@univie.ac.at>

I am trying to adapt boxplot.formula (in graphics) to accept an
additional parameter, weights.
I already managed to adapt boxplot.default to do this.

boxplot.formula prepares the data for a call to boxplot.default and to
achieve that does the following: It takes a formula like

    x~g*h

as the first argument, and then by using

    m <- match.call(expand.dots = FALSE)

saves the call. It transforms the call

    m$na.action <- na.action # force use of default for this method
    m[[1]] <- as.name("model.frame")

and then  evaluates the modified call
    mf <- eval(m, parent.frame())

    print(m)
gives
    model.frame(formula = x ~ g * h)

Then it uses components of mf for the call to boxplot.default.

m has a component m$formula containing the parsed model formula.
mode(m$formula) is "call".
In our case, deparse(m$formula) gives a string representation of the
formula: "x~g*h".
I want to replace the response variable (in our case x) by the weights
variable, which in the string expression can be done easily with
strsplit and paste. Then I need to reconvert the modified string to a call.

So I create newmodelstring<-"weights~g*h" and try

    m$formula<-as.call(parse(newmodelstring))

    print(m)
gives
    model.frame(formula = weights ~ g * h())


When I try to evaluate the modified m this does not work. When I try to
evaluate m with this modification I get

Error in model.frame(formula = weights ~ g * h()) :
        attempt to apply non-function

Is there a way to get rid of the empty parentheses at the
end of the formula? I think then my code could work.

-- 
Erich Neuwirth, Didactic Center for Computer Science
University of Vienna
Visit our SunSITE at http://sunsite.univie.ac.at
Phone: +43-1-4277-39902 Fax: +43-1-4277-9399


From dmbates at gmail.com  Mon Aug 22 23:52:08 2005
From: dmbates at gmail.com (Douglas Bates)
Date: Mon, 22 Aug 2005 16:52:08 -0500
Subject: [Rd] Questions about calls and formulas
In-Reply-To: <430A4629.8010506@univie.ac.at>
References: <430A4629.8010506@univie.ac.at>
Message-ID: <40e66e0b05082214525e2140e8@mail.gmail.com>

On 8/22/05, Erich Neuwirth <erich.neuwirth at univie.ac.at> wrote:
> I am trying to adapt boxplot.formula (in graphics) to accept an
> additional parameter, weights.
> I already managed to adapt boxplot.default to do this.
> 
> boxplot.formula prepares the data for a call to boxplot.default and to
> achieve that does the following: It takes a formula like
> 
>     x~g*h
> 
> as the first argument, and then by using
> 
>     m <- match.call(expand.dots = FALSE)
> 
> saves the call. It transforms the call
> 
>     m$na.action <- na.action # force use of default for this method
>     m[[1]] <- as.name("model.frame")
> 
> and then  evaluates the modified call
>     mf <- eval(m, parent.frame())
> 
>     print(m)
> gives
>     model.frame(formula = x ~ g * h)
> 
> Then it uses components of mf for the call to boxplot.default.
> 
> m has a component m$formula containing the parsed model formula.
> mode(m$formula) is "call".
> In our case, deparse(m$formula) gives a string representation of the
> formula: "x~g*h".
> I want to replace the response variable (in our case x) by the weights
> variable, which in the string expression can be done easily with
> strsplit and paste. Then I need to reconvert the modified string to a call.
> 
> So I create newmodelstring<-"weights~g*h" and try
> 
>     m$formula<-as.call(parse(newmodelstring))
> 
>     print(m)
> gives
>     model.frame(formula = weights ~ g * h())
> 
> 
> When I try to evaluate the modified m this does not work. When I try to
> evaluate m with this modification I get
> 
> Error in model.frame(formula = weights ~ g * h()) :
>         attempt to apply non-function
> 
> Is there a way to get rid of the empty parentheses at the
> end of the formula? I think then my code could work.
> 
> --
> Erich Neuwirth, Didactic Center for Computer Science
> University of Vienna
> Visit our SunSITE at http://sunsite.univie.ac.at
> Phone: +43-1-4277-39902 Fax: +43-1-4277-9399
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 

I think the preferred way to do this is using substitute although
formulas are a bit tricky in that you need to eval them after the
substitution to make sure that the object has class "formula".


> (foo <- eval(substitute(x ~ g * h, list(x = as.name("weights")))))
weights ~ g * h
> class(foo)
[1] "formula"


From erich.neuwirth at univie.ac.at  Tue Aug 23 00:45:02 2005
From: erich.neuwirth at univie.ac.at (Erich Neuwirth)
Date: Tue, 23 Aug 2005 00:45:02 +0200
Subject: [Rd] Questions about calls and formulas
In-Reply-To: <40e66e0b05082214525e2140e8@mail.gmail.com>
References: <430A4629.8010506@univie.ac.at>
	<40e66e0b05082214525e2140e8@mail.gmail.com>
Message-ID: <430A556E.4080203@univie.ac.at>

> 
>>(foo <- eval(substitute(x ~ g * h, list(x = as.name("weights")))))
> 
> weights ~ g * h
> 
>>class(foo)
> 
> [1] "formula"
> 
> 

  ff<-formula("x~g*h")
  (foo<-eval(substitute(ff,list(x=as.name("weights")))))

gives

  x ~ g * h

what needs to be done to ff for the substitution to work?

I found a way of doing it using string substitution
and applying formula (instead of as.call) to the string,
but I would like to be able to do it using substitution.

This is what I currently do:

  myexpr<-paste("weights ~",strsplit(deparse(m$formula),"~")[[1]][2])
  m$formula<-formula(myexpr)


-- 
Erich Neuwirth, Didactic Center for Computer Science
University of Vienna
Visit our SunSITE at http://sunsite.univie.ac.at
Phone: +43-1-4277-39902 Fax: +43-1-4277-9399


From ggrothendieck at gmail.com  Tue Aug 23 00:55:38 2005
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Mon, 22 Aug 2005 18:55:38 -0400
Subject: [Rd] Questions about calls and formulas
In-Reply-To: <430A556E.4080203@univie.ac.at>
References: <430A4629.8010506@univie.ac.at>
	<40e66e0b05082214525e2140e8@mail.gmail.com>
	<430A556E.4080203@univie.ac.at>
Message-ID: <971536df050822155550243049@mail.gmail.com>

On 8/22/05, Erich Neuwirth <erich.neuwirth at univie.ac.at> wrote:
> >
> >>(foo <- eval(substitute(x ~ g * h, list(x = as.name("weights")))))
> >
> > weights ~ g * h
> >
> >>class(foo)
> >
> > [1] "formula"
> >
> >
> 
>  ff<-formula("x~g*h")
>  (foo<-eval(substitute(ff,list(x=as.name("weights")))))
> 
> gives
> 
>  x ~ g * h
> 
> what needs to be done to ff for the substitution to work?
> 
> I found a way of doing it using string substitution
> and applying formula (instead of as.call) to the string,
> but I would like to be able to do it using substitution.
> 
> This is what I currently do:
> 
>  myexpr<-paste("weights ~",strsplit(deparse(m$formula),"~")[[1]][2])
>  m$formula<-formula(myexpr)

Try do.call like this:

ff <- x ~ g*h
do.call("substitute", list(ff, list(x = as.name("weight"))))


From erich.neuwirth at univie.ac.at  Tue Aug 23 01:35:24 2005
From: erich.neuwirth at univie.ac.at (Erich Neuwirth)
Date: Tue, 23 Aug 2005 01:35:24 +0200
Subject: [Rd] Questions about calls and formulas
In-Reply-To: <971536df050822155550243049@mail.gmail.com>
References: <430A4629.8010506@univie.ac.at>	<40e66e0b05082214525e2140e8@mail.gmail.com>	<430A556E.4080203@univie.ac.at>
	<971536df050822155550243049@mail.gmail.com>
Message-ID: <430A613C.5020705@univie.ac.at>

> Try do.call like this:
> 
> ff <- x ~ g*h
> do.call("substitute", list(ff, list(x = as.name("weight"))))
> 

It is even more complicated.
All I know is that ff is a formula with an expression on the left hand
side. This expression needs to be replaced by "weights".
According to the documentation, substitute only handles
replacement of variables by something else,
and that is not enough in my case.





-- 
Erich Neuwirth, Didactic Center for Computer Science
University of Vienna
Visit our SunSITE at http://sunsite.univie.ac.at
Phone: +43-1-4277-39902 Fax: +43-1-4277-9399


From charlie at stat.umn.edu  Tue Aug 23 01:57:53 2005
From: charlie at stat.umn.edu (Charles Geyer)
Date: Mon, 22 Aug 2005 18:57:53 -0500
Subject: [Rd] bizarre signif stars in Sweave latex
In-Reply-To: <Pine.LNX.4.61.0508220737470.31614@gannet.stats>
References: <mailman.9.1124618400.6983.r-devel@r-project.org>
	<20050821235504.GB32730@stat.umn.edu>
	<Pine.LNX.4.61.0508220737470.31614@gannet.stats>
Message-ID: <20050822235753.GA13762@stat.umn.edu>

On Mon, Aug 22, 2005 at 07:42:21AM +0100, Prof Brian Ripley wrote:
> What locale is this?
> 
> My guess is that this is a UTF-8 locale.

Yes.

    > Sys.getlocale()
    [1] "LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=en_US.UTF-8;LC_COLLATE=en_US.UTF-8;LC_MONETARY=en_US.UTF-8;LC_MESSAGES=en_US.UTF-8;LC_PAPER=C;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=C;LC_IDENTIFICATION=C"

> If so, you need to tell latex 
> the input is in UTF-8, which you can do in the current LaTeX release
> (you need 2003/12/01).  As I recall you do this by
> 
> \usepackage[utf8]{inputenc}

Right.  This works.

Silly me.  I fell like the drunk looking for his keys under the lamppost.
Here I was looking for a solution in the R docs, when I should have been
looking in the LaTeX Companion.
-- 
Charles Geyer
Professor, School of Statistics
University of Minnesota
charlie at stat.umn.edu


From dhinds at sonic.net  Tue Aug 23 01:34:15 2005
From: dhinds at sonic.net (dhinds@sonic.net)
Date: Mon, 22 Aug 2005 23:34:15 +0000 (UTC)
Subject: [Rd] RFC: "loop connections"
Message-ID: <dedndn$daj$1@sea.gmane.org>

I've just implemented a generalization of R's text connections, to
also support reading/writing raw binary data.  There is very little
new code to speak of.  For input connections, I wrote code to populate
the old text connection buffer from a raw vector, and provided a new
raw_read() method.  For output connections, I wrote a raw_write() to
append to a raw vector.  On input, the mode (text or binary) is
determined by the data type of the input object; on output, I use the
requested output mode (i.e. "w" / "wb").  For example:

 > con <- loopConnection("r", "wb")
 > a <- c(10,100,1000)
 > writeBin(a, con, size=4)
 > r
  [1] 00 00 20 41 00 00 c8 42 00 00 7a 44
 > close(con)
 > con <- loopConnection(r)
 > readBin(con, "double", n=3, size=4)
 [1]   10  100 1000
 > close(con)

I think "loop connection" is a better name for this sort of connection
than "text connection" was even for the old version; that confuses the
mode of the connection (text vs binary) with the mechanism (file,
socket, etc).

I've appended a patch to the end of this message.  As implemented
here, textConnection is replaced by loopConnection but functionally
this is a superset of the old textConnection.  For compatibility, one
could add:

  textConnection <- function(...) loopConnection(...)

The patch is against R-2.1.1.  I can investigate whether any changes
are required for the current development tree.  I can also update the
documentation files as required.  I thought I'd first check whether
anyone else thought this was worth inclusion before spending more time
on it.

The raw_write() code could be improved with smarter memory allocation
(grabbing bigger chunks rather than reallocating the raw vector for
every write), but this is at least a proof of principle.

-- David Hinds



--- src/main/connections.c.orig	2005-06-17 19:05:02.000000000 -0700
+++ src/main/connections.c	2005-08-22 15:54:03.156038200 -0700
@@ -1644,13 +1644,13 @@
     return ans;
 }
 
-/* ------------------- text connections --------------------- */
+/* ------------------- loop connections --------------------- */
 
 /* read a R character vector into a buffer */
 static void text_init(Rconnection con, SEXP text)
 {
     int i, nlines = length(text), nchars = 0;
-    Rtextconn this = (Rtextconn)con->private;
+    Rloopconn this = (Rloopconn)con->private;
 
     for(i = 0; i < nlines; i++)
 	nchars += strlen(CHAR(STRING_ELT(text, i))) + 1;
@@ -1668,19 +1668,35 @@
     this->cur = this->save = 0;
 }
 
-static Rboolean text_open(Rconnection con)
+/* read a R raw vector into a buffer */
+static void raw_init(Rconnection con, SEXP raw)
+{
+    int nbytes = length(raw);
+    Rloopconn this = (Rloopconn)con->private;
+
+    this->data = (char *) malloc(nbytes);
+    if(!this->data) {
+	free(this); free(con->description); free(con->class); free(con);
+	error(_("cannot allocate memory for raw connection"));
+    }
+    memcpy(this->data, RAW(raw), nbytes);
+    this->nchars = nbytes;
+    this->cur = this->save = 0;
+}
+
+static Rboolean loop_open(Rconnection con)
 {
     con->save = -1000;
     return TRUE;
 }
 
-static void text_close(Rconnection con)
+static void loop_close(Rconnection con)
 {
 }
 
-static void text_destroy(Rconnection con)
+static void loop_destroy(Rconnection con)
 {
-    Rtextconn this = (Rtextconn)con->private;
+    Rloopconn this = (Rloopconn)con->private;
 
     free(this->data);
     /* this->cur = this->nchars = 0; */
@@ -1689,7 +1705,7 @@
 
 static int text_fgetc(Rconnection con)
 {
-    Rtextconn this = (Rtextconn)con->private;
+    Rloopconn this = (Rloopconn)con->private;
     if(this->save) {
 	int c;
 	c = this->save;
@@ -1700,48 +1716,69 @@
     else return (int) (this->data[this->cur++]);
 }
 
-static double text_seek(Rconnection con, double where, int origin, int rw)
+static double loop_seek(Rconnection con, double where, int origin, int rw)
 {
-    if(where >= 0) error(_("seek is not relevant for text connection"));
+    if(where >= 0) error(_("seek is not relevant for loop connection"));
     return 0; /* if just asking, always at the beginning */
 }
 
-static Rconnection newtext(char *description, SEXP text)
+static size_t raw_read(void *ptr, size_t size, size_t nitems,
+		       Rconnection con)
+{
+    Rloopconn this = (Rloopconn)con->private;
+    if (this->cur + size*nitems > this->nchars) {
+	nitems = (this->nchars - this->cur)/size;
+	memcpy(ptr, this->data+this->cur, size*nitems);
+	this->cur = this->nchars;
+    } else {
+	memcpy(ptr, this->data+this->cur, size*nitems);
+	this->cur += size*nitems;
+    }
+    return nitems;
+}
+
+static Rconnection newloop(char *description, SEXP data)
 {
     Rconnection new;
     new = (Rconnection) malloc(sizeof(struct Rconn));
-    if(!new) error(_("allocation of text connection failed"));
-    new->class = (char *) malloc(strlen("textConnection") + 1);
+    if(!new) error(_("allocation of loop connection failed"));
+    new->class = (char *) malloc(strlen("loopConnection") + 1);
     if(!new->class) {
 	free(new);
-	error(_("allocation of text connection failed"));
+	error(_("allocation of loop connection failed"));
     }
-    strcpy(new->class, "textConnection");
+    strcpy(new->class, "loopConnection");
     new->description = (char *) malloc(strlen(description) + 1);
     if(!new->description) {
 	free(new->class); free(new);
-	error(_("allocation of text connection failed"));
+	error(_("allocation of loop connection failed"));
     }
     init_con(new, description, "r");
     new->isopen = TRUE;
     new->canwrite = FALSE;
-    new->open = &text_open;
-    new->close = &text_close;
-    new->destroy = &text_destroy;
-    new->fgetc = &text_fgetc;
-    new->seek = &text_seek;
-    new->private = (void*) malloc(sizeof(struct textconn));
+    new->open = &loop_open;
+    new->close = &loop_close;
+    new->destroy = &loop_destroy;
+    new->seek = &loop_seek;
+    new->private = (void*) malloc(sizeof(struct loopconn));
     if(!new->private) {
 	free(new->description); free(new->class); free(new);
-	error(_("allocation of text connection failed"));
+	error(_("allocation of loop connection failed"));
+    }
+    new->text = isString(data);
+    if (new->text) {
+	new->fgetc = &text_fgetc;
+	text_init(new, data);
+    } else {
+	new->read = &raw_read;
+	raw_init(new, data);
     }
-    text_init(new, text);
     return new;
 }
 
-static void outtext_close(Rconnection con)
+static void outloop_close(Rconnection con)
 {
-    Routtextconn this = (Routtextconn)con->private;
+    Routloopconn this = (Routloopconn)con->private;
     SEXP tmp;
     int idx = ConnIndex(con);
 
@@ -1755,9 +1792,9 @@
     SET_VECTOR_ELT(OutTextData, idx, R_NilValue);
 }
 
-static void outtext_destroy(Rconnection con)
+static void outloop_destroy(Rconnection con)
 {
-    Routtextconn this = (Routtextconn)con->private;
+    Routloopconn this = (Routloopconn)con->private;
     free(this->lastline); free(this);
 }
 
@@ -1765,7 +1802,7 @@
 
 static int text_vfprintf(Rconnection con, const char *format, va_list ap)
 {
-    Routtextconn this = (Routtextconn)con->private;
+    Routloopconn this = (Routloopconn)con->private;
     char buf[BUFSIZE], *b = buf, *p, *q, *vmax = vmaxget();
     int res = 0, usedRalloc = FALSE, buffree,
 	already = strlen(this->lastline);
@@ -1830,24 +1867,41 @@
     return res;
 }
 
-static void outtext_init(Rconnection con, char *mode, int idx)
+static size_t raw_write(const void *ptr, size_t size, size_t nitems,
+			Rconnection con)
+{
+    Routloopconn this = (Routloopconn)con->private;
+    SEXP tmp;
+    int idx = ConnIndex(con);
+
+    PROTECT(tmp = lengthgets(this->data, this->len + size*nitems));
+    memcpy(RAW(tmp)+this->len, ptr, size*nitems);
+    this->len += size*nitems;
+    defineVar(this->namesymbol, tmp, VECTOR_ELT(OutTextData, idx));
+    this->data = tmp;
+    UNPROTECT(1);
+    return nitems;
+}
+
+static void outloop_init(Rconnection con, char *mode, int idx)
 {
-    Routtextconn this = (Routtextconn)con->private;
+    Routloopconn this = (Routloopconn)con->private;
+    int st = (con->text ? STRSXP : RAWSXP);
     SEXP val;
 
     this->namesymbol = install(con->description);
-    if(strcmp(mode, "w") == 0) {
+    if(strncmp(mode, "w", 1) == 0) {
 	/* create variable pointed to by con->description */
-	PROTECT(val = allocVector(STRSXP, 0));
+	PROTECT(val = allocVector(st, 0));
 	defineVar(this->namesymbol, val, VECTOR_ELT(OutTextData, idx));
 	UNPROTECT(1);
     } else {
 	/* take over existing variable */
 	val = findVar1(this->namesymbol, VECTOR_ELT(OutTextData, idx),
-		       STRSXP, FALSE);
+		       st, FALSE);
 	if(val == R_UnboundValue) {
-	    warning(_("text connection: appending to a non-existent char vector"));
-	    PROTECT(val = allocVector(STRSXP, 0));
+	    warning(_("loop connection: appending to a non-existent vector"));
+	    PROTECT(val = allocVector(st, 0));
 	    defineVar(this->namesymbol, val, VECTOR_ELT(OutTextData, idx));
 	    UNPROTECT(1);
 	}
@@ -1859,49 +1913,55 @@
 }
 
 
-static Rconnection newouttext(char *description, SEXP sfile, char *mode,
+static Rconnection newoutloop(char *description, SEXP sfile, char *mode,
 			      int idx)
 {
+    int isText = (mode[1] != 'b');
     Rconnection new;
     void *tmp;
 
     new = (Rconnection) malloc(sizeof(struct Rconn));
-    if(!new) error(_("allocation of text connection failed"));
-    new->class = (char *) malloc(strlen("textConnection") + 1);
+    if(!new) error(_("allocation of loop connection failed"));
+    new->class = (char *) malloc(strlen("loopConnection") + 1);
     if(!new->class) {
 	free(new);
-	error(_("allocation of text connection failed"));
+	error(_("allocation of loop connection failed"));
     }
-    strcpy(new->class, "textConnection");
+    strcpy(new->class, "loopConnection");
     new->description = (char *) malloc(strlen(description) + 1);
     if(!new->description) {
 	free(new->class); free(new);
-	error(_("allocation of text connection failed"));
+	error(_("allocation of loop connection failed"));
     }
     init_con(new, description, mode);
+    new->text = isText;
     new->isopen = TRUE;
     new->canread = FALSE;
-    new->open = &text_open;
-    new->close = &outtext_close;
-    new->destroy = &outtext_destroy;
-    new->vfprintf = &text_vfprintf;
-    new->seek = &text_seek;
-    new->private = (void*) malloc(sizeof(struct outtextconn));
+    new->open = &loop_open;
+    new->close = &outloop_close;
+    new->destroy = &outloop_destroy;
+    new->seek = &loop_seek;
+    new->private = (void*) malloc(sizeof(struct outloopconn));
     if(!new->private) {
 	free(new->description); free(new->class); free(new);
-	error(_("allocation of text connection failed"));
+	error(_("allocation of loop connection failed"));
     }
-    ((Routtextconn)new->private)->lastline = tmp = malloc(LAST_LINE_LEN);
+    ((Routloopconn)new->private)->lastline = tmp = malloc(LAST_LINE_LEN);
     if(!tmp) {
 	free(new->private);
 	free(new->description); free(new->class); free(new);
-	error(_("allocation of text connection failed"));
+	error(_("allocation of loop connection failed"));
     }
-    outtext_init(new, mode, idx);
+    if (isText) {
+	new->vfprintf = &text_vfprintf;
+    } else {
+	new->write = &raw_write;
+    }
+    outloop_init(new, mode, idx);
     return new;
 }
 
-SEXP do_textconnection(SEXP call, SEXP op, SEXP args, SEXP env)
+SEXP do_loopconnection(SEXP call, SEXP op, SEXP args, SEXP env)
 {
     SEXP sfile, stext, sopen, ans, class, venv;
     char *desc, *open;
@@ -1914,8 +1974,6 @@
 	error(_("invalid 'description' argument"));
     desc = CHAR(STRING_ELT(sfile, 0));
     stext = CADR(args);
-    if(!isString(stext))
-	error(_("invalid 'text' argument"));
     sopen = CADDR(args);
     if(!isString(sopen) || length(sopen) != 1)
     error(_("invalid 'open' argument"));
@@ -1924,16 +1982,20 @@
     if (!isEnvironment(venv) && venv != R_NilValue)
 	error(_("invalid 'environment' argument"));
     ncon = NextConnection();
-    if(!strlen(open) || strncmp(open, "r", 1) == 0)
-	con = Connections[ncon] = newtext(desc, stext);
-    else if (strncmp(open, "w", 1) == 0 || strncmp(open, "a", 1) == 0) {
+    if(!strlen(open) || strncmp(open, "r", 1) == 0) {
+	if(!isString(stext) && (TYPEOF(stext) != RAWSXP))
+	    error(_("invalid 'object' argument"));
+	con = Connections[ncon] = newloop(desc, stext);
+    } else if (strncmp(open, "w", 1) == 0 || strncmp(open, "a", 1) == 0) {
+	if(!isString(stext))
+	    error(_("invalid 'object' argument"));
 	if (OutTextData == NULL) {
 	    OutTextData = allocVector(VECSXP, NCONNECTIONS);
 	    R_PreserveObject(OutTextData);
 	}
 	SET_VECTOR_ELT(OutTextData, ncon, venv);
 	con = Connections[ncon] =
-	    newouttext(CHAR(STRING_ELT(stext, 0)), sfile, open, ncon);
+	    newoutloop(CHAR(STRING_ELT(stext, 0)), sfile, open, ncon);
     }
     else
 	errorcall(call, _("unsupported mode"));
@@ -1942,7 +2004,7 @@
     PROTECT(ans = allocVector(INTSXP, 1));
     INTEGER(ans)[0] = ncon;
     PROTECT(class = allocVector(STRSXP, 2));
-    SET_STRING_ELT(class, 0, mkChar("textConnection"));
+    SET_STRING_ELT(class, 0, mkChar("loopConnection"));
     SET_STRING_ELT(class, 1, mkChar("connection"));
     classgets(ans, class);
     UNPROTECT(2);
--- src/main/names.c.orig	2005-05-20 05:51:46.000000000 -0700
+++ src/main/names.c	2005-08-22 15:59:47.968828400 -0700
@@ -866,7 +866,7 @@
 {"pushBack", 	do_pushback,	0,      11,     3,      {PP_FUNCALL, PREC_FN,	0}},
 {"clearPushBackLength",do_clearpushback,0,  11,     1,      {PP_FUNCALL, PREC_FN,	0}},
 {"pushBackLength",do_pushbacklength,0,  11,     1,      {PP_FUNCALL, PREC_FN,	0}},
-{"textConnection",do_textconnection,0,	11,     4,      {PP_FUNCALL, PREC_FN,	0}},
+{"loopConnection",do_loopconnection,0,	11,     4,      {PP_FUNCALL, PREC_FN,	0}},
 {"socketConnection",do_sockconn,0,	11,     6,      {PP_FUNCALL, PREC_FN,	0}},
 {"sockSelect",do_sockselect,0,	11,     3,      {PP_FUNCALL, PREC_FN,	0}},
 {"getAllConnections",do_getallconnections,0,11, 0,      {PP_FUNCALL, PREC_FN,	0}},
--- src/include/Rconnections.h.orig	2005-04-18 04:34:02.000000000 -0700
+++ src/include/Rconnections.h	2005-08-22 15:40:02.582767400 -0700
@@ -82,19 +82,19 @@
     int cp;
 } *Rgzfileconn;
 
-typedef struct textconn {
+typedef struct loopconn {
     char *data;  /* all the data */
     int cur, nchars; /* current pos and number of chars */
     char save; /* pushback */
-} *Rtextconn;
+} *Rloopconn;
 
-typedef struct outtextconn {
+typedef struct outloopconn {
     int len;  /* number of lines */
     SEXP namesymbol;
     SEXP data;
     char *lastline;
     int lastlinelength; /* buffer size */
-} *Routtextconn;
+} *Routloopconn;
 
 typedef enum {HTTPsh, FTPsh} UrlScheme;
 
--- src/library/base/R/connections.R.orig	2005-04-18 04:34:17.000000000 -0700
+++ src/library/base/R/connections.R	2005-08-22 16:18:22.095231400 -0700
@@ -83,10 +83,10 @@
                              encoding = getOption("encoding"))
     .Internal(socketConnection(host, port, server, blocking, open, encoding))
 
-textConnection <- function(object, open = "r", local = FALSE) {
+loopConnection <- function(object, open = "r", local = FALSE) {
     if (local) env <- parent.frame()
     else env <- .GlobalEnv
-    .Internal(textConnection(deparse(substitute(object)), object, open, env))
+    .Internal(loopConnection(deparse(substitute(object)), object, open, env))
 }
 
 seek <- function(con, ...)


From murdoch at stats.uwo.ca  Tue Aug 23 04:21:50 2005
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Mon, 22 Aug 2005 22:21:50 -0400
Subject: [Rd] Questions about calls and formulas
In-Reply-To: <430A613C.5020705@univie.ac.at>
References: <430A4629.8010506@univie.ac.at>	<40e66e0b05082214525e2140e8@mail.gmail.com>	<430A556E.4080203@univie.ac.at>	<971536df050822155550243049@mail.gmail.com>
	<430A613C.5020705@univie.ac.at>
Message-ID: <430A883E.5040005@stats.uwo.ca>

Erich Neuwirth wrote:
>>Try do.call like this:
>>
>>ff <- x ~ g*h
>>do.call("substitute", list(ff, list(x = as.name("weight"))))
>>
> 
> 
> It is even more complicated.
> All I know is that ff is a formula with an expression on the left hand
> side. This expression needs to be replaced by "weights".
> According to the documentation, substitute only handles
> replacement of variables by something else,
> and that is not enough in my case.

That may make it simpler.  For example:

 > ff <- x ~ g*h
 > ff[[2]]
x
 > ff[[2]] <- as.name("weights")
 > ff
weights ~ g * h


If you know that ff is a formula with an expression on the left that you 
want to replace with "weights", then ff[[2]] <- as.name("weights")
will work.  (ff[[1]] is the tilde, ff[[3]] is the RHS.  You'll probably 
want some sanity checks in your code to confirm this.)

Duncan Murdoch


From h.wickham at gmail.com  Tue Aug 23 04:58:12 2005
From: h.wickham at gmail.com (hadley wickham)
Date: Mon, 22 Aug 2005 21:58:12 -0500
Subject: [Rd] Functions with the same name: best practices
Message-ID: <f8e6ff05050822195854575b4d@mail.gmail.com>

Ok, here's another best practices question - let's say I'm writing a
package and I want to use a function name that is already claimed by a
function in the base R packages.  For the sake of argument, let's
pretend this function is for profiling the performance of a function
(like Rprof for example), and so an obvious name that comes to mind is
profile.  This, of course, clashes with the built in profile for
"investigating behavior of objective function near the solution
represented by fitted."

A little thinking and a quick survey of other packages reveal some
possible solutions:

 * capitalise the function differently (eg. Profile)
 * use a prefix/suffic (eg. Rprof)
 * use a thesaurus
 * use namespaces (and rely on others to use namespaces correctly in
their code/packages)

What would you suggest?

Thanks again,

Hadley


From ggrothendieck at gmail.com  Tue Aug 23 05:19:28 2005
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Mon, 22 Aug 2005 23:19:28 -0400
Subject: [Rd] Functions with the same name: best practices
In-Reply-To: <f8e6ff05050822195854575b4d@mail.gmail.com>
References: <f8e6ff05050822195854575b4d@mail.gmail.com>
Message-ID: <971536df05082220191600ac8@mail.gmail.com>

On 8/22/05, hadley wickham <h.wickham at gmail.com> wrote:
> Ok, here's another best practices question - let's say I'm writing a
> package and I want to use a function name that is already claimed by a
> function in the base R packages.  For the sake of argument, let's
> pretend this function is for profiling the performance of a function
> (like Rprof for example), and so an obvious name that comes to mind is
> profile.  This, of course, clashes with the built in profile for
> "investigating behavior of objective function near the solution
> represented by fitted."
> 
> A little thinking and a quick survey of other packages reveal some
> possible solutions:
> 
>  * capitalise the function differently (eg. Profile)
>  * use a prefix/suffic (eg. Rprof)
>  * use a thesaurus
>  * use namespaces (and rely on others to use namespaces correctly in
> their code/packages)
> 
> What would you suggest?
> 

profile is a generic so if your function has the same purpose but for a 
different class you can just create a new method.


From Mark.Bravington at csiro.au  Tue Aug 23 07:23:27 2005
From: Mark.Bravington at csiro.au (Mark.Bravington@csiro.au)
Date: Tue, 23 Aug 2005 15:23:27 +1000
Subject: [Rd] TCITex and R
Message-ID: <D79013E40FEF254AAF0D72DFC94F274803D889@extas4-hba.tas.csiro.au>

Several times my packages have fallen foul of the latex check at the
uploading-to-CRAN stage, creating extra work for Kurt Hornik. I've never
bothered trying to get latex working on my own packages (happy with
vanilla help) but am told that "latex is the closest thing to a syntax
checker for Rd files" and that I should set it up. Now, there is already
a latex on my (Windows XP) system thanks to the program Scientific Word,
which comes with TCITex. However, RCMD etc don't recognize this latex at
the moment. Does anyone have any advice on what might be needed to make
RCMD use SciWord's installation of TCITex-- paths, environment
variables, etc etc?

Various R docs recommend fptex or MikTex implementations of latex, but
I'm a bit reluctant to put these on, primarily in case doing so somehow
stuffs up the workings of Scientific Word in a way that I don't know
enough to fix. In case it's not obvious already, I should add that I am
blissfully ignorant about how latex works-- that's one of my reasons for
using Scientific Word.

Thanks for any advice

Mark

Mark Bravington
CSIRO Mathematical & Information Sciences
Marine Laboratory
Castray Esplanade
Hobart 7001
TAS

ph (+61) 3 6232 5118
fax (+61) 3 6232 5012
mob (+61) 438 315 623


From n.shah at decisioncraft.com  Tue Aug 23 08:00:01 2005
From: n.shah at decisioncraft.com (Nikhil Shah)
Date: Tue, 23 Aug 2005 11:30:01 +0530
Subject: [Rd] Fetching Warning Messages
References: <003301c5a72d$f1badf50$7900a8c0@dca.com>
	<Pine.LNX.4.61.0508221634470.16868@gannet.stats>
Message-ID: <00c901c5a7a7$ef175d30$7900a8c0@dca.com>

Hi,

    I read the help page and saw that warnings() actually prints the warning
message and stores warning in top-level variable "last.warning". So it seems
that it is almost impossible to access last warning from java code. I got
another solution of fetching warning messages by storing warning messages in
a file and reading the file later. This can be done by using sink() command,
but before that options(warn=1) must be set.

> Please read the help page on options("warn") and see what warnings()
> does. (I am pretty sure you have asked this and been told before.)
>
> There should not be an object called last.warning in your example.
>

    I read help page

> On Mon, 22 Aug 2005, Nikhil Shah wrote:
>
> > Hi,
> >
> >    I am facing one problem of fetching R warning messages in Java Code
> > using Rserve. It is easier to trap R Error messages by using catching
> > RSrvException. I came to know one way of fetching R Warning messages,
i.e.
> > using "withCallingHandlers", below is my Java Program, which uses
> > withCallingHandlers of R :
> > import org.rosuda.JRclient.*;
> >
> > ---------------------------RWarning.java-----------------------
> > class RWarning
> > {
> >   public static void main(String args[])
> >  {
> >     try
> >     {
> >       String hostName = null;
> >       hostName = args[0];
> >       Rconnection c = new Rconnection(hostName);
> >       c.voidEval("lastWarning <- NULL");
> >       c.voidEval("withCallingHandlers(
> > {x<-sqrt(-9);y<-matrix(1:9,ncol=4);z<-sqrt(4)} , warning = function (w)
{
> > lastWarning <<- paste(lastWarning,as.character(w))})"); //This will
generate
> > warning message[sqrt(-9)], another warning message [
matrix(1:9,ncol=4) ]
> > and successful completion [ sqrt(4) ]
> >        System.out.println(c.eval("z").asDouble());
> >        System.out.println(c.eval("lastWarning").asString());
> >        c.close();
> >        System.out.println("DONE");
> >      }
> >      catch(RSrvException  e)
> >      {
> >         System.out.println("Error : " + e.getMessage());
> >         e.printStackTrace();
> >      }
> >   }
> > }
> > ---------------------------End Of RWarning.java-----------------------
> >
> > Output of above program is (as expected) :
> >
> > 2.0
> > simpleWarning in sqrt(-9): NaNs produced
> > simpleWarning: data length [9] is not a sub-multiple or multiple of the
> > number of columns [4] in matrix
> >
> > DONE
> >
> >
> >
> >     Now my query is that if there is any way of using warnings()
function
> > in Java Program to fetch all warnings. I used it in my program but
returns
> > me NULL instead of warning messages. I also used last.warning but it
Java
> > Program gives an error saying that last.warning object is not found. I
have
> > pasted both the java code below :
> >
> > This is the java program that I have written to use "last.warning"
object of
> > R. Please explain me where the error could be.
> >
> > ------------Code of RWarning1.java----------------
> >
> > import org.rosuda.JRclient.*;
> >
> > class RWarning1
> > {
> >  public static void main(String args[])
> >  {
> >    try
> >    {
> >      String hostName = null;
> >      hostName = args[0];
> >      Rconnection c = new Rconnection(hostName);
> >      System.out.println(c.eval("x<-sqrt(-9)").asString());
> >      System.out.println(c.eval("last.warning").asString());
> >      c.close();
> >      System.out.println("DONE");
> >    }
> >    catch(RSrvException  e)
> >    {
> >      System.out.println("Error : " + e.getMessage());
> >      e.printStackTrace();
> >    }
> >  }
> > }
> > ------------End of code of RWarning1.java------------------
> >
> > output of RWarning1.class
> >
> > null
> > Error : Request return code: 127 [request status: Error (127)]
> > org.rosuda.JRclient.RSrvException: Request return code: 127 [request
status:
> > Err
> > or (127)]
> >        at org.rosuda.JRclient.Rconnection.eval(Rconnection.java:190)
> >        at RWarning.main(RWarning.java:13)
> >
> > In other words, when I use "last.warning" in eval method, I simply get
an
> > exception, instead of value of last.warning.
> >
> >
> > Below is the java code of using warnings() function.
> >
> > ------------Code of RWarning2.java----------------
> >
> > import org.rosuda.JRclient.*;
> >
> > class RWarning2
> > {
> >  public static void main(String args[])
> >  {
> >  try
> >  {
> >    String hostName = null;
> >    hostName = args[0];
> >    Rconnection c = new Rconnection(hostName);
> >    System.out.println(c.eval("x<-sqrt(-9)").asString());
> >
> >
System.out.println(c.eval("paste(capture.output(warnings()),collapse='\n')")
> > .asString());
> >    c.close();
> >    System.out.println("DONE");
> >  }
> >  catch(RSrvException  e)
> >  {
> >    System.out.println("Error : " + e.getMessage());
> >    e.printStackTrace();
> >  }
> > }
> > }
> > ------------End of code of RWarning2.java------------------
> > output of RWarning2.class
> >
> > null
> > NULL
> > DONE
> >
> >
> >  Please let me know where I am making mistake.
> >
> > Regards,
> >
> > Nikhil Shah
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >
> >
>
> -- 
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>

Regards,

Nikhil Shah


From ripley at stats.ox.ac.uk  Tue Aug 23 08:38:34 2005
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 23 Aug 2005 07:38:34 +0100 (BST)
Subject: [Rd] Functions with the same name: best practices
In-Reply-To: <f8e6ff05050822195854575b4d@mail.gmail.com>
References: <f8e6ff05050822195854575b4d@mail.gmail.com>
Message-ID: <Pine.LNX.4.61.0508230726370.32468@gannet.stats>

It depends on the example, as you might guess.

profile() is a generic function in stats.  Namespaces are not going to 
help there, as it is normally called by users (it is also called by some 
confint() methods, and that will be protected by namespaces).

For functions intended to be used by end-users, I think there is little 
choice but to have distinct names.  For other functions, you would not 
need to export them from the namespace of your package, and then probably 
the nameclash would be of little consequence.  However, even there beware 
of examples like Adai's with 'df', where model.frame() found that object 
in the package rather than in his workspace.

On Mon, 22 Aug 2005, hadley wickham wrote:

> Ok, here's another best practices question - let's say I'm writing a
> package and I want to use a function name that is already claimed by a
> function in the base R packages.  For the sake of argument, let's
> pretend this function is for profiling the performance of a function
> (like Rprof for example), and so an obvious name that comes to mind is
> profile.  This, of course, clashes with the built in profile for
> "investigating behavior of objective function near the solution
> represented by fitted."
>
> A little thinking and a quick survey of other packages reveal some
> possible solutions:
>
> * capitalise the function differently (eg. Profile)
> * use a prefix/suffic (eg. Rprof)
> * use a thesaurus
> * use namespaces (and rely on others to use namespaces correctly in
> their code/packages)
>
> What would you suggest?
>
> Thanks again,
>
> Hadley
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From hb at maths.lth.se  Tue Aug 23 11:00:29 2005
From: hb at maths.lth.se (Henrik Bengtsson)
Date: Tue, 23 Aug 2005 11:00:29 +0200
Subject: [Rd] Fetching Warning Messages
In-Reply-To: <00c901c5a7a7$ef175d30$7900a8c0@dca.com>
References: <003301c5a72d$f1badf50$7900a8c0@dca.com>	<Pine.LNX.4.61.0508221634470.16868@gannet.stats>
	<00c901c5a7a7$ef175d30$7900a8c0@dca.com>
Message-ID: <430AE5AD.10607@maths.lth.se>

Did you get my reply to you on Aug 13 on withCallingHandlers()?

  https://stat.ethz.ch/pipermail/r-devel/2005-August/034189.html

/Henrik


Nikhil Shah wrote:
> Hi,
> 
>     I read the help page and saw that warnings() actually prints the warning
> message and stores warning in top-level variable "last.warning". So it seems
> that it is almost impossible to access last warning from java code. I got
> another solution of fetching warning messages by storing warning messages in
> a file and reading the file later. This can be done by using sink() command,
> but before that options(warn=1) must be set.
> 
> 
>>Please read the help page on options("warn") and see what warnings()
>>does. (I am pretty sure you have asked this and been told before.)
>>
>>There should not be an object called last.warning in your example.
>>
> 
> 
>     I read help page
> 
> 
>>On Mon, 22 Aug 2005, Nikhil Shah wrote:
>>
>>
>>>Hi,
>>>
>>>   I am facing one problem of fetching R warning messages in Java Code
>>>using Rserve. It is easier to trap R Error messages by using catching
>>>RSrvException. I came to know one way of fetching R Warning messages,
> 
> i.e.
> 
>>>using "withCallingHandlers", below is my Java Program, which uses
>>>withCallingHandlers of R :
>>>import org.rosuda.JRclient.*;
>>>
>>>---------------------------RWarning.java-----------------------
>>>class RWarning
>>>{
>>>  public static void main(String args[])
>>> {
>>>    try
>>>    {
>>>      String hostName = null;
>>>      hostName = args[0];
>>>      Rconnection c = new Rconnection(hostName);
>>>      c.voidEval("lastWarning <- NULL");
>>>      c.voidEval("withCallingHandlers(
>>>{x<-sqrt(-9);y<-matrix(1:9,ncol=4);z<-sqrt(4)} , warning = function (w)
> 
> {
> 
>>>lastWarning <<- paste(lastWarning,as.character(w))})"); //This will
> 
> generate
> 
>>>warning message[sqrt(-9)], another warning message [
> 
> matrix(1:9,ncol=4) ]
> 
>>>and successful completion [ sqrt(4) ]
>>>       System.out.println(c.eval("z").asDouble());
>>>       System.out.println(c.eval("lastWarning").asString());
>>>       c.close();
>>>       System.out.println("DONE");
>>>     }
>>>     catch(RSrvException  e)
>>>     {
>>>        System.out.println("Error : " + e.getMessage());
>>>        e.printStackTrace();
>>>     }
>>>  }
>>>}
>>>---------------------------End Of RWarning.java-----------------------
>>>
>>>Output of above program is (as expected) :
>>>
>>>2.0
>>>simpleWarning in sqrt(-9): NaNs produced
>>>simpleWarning: data length [9] is not a sub-multiple or multiple of the
>>>number of columns [4] in matrix
>>>
>>>DONE
>>>
>>>
>>>
>>>    Now my query is that if there is any way of using warnings()
> 
> function
> 
>>>in Java Program to fetch all warnings. I used it in my program but
> 
> returns
> 
>>>me NULL instead of warning messages. I also used last.warning but it
> 
> Java
> 
>>>Program gives an error saying that last.warning object is not found. I
> 
> have
> 
>>>pasted both the java code below :
>>>
>>>This is the java program that I have written to use "last.warning"
> 
> object of
> 
>>>R. Please explain me where the error could be.
>>>
>>>------------Code of RWarning1.java----------------
>>>
>>>import org.rosuda.JRclient.*;
>>>
>>>class RWarning1
>>>{
>>> public static void main(String args[])
>>> {
>>>   try
>>>   {
>>>     String hostName = null;
>>>     hostName = args[0];
>>>     Rconnection c = new Rconnection(hostName);
>>>     System.out.println(c.eval("x<-sqrt(-9)").asString());
>>>     System.out.println(c.eval("last.warning").asString());
>>>     c.close();
>>>     System.out.println("DONE");
>>>   }
>>>   catch(RSrvException  e)
>>>   {
>>>     System.out.println("Error : " + e.getMessage());
>>>     e.printStackTrace();
>>>   }
>>> }
>>>}
>>>------------End of code of RWarning1.java------------------
>>>
>>>output of RWarning1.class
>>>
>>>null
>>>Error : Request return code: 127 [request status: Error (127)]
>>>org.rosuda.JRclient.RSrvException: Request return code: 127 [request
> 
> status:
> 
>>>Err
>>>or (127)]
>>>       at org.rosuda.JRclient.Rconnection.eval(Rconnection.java:190)
>>>       at RWarning.main(RWarning.java:13)
>>>
>>>In other words, when I use "last.warning" in eval method, I simply get
> 
> an
> 
>>>exception, instead of value of last.warning.
>>>
>>>
>>>Below is the java code of using warnings() function.
>>>
>>>------------Code of RWarning2.java----------------
>>>
>>>import org.rosuda.JRclient.*;
>>>
>>>class RWarning2
>>>{
>>> public static void main(String args[])
>>> {
>>> try
>>> {
>>>   String hostName = null;
>>>   hostName = args[0];
>>>   Rconnection c = new Rconnection(hostName);
>>>   System.out.println(c.eval("x<-sqrt(-9)").asString());
>>>
>>>
> 
> System.out.println(c.eval("paste(capture.output(warnings()),collapse='\n')")
> 
>>>.asString());
>>>   c.close();
>>>   System.out.println("DONE");
>>> }
>>> catch(RSrvException  e)
>>> {
>>>   System.out.println("Error : " + e.getMessage());
>>>   e.printStackTrace();
>>> }
>>>}
>>>}
>>>------------End of code of RWarning2.java------------------
>>>output of RWarning2.class
>>>
>>>null
>>>NULL
>>>DONE
>>>
>>>
>>> Please let me know where I am making mistake.
>>>
>>>Regards,
>>>
>>>Nikhil Shah
>>>
>>>______________________________________________
>>>R-devel at r-project.org mailing list
>>>https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>>
>>
>>-- 
>>Brian D. Ripley,                  ripley at stats.ox.ac.uk
>>Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
>>University of Oxford,             Tel:  +44 1865 272861 (self)
>>1 South Parks Road,                     +44 1865 272866 (PA)
>>Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>>
> 
> 
> Regards,
> 
> Nikhil Shah
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
>


From duncan at wald.ucdavis.edu  Sun Aug 21 17:47:48 2005
From: duncan at wald.ucdavis.edu (Duncan Temple Lang)
Date: Sun, 21 Aug 2005 08:47:48 -0700
Subject: [Rd] IPC
In-Reply-To: <1124628383.20671.49.camel@schrodinger>
References: <1124628383.20671.49.camel@schrodinger>
Message-ID: <20050821154748.GD21511@wald.ucdavis.edu>

Nigel Sim wrote:
> Hi, I need to somehow make R communicate with another remote JAVA
> process which provides compute services. I have control over the
> communications protocol, but I would like to keep it to a standardised
> protocol, such as SOAP, CORBA, etc. 
> 
> What I would like to know is, what do other people use to do this? The
> nature of the communications will be low bandwidth procedure calls, with
> little data. (The data is stored in a DBMS). To date I have tried the
> RCORBA and SSOAP packages. Corba I couldn't get to compile, and soap I
> couldn't get to talk properly to soapanywhere (the embedded soap
> implementation I am trialing). 


Can you let me know what went wrong with SSOAP? It would be
good to fix this and I am about to turn my attention to it anyway.

As for the "RCORBA" package - what precisely are you referring to?
I don't think there is a package named RCORBA, perhaps you mean
RSCORBA.  If so, yes it is quite old. It can be updated
and indeed I have a plan that I might connect it to Orbit.
But if RSCORBA didn't compile, you might want to mention which
CORBA implementation you were trying to use: it was setup to use 
3.



As for what people typically use to connect to Java.
There is Rserve. There is RSJava.
I think your desire to use a standard protocol is a very 
good one. There are far too many ad hoc solutions that don't
do have limited functionality, such as callbacks.
On Windows, DCOM client and server  and event packages are available.
And there are MPI or PVM packages which implement a form of IPC.

Do you absolutely need to have a middle-tier of going through
the server to get to the DBMS?  It is often a good design,
but if you can go straight to the DBMS, then that would be
esier and more efficient.


Please let me know what went wrong with the SSOAP package.

 D.


> 
> I'm sure with persistence I can get both working, but I would like to
> hear others experiences before I invest the time.
> 
> Thank you for your time.
> -- 
> Nigel Sim
> 
> PhD Candidate
> School of Mathematics and Physical Sciences
> James Cook University
> +61 7 4781 4247
> +61 409 277 641
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Duncan Temple Lang                duncan at wald.ucdavis.edu
Department of Statistics          work:  (530) 752-4782
371 Kerr Hall                     fax:   (530) 752-7099
One Shields Ave.
University of California at Davis
Davis, CA 95616, USA



-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
Url : https://stat.ethz.ch/pipermail/r-devel/attachments/20050821/0006a6bf/attachment.bin

From duncan at wald.ucdavis.edu  Sun Aug 21 17:40:01 2005
From: duncan at wald.ucdavis.edu (Duncan Temple Lang)
Date: Sun, 21 Aug 2005 08:40:01 -0700
Subject: [Rd] IPC
In-Reply-To: <8ed68eed05082106117545e667@mail.gmail.com>
References: <1124628383.20671.49.camel@schrodinger>
	<8ed68eed05082106117545e667@mail.gmail.com>
Message-ID: <20050821154001.GC21511@wald.ucdavis.edu>

Sean O'Riordain wrote:
> for very low bandwidth IPC I'd just use a standard web page form using
> a GET... so all you have to do is call a URL with the parameters
> embedded in the URL, e.g.
> 
> http://silly.name.for.server.com/javaServlet?a=42&b=394&c=1982&d=complex
> 
> If your bandwidth requirements are a bit higher then you have to start
> using POST which is a bit more complicated though... so at that stage
> I might use SOAP.

POST is not equivalent to SOAP.  SOAP uses POST.

In order to avoid all the details dealing with HTTP requests
such as escaping characters, SSL, passwords, POST/GET, etc., it is simplest
to use something that already takes care of  these.
The RCurl package (www.omegahat.org/RCurl) is in interface libcurl which takes care of
so many of these details.  httpRequest (regular CRAN package) is implemented entirely
within R, but doesn't handle as many of these extra details.

  D.

> 
> cheers!
> Sean
> 
> On 21/08/05, Nigel Sim <nigel.sim at jcu.edu.au> wrote:
> > Hi, I need to somehow make R communicate with another remote JAVA
> > process which provides compute services. I have control over the
> > communications protocol, but I would like to keep it to a standardised
> > protocol, such as SOAP, CORBA, etc.
> > 
> > What I would like to know is, what do other people use to do this? The
> > nature of the communications will be low bandwidth procedure calls, with
> > little data. (The data is stored in a DBMS). To date I have tried the
> > RCORBA and SSOAP packages. Corba I couldn't get to compile, and soap I
> > couldn't get to talk properly to soapanywhere (the embedded soap
> > implementation I am trialing).
> > 
> > I'm sure with persistence I can get both working, but I would like to
> > hear others experiences before I invest the time.
> > 
> > Thank you for your time.
> > --
> > Nigel Sim
> > 
> > PhD Candidate
> > School of Mathematics and Physical Sciences
> > James Cook University
> > +61 7 4781 4247
> > +61 409 277 641
> > 
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Duncan Temple Lang                duncan at wald.ucdavis.edu
Department of Statistics          work:  (530) 752-4782
371 Kerr Hall                     fax:   (530) 752-7099
One Shields Ave.
University of California at Davis
Davis, CA 95616, USA



-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
Url : https://stat.ethz.ch/pipermail/r-devel/attachments/20050821/53541927/attachment.bin

From maechler at stat.math.ethz.ch  Tue Aug 23 11:21:23 2005
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Tue, 23 Aug 2005 11:21:23 +0200
Subject: [Rd] do.call(): no need for quote {was .. Questions about calls..}
In-Reply-To: <971536df050822155550243049@mail.gmail.com>
References: <430A4629.8010506@univie.ac.at>
	<40e66e0b05082214525e2140e8@mail.gmail.com>
	<430A556E.4080203@univie.ac.at>
	<971536df050822155550243049@mail.gmail.com>
Message-ID: <17162.60051.935766.508861@stat.math.ethz.ch>

>>>>> "Gabor" == Gabor Grothendieck <ggrothendieck at gmail.com>
>>>>>     on Mon, 22 Aug 2005 18:55:38 -0400 writes:

   ..................

    Gabor> Try do.call like this:

    Gabor> ff <- x ~ g*h 
    Gabor> do.call("substitute", list(ff, list(x = as.name("weight"))))

Just a small remark: For all those who -- like me -- have found
it  ``unpleasant'' to have to quote the first argument of do.call():
You don't have to any longer since the NEWS of R 2.1.0 contains

    o	do.call() now takes either a function or a character string as
	its first argument.  The supplied arguments can optionally be
	quoted.

So the above could be 

   do.call(substitute, list(ff, list(x = as.name("weight"))))

--
Martin


From murdoch at stats.uwo.ca  Tue Aug 23 12:16:31 2005
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Tue, 23 Aug 2005 06:16:31 -0400
Subject: [Rd] Functions with the same name: best practices
In-Reply-To: <f8e6ff05050822195854575b4d@mail.gmail.com>
References: <f8e6ff05050822195854575b4d@mail.gmail.com>
Message-ID: <430AF77F.8090402@stats.uwo.ca>

hadley wickham wrote:
> Ok, here's another best practices question - let's say I'm writing a
> package and I want to use a function name that is already claimed by a
> function in the base R packages.  For the sake of argument, let's
> pretend this function is for profiling the performance of a function
> (like Rprof for example), and so an obvious name that comes to mind is
> profile.  This, of course, clashes with the built in profile for
> "investigating behavior of objective function near the solution
> represented by fitted."
> 
> A little thinking and a quick survey of other packages reveal some
> possible solutions:
> 
>  * capitalise the function differently (eg. Profile)
>  * use a prefix/suffic (eg. Rprof)
>  * use a thesaurus
>  * use namespaces (and rely on others to use namespaces correctly in
> their code/packages)
> 
> What would you suggest?

You should use a namespace.  It will protect your code against someone 
else using one of your function names.

If the function is for internal use only, that's sufficient.  If you 
want to export the function, you should try to avoid conflicting with 
existing functions that you expect users to have installed, because it 
becomes quite inconvenient to users:  their scripts depend on the load 
order of packages unless they put <pkg>:: in front of each call.

I think using a thesaurus would be best (if by that you mean choosing a 
different name that still describes the function), but will often fail, 
in which case I'd use the prefix/suffix decoration.  Changing only 
capitalization makes it nearly impossible to talk about your function 
without confusion.

Duncan Murdoch


From murdoch at stats.uwo.ca  Tue Aug 23 12:26:52 2005
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Tue, 23 Aug 2005 06:26:52 -0400
Subject: [Rd] TCITex and R
In-Reply-To: <D79013E40FEF254AAF0D72DFC94F274803D889@extas4-hba.tas.csiro.au>
References: <D79013E40FEF254AAF0D72DFC94F274803D889@extas4-hba.tas.csiro.au>
Message-ID: <430AF9EC.30406@stats.uwo.ca>

Mark.Bravington at csiro.au wrote:
> Several times my packages have fallen foul of the latex check at the
> uploading-to-CRAN stage, creating extra work for Kurt Hornik. I've never
> bothered trying to get latex working on my own packages (happy with
> vanilla help) but am told that "latex is the closest thing to a syntax
> checker for Rd files" and that I should set it up. Now, there is already
> a latex on my (Windows XP) system thanks to the program Scientific Word,
> which comes with TCITex. However, RCMD etc don't recognize this latex at
> the moment. Does anyone have any advice on what might be needed to make
> RCMD use SciWord's installation of TCITex-- paths, environment
> variables, etc etc?

I have no experience with TCITex, but what you need to do is make sure 
the commands that R needs are on your path.  Those include "latex", 
"pdflatex", and possibly others I've forgotten:  try building a binary 
copy of your package and you'll get errors if you haven't got them in place.

You also need that TCITex follows the usual practice of using an 
environment variable to accept additional directories to search.  MikTex 
doesn't, and it causes lots of trouble for people.  This is the main 
reason I haven't recommended MikTex over fptex even though I use it; 
MikTex seems less stable about its interface.

Duncan Murdoch
> 
> Various R docs recommend fptex or MikTex implementations of latex, but
> I'm a bit reluctant to put these on, primarily in case doing so somehow
> stuffs up the workings of Scientific Word in a way that I don't know
> enough to fix. In case it's not obvious already, I should add that I am
> blissfully ignorant about how latex works-- that's one of my reasons for
> using Scientific Word.
> 
> Thanks for any advice
> 
> Mark
> 
> Mark Bravington
> CSIRO Mathematical & Information Sciences
> Marine Laboratory
> Castray Esplanade
> Hobart 7001
> TAS
> 
> ph (+61) 3 6232 5118
> fax (+61) 3 6232 5012
> mob (+61) 438 315 623
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From aleszib at gmail.com  Tue Aug 23 13:11:25 2005
From: aleszib at gmail.com (Ales Ziberna)
Date: Tue, 23 Aug 2005 13:11:25 +0200
Subject: [Rd] Which TEX for Wiindows
References: <D79013E40FEF254AAF0D72DFC94F274803D889@extas4-hba.tas.csiro.au>
	<430AF9EC.30406@stats.uwo.ca>
Message-ID: <018201c5a7d3$6cb35fc0$598debd4@ales>

I am intending to instal TEX (for use with R - building, checking packages) 
on my WinXP SP2. I read that fptex is recomended, however 
http://www.fptex.org/ is not not available. Is MiKTeX the next best choice?

Thanks in advance for any suggestions!
Ales Ziberna


From ggrothendieck at gmail.com  Tue Aug 23 13:16:02 2005
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Tue, 23 Aug 2005 07:16:02 -0400
Subject: [Rd] do.call(): no need for quote {was .. Questions about
	calls..}
In-Reply-To: <17162.60051.935766.508861@stat.math.ethz.ch>
References: <430A4629.8010506@univie.ac.at>
	<40e66e0b05082214525e2140e8@mail.gmail.com>
	<430A556E.4080203@univie.ac.at>
	<971536df050822155550243049@mail.gmail.com>
	<17162.60051.935766.508861@stat.math.ethz.ch>
Message-ID: <971536df05082304163df135e@mail.gmail.com>

On 8/23/05, Martin Maechler <maechler at stat.math.ethz.ch> wrote:
> >>>>> "Gabor" == Gabor Grothendieck <ggrothendieck at gmail.com>
> >>>>>     on Mon, 22 Aug 2005 18:55:38 -0400 writes:
> 
>   ..................
> 
>    Gabor> Try do.call like this:
> 
>    Gabor> ff <- x ~ g*h
>    Gabor> do.call("substitute", list(ff, list(x = as.name("weight"))))
> 
> Just a small remark: For all those who -- like me -- have found
> it  ``unpleasant'' to have to quote the first argument of do.call():
> You don't have to any longer since the NEWS of R 2.1.0 contains
> 
>    o   do.call() now takes either a function or a character string as
>        its first argument.  The supplied arguments can optionally be
>        quoted.
> 
> So the above could be
> 
>   do.call(substitute, list(ff, list(x = as.name("weight"))))

I have used that form but went back to the character form
when I noticed the entire text of the function appearing
in tracebacks, which I found to be a nuisance, particularly
for functions with large bodies:

> f <- function(x) { stop() }
> do.call(f, list(3))
Error in function (x)  : 
> traceback()
3: stop()
2: function (x) 
   {
       stop()
   }(3)
1: do.call(f, list(3))

Of course, in the case of substitute the body is only one line.


From ripley at stats.ox.ac.uk  Tue Aug 23 13:36:03 2005
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 23 Aug 2005 12:36:03 +0100 (BST)
Subject: [Rd] Which TEX for Wiindows
In-Reply-To: <018201c5a7d3$6cb35fc0$598debd4@ales>
References: <D79013E40FEF254AAF0D72DFC94F274803D889@extas4-hba.tas.csiro.au>
	<430AF9EC.30406@stats.uwo.ca> <018201c5a7d3$6cb35fc0$598debd4@ales>
Message-ID: <Pine.LNX.4.61.0508231233340.4175@gannet.stats>

On Tue, 23 Aug 2005, Ales Ziberna wrote:

> I am intending to instal TEX (for use with R - building, checking packages)
> on my WinXP SP2. I read that fptex is recomended, however
> http://www.fptex.org/ is not not available. Is MiKTeX the next best choice?

Please look at the current documentation:

   The @code{fptex} distribution of @LaTeX{} (directly from any CTAN node
   such as @url{http://www.ctan.org/tex-archive/systems/windows/fptex/} or
   via XEmTeX at @url{http://www.fptex.org}) includes a suitable port of
   @code{pdftex}.

(www.fptex.org was available until very recently.)

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ggrothendieck at gmail.com  Tue Aug 23 13:41:35 2005
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Tue, 23 Aug 2005 07:41:35 -0400
Subject: [Rd] Which TEX for Wiindows
In-Reply-To: <018201c5a7d3$6cb35fc0$598debd4@ales>
References: <D79013E40FEF254AAF0D72DFC94F274803D889@extas4-hba.tas.csiro.au>
	<430AF9EC.30406@stats.uwo.ca> <018201c5a7d3$6cb35fc0$598debd4@ales>
Message-ID: <971536df0508230441195dbd2f@mail.gmail.com>

On 8/23/05, Ales Ziberna <aleszib at gmail.com> wrote:
> I am intending to instal TEX (for use with R - building, checking packages)
> on my WinXP SP2. I read that fptex is recomended, however
> http://www.fptex.org/ is not not available. Is MiKTeX the next best choice?
> 

Yes. Be sure to read:

http://www.murdoch-sutherland.com/Rtools/miktex.html


From duncan at wald.ucdavis.edu  Sun Aug 21 17:40:01 2005
From: duncan at wald.ucdavis.edu (Duncan Temple Lang)
Date: Sun, 21 Aug 2005 08:40:01 -0700
Subject: [Rd] IPC
In-Reply-To: <8ed68eed05082106117545e667@mail.gmail.com>
References: <1124628383.20671.49.camel@schrodinger>
	<8ed68eed05082106117545e667@mail.gmail.com>
Message-ID: <20050821154001.GC21511@wald.ucdavis.edu>

Sean O'Riordain wrote:
> for very low bandwidth IPC I'd just use a standard web page form using
> a GET... so all you have to do is call a URL with the parameters
> embedded in the URL, e.g.
> 
> http://silly.name.for.server.com/javaServlet?a=42&b=394&c=1982&d=complex
> 
> If your bandwidth requirements are a bit higher then you have to start
> using POST which is a bit more complicated though... so at that stage
> I might use SOAP.

POST is not equivalent to SOAP.  SOAP uses POST.

In order to avoid all the details dealing with HTTP requests
such as escaping characters, SSL, passwords, POST/GET, etc., it is simplest
to use something that already takes care of  these.
The RCurl package (www.omegahat.org/RCurl) is in interface libcurl which takes care of
so many of these details.  httpRequest (regular CRAN package) is implemented entirely
within R, but doesn't handle as many of these extra details.

  D.

> 
> cheers!
> Sean
> 
> On 21/08/05, Nigel Sim <nigel.sim at jcu.edu.au> wrote:
> > Hi, I need to somehow make R communicate with another remote JAVA
> > process which provides compute services. I have control over the
> > communications protocol, but I would like to keep it to a standardised
> > protocol, such as SOAP, CORBA, etc.
> > 
> > What I would like to know is, what do other people use to do this? The
> > nature of the communications will be low bandwidth procedure calls, with
> > little data. (The data is stored in a DBMS). To date I have tried the
> > RCORBA and SSOAP packages. Corba I couldn't get to compile, and soap I
> > couldn't get to talk properly to soapanywhere (the embedded soap
> > implementation I am trialing).
> > 
> > I'm sure with persistence I can get both working, but I would like to
> > hear others experiences before I invest the time.
> > 
> > Thank you for your time.
> > --
> > Nigel Sim
> > 
> > PhD Candidate
> > School of Mathematics and Physical Sciences
> > James Cook University
> > +61 7 4781 4247
> > +61 409 277 641
> > 
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Duncan Temple Lang                duncan at wald.ucdavis.edu
Department of Statistics          work:  (530) 752-4782
371 Kerr Hall                     fax:   (530) 752-7099
One Shields Ave.
University of California at Davis
Davis, CA 95616, USA



-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
Url : https://stat.ethz.ch/pipermail/r-devel/attachments/20050821/53541927/attachment-0002.bin

From duncan at wald.ucdavis.edu  Sun Aug 21 17:47:48 2005
From: duncan at wald.ucdavis.edu (Duncan Temple Lang)
Date: Sun, 21 Aug 2005 08:47:48 -0700
Subject: [Rd] IPC
In-Reply-To: <1124628383.20671.49.camel@schrodinger>
References: <1124628383.20671.49.camel@schrodinger>
Message-ID: <20050821154748.GD21511@wald.ucdavis.edu>

Nigel Sim wrote:
> Hi, I need to somehow make R communicate with another remote JAVA
> process which provides compute services. I have control over the
> communications protocol, but I would like to keep it to a standardised
> protocol, such as SOAP, CORBA, etc. 
> 
> What I would like to know is, what do other people use to do this? The
> nature of the communications will be low bandwidth procedure calls, with
> little data. (The data is stored in a DBMS). To date I have tried the
> RCORBA and SSOAP packages. Corba I couldn't get to compile, and soap I
> couldn't get to talk properly to soapanywhere (the embedded soap
> implementation I am trialing). 


Can you let me know what went wrong with SSOAP? It would be
good to fix this and I am about to turn my attention to it anyway.

As for the "RCORBA" package - what precisely are you referring to?
I don't think there is a package named RCORBA, perhaps you mean
RSCORBA.  If so, yes it is quite old. It can be updated
and indeed I have a plan that I might connect it to Orbit.
But if RSCORBA didn't compile, you might want to mention which
CORBA implementation you were trying to use: it was setup to use 
3.



As for what people typically use to connect to Java.
There is Rserve. There is RSJava.
I think your desire to use a standard protocol is a very 
good one. There are far too many ad hoc solutions that don't
do have limited functionality, such as callbacks.
On Windows, DCOM client and server  and event packages are available.
And there are MPI or PVM packages which implement a form of IPC.

Do you absolutely need to have a middle-tier of going through
the server to get to the DBMS?  It is often a good design,
but if you can go straight to the DBMS, then that would be
esier and more efficient.


Please let me know what went wrong with the SSOAP package.

 D.


> 
> I'm sure with persistence I can get both working, but I would like to
> hear others experiences before I invest the time.
> 
> Thank you for your time.
> -- 
> Nigel Sim
> 
> PhD Candidate
> School of Mathematics and Physical Sciences
> James Cook University
> +61 7 4781 4247
> +61 409 277 641
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Duncan Temple Lang                duncan at wald.ucdavis.edu
Department of Statistics          work:  (530) 752-4782
371 Kerr Hall                     fax:   (530) 752-7099
One Shields Ave.
University of California at Davis
Davis, CA 95616, USA



-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
Url : https://stat.ethz.ch/pipermail/r-devel/attachments/20050821/0006a6bf/attachment-0002.bin

From duncan at wald.ucdavis.edu  Wed Aug 17 09:15:29 2005
From: duncan at wald.ucdavis.edu (Duncan Temple Lang)
Date: Wed, 17 Aug 2005 00:15:29 -0700
Subject: [Rd] About R variable references
In-Reply-To: <000001c5a2f7$b2407e00$e101a8c0@MARKKUNOTEBOOK>
References: <000001c5a2f7$b2407e00$e101a8c0@MARKKUNOTEBOOK>
Message-ID: <20050817071529.GE2941@wald.ucdavis.edu>

Hi Markku.

  You have correctly diagnosed the problem that the initially
set global variables "are not stable".  In your call
to myinit, you store a C-level reference to the var and func
R objects. But you need to tell R's memory management
that you need to hold onto them.  Otherwise it is entitled
to garbage collect them as it feels fit. 
In the C-code for myinit, you might add calls 

    R_PreserveObject(myfunction)
    R_PreserveObject(myvariable)

that is defined in Rinternals.h. These go after
you assign values to your global variables.

You are PROTECT()'ing these variables only in the call
to myexec.

 D.
 

Markku Mielityinen wrote:
> Hello Group,
> 
> I could use an advice on how SEXP handles work. My aim is to implement a
> system where I initially set a few global variables that are used for
> communication between C and R code. Then I do some work with R code and
> periodically call a function of my own that will update the system
> state. Such a design is useful for many purposes (for GUIs to name one).
> I am not entirely sure that R can handle such a design but at the moment
> I cannot see any reasons why it could not. The problem I have is that
> the initially set global variables are not stable. Everything works for
> a while but eventually the system gets confused. It seems that the SEXP
> references to the state variables and to the callback functions may get
> altered and become pointing to some other variables. This will then
> rightfully give me the error messages like "attempt to apply
> non-function". My (maybe uneducated) guess is that this might have
> something to do with R memory management. The variables are connected to
> the namespace so a do not think they are removed. Maybe they are moved
> is such a way that my SEXP references are not able to follow. As you can
> see I am on thin ice here so please feel welcome to step in...
> 
> My librtary contains ~20k lines of C code so I would not consider a bug
> here out of the question. I have tried to look for one but until now
> without success.
> 
> My question is: can you see a design flaw here or is everything done
> according to R requirements and hence it is likely that there is a bug
> in my own code?
> 
> One dirty correction I can see but have not tried is to use object names
> and findVar but this would make it less flexible (at least IMHO).
> 
> I have quickly browsed the forums and the documentation I was able to
> find but found no answers.
> 
> My system is FC3 with R version >= 2.
> 
> There are two snippets of code that hopefully make clear what I am
> trying to achieve. The code is provided for illustration purposes only
> and I did not try to compile it.
> 
> Best regards,
>         Markku Mielityinen
> 
> 
> #  C CODE
> #####################################################################
> 
> SEXP myrho = R_GlobalEnv;
> SEXP myvariable = R_NilValue;
> SEXP myfunction = R_NilValue;
> 
> SEXP myinit(SEXP var, SEXP func) {
> 	myvariable = var;
> 	myfunction = func;
> 	return R_NilValue;
> }
> 
> SEXP myexec(/* probably has some parameters that are omitted in this
> example */) {
> 	int state;
> 	SEXP thecall;
> 	
> 	/* do some work, then set the state and call a callback function
> if necessary */
> 	
> 	PROTECT(myvariable);
> 	INTEGER(myvariable)[0] = state;
> 	UNPROTECT(1);
> 	if(state) {
> 		PROTECT(thecall = LCONS(myfunction, LCONS(myvariable,
> R_NilValue)));
> 		eval(thecall, myrho);
> 		UNPROTECT(1);
> 	}
> 
> 	return R_NilValue;
> }
> 
> ########################################################################
> ########
> 
> #  R CODE
> #####################################################################
> 
> myinit<-function(var,func) .Call("myinit",var,func)
> myexec<-function() .Call("myexec")
> 
> state<-as.integer(1)
> callback<-function(state) { cat(sprintf("You got state %s\n",state)) }
> 
> myinit()
> # do some work here and call myexec() periodically...
> 
> ########################################################################
> ########
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Duncan Temple Lang                duncan at wald.ucdavis.edu
Department of Statistics          work:  (530) 752-4782
371 Kerr Hall                     fax:   (530) 752-7099
One Shields Ave.
University of California at Davis
Davis, CA 95616, USA



-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
Url : https://stat.ethz.ch/pipermail/r-devel/attachments/20050817/35eda213/attachment.bin

From maechler at stat.math.ethz.ch  Tue Aug 23 15:06:34 2005
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Tue, 23 Aug 2005 15:06:34 +0200
Subject: [Rd] weigths in boxplot
In-Reply-To: <4308B108.7030003@univie.ac.at>
References: <20050808192734.F0418A274@slim.kubism.ku.dk>
	<4308B108.7030003@univie.ac.at>
Message-ID: <17163.8026.69287.789426@stat.math.ethz.ch>

>>>>> "Erich" == Erich Neuwirth <erich.neuwirth at univie.ac.at>
>>>>>     on Sun, 21 Aug 2005 18:51:20 +0200 writes:

    Erich> In R 2.2.0 density now can work with weighted
    Erich> obesrvations.  It would be nice if boxplot also would
    Erich> accept a weight parameter, then one could produce
    Erich> consistent density estimators and boxplots.

    Erich> Could the developers consider adding this feature?

The first thing I'd want is  quantile() with weights --- which I
personally find quite interesting and have wanted several times
in the past --- not wanted enough to implement though.

I'm interested to hear of (or even see C or R implementations of)
fast algorithms for "weight quantiles".  
Code contributions are welcome too..

(And yes, I do know that boxplots are base on "hinges" rather than
 quartiles but that's less interesting here.)

Martin Maechler <maechler at stat.math.ethz.ch>	http://stat.ethz.ch/~maechler/
Seminar fuer Statistik, ETH-Zentrum  LEO C16	Leonhardstr. 27
ETH (Federal Inst. Technology)	8092 Zurich	SWITZERLAND
phone: +41-44-632-3408		fax: ...-1228			<><


From jtk at cmp.uea.ac.uk  Tue Aug 23 15:15:09 2005
From: jtk at cmp.uea.ac.uk (jtk@cmp.uea.ac.uk)
Date: Tue, 23 Aug 2005 15:15:09 +0200 (CEST)
Subject: [Rd] NAs by integer overflow in Spearman's test p-value (PR#8087)
Message-ID: <20050823131509.01C3719838@slim.kubism.ku.dk>

Full_Name: Jan T. Kim
Version: 2.1.0 (and better)
OS: Linux
Submission from: (NULL) (139.222.3.229)


The p value in Spearman's test is NA if the length of x exceeds 46340, due to
an integer overflow, occurring if length(n) > sqrt(2^31):

    > n <- 46341;
    > set.seed(1);
    > x <- runif(n);
    > y <- runif(n);
    > cor.test(x, y, method = "spearman");

            Spearman's rank correlation rho

    data:  x and y 
    S = 1.654965e+13, p-value = NA
    alternative hypothesis: true rho is not equal to 0 
    sample estimates:
            rho 
    0.002199426 

    Warning message:
    NAs produced by integer overflow in: n * n 

The integer overflow occurs in src/library/stats/R/cor.test.R, and it can be
fixed
by converting n to double appropriately (see *** fix label ***, lines 110
onwards
are shown):

                ## Use the test statistic S = sum(rank(x) - rank(y))^2
                ## and AS 89 for obtaining better p-values than via the
                ## simple normal approximation.
                ## In the case of no ties, S = (1-rho) * (n^3-n)/6.
                pspearman <- function(q, n, lower.tail = TRUE) {
                    if(n <= 1290) # n*(n^2 - 1) does not overflow
                        .C("prho",
                           as.integer(n),
                           as.double(q + 1),
                           p = double(1),
                           integer(1),
                           as.logical(lower.tail),
                           PACKAGE = "stats")$p
                    else { # for large n: aymptotic t_{n-2}
                        n <- as.double(n);  # *** fix ***
                        r <- 1 - 6 * q / (n*(n*n - 1))
                        pt(r / sqrt((1 - r^2)/(n-2)), df = n-2,
                           lower.tail= !lower.tail)
                    }
                }
                q <- round((n^3 - n) * (1 - r) / 6)
                STATISTIC <- c(S = q)
                PVAL <-
                    switch(alternative,
                           "two.sided" = {
                               p <- if(q > (n^3 - n) / 6)
                                   pspearman(q - 1, n, lower.tail = FALSE)
                               else
                                   pspearman(q, n, lower.tail = TRUE)
                               min(2 * p, 1)
                           },
                           "greater" = pspearman(q, n, lower.tail = TRUE),
                           "less" = pspearman(q - 1, n, lower.tail = FALSE))
                if(TIES)
                    warning("p-values may be incorrect due to ties")

Inserting the typecast only in the pspearman function is a minimally invasive
fix -- alternatively, replacing at line 17

    n <- length(x)

with

    n <- as.double(length(x))

achieves the same fix and may take care of other unnecessary integer overflows,
but it may also introduce new problems e.g. in .C calls etc.


From ripley at stats.ox.ac.uk  Tue Aug 23 19:19:39 2005
From: ripley at stats.ox.ac.uk (ripley@stats.ox.ac.uk)
Date: Tue, 23 Aug 2005 19:19:39 +0200 (CEST)
Subject: [Rd] (PR#8087) NAs by integer overflow in Spearman's test
	p-value
Message-ID: <20050823171939.C5D5B1983B@slim.kubism.ku.dk>

There is an even simpler way: someone wrote n*(n^2-1) as n*(n-1)*(n+1)
and caused the problem.

Your superfluous semicolons do definitely make your code harder to read.

On Tue, 23 Aug 2005 jtk at cmp.uea.ac.uk wrote:

> Full_Name: Jan T. Kim
> Version: 2.1.0 (and better)
> OS: Linux
> Submission from: (NULL) (139.222.3.229)
>
>
> The p value in Spearman's test is NA if the length of x exceeds 46340, due to
> an integer overflow, occurring if length(n) > sqrt(2^31):
>
>    > n <- 46341;
>    > set.seed(1);
>    > x <- runif(n);
>    > y <- runif(n);
>    > cor.test(x, y, method = "spearman");
>
>            Spearman's rank correlation rho
>
>    data:  x and y
>    S = 1.654965e+13, p-value = NA
>    alternative hypothesis: true rho is not equal to 0
>    sample estimates:
>            rho
>    0.002199426
>
>    Warning message:
>    NAs produced by integer overflow in: n * n
>
> The integer overflow occurs in src/library/stats/R/cor.test.R, and it can be
> fixed
> by converting n to double appropriately (see *** fix label ***, lines 110
> onwards
> are shown):
>
>                ## Use the test statistic S = sum(rank(x) - rank(y))^2
>                ## and AS 89 for obtaining better p-values than via the
>                ## simple normal approximation.
>                ## In the case of no ties, S = (1-rho) * (n^3-n)/6.
>                pspearman <- function(q, n, lower.tail = TRUE) {
>                    if(n <= 1290) # n*(n^2 - 1) does not overflow
>                        .C("prho",
>                           as.integer(n),
>                           as.double(q + 1),
>                           p = double(1),
>                           integer(1),
>                           as.logical(lower.tail),
>                           PACKAGE = "stats")$p
>                    else { # for large n: aymptotic t_{n-2}
>                        n <- as.double(n);  # *** fix ***
>                        r <- 1 - 6 * q / (n*(n*n - 1))
>                        pt(r / sqrt((1 - r^2)/(n-2)), df = n-2,
>                           lower.tail= !lower.tail)
>                    }
>                }
>                q <- round((n^3 - n) * (1 - r) / 6)
>                STATISTIC <- c(S = q)
>                PVAL <-
>                    switch(alternative,
>                           "two.sided" = {
>                               p <- if(q > (n^3 - n) / 6)
>                                   pspearman(q - 1, n, lower.tail = FALSE)
>                               else
>                                   pspearman(q, n, lower.tail = TRUE)
>                               min(2 * p, 1)
>                           },
>                           "greater" = pspearman(q, n, lower.tail = TRUE),
>                           "less" = pspearman(q - 1, n, lower.tail = FALSE))
>                if(TIES)
>                    warning("p-values may be incorrect due to ties")
>
> Inserting the typecast only in the pspearman function is a minimally invasive
> fix -- alternatively, replacing at line 17
>
>    n <- length(x)
>
> with
>
>    n <- as.double(length(x))
>
> achieves the same fix and may take care of other unnecessary integer overflows,
> but it may also introduce new problems e.g. in .C calls etc.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From lai at lindaspaces.com  Tue Aug 23 19:59:23 2005
From: lai at lindaspaces.com (Jennifer Lai)
Date: Tue, 23 Aug 2005 13:59:23 -0400
Subject: [Rd] compile R with Portland Group compiler
Message-ID: <430B63FB.1000908@lindaspaces.com>

Hi,
    Can anyone advise me on how to compile R with Portland Group 
compiler on a Opeteron machine with Red Hat Enterprise Linux WS release 
4 installed?

I've edit config.site file to pick portland group compilers instead of 
gcc. Here is the list of modified flags:
CC=/usr/pgi/linux86-64/6.0/bin/pgcc
CFLAGS='-g -O2'
CPPFLAGS='-I/usr/pgi/linux86-64/6.0/include 
-I/usr/pgi/linux86-64/6.0/include/CC'
F77=/usr/pgi/linux86-64/6.0/bin/pgf77
FLAGS='-O2'
CPICFLAGS=-fPIC
FPICFLAGS=-fPIC
SHLIB_LDFLAGS=-shared
LDFLAGS='-L/usr/pgi/linux86-64/6.0/lib -L/usr/lib64'
CXX=/usr/pgi/linux86-64/6.0/bin/pgCC
CXXPICFLAGS=-fPIC
SHLIB_CXXLDFLAGS=-shared


When I ran configure, I didn't get any error message, but config.log 
indicated there are errors,
configure:4102: $? = 0
configure:4124: result: o
configure:4128: checking whether we are using the GNU C compiler
configure:4152: /usr/pgi/linux86-64/6.0/bin/pgcc -c -g -O2 
-I/usr/pgi/linux86-64/6.0/include -I/usr/pgi/linux86-64/6.0/include/C\
C conftest.c >&5
PGC-S-0040-Illegal use of symbol, choke (conftest.c: 21)
PGC/x86-64 Linux/x86-64 6.0-5: compilation completed with severe errors
configure:4158: $? = 2
configure: failed program was:
| /* confdefs.h.  */
|
| #define PACKAGE_NAME "R"
| #define PACKAGE_TARNAME "R"
| #define PACKAGE_VERSION "2.1.1"
| #define PACKAGE_STRING "R 2.1.1"
| #define PACKAGE_BUGREPORT "r-bugs at R-project.org"
| #define PACKAGE "R"
| #define VERSION "2.1.1"
| #define R_PLATFORM "x86_64-unknown-linux-gnu"
| #define R_CPU "x86_64"
| #define R_VENDOR "unknown"
| #define R_OS "linux-gnu"
| #define Unix 1
| /* end confdefs.h.  */
|
| int
| main ()
| {
| #ifndef __GNUC__
|        choke me
| #endif
|
|   ;
|   return 0;
| }
configure:4184: result: no
configure:4190: checking whether /usr/pgi/linux86-64/6.0/bin/pgcc accepts -g


If I ignored the config.log errors and went ahead to do make, I got the 
following errors,
make[3]: Entering directory `/home/cuser/AMD_BENCH/R-2.1.1/src/main'
/usr/pgi/linux86-64/6.0/bin/pgcc -I../../src/extra/zlib 
-I../../src/extra/bzip2 -I../../src/extra/pcre  -I. -I../../src/include 
-I../../src/include -I/usr/pgi/linux86-64/6.0/include 
-I/usr/pgi/linux86-64/6.0/include/CC -DHAVE_CONFIG_H   -g -O2 -c regex.c 
-o regex.o
PGC-W-0155-64-bit integral value truncated  (/usr/include/wctype.h: 109)
PGC-W-0155-64-bit integral value truncated  (/usr/include/wctype.h: 110)
PGC-W-0155-64-bit integral value truncated  (/usr/include/wctype.h: 111)
PGC-W-0155-64-bit integral value truncated  (/usr/include/wctype.h: 112)
PGC-W-0084-Type of old-style argument src does not match type of 
prototype argument src (regex.c: 743)
PGC-S-0043-Redefinition of symbol, bitset_merge (regex.c: 743)
PGC-S-0100-Non-integral operand for mod, shift, or bitwise operator 
(regex.c: 746)
PGC-W-0084-Type of old-style argument src does not match type of 
prototype argument src (regex.c: 753)
PGC-S-0043-Redefinition of symbol, bitset_not_merge (regex.c: 753)
PGC-S-0063-Operand of ~ must be an integer type (regex.c: 756)
PGC-W-0084-Type of old-style argument src does not match type of 
prototype argument src (regex.c: 763)
PGC-S-0043-Redefinition of symbol, bitset_mask (regex.c: 763)
PGC-S-0100-Non-integral operand for mod, shift, or bitwise operator 
(regex.c: 766)
PGC-W-0155-Long value is passed to a nonprototyped function - argument 
#5 (regex.c: 3152)
PGC-W-0155-Long value is passed to a nonprototyped function - argument 
#3 (regex.c: 4261)
PGC-W-0155-Long value is passed to a nonprototyped function - argument 
#3 (regex.c: 4383)
PGC-W-0155-Long value is passed to a nonprototyped function - argument 
#3 (regex.c: 4427)
PGC-W-0155-Long value is passed to a nonprototyped function - argument 
#3 (regex.c: 4529)
PGC-W-0155-Long value is passed to a nonprototyped function - argument 
#3 (regex.c: 4585)
PGC-W-0155-Long value is passed to a nonprototyped function - argument 
#4 (regex.c: 4586)
PGC-W-0155-Long value is passed to a nonprototyped function - argument 
#3 (regex.c: 4648)
PGC-W-0155-Long value is passed to a nonprototyped function - argument 
#3 (regex.c: 4701)
PGC-W-0155-Long value is passed to a nonprototyped function - argument 
#3 (regex.c: 4766)
PGC-W-0155-Long value is passed to a nonprototyped function - argument 
#4 (regex.c: 4773)
PGC-W-0155-Long value is passed to a nonprototyped function - argument 
#3 (regex.c: 4846)
PGC-W-0155-Long value is passed to a nonprototyped function - argument 
#3 (regex.c: 4925)
PGC-W-0155-Long value is passed to a nonprototyped function - argument 
#3 (regex.c: 5420)
PGC-W-0155-Long value is passed to a nonprototyped function - argument 
#3 (regex.c: 5436)
PGC-W-0155-Long value is passed to a nonprototyped function - argument 
#3 (regex.c: 5469)
PGC-W-0155-Long value is passed to a nonprototyped function - argument 
#3 (regex.c: 5482)
PGC-W-0155-Long value is passed to a nonprototyped function - argument 
#3 (regex.c: 5510)
PGC-W-0155-Long value is passed to a nonprototyped function - argument 
#3 (regex.c: 5695)
PGC-W-0155-Long value is passed to a nonprototyped function - argument 
#3 (regex.c: 6071)
PGC-W-0155-Long value is passed to a nonprototyped function - argument 
#6 (regex.c: 6790)
PGC-W-0155-Long value is passed to a nonprototyped function - argument 
#3 (regex.c: 7483)
PGC-W-0155-Long value is passed to a nonprototyped function - argument 
#2 (regex.c: 7494)
PGC-W-0155-Long value is passed to a nonprototyped function - argument 
#3 (regex.c: 7502)
PGC-W-0155-Long value is passed to a nonprototyped function - argument 
#7 (regex.c: 10317)
PGC/x86-64 Linux/x86-64 6.0-5: compilation completed with severe errors
make[3]: *** [regex.o] Error 2
make[3]: Leaving directory `/home/cuser/AMD_BENCH/R-2.1.1/src/main'
make[2]: *** [R] Error 2


Any help is greatly appreciated.

Thanks,
Jennifer


From exclude-me at client-2bsmsend.com  Tue Aug 23 20:55:31 2005
From: exclude-me at client-2bsmsend.com (exclude-me@client-2bsmsend.com)
Date: Tue, 23 Aug 2005 20:55:31 +0200 (CEST)
Subject: [Rd] Extended-Warranty for your vehicle r-bugs (PR#8088)
Message-ID: <20050823185531.7C3A51983B@slim.kubism.ku.dk>

This is a multi-part message in MIME format.

----58736078_abAug1180
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: 7bit

*********
If you are reading this text, you either do 
not have an HTML capable email client, or 
you choose not to view HTML emails by default.
*********

Q: What if I still want to visit the web site?
A: You may follow the url below:
http://f.client-2bsmsend.com/t/f.aspx?TID=1180&LID=2578&EID=58736078&VID=273

Q: I refuse to view this message in HTML, 
   how do I remove myself?
A: You may follow the url below:
http://f.client-2bsmsend.com/t/d.aspx?pepsi=blue&TID=1180&LID=2578&EID=58736078&VID=273

*********
This email is a paid eAd sent to 
r-bugs at biostat.ku.dk by Auto Warranty Dealz on
Tue, 23 Aug 2005 11:45:46 -0700.

Sender information:
Auto Warranty Dealz
350 S. Center Dr. Suite 500
Reno, NV 89501

End of msg.

----58736078_abAug1180
Content-Type: text/html;
	charset="us-ascii"

<table width="361" border="0" cellpadding="10" cellspacing="0">
  <tr>
    <td width="341"><a href="http://f.client-2bsmsend.com/t/f.aspx?TID=1180&LID=2578&EID=58736078&VID=273"><img src="http://i.client-2bsmsend.com/aw4/Email7.jpg" border="0"></a></td>
  </tr>
  <tr>
    <td align="left"><div align="left"><a href="http://f.client-2bsmsend.com/t/f.aspx?TID=1180&LID=2579&EID=58736078&VID=273"><img src="http://i.client-2bsmsend.com/aw4/bottom2.gif" border="0"></a></div></td>
  </tr>
</table>
<img src="http://www.4carwarranty.com/open.php?cid=13" height=0 width=0 border=0>
<p>&nbsp;</p>
<table border="0" width="600" id="table1" cellspacing="0" cellpadding="0" height="127">
	<tr>
		<td width="425" valign="top" height="17">
		<p align="left">
		<font face="Tahoma" size="1">
		<img border="0" src="http://i.client-2bsmsend.com/bsminc/top.gif" width="428" height="17"></font></td>
		<td width="175" rowspan="2" valign="top">
		<p align="left">
		<font face="Tahoma" size="1">
		<a href="http://f.client-2bsmsend.com/t/f.aspx?TID=403&LID=765">
		<img border="0" src="http://f.client-2bsmsend.com/t/i.aspx?TID=1180&LID=2578&EID=58736078&VID=273&Image=logo.gif" width="172" height="75"></a></font></td>
	</tr>
	<tr>
		<td valign="top" align="left"><b>
		<font size="1" face="Tahoma">This message was 
	intended for:<br>
		</font></b><font size="1" face="Tahoma">r-bugs at biostat.ku.dk;
	<a href="http://f.client-2bsmsend.com/t/d.aspx?pepsi=blue&TID=1180&LID=2578&EID=58736078&VID=273">
		<font color="#000000">
	<img border="0" src="http://i.client-2bsmsend.com/bsminc/rf.gif" width="144" height="12"></font></a></font><p class="MsoNormal">
		<font size="1" face="Tahoma">This message has been sent to you by 
		Auto Warranty Dealz.&nbsp; Auto Warranty Dealz is solely responsible for the fulfillment of 
		products and or services associated with this message and any site this 
		message takes you to here after.&nbsp;&nbsp; If you have any questions regarding 
		this message, please contact Auto Warranty Dealz at 350 S. Center Dr. Suite 500, Reno, NV 
		89501.</font></p>
		<hr color="#000000" size="1">
		<p class="MsoNormal"><font size="1" face="Tahoma">This message was sent 
		to r-bugs at biostat.ku.dk, with the last known Internet Protocol (IP) address 66.249.65.15, 
		which is kept on file by the publisher of this message for audit 
		reasons.&nbsp; You may seek information on the publisher by navigating your 
		cursor to the logo-image located at the top-right of this message.</font></p>
		<p class="MsoNormal"><font size="1" face="Tahoma">If for any reason you 
		no longer want any more messages from Auto Warranty Dealz then please follow the 
		directions above, next to the email address this message was intended 
		for.&nbsp; </font></p>
		<p class="MsoNormal"><font size="1" face="Tahoma">Thank you and have an 
		excellent .<br>
		Tuesday, August 23, 2005 11:44</font></p>
		<hr color="#000000" size="1">
		<p class="MsoNormal"><font face="Tahoma" size="1">58736078_1144_23082005_1180_1627485?</font></td>
	</tr>
</table>

----58736078_abAug1180--


From ripley at stats.ox.ac.uk  Tue Aug 23 23:20:47 2005
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 23 Aug 2005 22:20:47 +0100 (BST)
Subject: [Rd] compile R with Portland Group compiler
In-Reply-To: <430B63FB.1000908@lindaspaces.com>
References: <430B63FB.1000908@lindaspaces.com>
Message-ID: <Pine.LNX.4.61.0508232211550.21594@gannet.stats>

regex.c is not our code, but from glibc.  Could you please try R-devel 
instead, which has a later version of glibc.  Since 2.1.1 is not longer 
part of the developement, we cannot help with that, but we can help wih 
R-devel.

I see the later regex.c does use prototypes.  But bitset is an integer 
type, so that may be a compiler error.

(It is on my list to try Intel and PG compilers on AMD64 as we have 
licences, but not very high priority.)

On Tue, 23 Aug 2005, Jennifer Lai wrote:

> Hi,
>    Can anyone advise me on how to compile R with Portland Group
> compiler on a Opeteron machine with Red Hat Enterprise Linux WS release
> 4 installed?
>
> I've edit config.site file to pick portland group compilers instead of
> gcc. Here is the list of modified flags:
> CC=/usr/pgi/linux86-64/6.0/bin/pgcc
> CFLAGS='-g -O2'
> CPPFLAGS='-I/usr/pgi/linux86-64/6.0/include
> -I/usr/pgi/linux86-64/6.0/include/CC'
> F77=/usr/pgi/linux86-64/6.0/bin/pgf77
> FLAGS='-O2'
> CPICFLAGS=-fPIC
> FPICFLAGS=-fPIC
> SHLIB_LDFLAGS=-shared
> LDFLAGS='-L/usr/pgi/linux86-64/6.0/lib -L/usr/lib64'
> CXX=/usr/pgi/linux86-64/6.0/bin/pgCC
> CXXPICFLAGS=-fPIC
> SHLIB_CXXLDFLAGS=-shared
>
>
> When I ran configure, I didn't get any error message, but config.log
> indicated there are errors,

That's fine: it is not GNU C so it should give an error.

> configure:4102: $? = 0
> configure:4124: result: o
> configure:4128: checking whether we are using the GNU C compiler
> configure:4152: /usr/pgi/linux86-64/6.0/bin/pgcc -c -g -O2
> -I/usr/pgi/linux86-64/6.0/include -I/usr/pgi/linux86-64/6.0/include/C\
> C conftest.c >&5
> PGC-S-0040-Illegal use of symbol, choke (conftest.c: 21)
> PGC/x86-64 Linux/x86-64 6.0-5: compilation completed with severe errors
> configure:4158: $? = 2
> configure: failed program was:
> | /* confdefs.h.  */
> |
> | #define PACKAGE_NAME "R"
> | #define PACKAGE_TARNAME "R"
> | #define PACKAGE_VERSION "2.1.1"
> | #define PACKAGE_STRING "R 2.1.1"
> | #define PACKAGE_BUGREPORT "r-bugs at R-project.org"
> | #define PACKAGE "R"
> | #define VERSION "2.1.1"
> | #define R_PLATFORM "x86_64-unknown-linux-gnu"
> | #define R_CPU "x86_64"
> | #define R_VENDOR "unknown"
> | #define R_OS "linux-gnu"
> | #define Unix 1
> | /* end confdefs.h.  */
> |
> | int
> | main ()
> | {
> | #ifndef __GNUC__
> |        choke me
> | #endif
> |
> |   ;
> |   return 0;
> | }
> configure:4184: result: no
> configure:4190: checking whether /usr/pgi/linux86-64/6.0/bin/pgcc accepts -g
>
>
> If I ignored the config.log errors and went ahead to do make, I got the
> following errors,
> make[3]: Entering directory `/home/cuser/AMD_BENCH/R-2.1.1/src/main'
> /usr/pgi/linux86-64/6.0/bin/pgcc -I../../src/extra/zlib
> -I../../src/extra/bzip2 -I../../src/extra/pcre  -I. -I../../src/include
> -I../../src/include -I/usr/pgi/linux86-64/6.0/include
> -I/usr/pgi/linux86-64/6.0/include/CC -DHAVE_CONFIG_H   -g -O2 -c regex.c
> -o regex.o
> PGC-W-0155-64-bit integral value truncated  (/usr/include/wctype.h: 109)
> PGC-W-0155-64-bit integral value truncated  (/usr/include/wctype.h: 110)
> PGC-W-0155-64-bit integral value truncated  (/usr/include/wctype.h: 111)
> PGC-W-0155-64-bit integral value truncated  (/usr/include/wctype.h: 112)
> PGC-W-0084-Type of old-style argument src does not match type of
> prototype argument src (regex.c: 743)
> PGC-S-0043-Redefinition of symbol, bitset_merge (regex.c: 743)
> PGC-S-0100-Non-integral operand for mod, shift, or bitwise operator
> (regex.c: 746)
> PGC-W-0084-Type of old-style argument src does not match type of
> prototype argument src (regex.c: 753)
> PGC-S-0043-Redefinition of symbol, bitset_not_merge (regex.c: 753)
> PGC-S-0063-Operand of ~ must be an integer type (regex.c: 756)
> PGC-W-0084-Type of old-style argument src does not match type of
> prototype argument src (regex.c: 763)
> PGC-S-0043-Redefinition of symbol, bitset_mask (regex.c: 763)
> PGC-S-0100-Non-integral operand for mod, shift, or bitwise operator
> (regex.c: 766)
> PGC-W-0155-Long value is passed to a nonprototyped function - argument
> #5 (regex.c: 3152)
> PGC-W-0155-Long value is passed to a nonprototyped function - argument
> #3 (regex.c: 4261)
> PGC-W-0155-Long value is passed to a nonprototyped function - argument
> #3 (regex.c: 4383)
> PGC-W-0155-Long value is passed to a nonprototyped function - argument
> #3 (regex.c: 4427)
> PGC-W-0155-Long value is passed to a nonprototyped function - argument
> #3 (regex.c: 4529)
> PGC-W-0155-Long value is passed to a nonprototyped function - argument
> #3 (regex.c: 4585)
> PGC-W-0155-Long value is passed to a nonprototyped function - argument
> #4 (regex.c: 4586)
> PGC-W-0155-Long value is passed to a nonprototyped function - argument
> #3 (regex.c: 4648)
> PGC-W-0155-Long value is passed to a nonprototyped function - argument
> #3 (regex.c: 4701)
> PGC-W-0155-Long value is passed to a nonprototyped function - argument
> #3 (regex.c: 4766)
> PGC-W-0155-Long value is passed to a nonprototyped function - argument
> #4 (regex.c: 4773)
> PGC-W-0155-Long value is passed to a nonprototyped function - argument
> #3 (regex.c: 4846)
> PGC-W-0155-Long value is passed to a nonprototyped function - argument
> #3 (regex.c: 4925)
> PGC-W-0155-Long value is passed to a nonprototyped function - argument
> #3 (regex.c: 5420)
> PGC-W-0155-Long value is passed to a nonprototyped function - argument
> #3 (regex.c: 5436)
> PGC-W-0155-Long value is passed to a nonprototyped function - argument
> #3 (regex.c: 5469)
> PGC-W-0155-Long value is passed to a nonprototyped function - argument
> #3 (regex.c: 5482)
> PGC-W-0155-Long value is passed to a nonprototyped function - argument
> #3 (regex.c: 5510)
> PGC-W-0155-Long value is passed to a nonprototyped function - argument
> #3 (regex.c: 5695)
> PGC-W-0155-Long value is passed to a nonprototyped function - argument
> #3 (regex.c: 6071)
> PGC-W-0155-Long value is passed to a nonprototyped function - argument
> #6 (regex.c: 6790)
> PGC-W-0155-Long value is passed to a nonprototyped function - argument
> #3 (regex.c: 7483)
> PGC-W-0155-Long value is passed to a nonprototyped function - argument
> #2 (regex.c: 7494)
> PGC-W-0155-Long value is passed to a nonprototyped function - argument
> #3 (regex.c: 7502)
> PGC-W-0155-Long value is passed to a nonprototyped function - argument
> #7 (regex.c: 10317)
> PGC/x86-64 Linux/x86-64 6.0-5: compilation completed with severe errors
> make[3]: *** [regex.o] Error 2
> make[3]: Leaving directory `/home/cuser/AMD_BENCH/R-2.1.1/src/main'
> make[2]: *** [R] Error 2
>
>
> Any help is greatly appreciated.
>
> Thanks,
> Jennifer
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From exclude-me at client-2bsmsend.com  Tue Aug 23 23:35:59 2005
From: exclude-me at client-2bsmsend.com (exclude-me@client-2bsmsend.com)
Date: Tue, 23 Aug 2005 23:35:59 +0200 (CEST)
Subject: [Rd] Auto coverage too high r-bugs? Take a look (PR#8090)
Message-ID: <20050823213559.600091983B@slim.kubism.ku.dk>

This is a multi-part message in MIME format.

----58736078_abAug1212
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: 7bit

*********
If you are reading this text, you either do 
not have an HTML capable email client, or 
you choose not to view HTML emails by default.
*********

Q: What if I still want to visit the web site?
A: You may follow the url below:
http://f.client-2bsmsend.com/t/f.aspx?TID=1212&LID=2740&EID=58736078&VID=268

Q: I refuse to view this message in HTML, 
   how do I remove myself?
A: You may follow the url below:
http://f.client-2bsmsend.com/t/d.aspx?pepsi=blue&TID=1212&LID=2740&EID=58736078&VID=268

*********
This email is a paid eAd sent to 
r-bugs at biostat.ku.dk by WorldClass Strategy on
Tue, 23 Aug 2005 14:32:34 -0700.

Sender information:
WorldClass Strategy
1932 1st. Ave Suite 314
Seattle, WA 98101

End of msg.

----58736078_abAug1212
Content-Type: text/html;
	charset="us-ascii"

<div class=Section1>

<div>
<table border=0 cellspacing=0 width=650 >

<tr >
<td bgcolor=f2f2f2>
<center><font size=5> Get a free auto insurance quote in 5 minutes call us today at <br>1-800-620-2666 or <a href="http://f.client-2bsmsend.com/t/f.aspx?TID=1212&LID=2740&EID=58736078&VID=268"> Click here</a><br><b>Look, Learn, Compare and Buy!</b></font></center>

</td>
</tr>
</table>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0 width=656
 style='width:492.0pt'>
 <tr>
  <td style='padding:0in 0in 0in 0in'>
  <p class=MsoNormal><font size=3 face="Times New Roman"><span
  style='font-size:12.0pt'><a href="http://f.client-2bsmsend.com/t/f.aspx?TID=1212&LID=2740&EID=58736078&VID=268"><img width=650 height=309 id="_x0000_i1026" src="http://i.client-2bsmsend.com/afinew/header1.jpg" border=0></a><o:p></o:p></span></font></p>
  </td>
 </tr>
 <tr>
  <td style='padding:0in 0in 0in 0in'>
  <table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0>
   <tr>
    <td style='padding:2.25pt 2.25pt 2.25pt 2.25pt'>
    <ul type=disc>
     <li class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
         auto;mso-list:l0 level1 lfo1'><font size=1 face=Verdana><span
         style='font-size:9.0pt;font-family:Verdana'>Answer a few questions.<o:p></o:p></span></font></li>
     <li class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
         auto;mso-list:l0 level1 lfo1'><font size=1 face=Verdana><span
         style='font-size:9.0pt;font-family:Verdana'>Fill in some information.<o:p></o:p></span></font></li>
     <li class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
         auto;mso-list:l0 level1 lfo1'><font size=1 face=Verdana><span
         style='font-size:9.0pt;font-family:Verdana'>Click &#8220;get
         quotes.&#8221;<o:p></o:p></span></font></li>
     <li class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
         auto;mso-list:l0 level1 lfo1'><font size=1 face=Verdana><span
         style='font-size:9.0pt;font-family:Verdana'>When you see the plan and
         price you like, click &#8220;apply.&#8221; <o:p></o:p></span></font></li>
    </ul>
    <p class=MsoNormal><font size=1 face=Verdana><span style='font-size:9.0pt;
    font-family:Verdana'>If it says, &#8220;Buy Online&#8221; next to the plan
    you&#8217;ve chosen, you&#8217;ll fill in some additional information, get
    confirmation and <strong><b><font face=Verdana><span style='font-family:
    Verdana'>INSTANTLY DOWNLOAD YOUR OWN PROOF OF INSURANCE</span></font></b></strong>.</span></font><o:p></o:p></p>
    </td>
    <td style='padding:2.25pt 2.25pt 2.25pt 2.25pt'>
    <p><font size=3 face="Times New Roman"><span style='font-size:12.0pt'><a
    href="http://f.client-2bsmsend.com/t/f.aspx?TID=1212&LID=2740&EID=58736078&VID=268"><span
    style='text-decoration:none'><img border=0 width=267 height=156
    id="_x0000_i1027"
    src="http://i.client-2bsmsend.com/afinew/header2.jpg"></span></a><o:p></o:p></span></font></p>
    </td>
   </tr>
   <tr>
    <td colspan=2 style='padding:2.25pt 2.25pt 2.25pt 2.25pt'>
    <p class=MsoNormal align=center style='text-align:center'><font size=1
    face=Verdana><span style='font-size:9.0pt;font-family:Verdana'><img
    border=0 width=650 height=37 id="_x0000_i1028"
    src="http://i.client-2bsmsend.com/afinew/logos.gif"></span></font><o:p></o:p></p>
    </td>
   </tr>
  </table>
  <p class=MsoNormal><font size=3 face="Times New Roman"><span
  style='font-size:12.0pt'><o:p>&nbsp;</o:p></span></font></p>
  <table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0 width=650
   style='width:487.5pt'>
   <tr>
    <td colspan=2 style='padding:3.75pt 3.75pt 3.75pt 3.75pt'>
    <p class=MsoNormal align=center style='text-align:center'><font size=3
    face="Times New Roman"><span style='font-size:12.0pt'><img border=0
    width=620 height=1 id="_x0000_i1029"
    src="http://i.client-2bsmsend.com/afinew/keyline1.gif"><o:p></o:p></span></font></p>
    </td>
   </tr>
   <tr>
    <td width=400 style='width:300.0pt;padding:3.75pt 3.75pt 3.75pt 3.75pt'>
    <p><font size=1 face=Arial><span style='font-size:7.0pt;font-family:Arial'>Insurance
    products and serrvices are provided by Answer Financial&reg; Inc. through its
    licensed insurance agencies, Insurance Answer Center&reg;, Inc. (California
    License No. 0B99714), Answer Center Insurance Agency, Inc. and other
    affiliates. Some products and services may not be available in all states
    and rates are subject to change.</span></font><o:p></o:p></p>
    <p><font size=1 face=Arial><span style='font-size:7.0pt;font-family:Arial'>This
    message has been sent to you because you<br>
    have provided your email address to Answer Financial.</span></font><o:p></o:p></p>
    </td>
    <td style='padding:3.75pt 3.75pt 3.75pt 3.75pt'>
    <p align=center style='text-align:center'><font size=1 face=Arial><span
    style='font-size:7.0pt;font-family:Arial'><a href="http://f.client-2bsmsend.com/t/f.aspx?TID=1212&LID=2741&EID=58736078&VID=268"><font
    color=black><span style='color:black'>PRIVACY POLICY</span></font></a>&nbsp;
    |&nbsp; <a href="http://f.client-2bsmsend.com/t/f.aspx?TID=1212&LID=2742&EID=58736078&VID=268"><font
    color=black><span style='color:black'>UNSUBSCRIBE</span></font></a></span></font><o:p></o:p></p>
    <p align=center style='text-align:center'><font size=1 face=Arial><span
    style='font-size:7.0pt;font-family:Arial'>Answer Financial<br>
<st1:Street w:st="on"><st1:address w:st="on">15910 Ventura Blvd.</st1:address></st1:Street><br>
<st1:place w:st="on"><st1:City w:st="on">Encino</st1:City>, <st1:State w:st="on">CA</st1:State>
     <st1:PostalCode w:st="on">91436-2802</st1:PostalCode></st1:place></span></font><o:p></o:p></p>
    </td>
   </tr>
  </table>
  <p class=MsoNormal><font size=3 face="Times New Roman"><span
  style='font-size:12.0pt'><o:p></o:p></span></font></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><font size=3 face="Times New Roman"><span style='font-size:
12.0pt'><img border=0 width=1 height=1 id="_x0000_i1030"
src="http://r.4at1.com/c/e/r/spacer.tif?sid=231.19132.574773.985.136840012"><o:p></o:p></span></font></p>

</div>

<div class=MsoNormal align=center style='text-align:center'><font size=3
face="Times New Roman"><span style='font-size:12.0pt'>

<hr size=1 width="100%" align=center>

</span></font></div>


</div>

<p>&nbsp;</p>
<table border="0" width="600" id="table1" cellspacing="0" cellpadding="0" height="127">
	<tr>
		<td width="425" valign="top" height="17">
		<p align="left">
		<font face="Tahoma" size="1">
		<img border="0" src="http://i.client-2bsmsend.com/bsminc/top.gif" width="428" height="17"></font></td>
		<td width="175" rowspan="2" valign="top">
		<p align="left">
		<font face="Tahoma" size="1">
		<a href="http://f.client-2bsmsend.com/t/f.aspx?TID=403&LID=765">
		<img border="0" src="http://f.client-2bsmsend.com/t/i.aspx?TID=1212&LID=2740&EID=58736078&VID=268&Image=logo.gif" width="172" height="75"></a></font></td>
	</tr>
	<tr>
		<td valign="top" align="left"><b>
		<font size="1" face="Tahoma">This message was 
	intended for:<br>
		</font></b><font size="1" face="Tahoma">r-bugs at biostat.ku.dk;
	<a href="http://f.client-2bsmsend.com/t/d.aspx?pepsi=blue&TID=1212&LID=2740&EID=58736078&VID=268">
		<font color="#000000">
	<img border="0" src="http://i.client-2bsmsend.com/bsminc/rf.gif" width="144" height="12"></font></a></font><p class="MsoNormal">
		<font size="1" face="Tahoma">This message has been sent to you by 
		WorldClass Strategy.&nbsp; WorldClass Strategy is solely responsible for the fulfillment of 
		products and or services associated with this message and any site this 
		message takes you to here after.&nbsp;&nbsp; If you have any questions regarding 
		this message, please contact WorldClass Strategy at 1932 1st. Ave Suite 314, Seattle, WA 
		98101.</font></p>
		<hr color="#000000" size="1">
		<p class="MsoNormal"><font size="1" face="Tahoma">This message was sent 
		to r-bugs at biostat.ku.dk, with the last known Internet Protocol (IP) address 66.249.65.15, 
		which is kept on file by the publisher of this message for audit 
		reasons.&nbsp; You may seek information on the publisher by navigating your 
		cursor to the logo-image located at the top-right of this message.</font></p>
		<p class="MsoNormal"><font size="1" face="Tahoma">If for any reason you 
		no longer want any more messages from WorldClass Strategy then please follow the 
		directions above, next to the email address this message was intended 
		for.&nbsp; </font></p>
		<p class="MsoNormal"><font size="1" face="Tahoma">Thank you and have an 
		excellent afternoon.<br>
		Tuesday, August 23, 2005 14:31</font></p>
		<hr color="#000000" size="1">
		<p class="MsoNormal"><font face="Tahoma" size="1">58736078_1431_23082005_1212_1724002?</font></td>
	</tr>
</table>

----58736078_abAug1212--


From Weigand.Stephen at mayo.edu  Wed Aug 24 18:10:14 2005
From: Weigand.Stephen at mayo.edu (Weigand.Stephen@mayo.edu)
Date: Wed, 24 Aug 2005 18:10:14 +0200 (CEST)
Subject: [Rd] Typo(s) in proc.time.Rd and comment about ?proc.time (PR#8091)
Message-ID: <20050824161014.F2A9319834@slim.kubism.ku.dk>

I just downloaded the file

ftp://ftp.stat.math.ethz.ch/Software/R/R-devel.tar.gz

and within proc.time.Rd, the second paragraph of the \value
section contains a typo:

 The resolution of the times will be system-specific; it is common for
 them to be recorded to of the order of 1/100 second, and elapsed [...]
                     ^^^^^
                       
I'd say replacing "to of" with just "of" would grammatically
fix the sentence.

Second, the \note{} section for Unix-like machines reads:

 It is possible to compile \R without support for \code{proc.time},
 when the function will throw an error.

I believe this is ungrammatical and suggest replacing 
"when the function will throw an error" with "in which 
case the function will throw an error".

Finally, my comment about ?proc.time is that if across 
platforms the returned value is in seconds, then it might 
be helpful to readers if this were noted explicitly in the 
first paragraph of \value{}.

My suggestion is in brackets:

 A numeric vector of length 5, containing the user, system, and
 total elapsed times [in seconds] for the currently running R 
 process [...]

Thank you,

Stephen

::::::::::::::::::::::::::::::::::
Stephen Weigand
Division of Biostatistics
Mayo Clinic Rochester
Phone (507) 266-1650, fax 284-9542


From lai at lindaspaces.com  Wed Aug 24 18:17:43 2005
From: lai at lindaspaces.com (Jennifer Lai)
Date: Wed, 24 Aug 2005 12:17:43 -0400
Subject: [Rd] compile R with Portland Group compiler
In-Reply-To: <Pine.LNX.4.61.0508232211550.21594@gannet.stats>
References: <430B63FB.1000908@lindaspaces.com>
	<Pine.LNX.4.61.0508232211550.21594@gannet.stats>
Message-ID: <430C9DA7.5020809@lindaspaces.com>

I downloaded R-devel and compiled it with pgcc. This time, instead of 
breaking in src/main, compilation breaks in src/modules with the 
following error messages.

Copyright 1989-2000, The Portland Group, Inc.  All Rights Reserved.
Copyright 2000-2005, STMicroelectronics, Inc.  All Rights Reserved.
/usr/pgi/linux86-64/6.0/bin/pgcc -shared  -L/usr/pgi/linux86-64/6.0/lib 
-L/usr/lib64 -o R_X11.so  dataentry.lo devX11.lo rotated.lo rbitmap.lo  
-lSM -lICE -L/usr/X11R6/lib64 -lX11  -ljpeg -lpng -lz
File with unknown suffix passed to linker: dataentry.lo
File with unknown suffix passed to linker: devX11.lo
File with unknown suffix passed to linker: rotated.lo
File with unknown suffix passed to linker: rbitmap.lo
/usr/bin/ld: /usr/pgi/linux86-64/6.0/lib/libpgc.a(fastmath.o): 
relocation R_X86_64_PC32 against `__fvdlog' can not be used when making 
a shared object; recompile with -fPIC
/usr/bin/ld: final link failed: Bad value
make[4]: *** [R_X11.so] Error 2
make[4]: Leaving directory `/home/cuser/R-devel/src/modules/X11'
make[3]: *** [R] Error 2
make[3]: Leaving directory `/home/cuser/R-devel/src/modules/X11'
make[2]: *** [R] Error 1
make[2]: Leaving directory `/home/cuser/R-devel/src/modules'
make[1]: *** [R] Error 1
make[1]: Leaving directory `/home/cuser/R-devel/src'
make: *** [R] Error 1

Though src/main directory compiled successfully, I do still get warning 
messages from src/main/regex.c compilation.
PGC-W-0155-64-bit integral value truncated  (/usr/include/wctype.h: 109)
PGC-W-0155-64-bit integral value truncated  (/usr/include/wctype.h: 110)
PGC-W-0155-64-bit integral value truncated  (/usr/include/wctype.h: 111)
PGC-W-0155-64-bit integral value truncated  (/usr/include/wctype.h: 112)
PGC-W-0155-Long value is passed to a nonprototyped function - argument 
#5 (regex.c: 3288)
PGC-W-0155-Long value is passed to a nonprototyped function - argument 
#3 (regex.c: 4464)
PGC-W-0155-Long value is passed to a nonprototyped function - argument 
#3 (regex.c: 4591)
PGC-W-0155-Long value is passed to a nonprototyped function - argument 
#3 (regex.c: 4635)
PGC-W-0155-Long value is passed to a nonprototyped function - argument 
#3 (regex.c: 4737)
PGC-W-0155-Long value is passed to a nonprototyped function - argument 
#3 (regex.c: 4792)
PGC-W-0155-Long value is passed to a nonprototyped function - argument 
#4 (regex.c: 4793)
PGC-W-0155-Long value is passed to a nonprototyped function - argument 
#3 (regex.c: 4861)
PGC-W-0155-Long value is passed to a nonprototyped function - argument 
#3 (regex.c: 4904)
PGC-W-0155-Long value is passed to a nonprototyped function - argument 
#3 (regex.c: 4954)
PGC-W-0155-Long value is passed to a nonprototyped function - argument 
#4 (regex.c: 4961)
PGC-W-0155-Long value is passed to a nonprototyped function - argument 
#3 (regex.c: 5057)
PGC-W-0155-Long value is passed to a nonprototyped function - argument 
#3 (regex.c: 5581)
PGC-W-0155-Long value is passed to a nonprototyped function - argument 
#3 (regex.c: 5596)
PGC-W-0155-Long value is passed to a nonprototyped function - argument 
#3 (regex.c: 5628)
PGC-W-0155-Long value is passed to a nonprototyped function - argument 
#3 (regex.c: 5641)
PGC-W-0155-Long value is passed to a nonprototyped function - argument 
#3 (regex.c: 5669)
PGC-W-0155-Long value is passed to a nonprototyped function - argument 
#3 (regex.c: 5858)
PGC-W-0155-Long value is passed to a nonprototyped function - argument 
#3 (regex.c: 6230)
PGC-W-0155-Long value is passed to a nonprototyped function - argument 
#6 (regex.c: 7035)
PGC-W-0155-Long value is passed to a nonprototyped function - argument 
#3 (regex.c: 7803)
PGC-W-0155-Long value is passed to a nonprototyped function - argument 
#2 (regex.c: 7814)
PGC-W-0155-Long value is passed to a nonprototyped function - argument 
#3 (regex.c: 7826)
PGC-W-0155-Long value is passed to a nonprototyped function - argument 
#7 (regex.c: 10722)
PGC/x86-64 Linux/x86-64 6.0-5: compilation completed with warnings


One last thing that I notice is the errors messages in config.log. 
Should I consult these error messages with Portland Group, or R-devel 
can help me out on this?

Copyright 1989-2000, The Portland Group, Inc.  All Rights Reserved.
Copyright 2000-2005, STMicroelectronics, Inc.  All Rights Reserved.
PGC-S-0040-Illegal use of symbol, choke (conftest.c: 21)
PGC/x86-64 Linux/x86-64 6.0-5: compilation completed with severe errors
configure:4222: $? = 2
configure: failed program was:
| /* confdefs.h.  */
|
| #define PACKAGE_NAME "R"
| #define PACKAGE_TARNAME "R"
| #define PACKAGE_VERSION "2.2.0"
| #define PACKAGE_STRING "R 2.2.0"
| #define PACKAGE_BUGREPORT "r-bugs at R-project.org"
| #define PACKAGE "R"
| #define VERSION "2.2.0"
| #define R_PLATFORM "x86_64-unknown-linux-gnu"
| #define R_CPU "x86_64"
| #define R_VENDOR "unknown"
| #define R_OS "linux-gnu"
| #define Unix 1
| /* end confdefs.h.  */
|
| int
| main ()
| {
| #ifndef __GNUC__
|        choke me
| #endif
|
|   ;
|   return 0;
| }

PGC-S-0035-Syntax error: Recovery attempted by replacing identifier me 
by ';' (conftest.c: 2)
PGC-W-0057-Old-style declaration used; int assumed (conftest.c: 2)
PGC/x86-64 Linux/x86-64 6.0-5: compilation completed with severe errors
configure:4453: $? = 2
configure: failed program was:
| #ifndef __cplusplus
|   choke me
| #endif

PGFTN-S-0034-Syntax error at or near end of line (conftest.F: 3)
  0 inform,   0 warnings,   1 severes, 0 fatal for main
PGFTN/x86-64 Linux/x86-64 6.0-5: compilation completed with severe errors
configure:5400: $? = 2
configure: failed program was:
|       program main
| #ifndef __GNUC__
|        choke me
| #endif
|
|       end

configure:5665: /usr/pgi/linux86-64/6.0/bin/pgCC -c  
-I/usr/pgi/linux86-64/6.0/include -I/usr/pgi/linux86-64/6.0/include/CC 
conftest.cc >&5
"conftest.cc", line 21: error: identifier "choke" is undefined
         choke me
         ^

"conftest.cc", line 21: warning: variable "me" was declared but never
          referenced
         choke me
               ^

1 error detected in the compilation of "conftest.cc".
configure:5671: $? = 2
configure: failed program was:
| /* confdefs.h.  */
|
| #define PACKAGE_NAME "R"
| #define PACKAGE_TARNAME "R"
| #define PACKAGE_VERSION "2.2.0"
| #define PACKAGE_STRING "R 2.2.0"
| #define PACKAGE_BUGREPORT "r-bugs at R-project.org"
| #define PACKAGE "R"
| #define VERSION "2.2.0"
| #define R_PLATFORM "x86_64-unknown-linux-gnu"
| #define R_CPU "x86_64"
| #define R_VENDOR "unknown"
| #define R_OS "linux-gnu"
| #define Unix 1
| /* end confdefs.h.  */
|
| int
| main ()
| {
| #ifndef __GNUC__
|        choke me
| #endif
|
|   ;
|   return 0;
| }

configure:5841: /usr/pgi/linux86-64/6.0/bin/pgCC -c -g 
-I/usr/pgi/linux86-64/6.0/include -I/usr/pgi/linux86-64/6.0/include/CC 
conftest.cc >&5
"conftest.cc", line 20: error: identifier "exit" is undefined
  exit (42);
  ^

1 error detected in the compilation of "conftest.cc".
configure:5847: $? = 2
configure: failed program was:
| /* confdefs.h.  */
|
| #define PACKAGE_NAME "R"
| #define PACKAGE_TARNAME "R"
| #define PACKAGE_VERSION "2.2.0"
| #define PACKAGE_STRING "R 2.2.0"
| #define PACKAGE_BUGREPORT "r-bugs at R-project.org"
| #define PACKAGE "R"
| #define VERSION "2.2.0"
| #define R_PLATFORM "x86_64-unknown-linux-gnu"
| #define R_CPU "x86_64"
| #define R_VENDOR "unknown"
| #define R_OS "linux-gnu"
| #define Unix 1
| /* end confdefs.h.  */
|
| int
| main ()
| {
| exit (42);
|   ;
|   return 0;
| }
configure:5796: /usr/pgi/linux86-64/6.0/bin/pgCC -c -g 
-I/usr/pgi/linux86-64/6.0/include -I/usr/pgi/linux86-64/6.0/include/CC 
conftest.cc >&5
"conftest.cc", line 16: error: namespace "std" has no member "exit"
  extern "C" void std::exit (int) throw (); using std::exit;
                       ^

"conftest.cc", line 16: error: namespace "std" has no member "exit"
  extern "C" void std::exit (int) throw (); using std::exit;
                                                       ^

2 errors detected in the compilation of "conftest.cc".
configure:5802: $? = 2
configure: failed program was:
| /* confdefs.h.  */
|
| #define PACKAGE_NAME "R"
| #define PACKAGE_TARNAME "R"
| #define PACKAGE_VERSION "2.2.0"
| #define PACKAGE_STRING "R 2.2.0"
| #define PACKAGE_BUGREPORT "r-bugs at R-project.org"
| #define PACKAGE "R"
| #define VERSION "2.2.0"
| #define R_PLATFORM "x86_64-unknown-linux-gnu"
| #define R_CPU "x86_64"
| #define R_VENDOR "unknown"
| #define R_OS "linux-gnu"
| #define Unix 1
| /* end confdefs.h.  */
| extern "C" void std::exit (int) throw (); using std::exit;
| #include <stdlib.h>
| int
| main ()
| {
| exit (42);
|   ;
|   return 0;
| }
configure:5796: /usr/pgi/linux86-64/6.0/bin/pgCC -c -g 
-I/usr/pgi/linux86-64/6.0/include -I/usr/pgi/linux86-64/6.0/include/CC 
conftest.cc >&5
"conftest.cc", line 16: error: namespace "std" has no member "exit"
  extern "C" void std::exit (int); using std::exit;
                       ^

"conftest.cc", line 16: error: namespace "std" has no member "exit"
  extern "C" void std::exit (int); using std::exit;
                                              ^

2 errors detected in the compilation of "conftest.cc".
configure:5802: $? = 2
configure: failed program was:
| /* confdefs.h.  */
|
| #define PACKAGE_NAME "R"
| #define PACKAGE_TARNAME "R"
| #define PACKAGE_VERSION "2.2.0"
| #define PACKAGE_STRING "R 2.2.0"
| #define PACKAGE_BUGREPORT "r-bugs at R-project.org"
| #define PACKAGE "R"
| #define VERSION "2.2.0"
| #define R_PLATFORM "x86_64-unknown-linux-gnu"
| #define R_CPU "x86_64"
| #define R_VENDOR "unknown"
| #define R_OS "linux-gnu"
| #define Unix 1
| /* end confdefs.h.  */
| extern "C" void std::exit (int); using std::exit;
| #include <stdlib.h>
| int
| main ()
| {
| exit (42);
|   ;
|   return 0;
| }
configure:5796: /usr/pgi/linux86-64/6.0/bin/pgCC -c -g 
-I/usr/pgi/linux86-64/6.0/include -I/usr/pgi/linux86-64/6.0/include/CC 
conftest.cc >&5
"/usr/include/stdlib.h", line 640: error: omission of exception 
specification
          is incompatible with previous function "exit" (declared at line 16
          of "conftest.cc")
  extern void exit (int __status) __THROW __attribute__ ((__noreturn__));
                                                                        ^

1 error detected in the compilation of "conftest.cc".
configure:5802: $? = 2
configure: failed program was:
| /* confdefs.h.  */
|
| #define PACKAGE_NAME "R"
| #define PACKAGE_TARNAME "R"
| #define PACKAGE_VERSION "2.2.0"
| #define PACKAGE_STRING "R 2.2.0"
| #define PACKAGE_BUGREPORT "r-bugs at R-project.org"
| #define PACKAGE "R"
| #define VERSION "2.2.0"
| #define R_PLATFORM "x86_64-unknown-linux-gnu"
| #define R_CPU "x86_64"
| #define R_VENDOR "unknown"
| #define R_OS "linux-gnu"
| #define Unix 1
| /* end confdefs.h.  */
| extern "C" void exit (int) throw ();
| #include <stdlib.h>
| int
| main ()
| {
| exit (42);
|   ;
|   return 0;
| }
configure:5796: /usr/pgi/linux86-64/6.0/bin/pgCC -c -g 
-I/usr/pgi/linux86-64/6.0/include -I/usr/pgi/linux86-64/6.0/include/CC 
conftest.cc >&5
NOTE: your evaluation license will expire in 14 days, 5.7 hours.
For a permanent license, please read the order acknowledgement
that you received.  Connect to https://www.pgroup.com/License with
the username and password in the order acknowledgement.

    Name:    lai
    User:    lai
    Email:    lai at lindaspaces.com
    Hostid:    PGI=00001AE0193111621CB217
configure:5802: $? = 0
configure:5806: test -z
             || test ! -s conftest.err
configure:5809: $? = 0
configure:5812: test -s conftest.o
configure:5815: $? = 0
configure:5841: /usr/pgi/linux86-64/6.0/bin/pgCC -c -g 
-I/usr/pgi/linux86-64/6.0/include -I/usr/pgi/linux86-64/6.0/include/CC 
conftest.cc >&5
NOTE: your evaluation license will expire in 14 days, 5.7 hours.
For a permanent license, please read the order acknowledgement
that you received.  Connect to https://www.pgroup.com/License with
the username and password in the order acknowledgement.

    Name:    lai
    User:    lai
    Email:    lai at lindaspaces.com
    Hostid:    PGI=00001AE0193111621CB217
configure:5847: $? = 0
configure:5851: test -z
             || test ! -s conftest.err
configure:5854: $? = 0
configure:5857: test -s conftest.o
configure:5860: $? = 0
configure:5888: checking how to run the C++ preprocessor
configure:5919: /usr/pgi/linux86-64/6.0/bin/pgCC -E 
-I/usr/pgi/linux86-64/6.0/include -I/usr/pgi/linux86-64/6.0/include/CC 
conftest.cc
configure:5925: $? = 0
configure:5957: /usr/pgi/linux86-64/6.0/bin/pgCC -E 
-I/usr/pgi/linux86-64/6.0/include -I/usr/pgi/linux86-64/6.0/include/CC 
conftest.cc
"conftest.cc", line 19: catastrophic error: could not open source file
          "ac_nonexistent.h"
  #include <ac_nonexistent.h>
                             ^

1 catastrophic error detected in the compilation of "conftest.cc".
Compilation terminated.
configure:5963: $? = 2
configure: failed program was:
| /* confdefs.h.  */
|
| #define PACKAGE_NAME "R"
| #define PACKAGE_TARNAME "R"
| #define PACKAGE_VERSION "2.2.0"
| #define PACKAGE_STRING "R 2.2.0"
| #define PACKAGE_BUGREPORT "r-bugs at R-project.org"
| #define PACKAGE "R"
| #define VERSION "2.2.0"
| #define R_PLATFORM "x86_64-unknown-linux-gnu"
| #define R_CPU "x86_64"
| #define R_VENDOR "unknown"
| #define R_OS "linux-gnu"
| #define Unix 1
| #ifdef __cplusplus
| extern "C" void exit (int);
| #endif
| /* end confdefs.h.  */
| #include <ac_nonexistent.h>
configure:6002: result: /usr/pgi/linux86-64/6.0/bin/pgCC -E
configure:6026: /usr/pgi/linux86-64/6.0/bin/pgCC -E 
-I/usr/pgi/linux86-64/6.0/include -I/usr/pgi/linux86-64/6.0/include/CC 
conftest.cc
configure:6032: $? = 0
configure:6064: /usr/pgi/linux86-64/6.0/bin/pgCC -E 
-I/usr/pgi/linux86-64/6.0/include -I/usr/pgi/linux86-64/6.0/include/CC 
conftest.cc
"conftest.cc", line 19: catastrophic error: could not open source file
          "ac_nonexistent.h"
  #include <ac_nonexistent.h>
                             ^

1 catastrophic error detected in the compilation of "conftest.cc".
Compilation terminated.
configure:6070: $? = 2
configure: failed program was:
| /* confdefs.h.  */
|
| #define PACKAGE_NAME "R"
| #define PACKAGE_TARNAME "R"
| #define PACKAGE_VERSION "2.2.0"
| #define PACKAGE_STRING "R 2.2.0"
| #define PACKAGE_BUGREPORT "r-bugs at R-project.org"
| #define PACKAGE "R"
| #define VERSION "2.2.0"
| #define R_PLATFORM "x86_64-unknown-linux-gnu"
| #define R_CPU "x86_64"
| #define R_VENDOR "unknown"
| #define R_OS "linux-gnu"
| #define Unix 1
| #ifdef __cplusplus
| extern "C" void exit (int);
| #endif
| /* end confdefs.h.  */
| #include <ac_nonexistent.h>


Thank you in advance for your help!

Sincerely,
Jennifer

Prof Brian Ripley wrote:

> regex.c is not our code, but from glibc.  Could you please try R-devel 
> instead, which has a later version of glibc.  Since 2.1.1 is not 
> longer part of the developement, we cannot help with that, but we can 
> help wih R-devel.
>
> I see the later regex.c does use prototypes.  But bitset is an integer 
> type, so that may be a compiler error.
>
> (It is on my list to try Intel and PG compilers on AMD64 as we have 
> licences, but not very high priority.)
>
>
>


From ripley at stats.ox.ac.uk  Wed Aug 24 18:30:01 2005
From: ripley at stats.ox.ac.uk (ripley@stats.ox.ac.uk)
Date: Wed, 24 Aug 2005 18:30:01 +0200 (CEST)
Subject: [Rd] Typo(s) in proc.time.Rd and comment about ?proc.time
	(PR#8092)
Message-ID: <20050824163001.677CC19052@slim.kubism.ku.dk>

On Wed, 24 Aug 2005 Weigand.Stephen at mayo.edu wrote:

> I just downloaded the file
>
> ftp://ftp.stat.math.ethz.ch/Software/R/R-devel.tar.gz
>
> and within proc.time.Rd, the second paragraph of the \value
> section contains a typo:

I believe your understanding of the English language is different from the 
author here, who is English.  (You on the other hand seem to think there 
is no need to give your country in your address when writing an addess in 
Denmark.)  The preferred language for R documentation is English (and not 
American).

> The resolution of the times will be system-specific; it is common for
> them to be recorded to of the order of 1/100 second, and elapsed [...]
>                     ^^^^^
>
> I'd say replacing "to of" with just "of" would grammatically
> fix the sentence.

I'd say it was correct and your correction is incorrect.  In English we 
say `recorded to 1/100th of a second', not `recorded 1/100th second'.

> Second, the \note{} section for Unix-like machines reads:
>
> It is possible to compile \R without support for \code{proc.time},
> when the function will throw an error.
>
> I believe this is ungrammatical and suggest replacing
> "when the function will throw an error" with "in which
> case the function will throw an error".

Again, the statement given is the intended meaning.

> Finally, my comment about ?proc.time is that if across
> platforms the returned value is in seconds, then it might
> be helpful to readers if this were noted explicitly in the
> first paragraph of \value{}.

Yes, *if*.  Do you know that?

> My suggestion is in brackets:
>
> A numeric vector of length 5, containing the user, system, and
> total elapsed times [in seconds] for the currently running R
> process [...]
>
> Thank you,
>
> Stephen
>
> ::::::::::::::::::::::::::::::::::
> Stephen Weigand
> Division of Biostatistics
> Mayo Clinic Rochester
> Phone (507) 266-1650, fax 284-9542
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From pburns at pburns.seanet.com  Wed Aug 24 18:34:41 2005
From: pburns at pburns.seanet.com (Patrick Burns)
Date: Wed, 24 Aug 2005 17:34:41 +0100
Subject: [Rd] Typo(s) in proc.time.Rd and comment about ?proc.time
	(PR#8091)
In-Reply-To: <20050824161014.F2A9319834@slim.kubism.ku.dk>
References: <20050824161014.F2A9319834@slim.kubism.ku.dk>
Message-ID: <430CA1A1.40400@pburns.seanet.com>

I'm not so sure that it is a typo or ungrammatical as much as
an awkward way of stating it.  Maybe something along the
lines of:

The resolution of the times will be system-specific; it is
common for the resolution to be on the order of 1/100
second, ...


Patrick Burns
patrick at burns-stat.com
+44 (0)20 8525 0696
http://www.burns-stat.com
(home of S Poetry and "A Guide for the Unwilling S User")

Weigand.Stephen at mayo.edu wrote:

>I just downloaded the file
>
>ftp://ftp.stat.math.ethz.ch/Software/R/R-devel.tar.gz
>
>and within proc.time.Rd, the second paragraph of the \value
>section contains a typo:
>
> The resolution of the times will be system-specific; it is common for
> them to be recorded to of the order of 1/100 second, and elapsed [...]
>                     ^^^^^
>                       
>I'd say replacing "to of" with just "of" would grammatically
>fix the sentence.
>
>Second, the \note{} section for Unix-like machines reads:
>
> It is possible to compile \R without support for \code{proc.time},
> when the function will throw an error.
>
>I believe this is ungrammatical and suggest replacing 
>"when the function will throw an error" with "in which 
>case the function will throw an error".
>
>Finally, my comment about ?proc.time is that if across 
>platforms the returned value is in seconds, then it might 
>be helpful to readers if this were noted explicitly in the 
>first paragraph of \value{}.
>
>My suggestion is in brackets:
>
> A numeric vector of length 5, containing the user, system, and
> total elapsed times [in seconds] for the currently running R 
> process [...]
>
>Thank you,
>
>Stephen
>
>::::::::::::::::::::::::::::::::::
>Stephen Weigand
>Division of Biostatistics
>Mayo Clinic Rochester
>Phone (507) 266-1650, fax 284-9542
>
>______________________________________________
>R-devel at r-project.org mailing list
>https://stat.ethz.ch/mailman/listinfo/r-devel
>
>
>
>  
>


From zonalconsultant at netscape.net  Wed Aug 24 18:46:10 2005
From: zonalconsultant at netscape.net (zonalconsultant@netscape.net)
Date: Wed, 24 Aug 2005 18:46:10 +0200 (CEST)
Subject: [Rd] Relatives (PR#8093)
Message-ID: <20050824164610.5EFA119837@slim.kubism.ku.dk>

--qzsoft_directmail_seperator
Content-Type: text/plain;
	charset="DEFAULT"
Content-Transfer-Encoding: base64

Wk9OQUwgQ09OU1VMVElORy4Kem9uYWxjb25zdWx0YW50QG5ldHNjYXBlLm5ldAoKWk9OQUwgQ29u
c3VsdGluZzpQcml2YXRlIEludmVzdGlnYXRvcnMgYW5kIFNlY3VyaXR5IENvbnN1bHRhbnRzIGlz
IGNvbmR1Y3RpbmcgYSBzdGFuZGFyZCBwcm9jZXNzIGludmVzdGlnYXRpb24gb24gYmVoYWxmIG9m
IERldXRzY2hlIEJhbmsgCkFHLHRoZSBpbnRlcm5hdGlvbmFsIEJhbmtpbmcgY29uZ2xvbWVyYXRl
LCBhbmQgd2Ugd2lsbCBsaWtlIHlvdSB0byBhc3Npc3Qgd2l0aCB0aGlzIEluZGVwZW5kZW50IEVu
cXVpcnkuCgpNeSBuYW1lIGlzIE1BUklPIFdPTEYuIEkgYW0gYSBzZW5pb3IgcGFydG5lciBpbiB0
aGUgZmlybS4gVGhpcyBpbnZlc3RpZ2F0aW9uIGludm9sdmVzIGEgY2xpZW50IHdobyBzaGFyZXMg
dGhlIHNhbWUgc3VybmFtZSB3aXRoIHlvdSAKYW5kIGFsc28gdGhlIGNpcmN1bXN0YW5jZXMgc3Vy
cm91bmRpbmcgaW52ZXN0bWVudHMgbWFkZSBieSB0aGlzIGNsaWVudCAKYXQgRGV1dHNjaGUgQmFu
ayBBRy4KClRoZSBEZXV0c2NoZSBCYW5rIEFHIEJhbmtpbmcgY2xpZW50IGRpZWQgaW50ZXN0YXRl
IGFuZCBub21pbmF0ZWQgbm8gc3VjY2Vzc29yIGluIHRpdGxlIG92ZXIgdGhlIGludmVzdG1lbnRz
IG1hZGUgd2l0aCB0aGUgQmFuay4gVGhlIGVzc2VuY2Ugb2YgCnRoaXMgY29tbXVuaWNhdGlvbiB3
aXRoIHlvdSBpcyB0byByZXF1ZXN0IHlvdSBwcm92aWRlIHVzIGluZm9ybWF0aW9uL2NvbW1lbnRz
IG9uIGFueSBvciBhbGwgb2YgdGhlIGZvdXIgaXNzdWVzOgoKMS1BcmUgeW91IGF3YXJlIG9mIGFu
eSByZWxhdGl2ZS9yZWxhdGlvbiB3aG8gc2hhcmVzIHlvdXIgc2FtZSBzdXJuYW1lIHdob3NlIGxh
c3Qga25vd24gY29udGFjdCBhZGRyZXNzIHdhcyBIYW1idXJnLCBHZXJtYW55PwoKMi1BcmUgeW91
IGF3YXJlIG9mIGFueSBpbnZlc3RtZW50IG9mIGNvbnNpZGVyYWJsZSB2YWx1ZSBtYWRlIGJ5IHN1
Y2ggYXBlcnNvbiBhdCB0aGUgRGV1dHNjaGUgQmFuayBBRz8KCjMtQm9ybiBvbiB0aGUgMXN0IG9m
IEp1bmUgMTkyNwoKNC1DYW4geW91IGVzdGFibGlzaCBiZXlvbmQgcmVhc29uYWJsZSBkb3VidCB5
b3VyIGVsaWdpYmlsaXR5IHRvIGFzc3VtZSBzdGF0dXMgb2Ygc3VjY2Vzc29yIGluIHRpdGxlIHRv
IHRoZSBkZWNlYXNlZD8KCkl0IGlzIHBlcnRpbmVudCB0aGF0IHlvdSBpbmZvcm0gdXMgQVNBUCB3
aGV0aGVyIG9yIG5vdCB5b3UgYXJlIGZhbWlsaWFyIHdpdGggdGhpcyBwZXJzb25hbGl0eSB0aGF0
IHdlIG1heSBwdXQgYW4gZW5kIHRvIHRoaXMgY29tbXVuaWNhdGlvbiB3aXRoIAp5b3UgYW5kIG91
ciBpbnF1aXJpZXMgc3Vycm91bmRpbmcgdGhpcyBwZXJzb25hbGl0eS4gWW91IG11c3QgYXBwcmVj
aWF0ZSB0aGF0IHdlIGFyZSBjb25zdHJhaW5lZCBmcm9tIHByb3ZpZGluZyB5b3Ugd2l0aCBtb3Jl
IGRldGFpbGVkIAppbmZvcm1hdGlvbiBhdCB0aGlzIHBvaW50LgoKUGxlYXNlIHJlc3BvbmQgdG8g
dGhpcyBtYWlsIGFzIHNvb24gYXMgcG9zc2libGUgdG8gYWZmb3JkIHVzIHRoZW9wcG9ydHVuaXR5
IHRvIGNsb3NlIHRoaXMgaW52ZXN0aWdhdGlvbi4gVGhhbmsgeW91IGZvciBhY2NvbW1vZGF0aW5n
IApvdXIgZW5xdWlyeS4KCnpvbmFsY29uc3VsdGFudEBuZXRzY2FwZS5uZXQKTWFyaW8gV29sZi4K


--qzsoft_directmail_seperator--


From dkoschuetzki at gmx.de  Wed Aug 24 18:55:38 2005
From: dkoschuetzki at gmx.de (dkoschuetzki@gmx.de)
Date: Wed, 24 Aug 2005 18:55:38 +0200 (CEST)
Subject: [Rd] kendall tau correlation test for ties: Potential error
	(PR#8076)
Message-ID: <20050824165538.4EB2F19837@slim.kubism.ku.dk>

Hello,

On Thu, 18 Aug 2005 15:07:07 +0200, Peter Dalgaard  
<p.dalgaard at biostat.ku.dk> wrote:

> dkoschuetzki at gmx.de writes:

>> The problem is:
>> * Either the comment is wrong because the modification should be done  
>> with
>> kendall too, or
>> * The variable PVAL has to be assigned in the kendall block.
>
> I think it is the comment that is wrong. [...]

Thanks for the clarification. I think I got the untied case and I think  
that I have an understanding of the problems of the tied one by now.  
Thanks for you comments and many thanks for the great R system. I use it  
as my daily working environment and I'm very happy with it. Thanks!

Dirk


From dhinds at sonic.net  Wed Aug 24 20:08:46 2005
From: dhinds at sonic.net (dhinds@sonic.net)
Date: Wed, 24 Aug 2005 18:08:46 +0000 (UTC)
Subject: [Rd] Typo(s) in proc.time.Rd and comment about
	?proc.time	(PR#8092)
References: <20050824163001.677CC19052@slim.kubism.ku.dk>
Message-ID: <deid3e$fnl$1@sea.gmane.org>

ripley at stats.ox.ac.uk wrote:
> On Wed, 24 Aug 2005 Weigand.Stephen at mayo.edu wrote:

> > I just downloaded the file
> >
> > ftp://ftp.stat.math.ethz.ch/Software/R/R-devel.tar.gz
> >
> > and within proc.time.Rd, the second paragraph of the \value
> > section contains a typo:

> I believe your understanding of the English language is different from the 
> author here, who is English.  (You on the other hand seem to think there 
> is no need to give your country in your address when writing an addess in 
> Denmark.)  The preferred language for R documentation is English (and not 
> American).

> > The resolution of the times will be system-specific; it is common for
> > them to be recorded to of the order of 1/100 second, and elapsed [...]
> >                     ^^^^^
> >
> > I'd say replacing "to of" with just "of" would grammatically
> > fix the sentence.

> I'd say it was correct and your correction is incorrect.  In English we 
> say `recorded to 1/100th of a second', not `recorded 1/100th second'.

The correction was incorrect, but so was the original.  I've never
heard the expression "of the order of"; common usage (in English or
American, as far as I know) is "on the order of".  Your "recorded to
1/100th of a second" is also ok.

> > Second, the \note{} section for Unix-like machines reads:
> >
> > It is possible to compile \R without support for \code{proc.time},
> > when the function will throw an error.
> >
> > I believe this is ungrammatical and suggest replacing
> > "when the function will throw an error" with "in which
> > case the function will throw an error".

> Again, the statement given is the intended meaning.

I think more clear might be, "it is possible to compile R without
support for proc.time, when the function *would* throw an error".

-- Dave


From ggrothendieck at gmail.com  Wed Aug 24 20:30:38 2005
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Wed, 24 Aug 2005 14:30:38 -0400
Subject: [Rd] Typo(s) in proc.time.Rd and comment about ?proc.time
	(PR#8092)
In-Reply-To: <deid3e$fnl$1@sea.gmane.org>
References: <20050824163001.677CC19052@slim.kubism.ku.dk>
	<deid3e$fnl$1@sea.gmane.org>
Message-ID: <971536df0508241130645a645c@mail.gmail.com>

On 8/24/05, dhinds at sonic.net <dhinds at sonic.net> wrote:
> ripley at stats.ox.ac.uk wrote:
> > On Wed, 24 Aug 2005 Weigand.Stephen at mayo.edu wrote:
> 
> > > I just downloaded the file
> > >
> > > ftp://ftp.stat.math.ethz.ch/Software/R/R-devel.tar.gz
> > >
> > > and within proc.time.Rd, the second paragraph of the \value
> > > section contains a typo:
> 
> > I believe your understanding of the English language is different from the
> > author here, who is English.  (You on the other hand seem to think there
> > is no need to give your country in your address when writing an addess in
> > Denmark.)  The preferred language for R documentation is English (and not
> > American).
> 
> > > The resolution of the times will be system-specific; it is common for
> > > them to be recorded to of the order of 1/100 second, and elapsed [...]
> > >                     ^^^^^
> > >
> > > I'd say replacing "to of" with just "of" would grammatically
> > > fix the sentence.
> 
> > I'd say it was correct and your correction is incorrect.  In English we
> > say `recorded to 1/100th of a second', not `recorded 1/100th second'.
> 
> The correction was incorrect, but so was the original.  I've never
> heard the expression "of the order of"; common usage (in English or
> American, as far as I know) is "on the order of".  Your "recorded to
> 1/100th of a second" is also ok.
> 
> > > Second, the \note{} section for Unix-like machines reads:
> > >
> > > It is possible to compile \R without support for \code{proc.time},
> > > when the function will throw an error.
> > >
> > > I believe this is ungrammatical and suggest replacing
> > > "when the function will throw an error" with "in which
> > > case the function will throw an error".
> 
> > Again, the statement given is the intended meaning.
> 
> I think more clear might be, "it is possible to compile R without
               ^^^^^^^^^

That should be "clearer".  Comparative adjectives with one syllable 
normally end in er rather than using more.  :)

> support for proc.time, when the function *would* throw an error".
> 
> -- Dave


From rowe at psych.ucsb.edu  Wed Aug 24 20:31:17 2005
From: rowe at psych.ucsb.edu (rowe@psych.ucsb.edu)
Date: Wed, 24 Aug 2005 20:31:17 +0200 (CEST)
Subject: [Rd] extra parentheses cause death of kernel (PR#8094)
Message-ID: <20050824183117.217CF18DF5@slim.kubism.ku.dk>


I try to type quickly, and sometimes I make mistakes that cost me more
than I think they should...  It appears that any time I quickly type a
sequence such as:

quartz()

I am rewarded with the following text in red:

2005-08-24 11:02:42.388 R[2198] *** -[NSCFDate characterAtIndex:]: selector not recognized
2005-08-24 11:02:42.390 R[2198] *** NSTimer discarding exception 'NSInvalidArgumentException' (reason '*** -[NSCFDate
characterAtIndex:]: selector not recognized') that raised during firing of timer with target 3c8e40 and selector 'kickstart:'

printed above the command line, an extra opening parenthesis at the
end of the command line, and after that, I can't get R to do anything.
It gives me a prompt and acts like it's waiting for commands -- it
will allow me to step back through and edit previous commands, but it
won't execute anything.  With one exception...  if I type a similar
sequence, I can get a message similar to the above error message added
underneath the first (still above the command line).  The second error
looks like:

2005-08-24 11:25:27.952 R[2227] *** -[NSConcreteValue characterAtIndex:]: selector not recognized
2005-08-24 11:25:27.982 R[2227] *** -[NSConcreteValue characterAtIndex:]: selector not recognized

and I can get as many copies of it or a variant:

2005-08-24 11:28:19.129 R[2227] *** -[NSCFDate characterAtIndex:]: selector not recognized
2005-08-24 11:28:19.130 R[2227] *** -[NSCFDate characterAtIndex:]: selector not recognized

as I want by trying to create a string that ends "()" and not typing slowly.

My system:

   platform powerpc-apple-darwin7.9.0
   arch     powerpc                  
   os       darwin7.9.0              
   system   powerpc, darwin7.9.0     
   status   Patched                  
   major    2                        
   minor    1.0                      
   year     2005                     
   month    05                       
   day      12                       
   language R                        

---

I've tried this several times and verified the behavior.  The "quartz"
part is not important; I just verified it again with "plot.new()",
"garbage()", and "foo()".  Typing opening and closing parentheses in
rapid succession causes an extra opening parenthesis to show up on the
command line and the death of the command line interpreter (but it
does still show you command line completions on the bottom of the
window).  The only exception I've found is when there is no character
string at all before the opening parenthesis.  Then you can type as
quickly as you want with no ill effects.

-- 
Mickey Rowe     (mrowe at lifesci.ucsb.edu)


From simon.urbanek at r-project.org  Wed Aug 24 20:46:09 2005
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Wed, 24 Aug 2005 14:46:09 -0400
Subject: [Rd] extra parentheses cause death of kernel (PR#8094)
In-Reply-To: <20050824183117.217CF18DF5@slim.kubism.ku.dk>
References: <20050824183117.217CF18DF5@slim.kubism.ku.dk>
Message-ID: <A2C14501-AB96-4D0C-8059-2FFCFCF24B5E@r-project.org>

Mickey,

On Aug 24, 2005, at 2:31 PM, rowe at psych.ucsb.edu wrote:

> I try to type quickly, and sometimes I make mistakes that cost me more
> than I think they should...  It appears that any time I quickly type a
> sequence such as:
>
> quartz()
>
> I am rewarded with the following text in red:

You're using an outdated version - please update to 2.1.1, that  
problem (and many others) have been fixed in the meantime (c.f.  
posting guide about bugs). Before reporting bugs on R.app you should  
even try the nightly build binary.

As was mentioned several times on the lists, it is highly recommended  
to update from the version you're using, because it had several  
issues that have been fixed shortly afterwards.

Cheers,
Simon


From jfox at mcmaster.ca  Wed Aug 24 21:54:36 2005
From: jfox at mcmaster.ca (John Fox)
Date: Wed, 24 Aug 2005 15:54:36 -0400
Subject: [Rd] TCITex and R
In-Reply-To: <D79013E40FEF254AAF0D72DFC94F274803D889@extas4-hba.tas.csiro.au>
Message-ID: <20050824195434.TSBA1799.tomts40-srv.bellnexxia.net@JohnDesktop8300>

Dear Mark,

I use Scientific Word as a Latex front end. I've also installed fptex and
use that to build R packages. The two have coexisted on my computers for
several years without problems.

I hope this helps,
 John

--------------------------------
John Fox
Department of Sociology
McMaster University
Hamilton, Ontario
Canada L8S 4M4
905-525-9140x23604
http://socserv.mcmaster.ca/jfox 
-------------------------------- 

> -----Original Message-----
> From: r-devel-bounces at r-project.org 
> [mailto:r-devel-bounces at r-project.org] On Behalf Of 
> Mark.Bravington at csiro.au
> Sent: Tuesday, August 23, 2005 12:23 AM
> To: r-devel at stat.math.ethz.ch
> Subject: [Rd] TCITex and R
> 
> Several times my packages have fallen foul of the latex check 
> at the uploading-to-CRAN stage, creating extra work for Kurt 
> Hornik. I've never bothered trying to get latex working on my 
> own packages (happy with vanilla help) but am told that 
> "latex is the closest thing to a syntax checker for Rd files" 
> and that I should set it up. Now, there is already a latex on 
> my (Windows XP) system thanks to the program Scientific Word, 
> which comes with TCITex. However, RCMD etc don't recognize 
> this latex at the moment. Does anyone have any advice on what 
> might be needed to make RCMD use SciWord's installation of 
> TCITex-- paths, environment variables, etc etc?
> 
> Various R docs recommend fptex or MikTex implementations of 
> latex, but I'm a bit reluctant to put these on, primarily in 
> case doing so somehow stuffs up the workings of Scientific 
> Word in a way that I don't know enough to fix. In case it's 
> not obvious already, I should add that I am blissfully 
> ignorant about how latex works-- that's one of my reasons for 
> using Scientific Word.
> 
> Thanks for any advice
> 
> Mark
> 
> Mark Bravington
> CSIRO Mathematical & Information Sciences Marine Laboratory 
> Castray Esplanade Hobart 7001 TAS
> 
> ph (+61) 3 6232 5118
> fax (+61) 3 6232 5012
> mob (+61) 438 315 623
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From nashjc at uottawa.ca  Wed Aug 24 22:56:54 2005
From: nashjc at uottawa.ca (Prof J C Nash)
Date: Wed, 24 Aug 2005 16:56:54 -0400
Subject: [Rd] Model forecasts with new factor levels - predict.warn
Message-ID: <430CDF16.5020606@uottawa.ca>

predict.warn() -- a function to display factor levels in new data
	for linear model prediction that do not exist in the
	estimating data.
	
Date: 2005-8-24
From: John C. Nash (with thanks to Uwe Ligges for suggestions)
	nashjc at uottawa.ca

Motivation: In computing predictions from a linear model using factors,
it is possible to introduce new factor levels. This was encountered on
a practical level in forecasting retail sales where certain events
had not occurred during the estimation period but did occur during
the validation (i.e., trial forecast) period. predict() then gives
an error message that it cannot continue because the new data has
new levels of a factor. Indeed, it will give the new level of the
first such factor found. predict.warn is designed to give more
detailed information. for example, if there are other factor levels
that are also "new".

The underlying interest is to find a suitable method for introducing
estimates of the effects of such "new" factor levels into the model,
and I welcome exchanges on how that may be done. Indeed, one of my
main interests in submitting this tool is to learn how that may be
done appropriately and with suitable information to the user to avoid
egregious errors. For example, a new sales promotion may have many
similarities with existing promotions, so a rough estimate for the
effect may be possible, allowing for rudimentary validation testing
and for "working" values of forecasts.

Unfortunately, the lack of some facility to provide "guesstimates"
in this way leads users to ignore R or other tools and to work with
Excel. I have experience of this situation arising in practise, and
we may anticipate that these users will be difficult to convert to
using better tools. I believe we must find ways to allow users to
carry out such operations in as safe and informed manner possible.
Ideally, the follow-on to predict.warn should be a function called
something like predict.expand or predict.force that asks the user
to supply values (or possibly sets or distributions) of the "new"
factor level estimates.



Sample function:

predict.warn<-function (object, newdata,
      ...)
# this is function predict.warn.R
# Tries to warn if we do not have appropriate factor levels in 
estimation data
# that appear in the newdata.
# It does NOT yet test for non-factor variables, but that would also be 
nice.
# However, we usually assume that numerical variables can be 
interpolated and
# extrapolated.
{   message("predict.warn -- check for factor levels not present")
     message("in linear models with factors")
     message(" ")
     if (missing(newdata) || is.null(newdata)) {
# Without newdata, issue warning and return
	message("You do not have any new data.")
     }
     else {
         xlev <- object$xlevels
         nn<-names(xlev)
	dnn<-length(nn)
	message("there are ",dnn," factor names ")
	dostop<-FALSE # Ensure the return value is defined
     	for (i in seq(along=nn)) {
		message("Factor ",nn[i]," in estimation data")
		ofac <- object[["model"]][[nn[i]]]
		print(ofac)  # diagnostic
		oldlev<-levels(factor(ofac))
		nfac <- newdata[[nn[i]]]  # ?? note need for double brackets. Why?
		message("Factor ",nn[i], " in new data")
		print(nfac) # diagnostic
		message("about to try levels on newfac")
		newlev<-levels(factor(nfac))
     		for (j in seq(along=newlev)) {
			if (!(newlev[j] %in% oldlev)) {
				message("New level ", newlev[j]," not found in estimation levels of 
factor ", nn[i])
				dostop = TRUE
			}
		}
	} # end loop over names
     } # end part where we DO have new data
     return(dostop) # TRUE if we should stop
}

# end of predict.warn code

Test example:

# A simple test of predict.warn.R for 2 factors
# J C Nash 20050822
rm(list=ls())
source("predict.warn.R")
x<-c(1, 2, 3, 4, 5, 6, 7, 8)
fac1<-c("A", "A", "", "", "", "B", "")
fac1<-c(fac1, "A")
fac1
y<-c( 2, 4, 5, 8, 9.5, 12, 13, 17)
fac2<-c(1,1,1,2,2,1,2,3)
fac2<-as.factor(fac2) # Note: or else defaults to num
joe<-data.frame(x, y, fac1, fac2)
bill<-subset(joe, x<=5)
mary<-subset(joe, x>5)
message("bill")
str(bill)
print(bill)
message("mary")
str(mary)
print(mary)
est<-lm(y ~ fac1 + fac2 + x, bill)
print(est)
test<-predict.warn(est, newdata = mary)
message('predict.warn returns ',test)
message("\n")
message("Now try predict()")
predict(est, newdata = mary)

# ======================= end of msg ===========================

-- 
John C. Nash, School of Management, University of Ottawa,
Vanier Hall 451, 136 Jean-Jacques Lussier Private,
P.O. Box 450, Stn A, Ottawa, Ontario, K1N 6N5 Canada
email: nashjc on mail server uottawa.ca, voice mail: 613 562 5800 X 4796
fax 613 562 5164,  Web URL = http://macnash.admin.uottawa.ca
"Practical Forecasting for Managers" web site is at
http://www.arnoldpublishers.com/support/nash/


From colin at colinsmith.org  Thu Aug 25 03:25:39 2005
From: colin at colinsmith.org (Colin A. Smith)
Date: Wed, 24 Aug 2005 18:25:39 -0700
Subject: [Rd] Implementing a single-precision class with raw (now
	integer)
In-Reply-To: <Pine.LNX.4.61.0508200836330.25528@gannet.stats>
References: <c06c608685a92cf22b59f0420a179ccc@colinsmith.org>
	<Pine.LNX.4.61.0508200836330.25528@gannet.stats>
Message-ID: <2be99441478157d98d8d3f08f534fbdd@colinsmith.org>

On Aug 22, 2005, at 3:38 , Prof Brian Ripley wrote:

>> Unfortunately, R sometimes hits the 2GB memory limit of Win32.
> The rw-FAQ explains why that is _not_ the limit!

Sorry to be uninformed, I see from the Microsoft documentation that the 
limit can be increased to 3GB when you change the boot parameters of 
Windows and a flag in the R binary.

> Why via "raw"?
>
> I believe the intention is that this sort of thing be done via 
> external references, but as float and int are the same size on all 
> current platforms, I would have considered R integers for storage. 
> Then for example subsetting would work and you had a 4x larger size 
> limit on 64-bit platforms. (You would also have got automatic handling 
> of endianness.)

I was concerned that on some platforms (particularly 64 bit ones) an 
integer may actually be 64 bits. However, if all current platforms have 
standardized on float and int being the same size, then using the 
integer data type would be more elegant and solve any endian issues. 
(Is that really the case?) Another motivation for using raw was so 
other R functions (particularly internal ones) wouldn't assume the data 
was integer and produce erroneous results. I'd rather have user-visible 
error thrown.

To have the best of both worlds, I'm now using an S4 class with a 
single slot (f) that stores the float data as an integer vector. It 
uses the extensible conversion mechanism created by Duncan Lang to 
allow the .C() function to handle float objects. (The custom converter 
also allows proper checking for single-precision NA values, which don't 
get caught if passed as integers.)

At some point, I would like to release this for others to use. Before I 
get too far into it, I would greatly appreciate it if anyone had any 
ideas, unforeseen caveats, or other suggestions about my current 
direction. My implementation is available here:

http://abagyan.scripps.edu/~csmith/float.R
http://abagyan.scripps.edu/~csmith/float.c
http://abagyan.scripps.edu/~csmith/float_0.1.0.tar.gz

>> I've run into a limitation with the .C() function where it does not
>> handle raw vectors, which it will do in 2.2.0.
> That is just not true!

I should have been a bit more explicit and said that R 2.1.x doesn't 
have?RAWSXP handlers in either RObjToCPtr() or CPtrToRObj(), so all the 
C code gets is a SEXP. R-devel does and passes raw vectors as unsigned 
char *. Of course that doesn't matter now that I'm using an extensible 
converter.

Cheers.

-Colin


From ehlers at math.ucalgary.ca  Thu Aug 25 07:49:26 2005
From: ehlers at math.ucalgary.ca (P Ehlers)
Date: Wed, 24 Aug 2005 23:49:26 -0600
Subject: [Rd] Typo(s) in proc.time.Rd and comment
	about	?proc.time	(PR#8092)
In-Reply-To: <deid3e$fnl$1@sea.gmane.org>
References: <20050824163001.677CC19052@slim.kubism.ku.dk>
	<deid3e$fnl$1@sea.gmane.org>
Message-ID: <430D5BE6.1080103@math.ucalgary.ca>

David,

Re: "of the order of ..." vs "on the order of ..."

My Oxford dictionary has "of (or 'in' or 'on') the order of",
so that there is no correction needed in proc.time.Rd. And, yes,
I do hear 'of', at least on the northern side of the 49th
parallel. But please don't let these comments discourage
further documentation improvement suggestions.

Peter Ehlers
U. of Calgary (Canada)

dhinds at sonic.net wrote:
> ripley at stats.ox.ac.uk wrote:
> 
>>On Wed, 24 Aug 2005 Weigand.Stephen at mayo.edu wrote:
> 
> 
>>>I just downloaded the file
>>>
>>>ftp://ftp.stat.math.ethz.ch/Software/R/R-devel.tar.gz
>>>
>>>and within proc.time.Rd, the second paragraph of the \value
>>>section contains a typo:
> 
> 
>>I believe your understanding of the English language is different from the 
>>author here, who is English.  (You on the other hand seem to think there 
>>is no need to give your country in your address when writing an addess in 
>>Denmark.)  The preferred language for R documentation is English (and not 
>>American).
> 
> 
>>>The resolution of the times will be system-specific; it is common for
>>>them to be recorded to of the order of 1/100 second, and elapsed [...]
>>>                    ^^^^^
>>>
>>>I'd say replacing "to of" with just "of" would grammatically
>>>fix the sentence.
> 
> 
>>I'd say it was correct and your correction is incorrect.  In English we 
>>say `recorded to 1/100th of a second', not `recorded 1/100th second'.
> 
> 
> The correction was incorrect, but so was the original.  I've never
> heard the expression "of the order of"; common usage (in English or
> American, as far as I know) is "on the order of".  Your "recorded to
> 1/100th of a second" is also ok.
> 
> 
>>>Second, the \note{} section for Unix-like machines reads:
>>>
>>>It is possible to compile \R without support for \code{proc.time},
>>>when the function will throw an error.
>>>
>>>I believe this is ungrammatical and suggest replacing
>>>"when the function will throw an error" with "in which
>>>case the function will throw an error".
> 
> 
>>Again, the statement given is the intended meaning.
> 
> 
> I think more clear might be, "it is possible to compile R without
> support for proc.time, when the function *would* throw an error".
> 
> -- Dave
>


From ripley at stats.ox.ac.uk  Thu Aug 25 08:04:37 2005
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 25 Aug 2005 07:04:37 +0100 (BST)
Subject: [Rd] Implementing a single-precision class with raw (now
	integer)
In-Reply-To: <2be99441478157d98d8d3f08f534fbdd@colinsmith.org>
References: <c06c608685a92cf22b59f0420a179ccc@colinsmith.org>
	<Pine.LNX.4.61.0508200836330.25528@gannet.stats>
	<2be99441478157d98d8d3f08f534fbdd@colinsmith.org>
Message-ID: <Pine.LNX.4.61.0508250702490.6749@gannet.stats>

On Wed, 24 Aug 2005, Colin A. Smith wrote:

> On Aug 22, 2005, at 3:38 , Prof Brian Ripley wrote:
>
>>> Unfortunately, R sometimes hits the 2GB memory limit of Win32.
>> The rw-FAQ explains why that is _not_ the limit!
>
> Sorry to be uninformed, I see from the Microsoft documentation that the limit 
> can be increased to 3GB when you change the boot parameters of Windows and a 
> flag in the R binary.
>
>> Why via "raw"?
>> 
>> I believe the intention is that this sort of thing be done via external 
>> references, but as float and int are the same size on all current 
>> platforms, I would have considered R integers for storage. Then for example 
>> subsetting would work and you had a 4x larger size limit on 64-bit 
>> platforms. (You would also have got automatic handling of endianness.)
>
> I was concerned that on some platforms (particularly 64 bit ones) an integer 
> may actually be 64 bits. However, if all current platforms have standardized 
> on float and int being the same size, then using the integer data type would 
> be more elegant and solve any endian issues. (Is that really the case?)

Yes, configure tests for int being 32 bit, and R if set to fail to compile 
it not.  As we assume IEC60559 arithmetic, a float is 32-bit.

> Another motivation for using raw was so other R functions (particularly 
> internal ones) wouldn't assume the data was integer and produce erroneous 
> results. I'd rather have user-visible error thrown.
>
> To have the best of both worlds, I'm now using an S4 class with a single slot 
> (f) that stores the float data as an integer vector. It uses the extensible 
> conversion mechanism created by Duncan Lang to allow the .C() function to 
> handle float objects. (The custom converter also allows proper checking for 
> single-precision NA values, which don't get caught if passed as integers.)
>
> At some point, I would like to release this for others to use. Before I get 
> too far into it, I would greatly appreciate it if anyone had any ideas, 
> unforeseen caveats, or other suggestions about my current direction. My 
> implementation is available here:
>
> http://abagyan.scripps.edu/~csmith/float.R
> http://abagyan.scripps.edu/~csmith/float.c
> http://abagyan.scripps.edu/~csmith/float_0.1.0.tar.gz
>
>>> I've run into a limitation with the .C() function where it does not
>>> handle raw vectors, which it will do in 2.2.0.
>> That is just not true!
>
> I should have been a bit more explicit and said that R 2.1.x doesn't 
> have?RAWSXP handlers in either RObjToCPtr() or CPtrToRObj(), so all the C 
> code gets is a SEXP. R-devel does and passes raw vectors as unsigned char *. 
> Of course that doesn't matter now that I'm using an extensible converter.
>
> Cheers.
>
> -Colin
>
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From ripley at stats.ox.ac.uk  Thu Aug 25 08:48:26 2005
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 25 Aug 2005 07:48:26 +0100 (BST)
Subject: [Rd] compile R with Portland Group compiler
In-Reply-To: <430C9DA7.5020809@lindaspaces.com>
References: <430B63FB.1000908@lindaspaces.com>
	<Pine.LNX.4.61.0508232211550.21594@gannet.stats>
	<430C9DA7.5020809@lindaspaces.com>
Message-ID: <Pine.LNX.4.61.0508241730270.17771@gannet.stats>

Let us be clear: some things in config.log are designed to fail, so only 
unexpected errors are a cause to look there.  The regex.c warnings are 
it seems from an over-zealous compiler.

The problems here seem to be the unknown use of .lo (which it seems to 
have coped with) and a problem in the PG's own libc, which it seems cannot 
be used in a shared object.  That issue discussed in the R-admin manual, 
and seems something you do need to take up with PG.  The crucial part is

> /usr/bin/ld: /usr/pgi/linux86-64/6.0/lib/libpgc.a(fastmath.o): relocation
> R_X86_64_PC32 against `__fvdlog' can not be used when making a shared object;
> recompile with -fPIC

which is asking you to recompile their static library.  If you can't use a 
dynamic library then this is fatal.


On Wed, 24 Aug 2005, Jennifer Lai wrote:

> I downloaded R-devel and compiled it with pgcc. This time, instead of 
> breaking in src/main, compilation breaks in src/modules with the following 
> error messages.
>
> Copyright 1989-2000, The Portland Group, Inc.  All Rights Reserved.
> Copyright 2000-2005, STMicroelectronics, Inc.  All Rights Reserved.
> /usr/pgi/linux86-64/6.0/bin/pgcc -shared  -L/usr/pgi/linux86-64/6.0/lib 
> -L/usr/lib64 -o R_X11.so  dataentry.lo devX11.lo rotated.lo rbitmap.lo  -lSM 
> -lICE -L/usr/X11R6/lib64 -lX11  -ljpeg -lpng -lz
> File with unknown suffix passed to linker: dataentry.lo
> File with unknown suffix passed to linker: devX11.lo
> File with unknown suffix passed to linker: rotated.lo
> File with unknown suffix passed to linker: rbitmap.lo
> /usr/bin/ld: /usr/pgi/linux86-64/6.0/lib/libpgc.a(fastmath.o): relocation 
> R_X86_64_PC32 against `__fvdlog' can not be used when making a shared object; 
> recompile with -fPIC
> /usr/bin/ld: final link failed: Bad value
> make[4]: *** [R_X11.so] Error 2
> make[4]: Leaving directory `/home/cuser/R-devel/src/modules/X11'
> make[3]: *** [R] Error 2
> make[3]: Leaving directory `/home/cuser/R-devel/src/modules/X11'
> make[2]: *** [R] Error 1
> make[2]: Leaving directory `/home/cuser/R-devel/src/modules'
> make[1]: *** [R] Error 1
> make[1]: Leaving directory `/home/cuser/R-devel/src'
> make: *** [R] Error 1
>
> Though src/main directory compiled successfully, I do still get warning 
> messages from src/main/regex.c compilation.
> PGC-W-0155-64-bit integral value truncated  (/usr/include/wctype.h: 109)
> PGC-W-0155-64-bit integral value truncated  (/usr/include/wctype.h: 110)
> PGC-W-0155-64-bit integral value truncated  (/usr/include/wctype.h: 111)
> PGC-W-0155-64-bit integral value truncated  (/usr/include/wctype.h: 112)
> PGC-W-0155-Long value is passed to a nonprototyped function - argument #5 
> (regex.c: 3288)
> PGC-W-0155-Long value is passed to a nonprototyped function - argument #3 
> (regex.c: 4464)
> PGC-W-0155-Long value is passed to a nonprototyped function - argument #3 
> (regex.c: 4591)
> PGC-W-0155-Long value is passed to a nonprototyped function - argument #3 
> (regex.c: 4635)
> PGC-W-0155-Long value is passed to a nonprototyped function - argument #3 
> (regex.c: 4737)
> PGC-W-0155-Long value is passed to a nonprototyped function - argument #3 
> (regex.c: 4792)
> PGC-W-0155-Long value is passed to a nonprototyped function - argument #4 
> (regex.c: 4793)
> PGC-W-0155-Long value is passed to a nonprototyped function - argument #3 
> (regex.c: 4861)
> PGC-W-0155-Long value is passed to a nonprototyped function - argument #3 
> (regex.c: 4904)
> PGC-W-0155-Long value is passed to a nonprototyped function - argument 
#3 
> (regex.c: 4954)
> PGC-W-0155-Long value is passed to a nonprototyped function - argument #4 
> (regex.c: 4961)
> PGC-W-0155-Long value is passed to a nonprototyped function - argument #3 
> (regex.c: 5057)
> PGC-W-0155-Long value is passed to a nonprototyped function - argument #3 
> (regex.c: 5581)
> PGC-W-0155-Long value is passed to a nonprototyped function - argument #3 
> (regex.c: 5596)
> PGC-W-0155-Long value is passed to a nonprototyped function - argument #3 
> (regex.c: 5628)
> PGC-W-0155-Long value is passed to a nonprototyped function - argument #3 
> (regex.c: 5641)
> PGC-W-0155-Long value is passed to a nonprototyped function - argument #3 
> (regex.c: 5669)
> PGC-W-0155-Long value is passed to a nonprototyped function - argument #3 
> (regex.c: 5858)
> PGC-W-0155-Long value is passed to a nonprototyped function - argument #3 
> (regex.c: 6230)
> PGC-W-0155-Long value is passed to a nonprototyped function - argument #6 
> (regex.c: 7035)
> PGC-W-0155-Long value is passed to a nonprototyped function - argument #3 
> (regex.c: 7803)
> PGC-W-0155-Long value is passed to a nonprototyped function - argument #2 
> (regex.c: 7814)
> PGC-W-0155-Long value is passed to a nonprototyped function - argument #3 
> (regex.c: 7826)
> PGC-W-0155-Long value is passed to a nonprototyped function - argument #7 
> (regex.c: 10722)
> PGC/x86-64 Linux/x86-64 6.0-5: compilation completed with warnings
>
>
> One last thing that I notice is the errors messages in config.log. Should I 
> consult these error messages with Portland Group, or R-devel can help me out 
> on this?
>
> Copyright 1989-2000, The Portland Group, Inc.  All Rights Reserved.
> Copyright 2000-2005, STMicroelectronics, Inc.  All Rights Reserved.
> PGC-S-0040-Illegal use of symbol, choke (conftest.c: 21)
> PGC/x86-64 Linux/x86-64 6.0-5: compilation completed with severe errors
> configure:4222: $? = 2
> configure: failed program was:
> | /* confdefs.h.  */
> |
> | #define PACKAGE_NAME "R"
> | #define PACKAGE_TARNAME "R"
> | #define PACKAGE_VERSION "2.2.0"
> | #define PACKAGE_STRING "R 2.2.0"
> | #define PACKAGE_BUGREPORT "r-bugs at R-project.org"
> | #define PACKAGE "R"
> | #define VERSION "2.2.0"
> | #define R_PLATFORM "x86_64-unknown-linux-gnu"
> | #define R_CPU "x86_64"
> | #define R_VENDOR "unknown"
> | #define R_OS "linux-gnu"
> | #define Unix 1
> | /* end confdefs.h.  */
> |
> | int
> | main ()
> | {
> | #ifndef __GNUC__
> |        choke me
> | #endif
> |
> |   ;
> |   return 0;
> | }
>
> PGC-S-0035-Syntax error: Recovery attempted by replacing identifier me by ';' 
> (conftest.c: 2)
> PGC-W-0057-Old-style declaration used; int assumed (conftest.c: 2)
> PGC/x86-64 Linux/x86-64 6.0-5: compilation completed with severe errors
> configure:4453: $? = 2
> configure: failed program was:
> | #ifndef __cplusplus
> |   choke me
> | #endif
>
> PGFTN-S-0034-Syntax error at or near end of line (conftest.F: 3)
> 0 inform,   0 warnings,   1 severes, 0 fatal for main
> PGFTN/x86-64 Linux/x86-64 6.0-5: compilation completed with severe errors
> configure:5400: $? = 2
> configure: failed program was:
> |       program main
> | #ifndef __GNUC__
> |        choke me
> | #endif
> |
> |       end
>
> configure:5665: /usr/pgi/linux86-64/6.0/bin/pgCC -c 
> -I/usr/pgi/linux86-64/6.0/include -I/usr/pgi/linux86-64/6.0/include/CC 
> conftest.cc >&5
> "conftest.cc", line 21: error: identifier "choke" is undefined
>        choke me
>        ^
>
> "conftest.cc", line 21: warning: variable "me" was declared but never
>         referenced
>        choke me
>              ^
>
> 1 error detected in the compilation of "conftest.cc".
> configure:5671: $? = 2
> configure: failed program was:
> | /* confdefs.h.  */
> |
> | #define PACKAGE_NAME "R"
> | #define PACKAGE_TARNAME "R"
> | #define PACKAGE_VERSION "2.2.0"
> | #define PACKAGE_STRING "R 2.2.0"
> | #define PACKAGE_BUGREPORT "r-bugs at R-project.org"
> | #define PACKAGE "R"
> | #define VERSION "2.2.0"
> | #define R_PLATFORM "x86_64-unknown-linux-gnu"
> | #define R_CPU "x86_64"
> | #define R_VENDOR "unknown"
> | #define R_OS "linux-gnu"
> | #define Unix 1
> | /* end confdefs.h.  */
> |
> | int
> | main ()
> | {
> | #ifndef __GNUC__
> |        choke me
> | #endif
> |
> |   ;
> |   return 0;
> | }
>
> configure:5841: /usr/pgi/linux86-64/6.0/bin/pgCC -c -g 
> -I/usr/pgi/linux86-64/6.0/include -I/usr/pgi/linux86-64/6.0/include/CC 
> conftest.cc >&5
> "conftest.cc", line 20: error: identifier "exit" is undefined
> exit (42);
> ^
>
> 1 error detected in the compilation of "conftest.cc".
> configure:5847: $? = 2
> configure: failed program was:
> | /* confdefs.h.  */
> |
> | #define PACKAGE_NAME "R"
> | #define PACKAGE_TARNAME "R"
> | #define PACKAGE_VERSION "2.2.0"
> | #define PACKAGE_STRING "R 2.2.0"
> | #define PACKAGE_BUGREPORT "r-bugs at R-project.org"
> | #define PACKAGE "R"
> | #define VERSION "2.2.0"
> | #define R_PLATFORM "x86_64-unknown-linux-gnu"
> | #define R_CPU "x86_64"
> | #define R_VENDOR "unknown"
> | #define R_OS "linux-gnu"
> | #define Unix 1
> | /* end confdefs.h.  */
> |
> | int
> | main ()
> | {
> | exit (42);
> |   ;
> |   return 0;
> | }
> configure:5796: /usr/pgi/linux86-64/6.0/bin/pgCC -c -g 
> -I/usr/pgi/linux86-64/6.0/include -I/usr/pgi/linux86-64/6.0/include/CC 
> conftest.cc >&5
> "conftest.cc", line 16: error: namespace "std" has no member "exit"
> extern "C" void std::exit (int) throw (); using std::exit;
>                      ^
>
> "conftest.cc", line 16: error: namespace "std" has no member "exit"
> extern "C" void std::exit (int) throw (); using std::exit;
>                                                      ^
>
> 2 errors detected in the compilation of "conftest.cc".
> configure:5802: $? = 2
> configure: failed program was:
> | /* confdefs.h.  */
> |
> | #define PACKAGE_NAME "R"
> | #define PACKAGE_TARNAME "R"
> | #define PACKAGE_VERSION "2.2.0"
> | #define PACKAGE_STRING "R 2.2.0"
> | #define PACKAGE_BUGREPORT "r-bugs at R-project.org"
> | #define PACKAGE "R"
> | #define VERSION "2.2.0"
> | #define R_PLATFORM "x86_64-unknown-linux-gnu"
> | #define R_CPU "x86_64"
> | #define R_VENDOR "unknown"
> | #define R_OS "linux-gnu"
> | #define Unix 1
> | /* end confdefs.h.  */
> | extern "C" void std::exit (int) throw (); using std::exit;
> | #include <stdlib.h>
> | int
> | main ()
> | {
> | exit (42);
> |   ;
> |   return 0;
> | }
> configure:5796: /usr/pgi/linux86-64/6.0/bin/pgCC -c -g 
> -I/usr/pgi/linux86-64/6.0/include -I/usr/pgi/linux86-64/6.0/include/CC 
> conftest.cc >&5
> "conftest.cc", line 16: error: namespace "std" has no member "exit"
> extern "C" void std::exit (int); using std::exit;
>                      ^
>
> "conftest.cc", line 16: error: namespace "std" has no member "exit"
> extern "C" void std::exit (int); using std::exit;
>                                             ^
>
> 2 errors detected in the compilation of "conftest.cc".
> configure:5802: $? = 2
> configure: failed program was:
> | /* confdefs.h.  */
> |
> | #define PACKAGE_NAME "R"
> | #define PACKAGE_TARNAME "R"
> | #define PACKAGE_VERSION "2.2.0"
> | #define PACKAGE_STRING "R 2.2.0"
> | #define PACKAGE_BUGREPORT "r-bugs at R-project.org"
> | #define PACKAGE "R"
> | #define VERSION "2.2.0"
> | #define R_PLATFORM "x86_64-unknown-linux-gnu"
> | #define R_CPU "x86_64"
> | #define R_VENDOR "unknown"
> | #define R_OS "linux-gnu"
> | #define Unix 1
> | /* end confdefs.h.  */
> | extern "C" void std::exit (int); using std::exit;
> | #include <stdlib.h>
> | int
> | main ()
> | {
> | exit (42);
> |   ;
> |   return 0;
> | }
> configure:5796: /usr/pgi/linux86-64/6.0/bin/pgCC -c -g 
> -I/usr/pgi/linux86-64/6.0/include -I/usr/pgi/linux86-64/6.0/include/CC 
> conftest.cc >&5
> "/usr/include/stdlib.h", line 640: error: omission of exception specification
>         is incompatible with previous function "exit" (declared at line 16
>         of "conftest.cc")
> extern void exit (int __status) __THROW __attribute__ ((__noreturn__));
>                                                                       ^
>
> 1 error detected in the compilation of "conftest.cc".
> configure:5802: $? = 2
> configure: failed program was:
> | /* confdefs.h.  */
> |
> | #define PACKAGE_NAME "R"
> | #define PACKAGE_TARNAME "R"
> | #define PACKAGE_VERSION "2.2.0"
> | #define PACKAGE_STRING "R 2.2.0"
> | #define PACKAGE_BUGREPORT "r-bugs at R-project.org"
> | #define PACKAGE "R"
> | #define VERSION "2.2.0"
> | #define R_PLATFORM "x86_64-unknown-linux-gnu"
> | #define R_CPU "x86_64"
> | #define R_VENDOR "unknown"
> | #define R_OS "linux-gnu"
> | #define Unix 1
> | /* end confdefs.h.  */
> | extern "C" void exit (int) throw ();
> | #include <stdlib.h>
> | int
> | main ()
> | {
> | exit (42);
> |   ;
> |   return 0;
> | }
> configure:5796: /usr/pgi/linux86-64/6.0/bin/pgCC -c -g 
> -I/usr/pgi/linux86-64/6.0/include -I/usr/pgi/linux86-64/6.0/include/CC 
> conftest.cc >&5
> NOTE: your evaluation license will expire in 14 days, 5.7 hours.
> For a permanent license, please read the order acknowledgement
> that you received.  Connect to https://www.pgroup.com/License with
> the username and password in the order acknowledgement.
>
>   Name:    lai
>   User:    lai
>   Email:    lai at lindaspaces.com
>   Hostid:    PGI=00001AE0193111621CB217
> configure:5802: $? = 0
> configure:5806: test -z
>            || test ! -s conftest.err
> configure:5809: $? = 0
> configure:5812: test -s conftest.o
> configure:5815: $? = 0
> configure:5841: /usr/pgi/linux86-64/6.0/bin/pgCC -c -g 
> -I/usr/pgi/linux86-64/6.0/include -I/usr/pgi/linux86-64/6.0/include/CC 
> conftest.cc >&5
> NOTE: your evaluation license will expire in 14 days, 5.7 hours.
> For a permanent license, please read the order acknowledgement
> that you received.  Connect to https://www.pgroup.com/License with
> the username and password in the order acknowledgement.
>
>   Name:    lai
>   User:    lai
>   Email:    lai at lindaspaces.com
>   Hostid:    PGI=00001AE0193111621CB217
> configure:5847: $? = 0
> configure:5851: test -z
>            || test ! -s conftest.err
> configure:5854: $? = 0
> configure:5857: test -s conftest.o
> configure:5860: $? = 0
> configure:5888: checking how to run the C++ preprocessor
> configure:5919: /usr/pgi/linux86-64/6.0/bin/pgCC -E 
> -I/usr/pgi/linux86-64/6.0/include -I/usr/pgi/linux86-64/6.0/include/CC 
> conftest.cc
> configure:5925: $? = 0
> configure:5957: /usr/pgi/linux86-64/6.0/bin/pgCC -E 
> -I/usr/pgi/linux86-64/6.0/include -I/usr/pgi/linux86-64/6.0/include/CC 
> conftest.cc
> "conftest.cc", line 19: catastrophic error: could not open source file
>         "ac_nonexistent.h"
> #include <ac_nonexistent.h>
>                            ^
>
> 1 catastrophic error detected in the compilation of "conftest.cc".
> Compilation terminated.
> configure:5963: $? = 2
> configure: failed program was:
> | /* confdefs.h.  */
> |
> | #define PACKAGE_NAME "R"
> | #define PACKAGE_TARNAME "R"
> | #define PACKAGE_VERSION "2.2.0"
> | #define PACKAGE_STRING "R 2.2.0"
> | #define PACKAGE_BUGREPORT "r-bugs at R-project.org"
> | #define PACKAGE "R"
> | #define VERSION "2.2.0"
> | #define R_PLATFORM "x86_64-unknown-linux-gnu"
> | #define R_CPU "x86_64"
> | #define R_VENDOR "unknown"
> | #define R_OS "linux-gnu"
> | #define Unix 1
> | #ifdef __cplusplus
> | extern "C" void exit (int);
> | #endif
> | /* end confdefs.h.  */
> | #include <ac_nonexistent.h>
> configure:6002: result: /usr/pgi/linux86-64/6.0/bin/pgCC -E
> configure:6026: /usr/pgi/linux86-64/6.0/bin/pgCC -E 
> -I/usr/pgi/linux86-64/6.0/include -I/usr/pgi/linux86-64/6.0/include/CC 
> conftest.cc
> configure:6032: $? = 0
> configure:6064: /usr/pgi/linux86-64/6.0/bin/pgCC -E 
> -I/usr/pgi/linux86-64/6.0/include -I/usr/pgi/linux86-64/6.0/include/CC 
> conftest.cc
> "conftest.cc", line 19: catastrophic error: could not open source file
>         "ac_nonexistent.h"
> #include <ac_nonexistent.h>
>                            ^
>
> 1 catastrophic error detected in the compilation of "conftest.cc".
> Compilation terminated.
> configure:6070: $? = 2
> configure: failed program was:
> | /* confdefs.h.  */
> |
> | #define PACKAGE_NAME "R"
> | #define PACKAGE_TARNAME "R"
> | #define PACKAGE_VERSION "2.2.0"
> | #define PACKAGE_STRING "R 2.2.0"
> | #define PACKAGE_BUGREPORT "r-bugs at R-project.org"
> | #define PACKAGE "R"
> | #define VERSION "2.2.0"
> | #define R_PLATFORM "x86_64-unknown-linux-gnu"
> | #define R_CPU "x86_64"
> | #define R_VENDOR "unknown"
> | #define R_OS "linux-gnu"
> | #define Unix 1
> | #ifdef __cplusplus
> | extern "C" void exit (int);
> | #endif
> | /* end confdefs.h.  */
> | #include <ac_nonexistent.h>
>
>
> Thank you in advance for your help!
>
> Sincerely,
> Jennifer
>
> Prof Brian Ripley wrote:
>
>> regex.c is not our code, but from glibc.  Could you please try R-devel 
>> instead, which has a later version of glibc.  Since 2.1.1 is not longer 
>> part of the developement, we cannot help with that, but we can help wih 
>> R-devel.
>> 
>> I see the later regex.c does use prototypes.  But bitset is an integer 
>> type, so that may be a compiler error.
>> 
>> (It is on my list to try Intel and PG compilers on AMD64 as we have 
>> licences, but not very high priority.)
>> 
>> 
>> 
>
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From roger.bos at gmail.com  Thu Aug 25 15:07:20 2005
From: roger.bos at gmail.com (roger bos)
Date: Thu, 25 Aug 2005 09:07:20 -0400
Subject: [Rd] Typo(s) in proc.time.Rd and comment about ?proc.time
	(PR#8092)
In-Reply-To: <430D5BE6.1080103@math.ucalgary.ca>
References: <20050824163001.677CC19052@slim.kubism.ku.dk>
	<deid3e$fnl$1@sea.gmane.org> <430D5BE6.1080103@math.ucalgary.ca>
Message-ID: <1db726800508250607228aa3cc@mail.gmail.com>

I didn't know there was a language called American, I thought I spoke
English too, even if mine does not sound as eloquent...  This thread
should provide credit to the R Core Team for bringing R to such a
level of perfection that these are types of bug reports submitted now
adays.  Microsoft is still playing constant catch up with major
security fixes and R is debating about 'of' or 'on' in documentation.

In all seriousness, this does show the level of quality of the product... 


On 8/25/05, P Ehlers <ehlers at math.ucalgary.ca> wrote:
> David,
> 
> Re: "of the order of ..." vs "on the order of ..."
> 
> My Oxford dictionary has "of (or 'in' or 'on') the order of",
> so that there is no correction needed in proc.time.Rd. And, yes,
> I do hear 'of', at least on the northern side of the 49th
> parallel. But please don't let these comments discourage
> further documentation improvement suggestions.
> 
> Peter Ehlers
> U. of Calgary (Canada)
> 
> dhinds at sonic.net wrote:
> > ripley at stats.ox.ac.uk wrote:
> >
> >>On Wed, 24 Aug 2005 Weigand.Stephen at mayo.edu wrote:
> >
> >
> >>>I just downloaded the file
> >>>
> >>>ftp://ftp.stat.math.ethz.ch/Software/R/R-devel.tar.gz
> >>>
> >>>and within proc.time.Rd, the second paragraph of the \value
> >>>section contains a typo:
> >
> >
> >>I believe your understanding of the English language is different from the
> >>author here, who is English.  (You on the other hand seem to think there
> >>is no need to give your country in your address when writing an addess in
> >>Denmark.)  The preferred language for R documentation is English (and not
> >>American).
> >
> >
> >>>The resolution of the times will be system-specific; it is common for
> >>>them to be recorded to of the order of 1/100 second, and elapsed [...]
> >>>                    ^^^^^
> >>>
> >>>I'd say replacing "to of" with just "of" would grammatically
> >>>fix the sentence.
> >
> >
> >>I'd say it was correct and your correction is incorrect.  In English we
> >>say `recorded to 1/100th of a second', not `recorded 1/100th second'.
> >
> >
> > The correction was incorrect, but so was the original.  I've never
> > heard the expression "of the order of"; common usage (in English or
> > American, as far as I know) is "on the order of".  Your "recorded to
> > 1/100th of a second" is also ok.
> >
> >
> >>>Second, the \note{} section for Unix-like machines reads:
> >>>
> >>>It is possible to compile \R without support for \code{proc.time},
> >>>when the function will throw an error.
> >>>
> >>>I believe this is ungrammatical and suggest replacing
> >>>"when the function will throw an error" with "in which
> >>>case the function will throw an error".
> >
> >
> >>Again, the statement given is the intended meaning.
> >
> >
> > I think more clear might be, "it is possible to compile R without
> > support for proc.time, when the function *would* throw an error".
> >
> > -- Dave
> >
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From lvr at curame.com  Thu Aug 25 16:56:27 2005
From: lvr at curame.com (lvr@curame.com)
Date: Thu, 25 Aug 2005 16:56:27 +0200 (CEST)
Subject: [Rd] doesn't recognise ~ (PR#8096)
Message-ID: <20050825145627.BD10A1983B@slim.kubism.ku.dk>

Full_Name: Leo van Romunde
Version: 2, 1, 0
OS: Win XP prof. sp1
Submission from: (NULL) (81.58.34.90)


When we type the following R gives an error:

> a = c(1, 2)
> b = c(1, 2)
> boxplot (a ~ b)
Error in list(a, b) : invalid 'envir' argument

When we do exactly the same on another machine (Win2000) it works correctly.
Any suggestions?


From murdoch at stats.uwo.ca  Thu Aug 25 17:04:08 2005
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Thu, 25 Aug 2005 11:04:08 -0400
Subject: [Rd] doesn't recognise ~ (PR#8096)
In-Reply-To: <20050825145627.BD10A1983B@slim.kubism.ku.dk>
References: <20050825145627.BD10A1983B@slim.kubism.ku.dk>
Message-ID: <430DDDE8.5010307@stats.uwo.ca>

On 8/25/2005 10:56 AM, lvr at curame.com wrote:
> Full_Name: Leo van Romunde
> Version: 2, 1, 0
> OS: Win XP prof. sp1
> Submission from: (NULL) (81.58.34.90)
> 
> 
> When we type the following R gives an error:
> 
>> a = c(1, 2)
>> b = c(1, 2)
>> boxplot (a ~ b)
> Error in list(a, b) : invalid 'envir' argument
> 
> When we do exactly the same on another machine (Win2000) it works correctly.
> Any suggestions?

You probably have overwritten boxplot() or something with your own 
object.  This works fine for me in 2.1.0 (but you should upgrade to 
2.1.1 for other bug fixes).

Duncan Murdoch


From ligges at statistik.uni-dortmund.de  Thu Aug 25 18:04:02 2005
From: ligges at statistik.uni-dortmund.de (ligges@statistik.uni-dortmund.de)
Date: Thu, 25 Aug 2005 18:04:02 +0200 (CEST)
Subject: [Rd] doesn't recognise ~ (PR#8096)
Message-ID: <20050825160402.91EA21983A@slim.kubism.ku.dk>

lvr at curame.com wrote:

> Full_Name: Leo van Romunde
> Version: 2, 1, 0
> OS: Win XP prof. sp1
> Submission from: (NULL) (81.58.34.90)
> 
> 
> When we type the following R gives an error:
> 
> 
>>a = c(1, 2)
>>b = c(1, 2)
>>boxplot (a ~ b)
> 
> Error in list(a, b) : invalid 'envir' argument
> 
> When we do exactly the same on another machine (Win2000) it works correctly.
> Any suggestions?

Yes:
a) Do not file a bug report if there is no evidence for a bug (you say 
yourself it works on another machine).
b) Do upgrade  before posting a bug (at least you .0 version of R, and 
in a next step (here not so important) your Windows).
c) Try to start a clean version of R:
I mean without loading some strange objects in your workspace or some 
packages that might break some important R properties.

Uwe Ligges



> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From deepayan.sarkar at gmail.com  Thu Aug 25 19:05:04 2005
From: deepayan.sarkar at gmail.com (Deepayan Sarkar)
Date: Thu, 25 Aug 2005 12:05:04 -0500
Subject: [Rd] histogram method for S4 class.
In-Reply-To: <430C5958.1040005@ipimar.pt>
References: <430C5958.1040005@ipimar.pt>
Message-ID: <eb555e6605082510052dc054a@mail.gmail.com>

On 8/24/05, ernesto <ernesto at ipimar.pt> wrote:
> Hi,
> 
> I'm trying to develop an histogram method for a class called "FLQuant"
> which is used by the package FLCore (http://flr-project.org). FLQuant is
> an extension to "array". There is an as.data.frame method that coerces
> flquant into a data.frame suitable for lattice plotting. The problem is
> that when I coerce the object and plot it after it works but if the
> method is applied within the histogram method it does not work. See the
> code below (the FLCore package is here
> http://prdownloads.sourceforge.net/flr/FLCore_1.0-1.tar.gz?download)
> 
> > library(FLCore)
> Loading required package: lattice
> > data(ple4)
> > histogram(~data|year, data=ple4 at catch.n)
> Error in inherits(x, "factor") : Object "x" not found
> > histogram(~data|year, data=as.data.frame(ple4 at catch.n))
> 
> The catch.n slot is a FLQuant object and the code for histogram is the
> following
> 
> setMethod("histogram", signature(formula="formula", data="FLQuant"),
>     function (formula, data = parent.frame(), allow.multiple =
> is.null(groups) || outer,
>         outer = FALSE, auto.key = FALSE, aspect = "fill", panel =
> "panel.histogram", prepanel = NULL,
>         scales = list(), strip = TRUE, groups = NULL, xlab, xlim, ylab,
> ylim,
>         type = c("percent", "count", "density"),
>         nint = if (is.factor(x)) length(levels(x)) else
> round(log2(length(x)) + 1),
>         endpoints = extend.limits(range(x[!is.na(x)]), prop = 0.04),
>         breaks = if (is.factor(x)) seq(0.5, length = length(levels(x)) +
> 1) else do.breaks(endpoints, nint),
>         equal.widths = TRUE, drop.unused.levels =
> lattice.getOption("drop.unused.levels"), ...,
>         default.scales = list(), subscripts = !is.null(groups), subset =
> TRUE) {
> 
>         qdf <- as.data.frame(data)
> 
>         histogram(formula, data = qdf, allow.multiple = allow.multiple,
> outer = outer,
>             auto.key = auto.key, aspect = aspect, panel = panel,
> prepanel = prepanel, scales = scales,
>             strip = strip, groups = groups, xlab=xlab, xlim=xlim,
> ylab=ylab, ylim=ylim, type = type,
>             nint = nint, endpoints = endpoints, breaks = breaks,
> equal.widths = equal.widths,
>             drop.unused.levels = drop.unused.levels, ..., default.scales
> = default.scales,
>             subscripts = subscripts, subset = subset)
>     }
> )
> 
> 
> Any ideas ?

[I'm CC-ing to r-devel, please post follow-ups there]

What version of lattice are you using? Please use the latest one, in
which histogram is an S3 generic, with only one argument, formula. The
eventual solution to your problem may involve changing that, but the
first question to ask is whether any other formula makes sense in your
context (if not, I would rather keep one argument and dispatch on
signature(formula = "FLQuant").

Disclaimer: I haven't actually had time to check out FLCore yet, I
will as soon as I can.

Deepayan


From erich.neuwirth at univie.ac.at  Thu Aug 25 23:35:45 2005
From: erich.neuwirth at univie.ac.at (Erich Neuwirth)
Date: Thu, 25 Aug 2005 23:35:45 +0200
Subject: [Rd] weigths in boxplot
In-Reply-To: <17163.8026.69287.789426@stat.math.ethz.ch>
References: <20050808192734.F0418A274@slim.kubism.ku.dk>	<4308B108.7030003@univie.ac.at>
	<17163.8026.69287.789426@stat.math.ethz.ch>
Message-ID: <430E39B1.2010209@univie.ac.at>

Martin,

Frank Harrell's Hmisc has weigthed variants of quite a few statistical
estimators, including quantiles. I never have look at
how efficiently this is implemented, but as far as I know
it works.

Erich




Martin Maechler wrote:
>>>>>>"Erich" == Erich Neuwirth <erich.neuwirth at univie.ac.at>
>>>>>>    on Sun, 21 Aug 2005 18:51:20 +0200 writes:
> 
> 
>     Erich> In R 2.2.0 density now can work with weighted
>     Erich> obesrvations.  It would be nice if boxplot also would
>     Erich> accept a weight parameter, then one could produce
>     Erich> consistent density estimators and boxplots.
> 
>     Erich> Could the developers consider adding this feature?
> 
> The first thing I'd want is  quantile() with weights --- which I
> personally find quite interesting and have wanted several times
> in the past --- not wanted enough to implement though.
> 
> I'm interested to hear of (or even see C or R implementations of)
> fast algorithms for "weight quantiles".  
> Code contributions are welcome too..
> 
> (And yes, I do know that boxplots are base on "hinges" rather than
>  quartiles but that's less interesting here.)
> 
> Martin Maechler <maechler at stat.math.ethz.ch>	http://stat.ethz.ch/~maechler/
> Seminar fuer Statistik, ETH-Zentrum  LEO C16	Leonhardstr. 27
> ETH (Federal Inst. Technology)	8092 Zurich	SWITZERLAND
> phone: +41-44-632-3408		fax: ...-1228			<><
> 


-- 
Erich Neuwirth, Didactic Center for Computer Science
University of Vienna
Visit our SunSITE at http://sunsite.univie.ac.at
Phone: +43-1-4277-39902 Fax: +43-1-4277-9399


From ernesto at ipimar.pt  Fri Aug 26 11:15:01 2005
From: ernesto at ipimar.pt (Ernesto Jardim)
Date: Fri, 26 Aug 2005 10:15:01 +0100
Subject: [Rd] histogram method for S4 class.
In-Reply-To: <eb555e6605082510052dc054a@mail.gmail.com>
References: <430C5958.1040005@ipimar.pt>
	<eb555e6605082510052dc054a@mail.gmail.com>
Message-ID: <430EDD95.3010006@ipimar.pt>

Deepayan Sarkar wrote:

>On 8/24/05, ernesto <ernesto at ipimar.pt> wrote:
>  
>
>>Hi,
>>
>>I'm trying to develop an histogram method for a class called "FLQuant"
>>which is used by the package FLCore (http://flr-project.org). FLQuant is
>>an extension to "array". There is an as.data.frame method that coerces
>>flquant into a data.frame suitable for lattice plotting. The problem is
>>that when I coerce the object and plot it after it works but if the
>>method is applied within the histogram method it does not work. See the
>>code below (the FLCore package is here
>>http://prdownloads.sourceforge.net/flr/FLCore_1.0-1.tar.gz?download)
>>
>>    
>>
>>>library(FLCore)
>>>      
>>>
>>Loading required package: lattice
>>    
>>
>>>data(ple4)
>>>histogram(~data|year, data=ple4 at catch.n)
>>>      
>>>
>>Error in inherits(x, "factor") : Object "x" not found
>>    
>>
>>>histogram(~data|year, data=as.data.frame(ple4 at catch.n))
>>>      
>>>
>>The catch.n slot is a FLQuant object and the code for histogram is the
>>following
>>
>>setMethod("histogram", signature(formula="formula", data="FLQuant"),
>>    function (formula, data = parent.frame(), allow.multiple =
>>is.null(groups) || outer,
>>        outer = FALSE, auto.key = FALSE, aspect = "fill", panel =
>>"panel.histogram", prepanel = NULL,
>>        scales = list(), strip = TRUE, groups = NULL, xlab, xlim, ylab,
>>ylim,
>>        type = c("percent", "count", "density"),
>>        nint = if (is.factor(x)) length(levels(x)) else
>>round(log2(length(x)) + 1),
>>        endpoints = extend.limits(range(x[!is.na(x)]), prop = 0.04),
>>        breaks = if (is.factor(x)) seq(0.5, length = length(levels(x)) +
>>1) else do.breaks(endpoints, nint),
>>        equal.widths = TRUE, drop.unused.levels =
>>lattice.getOption("drop.unused.levels"), ...,
>>        default.scales = list(), subscripts = !is.null(groups), subset =
>>TRUE) {
>>
>>        qdf <- as.data.frame(data)
>>
>>        histogram(formula, data = qdf, allow.multiple = allow.multiple,
>>outer = outer,
>>            auto.key = auto.key, aspect = aspect, panel = panel,
>>prepanel = prepanel, scales = scales,
>>            strip = strip, groups = groups, xlab=xlab, xlim=xlim,
>>ylab=ylab, ylim=ylim, type = type,
>>            nint = nint, endpoints = endpoints, breaks = breaks,
>>equal.widths = equal.widths,
>>            drop.unused.levels = drop.unused.levels, ..., default.scales
>>= default.scales,
>>            subscripts = subscripts, subset = subset)
>>    }
>>)
>>
>>
>>Any ideas ?
>>    
>>
>
>[I'm CC-ing to r-devel, please post follow-ups there]
>
>What version of lattice are you using? Please use the latest one, in
>which histogram is an S3 generic, with only one argument, formula. The
>eventual solution to your problem may involve changing that, but the
>first question to ask is whether any other formula makes sense in your
>context (if not, I would rather keep one argument and dispatch on
>signature(formula = "FLQuant").
>
>Disclaimer: I haven't actually had time to check out FLCore yet, I
>will as soon as I can.
>
>Deepayan
>  
>
Hi,

I've installed the version that is distributed with R-2.1.1, 0.11-8. I 
see there's a new version now so I'll install it and check the results. 
I've developed the code a little more using the approach you use for 
dotplot (see below) and I know where the problem is now. I'm not able to 
pass the argument nint, breaks and endpoints to the function call. I 
guess the problem is my programming skils :-(

Thanks

EJ

ps: I'm not a subscriber of r-devel so I guess I'm not able to post 
there, anyway I'm CC-ing there too.



setMethod("histogram", signature(formula="formula", data="FLQuant"), 
function (formula, data = parent.frame(), allow.multiple = 
is.null(groups) || outer, outer = FALSE, auto.key = FALSE, aspect = 
"fill", panel = "panel.histogram", prepanel = NULL, scales = list(), 
strip = TRUE, groups = NULL, xlab, xlim, ylab, ylim, type = c("percent", 
"count", "density"), nint = if (is.factor(x)) length(levels(x)) else 
round(log2(length(x)) + 1), endpoints = 
extend.limits(range(x[!is.na(x)]), prop = 0.04), breaks = if 
(is.factor(x)) seq(0.5, length = length(levels(x)) + 1) else 
do.breaks(endpoints, nint), equal.widths = TRUE, drop.unused.levels = 
lattice.getOption("drop.unused.levels"), ..., default.scales = list(), 
subscripts = !is.null(groups), subset = TRUE) {

# need to develop further, at the moment is not possible to control 
nint, breaks and endpoints.

data <- as.data.frame(data)

dots <- list(...)

groups <- eval(substitute(groups), data, parent.frame())
subset <- eval(substitute(subset), data, parent.frame())

call.list <- c(list(formula = formula, data = data, groups = groups, 
subset = subset, allow.multiple = allow.multiple, outer = outer, 
auto.key = auto.key, aspect = aspect, panel = panel, prepanel = 
prepanel, scales = scales, strip = strip, type = type, equal.widths = 
equal.widths, drop.unused.levels = drop.unused.levels, default.scales = 
default.scales, subscripts = subscripts), dots)

# include xlab & co if existent
if(!missing(xlab)) call.list$xlab <- xlab
if(!missing(ylab)) call.list$ylab <- ylab
if(!missing(xlim)) call.list$xlim <- xlim
if(!missing(ylim)) call.list$ylim <- ylim

ans <- do.call("histogram", call.list)
ans$call <- match.call()
ans

})


From maechler at stat.math.ethz.ch  Fri Aug 26 12:17:37 2005
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Fri, 26 Aug 2005 12:17:37 +0200
Subject: [Rd] histogram method for S4 class.
In-Reply-To: <430EDD95.3010006@ipimar.pt>
References: <430C5958.1040005@ipimar.pt>
	<eb555e6605082510052dc054a@mail.gmail.com>
	<430EDD95.3010006@ipimar.pt>
Message-ID: <17166.60481.113887.50512@stat.math.ethz.ch>

>>>>> "Ernesto" == Ernesto Jardim <ernesto at ipimar.pt>
>>>>>     on Fri, 26 Aug 2005 10:15:01 +0100 writes:

    Ernesto> Deepayan Sarkar wrote:

    >> [I'm CC-ing to r-devel, please post follow-ups there]

    >> .........

    >> Deepayan

    Ernesto> ...............

    Ernesto> ps: I'm not a subscriber of r-devel so I guess I'm
    Ernesto> not able to post there, 

yes, you can post here without being a subscriber (the same as with R-help) !

    Ernesto> anyway I'm CC-ing there too.

{ the idea was that you'd only send this to R-devel, not to
  R-help as well, once Deepayan has diverted it to here }

BTW: I think you *should* rather subscribe to R-devel, if you
  are an R package writer. 
  We (R-core) actually sometimes behave as if R-devel was
  read by all interested R package writers - even though we know
  it's not quite true.

  Since R-devel has much a smaller bandwidth than R-help, and
  you're already willing to read R-help, why don't you subscribe
  to R-devel?


Regards,
Martin Maechler, ETH Zurich


From gb at stat.umu.se  Fri Aug 26 13:46:50 2005
From: gb at stat.umu.se (=?iso-8859-1?Q?G=F6ran_Brostr=F6m?=)
Date: Fri, 26 Aug 2005 13:46:50 +0200
Subject: [Rd] Fortran (Was: Re: [R] linux compile options (64-bit))
In-Reply-To: <20050802101208.GA32181@stat.umu.se>
References: <22761BFE-8A79-4A81-966F-6E863E556A83@comcast.net>
	<5FD5AD51-2B4A-4669-AC0F-DBD1541B10E8@comcast.net>
	<Pine.LNX.4.61.0508020729350.19394@gannet.stats>
	<20050802081040.GA28478@stat.umu.se>
	<Pine.LNX.4.61.0508020914500.21072@gannet.stats>
	<20050802092351.GA30688@stat.umu.se>
	<Pine.LNX.4.61.0508021052020.25929@gannet.stats>
	<20050802101208.GA32181@stat.umu.se>
Message-ID: <20050826114650.GA23719@stat.umu.se>

On Tue, Aug 02, 2005 at 12:12:08PM +0200, G?ran Brostr?m wrote:
> On Tue, Aug 02, 2005 at 10:58:31AM +0100, Prof Brian Ripley wrote:
> 
> > The problems we are seeing with gcc4 are mainly (but not 
> > entirely) with gfortran: it seems not quite ready for production use.
> > -4.0.1 is already a considerable improvement over -4.0.0.
> > 
> > There is another project (www.g95.org) that is using a slightly different 
> > version of these sources, and either g95 or gfortran can be used with 
> > gcc3 if you want to use F95 sources.  However, F95 is unlikely to be 
> > suitable for use in distributed R packages for a long time to come.
> 
> Thanks; I'll stick to 3.4.4(!) and f77 for the time being.

One short follow-up question on the F77/95 theme: In my CRAN packages, I use
the construct "do while ... end do" in my fortran sources. This is AFAIK not
strict F77, but an extension in g77, and standard in F95. "-pedantic" does not 
complain about this; on the other hand "---it finds some non-ANSI
practices, but not all" (from 'man g77').

Should I rewrite the "do while...end do" parts? (Please answer NO!:)


G?ran


From ripley at stats.ox.ac.uk  Fri Aug 26 14:40:42 2005
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 26 Aug 2005 13:40:42 +0100 (BST)
Subject: [Rd] Fortran (Was: Re: [R] linux compile options (64-bit))
In-Reply-To: <20050826114650.GA23719@stat.umu.se>
References: <22761BFE-8A79-4A81-966F-6E863E556A83@comcast.net>
	<5FD5AD51-2B4A-4669-AC0F-DBD1541B10E8@comcast.net>
	<Pine.LNX.4.61.0508020729350.19394@gannet.stats>
	<20050802081040.GA28478@stat.umu.se>
	<Pine.LNX.4.61.0508020914500.21072@gannet.stats>
	<20050802092351.GA30688@stat.umu.se>
	<Pine.LNX.4.61.0508021052020.25929@gannet.stats>
	<20050802101208.GA32181@stat.umu.se>
	<20050826114650.GA23719@stat.umu.se>
Message-ID: <Pine.LNX.4.61.0508261338560.3521@gannet.stats>

On Fri, 26 Aug 2005, G?ran Brostr?m wrote:

> On Tue, Aug 02, 2005 at 12:12:08PM +0200, G?ran Brostr?m wrote:
>> On Tue, Aug 02, 2005 at 10:58:31AM +0100, Prof Brian Ripley wrote:
>>
>>> The problems we are seeing with gcc4 are mainly (but not
>>> entirely) with gfortran: it seems not quite ready for production use.
>>> -4.0.1 is already a considerable improvement over -4.0.0.
>>>
>>> There is another project (www.g95.org) that is using a slightly different
>>> version of these sources, and either g95 or gfortran can be used with
>>> gcc3 if you want to use F95 sources.  However, F95 is unlikely to be
>>> suitable for use in distributed R packages for a long time to come.
>>
>> Thanks; I'll stick to 3.4.4(!) and f77 for the time being.
>
> One short follow-up question on the F77/95 theme: In my CRAN packages, I use
> the construct "do while ... end do" in my fortran sources. This is AFAIK not
> strict F77, but an extension in g77, and standard in F95. "-pedantic" does not
> complain about this; on the other hand "---it finds some non-ANSI
> practices, but not all" (from 'man g77').
>
> Should I rewrite the "do while...end do" parts? (Please answer NO!:)

There are compilers that do not accept that construct: AFAIR the Solaris 
f77 is one.  But, if no one is complaining I would leave it.  (We would 
not allow such things in base R, as inevitably it will cause problems on 
some rare platform.)

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From ales.ziberna at guest.arnes.si  Fri Aug 26 16:36:20 2005
From: ales.ziberna at guest.arnes.si (=?iso-8859-2?Q?Ale=B9_=AEiberna?=)
Date: Fri, 26 Aug 2005 16:36:20 +0200
Subject: [Rd] Free-form to fixed-form Fortran
Message-ID: <012c01c5aa4b$98531ce0$598debd4@ales>

Hello!

I have writen some subrutines in Free-form Fortran. I would like to includ 
them in a package, which I would like to build on WinXP. I have all 
suggested tools/programs for bulding R packages on Windows (except latex).

What is the best way of using these subrutines? Does sombody mybe know any 
translation tools for converting Free-form to fixed-form Fortran?

Thanks for any suggestions,
Ales Ziberna


From h.wickham at gmail.com  Fri Aug 26 17:30:56 2005
From: h.wickham at gmail.com (hadley wickham)
Date: Fri, 26 Aug 2005 10:30:56 -0500
Subject: [Rd] Functions with the same name: best practices
In-Reply-To: <430AF77F.8090402@stats.uwo.ca>
References: <f8e6ff05050822195854575b4d@mail.gmail.com>
	<430AF77F.8090402@stats.uwo.ca>
Message-ID: <f8e6ff05050826083030aee9b8@mail.gmail.com>

Thanks to all of you for your advice. I will read up on namespaces and
start using them to "protect" my internal function from name clashes
with other packages, and endeavour to my public functions unique
names.

I know other languages (eg. python) separate loading a package and
including it in the default namespace, do you think R will ever move
to such a system?

Thanks,

Hadley


From ripley at stats.ox.ac.uk  Fri Aug 26 17:45:57 2005
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 26 Aug 2005 16:45:57 +0100 (BST)
Subject: [Rd] Functions with the same name: best practices
In-Reply-To: <f8e6ff05050826083030aee9b8@mail.gmail.com>
References: <f8e6ff05050822195854575b4d@mail.gmail.com>
	<430AF77F.8090402@stats.uwo.ca>
	<f8e6ff05050826083030aee9b8@mail.gmail.com>
Message-ID: <Pine.LNX.4.61.0508261643370.11188@gannet.stats>

On Fri, 26 Aug 2005, hadley wickham wrote:

> Thanks to all of you for your advice. I will read up on namespaces and
> start using them to "protect" my internal function from name clashes
> with other packages, and endeavour to my public functions unique
> names.
>
> I know other languages (eg. python) separate loading a package and
> including it in the default namespace, do you think R will ever move
> to such a system?

I don't follow the terminology here, but in R you can load a namespace 
without making the exports visible, which sounds like what you are asking. 
In R `loading a package' means making its objects visible from the 
top-level scope.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From hb at maths.lth.se  Fri Aug 26 17:55:38 2005
From: hb at maths.lth.se (Henrik Bengtsson)
Date: Fri, 26 Aug 2005 17:55:38 +0200
Subject: [Rd] Memory leakage/violation?
Message-ID: <430F3B7A.5020807@maths.lth.se>

Hi,

I've spotted a possible memory leakage/violation in the latest R v2.1.1 
patched and R v2.2.0dev on Windows XP Pro SP2 Eng.

I first caught it deep down in a nested svd algorithm when subtracting a 
double 'c' from a integer vector 'a' where both had finite values but 
when assigning 'a <- a - c' would report NaNs whereas (a-c) alone would 
not.  Different runs with the identical data would introduce NaNs at 
random positions, but not all the time.

Troubleshooting is after a couple of hours still at v0.5, but here is a 
script that generates the strange behavior on the above R setups.  I let 
the script speak for itself.  Note that both the script 'strange.R' and 
the data 'strange.RData' is online too, see code below.

People on other systems (but also on Windows), could you please try it 
and see if you can reproduce what I get.

Cheers

Henrik


# The following was tested on: Windows XP Pro SP2 Eng with
#   i) R Version 2.1.1 Patched (2005-08-25)
#  ii) R 2.2.0 Under development (unstable) (2005-08-25 r35394M)

# Start 'R --vanilla' and source() this script, i.e.
#  source("http://www.maths.lth.se/help/R/strange.R")
# If you do not get any errors, retry a few times.

foo <- function(x) {
   print(list(
     name=as.character(substitute(x)),
     storage.mode=storage.mode(x),
     na=any(is.na(x)),
     nan=any(is.nan(x)),
     inf=any(is.infinite(x)),
     ok=all(is.finite(a))
   ))
   print(length(x))
   print(summary(x))
}

# Load data from a complicated "non-reproducible" algorithm.
# The below errors occur also when data is not
# saved and then reloaded from file.  Data was generated in
# R v2.1.1 patched (see above).
if (file.exists("strange.RData")) {
   load("strange.RData")
} else {
   load(url("http://www.maths.lth.se/help/R/strange.RData"))
}

# First glance at data...
foo(a)
foo(c)

## $name
## [1] "a"
##
## $storage.mode
## [1] "integer"
##
## $na
## [1] FALSE
##
## $nan
## [1] FALSE
##
## $inf
## [1] FALSE
##
## $ok
## [1] TRUE
##
## [1] 15000
##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.
##    41.0    51.0    63.0   292.2   111.0 65170.0
## $name
## [1] "c"
##
## $storage.mode
## [1] "double"
##
## $na
## [1] FALSE
##
## $nan
## [1] FALSE
##
## $inf
## [1] FALSE
##
## $ok
## [1] TRUE
##
## [1] 1
##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.
##   53.43   53.43   53.43   53.43   53.43   53.43
##

# But, trying the following, will result in
# no-reproducible error messages. Sometimes
# it errors at kk==1, sometimes at kk >> 1.
# Also, look at the different output for
# different kk:s.
for (kk in 1:100) {
   cat("kk=",kk, "\n")
   print(summary(a-c))
}

## kk= 1
## 	  Min.     1st Qu.      Median        Mean     3rd Qu.        Max.
## -7.741e+307  -2.431e+00   9.569e+00               5.757e+01
## kk= 2
## 	Min.   1st Qu.    Median      Mean   3rd Qu.      Max.
##   -12.430    -2.431     9.569   238.700    57.570 65120.000
## kk= 3
## 	Min.   1st Qu.    Median      Mean   3rd Qu.      Max.
##   -12.430    -2.431     9.569              57.570 65120.000
## kk= 4
## 	Min.   1st Qu.    Median      Mean   3rd Qu.      Max.
##   -12.430    -2.431     9.569   238.700    57.570 65120.000
## kk= 5
## 	Min.   1st Qu.    Median      Mean   3rd Qu.      Max.
##   -12.430    -2.431     9.569   238.700    57.570 65120.000
## kk= 6
## Error in quantile.default(object) : missing values and NaN's
## not allowed if 'na.rm' is FALSE


## Comments: If you shorten down 'a', the bug occurs less frequently.


From macq at llnl.gov  Fri Aug 26 19:18:37 2005
From: macq at llnl.gov (Don MacQueen)
Date: Fri, 26 Aug 2005 10:18:37 -0700
Subject: [Rd] Free-form to fixed-form Fortran
In-Reply-To: <012c01c5aa4b$98531ce0$598debd4@ales>
References: <012c01c5aa4b$98531ce0$598debd4@ales>
Message-ID: <p06210202bf34fed7855a@[128.115.153.6]>

Not knowing exactly what you mean by Free-form Fortran I couldn't say 
for sure, but
perhaps ratfor will do the job. Worth trying, I would think.

-Don

At 4:36 PM +0200 8/26/05, =?iso-8859-2?Q?Ale=B9_=AEiberna?= wrote:
>Hello!
>
>I have writen some subrutines in Free-form Fortran. I would like to includ
>them in a package, which I would like to build on WinXP. I have all
>suggested tools/programs for bulding R packages on Windows (except latex).
>
>What is the best way of using these subrutines? Does sombody mybe know any
>translation tools for converting Free-form to fixed-form Fortran?
>
>Thanks for any suggestions,
>Ales Ziberna
>
>______________________________________________
>R-devel at r-project.org mailing list
>https://stat.ethz.ch/mailman/listinfo/r-devel


-- 
--------------------------------------
Don MacQueen
Environmental Protection Department
Lawrence Livermore National Laboratory
Livermore, CA, USA


From simon.urbanek at r-project.org  Fri Aug 26 20:29:46 2005
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Fri, 26 Aug 2005 14:29:46 -0400
Subject: [Rd] Free-form to fixed-form Fortran
In-Reply-To: <012c01c5aa4b$98531ce0$598debd4@ales>
References: <012c01c5aa4b$98531ce0$598debd4@ales>
Message-ID: <0FB3A270-8726-4BC3-AEEE-0A53BEF222DF@r-project.org>

Ale?i,

On Aug 26, 2005, at 10:36 AM, Ale? ?iberna wrote:

> I have writen some subrutines in Free-form Fortran. I would like to  
> includ
> them in a package, which I would like to build on WinXP. I have all
> suggested tools/programs for bulding R packages on Windows (except  
> latex).
>
> What is the best way of using these subrutines? Does sombody mybe  
> know any
> translation tools for converting Free-form to fixed-form Fortran?

If your only concern is to build it, you may try using g77 with - 
ffree-form. This should work with GNU Fortran. However, that limits  
the availability of your package to GNU compilers only.

Cheers,
?imon


From tlumley at u.washington.edu  Fri Aug 26 20:47:45 2005
From: tlumley at u.washington.edu (Thomas Lumley)
Date: Fri, 26 Aug 2005 11:47:45 -0700 (PDT)
Subject: [Rd] Memory leakage/violation?
In-Reply-To: <430F3B7A.5020807@maths.lth.se>
References: <430F3B7A.5020807@maths.lth.se>
Message-ID: <Pine.A41.4.61b.0508261146090.87310@homer03.u.washington.edu>


I can't reproduce this on R2.2.0dev on Windows XP (in a few hundred 
tries), or running under Valgrind on AMD64 Linux (in four or five tries).

 	-thomas


On Fri, 26 Aug 2005, Henrik Bengtsson wrote:

> Hi,
>
> I've spotted a possible memory leakage/violation in the latest R v2.1.1
> patched and R v2.2.0dev on Windows XP Pro SP2 Eng.
>
> I first caught it deep down in a nested svd algorithm when subtracting a
> double 'c' from a integer vector 'a' where both had finite values but
> when assigning 'a <- a - c' would report NaNs whereas (a-c) alone would
> not.  Different runs with the identical data would introduce NaNs at
> random positions, but not all the time.
>
> Troubleshooting is after a couple of hours still at v0.5, but here is a
> script that generates the strange behavior on the above R setups.  I let
> the script speak for itself.  Note that both the script 'strange.R' and
> the data 'strange.RData' is online too, see code below.
>
> People on other systems (but also on Windows), could you please try it
> and see if you can reproduce what I get.
>
> Cheers
>
> Henrik
>
>
> # The following was tested on: Windows XP Pro SP2 Eng with
> #   i) R Version 2.1.1 Patched (2005-08-25)
> #  ii) R 2.2.0 Under development (unstable) (2005-08-25 r35394M)
>
> # Start 'R --vanilla' and source() this script, i.e.
> #  source("http://www.maths.lth.se/help/R/strange.R")
> # If you do not get any errors, retry a few times.
>
> foo <- function(x) {
>   print(list(
>     name=as.character(substitute(x)),
>     storage.mode=storage.mode(x),
>     na=any(is.na(x)),
>     nan=any(is.nan(x)),
>     inf=any(is.infinite(x)),
>     ok=all(is.finite(a))
>   ))
>   print(length(x))
>   print(summary(x))
> }
>
> # Load data from a complicated "non-reproducible" algorithm.
> # The below errors occur also when data is not
> # saved and then reloaded from file.  Data was generated in
> # R v2.1.1 patched (see above).
> if (file.exists("strange.RData")) {
>   load("strange.RData")
> } else {
>   load(url("http://www.maths.lth.se/help/R/strange.RData"))
> }
>
> # First glance at data...
> foo(a)
> foo(c)
>
> ## $name
> ## [1] "a"
> ##
> ## $storage.mode
> ## [1] "integer"
> ##
> ## $na
> ## [1] FALSE
> ##
> ## $nan
> ## [1] FALSE
> ##
> ## $inf
> ## [1] FALSE
> ##
> ## $ok
> ## [1] TRUE
> ##
> ## [1] 15000
> ##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.
> ##    41.0    51.0    63.0   292.2   111.0 65170.0
> ## $name
> ## [1] "c"
> ##
> ## $storage.mode
> ## [1] "double"
> ##
> ## $na
> ## [1] FALSE
> ##
> ## $nan
> ## [1] FALSE
> ##
> ## $inf
> ## [1] FALSE
> ##
> ## $ok
> ## [1] TRUE
> ##
> ## [1] 1
> ##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.
> ##   53.43   53.43   53.43   53.43   53.43   53.43
> ##
>
> # But, trying the following, will result in
> # no-reproducible error messages. Sometimes
> # it errors at kk==1, sometimes at kk >> 1.
> # Also, look at the different output for
> # different kk:s.
> for (kk in 1:100) {
>   cat("kk=",kk, "\n")
>   print(summary(a-c))
> }
>
> ## kk= 1
> ## 	  Min.     1st Qu.      Median        Mean     3rd Qu.        Max.
> ## -7.741e+307  -2.431e+00   9.569e+00               5.757e+01
> ## kk= 2
> ## 	Min.   1st Qu.    Median      Mean   3rd Qu.      Max.
> ##   -12.430    -2.431     9.569   238.700    57.570 65120.000
> ## kk= 3
> ## 	Min.   1st Qu.    Median      Mean   3rd Qu.      Max.
> ##   -12.430    -2.431     9.569              57.570 65120.000
> ## kk= 4
> ## 	Min.   1st Qu.    Median      Mean   3rd Qu.      Max.
> ##   -12.430    -2.431     9.569   238.700    57.570 65120.000
> ## kk= 5
> ## 	Min.   1st Qu.    Median      Mean   3rd Qu.      Max.
> ##   -12.430    -2.431     9.569   238.700    57.570 65120.000
> ## kk= 6
> ## Error in quantile.default(object) : missing values and NaN's
> ## not allowed if 'na.rm' is FALSE
>
>
> ## Comments: If you shorten down 'a', the bug occurs less frequently.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

Thomas Lumley			Assoc. Professor, Biostatistics
tlumley at u.washington.edu	University of Washington, Seattle


From blue123silver at netscape.net  Fri Aug 26 21:49:31 2005
From: blue123silver at netscape.net (blue123silver@netscape.net)
Date: Fri, 26 Aug 2005 21:49:31 +0200 (CEST)
Subject: [Rd] Relatives (PR#8098)
Message-ID: <20050826194931.167F418B8F@slim.kubism.ku.dk>

BLUE SILVER CONSULTANTS.
blue123silver at netscape.net

Blue Silver Consultants:Private Investigators and Security Consultants is
conducting a standard process investigation on behalf of Deutsche Bank
AG,the international Banking conglomerate, and we will like you to assist with
this Independent Enquiry.

My name is Alter Wolfgang. I am a senior partner in the firm. This
investigation involves a client who shares the same surname with you
and also the circumstances surrounding investments made by this client at
Deutsche Bank AG.

The Deutsche Bank AG Banking client died intestate and nominated no
successor in title over the investments made with the Bank. The essence of this
communication with you is to request you provide us information/comments on any
or all of the four issues:

1-Are you aware of any relative/relation who shares your same surname
whose last known contact address was Hamburg, Germany?

2-Are you aware of any investment of considerable value made by such
aperson at the Deutsche Bank AG?

3-Born on the 1st of June 1927

4-Can you establish beyond reasonable doubt your eligibility to assume
status of successor in title to the deceased?

It is pertinent that you inform us ASAP whether or not you are familiar
with this personality that we may put an end to this communication with
you and our inquiries surrounding this personality. You must appreciate
that we are constrained from providing you with more detailed
information at this point.

Please respond to this mail as soon as possible to afford us the
opportunity to close this investigation. Thank you for accommodating
our enquiry.

blue123silver at netscape.net
Wolfgang Alter

For:Blue Silver Consultants.


From dhinds at sonic.net  Fri Aug 26 22:51:12 2005
From: dhinds at sonic.net (dhinds@sonic.net)
Date: Fri, 26 Aug 2005 20:51:12 +0000 (UTC)
Subject: [Rd] RFC: "loop connections"
References: <dedndn$daj$1@sea.gmane.org>
Message-ID: <denvc0$eag$1@sea.gmane.org>

I accidentally left one small change out of my previous patch.

So... no response to my request for comments.  Does that mean no one
has an opinion about whether this is a good idea or not?  I'd
appreciate a response from an R core member one way or the other; if
this is not the right way to get a response, should I email people
instead?

-- David Hinds


--- src/include/Internal.h.orig	2005-05-20 05:51:37.000000000 -0700
+++ src/include/Internal.h	2005-08-22 15:46:48.968190600 -0700
@@ -518,7 +518,7 @@
 SEXP do_pushback(SEXP, SEXP, SEXP, SEXP);
 SEXP do_pushbacklength(SEXP, SEXP, SEXP, SEXP);
 SEXP do_clearpushback(SEXP, SEXP, SEXP, SEXP);
-SEXP do_textconnection(SEXP, SEXP, SEXP, SEXP);
+SEXP do_loopconnection(SEXP, SEXP, SEXP, SEXP);
 SEXP do_getallconnections(SEXP, SEXP, SEXP, SEXP);
 SEXP do_sumconnection(SEXP, SEXP, SEXP, SEXP);
 SEXP do_download(SEXP, SEXP, SEXP, SEXP);


From ggrothendieck at gmail.com  Fri Aug 26 23:25:24 2005
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Fri, 26 Aug 2005 17:25:24 -0400
Subject: [Rd] RFC: "loop connections"
In-Reply-To: <denvc0$eag$1@sea.gmane.org>
References: <dedndn$daj$1@sea.gmane.org> <denvc0$eag$1@sea.gmane.org>
Message-ID: <971536df05082614254465b8c6@mail.gmail.com>

OK.  I guess you want one of the core people to respond but in the
interim can you explain the terminology "loop"?   
Also, do you have any prototypical applications in mind?

On 8/26/05, dhinds at sonic.net <dhinds at sonic.net> wrote:
> I accidentally left one small change out of my previous patch.
> 
> So... no response to my request for comments.  Does that mean no one
> has an opinion about whether this is a good idea or not?  I'd
> appreciate a response from an R core member one way or the other; if
> this is not the right way to get a response, should I email people
> instead?
> 
> -- David Hinds
> 
> 
> --- src/include/Internal.h.orig 2005-05-20 05:51:37.000000000 -0700
> +++ src/include/Internal.h      2005-08-22 15:46:48.968190600 -0700
> @@ -518,7 +518,7 @@
>  SEXP do_pushback(SEXP, SEXP, SEXP, SEXP);
>  SEXP do_pushbacklength(SEXP, SEXP, SEXP, SEXP);
>  SEXP do_clearpushback(SEXP, SEXP, SEXP, SEXP);
> -SEXP do_textconnection(SEXP, SEXP, SEXP, SEXP);
> +SEXP do_loopconnection(SEXP, SEXP, SEXP, SEXP);
>  SEXP do_getallconnections(SEXP, SEXP, SEXP, SEXP);
>  SEXP do_sumconnection(SEXP, SEXP, SEXP, SEXP);
>  SEXP do_download(SEXP, SEXP, SEXP, SEXP);
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From rabrantes82 at gmail.com  Sat Aug 27 00:08:51 2005
From: rabrantes82 at gmail.com (Ricardo Luiz Andrade Abrantes)
Date: Fri, 26 Aug 2005 19:08:51 -0300
Subject: [Rd] .Call and Segmentation Fault
Message-ID: <973080e10508261508239dab3b@mail.gmail.com>

Hello to everyone!
I use .Call to call a C function without arguments wich calls a
fortran optimization package. My C function uses others C and Fortran
functions and it works fine when I call it from a main() in a C
program. But when I call it from R with
.Call("name_of_the_c_function"), R gives me some weird output.
This weird output is a worng answer to my optimization problem
(sometimes after thousands iteractions, what does not occur when
called from C) or a segmentation fault error. The kind of output
depends on the machine I am using. At home I got a segmentation faul,
in university I got those wrong values.
I tried a memcheck in C and Fortran binaries, but everything seems
allright except by 2 missing free() calls (wich I don`t think might be
causing this error).
I compiled my C and Fortran files with R CMD SHARED and then linked
all the .o with the same command. I also tried compiling all the
needed object files with -fPIC and -shared and then using R CMD SHARED
to link everything, but I got the same problem.
The only thing I do in R is the following:

dyn.load("mylib.so")
.Call("name_of_the_c_function")

Can someone hellp me with this?


   Thanks!


         Ricardo


From rabrantes82 at gmail.com  Sat Aug 27 00:19:05 2005
From: rabrantes82 at gmail.com (Ricardo Luiz Andrade Abrantes)
Date: Fri, 26 Aug 2005 19:19:05 -0300
Subject: [Rd] .Call and Segmentation Fault
Message-ID: <973080e10508261519699235ea@mail.gmail.com>

Hello to everyone!
I use .Call to call a C function without arguments wich calls a
fortran optimization package. My C function uses others C and Fortran
functions and it works fine when I call it from a main() in a C
program. But when I call it from R with
.Call("name_of_the_c_function"), R gives me some weird output.
This weird output is a worng answer to my optimization problem
(sometimes after thousands iteractions, what does not occur when
called from C) or a segmentation fault error. The kind of output
depends on the machine I am using. At home I got a segmentation faul,
in university I got those wrong values.
I tried a memcheck in C and Fortran binaries, but everything seems
allright except by 2 missing free() calls (wich I don`t think might be
causing this error).
I compiled my C and Fortran files with R CMD SHARED and then linked
all the .o with the same command. I also tried compiling all the
needed object files with -fPIC and -shared and then using R CMD SHARED
to link everything, but I got the same problem.
The only thing I do in R is the following:

dyn.load("mylib.so")
.Call("name_of_the_c_function")

Can someone hellp me with this?


  Thanks!


        Ricardo


From ellis at stat.harvard.edu  Sat Aug 27 00:55:06 2005
From: ellis at stat.harvard.edu (Byron Ellis)
Date: Fri, 26 Aug 2005 15:55:06 -0700
Subject: [Rd] .Call and Segmentation Fault
In-Reply-To: <973080e10508261519699235ea@mail.gmail.com>
References: <973080e10508261519699235ea@mail.gmail.com>
Message-ID: <F81375EB-3C7E-4385-ADC1-8842A449A332@stat.harvard.edu>

Are you returning a SEXP? .Call (unlike .C) expects a SEXP return  
value. It sounds like you're returning garbage and R is choking on  
that when it tries to use the address as a SEXP.

On Aug 26, 2005, at 3:19 PM, Ricardo Luiz Andrade Abrantes wrote:

> Hello to everyone!
> I use .Call to call a C function without arguments wich calls a
> fortran optimization package. My C function uses others C and Fortran
> functions and it works fine when I call it from a main() in a C
> program. But when I call it from R with
> .Call("name_of_the_c_function"), R gives me some weird output.
> This weird output is a worng answer to my optimization problem
> (sometimes after thousands iteractions, what does not occur when
> called from C) or a segmentation fault error. The kind of output
> depends on the machine I am using. At home I got a segmentation faul,
> in university I got those wrong values.
> I tried a memcheck in C and Fortran binaries, but everything seems
> allright except by 2 missing free() calls (wich I don`t think might be
> causing this error).
> I compiled my C and Fortran files with R CMD SHARED and then linked
> all the .o with the same command. I also tried compiling all the
> needed object files with -fPIC and -shared and then using R CMD SHARED
> to link everything, but I got the same problem.
> The only thing I do in R is the following:
>
> dyn.load("mylib.so")
> .Call("name_of_the_c_function")
>
> Can someone hellp me with this?
>
>
>   Thanks!
>
>
>         Ricardo
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

---
Byron Ellis (ellis at stat.harvard.edu)
"Oook" -- The Librarian


From bullard at berkeley.edu  Sat Aug 27 00:56:14 2005
From: bullard at berkeley.edu (James Bullard)
Date: Fri, 26 Aug 2005 15:56:14 -0700
Subject: [Rd] wchar and wstring.
Message-ID: <430F9E0E.9020606@berkeley.edu>

Hello all, I am writing an R interface to some C++ files which make use
of std::wstring classes for internationalization. Previously (when I
wanted to make R strings from C++ std::strings), I would do something
like this to construct a string in R from the results of the parse.

SET_VECTOR_ELT(vals, i++, mkString(header.GetHeader().c_str()));


However, now the call header.GetHeader().c_str() returns a pointer to an
array of wchar_t's. I was going to use
wcstombs() to convert the wchar_t* to char*, but I wanted to see if
there was a similar function in R for the mkString function which I had
initially used which deals with wchar_ts as opposed to chars. Also,
since I have no experience with the wctombs() function I wanted to ask
if anyone knew if this will handle the internationilzation issues from
within R.


As always thank you for the help. jim


From dhinds at sonic.net  Sat Aug 27 07:06:07 2005
From: dhinds at sonic.net (dhinds@sonic.net)
Date: Sat, 27 Aug 2005 05:06:07 +0000 (UTC)
Subject: [Rd] RFC: "loop connections"
References: <dedndn$daj$1@sea.gmane.org> <denvc0$eag$1@sea.gmane.org>
	<971536df05082614254465b8c6@mail.gmail.com>
Message-ID: <deosbv$8qa$1@sea.gmane.org>

Gabor Grothendieck <ggrothendieck at gmail.com> wrote:
> OK.  I guess you want one of the core people to respond but in the
> interim can you explain the terminology "loop"?   
> Also, do you have any prototypical applications in mind?

"loop" is short for "loopback".  A loop or loopback device is one that
just returns the data sent to it.

The prototypical applications are the same sort of applications text
connections are used for: data transformation, in this case of raw
binary data, rather than formatted text data.  In my case, I needed to
interpret a "long raw" column from an Oracle table, that consisted of
packed single precision floating point numbers.

The caTools package on CRAN includes less capable raw2bin and bin2raw
functions, used to implement Base64 encoders and decoders.

-- Dave


From ripley at stats.ox.ac.uk  Sat Aug 27 10:23:37 2005
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sat, 27 Aug 2005 09:23:37 +0100 (BST)
Subject: [Rd] RFC: "loop connections"
In-Reply-To: <deosbv$8qa$1@sea.gmane.org>
References: <dedndn$daj$1@sea.gmane.org> <denvc0$eag$1@sea.gmane.org>
	<971536df05082614254465b8c6@mail.gmail.com>
	<deosbv$8qa$1@sea.gmane.org>
Message-ID: <Pine.LNX.4.61.0508270825270.25461@gannet.stats>

On Sat, 27 Aug 2005 dhinds at sonic.net wrote:

> Gabor Grothendieck <ggrothendieck at gmail.com> wrote:
>> OK.  I guess you want one of the core people to respond but in the

One has.

>> interim can you explain the terminology "loop"?
>> Also, do you have any prototypical applications in mind?
>
> "loop" is short for "loopback".  A loop or loopback device is one that
> just returns the data sent to it.

That is definitely not what text connections do, and not what I read the 
proposal as being given the analogies to text connections.

> The prototypical applications are the same sort of applications text
> connections are used for: data transformation,

That I think is where Hinds' confusion arises.  As the posting guide asks, 
please do your homework before posting.

Text connections are from the Green Book, where they are described as

- a 'text connection' using S character strings as lines of text input

- Text connections are a convenience to make it easy to use an object
   containing character strings in a computation that expects to read
   from a connection.

They are read-only (or in R but not S, write-only).  Think for them as the 
analogues of the C functions sscanf and sprintf.  Output text connections 
are a particularly convenient way to create text labels -- see for example 
capture.output().

> in this case of raw binary data, rather than formatted text data.  In my 
> case, I needed to interpret a "long raw" column from an Oracle table, 
> that consisted of packed single precision floating point numbers.

That is exactly what read-write anonymous file() connections are designed 
for.  They too come from the Green Book.  (If efficiency were an issue, a 
short purpose-designed C routine would be the answer.  But file 
connections are already much 'smarter' than the proposed implementation of 
loop connections and do allow seeking.)

Another piece of homework might be my article in the very first R 
newsletter.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From aleszib at gmail.com  Sat Aug 27 10:27:43 2005
From: aleszib at gmail.com (Ales Ziberna)
Date: Sat, 27 Aug 2005 10:27:43 +0200
Subject: [Rd] Free-form to fixed-form Fortran
References: <012c01c5aa4b$98531ce0$598debd4@ales>
	<0FB3A270-8726-4BC3-AEEE-0A53BEF222DF@r-project.org>
Message-ID: <024b01c5aae1$339a2230$598debd4@ales>

Thank you for your reply!

I know I can use g77 with -ffree-form. However, I do not know how to make a 
package so that when others would build a package, these subrutines would 
compile with "-ffree-form". I heard of "makevars" and flags, however I read 
on the mailing list archives that they are ignored on Windows.

Ales


----- Original Message ----- 
From: "Simon Urbanek" <simon.urbanek at r-project.org>
To: "Ale? ?iberna" <ales.ziberna at guest.arnes.si>
Cc: "R Development Mailing List" <r-devel at stat.math.ethz.ch>
Sent: Friday, August 26, 2005 8:29 PM
Subject: Re: [Rd] Free-form to fixed-form Fortran


Ale?i,

On Aug 26, 2005, at 10:36 AM, Ale? ?iberna wrote:

> I have writen some subrutines in Free-form Fortran. I would like to
> includ
> them in a package, which I would like to build on WinXP. I have all
> suggested tools/programs for bulding R packages on Windows (except
> latex).
>
> What is the best way of using these subrutines? Does sombody mybe
> know any
> translation tools for converting Free-form to fixed-form Fortran?

If your only concern is to build it, you may try using g77 with -
ffree-form. This should work with GNU Fortran. However, that limits
the availability of your package to GNU compilers only.

Cheers,
?imon

______________________________________________
R-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-devel


From ripley at stats.ox.ac.uk  Sat Aug 27 10:36:12 2005
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sat, 27 Aug 2005 09:36:12 +0100 (BST)
Subject: [Rd] Free-form to fixed-form Fortran
In-Reply-To: <024b01c5aae1$339a2230$598debd4@ales>
References: <012c01c5aa4b$98531ce0$598debd4@ales>
	<0FB3A270-8726-4BC3-AEEE-0A53BEF222DF@r-project.org>
	<024b01c5aae1$339a2230$598debd4@ales>
Message-ID: <Pine.LNX.4.61.0508270930190.26377@gannet.stats>

On Sat, 27 Aug 2005, Ales Ziberna wrote:

> Thank you for your reply!
>
> I know I can use g77 with -ffree-form. However, I do not know how to make a
> package so that when others would build a package, these subrutines would
> compile with "-ffree-form". I heard of "makevars" and flags, however I read
> on the mailing list archives that they are ignored on Windows.

-ffree-form is compiler-specific: it will not work on Sun's f77 for 
example, and Sun's f95 needs -free.  The only way to make a portable 
package is to use standard code layout as described in the link at

http://developer.r-project.org/Portability.html

Whatever you heard `on the archives' is incorrect.  The correct 
information is in the R-admin manual: reading that is part of the homework 
expected before posting.

>
> Ales
>
>
> ----- Original Message -----
> From: "Simon Urbanek" <simon.urbanek at r-project.org>
> To: "Alea }iberna" <ales.ziberna at guest.arnes.si>
> Cc: "R Development Mailing List" <r-devel at stat.math.ethz.ch>
> Sent: Friday, August 26, 2005 8:29 PM
> Subject: Re: [Rd] Free-form to fixed-form Fortran
>
>
> Aleai,
>
> On Aug 26, 2005, at 10:36 AM, Alea }iberna wrote:
>
>> I have writen some subrutines in Free-form Fortran. I would like to
>> includ
>> them in a package, which I would like to build on WinXP. I have all
>> suggested tools/programs for bulding R packages on Windows (except
>> latex).
>>
>> What is the best way of using these subrutines? Does sombody mybe
>> know any
>> translation tools for converting Free-form to fixed-form Fortran?
>
> If your only concern is to build it, you may try using g77 with -
> ffree-form. This should work with GNU Fortran. However, that limits
> the availability of your package to GNU compilers only.
>
> Cheers,
> `imon
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ligges at statistik.uni-dortmund.de  Sat Aug 27 11:39:36 2005
From: ligges at statistik.uni-dortmund.de (Uwe Ligges)
Date: Sat, 27 Aug 2005 11:39:36 +0200
Subject: [Rd] Memory leakage/violation?
In-Reply-To: <Pine.A41.4.61b.0508261146090.87310@homer03.u.washington.edu>
References: <430F3B7A.5020807@maths.lth.se>
	<Pine.A41.4.61b.0508261146090.87310@homer03.u.washington.edu>
Message-ID: <431034D8.5030008@statistik.uni-dortmund.de>

Thomas Lumley wrote:
> I can't reproduce this on R2.2.0dev on Windows XP (in a few hundred 
> tries), or running under Valgrind on AMD64 Linux (in four or five tries).

Cannot reproduce either (using R-2.1.1 and an older version of R-devel, 
though). Maybe a compiler issue?
Henrik, do you use exactly the compiler set up mentioned in the manuals? 
Which version of gcc? Did your emember to replace the f771.exe?

Uwe



>  	-thomas
> 
> 
> On Fri, 26 Aug 2005, Henrik Bengtsson wrote:
> 
> 
>>Hi,
>>
>>I've spotted a possible memory leakage/violation in the latest R v2.1.1
>>patched and R v2.2.0dev on Windows XP Pro SP2 Eng.
>>
>>I first caught it deep down in a nested svd algorithm when subtracting a
>>double 'c' from a integer vector 'a' where both had finite values but
>>when assigning 'a <- a - c' would report NaNs whereas (a-c) alone would
>>not.  Different runs with the identical data would introduce NaNs at
>>random positions, but not all the time.
>>
>>Troubleshooting is after a couple of hours still at v0.5, but here is a
>>script that generates the strange behavior on the above R setups.  I let
>>the script speak for itself.  Note that both the script 'strange.R' and
>>the data 'strange.RData' is online too, see code below.
>>
>>People on other systems (but also on Windows), could you please try it
>>and see if you can reproduce what I get.
>>
>>Cheers
>>
>>Henrik
>>
>>
>># The following was tested on: Windows XP Pro SP2 Eng with
>>#   i) R Version 2.1.1 Patched (2005-08-25)
>>#  ii) R 2.2.0 Under development (unstable) (2005-08-25 r35394M)
>>
>># Start 'R --vanilla' and source() this script, i.e.
>>#  source("http://www.maths.lth.se/help/R/strange.R")
>># If you do not get any errors, retry a few times.
>>
>>foo <- function(x) {
>>  print(list(
>>    name=as.character(substitute(x)),
>>    storage.mode=storage.mode(x),
>>    na=any(is.na(x)),
>>    nan=any(is.nan(x)),
>>    inf=any(is.infinite(x)),
>>    ok=all(is.finite(a))
>>  ))
>>  print(length(x))
>>  print(summary(x))
>>}
>>
>># Load data from a complicated "non-reproducible" algorithm.
>># The below errors occur also when data is not
>># saved and then reloaded from file.  Data was generated in
>># R v2.1.1 patched (see above).
>>if (file.exists("strange.RData")) {
>>  load("strange.RData")
>>} else {
>>  load(url("http://www.maths.lth.se/help/R/strange.RData"))
>>}
>>
>># First glance at data...
>>foo(a)
>>foo(c)
>>
>>## $name
>>## [1] "a"
>>##
>>## $storage.mode
>>## [1] "integer"
>>##
>>## $na
>>## [1] FALSE
>>##
>>## $nan
>>## [1] FALSE
>>##
>>## $inf
>>## [1] FALSE
>>##
>>## $ok
>>## [1] TRUE
>>##
>>## [1] 15000
>>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.
>>##    41.0    51.0    63.0   292.2   111.0 65170.0
>>## $name
>>## [1] "c"
>>##
>>## $storage.mode
>>## [1] "double"
>>##
>>## $na
>>## [1] FALSE
>>##
>>## $nan
>>## [1] FALSE
>>##
>>## $inf
>>## [1] FALSE
>>##
>>## $ok
>>## [1] TRUE
>>##
>>## [1] 1
>>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.
>>##   53.43   53.43   53.43   53.43   53.43   53.43
>>##
>>
>># But, trying the following, will result in
>># no-reproducible error messages. Sometimes
>># it errors at kk==1, sometimes at kk >> 1.
>># Also, look at the different output for
>># different kk:s.
>>for (kk in 1:100) {
>>  cat("kk=",kk, "\n")
>>  print(summary(a-c))
>>}
>>
>>## kk= 1
>>## 	  Min.     1st Qu.      Median        Mean     3rd Qu.        Max.
>>## -7.741e+307  -2.431e+00   9.569e+00               5.757e+01
>>## kk= 2
>>## 	Min.   1st Qu.    Median      Mean   3rd Qu.      Max.
>>##   -12.430    -2.431     9.569   238.700    57.570 65120.000
>>## kk= 3
>>## 	Min.   1st Qu.    Median      Mean   3rd Qu.      Max.
>>##   -12.430    -2.431     9.569              57.570 65120.000
>>## kk= 4
>>## 	Min.   1st Qu.    Median      Mean   3rd Qu.      Max.
>>##   -12.430    -2.431     9.569   238.700    57.570 65120.000
>>## kk= 5
>>## 	Min.   1st Qu.    Median      Mean   3rd Qu.      Max.
>>##   -12.430    -2.431     9.569   238.700    57.570 65120.000
>>## kk= 6
>>## Error in quantile.default(object) : missing values and NaN's
>>## not allowed if 'na.rm' is FALSE
>>
>>
>>## Comments: If you shorten down 'a', the bug occurs less frequently.
>>
>>______________________________________________
>>R-devel at r-project.org mailing list
>>https://stat.ethz.ch/mailman/listinfo/r-devel
>>
> 
> 
> Thomas Lumley			Assoc. Professor, Biostatistics
> tlumley at u.washington.edu	University of Washington, Seattle
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From ripley at stats.ox.ac.uk  Sat Aug 27 11:50:17 2005
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sat, 27 Aug 2005 10:50:17 +0100 (BST)
Subject: [Rd] Memory leakage/violation?
In-Reply-To: <431034D8.5030008@statistik.uni-dortmund.de>
References: <430F3B7A.5020807@maths.lth.se>
	<Pine.A41.4.61b.0508261146090.87310@homer03.u.washington.edu>
	<431034D8.5030008@statistik.uni-dortmund.de>
Message-ID: <Pine.LNX.4.61.0508271046220.27340@gannet.stats>

On Sat, 27 Aug 2005, Uwe Ligges wrote:

> Thomas Lumley wrote:
>> I can't reproduce this on R2.2.0dev on Windows XP (in a few hundred
>> tries), or running under Valgrind on AMD64 Linux (in four or five tries).
>
> Cannot reproduce either (using R-2.1.1 and an older version of R-devel,
> though). Maybe a compiler issue?
> Henrik, do you use exactly the compiler set up mentioned in the manuals?
> Which version of gcc? Did your emember to replace the f771.exe?

It would be better to use gcc-3.4.4 as recommended in the current manual.
However, I read this that Henrik was using the binary from CRAN which I 
think Duncan M is now building with that.

Another possibility is a broken version of a Windows DLL, such as 
msvcrt.dll.

>
> Uwe
>
>
>
>>  	-thomas
>>
>>
>> On Fri, 26 Aug 2005, Henrik Bengtsson wrote:
>>
>>
>>> Hi,
>>>
>>> I've spotted a possible memory leakage/violation in the latest R v2.1.1
>>> patched and R v2.2.0dev on Windows XP Pro SP2 Eng.
>>>
>>> I first caught it deep down in a nested svd algorithm when subtracting a
>>> double 'c' from a integer vector 'a' where both had finite values but
>>> when assigning 'a <- a - c' would report NaNs whereas (a-c) alone would
>>> not.  Different runs with the identical data would introduce NaNs at
>>> random positions, but not all the time.
>>>
>>> Troubleshooting is after a couple of hours still at v0.5, but here is a
>>> script that generates the strange behavior on the above R setups.  I let
>>> the script speak for itself.  Note that both the script 'strange.R' and
>>> the data 'strange.RData' is online too, see code below.
>>>
>>> People on other systems (but also on Windows), could you please try it
>>> and see if you can reproduce what I get.
>>>
>>> Cheers
>>>
>>> Henrik
>>>
>>>
>>> # The following was tested on: Windows XP Pro SP2 Eng with
>>> #   i) R Version 2.1.1 Patched (2005-08-25)
>>> #  ii) R 2.2.0 Under development (unstable) (2005-08-25 r35394M)
>>>
>>> # Start 'R --vanilla' and source() this script, i.e.
>>> #  source("http://www.maths.lth.se/help/R/strange.R")
>>> # If you do not get any errors, retry a few times.
>>>
>>> foo <- function(x) {
>>>  print(list(
>>>    name=as.character(substitute(x)),
>>>    storage.mode=storage.mode(x),
>>>    na=any(is.na(x)),
>>>    nan=any(is.nan(x)),
>>>    inf=any(is.infinite(x)),
>>>    ok=all(is.finite(a))
>>>  ))
>>>  print(length(x))
>>>  print(summary(x))
>>> }
>>>
>>> # Load data from a complicated "non-reproducible" algorithm.
>>> # The below errors occur also when data is not
>>> # saved and then reloaded from file.  Data was generated in
>>> # R v2.1.1 patched (see above).
>>> if (file.exists("strange.RData")) {
>>>  load("strange.RData")
>>> } else {
>>>  load(url("http://www.maths.lth.se/help/R/strange.RData"))
>>> }
>>>
>>> # First glance at data...
>>> foo(a)
>>> foo(c)
>>>
>>> ## $name
>>> ## [1] "a"
>>> ##
>>> ## $storage.mode
>>> ## [1] "integer"
>>> ##
>>> ## $na
>>> ## [1] FALSE
>>> ##
>>> ## $nan
>>> ## [1] FALSE
>>> ##
>>> ## $inf
>>> ## [1] FALSE
>>> ##
>>> ## $ok
>>> ## [1] TRUE
>>> ##
>>> ## [1] 15000
>>> ##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.
>>> ##    41.0    51.0    63.0   292.2   111.0 65170.0
>>> ## $name
>>> ## [1] "c"
>>> ##
>>> ## $storage.mode
>>> ## [1] "double"
>>> ##
>>> ## $na
>>> ## [1] FALSE
>>> ##
>>> ## $nan
>>> ## [1] FALSE
>>> ##
>>> ## $inf
>>> ## [1] FALSE
>>> ##
>>> ## $ok
>>> ## [1] TRUE
>>> ##
>>> ## [1] 1
>>> ##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.
>>> ##   53.43   53.43   53.43   53.43   53.43   53.43
>>> ##
>>>
>>> # But, trying the following, will result in
>>> # no-reproducible error messages. Sometimes
>>> # it errors at kk==1, sometimes at kk >> 1.
>>> # Also, look at the different output for
>>> # different kk:s.
>>> for (kk in 1:100) {
>>>  cat("kk=",kk, "\n")
>>>  print(summary(a-c))
>>> }
>>>
>>> ## kk= 1
>>> ## 	  Min.     1st Qu.      Median        Mean     3rd Qu.        Max.
>>> ## -7.741e+307  -2.431e+00   9.569e+00               5.757e+01
>>> ## kk= 2
>>> ## 	Min.   1st Qu.    Median      Mean   3rd Qu.      Max.
>>> ##   -12.430    -2.431     9.569   238.700    57.570 65120.000
>>> ## kk= 3
>>> ## 	Min.   1st Qu.    Median      Mean   3rd Qu.      Max.
>>> ##   -12.430    -2.431     9.569              57.570 65120.000
>>> ## kk= 4
>>> ## 	Min.   1st Qu.    Median      Mean   3rd Qu.      Max.
>>> ##   -12.430    -2.431     9.569   238.700    57.570 65120.000
>>> ## kk= 5
>>> ## 	Min.   1st Qu.    Median      Mean   3rd Qu.      Max.
>>> ##   -12.430    -2.431     9.569   238.700    57.570 65120.000
>>> ## kk= 6
>>> ## Error in quantile.default(object) : missing values and NaN's
>>> ## not allowed if 'na.rm' is FALSE
>>>
>>>
>>> ## Comments: If you shorten down 'a', the bug occurs less frequently.
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>
>>
>> Thomas Lumley			Assoc. Professor, Biostatistics
>> tlumley at u.washington.edu	University of Washington, Seattle
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From hb at maths.lth.se  Sat Aug 27 12:09:09 2005
From: hb at maths.lth.se (Henrik Bengtsson)
Date: Sat, 27 Aug 2005 12:09:09 +0200
Subject: [Rd] Memory leakage/violation?
In-Reply-To: <431034D8.5030008@statistik.uni-dortmund.de>
References: <430F3B7A.5020807@maths.lth.se>
	<Pine.A41.4.61b.0508261146090.87310@homer03.u.washington.edu>
	<431034D8.5030008@statistik.uni-dortmund.de>
Message-ID: <43103BC5.3040909@maths.lth.se>

Thank you Thomas and Uwe for this.

This is really odd, because today I can neither reproduce it myself (I 
rebooted my computer this morning).   I try to recall what I did 
yesterday: I did _not_ reboot my machine, but I did install the latest 
binaries of R 2.1.1 and 2.2.0dev from CRAN.  I did close all R sessions 
and restarted them by R --vanilla (only one at the time) and got the 
same errors over and over for hours (trust me, I was really frustrated 
with my analysis).   Maybe a reboot would have solved it - I should know 
better and try that first!  A worse scenario is that the hardware was 
overheated or starts to fall apart.

To answer you question Uwe, I don't know about the compiler settings 
since I got the pre-build binaries from CRAN.

Best wishes

Henrik

Uwe Ligges wrote:
> Thomas Lumley wrote:
> 
>> I can't reproduce this on R2.2.0dev on Windows XP (in a few hundred 
>> tries), or running under Valgrind on AMD64 Linux (in four or five tries).
> 
> 
> Cannot reproduce either (using R-2.1.1 and an older version of R-devel, 
> though). Maybe a compiler issue?
> Henrik, do you use exactly the compiler set up mentioned in the manuals? 
> Which version of gcc? Did your emember to replace the f771.exe?
> 
> Uwe
> 
> 
> 
>>      -thomas
>>
>>
>> On Fri, 26 Aug 2005, Henrik Bengtsson wrote:
>>
>>
>>> Hi,
>>>
>>> I've spotted a possible memory leakage/violation in the latest R v2.1.1
>>> patched and R v2.2.0dev on Windows XP Pro SP2 Eng.
>>>
>>> I first caught it deep down in a nested svd algorithm when subtracting a
>>> double 'c' from a integer vector 'a' where both had finite values but
>>> when assigning 'a <- a - c' would report NaNs whereas (a-c) alone would
>>> not.  Different runs with the identical data would introduce NaNs at
>>> random positions, but not all the time.
>>>
>>> Troubleshooting is after a couple of hours still at v0.5, but here is a
>>> script that generates the strange behavior on the above R setups.  I let
>>> the script speak for itself.  Note that both the script 'strange.R' and
>>> the data 'strange.RData' is online too, see code below.
>>>
>>> People on other systems (but also on Windows), could you please try it
>>> and see if you can reproduce what I get.
>>>
>>> Cheers
>>>
>>> Henrik
>>>
>>>
>>> # The following was tested on: Windows XP Pro SP2 Eng with
>>> #   i) R Version 2.1.1 Patched (2005-08-25)
>>> #  ii) R 2.2.0 Under development (unstable) (2005-08-25 r35394M)
>>>
>>> # Start 'R --vanilla' and source() this script, i.e.
>>> #  source("http://www.maths.lth.se/help/R/strange.R")
>>> # If you do not get any errors, retry a few times.
>>>
>>> foo <- function(x) {
>>>  print(list(
>>>    name=as.character(substitute(x)),
>>>    storage.mode=storage.mode(x),
>>>    na=any(is.na(x)),
>>>    nan=any(is.nan(x)),
>>>    inf=any(is.infinite(x)),
>>>    ok=all(is.finite(a))
>>>  ))
>>>  print(length(x))
>>>  print(summary(x))
>>> }
>>>
>>> # Load data from a complicated "non-reproducible" algorithm.
>>> # The below errors occur also when data is not
>>> # saved and then reloaded from file.  Data was generated in
>>> # R v2.1.1 patched (see above).
>>> if (file.exists("strange.RData")) {
>>>  load("strange.RData")
>>> } else {
>>>  load(url("http://www.maths.lth.se/help/R/strange.RData"))
>>> }
>>>
>>> # First glance at data...
>>> foo(a)
>>> foo(c)
>>>
>>> ## $name
>>> ## [1] "a"
>>> ##
>>> ## $storage.mode
>>> ## [1] "integer"
>>> ##
>>> ## $na
>>> ## [1] FALSE
>>> ##
>>> ## $nan
>>> ## [1] FALSE
>>> ##
>>> ## $inf
>>> ## [1] FALSE
>>> ##
>>> ## $ok
>>> ## [1] TRUE
>>> ##
>>> ## [1] 15000
>>> ##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.
>>> ##    41.0    51.0    63.0   292.2   111.0 65170.0
>>> ## $name
>>> ## [1] "c"
>>> ##
>>> ## $storage.mode
>>> ## [1] "double"
>>> ##
>>> ## $na
>>> ## [1] FALSE
>>> ##
>>> ## $nan
>>> ## [1] FALSE
>>> ##
>>> ## $inf
>>> ## [1] FALSE
>>> ##
>>> ## $ok
>>> ## [1] TRUE
>>> ##
>>> ## [1] 1
>>> ##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.
>>> ##   53.43   53.43   53.43   53.43   53.43   53.43
>>> ##
>>>
>>> # But, trying the following, will result in
>>> # no-reproducible error messages. Sometimes
>>> # it errors at kk==1, sometimes at kk >> 1.
>>> # Also, look at the different output for
>>> # different kk:s.
>>> for (kk in 1:100) {
>>>  cat("kk=",kk, "\n")
>>>  print(summary(a-c))
>>> }
>>>
>>> ## kk= 1
>>> ##       Min.     1st Qu.      Median        Mean     3rd Qu.        
>>> Max.
>>> ## -7.741e+307  -2.431e+00   9.569e+00               5.757e+01
>>> ## kk= 2
>>> ##     Min.   1st Qu.    Median      Mean   3rd Qu.      Max.
>>> ##   -12.430    -2.431     9.569   238.700    57.570 65120.000
>>> ## kk= 3
>>> ##     Min.   1st Qu.    Median      Mean   3rd Qu.      Max.
>>> ##   -12.430    -2.431     9.569              57.570 65120.000
>>> ## kk= 4
>>> ##     Min.   1st Qu.    Median      Mean   3rd Qu.      Max.
>>> ##   -12.430    -2.431     9.569   238.700    57.570 65120.000
>>> ## kk= 5
>>> ##     Min.   1st Qu.    Median      Mean   3rd Qu.      Max.
>>> ##   -12.430    -2.431     9.569   238.700    57.570 65120.000
>>> ## kk= 6
>>> ## Error in quantile.default(object) : missing values and NaN's
>>> ## not allowed if 'na.rm' is FALSE
>>>
>>>
>>> ## Comments: If you shorten down 'a', the bug occurs less frequently.
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>
>>
>> Thomas Lumley            Assoc. Professor, Biostatistics
>> tlumley at u.washington.edu    University of Washington, Seattle
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 
>


From dhinds at sonic.net  Sat Aug 27 12:13:36 2005
From: dhinds at sonic.net (David Hinds)
Date: Sat, 27 Aug 2005 03:13:36 -0700
Subject: [Rd] RFC: "loop connections"
In-Reply-To: <Pine.LNX.4.61.0508270825270.25461@gannet.stats>
References: <dedndn$daj$1@sea.gmane.org> <denvc0$eag$1@sea.gmane.org>
	<971536df05082614254465b8c6@mail.gmail.com>
	<deosbv$8qa$1@sea.gmane.org>
	<Pine.LNX.4.61.0508270825270.25461@gannet.stats>
Message-ID: <20050827101336.GB10059@sonic.net>

On Sat, Aug 27, 2005 at 09:23:37AM +0100, Prof Brian Ripley wrote:
>
> >"loop" is short for "loopback".  A loop or loopback device is one that
> >just returns the data sent to it.
> 
> That is definitely not what text connections do, and not what I read the 
> proposal as being given the analogies to text connections.

Hmmm.  The distinction you are making seems to be a narrow one.  Or
maybe my analogy is lacking.  To be honest, I could care less about
the name; I wanted something short and more general than "text" but
I've apparently failed.

> - Text connections are a convenience to make it easy to use an object
>   containing character strings in a computation that expects to read
>   from a connection.

You're right, this isn't exactly the sense I was thinking of.  But a
binary analog of text connections also seems useful here, doesn't it?
Why should we be able to use objects for computations that expect text
mode connections, but not binary mode connections?  The computation I
want to use is readBin, and it expects a connection, and I want to
feed it an object instead.

> That is exactly what read-write anonymous file() connections are
> designed for.  They too come from the Green Book.  (If efficiency
> were an issue, a short purpose-designed C routine would be the
> answer.  But file connections are already much 'smarter' than the
> proposed implementation of loop connections and do allow seeking.)

Anonymous file() connections seem to be hidden temporary files and I
was trying to avoid going through temporary files just to cast between
data types.  But then I admit to not testing the relative overhead of
the two mechanisms.  I'd rather not write dedicated C routines when
readBin and writeBin already do exactly what I need.

I'm afraid you've stumped me: I thought this seemed like a clean and
orthogonal extension of the existing facility requiring minimal new
code.  If the answer is that it isn't in the Green Book, well, then
shoot, I guess you've got me there!

-- David Hinds


From maechler at stat.math.ethz.ch  Sat Aug 27 12:18:16 2005
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Sat, 27 Aug 2005 12:18:16 +0200
Subject: [Rd] RFC: "loop connections"
In-Reply-To: <dedndn$daj$1@sea.gmane.org>
References: <dedndn$daj$1@sea.gmane.org>
Message-ID: <17168.15848.291481.473231@stat.math.ethz.ch>

>>>>> "David" == David Hinds <dhinds at sonic.net>
>>>>>     on Mon, 22 Aug 2005 23:34:15 +0000 (UTC) writes:

    David> I've just implemented a generalization of R's text connections, to
    David> also support reading/writing raw binary data.  There is very little
    David> new code to speak of.  For input connections, I wrote code to populate
    David> the old text connection buffer from a raw vector, and provided a new
    David> raw_read() method.  For output connections, I wrote a raw_write() to
    David> append to a raw vector.  On input, the mode (text or binary) is
    David> determined by the data type of the input object; on output, I use the
    David> requested output mode (i.e. "w" / "wb").  For example:

    > con <- loopConnection("r", "wb")
    > a <- c(10,100,1000)
    > writeBin(a, con, size=4)
    > r
     [1] 00 00 20 41 00 00 c8 42 00 00 7a 44
    > close(con)
    > con <- loopConnection(r)
    > readBin(con, "double", n=3, size=4)
     [1]   10  100 1000
    > close(con)

    David> I think "loop connection" is a better name for this
    David> sort of connection than "text connection" was even
    David> for the old version; that confuses the mode of the
    David> connection (text vs binary) with the mechanism (file,
    David> socket, etc).

    ..........

In the mean time, I think it has become clear that
"loopconnection" isn't necessarily a better name, and that
textConnection() has been there in "the S litterature" for a
good reason and for quite a while.
Let's forget about the naming and the exact UI for the moment.

I think the main point of David's proposal is still worth
consideration:  One way to see text connections is as a way to
treat some kind of R objects as "generalized files" i.e., connections.
And AFAICS David proposes to enlarge the kind of R objects that
can be dealt with as connections 
  from  {"character"} 
  to    {"character", "raw"} 
something which has some appeal to me.
IIUC, Brian Ripley is doubting the potential use for the
proposed generalization, whereas David makes a point of someone
else (the 'caTools' author) having written raw2bin / bin2raw function
for a related use case.

Maybe you can elaborate on the above a bit, David?
In any case, as you might have guessed by now, R-core would have
been more positive to a proposal to generalize current
textConnection() - fully back-compatibly - rather than renaming
it first.

Best regards,
Martin


From hb at maths.lth.se  Sat Aug 27 12:24:07 2005
From: hb at maths.lth.se (Henrik Bengtsson)
Date: Sat, 27 Aug 2005 12:24:07 +0200
Subject: [Rd] Memory leakage/violation?
In-Reply-To: <Pine.LNX.4.61.0508271046220.27340@gannet.stats>
References: <430F3B7A.5020807@maths.lth.se>
	<Pine.A41.4.61b.0508261146090.87310@homer03.u.washington.edu>
	<431034D8.5030008@statistik.uni-dortmund.de>
	<Pine.LNX.4.61.0508271046220.27340@gannet.stats>
Message-ID: <43103F47.3000902@maths.lth.se>

Prof Brian Ripley wrote:
> On Sat, 27 Aug 2005, Uwe Ligges wrote:
> 
>> Thomas Lumley wrote:
>>
>>> I can't reproduce this on R2.2.0dev on Windows XP (in a few hundred
>>> tries), or running under Valgrind on AMD64 Linux (in four or five 
>>> tries).
>>
>>
>> Cannot reproduce either (using R-2.1.1 and an older version of R-devel,
>> though). Maybe a compiler issue?
>> Henrik, do you use exactly the compiler set up mentioned in the manuals?
>> Which version of gcc? Did your emember to replace the f771.exe?
> 
> 
> It would be better to use gcc-3.4.4 as recommended in the current manual.
> However, I read this that Henrik was using the binary from CRAN which I 
> think Duncan M is now building with that.
> 
> Another possibility is a broken version of a Windows DLL, such as 
> msvcrt.dll.

Thank you for this.

I scanned my computer for possible msvcrt.dll (Microsoft (R) C Runtime 
Library) files and found:

C:\Windows\system32\msvcrt.dll
    v7.0.2600.1106 (xpsp1.020828-1920), 323 072 bytes

C:\WINDOWS\$NtServicePackUninstall$\msvcrt.dll
    v7.0.2600.0 (xpclient.010817-1148), 322 560 bytes

(plus a few versions of the same in "temporary" directories).

As I mentioned in the email I sent recently, I cannot reproduce the 
error today after a fresh reboot (and letting the computer rest for 12 
hours).

Best

Henrik


>>
>> Uwe
>>
>>
>>
>>>      -thomas
>>>
>>>
>>> On Fri, 26 Aug 2005, Henrik Bengtsson wrote:
>>>
>>>
>>>> Hi,
>>>>
>>>> I've spotted a possible memory leakage/violation in the latest R v2.1.1
>>>> patched and R v2.2.0dev on Windows XP Pro SP2 Eng.
>>>>
>>>> I first caught it deep down in a nested svd algorithm when 
>>>> subtracting a
>>>> double 'c' from a integer vector 'a' where both had finite values but
>>>> when assigning 'a <- a - c' would report NaNs whereas (a-c) alone would
>>>> not.  Different runs with the identical data would introduce NaNs at
>>>> random positions, but not all the time.
>>>>
>>>> Troubleshooting is after a couple of hours still at v0.5, but here is a
>>>> script that generates the strange behavior on the above R setups.  I 
>>>> let
>>>> the script speak for itself.  Note that both the script 'strange.R' and
>>>> the data 'strange.RData' is online too, see code below.
>>>>
>>>> People on other systems (but also on Windows), could you please try it
>>>> and see if you can reproduce what I get.
>>>>
>>>> Cheers
>>>>
>>>> Henrik
>>>>
>>>>
>>>> # The following was tested on: Windows XP Pro SP2 Eng with
>>>> #   i) R Version 2.1.1 Patched (2005-08-25)
>>>> #  ii) R 2.2.0 Under development (unstable) (2005-08-25 r35394M)
>>>>
>>>> # Start 'R --vanilla' and source() this script, i.e.
>>>> #  source("http://www.maths.lth.se/help/R/strange.R")
>>>> # If you do not get any errors, retry a few times.
>>>>
>>>> foo <- function(x) {
>>>>  print(list(
>>>>    name=as.character(substitute(x)),
>>>>    storage.mode=storage.mode(x),
>>>>    na=any(is.na(x)),
>>>>    nan=any(is.nan(x)),
>>>>    inf=any(is.infinite(x)),
>>>>    ok=all(is.finite(a))
>>>>  ))
>>>>  print(length(x))
>>>>  print(summary(x))
>>>> }
>>>>
>>>> # Load data from a complicated "non-reproducible" algorithm.
>>>> # The below errors occur also when data is not
>>>> # saved and then reloaded from file.  Data was generated in
>>>> # R v2.1.1 patched (see above).
>>>> if (file.exists("strange.RData")) {
>>>>  load("strange.RData")
>>>> } else {
>>>>  load(url("http://www.maths.lth.se/help/R/strange.RData"))
>>>> }
>>>>
>>>> # First glance at data...
>>>> foo(a)
>>>> foo(c)
>>>>
>>>> ## $name
>>>> ## [1] "a"
>>>> ##
>>>> ## $storage.mode
>>>> ## [1] "integer"
>>>> ##
>>>> ## $na
>>>> ## [1] FALSE
>>>> ##
>>>> ## $nan
>>>> ## [1] FALSE
>>>> ##
>>>> ## $inf
>>>> ## [1] FALSE
>>>> ##
>>>> ## $ok
>>>> ## [1] TRUE
>>>> ##
>>>> ## [1] 15000
>>>> ##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.
>>>> ##    41.0    51.0    63.0   292.2   111.0 65170.0
>>>> ## $name
>>>> ## [1] "c"
>>>> ##
>>>> ## $storage.mode
>>>> ## [1] "double"
>>>> ##
>>>> ## $na
>>>> ## [1] FALSE
>>>> ##
>>>> ## $nan
>>>> ## [1] FALSE
>>>> ##
>>>> ## $inf
>>>> ## [1] FALSE
>>>> ##
>>>> ## $ok
>>>> ## [1] TRUE
>>>> ##
>>>> ## [1] 1
>>>> ##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.
>>>> ##   53.43   53.43   53.43   53.43   53.43   53.43
>>>> ##
>>>>
>>>> # But, trying the following, will result in
>>>> # no-reproducible error messages. Sometimes
>>>> # it errors at kk==1, sometimes at kk >> 1.
>>>> # Also, look at the different output for
>>>> # different kk:s.
>>>> for (kk in 1:100) {
>>>>  cat("kk=",kk, "\n")
>>>>  print(summary(a-c))
>>>> }
>>>>
>>>> ## kk= 1
>>>> ##       Min.     1st Qu.      Median        Mean     3rd Qu.        
>>>> Max.
>>>> ## -7.741e+307  -2.431e+00   9.569e+00               5.757e+01
>>>> ## kk= 2
>>>> ##     Min.   1st Qu.    Median      Mean   3rd Qu.      Max.
>>>> ##   -12.430    -2.431     9.569   238.700    57.570 65120.000
>>>> ## kk= 3
>>>> ##     Min.   1st Qu.    Median      Mean   3rd Qu.      Max.
>>>> ##   -12.430    -2.431     9.569              57.570 65120.000
>>>> ## kk= 4
>>>> ##     Min.   1st Qu.    Median      Mean   3rd Qu.      Max.
>>>> ##   -12.430    -2.431     9.569   238.700    57.570 65120.000
>>>> ## kk= 5
>>>> ##     Min.   1st Qu.    Median      Mean   3rd Qu.      Max.
>>>> ##   -12.430    -2.431     9.569   238.700    57.570 65120.000
>>>> ## kk= 6
>>>> ## Error in quantile.default(object) : missing values and NaN's
>>>> ## not allowed if 'na.rm' is FALSE
>>>>
>>>>
>>>> ## Comments: If you shorten down 'a', the bug occurs less frequently.
>>>>
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>
>>>
>>>
>>> Thomas Lumley            Assoc. Professor, Biostatistics
>>> tlumley at u.washington.edu    University of Washington, Seattle
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
>


From hb at maths.lth.se  Sat Aug 27 12:38:18 2005
From: hb at maths.lth.se (Henrik Bengtsson)
Date: Sat, 27 Aug 2005 12:38:18 +0200
Subject: [Rd] Memory leakage/violation?
In-Reply-To: <43103F47.3000902@maths.lth.se>
References: <430F3B7A.5020807@maths.lth.se>	<Pine.A41.4.61b.0508261146090.87310@homer03.u.washington.edu>	<431034D8.5030008@statistik.uni-dortmund.de>	<Pine.LNX.4.61.0508271046220.27340@gannet.stats>
	<43103F47.3000902@maths.lth.se>
Message-ID: <4310429A.1020703@maths.lth.se>

And... hopefully my final admission that I did not do my background 
research; the system I'm working with and borrowed from a colleague 
(since my own is on service) is not a Windows XP Pro _SP2_, but 
apparently _SP1_.  It's not worth troubleshooting much until I get an 
update here.  Thank you Brian for making me aware of this by mentioning 
a possible broken DLL.

Thanks you all for taking the time on this one

Henrik


Henrik Bengtsson wrote:
> Prof Brian Ripley wrote:
> 
>>On Sat, 27 Aug 2005, Uwe Ligges wrote:
>>
>>
>>>Thomas Lumley wrote:
>>>
>>>
>>>>I can't reproduce this on R2.2.0dev on Windows XP (in a few hundred
>>>>tries), or running under Valgrind on AMD64 Linux (in four or five 
>>>>tries).
>>>
>>>
>>>Cannot reproduce either (using R-2.1.1 and an older version of R-devel,
>>>though). Maybe a compiler issue?
>>>Henrik, do you use exactly the compiler set up mentioned in the manuals?
>>>Which version of gcc? Did your emember to replace the f771.exe?
>>
>>
>>It would be better to use gcc-3.4.4 as recommended in the current manual.
>>However, I read this that Henrik was using the binary from CRAN which I 
>>think Duncan M is now building with that.
>>
>>Another possibility is a broken version of a Windows DLL, such as 
>>msvcrt.dll.
> 
> 
> Thank you for this.
> 
> I scanned my computer for possible msvcrt.dll (Microsoft (R) C Runtime 
> Library) files and found:
> 
> C:\Windows\system32\msvcrt.dll
>     v7.0.2600.1106 (xpsp1.020828-1920), 323 072 bytes
> 
> C:\WINDOWS\$NtServicePackUninstall$\msvcrt.dll
>     v7.0.2600.0 (xpclient.010817-1148), 322 560 bytes
> 
> (plus a few versions of the same in "temporary" directories).
> 
> As I mentioned in the email I sent recently, I cannot reproduce the 
> error today after a fresh reboot (and letting the computer rest for 12 
> hours).
> 
> Best
> 
> Henrik
> 
> 
> 
>>>Uwe
>>>
>>>
>>>
>>>
>>>>     -thomas
>>>>
>>>>
>>>>On Fri, 26 Aug 2005, Henrik Bengtsson wrote:
>>>>
>>>>
>>>>
>>>>>Hi,
>>>>>
>>>>>I've spotted a possible memory leakage/violation in the latest R v2.1.1
>>>>>patched and R v2.2.0dev on Windows XP Pro SP2 Eng.
>>>>>
>>>>>I first caught it deep down in a nested svd algorithm when 
>>>>>subtracting a
>>>>>double 'c' from a integer vector 'a' where both had finite values but
>>>>>when assigning 'a <- a - c' would report NaNs whereas (a-c) alone would
>>>>>not.  Different runs with the identical data would introduce NaNs at
>>>>>random positions, but not all the time.
>>>>>
>>>>>Troubleshooting is after a couple of hours still at v0.5, but here is a
>>>>>script that generates the strange behavior on the above R setups.  I 
>>>>>let
>>>>>the script speak for itself.  Note that both the script 'strange.R' and
>>>>>the data 'strange.RData' is online too, see code below.
>>>>>
>>>>>People on other systems (but also on Windows), could you please try it
>>>>>and see if you can reproduce what I get.
>>>>>
>>>>>Cheers
>>>>>
>>>>>Henrik
>>>>>
>>>>>
>>>>># The following was tested on: Windows XP Pro SP2 Eng with
>>>>>#   i) R Version 2.1.1 Patched (2005-08-25)
>>>>>#  ii) R 2.2.0 Under development (unstable) (2005-08-25 r35394M)
>>>>>
>>>>># Start 'R --vanilla' and source() this script, i.e.
>>>>>#  source("http://www.maths.lth.se/help/R/strange.R")
>>>>># If you do not get any errors, retry a few times.
>>>>>
>>>>>foo <- function(x) {
>>>>> print(list(
>>>>>   name=as.character(substitute(x)),
>>>>>   storage.mode=storage.mode(x),
>>>>>   na=any(is.na(x)),
>>>>>   nan=any(is.nan(x)),
>>>>>   inf=any(is.infinite(x)),
>>>>>   ok=all(is.finite(a))
>>>>> ))
>>>>> print(length(x))
>>>>> print(summary(x))
>>>>>}
>>>>>
>>>>># Load data from a complicated "non-reproducible" algorithm.
>>>>># The below errors occur also when data is not
>>>>># saved and then reloaded from file.  Data was generated in
>>>>># R v2.1.1 patched (see above).
>>>>>if (file.exists("strange.RData")) {
>>>>> load("strange.RData")
>>>>>} else {
>>>>> load(url("http://www.maths.lth.se/help/R/strange.RData"))
>>>>>}
>>>>>
>>>>># First glance at data...
>>>>>foo(a)
>>>>>foo(c)
>>>>>
>>>>>## $name
>>>>>## [1] "a"
>>>>>##
>>>>>## $storage.mode
>>>>>## [1] "integer"
>>>>>##
>>>>>## $na
>>>>>## [1] FALSE
>>>>>##
>>>>>## $nan
>>>>>## [1] FALSE
>>>>>##
>>>>>## $inf
>>>>>## [1] FALSE
>>>>>##
>>>>>## $ok
>>>>>## [1] TRUE
>>>>>##
>>>>>## [1] 15000
>>>>>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.
>>>>>##    41.0    51.0    63.0   292.2   111.0 65170.0
>>>>>## $name
>>>>>## [1] "c"
>>>>>##
>>>>>## $storage.mode
>>>>>## [1] "double"
>>>>>##
>>>>>## $na
>>>>>## [1] FALSE
>>>>>##
>>>>>## $nan
>>>>>## [1] FALSE
>>>>>##
>>>>>## $inf
>>>>>## [1] FALSE
>>>>>##
>>>>>## $ok
>>>>>## [1] TRUE
>>>>>##
>>>>>## [1] 1
>>>>>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.
>>>>>##   53.43   53.43   53.43   53.43   53.43   53.43
>>>>>##
>>>>>
>>>>># But, trying the following, will result in
>>>>># no-reproducible error messages. Sometimes
>>>>># it errors at kk==1, sometimes at kk >> 1.
>>>>># Also, look at the different output for
>>>>># different kk:s.
>>>>>for (kk in 1:100) {
>>>>> cat("kk=",kk, "\n")
>>>>> print(summary(a-c))
>>>>>}
>>>>>
>>>>>## kk= 1
>>>>>##       Min.     1st Qu.      Median        Mean     3rd Qu.        
>>>>>Max.
>>>>>## -7.741e+307  -2.431e+00   9.569e+00               5.757e+01
>>>>>## kk= 2
>>>>>##     Min.   1st Qu.    Median      Mean   3rd Qu.      Max.
>>>>>##   -12.430    -2.431     9.569   238.700    57.570 65120.000
>>>>>## kk= 3
>>>>>##     Min.   1st Qu.    Median      Mean   3rd Qu.      Max.
>>>>>##   -12.430    -2.431     9.569              57.570 65120.000
>>>>>## kk= 4
>>>>>##     Min.   1st Qu.    Median      Mean   3rd Qu.      Max.
>>>>>##   -12.430    -2.431     9.569   238.700    57.570 65120.000
>>>>>## kk= 5
>>>>>##     Min.   1st Qu.    Median      Mean   3rd Qu.      Max.
>>>>>##   -12.430    -2.431     9.569   238.700    57.570 65120.000
>>>>>## kk= 6
>>>>>## Error in quantile.default(object) : missing values and NaN's
>>>>>## not allowed if 'na.rm' is FALSE
>>>>>
>>>>>
>>>>>## Comments: If you shorten down 'a', the bug occurs less frequently.
>>>>>
>>>>>______________________________________________
>>>>>R-devel at r-project.org mailing list
>>>>>https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>>
>>>>
>>>>
>>>>Thomas Lumley            Assoc. Professor, Biostatistics
>>>>tlumley at u.washington.edu    University of Washington, Seattle
>>>>
>>>>______________________________________________
>>>>R-devel at r-project.org mailing list
>>>>https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>>
>>>______________________________________________
>>>R-devel at r-project.org mailing list
>>>https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>>
>>
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
>


From ripley at stats.ox.ac.uk  Sat Aug 27 13:33:15 2005
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sat, 27 Aug 2005 12:33:15 +0100 (BST)
Subject: [Rd] wchar and wstring.
In-Reply-To: <430F9E0E.9020606@berkeley.edu>
References: <430F9E0E.9020606@berkeley.edu>
Message-ID: <Pine.LNX.4.61.0508271221090.2871@gannet.stats>

On Fri, 26 Aug 2005, James Bullard wrote:

> Hello all, I am writing an R interface to some C++ files which make use
> of std::wstring classes for internationalization. Previously (when I
> wanted to make R strings from C++ std::strings), I would do something
> like this to construct a string in R from the results of the parse.
>
> SET_VECTOR_ELT(vals, i++, mkString(header.GetHeader().c_str()));

That creates a list of one-element character vectors.  It would be more
usual to do

   SET_STRING_ELT(vals, i++, mkChar(header.GetHeader().c_str()));

> However, now the call header.GetHeader().c_str() returns a pointer to an 
> array of wchar_t's. I was going to use wcstombs() to convert the 
> wchar_t* to char*, but I wanted to see if there was a similar function 
> in R for the mkString function which I had initially used which deals 
> with wchar_ts as opposed to chars.

No (nor an analogue of mkChar).  R uses MBCS and not wchar_t internally 
(and Unix-alike systems do externally).  There is no wchar_t internal R 
type (a much-debated design decision at the time).

> Also, since I have no experience with the wctombs() function I wanted to 
> ask if anyone knew if this will handle the internationilzation issues 
> from within R.

Did you mean wcstombs or wctomb (if the latter, wcrtomb is preferred)?
There are tens of examples in the R sources for you to consult.

Note that not all R platforms support wchar_t, hence this code is 
surrounded by #ifdef SUPPORT_MBCS macros (exported in Rconfig.h for 
package writers).

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From berwin at maths.uwa.edu.au  Sat Aug 27 14:04:03 2005
From: berwin at maths.uwa.edu.au (Berwin A Turlach)
Date: Sat, 27 Aug 2005 20:04:03 +0800
Subject: [Rd] Writing R-extensions
Message-ID: <17168.22195.533974.55934@bossiaea.maths.uwa.edu.au>

G'day all,

After reading through "Writing R Extensions", Version 2.1.1
(2005-06-20), I thought the the following points might need
clarifications or corrections.  (I checked that these comments also
hold for "Writing R Extensions", Version 2.2.0.)

1) When I ran "package.skeleton" recently, I noticed that the
   DESCRIPTION file and an entry `type'.  This surprised me a bit
   since I did not remember reading about it in the description of the
   DESCRIPTION file.  I realised that package types are described in
   the last section of Chapter 1 of "Writing R Extensions", but would
   it be possible to add at the end of Section 1.1.1 (The
   `DESCRIPTION' file) something like:

The optional @samp{Type} field specifies the type of the package:
@pxref{Package types}.

2) The description of the `inst' subdirectory states:

        Subdirectories of @file{inst} should not interfere with those
        used by R (currently, @file{R}, @file{data}, @file{demo},
        @file{exec}, @file{libs}, @file{man}, @file{help},
        @file{html}, @file{latex}, @file{R-ex}, and @file{Meta}).

   And I wonder whether this list is incomplete.  Should not, with the
   introduction of localisation, at least @file{po} be listed too?

3) The final sentence in the section on `Registering S3 methods' is:

        Any methods for a generic defined in a package that does not
        use a name space should be exported, and the package defining
        and exporting the method should be attached to the search path
        if the methods are to be found.

   I wonder whether this should actually be:

        Any methods for a generic defined in a package that does not
        use a name space should be exported, and the package defining
        and exporting the generic should be attached to the search path
                          ^^^^^^^
        if the methods are to be found.

   Or is the implication of that sentence that if I have a package
   with a name space which defines a method for a generic defined in
   another package that does not use a name space, then this method
   is only found if my package is attached to the search path and
   mere loading of the namespace is not sufficient?

4) This could be nit-picking (or just the fact that English is not my
   native language), but the section on `Load hooks' states
 
      Packages with name spaces do not use the @code{.First.lib}
      function.  Since loading and attaching are distinct operations
      when a name space is used, separate hooks are provided for each.
      These hook functions are called @code{.onLoad} and
      @code{.onAttach}.
      
   I interpreted this as "o.k., loading and attaching are distinct
   operations, if I load a package .onLoad (and only .onLoad) is run,
   if I attach a package then .onAttach (and only .onAttach) is run".
   But the manual continues a bit further down with

      Packages are not likely to need @code{.onAttach} (except perhaps
      for a start-up banner); code to set options and load shared
      objects should be placed in a @code{.onLoad} function, or use
      made of the @code{useDynLib} directive described next.

   This seems to imply to me that the .onLoad is executed also if I
   attach a package.  So should may understanding rather be "attaching
   a package implies loading it and, hence, if I attach a package,
   then .onLoad and .onAttach are both run (with .onLoad presumably
   run first?)"?

Cheers,

        Berwin


From ripley at stats.ox.ac.uk  Sat Aug 27 14:55:27 2005
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sat, 27 Aug 2005 13:55:27 +0100 (BST)
Subject: [Rd] Writing R-extensions
In-Reply-To: <17168.22195.533974.55934@bossiaea.maths.uwa.edu.au>
References: <17168.22195.533974.55934@bossiaea.maths.uwa.edu.au>
Message-ID: <Pine.LNX.4.61.0508271350370.3861@gannet.stats>

On Sat, 27 Aug 2005, Berwin A Turlach wrote:

> G'day all,
>
> After reading through "Writing R Extensions", Version 2.1.1
> (2005-06-20), I thought the the following points might need
> clarifications or corrections.  (I checked that these comments also
> hold for "Writing R Extensions", Version 2.2.0.)

[...]

> 2) The description of the `inst' subdirectory states:
>
>        Subdirectories of @file{inst} should not interfere with those
>        used by R (currently, @file{R}, @file{data}, @file{demo},
>        @file{exec}, @file{libs}, @file{man}, @file{help},
>        @file{html}, @file{latex}, @file{R-ex}, and @file{Meta}).
>
>   And I wonder whether this list is incomplete.  Should not, with the
>   introduction of localisation, at least @file{po} be listed too?

Nope.  po is not copied across, and inst _is_ used to install message 
catalogues.  So inst/po is quite to be expected.  (The difference is that 
po contains sources of translations, and inst/po contains compiled 
translations.  The naming is a bit different too (we didn't invent this).)

Probably chtml should be added to cater for Windows which (optionally) 
uses it.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From berwin at maths.uwa.edu.au  Sat Aug 27 16:10:28 2005
From: berwin at maths.uwa.edu.au (berwin@maths.uwa.edu.au)
Date: Sat, 27 Aug 2005 16:10:28 +0200 (CEST)
Subject: [Rd] bug in L-BFGS-B? (PR#8099)
Message-ID: <20050827141028.DCE0218B9F@slim.kubism.ku.dk>


--WWm7B+u2U4
Content-Type: text/plain; charset=us-ascii
Content-Description: message body text
Content-Transfer-Encoding: 7bit

G'day all,

I believe that this is related to PR#1717 (filed under
not-reproducible) which was reported for a version of R that is a
quite a bit older than the ones used in for this report.  But I
noticed this behaviour under R 2.1.1 and R 2.2.0 on my linux box and
under R 2.0.1 and R 2.1.1 on my Windows box.

I recently ran the examples for fitdistr in the MASS library and on my
linux machine I get the following results:

> library(MASS)
>      set.seed(123)
>      x <- rgamma(100, shape = 5, rate = 0.1)
>      fitdistr(x, "gamma")
     shape         rate   
  6.45947303   0.13593172 
 (0.89052006) (0.01948648)
>      fitdistr(x, dgamma, list(shape = 1, rate = 0.1), lower = 0.01)
      shape         rate    
  2.156761461   0.010000000 
 (0.277607887) (0.001433778)

I find the second result quite extraordinary.  O.k., the likelihood
that is maximised is quite flat along a certain direction, but I don't
think that it is so flat that it should fool the underlying
optimisation routine into believing that it has converged.

Moreover:

>      fitdistr(x, dgamma, list(shape = 1, rate = 0.1), lower = 0.001)
     shape         rate   
  6.48686551   0.13651012 
 (0.89438949) (0.01956818)

As far as I can tell, the problem is with L-BFGS-B hitting the lower
bound and stopping, the same problem as reported in #1717.

I tried the same comments on my Windows box and the result is as
attached below (together with the system information that bug.report
produces on that machine).  Looking at the output given on the Windows
machine, I am actually amazed that my Linux box didn't give me any of
those warning messages --- the R input/output given above is cut and
paste.  I am not aware of any fiddling with ptions regarding warning
messages by any configurations files anywhere on my linux system; and I
ran the same commands using `R --vanilla' on the linux box and did not
get any warning messages.

Cheers,

        Berwin


--WWm7B+u2U4
Content-Type: text/plain
Content-Description: Manifestation of bug on a Windows machine
Content-Disposition: inline;
	filename="Bug.txt"
Content-Transfer-Encoding: 7bit

> set.seed(123)
>      x <- rgamma(100, shape = 5, rate = 0.1)
>      fitdistr(x, "gamma")
     shape         rate   
  6.48592894   0.13649147 
 (0.89425721) (0.01956555)
Warning messages:
1: NaNs produced in: dgamma(x, shape, scale, log) 
2: NaNs produced in: dgamma(x, shape, scale, log) 
3: NaNs produced in: dgamma(x, shape, scale, log) 
>      fitdistr(x, dgamma, list(shape = 1, rate = 0.1), lower = 0.01)
      shape         rate    
  2.156761461   0.010000000 
 (0.277607888) (0.001433778)
Warning message:
bounds can only be used with method L-BFGS-B in: optim(start, mylogfn, x = x, hessian = TRUE, ...) 
>      fitdistr(x, dgamma, list(shape = 1, rate = 0.1), lower = 0.001)
     shape         rate   
  6.48686551   0.13651012 
 (0.89438949) (0.01956818)
Warning message:
bounds can only be used with method L-BFGS-B in: optim(start, mylogfn, x = x, hessian = TRUE, ...) 

--please do not edit the information below--

Version:
 platform = i386-pc-mingw32
 arch = i386
 os = mingw32
 system = i386, mingw32
 status = 
 major = 2
 minor = 1.1
 year = 2005
 month = 06
 day = 20
 language = R

Windows XP Professional (build 2600) Service Pack 2.0

Locale:
LC_COLLATE=English_Australia.1252;LC_CTYPE=English_Australia.1252;LC_MONETARY=English_Australia.1252;LC_NUMERIC=C;LC_TIME=English_Australia.1252

Search Path:
 .GlobalEnv, package:MASS, package:methods, package:stats, package:graphics, package:grDevices, package:utils, package:datasets, Autoloads, package:base

--WWm7B+u2U4
Content-Type: text/plain; charset=us-ascii
Content-Description: message body text
Content-Transfer-Encoding: 7bit


--please do not edit the information below--

Version:
 platform = i686-pc-linux-gnu
 arch = i686
 os = linux-gnu
 system = i686, linux-gnu
 status = Under development (unstable)
 major = 2
 minor = 2.0
 year = 2005
 month = 08
 day = 26
 svn rev = 35424
 language = R

Locale:
C

Search Path:
 .GlobalEnv, package:methods, package:stats, package:graphics, package:grDevices, package:utils, package:datasets, Autoloads, package:base

--WWm7B+u2U4--


From ripley at stats.ox.ac.uk  Sat Aug 27 16:23:24 2005
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sat, 27 Aug 2005 15:23:24 +0100 (BST)
Subject: [Rd] Writing R-extensions
In-Reply-To: <17168.22195.533974.55934@bossiaea.maths.uwa.edu.au>
References: <17168.22195.533974.55934@bossiaea.maths.uwa.edu.au>
Message-ID: <Pine.LNX.4.61.0508271504001.4656@gannet.stats>

On Sat, 27 Aug 2005, Berwin A Turlach wrote:

> G'day all,
>
> After reading through "Writing R Extensions", Version 2.1.1
> (2005-06-20), I thought the the following points might need
> clarifications or corrections.  (I checked that these comments also
> hold for "Writing R Extensions", Version 2.2.0.)
>
> 1) When I ran "package.skeleton" recently, I noticed that the
>   DESCRIPTION file and an entry `type'.  This surprised me a bit
>   since I did not remember reading about it in the description of the
>   DESCRIPTION file.  I realised that package types are described in
>   the last section of Chapter 1 of "Writing R Extensions", but would
>   it be possible to add at the end of Section 1.1.1 (The
>   `DESCRIPTION' file) something like:
>
> The optional @samp{Type} field specifies the type of the package:
> @pxref{Package types}.

Added.  Note that section 1.1.1 is not exhaustive: other fields are 
allowed.

> 3) The final sentence in the section on `Registering S3 methods' is:
>
>        Any methods for a generic defined in a package that does not
>        use a name space should be exported, and the package defining
>        and exporting the method should be attached to the search path
>        if the methods are to be found.
>
>   I wonder whether this should actually be:
>
>        Any methods for a generic defined in a package that does not
>        use a name space should be exported, and the package defining
>        and exporting the generic should be attached to the search path
>                          ^^^^^^^
>        if the methods are to be found.
>
>   Or is the implication of that sentence that if I have a package
>   with a name space which defines a method for a generic defined in
>   another package that does not use a name space, then this method
>   is only found if my package is attached to the search path and
>   mere loading of the namespace is not sufficient?

I think we need to check with the author (Luke, r23430).  If the generic 
is not visible there is no dispatch and so this would be irrelevant. 
Assuming a typo, your implication is what the svn log entry says and how I 
read the text.

r23430 | luke | 2003-03-02 18:52:13 +0000 (Sun, 02 Mar 2003) | 3 lines

Added wording to clarify that S3method registration should only be used if
the generic is defined in a work space.
                             name?


> 4) This could be nit-picking (or just the fact that English is not my
>   native language), but the section on `Load hooks' states
>
>      Packages with name spaces do not use the @code{.First.lib}
>      function.  Since loading and attaching are distinct operations
>      when a name space is used, separate hooks are provided for each.
>      These hook functions are called @code{.onLoad} and
>      @code{.onAttach}.
>
>   I interpreted this as "o.k., loading and attaching are distinct
>   operations, if I load a package .onLoad (and only .onLoad) is run,
>   if I attach a package then .onAttach (and only .onAttach) is run".
>   But the manual continues a bit further down with
>
>      Packages are not likely to need @code{.onAttach} (except perhaps
>      for a start-up banner); code to set options and load shared
>      objects should be placed in a @code{.onLoad} function, or use
>      made of the @code{useDynLib} directive described next.
>
>   This seems to imply to me that the .onLoad is executed also if I
>   attach a package.  So should may understanding rather be "attaching
>   a package implies loading it and, hence, if I attach a package,
>   then .onLoad and .onAttach are both run (with .onLoad presumably
>   run first?)"?

Yes.  But not quite the whole story.  You cannot attach a package without 
loading the namespace, and so .onLoad is run when the namespace is loaded.
Possibly some time later the package can be attached and then .onAttach is 
run.

That section is about how to write load hooks: it is not intended to be a 
tutorial on namespaces.  But earlier we do have

   Like other packages, packages with name spaces are loaded and attached
   to the search path by calling @code{library}.

and library() is the only way to attach package with a name space.  (In 
case anyone thinks differently, require() etc all call library.)

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Sat Aug 27 16:36:16 2005
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sat, 27 Aug 2005 15:36:16 +0100 (BST)
Subject: [Rd] bug in L-BFGS-B? (PR#8099)
In-Reply-To: <20050827141028.DCE0218B9F@slim.kubism.ku.dk>
References: <20050827141028.DCE0218B9F@slim.kubism.ku.dk>
Message-ID: <Pine.LNX.4.61.0508271525290.4656@gannet.stats>

Check your versions of MASS.  The Windows one appears to be an outdated 
version, and does different things.

As for the problem, yes it probably is a bug in L-BFGS-B.  Fancy debugging 
the code?

On Sat, 27 Aug 2005 berwin at maths.uwa.edu.au wrote:

>
> --WWm7B+u2U4
> Content-Type: text/plain; charset=us-ascii
> Content-Description: message body text
> Content-Transfer-Encoding: 7bit
>
> G'day all,
>
> I believe that this is related to PR#1717 (filed under
> not-reproducible) which was reported for a version of R that is a
> quite a bit older than the ones used in for this report.  But I
> noticed this behaviour under R 2.1.1 and R 2.2.0 on my linux box and
> under R 2.0.1 and R 2.1.1 on my Windows box.
>
> I recently ran the examples for fitdistr in the MASS library and on my
> linux machine I get the following results:
>
>> library(MASS)
>>      set.seed(123)
>>      x <- rgamma(100, shape = 5, rate = 0.1)
>>      fitdistr(x, "gamma")
>     shape         rate
>  6.45947303   0.13593172
> (0.89052006) (0.01948648)
>>      fitdistr(x, dgamma, list(shape = 1, rate = 0.1), lower = 0.01)
>      shape         rate
>  2.156761461   0.010000000
> (0.277607887) (0.001433778)
>
> I find the second result quite extraordinary.  O.k., the likelihood
> that is maximised is quite flat along a certain direction, but I don't
> think that it is so flat that it should fool the underlying
> optimisation routine into believing that it has converged.
>
> Moreover:
>
>>      fitdistr(x, dgamma, list(shape = 1, rate = 0.1), lower = 0.001)
>     shape         rate
>  6.48686551   0.13651012
> (0.89438949) (0.01956818)
>
> As far as I can tell, the problem is with L-BFGS-B hitting the lower
> bound and stopping, the same problem as reported in #1717.
>
> I tried the same comments on my Windows box and the result is as
> attached below (together with the system information that bug.report
> produces on that machine).  Looking at the output given on the Windows
> machine, I am actually amazed that my Linux box didn't give me any of
> those warning messages --- the R input/output given above is cut and
> paste.  I am not aware of any fiddling with ptions regarding warning
> messages by any configurations files anywhere on my linux system; and I
> ran the same commands using `R --vanilla' on the linux box and did not
> get any warning messages.
>
> Cheers,
>
>        Berwin
>
>
> --WWm7B+u2U4
> Content-Type: text/plain
> Content-Description: Manifestation of bug on a Windows machine
> Content-Disposition: inline;
> 	filename="Bug.txt"
> Content-Transfer-Encoding: 7bit
>
>> set.seed(123)
>>      x <- rgamma(100, shape = 5, rate = 0.1)
>>      fitdistr(x, "gamma")
>     shape         rate
>  6.48592894   0.13649147
> (0.89425721) (0.01956555)
> Warning messages:
> 1: NaNs produced in: dgamma(x, shape, scale, log)
> 2: NaNs produced in: dgamma(x, shape, scale, log)
> 3: NaNs produced in: dgamma(x, shape, scale, log)
>>      fitdistr(x, dgamma, list(shape = 1, rate = 0.1), lower = 0.01)
>      shape         rate
>  2.156761461   0.010000000
> (0.277607888) (0.001433778)
> Warning message:
> bounds can only be used with method L-BFGS-B in: optim(start, mylogfn, x = x, hessian = TRUE, ...)
>>      fitdistr(x, dgamma, list(shape = 1, rate = 0.1), lower = 0.001)
>     shape         rate
>  6.48686551   0.13651012
> (0.89438949) (0.01956818)
> Warning message:
> bounds can only be used with method L-BFGS-B in: optim(start, mylogfn, x = x, hessian = TRUE, ...)
>
> --please do not edit the information below--
>
> Version:
> platform = i386-pc-mingw32
> arch = i386
> os = mingw32
> system = i386, mingw32
> status =
> major = 2
> minor = 1.1
> year = 2005
> month = 06
> day = 20
> language = R
>
> Windows XP Professional (build 2600) Service Pack 2.0
>
> Locale:
> LC_COLLATE=English_Australia.1252;LC_CTYPE=English_Australia.1252;LC_MONETARY=English_Australia.1252;LC_NUMERIC=C;LC_TIME=English_Australia.1252
>
> Search Path:
> .GlobalEnv, package:MASS, package:methods, package:stats, package:graphics, package:grDevices, package:utils, package:datasets, Autoloads, package:base
>
> --WWm7B+u2U4
> Content-Type: text/plain; charset=us-ascii
> Content-Description: message body text
> Content-Transfer-Encoding: 7bit
>
>
> --please do not edit the information below--
>
> Version:
> platform = i686-pc-linux-gnu
> arch = i686
> os = linux-gnu
> system = i686, linux-gnu
> status = Under development (unstable)
> major = 2
> minor = 2.0
> year = 2005
> month = 08
> day = 26
> svn rev = 35424
> language = R
>
> Locale:
> C
>
> Search Path:
> .GlobalEnv, package:methods, package:stats, package:graphics, package:grDevices, package:utils, package:datasets, Autoloads, package:base
>
> --WWm7B+u2U4--
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From p.dalgaard at biostat.ku.dk  Sat Aug 27 19:14:48 2005
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: 27 Aug 2005 19:14:48 +0200
Subject: [Rd] bug in L-BFGS-B? (PR#8099)
In-Reply-To: <Pine.LNX.4.61.0508271525290.4656@gannet.stats>
References: <20050827141028.DCE0218B9F@slim.kubism.ku.dk>
	<Pine.LNX.4.61.0508271525290.4656@gannet.stats>
Message-ID: <x27je7uws7.fsf@turmalin.kubism.ku.dk>

Prof Brian Ripley <ripley at stats.ox.ac.uk> writes:

> Check your versions of MASS.  The Windows one appears to be an outdated 
> version, and does different things.

Forgetting to run tools/rsync-recommended during build will do that
sort of thing to you, but it would seem that Berwin used a binary
download. But of course he might be picking up an older version of the
package from a private library.
 
> As for the problem, yes it probably is a bug in L-BFGS-B.  Fancy debugging 
> the code?

B. might just be capable of it, but this is certainly some of the more
impenetrable code in R. While he (or anyone else) is in there, there
seems to be another problem in that the Hessian calculations refuse to
stay within the bounds (which is pretty annoying when the objective
function is undefined outside of them). Try for instance

f <- function(p) sum(ifelse(p>=-1e-4,p,Inf)^2)
optim(f, lower=c(0,0), par=c(5,5), method="L-BFGS-B")
optim(f, lower=c(0,0), par=c(5,5), method="L-BFGS-B", hess=T)


-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From ripley at stats.ox.ac.uk  Sat Aug 27 19:19:32 2005
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sat, 27 Aug 2005 18:19:32 +0100 (BST)
Subject: [Rd] bug in L-BFGS-B? (PR#8099)
In-Reply-To: <x27je7uws7.fsf@turmalin.kubism.ku.dk>
References: <20050827141028.DCE0218B9F@slim.kubism.ku.dk>
	<Pine.LNX.4.61.0508271525290.4656@gannet.stats>
	<x27je7uws7.fsf@turmalin.kubism.ku.dk>
Message-ID: <Pine.LNX.4.61.0508271816110.6706@gannet.stats>

On Sat, 27 Aug 2005, Peter Dalgaard wrote:

> Prof Brian Ripley <ripley at stats.ox.ac.uk> writes:
>
>> Check your versions of MASS.  The Windows one appears to be an outdated
>> version, and does different things.
>
> Forgetting to run tools/rsync-recommended during build will do that
> sort of thing to you, but it would seem that Berwin used a binary
> download. But of course he might be picking up an older version of the
> package from a private library.

I think it is a case of the version released with 2.1.0 vs an update 
(possibly one post 2.1.1).

>> As for the problem, yes it probably is a bug in L-BFGS-B.  Fancy debugging
>> the code?
>
> B. might just be capable of it, but this is certainly some of the more
> impenetrable code in R. While he (or anyone else) is in there, there
> seems to be another problem in that the Hessian calculations refuse to
> stay within the bounds (which is pretty annoying when the objective
> function is undefined outside of them). Try for instance
>
> f <- function(p) sum(ifelse(p>=-1e-4,p,Inf)^2)
> optim(f, lower=c(0,0), par=c(5,5), method="L-BFGS-B")
> optim(f, lower=c(0,0), par=c(5,5), method="L-BFGS-B", hess=T)

I think you will find that is as documented: see the return value stated.
Could be fixed though.


From dhinds at sonic.net  Sat Aug 27 22:11:57 2005
From: dhinds at sonic.net (dhinds@sonic.net)
Date: Sat, 27 Aug 2005 20:11:57 +0000 (UTC)
Subject: [Rd] RFC: "loop connections"
References: <dedndn$daj$1@sea.gmane.org>
	<17168.15848.291481.473231@stat.math.ethz.ch>
Message-ID: <deqhed$u28$1@sea.gmane.org>

Martin Maechler <maechler at stat.math.ethz.ch> wrote:

> In the mean time, I think it has become clear that
> "loopconnection" isn't necessarily a better name, and that
> textConnection() has been there in "the S litterature" for a
> good reason and for quite a while.
> Let's forget about the naming and the exact UI for the moment.

That is entirely fine with me.

> I think the main point of David's proposal is still worth
> consideration:  One way to see text connections is as a way to
> treat some kind of R objects as "generalized files" i.e., connections.
> And AFAICS David proposes to enlarge the kind of R objects that
> can be dealt with as connections 
>   from  {"character"} 
>   to    {"character", "raw"} 
> something which has some appeal to me.
> IIUC, Brian Ripley is doubting the potential use for the
> proposed generalization, whereas David makes a point of someone
> else (the 'caTools' author) having written raw2bin / bin2raw function
> for a related use case.

> Maybe you can elaborate on the above a bit, David?

I'm not sure what more can be said on the subject.  Most connection
types support both text-mode and binary-mode, so this is partly a
proposal for symmetry and consistency.  Prof. Ripley is correct that
binary anonymous connections provide overlapping functionality, but
the semantics are slightly different, and performance is different.  I
don't see an advantage for having the "text-like" connection only
support text access.

I ran some quick benchmarks on three implementations, where the task
was conversion back and forth between a numeric vector of length 1000,
and a packed raw vector of single precision floats, repeated 1000
times.  The first method uses a new anonymous connection for each
transformation.  The second reuses a single anonymous connection.  The
third uses a new raw textConnection for each transformation.

  usr  sys  elapsed
  1.5  9.5   14.6    anonymous
  1.1  0.1    1.2    persistent
  0.9  0.0    0.9    raw

Setting up and tearing down anonymous connections is very slow (at
least on Windows) because it requires substantial OS intervention.  If
a program can be easily organized so that a single connection can be
used, performance is much better.

I would appreciate feedback on how to improve raw_write() for the case
of appending to an existing vector.  Is it possible to reserve free
space at the end of a vector for appending?  I see that there is a
distinction between LENGTH() and TRUELENGTH() but I'm not sure if this
is the intended use.

> In any case, as you might have guessed by now, R-core would have
> been more positive to a proposal to generalize current
> textConnection() - fully back-compatibly - rather than renaming
> it first.

I have no interest in sacrificing back compatibility; I did intend
that there would always be a textConnection() entry point, if only as
a wrapper for the new constructor.  The only reason for a new name
(and I'm certainly open to suggestions) is because the notion of a
binary or raw textConnection seemed wrong.

-- David Hinds


From ggrothendieck at gmail.com  Sun Aug 28 01:38:29 2005
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sat, 27 Aug 2005 19:38:29 -0400
Subject: [Rd] RFC: "loop connections"
In-Reply-To: <deqhed$u28$1@sea.gmane.org>
References: <dedndn$daj$1@sea.gmane.org>
	<17168.15848.291481.473231@stat.math.ethz.ch>
	<deqhed$u28$1@sea.gmane.org>
Message-ID: <971536df0508271638166beecd@mail.gmail.com>

This may not be entirely on the mark in terms of relevancy but
just in case there is some relevancy I wanted to bring it up.

Just to be concrete, suppose one wants to run the following as 
a concurrent process to R.  (What is does is it implicitly sets x
to zero and then for each line of stdin it adds the first field
of the input to x and prints that to stdout unless the first field is "exit"
in which case it exits.  gawk has an implicit read/process loop
so one does not have to specify the read step.  The fflush()
command just makes sure that output is emitted, rather than
buffered, as it is produced.)

   gawk -f myexample.awk

where myexample.awk contains the single line:

   { if ($1 == "exit") exit else { x += $1; print x; fflush() } }

This has nothing to do with raw data but is prototypical of many
possible situations where one is controlling a remote program
from R and is sending input to it and getting back output with
memory/persistance.

This example is actually the same as
   system("gawk -f myexample.awk", intern = TRUE)
except that it also has memory/persistance whereas the system
call starts up a new instance of gawk each time its called and
so would always start out with x=0 each time rather than
the accumulated sum of past values.

I have not used fifos which I assume could handle this problem
(since they are not yet provided in the Windows version of R which
is what I use) but I was wondering if the application overlaps in any 
way with what is being discussed here.  In particular it would be nice 
to have a read/write "connection" that one writes to in order to provide 
the next line to the gawk process and reads from to get the answer.


From rabrantes82 at gmail.com  Sun Aug 28 04:24:08 2005
From: rabrantes82 at gmail.com (Ricardo Luiz Andrade Abrantes)
Date: Sat, 27 Aug 2005 23:24:08 -0300
Subject: [Rd] .Call and Segmentation Fault
In-Reply-To: <F81375EB-3C7E-4385-ADC1-8842A449A332@stat.harvard.edu>
References: <973080e10508261519699235ea@mail.gmail.com>
	<F81375EB-3C7E-4385-ADC1-8842A449A332@stat.harvard.edu>
Message-ID: <973080e10508271924266ea3bf@mail.gmail.com>

Hi!
Yes, I am returning a SEXP from the functions called from R, and the
problem occurs before (thousands of iterations before) the return
point.
In fact I runned valgrind into R and when I call ".Call(...) " I got
many errors like:
==4324== Use of uninitialised value of size 8
==4324==    at 0x1CB0766D: tnls_ (gencan.f:4101)
==4324==    by 0x1CB01962: gencan_ (gencan.f:1876)
==4324==    by 0x1CAFECA5: easygencan_ (gencan.f:440)
==4324==    by 0x1CB0B47D: algencan_ (algencan.f:517)
==4324==    by 0x1CB09E74: easyalgencan_ (algencan.f:76)
==4324==    by 0x1CAFE5B3: main (algencanma.c:808)
what does not happens when I compile the algencanma as a regular
program (not a library) and run it from shell. Valgrind does not find
anything wrong when I run the program directly, except 2 missing
free() calls.
Do you have any ideas where the problem lies (R .Call function or C program)?
By the way I am using a debian linux with kernel 2.6.


  Thanks


        Ricardo



On 8/26/05, Byron Ellis <ellis at stat.harvard.edu> wrote:
> Are you returning a SEXP? .Call (unlike .C) expects a SEXP return
> value. It sounds like you're returning garbage and R is choking on
> that when it tries to use the address as a SEXP.
> 
> On Aug 26, 2005, at 3:19 PM, Ricardo Luiz Andrade Abrantes wrote:
> 
> > Hello to everyone!
> > I use .Call to call a C function without arguments wich calls a
> > fortran optimization package. My C function uses others C and Fortran
> > functions and it works fine when I call it from a main() in a C
> > program. But when I call it from R with
> > .Call("name_of_the_c_function"), R gives me some weird output.
> > This weird output is a worng answer to my optimization problem
> > (sometimes after thousands iteractions, what does not occur when
> > called from C) or a segmentation fault error. The kind of output
> > depends on the machine I am using. At home I got a segmentation faul,
> > in university I got those wrong values.
> > I tried a memcheck in C and Fortran binaries, but everything seems
> > allright except by 2 missing free() calls (wich I don`t think might be
> > causing this error).
> > I compiled my C and Fortran files with R CMD SHARED and then linked
> > all the .o with the same command. I also tried compiling all the
> > needed object files with -fPIC and -shared and then using R CMD SHARED
> > to link everything, but I got the same problem.
> > The only thing I do in R is the following:
> >
> > dyn.load("mylib.so")
> > .Call("name_of_the_c_function")
> >
> > Can someone hellp me with this?
> >
> >
> >   Thanks!
> >
> >
> >         Ricardo
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >
> 
> ---
> Byron Ellis (ellis at stat.harvard.edu)
> "Oook" -- The Librarian
> 
>


From ripley at stats.ox.ac.uk  Sun Aug 28 08:20:44 2005
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sun, 28 Aug 2005 07:20:44 +0100 (BST)
Subject: [Rd] .Call and Segmentation Fault
In-Reply-To: <973080e10508271924266ea3bf@mail.gmail.com>
References: <973080e10508261519699235ea@mail.gmail.com>
	<F81375EB-3C7E-4385-ADC1-8842A449A332@stat.harvard.edu>
	<973080e10508271924266ea3bf@mail.gmail.com>
Message-ID: <Pine.LNX.4.61.0508280718090.3599@gannet.stats>

On Sat, 27 Aug 2005, Ricardo Luiz Andrade Abrantes wrote:

> Hi!
> Yes, I am returning a SEXP from the functions called from R, and the
> problem occurs before (thousands of iterations before) the return
> point.
> In fact I runned valgrind into R and when I call ".Call(...) " I got
> many errors like:
> ==4324== Use of uninitialised value of size 8
> ==4324==    at 0x1CB0766D: tnls_ (gencan.f:4101)
> ==4324==    by 0x1CB01962: gencan_ (gencan.f:1876)
> ==4324==    by 0x1CAFECA5: easygencan_ (gencan.f:440)
> ==4324==    by 0x1CB0B47D: algencan_ (algencan.f:517)
> ==4324==    by 0x1CB09E74: easyalgencan_ (algencan.f:76)
> ==4324==    by 0x1CAFE5B3: main (algencanma.c:808)
> what does not happens when I compile the algencanma as a regular
> program (not a library) and run it from shell. Valgrind does not find
> anything wrong when I run the program directly, except 2 missing
> free() calls.
> Do you have any ideas where the problem lies (R .Call function or C program)?

It cannot be .Call: your .Call passed no parameters so there was nothing 
to be uninitialized.  I did ask you why you were doing that.

.Call is very heavily tested in lots of R applications, so the prior 
probability of innocence must be very high.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From berwin at maths.uwa.edu.au  Sun Aug 28 13:16:06 2005
From: berwin at maths.uwa.edu.au (Berwin A Turlach)
Date: Sun, 28 Aug 2005 19:16:06 +0800
Subject: [Rd] robustness of install.packages/update.packages (was Re: bug in
	L-BFGS-B? (PR#8099))
In-Reply-To: <Pine.LNX.4.61.0508271525290.4656@gannet.stats>
References: <20050827141028.DCE0218B9F@slim.kubism.ku.dk>
	<Pine.LNX.4.61.0508271525290.4656@gannet.stats>
Message-ID: <17169.40182.935036.246380@bossiaea.maths.uwa.edu.au>

G'day Brian,

I am splitting my reply to your e-mail into two since there are two
separate spinoffs.

>>>>> "BDR" == Prof Brian Ripley <ripley at stats.ox.ac.uk> writes:

    BDR> Check your versions of MASS.  The Windows one appears to be
    BDR> an outdated version, and does different things.
Thanks, yes, this is the problem.  On my linux box, I compile things
from source and had the latest version of MASS (7.2-19) installed
under R 2.1.1 and R 2.2.0.

Since I hardly ever work under Windows, I rely for my Windows box on
the precompiled versions provided from CRAN and do not compile R or
packages from source.  (Though I have it set up so that I can compile
my own packages.)  Actually, I only installed R 2.1.1 on that machine
(which has an AMD processor) yesterday and it was using MASS version
7.2-16.  Running `update.packages' today, updated MASS to version
7.2-18.  And, lo and behold, there are no more warning messages, even
more, running the example in `fitdistr' now returns:

> set.seed(123)
> x <- rgamma(100, shape = 5, rate = 0.1)
> fitdistr(x, "gamma")
     shape         rate   
  6.45947303   0.13593172 
 (0.89052006) (0.01948648)
> ## now do this directly with more control.
> fitdistr(x, dgamma, list(shape = 1, rate = 0.1), lower = 0.01)
     shape         rate   
  6.48714685   0.13651706 
 (0.89442924) (0.01956916)

So it was perhaps lucky that I did not run update.packages yesterday,
since I would have expected that (like PR#1717) my bug report would be
filed under not-reproducible. :-)

But this made me curious, and I fired my laptop (which has an Intel
chip) up under Windows (usually it runs under Linux) and installed R
2.1.1 on it.  On that Windows machine, I get the same answers as those
reported yesterday under both MASS 7.2-16 and 7.2-18.  Thus, I am a
bit baffled.  Well, I just went back to the AMD box and re-run the
code, now it gives me again the "nonsense" answer in the second case.
There is definitely something wrong in the L-BFGS-B routine, which
will be hard to find.

Regarding the changed subject line:

After installing R 2.1.1 on my laptop, I executed an R source file
which, essentially, only contains an install.packages command with the
list of contributed packages that I like to have installed.  One of
this packages is DAAG and it seems that overnight the file
DAAG_0.58.zip disappeared from
        http://mirror.aarnet.edu.au/pub/CRAN/bin/windows/contrib/2.1/
so the install.packages command terminated with an error message that
the source file could not be downloaded.

Would it be possible to robustify the install.packages command such
that it continues with installing all the other packages requested
instead of terminating?

After redirecting R 2.1.1 on my laptop to use 
        http://cran.au.r-project.org/
for the CRAN repository, the install.packages() command ran without
problems.  I issued the command `library(MASS)' and tried out the
example from fitdistr on that machine (same strange result for second
command and warning messages were issued).  So I said
update.packages()  and that command failed when it wanted to update
the MASS package.  So I detach()'ed MASS and re-ran update.packages()
and again it failed.  So I exited R 2.1.1 and restarted it again
(probably I should have unloaded the namespace of MASS??) and then the
update.packages command worked.

However, update.packages() wanted to update quite a few packages
besides MASS (the other packages in the VR bundle, nlme, lattice &c).
Once it failed on MASS, it terminated with an error and did not update
any of the other packages.  Would it be possible to robustify
update.packages behaviour such that it would continue in such
situations with updating the remaining packages?

Cheers,

        Berwin


From berwin at maths.uwa.edu.au  Sun Aug 28 13:46:24 2005
From: berwin at maths.uwa.edu.au (Berwin A Turlach)
Date: Sun, 28 Aug 2005 19:46:24 +0800
Subject: [Rd] Coding standards (was Re:  bug in L-BFGS-B? (PR#8099))
In-Reply-To: <Pine.LNX.4.61.0508271525290.4656@gannet.stats>
References: <20050827141028.DCE0218B9F@slim.kubism.ku.dk>
	<Pine.LNX.4.61.0508271525290.4656@gannet.stats>
Message-ID: <17169.42000.451244.55081@bossiaea.maths.uwa.edu.au>

G'day Brian,

>>>>> "BDR" == Prof Brian Ripley <ripley at stats.ox.ac.uk> writes:

    BDR> As for the problem, yes it probably is a bug in L-BFGS-B.
    BDR> Fancy debugging the code?
I was afraid that somebody would ask this. ;-)

I looked a bit at the code and it seems to be non-trivial.  Moreover,
it seems to be code translated from FORTRAN to C via f2c and I am not
a fan of such kind of code.  I know that "Writing R Extensions" lists
in Appendix B ("R coding standards") f2c as a tool that `can "safely
be assumed" for R extensions'.  However, f2c, despite its `-A' option,
does not produce ANSI C compliant code but rather C code that provokes
undefined behaviour.

The problem is, that the code produced by f2c is decrementing pointers
to simulate 1-based vectors and the C FAQ is pretty unambigious about
the fact that this provokes undefined behaviour, see
        http://www.eskimo.com/~scs/C-faq/q6.17.html

As far as I understand, this translated code mostly stems from the
time when some platforms did not have ready access to a fortran
compiler and, hence, f2c was used (extensively?).  But now, with g77
this does not seem to be an issue anymore.  So I wonder whether there
are any plans of returning to the original fortran code?  Or are there
plans to clean up these f2c'd code snippet to make them ANSI C
compliant?  

I noticed such f2c'd code already in the splines.c file when I studied
how splinefun was implemented (which lead to bug report #8030).  In
that case, I am fairly familiar with the algorithms used in splines.c
since I programmed them myself on other occassions and I probably
could rewrite the algorithms in proper ANSI C (it would still take
some time).  But it would be nice to know what the official stance of
the R Core Team is.

When I spoke with one member of the R Core Team about this on a
conference in 2004, the answer was, IIRC, "yes, we know that this code
invokes undefined behaviour, but there are bigger problems to fix
first and this pointer manipulation seems to work on all platforms
these days."  Another member of the R Core Team whom I recently asked:

      I guess all platforms on which R is running at the moment do not
      have a problem with this trick, but are there any plans to
      change such kind of code to "valid" C?  Would patches that do
      that be accepted?

answered:

      Hmm, I think we'd tend to disagree here. But in any case that
      would be a wide issue.  Can you address this question to R-core,
      please?  (or I forward?)

Cheers,

        Berwin


From gb at stat.umu.se  Sun Aug 28 13:58:51 2005
From: gb at stat.umu.se (gb@stat.umu.se)
Date: Sun, 28 Aug 2005 13:58:51 +0200 (CEST)
Subject: [Rd] xerbla called from BLAS routine (PR#8100)
Message-ID: <20050828115851.5F3A518B9C@slim.kubism.ku.dk>

Full_Name: G?ran Brostr?m
Version: R-2.1.1, 2.2.0
OS: Debian unstable
Submission from: (NULL) (213.65.9.59)


Some BLAS routines call xerbla for error messages, which results in a message
like
"LAPACK routine DGER gave error code -9".

Suggested solution: In 

void F77_NAME(xerbla)(char *srname, int *info)
{
   /* srname is not null-terminated.  It should be 6 characters. */
    char buf[7];
    strncpy(buf, srname, 6);
    buf[6] = '\0';
    error(_("LAPACK routine '%6s' gave error code %d"), buf, -(*info));
}

change 'LAPACK' to 'The' (or 'The BLAS/LAPACK').


From p.dalgaard at biostat.ku.dk  Sun Aug 28 14:10:57 2005
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: 28 Aug 2005 14:10:57 +0200
Subject: [Rd] Coding standards (was Re:  bug in L-BFGS-B? (PR#8099))
In-Reply-To: <17169.42000.451244.55081@bossiaea.maths.uwa.edu.au>
References: <20050827141028.DCE0218B9F@slim.kubism.ku.dk>
	<Pine.LNX.4.61.0508271525290.4656@gannet.stats>
	<17169.42000.451244.55081@bossiaea.maths.uwa.edu.au>
Message-ID: <x2r7cetg6m.fsf@turmalin.kubism.ku.dk>

Berwin A Turlach <berwin at maths.uwa.edu.au> writes:

> The problem is, that the code produced by f2c is decrementing pointers
> to simulate 1-based vectors and the C FAQ is pretty unambigious about
> the fact that this provokes undefined behaviour, see
>         http://www.eskimo.com/~scs/C-faq/q6.17.html
> 
> As far as I understand, this translated code mostly stems from the
> time when some platforms did not have ready access to a fortran
> compiler and, hence, f2c was used (extensively?).  But now, with g77
> this does not seem to be an issue anymore.  So I wonder whether there
> are any plans of returning to the original fortran code?  Or are there
> plans to clean up these f2c'd code snippet to make them ANSI C
> compliant?  

There's more to it than that. F2c has also been used in places to make
Fortran code reentrant, which it is generally not. I forget whether we
were ever bitten by nested calls to optim(), but we certainly was by
integrate().

There is of course no argument against the fact that the
pointer-decrement trick goes against the C specs, but I do wonder
whether it is *actually* biting anyone these days. The remarks in the
C FAQ seem to mainly refer to segmented architectures like the
original IBM PC. With modern flat address spaces, it would seem quite
unlikely to run into trouble. 

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From rabrantes82 at gmail.com  Sun Aug 28 18:10:06 2005
From: rabrantes82 at gmail.com (Ricardo Luiz Andrade Abrantes)
Date: Sun, 28 Aug 2005 12:10:06 -0400
Subject: [Rd] .Call and Segmentation Fault
In-Reply-To: <Pine.LNX.4.61.0508280718090.3599@gannet.stats>
References: <973080e10508261519699235ea@mail.gmail.com>
	<F81375EB-3C7E-4385-ADC1-8842A449A332@stat.harvard.edu>
	<973080e10508271924266ea3bf@mail.gmail.com>
	<Pine.LNX.4.61.0508280718090.3599@gannet.stats>
Message-ID: <973080e105082809105c4e6230@mail.gmail.com>

> It cannot be .Call: your .Call passed no parameters so there was nothing 
> to be uninitialized.  I did ask you why you were doing that.

This .Call without parameters is just for a test. I am constructing an
interface to this C/Fortran optimization package, and because this
segmentation fault problem, I decided to modify the interface for a
simple test: call a C function that initialize the set of variables
wich describe the problem to be solved (wich supose to be done in R)
and call the optimization package. But my surprise was that the
program when called from R gives me the same segmentation fault error.
But when I compile the program as a regular linux binary and run it
from shell I don't get any problem. That's why I thought it could be a
problem with .Call.

 
> .Call is very heavily tested in lots of R applications, so the prior 
> probability of innocence must be very high.

Thanks professor, I will  check the C program again.


   Ricardo



> 
> -- 
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>


From ripley at stats.ox.ac.uk  Sun Aug 28 19:17:20 2005
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sun, 28 Aug 2005 18:17:20 +0100 (BST)
Subject: [Rd] robustness of install.packages/update.packages (was Re:
 bug in L-BFGS-B? (PR#8099))
In-Reply-To: <17169.40182.935036.246380@bossiaea.maths.uwa.edu.au>
References: <20050827141028.DCE0218B9F@slim.kubism.ku.dk>
	<Pine.LNX.4.61.0508271525290.4656@gannet.stats>
	<17169.40182.935036.246380@bossiaea.maths.uwa.edu.au>
Message-ID: <Pine.LNX.4.61.0508281813240.15601@gannet.stats>

We've never encountered this lying mirror problem.  Perhaps you (or 
another user of the unreliable mirror) could contribute suitable fixes.

On Sun, 28 Aug 2005, Berwin A Turlach wrote:

> G'day Brian,
>
> I am splitting my reply to your e-mail into two since there are two
> separate spinoffs.
>
>>>>>> "BDR" == Prof Brian Ripley <ripley at stats.ox.ac.uk> writes:
>
>    BDR> Check your versions of MASS.  The Windows one appears to be
>    BDR> an outdated version, and does different things.
> Thanks, yes, this is the problem.  On my linux box, I compile things
> from source and had the latest version of MASS (7.2-19) installed
> under R 2.1.1 and R 2.2.0.
>
> Since I hardly ever work under Windows, I rely for my Windows box on
> the precompiled versions provided from CRAN and do not compile R or
> packages from source.  (Though I have it set up so that I can compile
> my own packages.)  Actually, I only installed R 2.1.1 on that machine
> (which has an AMD processor) yesterday and it was using MASS version
> 7.2-16.  Running `update.packages' today, updated MASS to version
> 7.2-18.  And, lo and behold, there are no more warning messages, even
> more, running the example in `fitdistr' now returns:
>
>> set.seed(123)
>> x <- rgamma(100, shape = 5, rate = 0.1)
>> fitdistr(x, "gamma")
>     shape         rate
>  6.45947303   0.13593172
> (0.89052006) (0.01948648)
>> ## now do this directly with more control.
>> fitdistr(x, dgamma, list(shape = 1, rate = 0.1), lower = 0.01)
>     shape         rate
>  6.48714685   0.13651706
> (0.89442924) (0.01956916)
>
> So it was perhaps lucky that I did not run update.packages yesterday,
> since I would have expected that (like PR#1717) my bug report would be
> filed under not-reproducible. :-)
>
> But this made me curious, and I fired my laptop (which has an Intel
> chip) up under Windows (usually it runs under Linux) and installed R
> 2.1.1 on it.  On that Windows machine, I get the same answers as those
> reported yesterday under both MASS 7.2-16 and 7.2-18.  Thus, I am a
> bit baffled.  Well, I just went back to the AMD box and re-run the
> code, now it gives me again the "nonsense" answer in the second case.
> There is definitely something wrong in the L-BFGS-B routine, which
> will be hard to find.
>
> Regarding the changed subject line:
>
> After installing R 2.1.1 on my laptop, I executed an R source file
> which, essentially, only contains an install.packages command with the
> list of contributed packages that I like to have installed.  One of
> this packages is DAAG and it seems that overnight the file
> DAAG_0.58.zip disappeared from
>        http://mirror.aarnet.edu.au/pub/CRAN/bin/windows/contrib/2.1/
> so the install.packages command terminated with an error message that
> the source file could not be downloaded.
>
> Would it be possible to robustify the install.packages command such
> that it continues with installing all the other packages requested
> instead of terminating?
>
> After redirecting R 2.1.1 on my laptop to use
>        http://cran.au.r-project.org/
> for the CRAN repository, the install.packages() command ran without
> problems.  I issued the command `library(MASS)' and tried out the
> example from fitdistr on that machine (same strange result for second
> command and warning messages were issued).  So I said
> update.packages()  and that command failed when it wanted to update
> the MASS package.  So I detach()'ed MASS and re-ran update.packages()
> and again it failed.  So I exited R 2.1.1 and restarted it again
> (probably I should have unloaded the namespace of MASS??) and then the
> update.packages command worked.

Yes, and that *is* in the rw-FAQ.

> However, update.packages() wanted to update quite a few packages
> besides MASS (the other packages in the VR bundle, nlme, lattice &c).
> Once it failed on MASS, it terminated with an error and did not update
> any of the other packages.  Would it be possible to robustify
> update.packages behaviour such that it would continue in such
> situations with updating the remaining packages?

Not a good idea. Better to follow the FAQ.  At that point the dependencies 
have been worked out and will not be re-computed if a package installation 
fails.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From MSchwartz at mn.rr.com  Mon Aug 29 00:30:24 2005
From: MSchwartz at mn.rr.com (Marc Schwartz)
Date: Sun, 28 Aug 2005 17:30:24 -0500
Subject: [Rd] Additional Books on R for Web Site Listing
Message-ID: <1125268224.18760.50.camel@localhost.localdomain>

Hi all,

I noted that the books below are not included on the R web site
Documentation section under "Books". I thought that I would provide
these and have created some bib entries consistent with the style used
on the site. The abstract sections were copied from the publisher sites.

I hope that these are acceptable to both the book list maintainer and
the respective authors. Feel free to modify as may be appropriate.

It is great to see the increasing number of new books on R!

A special note to Paul Murrell on a great addition to the R library! I
just got my copy this past week from Amazon.com. Well Done!

Best regards,

Marc Schwartz



@BOOK{R:Crawley:2005,
  AUTHOR = {Michael J. Crawley},
  TITLE = {Statistics: An Introduction using R},
  PUBLISHER = {Wiley},
  YEAR = 2005,
  NOTE = {ISBN 0-470-02297-3},
  PUBLISHERURL = {http://www.wiley.com/WileyCDA/WileyTitle/productCd-0470022973.html},
  URL = {http://www.bio.ic.ac.uk/research/crawley/statistics/},
  ABSTRACT = {Statistics: An Introduction using R is the first text to offer such
              a concise introduction to a broad array of statistical methods,
              at a level that is elementary enough to appeal to a broad range of
              disciplines. It is primarily aimed at undergraduate students in medicine,
              engineering, economics and biology ? but will also appeal to postgraduates
              who have not previously covered this area, or wish to switch to using R.}
}



@BOOK{R:Everitt:2005,
  AUTHOR = {Brian S. Everitt},
  TITLE = {An R and S-Plus? Companion to Multivariate Analysis},
  PUBLISHER = {Springer},
  YEAR = 2005,
  NOTE = {ISBN 1-85233-882-2},
  PUBLISHERURL = {http://www.springeronline.com/sgw/cda/frontpage/0,11855,4-40109-22-34953445-0,00.html},
  URL = {http://biostatistics.iop.kcl.ac.uk/publications/everitt/},
  ABSTRACT = {In this book the core multivariate methodology is covered along with some
              basic theory for each method described. The necessary R and S-PLUS code
              is given for each analysis in the book, with any differences between the
              two highlighted. A website with all the datasets and code used in the book
              can be found at http://biostatistics.iop.kcl.ac.uk/publications/everitt/.}
}



@BOOK{R:Harrell:2001,
  AUTHOR = {Frank E. Harrell},
  TITLE = {Regression Modeling Strategies, with Applications to Linear
  Models, Survival Analysis and Logistic Regression},
  PUBLISHER = {Springer},
  YEAR = 2001,
  NOTE = {ISBN 0-387-95232-2},
  PUBLISHERURL = {http://www.springeronline.com/sgw/cda/frontpage/0,11855,4-0-22-2187282-0,00.html},
  URL = {http://biostat.mc.vanderbilt.edu/twiki/bin/view/Main/RmS},
  ABSTRACT = {There are many books that are excellent sources of knowledge about individual statistical
              tools (survival models, general linear models, etc.), but the art of data analysis is
              about choosing and using multiple tools. In the words of Chatfield "...students typically
              know the technical details of regression for example, but not necessarily when and how to
              apply it. This argues the need for a better balance in the literature and in statistical
              teaching between techniques and problem solving strategies." Whether analyzing risk
              factors, adjusting for biases in observational studies, or developing predictive models,
              there are common problems that few regression texts address. For example, there are
              missing data in the majority of datasets one is likely to encounter (other than those
              used in textbooks!) but most regression texts do not include methods for dealing with
              such data effectively, and texts on missing data do not cover regression modeling.}
}


From ripley at stats.ox.ac.uk  Mon Aug 29 10:05:51 2005
From: ripley at stats.ox.ac.uk (ripley@stats.ox.ac.uk)
Date: Mon, 29 Aug 2005 10:05:51 +0200 (CEST)
Subject: [Rd] xerbla called from BLAS routine (PR#8100)
Message-ID: <20050829080551.212E718B8A@slim.kubism.ku.dk>

  This message is in MIME format.  The first part should be readable text,
  while the remaining parts are likely unreadable without MIME-aware tools.

--27464147-1060265079-1125299740=:28726
Content-Type: TEXT/PLAIN; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: QUOTED-PRINTABLE

Please check out

http://www.netlib.org/blas/index.html

file=09xerbla.f
for=09error handler for the Level 2 and 3 BLAS routines.
,=09(Auxiliary Routine)

and the refefence code which says

*  XERBLA  is an error handler for the LAPACK routines.
*  It is called by an LAPACK routine if an input parameter has an
*  invalid value.  A message is printed and execution stops.

So, XERBLA is an LAPACK handler, intended to be called from LAPACK=20
routines -- the level 2 and level 3 BLAS routines are considered to be
part of LAPACK in the reference implementation.

On Mon, 29 Aug 2005, Prof Brian Ripley wrote:

> I don't believe your message actually came from R's XERBLA.  Note that th=
e=20
> name is not quoted and that the name of the routine is not 6 characters l=
ong.
>
> Here is a genuine example from R:
>
> Error in La.svd(x, nu, nv) : LAPACK routine 'DGEBRD' gave error code -10
>
> There is no R 2.2.0, BTW.  If referring to R-devel, please do so with an =
SVN=20
> revision.
>
> On Sun, 28 Aug 2005 gb at stat.umu.se wrote:
>
>> Full_Name: G=F6ran Brostr=F6m
>> Version: R-2.1.1, 2.2.0
>> OS: Debian unstable
>> Submission from: (NULL) (213.65.9.59)
>>=20
>>=20
>> Some BLAS routines call xerbla for error messages, which results in a=20
>> message
>> like
>> "LAPACK routine DGER gave error code -9".
>>=20
>> Suggested solution: In
>>=20
>> void F77_NAME(xerbla)(char *srname, int *info)
>> {
>>   /* srname is not null-terminated.  It should be 6 characters. */
>>    char buf[7];
>>    strncpy(buf, srname, 6);
>>    buf[6] =3D '\0';
>>    error(_("LAPACK routine '%6s' gave error code %d"), buf, -(*info));
>> }
>>=20
>> change 'LAPACK' to 'The' (or 'The BLAS/LAPACK').
>>=20
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>=20
>>=20
>
> --=20
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595

--=20
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595
--27464147-1060265079-1125299740=:28726--


From ripley at stats.ox.ac.uk  Mon Aug 29 10:06:00 2005
From: ripley at stats.ox.ac.uk (ripley@stats.ox.ac.uk)
Date: Mon, 29 Aug 2005 10:06:00 +0200 (CEST)
Subject: [Rd] xerbla called from BLAS routine (PR#8100)
Message-ID: <20050829080600.3854E13F8E@slim.kubism.ku.dk>

  This message is in MIME format.  The first part should be readable text,
  while the remaining parts are likely unreadable without MIME-aware tools.

--27464147-1510948051-1125298763=:26166
Content-Type: TEXT/PLAIN; charset=iso-8859-1; format=flowed
Content-Transfer-Encoding: QUOTED-PRINTABLE

I don't believe your message actually came from R's XERBLA.  Note that the=
=20
name is not quoted and that the name of the routine is not 6 characters=20
long.

Here is a genuine example from R:

Error in La.svd(x, nu, nv) : LAPACK routine 'DGEBRD' gave error code -10

There is no R 2.2.0, BTW.  If referring to R-devel, please do so with an=20
SVN revision.

On Sun, 28 Aug 2005 gb at stat.umu.se wrote:

> Full_Name: G=F6ran Brostr=F6m
> Version: R-2.1.1, 2.2.0
> OS: Debian unstable
> Submission from: (NULL) (213.65.9.59)
>
>
> Some BLAS routines call xerbla for error messages, which results in a mes=
sage
> like
> "LAPACK routine DGER gave error code -9".
>
> Suggested solution: In
>
> void F77_NAME(xerbla)(char *srname, int *info)
> {
>   /* srname is not null-terminated.  It should be 6 characters. */
>    char buf[7];
>    strncpy(buf, srname, 6);
>    buf[6] =3D '\0';
>    error(_("LAPACK routine '%6s' gave error code %d"), buf, -(*info));
> }
>
> change 'LAPACK' to 'The' (or 'The BLAS/LAPACK').
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>

--=20
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595
--27464147-1510948051-1125298763=:26166--


From jago at mclink.it  Mon Aug 29 10:12:25 2005
From: jago at mclink.it (stefano iacus)
Date: Mon, 29 Aug 2005 10:12:25 +0200
Subject: [Rd] Fwd: segfault
References: <p06230901bf3759687fd6@[84.173.69.150]>
Message-ID: <AE67BE22-269F-4ED4-A6E3-D800A1F91496@mclink.it>

This segfaults on OS X (10.4) on both X11 and quartz devices.
Seems a problem with lattice but I cannot test on other platforms
stefano


Begin forwarded message:

> From: "G. Sawitzki" <gs at statlab.uni-heidelberg.de>
> Date: 28 agosto 2005 14:11:18 GMT+02:00
> To: jago at mclink.it
>
>
> Dear Stefano,
>
>  this small exaple leads to a crash of R. I did not try it on  
> versions other than the Mac version. So I am sending it to you  
> directly. If it is a littice problem, could you pass it to Deepayan  
> Sarkar? Thank you.
>
>   g.
>
> ==
> #pbinom
> library(grid)
> library(lattice)
>
> n<-20
> psteps<-50
> binomtable<- function (n,psteps){
> x<-(0:(10*n))/10
> p<- (0:psteps)/psteps
> dd<-expand.grid(x=x,p=p)
> dd$F<- pbinom(dd$x,n,dd$p)
> dd$x0<-trunc(dd$x)
> dd
> }
>
> bt<-binomtable(n=5,psteps=100)
> bt[bt$x-bt$x0>=0.9,]$F<-NA
> wireframe(bt$F~bt$x*bt$p,bt,groups=bt$x0,shade=TRUE) # leads to R  
> crash
> #wireframe(bt$F~bt$x*bt$p,bt,shade=TRUE) #ok
>


From ripley at stats.ox.ac.uk  Mon Aug 29 10:35:35 2005
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 29 Aug 2005 09:35:35 +0100 (BST)
Subject: [Rd] Fwd: segfault
In-Reply-To: <AE67BE22-269F-4ED4-A6E3-D800A1F91496@mclink.it>
References: <p06230901bf3759687fd6@[84.173.69.150]>
	<AE67BE22-269F-4ED4-A6E3-D800A1F91496@mclink.it>
Message-ID: <Pine.LNX.4.61.0508290930250.29579@gannet.stats>

It does not crash for me on either Windows or Linux, but it does take a 
long time and the plot is a mess, so there does seem to be a 
lattice-related problem (maybe a usage one).

However, I think the crash is a Mac (presumably quartz()) problem.

On Mon, 29 Aug 2005, stefano iacus wrote:

> This segfaults on OS X (10.4) on both X11 and quartz devices.
> Seems a problem with lattice but I cannot test on other platforms
> stefano
>
>
> Begin forwarded message:
>
>> From: "G. Sawitzki" <gs at statlab.uni-heidelberg.de>
>> Date: 28 agosto 2005 14:11:18 GMT+02:00
>> To: jago at mclink.it
>>
>>
>> Dear Stefano,
>>
>>  this small exaple leads to a crash of R. I did not try it on
>> versions other than the Mac version. So I am sending it to you
>> directly. If it is a littice problem, could you pass it to Deepayan
>> Sarkar? Thank you.
>>
>>   g.
>>
>> ==
>> #pbinom
>> library(grid)
>> library(lattice)
>>
>> n<-20
>> psteps<-50
>> binomtable<- function (n,psteps){
>> x<-(0:(10*n))/10
>> p<- (0:psteps)/psteps
>> dd<-expand.grid(x=x,p=p)
>> dd$F<- pbinom(dd$x,n,dd$p)
>> dd$x0<-trunc(dd$x)
>> dd
>> }
>>
>> bt<-binomtable(n=5,psteps=100)
>> bt[bt$x-bt$x0>=0.9,]$F<-NA
>> wireframe(bt$F~bt$x*bt$p,bt,groups=bt$x0,shade=TRUE) # leads to R
>> crash
>> #wireframe(bt$F~bt$x*bt$p,bt,shade=TRUE) #ok

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From gb at stat.umu.se  Mon Aug 29 11:19:08 2005
From: gb at stat.umu.se (=?iso-8859-1?Q?G=F6ran_Brostr=F6m?=)
Date: Mon, 29 Aug 2005 11:19:08 +0200
Subject: [Rd] xerbla called from BLAS routine (PR#8100)
In-Reply-To: <20050829080600.3854E13F8E@slim.kubism.ku.dk>
References: <20050829080600.3854E13F8E@slim.kubism.ku.dk>
Message-ID: <20050829091908.GA14693@stat.umu.se>

On Mon, Aug 29, 2005 at 10:06:00AM +0200, ripley at stats.ox.ac.uk wrote:
>   This message is in MIME format.  The first part should be readable text,
>   while the remaining parts are likely unreadable without MIME-aware tools.
> 
> --27464147-1510948051-1125298763=:26166
> Content-Type: TEXT/PLAIN; charset=iso-8859-1; format=flowed
> Content-Transfer-Encoding: QUOTED-PRINTABLE
> 
> I don't believe your message actually came from R's XERBLA.  Note that the=
> =20
> name is not quoted and that the name of the routine is not 6 characters=20
> long.

Actually, it did. I didn't quote the message exactly (as I said). Now,
I took the liberty to make my own suggested change in R-devel_2005-08-28 
and rebuilt, and you may guess what error message I got.;) 

Error in coxreg.fit(X, Y, rs, strats, offset, init, max.survs, method,  :
        The BLAS/LAPACK routine 'DSYR  ' gave error code -7


BTW, the original BLAS xerbla (from the netlib page you referred to)
gives the message:

     WRITE( *, FMT = 9999 )SRNAME, INFO
9999 FORMAT( ' ** On entry to ', A6, ' parameter number ', I2, ' had ',
     $      'an illegal value' )

which I think is even better than my original suggestion. 
(Why was it changed?)

G?ran 

> 
> Here is a genuine example from R:
> 
> Error in La.svd(x, nu, nv) : LAPACK routine 'DGEBRD' gave error code -10
> 
> There is no R 2.2.0, BTW.  If referring to R-devel, please do so with an=20
> SVN revision.
> 
> On Sun, 28 Aug 2005 gb at stat.umu.se wrote:
> 
> > Full_Name: G=F6ran Brostr=F6m
> > Version: R-2.1.1, 2.2.0
> > OS: Debian unstable
> > Submission from: (NULL) (213.65.9.59)
> >
> >
> > Some BLAS routines call xerbla for error messages, which results in a mes=
> sage
> > like
> > "LAPACK routine DGER gave error code -9".
> >
> > Suggested solution: In
> >
> > void F77_NAME(xerbla)(char *srname, int *info)
> > {
> >   /* srname is not null-terminated.  It should be 6 characters. */
> >    char buf[7];
> >    strncpy(buf, srname, 6);
> >    buf[6] =3D '\0';
> >    error(_("LAPACK routine '%6s' gave error code %d"), buf, -(*info));
> > }
> >
> > change 'LAPACK' to 'The' (or 'The BLAS/LAPACK').
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >
> >
> 
> --=20
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
> --27464147-1510948051-1125298763=:26166--
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
G?ran Brostr?m                    tel: +46 90 786 5223
Professor and Head
Department of Statistics          fax: +46 90 786 6614
Ume? University                   http://www.stat.umu.se/~goran.brostrom/
SE-90187 Ume?, Sweden             e-mail: gb at stat.umu.se


From ripley at stats.ox.ac.uk  Mon Aug 29 11:27:24 2005
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 29 Aug 2005 10:27:24 +0100 (BST)
Subject: [Rd] xerbla called from BLAS routine (PR#8100)
In-Reply-To: <20050829091908.GA14693@stat.umu.se>
References: <20050829080600.3854E13F8E@slim.kubism.ku.dk>
	<20050829091908.GA14693@stat.umu.se>
Message-ID: <Pine.LNX.4.61.0508291022120.30101@gannet.stats>

On Mon, 29 Aug 2005, G?ran Brostr?m wrote:

> On Mon, Aug 29, 2005 at 10:06:00AM +0200, ripley at stats.ox.ac.uk wrote:
>>   This message is in MIME format.  The first part should be readable text,
>>   while the remaining parts are likely unreadable without MIME-aware tools.
>>
>> --27464147-1510948051-1125298763=:26166
>> Content-Type: TEXT/PLAIN; charset=iso-8859-1; format=flowed
>> Content-Transfer-Encoding: QUOTED-PRINTABLE
>>
>> I don't believe your message actually came from R's XERBLA.  Note that the=
>> =20
>> name is not quoted and that the name of the routine is not 6 characters=20
>> long.
>
> Actually, it did.

You seem to be agreeing that it did not (which is the truth).

> I didn't quote the message exactly (as I said).

You didn't say, and the posting guide does ask you to do so exactly.

> Now, I took the liberty to make my own suggested change in 
> R-devel_2005-08-28 and rebuilt, and you may guess what error message I 
> got.;)
>
> Error in coxreg.fit(X, Y, rs, strats, offset, init, max.survs, method,  :
>        The BLAS/LAPACK routine 'DSYR  ' gave error code -7
>
>
> BTW, the original BLAS xerbla (from the netlib page you referred to)
> gives the message:
>
>     WRITE( *, FMT = 9999 )SRNAME, INFO
> 9999 FORMAT( ' ** On entry to ', A6, ' parameter number ', I2, ' had ',
>     $      'an illegal value' )
>
> which I think is even better than my original suggestion.
> (Why was it changed?)

Probably because R is not a Fortran program and so needs to make clear 
what these refer to, and because LAPACK does have other error values that 
invalid parameter values.

>
> G?ran
>
>>
>> Here is a genuine example from R:
>>
>> Error in La.svd(x, nu, nv) : LAPACK routine 'DGEBRD' gave error code -10
>>
>> There is no R 2.2.0, BTW.  If referring to R-devel, please do so with an=20
>> SVN revision.
>>
>> On Sun, 28 Aug 2005 gb at stat.umu.se wrote:
>>
>>> Full_Name: G=F6ran Brostr=F6m
>>> Version: R-2.1.1, 2.2.0
>>> OS: Debian unstable
>>> Submission from: (NULL) (213.65.9.59)
>>>
>>>
>>> Some BLAS routines call xerbla for error messages, which results in a mes=
>> sage
>>> like
>>> "LAPACK routine DGER gave error code -9".
>>>
>>> Suggested solution: In
>>>
>>> void F77_NAME(xerbla)(char *srname, int *info)
>>> {
>>>   /* srname is not null-terminated.  It should be 6 characters. */
>>>    char buf[7];
>>>    strncpy(buf, srname, 6);
>>>    buf[6] =3D '\0';
>>>    error(_("LAPACK routine '%6s' gave error code %d"), buf, -(*info));
>>> }
>>>
>>> change 'LAPACK' to 'The' (or 'The BLAS/LAPACK').
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>>
>>
>> --=20
>> Brian D. Ripley,                  ripley at stats.ox.ac.uk
>> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
>> University of Oxford,             Tel:  +44 1865 272861 (self)
>> 1 South Parks Road,                     +44 1865 272866 (PA)
>> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>> --27464147-1510948051-1125298763=:26166--
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
> -- 
> G?ran Brostr?m                    tel: +46 90 786 5223
> Professor and Head
> Department of Statistics          fax: +46 90 786 6614
> Ume? University                   http://www.stat.umu.se/~goran.brostrom/
> SE-90187 Ume?, Sweden             e-mail: gb at stat.umu.se
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From ripley at stats.ox.ac.uk  Mon Aug 29 11:29:53 2005
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 29 Aug 2005 10:29:53 +0100 (BST)
Subject: [Rd] robustness of install.packages/update.packages (was Re:
 bug in L-BFGS-B? (PR#8099))
In-Reply-To: <Pine.LNX.4.61.0508281813240.15601@gannet.stats>
References: <20050827141028.DCE0218B9F@slim.kubism.ku.dk>
	<Pine.LNX.4.61.0508271525290.4656@gannet.stats>
	<17169.40182.935036.246380@bossiaea.maths.uwa.edu.au>
	<Pine.LNX.4.61.0508281813240.15601@gannet.stats>
Message-ID: <Pine.LNX.4.61.0508291027350.30101@gannet.stats>

On Sun, 28 Aug 2005, Prof Brian Ripley wrote:

>> After redirecting R 2.1.1 on my laptop to use
>>        http://cran.au.r-project.org/
>> for the CRAN repository, the install.packages() command ran without
>> problems.  I issued the command `library(MASS)' and tried out the
>> example from fitdistr on that machine (same strange result for second
>> command and warning messages were issued).  So I said
>> update.packages()  and that command failed when it wanted to update
>> the MASS package.  So I detach()'ed MASS and re-ran update.packages()
>> and again it failed.  So I exited R 2.1.1 and restarted it again
>> (probably I should have unloaded the namespace of MASS??) and then the
>> update.packages command worked.
>
> Yes, and that *is* in the rw-FAQ.
>
>> However, update.packages() wanted to update quite a few packages
>> besides MASS (the other packages in the VR bundle, nlme, lattice &c).
>> Once it failed on MASS, it terminated with an error and did not update
>> any of the other packages.  Would it be possible to robustify
>> update.packages behaviour such that it would continue in such
>> situations with updating the remaining packages?
>
> Not a good idea. Better to follow the FAQ.  At that point the dependencies
> have been worked out and will not be re-computed if a package installation
> fails.

I checked, and I am unable to reproduce this.  I get

> library(MASS)
> install.packages(c("MASS", "tree"))
trying URL 
'http://cran.at.r-project.org/bin/windows/contrib/2.2/tree_1.0-19.zip'
Content type 'application/zip' length 144676 bytes
opened URL
downloaded 141Kb

package 'tree' successfully unpacked and MD5 sums checked

The downloaded packages are in
         C:\Documents and Settings\ripley\Local 
Settings\Temp\Rtmp13777\downloaded_packages
updating HTML package descriptions
Warning message:
package MASS is in use and will not be installed

which seems perfectly reasonable.



-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From joelarrais at gmail.com  Mon Aug 29 11:57:45 2005
From: joelarrais at gmail.com (joelarrais)
Date: Mon, 29 Aug 2005 10:57:45 +0100
Subject: [Rd] RServe initialization problem
Message-ID: <4312dc01.3d085e91.330e.4f87@mx.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20050829/16e2ff5d/attachment.pl

From joelarrais at gmail.com  Mon Aug 29 12:04:20 2005
From: joelarrais at gmail.com (joelarrais)
Date: Mon, 29 Aug 2005 11:04:20 +0100
Subject: [Rd] FW: RServe initialization problem
Message-ID: <4312dd8b.05c7373e.6198.ffff9afc@mx.gmail.com>


I want to use the R functionalities in my Java program. I found the Rserve
that appear to suite my requirements but I'm facing some configuration
problems.
I' following the web page tutorial
(http://stats.math.uni-augsburg.de/Rserve/doc.shtml) but I face the above
problem:

C:\Program Files\R\rw2010\bin>R CMD RSERVE
Can't open perl script "C:\PROGRA~1\R\rw2010/bin/RSERVE": No such file or
directory

Thanks in advance,

Joel Arrais,
joelarrais at gmail.com


From gb at stat.umu.se  Mon Aug 29 12:34:57 2005
From: gb at stat.umu.se (=?iso-8859-1?Q?G=F6ran_Brostr=F6m?=)
Date: Mon, 29 Aug 2005 12:34:57 +0200
Subject: [Rd] xerbla called from BLAS routine (PR#8100)
In-Reply-To: <Pine.LNX.4.61.0508291022120.30101@gannet.stats>
References: <20050829080600.3854E13F8E@slim.kubism.ku.dk>
	<20050829091908.GA14693@stat.umu.se>
	<Pine.LNX.4.61.0508291022120.30101@gannet.stats>
Message-ID: <20050829103457.GB14693@stat.umu.se>

On Mon, Aug 29, 2005 at 10:27:24AM +0100, Prof Brian Ripley wrote:
> On Mon, 29 Aug 2005, G?ran Brostr?m wrote:
[...]
> >
> >BTW, the original BLAS xerbla (from the netlib page you referred to)
> >gives the message:
> >
> >    WRITE( *, FMT = 9999 )SRNAME, INFO
> >9999 FORMAT( ' ** On entry to ', A6, ' parameter number ', I2, ' had ',
> >    $      'an illegal value' )
> >
> >which I think is even better than my original suggestion.
> >(Why was it changed?)
> 
> Probably because R is not a Fortran program and so needs to make clear 
> what these refer to, and because LAPACK does have other error values that 
> invalid parameter values.

LAPACK/BLAS routines call xerbla "if an input parameter has an 
invalid value" (exact quote from  XERBLA at Netlib). Other types of errors 
are not printed (by xerbla), but it is up to the user to check the return 
value of the argument 'INFO'. See
http://www.netlib.org/lapack/lug/node119.html.

So we can safely give the more informative, original, error messages, 
together with mentioning LAPACK and eventually BLAS, whatever you prefer.
This would "make clear what these refer to". Given that other BLAS/LAPACK 
routines than xerbla aren't changed in R, of course.

G?ran


From berwin at maths.uwa.edu.au  Mon Aug 29 12:46:31 2005
From: berwin at maths.uwa.edu.au (Berwin A Turlach)
Date: Mon, 29 Aug 2005 18:46:31 +0800
Subject: [Rd] robustness of install.packages/update.packages (was Re:
 bug in L-BFGS-B? (PR#8099))
In-Reply-To: <Pine.LNX.4.61.0508281813240.15601@gannet.stats>
References: <20050827141028.DCE0218B9F@slim.kubism.ku.dk>
	<Pine.LNX.4.61.0508271525290.4656@gannet.stats>
	<17169.40182.935036.246380@bossiaea.maths.uwa.edu.au>
	<Pine.LNX.4.61.0508281813240.15601@gannet.stats>
Message-ID: <17170.59271.40276.243798@bossiaea.maths.uwa.edu.au>

G'day Brian,

>>>>> "BDR" == Prof Brian Ripley <ripley at stats.ox.ac.uk> writes:

    BDR> We've never encountered this lying mirror problem.
Indeed, that mirror is a worry, I guess that is the reason why it is
not on the official mirror list.

We had the problem with install.packages/update.packages under linux
too: source packages that supposedly should have been on the mirror
were not and the commands just terminated with an error message instead
of installing all those packages that could be found.  

Unfortunately, the way we are charged for internet traffic, it is much
cheaper for us to use mirror.aarnet.edu.au than any other mirror.  I
remember that last year around this time (give or take a some months)
when a new R version was released (2.0.0?) it took actually quite some
time before the sources appeared on the mirror, the directory
structure was mirrored, but not the files.  That was when I decided to
(temporarily) change mirrors.

    BDR> Perhaps you (or another user of the unreliable mirror) could
    BDR> contribute suitable fixes.
I will look into this when I find some time.

Cheers,

        Berwin


From ripley at stats.ox.ac.uk  Mon Aug 29 12:48:23 2005
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 29 Aug 2005 11:48:23 +0100 (BST)
Subject: [Rd] xerbla called from BLAS routine (PR#8100)
In-Reply-To: <20050829103457.GB14693@stat.umu.se>
References: <20050829080600.3854E13F8E@slim.kubism.ku.dk>
	<20050829091908.GA14693@stat.umu.se>
	<Pine.LNX.4.61.0508291022120.30101@gannet.stats>
	<20050829103457.GB14693@stat.umu.se>
Message-ID: <Pine.LNX.4.61.0508291145200.3755@gannet.stats>

On Mon, 29 Aug 2005, G?ran Brostr?m wrote:

> On Mon, Aug 29, 2005 at 10:27:24AM +0100, Prof Brian Ripley wrote:
>> On Mon, 29 Aug 2005, G?ran Brostr?m wrote:
> [...]
>>>
>>> BTW, the original BLAS xerbla (from the netlib page you referred to)
>>> gives the message:
>>>
>>>    WRITE( *, FMT = 9999 )SRNAME, INFO
>>> 9999 FORMAT( ' ** On entry to ', A6, ' parameter number ', I2, ' had ',
>>>    $      'an illegal value' )
>>>
>>> which I think is even better than my original suggestion.
>>> (Why was it changed?)
>>
>> Probably because R is not a Fortran program and so needs to make clear
>> what these refer to, and because LAPACK does have other error values that
>> invalid parameter values.
>
> LAPACK/BLAS routines call xerbla "if an input parameter has an
> invalid value" (exact quote from  XERBLA at Netlib). Other types of errors
> are not printed (by xerbla), but it is up to the user to check the return
> value of the argument 'INFO'. See
> http://www.netlib.org/lapack/lug/node119.html.

Maybe, that is not actually true for real-life LAPACK implementations, as 
I did say.

> So we can safely give the more informative, original, error messages,
> together with mentioning LAPACK and eventually BLAS, whatever you prefer.
> This would "make clear what these refer to". Given that other BLAS/LAPACK
> routines than xerbla aren't changed in R, of course.

Irrelevant as R is often compiled against other ones implementations.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From ripley at stats.ox.ac.uk  Mon Aug 29 12:53:39 2005
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 29 Aug 2005 11:53:39 +0100 (BST)
Subject: [Rd] FW: RServe initialization problem
In-Reply-To: <4312dd8b.05c7373e.6198.ffff9afc@mx.gmail.com>
References: <4312dd8b.05c7373e.6198.ffff9afc@mx.gmail.com>
Message-ID: <Pine.LNX.4.61.0508291151240.3755@gannet.stats>

On Mon, 29 Aug 2005, joelarrais wrote:

>
> I want to use the R functionalities in my Java program. I found the Rserve
> that appear to suite my requirements but I'm facing some configuration
> problems.
> I' following the web page tutorial
> (http://stats.math.uni-augsburg.de/Rserve/doc.shtml) but I face the above
> problem:
>
> C:\Program Files\R\rw2010\bin>R CMD RSERVE
> Can't open perl script "C:\PROGRA~1\R\rw2010/bin/RSERVE": No such file or
> directory

Right.  RServe is not part of R: you need to install it.

BTW, as the posting guide says, the first thing to so is to update your R:
2.1.0 is not current.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From berwin at maths.uwa.edu.au  Mon Aug 29 12:55:04 2005
From: berwin at maths.uwa.edu.au (Berwin A Turlach)
Date: Mon, 29 Aug 2005 18:55:04 +0800
Subject: [Rd] robustness of install.packages/update.packages (was Re:
 bug in L-BFGS-B? (PR#8099))
In-Reply-To: <Pine.LNX.4.61.0508291027350.30101@gannet.stats>
References: <20050827141028.DCE0218B9F@slim.kubism.ku.dk>
	<Pine.LNX.4.61.0508271525290.4656@gannet.stats>
	<17169.40182.935036.246380@bossiaea.maths.uwa.edu.au>
	<Pine.LNX.4.61.0508281813240.15601@gannet.stats>
	<Pine.LNX.4.61.0508291027350.30101@gannet.stats>
Message-ID: <17170.59784.707764.393102@bossiaea.maths.uwa.edu.au>

G'day Brian,

>>>>> "BDR" == Prof Brian Ripley <ripley at stats.ox.ac.uk> writes:

    >>> However, update.packages() wanted to update quite a few
    >>> packages besides MASS (the other packages in the VR bundle,
    >>> nlme, lattice &c).  Once it failed on MASS, it terminated with
    >>> an error and did not update any of the other packages.  Would
    >>> it be possible to robustify update.packages behaviour such
    >>> that it would continue in such situations with updating the
    >>> remaining packages?
    >>  Not a good idea. Better to follow the FAQ.  At that point the
    >> dependencies have been worked out and will not be re-computed
    >> if a package installation fails.

    BDR> I checked, and I am unable to reproduce this.  I get
O.k., I tried to reproduce the behaviour.  So I installed the binary
distribution of R 2.1.1 in another directory on my laptop once more
(and then deleted the copy that I actually wanted to keep; shouldn't
do such things at this time of the day).

So below I attach what is, I believe a faithful reproduction of what I
tried to do yesterday.  Except that I did not run the file that
installs all the contributed packages that I like to have installed.

But it seems that now VR_7.2-17.zip has vanished from
mirror.aarnet.edu.au and you can see how on the first occassion the
download stops with an error.  I believe that in this case it could
have continued to download the other files.

Once I changed the mirror, the other behaviour that I mentioned
becomes apparent.  But I take your point that because of package
dependencies it might actually be not wise to continue with updating
further packages once the update of a package has failed.  But then,
shouldn't in that case (by the same argument) all the updates that
have been done already be undone again?

Cheers,

        Berwin

++++++++++++++++++ Transcript of R session ++++++++++++++++++++++++++++

R : Copyright 2005, The R Foundation for Statistical Computing
Version 2.1.1  (2005-06-20), ISBN 3-900051-07-0

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for a HTML browser interface to help.
Type 'q()' to quit R.

> library(MASS)
> update.packages()
boot :
 Version 1.2-22 installed in C:/PROGRA~1/R/rw2011/library 
 Version 1.2-23 available at http://mirror.aarnet.edu.au/pub/CRAN
Update (y/N/c)?  y
VR :
 Version 7.2-16 installed in C:/PROGRA~1/R/rw2011/library 
 Version 7.2-17 available at http://mirror.aarnet.edu.au/pub/CRAN
Update (y/N/c)?  y
cluster :
 Version 1.10.0 installed in C:/PROGRA~1/R/rw2011/library 
 Version 1.10.1 available at http://mirror.aarnet.edu.au/pub/CRAN
Update (y/N/c)?  y
foreign :
 Version 0.8-8 installed in C:/PROGRA~1/R/rw2011/library 
 Version 0.8-9 available at http://mirror.aarnet.edu.au/pub/CRAN
Update (y/N/c)?  y
lattice :
 Version 0.11-8 installed in C:/PROGRA~1/R/rw2011/library 
 Version 0.12-3 available at http://mirror.aarnet.edu.au/pub/CRAN
Update (y/N/c)?  y
mgcv :
 Version 1.3-1 installed in C:/PROGRA~1/R/rw2011/library 
 Version 1.3-4 available at http://mirror.aarnet.edu.au/pub/CRAN
Update (y/N/c)?  y
nlme :
 Version 3.1-60 installed in C:/PROGRA~1/R/rw2011/library 
 Version 3.1-62 available at http://mirror.aarnet.edu.au/pub/CRAN
Update (y/N/c)?  y
trying URL 'http://mirror.aarnet.edu.au/pub/CRAN/bin/windows/contrib/2.1/boot_1.2-23.zip'
Content type 'application/zip' length 767814 bytes
opened URL
downloaded 749Kb

trying URL 'http://mirror.aarnet.edu.au/pub/CRAN/bin/windows/contrib/2.1/VR_7.2-17.zip'
Error in download.file(url, destfile, method, mode = "wb") : 
        cannot open URL 'http://mirror.aarnet.edu.au/pub/CRAN/bin/windows/contrib/2.1/VR_7.2-17.zip'
In addition: Warning message:
cannot open: HTTP status was '404 Not Found' 
> options(repos=c(CRAN="http://cran.au.r-project.org/"))
> options()$repos
                           CRAN 
"http://cran.au.r-project.org/" 
> update.packages()
boot :
 Version 1.2-22 installed in C:/PROGRA~1/R/rw2011/library 
 Version 1.2-23 available at http://cran.au.r-project.org
Update (y/N/c)?  y
VR :
 Version 7.2-16 installed in C:/PROGRA~1/R/rw2011/library 
 Version 7.2-19 available at http://cran.au.r-project.org
Update (y/N/c)?  y
cluster :
 Version 1.10.0 installed in C:/PROGRA~1/R/rw2011/library 
 Version 1.10.1 available at http://cran.au.r-project.org
Update (y/N/c)?  y
foreign :
 Version 0.8-8 installed in C:/PROGRA~1/R/rw2011/library 
 Version 0.8-10 available at http://cran.au.r-project.org
Update (y/N/c)?  y
lattice :
 Version 0.11-8 installed in C:/PROGRA~1/R/rw2011/library 
 Version 0.12-5 available at http://cran.au.r-project.org
Update (y/N/c)?  y
mgcv :
 Version 1.3-1 installed in C:/PROGRA~1/R/rw2011/library 
 Version 1.3-6 available at http://cran.au.r-project.org
Update (y/N/c)?  y
nlme :
 Version 3.1-60 installed in C:/PROGRA~1/R/rw2011/library 
 Version 3.1-64 available at http://cran.au.r-project.org
Update (y/N/c)?  y
trying URL 'http://cran.au.r-project.org/bin/windows/contrib/2.1/boot_1.2-23.zip'
Content type 'application/zip' length 767814 bytes
opened URL
downloaded 749Kb

trying URL 'http://cran.au.r-project.org/bin/windows/contrib/2.1/VR_7.2-19.zip'
Content type 'application/zip' length 1575000 bytes
opened URL
downloaded 1538Kb

trying URL 'http://cran.au.r-project.org/bin/windows/contrib/2.1/cluster_1.10.1.zip'
Content type 'application/zip' length 480389 bytes
opened URL
downloaded 469Kb

trying URL 'http://cran.au.r-project.org/bin/windows/contrib/2.1/foreign_0.8-10.zip'
Content type 'application/zip' length 176663 bytes
opened URL
downloaded 172Kb

trying URL 'http://cran.au.r-project.org/bin/windows/contrib/2.1/lattice_0.12-5.zip'
Content type 'application/zip' length 713040 bytes
opened URL
downloaded 696Kb

trying URL 'http://cran.au.r-project.org/bin/windows/contrib/2.1/mgcv_1.3-6.zip'
Content type 'application/zip' length 795159 bytes
opened URL
downloaded 776Kb

trying URL 'http://cran.au.r-project.org/bin/windows/contrib/2.1/nlme_3.1-64.zip'
Content type 'application/zip' length 2142405 bytes
opened URL
downloaded 2092Kb

package 'boot' successfully unpacked and MD5 sums checked
bundle 'VR' successfully unpacked and MD5 sums checked
Error: cannot remove prior installation of package 'MASS'
> search()
 [1] ".GlobalEnv"        "package:MASS"      "package:methods"  
 [4] "package:stats"     "package:graphics"  "package:grDevices"
 [7] "package:utils"     "package:datasets"  "Autoloads"        
[10] "package:base"     
> detach(2)
> update.packages()
VR :
 Version 7.2-16 installed in C:/PROGRA~1/R/rw2011/library 
 Version 7.2-19 available at http://cran.au.r-project.org
Update (y/N/c)?  y
cluster :
 Version 1.10.0 installed in C:/PROGRA~1/R/rw2011/library 
 Version 1.10.1 available at http://cran.au.r-project.org
Update (y/N/c)?  y
foreign :
 Version 0.8-8 installed in C:/PROGRA~1/R/rw2011/library 
 Version 0.8-10 available at http://cran.au.r-project.org
Update (y/N/c)?  y
lattice :
 Version 0.11-8 installed in C:/PROGRA~1/R/rw2011/library 
 Version 0.12-5 available at http://cran.au.r-project.org
Update (y/N/c)?  y
mgcv :
 Version 1.3-1 installed in C:/PROGRA~1/R/rw2011/library 
 Version 1.3-6 available at http://cran.au.r-project.org
Update (y/N/c)?  y
nlme :
 Version 3.1-60 installed in C:/PROGRA~1/R/rw2011/library 
 Version 3.1-64 available at http://cran.au.r-project.org
Update (y/N/c)?  y
trying URL 'http://cran.au.r-project.org/bin/windows/contrib/2.1/VR_7.2-19.zip'
Content type 'application/zip' length 1575000 bytes
opened URL
downloaded 1538Kb

trying URL 'http://cran.au.r-project.org/bin/windows/contrib/2.1/cluster_1.10.1.zip'
Content type 'application/zip' length 480389 bytes
opened URL
downloaded 469Kb

trying URL 'http://cran.au.r-project.org/bin/windows/contrib/2.1/foreign_0.8-10.zip'
Content type 'application/zip' length 176663 bytes
opened URL
downloaded 172Kb

trying URL 'http://cran.au.r-project.org/bin/windows/contrib/2.1/lattice_0.12-5.zip'
Content type 'application/zip' length 713040 bytes
opened URL
downloaded 696Kb

trying URL 'http://cran.au.r-project.org/bin/windows/contrib/2.1/mgcv_1.3-6.zip'
Content type 'application/zip' length 795159 bytes
opened URL
downloaded 776Kb

trying URL 'http://cran.au.r-project.org/bin/windows/contrib/2.1/nlme_3.1-64.zip'
Content type 'application/zip' length 2142405 bytes
opened URL
downloaded 2092Kb

bundle 'VR' successfully unpacked and MD5 sums checked
Error: cannot remove prior installation of package 'MASS'
> search()
[1] ".GlobalEnv"        "package:methods"   "package:stats"    
[4] "package:graphics"  "package:grDevices" "package:utils"    
[7] "package:datasets"  "Autoloads"         "package:base"     
>


From gb at stat.umu.se  Mon Aug 29 15:34:09 2005
From: gb at stat.umu.se (=?iso-8859-1?Q?G=F6ran_Brostr=F6m?=)
Date: Mon, 29 Aug 2005 15:34:09 +0200
Subject: [Rd] BLAS and ATLAS
Message-ID: <20050829133409.GB3471@stat.umu.se>

On Mon, Aug 29, 2005 at 11:48:23AM +0100, Prof Brian Ripley wrote:
> On Mon, 29 Aug 2005, G?ran Brostr?m wrote:

> >LAPACK/BLAS routines call xerbla "if an input parameter has an
> >invalid value" (exact quote from  XERBLA at Netlib). Other types of errors
> >are not printed (by xerbla), but it is up to the user to check the return
> >value of the argument 'INFO'. See
> >http://www.netlib.org/lapack/lug/node119.html.
> 
> Maybe, that is not actually true for real-life LAPACK implementations, as 
> I did say.
> 
> >So we can safely give the more informative, original, error messages,
> >together with mentioning LAPACK and eventually BLAS, whatever you prefer.
> >This would "make clear what these refer to". Given that other BLAS/LAPACK
> >routines than xerbla aren't changed in R, of course.
> 
> Irrelevant as R is often compiled against other ones implementations.

That confuses me. My R installation (R-devel of yesterday) is compiled
against ATLAS BLAS (from Debian-unstable). Why, then, is xerbla from  R  
sources used anyway? 

G?ran


From simon.urbanek at r-project.org  Mon Aug 29 15:41:35 2005
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Mon, 29 Aug 2005 09:41:35 -0400
Subject: [Rd] RServe initialization problem
In-Reply-To: <4312dc01.3d085e91.330e.4f87@mx.gmail.com>
References: <4312dc01.3d085e91.330e.4f87@mx.gmail.com>
Message-ID: <A64D9E66-3E5F-421E-9046-6FF386CE2044@r-project.org>

Joel,

On Aug 29, 2005, at 5:57 AM, joelarrais wrote:

> I want to use the R functionalities in my Java program. I found the  
> Rserve
> that appear to suite my requirements but I'm facing some configuration
> problems.
>
> I' following the web page tutorial
> (http://stats.math.uni-augsburg.de/Rserve/doc.shtml) but I face the  
> above
> problem:
>
> C:\Program Files\R\rw2010\bin>R CMD RSERVE
>
> Can't open perl script "C:\PROGRA~1\R\rw2010/bin/RSERVE": No such  
> file or
> directory

You are using Windows, not unix, so should be just running Rserve.exe  
- please see the documentation, it specifically distinguishes Windows  
from unix. You may also consider reading the release notes for the  
Windows version of Rserve that discuss the differences.

Cheers,
Simon


From ripley at stats.ox.ac.uk  Mon Aug 29 15:43:28 2005
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 29 Aug 2005 14:43:28 +0100 (BST)
Subject: [Rd] BLAS and ATLAS
In-Reply-To: <20050829133409.GB3471@stat.umu.se>
References: <20050829133409.GB3471@stat.umu.se>
Message-ID: <Pine.LNX.4.61.0508291442001.5510@gannet.stats>

On Mon, 29 Aug 2005, G?ran Brostr?m wrote:

> On Mon, Aug 29, 2005 at 11:48:23AM +0100, Prof Brian Ripley wrote:
>> On Mon, 29 Aug 2005, G?ran Brostr?m wrote:
>
>>> LAPACK/BLAS routines call xerbla "if an input parameter has an
>>> invalid value" (exact quote from  XERBLA at Netlib). Other types of errors
>>> are not printed (by xerbla), but it is up to the user to check the return
>>> value of the argument 'INFO'. See
>>> http://www.netlib.org/lapack/lug/node119.html.
>>
>> Maybe, that is not actually true for real-life LAPACK implementations, as
>> I did say.
>>
>>> So we can safely give the more informative, original, error messages,
>>> together with mentioning LAPACK and eventually BLAS, whatever you prefer.
>>> This would "make clear what these refer to". Given that other BLAS/LAPACK
>>> routines than xerbla aren't changed in R, of course.
>>
>> Irrelevant as R is often compiled against other ones implementations.
>
> That confuses me. My R installation (R-devel of yesterday) is compiled
> against ATLAS BLAS (from Debian-unstable). Why, then, is xerbla from  R
> sources used anyway?

Because it is the only one seen: ATLAS does not provide it.  There is no 
guarantee that ATLAS or libsunperf or vecLib ... only use xerbla in the 
meaning in that page.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From simon.urbanek at r-project.org  Mon Aug 29 15:45:40 2005
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Mon, 29 Aug 2005 09:45:40 -0400
Subject: [Rd] FW: RServe initialization problem
In-Reply-To: <4312dd8b.05c7373e.6198.ffff9afc@mx.gmail.com>
References: <4312dd8b.05c7373e.6198.ffff9afc@mx.gmail.com>
Message-ID: <C1C7FE5A-9A01-4F1E-AB1D-343E94EBA9A9@r-project.org>

On Aug 29, 2005, at 6:04 AM, joelarrais wrote:

> I want to use the R functionalities in my Java program. I found the  
> Rserve
> that appear to suite my requirements but I'm facing some configuration
> problems.
> I' following the web page tutorial
> (http://stats.math.uni-augsburg.de/Rserve/doc.shtml) but I face the  
> above
> problem:
>
> C:\Program Files\R\rw2010\bin>R CMD RSERVE
> Can't open perl script "C:\PROGRA~1\R\rw2010/bin/RSERVE": No such  
> file or
> directory

I'm not quite sure why this e-mail was also sent to the R-devel,  
please see the posting guide!

Also a closer look at the documentation you mention would reveal that  
it strictly distinguishes between unix and Windows systems - on the  
latter you have to run the Rserve.exe application instead of using R  
CMD xxx.

Cheers,
Simon


From Friedrich.Leisch at tuwien.ac.at  Mon Aug 29 16:19:15 2005
From: Friedrich.Leisch at tuwien.ac.at (Friedrich.Leisch@tuwien.ac.at)
Date: Mon, 29 Aug 2005 16:19:15 +0200
Subject: [Rd] Additional Books on R for Web Site Listing
In-Reply-To: <1125268224.18760.50.camel@localhost.localdomain>
References: <1125268224.18760.50.camel@localhost.localdomain>
Message-ID: <17171.6499.286829.694370@galadriel.ci.tuwien.ac.at>

>>>>> On Sun, 28 Aug 2005 17:30:24 -0500,
>>>>> Marc Schwartz (MS) wrote:

  > Hi all,
  > I noted that the books below are not included on the R web site
  > Documentation section under "Books". I thought that I would provide
  > these and have created some bib entries consistent with the style used
  > on the site. The abstract sections were copied from the publisher
  > sites.

Thanks a lot, I have added them to the list (will go live later
today).

Best,
Fritz

-- 
-------------------------------------------------------------------
                        Friedrich Leisch 
Institut f?r Statistik                     Tel: (+43 1) 58801 10715
Technische Universit?t Wien                Fax: (+43 1) 58801 10798
Wiedner Hauptstra?e 8-10/1071
A-1040 Wien, Austria             http://www.ci.tuwien.ac.at/~leisch


From harrismic at mail.nih.gov  Mon Aug 29 16:24:25 2005
From: harrismic at mail.nih.gov (Harris, Michael (NIH/NCI) [E])
Date: Mon, 29 Aug 2005 10:24:25 -0400
Subject: [Rd] Compile warning in unique.c
Message-ID: <75DDD376F2B6B546B722398AC161106C1384922B@nihexchange2.nih.gov>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20050829/488740be/attachment.pl

From ripley at stats.ox.ac.uk  Mon Aug 29 16:32:38 2005
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 29 Aug 2005 15:32:38 +0100 (BST)
Subject: [Rd] Compile warning in unique.c
In-Reply-To: <75DDD376F2B6B546B722398AC161106C1384922B@nihexchange2.nih.gov>
References: <75DDD376F2B6B546B722398AC161106C1384922B@nihexchange2.nih.gov>
Message-ID: <Pine.LNX.4.61.0508291528360.5510@gannet.stats>

On Mon, 29 Aug 2005, Harris, Michael (NIH/NCI) [E] wrote:

> I am getting a compile warning when building R from source.  I am building
> on a AMD64 Opteron system  with  gcc (GCC) 3.3.3 (SuSE Linux)
>
> The warning is:
>
>            unique.c: In function `cshash':
>
> unique.c:1146: warning: cast from pointer to integer of different size

Have you bothered to read the code?  The comment there should explain this 
to you.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From tlumley at u.washington.edu  Mon Aug 29 16:37:08 2005
From: tlumley at u.washington.edu (Thomas Lumley)
Date: Mon, 29 Aug 2005 07:37:08 -0700 (PDT)
Subject: [Rd] Compile warning in unique.c
In-Reply-To: <75DDD376F2B6B546B722398AC161106C1384922B@nihexchange2.nih.gov>
References: <75DDD376F2B6B546B722398AC161106C1384922B@nihexchange2.nih.gov>
Message-ID: <Pine.A41.4.61b.0508290733180.156102@homer05.u.washington.edu>

On Mon, 29 Aug 2005, Harris, Michael (NIH/NCI) [E] wrote:
>
> I am getting a compile warning when building R from source.  I am building
> on a AMD64 Opteron system  with  gcc (GCC) 3.3.3 (SuSE Linux)
>
> The warning is:
>
>            unique.c: In function `cshash':
>
> unique.c:1146: warning: cast from pointer to integer of different size
>

The comment immediately above this suggests that it is deliberate

  /* Use hashing to improve object.size. Here we want equal CHARSXPs,
     not equal contents.  This only uses the bottom 32 bits of the pointer,
     but for now that's almost certainly OK */

The warning is presumably because casting this int back to a pointer would 
fail (and is a common 32 to 64bit conversion error), but that's not what 
is happening here.

 	-thomas


From gb at stat.umu.se  Mon Aug 29 16:41:11 2005
From: gb at stat.umu.se (=?iso-8859-1?Q?G=F6ran_Brostr=F6m?=)
Date: Mon, 29 Aug 2005 16:41:11 +0200
Subject: [Rd] BLAS and ATLAS
In-Reply-To: <Pine.LNX.4.61.0508291442001.5510@gannet.stats>
References: <20050829133409.GB3471@stat.umu.se>
	<Pine.LNX.4.61.0508291442001.5510@gannet.stats>
Message-ID: <20050829144111.GA19035@stat.umu.se>

On Mon, Aug 29, 2005 at 02:43:28PM +0100, Prof Brian Ripley wrote:
> On Mon, 29 Aug 2005, G?ran Brostr?m wrote:
> 
> >On Mon, Aug 29, 2005 at 11:48:23AM +0100, Prof Brian Ripley wrote:
> >>On Mon, 29 Aug 2005, G?ran Brostr?m wrote:
> >
> >>>LAPACK/BLAS routines call xerbla "if an input parameter has an
> >>>invalid value" (exact quote from  XERBLA at Netlib). Other types of 
> >>>errors
> >>>are not printed (by xerbla), but it is up to the user to check the return
> >>>value of the argument 'INFO'. See
> >>>http://www.netlib.org/lapack/lug/node119.html.
> >>
> >>Maybe, that is not actually true for real-life LAPACK implementations, as
> >>I did say.
> >>
> >>>So we can safely give the more informative, original, error messages,
> >>>together with mentioning LAPACK and eventually BLAS, whatever you prefer.
> >>>This would "make clear what these refer to". Given that other BLAS/LAPACK
> >>>routines than xerbla aren't changed in R, of course.
> >>
> >>Irrelevant as R is often compiled against other ones implementations.
> >
> >That confuses me. My R installation (R-devel of yesterday) is compiled
> >against ATLAS BLAS (from Debian-unstable). Why, then, is xerbla from  R
> >sources used anyway?
> 
> Because it is the only one seen: ATLAS does not provide it.  There is no 
> guarantee that ATLAS or libsunperf or vecLib ... only use xerbla in the 
> meaning in that page.

Well, the ATLAS sources contain 'xerbla.f'. So what does 'does not provide 
it' mean? Not included in the build process?

G?ran


From cpaulse at aecom.yu.edu  Mon Aug 29 16:52:16 2005
From: cpaulse at aecom.yu.edu (Chris Paulse)
Date: Mon, 29 Aug 2005 10:52:16 -0400
Subject: [Rd] floating point control on windows
Message-ID: <20050829145230.73A0E2FCB@post.aecom.yu.edu>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20050829/54e0bd8b/attachment.pl

From jpa at ieeta.pt  Mon Aug 29 17:17:41 2005
From: jpa at ieeta.pt (Joel Arrais)
Date: Mon, 29 Aug 2005 16:17:41 +0100
Subject: [Rd] Rserve seem to be working but it doesn't
Message-ID: <auto-000010393443@frontend1.cgpmail.ua.pt>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20050829/67b7e28d/attachment.pl

From deepayan at stat.wisc.edu  Mon Aug 29 17:35:47 2005
From: deepayan at stat.wisc.edu (Deepayan Sarkar)
Date: Mon, 29 Aug 2005 10:35:47 -0500
Subject: [Rd] Fwd: segfault
In-Reply-To: <Pine.LNX.4.61.0508290930250.29579@gannet.stats>
References: <p06230901bf3759687fd6@[84.173.69.150]>
	<AE67BE22-269F-4ED4-A6E3-D800A1F91496@mclink.it>
	<Pine.LNX.4.61.0508290930250.29579@gannet.stats>
Message-ID: <200508291035.47824.deepayan@stat.wisc.edu>

On Monday 29 August 2005 03:35, Prof Brian Ripley wrote:
> It does not crash for me on either Windows or Linux, but it does take a
> long time and the plot is a mess, so there does seem to be a
> lattice-related problem (maybe a usage one).

It is improper (or at least unanticipated) usage. The example cited does not 
crash X11 on GNU/Linux for me, but the following does:

wireframe(F ~ x * p, bt, groups = factor(p), shade=TRUE) 

This involves some C code in lattice, which could well be the culprit. I'll 
clarify the documentation, but I'm not sure how easy it would be to catch the 
bug.

Deepayan

> However, I think the crash is a Mac (presumably quartz()) problem.
>
> On Mon, 29 Aug 2005, stefano iacus wrote:
> > This segfaults on OS X (10.4) on both X11 and quartz devices.
> > Seems a problem with lattice but I cannot test on other platforms
> > stefano
> >
> > Begin forwarded message:
> >> From: "G. Sawitzki" <gs at statlab.uni-heidelberg.de>
> >> Date: 28 agosto 2005 14:11:18 GMT+02:00
> >> To: jago at mclink.it
> >>
> >>
> >> Dear Stefano,
> >>
> >>  this small exaple leads to a crash of R. I did not try it on
> >> versions other than the Mac version. So I am sending it to you
> >> directly. If it is a littice problem, could you pass it to Deepayan
> >> Sarkar? Thank you.
> >>
> >>   g.
> >>
> >> ==
> >> #pbinom
> >> library(grid)
> >> library(lattice)
> >>
> >> n<-20
> >> psteps<-50
> >> binomtable<- function (n,psteps){
> >> x<-(0:(10*n))/10
> >> p<- (0:psteps)/psteps
> >> dd<-expand.grid(x=x,p=p)
> >> dd$F<- pbinom(dd$x,n,dd$p)
> >> dd$x0<-trunc(dd$x)
> >> dd
> >> }
> >>
> >> bt<-binomtable(n=5,psteps=100)
> >> bt[bt$x-bt$x0>=0.9,]$F<-NA
> >> wireframe(bt$F~bt$x*bt$p,bt,groups=bt$x0,shade=TRUE) # leads to R
> >> crash
> >> #wireframe(bt$F~bt$x*bt$p,bt,shade=TRUE) #ok


From ripley at stats.ox.ac.uk  Mon Aug 29 17:53:05 2005
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 29 Aug 2005 16:53:05 +0100 (BST)
Subject: [Rd] floating point control on windows
In-Reply-To: <20050829145230.73A0E2FCB@post.aecom.yu.edu>
References: <20050829145230.73A0E2FCB@post.aecom.yu.edu>
Message-ID: <Pine.LNX.4.61.0508291646030.7232@gannet.stats>

We recommend calling Rwin_fpset() which is exported by R.dll and is known
to do the trick.  As it contains

     _controlfp(_PC_64, _MCW_PC);

it may be that the args you used are incorrect (and I am not on Windows 
to check the docs, but note that is the form used in the URL you cite).

On Mon, 29 Aug 2005, Chris Paulse wrote:

> Hi,
>
> I'm sure that this question has come up many times before.  When I load an R
> extension dll I've built with the Microsoft compiler, I get the warning:

> Warning message:
>
> DLL attempted to change FPU control word from 8001f to 9001f
>
> So, what I did to try to fix the problem (to my knowledge, Microsoft will
> not support compile time switching of floating point control until version
> 8.0 of their compiler - see: http://blogs.msdn.com/ericflee) was to place
> the following statement inside R_init_mylib:

> _controlfp(_MCW_PC, _PC_64); // use extended precision for operations in x87
> FPU
>
> This didn't fix my problem.  I ended up sprinkling these liberally
> throughout my code, but that didn't help.  One thing I do like about the
> Microsoft compiler is the debugging facility.  But, I'll definitely switch
> to gcc if this is necessary to get rid of the problem.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From cpaulse at aecom.yu.edu  Mon Aug 29 18:23:29 2005
From: cpaulse at aecom.yu.edu (Chris Paulse)
Date: Mon, 29 Aug 2005 12:23:29 -0400
Subject: [Rd] floating point control on windows
In-Reply-To: <Pine.LNX.4.61.0508291646030.7232@gannet.stats>
Message-ID: <20050829162340.73C822FC9@post.aecom.yu.edu>

Thanks for the guidance.

Using the following code fixed my problem:

#ifdef _WIN32
BOOL APIENTRY DllMain( HANDLE hModule, 
                       DWORD  ul_reason_for_call, 
                       LPVOID lpReserved
					 )
{
	if (ul_reason_for_call == DLL_PROCESS_ATTACH)
	{
		Rwin_fpset();
	}

    return TRUE;
}
#endif

-----Original Message-----
From: Prof Brian Ripley [mailto:ripley at stats.ox.ac.uk] 
Sent: Monday, August 29, 2005 10:53 AM
To: Chris Paulse
Cc: r-devel at r-project.org
Subject: Re: [Rd] floating point control on windows

We recommend calling Rwin_fpset() which is exported by R.dll and is known
to do the trick.  As it contains

     _controlfp(_PC_64, _MCW_PC);

it may be that the args you used are incorrect (and I am not on Windows 
to check the docs, but note that is the form used in the URL you cite).

On Mon, 29 Aug 2005, Chris Paulse wrote:

> Hi,
>
> I'm sure that this question has come up many times before.  When I load an
R
> extension dll I've built with the Microsoft compiler, I get the warning:

> Warning message:
>
> DLL attempted to change FPU control word from 8001f to 9001f
>
> So, what I did to try to fix the problem (to my knowledge, Microsoft will
> not support compile time switching of floating point control until version
> 8.0 of their compiler - see: http://blogs.msdn.com/ericflee) was to place
> the following statement inside R_init_mylib:

> _controlfp(_MCW_PC, _PC_64); // use extended precision for operations in
x87
> FPU
>
> This didn't fix my problem.  I ended up sprinkling these liberally
> throughout my code, but that didn't help.  One thing I do like about the
> Microsoft compiler is the debugging facility.  But, I'll definitely switch
> to gcc if this is necessary to get rid of the problem.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From Robert.McGehee at geodecapital.com  Mon Aug 29 19:39:51 2005
From: Robert.McGehee at geodecapital.com (Robert.McGehee@geodecapital.com)
Date: Mon, 29 Aug 2005 19:39:51 +0200 (CEST)
Subject: [Rd] Problems setting and adding POSIX dates (PR#8103)
Message-ID: <20050829173951.1A7301994C@slim.kubism.ku.dk>

> tm <- ISOdate(2005, 08, 29, hour =3D 12, tz =3D "EDT")
> tm
[1] "2005-08-29 11:00:00 EDT"
## Firstly, notice that the hour is 11, but was set to 12.

> tm + 0
[1] "2005-08-29 11:00:00 EDT"
> tm + 3600  ## Add an hour
[1] "2005-08-29 12:00:00 EDT"

> tm + c(0, 1) * 3600  ## Repeat
[1] "2005-08-29 07:00:00 Eastern Daylight Time"
[2] "2005-08-29 08:00:00 Eastern Daylight Time"

Oddly, the first two results differ from the second two by 4 hours.

> version
         _             =20
platform i386-pc-mingw32
arch     i386          =20
os       mingw32       =20
system   i386, mingw32 =20
status                 =20
major    2             =20
minor    1.1           =20
year     2005          =20
month    06            =20
day      20            =20
language R            =20



Robert McGehee
Quantitative Analyst
Geode Capital Management, LLC
53 State Street, 5th Floor | Boston, MA | 02109
Tel: 617/392-8396    Fax:617/476-6389
mailto:robert.mcgehee at geodecapital.com



This e-mail, and any attachments hereto, are intended for us...{{dropped}}


From bullard at berkeley.edu  Mon Aug 29 20:15:28 2005
From: bullard at berkeley.edu (James Bullard)
Date: Mon, 29 Aug 2005 11:15:28 -0700
Subject: [Rd] Question about SET_LENGTH
Message-ID: <431350C0.8030804@berkeley.edu>

Hello all, thanks for all the help on the other issues. This one should
be relatively straightforward. I have a vector of integers which I
allocate to be the maximal size possible (meaning I'll never see more
than cel.GetNumOutliers, but most likely I'll see less) therefore, I
want to resize the vector, one solution would be to allocate a new
vector then to copy into the new vector. That is what I was going to do
until I saw the SET_LENGTH macro. Does this macro effectively take care
of the memory? Is this an acceptable use of the macro? The code works,
but I dont want any lurking memory problems.


PROTECT(outliers = NEW_INTEGER(cel.GetNumOutliers()));

 if (i_readOutliers != 0) {
     if (noutlier == 0) {
        outliers = R_NilValue;
      }
      else if (noutlier < cel.GetNumOutliers()) {
        SET_LENGTH(outliers, noutlier);
      }
 }


Thanks as always!

jim


From ripley at stats.ox.ac.uk  Mon Aug 29 20:17:03 2005
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 29 Aug 2005 19:17:03 +0100 (BST)
Subject: [Rd] efficiency of sample() with prob.
In-Reply-To: <6ea7b54305062314375200f7d9@mail.gmail.com>
References: <C698D707214E6F4AB39AB7096C3DE5A5AB5031@phost015.EVAFUNDS.intermedia.net>
	<6ea7b54305062211146473e7bf@mail.gmail.com>
	<Pine.LNX.4.61.0506222005080.3592@gannet.stats>
	<6ea7b54305062314375200f7d9@mail.gmail.com>
Message-ID: <Pine.LNX.4.61.0508291607080.6766@gannet.stats>

Peter Windridge and I investigated this further.  It seems the 
distribution used for your tests is maximally favourable to your proposal 
(not uncommon in papers, but not very honest).  There are examples in 
which the existing method is substantially faster than Walker's (when each 
set of prob is used only a few times and there are many sets) and only a 
few areas in which there are large gains to be had.  For example, with 
binomial(N=10000, p=0.25) Walker's method is not twice as fast, and 10 
million samples only take a second or two.  (Tabulating them takes quite a 
bit longer.)  OTOH, with a distribution concentrated on 5 out of 10000 
points, the existing method is twice as fast.

Changing how this is done will break the reproducibility of past programs, 
and we don't really want to introduce yet more options.  So it seems only 
worth doing when there are substantial speed gains.  I am still tuning 
this, but it seems that it is worthwhile if the number of probs >= 0.1/N 
is more than 200 or so.  The advantage of Walker's method is that its 
speed is more-or-less independent of probs (unless they are actually all 
identical!), but equally that can be a disadvantage.


On Thu, 23 Jun 2005, Bo Peng wrote:

>> We suggest that you take up your own suggestion, research this area and
>> offer the R project the results of your research for consideration as your
>> contribution.
>
> I implemented Walker's alias method and re-compiled R. Here is what
> I did:

[...]

>
>> b=sample(seq(1,100), prob=seq(1,100), replace=TRUE, size=1000000)
>> table(b)/1000000*sum(seq(1,100))
>
> 4. run the following code in current R 2.1.0 and updated R.
>
> for(prob in seq(1,4)){
>  for(sample in seq(1,4)){
>    x = seq(1:(10^prob))   # short to long x
>    p = abs(rnorm(length(x)))  # prob vector
>    times = 10^(6-prob)   # run shorter cases more times
>    Rprof(paste("sample_", prob, "_", sample, ".prof", sep=''))
>    for(t in seq(1,times)){
>      sample(x, prob=p, size=10^sample, replace=TRUE )
>    }
>    Rprof(NULL)
>  }
> }
>
> Basically, I tried to test the performance of sample(replace=TRUE, prob=..)
> with different length of x and size.
>
> 5. process the profiles and here is the result.
> p: length of prob and x
> size: size of sample
> cell: execution time of old/updated sample()
>
>  size\p    10          10^2        10^3       10^4
>  10       2.4/1.6      0.32/0.22   0.20/0.08  0.24/0.06
>  10^2     3.1/2.6      0.48/0.28   0.28/0.06  0.30/0.06
>  10^3     11.8/11.1    1.84/1.14   0.94/0.18  0.96/0.08
>  10^4     96.8/96.6    15.34/9.68  7.54/1.06  7.48/0.16
>  run:     10000        1000        100        10 times
>
> We can see that the alias method is quicker than the linear search
> method in all cases. The performance difference is greatest (>50 times)
> when the original algorithm need to search in a long prob vector.
>
> I have not thoroughly tested the new function. I will do so if you
> (the developers) think that this has the potential to be incorporated
> into R.
>
> Thanks.
>
> Bo Peng
> Department of Statistics
> Rice University
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From dhinds at sonic.net  Mon Aug 29 20:16:26 2005
From: dhinds at sonic.net (dhinds@sonic.net)
Date: Mon, 29 Aug 2005 18:16:26 +0000 (UTC)
Subject: [Rd] floating point control on windows
References: <20050829145230.73A0E2FCB@post.aecom.yu.edu>
Message-ID: <devjdq$3f3$2@sea.gmane.org>

Chris Paulse <cpaulse at aecom.yu.edu> wrote:
> Hi,

> I'm sure that this question has come up many times before.  When I load an R
> extension dll I've built with the Microsoft compiler, I get the warning:

> Warning message:

> DLL attempted to change FPU control word from 8001f to 9001f

I think maybe most parsimonious/simple fix for this problem is to add
"fp10.obj" to the link line for your code.  This file is provided by
Microsoft to flip the precision of the run time library to 80 bits.
The linker should find it automatically.

http://msdn.microsoft.com/library/en-us/vclib/html/_crt_floating.2d.point_support.asp

-- David Hinds


From ripley at stats.ox.ac.uk  Mon Aug 29 20:41:03 2005
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 29 Aug 2005 19:41:03 +0100 (BST)
Subject: [Rd] Question about SET_LENGTH
In-Reply-To: <431350C0.8030804@berkeley.edu>
References: <431350C0.8030804@berkeley.edu>
Message-ID: <Pine.LNX.4.61.0508291935170.9690@gannet.stats>

SET_LENGTH is in Rdefines.h (you did not say).  It is a wrapper for

 	x = lengthgets(x, n)

and that will do what you want.  HOWEVER, you have changed x and the 
object it points to, so you do need to worry about re-protection.
So, I think that macro is rather dangerous (and it is not the only danger 
lurking in Rdefines.h, which provides no valid way to assign elements of 
character strings or lists any more).

Look and see how lengthgets is used in the R sources.

On Mon, 29 Aug 2005, James Bullard wrote:

> Hello all, thanks for all the help on the other issues. This one should
> be relatively straightforward. I have a vector of integers which I
> allocate to be the maximal size possible (meaning I'll never see more
> than cel.GetNumOutliers, but most likely I'll see less) therefore, I
> want to resize the vector, one solution would be to allocate a new
> vector then to copy into the new vector. That is what I was going to do
> until I saw the SET_LENGTH macro. Does this macro effectively take care
> of the memory? Is this an acceptable use of the macro? The code works,
> but I dont want any lurking memory problems.
>
>
> PROTECT(outliers = NEW_INTEGER(cel.GetNumOutliers()));
>
> if (i_readOutliers != 0) {
>     if (noutlier == 0) {
>        outliers = R_NilValue;
>      }
>      else if (noutlier < cel.GetNumOutliers()) {
>        SET_LENGTH(outliers, noutlier);
>      }
> }

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From rbug05 at kreil.org  Mon Aug 29 21:54:07 2005
From: rbug05 at kreil.org (rbug05@kreil.org)
Date: Mon, 29 Aug 2005 21:54:07 +0200 (CEST)
Subject: [Rd] test for readline installation fails if installation location
	non-standard (PR#8104)
Message-ID: <20050829195407.111441994D@slim.kubism.ku.dk>

Full_Name: D Kreil
Version: 2.1.1
OS: HP-UX B.11.23 U ia64 0029870451 unlimited-user license
Submission from: (NULL) (62.178.15.60)


When the dependency readline is installed in a non-standard location the
installation procedure fails.
If using a non-standard installation location like

  --prefix=/bi/common --exec-prefix=/bi/arch

the configure script default include and library paths should adapt accordingly.
They don't (/usr/local defaults remain).

Workaround:

  CPPFLAGS=-I/bi/common/include LDFLAGS=-L/bi/arch/lib ./configure

This should not be necessary, I think.

Best regards,

D Kreil.


From p.dalgaard at biostat.ku.dk  Mon Aug 29 22:59:24 2005
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: 29 Aug 2005 22:59:24 +0200
Subject: [Rd] test for readline installation fails if installation
	location non-standard (PR#8104)
In-Reply-To: <20050829195407.111441994D@slim.kubism.ku.dk>
References: <20050829195407.111441994D@slim.kubism.ku.dk>
Message-ID: <x2y86kmpcj.fsf@turmalin.kubism.ku.dk>

rbug05 at kreil.org writes:

> Full_Name: D Kreil
> Version: 2.1.1
> OS: HP-UX B.11.23 U ia64 0029870451 unlimited-user license
> Submission from: (NULL) (62.178.15.60)
> 
> 
> When the dependency readline is installed in a non-standard location the
> installation procedure fails.
> If using a non-standard installation location like
> 
>   --prefix=/bi/common --exec-prefix=/bi/arch
> 
> the configure script default include and library paths should adapt accordingly.
> They don't (/usr/local defaults remain).
> 
> Workaround:
> 
>   CPPFLAGS=-I/bi/common/include LDFLAGS=-L/bi/arch/lib ./configure
> 
> This should not be necessary, I think.

This is inherited from GNU autotools and apparently they think it
should. It is most certainly not a bug.

Presumably, the rationale is that the install target is not
necessarily releated to your build tools and libraries. You could have
--prefix=. or --prefix=$HOME/tools or whatever. If so, there is some
danger of picking up a home-built and outdated version instead of the
system one.

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From boku at kreil.org  Mon Aug 29 23:03:26 2005
From: boku at kreil.org (boku@kreil.org)
Date: Mon, 29 Aug 2005 23:03:26 +0200 (CEST)
Subject: [Rd] test for readline installation fails if installation
	(PR#8105)
Message-ID: <20050829210326.D3C5219943@slim.kubism.ku.dk>


Dear Peter,

Fair enough. For many people who install R without root rights, however, this 
is a first stumbling block so perhaps it might be worthwhile adding it to an 
"Installation how-to" document.

I found another hicup:

ld: Unsatisfied symbol "finite" in file colors.o

Fix: replace "finite" with R_FINITE in colors.c line 269.

Do you want this separately submitted via Jitterbug?

With best regards,

David.


---------------------------------------------------------------------------
Dr David Philip Kreil               
Research Fellow, Darwin College,  | WWTF Vienna Science Chair of
University of Cambridge           | Bioinformatics, Dept of Biotechnology,
++44 1223 764107, fax 7092 810040 | c/o IAM / BOKU, A-1190 Muthgasse 18
www.inference.phy.cam.ac.uk/dpk20 | ++43 1 360066830


From kreil at ebi.ac.uk  Mon Aug 29 23:03:16 2005
From: kreil at ebi.ac.uk (David Kreil)
Date: Mon, 29 Aug 2005 22:03:16 +0100
Subject: [Rd] test for readline installation fails if installation
 location non-standard (PR#8104)
In-Reply-To: Your message of "29 Aug 2005 22:59:24 +0200."
	<x2y86kmpcj.fsf@turmalin.kubism.ku.dk> 
Message-ID: <200508292103.j7TL3GS27233@parrot.ebi.ac.uk>


Dear Peter,

Fair enough. For many people who install R without root rights, however, this 
is a first stumbling block so perhaps it might be worthwhile adding it to an 
"Installation how-to" document.

I found another hicup:

ld: Unsatisfied symbol "finite" in file colors.o

Fix: replace "finite" with R_FINITE in colors.c line 269.

Do you want this separately submitted via Jitterbug?

With best regards,

David.


---------------------------------------------------------------------------
Dr David Philip Kreil               
Research Fellow, Darwin College,  | WWTF Vienna Science Chair of
University of Cambridge           | Bioinformatics, Dept of Biotechnology,
++44 1223 764107, fax 7092 810040 | c/o IAM / BOKU, A-1190 Muthgasse 18
www.inference.phy.cam.ac.uk/dpk20 | ++43 1 360066830


From rbug05 at kreil.org  Mon Aug 29 23:07:05 2005
From: rbug05 at kreil.org (rbug05@kreil.org)
Date: Mon, 29 Aug 2005 23:07:05 +0200 (CEST)
Subject: [Rd] Core dump during lazy loading of "survival" at installation
	time (PR#8106)
Message-ID: <20050829210705.2089B19943@slim.kubism.ku.dk>

Full_Name: D Kreil
Version: 2.1.1
OS: HP-UX B.11.23 U ia64 0029870451 unlimited-user license
Submission from: (NULL) (62.178.15.60)


I sadly get a core-dump during installation, when it tries to lazyload package
survival. Any idea what to do about this?

Best regards,
D.


...
include   -fPIC  -g -O2 -c survindex2.c -o survindex2.o
        gcc -I/bi/common/src/R-2.1.1/include  -I/bi/common/include
-I/usr/local/
include   -fPIC  -g -O2 -c survindex3.c -o survindex3.o
        gcc -I/bi/common/src/R-2.1.1/include  -I/bi/common/include
-I/usr/local/
include   -fPIC  -g -O2 -c survreg2.c -o survreg2.o
        gcc -I/bi/common/src/R-2.1.1/include  -I/bi/common/include
-I/usr/local/
include   -fPIC  -g -O2 -c survreg3.c -o survreg3.o
        gcc -I/bi/common/src/R-2.1.1/include  -I/bi/common/include
-I/usr/local/
include   -fPIC  -g -O2 -c survreg4.c -o survreg4.o
        gcc -I/bi/common/src/R-2.1.1/include  -I/bi/common/include
-I/usr/local/
include   -fPIC  -g -O2 -c survreg5.c -o survreg5.o
        gcc -shared -fPIC -Wl,-Bsymbolic -L/bi/arch/lib -L/usr/local/lib -o
surv
ival.sl agexact.o agfit2.o agfit3.o agfit5.o agfit_null.o agmart.o agmart2.o
ags
core.o agsurv1.o agsurv2.o agsurv3.o char_date.o chinv2.o chinv3.o cholesky2.o
c
holesky3.o chsolve2.o chsolve3.o cox_Rcallback.o coxdetail.o coxfit2.o
coxfit5.o
 coxmart.o coxph_wtest.o coxscho.o coxscore.o dmatrix.o doloop.o pyears1.o
pyear
s2.o pyears3.o pystep.o surv_callback.o survdiff2.o survfit2.o survfit3.o
survin
dex2.o survindex3.o survreg2.o survreg3.o survreg4.o survreg5.o   
** R
** data
**  moving datasets to lazyload DB
** inst
** preparing package for lazy loading
/bi/common/src/R-2.1.1/bin/INSTALL[325]: 3667 Memory fault(coredump)
ERROR: lazy loading failed for package 'survival'
** Removing '/bi/common/src/R-2.1.1/library/survival'
*** Error exit code 1

Stop.



My configuration is:

CPPFLAGS="-I/bi/common/include -I/usr/local/include" \
    LDFLAGS="-L/bi/arch/lib -L/usr/local/lib" ./configure \
    --prefix=/bi/common --exec-prefix=/bi/arch \
    --disable-mbcs 2>&1

(it won't compile at all without --disable-mbcs)


From rpeng at jhsph.edu  Mon Aug 29 23:23:02 2005
From: rpeng at jhsph.edu (rpeng@jhsph.edu)
Date: Mon, 29 Aug 2005 23:23:02 +0200 (CEST)
Subject: [Rd] test for readline installation fails if installation
	location (PR#8107)
Message-ID: <20050829212302.4944D19943@slim.kubism.ku.dk>

This is the kind of thing that goes in the 'config.site' file 
(which I believe is in fact documented).  The '--prefix' switch 
indicates where things should be installed.

-roger

rbug05 at kreil.org wrote:
> Full_Name: D Kreil
> Version: 2.1.1
> OS: HP-UX B.11.23 U ia64 0029870451 unlimited-user license
> Submission from: (NULL) (62.178.15.60)
> 
> 
> When the dependency readline is installed in a non-standard location the
> installation procedure fails.
> If using a non-standard installation location like
> 
>   --prefix=/bi/common --exec-prefix=/bi/arch
> 
> the configure script default include and library paths should adapt accordingly.
> They don't (/usr/local defaults remain).
> 
> Workaround:
> 
>   CPPFLAGS=-I/bi/common/include LDFLAGS=-L/bi/arch/lib ./configure
> 
> This should not be necessary, I think.
> 
> Best regards,
> 
> D Kreil.
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 

-- 
Roger D. Peng
http://www.biostat.jhsph.edu/~rpeng/


From rbug05 at kreil.org  Mon Aug 29 23:43:57 2005
From: rbug05 at kreil.org (rbug05@kreil.org)
Date: Mon, 29 Aug 2005 23:43:57 +0200 (CEST)
Subject: [Rd] "finite" vs "R_FINITE" in colors.c (PR#8108)
Message-ID: <20050829214357.A29E41994E@slim.kubism.ku.dk>

Full_Name: D Kreil
Version: 2.1.1
OS: HP-UX B.11.23 U ia64 0029870451 unlimited-user license
Submission from: (NULL) (62.178.15.60)


During compiliation, I get:

ld: Unsatisfied symbol "finite" in file colors.o

Fix: replace "finite" with R_FINITE in colors.c line 269.

I have, this time, searched through the R-admin.html, but not found a mention.
This is all a bit hard for me as I'm installing R as non-admin on a bare-bones
ia64 hpux system with no web browser, and a weird mix of libraries.
Nevertheless, the above seems to me like an innocent typo?

Best regards,

David.


From ben.bob at gmail.com  Tue Aug 30 00:03:06 2005
From: ben.bob at gmail.com (Bo Peng)
Date: Mon, 29 Aug 2005 15:03:06 -0700
Subject: [Rd] efficiency of sample() with prob.
In-Reply-To: <Pine.LNX.4.61.0508291607080.6766@gannet.stats>
References: <C698D707214E6F4AB39AB7096C3DE5A5AB5031@phost015.EVAFUNDS.intermedia.net>
	<6ea7b54305062211146473e7bf@mail.gmail.com>
	<Pine.LNX.4.61.0506222005080.3592@gannet.stats>
	<6ea7b54305062314375200f7d9@mail.gmail.com>
	<Pine.LNX.4.61.0508291607080.6766@gannet.stats>
Message-ID: <6ea7b54305082915037905dc2f@mail.gmail.com>

> It seems the distribution used for your tests is maximally favourable to 
> your proposal (not uncommon in papers, but not very honest).  

I did not have time to do a thorough test. I was simply reporting what
I had done so any implied dishonesty is unfair to me.

> Changing how this is done will break the reproducibility of past programs,
> and we don't really want to introduce yet more options.  So it seems only
> worth doing when there are substantial speed gains. 

I agree that Walker's method may be slow at some cases but there is
nothing to brag about R's current method either. The bottom line is: a
bisection method will be uniformly better than the linear search
method that R uses right now. This does not qualify as 'substantial
speed gain' though.

Cheers,
Bo


From bullard at berkeley.edu  Tue Aug 30 02:08:46 2005
From: bullard at berkeley.edu (James Bullard)
Date: Mon, 29 Aug 2005 17:08:46 -0700
Subject: [Rd] wchar and wstring. (followup question)
In-Reply-To: <Pine.LNX.4.61.0508271221090.2871@gannet.stats>
References: <430F9E0E.9020606@berkeley.edu>
	<Pine.LNX.4.61.0508271221090.2871@gannet.stats>
Message-ID: <4313A38E.7070404@berkeley.edu>

Thanks for all of the help with my previous posts. This question might
expose much of my ignorance when it comes to R's memory managment and
the responsibilities of the programmer, but I thought I had better ask
rather than continue in my ignorance.

I use the following code to create a multi-byte string in R from my wide
character string in C.

int str_length;
char* cstr;
   
str_length = cel.GetAlg().size();
cstr = Calloc(str_length, char);
wcstombs(cstr, cel.GetAlg().c_str(), str_length);
SET_STRING_ELT(names, i, mkChar("Algorithm"));
SET_VECTOR_ELT(vals, i++, mkString(cstr));
Free(cstr);

My first question is: do I need the Free? I looked at some of the
examples in main/character.c, but I could not decide whether or not I
needed it. I imagined (I could not find the source for this function)
that mkString made a copy so I thought I would clean up my copy, but if
this is not the case then I would assume the Free would be wrong.

My second question is: It was pointed out to me that it would be more
natural to use this code:

SET_STRING_ELT(vals, i++, mkChar(header.GetHeader().c_str()));

instead of:

SET_VECTOR_ELT(vals, i++, mkString(header.GetHeader().c_str()));

However, the first line creates the following list element in R:

<CHARSXP: "Percentile">

Whereas, I want it to create as the list element:

"Percentile"

Which the second example does correctly. I had previously posted about
this problem and I believe that I was advised to use the second syntax,
but maybe there is a different problem in my code. I am trying to
construct a named list in R where my first line SET_STRING_ELT sets the
name of the list element and the second sets the value where the value
can be an INTEGER, STRING or whatever.

My third question is simply, why is wcrtomb preferred, the example i
based my code of of in main/character.c used  wcstombs.


Thanks again for all of the help.

jim


Prof Brian Ripley wrote:

> On Fri, 26 Aug 2005, James Bullard wrote:
>
>> Hello all, I am writing an R interface to some C++ files which make use
>> of std::wstring classes for internationalization. Previously (when I
>> wanted to make R strings from C++ std::strings), I would do something
>> like this to construct a string in R from the results of the parse.
>>
>> SET_VECTOR_ELT(vals, i++, mkString(header.GetHeader().c_str()));
>
>
> That creates a list of one-element character vectors.  It would be more
> usual to do
>
>   SET_STRING_ELT(vals, i++, mkChar(header.GetHeader().c_str()));
>
>> However, now the call header.GetHeader().c_str() returns a pointer to
>> an array of wchar_t's. I was going to use wcstombs() to convert the
>> wchar_t* to char*, but I wanted to see if there was a similar
>> function in R for the mkString function which I had initially used
>> which deals with wchar_ts as opposed to chars.
>
>
> No (nor an analogue of mkChar).  R uses MBCS and not wchar_t
> internally (and Unix-alike systems do externally).  There is no
> wchar_t internal R type (a much-debated design decision at the time).
>
>> Also, since I have no experience with the wctombs() function I wanted
>> to ask if anyone knew if this will handle the internationilzation
>> issues from within R.
>
>
> Did you mean wcstombs or wctomb (if the latter, wcrtomb is preferred)?
> There are tens of examples in the R sources for you to consult.
>
> Note that not all R platforms support wchar_t, hence this code is
> surrounded by #ifdef SUPPORT_MBCS macros (exported in Rconfig.h for
> package writers).
>


From ripley at stats.ox.ac.uk  Tue Aug 30 08:04:48 2005
From: ripley at stats.ox.ac.uk (ripley@stats.ox.ac.uk)
Date: Tue, 30 Aug 2005 08:04:48 +0200 (CEST)
Subject: [Rd] "finite" vs "R_FINITE" in colors.c (PR#8108)
Message-ID: <20050830060448.35A791993C@slim.kubism.ku.dk>

Thanks, but it is already changed in the R-devel sources.

On Mon, 29 Aug 2005 rbug05 at kreil.org wrote:

> Full_Name: D Kreil
> Version: 2.1.1
> OS: HP-UX B.11.23 U ia64 0029870451 unlimited-user license
> Submission from: (NULL) (62.178.15.60)
>
>
> During compiliation, I get:
>
> ld: Unsatisfied symbol "finite" in file colors.o
>
> Fix: replace "finite" with R_FINITE in colors.c line 269.
>
> I have, this time, searched through the R-admin.html, but not found a mention.
> This is all a bit hard for me as I'm installing R as non-admin on a bare-bones
> ia64 hpux system with no web browser, and a weird mix of libraries.
> Nevertheless, the above seems to me like an innocent typo?

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Tue Aug 30 08:39:23 2005
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 30 Aug 2005 07:39:23 +0100 (BST)
Subject: [Rd] wchar and wstring. (followup question)
In-Reply-To: <4313A38E.7070404@berkeley.edu>
References: <430F9E0E.9020606@berkeley.edu>
	<Pine.LNX.4.61.0508271221090.2871@gannet.stats>
	<4313A38E.7070404@berkeley.edu>
Message-ID: <Pine.LNX.4.61.0508300731110.22282@gannet.stats>

On Mon, 29 Aug 2005, James Bullard wrote:

> Thanks for all of the help with my previous posts. This question might
> expose much of my ignorance when it comes to R's memory managment and
> the responsibilities of the programmer, but I thought I had better ask
> rather than continue in my ignorance.
>
> I use the following code to create a multi-byte string in R from my wide
> character string in C.
>
> int str_length;
> char* cstr;
>
> str_length = cel.GetAlg().size();
> cstr = Calloc(str_length, char);
> wcstombs(cstr, cel.GetAlg().c_str(), str_length);
> SET_STRING_ELT(names, i, mkChar("Algorithm"));
> SET_VECTOR_ELT(vals, i++, mkString(cstr));
> Free(cstr);
>
> My first question is: do I need the Free? I looked at some of the
> examples in main/character.c, but I could not decide whether or not I
> needed it. I imagined (I could not find the source for this function)
> that mkString made a copy so I thought I would clean up my copy, but if
> this is not the case then I would assume the Free would be wrong.

Yes, nkString copies the information (via mkChar) and the Free is needed.
The source is in gram.c.

Whenever you call Calloc you need to call Free or you will have a memory 
leak.

> My second question is: It was pointed out to me that it would be more
> natural to use this code:
>
> SET_STRING_ELT(vals, i++, mkChar(header.GetHeader().c_str()));
>
> instead of:
>
> SET_VECTOR_ELT(vals, i++, mkString(header.GetHeader().c_str()));
>
> However, the first line creates the following list element in R:

Nope, it creates an element of a character vector.  The point was that it 
was more natural to use character vectors than lists of single-element 
character vectors.

> <CHARSXP: "Percentile">
>
> Whereas, I want it to create as the list element:
>
> "Percentile"
>
> Which the second example does correctly. I had previously posted about
> this problem and I believe that I was advised to use the second syntax,
> but maybe there is a different problem in my code. I am trying to
> construct a named list in R where my first line SET_STRING_ELT sets the
> name of the list element and the second sets the value where the value
> can be an INTEGER, STRING or whatever.

Well, we STRING etc are macros not types, but if you want a list of mixed 
types for use at R-level, SET_VECTOR_ELT is fine.

> My third question is simply, why is wcrtomb preferred, the example i
> based my code of of in main/character.c used  wcstombs.

preferred to wctomb.  Please re-read what I wrote, and the relevant man 
pages.


>
> Thanks again for all of the help.
>
> jim
>
>
> Prof Brian Ripley wrote:
>
>> On Fri, 26 Aug 2005, James Bullard wrote:
>>
>>> Hello all, I am writing an R interface to some C++ files which make use
>>> of std::wstring classes for internationalization. Previously (when I
>>> wanted to make R strings from C++ std::strings), I would do something
>>> like this to construct a string in R from the results of the parse.
>>>
>>> SET_VECTOR_ELT(vals, i++, mkString(header.GetHeader().c_str()));
>>
>>
>> That creates a list of one-element character vectors.  It would be more
>> usual to do
>>
>>   SET_STRING_ELT(vals, i++, mkChar(header.GetHeader().c_str()));
>>
>>> However, now the call header.GetHeader().c_str() returns a pointer to
>>> an array of wchar_t's. I was going to use wcstombs() to convert the
>>> wchar_t* to char*, but I wanted to see if there was a similar
>>> function in R for the mkString function which I had initially used
>>> which deals with wchar_ts as opposed to chars.
>>
>>
>> No (nor an analogue of mkChar).  R uses MBCS and not wchar_t
>> internally (and Unix-alike systems do externally).  There is no
>> wchar_t internal R type (a much-debated design decision at the time).
>>
>>> Also, since I have no experience with the wctombs() function I wanted
>>> to ask if anyone knew if this will handle the internationilzation
>>> issues from within R.
>>
>>
>> Did you mean wcstombs or wctomb (if the latter, wcrtomb is preferred)?
>> There are tens of examples in the R sources for you to consult.
>>
>> Note that not all R platforms support wchar_t, hence this code is
>> surrounded by #ifdef SUPPORT_MBCS macros (exported in Rconfig.h for
>> package writers).
>>
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ben.bob at gmail.com  Tue Aug 30 15:44:50 2005
From: ben.bob at gmail.com (Bo Peng)
Date: Tue, 30 Aug 2005 06:44:50 -0700
Subject: [Rd] efficiency of sample() with prob.
In-Reply-To: <Pine.LNX.4.61.0508300716360.22282@gannet.stats>
References: <C698D707214E6F4AB39AB7096C3DE5A5AB5031@phost015.EVAFUNDS.intermedia.net>
	<6ea7b54305062211146473e7bf@mail.gmail.com>
	<Pine.LNX.4.61.0506222005080.3592@gannet.stats>
	<6ea7b54305062314375200f7d9@mail.gmail.com>
	<Pine.LNX.4.61.0508291607080.6766@gannet.stats>
	<6ea7b54305082915037905dc2f@mail.gmail.com>
	<Pine.LNX.4.61.0508300716360.22282@gannet.stats>
Message-ID: <6ea7b543050830064462b73670@mail.gmail.com>

> You chose to report just one extremely favourable example, < ignore>
> I do think you are being `careless with the truth'.

I chose to report whatever I got and whatever I felt the result was. It was not
a scientific report and it was up to you (the R-team) to validate my result and
make further investigations. When I was asked for a more thorough research
in this field (and thus take the responsibility to my results), I said
no since I did
not have enough expertise and time. 

After all, I could have chosen not to report anything at all. If this
mailing list
only accepts serious contributions from field professionals, it is time for me 
to quit.

> Hmm.  A sample every 100ns and generating samples several times faster
> than tabulating them is something to be impressed by. <ignore>
> Not in our tests.  Did you try my 5 out of 10,000 non-zero probablilties
> distribution, for example?

No. I did not try. Intuitively, Walker's method may be slow because  of
the memory allocation and table setup stuff. It should be used with 
large sample and small prob vector. Bisection method should be
quicker when the prob vector is large (so linear search is slow) and the 
sample size is relatively small. I thought bisection would be uniformly quicker 
than the linear search method since there is no additional cost other than 
a few more variables.

If you have done enough experiments and know the fastest method in 
each case, it should be straightforward to implement a hybrid method 
where the best method is chosen based on the lengths of sample and 
prob vector. I might have been reporting partial results, but the 80 times 
speed-up in some cases was not faked.

Cheers,
Bo


From lai at lindaspaces.com  Tue Aug 30 18:02:11 2005
From: lai at lindaspaces.com (Jennifer Lai)
Date: Tue, 30 Aug 2005 12:02:11 -0400
Subject: [Rd] compile R with Portland Group compiler
In-Reply-To: <Pine.LNX.4.61.0508241730270.17771@gannet.stats>
References: <430B63FB.1000908@lindaspaces.com>
	<Pine.LNX.4.61.0508232211550.21594@gannet.stats>
	<430C9DA7.5020809@lindaspaces.com>
	<Pine.LNX.4.61.0508241730270.17771@gannet.stats>
Message-ID: <43148303.8040805@lindaspaces.com>

Hi,
    After getting some help from Portland Group, I was able to pass the 
initial stage of building R with Portland Group Compiler on AMD Opeteron.

For anyone who is interested in building R with PG compiler, here is a 
list of set flags used in config.site,
CC=/usr/pgi/linux86-64/6.0/bin/pgcc
CFLAGS='-g -O2 -mieee-fp'
CPPFLAGS='-I/usr/pgi/linux86-64/6.0/include 
-I/usr/pgi/linux86-64/6.0/include/CC'
F77=/usr/pgi/linux86-64/6.0/bin/pgf77
FFLAGS=-O2
CPICFLAGS=-fpic
FPICFLAGS=-fpic
SHLIB_LDFLAGS=-shared
LDFLAGS='-L/usr/pgi/linux86-64/6.0/libso -L/usr/lib64'
CXX=/usr/pgi/linux86-64/6.0/bin/pgCC
CXXPICFLAGS=-fpic
SHLIB_CXXLDFLAGS=-shared

After installing R, I went ahead to install simpleaffy package. However, 
came across the following errors.

PGC-S-0035-Syntax error: Recovery attempted by replacing '/' by double  
0.00000000000000000E+0 (simpleaffy.c: 455)
PGC-S-0035-Syntax error: Recovery attempted by replacing identifier by 
by '!=' (simpleaffy.c: 455)
PGC-S-0035-Syntax error: Recovery attempted by replacing integer 15 by 
'!=' (simpleaffy.c: 455)
PGC-S-0039-Use of undeclared variable added (simpleaffy.c: 455)
PGC-S-0037-Syntax error: Recovery attempted by deleting identifier march 
(simpleaffy.c: 455)
PGC-S-0039-Use of undeclared variable Crispin (simpleaffy.c: 455)
PGC-S-0035-Syntax error: Recovery attempted by replacing identifier with 
by '!=' (simpleaffy.c: 455)
PGC-S-0035-Syntax error: Recovery attempted by replacing identifier in 
by '!=' (simpleaffy.c: 455)
PGC-S-0039-Use of undeclared variable deals (simpleaffy.c: 455)
PGC-S-0035-Syntax error: Recovery attempted by replacing identifier 
largest by '!=' (simpleaffy.c: 455)
PGC-S-0039-Use of undeclared variable ties (simpleaffy.c: 455)
PGC-S-0035-Syntax error: Recovery attempted by replacing '...' by ',' 
(simpleaffy.c: 455)
PGC-S-0039-Use of undeclared variable the (simpleaffy.c: 455)
PGC-S-0039-Use of undeclared variable ranks (simpleaffy.c: 455)
PGC/x86-64 Linux/x86-64 6.0-5: compilation completed with severe errors
make: *** [simpleaffy.o] Error 2
ERROR: compilation failed for package 'simpleaffy'

Apparently, PG compiler doesn't like "//" style for comments. So, by 
changing "//" to "/* */" style fixed above errors.
The commenting style errors also happened in other packages, such as affy.
Since "/* */" comment style is acceptable by both PG Compiler and gcc, 
it is probably worthwhile to use "/* */" consistently throughout R 
packages.


Regards,
Jennifer

Prof Brian Ripley wrote:

> Let us be clear: some things in config.log are designed to fail, so 
> only unexpected errors are a cause to look there.  The regex.c 
> warnings are it seems from an over-zealous compiler.
>
> The problems here seem to be the unknown use of .lo (which it seems to 
> have coped with) and a problem in the PG's own libc, which it seems 
> cannot be used in a shared object.  That issue discussed in the 
> R-admin manual, and seems something you do need to take up with PG.  
> The crucial part is
>
>> /usr/bin/ld: /usr/pgi/linux86-64/6.0/lib/libpgc.a(fastmath.o): 
>> relocation
>> R_X86_64_PC32 against `__fvdlog' can not be used when making a shared 
>> object;
>> recompile with -fPIC
>
>
> which is asking you to recompile their static library.  If you can't 
> use a dynamic library then this is fatal.
>
>
> On Wed, 24 Aug 2005, Jennifer Lai wrote:
>
>> I downloaded R-devel and compiled it with pgcc. This time, instead of 
>> breaking in src/main, compilation breaks in src/modules with the 
>> following error messages.
>>
>> Copyright 1989-2000, The Portland Group, Inc.  All Rights Reserved.
>> Copyright 2000-2005, STMicroelectronics, Inc.  All Rights Reserved.
>> /usr/pgi/linux86-64/6.0/bin/pgcc -shared  
>> -L/usr/pgi/linux86-64/6.0/lib -L/usr/lib64 -o R_X11.so  dataentry.lo 
>> devX11.lo rotated.lo rbitmap.lo  -lSM -lICE -L/usr/X11R6/lib64 -lX11  
>> -ljpeg -lpng -lz
>> File with unknown suffix passed to linker: dataentry.lo
>> File with unknown suffix passed to linker: devX11.lo
>> File with unknown suffix passed to linker: rotated.lo
>> File with unknown suffix passed to linker: rbitmap.lo
>> /usr/bin/ld: /usr/pgi/linux86-64/6.0/lib/libpgc.a(fastmath.o): 
>> relocation R_X86_64_PC32 against `__fvdlog' can not be used when 
>> making a shared object; recompile with -fPIC
>> /usr/bin/ld: final link failed: Bad value
>> make[4]: *** [R_X11.so] Error 2
>> make[4]: Leaving directory `/home/cuser/R-devel/src/modules/X11'
>> make[3]: *** [R] Error 2
>> make[3]: Leaving directory `/home/cuser/R-devel/src/modules/X11'
>> make[2]: *** [R] Error 1
>> make[2]: Leaving directory `/home/cuser/R-devel/src/modules'
>> make[1]: *** [R] Error 1
>> make[1]: Leaving directory `/home/cuser/R-devel/src'
>> make: *** [R] Error 1
>>
>> Though src/main directory compiled successfully, I do still get 
>> warning messages from src/main/regex.c compilation.
>> PGC-W-0155-64-bit integral value truncated  (/usr/include/wctype.h: 109)
>> PGC-W-0155-64-bit integral value truncated  (/usr/include/wctype.h: 110)
>> PGC-W-0155-64-bit integral value truncated  (/usr/include/wctype.h: 111)
>> PGC-W-0155-64-bit integral value truncated  (/usr/include/wctype.h: 112)
>> PGC-W-0155-Long value is passed to a nonprototyped function - 
>> argument #5 (regex.c: 3288)
>> PGC-W-0155-Long value is passed to a nonprototyped function - 
>> argument #3 (regex.c: 4464)
>> PGC-W-0155-Long value is passed to a nonprototyped function - 
>> argument #3 (regex.c: 4591)
>> PGC-W-0155-Long value is passed to a nonprototyped function - 
>> argument #3 (regex.c: 4635)
>> PGC-W-0155-Long value is passed to a nonprototyped function - 
>> argument #3 (regex.c: 4737)
>> PGC-W-0155-Long value is passed to a nonprototyped function - 
>> argument #3 (regex.c: 4792)
>> PGC-W-0155-Long value is passed to a nonprototyped function - 
>> argument #4 (regex.c: 4793)
>> PGC-W-0155-Long value is passed to a nonprototyped function - 
>> argument #3 (regex.c: 4861)
>> PGC-W-0155-Long value is passed to a nonprototyped function - 
>> argument #3 (regex.c: 4904)
>> PGC-W-0155-Long value is passed to a nonprototyped function - argument 
>
> #3
>
>> (regex.c: 4954)
>> PGC-W-0155-Long value is passed to a nonprototyped function - 
>> argument #4 (regex.c: 4961)
>> PGC-W-0155-Long value is passed to a nonprototyped function - 
>> argument #3 (regex.c: 5057)
>> PGC-W-0155-Long value is passed to a nonprototyped function - 
>> argument #3 (regex.c: 5581)
>> PGC-W-0155-Long value is passed to a nonprototyped function - 
>> argument #3 (regex.c: 5596)
>> PGC-W-0155-Long value is passed to a nonprototyped function - 
>> argument #3 (regex.c: 5628)
>> PGC-W-0155-Long value is passed to a nonprototyped function - 
>> argument #3 (regex.c: 5641)
>> PGC-W-0155-Long value is passed to a nonprototyped function - 
>> argument #3 (regex.c: 5669)
>> PGC-W-0155-Long value is passed to a nonprototyped function - 
>> argument #3 (regex.c: 5858)
>> PGC-W-0155-Long value is passed to a nonprototyped function - 
>> argument #3 (regex.c: 6230)
>> PGC-W-0155-Long value is passed to a nonprototyped function - 
>> argument #6 (regex.c: 7035)
>> PGC-W-0155-Long value is passed to a nonprototyped function - 
>> argument #3 (regex.c: 7803)
>> PGC-W-0155-Long value is passed to a nonprototyped function - 
>> argument #2 (regex.c: 7814)
>> PGC-W-0155-Long value is passed to a nonprototyped function - 
>> argument #3 (regex.c: 7826)
>> PGC-W-0155-Long value is passed to a nonprototyped function - 
>> argument #7 (regex.c: 10722)
>> PGC/x86-64 Linux/x86-64 6.0-5: compilation completed with warnings
>>
>>
>> One last thing that I notice is the errors messages in config.log. 
>> Should I consult these error messages with Portland Group, or R-devel 
>> can help me out on this?
>>
>> Copyright 1989-2000, The Portland Group, Inc.  All Rights Reserved.
>> Copyright 2000-2005, STMicroelectronics, Inc.  All Rights Reserved.
>> PGC-S-0040-Illegal use of symbol, choke (conftest.c: 21)
>> PGC/x86-64 Linux/x86-64 6.0-5: compilation completed with severe errors
>> configure:4222: $? = 2
>> configure: failed program was:
>> | /* confdefs.h.  */
>> |
>> | #define PACKAGE_NAME "R"
>> | #define PACKAGE_TARNAME "R"
>> | #define PACKAGE_VERSION "2.2.0"
>> | #define PACKAGE_STRING "R 2.2.0"
>> | #define PACKAGE_BUGREPORT "r-bugs at R-project.org"
>> | #define PACKAGE "R"
>> | #define VERSION "2.2.0"
>> | #define R_PLATFORM "x86_64-unknown-linux-gnu"
>> | #define R_CPU "x86_64"
>> | #define R_VENDOR "unknown"
>> | #define R_OS "linux-gnu"
>> | #define Unix 1
>> | /* end confdefs.h.  */
>> |
>> | int
>> | main ()
>> | {
>> | #ifndef __GNUC__
>> |        choke me
>> | #endif
>> |
>> |   ;
>> |   return 0;
>> | }
>>
>> PGC-S-0035-Syntax error: Recovery attempted by replacing identifier 
>> me by ';' (conftest.c: 2)
>> PGC-W-0057-Old-style declaration used; int assumed (conftest.c: 2)
>> PGC/x86-64 Linux/x86-64 6.0-5: compilation completed with severe errors
>> configure:4453: $? = 2
>> configure: failed program was:
>> | #ifndef __cplusplus
>> |   choke me
>> | #endif
>>
>> PGFTN-S-0034-Syntax error at or near end of line (conftest.F: 3)
>> 0 inform,   0 warnings,   1 severes, 0 fatal for main
>> PGFTN/x86-64 Linux/x86-64 6.0-5: compilation completed with severe 
>> errors
>> configure:5400: $? = 2
>> configure: failed program was:
>> |       program main
>> | #ifndef __GNUC__
>> |        choke me
>> | #endif
>> |
>> |       end
>>
>> configure:5665: /usr/pgi/linux86-64/6.0/bin/pgCC -c 
>> -I/usr/pgi/linux86-64/6.0/include 
>> -I/usr/pgi/linux86-64/6.0/include/CC conftest.cc >&5
>> "conftest.cc", line 21: error: identifier "choke" is undefined
>>        choke me
>>        ^
>>
>> "conftest.cc", line 21: warning: variable "me" was declared but never
>>         referenced
>>        choke me
>>              ^
>>
>> 1 error detected in the compilation of "conftest.cc".
>> configure:5671: $? = 2
>> configure: failed program was:
>> | /* confdefs.h.  */
>> |
>> | #define PACKAGE_NAME "R"
>> | #define PACKAGE_TARNAME "R"
>> | #define PACKAGE_VERSION "2.2.0"
>> | #define PACKAGE_STRING "R 2.2.0"
>> | #define PACKAGE_BUGREPORT "r-bugs at R-project.org"
>> | #define PACKAGE "R"
>> | #define VERSION "2.2.0"
>> | #define R_PLATFORM "x86_64-unknown-linux-gnu"
>> | #define R_CPU "x86_64"
>> | #define R_VENDOR "unknown"
>> | #define R_OS "linux-gnu"
>> | #define Unix 1
>> | /* end confdefs.h.  */
>> |
>> | int
>> | main ()
>> | {
>> | #ifndef __GNUC__
>> |        choke me
>> | #endif
>> |
>> |   ;
>> |   return 0;
>> | }
>>
>> configure:5841: /usr/pgi/linux86-64/6.0/bin/pgCC -c -g 
>> -I/usr/pgi/linux86-64/6.0/include 
>> -I/usr/pgi/linux86-64/6.0/include/CC conftest.cc >&5
>> "conftest.cc", line 20: error: identifier "exit" is undefined
>> exit (42);
>> ^
>>
>> 1 error detected in the compilation of "conftest.cc".
>> configure:5847: $? = 2
>> configure: failed program was:
>> | /* confdefs.h.  */
>> |
>> | #define PACKAGE_NAME "R"
>> | #define PACKAGE_TARNAME "R"
>> | #define PACKAGE_VERSION "2.2.0"
>> | #define PACKAGE_STRING "R 2.2.0"
>> | #define PACKAGE_BUGREPORT "r-bugs at R-project.org"
>> | #define PACKAGE "R"
>> | #define VERSION "2.2.0"
>> | #define R_PLATFORM "x86_64-unknown-linux-gnu"
>> | #define R_CPU "x86_64"
>> | #define R_VENDOR "unknown"
>> | #define R_OS "linux-gnu"
>> | #define Unix 1
>> | /* end confdefs.h.  */
>> |
>> | int
>> | main ()
>> | {
>> | exit (42);
>> |   ;
>> |   return 0;
>> | }
>> configure:5796: /usr/pgi/linux86-64/6.0/bin/pgCC -c -g 
>> -I/usr/pgi/linux86-64/6.0/include 
>> -I/usr/pgi/linux86-64/6.0/include/CC conftest.cc >&5
>> "conftest.cc", line 16: error: namespace "std" has no member "exit"
>> extern "C" void std::exit (int) throw (); using std::exit;
>>                      ^
>>
>> "conftest.cc", line 16: error: namespace "std" has no member "exit"
>> extern "C" void std::exit (int) throw (); using std::exit;
>>                                                      ^
>>
>> 2 errors detected in the compilation of "conftest.cc".
>> configure:5802: $? = 2
>> configure: failed program was:
>> | /* confdefs.h.  */
>> |
>> | #define PACKAGE_NAME "R"
>> | #define PACKAGE_TARNAME "R"
>> | #define PACKAGE_VERSION "2.2.0"
>> | #define PACKAGE_STRING "R 2.2.0"
>> | #define PACKAGE_BUGREPORT "r-bugs at R-project.org"
>> | #define PACKAGE "R"
>> | #define VERSION "2.2.0"
>> | #define R_PLATFORM "x86_64-unknown-linux-gnu"
>> | #define R_CPU "x86_64"
>> | #define R_VENDOR "unknown"
>> | #define R_OS "linux-gnu"
>> | #define Unix 1
>> | /* end confdefs.h.  */
>> | extern "C" void std::exit (int) throw (); using std::exit;
>> | #include <stdlib.h>
>> | int
>> | main ()
>> | {
>> | exit (42);
>> |   ;
>> |   return 0;
>> | }
>> configure:5796: /usr/pgi/linux86-64/6.0/bin/pgCC -c -g 
>> -I/usr/pgi/linux86-64/6.0/include 
>> -I/usr/pgi/linux86-64/6.0/include/CC conftest.cc >&5
>> "conftest.cc", line 16: error: namespace "std" has no member "exit"
>> extern "C" void std::exit (int); using std::exit;
>>                      ^
>>
>> "conftest.cc", line 16: error: namespace "std" has no member "exit"
>> extern "C" void std::exit (int); using std::exit;
>>                                             ^
>>
>> 2 errors detected in the compilation of "conftest.cc".
>> configure:5802: $? = 2
>> configure: failed program was:
>> | /* confdefs.h.  */
>> |
>> | #define PACKAGE_NAME "R"
>> | #define PACKAGE_TARNAME "R"
>> | #define PACKAGE_VERSION "2.2.0"
>> | #define PACKAGE_STRING "R 2.2.0"
>> | #define PACKAGE_BUGREPORT "r-bugs at R-project.org"
>> | #define PACKAGE "R"
>> | #define VERSION "2.2.0"
>> | #define R_PLATFORM "x86_64-unknown-linux-gnu"
>> | #define R_CPU "x86_64"
>> | #define R_VENDOR "unknown"
>> | #define R_OS "linux-gnu"
>> | #define Unix 1
>> | /* end confdefs.h.  */
>> | extern "C" void std::exit (int); using std::exit;
>> | #include <stdlib.h>
>> | int
>> | main ()
>> | {
>> | exit (42);
>> |   ;
>> |   return 0;
>> | }
>> configure:5796: /usr/pgi/linux86-64/6.0/bin/pgCC -c -g 
>> -I/usr/pgi/linux86-64/6.0/include 
>> -I/usr/pgi/linux86-64/6.0/include/CC conftest.cc >&5
>> "/usr/include/stdlib.h", line 640: error: omission of exception 
>> specification
>>         is incompatible with previous function "exit" (declared at 
>> line 16
>>         of "conftest.cc")
>> extern void exit (int __status) __THROW __attribute__ ((__noreturn__));
>>                                                                       ^
>>
>> 1 error detected in the compilation of "conftest.cc".
>> configure:5802: $? = 2
>> configure: failed program was:
>> | /* confdefs.h.  */
>> |
>> | #define PACKAGE_NAME "R"
>> | #define PACKAGE_TARNAME "R"
>> | #define PACKAGE_VERSION "2.2.0"
>> | #define PACKAGE_STRING "R 2.2.0"
>> | #define PACKAGE_BUGREPORT "r-bugs at R-project.org"
>> | #define PACKAGE "R"
>> | #define VERSION "2.2.0"
>> | #define R_PLATFORM "x86_64-unknown-linux-gnu"
>> | #define R_CPU "x86_64"
>> | #define R_VENDOR "unknown"
>> | #define R_OS "linux-gnu"
>> | #define Unix 1
>> | /* end confdefs.h.  */
>> | extern "C" void exit (int) throw ();
>> | #include <stdlib.h>
>> | int
>> | main ()
>> | {
>> | exit (42);
>> |   ;
>> |   return 0;
>> | }
>> configure:5796: /usr/pgi/linux86-64/6.0/bin/pgCC -c -g 
>> -I/usr/pgi/linux86-64/6.0/include 
>> -I/usr/pgi/linux86-64/6.0/include/CC conftest.cc >&5
>> NOTE: your evaluation license will expire in 14 days, 5.7 hours.
>> For a permanent license, please read the order acknowledgement
>> that you received.  Connect to https://www.pgroup.com/License with
>> the username and password in the order acknowledgement.
>>
>>   Name:    lai
>>   User:    lai
>>   Email:    lai at lindaspaces.com
>>   Hostid:    PGI=00001AE0193111621CB217
>> configure:5802: $? = 0
>> configure:5806: test -z
>>            || test ! -s conftest.err
>> configure:5809: $? = 0
>> configure:5812: test -s conftest.o
>> configure:5815: $? = 0
>> configure:5841: /usr/pgi/linux86-64/6.0/bin/pgCC -c -g 
>> -I/usr/pgi/linux86-64/6.0/include 
>> -I/usr/pgi/linux86-64/6.0/include/CC conftest.cc >&5
>> NOTE: your evaluation license will expire in 14 days, 5.7 hours.
>> For a permanent license, please read the order acknowledgement
>> that you received.  Connect to https://www.pgroup.com/License with
>> the username and password in the order acknowledgement.
>>
>>   Name:    lai
>>   User:    lai
>>   Email:    lai at lindaspaces.com
>>   Hostid:    PGI=00001AE0193111621CB217
>> configure:5847: $? = 0
>> configure:5851: test -z
>>            || test ! -s conftest.err
>> configure:5854: $? = 0
>> configure:5857: test -s conftest.o
>> configure:5860: $? = 0
>> configure:5888: checking how to run the C++ preprocessor
>> configure:5919: /usr/pgi/linux86-64/6.0/bin/pgCC -E 
>> -I/usr/pgi/linux86-64/6.0/include 
>> -I/usr/pgi/linux86-64/6.0/include/CC conftest.cc
>> configure:5925: $? = 0
>> configure:5957: /usr/pgi/linux86-64/6.0/bin/pgCC -E 
>> -I/usr/pgi/linux86-64/6.0/include 
>> -I/usr/pgi/linux86-64/6.0/include/CC conftest.cc
>> "conftest.cc", line 19: catastrophic error: could not open source file
>>         "ac_nonexistent.h"
>> #include <ac_nonexistent.h>
>>                            ^
>>
>> 1 catastrophic error detected in the compilation of "conftest.cc".
>> Compilation terminated.
>> configure:5963: $? = 2
>> configure: failed program was:
>> | /* confdefs.h.  */
>> |
>> | #define PACKAGE_NAME "R"
>> | #define PACKAGE_TARNAME "R"
>> | #define PACKAGE_VERSION "2.2.0"
>> | #define PACKAGE_STRING "R 2.2.0"
>> | #define PACKAGE_BUGREPORT "r-bugs at R-project.org"
>> | #define PACKAGE "R"
>> | #define VERSION "2.2.0"
>> | #define R_PLATFORM "x86_64-unknown-linux-gnu"
>> | #define R_CPU "x86_64"
>> | #define R_VENDOR "unknown"
>> | #define R_OS "linux-gnu"
>> | #define Unix 1
>> | #ifdef __cplusplus
>> | extern "C" void exit (int);
>> | #endif
>> | /* end confdefs.h.  */
>> | #include <ac_nonexistent.h>
>> configure:6002: result: /usr/pgi/linux86-64/6.0/bin/pgCC -E
>> configure:6026: /usr/pgi/linux86-64/6.0/bin/pgCC -E 
>> -I/usr/pgi/linux86-64/6.0/include 
>> -I/usr/pgi/linux86-64/6.0/include/CC conftest.cc
>> configure:6032: $? = 0
>> configure:6064: /usr/pgi/linux86-64/6.0/bin/pgCC -E 
>> -I/usr/pgi/linux86-64/6.0/include 
>> -I/usr/pgi/linux86-64/6.0/include/CC conftest.cc
>> "conftest.cc", line 19: catastrophic error: could not open source file
>>         "ac_nonexistent.h"
>> #include <ac_nonexistent.h>
>>                            ^
>>
>> 1 catastrophic error detected in the compilation of "conftest.cc".
>> Compilation terminated.
>> configure:6070: $? = 2
>> configure: failed program was:
>> | /* confdefs.h.  */
>> |
>> | #define PACKAGE_NAME "R"
>> | #define PACKAGE_TARNAME "R"
>> | #define PACKAGE_VERSION "2.2.0"
>> | #define PACKAGE_STRING "R 2.2.0"
>> | #define PACKAGE_BUGREPORT "r-bugs at R-project.org"
>> | #define PACKAGE "R"
>> | #define VERSION "2.2.0"
>> | #define R_PLATFORM "x86_64-unknown-linux-gnu"
>> | #define R_CPU "x86_64"
>> | #define R_VENDOR "unknown"
>> | #define R_OS "linux-gnu"
>> | #define Unix 1
>> | #ifdef __cplusplus
>> | extern "C" void exit (int);
>> | #endif
>> | /* end confdefs.h.  */
>> | #include <ac_nonexistent.h>
>>
>>
>> Thank you in advance for your help!
>>
>> Sincerely,
>> Jennifer
>>
>> Prof Brian Ripley wrote:
>>
>>> regex.c is not our code, but from glibc.  Could you please try 
>>> R-devel instead, which has a later version of glibc.  Since 2.1.1 is 
>>> not longer part of the developement, we cannot help with that, but 
>>> we can help wih R-devel.
>>>
>>> I see the later regex.c does use prototypes.  But bitset is an 
>>> integer type, so that may be a compiler error.
>>>
>>> (It is on my list to try Intel and PG compilers on AMD64 as we have 
>>> licences, but not very high priority.)
>>>
>>>
>>>
>>
>>
>>
>


From ripley at stats.ox.ac.uk  Tue Aug 30 18:23:28 2005
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 30 Aug 2005 17:23:28 +0100 (BST)
Subject: [Rd] compile R with Portland Group compiler
In-Reply-To: <43148303.8040805@lindaspaces.com>
References: <430B63FB.1000908@lindaspaces.com>
	<Pine.LNX.4.61.0508232211550.21594@gannet.stats>
	<430C9DA7.5020809@lindaspaces.com>
	<Pine.LNX.4.61.0508241730270.17771@gannet.stats>
	<43148303.8040805@lindaspaces.com>
Message-ID: <Pine.LNX.4.61.0508301721170.16651@gannet.stats>

Thank you for the report.

/* */ is standard C.  simpleaffy is not a CRAN package: we test those with 
enough flags (-Wall -pedantic) that the use of // is flagged and would get 
reported to the maintainer/submitter.

On Tue, 30 Aug 2005, Jennifer Lai wrote:

> Hi,
>   After getting some help from Portland Group, I was able to pass the 
> initial stage of building R with Portland Group Compiler on AMD Opeteron.
>
> For anyone who is interested in building R with PG compiler, here is a list 
> of set flags used in config.site,
> CC=/usr/pgi/linux86-64/6.0/bin/pgcc
> CFLAGS='-g -O2 -mieee-fp'
> CPPFLAGS='-I/usr/pgi/linux86-64/6.0/include 
> -I/usr/pgi/linux86-64/6.0/include/CC'
> F77=/usr/pgi/linux86-64/6.0/bin/pgf77
> FFLAGS=-O2
> CPICFLAGS=-fpic
> FPICFLAGS=-fpic
> SHLIB_LDFLAGS=-shared
> LDFLAGS='-L/usr/pgi/linux86-64/6.0/libso -L/usr/lib64'
> CXX=/usr/pgi/linux86-64/6.0/bin/pgCC
> CXXPICFLAGS=-fpic
> SHLIB_CXXLDFLAGS=-shared
>
> After installing R, I went ahead to install simpleaffy package. However, came 
> across the following errors.
>
> PGC-S-0035-Syntax error: Recovery attempted by replacing '/' by double 
> 0.00000000000000000E+0 (simpleaffy.c: 455)
> PGC-S-0035-Syntax error: Recovery attempted by replacing identifier by by 
> '!=' (simpleaffy.c: 455)
> PGC-S-0035-Syntax error: Recovery attempted by replacing integer 15 by '!=' 
> (simpleaffy.c: 455)
> PGC-S-0039-Use of undeclared variable added (simpleaffy.c: 455)
> PGC-S-0037-Syntax error: Recovery attempted by deleting identifier march 
> (simpleaffy.c: 455)
> PGC-S-0039-Use of undeclared variable Crispin (simpleaffy.c: 455)
> PGC-S-0035-Syntax error: Recovery attempted by replacing identifier with by 
> '!=' (simpleaffy.c: 455)
> PGC-S-0035-Syntax error: Recovery attempted by replacing identifier in by 
> '!=' (simpleaffy.c: 455)
> PGC-S-0039-Use of undeclared variable deals (simpleaffy.c: 455)
> PGC-S-0035-Syntax error: Recovery attempted by replacing identifier largest 
> by '!=' (simpleaffy.c: 455)
> PGC-S-0039-Use of undeclared variable ties (simpleaffy.c: 455)
> PGC-S-0035-Syntax error: Recovery attempted by replacing '...' by ',' 
> (simpleaffy.c: 455)
> PGC-S-0039-Use of undeclared variable the (simpleaffy.c: 455)
> PGC-S-0039-Use of undeclared variable ranks (simpleaffy.c: 455)
> PGC/x86-64 Linux/x86-64 6.0-5: compilation completed with severe errors
> make: *** [simpleaffy.o] Error 2
> ERROR: compilation failed for package 'simpleaffy'
>
> Apparently, PG compiler doesn't like "//" style for comments. So, by changing 
> "//" to "/* */" style fixed above errors.
> The commenting style errors also happened in other packages, such as affy.
> Since "/* */" comment style is acceptable by both PG Compiler and gcc, it is 
> probably worthwhile to use "/* */" consistently throughout R packages.
>
>
> Regards,
> Jennifer
>
> Prof Brian Ripley wrote:
>
>> Let us be clear: some things in config.log are designed to fail, so only 
>> unexpected errors are a cause to look there.  The regex.c warnings are it 
>> seems from an over-zealous compiler.
>> 
>> The problems here seem to be the unknown use of .lo (which it seems to have 
>> coped with) and a problem in the PG's own libc, which it seems cannot be 
>> used in a shared object.  That issue discussed in the R-admin manual, and 
>> seems something you do need to take up with PG.  The crucial part is
>> 
>>> /usr/bin/ld: /usr/pgi/linux86-64/6.0/lib/libpgc.a(fastmath.o): relocation
>>> R_X86_64_PC32 against `__fvdlog' can not be used when making a shared 
>>> object;
>>> recompile with -fPIC
>> 
>> 
>> which is asking you to recompile their static library.  If you can't use a 
>> dynamic library then this is fatal.
>> 
>> 
>> On Wed, 24 Aug 2005, Jennifer Lai wrote:
>> 
>>> I downloaded R-devel and compiled it with pgcc. This time, instead of 
>>> breaking in src/main, compilation breaks in src/modules with the following 
>>> error messages.
>>> 
>>> Copyright 1989-2000, The Portland Group, Inc.  All Rights Reserved.
>>> Copyright 2000-2005, STMicroelectronics, Inc.  All Rights Reserved.
>>> /usr/pgi/linux86-64/6.0/bin/pgcc -shared  -L/usr/pgi/linux86-64/6.0/lib 
>>> -L/usr/lib64 -o R_X11.so  dataentry.lo devX11.lo rotated.lo rbitmap.lo 
>>> -lSM -lICE -L/usr/X11R6/lib64 -lX11  -ljpeg -lpng -lz
>>> File with unknown suffix passed to linker: dataentry.lo
>>> File with unknown suffix passed to linker: devX11.lo
>>> File with unknown suffix passed to linker: rotated.lo
>>> File with unknown suffix passed to linker: rbitmap.lo
>>> /usr/bin/ld: /usr/pgi/linux86-64/6.0/lib/libpgc.a(fastmath.o): relocation 
>>> R_X86_64_PC32 against `__fvdlog' can not be used when making a shared 
>>> object; recompile with -fPIC
>>> /usr/bin/ld: final link failed: Bad value
>>> make[4]: *** [R_X11.so] Error 2
>>> make[4]: Leaving directory `/home/cuser/R-devel/src/modules/X11'
>>> make[3]: *** [R] Error 2
>>> make[3]: Leaving directory `/home/cuser/R-devel/src/modules/X11'
>>> make[2]: *** [R] Error 1
>>> make[2]: Leaving directory `/home/cuser/R-devel/src/modules'
>>> make[1]: *** [R] Error 1
>>> make[1]: Leaving directory `/home/cuser/R-devel/src'
>>> make: *** [R] Error 1
>>> 
>>> Though src/main directory compiled successfully, I do still get warning 
>>> messages from src/main/regex.c compilation.
>>> PGC-W-0155-64-bit integral value truncated  (/usr/include/wctype.h: 109)
>>> PGC-W-0155-64-bit integral value truncated  (/usr/include/wctype.h: 110)
>>> PGC-W-0155-64-bit integral value truncated  (/usr/include/wctype.h: 111)
>>> PGC-W-0155-64-bit integral value truncated  (/usr/include/wctype.h: 112)
>>> PGC-W-0155-Long value is passed to a nonprototyped function - argument #5 
>>> (regex.c: 3288)
>>> PGC-W-0155-Long value is passed to a nonprototyped function - argument #3 
>>> (regex.c: 4464)
>>> PGC-W-0155-Long value is passed to a nonprototyped function - argument #3 
>>> (regex.c: 4591)
>>> PGC-W-0155-Long value is passed to a nonprototyped function - argument #3 
>>> (regex.c: 4635)
>>> PGC-W-0155-Long value is passed to a nonprototyped function - argument #3 
>>> (regex.c: 4737)
>>> PGC-W-0155-Long value is passed to a nonprototyped function - argument #3 
>>> (regex.c: 4792)
>>> PGC-W-0155-Long value is passed to a nonprototyped function - argument #4 
>>> (regex.c: 4793)
>>> PGC-W-0155-Long value is passed to a nonprototyped function - argument #3 
>>> (regex.c: 4861)
>>> PGC-W-0155-Long value is passed to a nonprototyped function - argument #3 
>>> (regex.c: 4904)
>>> PGC-W-0155-Long value is passed to a nonprototyped function - argument 
>> 
>> #3
>> 
>>> (regex.c: 4954)
>>> PGC-W-0155-Long value is passed to a nonprototyped function - argument #4 
>>> (regex.c: 4961)
>>> PGC-W-0155-Long value is passed to a nonprototyped function - argument #3 
>>> (regex.c: 5057)
>>> PGC-W-0155-Long value is passed to a nonprototyped function - argument #3 
>>> (regex.c: 5581)
>>> PGC-W-0155-Long value is passed to a nonprototyped function - argument #3 
>>> (regex.c: 5596)
>>> PGC-W-0155-Long value is passed to a nonprototyped function - argument #3 
>>> (regex.c: 5628)
>>> PGC-W-0155-Long value is passed to a nonprototyped function - argument #3 
>>> (regex.c: 5641)
>>> PGC-W-0155-Long value is passed to a nonprototyped function - argument #3 
>>> (regex.c: 5669)
>>> PGC-W-0155-Long value is passed to a nonprototyped function - argument #3 
>>> (regex.c: 5858)
>>> PGC-W-0155-Long value is passed to a nonprototyped function - argument #3 
>>> (regex.c: 6230)
>>> PGC-W-0155-Long value is passed to a nonprototyped function - argument #6 
>>> (regex.c: 7035)
>>> PGC-W-0155-Long value is passed to a nonprototyped function - argument #3 
>>> (regex.c: 7803)
>>> PGC-W-0155-Long value is passed to a nonprototyped function - argument #2 
>>> (regex.c: 7814)
>>> PGC-W-0155-Long value is passed to a nonprototyped function - argument #3 
>>> (regex.c: 7826)
>>> PGC-W-0155-Long value is passed to a nonprototyped function - argument #7 
>>> (regex.c: 10722)
>>> PGC/x86-64 Linux/x86-64 6.0-5: compilation completed with warnings
>>> 
>>> 
>>> One last thing that I notice is the errors messages in config.log. Should 
>>> I consult these error messages with Portland Group, or R-devel can help me 
>>> out on this?
>>> 
>>> Copyright 1989-2000, The Portland Group, Inc.  All Rights Reserved.
>>> Copyright 2000-2005, STMicroelectronics, Inc.  All Rights Reserved.
>>> PGC-S-0040-Illegal use of symbol, choke (conftest.c: 21)
>>> PGC/x86-64 Linux/x86-64 6.0-5: compilation completed with severe errors
>>> configure:4222: $? = 2
>>> configure: failed program was:
>>> | /* confdefs.h.  */
>>> |
>>> | #define PACKAGE_NAME "R"
>>> | #define PACKAGE_TARNAME "R"
>>> | #define PACKAGE_VERSION "2.2.0"
>>> | #define PACKAGE_STRING "R 2.2.0"
>>> | #define PACKAGE_BUGREPORT "r-bugs at R-project.org"
>>> | #define PACKAGE "R"
>>> | #define VERSION "2.2.0"
>>> | #define R_PLATFORM "x86_64-unknown-linux-gnu"
>>> | #define R_CPU "x86_64"
>>> | #define R_VENDOR "unknown"
>>> | #define R_OS "linux-gnu"
>>> | #define Unix 1
>>> | /* end confdefs.h.  */
>>> |
>>> | int
>>> | main ()
>>> | {
>>> | #ifndef __GNUC__
>>> |        choke me
>>> | #endif
>>> |
>>> |   ;
>>> |   return 0;
>>> | }
>>> 
>>> PGC-S-0035-Syntax error: Recovery attempted by replacing identifier me by 
>>> ';' (conftest.c: 2)
>>> PGC-W-0057-Old-style declaration used; int assumed (conftest.c: 2)
>>> PGC/x86-64 Linux/x86-64 6.0-5: compilation completed with severe errors
>>> configure:4453: $? = 2
>>> configure: failed program was:
>>> | #ifndef __cplusplus
>>> |   choke me
>>> | #endif
>>> 
>>> PGFTN-S-0034-Syntax error at or near end of line (conftest.F: 3)
>>> 0 inform,   0 warnings,   1 severes, 0 fatal for main
>>> PGFTN/x86-64 Linux/x86-64 6.0-5: compilation completed with severe errors
>>> configure:5400: $? = 2
>>> configure: failed program was:
>>> |       program main
>>> | #ifndef __GNUC__
>>> |        choke me
>>> | #endif
>>> |
>>> |       end
>>> 
>>> configure:5665: /usr/pgi/linux86-64/6.0/bin/pgCC -c 
>>> -I/usr/pgi/linux86-64/6.0/include -I/usr/pgi/linux86-64/6.0/include/CC 
>>> conftest.cc >&5
>>> "conftest.cc", line 21: error: identifier "choke" is undefined
>>>        choke me
>>>        ^
>>> 
>>> "conftest.cc", line 21: warning: variable "me" was declared but never
>>>         referenced
>>>        choke me
>>>              ^
>>> 
>>> 1 error detected in the compilation of "conftest.cc".
>>> configure:5671: $? = 2
>>> configure: failed program was:
>>> | /* confdefs.h.  */
>>> |
>>> | #define PACKAGE_NAME "R"
>>> | #define PACKAGE_TARNAME "R"
>>> | #define PACKAGE_VERSION "2.2.0"
>>> | #define PACKAGE_STRING "R 2.2.0"
>>> | #define PACKAGE_BUGREPORT "r-bugs at R-project.org"
>>> | #define PACKAGE "R"
>>> | #define VERSION "2.2.0"
>>> | #define R_PLATFORM "x86_64-unknown-linux-gnu"
>>> | #define R_CPU "x86_64"
>>> | #define R_VENDOR "unknown"
>>> | #define R_OS "linux-gnu"
>>> | #define Unix 1
>>> | /* end confdefs.h.  */
>>> |
>>> | int
>>> | main ()
>>> | {
>>> | #ifndef __GNUC__
>>> |        choke me
>>> | #endif
>>> |
>>> |   ;
>>> |   return 0;
>>> | }
>>> 
>>> configure:5841: /usr/pgi/linux86-64/6.0/bin/pgCC -c -g 
>>> -I/usr/pgi/linux86-64/6.0/include -I/usr/pgi/linux86-64/6.0/include/CC 
>>> conftest.cc >&5
>>> "conftest.cc", line 20: error: identifier "exit" is undefined
>>> exit (42);
>>> ^
>>> 
>>> 1 error detected in the compilation of "conftest.cc".
>>> configure:5847: $? = 2
>>> configure: failed program was:
>>> | /* confdefs.h.  */
>>> |
>>> | #define PACKAGE_NAME "R"
>>> | #define PACKAGE_TARNAME "R"
>>> | #define PACKAGE_VERSION "2.2.0"
>>> | #define PACKAGE_STRING "R 2.2.0"
>>> | #define PACKAGE_BUGREPORT "r-bugs at R-project.org"
>>> | #define PACKAGE "R"
>>> | #define VERSION "2.2.0"
>>> | #define R_PLATFORM "x86_64-unknown-linux-gnu"
>>> | #define R_CPU "x86_64"
>>> | #define R_VENDOR "unknown"
>>> | #define R_OS "linux-gnu"
>>> | #define Unix 1
>>> | /* end confdefs.h.  */
>>> |
>>> | int
>>> | main ()
>>> | {
>>> | exit (42);
>>> |   ;
>>> |   return 0;
>>> | }
>>> configure:5796: /usr/pgi/linux86-64/6.0/bin/pgCC -c -g 
>>> -I/usr/pgi/linux86-64/6.0/include -I/usr/pgi/linux86-64/6.0/include/CC 
>>> conftest.cc >&5
>>> "conftest.cc", line 16: error: namespace "std" has no member "exit"
>>> extern "C" void std::exit (int) throw (); using std::exit;
>>>                      ^
>>> 
>>> "conftest.cc", line 16: error: namespace "std" has no member "exit"
>>> extern "C" void std::exit (int) throw (); using std::exit;
>>>                                                      ^
>>> 
>>> 2 errors detected in the compilation of "conftest.cc".
>>> configure:5802: $? = 2
>>> configure: failed program was:
>>> | /* confdefs.h.  */
>>> |
>>> | #define PACKAGE_NAME "R"
>>> | #define PACKAGE_TARNAME "R"
>>> | #define PACKAGE_VERSION "2.2.0"
>>> | #define PACKAGE_STRING "R 2.2.0"
>>> | #define PACKAGE_BUGREPORT "r-bugs at R-project.org"
>>> | #define PACKAGE "R"
>>> | #define VERSION "2.2.0"
>>> | #define R_PLATFORM "x86_64-unknown-linux-gnu"
>>> | #define R_CPU "x86_64"
>>> | #define R_VENDOR "unknown"
>>> | #define R_OS "linux-gnu"
>>> | #define Unix 1
>>> | /* end confdefs.h.  */
>>> | extern "C" void std::exit (int) throw (); using std::exit;
>>> | #include <stdlib.h>
>>> | int
>>> | main ()
>>> | {
>>> | exit (42);
>>> |   ;
>>> |   return 0;
>>> | }
>>> configure:5796: /usr/pgi/linux86-64/6.0/bin/pgCC -c -g 
>>> -I/usr/pgi/linux86-64/6.0/include -I/usr/pgi/linux86-64/6.0/include/CC 
>>> conftest.cc >&5
>>> "conftest.cc", line 16: error: namespace "std" has no member "exit"
>>> extern "C" void std::exit (int); using std::exit;
>>>                      ^
>>> 
>>> "conftest.cc", line 16: error: namespace "std" has no member "exit"
>>> extern "C" void std::exit (int); using std::exit;
>>>                                             ^
>>> 
>>> 2 errors detected in the compilation of "conftest.cc".
>>> configure:5802: $? = 2
>>> configure: failed program was:
>>> | /* confdefs.h.  */
>>> |
>>> | #define PACKAGE_NAME "R"
>>> | #define PACKAGE_TARNAME "R"
>>> | #define PACKAGE_VERSION "2.2.0"
>>> | #define PACKAGE_STRING "R 2.2.0"
>>> | #define PACKAGE_BUGREPORT "r-bugs at R-project.org"
>>> | #define PACKAGE "R"
>>> | #define VERSION "2.2.0"
>>> | #define R_PLATFORM "x86_64-unknown-linux-gnu"
>>> | #define R_CPU "x86_64"
>>> | #define R_VENDOR "unknown"
>>> | #define R_OS "linux-gnu"
>>> | #define Unix 1
>>> | /* end confdefs.h.  */
>>> | extern "C" void std::exit (int); using std::exit;
>>> | #include <stdlib.h>
>>> | int
>>> | main ()
>>> | {
>>> | exit (42);
>>> |   ;
>>> |   return 0;
>>> | }
>>> configure:5796: /usr/pgi/linux86-64/6.0/bin/pgCC -c -g 
>>> -I/usr/pgi/linux86-64/6.0/include -I/usr/pgi/linux86-64/6.0/include/CC 
>>> conftest.cc >&5
>>> "/usr/include/stdlib.h", line 640: error: omission of exception 
>>> specification
>>>         is incompatible with previous function "exit" (declared at line 16
>>>         of "conftest.cc")
>>> extern void exit (int __status) __THROW __attribute__ ((__noreturn__));
>>>                                                                       ^
>>> 
>>> 1 error detected in the compilation of "conftest.cc".
>>> configure:5802: $? = 2
>>> configure: failed program was:
>>> | /* confdefs.h.  */
>>> |
>>> | #define PACKAGE_NAME "R"
>>> | #define PACKAGE_TARNAME "R"
>>> | #define PACKAGE_VERSION "2.2.0"
>>> | #define PACKAGE_STRING "R 2.2.0"
>>> | #define PACKAGE_BUGREPORT "r-bugs at R-project.org"
>>> | #define PACKAGE "R"
>>> | #define VERSION "2.2.0"
>>> | #define R_PLATFORM "x86_64-unknown-linux-gnu"
>>> | #define R_CPU "x86_64"
>>> | #define R_VENDOR "unknown"
>>> | #define R_OS "linux-gnu"
>>> | #define Unix 1
>>> | /* end confdefs.h.  */
>>> | extern "C" void exit (int) throw ();
>>> | #include <stdlib.h>
>>> | int
>>> | main ()
>>> | {
>>> | exit (42);
>>> |   ;
>>> |   return 0;
>>> | }
>>> configure:5796: /usr/pgi/linux86-64/6.0/bin/pgCC -c -g 
>>> -I/usr/pgi/linux86-64/6.0/include -I/usr/pgi/linux86-64/6.0/include/CC 
>>> conftest.cc >&5
>>> NOTE: your evaluation license will expire in 14 days, 5.7 hours.
>>> For a permanent license, please read the order acknowledgement
>>> that you received.  Connect to https://www.pgroup.com/License with
>>> the username and password in the order acknowledgement.
>>> 
>>>   Name:    lai
>>>   User:    lai
>>>   Email:    lai at lindaspaces.com
>>>   Hostid:    PGI=00001AE0193111621CB217
>>> configure:5802: $? = 0
>>> configure:5806: test -z
>>>            || test ! -s conftest.err
>>> configure:5809: $? = 0
>>> configure:5812: test -s conftest.o
>>> configure:5815: $? = 0
>>> configure:5841: /usr/pgi/linux86-64/6.0/bin/pgCC -c -g 
>>> -I/usr/pgi/linux86-64/6.0/include -I/usr/pgi/linux86-64/6.0/include/CC 
>>> conftest.cc >&5
>>> NOTE: your evaluation license will expire in 14 days, 5.7 hours.
>>> For a permanent license, please read the order acknowledgement
>>> that you received.  Connect to https://www.pgroup.com/License with
>>> the username and password in the order acknowledgement.
>>> 
>>>   Name:    lai
>>>   User:    lai
>>>   Email:    lai at lindaspaces.com
>>>   Hostid:    PGI=00001AE0193111621CB217
>>> configure:5847: $? = 0
>>> configure:5851: test -z
>>>            || test ! -s conftest.err
>>> configure:5854: $? = 0
>>> configure:5857: test -s conftest.o
>>> configure:5860: $? = 0
>>> configure:5888: checking how to run the C++ preprocessor
>>> configure:5919: /usr/pgi/linux86-64/6.0/bin/pgCC -E 
>>> -I/usr/pgi/linux86-64/6.0/include -I/usr/pgi/linux86-64/6.0/include/CC 
>>> conftest.cc
>>> configure:5925: $? = 0
>>> configure:5957: /usr/pgi/linux86-64/6.0/bin/pgCC -E 
>>> -I/usr/pgi/linux86-64/6.0/include -I/usr/pgi/linux86-64/6.0/include/CC 
>>> conftest.cc
>>> "conftest.cc", line 19: catastrophic error: could not open source file
>>>         "ac_nonexistent.h"
>>> #include <ac_nonexistent.h>
>>>                            ^
>>> 
>>> 1 catastrophic error detected in the compilation of "conftest.cc".
>>> Compilation terminated.
>>> configure:5963: $? = 2
>>> configure: failed program was:
>>> | /* confdefs.h.  */
>>> |
>>> | #define PACKAGE_NAME "R"
>>> | #define PACKAGE_TARNAME "R"
>>> | #define PACKAGE_VERSION "2.2.0"
>>> | #define PACKAGE_STRING "R 2.2.0"
>>> | #define PACKAGE_BUGREPORT "r-bugs at R-project.org"
>>> | #define PACKAGE "R"
>>> | #define VERSION "2.2.0"
>>> | #define R_PLATFORM "x86_64-unknown-linux-gnu"
>>> | #define R_CPU "x86_64"
>>> | #define R_VENDOR "unknown"
>>> | #define R_OS "linux-gnu"
>>> | #define Unix 1
>>> | #ifdef __cplusplus
>>> | extern "C" void exit (int);
>>> | #endif
>>> | /* end confdefs.h.  */
>>> | #include <ac_nonexistent.h>
>>> configure:6002: result: /usr/pgi/linux86-64/6.0/bin/pgCC -E
>>> configure:6026: /usr/pgi/linux86-64/6.0/bin/pgCC -E 
>>> -I/usr/pgi/linux86-64/6.0/include -I/usr/pgi/linux86-64/6.0/include/CC 
>>> conftest.cc
>>> configure:6032: $? = 0
>>> configure:6064: /usr/pgi/linux86-64/6.0/bin/pgCC -E 
>>> -I/usr/pgi/linux86-64/6.0/include -I/usr/pgi/linux86-64/6.0/include/CC 
>>> conftest.cc
>>> "conftest.cc", line 19: catastrophic error: could not open source file
>>>         "ac_nonexistent.h"
>>> #include <ac_nonexistent.h>
>>>                            ^
>>> 
>>> 1 catastrophic error detected in the compilation of "conftest.cc".
>>> Compilation terminated.
>>> configure:6070: $? = 2
>>> configure: failed program was:
>>> | /* confdefs.h.  */
>>> |
>>> | #define PACKAGE_NAME "R"
>>> | #define PACKAGE_TARNAME "R"
>>> | #define PACKAGE_VERSION "2.2.0"
>>> | #define PACKAGE_STRING "R 2.2.0"
>>> | #define PACKAGE_BUGREPORT "r-bugs at R-project.org"
>>> | #define PACKAGE "R"
>>> | #define VERSION "2.2.0"
>>> | #define R_PLATFORM "x86_64-unknown-linux-gnu"
>>> | #define R_CPU "x86_64"
>>> | #define R_VENDOR "unknown"
>>> | #define R_OS "linux-gnu"
>>> | #define Unix 1
>>> | #ifdef __cplusplus
>>> | extern "C" void exit (int);
>>> | #endif
>>> | /* end confdefs.h.  */
>>> | #include <ac_nonexistent.h>
>>> 
>>> 
>>> Thank you in advance for your help!
>>> 
>>> Sincerely,
>>> Jennifer
>>> 
>>> Prof Brian Ripley wrote:
>>> 
>>>> regex.c is not our code, but from glibc.  Could you please try R-devel 
>>>> instead, which has a later version of glibc.  Since 2.1.1 is not longer 
>>>> part of the developement, we cannot help with that, but we can help wih 
>>>> R-devel.
>>>> 
>>>> I see the later regex.c does use prototypes.  But bitset is an integer 
>>>> type, so that may be a compiler error.
>>>> 
>>>> (It is on my list to try Intel and PG compilers on AMD64 as we have 
>>>> licences, but not very high priority.)
>>>> 
>>>> 
>>>> 
>>> 
>>> 
>>> 
>> 
>
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From rabrantes82 at gmail.com  Tue Aug 30 18:37:30 2005
From: rabrantes82 at gmail.com (Ricardo Luiz Andrade Abrantes)
Date: Tue, 30 Aug 2005 13:37:30 -0300
Subject: [Rd] .Call and Segmentation Fault
In-Reply-To: <6FFFED9A-D317-48DA-9A13-AC792C1D73E7@r-project.org>
References: <973080e10508261519699235ea@mail.gmail.com>
	<F81375EB-3C7E-4385-ADC1-8842A449A332@stat.harvard.edu>
	<973080e10508271924266ea3bf@mail.gmail.com>
	<Pine.LNX.4.61.0508280718090.3599@gannet.stats>
	<973080e105082809105c4e6230@mail.gmail.com>
	<6FFFED9A-D317-48DA-9A13-AC792C1D73E7@r-project.org>
Message-ID: <973080e105083009371a9a5ff7@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20050830/c2d035b1/attachment.pl

From dhinds at sonic.net  Tue Aug 30 18:46:09 2005
From: dhinds at sonic.net (dhinds@sonic.net)
Date: Tue, 30 Aug 2005 16:46:09 +0000 (UTC)
Subject: [Rd] RFC: "loop connections"
References: <dedndn$daj$1@sea.gmane.org>
	<17168.15848.291481.473231@stat.math.ethz.ch>
	<deqhed$u28$1@sea.gmane.org>
	<971536df0508271638166beecd@mail.gmail.com>
Message-ID: <df22gh$72u$1@sea.gmane.org>

Gabor Grothendieck <ggrothendieck at gmail.com> wrote:

> Just to be concrete, suppose one wants to run the following as a
> concurrent process to R.  (What is does is it implicitly sets x to
> zero and then for each line of stdin it adds the first field of the
> input to x and prints that to stdout unless the first field is
> "exit" in which case it exits.  gawk has an implicit read/process
> loop so one does not have to specify the read step.  The fflush()
> command just makes sure that output is emitted, rather than
> buffered, as it is produced.)

It seems you're just trying to reinvent fifo and/or pipe connections
for interprocess communication.  That is not directly related to the
problem I wanted to address.

-- Dave


From jago at mclink.it  Tue Aug 30 19:12:57 2005
From: jago at mclink.it (stefano iacus)
Date: Tue, 30 Aug 2005 19:12:57 +0200
Subject: [Rd] Fwd: segfault
In-Reply-To: <Pine.LNX.4.61.0508290930250.29579@gannet.stats>
References: <p06230901bf3759687fd6@[84.173.69.150]>
	<AE67BE22-269F-4ED4-A6E3-D800A1F91496@mclink.it>
	<Pine.LNX.4.61.0508290930250.29579@gannet.stats>
Message-ID: <90104E46-4CF0-48ED-9B75-C4C49D4D9540@mclink.it>


On 29/ago/05, at 10:35, Prof Brian Ripley wrote:

> It does not crash for me on either Windows or Linux, but it does  
> take a
> long time and the plot is a mess, so there does seem to be a
> lattice-related problem (maybe a usage one).
>
> However, I think the crash is a Mac (presumably quartz()) problem.
>

no, it also happens with the X11 device. BTW, it seems to be OS X  
specific.
I'll try to debug
stefano

> On Mon, 29 Aug 2005, stefano iacus wrote:
>
>
>> This segfaults on OS X (10.4) on both X11 and quartz devices.
>> Seems a problem with lattice but I cannot test on other platforms
>> stefano
>>
>>
>> Begin forwarded message:
>>
>>
>>> From: "G. Sawitzki" <gs at statlab.uni-heidelberg.de>
>>> Date: 28 agosto 2005 14:11:18 GMT+02:00
>>> To: jago at mclink.it
>>>
>>>
>>> Dear Stefano,
>>>
>>>  this small exaple leads to a crash of R. I did not try it on
>>> versions other than the Mac version. So I am sending it to you
>>> directly. If it is a littice problem, could you pass it to Deepayan
>>> Sarkar? Thank you.
>>>
>>>   g.
>>>
>>> ==
>>> #pbinom
>>> library(grid)
>>> library(lattice)
>>>
>>> n<-20
>>> psteps<-50
>>> binomtable<- function (n,psteps){
>>> x<-(0:(10*n))/10
>>> p<- (0:psteps)/psteps
>>> dd<-expand.grid(x=x,p=p)
>>> dd$F<- pbinom(dd$x,n,dd$p)
>>> dd$x0<-trunc(dd$x)
>>> dd
>>> }
>>>
>>> bt<-binomtable(n=5,psteps=100)
>>> bt[bt$x-bt$x0>=0.9,]$F<-NA
>>> wireframe(bt$F~bt$x*bt$p,bt,groups=bt$x0,shade=TRUE) # leads to R
>>> crash
>>> #wireframe(bt$F~bt$x*bt$p,bt,shade=TRUE) #ok
>>>
>
> -- 
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From rabrantes82 at gmail.com  Tue Aug 30 20:02:32 2005
From: rabrantes82 at gmail.com (Ricardo Luiz Andrade Abrantes)
Date: Tue, 30 Aug 2005 15:02:32 -0300
Subject: [Rd]  .Call and Segmentation Fault
In-Reply-To: <973080e105083009371a9a5ff7@mail.gmail.com>
References: <973080e10508261519699235ea@mail.gmail.com>
	<F81375EB-3C7E-4385-ADC1-8842A449A332@stat.harvard.edu>
	<973080e10508271924266ea3bf@mail.gmail.com>
	<Pine.LNX.4.61.0508280718090.3599@gannet.stats>
	<973080e105082809105c4e6230@mail.gmail.com>
	<6FFFED9A-D317-48DA-9A13-AC792C1D73E7@r-project.org>
	<973080e105083009371a9a5ff7@mail.gmail.com>
Message-ID: <973080e1050830110270b00ede@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20050830/bc8a88f6/attachment.pl

From rabrantes82 at gmail.com  Tue Aug 30 22:32:52 2005
From: rabrantes82 at gmail.com (Ricardo Luiz Andrade Abrantes)
Date: Tue, 30 Aug 2005 17:32:52 -0300
Subject: [Rd] .Call and Segmentation Fault
In-Reply-To: <Pine.LNX.4.61.0508280718090.3599@gannet.stats>
References: <973080e10508261519699235ea@mail.gmail.com>
	<F81375EB-3C7E-4385-ADC1-8842A449A332@stat.harvard.edu>
	<973080e10508271924266ea3bf@mail.gmail.com>
	<Pine.LNX.4.61.0508280718090.3599@gannet.stats>
Message-ID: <973080e1050830133260bec316@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20050830/fb37fcb4/attachment.pl

From p.dalgaard at biostat.ku.dk  Wed Aug 31 00:03:21 2005
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: 31 Aug 2005 00:03:21 +0200
Subject: [Rd] .Call and Segmentation Fault
In-Reply-To: <973080e1050830133260bec316@mail.gmail.com>
References: <973080e10508261519699235ea@mail.gmail.com>
	<F81375EB-3C7E-4385-ADC1-8842A449A332@stat.harvard.edu>
	<973080e10508271924266ea3bf@mail.gmail.com>
	<Pine.LNX.4.61.0508280718090.3599@gannet.stats>
	<973080e1050830133260bec316@mail.gmail.com>
Message-ID: <x2oe7faxqu.fsf@turmalin.kubism.ku.dk>

Ricardo Luiz Andrade Abrantes <rabrantes82 at gmail.com> writes:

> Hello to everybody!
> After reading all the C code, checking for problems, and find nothing, I 
> decided something a little bit different...
> If my ".so" library works in a wrog way in R it should do the same in C. So 
> I created a C program that loads my library file and the executes the same 
> function R is executing.
> The program worked perfectly! In fact I changed two things in my library: 
> The function I call now return an int, not a SEXP, and the return value is 0 
> not R_NilValue.
> Valgrind's output is ok too... 
> If .Call has no problems, and if my function works perfect when called from 
> a C program, where the problem lies? Why my program becomes "crazy" when I 
> run it from R?
> I would apreciate very much your help! I don't where else I could find help 
> on this.

Well, did you try running under a debugger? 

  R -d gdb 

then "bt" after the segfault. (Make sure that things are compiled with
-g option)



-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From mlopez at iattc.org  Wed Aug 31 01:27:31 2005
From: mlopez at iattc.org (Milton Lopez)
Date: Tue, 30 Aug 2005 16:27:31 -0700
Subject: [Rd] 64 bit R for Windows
Message-ID: <84B25EE9B4CB1A47A197E6AE76790D7801426CC5@mail1.lajolla.iattc.org>

I am assisting in the purchase of 64-bit Windows XP system for researchers who run R. These systems will have AMD Opteron processors and at least 4GB of RAM. I'd appreciate advice on whether there is a working version of R that can take full advantage of such systems.

Milton F. L?pez 
IT Guy
Inter-American Tuna Commission (IATTC)
8604 La Jolla Shores Drive 
La Jolla, CA 92037 
Tel: (858) 546-7041, Fax: (858) 546-7133 
email: mlopez at iattc.org
Web: http://www.iattc.org


From tlumley at u.washington.edu  Wed Aug 31 01:46:10 2005
From: tlumley at u.washington.edu (Thomas Lumley)
Date: Tue, 30 Aug 2005 16:46:10 -0700 (PDT)
Subject: [Rd] .Call and Segmentation Fault
In-Reply-To: <x2oe7faxqu.fsf@turmalin.kubism.ku.dk>
References: <973080e10508261519699235ea@mail.gmail.com>
	<F81375EB-3C7E-4385-ADC1-8842A449A332@stat.harvard.edu>
	<973080e10508271924266ea3bf@mail.gmail.com>
	<Pine.LNX.4.61.0508280718090.3599@gannet.stats>
	<973080e1050830133260bec316@mail.gmail.com>
	<x2oe7faxqu.fsf@turmalin.kubism.ku.dk>
Message-ID: <Pine.A41.4.61b.0508301642370.37942@homer05.u.washington.edu>

On Tue, 31 Aug 2005, Peter Dalgaard wrote:

> Well, did you try running under a debugger?
>
>  R -d gdb
>
> then "bt" after the segfault. (Make sure that things are compiled with
> -g option)

It would also be worth renaming the the function -- while I don't see 
exactly how it could be causing the problem, I would be nervous about 
having a C function called main() that wasn't the real main().

 	-thomas


From murdoch at stats.uwo.ca  Wed Aug 31 02:38:36 2005
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Tue, 30 Aug 2005 20:38:36 -0400
Subject: [Rd] 64 bit R for Windows
In-Reply-To: <84B25EE9B4CB1A47A197E6AE76790D7801426CC5@mail1.lajolla.iattc.org>
References: <84B25EE9B4CB1A47A197E6AE76790D7801426CC5@mail1.lajolla.iattc.org>
Message-ID: <4314FC0C.9090107@stats.uwo.ca>

Milton Lopez wrote:
> I am assisting in the purchase of 64-bit Windows XP system for researchers who run R. These systems will have AMD Opteron processors and at least 4GB of RAM. I'd appreciate advice on whether there is a working version of R that can take full advantage of such systems.

No, there are no 64 bit Windows versions yet.  You'll need to install 
some 64 bit version of Linux on those machines to take full advantage of 
the chips.

Duncan Murdoch


From Rob.Hyndman at buseco.monash.edu.au  Wed Aug 31 03:55:53 2005
From: Rob.Hyndman at buseco.monash.edu.au (Rob.Hyndman@buseco.monash.edu.au)
Date: Wed, 31 Aug 2005 03:55:53 +0200 (CEST)
Subject: [Rd] pf hangs with infinite arguments (PR#8110)
Message-ID: <20050831015553.A4FFD19945@slim.kubism.ku.dk>

Full_Name: Rob Hyndman
Version: 2.1.1
OS: Windows
Submission from: (NULL) (202.7.176.132)


pf(Inf,x,Inf) causes R to hang up for any value of x.


From ripley at stats.ox.ac.uk  Wed Aug 31 08:23:10 2005
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 31 Aug 2005 07:23:10 +0100 (BST)
Subject: [Rd] pf hangs with infinite arguments (PR#8110)
In-Reply-To: <20050831015553.A4FFD19945@slim.kubism.ku.dk>
References: <20050831015553.A4FFD19945@slim.kubism.ku.dk>
Message-ID: <Pine.LNX.4.61.0508310705510.25305@gannet.stats>

Which x?  Not for 1, 10, Inf for example.

I did manage to make pf(Inf, 5, Inf) hang, but not under R-patched or 
R-devel.  It seems this is already fixed (please see the reporting 
conditions in the FAQ or in the posting guide).

pf(Inf, n1, Inf) is the same code as pchisq(Inf, n1) and pgamma(Inf, n1/2)
The latter seems to be the same as PR#8001, as in the NEWS item

     o   pgamma(Inf, 1.1) did not terminate (PR#8001).

Please reopen this if you can reproduce it in R-devel (soon to become 
2.2.0) or R-patched.


On Wed, 31 Aug 2005 Rob.Hyndman at buseco.monash.edu.au wrote:

> Full_Name: Rob Hyndman
> Version: 2.1.1
> OS: Windows
> Submission from: (NULL) (202.7.176.132)
>
>
> pf(Inf,x,Inf) causes R to hang up for any value of x.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From r.hankin at noc.soton.ac.uk  Wed Aug 31 09:09:15 2005
From: r.hankin at noc.soton.ac.uk (Robin Hankin)
Date: Wed, 31 Aug 2005 08:09:15 +0100
Subject: [Rd] generic function argument list problem
Message-ID: <4EC54477-49E9-4F03-8151-5339D493895B@soc.soton.ac.uk>

Hi

it says in R-exts that


     A method must have all the arguments of the generic,  
including ... if the generic does.
     A method must have arguments in exactly the same order as the  
generic.
     A method should use the same defaults as the generic.


So, how come the arguments for rep() are (x, times, ...) and the  
arguments
for rep.default() are  (x, times, length.out, each, ...) ?  Shouldn't  
these be the same?


I am writing a rep() method for objects with class "octonion", and
my function rep.octonion() has argument list (x, times, length.out,  
each, ...)
just like rep.default(),   but  R CMD check complains about it, pointing
out that rep() and rep.octonion() have different arguments.

What do I have to do to my rep.octonion() function to make my package
  pass R CMD check without warning?


--
Robin Hankin
Uncertainty Analyst
National Oceanography Centre, Southampton
European Way, Southampton SO14 3ZH, UK
  tel  023-8059-7743


From maechler at stat.math.ethz.ch  Wed Aug 31 09:30:37 2005
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Wed, 31 Aug 2005 09:30:37 +0200
Subject: [Rd] generic function argument list problem
In-Reply-To: <4EC54477-49E9-4F03-8151-5339D493895B@soc.soton.ac.uk>
References: <4EC54477-49E9-4F03-8151-5339D493895B@soc.soton.ac.uk>
Message-ID: <17173.23709.250876.379303@stat.math.ethz.ch>

>>>>> "Robin" == Robin Hankin <r.hankin at noc.soton.ac.uk>
>>>>>     on Wed, 31 Aug 2005 08:09:15 +0100 writes:

    Robin> Hi it says in R-exts that

    1) A method must have all the arguments of the generic,  
       including ... if the generic does.

    2) A method must have arguments in exactly the same order as the generic.

    3) A method should use the same defaults as the generic.


    Robin> So, how come the arguments for rep() are (x, times, ...) and the  
    Robin> arguments
    Robin> for rep.default() are  (x, times, length.out, each, ...) ?  Shouldn't  
    Robin> these be the same?

no.  If they should be the same, the "R-exts" manual would use
a much shorter formulation than the carefully crafted points
1--3 above!

The point is that methods often have  *extra* arguments
which match the "..." of the generic. 
That's one of the points about "..." !

Martin Maechler, ETH Zurich


    Robin> I am writing a rep() method for objects with class "octonion", and
    Robin> my function rep.octonion() has argument list (x, times, length.out,  
    Robin> each, ...)
    Robin> just like rep.default(),   but  R CMD check complains about it, pointing
    Robin> out that rep() and rep.octonion() have different arguments.

    Robin> What do I have to do to my rep.octonion() function to make my package
    Robin> pass R CMD check without warning?


    Robin> --
    Robin> Robin Hankin
    Robin> Uncertainty Analyst
    Robin> National Oceanography Centre, Southampton
    Robin> European Way, Southampton SO14 3ZH, UK
    Robin> tel  023-8059-7743

    Robin> ______________________________________________
    Robin> R-devel at r-project.org mailing list
    Robin> https://stat.ethz.ch/mailman/listinfo/r-devel



    Robin>      A method must have all the arguments of the
    Robin> generic, including ... if the generic does.  A method
    Robin> must have arguments in exactly the same order as the
    Robin> generic.  A method should use the same defaults as
    Robin> the generic.


    Robin> So, how come the arguments for rep() are (x, times,
    Robin> ...) and the arguments for rep.default() are (x,
    Robin> times, length.out, each, ...) ?  Shouldn't these be
    Robin> the same?


    Robin> I am writing a rep() method for objects with class
    Robin> "octonion", and my function rep.octonion() has
    Robin> argument list (x, times, length.out, each, ...)  just
    Robin> like rep.default(), but R CMD check complains about
    Robin> it, pointing out that rep() and rep.octonion() have
    Robin> different arguments.

    Robin> What do I have to do to my rep.octonion() function to
    Robin> make my package pass R CMD check without warning?


    Robin> -- Robin Hankin Uncertainty Analyst National
    Robin> Oceanography Centre, Southampton European Way,
    Robin> Southampton SO14 3ZH, UK tel 023-8059-7743

    Robin> ______________________________________________
    Robin> R-devel at r-project.org mailing list
    Robin> https://stat.ethz.ch/mailman/listinfo/r-devel


From Mark.Bravington at csiro.au  Wed Aug 31 09:33:56 2005
From: Mark.Bravington at csiro.au (Mark.Bravington@csiro.au)
Date: Wed, 31 Aug 2005 17:33:56 +1000
Subject: [Rd] pos option to function 'library'
Message-ID: <D79013E40FEF254AAF0D72DFC94F274803D8A2@extas4-hba.tas.csiro.au>

At the moment, the 'pos' argument to 'library' defaults to 2. Would it
be possible to change this default to something functionally like the
following?

pos= if( is.null( pos.expr <- getOption( 'library.pos.default.expr'))) 2
else eval( pos.expr)

The proposal is fully back-compatible in that 'pos' still defaults to 2
unless the user (or a package) sets the option. The point of the change
is to allow flexibility in the default attachment position. The
'mvbutils' package needs to be able to attach packages at default
positions lower than 2, otherwise its chain of workspaces gets confused.
For the last three years, I've done this by modifying 'library' itself
so that 'pos' defaults to the functional equivalent of the above, but
I'd prefer not to have to hack a system function.

Slightly more readable would be

pos=default.lib.pos()

where

default.lib.pos <- function() if( is.null( pos.expr <- getOption(
'library.pos.default.expr'))) 2 else eval( pos.expr)

is defined inside 'library'.

Mark Bravington
CSIRO Mathematical & Information Sciences
Marine Laboratory
Castray Esplanade
Hobart 7001
TAS

ph (+61) 3 6232 5118
fax (+61) 3 6232 5012
mob (+61) 438 315 623


From maechler at stat.math.ethz.ch  Wed Aug 31 09:34:47 2005
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Wed, 31 Aug 2005 09:34:47 +0200
Subject: [Rd] generic function argument list problem
In-Reply-To: <4EC54477-49E9-4F03-8151-5339D493895B@soc.soton.ac.uk>
References: <4EC54477-49E9-4F03-8151-5339D493895B@soc.soton.ac.uk>
Message-ID: <17173.23959.702128.595982@stat.math.ethz.ch>

>>>>> "Robin" == Robin Hankin <r.hankin at noc.soton.ac.uk>
>>>>>     on Wed, 31 Aug 2005 08:09:15 +0100 writes:

	  ................

    Robin> I am writing a rep() method for objects with class "octonion", and
    Robin> my function rep.octonion() has argument list (x, times, length.out,  
    Robin> each, ...)
    Robin> just like rep.default(),   but  R CMD check complains about it, pointing
    Robin> out that rep() and rep.octonion() have different arguments.

Hmm, not exactly, ``like rep.default'', I'm pretty sure.
Why not peek into R's <source>/src/library/base/man/rep.Rd  
which has

\usage{
rep(x, times, \dots)

\method{rep}{default}(x, times, length.out, each, \dots)
}

and definitely passes R CMD check without a warning.

    Robin> What do I have to do to my rep.octonion() function to make my package
    Robin> pass R CMD check without warning?


From jarioksa at sun3.oulu.fi  Wed Aug 31 10:04:42 2005
From: jarioksa at sun3.oulu.fi (Jari Oksanen)
Date: Wed, 31 Aug 2005 11:04:42 +0300
Subject: [Rd] generic function argument list problem
In-Reply-To: <4EC54477-49E9-4F03-8151-5339D493895B@soc.soton.ac.uk>
References: <4EC54477-49E9-4F03-8151-5339D493895B@soc.soton.ac.uk>
Message-ID: <1125475483.23565.10.camel@biol102145.oulu.fi>

On Wed, 2005-08-31 at 08:09 +0100, Robin Hankin wrote:
> Hi
> 
> it says in R-exts that
> 
> 
>      A method must have all the arguments of the generic,  
> including ... if the generic does.
>      A method must have arguments in exactly the same order as the  
> generic.
>      A method should use the same defaults as the generic.
> 
> 
> So, how come the arguments for rep() are (x, times, ...) and the  
> arguments
> for rep.default() are  (x, times, length.out, each, ...) ?
Shouldn't  
> these be the same?
> 
> 
> I am writing a rep() method for objects with class "octonion", and
> my function rep.octonion() has argument list (x, times, length.out,  
> each, ...)
> just like rep.default(),   but  R CMD check complains about it,
pointing
> out that rep() and rep.octonion() have different arguments.
> 
> What do I have to do to my rep.octonion() function to make my package
>   pass R CMD check without warning?
> 
I cannot repeat your problem. Probably you did something differently
than you said (like omitted "..." , misspelled times as time or
something else in your rep.octonion).

This is what I tried.

In R:
> str(rep)
function (x, times, ...)
> rep.octonion <- function(x, times, length.out, each, ...) {}
> package.skeleton("octonion", "rep.octonion")
Creating directories ...
Creating DESCRIPTION ...
Creating READMEs ...
Saving functions and data ...
Making help files ...
Created file named './octonion/man/rep.octonion.Rd'.
Edit the file and move it to the appropriate directory.
Done.
Further steps are described in ./octonion/README

Then I edited octonion/man/rep.octonion.Rd so that it uses the generic
and passes R CMD check (virgin Rd files produced by package.skeleton
fail the test, which I found a bit weird). Here are the minimum changes
you need to pass the tests.

--- rep.octonion.Rd.orig        2005-08-31 10:56:36.000000000 +0300
+++ rep.octonion.Rd     2005-08-31 10:55:25.000000000 +0300
@@ -7,5 +7,5 @@
 }
 \usage{
-rep.octonion(x, times, length.out, each, ...)
+\method{rep}{octonion}(x, times, length.out, each, ...)
 }
 %- maybe also 'usage' for other objects documented here.
@@ -18,5 +18,5 @@
 }
 \details{
-  ~~ If necessary, more details than the __description__  above ~~
+  ~~ If necessary, more details than the description  above ~~
 }
 \value{
@@ -31,7 +31,7 @@
 \note{ ~~further notes~~ }

- ~Make other sections like Warning with \section{Warning }{....} ~

-\seealso{ ~~objects to See Also as \code{\link{~~fun~~}}, ~~~ }
+
+\seealso{ ~~objects to See Also as \code{\link{rep}}, ~~~ }
 \examples{
 ##---- Should be DIRECTLY executable !! ----
@@ -42,4 +42,4 @@
 function(x, time, length.out, each, ...) {}
 }
-\keyword{ ~kwd1 }% at least one, from doc/KEYWORDS
-\keyword{ ~kwd2 }% __ONLY ONE__ keyword per line
+\keyword{ models }% at least one, from doc/KEYWORDS
+

So this replaces rep.octonion with \method{rep}{octonion}, removes __
from description (these cause latex errors), remove a hanging top level
text "Make other sections...", and removes a link to non-existent
~~fun~~ (I'm not sure if adding a real keyword is necessary).

This passes tests. Including 

* checking S3 generic/method consistency ... OK

Conclusion: check your files. (It is pain: been there, done that.)

cheers, jari oksanen


From gb at stat.umu.se  Wed Aug 31 10:06:36 2005
From: gb at stat.umu.se (=?iso-8859-1?Q?G=F6ran_Brostr=F6m?=)
Date: Wed, 31 Aug 2005 10:06:36 +0200
Subject: [Rd] generic function argument list problem
In-Reply-To: <17173.23709.250876.379303@stat.math.ethz.ch>
References: <4EC54477-49E9-4F03-8151-5339D493895B@soc.soton.ac.uk>
	<17173.23709.250876.379303@stat.math.ethz.ch>
Message-ID: <20050831080636.GA5116@stat.umu.se>

On Wed, Aug 31, 2005 at 09:30:37AM +0200, Martin Maechler wrote:
> >>>>> "Robin" == Robin Hankin <r.hankin at noc.soton.ac.uk>
> >>>>>     on Wed, 31 Aug 2005 08:09:15 +0100 writes:
> 
>     Robin> Hi it says in R-exts that
> 
>     1) A method must have all the arguments of the generic,  
>        including ... if the generic does.
>  
>     2) A method must have arguments in exactly the same order as the generic.
> 
>     3) A method should use the same defaults as the generic.
> 
> 
>     Robin> So, how come the arguments for rep() are (x, times, ...) and the  
>     Robin> arguments
>     Robin> for rep.default() are  (x, times, length.out, each, ...) ?  Shouldn't  
>     Robin> these be the same?
> 
> no.  If they should be the same, the "R-exts" manual would use
> a much shorter formulation than the carefully crafted points
> 1--3 above!

Martin, sorry if I am pedantic, but is 2. above that clear? Suppose that
the generic has arguments (a, b, ...). Then, if I want to add an argument
'X' to a method, the argument list (a, b, X, ...) for the method would be OK,
right? But how about (a, X, b, ...) or (a, b, ..., X)? I guess that would 
be wrong (but I haven't checked; is it maybe ok?!). 

The point is: What does it mean that two lists "have arguments in exactly 
the same order", when one list is a proper subset of the other? Maybe one 
should add "The common arguments, except ..., must have exactly the same 
_position_ in the generic and the method." 

G?ran


From ellis at stat.harvard.edu  Wed Aug 31 10:23:56 2005
From: ellis at stat.harvard.edu (Byron Ellis)
Date: Wed, 31 Aug 2005 01:23:56 -0700
Subject: [Rd] Fwd: segfault
In-Reply-To: <90104E46-4CF0-48ED-9B75-C4C49D4D9540@mclink.it>
References: <p06230901bf3759687fd6@[84.173.69.150]>
	<AE67BE22-269F-4ED4-A6E3-D800A1F91496@mclink.it>
	<Pine.LNX.4.61.0508290930250.29579@gannet.stats>
	<90104E46-4CF0-48ED-9B75-C4C49D4D9540@mclink.it>
Message-ID: <B2C92800-D422-45C5-B281-F597A7639FE6@stat.harvard.edu>

There's definitely something a bit strange going on. The arguments as  
passed to wireframePanelCalculations from the code snippet show only  
6060 elements for the z vector (51,101,16 respectively for x,y,rot)  
while the function routinely tries to access at positions in the z  
vector >20,000... until it eventually falls over (how long this takes  
seems to depend on circumstances, I can actually get it to complete a  
run while running in gdb).

On Aug 30, 2005, at 10:12 AM, stefano iacus wrote:

>
> On 29/ago/05, at 10:35, Prof Brian Ripley wrote:
>
>
>> It does not crash for me on either Windows or Linux, but it does
>> take a
>> long time and the plot is a mess, so there does seem to be a
>> lattice-related problem (maybe a usage one).
>>
>> However, I think the crash is a Mac (presumably quartz()) problem.
>>
>>
>
> no, it also happens with the X11 device. BTW, it seems to be OS X
> specific.
> I'll try to debug
> stefano
>
>
>> On Mon, 29 Aug 2005, stefano iacus wrote:
>>
>>
>>
>>> This segfaults on OS X (10.4) on both X11 and quartz devices.
>>> Seems a problem with lattice but I cannot test on other platforms
>>> stefano
>>>
>>>
>>> Begin forwarded message:
>>>
>>>
>>>
>>>> From: "G. Sawitzki" <gs at statlab.uni-heidelberg.de>
>>>> Date: 28 agosto 2005 14:11:18 GMT+02:00
>>>> To: jago at mclink.it
>>>>
>>>>
>>>> Dear Stefano,
>>>>
>>>>  this small exaple leads to a crash of R. I did not try it on
>>>> versions other than the Mac version. So I am sending it to you
>>>> directly. If it is a littice problem, could you pass it to Deepayan
>>>> Sarkar? Thank you.
>>>>
>>>>   g.
>>>>
>>>> ==
>>>> #pbinom
>>>> library(grid)
>>>> library(lattice)
>>>>
>>>> n<-20
>>>> psteps<-50
>>>> binomtable<- function (n,psteps){
>>>> x<-(0:(10*n))/10
>>>> p<- (0:psteps)/psteps
>>>> dd<-expand.grid(x=x,p=p)
>>>> dd$F<- pbinom(dd$x,n,dd$p)
>>>> dd$x0<-trunc(dd$x)
>>>> dd
>>>> }
>>>>
>>>> bt<-binomtable(n=5,psteps=100)
>>>> bt[bt$x-bt$x0>=0.9,]$F<-NA
>>>> wireframe(bt$F~bt$x*bt$p,bt,groups=bt$x0,shade=TRUE) # leads to R
>>>> crash
>>>> #wireframe(bt$F~bt$x*bt$p,bt,shade=TRUE) #ok
>>>>
>>>>
>>
>> -- 
>> Brian D. Ripley,                  ripley at stats.ox.ac.uk
>> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
>> University of Oxford,             Tel:  +44 1865 272861 (self)
>> 1 South Parks Road,                     +44 1865 272866 (PA)
>> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

---
Byron Ellis (ellis at stat.harvard.edu)
"Oook" -- The Librarian


From jarioksa at sun3.oulu.fi  Wed Aug 31 10:58:10 2005
From: jarioksa at sun3.oulu.fi (Jari Oksanen)
Date: Wed, 31 Aug 2005 11:58:10 +0300
Subject: [Rd] Why should package.skeleton() fail R CMD check?
Message-ID: <1125478690.23565.34.camel@biol102145.oulu.fi>

I find it a bit peculiar that a package skeleton created with a utils
function package.skeleton() fails subsequent R CMD check. I do
understand that the function is intended to produce only a skeleton that
should be edited by the package author. I think that it would be
justified to say that the skeleton *should* fail the test. However, I
have two arguments against intentional failure:

* When you produce a skeleton, a natural thing is to see if it works and
run R CMD check. It is is baffling (but educating) if this fails.

* The second argument is more major: If you produce a package with
several functions, you want to edit one Rd file in time to see what
errors you made. You don't want to correct errors in other Rd files not
yet edited by you to see your own errors. This kind of incremental
editing is much more pleasant, as following strict R code is painful
even with your own mistakes.

The failure comes only from Rd files, and it seems that the violating
code is produced by prompt.default function hidden in the utils
namespace. I attach a uniform diff file which shows the minimal set of
changes I had to do make utils:::prompt.default to produce Rd files
passing R CMD check. There are still two warnings: one on missing source
files and another on missing keywords, but these are not fatal. This
still produces bad looking latex. These are the changes I made 

* I replaced "__description__" with "description", since "__" will give
latex errors. 

* I enclosed ""Make other sections" within Note, so that it won't give
error on stray top level text. It will now appear as numbered latex
\section{} in dvi file, but that can the package author correct.

* I replaced reference to a non-existent function ~~fun~~ with a
reference to function help. 

I'm sorry for the formatting of the diff file: my emacs/ESS is cleverer
than I and changes indentation and line breaks against my will.

cheers, jari oksanen
-- 
Jari Oksanen -- Dept Biology, Univ Oulu, 90014 Oulu, Finland
Ph. +358 8 5531526, cell +358 40 5136529, fax +358 8 5531061
email jari.oksanen at oulu.fi, homepage http://cc.oulu.fi/~jarioksa/

From maechler at stat.math.ethz.ch  Wed Aug 31 11:23:39 2005
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Wed, 31 Aug 2005 11:23:39 +0200
Subject: [Rd] Why should package.skeleton() fail R CMD check?
In-Reply-To: <1125478690.23565.34.camel@biol102145.oulu.fi>
References: <1125478690.23565.34.camel@biol102145.oulu.fi>
Message-ID: <17173.30491.377031.303055@stat.math.ethz.ch>

>>>>> "Jari" == Jari Oksanen <jarioksa at sun3.oulu.fi>
>>>>>     on Wed, 31 Aug 2005 11:58:10 +0300 writes:

    Jari> I find it a bit peculiar that a package skeleton created with a utils
    Jari> function package.skeleton() fails subsequent R CMD check. I do
    Jari> understand that the function is intended to produce only a skeleton that
    Jari> should be edited by the package author. I think that it would be
    Jari> justified to say that the skeleton *should* fail the test. However, I
    Jari> have two arguments against intentional failure:

    Jari> * When you produce a skeleton, a natural thing is to see if it works and
    Jari> run R CMD check. It is is baffling (but educating) if this fails.

yes, and the ``but educating'' part has at least kept me from
fixing the problem in the past.
However, I nowadays rather agree with you.

    Jari> * The second argument is more major: If you produce a package with
    Jari> several functions, you want to edit one Rd file in time to see what
    Jari> errors you made. You don't want to correct errors in other Rd files not
    Jari> yet edited by you to see your own errors. This kind of incremental
    Jari> editing is much more pleasant, as following strict R code is painful
    Jari> even with your own mistakes.

    Jari> The failure comes only from Rd files, and it seems that the violating
    Jari> code is produced by prompt.default function hidden in the utils
    Jari> namespace. I attach a uniform diff file which shows the minimal set of
    Jari> changes I had to do make utils:::prompt.default to produce Rd files
    Jari> passing R CMD check. There are still two warnings: one on missing source
    Jari> files and another on missing keywords, but these are not fatal. This
    Jari> still produces bad looking latex. 

both is *desired*; a package author *should* get some urge to
edit the files,  but I now agree that she should only get
warnings, not errors.

    Jari> These are the changes I made 

    Jari> * I replaced "__description__" with "description", since "__" will give
    Jari> latex errors. 

    Jari> * I enclosed ""Make other sections" within Note, so that it won't give
    Jari> error on stray top level text. It will now appear as numbered latex
    Jari> \section{} in dvi file, but that can the package author correct.

    Jari> * I replaced reference to a non-existent function ~~fun~~ with a
    Jari> reference to function help. 

sounds all reasonable


    Jari> I'm sorry for the formatting of the diff file: my emacs/ESS is cleverer
    Jari> than I and changes indentation and line breaks against my will.

hmm; did you *edit* the *source*
or did you just edit a ``dump'' of the function definition?

Since you didn't use  text/plain  as content type, your
attachment didn't make it to the list anyway, and you have a
second chance:

Please use a "diff -u" against

   https://svn.R-project.org/R/trunk/src/library/utils/R/prompt.R

or maybe even a "diff -ubBw ..." one.

Thank you for your proposition and willingness to contribute!

Martin Maechler, ETH Zurich


From maechler at stat.math.ethz.ch  Wed Aug 31 11:33:00 2005
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Wed, 31 Aug 2005 11:33:00 +0200
Subject: [Rd] Why should package.skeleton() fail R CMD check?
In-Reply-To: <17173.30491.377031.303055@stat.math.ethz.ch>
References: <1125478690.23565.34.camel@biol102145.oulu.fi>
	<17173.30491.377031.303055@stat.math.ethz.ch>
Message-ID: <17173.31052.9633.782649@stat.math.ethz.ch>

One thing I forgot to add:

Did you try to include

    - data frames
    - other data

    - S3 generics and methods
    - S4 generics and methods

in the objects you gave to package.skeleton() ?

If we want to change the prompt*() functions such that 
package.skeleton() produces a package that only gives warnings
{for the case of no ./src/ dependence; no NAMESPACE ; no other
 package dependencies; ...}

I think we'd also need patches for the above objects' prompt*()
results.

Martin


From ripley at stats.ox.ac.uk  Wed Aug 31 11:33:23 2005
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 31 Aug 2005 10:33:23 +0100 (BST)
Subject: [Rd] robustness of install.packages/update.packages
In-Reply-To: <Pine.LNX.4.61.0508291027350.30101@gannet.stats>
References: <20050827141028.DCE0218B9F@slim.kubism.ku.dk>
	<Pine.LNX.4.61.0508271525290.4656@gannet.stats>
	<17169.40182.935036.246380@bossiaea.maths.uwa.edu.au>
	<Pine.LNX.4.61.0508281813240.15601@gannet.stats>
	<Pine.LNX.4.61.0508291027350.30101@gannet.stats>
Message-ID: <Pine.LNX.4.61.0508311028280.28031@gannet.stats>

On Mon, 29 Aug 2005, Prof Brian Ripley wrote:

> On Sun, 28 Aug 2005, Prof Brian Ripley wrote:
>
>>> After redirecting R 2.1.1 on my laptop to use
>>>        http://cran.au.r-project.org/
>>> for the CRAN repository, the install.packages() command ran without
>>> problems.  I issued the command `library(MASS)' and tried out the
>>> example from fitdistr on that machine (same strange result for second
>>> command and warning messages were issued).  So I said
>>> update.packages()  and that command failed when it wanted to update
>>> the MASS package.  So I detach()'ed MASS and re-ran update.packages()
>>> and again it failed.  So I exited R 2.1.1 and restarted it again
>>> (probably I should have unloaded the namespace of MASS??) and then the
>>> update.packages command worked.
>> 
>> Yes, and that *is* in the rw-FAQ.
>> 
>>> However, update.packages() wanted to update quite a few packages
>>> besides MASS (the other packages in the VR bundle, nlme, lattice &c).
>>> Once it failed on MASS, it terminated with an error and did not update
>>> any of the other packages.  Would it be possible to robustify
>>> update.packages behaviour such that it would continue in such
>>> situations with updating the remaining packages?
>> 
>> Not a good idea. Better to follow the FAQ.  At that point the dependencies
>> have been worked out and will not be re-computed if a package installation
>> fails.
>
> I checked, and I am unable to reproduce this.  I get

The difference here was that it is install.packages("VR") which 
update.packages() uses, not install.packages("MASS"), and of course "VR" 
is not a package.

I've altered the code to check if any package in a bundle is in use.  We 
can only do that if installing from a repository (not a local zip file), 
but at least we can cover than base.

I've also changed the code to use warning() and not stop() if moving fails 
(although that is likely to be quite a serious problem).

>
>> library(MASS)
>> install.packages(c("MASS", "tree"))
> trying URL 
> 'http://cran.at.r-project.org/bin/windows/contrib/2.2/tree_1.0-19.zip'
> Content type 'application/zip' length 144676 bytes
> opened URL
> downloaded 141Kb
>
> package 'tree' successfully unpacked and MD5 sums checked
>
> The downloaded packages are in
>        C:\Documents and Settings\ripley\Local 
> Settings\Temp\Rtmp13777\downloaded_packages
> updating HTML package descriptions
> Warning message:
> package MASS is in use and will not be installed
>
> which seems perfectly reasonable.
>
>
>
> -- 
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From jarioksa at sun3.oulu.fi  Wed Aug 31 11:42:14 2005
From: jarioksa at sun3.oulu.fi (Jari Oksanen)
Date: Wed, 31 Aug 2005 12:42:14 +0300
Subject: [Rd] Why should package.skeleton() fail R CMD check?
In-Reply-To: <17173.30491.377031.303055@stat.math.ethz.ch>
References: <1125478690.23565.34.camel@biol102145.oulu.fi>
	<17173.30491.377031.303055@stat.math.ethz.ch>
Message-ID: <1125481334.23565.51.camel@biol102145.oulu.fi>

On Wed, 2005-08-31 at 11:23 +0200, Martin Maechler wrote:

> Since you didn't use  text/plain  as content type, your
> attachment didn't make it to the list anyway, 

Yeah, I noticed. 

> and you have a
> second chance:
> 
> Please use a "diff -u" against
> 
>    https://svn.R-project.org/R/trunk/src/library/utils/R/prompt.R
> 
> or maybe even a "diff -ubBw ..." one.
> 

Here comes a uniform diff against svn source of prompt.R. I hope I made
all the same changes as previously. At least package.skeletons with this
pass R CMD check with the same two warnings as previously (after you
beat the namespace -- oh how I hate namespaces):

--- prompt.R    2005-08-31 12:30:28.000000000 +0300
+++ prompt.R.new        2005-08-31 12:32:13.000000000 +0300
@@ -96,5 +96,5 @@
              details = c("\\details{",
              paste("  ~~ If necessary, more details than the",
-                   "__description__  above ~~"),
+                   "description above ~~"),
              "}"),
              value = c("\\value{",
@@ -108,11 +108,11 @@
              "literature/web site here ~ }"),
              author = "\\author{ ~~who you are~~ }",
-             note = c("\\note{ ~~further notes~~ }",
+             note = c("\\note{ ~~further notes~~ ",
              "",
              paste(" ~Make other sections like Warning with",
                    "\\section{Warning }{....} ~"),
-             ""),
+             "}"),
              seealso = paste("\\seealso{ ~~objects to See Also as",
-             "\\code{\\link{~~fun~~}}, ~~~ }"),
+             "\\code{\\link{help}}, ~~~ }"),
              examples = c("\\examples{",
              "##---- Should be DIRECTLY executable !! ----",

Cheers,

Jari Oksanen
-- 
Jari Oksanen -- Dept Biology, Univ Oulu, 90014 Oulu, Finland
Ph. +358 8 5531526, cell +358 40 5136529, fax +358 8 5531061
email jari.oksanen at oulu.fi, homepage http://cc.oulu.fi/~jarioksa/


From ripley at stats.ox.ac.uk  Wed Aug 31 12:40:42 2005
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 31 Aug 2005 11:40:42 +0100 (BST)
Subject: [Rd] So-called 'bug' reports PR#8102 and PR#8103
Message-ID: <Pine.LNX.4.61.0508311105430.28816@gannet.stats>

Neither of these have reached me on R-devel (and only PR#8103 is on the 
archive), and they seem to be the same error although neither mentions the 
other.  That's 'odd', to quote one of them.

"EDT" is not a valid POSIX timezone (but, say, EST5EDT is).  R's docs are 
quite clear that what happens with invalid inputs is system-specific. 
(Windows seems often to run home to PST8PDT.)  You can have timezones 
without DST, but not one permanently in DST.

In short, these were user errors compounded by unhelpful error-recovery by 
the OS the users were using.

As to why tm + 3600 and tm + c(0, 1) * 3600 differ: one time is in one 
timezone, but two can be in different timezones so they must be handled 
differently.  This is handled slightly differently in the R-devel version, 
which both the posting guide and the FAQ do ask you to try out (as well as 
consulting the NEWS file which has a relevant entry).

Next time, please show some consideration for those who have to clear up 
after you, and do as we ask in the posting guide and FAQ.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From mailerndr at trademe.co.nz  Wed Aug 31 14:51:23 2005
From: mailerndr at trademe.co.nz (mailerndr@trademe.co.nz)
Date: Wed, 31 Aug 2005 14:51:23 +0200 (CEST)
Subject: [Rd] Old times (PR#8111)
Message-ID: <20050831125123.5F2F819959@slim.kubism.ku.dk>

*****************************************
***** THIS IS AN AUTOMATED RESPONSE *****
*****   FROM MAILER at TRADEME.CO.NZ   *****
*****************************************
You have been sent this email because you responded to a Trade Me=20
automated email.
=20
We send out a number of emails automatically including:
* To the top bidder and seller at the conclusion of an auction
* To bidders when they are outbid
* To the seller when a question is placed on their auction
=20

TO CONTACT THE SELLER OR TOP BIDDER
***********************************
If you are wanting to contact the seller or the top bidder in an=20
auction, their email address is contained within the email we send=20
you at the conclusion of the auction. Full details of all of your=20
auctions can be found under the My Trade Me tab on Trade Me.
=20
My Trade Me: http://www.trademe.co.nz/structure/my_trademe.asp
=20

TO ANSWER A QUESTION ON YOUR AUCTION
************************************
To answer questions posted on your auction, visit Trade Me, login=20
and go to the auction the question was asked on. The link to do this=20
was contained in the email we sent when the question was asked.=20
Your answer will be immediately posted on the auction and forwarded=20
to the trader who asked the question.
=20

TO CONTACT TRADE ME
*******************
If you were wanting to contact Trade Me Support, please visit the=20
site at:
http://www.trademe.co.nz/structure/helpdocs/crm_choose_subject.asp

	[[alternative HTML version deleted]]


From ripley at stats.ox.ac.uk  Wed Aug 31 16:30:01 2005
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 31 Aug 2005 15:30:01 +0100 (BST)
Subject: [Rd] So-called 'bug' reports PR#8102 and PR#8103
In-Reply-To: <Pine.LNX.4.61.0508311105430.28816@gannet.stats>
Message-ID: <Pine.GSO.4.31.0508311332440.22042@toucan.stats>

Windows XP, R-devel (2005-08-31 r35465)

> tm <- ISOdate(2005, 08, 29, hour = 12, tz = "EST5EDT")
> tm
[1] "2005-08-29 12:00:00 EDT"
> tm + 0
[1] "2005-08-29 12:00:00 EDT"
> tm + 3600
[1] "2005-08-29 13:00:00 EDT"
> tm + c(0,1) * 3600
[1] "2005-08-29 12:00:00 EDT" "2005-08-29 13:00:00 EDT"

(R 2.1.1 gives on my machine

> tm + c(0,1) * 3600
[1] "2005-08-29 17:00:00 BST" "2005-08-29 18:00:00 BST"

which is also valid.)

> tstamp <- strptime("2005-07-31 23:59:59", format="%Y-%m-%d %H:%M:%S")
> attr(tstamp,"tzone") <- "EST5EDT"
> tstamp
[1] "2005-07-31 23:59:59 EST5EDT"
> tstamp-3600
[1] "2005-07-31 22:59:59 EDT"

so once the user error is corrected this works as expected even on 
Windows.  (Even with the user error it works correctly in FC3 Linux, 
which seems smart enough to know that EST5EDT was meant..)

On Windows, the routine used (_tzset) does not indicate user error, so 
there is no way for R to know that an invalid value was given. Linux 
(quoting POSIX) says `No errors are defined.' So users do need to read 
their system documentation.  For reference, see TZ in

http://www.opengroup.org/onlinepubs/009695399/basedefs/xbd_chap08.html#tag_08


On Wed, 31 Aug 2005, Prof Brian Ripley wrote:

> Neither of these have reached me on R-devel (and only PR#8103 is on the 
> archive), and they seem to be the same error although neither mentions the 
> other.  That's 'odd', to quote one of them.
> 
> "EDT" is not a valid POSIX timezone (but, say, EST5EDT is).  R's docs are 
> quite clear that what happens with invalid inputs is system-specific. 
> (Windows seems often to run home to PST8PDT.)  You can have timezones 
> without DST, but not one permanently in DST.
> 
> In short, these were user errors compounded by unhelpful error-recovery by 
> the OS the users were using.
> 
> As to why tm + 3600 and tm + c(0, 1) * 3600 differ: one time is in one 
> timezone, but two can be in different timezones so they must be handled 
> differently.  This is handled slightly differently in the R-devel version, 
> which both the posting guide and the FAQ do ask you to try out (as well as 
> consulting the NEWS file which has a relevant entry).
> 
> Next time, please show some consideration for those who have to clear up 
> after you, and do as we ask in the posting guide and FAQ.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272860 (secr)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From reid_huntsinger at merck.com  Wed Aug 31 18:15:16 2005
From: reid_huntsinger at merck.com (Huntsinger, Reid)
Date: Wed, 31 Aug 2005 12:15:16 -0400
Subject: [Rd] .Call and Segmentation Fault
Message-ID: <355C35514FEAC9458F75947F5270974D076CA3@usctmx1103.merck.com>

I suggest you look at the code for .Call() in dotcode.c. I suspect the
problem is in dealing with R objects, however. You don't show how you get
from SEXPs to pointers to pass to Fortran, or what the Fortran routine
requires. 

I don't understand how you can call the "same" function from C. How do you
deal with SEXPs? 

Reid Huntsinger

Reid Huntsinger
-----Original Message-----
From: r-devel-bounces at r-project.org [mailto:r-devel-bounces at r-project.org]
On Behalf Of Ricardo Luiz Andrade Abrantes
Sent: Tuesday, August 30, 2005 4:33 PM
To: r-devel at r-project.org
Subject: Re: [Rd] .Call and Segmentation Fault


Hello to everybody!
After reading all the C code, checking for problems, and find nothing, I 
decided something a little bit different...
If my ".so" library works in a wrog way in R it should do the same in C. So 
I created a C program that loads my library file and the executes the same 
function R is executing.
The program worked perfectly! In fact I changed two things in my library: 
The function I call now return an int, not a SEXP, and the return value is 0

not R_NilValue.
Valgrind's output is ok too... 
If .Call has no problems, and if my function works perfect when called from 
a C program, where the problem lies? Why my program becomes "crazy" when I 
run it from R?
I would apreciate very much your help! I don't where else I could find help 
on this.
I can provide any piece of code that may help, Its just ask!


Thanks,


Ricardo



On 8/28/05, Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
> 
> On Sat, 27 Aug 2005, Ricardo Luiz Andrade Abrantes wrote:
> 
> > Hi!
> > Yes, I am returning a SEXP from the functions called from R, and the
> > problem occurs before (thousands of iterations before) the return
> > point.
> > In fact I runned valgrind into R and when I call ".Call(...) " I got
> > many errors like:
> > ==4324== Use of uninitialised value of size 8
> > ==4324== at 0x1CB0766D: tnls_ (gencan.f:4101)
> > ==4324== by 0x1CB01962: gencan_ (gencan.f:1876)
> > ==4324== by 0x1CAFECA5: easygencan_ (gencan.f:440)
> > ==4324== by 0x1CB0B47D: algencan_ (algencan.f:517)
> > ==4324== by 0x1CB09E74: easyalgencan_ (algencan.f:76)
> > ==4324== by 0x1CAFE5B3: main (algencanma.c:808)
> > what does not happens when I compile the algencanma as a regular
> > program (not a library) and run it from shell. Valgrind does not find
> > anything wrong when I run the program directly, except 2 missing
> > free() calls.
> > Do you have any ideas where the problem lies (R .Call function or C 
> program)?
> 
> It cannot be .Call: your .Call passed no parameters so there was nothing
> to be uninitialized. I did ask you why you were doing that.
> 
> .Call is very heavily tested in lots of R applications, so the prior
> probability of innocence must be very high.
> 
> --
> Brian D. Ripley, ripley at stats.ox.ac.uk
> Professor of Applied Statistics, http://www.stats.ox.ac.uk/~ripley/
> University of Oxford, Tel: +44 1865 272861 (self)
> 1 South Parks Road, +44 1865 272866 (PA)
> Oxford OX1 3TG, UK Fax: +44 1865 272595
>

	[[alternative HTML version deleted]]

______________________________________________
R-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-devel


From murdoch at stats.uwo.ca  Wed Aug 31 20:48:20 2005
From: murdoch at stats.uwo.ca (murdoch@stats.uwo.ca)
Date: Wed, 31 Aug 2005 20:48:20 +0200 (CEST)
Subject: [Rd] Bug in copying of S4 objects (PR#8112)
Message-ID: <20050831184820.9612B1992B@slim.kubism.ku.dk>

If I have an S4 object, and I make a copy, changes to the original 
aren't reflected in the copy:

 > setClass("foo", representation(slot="numeric"))
 > x <- new("foo", slot=1)
 > y <- x
 > x at slot <- 2
 > y
An object of class "foo"
Slot "slot":
[1] 1

This is as it should be.  However, if I call the slot assignment 
function in a funny way, y *does* receive the changes:

 > x <- new("foo", slot=1)
 > y <- x
 > assign("x", "@<-"(x, "slot", 2))
 > y
An object of class "foo"
Slot "slot":
[1] 2

This happens in the current R-devel in Windows, and R-patched too.

 > version
          _
platform i386-pc-mingw32
arch     i386
os       mingw32
system   i386, mingw32
status   Under development (unstable)
major    2
minor    2.0
year     2005
month    08
day      31
svn rev  35467
language R

Duncan Murdoch


From gregory.r.warnes at pfizer.com  Wed Aug 31 21:44:46 2005
From: gregory.r.warnes at pfizer.com (Warnes, Gregory R)
Date: Wed, 31 Aug 2005 15:44:46 -0400
Subject: [Rd] Email failure for forwards from r-bugs@cran.r-project.org to
	r-de	vel
Message-ID: <915D2D65A9986440A277AC5C98AA466F01863237@groamrexm02.amer.pfizer.com>


I just sent a bug report to r-bugs at cran.r-project.org.   Unfortunately, the
message forwarding to r-devel failed.  It appears that this occurred due an
interaction between the forwarding setup and SPF:   
	1) The forwarded message had From  as gregory.r.warnes at pfizer.com, 
	2) Pfizer has SPF records in DNS 
	3) the forwarding host's IP address is (correctly) not listed in
these SPF records.
I suspect that this will increasingly occur as other organizations deploy
SPF. Hence some re-configuration of the r-bugs forwarding needs to be
performed.  Perhaps something like appropriately setting the "Sender" field
might help.

-Greg

Gregory R. Warnes, Ph.D.
Associate Director, Non-Clinical Statistics
Pfizer Global Research and Development



LEGAL NOTICE\ Unless expressly stated otherwise, this messag...{{dropped}}


From gregory.r.warnes at pfizer.com  Wed Aug 31 21:46:19 2005
From: gregory.r.warnes at pfizer.com (Warnes, Gregory R)
Date: Wed, 31 Aug 2005 15:46:19 -0400
Subject: [Rd] R CMD check example problem (PR#8113)
Message-ID: <915D2D65A9986440A277AC5C98AA466F01863238@groamrexm02.amer.pfizer.com>


[Automatic forwarding from R-bugs failed.  This message has been manually
forwarded.]

Hi all!

I'm trying to add Thomas Lumley's defmacro() function  Lumley T.
"Programmer's Niche: Macros in {R}", R News, 2001, Vol 1,
  No. 3, pp 11--13, \url{http://CRAN.R-project.org/doc/Rnews/} to the gtools
package (provided that Thomas gives his OK). And I've encountered an error
in how R CMD check is extracting the example code I have in the .Rd file.

The example section contains the lines 

  # An equivalent function is somewhat messier, since it must either
explicitly
  # construct the y axis label, duplicating some of the work of the plot
  # function:
  plotit <- function( df, var, col="red", title="" )
  {
      dname <- deparse(substitute(df))
      vname <- deparse(substitute(var))
      plot( df[[vname]] ~ df$Grp, type="b", col=col, title=title,
            ylab=paste( dname, "$", vname, sep='' ) )
  }
  # or we explicitly construct the call and then call eval.  The code for
  # the latter approach is # omiited since this is quite messy and
  # requires a lot of work.
  
which is getting extracted for testing into gtools.Rcheck/gtools-Ex.R as

  # An equivalent function is somewhat messier, since it must either
explicitly
  # construct the y axis label, duplicating some of the work of the plot
  # function:
  plotit <- function( df, var, col="red", title=""
)normal-bracket43bracket-normal
      dname <- deparse(substitute(df))
      vname <- deparse(substitute(var))
      plot( df[[vname]] ~ df$Grp, type="b", col=col, title=title,
            ylab=paste( dname, "$", vname, sep='' ) )
  normal-bracket43bracket-normal
  # or we explicitly construct the call and then call eval.  The code for
  # the latter approach is # omiited since this is quite messy and
  # requires a lot of work.

Note that the opening and closing curly brakkets are converted to the string
"normal-bracket43bracket-normal".   [I assume that this is happeing
somewhere to check for brace-matches, and isn't being properly undone.]  As
a consequence, R CMD check is failing:

  > # An equivalent function is somewhat messier, since it must either
explicitly
  > # construct the y axis label, duplicating some of the work of the plot
  > # function:
  > plotit <- function( df, var, col="red", title=""
)normal-bracket43bracket-normal
  >     dname <- deparse(substitute(df))
  >     vname <- deparse(substitute(var))
  >     plot( df[[vname]] ~ df$Grp, type="b", col=col, title=title,
  +           ylab=paste( dname, "$", vname, sep='' ) )
  Error in df[[vname]] : object is not subsettable
  Execution halted

I've checked, and this occurs under R-2.1.0, R-2.1.1, and today's
R-2.2.0-devel on my

  platform i686-pc-linux-gnu
  arch     i686             
  os       linux-gnu        
  system   i686, linux-gnu  

I'm attaching the probelmatic .Rd file to this email.  

  <<defmacro.Rd>> 

(For the record, I've simply enclosed the problematic section in \dontrun as
a workaround.)

-Greg



Gregory R. Warnes, Ph.D.
Associate Director, Non-Clinical Statistics
Pfizer Global Research and Development



LEGAL NOTICE
Unless expressly stated otherwise, this message is confidential and may be privileged. It is intended for the addressee(s) only. Access to this E-mail by anyone else is unauthorized. If you are not an addressee, any disclosure or copying of the contents of this E-mail or any action taken (or not taken) in reliance on it is unauthorized and may be unlawful. If you are not an addressee, please inform the sender immediately.

From robert.king at newcastle.edu.au  Wed Aug 31 22:05:38 2005
From: robert.king at newcastle.edu.au (Robert King)
Date: Wed, 31 Aug 2005 13:05:38 -0700
Subject: [Rd] R --gui doesn't work, but R --help says it does
Message-ID: <200508311305.39095.robert.king@newcastle.edu.au>

This was reported on r-devel in April for 2.1.0, but isn't fixed in 2.1.1
see
http://tolstoy.newcastle.edu.au/~rking/R/devel/05/04/0586.html

# R --help
[ output omitted, until] 

  -g, --gui=TYPE        Use TYPE as GUI; possible values are 'X11'
                        (default), 'none', 'Tk' and 'gnome'

solzhenitsyn:~# R --gui=none
ERROR: unknown GUI none
solzhenitsyn:~# R --gui=none
ERROR: unknown GUI none
solzhenitsyn:~# R --gui='none'
ERROR: unknown GUI none
solzhenitsyn:~# R --gui=X11
ERROR: unknown GUI X11
solzhenitsyn:~# R --gui=Tk
ERROR: unknown GUI Tk
solzhenitsyn:~# R --gui='Tk'
ERROR: unknown GUI Tk
solzhenitsyn:~# R --gui='X11'
ERROR: unknown GUI X11
solzhenitsyn:~# R --gui="none"
ERROR: unknown GUI none



-- 
Robert King, Statistics, School of Mathematical & Physical Sciences,
University of Newcastle, Australia
Room V133  ph +61 2 4921 5548
Robert.King at newcastle.edu.au   http://maths.newcastle.edu.au/~rking/

 "It might be in the basement,
 I'll go upstairs and check .." Escher


From robert.king at newcastle.edu.au  Wed Aug 31 22:16:50 2005
From: robert.king at newcastle.edu.au (robert.king@newcastle.edu.au)
Date: Wed, 31 Aug 2005 22:16:50 +0200 (CEST)
Subject: [Rd] update.packages forces Tcl/Tk interface despite ask=TRUE if
	the DISPLAY environment variable is set (PR#8115)
Message-ID: <20050831201650.8AFE21992B@slim.kubism.ku.dk>

Full_Name: Robert King
Version: 2.1.1
OS: Linux (debian stable, with backport R)
Submission from: (NULL) (142.58.147.28)


update.packages documentation (and code, from what I can make out) says:

     ask: logical indicating whether to ask user before packages are
          actually downloaded and installed, or the character string
          '"graphics"', which brings up a widget to allow the user to
          (de-)select from the list of packages which could be updated.
           The latter only works on systems with a GUI version of
          'select.list', and is otherwise equivalent to 'ask = TRUE'.

But, if I try ask=TRUE, it tries loading the Tcl/Tk interface (which I found out
because I'm doing this remotely and it crashed.

> update.packages(ask=TRUE)
--- Please select a CRAN mirror for use in this session ---
Loading Tcl/Tk interface ... Error in fun(...) : Tcl already loaded
Error: .onLoad failed in 'loadNamespace' for 'tcltk'

On the other hand, if I log out and ssh back with X forwarding turned off, it
does the right thing,


From p.dalgaard at biostat.ku.dk  Wed Aug 31 22:47:05 2005
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: 31 Aug 2005 22:47:05 +0200
Subject: [Rd] update.packages forces Tcl/Tk interface despite ask=TRUE
	if the DISPLAY environment variable is set (PR#8115)
In-Reply-To: <20050831201650.8AFE21992B@slim.kubism.ku.dk>
References: <20050831201650.8AFE21992B@slim.kubism.ku.dk>
Message-ID: <x2slwp4ywm.fsf@turmalin.kubism.ku.dk>

robert.king at newcastle.edu.au writes:

> Full_Name: Robert King
> Version: 2.1.1
> OS: Linux (debian stable, with backport R)
> Submission from: (NULL) (142.58.147.28)
> 
> 
> update.packages documentation (and code, from what I can make out) says:
> 
>      ask: logical indicating whether to ask user before packages are
>           actually downloaded and installed, or the character string
>           '"graphics"', which brings up a widget to allow the user to
>           (de-)select from the list of packages which could be updated.
>            The latter only works on systems with a GUI version of
>           'select.list', and is otherwise equivalent to 'ask = TRUE'.
> 
> But, if I try ask=TRUE, it tries loading the Tcl/Tk interface (which I found out
> because I'm doing this remotely and it crashed.
> 
> > update.packages(ask=TRUE)
> --- Please select a CRAN mirror for use in this session ---
> Loading Tcl/Tk interface ... Error in fun(...) : Tcl already loaded
> Error: .onLoad failed in 'loadNamespace' for 'tcltk'
> 
> On the other hand, if I log out and ssh back with X forwarding turned off, it
> does the right thing,

This is unrelated to ask=TRUE. It is during the choice of CRAN site
that R is trying to fire up a Tk listbox (it might be debated whether
this is a good idea, but it _is_ intentional). If you set the
repository yourself, this won't happen.

The error looks a bit odd though. The logic is supposed to be that
either you have Tcl/Tk capabilities and you get the popup, or you
don't and get a text menu.

So something appears not right with your Tcl/Tk configuration.

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From lai at lindaspaces.com  Wed Aug 31 23:28:57 2005
From: lai at lindaspaces.com (Jennifer Lai)
Date: Wed, 31 Aug 2005 17:28:57 -0400
Subject: [Rd] Build Portland Group Compiler
Message-ID: <43162119.1010503@lindaspaces.com>

Hi,
    I built R with Portland Group compiler, but I noticed one thing that 
when I ran configure for the first time on AMD machine, I got the 
following error:


checking whether the C compiler works... configure: error: cannot run C 
compiled programs.
If you meant to cross compile, use `--host'.
See `config.log' for more details.



so I tried to set host=x86_64-unknown-linux-gnu, which seems to work, 
except what puzzles me is that there is warning messages indicating C 
longs are 4 bytes.

*******************************************
% configure --host=x86_64-unknown-linux-gnu
.
.
.
R is now configured for x86_64-unknown-linux-gnu

  Source directory:          .
  Installation directory:    /usr/local/R.pgcc

  C compiler:                /usr/pgi/linux86-64/6.0/bin/pgcc  -g -O2 
-mieee-fp
  C++ compiler:              /usr/pgi/linux86-64/6.0/bin/pgCC  -g
  Fortran compiler:          /usr/pgi/linux86-64/6.0/bin/pgf77  -O2

  Interfaces supported:      X11
  External libraries:        readline
  Additional capabilities:   PNG, JPEG, MBCS, NLS
  Options enabled:           R profiling

  Recommended packages:      yes

configure: WARNING: assuming C ints are 4 byte on x86_64-unknown-linux-gnu
configure: WARNING: assuming C longs are 4 byte on x86_64-unknown-linux-gnu
configure: WARNING: you cannot build info or html versions of the R manuals


Am I defining a wrong host?


Thanks,
Jennifer


From p.dalgaard at biostat.ku.dk  Wed Aug 31 23:52:54 2005
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: 31 Aug 2005 23:52:54 +0200
Subject: [Rd] Build Portland Group Compiler
In-Reply-To: <43162119.1010503@lindaspaces.com>
References: <43162119.1010503@lindaspaces.com>
Message-ID: <x2oe7d4vux.fsf@turmalin.kubism.ku.dk>

Jennifer Lai <lai at lindaspaces.com> writes:

> Hi,
>     I built R with Portland Group compiler, but I noticed one thing that 
> when I ran configure for the first time on AMD machine, I got the 
> following error:
> 
> 
> checking whether the C compiler works... configure: error: cannot run C 
> compiled programs.
> If you meant to cross compile, use `--host'.
> See `config.log' for more details.
> 
> 
> 
> so I tried to set host=x86_64-unknown-linux-gnu, which seems to work, 
> except what puzzles me is that there is warning messages indicating C 
> longs are 4 bytes.
> 
> *******************************************
> % configure --host=x86_64-unknown-linux-gnu
> .
> .
> .
> R is now configured for x86_64-unknown-linux-gnu
> 
>   Source directory:          .
>   Installation directory:    /usr/local/R.pgcc
> 
>   C compiler:                /usr/pgi/linux86-64/6.0/bin/pgcc  -g -O2 
> -mieee-fp
>   C++ compiler:              /usr/pgi/linux86-64/6.0/bin/pgCC  -g
>   Fortran compiler:          /usr/pgi/linux86-64/6.0/bin/pgf77  -O2
> 
>   Interfaces supported:      X11
>   External libraries:        readline
>   Additional capabilities:   PNG, JPEG, MBCS, NLS
>   Options enabled:           R profiling
> 
>   Recommended packages:      yes
> 
> configure: WARNING: assuming C ints are 4 byte on x86_64-unknown-linux-gnu
> configure: WARNING: assuming C longs are 4 byte on x86_64-unknown-linux-gnu
> configure: WARNING: you cannot build info or html versions of the R manuals
> 
> 
> Am I defining a wrong host?

You're not doing yourself a favour, anyway. 4-byte longs are
definitely not a good idea on Linux. What is worse, you are building a
cross-target, which means that configure is not even going to try
running any compiled programs, not that they work any better than
before.

The thing to do is to look inside config.log and see what causes
configure to conclude that you cannot run C compiled programs.

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From lai at lindaspaces.com  Wed Aug 31 23:59:47 2005
From: lai at lindaspaces.com (Jennifer Lai)
Date: Wed, 31 Aug 2005 17:59:47 -0400
Subject: [Rd] Build Portland Group Compiler
In-Reply-To: <x2oe7d4vux.fsf@turmalin.kubism.ku.dk>
References: <43162119.1010503@lindaspaces.com>
	<x2oe7d4vux.fsf@turmalin.kubism.ku.dk>
Message-ID: <43162853.6070902@lindaspaces.com>

I can't duplicate the error message. After running "configure 
--host=x86_64-unknow-linux-gnu" for the first time, I was able to run 
configure without providing --host argument. Even start with a fresh 
copy of R-devel didn't help me to get the original error. Is the host 
info been cached somewhere in R?

Regards,
Jennifer

Peter Dalgaard wrote:

>Jennifer Lai <lai at lindaspaces.com> writes:
>
>  
>
>>Hi,
>>    I built R with Portland Group compiler, but I noticed one thing that 
>>when I ran configure for the first time on AMD machine, I got the 
>>following error:
>>
>>
>>checking whether the C compiler works... configure: error: cannot run C 
>>compiled programs.
>>If you meant to cross compile, use `--host'.
>>See `config.log' for more details.
>>
>>
>>
>>so I tried to set host=x86_64-unknown-linux-gnu, which seems to work, 
>>except what puzzles me is that there is warning messages indicating C 
>>longs are 4 bytes.
>>
>>*******************************************
>>% configure --host=x86_64-unknown-linux-gnu
>>.
>>.
>>.
>>R is now configured for x86_64-unknown-linux-gnu
>>
>>  Source directory:          .
>>  Installation directory:    /usr/local/R.pgcc
>>
>>  C compiler:                /usr/pgi/linux86-64/6.0/bin/pgcc  -g -O2 
>>-mieee-fp
>>  C++ compiler:              /usr/pgi/linux86-64/6.0/bin/pgCC  -g
>>  Fortran compiler:          /usr/pgi/linux86-64/6.0/bin/pgf77  -O2
>>
>>  Interfaces supported:      X11
>>  External libraries:        readline
>>  Additional capabilities:   PNG, JPEG, MBCS, NLS
>>  Options enabled:           R profiling
>>
>>  Recommended packages:      yes
>>
>>configure: WARNING: assuming C ints are 4 byte on x86_64-unknown-linux-gnu
>>configure: WARNING: assuming C longs are 4 byte on x86_64-unknown-linux-gnu
>>configure: WARNING: you cannot build info or html versions of the R manuals
>>
>>
>>Am I defining a wrong host?
>>    
>>
>
>You're not doing yourself a favour, anyway. 4-byte longs are
>definitely not a good idea on Linux. What is worse, you are building a
>cross-target, which means that configure is not even going to try
>running any compiled programs, not that they work any better than
>before.
>
>The thing to do is to look inside config.log and see what causes
>configure to conclude that you cannot run C compiled programs.
>
>  
>


