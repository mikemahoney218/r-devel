From baptiste.auguie at googlemail.com  Fri Oct  1 09:17:37 2010
From: baptiste.auguie at googlemail.com (baptiste auguie)
Date: Fri, 1 Oct 2010 09:17:37 +0200
Subject: [Rd] strange interaction between rasterImage and Grid graphics
Message-ID: <AANLkTimX=5B478CCrEjCX0Y0Kw-FVuu=6ED5kYQ0iykY@mail.gmail.com>

Dear all,

This may be specific to Mac, I haven't had a chance to test another
platform. Consider this,

plot(1,1,t="n")
rasterImage(matrix(1),1,1,1,1)
library(grid)
grid.rect(gp=gpar(fill="grey"))

The grid.rect covers the full device window as expected. However, when
I resize the window ever so slightly (interactive device) the rectGrob
is suddenly clipped to the previous plot window. I cannot understand
this behavior, and it doesn't happen if one removes the rasterImage()
call, so I suspect something iffy is going on with the display list or
something.

The only device I've tried is quartz(), x11() crashed with rasterImage,

 *** caught segfault ***
address 0x28, cause 'memory not mapped'

Traceback:
 1: rasterImage(matrix(1), 1, 1, 1, 1)

sessionInfo()
R version 2.11.1 (2010-05-31)
x86_64-apple-darwin9.8.0

locale:
[1] en_GB.UTF-8/en_GB.UTF-8/C/C/en_GB.UTF-8/en_GB.UTF-8

attached base packages:
[1] grid      stats     graphics  grDevices utils     datasets  methods   base


From jorismeys at gmail.com  Fri Oct  1 18:00:46 2010
From: jorismeys at gmail.com (Joris Meys)
Date: Fri, 1 Oct 2010 18:00:46 +0200
Subject: [Rd] scoping goes wrong when some functions are used within others.
Message-ID: <AANLkTimfvgszrjLgHg7Fz=5K3hzJ=9y3=HZoo8McNY1o@mail.gmail.com>

Dear,

I'm following the r tag on stackoverflow.com, and couldn't but notice
there are quite some questions popping up that deal with scoping in
relation to custom functions. I grinded my teeth on it already, and I
have absolutely no clue what goes wrong. The general pattern is as
follows :

ff <- function(x){
    y <- some_value
    some_function(y)
}

> ff(x)
Error in eval(expr, envir, enclos) : object 'y' not found

I tried to report this as a bug earlier, but got the message I used
the wrong channel. I also don't know how to formalize it into a bug
report on the report site. That's why I bring it to your attention
this way, and want to ask you whether this is by design and we're all
doing something wrong, whether these are problems within certain
packages/situations, ...

I solve these problems now by adding an environment to my global
environment, and delete it after the function finished running. But
this can't be the correct way.

The problem is described here :
http://stackoverflow.com/questions/3840769/scoping-and-functions-in-r-2-11-1-whats-going-wrong

Links to different reports, all having that same pattern but with
different functions :

http://stackoverflow.com/questions/3742415/r-statistical-scoping-error-using-transformby-part-of-the-doby-package
http://stackoverflow.com/questions/3768417/how-to-use-acast-reshape2-within-a-function-in-r
http://stackoverflow.com/questions/3661500/why-cant-i-pass-a-dataset-to-a-function
http://stackoverflow.com/questions/3574858/values-not-being-copied-to-the-next-local-environment
http://stackoverflow.com/questions/2646402/using-functions-and-environments


-- 
Joris Meys
Statistical consultant

Ghent University
Faculty of Bioscience Engineering
Department of Applied mathematics, biometrics and process control

tel : +32 9 264 59 87
Joris.Meys at Ugent.be
-------------------------------
Disclaimer : http://helpdesk.ugent.be/e-maildisclaimer.php


From eriki at ccbr.umn.edu  Fri Oct  1 19:21:55 2010
From: eriki at ccbr.umn.edu (Erik Iverson)
Date: Fri, 01 Oct 2010 12:21:55 -0500
Subject: [Rd] scoping goes wrong when some functions are used within
	others.
In-Reply-To: <AANLkTimfvgszrjLgHg7Fz=5K3hzJ=9y3=HZoo8McNY1o@mail.gmail.com>
References: <AANLkTimfvgszrjLgHg7Fz=5K3hzJ=9y3=HZoo8McNY1o@mail.gmail.com>
Message-ID: <4CA618B3.4040504@ccbr.umn.edu>



Joris Meys wrote:
> Dear,
> 
> I'm following the r tag on stackoverflow.com, and couldn't but notice
> there are quite some questions popping up that deal with scoping in
> relation to custom functions. I grinded my teeth on it already, and I
> have absolutely no clue what goes wrong. The general pattern is as
> follows :
> 
> ff <- function(x){
>     y <- some_value
>     some_function(y)
> }
> 
>> ff(x)
> Error in eval(expr, envir, enclos) : object 'y' not found

I get:

Error in ff(x) : object 'some_value' not found

which is entirely consistent, since it has not been bound to a value.



> 
> I tried to report this as a bug earlier, but got the message I used
> the wrong channel. I also don't know how to formalize it into a bug
> report on the report site. That's why I bring it to your attention
> this way, and want to ask you whether this is by design and we're all
> doing something wrong, whether these are problems within certain
> packages/situations, ...
> 
> I solve these problems now by adding an environment to my global
> environment, and delete it after the function finished running. But
> this can't be the correct way.
> 
> The problem is described here :
> http://stackoverflow.com/questions/3840769/scoping-and-functions-in-r-2-11-1-whats-going-wrong
> 
> Links to different reports, all having that same pattern but with
> different functions :
> 
> http://stackoverflow.com/questions/3742415/r-statistical-scoping-error-using-transformby-part-of-the-doby-package
> http://stackoverflow.com/questions/3768417/how-to-use-acast-reshape2-within-a-function-in-r
> http://stackoverflow.com/questions/3661500/why-cant-i-pass-a-dataset-to-a-function
> http://stackoverflow.com/questions/3574858/values-not-being-copied-to-the-next-local-environment
> http://stackoverflow.com/questions/2646402/using-functions-and-environments
> 
>


From murdoch.duncan at gmail.com  Fri Oct  1 19:49:55 2010
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Fri, 01 Oct 2010 13:49:55 -0400
Subject: [Rd] scoping goes wrong when some functions are used within
	others.
In-Reply-To: <AANLkTimfvgszrjLgHg7Fz=5K3hzJ=9y3=HZoo8McNY1o@mail.gmail.com>
References: <AANLkTimfvgszrjLgHg7Fz=5K3hzJ=9y3=HZoo8McNY1o@mail.gmail.com>
Message-ID: <4CA61F43.3090900@gmail.com>

  On 01/10/2010 12:00 PM, Joris Meys wrote:
> Dear,
>
> I'm following the r tag on stackoverflow.com, and couldn't but notice
> there are quite some questions popping up that deal with scoping in
> relation to custom functions. I grinded my teeth on it already, and I
> have absolutely no clue what goes wrong. The general pattern is as
> follows :

I think each of the reports is really a separate bug, mostly in the 
implementation of "some_function". As far as I could see, only the last one

|y<- new.env()
with(y, x<- 1)
f<- function(env,z) {
     with(env, x+z)
}
f(y,z=1)
|

involves base R functions, and there I think the problem is with your 
reading of the documentation, not with the function. The documentation 
may suggest that should work by saying "The environment has the caller's 
environment as its parent", but there's no way it possibly could. 
Environments only have one parent. If you read carefully you'll see that 
this is documented correctly in "(Note: if ?data? is already an 
environment then this is used with its existing parent.)"

Duncan Murdoch

> ff<- function(x){
>      y<- some_value
>      some_function(y)
> }
>
> >  ff(x)
> Error in eval(expr, envir, enclos) : object 'y' not found
>
> I tried to report this as a bug earlier, but got the message I used
> the wrong channel. I also don't know how to formalize it into a bug
> report on the report site. That's why I bring it to your attention
> this way, and want to ask you whether this is by design and we're all
> doing something wrong, whether these are problems within certain
> packages/situations, ...
>
> I solve these problems now by adding an environment to my global
> environment, and delete it after the function finished running. But
> this can't be the correct way.
>
> The problem is described here :
> http://stackoverflow.com/questions/3840769/scoping-and-functions-in-r-2-11-1-whats-going-wrong
>
> Links to different reports, all having that same pattern but with
> different functions :
>
> http://stackoverflow.com/questions/3742415/r-statistical-scoping-error-using-transformby-part-of-the-doby-package
> http://stackoverflow.com/questions/3768417/how-to-use-acast-reshape2-within-a-function-in-r
> http://stackoverflow.com/questions/3661500/why-cant-i-pass-a-dataset-to-a-function
> http://stackoverflow.com/questions/3574858/values-not-being-copied-to-the-next-local-environment
> http://stackoverflow.com/questions/2646402/using-functions-and-environments
>
>


From wdunlap at tibco.com  Fri Oct  1 19:56:44 2010
From: wdunlap at tibco.com (William Dunlap)
Date: Fri, 1 Oct 2010 10:56:44 -0700
Subject: [Rd] scoping goes wrong when some functions are used within
	others.
In-Reply-To: <AANLkTimfvgszrjLgHg7Fz=5K3hzJ=9y3=HZoo8McNY1o@mail.gmail.com>
References: <AANLkTimfvgszrjLgHg7Fz=5K3hzJ=9y3=HZoo8McNY1o@mail.gmail.com>
Message-ID: <77EB52C6DD32BA4D87471DCD70C8D70003828EFE@NA-PA-VBE03.na.tibco.com>

One of the complaints in your stackoverlow references
concerned doBy::transformBy and the error message came
from eval().  Using eval() means you are throwing the
usual scoping rules out the window and making up some
new ones.  Using a non-core package means you are at
the mercy of its writer.

In transformBy I believe there is an error in the use
of parent.frame() that can be fixed by changing the
current

  > head(doBy::transformBy)
                                                                  
  1 function (formula, data, ...)                                 
  2 {                                                             
  3     transform2 <- function(data, ...) {                       
  4         e <- eval(substitute(list(...)), data, parent.frame())
  5         tags <- names(e)                                      
  6         inx <- match(tags, names(data))

to
                       
  > head(transformBy)
                                                              
  1 function (formula, data, ...)                               
  2 {                                                           
  3     PARENT.FRAME <- parent.frame()                          
  4     transform2 <- function(data, ...) {                     
  5         e <- eval(substitute(list(...)), data, PARENT.FRAME)
  6         tags <- names(e)             

transform2's parent.frame will always be transformBy
and we really want to look for variables in the expressions
in the .. list in transformBy's parent frame, not in
transformBy itself.

Using parent.frame() often causes problems because you don't
always know how many frames come between your user's code and
your function's code.  (E.g., using methods may insert extra
frames.)  In this case I think it was always looking in the
wrong place.  The fix doesn't guarentee that it will always
look in the right place, but it should be right more often.

Bill Dunlap
Spotfire, TIBCO Software
wdunlap tibco.com  

> -----Original Message-----
> From: r-devel-bounces at r-project.org 
> [mailto:r-devel-bounces at r-project.org] On Behalf Of Joris Meys
> Sent: Friday, October 01, 2010 9:01 AM
> To: r-devel at r-project.org
> Subject: [Rd] scoping goes wrong when some functions are used 
> within others.
> 
> Dear,
> 
> I'm following the r tag on stackoverflow.com, and couldn't but notice
> there are quite some questions popping up that deal with scoping in
> relation to custom functions. I grinded my teeth on it already, and I
> have absolutely no clue what goes wrong. The general pattern is as
> follows :
> 
> ff <- function(x){
>     y <- some_value
>     some_function(y)
> }
> 
> > ff(x)
> Error in eval(expr, envir, enclos) : object 'y' not found
> 
> I tried to report this as a bug earlier, but got the message I used
> the wrong channel. I also don't know how to formalize it into a bug
> report on the report site. That's why I bring it to your attention
> this way, and want to ask you whether this is by design and we're all
> doing something wrong, whether these are problems within certain
> packages/situations, ...
> 
> I solve these problems now by adding an environment to my global
> environment, and delete it after the function finished running. But
> this can't be the correct way.
> 
> The problem is described here :
> http://stackoverflow.com/questions/3840769/scoping-and-functio
ns-in-r-2-11-1-whats-going-wrong
> 
> Links to different reports, all having that same pattern but with
> different functions :
> 
> http://stackoverflow.com/questions/3742415/r-statistical-scopi
ng-error-using-transformby-part-of-the-doby-package
> http://stackoverflow.com/questions/3768417/how-to-use-acast-re
shape2-within-a-function-in-r
> http://stackoverflow.com/questions/3661500/why-cant-i-pass-a-d
ataset-to-a-function
> http://stackoverflow.com/questions/3574858/values-not-being-co
pied-to-the-next-local-environment
> http://stackoverflow.com/questions/2646402/using-functions-and
-environments
> 
> 
> -- 
> Joris Meys
> Statistical consultant
> 
> Ghent University
> Faculty of Bioscience Engineering
> Department of Applied mathematics, biometrics and process control
> 
> tel : +32 9 264 59 87
> Joris.Meys at Ugent.be
> -------------------------------
> Disclaimer : http://helpdesk.ugent.be/e-maildisclaimer.php
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 


From jorismeys at gmail.com  Fri Oct  1 23:48:53 2010
From: jorismeys at gmail.com (Joris Meys)
Date: Fri, 1 Oct 2010 23:48:53 +0200
Subject: [Rd] scoping goes wrong when some functions are used within
	others.
In-Reply-To: <4CA618B3.4040504@ccbr.umn.edu>
References: <AANLkTimfvgszrjLgHg7Fz=5K3hzJ=9y3=HZoo8McNY1o@mail.gmail.com>
	<4CA618B3.4040504@ccbr.umn.edu>
Message-ID: <AANLkTi=WKkcte6JPEyiM7ywZ8gAqo0tiLCAN=WPrDH65@mail.gmail.com>

Thank you for all your answers, this really helped me out. I've been
digging into scoping rules in R and although I'm going to need quite
some more studying to fully grasp it, I do see where the errors come
from.

Thanks again.

@Erik : I know that some_value was not declared. I just gave some
pseudo-code to illustrate the general pattern of the errors, to
indicate why I thought they were linked. Sorry if I wasn't clear
enough on that one.

Cheers
Joris

On Fri, Oct 1, 2010 at 7:21 PM, Erik Iverson <eriki at ccbr.umn.edu> wrote:
>
>
> Joris Meys wrote:
>>
>> Dear,
>>
>> I'm following the r tag on stackoverflow.com, and couldn't but notice
>> there are quite some questions popping up that deal with scoping in
>> relation to custom functions. I grinded my teeth on it already, and I
>> have absolutely no clue what goes wrong. The general pattern is as
>> follows :
>>
>> ff <- function(x){
>> ? ?y <- some_value
>> ? ?some_function(y)
>> }
>>
>>> ff(x)
>>
>> Error in eval(expr, envir, enclos) : object 'y' not found
>
> I get:
>
> Error in ff(x) : object 'some_value' not found
>
> which is entirely consistent, since it has not been bound to a value.
>
>
>
>>
>> I tried to report this as a bug earlier, but got the message I used
>> the wrong channel. I also don't know how to formalize it into a bug
>> report on the report site. That's why I bring it to your attention
>> this way, and want to ask you whether this is by design and we're all
>> doing something wrong, whether these are problems within certain
>> packages/situations, ...
>>
>> I solve these problems now by adding an environment to my global
>> environment, and delete it after the function finished running. But
>> this can't be the correct way.
>>
>> The problem is described here :
>>
>> http://stackoverflow.com/questions/3840769/scoping-and-functions-in-r-2-11-1-whats-going-wrong
>>
>> Links to different reports, all having that same pattern but with
>> different functions :
>>
>>
>> http://stackoverflow.com/questions/3742415/r-statistical-scoping-error-using-transformby-part-of-the-doby-package
>>
>> http://stackoverflow.com/questions/3768417/how-to-use-acast-reshape2-within-a-function-in-r
>>
>> http://stackoverflow.com/questions/3661500/why-cant-i-pass-a-dataset-to-a-function
>>
>> http://stackoverflow.com/questions/3574858/values-not-being-copied-to-the-next-local-environment
>>
>> http://stackoverflow.com/questions/2646402/using-functions-and-environments
>>
>>
>



-- 
Joris Meys
Statistical consultant

Ghent University
Faculty of Bioscience Engineering
Department of Applied mathematics, biometrics and process control

tel : +32 9 264 59 87
Joris.Meys at Ugent.be
-------------------------------
Disclaimer : http://helpdesk.ugent.be/e-maildisclaimer.php


From jeffrey.horner at gmail.com  Fri Oct  1 23:49:02 2010
From: jeffrey.horner at gmail.com (Jeffrey Horner)
Date: Fri, 1 Oct 2010 16:49:02 -0500
Subject: [Rd] Will PrintWarnings remain non static?
Message-ID: <AANLkTin9ufq=90ifN8jsSuJUey0_cBehOAuKOWiAvi6b@mail.gmail.com>

Hi,

The C function PrintWarnings is currently not in the C API, but it is
declared non static in the svn trunk as of revision 53110 . As this is
the only function that creates the last.warning object used by the R
function warnings(), I think it would be useful for programs that
embed R to be able to call it.

So, will it remain non static, that is callable although it's not
declared in the public C API?

Thanks,

Jeff


From hpages at fhcrc.org  Sat Oct  2 03:31:43 2010
From: hpages at fhcrc.org (=?ISO-8859-1?Q?Herv=E9_Pag=E8s?=)
Date: Fri, 01 Oct 2010 18:31:43 -0700
Subject: [Rd] cleanup_pkg() in tools:::.build_packages() is broken
Message-ID: <4CA68B7F.5070208@fhcrc.org>

Hi,

The cleanup_pkg() function defined the big tools:::.build_packages() 
function in tools/R/build.R is currently broken. When Makefiles are
used cleanup_pkg() doesn't clean anything because of the way system2()
is called.

For example, the call to Ssystem() on line 304 (Ssystem is a silent
version of system2) is basically trying to do this:

   > system2(paste(Sys.getenv("MAKE", "make"), makefiles, "clean"))
   sh: make -f '/home/hpages/R-2.12/etc//Makeconf' -f Makefile clean: 
not found

But it seems that with this new system2(), the arguments to the system
command need to be passed separately thru the 'args' argument.

Cheers,
H.

-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M2-B876
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fhcrc.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From deepayan.sarkar at gmail.com  Sat Oct  2 09:33:59 2010
From: deepayan.sarkar at gmail.com (Deepayan Sarkar)
Date: Sat, 2 Oct 2010 00:33:59 -0700
Subject: [Rd] strange interaction between rasterImage and Grid graphics
In-Reply-To: <AANLkTimX=5B478CCrEjCX0Y0Kw-FVuu=6ED5kYQ0iykY@mail.gmail.com>
References: <AANLkTimX=5B478CCrEjCX0Y0Kw-FVuu=6ED5kYQ0iykY@mail.gmail.com>
Message-ID: <AANLkTi=4Q0Az8m+fES9erxMHxwB-sNh=AEn0MPCJdVCQ@mail.gmail.com>

On Fri, Oct 1, 2010 at 12:17 AM, baptiste auguie
<baptiste.auguie at googlemail.com> wrote:
> Dear all,
>
> This may be specific to Mac, I haven't had a chance to test another
> platform. Consider this,
>
> plot(1,1,t="n")
> rasterImage(matrix(1),1,1,1,1)
> library(grid)
> grid.rect(gp=gpar(fill="grey"))
>
> The grid.rect covers the full device window as expected. However, when
> I resize the window ever so slightly (interactive device) the rectGrob
> is suddenly clipped to the previous plot window. I cannot understand
> this behavior, and it doesn't happen if one removes the rasterImage()
> call, so I suspect something iffy is going on with the display list or
> something.

I can reproduce the behaviour on GNU/Linux x11(type="cairo"), but this
is inappropriate mixing of base and grid graphics, so officially I
don't think you are allowed to expect anything at all.

-Deepayan


>
> The only device I've tried is quartz(), x11() crashed with rasterImage,
>
> ?*** caught segfault ***
> address 0x28, cause 'memory not mapped'
>
> Traceback:
> ?1: rasterImage(matrix(1), 1, 1, 1, 1)
>
> sessionInfo()
> R version 2.11.1 (2010-05-31)
> x86_64-apple-darwin9.8.0
>
> locale:
> [1] en_GB.UTF-8/en_GB.UTF-8/C/C/en_GB.UTF-8/en_GB.UTF-8
>
> attached base packages:
> [1] grid ? ? ?stats ? ? graphics ?grDevices utils ? ? datasets ?methods ? base
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From hadley at rice.edu  Sat Oct  2 13:57:32 2010
From: hadley at rice.edu (Hadley Wickham)
Date: Sat, 2 Oct 2010 06:57:32 -0500
Subject: [Rd] Eval and the enclos argument
Message-ID: <AANLkTinQ8fXByLEkJqCFOr9i4Q5KNSnf2cfAD0vBJy-6@mail.gmail.com>

Hi all,

I'm trying to understand the default value of the enclos argument of eval:

  enclos = if(is.list(envir) || is.pairlist(envir)) parent.frame()
else baseenv()

Why isn't it just

  enclos = parent.frame()

given that enclos is only meaningful (given my reading of the
documentation) when envir is not an environment already.

Hadley

-- 
Assistant Professor / Dobelman Family Junior Chair
Department of Statistics / Rice University
http://had.co.nz/


From murdoch.duncan at gmail.com  Sat Oct  2 15:18:18 2010
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Sat, 02 Oct 2010 09:18:18 -0400
Subject: [Rd] Eval and the enclos argument
In-Reply-To: <AANLkTinQ8fXByLEkJqCFOr9i4Q5KNSnf2cfAD0vBJy-6@mail.gmail.com>
References: <AANLkTinQ8fXByLEkJqCFOr9i4Q5KNSnf2cfAD0vBJy-6@mail.gmail.com>
Message-ID: <4CA7311A.1000304@gmail.com>

On 02/10/2010 7:57 AM, Hadley Wickham wrote:
> Hi all,
> 
> I'm trying to understand the default value of the enclos argument of eval:
> 
>   enclos = if(is.list(envir) || is.pairlist(envir)) parent.frame()
> else baseenv()
> 
> Why isn't it just
> 
>   enclos = parent.frame()
> 
> given that enclos is only meaningful (given my reading of the
> documentation) when envir is not an environment already.
> 
> Hadley
> 


I think that handles the case of envir=NULL.

Duncan Murdoch


From hadley at rice.edu  Sat Oct  2 16:40:33 2010
From: hadley at rice.edu (Hadley Wickham)
Date: Sat, 2 Oct 2010 09:40:33 -0500
Subject: [Rd] Eval and the enclos argument
In-Reply-To: <4CA7311A.1000304@gmail.com>
References: <AANLkTinQ8fXByLEkJqCFOr9i4Q5KNSnf2cfAD0vBJy-6@mail.gmail.com>
	<4CA7311A.1000304@gmail.com>
Message-ID: <AANLkTinUc0-XXNa5+MxTa_GrXquywKv9sPkMGZa8LTHx@mail.gmail.com>

On Sat, Oct 2, 2010 at 8:18 AM, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
> On 02/10/2010 7:57 AM, Hadley Wickham wrote:
>>
>> Hi all,
>>
>> I'm trying to understand the default value of the enclos argument of eval:
>>
>> ?enclos = if(is.list(envir) || is.pairlist(envir)) parent.frame()
>> else baseenv()
>>
>> Why isn't it just
>>
>> ?enclos = parent.frame()
>>
>> given that enclos is only meaningful (given my reading of the
>> documentation) when envir is not an environment already.
>>
>> Hadley
>>
>
>
> I think that handles the case of envir=NULL.

So that makes eval(expr, NULL) equivalent to eval(expr, baseenv()), right?

Hadley


-- 
Assistant Professor / Dobelman Family Junior Chair
Department of Statistics / Rice University
http://had.co.nz/


From murdoch.duncan at gmail.com  Sat Oct  2 17:01:27 2010
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Sat, 02 Oct 2010 11:01:27 -0400
Subject: [Rd] Eval and the enclos argument
In-Reply-To: <AANLkTinUc0-XXNa5+MxTa_GrXquywKv9sPkMGZa8LTHx@mail.gmail.com>
References: <AANLkTinQ8fXByLEkJqCFOr9i4Q5KNSnf2cfAD0vBJy-6@mail.gmail.com>
	<4CA7311A.1000304@gmail.com>
	<AANLkTinUc0-XXNa5+MxTa_GrXquywKv9sPkMGZa8LTHx@mail.gmail.com>
Message-ID: <4CA74947.9030509@gmail.com>

On 02/10/2010 10:40 AM, Hadley Wickham wrote:
> On Sat, Oct 2, 2010 at 8:18 AM, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
>> On 02/10/2010 7:57 AM, Hadley Wickham wrote:
>>> Hi all,
>>>
>>> I'm trying to understand the default value of the enclos argument of eval:
>>>
>>>  enclos = if(is.list(envir) || is.pairlist(envir)) parent.frame()
>>> else baseenv()
>>>
>>> Why isn't it just
>>>
>>>  enclos = parent.frame()
>>>
>>> given that enclos is only meaningful (given my reading of the
>>> documentation) when envir is not an environment already.
>>>
>>> Hadley
>>>
>>
>> I think that handles the case of envir=NULL.
> 
> So that makes eval(expr, NULL) equivalent to eval(expr, baseenv()), right?

I think so.

Duncan


From baptiste.auguie at googlemail.com  Sat Oct  2 21:01:29 2010
From: baptiste.auguie at googlemail.com (baptiste auguie)
Date: Sat, 2 Oct 2010 21:01:29 +0200
Subject: [Rd] strange interaction between rasterImage and Grid graphics
In-Reply-To: <AANLkTi=4Q0Az8m+fES9erxMHxwB-sNh=AEn0MPCJdVCQ@mail.gmail.com>
References: <AANLkTimX=5B478CCrEjCX0Y0Kw-FVuu=6ED5kYQ0iykY@mail.gmail.com>
	<AANLkTi=4Q0Az8m+fES9erxMHxwB-sNh=AEn0MPCJdVCQ@mail.gmail.com>
Message-ID: <AANLkTik2XqV+_Xox3d5VVD5_iV8J=iqcPPfZHPadvhPr@mail.gmail.com>

Hi,

Thanks for the follow-up.

On 2 October 2010 09:33, Deepayan Sarkar <deepayan.sarkar at gmail.com> wrote:
> On Fri, Oct 1, 2010 at 12:17 AM, baptiste auguie
> <baptiste.auguie at googlemail.com> wrote:
>> Dear all,
>>
>> This may be specific to Mac, I haven't had a chance to test another
>> platform. Consider this,
>>
>> plot(1,1,t="n")
>> rasterImage(matrix(1),1,1,1,1)
>> library(grid)
>> grid.rect(gp=gpar(fill="grey"))
>>
>> The grid.rect covers the full device window as expected. However, when
>> I resize the window ever so slightly (interactive device) the rectGrob
>> is suddenly clipped to the previous plot window. I cannot understand
>> this behavior, and it doesn't happen if one removes the rasterImage()
>> call, so I suspect something iffy is going on with the display list or
>> something.
>
> I can reproduce the behaviour on GNU/Linux x11(type="cairo"), but this
> is inappropriate mixing of base and grid graphics, so officially I
> don't think you are allowed to expect anything at all.
>

I think the gridBase package does this kind of mixing of base and grid
graphics; and also this behavior might be a side-effect of a more
serious bug.

Best regards,

baptiste


> -Deepayan
>
>
>>
>> The only device I've tried is quartz(), x11() crashed with rasterImage,
>>
>> ?*** caught segfault ***
>> address 0x28, cause 'memory not mapped'
>>
>> Traceback:
>> ?1: rasterImage(matrix(1), 1, 1, 1, 1)
>>
>> sessionInfo()
>> R version 2.11.1 (2010-05-31)
>> x86_64-apple-darwin9.8.0
>>
>> locale:
>> [1] en_GB.UTF-8/en_GB.UTF-8/C/C/en_GB.UTF-8/en_GB.UTF-8
>>
>> attached base packages:
>> [1] grid ? ? ?stats ? ? graphics ?grDevices utils ? ? datasets ?methods ? base
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>


From p.murrell at auckland.ac.nz  Sun Oct  3 01:35:52 2010
From: p.murrell at auckland.ac.nz (Paul Murrell)
Date: Sun, 03 Oct 2010 12:35:52 +1300
Subject: [Rd] strange interaction between rasterImage and Grid graphics
In-Reply-To: <AANLkTimX=5B478CCrEjCX0Y0Kw-FVuu=6ED5kYQ0iykY@mail.gmail.com>
References: <AANLkTimX=5B478CCrEjCX0Y0Kw-FVuu=6ED5kYQ0iykY@mail.gmail.com>
Message-ID: <4CA7C1D8.7050202@auckland.ac.nz>

Hi

baptiste auguie wrote:
> Dear all,
> 
> This may be specific to Mac, I haven't had a chance to test another
> platform. Consider this,
> 
> plot(1,1,t="n")
> rasterImage(matrix(1),1,1,1,1)
> library(grid)
> grid.rect(gp=gpar(fill="grey"))
 >
> The grid.rect covers the full device window as expected. However, when
> I resize the window ever so slightly (interactive device) the rectGrob
> is suddenly clipped to the previous plot window. I cannot understand
> this behavior, and it doesn't happen if one removes the rasterImage()
> call, so I suspect something iffy is going on with the display list or
> something.

It happens like this:

# 1. Clip to the device and draw axes and labels
plot(1,1,t="n")
# 2. Clip to the plot region and draw raster
rasterImage(matrix(1),1,1,1,1)
library(grid)
# Oooh!  This is the first time any grid drawing
# has occurred on the device, so initialize grid
# stuff, including the top-level viewport,
# *which clips to the device*
# 3. Draw a rectangle
grid.rect(gp=gpar(fill="grey"))

# Resize the window ...
# which triggers a redraw ...
# Oooh! There is grid output on this device so
# initialize grid stuff, including the top-level
# viewport *which clips to the device* ...
# 1. Clip to the device and draw axes and labels
# 2. Clip to the plot region and draw raster
# 3. Draw a rectangle

A workaround is to explicitly do a clip before the grid.rect(), i.e., ...

plot(1,1,t="n")
rasterImage(matrix(1),1,1,1,1)
library(grid)
grid.clip()
grid.rect(gp=gpar(fill="grey"))

... and I will add this example to the things I will look at when I am 
trying to clean up the grid code a bit.

> The only device I've tried is quartz(), x11() crashed with rasterImage,

That is more serious.  I have heard of a couple of others like this and 
I think the common thread may be 64-bit MacOS X.  I need to get access 
to such a beast to take a look.

Paul

>  *** caught segfault ***
> address 0x28, cause 'memory not mapped'
> 
> Traceback:
>  1: rasterImage(matrix(1), 1, 1, 1, 1)
> 
> sessionInfo()
> R version 2.11.1 (2010-05-31)
> x86_64-apple-darwin9.8.0
> 
> locale:
> [1] en_GB.UTF-8/en_GB.UTF-8/C/C/en_GB.UTF-8/en_GB.UTF-8
> 
> attached base packages:
> [1] grid      stats     graphics  grDevices utils     datasets  methods   base
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Dr Paul Murrell
Department of Statistics
The University of Auckland
Private Bag 92019
Auckland
New Zealand
64 9 3737599 x85392
paul at stat.auckland.ac.nz
http://www.stat.auckland.ac.nz/~paul/


From deepayan.sarkar at gmail.com  Sun Oct  3 07:36:07 2010
From: deepayan.sarkar at gmail.com (Deepayan Sarkar)
Date: Sat, 2 Oct 2010 22:36:07 -0700
Subject: [Rd] strange interaction between rasterImage and Grid graphics
In-Reply-To: <4CA7C1D8.7050202@auckland.ac.nz>
References: <AANLkTimX=5B478CCrEjCX0Y0Kw-FVuu=6ED5kYQ0iykY@mail.gmail.com>
	<4CA7C1D8.7050202@auckland.ac.nz>
Message-ID: <AANLkTikY-erfsxifHcKyPcnrCnwaiTn5K3s9KTvcfht4@mail.gmail.com>

On Sat, Oct 2, 2010 at 4:35 PM, Paul Murrell <p.murrell at auckland.ac.nz> wrote:
> Hi
>
> baptiste auguie wrote:
>>
>> Dear all,
>>
>> This may be specific to Mac, I haven't had a chance to test another
>> platform. Consider this,
>>
>> plot(1,1,t="n")
>> rasterImage(matrix(1),1,1,1,1)
>> library(grid)
>> grid.rect(gp=gpar(fill="grey"))
>
>>
>>
>> The grid.rect covers the full device window as expected. However, when
>> I resize the window ever so slightly (interactive device) the rectGrob
>> is suddenly clipped to the previous plot window. I cannot understand
>> this behavior, and it doesn't happen if one removes the rasterImage()
>> call, so I suspect something iffy is going on with the display list or
>> something.
>
> It happens like this:
>
> # 1. Clip to the device and draw axes and labels
> plot(1,1,t="n")
> # 2. Clip to the plot region and draw raster
> rasterImage(matrix(1),1,1,1,1)
> library(grid)
> # Oooh! ?This is the first time any grid drawing
> # has occurred on the device, so initialize grid
> # stuff, including the top-level viewport,
> # *which clips to the device*
> # 3. Draw a rectangle
> grid.rect(gp=gpar(fill="grey"))
>
> # Resize the window ...
> # which triggers a redraw ...
> # Oooh! There is grid output on this device so
> # initialize grid stuff, including the top-level
> # viewport *which clips to the device* ...
> # 1. Clip to the device and draw axes and labels
> # 2. Clip to the plot region and draw raster
> # 3. Draw a rectangle
>
> A workaround is to explicitly do a clip before the grid.rect(), i.e., ...
>
> plot(1,1,t="n")
> rasterImage(matrix(1),1,1,1,1)
> library(grid)
> grid.clip()
> grid.rect(gp=gpar(fill="grey"))
>
> ... and I will add this example to the things I will look at when I am
> trying to clean up the grid code a bit.
>
>> The only device I've tried is quartz(), x11() crashed with rasterImage,
>
> That is more serious. ?I have heard of a couple of others like this and I
> think the common thread may be 64-bit MacOS X. ?I need to get access to such
> a beast to take a look.

Or maybe just 64 bit. I have (running Debian unstable)

> sessionInfo()
R version 2.12.0 Under development (unstable) (2010-09-02 r52864)
Platform: x86_64-unknown-linux-gnu (64-bit)

and I get reproducible crashes (same 'memory not mapped' segfault) with

x11(type="Xlib")
example(rasterImage) #or

library(lattice)
example(panel.levelplot.raster)

[I noticed this a while back, but neglected to report.]

-Deepayan

>
> Paul
>
>> ?*** caught segfault ***
>> address 0x28, cause 'memory not mapped'
>>
>> Traceback:
>> ?1: rasterImage(matrix(1), 1, 1, 1, 1)
>>
>> sessionInfo()
>> R version 2.11.1 (2010-05-31)
>> x86_64-apple-darwin9.8.0
>>
>> locale:
>> [1] en_GB.UTF-8/en_GB.UTF-8/C/C/en_GB.UTF-8/en_GB.UTF-8
>>
>> attached base packages:
>> [1] grid ? ? ?stats ? ? graphics ?grDevices utils ? ? datasets ?methods
>> base


From brian at braverock.com  Sun Oct  3 11:25:25 2010
From: brian at braverock.com (Brian G. Peterson)
Date: Sun, 03 Oct 2010 04:25:25 -0500
Subject: [Rd] strange interaction between rasterImage and Grid graphics
In-Reply-To: <AANLkTikY-erfsxifHcKyPcnrCnwaiTn5K3s9KTvcfht4@mail.gmail.com>
References: <AANLkTimX=5B478CCrEjCX0Y0Kw-FVuu=6ED5kYQ0iykY@mail.gmail.com>
	<4CA7C1D8.7050202@auckland.ac.nz>
	<AANLkTikY-erfsxifHcKyPcnrCnwaiTn5K3s9KTvcfht4@mail.gmail.com>
Message-ID: <58dc2267d949738dc9a098ff54e26482@braverock.com>

On Sat, 2 Oct 2010 22:36:07 -0700, Deepayan Sarkar
<deepayan.sarkar at gmail.com> wrote:
>> On Sat, Oct 2, 2010 at 4:35 PM, Paul Murrell <p.murrell at auckland.ac.nz>
>> wrote:
>>> The only device I've tried is quartz(), x11() crashed with
rasterImage,
>>
>> That is more serious. ?I have heard of a couple of others like this and
>> I think the common thread may be 64-bit MacOS X. ?
>> I need to get access to such a beast to take a look.
> 
> Or maybe just 64 bit. I have (running Debian unstable)
> 
>> sessionInfo()
> R version 2.12.0 Under development (unstable) (2010-09-02 r52864)
> Platform: x86_64-unknown-linux-gnu (64-bit)
> 
> and I get reproducible crashes (same 'memory not mapped' segfault) with
> 
> x11(type="Xlib")
> example(rasterImage) #or
> 
> library(lattice)
> example(panel.levelplot.raster)
> 
> [I noticed this a while back, but neglected to report.]
> 
> -Deepayan
> 
>>
>> Paul
>>
>>> ?*** caught segfault ***
>>> address 0x28, cause 'memory not mapped'
>>>
>>> Traceback:
>>> ?1: rasterImage(matrix(1), 1, 1, 1, 1)
>>>
>>> sessionInfo()
>>> R version 2.11.1 (2010-05-31)
>>> x86_64-apple-darwin9.8.0

I can confirm the problem exists in 2.11.1 as well on 64 bit Ubuntu:

R version 2.11.1 (2010-05-31)

> x11(type="Xlib")
> example(rasterImage) 

rstrIm> require(grDevices)

rstrIm> ## set up the plot region:
rstrIm> op <- par(bg = "thistle")

rstrIm> plot(c(100, 250), c(300, 450), type = "n", xlab="", ylab="")
Hit <Return> to see next plot: 

rstrIm> image <- as.raster(matrix(0:1, ncol=5, nrow=3))

rstrIm> rasterImage(image, 100, 300, 150, 350, interpolate=FALSE)

 *** caught segfault ***
address 0x28, cause 'memory not mapped'

Traceback:
 1: rasterImage(image, 100, 300, 150, 350, interpolate = FALSE)
 2: eval.with.vis(expr, envir, enclos)
 3: eval.with.vis(ei, envir)
 4: source(tf, local, echo = echo, prompt.echo = paste(prompt.prefix,    
getOption("prompt"), sep = ""), continue.echo = paste(prompt.prefix,    
getOption("continue"), sep = ""), verbose = verbose, max.deparse.length =
Inf,     encoding = encoding, skip.echo = skips, keep.source = TRUE)
 5: example(rasterImage)

The lattice example in Deepyan's email 

library(lattice)
example(panel.levelplot.raster)

works for me in 2.11.1 

Regards,

   - Brian

> sessionInfo()
R version 2.11.1 (2010-05-31) 
x86_64-pc-linux-gnu 

locale:
 [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              
 [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    
 [5] LC_MONETARY=C              LC_MESSAGES=en_US.UTF-8   
 [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 
 [9] LC_ADDRESS=C               LC_TELEPHONE=C            
[11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       

attached base packages:
[1] grid      stats     graphics  grDevices utils     datasets  methods  
[8] base     

other attached packages:
[1] lattice_0.19-11

loaded via a namespace (and not attached):
[1] tools_2.11.1


From rhurlin at gwdg.de  Sun Oct  3 16:24:09 2010
From: rhurlin at gwdg.de (Rainer Hurling)
Date: Sun, 03 Oct 2010 16:24:09 +0200
Subject: [Rd] R-beta_2010-10-02_r53128 fails to compile on FreeBSD
Message-ID: <4CA89209.4030005@gwdg.de>

I tried to compile R-beta_2010-10-02_r53128 on FreeBSD 9.0-CURRENT 
(amd64) with gcc-4.4.5 and it fails:

-----------------------------------------
gcc -std=gnu99 -I../../src/extra/zlib -I../../src/extra/bzip2 
-I../../src/extra/pcre  -I../../src/extra   -I. -I../../src/include 
-I../../src/include -I/usr/local/include -DHAVE_CONFIG_H   -g -O2 -c 
sysutils.c -o sysutils.o
sysutils.c: In function 'R_system':
sysutils.c:289: warning: implicit declaration of function 'WIFEXITED'
sysutils.c:289: warning: implicit declaration of function 'WEXITSTATUS'
gcc -std=gnu99 -I../../src/extra/zlib -I../../src/extra/bzip2 
-I../../src/extra/pcre  -I../../src/extra   -I. -I../../src/include 
-I../../src/include -I/usr/local/include -DHAVE_CONFIG_H   -g -O2 -c 
unique.c -o unique.o
gcc -std=gnu99 -I../../src/extra/zlib -I../../src/extra/bzip2 
-I../../src/extra/pcre  -I../../src/extra   -I. -I../../src/include 
-I../../src/include -I/usr/local/include -DHAVE_CONFIG_H   -g -O2 -c 
util.c -o util.o
gcc -std=gnu99 -I../../src/extra/zlib -I../../src/extra/bzip2 
-I../../src/extra/pcre  -I../../src/extra   -I. -I../../src/include 
-I../../src/include -I/usr/local/include -DHAVE_CONFIG_H   -g -O2 -c 
version.c -o version.o
gcc -std=gnu99 -I../../src/extra/zlib -I../../src/extra/bzip2 
-I../../src/extra/pcre  -I../../src/extra   -I. -I../../src/include 
-I../../src/include -I/usr/local/include -DHAVE_CONFIG_H   -g -O2 -c 
vfonts.c -o vfonts.o
gfortran   -g -O2 -c xxxpr.f -o xxxpr.o
ar cr libR.a CConverters.o CommandLineArgs.o Rdynload.o Renviron.o RNG.o 
agrep.o apply.o arithmetic.o array.o attrib.o base.o bind.o builtin.o 
character.o coerce.o colors.o complex.o connections.o context.o cov.o 
cum.o dcf.o datetime.o debug.o deparse.o deriv.o devices.o dotcode.o 
dounzip.o dstruct.o duplicate.o engine.o envir.o errors.o eval.o 
format.o fourier.o gevents.o gram.o gram-ex.o gramLatex.o gramRd.o 
graphics.o grep.o identical.o inlined.o inspect.o internet.o iosupport.o 
lapack.o list.o localecharset.o logic.o main.o mapply.o match.o memory.o 
model.o names.o objects.o optim.o optimize.o options.o par.o paste.o 
platform.o plot.o plot3d.o plotmath.o print.o printarray.o printvector.o 
printutils.o qsort.o random.o raw.o registration.o relop.o rlocale.o 
saveload.o scan.o seq.o serialize.o size.o sort.o source.o split.o 
sprintf.o startup.o subassign.o subscript.o subset.o summary.o 
sysutils.o unique.o util.o version.o vfonts.o xxxpr.o libs/*o
ranlib libR.a
gcc -std=gnu99 -export-dynamic -L/usr/local/lib -o R.bin Rmain.o libR.a 
-L../../lib -lRblas 
-L/usr/local/lib/gcc44/gcc/x86_64-portbld-freebsd9.0/4.4.5 
-L/usr/local/x86_64-portbld-freebsd9.0/lib -L/usr/local/lib/gcc44 
-lgfortran -lm  /usr/local/lib/libintl.so /usr/local/lib/libiconv.so 
-Wl,-rpath -Wl,/usr/local/lib -lreadline -llzma -lm -liconv -licuuc 
-licui18n
libR.a(sysutils.o)(.text+0x1d5d): In function `R_system':
/usr/local/R-beta/src/main/sysutils.c:289: undefined reference to 
`WIFEXITED'
libR.a(sysutils.o)(.text+0x1d76):/usr/local/R-beta/src/main/sysutils.c:289: 
undefined reference to `WEXITSTATUS'
libR.a(sys-unix.o)(.text+0x475): In function `do_system':
/usr/local/R-beta/src/unix/sys-unix.c:290: undefined reference to 
`WIFEXITED'
libR.a(sys-unix.o)(.text+0x551):/usr/local/R-beta/src/unix/sys-unix.c:290: 
undefined reference to `WEXITSTATUS'
*** Error code 1
Stop in /usr/local/R-beta/src/main.
*** Error code 1
Stop in /usr/local/R-beta/src/main.
*** Error code 1
Stop in /usr/local/R-beta/src.
*** Error code 1
Stop in /usr/local/R-beta.
-----------------------------------------

Is this a known error? I would really appreciate if someone could give 
me a hint.

Please let me know if more information is needed.

Thanks in advance,
Rainer Hurling


From pdalgd at gmail.com  Sun Oct  3 17:08:39 2010
From: pdalgd at gmail.com (Peter Dalgaard)
Date: Sun, 03 Oct 2010 17:08:39 +0200
Subject: [Rd] R-beta_2010-10-02_r53128 fails to compile on FreeBSD
In-Reply-To: <4CA89209.4030005@gwdg.de>
References: <4CA89209.4030005@gwdg.de>
Message-ID: <4CA89C77.7050805@gmail.com>

On 10/03/2010 04:24 PM, Rainer Hurling wrote:
> I tried to compile R-beta_2010-10-02_r53128 on FreeBSD 9.0-CURRENT 
> (amd64) with gcc-4.4.5 and it fails:

Thanks for the report. WIFEXITED/WEXITSTATUS are usually defined in
<sys/wait.h> (usually /usr/include/sys/wait.h). Do you have any
indication that this might be skipped? (configure output, etc.)

I'm not quite sure by which mechanism gcc is expected to include
sys/wait.h, but the offending code is inside

#ifdef HAVE_SYS_WAIT_H

which configure is supposed to set only if it is available and POSIX
compatible.

Any chance you switched platform features (e.g. upgraded gcc) without
reconfiguring?

-pd

> 
> -----------------------------------------
> gcc -std=gnu99 -I../../src/extra/zlib -I../../src/extra/bzip2 
> -I../../src/extra/pcre  -I../../src/extra   -I. -I../../src/include 
> -I../../src/include -I/usr/local/include -DHAVE_CONFIG_H   -g -O2 -c 
> sysutils.c -o sysutils.o
> sysutils.c: In function 'R_system':
> sysutils.c:289: warning: implicit declaration of function 'WIFEXITED'
> sysutils.c:289: warning: implicit declaration of function 'WEXITSTATUS'
> gcc -std=gnu99 -I../../src/extra/zlib -I../../src/extra/bzip2 
> -I../../src/extra/pcre  -I../../src/extra   -I. -I../../src/include 
> -I../../src/include -I/usr/local/include -DHAVE_CONFIG_H   -g -O2 -c 
> unique.c -o unique.o
> gcc -std=gnu99 -I../../src/extra/zlib -I../../src/extra/bzip2 
> -I../../src/extra/pcre  -I../../src/extra   -I. -I../../src/include 
> -I../../src/include -I/usr/local/include -DHAVE_CONFIG_H   -g -O2 -c 
> util.c -o util.o
> gcc -std=gnu99 -I../../src/extra/zlib -I../../src/extra/bzip2 
> -I../../src/extra/pcre  -I../../src/extra   -I. -I../../src/include 
> -I../../src/include -I/usr/local/include -DHAVE_CONFIG_H   -g -O2 -c 
> version.c -o version.o
> gcc -std=gnu99 -I../../src/extra/zlib -I../../src/extra/bzip2 
> -I../../src/extra/pcre  -I../../src/extra   -I. -I../../src/include 
> -I../../src/include -I/usr/local/include -DHAVE_CONFIG_H   -g -O2 -c 
> vfonts.c -o vfonts.o
> gfortran   -g -O2 -c xxxpr.f -o xxxpr.o
> ar cr libR.a CConverters.o CommandLineArgs.o Rdynload.o Renviron.o RNG.o 
> agrep.o apply.o arithmetic.o array.o attrib.o base.o bind.o builtin.o 
> character.o coerce.o colors.o complex.o connections.o context.o cov.o 
> cum.o dcf.o datetime.o debug.o deparse.o deriv.o devices.o dotcode.o 
> dounzip.o dstruct.o duplicate.o engine.o envir.o errors.o eval.o 
> format.o fourier.o gevents.o gram.o gram-ex.o gramLatex.o gramRd.o 
> graphics.o grep.o identical.o inlined.o inspect.o internet.o iosupport.o 
> lapack.o list.o localecharset.o logic.o main.o mapply.o match.o memory.o 
> model.o names.o objects.o optim.o optimize.o options.o par.o paste.o 
> platform.o plot.o plot3d.o plotmath.o print.o printarray.o printvector.o 
> printutils.o qsort.o random.o raw.o registration.o relop.o rlocale.o 
> saveload.o scan.o seq.o serialize.o size.o sort.o source.o split.o 
> sprintf.o startup.o subassign.o subscript.o subset.o summary.o 
> sysutils.o unique.o util.o version.o vfonts.o xxxpr.o libs/*o
> ranlib libR.a
> gcc -std=gnu99 -export-dynamic -L/usr/local/lib -o R.bin Rmain.o libR.a 
> -L../../lib -lRblas 
> -L/usr/local/lib/gcc44/gcc/x86_64-portbld-freebsd9.0/4.4.5 
> -L/usr/local/x86_64-portbld-freebsd9.0/lib -L/usr/local/lib/gcc44 
> -lgfortran -lm  /usr/local/lib/libintl.so /usr/local/lib/libiconv.so 
> -Wl,-rpath -Wl,/usr/local/lib -lreadline -llzma -lm -liconv -licuuc 
> -licui18n
> libR.a(sysutils.o)(.text+0x1d5d): In function `R_system':
> /usr/local/R-beta/src/main/sysutils.c:289: undefined reference to 
> `WIFEXITED'
> libR.a(sysutils.o)(.text+0x1d76):/usr/local/R-beta/src/main/sysutils.c:289: 
> undefined reference to `WEXITSTATUS'
> libR.a(sys-unix.o)(.text+0x475): In function `do_system':
> /usr/local/R-beta/src/unix/sys-unix.c:290: undefined reference to 
> `WIFEXITED'
> libR.a(sys-unix.o)(.text+0x551):/usr/local/R-beta/src/unix/sys-unix.c:290: 
> undefined reference to `WEXITSTATUS'
> *** Error code 1
> Stop in /usr/local/R-beta/src/main.
> *** Error code 1
> Stop in /usr/local/R-beta/src/main.
> *** Error code 1
> Stop in /usr/local/R-beta/src.
> *** Error code 1
> Stop in /usr/local/R-beta.
> -----------------------------------------
> 
> Is this a known error? I would really appreciate if someone could give 
> me a hint.
> 
> Please let me know if more information is needed.
> 
> Thanks in advance,
> Rainer Hurling
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


-- 
Peter Dalgaard
Center for Statistics, Copenhagen Business School
Phone: (+45)38153501
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From ripley at stats.ox.ac.uk  Sun Oct  3 17:10:44 2010
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sun, 3 Oct 2010 16:10:44 +0100 (BST)
Subject: [Rd] R-beta_2010-10-02_r53128 fails to compile on FreeBSD
In-Reply-To: <4CA89209.4030005@gwdg.de>
References: <4CA89209.4030005@gwdg.de>
Message-ID: <alpine.LFD.2.00.1010031607400.17992@gannet.stats.ox.ac.uk>

On Sun, 3 Oct 2010, Rainer Hurling wrote:

> I tried to compile R-beta_2010-10-02_r53128 on FreeBSD 9.0-CURRENT (amd64) 
> with gcc-4.4.5 and it fails:
>
> -----------------------------------------
> gcc -std=gnu99 -I../../src/extra/zlib -I../../src/extra/bzip2 
> -I../../src/extra/pcre  -I../../src/extra   -I. -I../../src/include 
> -I../../src/include -I/usr/local/include -DHAVE_CONFIG_H   -g -O2 -c 
> sysutils.c -o sysutils.o
> sysutils.c: In function 'R_system':
> sysutils.c:289: warning: implicit declaration of function 'WIFEXITED'
> sysutils.c:289: warning: implicit declaration of function 'WEXITSTATUS'
> gcc -std=gnu99 -I../../src/extra/zlib -I../../src/extra/bzip2 
> -I../../src/extra/pcre  -I../../src/extra   -I. -I../../src/include 
> -I../../src/include -I/usr/local/include -DHAVE_CONFIG_H   -g -O2 -c unique.c 
> -o unique.o
> gcc -std=gnu99 -I../../src/extra/zlib -I../../src/extra/bzip2 
> -I../../src/extra/pcre  -I../../src/extra   -I. -I../../src/include 
> -I../../src/include -I/usr/local/include -DHAVE_CONFIG_H   -g -O2 -c util.c 
> -o util.o
> gcc -std=gnu99 -I../../src/extra/zlib -I../../src/extra/bzip2 
> -I../../src/extra/pcre  -I../../src/extra   -I. -I../../src/include 
> -I../../src/include -I/usr/local/include -DHAVE_CONFIG_H   -g -O2 -c 
> version.c -o version.o
> gcc -std=gnu99 -I../../src/extra/zlib -I../../src/extra/bzip2 
> -I../../src/extra/pcre  -I../../src/extra   -I. -I../../src/include 
> -I../../src/include -I/usr/local/include -DHAVE_CONFIG_H   -g -O2 -c vfonts.c 
> -o vfonts.o
> gfortran   -g -O2 -c xxxpr.f -o xxxpr.o
> ar cr libR.a CConverters.o CommandLineArgs.o Rdynload.o Renviron.o RNG.o 
> agrep.o apply.o arithmetic.o array.o attrib.o base.o bind.o builtin.o 
> character.o coerce.o colors.o complex.o connections.o context.o cov.o cum.o 
> dcf.o datetime.o debug.o deparse.o deriv.o devices.o dotcode.o dounzip.o 
> dstruct.o duplicate.o engine.o envir.o errors.o eval.o format.o fourier.o 
> gevents.o gram.o gram-ex.o gramLatex.o gramRd.o graphics.o grep.o identical.o 
> inlined.o inspect.o internet.o iosupport.o lapack.o list.o localecharset.o 
> logic.o main.o mapply.o match.o memory.o model.o names.o objects.o optim.o 
> optimize.o options.o par.o paste.o platform.o plot.o plot3d.o plotmath.o 
> print.o printarray.o printvector.o printutils.o qsort.o random.o raw.o 
> registration.o relop.o rlocale.o saveload.o scan.o seq.o serialize.o size.o 
> sort.o source.o split.o sprintf.o startup.o subassign.o subscript.o subset.o 
> summary.o sysutils.o unique.o util.o version.o vfonts.o xxxpr.o libs/*o
> ranlib libR.a
> gcc -std=gnu99 -export-dynamic -L/usr/local/lib -o R.bin Rmain.o libR.a 
> -L../../lib -lRblas 
> -L/usr/local/lib/gcc44/gcc/x86_64-portbld-freebsd9.0/4.4.5 
> -L/usr/local/x86_64-portbld-freebsd9.0/lib -L/usr/local/lib/gcc44 -lgfortran 
> -lm  /usr/local/lib/libintl.so /usr/local/lib/libiconv.so -Wl,-rpath 
> -Wl,/usr/local/lib -lreadline -llzma -lm -liconv -licuuc -licui18n
> libR.a(sysutils.o)(.text+0x1d5d): In function `R_system':
> /usr/local/R-beta/src/main/sysutils.c:289: undefined reference to `WIFEXITED'
> libR.a(sysutils.o)(.text+0x1d76):/usr/local/R-beta/src/main/sysutils.c:289: 
> undefined reference to `WEXITSTATUS'
> libR.a(sys-unix.o)(.text+0x475): In function `do_system':
> /usr/local/R-beta/src/unix/sys-unix.c:290: undefined reference to `WIFEXITED'
> libR.a(sys-unix.o)(.text+0x551):/usr/local/R-beta/src/unix/sys-unix.c:290: 
> undefined reference to `WEXITSTATUS'
> *** Error code 1
> Stop in /usr/local/R-beta/src/main.
> *** Error code 1
> Stop in /usr/local/R-beta/src/main.
> *** Error code 1
> Stop in /usr/local/R-beta/src.
> *** Error code 1
> Stop in /usr/local/R-beta.
> -----------------------------------------
>
> Is this a known error? I would really appreciate if someone could give me a 
> hint.

Not known, and as it is a POSIX construction almost all OSes have it.
Can you try (in sysutils.c and sys-unix.c) replacing

#ifdef HAVE_SYS_WAIT_H

by

#if defined(HAVE_SYS_WAIT_H) && defined(WEXITSTATUS)

?


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From rhurlin at gwdg.de  Sun Oct  3 17:44:51 2010
From: rhurlin at gwdg.de (Rainer Hurling)
Date: Sun, 03 Oct 2010 17:44:51 +0200
Subject: [Rd] R-beta_2010-10-02_r53128 fails to compile on FreeBSD
In-Reply-To: <alpine.LFD.2.00.1010031607400.17992@gannet.stats.ox.ac.uk>
References: <4CA89209.4030005@gwdg.de>
	<alpine.LFD.2.00.1010031607400.17992@gannet.stats.ox.ac.uk>
Message-ID: <4CA8A4F3.1050105@gwdg.de>

On 03.10.2010 17:10 (UTC+1), Prof Brian Ripley wrote:
> On Sun, 3 Oct 2010, Rainer Hurling wrote:
>
>> I tried to compile R-beta_2010-10-02_r53128 on FreeBSD 9.0-CURRENT
>> (amd64) with gcc-4.4.5 and it fails:
>>
>> -----------------------------------------
>> gcc -std=gnu99 -I../../src/extra/zlib -I../../src/extra/bzip2
>> -I../../src/extra/pcre -I../../src/extra -I. -I../../src/include
>> -I../../src/include -I/usr/local/include -DHAVE_CONFIG_H -g -O2 -c
>> sysutils.c -o sysutils.o
>> sysutils.c: In function 'R_system':
>> sysutils.c:289: warning: implicit declaration of function 'WIFEXITED'
>> sysutils.c:289: warning: implicit declaration of function 'WEXITSTATUS'
>> gcc -std=gnu99 -I../../src/extra/zlib -I../../src/extra/bzip2
>> -I../../src/extra/pcre -I../../src/extra -I. -I../../src/include
>> -I../../src/include -I/usr/local/include -DHAVE_CONFIG_H -g -O2 -c
>> unique.c -o unique.o
>> gcc -std=gnu99 -I../../src/extra/zlib -I../../src/extra/bzip2
>> -I../../src/extra/pcre -I../../src/extra -I. -I../../src/include
>> -I../../src/include -I/usr/local/include -DHAVE_CONFIG_H -g -O2 -c
>> util.c -o util.o
>> gcc -std=gnu99 -I../../src/extra/zlib -I../../src/extra/bzip2
>> -I../../src/extra/pcre -I../../src/extra -I. -I../../src/include
>> -I../../src/include -I/usr/local/include -DHAVE_CONFIG_H -g -O2 -c
>> version.c -o version.o
>> gcc -std=gnu99 -I../../src/extra/zlib -I../../src/extra/bzip2
>> -I../../src/extra/pcre -I../../src/extra -I. -I../../src/include
>> -I../../src/include -I/usr/local/include -DHAVE_CONFIG_H -g -O2 -c
>> vfonts.c -o vfonts.o
>> gfortran -g -O2 -c xxxpr.f -o xxxpr.o
>> ar cr libR.a CConverters.o CommandLineArgs.o Rdynload.o Renviron.o
>> RNG.o agrep.o apply.o arithmetic.o array.o attrib.o base.o bind.o
>> builtin.o character.o coerce.o colors.o complex.o connections.o
>> context.o cov.o cum.o dcf.o datetime.o debug.o deparse.o deriv.o
>> devices.o dotcode.o dounzip.o dstruct.o duplicate.o engine.o envir.o
>> errors.o eval.o format.o fourier.o gevents.o gram.o gram-ex.o
>> gramLatex.o gramRd.o graphics.o grep.o identical.o inlined.o inspect.o
>> internet.o iosupport.o lapack.o list.o localecharset.o logic.o main.o
>> mapply.o match.o memory.o model.o names.o objects.o optim.o optimize.o
>> options.o par.o paste.o platform.o plot.o plot3d.o plotmath.o print.o
>> printarray.o printvector.o printutils.o qsort.o random.o raw.o
>> registration.o relop.o rlocale.o saveload.o scan.o seq.o serialize.o
>> size.o sort.o source.o split.o sprintf.o startup.o subassign.o
>> subscript.o subset.o summary.o sysutils.o unique.o util.o version.o
>> vfonts.o xxxpr.o libs/*o
>> ranlib libR.a
>> gcc -std=gnu99 -export-dynamic -L/usr/local/lib -o R.bin Rmain.o
>> libR.a -L../../lib -lRblas
>> -L/usr/local/lib/gcc44/gcc/x86_64-portbld-freebsd9.0/4.4.5
>> -L/usr/local/x86_64-portbld-freebsd9.0/lib -L/usr/local/lib/gcc44
>> -lgfortran -lm /usr/local/lib/libintl.so /usr/local/lib/libiconv.so
>> -Wl,-rpath -Wl,/usr/local/lib -lreadline -llzma -lm -liconv -licuuc
>> -licui18n
>> libR.a(sysutils.o)(.text+0x1d5d): In function `R_system':
>> /usr/local/R-beta/src/main/sysutils.c:289: undefined reference to
>> `WIFEXITED'
>> libR.a(sysutils.o)(.text+0x1d76):/usr/local/R-beta/src/main/sysutils.c:289:
>> undefined reference to `WEXITSTATUS'
>> libR.a(sys-unix.o)(.text+0x475): In function `do_system':
>> /usr/local/R-beta/src/unix/sys-unix.c:290: undefined reference to
>> `WIFEXITED'
>> libR.a(sys-unix.o)(.text+0x551):/usr/local/R-beta/src/unix/sys-unix.c:290:
>> undefined reference to `WEXITSTATUS'
>> *** Error code 1
>> Stop in /usr/local/R-beta/src/main.
>> *** Error code 1
>> Stop in /usr/local/R-beta/src/main.
>> *** Error code 1
>> Stop in /usr/local/R-beta/src.
>> *** Error code 1
>> Stop in /usr/local/R-beta.
>> -----------------------------------------
>>
>> Is this a known error? I would really appreciate if someone could give
>> me a hint.
>
> Not known, and as it is a POSIX construction almost all OSes have it.

Hmmm. It seems its implementation in FreeBSD (CURRENT) is a little 
different from other OSes?

> Can you try (in sysutils.c and sys-unix.c) replacing
>
> #ifdef HAVE_SYS_WAIT_H
>
> by
>
> #if defined(HAVE_SYS_WAIT_H) && defined(WEXITSTATUS)
>
> ?

Yes, with this patch in both files all works again. I tried it with 
gcc-4.4.5 and gcc-4.5.2. Is there any chance to get it in the release 
(R-2.12.0)?

As always you hit the goal. Thank you very much for the quick help,
Rainer Hurling


From rhurlin at gwdg.de  Sun Oct  3 17:45:01 2010
From: rhurlin at gwdg.de (Rainer Hurling)
Date: Sun, 03 Oct 2010 17:45:01 +0200
Subject: [Rd] R-beta_2010-10-02_r53128 fails to compile on FreeBSD
In-Reply-To: <4CA89C77.7050805@gmail.com>
References: <4CA89209.4030005@gwdg.de> <4CA89C77.7050805@gmail.com>
Message-ID: <4CA8A4FD.9090906@gwdg.de>

On 03.10.2010 17:08 (UTC+1), Peter Dalgaard wrote:
> On 10/03/2010 04:24 PM, Rainer Hurling wrote:
>> I tried to compile R-beta_2010-10-02_r53128 on FreeBSD 9.0-CURRENT
>> (amd64) with gcc-4.4.5 and it fails:
>
> Thanks for the report. WIFEXITED/WEXITSTATUS are usually defined in
> <sys/wait.h>  (usually /usr/include/sys/wait.h). Do you have any
> indication that this might be skipped? (configure output, etc.)

I think you are right, see the posting of Brian Ripley. With his 
suggested patch it works again.

> I'm not quite sure by which mechanism gcc is expected to include
> sys/wait.h, but the offending code is inside
>
> #ifdef HAVE_SYS_WAIT_H
>
> which configure is supposed to set only if it is available and POSIX
> compatible.
>
> Any chance you switched platform features (e.g. upgraded gcc) without
> reconfiguring?

No, nothing I am aware of. But 9.0-CURRENT is the development platform 
of FreeBSD and my system is very recent ;-)

> -pd

Many thanks for your answer,
Rainer Hurling


>> -----------------------------------------
>> gcc -std=gnu99 -I../../src/extra/zlib -I../../src/extra/bzip2
>> -I../../src/extra/pcre  -I../../src/extra   -I. -I../../src/include
>> -I../../src/include -I/usr/local/include -DHAVE_CONFIG_H   -g -O2 -c
>> sysutils.c -o sysutils.o
>> sysutils.c: In function 'R_system':
>> sysutils.c:289: warning: implicit declaration of function 'WIFEXITED'
>> sysutils.c:289: warning: implicit declaration of function 'WEXITSTATUS'
>> gcc -std=gnu99 -I../../src/extra/zlib -I../../src/extra/bzip2
>> -I../../src/extra/pcre  -I../../src/extra   -I. -I../../src/include
>> -I../../src/include -I/usr/local/include -DHAVE_CONFIG_H   -g -O2 -c
>> unique.c -o unique.o
>> gcc -std=gnu99 -I../../src/extra/zlib -I../../src/extra/bzip2
>> -I../../src/extra/pcre  -I../../src/extra   -I. -I../../src/include
>> -I../../src/include -I/usr/local/include -DHAVE_CONFIG_H   -g -O2 -c
>> util.c -o util.o
>> gcc -std=gnu99 -I../../src/extra/zlib -I../../src/extra/bzip2
>> -I../../src/extra/pcre  -I../../src/extra   -I. -I../../src/include
>> -I../../src/include -I/usr/local/include -DHAVE_CONFIG_H   -g -O2 -c
>> version.c -o version.o
>> gcc -std=gnu99 -I../../src/extra/zlib -I../../src/extra/bzip2
>> -I../../src/extra/pcre  -I../../src/extra   -I. -I../../src/include
>> -I../../src/include -I/usr/local/include -DHAVE_CONFIG_H   -g -O2 -c
>> vfonts.c -o vfonts.o
>> gfortran   -g -O2 -c xxxpr.f -o xxxpr.o
>> ar cr libR.a CConverters.o CommandLineArgs.o Rdynload.o Renviron.o RNG.o
>> agrep.o apply.o arithmetic.o array.o attrib.o base.o bind.o builtin.o
>> character.o coerce.o colors.o complex.o connections.o context.o cov.o
>> cum.o dcf.o datetime.o debug.o deparse.o deriv.o devices.o dotcode.o
>> dounzip.o dstruct.o duplicate.o engine.o envir.o errors.o eval.o
>> format.o fourier.o gevents.o gram.o gram-ex.o gramLatex.o gramRd.o
>> graphics.o grep.o identical.o inlined.o inspect.o internet.o iosupport.o
>> lapack.o list.o localecharset.o logic.o main.o mapply.o match.o memory.o
>> model.o names.o objects.o optim.o optimize.o options.o par.o paste.o
>> platform.o plot.o plot3d.o plotmath.o print.o printarray.o printvector.o
>> printutils.o qsort.o random.o raw.o registration.o relop.o rlocale.o
>> saveload.o scan.o seq.o serialize.o size.o sort.o source.o split.o
>> sprintf.o startup.o subassign.o subscript.o subset.o summary.o
>> sysutils.o unique.o util.o version.o vfonts.o xxxpr.o libs/*o
>> ranlib libR.a
>> gcc -std=gnu99 -export-dynamic -L/usr/local/lib -o R.bin Rmain.o libR.a
>> -L../../lib -lRblas
>> -L/usr/local/lib/gcc44/gcc/x86_64-portbld-freebsd9.0/4.4.5
>> -L/usr/local/x86_64-portbld-freebsd9.0/lib -L/usr/local/lib/gcc44
>> -lgfortran -lm  /usr/local/lib/libintl.so /usr/local/lib/libiconv.so
>> -Wl,-rpath -Wl,/usr/local/lib -lreadline -llzma -lm -liconv -licuuc
>> -licui18n
>> libR.a(sysutils.o)(.text+0x1d5d): In function `R_system':
>> /usr/local/R-beta/src/main/sysutils.c:289: undefined reference to
>> `WIFEXITED'
>> libR.a(sysutils.o)(.text+0x1d76):/usr/local/R-beta/src/main/sysutils.c:289:
>> undefined reference to `WEXITSTATUS'
>> libR.a(sys-unix.o)(.text+0x475): In function `do_system':
>> /usr/local/R-beta/src/unix/sys-unix.c:290: undefined reference to
>> `WIFEXITED'
>> libR.a(sys-unix.o)(.text+0x551):/usr/local/R-beta/src/unix/sys-unix.c:290:
>> undefined reference to `WEXITSTATUS'
>> *** Error code 1
>> Stop in /usr/local/R-beta/src/main.
>> *** Error code 1
>> Stop in /usr/local/R-beta/src/main.
>> *** Error code 1
>> Stop in /usr/local/R-beta/src.
>> *** Error code 1
>> Stop in /usr/local/R-beta.
>> -----------------------------------------
>>
>> Is this a known error? I would really appreciate if someone could give
>> me a hint.
>>
>> Please let me know if more information is needed.
>>
>> Thanks in advance,
>> Rainer Hurling


From ripley at stats.ox.ac.uk  Sun Oct  3 17:58:43 2010
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sun, 3 Oct 2010 16:58:43 +0100 (BST)
Subject: [Rd] R-beta_2010-10-02_r53128 fails to compile on FreeBSD
In-Reply-To: <4CA8A4F3.1050105@gwdg.de>
References: <4CA89209.4030005@gwdg.de>
	<alpine.LFD.2.00.1010031607400.17992@gannet.stats.ox.ac.uk>
	<4CA8A4F3.1050105@gwdg.de>
Message-ID: <alpine.LFD.2.00.1010031654440.25405@gannet.stats.ox.ac.uk>

On Sun, 3 Oct 2010, Rainer Hurling wrote:

...
>>> Is this a known error? I would really appreciate if someone could give
>>> me a hint.
>> 
>> Not known, and as it is a POSIX construction almost all OSes have it.
>
> Hmmm. It seems its implementation in FreeBSD (CURRENT) is a little different 
> from other OSes?
>
>> Can you try (in sysutils.c and sys-unix.c) replacing
>> 
>> #ifdef HAVE_SYS_WAIT_H
>> 
>> by
>> 
>> #if defined(HAVE_SYS_WAIT_H) && defined(WEXITSTATUS)
>> 
>> ?
>
> Yes, with this patch in both files all works again. I tried it with gcc-4.4.5 
> and gcc-4.5.2. Is there any chance to get it in the release (R-2.12.0)?

Yes, of course.  (After a little more testing on other platforms.)

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From renaud.lancelot at gmail.com  Sun Oct  3 18:23:12 2010
From: renaud.lancelot at gmail.com (Renaud Lancelot)
Date: Sun, 3 Oct 2010 18:23:12 +0200
Subject: [Rd] Encoding problem in Rd file
Message-ID: <AANLkTim64+ZkrdnxwFQLtSr0zimDbt61a4L9afNGGwNO@mail.gmail.com>

Dear all,

I have a problem with an Rd file containing French accentuated
characters. I have uploaded the file at
http://filex.cirad.fr/get?k=cjW7lImMaNC6Ci2vX0H

I have declared
Encoding: latin1
in the package DESCRIPTION file

and I have added
\encoding{latin1}
in the header of the Rd file.

When I compile the package manual, I have LaTeX errors:

! Package inputenc Error: Unicode char \u8:?F not set up for use with LaTeX.

See the inputenc package documentation for explanation.
Type  H <return>  for immediate help.
 ...

l.579 ...ain. Aspects m??thodologiques.} Rev. ?  F
                                                  aug??re, O., Dock??s, A.-C...

Your command was ignored.
Type  I <command> <return>  to replace it with another command,
or  <return>  to continue without it.


! Package inputenc Error: Unicode char \u8:?F not set up for use with LaTeX.

See the inputenc package documentation for explanation.
Type  H <return>  for immediate help.
 ...

l.581 ?  F
          aug??re, O., Tillard, E., Faug??re, B., 1992. \emph{Prophylaxie ch...

Your command was ignored.
Type  I <command> <return>  to replace it with another command,
or  <return>  to continue without it.


! Package inputenc Error: Unicode char \u8:?\end not set up for use with LaTeX.


See the inputenc package documentation for explanation.
Type  H <return>  for immediate help.
 ...

l.587 \end
          {References}
Your command was ignored.
Type  I <command> <return>  to replace it with another command,
or  <return>  to continue without it.

***********
I can easily find the offending lines using
showNonASCII(readLines(file)). However, I don't know what to do to
solve the problem. The strange thing (to me!) is that the pdf is
actually built with appropriate accentuated characters, at least when
I look at it with my pdf viewer (Acrobat reader).

My config is:

> sessionInfo()
R version 2.11.1 Patched (2010-09-30 r53117)
Platform: i386-pc-mingw32 (32-bit)

locale:
[1] LC_COLLATE=French_France.1252  LC_CTYPE=French_France.1252
[3] LC_MONETARY=French_France.1252 LC_NUMERIC=C
[5] LC_TIME=French_France.1252

attached base packages:
[1] tools     stats     graphics  grDevices utils     datasets  methods
[8] base

other attached packages:
[1] fortunes_1.4-0




-- 
Renaud Lancelot
EDEN Project, coordinator
http://www.eden-fp6project.net/

UMR CIRAD-INRA "Contr?le des maladies animales exotiques et ?mergentes"
Joint research unit "Control of emerging and exotic animal diseases"

CIRAD, Campus International de Baillarguet TA A-DIR / B
F34398 Montpellier
http://umr-cmaee.cirad.fr/

Tel.? +33 4 67 59 37 17? -? Fax? +33 4 67 59 37 95
Secr. +33 4 67 59 37 37? - Cell. +33 6 77 52 08 69


From pdalgd at gmail.com  Sun Oct  3 18:38:05 2010
From: pdalgd at gmail.com (Peter Dalgaard)
Date: Sun, 03 Oct 2010 18:38:05 +0200
Subject: [Rd] R-beta_2010-10-02_r53128 fails to compile on FreeBSD
In-Reply-To: <alpine.LFD.2.00.1010031654440.25405@gannet.stats.ox.ac.uk>
References: <4CA89209.4030005@gwdg.de>	<alpine.LFD.2.00.1010031607400.17992@gannet.stats.ox.ac.uk>	<4CA8A4F3.1050105@gwdg.de>
	<alpine.LFD.2.00.1010031654440.25405@gannet.stats.ox.ac.uk>
Message-ID: <4CA8B16D.901@gmail.com>

On 10/03/2010 05:58 PM, Prof Brian Ripley wrote:
> On Sun, 3 Oct 2010, Rainer Hurling wrote:
> 
> ...
>>>> Is this a known error? I would really appreciate if someone could give
>>>> me a hint.
>>>
>>> Not known, and as it is a POSIX construction almost all OSes have it.
>>
>> Hmmm. It seems its implementation in FreeBSD (CURRENT) is a little different 
>> from other OSes?
>>
>>> Can you try (in sysutils.c and sys-unix.c) replacing
>>>
>>> #ifdef HAVE_SYS_WAIT_H
>>>
>>> by
>>>
>>> #if defined(HAVE_SYS_WAIT_H) && defined(WEXITSTATUS)
>>>
>>> ?
>>
>> Yes, with this patch in both files all works again. I tried it with gcc-4.4.5 
>> and gcc-4.5.2. Is there any chance to get it in the release (R-2.12.0)?
> 
> Yes, of course.  (After a little more testing on other platforms.)
> 

Only it strikes me that it might be plugging the wrong hole. I.e., that
the real issue is that somehow we're not including sys/wait.h in all
cases. Would it perchance also work to have

#ifdef HAVE_SYS_WAIT_H
#include <sys/wait.h>
#endif

somewhere at the top of the files that use the two macros (sysutils.c
and sys-unix.c AFAICS).

"&& defined(WEXITSTATUS)" probably won't break anything that wasn't
already broken, but it does insert a default definition that could
conflict with the one intended for the OS (that's what include files and
macros are for, after all).




-- 
Peter Dalgaard
Center for Statistics, Copenhagen Business School
Phone: (+45)38153501
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From murdoch.duncan at gmail.com  Sun Oct  3 18:48:49 2010
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Sun, 03 Oct 2010 12:48:49 -0400
Subject: [Rd] Encoding problem in Rd file
In-Reply-To: <AANLkTim64+ZkrdnxwFQLtSr0zimDbt61a4L9afNGGwNO@mail.gmail.com>
References: <AANLkTim64+ZkrdnxwFQLtSr0zimDbt61a4L9afNGGwNO@mail.gmail.com>
Message-ID: <4CA8B3F1.1080404@gmail.com>

On 03/10/2010 12:23 PM, Renaud Lancelot wrote:
> Dear all,
> 
> I have a problem with an Rd file containing French accentuated
> characters. I have uploaded the file at
> http://filex.cirad.fr/get?k=cjW7lImMaNC6Ci2vX0H
> 
> I have declared
> Encoding: latin1
> in the package DESCRIPTION file
> 
> and I have added
> \encoding{latin1}
> in the header of the Rd file.
> 
> When I compile the package manual, I have LaTeX errors:
> 
> ! Package inputenc Error: Unicode char \u8:?F not set up for use with LaTeX.
> 
> See the inputenc package documentation for explanation.
> Type  H <return>  for immediate help.
>  ...
> 
> l.579 ...ain. Aspects m??thodologiques.} Rev. ?  F
>                                                   aug??re, O., Dock??s, A.-C...

R converts everything to UTF-8 and declares it that way for LaTeX. It 
looks as though your LaTeX installation isn't prepared to handle that, 
or something has gone wrong in the conversion on your system.  The 
letter following "Rev. " above is a capital E with an acute accent, 
which is encoded as C3 89 in UTF-8.  Interpreted as Latin1, that looks 
like "?", because the 89 is unprintable, but it shouldn't come out as "?F".

I'd suggest updating your LaTeX inputenc package.  If that doesn't work, 
you can see if the problem is in the conversion, by running

R CMD Rd2dvi --no-clean dja.Rd

and look in the Rd2.tex file that was produced.

Duncan Murdoch

> 
> Your command was ignored.
> Type  I <command> <return>  to replace it with another command,
> or  <return>  to continue without it.
> 
> 
> ! Package inputenc Error: Unicode char \u8:?F not set up for use with LaTeX.
> 
> See the inputenc package documentation for explanation.
> Type  H <return>  for immediate help.
>  ...
> 
> l.581 ?  F
>           aug??re, O., Tillard, E., Faug??re, B., 1992. \emph{Prophylaxie ch...
> 
> Your command was ignored.
> Type  I <command> <return>  to replace it with another command,
> or  <return>  to continue without it.
> 
> 
> ! Package inputenc Error: Unicode char \u8:?\end not set up for use with LaTeX.
> 
> 
> See the inputenc package documentation for explanation.
> Type  H <return>  for immediate help.
>  ...
> 
> l.587 \end
>           {References}
> Your command was ignored.
> Type  I <command> <return>  to replace it with another command,
> or  <return>  to continue without it.
> 
> ***********
> I can easily find the offending lines using
> showNonASCII(readLines(file)). However, I don't know what to do to
> solve the problem. The strange thing (to me!) is that the pdf is
> actually built with appropriate accentuated characters, at least when
> I look at it with my pdf viewer (Acrobat reader).
> 
> My config is:
> 
>> sessionInfo()
> R version 2.11.1 Patched (2010-09-30 r53117)
> Platform: i386-pc-mingw32 (32-bit)
> 
> locale:
> [1] LC_COLLATE=French_France.1252  LC_CTYPE=French_France.1252
> [3] LC_MONETARY=French_France.1252 LC_NUMERIC=C
> [5] LC_TIME=French_France.1252
> 
> attached base packages:
> [1] tools     stats     graphics  grDevices utils     datasets  methods
> [8] base
> 
> other attached packages:
> [1] fortunes_1.4-0
> 
> 
> 
>


From rhurlin at gwdg.de  Sun Oct  3 19:03:25 2010
From: rhurlin at gwdg.de (Rainer Hurling)
Date: Sun, 03 Oct 2010 19:03:25 +0200
Subject: [Rd] R-beta_2010-10-02_r53128 fails to compile on FreeBSD
In-Reply-To: <4CA8B16D.901@gmail.com>
References: <4CA89209.4030005@gwdg.de>	<alpine.LFD.2.00.1010031607400.17992@gannet.stats.ox.ac.uk>	<4CA8A4F3.1050105@gwdg.de>
	<alpine.LFD.2.00.1010031654440.25405@gannet.stats.ox.ac.uk>
	<4CA8B16D.901@gmail.com>
Message-ID: <4CA8B75D.8040606@gwdg.de>

On 03.10.2010 18:38 (UTC+1), Peter Dalgaard wrote:
> On 10/03/2010 05:58 PM, Prof Brian Ripley wrote:
>> On Sun, 3 Oct 2010, Rainer Hurling wrote:
>>
>> ...
>>>>> Is this a known error? I would really appreciate if someone could give
>>>>> me a hint.
>>>>
>>>> Not known, and as it is a POSIX construction almost all OSes have it.
>>>
>>> Hmmm. It seems its implementation in FreeBSD (CURRENT) is a little different
>>> from other OSes?
>>>
>>>> Can you try (in sysutils.c and sys-unix.c) replacing
>>>>
>>>> #ifdef HAVE_SYS_WAIT_H
>>>>
>>>> by
>>>>
>>>> #if defined(HAVE_SYS_WAIT_H)&&  defined(WEXITSTATUS)
>>>>
>>>> ?
>>>
>>> Yes, with this patch in both files all works again. I tried it with gcc-4.4.5
>>> and gcc-4.5.2. Is there any chance to get it in the release (R-2.12.0)?
>>
>> Yes, of course.  (After a little more testing on other platforms.)
>>
>
> Only it strikes me that it might be plugging the wrong hole. I.e., that
> the real issue is that somehow we're not including sys/wait.h in all
> cases. Would it perchance also work to have
>
> #ifdef HAVE_SYS_WAIT_H
> #include<sys/wait.h>
> #endif

Just as a note. This (#include<sys/wait.h>) also works on FreeBSD.

Rainer Hurling


> somewhere at the top of the files that use the two macros (sysutils.c
> and sys-unix.c AFAICS).
>
> "&&  defined(WEXITSTATUS)" probably won't break anything that wasn't
> already broken, but it does insert a default definition that could
> conflict with the one intended for the OS (that's what include files and
> macros are for, after all).


From renaud.lancelot at gmail.com  Sun Oct  3 19:14:35 2010
From: renaud.lancelot at gmail.com (Renaud Lancelot)
Date: Sun, 3 Oct 2010 19:14:35 +0200
Subject: [Rd] Encoding problem in Rd file
In-Reply-To: <4CA8B3F1.1080404@gmail.com>
References: <AANLkTim64+ZkrdnxwFQLtSr0zimDbt61a4L9afNGGwNO@mail.gmail.com>
	<4CA8B3F1.1080404@gmail.com>
Message-ID: <AANLkTineG4qndYdykEZCzC49OpKt-5XGGACuQf71dkxe@mail.gmail.com>

Thank you very much. My LaTeX installation is up to date (very
recently updated with MIKTeK update facility).
I have run R CMD Rd2dvi --no-clean dja.Rd and the result looks OK. I
have put the resulting TeX file at
http://filex.cirad.fr/get?k=K1cBpKr3UBUmdOJFMlx

Do you have another suggestion?

Renaud

2010/10/3 Duncan Murdoch <murdoch.duncan at gmail.com>:
> On 03/10/2010 12:23 PM, Renaud Lancelot wrote:
>>
>> Dear all,
>>
>> I have a problem with an Rd file containing French accentuated
>> characters. I have uploaded the file at
>> http://filex.cirad.fr/get?k=cjW7lImMaNC6Ci2vX0H
>>
>> I have declared
>> Encoding: latin1
>> in the package DESCRIPTION file
>>
>> and I have added
>> \encoding{latin1}
>> in the header of the Rd file.
>>
>> When I compile the package manual, I have LaTeX errors:
>>
>> ! Package inputenc Error: Unicode char \u8:?F not set up for use with
>> LaTeX.
>>
>> See the inputenc package documentation for explanation.
>> Type ?H <return> ?for immediate help.
>> ?...
>>
>> l.579 ...ain. Aspects m??thodologiques.} Rev. ? ?F
>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?aug??re, O., Dock??s,
>> A.-C...
>
> R converts everything to UTF-8 and declares it that way for LaTeX. It looks
> as though your LaTeX installation isn't prepared to handle that, or
> something has gone wrong in the conversion on your system. ?The letter
> following "Rev. " above is a capital E with an acute accent, which is
> encoded as C3 89 in UTF-8. ?Interpreted as Latin1, that looks like "?",
> because the 89 is unprintable, but it shouldn't come out as "?F".
>
> I'd suggest updating your LaTeX inputenc package. ?If that doesn't work, you
> can see if the problem is in the conversion, by running
>
> R CMD Rd2dvi --no-clean dja.Rd
>
> and look in the Rd2.tex file that was produced.
>
> Duncan Murdoch
>
>>
>> Your command was ignored.
>> Type ?I <command> <return> ?to replace it with another command,
>> or ?<return> ?to continue without it.
>>
>>
>> ! Package inputenc Error: Unicode char \u8:?F not set up for use with
>> LaTeX.
>>
>> See the inputenc package documentation for explanation.
>> Type ?H <return> ?for immediate help.
>> ?...
>>
>> l.581 ? ?F
>> ? ? ? ? ?aug??re, O., Tillard, E., Faug??re, B., 1992. \emph{Prophylaxie
>> ch...
>>
>> Your command was ignored.
>> Type ?I <command> <return> ?to replace it with another command,
>> or ?<return> ?to continue without it.
>>
>>
>> ! Package inputenc Error: Unicode char \u8:?\end not set up for use with
>> LaTeX.
>>
>>
>> See the inputenc package documentation for explanation.
>> Type ?H <return> ?for immediate help.
>> ?...
>>
>> l.587 \end
>> ? ? ? ? ?{References}
>> Your command was ignored.
>> Type ?I <command> <return> ?to replace it with another command,
>> or ?<return> ?to continue without it.
>>
>> ***********
>> I can easily find the offending lines using
>> showNonASCII(readLines(file)). However, I don't know what to do to
>> solve the problem. The strange thing (to me!) is that the pdf is
>> actually built with appropriate accentuated characters, at least when
>> I look at it with my pdf viewer (Acrobat reader).
>>
>> My config is:
>>
>>> sessionInfo()
>>
>> R version 2.11.1 Patched (2010-09-30 r53117)
>> Platform: i386-pc-mingw32 (32-bit)
>>
>> locale:
>> [1] LC_COLLATE=French_France.1252 ?LC_CTYPE=French_France.1252
>> [3] LC_MONETARY=French_France.1252 LC_NUMERIC=C
>> [5] LC_TIME=French_France.1252
>>
>> attached base packages:
>> [1] tools ? ? stats ? ? graphics ?grDevices utils ? ? datasets ?methods
>> [8] base
>>
>> other attached packages:
>> [1] fortunes_1.4-0
>>
>>
>>
>>
>
>



-- 
Renaud Lancelot
EDEN Project, coordinator
http://www.eden-fp6project.net/

UMR CIRAD-INRA "Contr?le des maladies animales exotiques et ?mergentes"
Joint research unit "Control of emerging and exotic animal diseases"

CIRAD, Campus International de Baillarguet TA A-DIR / B
F34398 Montpellier
http://umr-cmaee.cirad.fr/

Tel.? +33 4 67 59 37 17? -? Fax? +33 4 67 59 37 95
Secr. +33 4 67 59 37 37? - Cell. +33 6 77 52 08 69


From murdoch.duncan at gmail.com  Sun Oct  3 19:31:42 2010
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Sun, 03 Oct 2010 13:31:42 -0400
Subject: [Rd] Encoding problem in Rd file
In-Reply-To: <AANLkTineG4qndYdykEZCzC49OpKt-5XGGACuQf71dkxe@mail.gmail.com>
References: <AANLkTim64+ZkrdnxwFQLtSr0zimDbt61a4L9afNGGwNO@mail.gmail.com>	<4CA8B3F1.1080404@gmail.com>
	<AANLkTineG4qndYdykEZCzC49OpKt-5XGGACuQf71dkxe@mail.gmail.com>
Message-ID: <4CA8BDFE.2070505@gmail.com>

On 03/10/2010 1:14 PM, Renaud Lancelot wrote:
> Thank you very much. My LaTeX installation is up to date (very
> recently updated with MIKTeK update facility).
> I have run R CMD Rd2dvi --no-clean dja.Rd and the result looks OK. I
> have put the resulting TeX file at
> http://filex.cirad.fr/get?k=K1cBpKr3UBUmdOJFMlx
> 
> Do you have another suggestion?

Not really, other than trying a LaTeX expert.  When I run your file 
through latex using

R CMD latex Rd2.tex

it compiles fine with no errors (only an "underfull hbox" warning).

One thought:  some people install copies of Rd.sty into their local tex 
installation.  If that version isn't compatible with the current macros 
generated by R, you could have problems.  You should see something like

(F:/R/svn/r-devel/R/share/texmf/tex/latex\Rd.sty
Package: Rd

in the Rd2.log file.  If you see that it finds Rd.sty outside of the 
current R version, delete the old file.

Duncan Murdoch


> 
> Renaud
> 
> 2010/10/3 Duncan Murdoch <murdoch.duncan at gmail.com>:
>> On 03/10/2010 12:23 PM, Renaud Lancelot wrote:
>>> Dear all,
>>>
>>> I have a problem with an Rd file containing French accentuated
>>> characters. I have uploaded the file at
>>> http://filex.cirad.fr/get?k=cjW7lImMaNC6Ci2vX0H
>>>
>>> I have declared
>>> Encoding: latin1
>>> in the package DESCRIPTION file
>>>
>>> and I have added
>>> \encoding{latin1}
>>> in the header of the Rd file.
>>>
>>> When I compile the package manual, I have LaTeX errors:
>>>
>>> ! Package inputenc Error: Unicode char \u8:?F not set up for use with
>>> LaTeX.
>>>
>>> See the inputenc package documentation for explanation.
>>> Type  H <return>  for immediate help.
>>>  ...
>>>
>>> l.579 ...ain. Aspects m??thodologiques.} Rev. ?  F
>>>                                                  aug??re, O., Dock??s,
>>> A.-C...
>> R converts everything to UTF-8 and declares it that way for LaTeX. It looks
>> as though your LaTeX installation isn't prepared to handle that, or
>> something has gone wrong in the conversion on your system.  The letter
>> following "Rev. " above is a capital E with an acute accent, which is
>> encoded as C3 89 in UTF-8.  Interpreted as Latin1, that looks like "?",
>> because the 89 is unprintable, but it shouldn't come out as "?F".
>>
>> I'd suggest updating your LaTeX inputenc package.  If that doesn't work, you
>> can see if the problem is in the conversion, by running
>>
>> R CMD Rd2dvi --no-clean dja.Rd
>>
>> and look in the Rd2.tex file that was produced.
>>
>> Duncan Murdoch
>>
>>> Your command was ignored.
>>> Type  I <command> <return>  to replace it with another command,
>>> or  <return>  to continue without it.
>>>
>>>
>>> ! Package inputenc Error: Unicode char \u8:?F not set up for use with
>>> LaTeX.
>>>
>>> See the inputenc package documentation for explanation.
>>> Type  H <return>  for immediate help.
>>>  ...
>>>
>>> l.581 ?  F
>>>          aug??re, O., Tillard, E., Faug??re, B., 1992. \emph{Prophylaxie
>>> ch...
>>>
>>> Your command was ignored.
>>> Type  I <command> <return>  to replace it with another command,
>>> or  <return>  to continue without it.
>>>
>>>
>>> ! Package inputenc Error: Unicode char \u8:?\end not set up for use with
>>> LaTeX.
>>>
>>>
>>> See the inputenc package documentation for explanation.
>>> Type  H <return>  for immediate help.
>>>  ...
>>>
>>> l.587 \end
>>>          {References}
>>> Your command was ignored.
>>> Type  I <command> <return>  to replace it with another command,
>>> or  <return>  to continue without it.
>>>
>>> ***********
>>> I can easily find the offending lines using
>>> showNonASCII(readLines(file)). However, I don't know what to do to
>>> solve the problem. The strange thing (to me!) is that the pdf is
>>> actually built with appropriate accentuated characters, at least when
>>> I look at it with my pdf viewer (Acrobat reader).
>>>
>>> My config is:
>>>
>>>> sessionInfo()
>>> R version 2.11.1 Patched (2010-09-30 r53117)
>>> Platform: i386-pc-mingw32 (32-bit)
>>>
>>> locale:
>>> [1] LC_COLLATE=French_France.1252  LC_CTYPE=French_France.1252
>>> [3] LC_MONETARY=French_France.1252 LC_NUMERIC=C
>>> [5] LC_TIME=French_France.1252
>>>
>>> attached base packages:
>>> [1] tools     stats     graphics  grDevices utils     datasets  methods
>>> [8] base
>>>
>>> other attached packages:
>>> [1] fortunes_1.4-0
>>>
>>>
>>>
>>>
>>
> 
> 
>


From renaud.lancelot at gmail.com  Sun Oct  3 20:09:54 2010
From: renaud.lancelot at gmail.com (Renaud Lancelot)
Date: Sun, 3 Oct 2010 20:09:54 +0200
Subject: [Rd] Encoding problem in Rd file
In-Reply-To: <4CA8BDFE.2070505@gmail.com>
References: <AANLkTim64+ZkrdnxwFQLtSr0zimDbt61a4L9afNGGwNO@mail.gmail.com>
	<4CA8B3F1.1080404@gmail.com>
	<AANLkTineG4qndYdykEZCzC49OpKt-5XGGACuQf71dkxe@mail.gmail.com>
	<4CA8BDFE.2070505@gmail.com>
Message-ID: <AANLkTinxdTL1NuZs-WjB+wE1Gbs3--FCsx5EGaXtRo+Z@mail.gmail.com>

I see C:/R\R-2.11.1\share\texmf\Rd.sty which is my current R
installation. By the way, there is no error during the compilation
with

 R CMD Rd2dvi --no-clean dja.Rd

So, it looks that the problem is located elsewhere...

Thank you for your help.

All the best,

Renaud

2010/10/3 Duncan Murdoch <murdoch.duncan at gmail.com>:
> On 03/10/2010 1:14 PM, Renaud Lancelot wrote:
>>
>> Thank you very much. My LaTeX installation is up to date (very
>> recently updated with MIKTeK update facility).
>> I have run R CMD Rd2dvi --no-clean dja.Rd and the result looks OK. I
>> have put the resulting TeX file at
>> http://filex.cirad.fr/get?k=K1cBpKr3UBUmdOJFMlx
>>
>> Do you have another suggestion?
>
> Not really, other than trying a LaTeX expert. ?When I run your file through
> latex using
>
> R CMD latex Rd2.tex
>
> it compiles fine with no errors (only an "underfull hbox" warning).
>
> One thought: ?some people install copies of Rd.sty into their local tex
> installation. ?If that version isn't compatible with the current macros
> generated by R, you could have problems. ?You should see something like
>
> (F:/R/svn/r-devel/R/share/texmf/tex/latex\Rd.sty
> Package: Rd
>
> in the Rd2.log file. ?If you see that it finds Rd.sty outside of the current
> R version, delete the old file.
>
> Duncan Murdoch
>
>
>>
>> Renaud
>>
>> 2010/10/3 Duncan Murdoch <murdoch.duncan at gmail.com>:
>>>
>>> On 03/10/2010 12:23 PM, Renaud Lancelot wrote:
>>>>
>>>> Dear all,
>>>>
>>>> I have a problem with an Rd file containing French accentuated
>>>> characters. I have uploaded the file at
>>>> http://filex.cirad.fr/get?k=cjW7lImMaNC6Ci2vX0H
>>>>
>>>> I have declared
>>>> Encoding: latin1
>>>> in the package DESCRIPTION file
>>>>
>>>> and I have added
>>>> \encoding{latin1}
>>>> in the header of the Rd file.
>>>>
>>>> When I compile the package manual, I have LaTeX errors:
>>>>
>>>> ! Package inputenc Error: Unicode char \u8:?F not set up for use with
>>>> LaTeX.
>>>>
>>>> See the inputenc package documentation for explanation.
>>>> Type ?H <return> ?for immediate help.
>>>> ?...
>>>>
>>>> l.579 ...ain. Aspects m??thodologiques.} Rev. ? ?F
>>>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? aug??re, O., Dock??s,
>>>> A.-C...
>>>
>>> R converts everything to UTF-8 and declares it that way for LaTeX. It
>>> looks
>>> as though your LaTeX installation isn't prepared to handle that, or
>>> something has gone wrong in the conversion on your system. ?The letter
>>> following "Rev. " above is a capital E with an acute accent, which is
>>> encoded as C3 89 in UTF-8. ?Interpreted as Latin1, that looks like "?",
>>> because the 89 is unprintable, but it shouldn't come out as "?F".
>>>
>>> I'd suggest updating your LaTeX inputenc package. ?If that doesn't work,
>>> you
>>> can see if the problem is in the conversion, by running
>>>
>>> R CMD Rd2dvi --no-clean dja.Rd
>>>
>>> and look in the Rd2.tex file that was produced.
>>>
>>> Duncan Murdoch
>>>
>>>> Your command was ignored.
>>>> Type ?I <command> <return> ?to replace it with another command,
>>>> or ?<return> ?to continue without it.
>>>>
>>>>
>>>> ! Package inputenc Error: Unicode char \u8:?F not set up for use with
>>>> LaTeX.
>>>>
>>>> See the inputenc package documentation for explanation.
>>>> Type ?H <return> ?for immediate help.
>>>> ?...
>>>>
>>>> l.581 ? ?F
>>>> ? ? ? ? aug??re, O., Tillard, E., Faug??re, B., 1992. \emph{Prophylaxie
>>>> ch...
>>>>
>>>> Your command was ignored.
>>>> Type ?I <command> <return> ?to replace it with another command,
>>>> or ?<return> ?to continue without it.
>>>>
>>>>
>>>> ! Package inputenc Error: Unicode char \u8:?\end not set up for use with
>>>> LaTeX.
>>>>
>>>>
>>>> See the inputenc package documentation for explanation.
>>>> Type ?H <return> ?for immediate help.
>>>> ?...
>>>>
>>>> l.587 \end
>>>> ? ? ? ? {References}
>>>> Your command was ignored.
>>>> Type ?I <command> <return> ?to replace it with another command,
>>>> or ?<return> ?to continue without it.
>>>>
>>>> ***********
>>>> I can easily find the offending lines using
>>>> showNonASCII(readLines(file)). However, I don't know what to do to
>>>> solve the problem. The strange thing (to me!) is that the pdf is
>>>> actually built with appropriate accentuated characters, at least when
>>>> I look at it with my pdf viewer (Acrobat reader).
>>>>
>>>> My config is:
>>>>
>>>>> sessionInfo()
>>>>
>>>> R version 2.11.1 Patched (2010-09-30 r53117)
>>>> Platform: i386-pc-mingw32 (32-bit)
>>>>
>>>> locale:
>>>> [1] LC_COLLATE=French_France.1252 ?LC_CTYPE=French_France.1252
>>>> [3] LC_MONETARY=French_France.1252 LC_NUMERIC=C
>>>> [5] LC_TIME=French_France.1252
>>>>
>>>> attached base packages:
>>>> [1] tools ? ? stats ? ? graphics ?grDevices utils ? ? datasets ?methods
>>>> [8] base
>>>>
>>>> other attached packages:
>>>> [1] fortunes_1.4-0
>>>>
>>>>
>>>>
>>>>
>>>
>>
>>
>>
>
>



-- 
Renaud Lancelot
EDEN Project, coordinator
http://www.eden-fp6project.net/

UMR CIRAD-INRA "Contr?le des maladies animales exotiques et ?mergentes"
Joint research unit "Control of emerging and exotic animal diseases"

CIRAD, Campus International de Baillarguet TA A-DIR / B
F34398 Montpellier
http://umr-cmaee.cirad.fr/

Tel.? +33 4 67 59 37 17? -? Fax? +33 4 67 59 37 95
Secr. +33 4 67 59 37 37? - Cell. +33 6 77 52 08 69


From p.murrell at auckland.ac.nz  Sun Oct  3 23:23:39 2010
From: p.murrell at auckland.ac.nz (Paul Murrell)
Date: Mon, 04 Oct 2010 10:23:39 +1300
Subject: [Rd] strange interaction between rasterImage and Grid graphics
In-Reply-To: <58dc2267d949738dc9a098ff54e26482@braverock.com>
References: <AANLkTimX=5B478CCrEjCX0Y0Kw-FVuu=6ED5kYQ0iykY@mail.gmail.com>
	<4CA7C1D8.7050202@auckland.ac.nz>
	<AANLkTikY-erfsxifHcKyPcnrCnwaiTn5K3s9KTvcfht4@mail.gmail.com>
	<58dc2267d949738dc9a098ff54e26482@braverock.com>
Message-ID: <4CA8F45B.8080406@auckland.ac.nz>

Hi

Thanks for narrowing down the problem.

I have committed some more defensive code and a change that fixes the 
problem (for me ...

R version 2.13.0 Under development (unstable) (2010-09-28 r53056)
Platform: i686-pc-linux-gnu (32-bit)

Paul

On 10/3/2010 10:25 PM, Brian G. Peterson wrote:
> On Sat, 2 Oct 2010 22:36:07 -0700, Deepayan Sarkar
> <deepayan.sarkar at gmail.com>  wrote:
>>> On Sat, Oct 2, 2010 at 4:35 PM, Paul Murrell<p.murrell at auckland.ac.nz>
>>> wrote:
>>>> The only device I've tried is quartz(), x11() crashed with
> rasterImage,
>>>
>>> That is more serious.  I have heard of a couple of others like this and
>>> I think the common thread may be 64-bit MacOS X.
>>> I need to get access to such a beast to take a look.
>>
>> Or maybe just 64 bit. I have (running Debian unstable)
>>
>>> sessionInfo()
>> R version 2.12.0 Under development (unstable) (2010-09-02 r52864)
>> Platform: x86_64-unknown-linux-gnu (64-bit)
>>
>> and I get reproducible crashes (same 'memory not mapped' segfault) with
>>
>> x11(type="Xlib")
>> example(rasterImage) #or
>>
>> library(lattice)
>> example(panel.levelplot.raster)
>>
>> [I noticed this a while back, but neglected to report.]
>>
>> -Deepayan
>>
>>>
>>> Paul
>>>
>>>>   *** caught segfault ***
>>>> address 0x28, cause 'memory not mapped'
>>>>
>>>> Traceback:
>>>>   1: rasterImage(matrix(1), 1, 1, 1, 1)
>>>>
>>>> sessionInfo()
>>>> R version 2.11.1 (2010-05-31)
>>>> x86_64-apple-darwin9.8.0
>
> I can confirm the problem exists in 2.11.1 as well on 64 bit Ubuntu:
>
> R version 2.11.1 (2010-05-31)
>
>> x11(type="Xlib")
>> example(rasterImage)
>
> rstrIm>  require(grDevices)
>
> rstrIm>  ## set up the plot region:
> rstrIm>  op<- par(bg = "thistle")
>
> rstrIm>  plot(c(100, 250), c(300, 450), type = "n", xlab="", ylab="")
> Hit<Return>  to see next plot:
>
> rstrIm>  image<- as.raster(matrix(0:1, ncol=5, nrow=3))
>
> rstrIm>  rasterImage(image, 100, 300, 150, 350, interpolate=FALSE)
>
>   *** caught segfault ***
> address 0x28, cause 'memory not mapped'
>
> Traceback:
>   1: rasterImage(image, 100, 300, 150, 350, interpolate = FALSE)
>   2: eval.with.vis(expr, envir, enclos)
>   3: eval.with.vis(ei, envir)
>   4: source(tf, local, echo = echo, prompt.echo = paste(prompt.prefix,
> getOption("prompt"), sep = ""), continue.echo = paste(prompt.prefix,
> getOption("continue"), sep = ""), verbose = verbose, max.deparse.length =
> Inf,     encoding = encoding, skip.echo = skips, keep.source = TRUE)
>   5: example(rasterImage)
>
> The lattice example in Deepyan's email
>
> library(lattice)
> example(panel.levelplot.raster)
>
> works for me in 2.11.1
>
> Regards,
>
>     - Brian
>
>> sessionInfo()
> R version 2.11.1 (2010-05-31)
> x86_64-pc-linux-gnu
>
> locale:
>   [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
>   [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
>   [5] LC_MONETARY=C              LC_MESSAGES=en_US.UTF-8
>   [7] LC_PAPER=en_US.UTF-8       LC_NAME=C
>   [9] LC_ADDRESS=C               LC_TELEPHONE=C
> [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
>
> attached base packages:
> [1] grid      stats     graphics  grDevices utils     datasets  methods
> [8] base
>
> other attached packages:
> [1] lattice_0.19-11
>
> loaded via a namespace (and not attached):
> [1] tools_2.11.1
>
>

-- 
Dr Paul Murrell
Department of Statistics
The University of Auckland
Private Bag 92019
Auckland
New Zealand
64 9 3737599 x85392
paul at stat.auckland.ac.nz
http://www.stat.auckland.ac.nz/~paul/


From renaud.lancelot at gmail.com  Mon Oct  4 00:59:20 2010
From: renaud.lancelot at gmail.com (Renaud Lancelot)
Date: Mon, 4 Oct 2010 00:59:20 +0200
Subject: [Rd] Encoding problem in Rd file
In-Reply-To: <AANLkTinxdTL1NuZs-WjB+wE1Gbs3--FCsx5EGaXtRo+Z@mail.gmail.com>
References: <AANLkTim64+ZkrdnxwFQLtSr0zimDbt61a4L9afNGGwNO@mail.gmail.com>
	<4CA8B3F1.1080404@gmail.com>
	<AANLkTineG4qndYdykEZCzC49OpKt-5XGGACuQf71dkxe@mail.gmail.com>
	<4CA8BDFE.2070505@gmail.com>
	<AANLkTinxdTL1NuZs-WjB+wE1Gbs3--FCsx5EGaXtRo+Z@mail.gmail.com>
Message-ID: <AANLkTimM-Fq+_2ZSKdOe5DqO9WyD4f4fXFMCUUtSKR4t@mail.gmail.com>

I found the problem. It turned out that the coding system of the Rd
file (as defined under Emacs) was mistakenly set by me to a wrong
value. I had to define it as iso-latin-1, and then retype the
accentuated characters under this new system. Everything looks OK,
now. Sorry for bothering you.

2010/10/3 Renaud Lancelot <renaud.lancelot at gmail.com>:
> I see C:/R\R-2.11.1\share\texmf\Rd.sty which is my current R
> installation. By the way, there is no error during the compilation
> with
>
> ?R CMD Rd2dvi --no-clean dja.Rd
>
> So, it looks that the problem is located elsewhere...
>
> Thank you for your help.
>
> All the best,
>
> Renaud
>
> 2010/10/3 Duncan Murdoch <murdoch.duncan at gmail.com>:
>> On 03/10/2010 1:14 PM, Renaud Lancelot wrote:
>>>
>>> Thank you very much. My LaTeX installation is up to date (very
>>> recently updated with MIKTeK update facility).
>>> I have run R CMD Rd2dvi --no-clean dja.Rd and the result looks OK. I
>>> have put the resulting TeX file at
>>> http://filex.cirad.fr/get?k=K1cBpKr3UBUmdOJFMlx
>>>
>>> Do you have another suggestion?
>>
>> Not really, other than trying a LaTeX expert. ?When I run your file through
>> latex using
>>
>> R CMD latex Rd2.tex
>>
>> it compiles fine with no errors (only an "underfull hbox" warning).
>>
>> One thought: ?some people install copies of Rd.sty into their local tex
>> installation. ?If that version isn't compatible with the current macros
>> generated by R, you could have problems. ?You should see something like
>>
>> (F:/R/svn/r-devel/R/share/texmf/tex/latex\Rd.sty
>> Package: Rd
>>
>> in the Rd2.log file. ?If you see that it finds Rd.sty outside of the current
>> R version, delete the old file.
>>
>> Duncan Murdoch
>>
>>
>>>
>>> Renaud
>>>
>>> 2010/10/3 Duncan Murdoch <murdoch.duncan at gmail.com>:
>>>>
>>>> On 03/10/2010 12:23 PM, Renaud Lancelot wrote:
>>>>>
>>>>> Dear all,
>>>>>
>>>>> I have a problem with an Rd file containing French accentuated
>>>>> characters. I have uploaded the file at
>>>>> http://filex.cirad.fr/get?k=cjW7lImMaNC6Ci2vX0H
>>>>>
>>>>> I have declared
>>>>> Encoding: latin1
>>>>> in the package DESCRIPTION file
>>>>>
>>>>> and I have added
>>>>> \encoding{latin1}
>>>>> in the header of the Rd file.
>>>>>
>>>>> When I compile the package manual, I have LaTeX errors:
>>>>>
>>>>> ! Package inputenc Error: Unicode char \u8:?F not set up for use with
>>>>> LaTeX.
>>>>>
>>>>> See the inputenc package documentation for explanation.
>>>>> Type ?H <return> ?for immediate help.
>>>>> ?...
>>>>>
>>>>> l.579 ...ain. Aspects m??thodologiques.} Rev. ? ?F
>>>>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? aug??re, O., Dock??s,
>>>>> A.-C...
>>>>
>>>> R converts everything to UTF-8 and declares it that way for LaTeX. It
>>>> looks
>>>> as though your LaTeX installation isn't prepared to handle that, or
>>>> something has gone wrong in the conversion on your system. ?The letter
>>>> following "Rev. " above is a capital E with an acute accent, which is
>>>> encoded as C3 89 in UTF-8. ?Interpreted as Latin1, that looks like "?",
>>>> because the 89 is unprintable, but it shouldn't come out as "?F".
>>>>
>>>> I'd suggest updating your LaTeX inputenc package. ?If that doesn't work,
>>>> you
>>>> can see if the problem is in the conversion, by running
>>>>
>>>> R CMD Rd2dvi --no-clean dja.Rd
>>>>
>>>> and look in the Rd2.tex file that was produced.
>>>>
>>>> Duncan Murdoch
>>>>
>>>>> Your command was ignored.
>>>>> Type ?I <command> <return> ?to replace it with another command,
>>>>> or ?<return> ?to continue without it.
>>>>>
>>>>>
>>>>> ! Package inputenc Error: Unicode char \u8:?F not set up for use with
>>>>> LaTeX.
>>>>>
>>>>> See the inputenc package documentation for explanation.
>>>>> Type ?H <return> ?for immediate help.
>>>>> ?...
>>>>>
>>>>> l.581 ? ?F
>>>>> ? ? ? ? aug??re, O., Tillard, E., Faug??re, B., 1992. \emph{Prophylaxie
>>>>> ch...
>>>>>
>>>>> Your command was ignored.
>>>>> Type ?I <command> <return> ?to replace it with another command,
>>>>> or ?<return> ?to continue without it.
>>>>>
>>>>>
>>>>> ! Package inputenc Error: Unicode char \u8:?\end not set up for use with
>>>>> LaTeX.
>>>>>
>>>>>
>>>>> See the inputenc package documentation for explanation.
>>>>> Type ?H <return> ?for immediate help.
>>>>> ?...
>>>>>
>>>>> l.587 \end
>>>>> ? ? ? ? {References}
>>>>> Your command was ignored.
>>>>> Type ?I <command> <return> ?to replace it with another command,
>>>>> or ?<return> ?to continue without it.
>>>>>
>>>>> ***********
>>>>> I can easily find the offending lines using
>>>>> showNonASCII(readLines(file)). However, I don't know what to do to
>>>>> solve the problem. The strange thing (to me!) is that the pdf is
>>>>> actually built with appropriate accentuated characters, at least when
>>>>> I look at it with my pdf viewer (Acrobat reader).
>>>>>
>>>>> My config is:
>>>>>
>>>>>> sessionInfo()
>>>>>
>>>>> R version 2.11.1 Patched (2010-09-30 r53117)
>>>>> Platform: i386-pc-mingw32 (32-bit)
>>>>>
>>>>> locale:
>>>>> [1] LC_COLLATE=French_France.1252 ?LC_CTYPE=French_France.1252
>>>>> [3] LC_MONETARY=French_France.1252 LC_NUMERIC=C
>>>>> [5] LC_TIME=French_France.1252
>>>>>
>>>>> attached base packages:
>>>>> [1] tools ? ? stats ? ? graphics ?grDevices utils ? ? datasets ?methods
>>>>> [8] base
>>>>>
>>>>> other attached packages:
>>>>> [1] fortunes_1.4-0
>>>>>
>>>>>
>>>>>
>>>>>
>>>>
>>>
>>>
>>>
>>
>>
>
>
>
> --
> Renaud Lancelot
> EDEN Project, coordinator
> http://www.eden-fp6project.net/
>
> UMR CIRAD-INRA "Contr?le des maladies animales exotiques et ?mergentes"
> Joint research unit "Control of emerging and exotic animal diseases"
>
> CIRAD, Campus International de Baillarguet TA A-DIR / B
> F34398 Montpellier
> http://umr-cmaee.cirad.fr/
>
> Tel.? +33 4 67 59 37 17? -? Fax? +33 4 67 59 37 95
> Secr. +33 4 67 59 37 37? - Cell. +33 6 77 52 08 69
>



-- 
Renaud Lancelot
EDEN Project, coordinator
http://www.eden-fp6project.net/

UMR CIRAD-INRA "Contr?le des maladies animales exotiques et ?mergentes"
Joint research unit "Control of emerging and exotic animal diseases"

CIRAD, Campus International de Baillarguet TA A-DIR / B
F34398 Montpellier
http://umr-cmaee.cirad.fr/

Tel.? +33 4 67 59 37 17? -? Fax? +33 4 67 59 37 95
Secr. +33 4 67 59 37 37? - Cell. +33 6 77 52 08 69


From sgiannerini at gmail.com  Mon Oct  4 01:01:27 2010
From: sgiannerini at gmail.com (Simone Giannerini)
Date: Mon, 4 Oct 2010 01:01:27 +0200
Subject: [Rd] tabulate() does not check for input bounds
Message-ID: <AANLkTiknfbMgqMO18f47s1_skf_+fpp5_mrNV83QS5t9@mail.gmail.com>

Dear all,

it looks like that tabulate() does not check for the bounds of the input.
Reproducible example:

 > b <- 1:2
> tabulate(b[1:100])
[1] 1 1

> R.version
               _
platform       i386-pc-mingw32
arch           i386
os             mingw32
system         i386, mingw32
status         Patched
major          2
minor          11.1
year           2010
month          09
day            30
svn rev        53072
language       R
version.string R version 2.11.1 Patched (2010-09-30 r53072)

> sessionInfo()
R version 2.11.1 Patched (2010-09-30 r53072)
Platform: i386-pc-mingw32 (32-bit)

locale:
[1] LC_COLLATE=Italian_Italy.1252  LC_CTYPE=Italian_Italy.1252
LC_MONETARY=Italian_Italy.1252
[4] LC_NUMERIC=C                   LC_TIME=Italian_Italy.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] gtools_2.6.2

loaded via a namespace (and not attached):
[1] tools_2.11.1

OS: Windows 7 64 bit
--
______________________________________________________

Simone Giannerini
Dipartimento di Scienze Statistiche "Paolo Fortunati"
Universita' di Bologna
Via delle belle arti 41 - 40126? Bologna,? ITALY
Tel: +39 051 2098262? Fax: +39 051 232153
http://www2.stat.unibo.it/giannerini/


From olafm at statistik.tu-dortmund.de  Mon Oct  4 01:13:28 2010
From: olafm at statistik.tu-dortmund.de (Olaf Mersmann)
Date: Mon, 4 Oct 2010 01:13:28 +0200
Subject: [Rd] tabulate() does not check for input bounds
In-Reply-To: <AANLkTiknfbMgqMO18f47s1_skf_+fpp5_mrNV83QS5t9@mail.gmail.com>
References: <AANLkTiknfbMgqMO18f47s1_skf_+fpp5_mrNV83QS5t9@mail.gmail.com>
Message-ID: <477366AD-7E6B-4889-BA03-0A84859CFE91@statistik.tu-dortmund.de>

Dear Simone,

On 04.10.2010, at 01:01, Simone Giannerini wrote:
> it looks like that tabulate() does not check for the bounds of the input.
> Reproducible example:
> 
>> b <- 1:2
>> tabulate(b[1:100])
> [1] 1 1

this looks perfectly reasonable. Consider the result of 

> b <- 1:2
> b[1:100]
  [1]  1  2 NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
 [26] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
 [51] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
 [76] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA

and check the help page for tabulate (esp. the na.rm argument).

What was your expected result?

Cheers,
Olaf


From Troy.Robertson at aad.gov.au  Mon Oct  4 06:14:44 2010
From: Troy.Robertson at aad.gov.au (Troy Robertson)
Date: Mon, 4 Oct 2010 15:14:44 +1100
Subject: [Rd] S4 class help pages [Sec=Unclassified]
Message-ID: <42C7503E0B99F248B06BC65E7D2B4E020187DD7256F1@EX2K7-CCR.AAD.GOV.AU>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20101004/0c32d245/attachment.pl>

From Troy.Robertson at aad.gov.au  Mon Oct  4 06:37:53 2010
From: Troy.Robertson at aad.gov.au (Troy Robertson)
Date: Mon, 4 Oct 2010 15:37:53 +1100
Subject: [Rd] Recursion error after upgrade to R_2.11.1 [Sec=Unclassified]
Message-ID: <42C7503E0B99F248B06BC65E7D2B4E020187DD7256F9@EX2K7-CCR.AAD.GOV.AU>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20101004/3ecea002/attachment.pl>

From harold.petithomme at meteo.fr  Mon Oct  4 12:49:18 2010
From: harold.petithomme at meteo.fr (Harold Petithomme)
Date: Mon, 04 Oct 2010 12:49:18 +0200
Subject: [Rd] Unexplained strange behaviour of callNextMethod in S4 methods
In-Reply-To: <cpnk4m8muyp.fsf@gmail.com>
References: <4C9B6257.8070500@meteo.fr> <cpnk4m8muyp.fsf@gmail.com>
Message-ID: <4CA9B12E.6000902@meteo.fr>

Hello all.

A few days ago, I submitted a problem which remains unsolved although 
somebody answered to my question. I still have the problem. Can someone 
please explain if something is wrong ?

Have a look at this example:

setGeneric("f",valueClass="NULL",def=function(x) standardGeneric("f"))

setMethod("f",signature(x="A"),def=function(x)
{
    a = x at a
    cat("nombre :",a,"\n")
}
)

setMethod("f",signature(x="B"),def=function(x)
{
    cat("mot :",x at b,"\n")
    callNextMethod()
}
)

a = new("A",a=1)
b = new("B",b="hello",a)

f(a)
f(b)

This last command (f(b)) fails. But remove the 'valueClass="NULL"' 
setting in setGeneric or add argument x to the call to callNextMethod 
and it will be OK! Isn't it tricky?

Thanks in advance for any help.

Harold

-- 
*********************************************************
Harold PETITHOMME
Equipe Donn?es et Outils de Pr?vision (DPREVI/COMPAS/DOP)

M?t?o France - Direction de la Production
42, avenue G. Coriolis.
31057 Toulouse Cedex
France

Tel : (33/0)5.61.07.82.85
Fax : (33/0)5.61.07.86.09
E-mail : harold.petithomme at meteo.fr


From murdoch.duncan at gmail.com  Mon Oct  4 14:08:40 2010
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Mon, 04 Oct 2010 08:08:40 -0400
Subject: [Rd] S4 class help pages [Sec=Unclassified]
In-Reply-To: <42C7503E0B99F248B06BC65E7D2B4E020187DD7256F1@EX2K7-CCR.AAD.GOV.AU>
References: <42C7503E0B99F248B06BC65E7D2B4E020187DD7256F1@EX2K7-CCR.AAD.GOV.AU>
Message-ID: <4CA9C3C8.2090208@gmail.com>

  On 04/10/2010 12:14 AM, Troy Robertson wrote:
> Hi,
>
> I am working on producing an R package containing mostly S4 classes and methods.
> I have generated and filled out all the necessary .Rd files but find that once installed I am unable to access help pages for the classes using the ?package::classname-class syntax that is suggested when using the ?? apropos search.  This lists my package classes and the class help pages.  Instead, the "Arithmetic Operators" help page is always loaded.  I can load the pages I want via links like \linkS4class{classname} in my package help page.
>
> I have played with a couple of other packages and see the same problem.  Is there a different syntax to access these S4 class help pages rather than ?package::classname-class?

The problem is the parsing:  that is parsed as `?`(stats4::mle - class), 
i.e. there's a subtraction there, not a name with a hyphen in it.  So 
you're seeing help on subtraction.

You can get what you want with class?stats4::mle.

I'll see if I can fix the advice from ??.

Duncan Murdoch

> Thanks
>
> Troy
>
>
> ___________________________________________________________________________
>
>      Australian Antarctic Division - Commonwealth of Australia
> IMPORTANT: This transmission is intended for the addressee only. If you are not the
> intended recipient, you are notified that use or dissemination of this communication is
> strictly prohibited by Commonwealth law. If you have received this transmission in error,
> please notify the sender immediately by e-mail or by telephoning +61 3 6232 3209 and
> DELETE the message.
>          Visit our web site at http://www.antarctica.gov.au/
> ___________________________________________________________________________
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From sgiannerini at gmail.com  Mon Oct  4 14:50:51 2010
From: sgiannerini at gmail.com (Simone Giannerini)
Date: Mon, 4 Oct 2010 14:50:51 +0200
Subject: [Rd] tabulate() does not check for input bounds
In-Reply-To: <477366AD-7E6B-4889-BA03-0A84859CFE91@statistik.tu-dortmund.de>
References: <AANLkTiknfbMgqMO18f47s1_skf_+fpp5_mrNV83QS5t9@mail.gmail.com>
	<477366AD-7E6B-4889-BA03-0A84859CFE91@statistik.tu-dortmund.de>
Message-ID: <AANLkTimBf=dK1kRATU25=Rk6fBQvc-QBaa=eBLvva6hj@mail.gmail.com>

Dear Olaf,

thanks for your reply, at first sight I did not link this behaviour to
that subsetting feature that I must admit I am not used to.

Ciao

Simone



On Mon, Oct 4, 2010 at 1:13 AM, Olaf Mersmann
<olafm at statistik.tu-dortmund.de> wrote:
> Dear Simone,
>
> On 04.10.2010, at 01:01, Simone Giannerini wrote:
>> it looks like that tabulate() does not check for the bounds of the input.
>> Reproducible example:
>>
>>> b <- 1:2
>>> tabulate(b[1:100])
>> [1] 1 1
>
> this looks perfectly reasonable. Consider the result of
>
>> b <- 1:2
>> b[1:100]
> ?[1] ?1 ?2 NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
> ?[26] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
> ?[51] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
> ?[76] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
>
> and check the help page for tabulate (esp. the na.rm argument).
>
> What was your expected result?
>
> Cheers,
> Olaf
>
>



-- 
______________________________________________________

Simone Giannerini
Dipartimento di Scienze Statistiche "Paolo Fortunati"
Universita' di Bologna
Via delle belle arti 41 - 40126? Bologna,? ITALY
Tel: +39 051 2098262? Fax: +39 051 232153
http://www2.stat.unibo.it/giannerini/


From it-r-devel at ml.epigenomics.com  Mon Oct  4 14:50:57 2010
From: it-r-devel at ml.epigenomics.com (it-r-devel at ml.epigenomics.com)
Date: Mon, 04 Oct 2010 14:50:57 +0200
Subject: [Rd] R 2.12.0 beta (r53110) fails make check on Ubuntu hardy
Message-ID: <i8cijh$s9u$1@perl.epigenomics.epi>


Hi!

we observe a failing make check for reg-tests-1b.R with r53110 and since at least r53056
with the failing lines being

[...]
> ## found from fallback test in slam 0.1-15
> x <- matrix(c(1, 0, NA, 1), 2, 2)
> y <- matrix(c(1, 0, 0, 2, 1, 0), 3, 2)
> (z <- tcrossprod(x, y))
     [,1] [,2] [,3]
[1,]   NA   NA    0
[2,]    2    1    0
> stopifnot(identical(z, x %*% t(y)))
Error: identical(z, x %*% t(y)) is not TRUE
Execution halted


In a fresh R session the results are
x %*% t(y)
     [,1] [,2] [,3]
[1,]   NA   NA   NA
[2,]    2    1    0

(z <- tcrossprod(x, y))
     [,1] [,2] [,3]
[1,]   NA   NA    0
[2,]    2    1    0

Regards,

  Matthias



System:
Ubuntu 8.05 hardy heron

uname -a
Linux bednorz 2.6.27.10-p4-server #1 SMP Fri Jan 9 10:03:30 CET 2009 i686 GNU/Linux

gcc --version
gcc (GCC) 4.2.4 (Ubuntu 4.2.4-1ubuntu4)


Complete log reg-tests-1b.Rout.fail attached.

configure ares used:
 --prefix=/mnt/local/R/hardy/R-2.12.0-rc_101001r53110 --enable-R-profiling=yes
--enable-R-shlib=yes --enable-BLAS-shlib=yes --with-blas=yes --with-lapack=no
--with-readline=yes --with-tcltk=/usr/include/tcl8.4
--with-tcl-config=/usr/lib/tcl8.4/tclConfig.sh --with-tk-config=/usr/lib/tk8.4/tkConfig.sh
--enable-shared=yes --enable-prebuilt-html --with-pic=yes --with-x=yes --with-cairo=yes
--with-recommended-packages=yes  --with-libpng=yes --with-jpeglib=yes
--with-system-zlib=yes --with-system-bzlib=yes  --with-system-pcre=no
--with-valgrind-instrumentation=2 --enable-memory-profiling=yes

configure output:

R is now configured for i686-pc-linux-gnu

  Source directory:          .
  Installation directory:    /mnt/local/R/hardy/R-2.12.0-rc_101001r53110

  C compiler:                /usr/bin/gcc-4.2 -std=gnu99  -g -O2
  Fortran 77 compiler:       /usr/bin/gfortran-4.2  -g -O2

  C++ compiler:              /usr/bin/g++-4.2  -g -O2
  Fortran 90/95 compiler:    /usr/bin/gfortran-4.2 -g -O2
  Obj-C compiler:	     /usr/bin/gcc-4.2 -g -O2

  Interfaces supported:      X11, tcltk
  External libraries:        readline, BLAS(generic), ICU
  Additional capabilities:   PNG, JPEG, TIFF, NLS, cairo
  Options enabled:           shared R library, shared BLAS, R profiling, memory profiling,
Java, static HTML

  Recommended packages:      yes


-- 
Matthias Burger                        Project Manager, Assay Transfer
Epigenomics AG     Kleine Praesidentenstr. 1     10178 Berlin, Germany
phone:+49-30-24345-0                              fax:+49-30-24345-555
http://www.epigenomics.com             matthias.burger at epigenomics.com
--
Epigenomics AG Berlin             Amtsgericht Charlottenburg HRB 75861
Vorstand:                             Geert Nygaard (CEO/Vorsitzender)
                                              Oliver Schacht PhD (CFO)
Aufsichtsrat:     Prof. Dr. Dr. hc. Rolf Krebs (Chairman/Vorsitzender)
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: reg-tests-1b.Rout.fail
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20101004/5eb93025/attachment.pl>

From ripley at stats.ox.ac.uk  Mon Oct  4 15:17:44 2010
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 4 Oct 2010 14:17:44 +0100 (BST)
Subject: [Rd] R 2.12.0 beta (r53110) fails make check on Ubuntu hardy
In-Reply-To: <i8cijh$s9u$1@perl.epigenomics.epi>
References: <i8cijh$s9u$1@perl.epigenomics.epi>
Message-ID: <alpine.LFD.2.00.1010041415540.4507@gannet.stats.ox.ac.uk>

So your system has a broken BLAS and you need to use the builtin one.

On Mon, 4 Oct 2010, it-r-devel at ml.epigenomics.com wrote:
>
> Hi!
>
> we observe a failing make check for reg-tests-1b.R with r53110 and since at least r53056
> with the failing lines being
>
> [...]
>> ## found from fallback test in slam 0.1-15
>> x <- matrix(c(1, 0, NA, 1), 2, 2)
>> y <- matrix(c(1, 0, 0, 2, 1, 0), 3, 2)
>> (z <- tcrossprod(x, y))
>     [,1] [,2] [,3]
> [1,]   NA   NA    0
> [2,]    2    1    0
>> stopifnot(identical(z, x %*% t(y)))
> Error: identical(z, x %*% t(y)) is not TRUE
> Execution halted
>
>
> In a fresh R session the results are
> x %*% t(y)
>     [,1] [,2] [,3]
> [1,]   NA   NA   NA
> [2,]    2    1    0
>
> (z <- tcrossprod(x, y))
>     [,1] [,2] [,3]
> [1,]   NA   NA    0
> [2,]    2    1    0
>
> Regards,
>
>  Matthias
>
>
>
> System:
> Ubuntu 8.05 hardy heron
>
> uname -a
> Linux bednorz 2.6.27.10-p4-server #1 SMP Fri Jan 9 10:03:30 CET 2009 i686 GNU/Linux
>
> gcc --version
> gcc (GCC) 4.2.4 (Ubuntu 4.2.4-1ubuntu4)
>
>
> Complete log reg-tests-1b.Rout.fail attached.
>
> configure ares used:
> --prefix=/mnt/local/R/hardy/R-2.12.0-rc_101001r53110 --enable-R-profiling=yes
> --enable-R-shlib=yes --enable-BLAS-shlib=yes --with-blas=yes --with-lapack=no
> --with-readline=yes --with-tcltk=/usr/include/tcl8.4
> --with-tcl-config=/usr/lib/tcl8.4/tclConfig.sh --with-tk-config=/usr/lib/tk8.4/tkConfig.sh
> --enable-shared=yes --enable-prebuilt-html --with-pic=yes --with-x=yes --with-cairo=yes
> --with-recommended-packages=yes  --with-libpng=yes --with-jpeglib=yes
> --with-system-zlib=yes --with-system-bzlib=yes  --with-system-pcre=no
> --with-valgrind-instrumentation=2 --enable-memory-profiling=yes
>
> configure output:
>
> R is now configured for i686-pc-linux-gnu
>
>  Source directory:          .
>  Installation directory:    /mnt/local/R/hardy/R-2.12.0-rc_101001r53110
>
>  C compiler:                /usr/bin/gcc-4.2 -std=gnu99  -g -O2
>  Fortran 77 compiler:       /usr/bin/gfortran-4.2  -g -O2
>
>  C++ compiler:              /usr/bin/g++-4.2  -g -O2
>  Fortran 90/95 compiler:    /usr/bin/gfortran-4.2 -g -O2
>  Obj-C compiler:	     /usr/bin/gcc-4.2 -g -O2
>
>  Interfaces supported:      X11, tcltk
>  External libraries:        readline, BLAS(generic), ICU
>  Additional capabilities:   PNG, JPEG, TIFF, NLS, cairo
>  Options enabled:           shared R library, shared BLAS, R profiling, memory profiling,
> Java, static HTML
>
>  Recommended packages:      yes
>
>
> -- 
> Matthias Burger                        Project Manager, Assay Transfer
> Epigenomics AG     Kleine Praesidentenstr. 1     10178 Berlin, Germany
> phone:+49-30-24345-0                              fax:+49-30-24345-555
> http://www.epigenomics.com             matthias.burger at epigenomics.com
> --
> Epigenomics AG Berlin             Amtsgericht Charlottenburg HRB 75861
> Vorstand:                             Geert Nygaard (CEO/Vorsitzender)
>                                              Oliver Schacht PhD (CFO)
> Aufsichtsrat:     Prof. Dr. Dr. hc. Rolf Krebs (Chairman/Vorsitzender)
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From it-r-devel at ml.epigenomics.com  Mon Oct  4 17:19:51 2010
From: it-r-devel at ml.epigenomics.com (it-r-devel at ml.epigenomics.com)
Date: Mon, 04 Oct 2010 17:19:51 +0200
Subject: [Rd] R 2.12.0 beta (r53110) fails make check on Ubuntu hardy
In-Reply-To: <alpine.LFD.2.00.1010041415540.4507@gannet.stats.ox.ac.uk>
References: <i8cijh$s9u$1@perl.epigenomics.epi>
	<alpine.LFD.2.00.1010041415540.4507@gannet.stats.ox.ac.uk>
Message-ID: <i8cran$be2$1@perl.epigenomics.epi>


Thanks for the quick answer. We will use the builtin BLAS then.

  Matthias

Prof Brian Ripley wrote, On 10/04/10 15:17:
> So your system has a broken BLAS and you need to use the builtin one.
> 
> On Mon, 4 Oct 2010, it-r-devel at ml.epigenomics.com wrote:
>>
>> Hi!
[...]

-- 
Matthias Burger                        Project Manager, Assay Transfer
Epigenomics AG     Kleine Praesidentenstr. 1     10178 Berlin, Germany
phone:+49-30-24345-0                              fax:+49-30-24345-555
http://www.epigenomics.com             matthias.burger at epigenomics.com
--
Epigenomics AG Berlin             Amtsgericht Charlottenburg HRB 75861
Vorstand:                             Geert Nygaard (CEO/Vorsitzender)
                                              Oliver Schacht PhD (CFO)
Aufsichtsrat:     Prof. Dr. Dr. hc. Rolf Krebs (Chairman/Vorsitzender)


From Troy.Robertson at aad.gov.au  Tue Oct  5 00:30:12 2010
From: Troy.Robertson at aad.gov.au (Troy Robertson)
Date: Tue, 5 Oct 2010 09:30:12 +1100
Subject: [Rd] S4 class help pages [Sec=Unclassified]
In-Reply-To: <4CA9C3C8.2090208@gmail.com>
Message-ID: <42C7503E0B99F248B06BC65E7D2B4E020187DD72573F@EX2K7-CCR.AAD.GOV.AU>

> -----Original Message-----
> From: Duncan Murdoch [mailto:murdoch.duncan at gmail.com]
> Sent: Monday, 4 October 2010 11:09 PM
> To: Troy Robertson
> Cc: 'r-devel at R-project.org'
> Subject: Re: [Rd] S4 class help pages [Sec=Unclassified]
>
>
>   On 04/10/2010 12:14 AM, Troy Robertson wrote:
> > Hi,
> >
> > I am working on producing an R package containing mostly S4 classes
> > and methods. I have generated and filled out all the necessary .Rd
> > files but find that once installed I am unable to access help pages
> > for the classes using the ?package::classname-class syntax that is
> > suggested when using the ?? apropos search.  This lists my package
> > classes and the class help pages.  Instead, the "Arithmetic
> Operators"
> > help page is always loaded.  I can load the pages I want via links
> > like \linkS4class{classname} in my package help page.
> >
> > I have played with a couple of other packages and see the same
> > problem.  Is there a different syntax to access these S4 class help
> > pages rather than ?package::classname-class?
>
> The problem is the parsing:  that is parsed as
> `?`(stats4::mle - class), i.e. there's a subtraction there,
> not a name with a hyphen in it.  So you're seeing help on subtraction.
>
> You can get what you want with class?stats4::mle.
>
> I'll see if I can fix the advice from ??.
>
> Duncan Murdoch
>
> > Thanks
> >
> > Troy

Cheers Duncan,

Both your suggestions do the trick.
i.e. class?stats4::mle and ?stats4::`mle-class`

Troy
___________________________________________________________________________

    Australian Antarctic Division - Commonwealth of Australia
IMPORTANT: This transmission is intended for the addressee only. If you are not the
intended recipient, you are notified that use or dissemination of this communication is
strictly prohibited by Commonwealth law. If you have received this transmission in error,
please notify the sender immediately by e-mail or by telephoning +61 3 6232 3209 and
DELETE the message.
        Visit our web site at http://www.antarctica.gov.au/
___________________________________________________________________________


From Troy.Robertson at aad.gov.au  Tue Oct  5 01:25:21 2010
From: Troy.Robertson at aad.gov.au (Troy Robertson)
Date: Tue, 5 Oct 2010 10:25:21 +1100
Subject: [Rd] Recursion error after upgrade to R_2.11.1 [Sec=Unclassified]
Message-ID: <42C7503E0B99F248B06BC65E7D2B4E020187DD72574D@EX2K7-CCR.AAD.GOV.AU>

Resending this in plain text, after realising the html text hadn't been posted (oops).

Hi all,

After an upgrade from R_2.10.1 to R_2.11.1 I am now getting the following error:
Error: evaluation nested too deeply: infinite recursion / options(expressions=)?

This occurs in the initialize method of S4 classes where I was initialising attributes eg:
.Object[['realtimeState']] <- list()

I can mostly avoid this new error by altering the code to do:
.Object$realtimeState <- list() OR .Object at .xData$realtimeState <- list()

But there are also times when I need to do .Object[realtimeState] <- list(NULL) in order to specifically set it to NULL (rather than have it removed) which I think is also causing me grief.

My classes all extend .environment and store all non-static data as per above (in environment .xData slot) rather than in normal class slots because I am able to achieve much quicker execution times without all the copy-on-change cost that results from passing these objects containing large amounts of slot-based data.


Can anyone provide a reason for the changes that have brought about the recursion issue?

Is there a better way to achieve the pass-by-reference style objects I am after?


Thanks

Troy

___________________________________________________________________________

    Australian Antarctic Division - Commonwealth of Australia
IMPORTANT: This transmission is intended for the addressee only. If you are not the
intended recipient, you are notified that use or dissemination of this communication is
strictly prohibited by Commonwealth law. If you have received this transmission in error,
please notify the sender immediately by e-mail or by telephoning +61 3 6232 3209 and
DELETE the message.
        Visit our web site at http://www.antarctica.gov.au/
___________________________________________________________________________


From wukefe at gmail.com  Tue Oct  5 03:15:33 2010
From: wukefe at gmail.com (=?GB2312?B?s8K6rbfm?=)
Date: Tue, 5 Oct 2010 09:15:33 +0800
Subject: [Rd] Fwd: Hello
In-Reply-To: <AANLkTinz3buM+H5UOBTdiDuqYqvJct1zZV36fJDyRQts@mail.gmail.com>
References: <AANLkTinz3buM+H5UOBTdiDuqYqvJct1zZV36fJDyRQts@mail.gmail.com>
Message-ID: <AANLkTi=y=_GnCLYwfmR6dURHFwCQCpN1rgHzsxACxk=O@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20101005/330ce144/attachment.pl>

From ripley at stats.ox.ac.uk  Tue Oct  5 08:09:28 2010
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 5 Oct 2010 07:09:28 +0100 (BST)
Subject: [Rd] History of seq and seq.int
In-Reply-To: <20100930031557.GA2782@cs.toronto.edu>
References: <20100930031557.GA2782@cs.toronto.edu>
Message-ID: <alpine.LFD.2.00.1010040939240.3847@gannet.stats.ox.ac.uk>

The history is open for all to see. E.g. from the NEWS file (ONEWS in 
pre-2.12.0) entry for R 2.4.0

     o	There is a new primitive seq.int() which is slightly more
 	restricted than seq() but often very much faster, and new
 	primitives seq_along() and seq_len() which are faster still.

It isn't just complex values: seq.default() dispatches on methods for 
e.g. arithmetic so is potentially quite a lot more general.  And if 
you look back, seq() was in R 'for ever' as an interpreted generic 
function -- its peculiarities are taken from blue-book S (although not 
necessarily documented there).

We provide faster versions for use where needed -- but it is rather 
rare that seq() takes up more than a tiny proportion of the run time 
of an R task (and we do provide tools to find out).  Those faster 
versions are used in R's own code where suitable (and as I discovered 
recently, in a couple of places where not).

On Wed, 29 Sep 2010, Radford Neal wrote:

> I wonder what is the history of "seq" and "seq.int"?
>
>> From "help(seq)", one reads that "'seq.int' is an internal generic
> which can be much faster but has a few restrictions".  And indeed,
> "seq.int(1,99,by=2)" is over 40 times faster than "seq(1,99,by=2)" in
> a quick test I just did.  This is not surprising given that "seq" is
> written in R whereas "seq.int" is a primitive written in C.  The only
> documented restriction on "seq.int" that I can see is that it won't
> produce complex-valued sequences.
>
> It would be nice if the 40-times-faster version could replace the slow
> version, if it can be made to do the same thing.  But is there some
> reason I don't see that this makes this hard?  Was the C version the
> original, and then someone decided that complex number support was
> essential, and most easily obtained by translating it to R?  (The R
> code and C code are very parallel, so there was certainly a
> translation rather a rewrite one way or the other.)  Or was the
> original in R, and someone rewrote it in C for speed, but stopped just
> short of being able to replace the R version with the C version
> because they didn't implement complex-valued sequences?  Or is there
> some other feature that's missing from seq.int?

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From cbeleites at units.it  Tue Oct  5 11:38:31 2010
From: cbeleites at units.it (Claudia Beleites)
Date: Tue, 05 Oct 2010 11:38:31 +0200
Subject: [Rd] SweaveInput + keep.source = TRUE trouble
Message-ID: <4CAAF217.6090200@units.it>

Dear all,

I have trouble with R-beta sweaving files that include definitions with
\SweaveInput in combination with keep.source = TRUE

Symptom:
SInput is taken from too far down the input file (the shift is the number of
lines of the included file). Is that known? Searching didn't turn up anything, 
yet I think there are more people than just me using keep.source.

Example:
$ ~/tmp/R-beta/bin/R CMD Sweave baseline.Rnw &&
mv baseline.tex baseline.devel.tex &&
R CMD Sweave baseline.Rnw &&
mv baseline.tex baseline.2.11.tex &&
diff -u baseline.2.11.tex baseline.devel.tex

gives:
--- baseline.2.11.tex	2010-10-05 11:33:49.000000000 +0200
+++ baseline.devel.tex	2010-10-05 11:33:49.000000000 +0200
@@ -83,7 +83,7 @@
  \verb+\SweaveOpts{keep.source = TRUE}+
  \begin{Schunk}
  \begin{Sinput}
-> 12
+> line 54
  \end{Sinput}
  \begin{Soutput}
  [1] 12
@@ -106,7 +106,7 @@
  line 63 chunk option keep.source = TRUE
  \begin{Schunk}
  \begin{Sinput}
-> 14
+> line 67
  \end{Sinput}
  \begin{Soutput}
  [1] 14

I used yesterday's R-beta, and my system is Ubuntu 9.10 64 bit (though that 
probably doesn't matter).

Building the example file I also found that \SweaveInput{} cannot be followed by 
anything else on the line(not even a LaTeX comment).

\SweaveInput{x}y
complains that file xy is not found.

Best regards,

Claudia Beleites

-- 
Claudia Beleites
Dipartimento dei Materiali e delle Risorse Naturali
Universit? degli Studi di Trieste
Via Alfonso Valerio 6/a
I-34127 Trieste

phone: +39 0 40 5 58-37 68
email: cbeleites at units.it

-------------- next part --------------
A non-text attachment was scrubbed...
Name: baseline.devel.pdf
Type: application/pdf
Size: 52300 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20101005/1fce35b4/attachment.pdf>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: baseline.2.11.tex
Type: text/x-tex
Size: 1768 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20101005/1fce35b4/attachment.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: baseline.devel.tex
Type: text/x-tex
Size: 1779 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20101005/1fce35b4/attachment-0001.bin>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: baseline.Rnw
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20101005/1fce35b4/attachment.pl>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: vignettes.defs
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20101005/1fce35b4/attachment-0001.pl>

From cbeleites at units.it  Tue Oct  5 11:45:22 2010
From: cbeleites at units.it (Claudia Beleites)
Date: Tue, 05 Oct 2010 11:45:22 +0200
Subject: [Rd] SweaveInput + keep.source = TRUE trouble
In-Reply-To: <4CAAF217.6090200@units.it>
References: <4CAAF217.6090200@units.it>
Message-ID: <4CAAF3B2.6020307@units.it>

Sorry, I forgot the sessionInfos:

devel:
R version 2.12.0 beta (2010-10-03 r53154)
Platform: x86_64-unknown-linux-gnu (64-bit)

locale:
  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
  [5] LC_MONETARY=C              LC_MESSAGES=en_US.UTF-8
  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C
  [9] LC_ADDRESS=C               LC_TELEPHONE=C
[11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

2.11:
R version 2.11.1 (2010-05-31)
x86_64-pc-linux-gnu

locale:
  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
  [5] LC_MONETARY=C              LC_MESSAGES=en_US.UTF-8
  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C
  [9] LC_ADDRESS=C               LC_TELEPHONE=C
[11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base


Claudia Beleites wrote:
> Dear all,
> 
> I have trouble with R-beta sweaving files that include definitions with
> \SweaveInput in combination with keep.source = TRUE
> 
> Symptom:
> SInput is taken from too far down the input file (the shift is the 
> number of
> lines of the included file). Is that known? Searching didn't turn up 
> anything, yet I think there are more people than just me using keep.source.
> 
> Example:
> $ ~/tmp/R-beta/bin/R CMD Sweave baseline.Rnw &&
> mv baseline.tex baseline.devel.tex &&
> R CMD Sweave baseline.Rnw &&
> mv baseline.tex baseline.2.11.tex &&
> diff -u baseline.2.11.tex baseline.devel.tex
> 
> gives:
> --- baseline.2.11.tex    2010-10-05 11:33:49.000000000 +0200
> +++ baseline.devel.tex    2010-10-05 11:33:49.000000000 +0200
> @@ -83,7 +83,7 @@
>  \verb+\SweaveOpts{keep.source = TRUE}+
>  \begin{Schunk}
>  \begin{Sinput}
> -> 12
> +> line 54
>  \end{Sinput}
>  \begin{Soutput}
>  [1] 12
> @@ -106,7 +106,7 @@
>  line 63 chunk option keep.source = TRUE
>  \begin{Schunk}
>  \begin{Sinput}
> -> 14
> +> line 67
>  \end{Sinput}
>  \begin{Soutput}
>  [1] 14
> 
> I used yesterday's R-beta, and my system is Ubuntu 9.10 64 bit (though 
> that probably doesn't matter).
> 
> Building the example file I also found that \SweaveInput{} cannot be 
> followed by anything else on the line(not even a LaTeX comment).
> 
> \SweaveInput{x}y
> complains that file xy is not found.
> 
> Best regards,
> 
> Claudia Beleites
> 
> 
> ------------------------------------------------------------------------
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


-- 
Claudia Beleites
Dipartimento dei Materiali e delle Risorse Naturali
Universit? degli Studi di Trieste
Via Alfonso Valerio 6/a
I-34127 Trieste

phone: +39 0 40 5 58-37 68
email: cbeleites at units.it


From murdoch.duncan at gmail.com  Tue Oct  5 13:16:52 2010
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Tue, 05 Oct 2010 07:16:52 -0400
Subject: [Rd] SweaveInput + keep.source = TRUE trouble
In-Reply-To: <4CAAF217.6090200@units.it>
References: <4CAAF217.6090200@units.it>
Message-ID: <4CAB0924.8030309@gmail.com>

On 05/10/2010 5:38 AM, Claudia Beleites wrote:
> Dear all,
> 
> I have trouble with R-beta sweaving files that include definitions with
> \SweaveInput in combination with keep.source = TRUE

Thanks for the report.  I'll take a look.

Duncan Murdoch

> 
> Symptom:
> SInput is taken from too far down the input file (the shift is the number of
> lines of the included file). Is that known? Searching didn't turn up anything, 
> yet I think there are more people than just me using keep.source.
> 
> Example:
> $ ~/tmp/R-beta/bin/R CMD Sweave baseline.Rnw &&
> mv baseline.tex baseline.devel.tex &&
> R CMD Sweave baseline.Rnw &&
> mv baseline.tex baseline.2.11.tex &&
> diff -u baseline.2.11.tex baseline.devel.tex
> 
> gives:
> --- baseline.2.11.tex	2010-10-05 11:33:49.000000000 +0200
> +++ baseline.devel.tex	2010-10-05 11:33:49.000000000 +0200
> @@ -83,7 +83,7 @@
>   \verb+\SweaveOpts{keep.source = TRUE}+
>   \begin{Schunk}
>   \begin{Sinput}
> -> 12
> +> line 54
>   \end{Sinput}
>   \begin{Soutput}
>   [1] 12
> @@ -106,7 +106,7 @@
>   line 63 chunk option keep.source = TRUE
>   \begin{Schunk}
>   \begin{Sinput}
> -> 14
> +> line 67
>   \end{Sinput}
>   \begin{Soutput}
>   [1] 14
> 
> I used yesterday's R-beta, and my system is Ubuntu 9.10 64 bit (though that 
> probably doesn't matter).
> 
> Building the example file I also found that \SweaveInput{} cannot be followed by 
> anything else on the line(not even a LaTeX comment).
> 
> \SweaveInput{x}y
> complains that file xy is not found.
> 
> Best regards,
> 
> Claudia Beleites
> 
> 
> 
> ------------------------------------------------------------------------
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From renaud at mancala.cbio.uct.ac.za  Tue Oct  5 14:34:43 2010
From: renaud at mancala.cbio.uct.ac.za (Renaud Gaujoux)
Date: Tue, 05 Oct 2010 14:34:43 +0200
Subject: [Rd] library: loading of required packages and argument 'lib.loc'
Message-ID: <4CAB1B63.3040607@cbio.uct.ac.za>

Hi,

is there a reason why when calling the argument 'lib.loc' of library() 
is not used when trying to load the required packages?

0. Package A depends on package B
1. Install packages A and B in a subdirectory 'lib' of the current directory
2. Call:

library(A, lib.loc='./lib')

This will give something like the following:

Loading required package: B
Error: package 'B' could not be loaded
In addition: Warning message:
In library(pkg, character.only = TRUE, logical.return = TRUE, lib.loc = 
lib.loc) :
   there is no package called 'B'

In function library there the call '.getRequiredPackages2(pkgInfo)' 
loads the required packages but do not pass the argument lib.loc 
(whereas .getRequiredPackages2 has an argument for this).
I know a quick work around for this is to put './lib' into .libPaths but 
it would be nice if library() could do it locally (e.g. pass the 
argument), without changing the global settings.

Thanks,
Renaud


 

###
UNIVERSITY OF CAPE TOWN 

This e-mail is subject to the UCT ICT policies and e-mail disclaimer published on our website at http://www.uct.ac.za/about/policies/emaildisclaimer/ or obtainable from +27 21 650 4500. This e-mail is intended only for the person(s) to whom it is addressed. If the e-mail has reached you in error, please notify the author. If you are not the intended recipient of the e-mail you may not use, disclose, copy, redirect or print the content. If this e-mail is not related to the business of UCT it is sent by the sender in the sender's individual capacity.

###


From murdoch.duncan at gmail.com  Tue Oct  5 16:54:52 2010
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Tue, 05 Oct 2010 10:54:52 -0400
Subject: [Rd] SweaveInput + keep.source = TRUE trouble
In-Reply-To: <4CAAF217.6090200@units.it>
References: <4CAAF217.6090200@units.it>
Message-ID: <4CAB3C3C.9070101@gmail.com>

  This is fixed now in R-devel and the beta version.  The fix isn't 
perfect:  if you use \SweaveInput, you lose the error reporting that 
gives line numbers from the original file.  It should be possible to 
have both, but I think the changes to implement that are too large to 
consider in a beta.

Duncan Murdoch

On 05/10/2010 5:38 AM, Claudia Beleites wrote:
> Dear all,
>
> I have trouble with R-beta sweaving files that include definitions with
> \SweaveInput in combination with keep.source = TRUE
>
> Symptom:
> SInput is taken from too far down the input file (the shift is the number of
> lines of the included file). Is that known? Searching didn't turn up anything,
> yet I think there are more people than just me using keep.source.
>
> Example:
> $ ~/tmp/R-beta/bin/R CMD Sweave baseline.Rnw&&
> mv baseline.tex baseline.devel.tex&&
> R CMD Sweave baseline.Rnw&&
> mv baseline.tex baseline.2.11.tex&&
> diff -u baseline.2.11.tex baseline.devel.tex
>
> gives:
> --- baseline.2.11.tex	2010-10-05 11:33:49.000000000 +0200
> +++ baseline.devel.tex	2010-10-05 11:33:49.000000000 +0200
> @@ -83,7 +83,7 @@
>    \verb+\SweaveOpts{keep.source = TRUE}+
>    \begin{Schunk}
>    \begin{Sinput}
> ->  12
> +>  line 54
>    \end{Sinput}
>    \begin{Soutput}
>    [1] 12
> @@ -106,7 +106,7 @@
>    line 63 chunk option keep.source = TRUE
>    \begin{Schunk}
>    \begin{Sinput}
> ->  14
> +>  line 67
>    \end{Sinput}
>    \begin{Soutput}
>    [1] 14
>
> I used yesterday's R-beta, and my system is Ubuntu 9.10 64 bit (though that
> probably doesn't matter).
>
> Building the example file I also found that \SweaveInput{} cannot be followed by
> anything else on the line(not even a LaTeX comment).
>
> \SweaveInput{x}y
> complains that file xy is not found.
>
> Best regards,
>
> Claudia Beleites
>
>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From vqnguyen at uci.edu  Wed Oct  6 00:41:59 2010
From: vqnguyen at uci.edu (Vinh Nguyen)
Date: Tue, 5 Oct 2010 15:41:59 -0700
Subject: [Rd] args() and body() equivalents for S4 methods?
Message-ID: <AANLkTinoqP9U=5-PEEP67FfQXUHxErnx5ptXZKQLFcni@mail.gmail.com>

Dear list,

Suppose some methods were defined for a generic function genF(fitobj,
...).  Suppose one has signature(fitobj="lm") and
signature(fitobj="glm").  The ... piece of each method could have
different arguments.  I'm aware of getMethod("genF", "lm") to get the
function definition but are there equivalents to the args() and body()
functions?

Thanks.
Vinh
--
Vinh Nguyen
Department of Statistics
Donald Bren School of ICS
2231 Bren Hall
University of California, Irvine
Irvine, CA 92607
vqnguyen at uci.edu | http://www.ics.uci.edu/~vqnguyen/
Schedule a meeting: http://tungle.me/VinhNguyen


From vqnguyen at uci.edu  Wed Oct  6 02:21:20 2010
From: vqnguyen at uci.edu (Vinh Nguyen)
Date: Tue, 5 Oct 2010 17:21:20 -0700
Subject: [Rd] args() and body() equivalents for S4 methods?
In-Reply-To: <AANLkTinTuQs8RoWADcYS5oCy+e+7KXACYTRO8=8Jj-F1@mail.gmail.com>
References: <AANLkTinoqP9U=5-PEEP67FfQXUHxErnx5ptXZKQLFcni@mail.gmail.com>
	<AANLkTinTuQs8RoWADcYS5oCy+e+7KXACYTRO8=8Jj-F1@mail.gmail.com>
Message-ID: <AANLkTim2J4kcf9o-18Nd_K4FsFw_OEXyw-kVK4fCSaTX@mail.gmail.com>

On Tue, Oct 5, 2010 at 4:45 PM, Thomas Lumley <tlumley at uw.edu> wrote:
> You could define
>
> args4<-function(generic, signature) args(getMethod(generic,signature))
> and
> body4<-function(generic, signature) body(getMethod(generic,signature))
>
> or use selectMethod() instead of getMethod() if you want to find
> inherited methods.
>
> ? -thomas

Thanks Professor Lumley, this is sufficient.


From tsakai at gallo.ucsf.edu  Wed Oct  6 06:38:46 2010
From: tsakai at gallo.ucsf.edu (Tena Sakai)
Date: Tue, 5 Oct 2010 21:38:46 -0700
Subject: [Rd] How do I put ldpaths in a specific place?
Message-ID: <C8D14B66.C9AF%tsakai@gallo.ucsf.edu>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20101005/a8da54a2/attachment.pl>

From simon.urbanek at r-project.org  Wed Oct  6 13:45:10 2010
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Wed, 6 Oct 2010 07:45:10 -0400
Subject: [Rd] How do I put ldpaths in a specific place?
In-Reply-To: <C8D14B66.C9AF%tsakai@gallo.ucsf.edu>
References: <C8D14B66.C9AF%tsakai@gallo.ucsf.edu>
Message-ID: <FBB26112-A52A-4EB0-89CC-D5CC952E1FA8@r-project.org>


On Oct 6, 2010, at 12:38 AM, Tena Sakai wrote:

> Hi Everybody,
> 
> I made R (v. 2.11.1) from source with the following config option:
>    ./configure --prefix=/mnt/ami-centos5.5-64bit-base \
>                        --exec-prefix=/mnt/ami-centos5.5-64bit-base \
>                        --with-tcltk
> 
> All seemed to go well, but when I tested it with:
>    /usr/sbin/chroot /mnt/ami-centos5.5-64bit-base R
> It told me:
>  /bin/R: line 217: /mnt/ami-centos5.5-64bit-base/lib64/R/etc/ldpaths: No such file or directory
> 
> Question:
> How can I direct ldpaths file into this directory?
> 

That's a quite irrelevant question if your underlying goal is to run R - ldpaths is your least problem - even if you fixed that nothing would work as your R.home is entirely wrong.

Note that by using chroot you're making the entire configuration under which you compiled R invalid.

If your chroot jailed configuration is identical to that of your main system, you should configure R against your full system and use DESTDIR on make install to place the installation in the jail. (Note that --prefix is something entirely different!)

If it's not then you are entirely on your own as you will have to use the above approach but then also make sure any dependent tools and libraries used by R are also present in the chroot jail.

Cheers,
Simon


From kasperdanielhansen at gmail.com  Wed Oct  6 15:31:52 2010
From: kasperdanielhansen at gmail.com (Kasper Daniel Hansen)
Date: Wed, 6 Oct 2010 09:31:52 -0400
Subject: [Rd] possible bug in summaryRprof with memory.profiling=TRUE
Message-ID: <AANLkTinG8W85K7tmm_XHuC89-XPqtnNBiwJ0OdH7W9ef@mail.gmail.com>

I apologize for the somewhat brief bug report, but we are getting
close to the release of 2.12 and I thought it was better to send
something brief than to stay silent.

R version 2.12.0 beta (2010-10-06 r53205)

compiled with memory-profiling enabled.  I have very little experience
with memory profiling, but the following works
  Rprof(memory.profiling = TRUE)
  example(glm)
  Rprof(NULL)
  summaryRprof(memory = "stats")

Now, I am working on a personal function involving a number of nested functions,
  smoothP contains smoothChromosome contains smoothSample
These functions contains a number of print(gc()) calls that I have
left untouched (not sure if this is related).  My code also used
multicore, but currently it uses mclapply(..., mc.cores = 1) which (as
far as I can see) simply calls lapply.

When I run
  Rprof(memory.profiling = TRUE)
  BSdata <- smoothP(BSdata.tmp, ns = 70, h = 1000, mc.cores = 1)
  Rprof(NULL)
  summaryRprof(memory = "stats")

I get an error:
 Error in tapply(1L:961L, list(index = c("\"smoothP\":\"print\"",
"\"smoothP\":\"print\"",  :
  arguments must have same length

Enter a frame number, or 0 to exit

1: summaryRprof(memory = "stats")
2: Rprof_memory_summary(filename = con, chunksize = chunksize, aggregate = ind
3: by(memcounts, index, function(these) with(these, round(c(vsize.small = mean
4: by.data.frame(memcounts, index, function(these) with(these, round(c(vsize.s
5: eval(substitute(tapply(1:nd, IND, FUNx, simplify = simplify)), data)
6: eval(expr, envir, enclos)
7: tapply(1:961, list(index = c("\"smoothP\":\"print\"",
"\"smoothP\":\"print\

Selection: 2
Called from: eval(expr, envir, enclos)
Browse[1]> dim(memcounts)
[1] 961   4
Browse[1]> length(index)
[1] 5961
Browse[1]> head(index)
[1] "\"smoothP\":\"print\"" "\"smoothP\":\"print\""
"\"smoothP\":\"print\""
[4] "\"smoothP\":\"print\"" "\"smoothP\":\"print\""
"\"smoothP\":\"print\""
Browse[1]> tail(index)
[1] "\"smoothP\":\"print\"" "\"smoothP\":\"print\""
"\"smoothP\":\"print\""
[4] "\"smoothP\":\"print\"" "\"smoothP\":\"list\""
"\"smoothP\":\"list\""
Browse[1]>

The file Rprof.out has 5962 lines according to wc -l, and looks
normal.  The file is available at
  http://www.biostat.jhsph.edu/~khansen/Rprof.out
It parses correctly if I just do
  summaryRprof()
(without the memory = "stats" option).  If I use memory = "tseries" I
also get a row number mismatch:

Error in data.frame(..., check.names = FALSE) :
  arguments imply differing number of rows: 961, 5961

Enter a frame number, or 0 to exit

1: summaryRprof("http://www.biostat.jhsph.edu/~khansen/Rprof.out", memory = "t
2: Rprof_memory_summary(filename = con, chunksize = chunksize, label = index,
3: cbind(memcounts, labels)
4: cbind(deparse.level, ...)
5: data.frame(..., check.names = FALSE)

Selection:

I see this in R-devel (build today) as well.

Kasper


From cbeleites at units.it  Wed Oct  6 16:20:23 2010
From: cbeleites at units.it (Claudia Beleites)
Date: Wed, 06 Oct 2010 16:20:23 +0200
Subject: [Rd] SweaveInput + keep.source = TRUE trouble
In-Reply-To: <4CAB3C3C.9070101@gmail.com>
References: <4CAAF217.6090200@units.it> <4CAB3C3C.9070101@gmail.com>
Message-ID: <i8i0j7$7mk$1@dough.gmane.org>

Thank you - works fine for me now.

Claudia

Duncan Murdoch wrote:
>  This is fixed now in R-devel and the beta version.  The fix isn't 
> perfect:  if you use \SweaveInput, you lose the error reporting that 
> gives line numbers from the original file.  It should be possible to 
> have both, but I think the changes to implement that are too large to 
> consider in a beta.
> 
> Duncan Murdoch
> 
> On 05/10/2010 5:38 AM, Claudia Beleites wrote:
>> Dear all,
>>
>> I have trouble with R-beta sweaving files that include definitions with
>> \SweaveInput in combination with keep.source = TRUE
>>
>> Symptom:
>> SInput is taken from too far down the input file (the shift is the 
>> number of
>> lines of the included file). Is that known? Searching didn't turn up 
>> anything,
>> yet I think there are more people than just me using keep.source.
>>
>> Example:
>> $ ~/tmp/R-beta/bin/R CMD Sweave baseline.Rnw&&
>> mv baseline.tex baseline.devel.tex&&
>> R CMD Sweave baseline.Rnw&&
>> mv baseline.tex baseline.2.11.tex&&
>> diff -u baseline.2.11.tex baseline.devel.tex
>>
>> gives:
>> --- baseline.2.11.tex    2010-10-05 11:33:49.000000000 +0200
>> +++ baseline.devel.tex    2010-10-05 11:33:49.000000000 +0200
>> @@ -83,7 +83,7 @@
>>    \verb+\SweaveOpts{keep.source = TRUE}+
>>    \begin{Schunk}
>>    \begin{Sinput}
>> ->  12
>> +>  line 54
>>    \end{Sinput}
>>    \begin{Soutput}
>>    [1] 12
>> @@ -106,7 +106,7 @@
>>    line 63 chunk option keep.source = TRUE
>>    \begin{Schunk}
>>    \begin{Sinput}
>> ->  14
>> +>  line 67
>>    \end{Sinput}
>>    \begin{Soutput}
>>    [1] 14
>>
>> I used yesterday's R-beta, and my system is Ubuntu 9.10 64 bit (though 
>> that
>> probably doesn't matter).
>>
>> Building the example file I also found that \SweaveInput{} cannot be 
>> followed by
>> anything else on the line(not even a LaTeX comment).
>>
>> \SweaveInput{x}y
>> complains that file xy is not found.
>>
>> Best regards,
>>
>> Claudia Beleites
>>
>>
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
> 


-- 
Claudia Beleites
Dipartimento dei Materiali e delle Risorse Naturali
Universit? degli Studi di Trieste
Via Alfonso Valerio 6/a
I-34127 Trieste

phone: +39 0 40 5 58-37 68
email: cbeleites at units.it


From tsakai at gallo.ucsf.edu  Wed Oct  6 23:19:16 2010
From: tsakai at gallo.ucsf.edu (Tena Sakai)
Date: Wed, 6 Oct 2010 14:19:16 -0700
Subject: [Rd] How do I put ldpaths in a specific place?
In-Reply-To: <FBB26112-A52A-4EB0-89CC-D5CC952E1FA8@r-project.org>
Message-ID: <C8D235E4.C9F2%tsakai@gallo.ucsf.edu>

Thank you Simon,

I ran:
  make install DESTDIR=/mnt/ami-centos5.5-64bit-base

Now I can execute this R which is in
/mnt/ami-centos5.5-64bit-base/usr/local/bin two ways:

  cd /mnt/ami-centos5.5-64bit-base/usr/local/bin
  ./R
and
  chroot /mnt/ami-centos5.5-64bit-base R

Many thanks for your help.

Regards,

Tena Sakai
tsakai at gallo.ucsf.edu


On 10/6/10 4:45 AM, "Simon Urbanek" <simon.urbanek at r-project.org> wrote:

> 
> On Oct 6, 2010, at 12:38 AM, Tena Sakai wrote:
> 
>> Hi Everybody,
>> 
>> I made R (v. 2.11.1) from source with the following config option:
>>    ./configure --prefix=/mnt/ami-centos5.5-64bit-base \
>>                        --exec-prefix=/mnt/ami-centos5.5-64bit-base \
>>                        --with-tcltk
>> 
>> All seemed to go well, but when I tested it with:
>>    /usr/sbin/chroot /mnt/ami-centos5.5-64bit-base R
>> It told me:
>>  /bin/R: line 217: /mnt/ami-centos5.5-64bit-base/lib64/R/etc/ldpaths: No such
>> file or directory
>> 
>> Question:
>> How can I direct ldpaths file into this directory?
>> 
> 
> That's a quite irrelevant question if your underlying goal is to run R -
> ldpaths is your least problem - even if you fixed that nothing would work as
> your R.home is entirely wrong.
> 
> Note that by using chroot you're making the entire configuration under which
> you compiled R invalid.
> 
> If your chroot jailed configuration is identical to that of your main system,
> you should configure R against your full system and use DESTDIR on make
> install to place the installation in the jail. (Note that --prefix is
> something entirely different!)
> 
> If it's not then you are entirely on your own as you will have to use the
> above approach but then also make sure any dependent tools and libraries used
> by R are also present in the chroot jail.
> 
> Cheers,
> Simon
> 
> 


From Troy.Robertson at aad.gov.au  Thu Oct  7 03:12:37 2010
From: Troy.Robertson at aad.gov.au (Troy Robertson)
Date: Thu, 7 Oct 2010 12:12:37 +1100
Subject: [Rd] Recursion error after upgrade to R_2.11.1
	[Sec=Unclassified]
Message-ID: <42C7503E0B99F248B06BC65E7D2B4E020187DD7258BC@EX2K7-CCR.AAD.GOV.AU>

Hi all,

After no replies to my previous message I thought I might show some code to demonstrate the change and again seek any explanation for the error now thrown by my code after upgrading from 2.10.1 to 2.11.1.

Thanks
Troy
--------------------------------------------------------
setClass("PortableObject",
        representation(test1    = "character"),

        prototype(      test1   = ""),
          contains = ".environment"
)

setMethod("initialize", "PortableObject",
    function(.Object, ..., .xData=new.env(parent=emptyenv())) {
                .Object <- callNextMethod(.Object, ..., .xData=.xData)

                .Object at test1 <- "Foo"
                # Following line works under 2.10.1 but now throws
                # Error: evaluation nested too deeply: infinite recursion / options(expressions=)?
                #####.Object[["test2"]] <- "Bar"
                # The following does what I want though
                .Object$test3 <- "Baa"

                return(.Object)
        }
)

e <- new("PortableObject")

alterEGo <- function(o = "EPOCObject") {
        o at test1 <- "Boo"

        # Following line works under 2.10.1 but now throws
        # Error: evaluation nested too deeply: infinite recursion / options(expressions=)?
        ####o[["test2"]] <- "Who"
        # The following does what I want though
        o$test3 <- "Hoo"

        # NOTE: No return
}

alterEGo(e)
e at test1
e$test2
e[["test3"]]
e at .xData[["test3"]]
___________________________________________________________________________

    Australian Antarctic Division - Commonwealth of Australia
IMPORTANT: This transmission is intended for the addressee only. If you are not the
intended recipient, you are notified that use or dissemination of this communication is
strictly prohibited by Commonwealth law. If you have received this transmission in error,
please notify the sender immediately by e-mail or by telephoning +61 3 6232 3209 and
DELETE the message.
        Visit our web site at http://www.antarctica.gov.au/
___________________________________________________________________________


From mtmorgan at fhcrc.org  Thu Oct  7 04:21:35 2010
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Wed, 06 Oct 2010 19:21:35 -0700
Subject: [Rd] Recursion error after upgrade to
	R_2.11.1	[Sec=Unclassified]
In-Reply-To: <42C7503E0B99F248B06BC65E7D2B4E020187DD7258BC@EX2K7-CCR.AAD.GOV.AU>
References: <42C7503E0B99F248B06BC65E7D2B4E020187DD7258BC@EX2K7-CCR.AAD.GOV.AU>
Message-ID: <4CAD2EAF.8040505@fhcrc.org>

On 10/06/2010 06:12 PM, Troy Robertson wrote:
> Hi all,
> 
> After no replies to my previous message I thought I might show some code to demonstrate the change and again seek any explanation for the error now thrown by my code after upgrading from 2.10.1 to 2.11.1.
> 
> Thanks
> Troy
> --------------------------------------------------------
> setClass("PortableObject",
>         representation(test1    = "character"),
> 
>         prototype(      test1   = ""),
>           contains = ".environment"
> )
> 
> setMethod("initialize", "PortableObject",
>     function(.Object, ..., .xData=new.env(parent=emptyenv())) {
>                 .Object <- callNextMethod(.Object, ..., .xData=.xData)
> 
>                 .Object at test1 <- "Foo"
>                 # Following line works under 2.10.1 but now throws
>                 # Error: evaluation nested too deeply: infinite recursion / options(expressions=)?
>                 #####.Object[["test2"]] <- "Bar"
>                 # The following does what I want though
>                 .Object$test3 <- "Baa"
> 
>                 return(.Object)
>         }
> )
> 
> e <- new("PortableObject")

The explicit example does help -- it's clear what bug you are
encountering. Here's the code in R-2.10

> selectMethod("[[<-", ".environment")
Method Definition:

function (x, i, j, ..., value)
{
    call <- sys.call()
    call[[2]] <- x at .Data
    eval.parent(call)
    x
}


and 2.11.1

> selectMethod("[[<-", ".environment")
Method Definition:

function (x, i, j, ..., value)
{
    .local <- function (x, i, j, ..., exact = TRUE, value)
    {
        call <- sys.call()
        call[[2]] <- x at .Data
        eval.parent(call)
        x
    }
    .local(x, i, j, ..., value = value)
}

Apparently the 'exact' argument has been added, and because the method
signature differs from the generic, a .local function is created. That
'sys.call()' originally returned the environment in which the generic
was called, but now it returns the environment in which .local is
defined. And so eval() keeps evaluating .local(). This I think is a bug.

For what it's worth, if I were interested in minimizing copying I would
set up initialize so that it ended with callNextMethod(<...>), on the
hopes that the method eventually called would take care not to make too
many copies on slot assignment.

Martin

> 
> alterEGo <- function(o = "EPOCObject") {
>         o at test1 <- "Boo"
> 
>         # Following line works under 2.10.1 but now throws
>         # Error: evaluation nested too deeply: infinite recursion / options(expressions=)?
>         ####o[["test2"]] <- "Who"
>         # The following does what I want though
>         o$test3 <- "Hoo"
> 
>         # NOTE: No return
> }
> 
> alterEGo(e)
> e at test1
> e$test2
> e[["test3"]]
> e at .xData[["test3"]]
> ___________________________________________________________________________
> 
>     Australian Antarctic Division - Commonwealth of Australia
> IMPORTANT: This transmission is intended for the addressee only. If you are not the
> intended recipient, you are notified that use or dissemination of this communication is
> strictly prohibited by Commonwealth law. If you have received this transmission in error,
> please notify the sender immediately by e-mail or by telephoning +61 3 6232 3209 and
> DELETE the message.
>         Visit our web site at http://www.antarctica.gov.au/
> ___________________________________________________________________________
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


-- 
Computational Biology
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N. PO Box 19024 Seattle, WA 98109

Location: M1-B861
Telephone: 206 667-2793


From Troy.Robertson at aad.gov.au  Thu Oct  7 04:50:49 2010
From: Troy.Robertson at aad.gov.au (Troy Robertson)
Date: Thu, 7 Oct 2010 13:50:49 +1100
Subject: [Rd] Recursion error after upgrade to
	R_2.11.1	[Sec=Unclassified] [Sec=Unclassified]
In-Reply-To: <4CAD2EAF.8040505@fhcrc.org>
Message-ID: <42C7503E0B99F248B06BC65E7D2B4E020187DD7258F4@EX2K7-CCR.AAD.GOV.AU>

>
> On 10/06/2010 06:12 PM, Troy Robertson wrote:
> > Hi all,
> >
> > After no replies to my previous message I thought I might show some
> > code to demonstrate the change and again seek any
> explanation for the
> > error now thrown by my code after upgrading from 2.10.1 to 2.11.1.
> >
> > Thanks
> > Troy
> > --------------------------------------------------------
> > setClass("PortableObject",
> >         representation(test1    = "character"),
> >
> >         prototype(      test1   = ""),
> >           contains = ".environment"
> > )
> >
> > setMethod("initialize", "PortableObject",
> >     function(.Object, ..., .xData=new.env(parent=emptyenv())) {
> >                 .Object <- callNextMethod(.Object, ...,
> .xData=.xData)
> >
> >                 .Object at test1 <- "Foo"
> >                 # Following line works under 2.10.1 but now throws
> >                 # Error: evaluation nested too deeply:
> infinite recursion / options(expressions=)?
> >                 #####.Object[["test2"]] <- "Bar"
> >                 # The following does what I want though
> >                 .Object$test3 <- "Baa"
> >
> >                 return(.Object)
> >         }
> > )
> >
> > e <- new("PortableObject")
>
> The explicit example does help -- it's clear what bug you are
> encountering. Here's the code in R-2.10
>
> > selectMethod("[[<-", ".environment")
> Method Definition:
>
> function (x, i, j, ..., value)
> {
>     call <- sys.call()
>     call[[2]] <- x at .Data
>     eval.parent(call)
>     x
> }
>
>
> and 2.11.1
>
> > selectMethod("[[<-", ".environment")
> Method Definition:
>
> function (x, i, j, ..., value)
> {
>     .local <- function (x, i, j, ..., exact = TRUE, value)
>     {
>         call <- sys.call()
>         call[[2]] <- x at .Data
>         eval.parent(call)
>         x
>     }
>     .local(x, i, j, ..., value = value)
> }
>
> Apparently the 'exact' argument has been added, and because
> the method signature differs from the generic, a .local
> function is created. That 'sys.call()' originally returned
> the environment in which the generic was called, but now it
> returns the environment in which .local is defined. And so
> eval() keeps evaluating .local(). This I think is a bug.

Yes, afer the email from William Dunlop, I found this difference in the methods between 2.10.1 and 2.11.1
I had a play and by adding my own method to overload "[[<-" for my PortableObject was able to reinstate the original functionality without the recursive error.

setMethod("[[<-", "PortableObject",
        function (x, i, j, ..., value)
        {
                call <- sys.call()
                call[[2]] <- x at .Data
                eval.parent(call)
                x
        }
)

>
> For what it's worth, if I were interested in minimizing
> copying I would set up initialize so that it ended with
> callNextMethod(<...>), on the hopes that the method
> eventually called would take care not to make too many copies
> on slot assignment.
>
> Martin
>

Hmmm, not sure what you mean here?  My code passes objects such as these as parameters to other S4 classes which alter their data.  If the .xData slot is used then I have no need to return the object.  No copy-on-change is performed but data held by the PortableObject is modified.  This speeds up my execution time by a LARGE amount.

I could very well have things all arse-about, having come from a Java OO background, but this is the only way I have been able to create a pass-by-reference paradigm using S4 classes.  Any suggestions for alternative solutions would be greatfully received.

Troy

> >
> > alterEGo <- function(o = "EPOCObject") {
> >         o at test1 <- "Boo"
> >
> >         # Following line works under 2.10.1 but now throws
> >         # Error: evaluation nested too deeply: infinite
> recursion / options(expressions=)?
> >         ####o[["test2"]] <- "Who"
> >         # The following does what I want though
> >         o$test3 <- "Hoo"
> >
> >         # NOTE: No return
> > }
> >
> > alterEGo(e)
> > e at test1
> > e$test2
> > e[["test3"]]
> > e at .xData[["test3"]]
> >
___________________________________________________________________________

    Australian Antarctic Division - Commonwealth of Australia
IMPORTANT: This transmission is intended for the addressee only. If you are not the
intended recipient, you are notified that use or dissemination of this communication is
strictly prohibited by Commonwealth law. If you have received this transmission in error,
please notify the sender immediately by e-mail or by telephoning +61 3 6232 3209 and
DELETE the message.
        Visit our web site at http://www.antarctica.gov.au/
___________________________________________________________________________


From maechler at stat.math.ethz.ch  Thu Oct  7 12:49:51 2010
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Thu, 7 Oct 2010 12:49:51 +0200
Subject: [Rd] Recursion error after upgrade
	to	R_2.11.1	[Sec=Unclassified] [Sec=Unclassified]
In-Reply-To: <42C7503E0B99F248B06BC65E7D2B4E020187DD7258F4@EX2K7-CCR.AAD.GOV.AU>
References: <4CAD2EAF.8040505@fhcrc.org>
	<42C7503E0B99F248B06BC65E7D2B4E020187DD7258F4@EX2K7-CCR.AAD.GOV.AU>
Message-ID: <19629.42447.193180.477102@lynne.math.ethz.ch>

>>>>> "TR" == Troy Robertson <Troy.Robertson at aad.gov.au>
>>>>>     on Thu, 7 Oct 2010 13:50:49 +1100 writes:

    >> 
    >> On 10/06/2010 06:12 PM, Troy Robertson wrote:
    >> > Hi all,
    >> >
    >> > After no replies to my previous message I thought I might show some
    >> > code to demonstrate the change and again seek any
    >> explanation for the
    >> > error now thrown by my code after upgrading from 2.10.1 to 2.11.1.
    >> >
    >> > Thanks
    >> > Troy
    >> > --------------------------------------------------------
    >> > setClass("PortableObject",
    >> >         representation(test1    = "character"),
    >> >
    >> >         prototype(      test1   = ""),
    >> >           contains = ".environment"
    >> > )
    >> >
    >> > setMethod("initialize", "PortableObject",
    >> >     function(.Object, ..., .xData=new.env(parent=emptyenv())) {
    >> >                 .Object <- callNextMethod(.Object, ...,
    >> .xData=.xData)
    >> >
    >> >                 .Object at test1 <- "Foo"
    >> >                 # Following line works under 2.10.1 but now throws
    >> >                 # Error: evaluation nested too deeply:
    >> infinite recursion / options(expressions=)?
    >> >                 #####.Object[["test2"]] <- "Bar"
    >> >                 # The following does what I want though
    >> >                 .Object$test3 <- "Baa"
    >> >
    >> >                 return(.Object)
    >> >         }
    >> > )
    >> >
    >> > e <- new("PortableObject")
    >> 
    >> The explicit example does help -- it's clear what bug you are
    >> encountering. Here's the code in R-2.10
    >> 
    >> > selectMethod("[[<-", ".environment")
    >> Method Definition:
    >> 
    >> function (x, i, j, ..., value)
    >> {
    >> call <- sys.call()
    >> call[[2]] <- x at .Data
    >> eval.parent(call)
    >> x
    >> }
    >> 
    >> 
    >> and 2.11.1
    >> 
    >> > selectMethod("[[<-", ".environment")
    >> Method Definition:
    >> 
    >> function (x, i, j, ..., value)
    >> {
    >> .local <- function (x, i, j, ..., exact = TRUE, value)
    >> {
    >> call <- sys.call()
    >> call[[2]] <- x at .Data
    >> eval.parent(call)
    >> x
    >> }
    >> .local(x, i, j, ..., value = value)
    >> }
    >> 
    >> Apparently the 'exact' argument has been added, and because
    >> the method signature differs from the generic, a .local
    >> function is created. That 'sys.call()' originally returned
    >> the environment in which the generic was called, but now it
    >> returns the environment in which .local is defined. And so
    >> eval() keeps evaluating .local(). This I think is a bug.

    TR> Yes, afer the email from William Dunlop, I found this difference in the methods between 2.10.1 and 2.11.1
    TR> I had a play and by adding my own method to overload "[[<-" for my PortableObject was able to reinstate the original functionality without the recursive error.

    TR> setMethod("[[<-", "PortableObject",
    TR> function (x, i, j, ..., value)
    TR> {
    TR> call <- sys.call()
    TR> call[[2]] <- x at .Data
    TR> eval.parent(call)
    TR> x
    TR> }
    TR> )

    >> 
    >> For what it's worth, if I were interested in minimizing
    >> copying I would set up initialize so that it ended with
    >> callNextMethod(<...>), on the hopes that the method
    >> eventually called would take care not to make too many copies
    >> on slot assignment.
    >> 
    >> Martin
    >> 

    TR> Hmmm, not sure what you mean here?  My code passes objects such as these as parameters to other S4 classes which alter their data.  If the .xData slot is used then I have no need to return the object.  No copy-on-change is performed but data held by the PortableObject is modified.  This speeds up my execution time by a LARGE amount.

    TR> I could very well have things all arse-about, having come from a Java OO background, but this is the only way I have been able to create a pass-by-reference paradigm using S4 classes.  Any suggestions for alternative solutions would be greatfully received.

    TR> Troy

R 2.12.2 (currently beta) has in its NEWS :

    o A facility for defining reference-based S4 classes (in the OOP
      style of Java, C++, etc.) has been added experimentally to
      package methods; see ?ReferenceClasses.

---> Please get R-2.12.2 beta and tell here about your
experiences. John Chambers (you have in CC) will be particularly
interested in your feedback.

Martin Maechler, ETH Zurich


From murdoch.duncan at gmail.com  Thu Oct  7 12:58:34 2010
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Thu, 07 Oct 2010 06:58:34 -0400
Subject: [Rd] Recursion error after upgrade
 to	R_2.11.1	[Sec=Unclassified] [Sec=Unclassified]
In-Reply-To: <19629.42447.193180.477102@lynne.math.ethz.ch>
References: <4CAD2EAF.8040505@fhcrc.org>	<42C7503E0B99F248B06BC65E7D2B4E020187DD7258F4@EX2K7-CCR.AAD.GOV.AU>
	<19629.42447.193180.477102@lynne.math.ethz.ch>
Message-ID: <4CADA7DA.7080402@gmail.com>

On 07/10/2010 6:49 AM, Martin Maechler wrote:
>>>>>> "TR" == Troy Robertson <Troy.Robertson at aad.gov.au>
>>>>>>     on Thu, 7 Oct 2010 13:50:49 +1100 writes:
> 
>     >> 
>     >> On 10/06/2010 06:12 PM, Troy Robertson wrote:
>     >> > Hi all,
>     >> >
>     >> > After no replies to my previous message I thought I might show some
>     >> > code to demonstrate the change and again seek any
>     >> explanation for the
>     >> > error now thrown by my code after upgrading from 2.10.1 to 2.11.1.
>     >> >
>     >> > Thanks
>     >> > Troy
>     >> > --------------------------------------------------------
>     >> > setClass("PortableObject",
>     >> >         representation(test1    = "character"),
>     >> >
>     >> >         prototype(      test1   = ""),
>     >> >           contains = ".environment"
>     >> > )
>     >> >
>     >> > setMethod("initialize", "PortableObject",
>     >> >     function(.Object, ..., .xData=new.env(parent=emptyenv())) {
>     >> >                 .Object <- callNextMethod(.Object, ...,
>     >> .xData=.xData)
>     >> >
>     >> >                 .Object at test1 <- "Foo"
>     >> >                 # Following line works under 2.10.1 but now throws
>     >> >                 # Error: evaluation nested too deeply:
>     >> infinite recursion / options(expressions=)?
>     >> >                 #####.Object[["test2"]] <- "Bar"
>     >> >                 # The following does what I want though
>     >> >                 .Object$test3 <- "Baa"
>     >> >
>     >> >                 return(.Object)
>     >> >         }
>     >> > )
>     >> >
>     >> > e <- new("PortableObject")
>     >> 
>     >> The explicit example does help -- it's clear what bug you are
>     >> encountering. Here's the code in R-2.10
>     >> 
>     >> > selectMethod("[[<-", ".environment")
>     >> Method Definition:
>     >> 
>     >> function (x, i, j, ..., value)
>     >> {
>     >> call <- sys.call()
>     >> call[[2]] <- x at .Data
>     >> eval.parent(call)
>     >> x
>     >> }
>     >> 
>     >> 
>     >> and 2.11.1
>     >> 
>     >> > selectMethod("[[<-", ".environment")
>     >> Method Definition:
>     >> 
>     >> function (x, i, j, ..., value)
>     >> {
>     >> .local <- function (x, i, j, ..., exact = TRUE, value)
>     >> {
>     >> call <- sys.call()
>     >> call[[2]] <- x at .Data
>     >> eval.parent(call)
>     >> x
>     >> }
>     >> .local(x, i, j, ..., value = value)
>     >> }
>     >> 
>     >> Apparently the 'exact' argument has been added, and because
>     >> the method signature differs from the generic, a .local
>     >> function is created. That 'sys.call()' originally returned
>     >> the environment in which the generic was called, but now it
>     >> returns the environment in which .local is defined. And so
>     >> eval() keeps evaluating .local(). This I think is a bug.
> 
>     TR> Yes, afer the email from William Dunlop, I found this difference in the methods between 2.10.1 and 2.11.1
>     TR> I had a play and by adding my own method to overload "[[<-" for my PortableObject was able to reinstate the original functionality without the recursive error.
> 
>     TR> setMethod("[[<-", "PortableObject",
>     TR> function (x, i, j, ..., value)
>     TR> {
>     TR> call <- sys.call()
>     TR> call[[2]] <- x at .Data
>     TR> eval.parent(call)
>     TR> x
>     TR> }
>     TR> )
> 
>     >> 
>     >> For what it's worth, if I were interested in minimizing
>     >> copying I would set up initialize so that it ended with
>     >> callNextMethod(<...>), on the hopes that the method
>     >> eventually called would take care not to make too many copies
>     >> on slot assignment.
>     >> 
>     >> Martin
>     >> 
> 
>     TR> Hmmm, not sure what you mean here?  My code passes objects such as these as parameters to other S4 classes which alter their data.  If the .xData slot is used then I have no need to return the object.  No copy-on-change is performed but data held by the PortableObject is modified.  This speeds up my execution time by a LARGE amount.
> 
>     TR> I could very well have things all arse-about, having come from a Java OO background, but this is the only way I have been able to create a pass-by-reference paradigm using S4 classes.  Any suggestions for alternative solutions would be greatfully received.
> 
>     TR> Troy
> 
> R 2.12.2 (currently beta) has in its NEWS :

Just pointing out a typo:  the version of the beta is 2.12.0.

Duncan Murdoch

> 
>     o A facility for defining reference-based S4 classes (in the OOP
>       style of Java, C++, etc.) has been added experimentally to
>       package methods; see ?ReferenceClasses.
> 
> ---> Please get R-2.12.2 beta and tell here about your
> experiences. John Chambers (you have in CC) will be particularly
> interested in your feedback.
> 
> Martin Maechler, ETH Zurich
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From r.d.morey at rug.nl  Thu Oct  7 20:28:32 2010
From: r.d.morey at rug.nl (Richard D. Morey)
Date: Thu, 07 Oct 2010 20:28:32 +0200
Subject: [Rd] long double, C, fortran
In-Reply-To: <mailman.21.1286445608.10801.r-devel@r-project.org>
References: <mailman.21.1286445608.10801.r-devel@r-project.org>
Message-ID: <4CAE1150.2050006@rug.nl>

  I'm using .Call() to call C code from R under Windows (on an Intel 
Core 2 duo). The C code involves some very small numbers, and I think 
I'm losing precision using doubles. I thought I might use long doubles 
to see if I can get that precision back. I have a few questions:

1. Does this affect the portability to other OSs or processors?
2. I'm returning the results in a matrix. Will a matrix of REALs be 
sufficient for holding long doubles, or will it be cast back to doubles?
3. Will calls to FORTRAN BLAS (like dsymv, dpotrf, dpotri) still work 
with long doubles?

Thanks for any help you can provide.

-- 
Richard D. Morey
Assistant Professor
Psychometrics and Statistics
Rijksuniversiteit Groningen / University of Groningen
http://drsmorey.org/research/rdmorey


From simon.urbanek at r-project.org  Thu Oct  7 20:57:14 2010
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Thu, 7 Oct 2010 14:57:14 -0400
Subject: [Rd] long double, C, fortran
In-Reply-To: <4CAE1150.2050006@rug.nl>
References: <mailman.21.1286445608.10801.r-devel@r-project.org>
	<4CAE1150.2050006@rug.nl>
Message-ID: <09250356-489B-4BA2-930C-0E9B5DBEDFD3@r-project.org>


On Oct 7, 2010, at 2:28 PM, Richard D. Morey wrote:

> I'm using .Call() to call C code from R under Windows (on an Intel Core 2 duo). The C code involves some very small numbers, and I think I'm losing precision using doubles.

The magnitude of numbers has really nothing to do with precision itself. Make sure this is really about precision and not something else. Also check your algorithm for common numerical problems (subtracting small numbers etc.).


> I thought I might use long doubles to see if I can get that precision back. I have a few questions:
> 
> 1. Does this affect the portability to other OSs or processors?

Different processors handle long doubles differently, but that is usually not an issue since you will end up passing back doubles (see below) so you simply take what you get (e.g. Intel processors actually use only fraction of the quadruple precision that long doubles offer [80 instead of 128 bits]). Although long doubles are supported on most systems these days, on some architectures this feature is emulated and thus can be slow.


> 2. I'm returning the results in a matrix. Will a matrix of REALs be sufficient for holding long doubles, or will it be cast back to doubles?

You can't use long doubles in any interface to R. You can use long doubles for intermediate calculations but you can only pass doubles between your code and R.


> 3. Will calls to FORTRAN BLAS (like dsymv, dpotrf, dpotri) still work with long doubles?
> 

No.

Cheers,
Simon


From hpages at fhcrc.org  Thu Oct  7 21:10:47 2010
From: hpages at fhcrc.org (=?ISO-8859-1?Q?Herv=E9_Pag=E8s?=)
Date: Thu, 07 Oct 2010 12:10:47 -0700
Subject: [Rd] cleanup_pkg() in tools:::.build_packages() is broken
In-Reply-To: <4CA68B7F.5070208@fhcrc.org>
References: <4CA68B7F.5070208@fhcrc.org>
Message-ID: <4CAE1B37.5090006@fhcrc.org>

This has been fixed in R-beta. Thanks!  H.

On 10/01/2010 06:31 PM, Herv? Pag?s wrote:
> Hi,
>
> The cleanup_pkg() function defined the big tools:::.build_packages()
> function in tools/R/build.R is currently broken. When Makefiles are
> used cleanup_pkg() doesn't clean anything because of the way system2()
> is called.
>
> For example, the call to Ssystem() on line 304 (Ssystem is a silent
> version of system2) is basically trying to do this:
>
>  > system2(paste(Sys.getenv("MAKE", "make"), makefiles, "clean"))
> sh: make -f '/home/hpages/R-2.12/etc//Makeconf' -f Makefile clean: not
> found
>
> But it seems that with this new system2(), the arguments to the system
> command need to be passed separately thru the 'args' argument.
>
> Cheers,
> H.
>


-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M2-B876
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fhcrc.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From hpages at fhcrc.org  Thu Oct  7 21:21:16 2010
From: hpages at fhcrc.org (=?windows-1252?Q?Herv=E9_Pag=E8s?=)
Date: Thu, 07 Oct 2010 12:21:16 -0700
Subject: [Rd] tar problem when using 'R CMD build' on Windows
In-Reply-To: <4CA4CCCC.6020303@fhcrc.org>
References: <4CA4CCCC.6020303@fhcrc.org>
Message-ID: <4CAE1DAC.6050905@fhcrc.org>

Hi,

On 09/30/2010 10:45 AM, Herv? Pag?s wrote:
[...]
> If that is not desirable, could the tools:::.build_packages() function
> not put quotes around the value of the TAR environment variable (the
> code does shQuote(TAR)), at least on Windows, so I can set this
> variable to
>
> tar --no-same-owner
>

Current R-beta doesn't put quotes around TAR anymore. So now
I can do SET TAR=tar --no-same-owner on Windows and that fixes
my problem. Thanks!

>
> Note that the use of quotes around TAR is inconsistent across
> utils::untar(), utils::tar() and tools:::.build_packages() (only
> the first doesn't put them) but that's another story.

And now things seem to be consistent (none of those functions puts
quotes around TAR anymore). This is good. Thanks again!

H.

>
> Thanks!
> H.
>
>


-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M2-B876
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fhcrc.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From shotwelm at musc.edu  Thu Oct  7 21:45:23 2010
From: shotwelm at musc.edu (Matt Shotwell)
Date: Thu, 07 Oct 2010 15:45:23 -0400
Subject: [Rd] long double, C, fortran
In-Reply-To: <4CAE1150.2050006@rug.nl>
References: <mailman.21.1286445608.10801.r-devel@r-project.org>
	<4CAE1150.2050006@rug.nl>
Message-ID: <1286480723.1684.57.camel@matt-laptop>

In working with small numbers, I usually look for a solution involving a
log transformation. For instance, when a or b are very small, we can
compute the ratio

a / ( a + b )

more safely by

1 / ( 1 + exp( log(b) - log(a) ) )

Alternative data types are sure to cause issues with portability. It's
not worth the headache if you can find an analytical solution like that
above. Some supposedly standard data types (including long double) are
simply not standard in regard to their size in memory. This short
Wikipedia article ought to scare anyone who cares about portability:
<http://en.wikipedia.org/wiki/Long_double>. 

If you are doing some specialty computations involving very large or
small numbers (e.g. computing the Bell number), you might consider the
CRAN package gmp, which wraps the GNU multiple precision arithmetic
library. Or consider using a language like Ruby, where multiple
precision is automatic
<http://en.wikipedia.org/wiki/Arbitrary-precision_arithmetic>.

-Matt

On Thu, 2010-10-07 at 14:28 -0400, Richard D. Morey wrote:
> I'm using .Call() to call C code from R under Windows (on an Intel 
> Core 2 duo). The C code involves some very small numbers, and I think 
> I'm losing precision using doubles. I thought I might use long doubles 
> to see if I can get that precision back. I have a few questions:
> 
> 1. Does this affect the portability to other OSs or processors?
> 2. I'm returning the results in a matrix. Will a matrix of REALs be 
> sufficient for holding long doubles, or will it be cast back to doubles?
> 3. Will calls to FORTRAN BLAS (like dsymv, dpotrf, dpotri) still work 
> with long doubles?
> 
> Thanks for any help you can provide.
> 

-- 
Matthew S. Shotwell
Graduate Student 
Division of Biostatistics and Epidemiology
Medical University of South Carolina


From Troy.Robertson at aad.gov.au  Fri Oct  8 00:52:01 2010
From: Troy.Robertson at aad.gov.au (Troy Robertson)
Date: Fri, 8 Oct 2010 09:52:01 +1100
Subject: [Rd] Recursion error after upgrade
	to	R_2.11.1	[Sec=Unclassified] [Sec=Unclassified]
In-Reply-To: <19629.42447.193180.477102@lynne.math.ethz.ch>
Message-ID: <42C7503E0B99F248B06BC65E7D2B4E020187DD725974@EX2K7-CCR.AAD.GOV.AU>

> -----Original Message-----
> From: Martin Maechler [mailto:maechler at stat.math.ethz.ch]
> Sent: Thursday, 7 October 2010 9:50 PM
> To: Troy Robertson
> Cc: 'Martin Morgan'; 'r-devel at R-project.org'; 'John Chambers'
> Subject: Re: [Rd] Recursion error after upgrade to R_2.11.1
> [Sec=Unclassified] [Sec=Unclassified]
>
>
> >>>>> "TR" == Troy Robertson <Troy.Robertson at aad.gov.au>
> >>>>>     on Thu, 7 Oct 2010 13:50:49 +1100 writes:
>
>     >>
>     >> On 10/06/2010 06:12 PM, Troy Robertson wrote:
>     >> > Hi all,
>     >> >
>     >> > After no replies to my previous message I thought I
> might show some
>     >> > code to demonstrate the change and again seek any
>     >> explanation for the
>     >> > error now thrown by my code after upgrading from
> 2.10.1 to 2.11.1.
>     >> >
>     >> > Thanks
>     >> > Troy
>     >> > --------------------------------------------------------
>     >> > setClass("PortableObject",
>     >> >         representation(test1    = "character"),
>     >> >
>     >> >         prototype(      test1   = ""),
>     >> >           contains = ".environment"
>     >> > )
>     >> >
>     >> > setMethod("initialize", "PortableObject",
>     >> >     function(.Object, ...,
> .xData=new.env(parent=emptyenv())) {
>     >> >                 .Object <- callNextMethod(.Object, ...,
>     >> .xData=.xData)
>     >> >
>     >> >                 .Object at test1 <- "Foo"
>     >> >                 # Following line works under 2.10.1
> but now throws
>     >> >                 # Error: evaluation nested too deeply:
>     >> infinite recursion / options(expressions=)?
>     >> >                 #####.Object[["test2"]] <- "Bar"
>     >> >                 # The following does what I want though
>     >> >                 .Object$test3 <- "Baa"
>     >> >
>     >> >                 return(.Object)
>     >> >         }
>     >> > )
>     >> >
>     >> > e <- new("PortableObject")
>     >>
>     >> The explicit example does help -- it's clear what bug you are
>     >> encountering. Here's the code in R-2.10
>     >>
>     >> > selectMethod("[[<-", ".environment")
>     >> Method Definition:
>     >>
>     >> function (x, i, j, ..., value)
>     >> {
>     >> call <- sys.call()
>     >> call[[2]] <- x at .Data
>     >> eval.parent(call)
>     >> x
>     >> }
>     >>
>     >>
>     >> and 2.11.1
>     >>
>     >> > selectMethod("[[<-", ".environment")
>     >> Method Definition:
>     >>
>     >> function (x, i, j, ..., value)
>     >> {
>     >> .local <- function (x, i, j, ..., exact = TRUE, value)
>     >> {
>     >> call <- sys.call()
>     >> call[[2]] <- x at .Data
>     >> eval.parent(call)
>     >> x
>     >> }
>     >> .local(x, i, j, ..., value = value)
>     >> }
>     >>
>     >> Apparently the 'exact' argument has been added, and because
>     >> the method signature differs from the generic, a .local
>     >> function is created. That 'sys.call()' originally returned
>     >> the environment in which the generic was called, but now it
>     >> returns the environment in which .local is defined. And so
>     >> eval() keeps evaluating .local(). This I think is a bug.
>
>     TR> Yes, afer the email from William Dunlop, I found this
> difference in the methods between 2.10.1 and 2.11.1
>     TR> I had a play and by adding my own method to overload
> "[[<-" for my PortableObject was able to reinstate the
> original functionality without the recursive error.
>
>     TR> setMethod("[[<-", "PortableObject",
>     TR> function (x, i, j, ..., value)
>     TR> {
>     TR> call <- sys.call()
>     TR> call[[2]] <- x at .Data
>     TR> eval.parent(call)
>     TR> x
>     TR> }
>     TR> )
>
>     >>
>     >> For what it's worth, if I were interested in minimizing
>     >> copying I would set up initialize so that it ended with
>     >> callNextMethod(<...>), on the hopes that the method
>     >> eventually called would take care not to make too many copies
>     >> on slot assignment.
>     >>
>     >> Martin
>     >>
>
>     TR> Hmmm, not sure what you mean here?  My code passes
> objects such as these as parameters to other S4 classes which
> alter their data.  If the .xData slot is used then I have no
> need to return the object.  No copy-on-change is performed
> but data held by the PortableObject is modified.  This speeds
> up my execution time by a LARGE amount.
>
>     TR> I could very well have things all arse-about, having
> come from a Java OO background, but this is the only way I
> have been able to create a pass-by-reference paradigm using
> S4 classes.  Any suggestions for alternative solutions would
> be greatfully received.
>
>     TR> Troy
>
> R 2.12.2 (currently beta) has in its NEWS :
>
>     o A facility for defining reference-based S4 classes (in the OOP
>       style of Java, C++, etc.) has been added experimentally to
>       package methods; see ?ReferenceClasses.
>
> ---> Please get R-2.12.2 beta and tell here about your
> experiences. John Chambers (you have in CC) will be
> particularly interested in your feedback.
>
> Martin Maechler, ETH Zurich
>
>

Well...

Just been having a read of the doco for the new reference classes.
This opens up a whole new world in R doesn't it.  Very exciting.
Except for the fact that it negates a lot of what I have been doing on top of S4 objects.  I will probably now be rewritting a lot of code.  Ouch!

I'll start having a bit of a play and exploring this new way of doing things and let you know how I go.
Will probably have questions along the way too.

Thank you to everyone involved for their hard work.

Troy
___________________________________________________________________________

    Australian Antarctic Division - Commonwealth of Australia
IMPORTANT: This transmission is intended for the addressee only. If you are not the
intended recipient, you are notified that use or dissemination of this communication is
strictly prohibited by Commonwealth law. If you have received this transmission in error,
please notify the sender immediately by e-mail or by telephoning +61 3 6232 3209 and
DELETE the message.
        Visit our web site at http://www.antarctica.gov.au/
___________________________________________________________________________


From therneau at mayo.edu  Fri Oct  8 01:17:37 2010
From: therneau at mayo.edu (Terry Therneau)
Date: Thu, 07 Oct 2010 18:17:37 -0500
Subject: [Rd] model.frame deficiency
Message-ID: <1286493457.21613.36.camel@punchbuggy>

The model.frame function has trouble with a certain type of really long
formula.  Here is a test:

tname <- paste('var', 1:50, sep='')
tmat <- matrix(rnorm(500), ncol=50, dimnames=list(NULL, tname))
tdata <- data.frame(tmat)

temp1 <- paste( paste(tname, tname, sep='='), collapse=', ')
temp2 <- paste("~1 + cbind(", temp1, ")")
model.frame(as.formula(temp2), tdata)

 This came out of a user report to me.  Coxph with a very long formula
(which does work) followed by a call to survexp leads to a call like the
above but using my "ratetable" function instead of "cbind".   

My machine's details:
R version 2.10.0 (2009-10-26) 
x86_64-unknown-linux-gnu 

locale:
 [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              
 [3] LC_TIME=en_US.UTF-8        LC_COLLATE=C              
 [5] LC_MONETARY=C              LC_MESSAGES=en_US.UTF-8   
 [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 
 [9] LC_ADDRESS=C               LC_TELEPHONE=C            
[11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       

attached base packages:
[1] grDevices datasets  splines   graphics  utils     stats
methods  
[8] base     


Editorial comment: I said "deficiency" not "bug" above, as I'm not so
sure how good a model with 75 variables might be in the first place.
(Though in this case the user is pretty savvy.)  

Terry Therneau


From pdalgd at gmail.com  Fri Oct  8 01:28:34 2010
From: pdalgd at gmail.com (Peter Dalgaard)
Date: Fri, 08 Oct 2010 01:28:34 +0200
Subject: [Rd] Recursion error after upgrade
 to	R_2.11.1	[Sec=Unclassified] [Sec=Unclassified]
In-Reply-To: <4CADA7DA.7080402@gmail.com>
References: <4CAD2EAF.8040505@fhcrc.org>	<42C7503E0B99F248B06BC65E7D2B4E020187DD7258F4@EX2K7-CCR.AAD.GOV.AU>	<19629.42447.193180.477102@lynne.math.ethz.ch>
	<4CADA7DA.7080402@gmail.com>
Message-ID: <4CAE57A2.6020201@gmail.com>

On 10/07/2010 12:58 PM, Duncan Murdoch wrote:

>>
>> R 2.12.2 (currently beta) has in its NEWS :
> 
> Just pointing out a typo:  the version of the beta is 2.12.0.
> 
> Duncan Murdoch
> 
>>
>>     o A facility for defining reference-based S4 classes (in the OOP
>>       style of Java, C++, etc.) has been added experimentally to
>>       package methods; see ?ReferenceClasses.
>>
>> ---> Please get R-2.12.2 beta and tell here about your
>> experiences. John Chambers (you have in CC) will be particularly
>> interested in your feedback.

By a curious coincidence, the prerelease crontab had the same typo

...
02 00 1 10 * $HOME/scripts/R-set-version '2.12.0 beta'
02 00 8 10 * $HOME/scripts/R-set-version '2.12.2 RC'

Fortunately, I saw the mail with a failing prerelease build before going
to bed, so it should be fixed now.

-pd

-- 
Peter Dalgaard
Center for Statistics, Copenhagen Business School
Phone: (+45)38153501
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From kasperdanielhansen at gmail.com  Fri Oct  8 06:12:46 2010
From: kasperdanielhansen at gmail.com (Kasper Daniel Hansen)
Date: Fri, 8 Oct 2010 00:12:46 -0400
Subject: [Rd] Recursion error after upgrade to R_2.11.1
	[Sec=Unclassified] [Sec=Unclassified]
In-Reply-To: <42C7503E0B99F248B06BC65E7D2B4E020187DD725974@EX2K7-CCR.AAD.GOV.AU>
References: <19629.42447.193180.477102@lynne.math.ethz.ch>
	<42C7503E0B99F248B06BC65E7D2B4E020187DD725974@EX2K7-CCR.AAD.GOV.AU>
Message-ID: <AANLkTinP+_H9JKzuOTTzO_W8Qk=Umr3DCMk_BrZOSZUF@mail.gmail.com>

Troy

For what it's worth, the ExpressionSet / eSet class in Biobase from
Bioconductor has for a long time implemented a pass-by-reference
system, using amongst other stuff locked environments to make sure
things are read only.  You might find this useful to look at.

In general it is hard to complement on your use case without knowing
the details.  I often find that careful programming and profiling can
make R code much faster than initially hypotised.  Having said that,
sometimes (esp. for very big, read-only  objects) environments make
sense.

Kasper

On Thu, Oct 7, 2010 at 6:52 PM, Troy Robertson
<Troy.Robertson at aad.gov.au> wrote:
>> -----Original Message-----
>> From: Martin Maechler [mailto:maechler at stat.math.ethz.ch]
>> Sent: Thursday, 7 October 2010 9:50 PM
>> To: Troy Robertson
>> Cc: 'Martin Morgan'; 'r-devel at R-project.org'; 'John Chambers'
>> Subject: Re: [Rd] Recursion error after upgrade to R_2.11.1
>> [Sec=Unclassified] [Sec=Unclassified]
>>
>>
>> >>>>> "TR" == Troy Robertson <Troy.Robertson at aad.gov.au>
>> >>>>> ? ? on Thu, 7 Oct 2010 13:50:49 +1100 writes:
>>
>> ? ? >>
>> ? ? >> On 10/06/2010 06:12 PM, Troy Robertson wrote:
>> ? ? >> > Hi all,
>> ? ? >> >
>> ? ? >> > After no replies to my previous message I thought I
>> might show some
>> ? ? >> > code to demonstrate the change and again seek any
>> ? ? >> explanation for the
>> ? ? >> > error now thrown by my code after upgrading from
>> 2.10.1 to 2.11.1.
>> ? ? >> >
>> ? ? >> > Thanks
>> ? ? >> > Troy
>> ? ? >> > --------------------------------------------------------
>> ? ? >> > setClass("PortableObject",
>> ? ? >> > ? ? ? ? representation(test1 ? ?= "character"),
>> ? ? >> >
>> ? ? >> > ? ? ? ? prototype( ? ? ?test1 ? = ""),
>> ? ? >> > ? ? ? ? ? contains = ".environment"
>> ? ? >> > )
>> ? ? >> >
>> ? ? >> > setMethod("initialize", "PortableObject",
>> ? ? >> > ? ? function(.Object, ...,
>> .xData=new.env(parent=emptyenv())) {
>> ? ? >> > ? ? ? ? ? ? ? ? .Object <- callNextMethod(.Object, ...,
>> ? ? >> .xData=.xData)
>> ? ? >> >
>> ? ? >> > ? ? ? ? ? ? ? ? .Object at test1 <- "Foo"
>> ? ? >> > ? ? ? ? ? ? ? ? # Following line works under 2.10.1
>> but now throws
>> ? ? >> > ? ? ? ? ? ? ? ? # Error: evaluation nested too deeply:
>> ? ? >> infinite recursion / options(expressions=)?
>> ? ? >> > ? ? ? ? ? ? ? ? #####.Object[["test2"]] <- "Bar"
>> ? ? >> > ? ? ? ? ? ? ? ? # The following does what I want though
>> ? ? >> > ? ? ? ? ? ? ? ? .Object$test3 <- "Baa"
>> ? ? >> >
>> ? ? >> > ? ? ? ? ? ? ? ? return(.Object)
>> ? ? >> > ? ? ? ? }
>> ? ? >> > )
>> ? ? >> >
>> ? ? >> > e <- new("PortableObject")
>> ? ? >>
>> ? ? >> The explicit example does help -- it's clear what bug you are
>> ? ? >> encountering. Here's the code in R-2.10
>> ? ? >>
>> ? ? >> > selectMethod("[[<-", ".environment")
>> ? ? >> Method Definition:
>> ? ? >>
>> ? ? >> function (x, i, j, ..., value)
>> ? ? >> {
>> ? ? >> call <- sys.call()
>> ? ? >> call[[2]] <- x at .Data
>> ? ? >> eval.parent(call)
>> ? ? >> x
>> ? ? >> }
>> ? ? >>
>> ? ? >>
>> ? ? >> and 2.11.1
>> ? ? >>
>> ? ? >> > selectMethod("[[<-", ".environment")
>> ? ? >> Method Definition:
>> ? ? >>
>> ? ? >> function (x, i, j, ..., value)
>> ? ? >> {
>> ? ? >> .local <- function (x, i, j, ..., exact = TRUE, value)
>> ? ? >> {
>> ? ? >> call <- sys.call()
>> ? ? >> call[[2]] <- x at .Data
>> ? ? >> eval.parent(call)
>> ? ? >> x
>> ? ? >> }
>> ? ? >> .local(x, i, j, ..., value = value)
>> ? ? >> }
>> ? ? >>
>> ? ? >> Apparently the 'exact' argument has been added, and because
>> ? ? >> the method signature differs from the generic, a .local
>> ? ? >> function is created. That 'sys.call()' originally returned
>> ? ? >> the environment in which the generic was called, but now it
>> ? ? >> returns the environment in which .local is defined. And so
>> ? ? >> eval() keeps evaluating .local(). This I think is a bug.
>>
>> ? ? TR> Yes, afer the email from William Dunlop, I found this
>> difference in the methods between 2.10.1 and 2.11.1
>> ? ? TR> I had a play and by adding my own method to overload
>> "[[<-" for my PortableObject was able to reinstate the
>> original functionality without the recursive error.
>>
>> ? ? TR> setMethod("[[<-", "PortableObject",
>> ? ? TR> function (x, i, j, ..., value)
>> ? ? TR> {
>> ? ? TR> call <- sys.call()
>> ? ? TR> call[[2]] <- x at .Data
>> ? ? TR> eval.parent(call)
>> ? ? TR> x
>> ? ? TR> }
>> ? ? TR> )
>>
>> ? ? >>
>> ? ? >> For what it's worth, if I were interested in minimizing
>> ? ? >> copying I would set up initialize so that it ended with
>> ? ? >> callNextMethod(<...>), on the hopes that the method
>> ? ? >> eventually called would take care not to make too many copies
>> ? ? >> on slot assignment.
>> ? ? >>
>> ? ? >> Martin
>> ? ? >>
>>
>> ? ? TR> Hmmm, not sure what you mean here? ?My code passes
>> objects such as these as parameters to other S4 classes which
>> alter their data. ?If the .xData slot is used then I have no
>> need to return the object. ?No copy-on-change is performed
>> but data held by the PortableObject is modified. ?This speeds
>> up my execution time by a LARGE amount.
>>
>> ? ? TR> I could very well have things all arse-about, having
>> come from a Java OO background, but this is the only way I
>> have been able to create a pass-by-reference paradigm using
>> S4 classes. ?Any suggestions for alternative solutions would
>> be greatfully received.
>>
>> ? ? TR> Troy
>>
>> R 2.12.2 (currently beta) has in its NEWS :
>>
>> ? ? o A facility for defining reference-based S4 classes (in the OOP
>> ? ? ? style of Java, C++, etc.) has been added experimentally to
>> ? ? ? package methods; see ?ReferenceClasses.
>>
>> ---> Please get R-2.12.2 beta and tell here about your
>> experiences. John Chambers (you have in CC) will be
>> particularly interested in your feedback.
>>
>> Martin Maechler, ETH Zurich
>>
>>
>
> Well...
>
> Just been having a read of the doco for the new reference classes.
> This opens up a whole new world in R doesn't it. ?Very exciting.
> Except for the fact that it negates a lot of what I have been doing on top of S4 objects. ?I will probably now be rewritting a lot of code. ?Ouch!
>
> I'll start having a bit of a play and exploring this new way of doing things and let you know how I go.
> Will probably have questions along the way too.
>
> Thank you to everyone involved for their hard work.
>
> Troy
> ___________________________________________________________________________
>
> ? ?Australian Antarctic Division - Commonwealth of Australia
> IMPORTANT: This transmission is intended for the addressee only. If you are not the
> intended recipient, you are notified that use or dissemination of this communication is
> strictly prohibited by Commonwealth law. If you have received this transmission in error,
> please notify the sender immediately by e-mail or by telephoning +61 3 6232 3209 and
> DELETE the message.
> ? ? ? ?Visit our web site at http://www.antarctica.gov.au/
> ___________________________________________________________________________
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From Troy.Robertson at aad.gov.au  Fri Oct  8 08:25:04 2010
From: Troy.Robertson at aad.gov.au (Troy Robertson)
Date: Fri, 8 Oct 2010 17:25:04 +1100
Subject: [Rd] Recursion error after upgrade to R_2.11.1
 [Sec=Unclassified] [Sec=Unclassified]
In-Reply-To: <AANLkTinP+_H9JKzuOTTzO_W8Qk=Umr3DCMk_BrZOSZUF@mail.gmail.com>
Message-ID: <42C7503E0B99F248B06BC65E7D2B4E020187DD725A07@EX2K7-CCR.AAD.GOV.AU>

Thanks Kasper,
I have been meaning to have a good look at some of the Bioconductor source for a while now.  So will check it out.
But I am also quite enthusiastic about what is happening with referenced classes and will be having a good play around with that in the coming weeks.

Troy

> -----Original Message-----
> From: Kasper Daniel Hansen [mailto:kasperdanielhansen at gmail.com]
> Sent: Friday, 8 October 2010 3:13 PM
> To: Troy Robertson
> Cc: Martin Maechler; r-devel at R-project.org; John Chambers
> Subject: Re: [Rd] Recursion error after upgrade to R_2.11.1
> [Sec=Unclassified] [Sec=Unclassified]
>
>
> Troy
>
> For what it's worth, the ExpressionSet / eSet class in
> Biobase from Bioconductor has for a long time implemented a
> pass-by-reference system, using amongst other stuff locked
> environments to make sure things are read only.  You might
> find this useful to look at.
>
> In general it is hard to complement on your use case without
> knowing the details.  I often find that careful programming
> and profiling can make R code much faster than initially
> hypotised.  Having said that, sometimes (esp. for very big,
> read-only  objects) environments make sense.
>
> Kasper
>
> On Thu, Oct 7, 2010 at 6:52 PM, Troy Robertson
> <Troy.Robertson at aad.gov.au> wrote:
> >> -----Original Message-----
> >> From: Martin Maechler [mailto:maechler at stat.math.ethz.ch]
> >> Sent: Thursday, 7 October 2010 9:50 PM
> >> To: Troy Robertson
> >> Cc: 'Martin Morgan'; 'r-devel at R-project.org'; 'John Chambers'
> >> Subject: Re: [Rd] Recursion error after upgrade to R_2.11.1
> >> [Sec=Unclassified] [Sec=Unclassified]
> >>
> >>
> >> >>>>> "TR" == Troy Robertson <Troy.Robertson at aad.gov.au>
> >> >>>>>     on Thu, 7 Oct 2010 13:50:49 +1100 writes:
> >>
> >>     >>
> >>     >> On 10/06/2010 06:12 PM, Troy Robertson wrote:
> >>     >> > Hi all,
> >>     >> >
> >>     >> > After no replies to my previous message I thought I might
> >> show some
> >>     >> > code to demonstrate the change and again seek any
> >>     >> explanation for the
> >>     >> > error now thrown by my code after upgrading from
> 2.10.1 to
> >> 2.11.1.
> >>     >> >
> >>     >> > Thanks
> >>     >> > Troy
> >>     >> > --------------------------------------------------------
> >>     >> > setClass("PortableObject",
> >>     >> >         representation(test1    = "character"),
> >>     >> >
> >>     >> >         prototype(      test1   = ""),
> >>     >> >           contains = ".environment"
> >>     >> > )
> >>     >> >
> >>     >> > setMethod("initialize", "PortableObject",
> >>     >> >     function(.Object, ...,
> >> .xData=new.env(parent=emptyenv())) {
> >>     >> >                 .Object <- callNextMethod(.Object, ...,
> >>     >> .xData=.xData)
> >>     >> >
> >>     >> >                 .Object at test1 <- "Foo"
> >>     >> >                 # Following line works under 2.10.1
> >> but now throws
> >>     >> >                 # Error: evaluation nested too deeply:
> >>     >> infinite recursion / options(expressions=)?
> >>     >> >                 #####.Object[["test2"]] <- "Bar"
> >>     >> >                 # The following does what I want though
> >>     >> >                 .Object$test3 <- "Baa"
> >>     >> >
> >>     >> >                 return(.Object)
> >>     >> >         }
> >>     >> > )
> >>     >> >
> >>     >> > e <- new("PortableObject")
> >>     >>
> >>     >> The explicit example does help -- it's clear what
> bug you are
> >>     >> encountering. Here's the code in R-2.10
> >>     >>
> >>     >> > selectMethod("[[<-", ".environment")
> >>     >> Method Definition:
> >>     >>
> >>     >> function (x, i, j, ..., value)
> >>     >> {
> >>     >> call <- sys.call()
> >>     >> call[[2]] <- x at .Data
> >>     >> eval.parent(call)
> >>     >> x
> >>     >> }
> >>     >>
> >>     >>
> >>     >> and 2.11.1
> >>     >>
> >>     >> > selectMethod("[[<-", ".environment")
> >>     >> Method Definition:
> >>     >>
> >>     >> function (x, i, j, ..., value)
> >>     >> {
> >>     >> .local <- function (x, i, j, ..., exact = TRUE, value)
> >>     >> {
> >>     >> call <- sys.call()
> >>     >> call[[2]] <- x at .Data
> >>     >> eval.parent(call)
> >>     >> x
> >>     >> }
> >>     >> .local(x, i, j, ..., value = value)
> >>     >> }
> >>     >>
> >>     >> Apparently the 'exact' argument has been added, and because
> >>     >> the method signature differs from the generic, a .local
> >>     >> function is created. That 'sys.call()' originally returned
> >>     >> the environment in which the generic was called, but now it
> >>     >> returns the environment in which .local is defined. And so
> >>     >> eval() keeps evaluating .local(). This I think is a bug.
> >>
> >>     TR> Yes, afer the email from William Dunlop, I found this
> >> difference in the methods between 2.10.1 and 2.11.1
> >>     TR> I had a play and by adding my own method to
> overload "[[<-"
> >> for my PortableObject was able to reinstate the original
> >> functionality without the recursive error.
> >>
> >>     TR> setMethod("[[<-", "PortableObject",
> >>     TR> function (x, i, j, ..., value)
> >>     TR> {
> >>     TR> call <- sys.call()
> >>     TR> call[[2]] <- x at .Data
> >>     TR> eval.parent(call)
> >>     TR> x
> >>     TR> }
> >>     TR> )
> >>
> >>     >>
> >>     >> For what it's worth, if I were interested in minimizing
> >>     >> copying I would set up initialize so that it ended with
> >>     >> callNextMethod(<...>), on the hopes that the method
> >>     >> eventually called would take care not to make too
> many copies
> >>     >> on slot assignment.
> >>     >>
> >>     >> Martin
> >>     >>
> >>
> >>     TR> Hmmm, not sure what you mean here?  My code passes objects
> >> such as these as parameters to other S4 classes which alter their
> >> data.  If the .xData slot is used then I have no need to
> return the
> >> object.  No copy-on-change is performed but data held by the
> >> PortableObject is modified.  This speeds up my execution time by a
> >> LARGE amount.
> >>
> >>     TR> I could very well have things all arse-about, having come
> >> from a Java OO background, but this is the only way I have
> been able
> >> to create a pass-by-reference paradigm using S4 classes.  Any
> >> suggestions for alternative solutions would be greatfully received.
> >>
> >>     TR> Troy
> >>
> >> R 2.12.2 (currently beta) has in its NEWS :
> >>
> >>     o A facility for defining reference-based S4 classes
> (in the OOP
> >>       style of Java, C++, etc.) has been added experimentally to
> >>       package methods; see ?ReferenceClasses.
> >>
> >> ---> Please get R-2.12.2 beta and tell here about your
> >> experiences. John Chambers (you have in CC) will be particularly
> >> interested in your feedback.
> >>
> >> Martin Maechler, ETH Zurich
> >>
> >>
> >
> > Well...
> >
> > Just been having a read of the doco for the new reference classes.
> > This opens up a whole new world in R doesn't it.  Very exciting.
> > Except for the fact that it negates a lot of what I have
> been doing on
> > top of S4 objects.  I will probably now be rewritting a lot
> of code.
> > Ouch!
> >
> > I'll start having a bit of a play and exploring this new
> way of doing
> > things and let you know how I go. Will probably have
> questions along
> > the way too.
> >
> > Thank you to everyone involved for their hard work.
> >
> > Troy
> >
> ______________________________________________________________________
> > _____
> >
> >    Australian Antarctic Division - Commonwealth of Australia
> > IMPORTANT: This transmission is intended for the addressee only. If
> > you are not the intended recipient, you are notified that use or
> > dissemination of this communication is strictly prohibited by
> > Commonwealth law. If you have received this transmission in error,
> > please notify the sender immediately by e-mail or by
> telephoning +61 3 6232 3209 and DELETE the message.
> >        Visit our web site at http://www.antarctica.gov.au/
> >
> ______________________________________________________________________
> > _____
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >
>
___________________________________________________________________________

    Australian Antarctic Division - Commonwealth of Australia
IMPORTANT: This transmission is intended for the addressee only. If you are not the
intended recipient, you are notified that use or dissemination of this communication is
strictly prohibited by Commonwealth law. If you have received this transmission in error,
please notify the sender immediately by e-mail or by telephoning +61 3 6232 3209 and
DELETE the message.
        Visit our web site at http://www.antarctica.gov.au/
___________________________________________________________________________


From spinuvit.list at gmail.com  Fri Oct  8 10:53:01 2010
From: spinuvit.list at gmail.com (Vitalie Spinu)
Date: Fri, 8 Oct 2010 10:53:01 +0200
Subject: [Rd] NULL assignment will change the expression's class into list
Message-ID: <AANLkTinLmOiRjZA_DhsbYwgCv=ZhQ0DoP-a3hUacG8GP@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20101008/aae2b944/attachment.pl>

From mk2391 at hotmail.com  Fri Oct  8 12:09:29 2010
From: mk2391 at hotmail.com (Martin Kerr)
Date: Fri, 8 Oct 2010 11:09:29 +0100
Subject: [Rd] Selecting multiple columns with same name
In-Reply-To: <mailman.21.1286445608.10801.r-devel@r-project.org>
References: <mailman.21.1286445608.10801.r-devel@r-project.org>
Message-ID: <COL117-W21736827679B3ADEF6E7EC0500@phx.gbl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20101008/bc811f88/attachment.pl>

From murdoch.duncan at gmail.com  Fri Oct  8 12:14:01 2010
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Fri, 08 Oct 2010 06:14:01 -0400
Subject: [Rd] NULL assignment will change the expression's class into
 list
In-Reply-To: <AANLkTinLmOiRjZA_DhsbYwgCv=ZhQ0DoP-a3hUacG8GP@mail.gmail.com>
References: <AANLkTinLmOiRjZA_DhsbYwgCv=ZhQ0DoP-a3hUacG8GP@mail.gmail.com>
Message-ID: <4CAEEEE9.6040607@gmail.com>

Vitalie Spinu wrote:
> Hello Everyone!
>
> NULL replacement will change expression object into list:
>
>   
>> te <- expression(a=23*4, b=33-2)
>> te
>>     
> expression(a = 23 * 4, b = 33 - 2)
>
>   
>> te[["a"]] <- quote(blabla) #ok
>> te
>>     
> expression(a = blabla, b = 33 - 2)
>
>   
>> te[["a"]] <- NULL #change to list
>> te
>>     
> $b
> 33 - 2
>
> I am on w32, version 2.11.1 (2010-05-31)
>   

That's certainly an inconsistency, still present in a recent R-devel 
(but I haven't checked the latest beta).  I don't know if it's a bug:  
NULL assignments are handled specially in other situations (e.g. if te 
was a list to start, the NULL assignment would remove the "a" entry).

A simple workaround is to use

te["a"] <- expression(NULL)

or te <- te[-1]

instead, depending on what you expected to happen.

Duncan Murdoch

> Regards,
> Vitally.
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From ripley at stats.ox.ac.uk  Fri Oct  8 15:42:56 2010
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 8 Oct 2010 14:42:56 +0100 (BST)
Subject: [Rd] model.frame deficiency
In-Reply-To: <1286493457.21613.36.camel@punchbuggy>
References: <1286493457.21613.36.camel@punchbuggy>
Message-ID: <alpine.LFD.2.00.1010081426230.28457@toucan.stats.ox.ac.uk>

At least for me, the problem is not to do with the length of 
formula.  You have a term in the formula with a very long name, and 
there are several places that can go wrong.  For example, for the N=20 
version I get

> model.frame(as.formula(temp2), tdata) -> foo
> foo
Error in do.call("data.frame", rval) :
   variable names are limited to 256 bytes

For the N=50 case the sticking point is

     varnames <- sapply(vars, deparse, width.cutoff = 500)[-1L]

which could be rewritten as

     varnames <- sapply(vars, function(x) paste(deparse(x,width.cutoff=500), collapse=' '))[-1L]

but you would still not be able to print the result.


On Thu, 7 Oct 2010, Terry Therneau wrote:

> The model.frame function has trouble with a certain type of really long
> formula.  Here is a test:
>
> tname <- paste('var', 1:50, sep='')
> tmat <- matrix(rnorm(500), ncol=50, dimnames=list(NULL, tname))
> tdata <- data.frame(tmat)
>
> temp1 <- paste( paste(tname, tname, sep='='), collapse=', ')
> temp2 <- paste("~1 + cbind(", temp1, ")")
> model.frame(as.formula(temp2), tdata)
>
> This came out of a user report to me.  Coxph with a very long formula
> (which does work) followed by a call to survexp leads to a call like the
> above but using my "ratetable" function instead of "cbind".
>
> My machine's details:
> R version 2.10.0 (2009-10-26)
> x86_64-unknown-linux-gnu
>
> locale:
> [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
> [3] LC_TIME=en_US.UTF-8        LC_COLLATE=C
> [5] LC_MONETARY=C              LC_MESSAGES=en_US.UTF-8
> [7] LC_PAPER=en_US.UTF-8       LC_NAME=C
> [9] LC_ADDRESS=C               LC_TELEPHONE=C
> [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
>
> attached base packages:
> [1] grDevices datasets  splines   graphics  utils     stats
> methods
> [8] base
>
>
> Editorial comment: I said "deficiency" not "bug" above, as I'm not so
> sure how good a model with 75 variables might be in the first place.
> (Though in this case the user is pretty savvy.)
>
> Terry Therneau
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From spinuvit.list at gmail.com  Fri Oct  8 18:24:58 2010
From: spinuvit.list at gmail.com (Vitalie Spinu)
Date: Fri, 8 Oct 2010 18:24:58 +0200
Subject: [Rd] NULL assignment will change the expression's class into
	list
In-Reply-To: <4CAEEEE9.6040607@gmail.com>
References: <AANLkTinLmOiRjZA_DhsbYwgCv=ZhQ0DoP-a3hUacG8GP@mail.gmail.com>
	<4CAEEEE9.6040607@gmail.com>
Message-ID: <AANLkTikEDqTcLeg5X_EELkPTqvFJEu6HLFkOaD4iOr-3@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20101008/b1f7b858/attachment.pl>

From murdoch.duncan at gmail.com  Fri Oct  8 19:49:32 2010
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Fri, 08 Oct 2010 13:49:32 -0400
Subject: [Rd] NULL assignment will change the expression's class into
 list
In-Reply-To: <AANLkTikEDqTcLeg5X_EELkPTqvFJEu6HLFkOaD4iOr-3@mail.gmail.com>
References: <AANLkTinLmOiRjZA_DhsbYwgCv=ZhQ0DoP-a3hUacG8GP@mail.gmail.com>	<4CAEEEE9.6040607@gmail.com>
	<AANLkTikEDqTcLeg5X_EELkPTqvFJEu6HLFkOaD4iOr-3@mail.gmail.com>
Message-ID: <4CAF59AC.2080104@gmail.com>

  On 08/10/2010 12:24 PM, Vitalie Spinu wrote:
> On Fri, Oct 8, 2010 at 12:14 PM, Duncan Murdoch<murdoch.duncan at gmail.com>wrote:
>
> >  Vitalie Spinu wrote:
> >
> >>  Hello Everyone!
> >>
> >>  NULL replacement will change expression object into list:
> >>
> >>
> >>
> >>>  te<- expression(a=23*4, b=33-2)
> >>>  te
> >>>
> >>>
> >>  expression(a = 23 * 4, b = 33 - 2)
> >>
> >>
> >>
> >>>  te[["a"]]<- quote(blabla) #ok
> >>>  te
> >>>
> >>>
> >>  expression(a = blabla, b = 33 - 2)
> >>
> >>
> >>
> >>>  te[["a"]]<- NULL #change to list
> >>>  te
> >>>
> >>>
> >>  $b
> >>  33 - 2
> >>
> >>  I am on w32, version 2.11.1 (2010-05-31)
> >>
> >>
> >
> >  That's certainly an inconsistency, still present in a recent R-devel (but I
> >  haven't checked the latest beta).  I don't know if it's a bug:  NULL
> >  assignments are handled specially in other situations (e.g. if te was a list
> >  to start, the NULL assignment would remove the "a" entry).
> >
> >  A simple workaround is to use
> >
> >  te["a"]<- expression(NULL)
> >
> >  or te<- te[-1]
> >
> >  instead, depending on what you expected to happen.
> >
>
> As ussual with NULL assignment in recursive structures, I would expect to
> remove the elements altogether. And this is exactly what I need.
>
> I would say it's a bug, because NULL assignment in data.frames would not
> convert them to lists, for example.

I think you're probably right.
> Thanks for looking into it. It's quite inconvenient when you have to
> manipulate named expression. Have to use constructs like
> et<-et[!names(et)%in%"a"].

Or simply follow te["a"] <- NULL

with

te <- as.expression(te)

This is a pretty fast operation if te is an expression or a list formed 
by mistaken conversion from one.

Duncan Murdoch

> Vitally.
>
> >
> >  Duncan Murdoch
> >
> >   Regards,
> >>  Vitally.
> >>
> >>         [[alternative HTML version deleted]]
> >>
> >>  ______________________________________________
> >>  R-devel at r-project.org mailing list
> >>  https://stat.ethz.ch/mailman/listinfo/r-devel
> >>
> >>
> >
> >
>


From spinuvit.list at gmail.com  Fri Oct  8 21:40:32 2010
From: spinuvit.list at gmail.com (Vitalie Spinu)
Date: Fri, 8 Oct 2010 21:40:32 +0200
Subject: [Rd] NULL assignment will change the expression's class into
	list
In-Reply-To: <4CAF59AC.2080104@gmail.com>
References: <AANLkTinLmOiRjZA_DhsbYwgCv=ZhQ0DoP-a3hUacG8GP@mail.gmail.com>
	<4CAEEEE9.6040607@gmail.com>
	<AANLkTikEDqTcLeg5X_EELkPTqvFJEu6HLFkOaD4iOr-3@mail.gmail.com>
	<4CAF59AC.2080104@gmail.com>
Message-ID: <AANLkTim=ZGQRJL2uq3M3NjqaUYWGfHK7ewCJzXy6hjwN@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20101008/9f1f02ce/attachment.pl>

From edd at debian.org  Fri Oct  8 22:25:27 2010
From: edd at debian.org (Dirk Eddelbuettel)
Date: Fri, 8 Oct 2010 15:25:27 -0500
Subject: [Rd] R 2.12.0 alpha/beta/rc warning: spurious or not?
Message-ID: <19631.32311.566706.14493@max.nulle.part>


With several versions of R 2.12.0 I have been seeing this when running

  R CMD build Rcpp

from the SVN sources:

  [...]
  Transcript written on Rd2.log.
  Saving output to '/home/edd/svn/rcpp/pkg/Rcpp/build/Rcpp.pdf' ...
  Warning in file.create(to[okay]) :
    cannot create file '/home/edd/svn/rcpp/pkg/Rcpp/build/Rcpp.pdf', reson 'No such file or directory'
  Done
  [...]

which looks like a simple case of a missing 'mkdir build'.  Or is there
something else at work I am overlooking?   NEWS has no hint about this as far
as I can tell.

Also, the error disappears when I create a directory build/ inside of my
package sources.

It is still present with the RC tarball wrapped up last night (r53227).

Dirk

-- 
Dirk Eddelbuettel | edd at debian.org | http://dirk.eddelbuettel.com


From mtmorgan at fhcrc.org  Sat Oct  9 00:11:14 2010
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Fri, 08 Oct 2010 15:11:14 -0700
Subject: [Rd] R 2.12.0 alpha/beta/rc warning: spurious or not?
In-Reply-To: <19631.32311.566706.14493@max.nulle.part>
References: <19631.32311.566706.14493@max.nulle.part>
Message-ID: <4CAF9702.1090806@fhcrc.org>

On 10/08/2010 01:25 PM, Dirk Eddelbuettel wrote:
> 
> With several versions of R 2.12.0 I have been seeing this when running
> 
>   R CMD build Rcpp
> 
> from the SVN sources:
> 
>   [...]
>   Transcript written on Rd2.log.
>   Saving output to '/home/edd/svn/rcpp/pkg/Rcpp/build/Rcpp.pdf' ...
>   Warning in file.create(to[okay]) :
>     cannot create file '/home/edd/svn/rcpp/pkg/Rcpp/build/Rcpp.pdf', reson 'No such file or directory'
>   Done
>   [...]
> 
> which looks like a simple case of a missing 'mkdir build'.  Or is there
> something else at work I am overlooking?   NEWS has no hint about this as far
> as I can tell.
> 
> Also, the error disappears when I create a directory build/ inside of my
> package sources.
> 
> It is still present with the RC tarball wrapped up last night (r53227).

Similar to this

  https://stat.ethz.ch/pipermail/r-devel/2010-September/058399.html

I think.

Martin
> 
> Dirk
> 


-- 
Computational Biology
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N. PO Box 19024 Seattle, WA 98109

Location: M1-B861
Telephone: 206 667-2793


From hadley at rice.edu  Sat Oct  9 00:32:05 2010
From: hadley at rice.edu (Hadley Wickham)
Date: Fri, 8 Oct 2010 17:32:05 -0500
Subject: [Rd] What do you call the value that represents a missing argument?
Message-ID: <AANLkTinE7+NhYw=8hxHi5nW+pWYWdRVjgJScm0ky_W1W@mail.gmail.com>

Hi all,

What's the official name for the value that represents a missing argument?

e.g.
formals(plot)$x
str(formals(plot)$x)
deparse(formals(plot)$x)
is.symbol(formals(plot)$x)

What's the correct way to create an object like this?  (for example if
you are manipulating the formals of a function to add an argument with
no default value, as in http://stackoverflow.com/questions/3892580/).
as.symbol("") returns an error.  Both substitute() and bquote() return
that object, but it's not obvious if this is on purpose.

Hadley


-- 
Assistant Professor / Dobelman Family Junior Chair
Department of Statistics / Rice University
http://had.co.nz/


From edd at debian.org  Sat Oct  9 00:46:34 2010
From: edd at debian.org (Dirk Eddelbuettel)
Date: Fri, 8 Oct 2010 17:46:34 -0500
Subject: [Rd] R 2.12.0 alpha/beta/rc warning: spurious or not?
In-Reply-To: <4CAF9702.1090806@fhcrc.org>
References: <19631.32311.566706.14493@max.nulle.part>
	<4CAF9702.1090806@fhcrc.org>
Message-ID: <19631.40778.86110.728499@max.nulle.part>


On 8 October 2010 at 15:11, Martin Morgan wrote:
| On 10/08/2010 01:25 PM, Dirk Eddelbuettel wrote:
| > 
| > With several versions of R 2.12.0 I have been seeing this when running
| > 
| >   R CMD build Rcpp
| > 
| > from the SVN sources:
| > 
| >   [...]
| >   Transcript written on Rd2.log.
| >   Saving output to '/home/edd/svn/rcpp/pkg/Rcpp/build/Rcpp.pdf' ...
| >   Warning in file.create(to[okay]) :
| >     cannot create file '/home/edd/svn/rcpp/pkg/Rcpp/build/Rcpp.pdf', reson 'No such file or directory'
| >   Done
| >   [...]
| > 
| > which looks like a simple case of a missing 'mkdir build'.  Or is there
| > something else at work I am overlooking?   NEWS has no hint about this as far
| > as I can tell.
| > 
| > Also, the error disappears when I create a directory build/ inside of my
| > package sources.
| > 
| > It is still present with the RC tarball wrapped up last night (r53227).
| 
| Similar to this
| 
|   https://stat.ethz.ch/pipermail/r-devel/2010-September/058399.html
| 
| I think.

Seems so. Did anybody ever get back to you?  

Maybe build/ is now an undocumented requirement....

Dirk

-- 
Dirk Eddelbuettel | edd at debian.org | http://dirk.eddelbuettel.com


From murdoch.duncan at gmail.com  Sat Oct  9 01:26:05 2010
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Fri, 08 Oct 2010 19:26:05 -0400
Subject: [Rd] NULL assignment will change the expression's class into
 list
In-Reply-To: <AANLkTim=ZGQRJL2uq3M3NjqaUYWGfHK7ewCJzXy6hjwN@mail.gmail.com>
References: <AANLkTinLmOiRjZA_DhsbYwgCv=ZhQ0DoP-a3hUacG8GP@mail.gmail.com>	<4CAEEEE9.6040607@gmail.com>	<AANLkTikEDqTcLeg5X_EELkPTqvFJEu6HLFkOaD4iOr-3@mail.gmail.com>	<4CAF59AC.2080104@gmail.com>
	<AANLkTim=ZGQRJL2uq3M3NjqaUYWGfHK7ewCJzXy6hjwN@mail.gmail.com>
Message-ID: <4CAFA88D.1050509@gmail.com>

Vitalie Spinu wrote:
> On Fri, Oct 8, 2010 at 7:49 PM, Duncan Murdoch <murdoch.duncan at gmail.com>wrote:
>
>   
>>  On 08/10/2010 12:24 PM, Vitalie Spinu wrote:
>>
>>     
>>> On Fri, Oct 8, 2010 at 12:14 PM, Duncan Murdoch<murdoch.duncan at gmail.com
>>>       
>>>> wrote:
>>>>         
>>>>  Vitalie Spinu wrote:
>>>>
>>>>         
>>>>>  Hello Everyone!
>>>>>
>>>>>  NULL replacement will change expression object into list:
>>>>>
>>>>>
>>>>>
>>>>>           
>>>>>>  te<- expression(a=23*4, b=33-2)
>>>>>>  te
>>>>>>
>>>>>>
>>>>>>             
>>>>>  expression(a = 23 * 4, b = 33 - 2)
>>>>>
>>>>>
>>>>>
>>>>>           
>>>>>>  te[["a"]]<- quote(blabla) #ok
>>>>>>  te
>>>>>>
>>>>>>
>>>>>>             
>>>>>  expression(a = blabla, b = 33 - 2)
>>>>>
>>>>>
>>>>>
>>>>>           
>>>>>>  te[["a"]]<- NULL #change to list
>>>>>>  te
>>>>>>
>>>>>>
>>>>>>             
>>>>>  $b
>>>>>  33 - 2
>>>>>
>>>>>  I am on w32, version 2.11.1 (2010-05-31)
>>>>>
>>>>>
>>>>>           
>>>>  That's certainly an inconsistency, still present in a recent R-devel
>>>>         
>>> (but I
>>>       
>>>>  haven't checked the latest beta).  I don't know if it's a bug:  NULL
>>>>  assignments are handled specially in other situations (e.g. if te was a
>>>>         
>>> list
>>>       
>>>>  to start, the NULL assignment would remove the "a" entry).
>>>>
>>>>  A simple workaround is to use
>>>>
>>>>  te["a"]<- expression(NULL)
>>>>
>>>>  or te<- te[-1]
>>>>
>>>>  instead, depending on what you expected to happen.
>>>>
>>>>         
>>> As ussual with NULL assignment in recursive structures, I would expect to
>>> remove the elements altogether. And this is exactly what I need.
>>>
>>> I would say it's a bug, because NULL assignment in data.frames would not
>>> convert them to lists, for example.
>>>
>>>       
>> I think you're probably right.
>>
>>  Thanks for looking into it. It's quite inconvenient when you have to
>>     
>>> manipulate named expression. Have to use constructs like
>>> et<-et[!names(et)%in%"a"].
>>>
>>>       
>> Or simply follow te["a"] <- NULL
>>
>> with
>>
>> te <- as.expression(te)
>>
>> This is a pretty fast operation if te is an expression or a list formed by
>> mistaken conversion from one.
>>
>> D
>>     
>
> But is this a reliable way to do it? I have been struggling some time ago
> with this type of conversion.
> Can not thing of an example now. But as far as I could remember, the
> conversion to list of an expression is not always reversible with
> as.expression. Am I wrong?
>   

I don't know of any examples, but this is your construction.  I think 
it's very unlikely this will be fixed for 2.12.0, but it will probably 
be fixed for 2.12.1, if

1.  There is a 2.12.1

and

2.  It really isn't intentional behaviour.


Duncan Murdoch
>
>   
>> uncan Murdoch
>>
>>
>>  Vitally.
>>     
>>>>  Duncan Murdoch
>>>>
>>>>   Regards,
>>>>         
>>>>>  Vitally.
>>>>>
>>>>>         [[alternative HTML version deleted]]
>>>>>
>>>>>  ______________________________________________
>>>>>  R-devel at r-project.org mailing list
>>>>>  https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>>
>>>>>
>>>>>           
>>>>         
>>>       
>
>


From cberry at tajo.ucsd.edu  Sat Oct  9 05:08:10 2010
From: cberry at tajo.ucsd.edu (Charles C. Berry)
Date: Fri, 8 Oct 2010 20:08:10 -0700
Subject: [Rd] What do you call the value that represents a missing
 argument?
In-Reply-To: <AANLkTinE7+NhYw=8hxHi5nW+pWYWdRVjgJScm0ky_W1W@mail.gmail.com>
References: <AANLkTinE7+NhYw=8hxHi5nW+pWYWdRVjgJScm0ky_W1W@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.1010082003070.10738@tajo.ucsd.edu>

On Fri, 8 Oct 2010, Hadley Wickham wrote:

> Hi all,
>
> What's the official name for the value that represents a missing argument?
>
> e.g.
> formals(plot)$x

See ?list

It is a 'dotted pair list'

Are you looking for 'alist'?

"alist handles its arguments as if they described function arguments. So 
the values are not evaluated, and tagged arguments with no value are 
allowed whereas list simply ignores them. alist is most often used in 
conjunction with formals."

> alist(x=)$x==formals(plot)$x
[1] TRUE
>

HTH,

Chuck

> str(formals(plot)$x)
> deparse(formals(plot)$x)
> is.symbol(formals(plot)$x)
>
> What's the correct way to create an object like this?  (for example if
> you are manipulating the formals of a function to add an argument with
> no default value, as in http://stackoverflow.com/questions/3892580/).
> as.symbol("") returns an error.  Both substitute() and bquote() return
> that object, but it's not obvious if this is on purpose.
>
> Hadley
>
>
> -- 
> Assistant Professor / Dobelman Family Junior Chair
> Department of Statistics / Rice University
> http://had.co.nz/
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

Charles C. Berry                            (858) 534-2098
                                             Dept of Family/Preventive Medicine
E mailto:cberry at tajo.ucsd.edu	            UC San Diego
http://famprevmed.ucsd.edu/faculty/cberry/  La Jolla, San Diego 92093-0901


From spinuvit.list at gmail.com  Sat Oct  9 11:33:38 2010
From: spinuvit.list at gmail.com (Vitally S.)
Date: Sat, 09 Oct 2010 11:33:38 +0200
Subject: [Rd] What do you call the value that represents a missing
	argument?
References: <AANLkTinE7+NhYw=8hxHi5nW+pWYWdRVjgJScm0ky_W1W@mail.gmail.com>
Message-ID: <cpnzkunk8wd.fsf@gmail.com>

Hadley Wickham <hadley at rice.edu> writes:

> What's the correct way to create an object like this?  (for example if
> you are manipulating the formals of a function to add an argument with
> no default value, as in http://stackoverflow.com/questions/3892580/).as.symbol("") returns an error.  Both substitute() and bquote() return
> that object, but it's not obvious if this is on purpose.

The question on stackoverflow was concerned with the creation of such an object:

Obvious way:
x <- alist(x=)$x

Because the object like that seems to be a zero length name 

as.symbol("") #should be able to produce it

quote() #is another meaningful candidate which does not work

instead substitute() and bquote() works fine. Funny thing is that the behavior
of bquote() and quote() are not expected to be different in this case.

Vitally.


>
> Hadley


From pburns at pburns.seanet.com  Sat Oct  9 12:16:31 2010
From: pburns at pburns.seanet.com (Patrick Burns)
Date: Sat, 09 Oct 2010 11:16:31 +0100
Subject: [Rd] symbol and symbols help files
Message-ID: <4CB040FF.6050001@pburns.seanet.com>

I think it makes sense to have
'symbol' in the See Also of 'symbols'
and vice versa.


-- 
Patrick Burns
pburns at pburns.seanet.com
http://www.portfolioprobe.com/blog
http://www.burns-stat.com
(home of 'Some hints for the R beginner'
and 'The R Inferno')


From hadley at rice.edu  Sat Oct  9 13:51:51 2010
From: hadley at rice.edu (Hadley Wickham)
Date: Sat, 9 Oct 2010 06:51:51 -0500
Subject: [Rd] What do you call the value that represents a missing
	argument?
In-Reply-To: <Pine.LNX.4.64.1010082003070.10738@tajo.ucsd.edu>
References: <AANLkTinE7+NhYw=8hxHi5nW+pWYWdRVjgJScm0ky_W1W@mail.gmail.com>
	<Pine.LNX.4.64.1010082003070.10738@tajo.ucsd.edu>
Message-ID: <AANLkTi==+Wsx-6fZMEquZtrwWmK2vLK3-6rbaRS6NLsw@mail.gmail.com>

> It is a 'dotted pair list'

But:

> is.pairlist(formals(plot)$x)
[1] FALSE

Hadley

-- 
Assistant Professor / Dobelman Family Junior Chair
Department of Statistics / Rice University
http://had.co.nz/


From pdalgd at gmail.com  Sat Oct  9 17:24:07 2010
From: pdalgd at gmail.com (Peter Dalgaard)
Date: Sat, 09 Oct 2010 17:24:07 +0200
Subject: [Rd] What do you call the value that represents a missing
	argument?
In-Reply-To: <AANLkTi==+Wsx-6fZMEquZtrwWmK2vLK3-6rbaRS6NLsw@mail.gmail.com>
References: <AANLkTinE7+NhYw=8hxHi5nW+pWYWdRVjgJScm0ky_W1W@mail.gmail.com>	<Pine.LNX.4.64.1010082003070.10738@tajo.ucsd.edu>
	<AANLkTi==+Wsx-6fZMEquZtrwWmK2vLK3-6rbaRS6NLsw@mail.gmail.com>
Message-ID: <4CB08917.7040807@gmail.com>

On 10/09/2010 01:51 PM, Hadley Wickham wrote:
>> It is a 'dotted pair list'
> 
> But:
> 
>> is.pairlist(formals(plot)$x)
> [1] FALSE
> 
> Hadley
> 

Vitaly is right that it is implemented as as.symbol(""), although
there's a safeguard against doing just that (and it is not like it is
imperative to have that particular implementation). It isn't really
supposed to live in the wild, but as you have noticed there are a couple
of ways to circumvent the safeguards, mainly due to the need to be able
to manipulate a function's argument list.

We did at some point play around with the idea of making "missing arg"
an official first-class object, but found ourselves in the same position
as the man who invented the acid that dissolves everything: These things
are hard to store....

> y <- alist(x=)$x
> z <- y
Error: argument "y" is missing, with no default

(I have forgotten whether there's a reason that the above doesn't fail
already on the assignment to y. Somehow it would have been more logical
if missing values could _only_ appear inside lists. Except in actual
function arguments, of course.)

-- 
Peter Dalgaard
Center for Statistics, Copenhagen Business School
Phone: (+45)38153501
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From berwin at maths.uwa.edu.au  Mon Oct 11 00:06:46 2010
From: berwin at maths.uwa.edu.au (Berwin A Turlach)
Date: Mon, 11 Oct 2010 06:06:46 +0800
Subject: [Rd] Query about .check_packages_used_in_examples
Message-ID: <20101011060646.0fbab35a@goodenia>

G'day all,

looking at
http://cran.at.r-project.org/web/checks/check_results_Sleuth2.html
I noticed that r-prerel-* and r-devel-* issue notes.  Apparently, now
examples are more thoroughly checked by R CMD check and the note
pointed out that a package used in the examples was not declared.  This
was easily fixed by adding 'Suggests: lattice' to the DESCRIPTION file
(now this change has to migrate through R-forge to CRAN).

But then I noticed that for another package I have on R-forge a similar
note is issued:
https://r-forge.r-project.org/R/?group_id=630&log=check_x86_64_linux&pkg=DeconWK&flavor=devel
O.k., R-forge is using R-devel, so I installed R 2.12.0 RC (2010-10-10
r53273) on my machine to check, same note is issued.

The note issued by R CMD check says:
	* checking for unstated dependencies in examples ... NOTE
	'library' or 'require' call not declared from: ks
which is a bit surprising.  

There are three .Rd files that have a library(ks) in them and ks is
listed in the Imports: of the description file.

This seems to be completely in line with the documentation in "Writing
R extensions":

	@item
	Packages whose name space only is needed to load the package
	using @code{library(@var{pkgname})} must be listed in the
	@samp{Imports} field and not in the @samp{Depends} field.

that's why ks is listed in depends

	@item
	All packages that are needed to successfully run @code{R CMD
	check} on the package must be listed in one of @samp{Depends}
	or @samp{Suggests} or @samp{Imports}. [...]

which seems to be adhered to, since ks is in the depends.

But upon digging into .check_packages_used_in_examples in QC.R in
package tools, I have the impression that packages loaded in examples
via library() or require() are only checked against packages listed in
Suggests, Enhances and Depends, the package's own name and the standard
packages, but not against those listed in Imports.  Thus, I believe
there is some disconnect between documentation and behaviour at the
moment.

In this particular case, possible solutions would be to list ks in
both, Imports and Suggests, or, to have only one entry, to move it to
Depends.  

But I believe the cleaner solution would be that
.check_packages_used_in_examples includes the packages listed in
Imports when checking whether all packages used in library() or
require() commands in examples are declared.

Cheers,

	Berwin


From berwin at maths.uwa.edu.au  Mon Oct 11 00:26:03 2010
From: berwin at maths.uwa.edu.au (Berwin A Turlach)
Date: Mon, 11 Oct 2010 06:26:03 +0800
Subject: [Rd] Query about .check_packages_used_in_examples
In-Reply-To: <20101011060646.0fbab35a@goodenia>
References: <20101011060646.0fbab35a@goodenia>
Message-ID: <20101011062603.13b56251@goodenia>

G'day all,

sorry, should proof-read better before hitting the send button...

On Mon, 11 Oct 2010 06:06:46 +0800
Berwin A Turlach <berwin at maths.uwa.edu.au> wrote:

> But then I noticed that for another package I have on R-forge a
> similar note is issued:
> https://r-forge.r-project.org/R/?group_id=630&log=check_x86_64_linux&pkg=DeconWK&flavor=devel
> O.k., R-forge is using R-devel, so I installed R 2.12.0 RC (2010-10-10
> r53273) on my machine to check, same note is issued.
> 
> The note issued by R CMD check says:
> 	* checking for unstated dependencies in examples ... NOTE
> 	'library' or 'require' call not declared from: ks
> which is a bit surprising.  
> 
> There are three .Rd files that have a library(ks) in them and ks is
> listed in the Imports: of the description file.
> 
> This seems to be completely in line with the documentation in "Writing
> R extensions":
> 
> 	@item
> 	Packages whose name space only is needed to load the package
> 	using @code{library(@var{pkgname})} must be listed in the
> 	@samp{Imports} field and not in the @samp{Depends} field.
> 
> that's why ks is listed in depends

ks is listed in the Imports: line in the DESCRIPTION file of the package
in question, not in the Depends: line.

> 	@item
> 	All packages that are needed to successfully run @code{R CMD
> 	check} on the package must be listed in one of @samp{Depends}
> 	or @samp{Suggests} or @samp{Imports}. [...]
> 
> which seems to be adhered to, since ks is in the depends.

Again, this depends should read Imports.

Sorry if this created confusion.

Cheers,

	Berwin


From hpages at fhcrc.org  Mon Oct 11 07:47:38 2010
From: hpages at fhcrc.org (=?ISO-8859-1?Q?Herv=E9_Pag=E8s?=)
Date: Sun, 10 Oct 2010 22:47:38 -0700
Subject: [Rd] 'R CMD build' not cleaning the src/ folder on Windows
Message-ID: <4CB2A4FA.6050907@fhcrc.org>

Hi,

'R CMD build' (with R 2.12.0 RC) fails to clean the src/ folder
on Windows:

   D:\biocbld\bbs-2.7-bioc>ls meat/BUS/src
   BUS.cpp  BUS.h

   D:\biocbld\bbs-2.7-bioc>R\bin\R CMD build meat\BUS
   * checking for file 'meat\BUS/DESCRIPTION' ... OK
   * preparing 'BUS':
   * checking DESCRIPTION meta-information ... OK
   * cleaning src
   * installing the package to re-build vignettes
   * creating vignettes ... OK
   * cleaning src
   * checking for LF line-endings in source and make files
   * checking for empty or unneeded directories
   * building 'BUS_1.5.0.tar.gz'

   D:\biocbld\bbs-2.7-bioc>tar ztvf BUS_1.5.0.tar.gz --wildcards '*.o'
   -rwxr--r-- biocbuild2/root 16503 2010-10-10 22:15 BUS/src/BUS.o

Packages with a Makefile in src/ don't seem to be affected.

This is with R 2.12.0 RC (2010-10-07 r53227).

Thanks,
H.

-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M2-B876
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fhcrc.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From ripley at stats.ox.ac.uk  Mon Oct 11 12:11:42 2010
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 11 Oct 2010 11:11:42 +0100 (BST)
Subject: [Rd] Query about .check_packages_used_in_examples
In-Reply-To: <20101011062603.13b56251@goodenia>
References: <20101011060646.0fbab35a@goodenia>
	<20101011062603.13b56251@goodenia>
Message-ID: <alpine.LFD.2.00.1010111108030.24058@gannet.stats.ox.ac.uk>

Sounds reasonable to count Imports, so we'll alter this.

Thank you for the report,  However, the pre-test period for 2.12.0 is 
already 80% over and we are in code freeze -- reports early on in the 
period are much more useful and at this stage anything but very simple 
localized changes need to be deferred to 2.12.1.

On Mon, 11 Oct 2010, Berwin A Turlach wrote:

> G'day all,
>
> sorry, should proof-read better before hitting the send button...
>
> On Mon, 11 Oct 2010 06:06:46 +0800
> Berwin A Turlach <berwin at maths.uwa.edu.au> wrote:
>
>> But then I noticed that for another package I have on R-forge a
>> similar note is issued:
>> https://r-forge.r-project.org/R/?group_id=630&log=check_x86_64_linux&pkg=DeconWK&flavor=devel
>> O.k., R-forge is using R-devel, so I installed R 2.12.0 RC (2010-10-10
>> r53273) on my machine to check, same note is issued.
>>
>> The note issued by R CMD check says:
>> 	* checking for unstated dependencies in examples ... NOTE
>> 	'library' or 'require' call not declared from: ks
>> which is a bit surprising.
>>
>> There are three .Rd files that have a library(ks) in them and ks is
>> listed in the Imports: of the description file.
>>
>> This seems to be completely in line with the documentation in "Writing
>> R extensions":
>>
>> 	@item
>> 	Packages whose name space only is needed to load the package
>> 	using @code{library(@var{pkgname})} must be listed in the
>> 	@samp{Imports} field and not in the @samp{Depends} field.
>>
>> that's why ks is listed in depends
>
> ks is listed in the Imports: line in the DESCRIPTION file of the package
> in question, not in the Depends: line.
>
>> 	@item
>> 	All packages that are needed to successfully run @code{R CMD
>> 	check} on the package must be listed in one of @samp{Depends}
>> 	or @samp{Suggests} or @samp{Imports}. [...]
>>
>> which seems to be adhered to, since ks is in the depends.
>
> Again, this depends should read Imports.
>
> Sorry if this created confusion.
>
> Cheers,
>
> 	Berwin
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From berwin at maths.uwa.edu.au  Mon Oct 11 20:15:27 2010
From: berwin at maths.uwa.edu.au (Berwin A Turlach)
Date: Tue, 12 Oct 2010 02:15:27 +0800
Subject: [Rd] Query about .check_packages_used_in_examples
In-Reply-To: <alpine.LFD.2.00.1010111108030.24058@gannet.stats.ox.ac.uk>
References: <20101011060646.0fbab35a@goodenia>
	<20101011062603.13b56251@goodenia>
	<alpine.LFD.2.00.1010111108030.24058@gannet.stats.ox.ac.uk>
Message-ID: <20101012021527.5c5f799a@goodenia>

G'day Brian,

On Mon, 11 Oct 2010 11:11:42 +0100 (BST)
Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:

> Sounds reasonable to count Imports, so we'll alter this.

Thanks for that.  I noticed the changes to R-devel and to the R-2-12-branch.
Looking at the diffs (an example is appended below), it seems to me
that, except for the ordering, the variables `depends_suggests' and
`imports'  are the same.  This would suggest that only one of them is
necessary and that the remaining code could be made leaner...  but
probably that is something to do after the code freeze is over...

> Thank you for the report,  However, the pre-test period for 2.12.0 is 
> already 80% over and we are in code freeze -- reports early on in the 
> period are much more useful and at this stage anything but very
> simple localized changes need to be deferred to 2.12.1.

Point taken.  When I am back home, I will think about what versions of
R I want to have installed on my main machine...  should probably
also write some scripts that regularly check my packages...

Cheers,

	Berwin

berwin at goodenia:/opt/src/R-2-12-branch/src/library/tools/R$ svn diff -r53024 QC.R
Index: QC.R
===================================================================
--- QC.R        (revision 53024)
+++ QC.R        (working copy)
@@ -3937,7 +3937,7 @@

     ## it is OK to refer to yourself and standard packages
     standard_package_names <- .get_standard_package_names()$base
-    depends_suggests <- c(depends, suggests, enhances,  pkg_name,
+    depends_suggests <- c(depends, imports, suggests, enhances, pkg_name,
                           standard_package_names)
     imports <- c(imports, depends, suggests, enhances, pkg_name,
                  standard_package_names)
@@ -4038,7 +4038,7 @@

     ## it is OK to refer to yourself and standard packages
     standard_package_names <- .get_standard_package_names()$base
-    depends_suggests <- c(depends, suggests, enhances,  pkg_name,
+    depends_suggests <- c(depends, imports, suggests, enhances, pkg_name,
                           standard_package_names)
     imports <- c(imports, depends, suggests, enhances, pkg_name,
                  standard_package_names)


From Mehrdad.Shamsi at oicr.on.ca  Mon Oct 11 19:41:13 2010
From: Mehrdad.Shamsi at oicr.on.ca (Mehrdad Shamsi)
Date: Mon, 11 Oct 2010 13:41:13 -0400
Subject: [Rd] Lattice::bwplot unexpected behaviour when using vector of
	colors
Message-ID: <A5A59D1F01D07D4B858C05F6A96077033D0366CE4D@EXCHANGE01.ad.oicr.on.ca>

Hi,
I'm trying to produce colored boxplots using lattice::bwplot function. I need to plot each boxplot in the panel with a specific color. Naturally I used a vector of colors and expected to see colored boxplots. Although the boxplots were colored, the color of whiskers and the boxes  do not match. Here is an example:

d = data.frame(y = rnorm(100), x=1:4)
box.color <- c('red','blue','black', 'green')
bwplot(y~x, 
	data=d, 
	horizontal=FALSE, 
	par.settings = list(
	box.rectangle = list(col = box.color),
	box.umbrella = list(col = box.color)
	)
)

I went through the bwplot.panel to figure out what the problem was. It seems that bwplot.panel function is implemented with the assumption that box.rectangle$col and box.umberella$col are not vectors. It would be nice if bwplot.panel could accept vector of colors.

I use R2.11-x64 on a Windows XP machine. The lattice package version is lattice_0.19-13.

--Thanks

-- M.S.


From gaoclan at gmail.com  Tue Oct 12 16:38:30 2010
From: gaoclan at gmail.com (lan gao)
Date: Tue, 12 Oct 2010 09:38:30 -0500
Subject: [Rd] data set mube S4 class to be submitted to Bioconductor
Message-ID: <AANLkTi=oQC7F17qAzJ0iw8=ZDDa0orq37O26+q0g+PF0@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20101012/2e64b75a/attachment.pl>

From mtmorgan at fhcrc.org  Tue Oct 12 18:06:09 2010
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Tue, 12 Oct 2010 09:06:09 -0700
Subject: [Rd] data set mube S4 class to be submitted to Bioconductor
In-Reply-To: <AANLkTi=oQC7F17qAzJ0iw8=ZDDa0orq37O26+q0g+PF0@mail.gmail.com>
References: <AANLkTi=oQC7F17qAzJ0iw8=ZDDa0orq37O26+q0g+PF0@mail.gmail.com>
Message-ID: <4CB48771.4030209@fhcrc.org>

On 10/12/2010 07:38 AM, lan gao wrote:
> Dear R Developers,
> 
> I am developing a package to submit to bioconductor. Right now, a gene-set
> sample data is saved as a data frame. Each row contains a probe set and its
> corresponding gene-set name ( mutiple probe -set may map to a gene-set name)
> .
> 
> Is this type of data format OK to be submitted to bioconductor? Or I have to
> make it  GeneCollectionSet class? ( If so, I have to change a lot of my R
> functions).
> 
> Your resonse is highly appreciated!

See the answer to your original post here

  https://stat.ethz.ch/pipermail/bioconductor/2010-October/035781.html

The 'Bioc-devel' list mentioned there is

  https://stat.ethz.ch/mailman/listinfo/bioc-devel

referenced from

  http://bioconductor.org/help/mailing-list/

Asking on the bioc-devel mailing list will not change the original
answer, but is the appropriate place to ask future questions about
developing Bioconductor packages.

Martin

> 
> 
> Lani
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


-- 
Computational Biology
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N. PO Box 19024 Seattle, WA 98109

Location: M1-B861
Telephone: 206 667-2793


From pgilbert at bank-banque-canada.ca  Tue Oct 12 23:16:19 2010
From: pgilbert at bank-banque-canada.ca (Paul Gilbert)
Date: Tue, 12 Oct 2010 17:16:19 -0400
Subject: [Rd] FW: [R] same random numbers in different sessions
Message-ID: <D611103AA7EE3B4DAE7F7D49C72B291A02EB34E1@EXMAIL2.bocad.bank-banque-canada.ca>

From R-help
...
>I notice that you have the IPSUR package loaded;  you know, just a
>shot in the dark here, but did you try not loading it?
>
>I ask because the vignette is built by making a special choice for
>set.seed, and the workspace that ships with the package might be
>interacting in an unexpected way.

Is it possible that a package can save a set seed and have the effect that users get when they save a workspace with the seed set? I think not, but if so, can we check that packages do not save a random seed?

Paul
====================================================================================

La version fran?aise suit le texte anglais.

------------------------------------------------------------------------------------

This email may contain privileged and/or confidential information, and the Bank of
Canada does not waive any related rights. Any distribution, use, or copying of this
email or the information it contains by other than the intended recipient is
unauthorized. If you received this email in error please delete it immediately from
your system and notify the sender promptly by email that you have done so. 

------------------------------------------------------------------------------------

Le pr?sent courriel peut contenir de l'information privil?gi?e ou confidentielle.
La Banque du Canada ne renonce pas aux droits qui s'y rapportent. Toute diffusion,
utilisation ou copie de ce courriel ou des renseignements qu'il contient par une
personne autre que le ou les destinataires d?sign?s est interdite. Si vous recevez
ce courriel par erreur, veuillez le supprimer imm?diatement et envoyer sans d?lai ?
l'exp?diteur un message ?lectronique pour l'aviser que vous avez ?limin? de votre
ordinateur toute copie du courriel re?u.

From gkerns at ysu.edu  Wed Oct 13 01:37:19 2010
From: gkerns at ysu.edu (G. Jay Kerns)
Date: Tue, 12 Oct 2010 19:37:19 -0400
Subject: [Rd] FW: [R] same random numbers in different sessions
In-Reply-To: <D611103AA7EE3B4DAE7F7D49C72B291A02EB34E1@EXMAIL2.bocad.bank-banque-canada.ca>
References: <D611103AA7EE3B4DAE7F7D49C72B291A02EB34E1@EXMAIL2.bocad.bank-banque-canada.ca>
Message-ID: <AANLkTi=KCs05e_kEPPC9FRF8hpdRDq7oMZqX3nhMDS=m@mail.gmail.com>

Dear Paul,

On Tue, Oct 12, 2010 at 5:16 PM, Paul Gilbert
<pgilbert at bank-banque-canada.ca> wrote:
> From R-help
> ...
>>I notice that you have the IPSUR package loaded; ?you know, just a
>>shot in the dark here, but did you try not loading it?
>>
>>I ask because the vignette is built by making a special choice for
>>set.seed, and the workspace that ships with the package might be
>>interacting in an unexpected way.
>
> Is it possible that a package can save a set seed and have the effect that users get when they save a workspace with the seed set? I think not, but if so, can we check that packages do not save a random seed?
>

Yes, it is possible.  For example, in principle, a person could
include a workspace in the /data subdirectory of the package (which
has had the seed set) and load the workspace when the package is
loaded with the .First.lib function.  That's not what I did, though,
and it was not what I had in mind when I wrote that earlier reply to
R-help.  At that time I was worried that maybe I goofed and forgot to
remove .Random.seed in the vignette, or something else was happening
that I didn't understand.  Turns out I didn't forget and everything is
fine.

Maybe somebody else could come up with a reason why a person would
want the ability to load a .Random.seed with a package, though I don't
have one off the top of my head.

Regards,
Jay




***************************************************
G. Jay Kerns, Ph.D.
Associate Professor
Department of Mathematics & Statistics
Youngstown State University
Youngstown, OH 44555-0002 USA
Office: 1035 Cushwa Hall
Phone: (330) 941-3310 Office (voice mail)
-3302 Department
-3170 FAX
VoIP: gjkerns at ekiga.net
E-mail: gkerns at ysu.edu
http://people.ysu.edu/~gkerns/


From hpages at fhcrc.org  Wed Oct 13 07:21:03 2010
From: hpages at fhcrc.org (=?ISO-8859-1?Q?Herv=E9_Pag=E8s?=)
Date: Tue, 12 Oct 2010 22:21:03 -0700
Subject: [Rd] 'R CMD build' not cleaning the src/ folder on Windows
In-Reply-To: <4CB2A4FA.6050907@fhcrc.org>
References: <4CB2A4FA.6050907@fhcrc.org>
Message-ID: <4CB541BF.1080707@fhcrc.org>

This problems seems to be solved in current R 2.12 RC. Thanks!  H.

On 10/10/2010 10:47 PM, Herv? Pag?s wrote:
> Hi,
>
> 'R CMD build' (with R 2.12.0 RC) fails to clean the src/ folder
> on Windows:
>
> D:\biocbld\bbs-2.7-bioc>ls meat/BUS/src
> BUS.cpp BUS.h
>
> D:\biocbld\bbs-2.7-bioc>R\bin\R CMD build meat\BUS
> * checking for file 'meat\BUS/DESCRIPTION' ... OK
> * preparing 'BUS':
> * checking DESCRIPTION meta-information ... OK
> * cleaning src
> * installing the package to re-build vignettes
> * creating vignettes ... OK
> * cleaning src
> * checking for LF line-endings in source and make files
> * checking for empty or unneeded directories
> * building 'BUS_1.5.0.tar.gz'
>
> D:\biocbld\bbs-2.7-bioc>tar ztvf BUS_1.5.0.tar.gz --wildcards '*.o'
> -rwxr--r-- biocbuild2/root 16503 2010-10-10 22:15 BUS/src/BUS.o
>
> Packages with a Makefile in src/ don't seem to be affected.
>
> This is with R 2.12.0 RC (2010-10-07 r53227).
>
> Thanks,
> H.
>


-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M2-B876
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fhcrc.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From Troy.Robertson at aad.gov.au  Wed Oct 13 07:39:05 2010
From: Troy.Robertson at aad.gov.au (Troy Robertson)
Date: Wed, 13 Oct 2010 16:39:05 +1100
Subject: [Rd] Wierd nlm behaviour in 2.10.1 and 2.12.0 [Sec=Unclassified]
Message-ID: <42C7503E0B99F248B06BC65E7D2B4E020187DD725C18@EX2K7-CCR.AAD.GOV.AU>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20101013/95a30e99/attachment.pl>

From Troy.Robertson at aad.gov.au  Wed Oct 13 07:51:20 2010
From: Troy.Robertson at aad.gov.au (Troy Robertson)
Date: Wed, 13 Oct 2010 16:51:20 +1100
Subject: [Rd] Wierd nlm behaviour in 2.10.1 and 2.12.0 [Sec=Unclassified]
Message-ID: <42C7503E0B99F248B06BC65E7D2B4E020187DD725C1C@EX2K7-CCR.AAD.GOV.AU>

Hi all,

When upgrading to 2.11.1 recently I noticed different results being produced by my code.
After MUCH digging into my code I have finally narrowed it to a call to nlm().
The problem actually occurs in 2.10.1 and 2.12.0.

This can be replicated by trying the code below in some different versions of R:

FixedRemovals<-1836180125888
AbStageInitial<-2223033830403
Rates<- 0.3102445
myfunc<-function(rootM,Abund,Loss,OtherM)
     {(Loss-(rootM/(rootM+OtherM)*
      (1-exp(-(rootM+OtherM)))*
      Abund))^2}

nlm(myfunc
   ,0.001,print.level=0,fscale=0, gradtol=1E-10, stepmax = 100.0
   ,Loss=FixedRemovals
   ,Abund=AbStageInitial
   ,OtherM=Rates)

nlm(myfunc
   ,0.001,print.level=0,fscale=0, gradtol=1E-10, stepmax = 100.0
   ,Loss=FixedRemovals
   ,Abund=AbStageInitial
   ,OtherM=Rates)$estimate

Why would I be seeing a different value of 'estimate' (or any of the other returned list items)?
Originally I thought it was 2.11.1 that was giving me the grief with different output but now I see that in 2.11.1 I get the same value to each returned list item both ways.
Can anyone explain this?

Thanks

Troy
___________________________________________________________________________

    Australian Antarctic Division - Commonwealth of Australia
IMPORTANT: This transmission is intended for the addressee only. If you are not the
intended recipient, you are notified that use or dissemination of this communication is
strictly prohibited by Commonwealth law. If you have received this transmission in error,
please notify the sender immediately by e-mail or by telephoning +61 3 6232 3209 and
DELETE the message.
        Visit our web site at http://www.antarctica.gov.au/
___________________________________________________________________________


From rvaradhan at jhmi.edu  Wed Oct 13 15:27:29 2010
From: rvaradhan at jhmi.edu (Ravi Varadhan)
Date: Wed, 13 Oct 2010 09:27:29 -0400
Subject: [Rd] Wierd nlm behaviour in 2.10.1 and 2.12.0 [Sec=Unclassified]
In-Reply-To: <42C7503E0B99F248B06BC65E7D2B4E020187DD725C1C@EX2K7-CCR.AAD.GOV.AU>
References: <42C7503E0B99F248B06BC65E7D2B4E020187DD725C1C@EX2K7-CCR.AAD.GOV.AU>
Message-ID: <000301cb6ada$625e67c0$271b3740$@edu>

Hi Troy,

I think that your problem is poorly scaled.  You have variables that vary
over several orders of magnitude. This means that any small changes (due to
subtle differences between R versions) could cause a big difference in the
convergence behavior of the algorithms.  So, you are asking for trouble and
you got it.  I would scale the problem such that the parameters, function
and its gradient are essentially of the same magnitude.  

To paraphrase John Nash, who paraphrased Richard Varga, "It is all about
scaling".

Furthermore, I would specify the analytic gradient, which should be very
easy to derive.

Ravi.


-----Original Message-----
From: r-devel-bounces at r-project.org [mailto:r-devel-bounces at r-project.org]
On Behalf Of Troy Robertson
Sent: Wednesday, October 13, 2010 1:51 AM
To: 'r-devel at R-project.org'
Subject: [Rd] Wierd nlm behaviour in 2.10.1 and 2.12.0 [Sec=Unclassified]

Hi all,

When upgrading to 2.11.1 recently I noticed different results being produced
by my code.
After MUCH digging into my code I have finally narrowed it to a call to
nlm().
The problem actually occurs in 2.10.1 and 2.12.0.

This can be replicated by trying the code below in some different versions
of R:

FixedRemovals<-1836180125888
AbStageInitial<-2223033830403
Rates<- 0.3102445
myfunc<-function(rootM,Abund,Loss,OtherM)
     {(Loss-(rootM/(rootM+OtherM)*
      (1-exp(-(rootM+OtherM)))*
      Abund))^2}

nlm(myfunc
   ,0.001,print.level=0,fscale=0, gradtol=1E-10, stepmax = 100.0
   ,Loss=FixedRemovals
   ,Abund=AbStageInitial
   ,OtherM=Rates)

nlm(myfunc
   ,0.001,print.level=0,fscale=0, gradtol=1E-10, stepmax = 100.0
   ,Loss=FixedRemovals
   ,Abund=AbStageInitial
   ,OtherM=Rates)$estimate

Why would I be seeing a different value of 'estimate' (or any of the other
returned list items)?
Originally I thought it was 2.11.1 that was giving me the grief with
different output but now I see that in 2.11.1 I get the same value to each
returned list item both ways.
Can anyone explain this?

Thanks

Troy
___________________________________________________________________________

    Australian Antarctic Division - Commonwealth of Australia
IMPORTANT: This transmission is intended for the addressee only. If you are
not the
intended recipient, you are notified that use or dissemination of this
communication is
strictly prohibited by Commonwealth law. If you have received this
transmission in error,
please notify the sender immediately by e-mail or by telephoning +61 3 6232
3209 and
DELETE the message.
        Visit our web site at http://www.antarctica.gov.au/
___________________________________________________________________________

______________________________________________
R-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-devel


From rvaradhan at jhmi.edu  Wed Oct 13 17:28:51 2010
From: rvaradhan at jhmi.edu (Ravi Varadhan)
Date: Wed, 13 Oct 2010 11:28:51 -0400
Subject: [Rd] Wierd nlm behaviour in 2.10.1 and 2.12.0 [Sec=Unclassified]
In-Reply-To: <000301cb6ada$625e67c0$271b3740$@edu>
References: <42C7503E0B99F248B06BC65E7D2B4E020187DD725C1C@EX2K7-CCR.AAD.GOV.AU>
	<000301cb6ada$625e67c0$271b3740$@edu>
Message-ID: <003601cb6aeb$56e66670$04b33350$@edu>

Try this:

Myfunc2 <- function(rootM,Abund,Loss,OtherM) {
# I have scaled the function
(Loss/Abund - (rootM/(rootM+OtherM)*
      (1-exp(-(rootM+OtherM)))))^2
}


nlm(myfunc2
   ,0.001,print.level=0,fscale=0, gradtol=1E-10, stepmax = 100.0
   ,Loss=FixedRemovals
   ,Abund=AbStageInitial
   ,OtherM=Rates)$estimate

This should work quite robustly under various R versions on different
platforms.

Ravi.

-----Original Message-----
From: r-devel-bounces at r-project.org [mailto:r-devel-bounces at r-project.org]
On Behalf Of Ravi Varadhan
Sent: Wednesday, October 13, 2010 9:27 AM
To: 'Troy Robertson'; 'r-devel at R-project.org'
Subject: Re: [Rd] Wierd nlm behaviour in 2.10.1 and 2.12.0
[Sec=Unclassified]

Hi Troy,

I think that your problem is poorly scaled.  You have variables that vary
over several orders of magnitude. This means that any small changes (due to
subtle differences between R versions) could cause a big difference in the
convergence behavior of the algorithms.  So, you are asking for trouble and
you got it.  I would scale the problem such that the parameters, function
and its gradient are essentially of the same magnitude.  

To paraphrase John Nash, who paraphrased Richard Varga, "It is all about
scaling".

Furthermore, I would specify the analytic gradient, which should be very
easy to derive.

Ravi.


-----Original Message-----
From: r-devel-bounces at r-project.org [mailto:r-devel-bounces at r-project.org]
On Behalf Of Troy Robertson
Sent: Wednesday, October 13, 2010 1:51 AM
To: 'r-devel at R-project.org'
Subject: [Rd] Wierd nlm behaviour in 2.10.1 and 2.12.0 [Sec=Unclassified]

Hi all,

When upgrading to 2.11.1 recently I noticed different results being produced
by my code.
After MUCH digging into my code I have finally narrowed it to a call to
nlm().
The problem actually occurs in 2.10.1 and 2.12.0.

This can be replicated by trying the code below in some different versions
of R:

FixedRemovals<-1836180125888
AbStageInitial<-2223033830403
Rates<- 0.3102445
myfunc<-function(rootM,Abund,Loss,OtherM)
     {(Loss-(rootM/(rootM+OtherM)*
      (1-exp(-(rootM+OtherM)))*
      Abund))^2}

nlm(myfunc
   ,0.001,print.level=0,fscale=0, gradtol=1E-10, stepmax = 100.0
   ,Loss=FixedRemovals
   ,Abund=AbStageInitial
   ,OtherM=Rates)

nlm(myfunc
   ,0.001,print.level=0,fscale=0, gradtol=1E-10, stepmax = 100.0
   ,Loss=FixedRemovals
   ,Abund=AbStageInitial
   ,OtherM=Rates)$estimate

Why would I be seeing a different value of 'estimate' (or any of the other
returned list items)?
Originally I thought it was 2.11.1 that was giving me the grief with
different output but now I see that in 2.11.1 I get the same value to each
returned list item both ways.
Can anyone explain this?

Thanks

Troy
___________________________________________________________________________

    Australian Antarctic Division - Commonwealth of Australia
IMPORTANT: This transmission is intended for the addressee only. If you are
not the
intended recipient, you are notified that use or dissemination of this
communication is
strictly prohibited by Commonwealth law. If you have received this
transmission in error,
please notify the sender immediately by e-mail or by telephoning +61 3 6232
3209 and
DELETE the message.
        Visit our web site at http://www.antarctica.gov.au/
___________________________________________________________________________

______________________________________________
R-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-devel

______________________________________________
R-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-devel


From chairmank at gmail.com  Wed Oct 13 21:26:51 2010
From: chairmank at gmail.com (Steve Kim)
Date: Wed, 13 Oct 2010 12:26:51 -0700
Subject: [Rd] list comprehension to create an arbitrary-sized list with
	arbitrary names/values
Message-ID: <AANLkTik7xjr5TaH1AcFtg5cUJkTg2cfEPGy8i-RT69GY@mail.gmail.com>

In python, one can do this

mydict = dict([(keyfun(x), valfun(x)) for x in mylist])

to create a dictionary with whatever keys and values we want from an
input list of arbitrary size. In R, I want to similarly create a list
with names/values that are generated by some keyfun and valfun
(assuming that keyfun is guaranteed to return something suitable as a
name). How can I do this?


From olafm at statistik.tu-dortmund.de  Wed Oct 13 21:34:24 2010
From: olafm at statistik.tu-dortmund.de (Olaf Mersmann)
Date: Wed, 13 Oct 2010 21:34:24 +0200
Subject: [Rd] list comprehension to create an arbitrary-sized list with
	arbitrary names/values
In-Reply-To: <AANLkTik7xjr5TaH1AcFtg5cUJkTg2cfEPGy8i-RT69GY@mail.gmail.com>
References: <AANLkTik7xjr5TaH1AcFtg5cUJkTg2cfEPGy8i-RT69GY@mail.gmail.com>
Message-ID: <9F6ACDD6-9002-471B-AF6E-50131B6FE7C4@statistik.tu-dortmund.de>

Hi,

On 13.10.2010, at 21:26, Steve Kim wrote:
> mydict = dict([(keyfun(x), valfun(x)) for x in mylist])
> 
> to create a dictionary with whatever keys and values we want from an
> input list of arbitrary size. In R, I want to similarly create a list
> with names/values that are generated by some keyfun and valfun
> (assuming that keyfun is guaranteed to return something suitable as a
> name). How can I do this?

Try something like this:

  mydict <- lapply(mylist, valfun)
  names(mydict) <- sapply(mylist, keyfun)

or

  mydict <- structure(lapply(mylist, valfun), names=sapply(mylist, keyfun))

Cheers
Olaf


From eriki at ccbr.umn.edu  Wed Oct 13 21:35:11 2010
From: eriki at ccbr.umn.edu (Erik Iverson)
Date: Wed, 13 Oct 2010 14:35:11 -0500
Subject: [Rd] list comprehension to create an arbitrary-sized list with
 arbitrary names/values
In-Reply-To: <AANLkTik7xjr5TaH1AcFtg5cUJkTg2cfEPGy8i-RT69GY@mail.gmail.com>
References: <AANLkTik7xjr5TaH1AcFtg5cUJkTg2cfEPGy8i-RT69GY@mail.gmail.com>
Message-ID: <4CB609EF.4020107@ccbr.umn.edu>

This question probably belongs on R-help instead of R-devel.

What works best for you will depend on how big 'mylist' is.

An article discussing some possibilities can be found at:
http://opendatagroup.com/2009/07/26/hash-package-for-r/

Hope this helps,
--Erik

Steve Kim wrote:
> In python, one can do this
> 
> mydict = dict([(keyfun(x), valfun(x)) for x in mylist])
> 
> to create a dictionary with whatever keys and values we want from an
> input list of arbitrary size. In R, I want to similarly create a list
> with names/values that are generated by some keyfun and valfun
> (assuming that keyfun is guaranteed to return something suitable as a
> name). How can I do this?
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From Troy.Robertson at aad.gov.au  Thu Oct 14 03:08:33 2010
From: Troy.Robertson at aad.gov.au (Troy Robertson)
Date: Thu, 14 Oct 2010 12:08:33 +1100
Subject: [Rd] Wierd nlm behaviour in 2.10.1 and 2.12.0 [Sec=Unclassified]
In-Reply-To: <003601cb6aeb$56e66670$04b33350$@edu>
Message-ID: <42C7503E0B99F248B06BC65E7D2B4E020187DD725C72@EX2K7-CCR.AAD.GOV.AU>

Thanks heaps Ravi,

I will have to take the modified function to my modeller/statistician and get him to check it out as I am only a general programmer and do not understand the significance of your suggested changes.  Your changes do look to produce consistent results though and as John Nash pointed out in an email, the returned 'code' value was originally 5, indicating a failure.  So it looks like the code I have been using has always been producing erroneous output data :-(

Still not sure why there is a difference between:
nlm(...)$estimate
AND
a<-nlm(...)
a$estimate
in R2.10.1 and R2.12.0beta though but not R2.11.1?
Even if nlm() is failing it should show consistent output I would have thought?

Thanks again for your suggestions Ravi.

Troy



> -----Original Message-----
> From: Ravi Varadhan [mailto:rvaradhan at jhmi.edu]
> Sent: Thursday, 14 October 2010 2:29 AM
> To: 'Ravi Varadhan'; Troy Robertson; 'r-devel at R-project.org'
> Subject: RE: [Rd] Wierd nlm behaviour in 2.10.1 and 2.12.0
> [Sec=Unclassified]
>
>
> Try this:
>
> Myfunc2 <- function(rootM,Abund,Loss,OtherM) {
> # I have scaled the function
> (Loss/Abund - (rootM/(rootM+OtherM)*
>       (1-exp(-(rootM+OtherM)))))^2
> }
>
>
> nlm(myfunc2
>    ,0.001,print.level=0,fscale=0, gradtol=1E-10, stepmax = 100.0
>    ,Loss=FixedRemovals
>    ,Abund=AbStageInitial
>    ,OtherM=Rates)$estimate
>
> This should work quite robustly under various R versions on
> different platforms.
>
> Ravi.
>
> -----Original Message-----
> From: r-devel-bounces at r-project.org
> [mailto:r-devel-bounces at r-project.org]
> On Behalf Of Ravi Varadhan
> Sent: Wednesday, October 13, 2010 9:27 AM
> To: 'Troy Robertson'; 'r-devel at R-project.org'
> Subject: Re: [Rd] Wierd nlm behaviour in 2.10.1 and 2.12.0
> [Sec=Unclassified]
>
> Hi Troy,
>
> I think that your problem is poorly scaled.  You have
> variables that vary over several orders of magnitude. This
> means that any small changes (due to subtle differences
> between R versions) could cause a big difference in the
> convergence behavior of the algorithms.  So, you are asking
> for trouble and you got it.  I would scale the problem such
> that the parameters, function and its gradient are
> essentially of the same magnitude.
>
> To paraphrase John Nash, who paraphrased Richard Varga, "It
> is all about scaling".
>
> Furthermore, I would specify the analytic gradient, which
> should be very easy to derive.
>
> Ravi.
>
>
> -----Original Message-----
> From: r-devel-bounces at r-project.org
> [mailto:r-devel-bounces at r-project.org]
> On Behalf Of Troy Robertson
> Sent: Wednesday, October 13, 2010 1:51 AM
> To: 'r-devel at R-project.org'
> Subject: [Rd] Wierd nlm behaviour in 2.10.1 and 2.12.0
> [Sec=Unclassified]
>
> Hi all,
>
> When upgrading to 2.11.1 recently I noticed different results
> being produced by my code. After MUCH digging into my code I
> have finally narrowed it to a call to nlm(). The problem
> actually occurs in 2.10.1 and 2.12.0.
>
> This can be replicated by trying the code below in some
> different versions of R:
>
> FixedRemovals<-1836180125888
> AbStageInitial<-2223033830403
> Rates<- 0.3102445
> myfunc<-function(rootM,Abund,Loss,OtherM)
>      {(Loss-(rootM/(rootM+OtherM)*
>       (1-exp(-(rootM+OtherM)))*
>       Abund))^2}
>
> nlm(myfunc
>    ,0.001,print.level=0,fscale=0, gradtol=1E-10, stepmax = 100.0
>    ,Loss=FixedRemovals
>    ,Abund=AbStageInitial
>    ,OtherM=Rates)
>
> nlm(myfunc
>    ,0.001,print.level=0,fscale=0, gradtol=1E-10, stepmax = 100.0
>    ,Loss=FixedRemovals
>    ,Abund=AbStageInitial
>    ,OtherM=Rates)$estimate
>
> Why would I be seeing a different value of 'estimate' (or any
> of the other returned list items)? Originally I thought it
> was 2.11.1 that was giving me the grief with different output
> but now I see that in 2.11.1 I get the same value to each
> returned list item both ways. Can anyone explain this?
>
> Thanks
>
> Troy
> ______________________________________________________________
> _____________
>
>     Australian Antarctic Division - Commonwealth of Australia
> IMPORTANT: This transmission is intended for the addressee
> only. If you are not the intended recipient, you are notified
> that use or dissemination of this communication is strictly
> prohibited by Commonwealth law. If you have received this
> transmission in error, please notify the sender immediately
> by e-mail or by telephoning +61 3 6232 3209 and DELETE the message.
>         Visit our web site at http://www.antarctica.gov.au/
> ______________________________________________________________
> _____________
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>
___________________________________________________________________________

    Australian Antarctic Division - Commonwealth of Australia
IMPORTANT: This transmission is intended for the addressee only. If you are not the
intended recipient, you are notified that use or dissemination of this communication is
strictly prohibited by Commonwealth law. If you have received this transmission in error,
please notify the sender immediately by e-mail or by telephoning +61 3 6232 3209 and
DELETE the message.
        Visit our web site at http://www.antarctica.gov.au/
___________________________________________________________________________


From whuber at embl.de  Wed Oct 13 17:30:48 2010
From: whuber at embl.de (Wolfgang Huber)
Date: Wed, 13 Oct 2010 17:30:48 +0200
Subject: [Rd] Scripting SVG with R
Message-ID: <4CB5D0A8.5040901@embl.de>


Since now many browsers support (ECMA/Java-)scripted SVG, I am wondering 
whether there are already any examples of inserting R code into SVG 
documents (or a Javascript canvas?) either directly, or perhaps more 
likely through a JavaScript layer, to dynamically generate graphics or 
make them interactive?

I am aware of the excellent packages gridSVG and SVGAnnotation, which 
facilitate making R-generated SVG plots more interesting either at 
construction time or by postprocessing; the above question is about 
employing R at viewing time.

Best wishes

Wolfgang Huber
EMBL
http://www.embl.de/research/units/genome_biology/huber


From rvaradhan at jhmi.edu  Thu Oct 14 05:21:05 2010
From: rvaradhan at jhmi.edu (Ravi Varadhan)
Date: Wed, 13 Oct 2010 23:21:05 -0400
Subject: [Rd] Wierd nlm behaviour in 2.10.1 and 2.12.0 [Sec=Unclassified]
In-Reply-To: <42C7503E0B99F248B06BC65E7D2B4E020187DD725C72@EX2K7-CCR.AAD.GOV.AU>
References: <003601cb6aeb$56e66670$04b33350$@edu>
	<42C7503E0B99F248B06BC65E7D2B4E020187DD725C72@EX2K7-CCR.AAD.GOV.AU>
Message-ID: <70f084ed968.4cb63ee1@johnshopkins.edu>

The scaling change that I did is extremely simple.  I just divided the objective function by `Abund' (actually, Abund^2).  Dividing a function by a constant (positive) factor does not change the optimum (minimum), so this is perfectly legal.  

Ravi.
____________________________________________________________________

Ravi Varadhan, Ph.D.
Assistant Professor,
Division of Geriatric Medicine and Gerontology
School of Medicine
Johns Hopkins University

Ph. (410) 502-2619
email: rvaradhan at jhmi.edu


----- Original Message -----
From: Troy Robertson <Troy.Robertson at aad.gov.au>
Date: Wednesday, October 13, 2010 9:08 pm
Subject: RE: [Rd] Wierd nlm behaviour in 2.10.1 and 2.12.0 [Sec=Unclassified]
To: 'Ravi Varadhan' <rvaradhan at jhmi.edu>, "'r-devel at R-project.org'" <r-devel at r-project.org>


> Thanks heaps Ravi,
>  
>  I will have to take the modified function to my modeller/statistician 
> and get him to check it out as I am only a general programmer and do 
> not understand the significance of your suggested changes.  Your 
> changes do look to produce consistent results though and as John Nash 
> pointed out in an email, the returned 'code' value was originally 5, 
> indicating a failure.  So it looks like the code I have been using has 
> always been producing erroneous output data :-(
>  
>  Still not sure why there is a difference between:
>  nlm(...)$estimate
>  AND
>  a<-nlm(...)
>  a$estimate
>  in R2.10.1 and R2.12.0beta though but not R2.11.1?
>  Even if nlm() is failing it should show consistent output I would 
> have thought?
>  
>  Thanks again for your suggestions Ravi.
>  
>  Troy
>  
>  
>  
>  > -----Original Message-----
>  > From: Ravi Varadhan [
>  > Sent: Thursday, 14 October 2010 2:29 AM
>  > To: 'Ravi Varadhan'; Troy Robertson; 'r-devel at R-project.org'
>  > Subject: RE: [Rd] Wierd nlm behaviour in 2.10.1 and 2.12.0
>  > [Sec=Unclassified]
>  >
>  >
>  > Try this:
>  >
>  > Myfunc2 <- function(rootM,Abund,Loss,OtherM) {
>  > # I have scaled the function
>  > (Loss/Abund - (rootM/(rootM+OtherM)*
>  >       (1-exp(-(rootM+OtherM)))))^2
>  > }
>  >
>  >
>  > nlm(myfunc2
>  >    ,0.001,print.level=0,fscale=0, gradtol=1E-10, stepmax = 100.0
>  >    ,Loss=FixedRemovals
>  >    ,Abund=AbStageInitial
>  >    ,OtherM=Rates)$estimate
>  >
>  > This should work quite robustly under various R versions on
>  > different platforms.
>  >
>  > Ravi.
>  >
>  > -----Original Message-----
>  > From: r-devel-bounces at r-project.org
>  > [
>  > On Behalf Of Ravi Varadhan
>  > Sent: Wednesday, October 13, 2010 9:27 AM
>  > To: 'Troy Robertson'; 'r-devel at R-project.org'
>  > Subject: Re: [Rd] Wierd nlm behaviour in 2.10.1 and 2.12.0
>  > [Sec=Unclassified]
>  >
>  > Hi Troy,
>  >
>  > I think that your problem is poorly scaled.  You have
>  > variables that vary over several orders of magnitude. This
>  > means that any small changes (due to subtle differences
>  > between R versions) could cause a big difference in the
>  > convergence behavior of the algorithms.  So, you are asking
>  > for trouble and you got it.  I would scale the problem such
>  > that the parameters, function and its gradient are
>  > essentially of the same magnitude.
>  >
>  > To paraphrase John Nash, who paraphrased Richard Varga, "It
>  > is all about scaling".
>  >
>  > Furthermore, I would specify the analytic gradient, which
>  > should be very easy to derive.
>  >
>  > Ravi.
>  >
>  >
>  > -----Original Message-----
>  > From: r-devel-bounces at r-project.org
>  > [
>  > On Behalf Of Troy Robertson
>  > Sent: Wednesday, October 13, 2010 1:51 AM
>  > To: 'r-devel at R-project.org'
>  > Subject: [Rd] Wierd nlm behaviour in 2.10.1 and 2.12.0
>  > [Sec=Unclassified]
>  >
>  > Hi all,
>  >
>  > When upgrading to 2.11.1 recently I noticed different results
>  > being produced by my code. After MUCH digging into my code I
>  > have finally narrowed it to a call to nlm(). The problem
>  > actually occurs in 2.10.1 and 2.12.0.
>  >
>  > This can be replicated by trying the code below in some
>  > different versions of R:
>  >
>  > FixedRemovals<-1836180125888
>  > AbStageInitial<-2223033830403
>  > Rates<- 0.3102445
>  > myfunc<-function(rootM,Abund,Loss,OtherM)
>  >      {(Loss-(rootM/(rootM+OtherM)*
>  >       (1-exp(-(rootM+OtherM)))*
>  >       Abund))^2}
>  >
>  > nlm(myfunc
>  >    ,0.001,print.level=0,fscale=0, gradtol=1E-10, stepmax = 100.0
>  >    ,Loss=FixedRemovals
>  >    ,Abund=AbStageInitial
>  >    ,OtherM=Rates)
>  >
>  > nlm(myfunc
>  >    ,0.001,print.level=0,fscale=0, gradtol=1E-10, stepmax = 100.0
>  >    ,Loss=FixedRemovals
>  >    ,Abund=AbStageInitial
>  >    ,OtherM=Rates)$estimate
>  >
>  > Why would I be seeing a different value of 'estimate' (or any
>  > of the other returned list items)? Originally I thought it
>  > was 2.11.1 that was giving me the grief with different output
>  > but now I see that in 2.11.1 I get the same value to each
>  > returned list item both ways. Can anyone explain this?
>  >
>  > Thanks
>  >
>  > Troy
>  > ______________________________________________________________
>  > _____________
>  >
>  >     Australian Antarctic Division - Commonwealth of Australia
>  > IMPORTANT: This transmission is intended for the addressee
>  > only. If you are not the intended recipient, you are notified
>  > that use or dissemination of this communication is strictly
>  > prohibited by Commonwealth law. If you have received this
>  > transmission in error, please notify the sender immediately
>  > by e-mail or by telephoning +61 3 6232 3209 and DELETE the message.
>  >         Visit our web site at 
>  > ______________________________________________________________
>  > _____________
>  >
>  > ______________________________________________
>  > R-devel at r-project.org mailing list
>  > 
>  >
>  > ______________________________________________
>  > R-devel at r-project.org mailing list
>  > 
>  >
>  >
>  ___________________________________________________________________________
>  
>      Australian Antarctic Division - Commonwealth of Australia
>  IMPORTANT: This transmission is intended for the addressee only. If 
> you are not the
>  intended recipient, you are notified that use or dissemination of 
> this communication is
>  strictly prohibited by Commonwealth law. If you have received this 
> transmission in error,
>  please notify the sender immediately by e-mail or by telephoning +61 
> 3 6232 3209 and
>  DELETE the message.
>          Visit our web site at 
>  ___________________________________________________________________________


From towolf at gmail.com  Thu Oct 14 09:06:04 2010
From: towolf at gmail.com (Tobias Wolf)
Date: Thu, 14 Oct 2010 09:06:04 +0200
Subject: [Rd] My retraced version of R logo in SVG
Message-ID: <1287039964.3009.33.camel@ovo>

Salvete,

when over the the weekend I found myself incapable of looking at any
more numbers and code, seeing the R logo, I wondered how one would go
about replicating the old-fashioned faux 3D effects it uses.

I thought it would make for a good distraction and exercise to try and
mimic it in SVG as close as possible, tracing the simple shapes by hand
and using layered gradients.

This is the result:

    http://www.alice-dsl.net/~towolf/rlogo/Rlogo-novo.svg

for comparison, this is the PNG logo at the same size

    http://svn.r-project.org/R-dev-web/trunk/Logo/Rlogo-2.png

The SVG is stripped down to 80K and the PNG is 200K.

I also have a version with preserved Inkscape metadata at 140K and a 2K
versoin with only the two flat shapes:

    http://www.alice-dsl.net/~towolf/rlogo/Rlogo-novo-editable.svg
    http://www.alice-dsl.net/~towolf/rlogo/Rlogo-simple.svg

I thought someone might find a use for these. If yes, just go ahead.
It?s easy to edit these files. Change the color, make them prettier, or
more physically plausible in terms of shading. I  just put them under
cc-by-sa.

--Tobias


From pgilbert at bank-banque-canada.ca  Thu Oct 14 16:34:34 2010
From: pgilbert at bank-banque-canada.ca (Paul Gilbert)
Date: Thu, 14 Oct 2010 10:34:34 -0400
Subject: [Rd] rc make error
Message-ID: <D611103AA7EE3B4DAE7F7D49C72B291A02EB3B10@EXMAIL2.bocad.bank-banque-canada.ca>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20101014/9430430b/attachment.pl>

From janko.thyson at ku-eichstaett.de  Thu Oct 14 21:06:48 2010
From: janko.thyson at ku-eichstaett.de (Janko Thyson)
Date: Thu, 14 Oct 2010 21:06:48 +0200
Subject: [Rd] Including data in packages
Message-ID: <008a01cb6bd2$f380f490$da82ddb0$@thyson@ku-eichstaett.de>

Dear List,

 

I would like to include a couple of objects in a package I am developing and
I don't really get it yet. The objects should be available after package
load as some functions depend on it.

 

I tried the following:

 

1)      Bundling all objects that I need in the file '/R/sysdata.rda' as
described in the "Writing R Extensions" manual on page 7

2)      Storing the objects in /inst/extdata/somedata.rda as described in
the "Writing R Extensions" manual on page 9

3)      Storing the objects in /data/somedata.rda to make it available via
data() later on (I would like these objects from the user, though. So this
isn't really my preferred option)

 

In DESCRIPTION I flagged 'LazyLoad' to 'yes'.

 

The thing is that I don't understand how the actual 'transfer' happens when
the package is build and installed. Where do the objects 'live' after
installation and how can I access them after firing library(mypackage)? For
example, there is a 'data' directory for package 'tm'
(R_HOME/R-2.11.1/library/tm) but such a directory is missing even if I chose
option 3) (as stated above) to get my data included. Also, how can I
actually execute the lazyload? 

 

Any hints are greatly appreciated!

 

Thanks,

Janko


From edd at debian.org  Thu Oct 14 21:17:41 2010
From: edd at debian.org (Dirk Eddelbuettel)
Date: Thu, 14 Oct 2010 14:17:41 -0500
Subject: [Rd] Including data in packages
In-Reply-To: <008a01cb6bd2$f380f490$da82ddb0$@thyson@ku-eichstaett.de>
References: <008a01cb6bd2$f380f490$da82ddb0$@thyson@ku-eichstaett.de>
Message-ID: <19639.22357.354666.280008@max.nulle.part>


On 14 October 2010 at 21:06, Janko Thyson wrote:
| The thing is that I don't understand how the actual 'transfer' happens when
| the package is build and installed. Where do the objects 'live' after
| installation and how can I access them after firing library(mypackage)? For
| example, there is a 'data' directory for package 'tm'
| (R_HOME/R-2.11.1/library/tm) but such a directory is missing even if I chose
| option 3) (as stated above) to get my data included. Also, how can I
| actually execute the lazyload? 

If in doubt, copy existing packages, preferably recommended ones:

edd at max:~/src/debian/CRAN$ find -type d -name data | sort
./boot-1.2.42/data
./boot-1.2.43/data
./car-2.0-2/data
./cluster-1.13.1/data
./effects-2.0.10/data
./fEcofin-290.76/data
./fExtremes-2100.77/data
./fGarch-2110.80/data
./fImport-2110.79/data
./fPortfolio-2110.79/data
./gdata-2.8.0/data
./gplots-2.8.0/data
./gtools-2.6.2/data
./lattice-0.19-11/data
./lattice-0.19-13/data
./latticeExtra-0.6-14/data
./lme4-0.999375-35/data
./lmtest-0.9.27/data
./MASS-7.3-7/data
./Matrix-0.999375-44/data
./misc3d-0.7-1/data
./multcomp-1.2-3/data
./nlme-3.1.96/data
./nlme-3.1.97/data
./nws-2.0.0.3/data
./rggobi-2.1.16/data
./robustbase-0.5-0-1/data
./rpart-3.1.46/data
./sandwich-2.2-6/data
./sm-2.2-4.1/data
./sn-0.4-16/data
./strucchange-1.4-1/data
./strucchange-1.4-2/data
./survival-2.35-8/data
./timeSeries-2120.89/data
./tseries-0.10-22/data
./urca-1.2-4/data
edd at max:~/src/debian/CRAN$ 

The vote is clearly in favour of data/ over inst/data.

Hth, Dirk

-- 
Dirk Eddelbuettel | edd at debian.org | http://dirk.eddelbuettel.com


From janko.thyson at ku-eichstaett.de  Thu Oct 14 21:27:39 2010
From: janko.thyson at ku-eichstaett.de (Janko Thyson)
Date: Thu, 14 Oct 2010 21:27:39 +0200
Subject: [Rd] Including data in packages
In-Reply-To: <19639.22357.354666.280008@max.nulle.part>
References: <008a01cb6bd2$f380f490$da82ddb0$@thyson@ku-eichstaett.de>
	<19639.22357.354666.280008@max.nulle.part>
Message-ID: <008e01cb6bd5$dd109a50$9731cef0$@thyson@ku-eichstaett.de>

Hi Dirk,

thanks for the quick reply. So all datasets, regardless if they should be
hidden from the user, should go into /data? If that's the convention, that's
fine with me. But the problem is that there is no data-directory in
R_HOME/library/2-11.1/mypackage after running R CMD build and R CMD INSTALL.
I've experimented with the options --binary and --use-zip-data but without
luck. 

I think I don't understand the "optional directory" procedure in general
yet: don't I just need to dump stuff in /data, /inst/doc, /exec etc. and
have them "transferred" (sorry, I don't know a better word) to the tar.gz
and eventually to the installed package?

Regards,
Janko

> -----Urspr?ngliche Nachricht-----
> Von: Dirk Eddelbuettel [mailto:edd at debian.org]
> Gesendet: Donnerstag, 14. Oktober 2010 21:18
> An: Janko Thyson
> Cc: r-devel at r-project. org
> Betreff: Re: [Rd] Including data in packages
> 
> 
> On 14 October 2010 at 21:06, Janko Thyson wrote:
> | The thing is that I don't understand how the actual 'transfer'
> happens when
> | the package is build and installed. Where do the objects 'live' after
> | installation and how can I access them after firing
> library(mypackage)? For
> | example, there is a 'data' directory for package 'tm'
> | (R_HOME/R-2.11.1/library/tm) but such a directory is missing even if
> I chose
> | option 3) (as stated above) to get my data included. Also, how can I
> | actually execute the lazyload?
> 
> If in doubt, copy existing packages, preferably recommended ones:
> 
> edd at max:~/src/debian/CRAN$ find -type d -name data | sort
> ./boot-1.2.42/data
> ./boot-1.2.43/data
> ./car-2.0-2/data
> ./cluster-1.13.1/data
> ./effects-2.0.10/data
> ./fEcofin-290.76/data
> ./fExtremes-2100.77/data
> ./fGarch-2110.80/data
> ./fImport-2110.79/data
> ./fPortfolio-2110.79/data
> ./gdata-2.8.0/data
> ./gplots-2.8.0/data
> ./gtools-2.6.2/data
> ./lattice-0.19-11/data
> ./lattice-0.19-13/data
> ./latticeExtra-0.6-14/data
> ./lme4-0.999375-35/data
> ./lmtest-0.9.27/data
> ./MASS-7.3-7/data
> ./Matrix-0.999375-44/data
> ./misc3d-0.7-1/data
> ./multcomp-1.2-3/data
> ./nlme-3.1.96/data
> ./nlme-3.1.97/data
> ./nws-2.0.0.3/data
> ./rggobi-2.1.16/data
> ./robustbase-0.5-0-1/data
> ./rpart-3.1.46/data
> ./sandwich-2.2-6/data
> ./sm-2.2-4.1/data
> ./sn-0.4-16/data
> ./strucchange-1.4-1/data
> ./strucchange-1.4-2/data
> ./survival-2.35-8/data
> ./timeSeries-2120.89/data
> ./tseries-0.10-22/data
> ./urca-1.2-4/data
> edd at max:~/src/debian/CRAN$
> 
> The vote is clearly in favour of data/ over inst/data.
> 
> Hth, Dirk
> 
> --
> Dirk Eddelbuettel | edd at debian.org | http://dirk.eddelbuettel.com


From janko.thyson at ku-eichstaett.de  Thu Oct 14 21:48:11 2010
From: janko.thyson at ku-eichstaett.de (Janko Thyson)
Date: Thu, 14 Oct 2010 21:48:11 +0200
Subject: [Rd] Including data in packages
In-Reply-To: <CD52DB5226F62F4EBC1116CD5E9BE8980268F3BB@ex2k.bankofamerica.com>
References: <008a01cb6bd2$f380f490$da82ddb0$%thyson@ku-eichstaett.de>
	<19639.22357.354666.280008@max.nulle.part>
	<008e01cb6bd5$dd109a50$9731cef0$%thyson@ku-eichstaett.de>
	<CD52DB5226F62F4EBC1116CD5E9BE8980268F3BB@ex2k.bankofamerica.com>
Message-ID: <008f01cb6bd8$bb7efa00$327cee00$@thyson@ku-eichstaett.de>

Thanks, it works now! I accidentally chose the wrong folder, sorry for that.
Now, if anyone could comment on the "hidden vs. non-hidden dataset" part of
my questions he/she'd make my day ;-)

Regards,
Janko

> -----Urspr?ngliche Nachricht-----
> Von: Rowe, Brian - Eqty NY [mailto:b.rowe at baml.com]
> Gesendet: Donnerstag, 14. Oktober 2010 21:35
> An: Janko Thyson
> Betreff: RE: [Rd] Including data in packages
> 
> Janko,
> 
> You have to save the data objects you want into that directory in your
> source package. Then when you build/install it will be there.
> 
> Regards,
> Brian
> 
> 
> -----Original Message-----
> From: r-devel-bounces at r-project.org [mailto:r-devel-bounces at r-
> project.org] On Behalf Of Janko Thyson
> Sent: Thursday, October 14, 2010 3:28 PM
> To: 'Dirk Eddelbuettel'
> Cc: 'r-devel at r-project. org'
> Subject: Re: [Rd] Including data in packages
> 
> Hi Dirk,
> 
> thanks for the quick reply. So all datasets, regardless if they should
> be
> hidden from the user, should go into /data? If that's the convention,
> that's
> fine with me. But the problem is that there is no data-directory in
> R_HOME/library/2-11.1/mypackage after running R CMD build and R CMD
> INSTALL.
> I've experimented with the options --binary and --use-zip-data but
> without
> luck.
> 
> I think I don't understand the "optional directory" procedure in
> general
> yet: don't I just need to dump stuff in /data, /inst/doc, /exec etc.
> and
> have them "transferred" (sorry, I don't know a better word) to the
> tar.gz
> and eventually to the installed package?
> 
> Regards,
> Janko
> 
> > -----Urspr?ngliche Nachricht-----
> > Von: Dirk Eddelbuettel [mailto:edd at debian.org]
> > Gesendet: Donnerstag, 14. Oktober 2010 21:18
> > An: Janko Thyson
> > Cc: r-devel at r-project. org
> > Betreff: Re: [Rd] Including data in packages
> >
> >
> > On 14 October 2010 at 21:06, Janko Thyson wrote:
> > | The thing is that I don't understand how the actual 'transfer'
> > happens when
> > | the package is build and installed. Where do the objects 'live'
> after
> > | installation and how can I access them after firing
> > library(mypackage)? For
> > | example, there is a 'data' directory for package 'tm'
> > | (R_HOME/R-2.11.1/library/tm) but such a directory is missing even
> if
> > I chose
> > | option 3) (as stated above) to get my data included. Also, how can
> I
> > | actually execute the lazyload?
> >
> > If in doubt, copy existing packages, preferably recommended ones:
> >
> > edd at max:~/src/debian/CRAN$ find -type d -name data | sort
> > ./boot-1.2.42/data
> > ./boot-1.2.43/data
> > ./car-2.0-2/data
> > ./cluster-1.13.1/data
> > ./effects-2.0.10/data
> > ./fEcofin-290.76/data
> > ./fExtremes-2100.77/data
> > ./fGarch-2110.80/data
> > ./fImport-2110.79/data
> > ./fPortfolio-2110.79/data
> > ./gdata-2.8.0/data
> > ./gplots-2.8.0/data
> > ./gtools-2.6.2/data
> > ./lattice-0.19-11/data
> > ./lattice-0.19-13/data
> > ./latticeExtra-0.6-14/data
> > ./lme4-0.999375-35/data
> > ./lmtest-0.9.27/data
> > ./MASS-7.3-7/data
> > ./Matrix-0.999375-44/data
> > ./misc3d-0.7-1/data
> > ./multcomp-1.2-3/data
> > ./nlme-3.1.96/data
> > ./nlme-3.1.97/data
> > ./nws-2.0.0.3/data
> > ./rggobi-2.1.16/data
> > ./robustbase-0.5-0-1/data
> > ./rpart-3.1.46/data
> > ./sandwich-2.2-6/data
> > ./sm-2.2-4.1/data
> > ./sn-0.4-16/data
> > ./strucchange-1.4-1/data
> > ./strucchange-1.4-2/data
> > ./survival-2.35-8/data
> > ./timeSeries-2120.89/data
> > ./tseries-0.10-22/data
> > ./urca-1.2-4/data
> > edd at max:~/src/debian/CRAN$
> >
> > The vote is clearly in favour of data/ over inst/data.
> >
> > Hth, Dirk
> >
> > --
> > Dirk Eddelbuettel | edd at debian.org | http://dirk.eddelbuettel.com
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> ----------------------------------------------------------------------
> This message w/attachments (message) is intended solely for the use of
> the intended recipient(s) and may contain information that is
> privileged, confidential or proprietary. If you are not an intended
> recipient, please notify the sender, and then please delete and destroy
> all copies and attachments, and be advised that any review or
> dissemination of, or the taking of any action in reliance on, the
> information contained in or attached to this message is prohibited.
> Unless specifically indicated, this message is not an offer to sell or
> a solicitation of any investment products or other financial product or
> service, an official confirmation of any transaction, or an official
> statement of Sender. Subject to applicable law, Sender may intercept,
> monitor, review and retain e-communications (EC) traveling through its
> networks/systems and may produce any such EC to regulators, law
> enforcement, in litigation and as required by law.
> The laws of the country of each sender/recipient may impact the
> handling of EC, and EC may be archived, supervised and produced in
> countries other than the country in which you are located. This message
> cannot be guaranteed to be secure or free of errors or viruses.
> 
> References to "Sender" are references to any subsidiary of Bank of
> America Corporation. Securities and Insurance Products: * Are Not FDIC
> Insured * Are Not Bank Guaranteed * May Lose Value * Are Not a Bank
> Deposit * Are Not a Condition to Any Banking Service or Activity * Are
> Not Insured by Any Federal Government Agency. Attachments that are part
> of this EC may have additional important disclosures and disclaimers,
> which you should read. This message is subject to terms available at
> the following link:
> http://www.bankofamerica.com/emaildisclaimer. By messaging with Sender
> you consent to the foregoing.


From friedrich.leisch at stat.uni-muenchen.de  Fri Oct 15 14:29:11 2010
From: friedrich.leisch at stat.uni-muenchen.de (friedrich.leisch at stat.uni-muenchen.de)
Date: Fri, 15 Oct 2010 14:29:11 +0200 (CEST)
Subject: [Rd] My retraced version of R logo in SVG
In-Reply-To: <1287039964.3009.33.camel@ovo>
References: <1287039964.3009.33.camel@ovo>
Message-ID: <18260.89.96.186.219.1287145751.squirrel@webmail.lrz.de>

Dear Tobias,

thanks a lot, this looks very nice. I just exported it to PDF and can zoom
in and out with great results. I think we should replace the current logo
with bitmaps (where necessary) of your version and would the be able to
use vector versions wherever possible.

Great work & really appreciated!

Best,
Fritz


> Salvete,
>
> when over the the weekend I found myself incapable of looking at any
> more numbers and code, seeing the R logo, I wondered how one would go
> about replicating the old-fashioned faux 3D effects it uses.
>
> I thought it would make for a good distraction and exercise to try and
> mimic it in SVG as close as possible, tracing the simple shapes by hand
> and using layered gradients.
>
> This is the result:
>
>     http://www.alice-dsl.net/~towolf/rlogo/Rlogo-novo.svg
>
> for comparison, this is the PNG logo at the same size
>
>     http://svn.r-project.org/R-dev-web/trunk/Logo/Rlogo-2.png
>
> The SVG is stripped down to 80K and the PNG is 200K.
>
> I also have a version with preserved Inkscape metadata at 140K and a 2K
> versoin with only the two flat shapes:
>
>     http://www.alice-dsl.net/~towolf/rlogo/Rlogo-novo-editable.svg
>     http://www.alice-dsl.net/~towolf/rlogo/Rlogo-simple.svg
>
> I thought someone might find a use for these. If yes, just go ahead.
> It???s easy to edit these files. Change the color, make them prettier, or
> more physically plausible in terms of shading. I  just put them under
> cc-by-sa.
>
> --Tobias
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From gmbecker at ucdavis.edu  Fri Oct 15 17:06:01 2010
From: gmbecker at ucdavis.edu (Gabriel Becker)
Date: Fri, 15 Oct 2010 08:06:01 -0700
Subject: [Rd] Scripting SVG with R
In-Reply-To: <4CB5D0A8.5040901@embl.de>
References: <4CB5D0A8.5040901@embl.de>
Message-ID: <AANLkTinLPOG0W5XXjr60iKw4xWrRxRW-P21i5qkOtBac@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20101015/7cc68858/attachment.pl>

From patrick at revolutionanalytics.com  Fri Oct 15 20:02:49 2010
From: patrick at revolutionanalytics.com (Patrick Aboyoun)
Date: Fri, 15 Oct 2010 11:02:49 -0700
Subject: [Rd] Adding more man page links to base::all.vars
Message-ID: <AANLkTikAEyUYtr4MfOQm8BbZkmY3dp1+fqH0ifzmzoZX@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20101015/9dd30663/attachment.pl>

From marc_schwartz at me.com  Fri Oct 15 20:27:21 2010
From: marc_schwartz at me.com (Marc Schwartz)
Date: Fri, 15 Oct 2010 13:27:21 -0500
Subject: [Rd] Package 'nlme' fails 'make check-all' in R 2.12.0 patched
 built from source
Message-ID: <CFDA7E70-31C6-41C8-BA9B-6583D0EBC432@me.com>

Hi all,

I am building R 2.12.0 patched this morning from source on Snow Leopard (10.6.4). In fact, three times now, with separate clean source and build directories each time, just to be sure that the issue is predictable.

I would be happy to have somebody tell me that I am missing something fundamental here also...


After running make check-all, I get the following error for 'nlme':

* using log directory ?/Users/marcschwartz/R.Files/SourceCode/32bitR/tests/nlme.Rcheck?
* using R version 2.12.0 Patched (2010-10-15 r53323)
* using platform: i386-apple-darwin10.4.0 (32-bit)
* using session charset: UTF-8
* checking for file ?nlme/DESCRIPTION? ... OK
* this is package ?nlme? version ?3.1-97?
* checking package name space information ... OK
* checking package dependencies ... ERROR
Package required but not available: Hmisc

See the information on DESCRIPTION files in the chapter
'Creating R packages' of the 'Writing R Extensions' manual.



From what I can tell, nlme is the only core/recommended package that now has a "Suggests" in the DESCRIPTION file for a non-core/non-recommended package. This Suggests for Frank's Hmisc appears to be new as of version 3.1.-97 of nlme. 

A search of the examples/tests for nlme yields an example in augPred_lab.R as follows, which appears to be the only code based reference to Hmisc in the nlme package:

library(nlme)
if(require("Hmisc")) {
    T.aug <- Orthodont
    label(T.aug$age) <- 'anyL'
    foo <- augPred(lme(distance ~ age, random = ~1|Subject, data=T.aug))
    ## failed in 3.1-72
}

## failed even if there is a variable with a class that is not being used.
T.aug <- Orthodont
T.aug$newage <- T.aug$age
class(T.aug$newage) <- 'anyC'
foo <- augPred(lme(distance ~ age, random = ~1|Subject, data=T.aug))
## failed in 3.1-72



The above example/test is not new to the package, so it would seem that something has changed in the handling of Suggests in the package DESCRIPTION file in 2.12.0.

A check of the log for nlme on CRAN does not reveal any problems for 2.12.0, but presumably since Hmisc would be available there, the check would not logically fail, whereas with a clean local build not containing any add-on packages, it would.


Running R CMD check from the CLI directly on the nlme package using 2.12.0 yields:

./R CMD check nlme_3.1-97.tar.gz
* using log directory ?/Users/marcschwartz/R.Files/SourceCode/32bitR/bin/nlme.Rcheck?
* using R version 2.12.0 Patched (2010-10-15 r53329)
* using platform: i386-apple-darwin10.4.0 (32-bit)
* using session charset: UTF-8
* checking for file ?nlme/DESCRIPTION? ... OK
* this is package ?nlme? version ?3.1-97?
* checking package name space information ... OK
* checking package dependencies ... ERROR
Package required but not available: Hmisc

See the information on DESCRIPTION files in the chapter
'Creating R packages' of the 'Writing R Extensions' manual.


whereas running R CMD check using 2.11.1 patched on the same new version of nlme does not yield an error. So, again, it would seem that something has changed in 2.12.0. 

From a review of R-Exts, the following language was in 2.11.1 patched in section 1.1.1 for the 'general rules':

All packages that are needed to successfully run R CMD check on the package must be listed in one of ?Depends? or ?Suggests? or ?Imports?.


whereas in 2.12.0:

All packages that are needed to successfully run R CMD check on the package must be listed in one of ?Depends? or ?Suggests? or ?Imports?. Packages used to run examples or tests conditionally (e.g. via if(require(pkgname))) should be listed in ?Suggests? or ?Enhances?. (This allows checkers to ensure that all the packages needed for a complete check are installed.)


So, without looking through code in the 'tools' package yet, it would seem that the tests in 2.12.0 are perhaps intended to be more rigorous, although I did not see an obvious change in the language in the 'checking packages' section of R-Exts, under bullet number 5 regarding the tests aborting.
 
This leads me to the question, in the case of nlme, should R CMD check fail if Hmisc is not present in a clean build tree? Or, should the use of Hmisc in the example be removed along with the Suggests entry in the DESCRIPTION file, such that none of the core/recommended packages are dependent upon any third party packages?

The former may be a functional issue, whereas the latter would seem to me to be an appropriate policy issue (not specifically pertaining to Hmisc or Frank, of course).

Thanks,

Marc Schwartz


From vogranovich at jumptrading.com  Fri Oct 15 20:27:56 2010
From: vogranovich at jumptrading.com (Vadim Ogranovich)
Date: Fri, 15 Oct 2010 13:27:56 -0500
Subject: [Rd] calling browser on error
Message-ID: <25C02255A75A684A9CF77F7D663B438F95180C77@chiexchange02.w2k.jumptrading.com>

Dear R-developers,

I am trying to figure out a way to call browser() when an error occur, and naturally I want the browser() to be called in the environment of the error.

I tried something simple in vain:

> f <- function() { x <- 1; stop('ok') }
> tryCatch(f(), error=browser())
Called from: tryCatch(f(), error = browser())
## if browser() was called in the local environment of f then 'x' would be set, but it's not
Browse[1]> x
Error: object 'x' not found
Browse[1]> Q

Is there a way to make it work? What do people do to 'set an on-error breakpoint'?

Thanks,
Vadim


Note: This email is for the confidential use of the named addressee(s) only and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you are hereby notified that any review, dissemination or copying of this email is strictly prohibited, and to please notify the sender immediately and destroy this email and any attachments.  Email transmission cannot be guaranteed to be secure or error-free.  Jump Trading, therefore, does not make any guarantees as to the completeness or accuracy of this email or any attachments.  This email is for informational purposes only and does not constitute a recommendation, offer, request or solicitation of any kind to buy, sell, subscribe, redeem or perform any type of transaction of a financial product.


From josh.m.ulrich at gmail.com  Fri Oct 15 20:31:24 2010
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Fri, 15 Oct 2010 13:31:24 -0500
Subject: [Rd] calling browser on error
In-Reply-To: <25C02255A75A684A9CF77F7D663B438F95180C77@chiexchange02.w2k.jumptrading.com>
References: <25C02255A75A684A9CF77F7D663B438F95180C77@chiexchange02.w2k.jumptrading.com>
Message-ID: <AANLkTinuY+RkavSeKW9OFmysmAK9ey8APViPT8X5K2r4@mail.gmail.com>

I believe options(error=recover) will do what you want.

--
Joshua Ulrich ?| ?FOSS Trading: www.fosstrading.com



On Fri, Oct 15, 2010 at 1:27 PM, Vadim Ogranovich
<vogranovich at jumptrading.com> wrote:
> Dear R-developers,
>
> I am trying to figure out a way to call browser() when an error occur, and naturally I want the browser() to be called in the environment of the error.
>
> I tried something simple in vain:
>
>> f <- function() { x <- 1; stop('ok') }
>> tryCatch(f(), error=browser())
> Called from: tryCatch(f(), error = browser())
> ## if browser() was called in the local environment of f then 'x' would be set, but it's not
> Browse[1]> x
> Error: object 'x' not found
> Browse[1]> Q
>
> Is there a way to make it work? What do people do to 'set an on-error breakpoint'?
>
> Thanks,
> Vadim
>
>
> Note: This email is for the confidential use of the named addressee(s) only and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you are hereby notified that any review, dissemination or copying of this email is strictly prohibited, and to please notify the sender immediately and destroy this email and any attachments. ?Email transmission cannot be guaranteed to be secure or error-free. ?Jump Trading, therefore, does not make any guarantees as to the completeness or accuracy of this email or any attachments. ?This email is for informational purposes only and does not constitute a recommendation, offer, request or solicitation of any kind to buy, sell, subscribe, redeem or perform any type of transaction of a financial product.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From ripley at stats.ox.ac.uk  Fri Oct 15 20:44:01 2010
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 15 Oct 2010 19:44:01 +0100 (BST)
Subject: [Rd] Package 'nlme' fails 'make check-all' in R 2.12.0 patched
 built from source
In-Reply-To: <CFDA7E70-31C6-41C8-BA9B-6583D0EBC432@me.com>
References: <CFDA7E70-31C6-41C8-BA9B-6583D0EBC432@me.com>
Message-ID: <alpine.LFD.2.00.1010151940070.1299@gannet.stats.ox.ac.uk>

Marc,

For make check-all you may need to set

setenv _R_CHECK_FORCE_SUGGESTS_ FALSE

Yes, there is a change in nlme, because packages needed for complete 
testing are required to be listed in DESCRIPTION: see 'Writing R 
Extensions'.

Most of us have that environmnet variable set.

Brian

On Fri, 15 Oct 2010, Marc Schwartz wrote:

> Hi all,
>
> I am building R 2.12.0 patched this morning from source on Snow Leopard (10.6.4). In fact, three times now, with separate clean source and build directories each time, just to be sure that the issue is predictable.
>
> I would be happy to have somebody tell me that I am missing something fundamental here also...
>
>
> After running make check-all, I get the following error for 'nlme':
>
> * using log directory ?/Users/marcschwartz/R.Files/SourceCode/32bitR/tests/nlme.Rcheck?
> * using R version 2.12.0 Patched (2010-10-15 r53323)
> * using platform: i386-apple-darwin10.4.0 (32-bit)
> * using session charset: UTF-8
> * checking for file ?nlme/DESCRIPTION? ... OK
> * this is package ?nlme? version ?3.1-97?
> * checking package name space information ... OK
> * checking package dependencies ... ERROR
> Package required but not available: Hmisc
>
> See the information on DESCRIPTION files in the chapter
> 'Creating R packages' of the 'Writing R Extensions' manual.
>
>
>
>> From what I can tell, nlme is the only core/recommended package 
>> that now has a "Suggests" in the DESCRIPTION file for a 
>> non-core/non-recommended package. This Suggests for Frank's Hmisc 
>> appears to be new as of version 3.1.-97 of nlme.
>
> A search of the examples/tests for nlme yields an example in augPred_lab.R as follows, which appears to be the only code based reference to Hmisc in the nlme package:
>
> library(nlme)
> if(require("Hmisc")) {
>    T.aug <- Orthodont
>    label(T.aug$age) <- 'anyL'
>    foo <- augPred(lme(distance ~ age, random = ~1|Subject, data=T.aug))
>    ## failed in 3.1-72
> }
>
> ## failed even if there is a variable with a class that is not being used.
> T.aug <- Orthodont
> T.aug$newage <- T.aug$age
> class(T.aug$newage) <- 'anyC'
> foo <- augPred(lme(distance ~ age, random = ~1|Subject, data=T.aug))
> ## failed in 3.1-72
>
>
>
> The above example/test is not new to the package, so it would seem that something has changed in the handling of Suggests in the package DESCRIPTION file in 2.12.0.
>
> A check of the log for nlme on CRAN does not reveal any problems for 2.12.0, but presumably since Hmisc would be available there, the check would not logically fail, whereas with a clean local build not containing any add-on packages, it would.
>
>
> Running R CMD check from the CLI directly on the nlme package using 2.12.0 yields:
>
> ./R CMD check nlme_3.1-97.tar.gz
> * using log directory ?/Users/marcschwartz/R.Files/SourceCode/32bitR/bin/nlme.Rcheck?
> * using R version 2.12.0 Patched (2010-10-15 r53329)
> * using platform: i386-apple-darwin10.4.0 (32-bit)
> * using session charset: UTF-8
> * checking for file ?nlme/DESCRIPTION? ... OK
> * this is package ?nlme? version ?3.1-97?
> * checking package name space information ... OK
> * checking package dependencies ... ERROR
> Package required but not available: Hmisc
>
> See the information on DESCRIPTION files in the chapter
> 'Creating R packages' of the 'Writing R Extensions' manual.
>
>
> whereas running R CMD check using 2.11.1 patched on the same new version of nlme does not yield an error. So, again, it would seem that something has changed in 2.12.0.
>
>> From a review of R-Exts, the following language was in 2.11.1 patched in section 1.1.1 for the 'general rules':
>
> All packages that are needed to successfully run R CMD check on the package must be listed in one of ?Depends? or ?Suggests? or ?Imports?.
>
>
> whereas in 2.12.0:
>
> All packages that are needed to successfully run R CMD check on the package must be listed in one of ?Depends? or ?Suggests? or ?Imports?. Packages used to run examples or tests conditionally (e.g. via if(require(pkgname))) should be listed in ?Suggests? or ?Enhances?. (This allows checkers to ensure that all the packages needed for a complete check are installed.)
>
>
> So, without looking through code in the 'tools' package yet, it would seem that the tests in 2.12.0 are perhaps intended to be more rigorous, although I did not see an obvious change in the language in the 'checking packages' section of R-Exts, under bullet number 5 regarding the tests aborting.
>
> This leads me to the question, in the case of nlme, should R CMD check fail if Hmisc is not present in a clean build tree? Or, should the use of Hmisc in the example be removed along with the Suggests entry in the DESCRIPTION file, such that none of the core/recommended packages are dependent upon any third party packages?
>
> The former may be a functional issue, whereas the latter would seem to me to be an appropriate policy issue (not specifically pertaining to Hmisc or Frank, of course).
>
> Thanks,
>
> Marc Schwartz
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From vogranovich at jumptrading.com  Fri Oct 15 20:45:11 2010
From: vogranovich at jumptrading.com (Vadim Ogranovich)
Date: Fri, 15 Oct 2010 13:45:11 -0500
Subject: [Rd] calling browser on error
In-Reply-To: <AANLkTinuY+RkavSeKW9OFmysmAK9ey8APViPT8X5K2r4@mail.gmail.com>
References: <25C02255A75A684A9CF77F7D663B438F95180C77@chiexchange02.w2k.jumptrading.com>
	<AANLkTinuY+RkavSeKW9OFmysmAK9ey8APViPT8X5K2r4@mail.gmail.com>
Message-ID: <25C02255A75A684A9CF77F7D663B438F95180C78@chiexchange02.w2k.jumptrading.com>

Joshua,

I didn't know about 'recover', thank you!

Anyway it doesn't work for me:
> tryCatch((function() { x <- 1; stop('ok') })(), error=recover())

Enter a frame number, or 0 to exit

1: tryCatch((function() {

Selection: 1
Called from: eval(expr, envir, enclos)
Browse[1]> x
Error: object 'x' not found
Browse[1]> Q

Though it does work if I set options(error = recover):
> options(error = recover)
> (function() { x <- 1; stop('ok') })()
Error in (function() { : ok

Enter a frame number, or 0 to exit

1: (function() {

Selection: 1
Called from: eval(expr, envir, enclos)
Browse[1]> x
[1] 1
Browse[1]> Q

I do not run the latest R so it might be the reason:
> version
               _
platform       i386-pc-mingw32
arch           i386
os             mingw32
system         i386, mingw32
status
major          2
minor          9.1
year           2009
month          06
day            26
svn rev        48839
language       R
version.string R version 2.9.1 (2009-06-26)


-----Original Message-----
From: Joshua Ulrich [mailto:josh.m.ulrich at gmail.com]
Sent: Friday, October 15, 2010 1:31 PM
To: Vadim Ogranovich
Cc: r-devel at r-project.org
Subject: Re: [Rd] calling browser on error

I believe options(error=recover) will do what you want.

--
Joshua Ulrich  |  FOSS Trading: www.fosstrading.com



On Fri, Oct 15, 2010 at 1:27 PM, Vadim Ogranovich
<vogranovich at jumptrading.com> wrote:
> Dear R-developers,
>
> I am trying to figure out a way to call browser() when an error occur, and naturally I want the browser() to be called in the environment of the error.
>
> I tried something simple in vain:
>
>> f <- function() { x <- 1; stop('ok') }
>> tryCatch(f(), error=browser())
> Called from: tryCatch(f(), error = browser())
> ## if browser() was called in the local environment of f then 'x' would be set, but it's not
> Browse[1]> x
> Error: object 'x' not found
> Browse[1]> Q
>
> Is there a way to make it work? What do people do to 'set an on-error breakpoint'?
>
> Thanks,
> Vadim
>
>
> Note: This email is for the confidential use of the named addressee(s) only and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you are hereby notified that any review, dissemination or copying of this email is strictly prohibited, and to please notify the sender immediately and destroy this email and any attachments.  Email transmission cannot be guaranteed to be secure or error-free.  Jump Trading, therefore, does not make any guarantees as to the completeness or accuracy of this email or any attachments.  This email is for informational purposes only and does not constitute a recommendation, offer, request or solicitation of any kind to buy, sell, subscribe, redeem or perform any type of transaction of a financial product.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

Note: This email is for the confidential use of the named addressee(s) only and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you are hereby notified that any review, dissemination or copying of this email is strictly prohibited, and to please notify the sender immediately and destroy this email and any attachments.  Email transmission cannot be guaranteed to be secure or error-free.  Jump Trading, therefore, does not make any guarantees as to the completeness or accuracy of this email or any attachments.  This email is for informational purposes only and does not constitute a recommendation, offer, request or solicitation of any kind to buy, sell, subscribe, redeem or perform any type of transaction of a financial product.


From wdunlap at tibco.com  Fri Oct 15 21:16:15 2010
From: wdunlap at tibco.com (William Dunlap)
Date: Fri, 15 Oct 2010 12:16:15 -0700
Subject: [Rd] calling browser on error
In-Reply-To: <25C02255A75A684A9CF77F7D663B438F95180C78@chiexchange02.w2k.jumptrading.com>
References: <25C02255A75A684A9CF77F7D663B438F95180C77@chiexchange02.w2k.jumptrading.com><AANLkTinuY+RkavSeKW9OFmysmAK9ey8APViPT8X5K2r4@mail.gmail.com>
	<25C02255A75A684A9CF77F7D663B438F95180C78@chiexchange02.w2k.jumptrading.com>
Message-ID: <77EB52C6DD32BA4D87471DCD70C8D700038B1F32@NA-PA-VBE03.na.tibco.com>

He said to use options(error=...) instead of
tryCatch(error=...).  In C++ lingo, the handler
set by options("error") is called when the exception
is thrown while tryCatch's handler is called
when it is caught.

Bill Dunlap
Spotfire, TIBCO Software
wdunlap tibco.com  

> -----Original Message-----
> From: r-devel-bounces at r-project.org 
> [mailto:r-devel-bounces at r-project.org] On Behalf Of Vadim Ogranovich
> Sent: Friday, October 15, 2010 11:45 AM
> To: 'Joshua Ulrich'
> Cc: r-devel at r-project.org
> Subject: Re: [Rd] calling browser on error
> 
> Joshua,
> 
> I didn't know about 'recover', thank you!
> 
> Anyway it doesn't work for me:
> > tryCatch((function() { x <- 1; stop('ok') })(), error=recover())
> 
> Enter a frame number, or 0 to exit
> 
> 1: tryCatch((function() {
> 
> Selection: 1
> Called from: eval(expr, envir, enclos)
> Browse[1]> x
> Error: object 'x' not found
> Browse[1]> Q
> 
> Though it does work if I set options(error = recover):
> > options(error = recover)
> > (function() { x <- 1; stop('ok') })()
> Error in (function() { : ok
> 
> Enter a frame number, or 0 to exit
> 
> 1: (function() {
> 
> Selection: 1
> Called from: eval(expr, envir, enclos)
> Browse[1]> x
> [1] 1
> Browse[1]> Q
> 
> I do not run the latest R so it might be the reason:
> > version
>                _
> platform       i386-pc-mingw32
> arch           i386
> os             mingw32
> system         i386, mingw32
> status
> major          2
> minor          9.1
> year           2009
> month          06
> day            26
> svn rev        48839
> language       R
> version.string R version 2.9.1 (2009-06-26)
> 
> 
> -----Original Message-----
> From: Joshua Ulrich [mailto:josh.m.ulrich at gmail.com]
> Sent: Friday, October 15, 2010 1:31 PM
> To: Vadim Ogranovich
> Cc: r-devel at r-project.org
> Subject: Re: [Rd] calling browser on error
> 
> I believe options(error=recover) will do what you want.
> 
> --
> Joshua Ulrich  |  FOSS Trading: www.fosstrading.com
> 
> 
> 
> On Fri, Oct 15, 2010 at 1:27 PM, Vadim Ogranovich
> <vogranovich at jumptrading.com> wrote:
> > Dear R-developers,
> >
> > I am trying to figure out a way to call browser() when an 
> error occur, and naturally I want the browser() to be called 
> in the environment of the error.
> >
> > I tried something simple in vain:
> >
> >> f <- function() { x <- 1; stop('ok') }
> >> tryCatch(f(), error=browser())
> > Called from: tryCatch(f(), error = browser())
> > ## if browser() was called in the local environment of f 
> then 'x' would be set, but it's not
> > Browse[1]> x
> > Error: object 'x' not found
> > Browse[1]> Q
> >
> > Is there a way to make it work? What do people do to 'set 
> an on-error breakpoint'?
> >
> > Thanks,
> > Vadim
> >
> >
> > Note: This email is for the confidential use of the named 
> addressee(s) only and may contain proprietary, confidential 
> or privileged information. If you are not the intended 
> recipient, you are hereby notified that any review, 
> dissemination or copying of this email is strictly 
> prohibited, and to please notify the sender immediately and 
> destroy this email and any attachments.  Email transmission 
> cannot be guaranteed to be secure or error-free.  Jump 
> Trading, therefore, does not make any guarantees as to the 
> completeness or accuracy of this email or any attachments.  
> This email is for informational purposes only and does not 
> constitute a recommendation, offer, request or solicitation 
> of any kind to buy, sell, subscribe, redeem or perform any 
> type of transaction of a financial product.
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >
> 
> Note: This email is for the confidential use of the named 
> addressee(s) only and may contain proprietary, confidential 
> or privileged information. If you are not the intended 
> recipient, you are hereby notified that any review, 
> dissemination or copying of this email is strictly 
> prohibited, and to please notify the sender immediately and 
> destroy this email and any attachments.  Email transmission 
> cannot be guaranteed to be secure or error-free.  Jump 
> Trading, therefore, does not make any guarantees as to the 
> completeness or accuracy of this email or any attachments.  
> This email is for informational purposes only and does not 
> constitute a recommendation, offer, request or solicitation 
> of any kind to buy, sell, subscribe, redeem or perform any 
> type of transaction of a financial product.
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 


From marc_schwartz at me.com  Fri Oct 15 22:15:52 2010
From: marc_schwartz at me.com (Marc Schwartz)
Date: Fri, 15 Oct 2010 15:15:52 -0500
Subject: [Rd] Package 'nlme' fails 'make check-all' in R 2.12.0 patched
 built from source
In-Reply-To: <alpine.LFD.2.00.1010151940070.1299@gannet.stats.ox.ac.uk>
References: <CFDA7E70-31C6-41C8-BA9B-6583D0EBC432@me.com>
	<alpine.LFD.2.00.1010151940070.1299@gannet.stats.ox.ac.uk>
Message-ID: <A0D51310-616B-4D84-A4C5-9399FD8565A1@me.com>


On Oct 15, 2010, at 1:44 PM, Prof Brian Ripley wrote:

> Marc,
> 
> For make check-all you may need to set
> 
> setenv _R_CHECK_FORCE_SUGGESTS_ FALSE
> 
> Yes, there is a change in nlme, because packages needed for complete testing are required to be listed in DESCRIPTION: see 'Writing R Extensions'.
> 
> Most of us have that environmnet variable set.
> 
> Brian
> 

<snip>

A quick follow up here. Thanks to Prof. Ripley for the pointer to the above env variable. 

Setting that now obviates the issue and the build now passes 'make check-all'.

And...apologies that I did not have a chance to test/catch this prior to release today.

Thanks much,

Marc


From cubranic at stat.ubc.ca  Fri Oct 15 22:53:45 2010
From: cubranic at stat.ubc.ca (Davor Cubranic)
Date: Fri, 15 Oct 2010 13:53:45 -0700
Subject: [Rd] Missing libpthread in RTools
Message-ID: <201010151353.45576.cubranic@stat.ubc.ca>

It appears that Mingw gcc included in RTools is missing a dependent 
library. If I compile a program with '-lgomp' switch (for OpenMP 
support), I get a errors about undefined references to functions like 
'_imp__pthread_mutex_destroy'. Adding the '-static' switch, I get the 
following error:

    c:/rtools/mingw/bin/../lib/gcc/mingw32/4.5.0/../../../../mingw32/bin/ld.exe: 
cannot find -lpthread

Sure enough, there is neither libpthread.a nor libpthread.dll under 
RTools' installation directory. I think these library are standard in 
Cygwin. Is there any chance to include them in RTools, too?

Davor


From murdoch.duncan at gmail.com  Sat Oct 16 01:39:53 2010
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Fri, 15 Oct 2010 19:39:53 -0400
Subject: [Rd] Missing libpthread in RTools
In-Reply-To: <201010151353.45576.cubranic@stat.ubc.ca>
References: <201010151353.45576.cubranic@stat.ubc.ca>
Message-ID: <4CB8E649.2070709@gmail.com>

On 15/10/2010 4:53 PM, Davor Cubranic wrote:
> It appears that Mingw gcc included in RTools is missing a dependent
> library. If I compile a program with '-lgomp' switch (for OpenMP
> support), I get a errors about undefined references to functions like
> '_imp__pthread_mutex_destroy'. Adding the '-static' switch, I get the
> following error:
>
>      c:/rtools/mingw/bin/../lib/gcc/mingw32/4.5.0/../../../../mingw32/bin/ld.exe:
> cannot find -lpthread
>
> Sure enough, there is neither libpthread.a nor libpthread.dll under
> RTools' installation directory. I think these library are standard in
> Cygwin. Is there any chance to include them in RTools, too?

Rtools is for building R, and that library isn't needed in R.  If you 
want it for some particular purpose, can't you just install a copy on 
your machine?

Duncan Murdoch

>
> Davor
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From luke at stat.uiowa.edu  Sat Oct 16 02:54:13 2010
From: luke at stat.uiowa.edu (luke at stat.uiowa.edu)
Date: Fri, 15 Oct 2010 19:54:13 -0500 (CDT)
Subject: [Rd] calling browser on error
In-Reply-To: <77EB52C6DD32BA4D87471DCD70C8D700038B1F32@NA-PA-VBE03.na.tibco.com>
References: <25C02255A75A684A9CF77F7D663B438F95180C77@chiexchange02.w2k.jumptrading.com><AANLkTinuY+RkavSeKW9OFmysmAK9ey8APViPT8X5K2r4@mail.gmail.com>
	<25C02255A75A684A9CF77F7D663B438F95180C78@chiexchange02.w2k.jumptrading.com>
	<77EB52C6DD32BA4D87471DCD70C8D700038B1F32@NA-PA-VBE03.na.tibco.com>
Message-ID: <alpine.DEB.2.00.1010151953330.1945@luke-inspiron>

On Fri, 15 Oct 2010, William Dunlap wrote:

> He said to use options(error=...) instead of
> tryCatch(error=...).  In C++ lingo, the handler
> set by options("error") is called when the exception
> is thrown while tryCatch's handler is called
> when it is caught.

withCallingHandlers is another option.

luke

>
> Bill Dunlap
> Spotfire, TIBCO Software
> wdunlap tibco.com
>
>> -----Original Message-----
>> From: r-devel-bounces at r-project.org
>> [mailto:r-devel-bounces at r-project.org] On Behalf Of Vadim Ogranovich
>> Sent: Friday, October 15, 2010 11:45 AM
>> To: 'Joshua Ulrich'
>> Cc: r-devel at r-project.org
>> Subject: Re: [Rd] calling browser on error
>>
>> Joshua,
>>
>> I didn't know about 'recover', thank you!
>>
>> Anyway it doesn't work for me:
>>> tryCatch((function() { x <- 1; stop('ok') })(), error=recover())
>>
>> Enter a frame number, or 0 to exit
>>
>> 1: tryCatch((function() {
>>
>> Selection: 1
>> Called from: eval(expr, envir, enclos)
>> Browse[1]> x
>> Error: object 'x' not found
>> Browse[1]> Q
>>
>> Though it does work if I set options(error = recover):
>>> options(error = recover)
>>> (function() { x <- 1; stop('ok') })()
>> Error in (function() { : ok
>>
>> Enter a frame number, or 0 to exit
>>
>> 1: (function() {
>>
>> Selection: 1
>> Called from: eval(expr, envir, enclos)
>> Browse[1]> x
>> [1] 1
>> Browse[1]> Q
>>
>> I do not run the latest R so it might be the reason:
>>> version
>>                _
>> platform       i386-pc-mingw32
>> arch           i386
>> os             mingw32
>> system         i386, mingw32
>> status
>> major          2
>> minor          9.1
>> year           2009
>> month          06
>> day            26
>> svn rev        48839
>> language       R
>> version.string R version 2.9.1 (2009-06-26)
>>
>>
>> -----Original Message-----
>> From: Joshua Ulrich [mailto:josh.m.ulrich at gmail.com]
>> Sent: Friday, October 15, 2010 1:31 PM
>> To: Vadim Ogranovich
>> Cc: r-devel at r-project.org
>> Subject: Re: [Rd] calling browser on error
>>
>> I believe options(error=recover) will do what you want.
>>
>> --
>> Joshua Ulrich  |  FOSS Trading: www.fosstrading.com
>>
>>
>>
>> On Fri, Oct 15, 2010 at 1:27 PM, Vadim Ogranovich
>> <vogranovich at jumptrading.com> wrote:
>>> Dear R-developers,
>>>
>>> I am trying to figure out a way to call browser() when an
>> error occur, and naturally I want the browser() to be called
>> in the environment of the error.
>>>
>>> I tried something simple in vain:
>>>
>>>> f <- function() { x <- 1; stop('ok') }
>>>> tryCatch(f(), error=browser())
>>> Called from: tryCatch(f(), error = browser())
>>> ## if browser() was called in the local environment of f
>> then 'x' would be set, but it's not
>>> Browse[1]> x
>>> Error: object 'x' not found
>>> Browse[1]> Q
>>>
>>> Is there a way to make it work? What do people do to 'set
>> an on-error breakpoint'?
>>>
>>> Thanks,
>>> Vadim
>>>
>>>
>>> Note: This email is for the confidential use of the named
>> addressee(s) only and may contain proprietary, confidential
>> or privileged information. If you are not the intended
>> recipient, you are hereby notified that any review,
>> dissemination or copying of this email is strictly
>> prohibited, and to please notify the sender immediately and
>> destroy this email and any attachments.  Email transmission
>> cannot be guaranteed to be secure or error-free.  Jump
>> Trading, therefore, does not make any guarantees as to the
>> completeness or accuracy of this email or any attachments.
>> This email is for informational purposes only and does not
>> constitute a recommendation, offer, request or solicitation
>> of any kind to buy, sell, subscribe, redeem or perform any
>> type of transaction of a financial product.
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>
>> Note: This email is for the confidential use of the named
>> addressee(s) only and may contain proprietary, confidential
>> or privileged information. If you are not the intended
>> recipient, you are hereby notified that any review,
>> dissemination or copying of this email is strictly
>> prohibited, and to please notify the sender immediately and
>> destroy this email and any attachments.  Email transmission
>> cannot be guaranteed to be secure or error-free.  Jump
>> Trading, therefore, does not make any guarantees as to the
>> completeness or accuracy of this email or any attachments.
>> This email is for informational purposes only and does not
>> constitute a recommendation, offer, request or solicitation
>> of any kind to buy, sell, subscribe, redeem or perform any
>> type of transaction of a financial product.
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Luke Tierney
Statistics and Actuarial Science
Ralph E. Wareham Professor of Mathematical Sciences
University of Iowa                  Phone:             319-335-3386
Department of Statistics and        Fax:               319-335-3017
    Actuarial Science
241 Schaeffer Hall                  email:      luke at stat.uiowa.edu
Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu


From djsamperi at gmail.com  Sat Oct 16 22:55:44 2010
From: djsamperi at gmail.com (Dominick Samperi)
Date: Sat, 16 Oct 2010 16:55:44 -0400
Subject: [Rd] R 2.12.0 doesn't install properly under Windows Vista
Message-ID: <AANLkTi=eV9iJeotY8wwjEKh0Ji8D6Te6AzHMKHo_HGuM@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20101016/44c7e3c7/attachment.pl>

From murdoch.duncan at gmail.com  Sun Oct 17 01:01:35 2010
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Sat, 16 Oct 2010 19:01:35 -0400
Subject: [Rd] R 2.12.0 doesn't install properly under Windows Vista
In-Reply-To: <AANLkTi=eV9iJeotY8wwjEKh0Ji8D6Te6AzHMKHo_HGuM@mail.gmail.com>
References: <AANLkTi=eV9iJeotY8wwjEKh0Ji8D6Te6AzHMKHo_HGuM@mail.gmail.com>
Message-ID: <4CBA2ECF.6040708@gmail.com>

On 16/10/2010 4:55 PM, Dominick Samperi wrote:
> After installing R 2.12.0 under windows Vista it does not start because it
> cannot
> find Rgui.exe. Indeed, the contents of R\R-2.12.0\bin are:
>
> config.sh
> R.exe
> Rscript.exe
> Sd2Rd.pl
>
> It appears that a few things are missing...

The original build was missing the contents of bin/i386, which is where 
32 bit binaries are stored now.  A new build has been done, and it will 
eventually make it to CRAN and the mirrors.

Check the date on the bottom of the bin/windows/base page on CRAN: 
2010-10-15 is bad, 2010-10-16 is good (as far as I know).

Duncan Murdoch


From jwiley.psych at gmail.com  Sun Oct 17 06:36:53 2010
From: jwiley.psych at gmail.com (Joshua Wiley)
Date: Sat, 16 Oct 2010 21:36:53 -0700
Subject: [Rd] R 2.12.0 doesn't install properly under Windows Vista
In-Reply-To: <4CBA2ECF.6040708@gmail.com>
References: <AANLkTi=eV9iJeotY8wwjEKh0Ji8D6Te6AzHMKHo_HGuM@mail.gmail.com>
	<4CBA2ECF.6040708@gmail.com>
Message-ID: <AANLkTinsGqRQ+Q-iOEuOrFKSA_3h6DiRfTOBCpBxBaxC@mail.gmail.com>

On Sat, Oct 16, 2010 at 4:01 PM, Duncan Murdoch
<murdoch.duncan at gmail.com> wrote:
> On 16/10/2010 4:55 PM, Dominick Samperi wrote:
>>
>> After installing R 2.12.0 under windows Vista it does not start because it
>> cannot
>> find Rgui.exe. Indeed, the contents of R\R-2.12.0\bin are:
>>
>> config.sh
>> R.exe
>> Rscript.exe
>> Sd2Rd.pl
>>
>> It appears that a few things are missing...
>
> The original build was missing the contents of bin/i386, which is where 32
> bit binaries are stored now. ?A new build has been done, and it will
> eventually make it to CRAN and the mirrors.
>
> Check the date on the bottom of the bin/windows/base page on CRAN:
> 2010-10-15 is bad, 2010-10-16 is good (as far as I know).

Just FYI, I successfully installed R 2.12.0 (2010-10-16) on Windows XP
32bit.  I'll try it on 7 x64 tomorrow, but so far the GUI, Rterm, and
R CMD BATCH all worked great.

Thanks for spending your Saturday making this available, Duncan!

Josh

>
> Duncan Murdoch
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


-- 
Joshua Wiley
Ph.D. Student, Health Psychology
University of California, Los Angeles
http://www.joshuawiley.com/


From djsamperi at gmail.com  Sun Oct 17 15:02:36 2010
From: djsamperi at gmail.com (Dominick Samperi)
Date: Sun, 17 Oct 2010 09:02:36 -0400
Subject: [Rd] R 2.12.0 doesn't install properly under Windows Vista
In-Reply-To: <4CBA2ECF.6040708@gmail.com>
References: <AANLkTi=eV9iJeotY8wwjEKh0Ji8D6Te6AzHMKHo_HGuM@mail.gmail.com>
	<4CBA2ECF.6040708@gmail.com>
Message-ID: <AANLkTinDZYd2qUpbwDA9PT_=LQ5JjQpub7zVF_ywNzsT@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20101017/6ae82fb9/attachment.pl>

From yintengfei at gmail.com  Sun Oct 17 23:50:22 2010
From: yintengfei at gmail.com (Tengfei Yin)
Date: Sun, 17 Oct 2010 16:50:22 -0500
Subject: [Rd] make error for R 2.13.0
Message-ID: <AANLkTinaAkdRhMad-WDad5inR=TSgBpuL87ry-mBjGjf@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20101017/a1a9da72/attachment.pl>

From HodgessE at uhd.edu  Mon Oct 18 02:08:07 2010
From: HodgessE at uhd.edu (Hodgess, Erin)
Date: Sun, 17 Oct 2010 19:08:07 -0500
Subject: [Rd] R 2.12.0 doesn't install properly under Windows Vista
References: <AANLkTi=eV9iJeotY8wwjEKh0Ji8D6Te6AzHMKHo_HGuM@mail.gmail.com>
	<4CBA2ECF.6040708@gmail.com>
Message-ID: <586A4828D7AAA04CA9B258C50A28DA206DAF87@BALI.uhd.campus>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20101017/c7f6bad7/attachment.pl>

From murdoch.duncan at gmail.com  Mon Oct 18 02:16:38 2010
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Sun, 17 Oct 2010 20:16:38 -0400
Subject: [Rd] R 2.12.0 doesn't install properly under Windows Vista
In-Reply-To: <586A4828D7AAA04CA9B258C50A28DA206DAF87@BALI.uhd.campus>
References: <AANLkTi=eV9iJeotY8wwjEKh0Ji8D6Te6AzHMKHo_HGuM@mail.gmail.com>
	<4CBA2ECF.6040708@gmail.com>
	<586A4828D7AAA04CA9B258C50A28DA206DAF87@BALI.uhd.campus>
Message-ID: <4CBB91E6.7030300@gmail.com>

Hodgess, Erin wrote:
> Dear R Developers:
>  
> I'm having the same trouble (no Rgui.exe) when compiling from source.
>  
> This is on a Windows XP with the latest Rtools.
>   

That is a different problem.  I was never missing Rgui.exe in the 
compiles I did; I just made a mistake that stopped it from being 
included in the installer.

So you'll need to debug what's going wrong in your build process that 
stops Rgui.exe from being built.

Duncan Murdoch

>  
> Sorry to be a pest.
> Thanks,
> Erin
>  
>  
> Erin M. Hodgess, PhD
> Associate Professor
> Department of Computer and Mathematical Sciences
> University of Houston - Downtown
> mailto: hodgesse at uhd.edu
>  
>
> ________________________________
>
> From: r-devel-bounces at r-project.org on behalf of Duncan Murdoch
> Sent: Sat 10/16/2010 6:01 PM
> To: Dominick Samperi
> Cc: r-devel at r-project.org
> Subject: Re: [Rd] R 2.12.0 doesn't install properly under Windows Vista
>
>
>
> On 16/10/2010 4:55 PM, Dominick Samperi wrote:
>   
>> After installing R 2.12.0 under windows Vista it does not start because it
>> cannot
>> find Rgui.exe. Indeed, the contents of R\R-2.12.0\bin are:
>>
>> config.sh
>> R.exe
>> Rscript.exe
>> Sd2Rd.pl
>>
>> It appears that a few things are missing...
>>     
>
> The original build was missing the contents of bin/i386, which is where
> 32 bit binaries are stored now.  A new build has been done, and it will
> eventually make it to CRAN and the mirrors.
>
> Check the date on the bottom of the bin/windows/base page on CRAN:
> 2010-10-15 is bad, 2010-10-16 is good (as far as I know).
>
> Duncan Murdoch
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>
>
>


From radford at cs.toronto.edu  Mon Oct 18 02:39:08 2010
From: radford at cs.toronto.edu (Radford Neal)
Date: Sun, 17 Oct 2010 20:39:08 -0400
Subject: [Rd] make error for R 2.13.0 (and 2.12.0)
Message-ID: <20101018003908.GA990@cs.toronto.edu>

Regarding Tengfei Yin's post about an error trying to install
"cluster" in 2.13.0, I have gotten an error with this package when
trying to install the released version of 2.12.0.  Here is the output
on an Ubuntu Linux system:

begin installing recommended package cluster
* installing *source* package 'cluster' ...
** libs
make[3]: Entering directory `/tmp/RtmpWX7ecF/R.INSTALL2aaf76ad/cluster/src'
gcc -std=gnu99 -I/u/radford/R/R-2.12.0-rel2/include  -I/usr/local/include    -fpic  -g -O2 -c clara.c -o clara.o
g77   -fpic  -g -O2 -c daisy.f -o daisy.o
g77   -fpic  -g -O2 -c dysta.f -o dysta.o
gcc -std=gnu99 -I/u/radford/R/R-2.12.0-rel2/include  -I/usr/local/include    -fpic  -g -O2 -c fanny.c -o fanny.o
gcc -std=gnu99 -I/u/radford/R/R-2.12.0-rel2/include  -I/usr/local/include    -fpic  -g -O2 -c init.c -o init.o
g77   -fpic  -g -O2 -c meet.f -o meet.o
g77   -fpic  -g -O2 -c mona.f -o mona.o
gcc -std=gnu99 -I/u/radford/R/R-2.12.0-rel2/include  -I/usr/local/include    -fpic  -g -O2 -c pam.c -o pam.o
gcc -std=gnu99 -I/u/radford/R/R-2.12.0-rel2/include  -I/usr/local/include    -fpic  -g -O2 -c sildist.c -o sildist.o
gcc -std=gnu99 -I/u/radford/R/R-2.12.0-rel2/include  -I/usr/local/include    -fpic  -g -O2 -c spannel.c -o spannel.o
g77   -fpic  -g -O2 -c twins.f -o twins.o
gcc -std=gnu99 -shared -L/usr/local/lib -o cluster.so clara.o daisy.o dysta.o fanny.o init.o meet.o mona.o pam.o sildist.o spannel.o twins.o -L/usr/lib/gcc/i486-linux-gnu/3.4.6 -lg2c -lm
make[3]: Leaving directory `/tmp/RtmpWX7ecF/R.INSTALL2aaf76ad/cluster/src'
installing to /h/253/radford/R/R-2.12.0-rel2/library/cluster/libs
** R
** data
**  moving datasets to lazyload DB
** inst
** preparing package for lazy loading
** help
*** installing help indices
** building package indices ...
** testing if installed package can be loaded
Error in dyn.load(file, DLLpath = DLLpath, ...) : 
  unable to load shared object '/h/253/radford/R/R-2.12.0-rel2/library/cluster/libs/cluster.so':
  /h/253/radford/R/R-2.12.0-rel2/library/cluster/libs/cluster.so: undefined symbol: cl_daisy_
ERROR: loading failed
* removing '/h/253/radford/R/R-2.12.0-rel2/library/cluster'
make[2]: *** [cluster.ts] Error 1
make[2]: Leaving directory `/h/253/radford/R/R-2.12.0-rel2/src/library/Recommended'
make[1]: *** [recommended-packages] Error 2
make[1]: Leaving directory `/h/253/radford/R/R-2.12.0-rel2/src/library/Recommended'
make: *** [stamp-recommended] Error 2

Here is the output of gcc -v for this system:

Using built-in specs.
Target: i486-linux-gnu
Configured with: ../src/configure -v --enable-languages=c,c++,fortran,objc,obj-c++,treelang --prefix=/usr --enable-shared --with-system-zlib --libexecdir=/usr/lib --without-included-gettext --enable-threads=posix --enable-nls --with-gxx-include-dir=/usr/include/c++/4.2 --program-suffix=-4.2 --enable-clocale=gnu --enable-libstdcxx-debug --enable-objc-gc --enable-mpfr --enable-targets=all --enable-checking=release --build=i486-linux-gnu --host=i486-linux-gnu --target=i486-linux-gnu
Thread model: posix
gcc version 4.2.4 (Ubuntu 4.2.4-1ubuntu4)

This R-2.12.0 installation generally works (based on testing a few
trivial things).  The same error occurs when trying to install 2.12.0
on Intel Solaris.

   Radford Neal


From Bill.Venables at csiro.au  Mon Oct 18 02:48:12 2010
From: Bill.Venables at csiro.au (Bill.Venables at csiro.au)
Date: Mon, 18 Oct 2010 11:48:12 +1100
Subject: [Rd] R 2.12.0  problems with Windows XP 32-bit binary installer
In-Reply-To: <4CBB91E6.7030300@gmail.com>
References: <AANLkTi=eV9iJeotY8wwjEKh0Ji8D6Te6AzHMKHo_HGuM@mail.gmail.com>
	<4CBA2ECF.6040708@gmail.com>
	<586A4828D7AAA04CA9B258C50A28DA206DAF87@BALI.uhd.campus>
	<4CBB91E6.7030300@gmail.com>
Message-ID: <1BDAE2969943D540934EE8B4EF68F95FB27A44F64F@EXNSW-MBX03.nexus.csiro.au>

I am having a problem with the installed R 2.12.0 on 32-bit Windows XP machine using the binary version. 

The installer I am using is R-2.12.0-win.exe .  The problem I have is that some of my installed packages will not load, in particular PolynomF, which has a pre-compiled .dll.  Other packages such as SOAR, which is pure R, attach and work without a hitch.

The error message I am getting when trying to load PolynomF is a question whether or not the package has been compiled for the present architecture.  (This package works without a hitch on R-2.11.1, for example.)

Is there any significance in the name of the installer now including just "win" rather than "win32", as it was in the last release?

Is it the case that all packages will have to be re-built for the present release?

Bill Venables.

From murdoch.duncan at gmail.com  Mon Oct 18 02:53:48 2010
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Sun, 17 Oct 2010 20:53:48 -0400
Subject: [Rd] R 2.12.0 problems with Windows XP 32-bit binary installer
In-Reply-To: <1BDAE2969943D540934EE8B4EF68F95FB27A44F64F@EXNSW-MBX03.nexus.csiro.au>
References: <AANLkTi=eV9iJeotY8wwjEKh0Ji8D6Te6AzHMKHo_HGuM@mail.gmail.com>	<4CBA2ECF.6040708@gmail.com>	<586A4828D7AAA04CA9B258C50A28DA206DAF87@BALI.uhd.campus>
	<4CBB91E6.7030300@gmail.com>
	<1BDAE2969943D540934EE8B4EF68F95FB27A44F64F@EXNSW-MBX03.nexus.csiro.au>
Message-ID: <4CBB9A9C.6080100@gmail.com>

Bill.Venables at csiro.au wrote:
> I am having a problem with the installed R 2.12.0 on 32-bit Windows XP machine using the binary version. 
>
> The installer I am using is R-2.12.0-win.exe .  The problem I have is that some of my installed packages will not load, in particular PolynomF, which has a pre-compiled .dll.  Other packages such as SOAR, which is pure R, attach and work without a hitch.
>
> The error message I am getting when trying to load PolynomF is a question whether or not the package has been compiled for the present architecture.  (This package works without a hitch on R-2.11.1, for example.)
>
> Is there any significance in the name of the installer now including just "win" rather than "win32", as it was in the last release?
>
> Is it the case that all packages will have to be re-built for the present release?


Generally packages do need to be rebuilt for new versions of R (other 
than patch releases, where only the last digit changes).  R 2.12.0 
supports both 32 bit and 64 bit Windows in the same installation, and 
since Windows doesn't have MacOS-like "universal" binaries, that means 
binaries need to be put in the right place.  Generally that's an i386 
subdirectory for 32 bit, and an x64 directory for 64 bit. 

I don't know why a 32 bit DLL wouldn't work with 32 bit R 2.12.0, but if 
it was installed for 2.11.1, it might not be in the right place.

Duncan Murdoch


From HodgessE at uhd.edu  Mon Oct 18 03:44:23 2010
From: HodgessE at uhd.edu (Hodgess, Erin)
Date: Sun, 17 Oct 2010 20:44:23 -0500
Subject: [Rd] R 2.12.0 problems with Windows XP 32-bit binary installer
References: <AANLkTi=eV9iJeotY8wwjEKh0Ji8D6Te6AzHMKHo_HGuM@mail.gmail.com>	<4CBA2ECF.6040708@gmail.com>	<586A4828D7AAA04CA9B258C50A28DA206DAF87@BALI.uhd.campus>
	<4CBB91E6.7030300@gmail.com>
	<1BDAE2969943D540934EE8B4EF68F95FB27A44F64F@EXNSW-MBX03.nexus.csiro.au>
	<4CBB9A9C.6080100@gmail.com>
Message-ID: <586A4828D7AAA04CA9B258C50A28DA206DAF89@BALI.uhd.campus>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20101017/2c0707e3/attachment.pl>

From bbolker at gmail.com  Sat Oct 16 10:27:49 2010
From: bbolker at gmail.com (Ben Bolker)
Date: Sat, 16 Oct 2010 04:27:49 -0400
Subject: [Rd] r-forge down?
Message-ID: <4CB96205.7020201@ufl.edu>


  anyone have a status report on r-forge ... ?

  From here (Hamilton, ON) I can't ping ...

PING r-forge.wu-wien.ac.at (137.208.57.38) 56(84) bytes of data.

  cheers
    Ben Bolker


From ripley at stats.ox.ac.uk  Mon Oct 18 08:19:39 2010
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 18 Oct 2010 07:19:39 +0100 (BST)
Subject: [Rd] R 2.12.0 problems with Windows XP 32-bit binary installer
In-Reply-To: <586A4828D7AAA04CA9B258C50A28DA206DAF89@BALI.uhd.campus>
References: <AANLkTi=eV9iJeotY8wwjEKh0Ji8D6Te6AzHMKHo_HGuM@mail.gmail.com>
	<4CBA2ECF.6040708@gmail.com>
	<586A4828D7AAA04CA9B258C50A28DA206DAF87@BALI.uhd.campus>
	<4CBB91E6.7030300@gmail.com>
	<1BDAE2969943D540934EE8B4EF68F95FB27A44F64F@EXNSW-MBX03.nexus.csiro.au>
	<4CBB9A9C.6080100@gmail.com>
	<586A4828D7AAA04CA9B258C50A28DA206DAF89@BALI.uhd.campus>
Message-ID: <alpine.LFD.2.00.1010180714590.6193@gannet.stats.ox.ac.uk>

On Sun, 17 Oct 2010, Hodgess, Erin wrote:

> I found the Rgui.exe under directory R\R-2.12.0\bin\i386.

Please read the CHANGES file: this is the first item for 2.12.0.

I don't believe it is related to Bill's problem.  The latter looks 
like a package installed for R < 2.12.0 (also covered in the first 
item of CHANGES), but without the exact message we cannot be sure.

(For the record, Mac OS X has 'fat' binaries, but R does not use them 
for compiled code in packages - it used subdirectories just as on 
Windows.)

> Thanks,
> Erin
>
>
> Erin M. Hodgess, PhD
> Associate Professor
> Department of Computer and Mathematical Sciences
> University of Houston - Downtown
> mailto: hodgesse at uhd.edu
>
>
> ________________________________
>
> From: Duncan Murdoch [mailto:murdoch.duncan at gmail.com]
> Sent: Sun 10/17/2010 7:53 PM
> To: Bill.Venables at csiro.au
> Cc: Hodgess, Erin; r-devel at r-project.org
> Subject: Re: R 2.12.0 problems with Windows XP 32-bit binary installer
>
>
>
> Bill.Venables at csiro.au wrote:
>> I am having a problem with the installed R 2.12.0 on 32-bit Windows XP machine using the binary version.
>>
>> The installer I am using is R-2.12.0-win.exe .  The problem I have 
>> is that some of my installed packages will not load, in particular 
>> PolynomF, which has a pre-compiled .dll.  Other packages such as 
>> SOAR, which is pure R, attach and work without a hitch.
>>
>> The error message I am getting when trying to load PolynomF is a 
>> question whether or not the package has been compiled for the 
>> present architecture.  (This package works without a hitch on 
>> R-2.11.1, for example.)
>>
>> Is there any significance in the name of the installer now 
>> including just "win" rather than "win32", as it was in the last 
>> release?
>>
>> Is it the case that all packages will have to be re-built for the 
>> present release?
>
>
> Generally packages do need to be rebuilt for new versions of R (other
> than patch releases, where only the last digit changes).  R 2.12.0
> supports both 32 bit and 64 bit Windows in the same installation, and
> since Windows doesn't have MacOS-like "universal" binaries, that means
> binaries need to be put in the right place.  Generally that's an i386
> subdirectory for 32 bit, and an x64 directory for 64 bit.
>
> I don't know why a 32 bit DLL wouldn't work with 32 bit R 2.12.0, but if
> it was installed for 2.11.1, it might not be in the right place.
>
> Duncan Murdoch
>
>
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From Bill.Venables at csiro.au  Mon Oct 18 08:44:19 2010
From: Bill.Venables at csiro.au (Bill.Venables at csiro.au)
Date: Mon, 18 Oct 2010 17:44:19 +1100
Subject: [Rd] R 2.12.0 problems with Windows XP 32-bit binary installer
In-Reply-To: <alpine.LFD.2.00.1010180714590.6193@gannet.stats.ox.ac.uk>
References: <AANLkTi=eV9iJeotY8wwjEKh0Ji8D6Te6AzHMKHo_HGuM@mail.gmail.com>
	<4CBA2ECF.6040708@gmail.com>
	<586A4828D7AAA04CA9B258C50A28DA206DAF87@BALI.uhd.campus>
	<4CBB91E6.7030300@gmail.com>
	<1BDAE2969943D540934EE8B4EF68F95FB27A44F64F@EXNSW-MBX03.nexus.csiro.au>
	<4CBB9A9C.6080100@gmail.com>
	<586A4828D7AAA04CA9B258C50A28DA206DAF89@BALI.uhd.campus>
	<alpine.LFD.2.00.1010180714590.6193@gannet.stats.ox.ac.uk>
Message-ID: <1BDAE2969943D540934EE8B4EF68F95FB27A44F68E@EXNSW-MBX03.nexus.csiro.au>

Re-installing PolynomF did fix that problem, though there are now others, namely R under ESS does not work.  It bombs out with a curious message about text being read-only.  

For me this is an equally serious problem, but that's another mailing list.  You may wish to be aware of it, though.

Bill. 

-----Original Message-----
From: Prof Brian Ripley [mailto:ripley at stats.ox.ac.uk] 
Sent: Monday, 18 October 2010 4:20 PM
To: Hodgess, Erin
Cc: Duncan Murdoch; Venables, Bill (CMIS, Cleveland); r-devel at r-project.org
Subject: Re: [Rd] R 2.12.0 problems with Windows XP 32-bit binary installer

On Sun, 17 Oct 2010, Hodgess, Erin wrote:

> I found the Rgui.exe under directory R\R-2.12.0\bin\i386.

Please read the CHANGES file: this is the first item for 2.12.0.

I don't believe it is related to Bill's problem.  The latter looks 
like a package installed for R < 2.12.0 (also covered in the first 
item of CHANGES), but without the exact message we cannot be sure.

(For the record, Mac OS X has 'fat' binaries, but R does not use them 
for compiled code in packages - it used subdirectories just as on 
Windows.)

> Thanks,
> Erin
>
>
> Erin M. Hodgess, PhD
> Associate Professor
> Department of Computer and Mathematical Sciences
> University of Houston - Downtown
> mailto: hodgesse at uhd.edu
>
>
> ________________________________
>
> From: Duncan Murdoch [mailto:murdoch.duncan at gmail.com]
> Sent: Sun 10/17/2010 7:53 PM
> To: Bill.Venables at csiro.au
> Cc: Hodgess, Erin; r-devel at r-project.org
> Subject: Re: R 2.12.0 problems with Windows XP 32-bit binary installer
>
>
>
> Bill.Venables at csiro.au wrote:
>> I am having a problem with the installed R 2.12.0 on 32-bit Windows XP machine using the binary version.
>>
>> The installer I am using is R-2.12.0-win.exe .  The problem I have 
>> is that some of my installed packages will not load, in particular 
>> PolynomF, which has a pre-compiled .dll.  Other packages such as 
>> SOAR, which is pure R, attach and work without a hitch.
>>
>> The error message I am getting when trying to load PolynomF is a 
>> question whether or not the package has been compiled for the 
>> present architecture.  (This package works without a hitch on 
>> R-2.11.1, for example.)
>>
>> Is there any significance in the name of the installer now 
>> including just "win" rather than "win32", as it was in the last 
>> release?
>>
>> Is it the case that all packages will have to be re-built for the 
>> present release?
>
>
> Generally packages do need to be rebuilt for new versions of R (other
> than patch releases, where only the last digit changes).  R 2.12.0
> supports both 32 bit and 64 bit Windows in the same installation, and
> since Windows doesn't have MacOS-like "universal" binaries, that means
> binaries need to be put in the right place.  Generally that's an i386
> subdirectory for 32 bit, and an x64 directory for 64 bit.
>
> I don't know why a 32 bit DLL wouldn't work with 32 bit R 2.12.0, but if
> it was installed for 2.11.1, it might not be in the right place.
>
> Duncan Murdoch
>
>
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From pdalgd at gmail.com  Mon Oct 18 09:03:58 2010
From: pdalgd at gmail.com (Peter Dalgaard)
Date: Mon, 18 Oct 2010 09:03:58 +0200
Subject: [Rd] make error for R 2.13.0 (and 2.12.0)
In-Reply-To: <20101018003908.GA990@cs.toronto.edu>
References: <20101018003908.GA990@cs.toronto.edu>
Message-ID: <4CBBF15E.6040104@gmail.com>

On 10/18/2010 02:39 AM, Radford Neal wrote:
> Regarding Tengfei Yin's post about an error trying to install
> "cluster" in 2.13.0, I have gotten an error with this package when
> trying to install the released version of 2.12.0.  Here is the output
> on an Ubuntu Linux system:

Hmm, g77 along with a recent gcc? It is usually gfortran on current
linux systems. It's strange that it got past the configure step though.
What did the configure output look like? A look at "nm cluster.so" could
also be informative.

-pd

> begin installing recommended package cluster
> * installing *source* package 'cluster' ...
> ** libs
> make[3]: Entering directory `/tmp/RtmpWX7ecF/R.INSTALL2aaf76ad/cluster/src'
> gcc -std=gnu99 -I/u/radford/R/R-2.12.0-rel2/include  -I/usr/local/include    -fpic  -g -O2 -c clara.c -o clara.o
> g77   -fpic  -g -O2 -c daisy.f -o daisy.o
> g77   -fpic  -g -O2 -c dysta.f -o dysta.o
> gcc -std=gnu99 -I/u/radford/R/R-2.12.0-rel2/include  -I/usr/local/include    -fpic  -g -O2 -c fanny.c -o fanny.o
> gcc -std=gnu99 -I/u/radford/R/R-2.12.0-rel2/include  -I/usr/local/include    -fpic  -g -O2 -c init.c -o init.o
> g77   -fpic  -g -O2 -c meet.f -o meet.o
> g77   -fpic  -g -O2 -c mona.f -o mona.o
> gcc -std=gnu99 -I/u/radford/R/R-2.12.0-rel2/include  -I/usr/local/include    -fpic  -g -O2 -c pam.c -o pam.o
> gcc -std=gnu99 -I/u/radford/R/R-2.12.0-rel2/include  -I/usr/local/include    -fpic  -g -O2 -c sildist.c -o sildist.o
> gcc -std=gnu99 -I/u/radford/R/R-2.12.0-rel2/include  -I/usr/local/include    -fpic  -g -O2 -c spannel.c -o spannel.o
> g77   -fpic  -g -O2 -c twins.f -o twins.o
> gcc -std=gnu99 -shared -L/usr/local/lib -o cluster.so clara.o daisy.o dysta.o fanny.o init.o meet.o mona.o pam.o sildist.o spannel.o twins.o -L/usr/lib/gcc/i486-linux-gnu/3.4.6 -lg2c -lm
> make[3]: Leaving directory `/tmp/RtmpWX7ecF/R.INSTALL2aaf76ad/cluster/src'
> installing to /h/253/radford/R/R-2.12.0-rel2/library/cluster/libs
> ** R
> ** data
> **  moving datasets to lazyload DB
> ** inst
> ** preparing package for lazy loading
> ** help
> *** installing help indices
> ** building package indices ...
> ** testing if installed package can be loaded
> Error in dyn.load(file, DLLpath = DLLpath, ...) : 
>   unable to load shared object '/h/253/radford/R/R-2.12.0-rel2/library/cluster/libs/cluster.so':
>   /h/253/radford/R/R-2.12.0-rel2/library/cluster/libs/cluster.so: undefined symbol: cl_daisy_
> ERROR: loading failed
> * removing '/h/253/radford/R/R-2.12.0-rel2/library/cluster'
> make[2]: *** [cluster.ts] Error 1
> make[2]: Leaving directory `/h/253/radford/R/R-2.12.0-rel2/src/library/Recommended'
> make[1]: *** [recommended-packages] Error 2
> make[1]: Leaving directory `/h/253/radford/R/R-2.12.0-rel2/src/library/Recommended'
> make: *** [stamp-recommended] Error 2
> 
> Here is the output of gcc -v for this system:
> 
> Using built-in specs.
> Target: i486-linux-gnu
> Configured with: ../src/configure -v --enable-languages=c,c++,fortran,objc,obj-c++,treelang --prefix=/usr --enable-shared --with-system-zlib --libexecdir=/usr/lib --without-included-gettext --enable-threads=posix --enable-nls --with-gxx-include-dir=/usr/include/c++/4.2 --program-suffix=-4.2 --enable-clocale=gnu --enable-libstdcxx-debug --enable-objc-gc --enable-mpfr --enable-targets=all --enable-checking=release --build=i486-linux-gnu --host=i486-linux-gnu --target=i486-linux-gnu
> Thread model: posix
> gcc version 4.2.4 (Ubuntu 4.2.4-1ubuntu4)
> 
> This R-2.12.0 installation generally works (based on testing a few
> trivial things).  The same error occurs when trying to install 2.12.0
> on Intel Solaris.
> 
>    Radford Neal
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


-- 
Peter Dalgaard
Center for Statistics, Copenhagen Business School
Phone: (+45)38153501
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From stefan.theussl at wu.ac.at  Mon Oct 18 12:33:14 2010
From: stefan.theussl at wu.ac.at (Stefan Theussl)
Date: Mon, 18 Oct 2010 12:33:14 +0200
Subject: [Rd] r-forge down?
In-Reply-To: <4CB96205.7020201@ufl.edu>
References: <4CB96205.7020201@ufl.edu>
Message-ID: <4CBC226A.9090406@wu.ac.at>

On 10/16/2010 10:27 AM, Ben Bolker wrote:
>    anyone have a status report on r-forge ... ?
>
>    From here (Hamilton, ON) I can't ping ...
>
> PING r-forge.wu-wien.ac.at (137.208.57.38) 56(84) bytes of data.
>    
The machine was restarted today morning. We are sorry for the downtime.

We need to migrate R-Forge to a better equipped system in order to 
improve reliability. Back then in 2007 when we designed R-Forge we 
didn't expect so much interest like we observe now (>2600 users, almost 
900 projects). Thus the current system is quite undersized compared to 
its responsibilities.

Best,
st
>    cheers
>      Ben Bolker
>
>
>
>


From phgrosjean at sciviews.org  Mon Oct 18 13:07:03 2010
From: phgrosjean at sciviews.org (Philippe Grosjean)
Date: Mon, 18 Oct 2010 13:07:03 +0200
Subject: [Rd] r-forge down?
In-Reply-To: <4CBC226A.9090406@wu.ac.at>
References: <4CB96205.7020201@ufl.edu> <4CBC226A.9090406@wu.ac.at>
Message-ID: <4CBC2A57.9040102@sciviews.org>

Thanks anyway for all your work on R-Forge... We will probably survive 
this thread ;-)
Once you will got an hardware upgrade, I think we will all be happy to 
recover complete testing of developed packages (Linux 32/64bit, Mac 
32/64bit, Windows 32/64bit), ... if possible.
Best,

Philippe

..............................................<?}))><........
  ) ) ) ) )
( ( ( ( (    Prof. Philippe Grosjean
  ) ) ) ) )
( ( ( ( (    Numerical Ecology of Aquatic Systems
  ) ) ) ) )   Mons University, Belgium
( ( ( ( (
..............................................................

On 18/10/10 12:33, Stefan Theussl wrote:
> On 10/16/2010 10:27 AM, Ben Bolker wrote:
>> anyone have a status report on r-forge ... ?
>>
>> From here (Hamilton, ON) I can't ping ...
>>
>> PING r-forge.wu-wien.ac.at (137.208.57.38) 56(84) bytes of data.
> The machine was restarted today morning. We are sorry for the downtime.
>
> We need to migrate R-Forge to a better equipped system in order to
> improve reliability. Back then in 2007 when we designed R-Forge we
> didn't expect so much interest like we observe now (>2600 users, almost
> 900 projects). Thus the current system is quite undersized compared to
> its responsibilities.
>
> Best,
> st
>> cheers
>> Ben Bolker
>>
>>
>>
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From stefan.theussl at wu.ac.at  Mon Oct 18 13:12:36 2010
From: stefan.theussl at wu.ac.at (Stefan Theussl)
Date: Mon, 18 Oct 2010 13:12:36 +0200
Subject: [Rd] r-forge down?
In-Reply-To: <4CBC2A57.9040102@sciviews.org>
References: <4CB96205.7020201@ufl.edu> <4CBC226A.9090406@wu.ac.at>
	<4CBC2A57.9040102@sciviews.org>
Message-ID: <4CBC2BA4.8050002@wu.ac.at>

On 10/18/2010 01:07 PM, Philippe Grosjean wrote:
> Thanks anyway for all your work on R-Forge... We will probably survive 
> this thread ;-)
> Once you will got an hardware upgrade, I think we will all be happy to 
> recover complete testing of developed packages (Linux 32/64bit, Mac 
> 32/64bit, Windows 32/64bit), ... if possible.
Sure, on my todo list. Multi-arch binaries are long promised (for 
Windows) and we are close to releasing them.

Best,
Stefan
> Best,
>
> Philippe
>
> ..............................................<?}))><........
>  ) ) ) ) )
> ( ( ( ( (    Prof. Philippe Grosjean
>  ) ) ) ) )
> ( ( ( ( (    Numerical Ecology of Aquatic Systems
>  ) ) ) ) )   Mons University, Belgium
> ( ( ( ( (
> ..............................................................
>
> On 18/10/10 12:33, Stefan Theussl wrote:
>> On 10/16/2010 10:27 AM, Ben Bolker wrote:
>>> anyone have a status report on r-forge ... ?
>>>
>>> From here (Hamilton, ON) I can't ping ...
>>>
>>> PING r-forge.wu-wien.ac.at (137.208.57.38) 56(84) bytes of data.
>> The machine was restarted today morning. We are sorry for the downtime.
>>
>> We need to migrate R-Forge to a better equipped system in order to
>> improve reliability. Back then in 2007 when we designed R-Forge we
>> didn't expect so much interest like we observe now (>2600 users, almost
>> 900 projects). Thus the current system is quite undersized compared to
>> its responsibilities.
>>
>> Best,
>> st
>>> cheers
>>> Ben Bolker
>>>
>>>
>>>
>>>
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>


From wdunlap at tibco.com  Mon Oct 18 21:03:20 2010
From: wdunlap at tibco.com (William Dunlap)
Date: Mon, 18 Oct 2010 12:03:20 -0700
Subject: [Rd] wishlist: system.file(..., mustExist = TRUE)
Message-ID: <77EB52C6DD32BA4D87471DCD70C8D700038B2146@NA-PA-VBE03.na.tibco.com>

I find system.file() handy for writing examples,
but if the user mistypes its arguments or if a
package is not up to date its return value of ""
can lead to trouble.  This forces the example to
be wordier than I'd like.

E.g., the following example works
  > scan(what="", sep="\n", system.file("DESCRIPTION"))
  Read 9 items
  [1] "Package: base"
  [2] "Version: 2.12.0"
  [3] "Priority: base"
  [4] "Title: The R Base Package"
  [5] "Author: R Development Core Team and contributors worldwide"
  [6] "Maintainer: R Core Team <R-core at r-project.org>"
  [7] "Description: Base R functions"
  [8] "License: Part of R 2.12.0"
  [9] "Built: R 2.12.0; ; 2010-10-18 15:08:12 UTC; unix"
but if you misspell DESCRIPTION you get
  > scan(what="", sep="\n", system.file("DESCRITION"))
  1:
and the user has to know how to get out of that scan() prompt.

I can write the example as
  theFile <- system.file("DESCRIPTION")
  if (!identical(theFile, ""))
      scan(what="", sep="\n", theFile)
  else
      stop("Cannot find file \"DESCRIPTION\" in package \"base\"")
but that would be pretty ugly in a help file.

What do you think of adding an argument mustExist=FALSE or
mustFind=FALSE to system.file() such that if it is TRUE and
no file is found then system.file throws an error?  Then my
example could be
  scan(what="", sep="\n", system.file("DESCRIPTION", mustExist=TRUE)) 
and it would throw an informative error message instead of
returning "" if DESCRIPTION were misspelled.

base::parseNamespaceFile uses an argument called mustExist
for this sort of thing and several functions in package:methods
(elNamed, getGeneric, etc.) use mustFind.

Bill Dunlap
Spotfire, TIBCO Software
wdunlap tibco.com 


From gchappi at gmail.com  Mon Oct 18 22:01:21 2010
From: gchappi at gmail.com (Hans-Peter Suter)
Date: Mon, 18 Oct 2010 22:01:21 +0200
Subject: [Rd] Rcmd build 32bit-only package on win7 64 bit platform?
Message-ID: <AANLkTint3q7y0sQ0UKjJOGF1nG-OQ2qK0-4bmZriH_7O@mail.gmail.com>

Is it possible to suppress compiling for the x64 arch when doing 'Rcmd
build <mypkg>? Such that the pre-compiled package for binary
distribution only contains a 'lib/i386/mypkg.dll'.

For CHECK (and also INSTALL) there is a '--no-multiarch' argument, but
I didn't find something similar for build.

Otherwise, I suppose, I could
- handle the problem in Makevars or Makefile or
- build the shlib manually and put it at the correct place or
- provide a placeholder library with C (my code is Delphi, 64bit
should/will come next year)
- (build inside a XP32bit VM)

Are there any other packages which are 32bit only (for now)?

Thanks for any advise,
Hans-Peter


From djsamperi at gmail.com  Tue Oct 19 07:00:22 2010
From: djsamperi at gmail.com (Dominick Samperi)
Date: Tue, 19 Oct 2010 01:00:22 -0400
Subject: [Rd] Creating a Windows import lib from R.dll (x64)?
Message-ID: <AANLkTi=bYz+rmu=3J1BJ60xuP1Hcp9nCFMXVp9BuS7gf@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20101019/b307f6e0/attachment.pl>

From djsamperi at gmail.com  Tue Oct 19 07:44:56 2010
From: djsamperi at gmail.com (Dominick Samperi)
Date: Tue, 19 Oct 2010 01:44:56 -0400
Subject: [Rd] Creating a Windows import lib from R.dll (x64)?
In-Reply-To: <4CBD2B2D.10604@joeconway.com>
References: <AANLkTi=bYz+rmu=3J1BJ60xuP1Hcp9nCFMXVp9BuS7gf@mail.gmail.com>
	<4CBD2B2D.10604@joeconway.com>
Message-ID: <AANLkTimYdYjbyS8CMLZ6X_kha=s8Yszn0AdFftuV971V@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20101019/3181cec9/attachment.pl>

From ml-node+3001166-191286213-199696 at n4.nabble.com  Mon Oct 18 23:53:43 2010
From: ml-node+3001166-191286213-199696 at n4.nabble.com (Sharpie [via R])
Date: Mon, 18 Oct 2010 14:53:43 -0700 (PDT)
Subject: [Rd] Incorrect positioning of raster images on Windows
In-Reply-To: <AANLkTimP9qTbwWdmucoFmXVdUaUBkZsQmvMO-g7Gg=rQ@mail.gmail.com>
References: <1287375438100-2999649.post@n4.nabble.com>
	<AANLkTimP9qTbwWdmucoFmXVdUaUBkZsQmvMO-g7Gg=rQ@mail.gmail.com>
Message-ID: <1287438823258-3001166.post@n4.nabble.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20101018/03f32f68/attachment.pl>

From mail at joeconway.com  Tue Oct 19 07:22:53 2010
From: mail at joeconway.com (Joe Conway)
Date: Mon, 18 Oct 2010 22:22:53 -0700
Subject: [Rd] Creating a Windows import lib from R.dll (x64)?
In-Reply-To: <AANLkTi=bYz+rmu=3J1BJ60xuP1Hcp9nCFMXVp9BuS7gf@mail.gmail.com>
References: <AANLkTi=bYz+rmu=3J1BJ60xuP1Hcp9nCFMXVp9BuS7gf@mail.gmail.com>
Message-ID: <4CBD2B2D.10604@joeconway.com>

On 10/18/2010 10:00 PM, Dominick Samperi wrote:
> 
> The procedure for creating an import library (Rdll.lib) that is documented
> in gnuwin32/README.packages works fine using the i386 architecture, but
> it doesn't seem to work under x64.
> 
> Specifically, the procedure is:
> pexports R.dll > R.exp
> lib /def:R.exp /out:Rdll.lib /machine:X86 R.dll
> 
> There are two issues under x64:
> 1. Older version of pexports crash when applied to an x64 R.dll.
>     The work-around is to use one of the newer versions that have
>     been fixed (pexports-9.44, say).
> 2. When lib is applied to an x64 R.dll it complains as follows:
> R.dll : fatal error LNK1107: invalid or corrupt file: cannot read at 0x318
> 
> This happens even when the /def:R.exp parameter is left out, for
> example, with lib /out:Rdll.lib R.dll.
> 
> Any tips would be much appreciated.

I successfully did the following recently in order to build 64 bit PL/R
on Windows 7:

----------------
dumpbin /exports R.dll > R.dump.csv

Note that I used the csv extension so OpenOffice would import the file
into a spreadsheet conveniently.

Edit R.dump.csv to produce a one column file of symbols called R.def.
Add the following two lines to the top of the file:
 LIBRARY R
 EXPORTS

Then run the following using R.def

 lib /def:R.def /out:R.lib
----------------

HTH,

Joe


-- 
Joe Conway
credativ LLC: http://www.credativ.us
Linux, PostgreSQL, and general Open Source
Training, Service, Consulting, & 24x7 Support

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 899 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20101018/e04a59e7/attachment.bin>

From ligges at statistik.tu-dortmund.de  Tue Oct 19 14:45:43 2010
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Tue, 19 Oct 2010 14:45:43 +0200
Subject: [Rd] Rcmd build 32bit-only package on win7 64 bit platform?
In-Reply-To: <AANLkTint3q7y0sQ0UKjJOGF1nG-OQ2qK0-4bmZriH_7O@mail.gmail.com>
References: <AANLkTint3q7y0sQ0UKjJOGF1nG-OQ2qK0-4bmZriH_7O@mail.gmail.com>
Message-ID: <4CBD92F7.40904@statistik.tu-dortmund.de>



On 18.10.2010 22:01, Hans-Peter Suter wrote:
> Is it possible to suppress compiling for the x64 arch when doing 'Rcmd
> build<mypkg>?


R CMD build <mypkg> does not compile anything except for creating the 
vignettes. Is this the case?
If so: During the pre-release cycle of R-2.12.0 we have not got any 
report telling us this is a desirable feature.


> Such that the pre-compiled package for binary
> distribution only contains a 'lib/i386/mypkg.dll'.
>
> For CHECK (and also INSTALL) there is a '--no-multiarch' argument, but
> I didn't find something similar for build.


For now, you can use an only 32-bit installation of R in order to build. 
Passing down a flag such as --no-multiarch will be considered.


> Otherwise, I suppose, I could
> - handle the problem in Makevars or Makefile or
> - build the shlib manually and put it at the correct place or
> - provide a placeholder library with C (my code is Delphi, 64bit
> should/will come next year)
> - (build inside a XP32bit VM)
>
> Are there any other packages which are 32bit only (for now)?

Yes, http://cran.r-project.org/bin/windows/contrib/2.12/@ReadMe tells us:

Packages
     Cairo, RBrownie, RSvgDevice, RSVGTipsDevice, SNPassoc, coxphf, eco,
     gcmrec, magnets, proj4, ripa, sampfling, survrec, yaml
are only available for 32-bit installations.

Best,
Uwe Ligges

> Thanks for any advise,
> Hans-Peter
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From cubranic at stat.ubc.ca  Wed Oct 20 01:45:22 2010
From: cubranic at stat.ubc.ca (Davor Cubranic)
Date: Tue, 19 Oct 2010 16:45:22 -0700
Subject: [Rd] Missing libpthread in RTools
In-Reply-To: <4CB8E649.2070709@gmail.com>
References: <201010151353.45576.cubranic@stat.ubc.ca>
	<4CB8E649.2070709@gmail.com>
Message-ID: <BD259C4F-FAB8-4896-8172-0DE4E6991564@stat.ubc.ca>

On 2010-10-15, at 4:39 PM, Duncan Murdoch wrote:

> On 15/10/2010 4:53 PM, Davor Cubranic wrote:
>> It appears that Mingw gcc included in RTools is missing a dependent
>> library. If I compile a program with '-lgomp' switch (for OpenMP
>> support), I get a errors about undefined references to functions like
>> '_imp__pthread_mutex_destroy'. Adding the '-static' switch, I get the
>> following error:
>> 
>>     c:/rtools/mingw/bin/../lib/gcc/mingw32/4.5.0/../../../../mingw32/bin/ld.exe:
>> cannot find -lpthread
>> 
>> Sure enough, there is neither libpthread.a nor libpthread.dll under
>> RTools' installation directory. I think these library are standard in
>> Cygwin. Is there any chance to include them in RTools, too?
> 
> Rtools is for building R, and that library isn't needed in R.  If you want it for some particular purpose, can't you just install a copy on your machine?

Yes, I can. But does it make sense for the compiler to have support for OpenMP (i.e., allow -fopenmp), but not include its library dependency so that it fails in the linking phase?

Davor

From D.Strbenac at garvan.org.au  Wed Oct 20 05:33:11 2010
From: D.Strbenac at garvan.org.au (Dario Strbenac)
Date: Wed, 20 Oct 2010 13:33:11 +1000 (EST)
Subject: [Rd] Loading Cached Weaver Objects
Message-ID: <20101020133311.BJK44386@gimr.garvan.unsw.edu.au>

Hello,

I'm looking for a way to extract objects from what gets created when I Sweave with driver = weaver(). I found where the .Rdata objects are, but when I load one into R, I don't see anything that looks like the objects that were created in that code chunk.

> load("/home/darstr/r_env_cache/2.11.0/AbsMeth_5/ac047940aaa9cf1a1ec09f1628b13381.RData")
> ls()
[1] "cacheEnv" "DEPS"     "SESSION"

What can I try next ?

--------------------------------------
Dario Strbenac
Research Assistant
Cancer Epigenetics
Garvan Institute of Medical Research
Darlinghurst NSW 2010
Australia


From ripley at stats.ox.ac.uk  Wed Oct 20 05:52:23 2010
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 20 Oct 2010 04:52:23 +0100 (BST)
Subject: [Rd] Missing libpthread in RTools
In-Reply-To: <BD259C4F-FAB8-4896-8172-0DE4E6991564@stat.ubc.ca>
References: <201010151353.45576.cubranic@stat.ubc.ca>
	<4CB8E649.2070709@gmail.com>
	<BD259C4F-FAB8-4896-8172-0DE4E6991564@stat.ubc.ca>
Message-ID: <alpine.LFD.2.00.1010200447190.27447@gannet.stats.ox.ac.uk>

On Tue, 19 Oct 2010, Davor Cubranic wrote:

> On 2010-10-15, at 4:39 PM, Duncan Murdoch wrote:
>
>> On 15/10/2010 4:53 PM, Davor Cubranic wrote:
>>> It appears that Mingw gcc included in RTools is missing a dependent
>>> library. If I compile a program with '-lgomp' switch (for OpenMP
>>> support), I get a errors about undefined references to functions like
>>> '_imp__pthread_mutex_destroy'. Adding the '-static' switch, I get the
>>> following error:
>>>
>>>     c:/rtools/mingw/bin/../lib/gcc/mingw32/4.5.0/../../../../mingw32/bin/ld.exe:
>>> cannot find -lpthread
>>>
>>> Sure enough, there is neither libpthread.a nor libpthread.dll under
>>> RTools' installation directory. I think these library are standard in
>>> Cygwin. Is there any chance to include them in RTools, too?
>>
>> Rtools is for building R, and that library isn't needed in R.  If you want it for some particular purpose, can't you just install a copy on your machine?
>
> Yes, I can. But does it make sense for the compiler to have support 
> for OpenMP (i.e., allow -fopenmp), but not include its library 
> dependency so that it fails in the linking phase?

For the MinGW project, yes.  The 'Min' stands for 'minimal'.

Note that there are a lot of issues with gcc using pthreads for OMP on 
Windows, and the gcc developers are working on a different solution.

>
> Davor
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From mtmorgan at fhcrc.org  Wed Oct 20 07:14:14 2010
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Tue, 19 Oct 2010 22:14:14 -0700
Subject: [Rd] Loading Cached Weaver Objects
In-Reply-To: <20101020133311.BJK44386@gimr.garvan.unsw.edu.au>
References: <20101020133311.BJK44386@gimr.garvan.unsw.edu.au>
Message-ID: <4CBE7AA6.1010505@fhcrc.org>

On 10/19/2010 08:33 PM, Dario Strbenac wrote:
> Hello,
> 
> I'm looking for a way to extract objects from what gets created when I Sweave with driver = weaver(). I found where the .Rdata objects are, but when I load one into R, I don't see anything that looks like the objects that were created in that code chunk.
> 
>> load("/home/darstr/r_env_cache/2.11.0/AbsMeth_5/ac047940aaa9cf1a1ec09f1628b13381.RData")
>> ls()
> [1] "cacheEnv" "DEPS"     "SESSION"
> 
> What can I try next ?

Hi Dario

Probably useful to ask the maintainer
packageDescription('weaver')$Maintainer. But from looking at the package
code I see

eval_and_cache <- function(sexpr, deps, cacheEnv, cachefile, quiet) {
    if (!quiet)
      cat("  COMPUTING... ", file=stderr())
    log_debug("computing...")
    ## We want to pick up inherited stuff during the eval.  So no
    ## parent=emptyenv().
    eval(sexpr, envir=cacheEnv)
    DEPS <- deps
    SESSION <- sessionInfo()
    save(cacheEnv, DEPS, SESSION, file=cachefile)
    if (!quiet)
      cat("done.\n", file=stderr())
}


load_from_cache_env <- function(fromEnv, toEnv, hash, sym2hash, updated) {
    ## The 'updated' arg is a logical flag.  TRUE indicates that
    ## syms in fromEnv were retrieved from cache but had to be
    ## recomputed because of a dependency mismatch.  This is allows
    ## us to detect second order dependency mismatch where the
    ## expression doesn't change, but we've recomputed.
    syms <- ls(fromEnv)
    for (sym in syms) {
        assign(sym, fromEnv[[sym]], envir=toEnv)
        assign(sym, list(hash=hash, updated=updated), envir=sym2hash)
    }
}

so would guess that 'cacheEnv' is a environment that contains the result
of evaluating the code in the chunk.

Hope that helps,

Martin

> 
> --------------------------------------
> Dario Strbenac
> Research Assistant
> Cancer Epigenetics
> Garvan Institute of Medical Research
> Darlinghurst NSW 2010
> Australia
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


-- 
Computational Biology
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N. PO Box 19024 Seattle, WA 98109

Location: M1-B861
Telephone: 206 667-2793


From D.Strbenac at garvan.org.au  Wed Oct 20 08:00:15 2010
From: D.Strbenac at garvan.org.au (Dario Strbenac)
Date: Wed, 20 Oct 2010 16:00:15 +1000 (EST)
Subject: [Rd] Loading Cached Weaver Objects
In-Reply-To: <4CBE7AA6.1010505@fhcrc.org>
References: <20101020133311.BJK44386@gimr.garvan.unsw.edu.au>
	<4CBE7AA6.1010505@fhcrc.org>
Message-ID: <20101020160015.BJK48730@gimr.garvan.unsw.edu.au>

Thanks. I was able to get them out via 

cacheEnv[["varName"]]

- Dario.

---- Original message ----
>Date: Tue, 19 Oct 2010 22:14:14 -0700
>From: Martin Morgan <mtmorgan at fhcrc.org>  
>Subject: Re: [Rd] Loading Cached Weaver Objects  
>To: D.Strbenac at garvan.org.au
>Cc: r-devel at r-project.org, seth at userprimary.net
>
>On 10/19/2010 08:33 PM, Dario Strbenac wrote:
>> Hello,
>> 
>> I'm looking for a way to extract objects from what gets created when I Sweave with driver = weaver(). I found where the .Rdata objects are, but when I load one into R, I don't see anything that looks like the objects that were created in that code chunk.
>> 
>>> load("/home/darstr/r_env_cache/2.11.0/AbsMeth_5/ac047940aaa9cf1a1ec09f1628b13381.RData")
>>> ls()
>> [1] "cacheEnv" "DEPS"     "SESSION"
>> 
>> What can I try next ?
>
>Hi Dario
>
>Probably useful to ask the maintainer
>packageDescription('weaver')$Maintainer. But from looking at the package
>code I see
>
>eval_and_cache <- function(sexpr, deps, cacheEnv, cachefile, quiet) {
>    if (!quiet)
>      cat("  COMPUTING... ", file=stderr())
>    log_debug("computing...")
>    ## We want to pick up inherited stuff during the eval.  So no
>    ## parent=emptyenv().
>    eval(sexpr, envir=cacheEnv)
>    DEPS <- deps
>    SESSION <- sessionInfo()
>    save(cacheEnv, DEPS, SESSION, file=cachefile)
>    if (!quiet)
>      cat("done.\n", file=stderr())
>}
>
>
>load_from_cache_env <- function(fromEnv, toEnv, hash, sym2hash, updated) {
>    ## The 'updated' arg is a logical flag.  TRUE indicates that
>    ## syms in fromEnv were retrieved from cache but had to be
>    ## recomputed because of a dependency mismatch.  This is allows
>    ## us to detect second order dependency mismatch where the
>    ## expression doesn't change, but we've recomputed.
>    syms <- ls(fromEnv)
>    for (sym in syms) {
>        assign(sym, fromEnv[[sym]], envir=toEnv)
>        assign(sym, list(hash=hash, updated=updated), envir=sym2hash)
>    }
>}
>
>so would guess that 'cacheEnv' is a environment that contains the result
>of evaluating the code in the chunk.
>
>Hope that helps,
>
>Martin
>
>> 
>> --------------------------------------
>> Dario Strbenac
>> Research Assistant
>> Cancer Epigenetics
>> Garvan Institute of Medical Research
>> Darlinghurst NSW 2010
>> Australia
>> 
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>
>-- 
>Computational Biology
>Fred Hutchinson Cancer Research Center
>1100 Fairview Ave. N. PO Box 19024 Seattle, WA 98109
>
>Location: M1-B861
>Telephone: 206 667-2793


From spinuvit.list at gmail.com  Wed Oct 20 12:17:06 2010
From: spinuvit.list at gmail.com (Vitaly S.)
Date: Wed, 20 Oct 2010 12:17:06 +0200
Subject: [Rd] new.env does not recognize parents from subclasses of
	"environment"
Message-ID: <cpnwrpdgod9.fsf@gmail.com>


Dear Developers,

A lot has been changed in the R12.0 with respect to behavior of "environment"
subclasses.  Many thanks for that.

One small irregularity, though; new.env does not allow the parent to be from S4
subclass.


> setClass("myenv", contains="environment")
[1] "myenv"
> new.env(parent=new("myenv"))
Error in new.env(parent = new("myenv")) : 'enclos' must be an environment

I wonder if this is a "planed" behavior.

The use of .xData  slot obviously works:
> new.env(parent=new("myenv")@.xData)
<environment: 063bb9e8>
>

Thanks,
Vitaly.


From jmc4 at stanford.edu  Wed Oct 20 19:21:24 2010
From: jmc4 at stanford.edu (John Chambers)
Date: Wed, 20 Oct 2010 10:21:24 -0700
Subject: [Rd] new.env does not recognize parents from subclasses
	of	"environment"
In-Reply-To: <cpnwrpdgod9.fsf@gmail.com>
References: <cpnwrpdgod9.fsf@gmail.com>
Message-ID: <4CBF2514.8050409@stanford.edu>

  Thanks for the report.  Should now be fixed in r-devel and 2.12 
patched (rev 53383).

Please do report any cases where a subclass of environment doesn't 
work.  There are some known cases in locking and active binding, that 
will be fixed in due course.

The workaround for any such problem is usually as.environment().

On 10/20/10 3:17 AM, Vitaly S. wrote:
> Dear Developers,
>
> A lot has been changed in the R12.0 with respect to behavior of "environment"
> subclasses.  Many thanks for that.
>
> One small irregularity, though; new.env does not allow the parent to be from S4
> subclass.
>
>
>> setClass("myenv", contains="environment")
> [1] "myenv"
>> new.env(parent=new("myenv"))
> Error in new.env(parent = new("myenv")) : 'enclos' must be an environment
>
> I wonder if this is a "planed" behavior.
>
> The use of .xData  slot obviously works:
>> new.env(parent=new("myenv")@.xData)
> <environment: 063bb9e8>
> Thanks,
> Vitaly.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From djsamperi at gmail.com  Thu Oct 21 00:49:30 2010
From: djsamperi at gmail.com (Dominick Samperi)
Date: Wed, 20 Oct 2010 18:49:30 -0400
Subject: [Rd] library verbose option doesn't stop "Loading required package
	XYZ"
Message-ID: <AANLkTimCoFJibeienRkQ5aXUoc-2DGqH2Biov3Cu6_Lt@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20101020/3a67a5e8/attachment.pl>

From dwinsemius at comcast.net  Thu Oct 21 01:00:23 2010
From: dwinsemius at comcast.net (David Winsemius)
Date: Wed, 20 Oct 2010 19:00:23 -0400
Subject: [Rd] library verbose option doesn't stop "Loading required
	package XYZ"
In-Reply-To: <AANLkTimCoFJibeienRkQ5aXUoc-2DGqH2Biov3Cu6_Lt@mail.gmail.com>
References: <AANLkTimCoFJibeienRkQ5aXUoc-2DGqH2Biov3Cu6_Lt@mail.gmail.com>
Message-ID: <94DF5568-CBE9-4049-BC82-1396AF88D8F3@comcast.net>


On Oct 20, 2010, at 6:49 PM, Dominick Samperi wrote:

> Hello,
>
> The library verbose option does not stop numerous messages
> of the form "Loading required package: XYZ". This is inconvenient
> when a package is loaded repeatedly using Rscript.
>
> Is there a way to turn off the "Loading required package"
> messages?

?invisible
 > invisible(require(Hmisc))
 > invisible(library(rms)  )  # no console messages

I do not think this suppress the messages when you attempt to load a  
non-existent package. For that you may need to look at the options()  
setting for warn and warning.expression
>
> One possible work-around is to make packages Suggested
> instead of Required, but this introduces other issues.
>
> Thanks,
> Dominick
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

David Winsemius, MD
West Hartford, CT


From djsamperi at gmail.com  Thu Oct 21 01:25:48 2010
From: djsamperi at gmail.com (Dominick Samperi)
Date: Wed, 20 Oct 2010 19:25:48 -0400
Subject: [Rd] library verbose option doesn't stop "Loading required
 package XYZ"
In-Reply-To: <94DF5568-CBE9-4049-BC82-1396AF88D8F3@comcast.net>
References: <AANLkTimCoFJibeienRkQ5aXUoc-2DGqH2Biov3Cu6_Lt@mail.gmail.com>
	<94DF5568-CBE9-4049-BC82-1396AF88D8F3@comcast.net>
Message-ID: <AANLkTikpctkCnj50x2XbaZCNxqhCjUqPLqgXaFEhVgct@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20101020/a3fa973b/attachment.pl>

From mtmorgan at fhcrc.org  Thu Oct 21 01:29:09 2010
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Wed, 20 Oct 2010 16:29:09 -0700
Subject: [Rd] library verbose option doesn't stop "Loading required
 package XYZ"
In-Reply-To: <AANLkTikpctkCnj50x2XbaZCNxqhCjUqPLqgXaFEhVgct@mail.gmail.com>
References: <AANLkTimCoFJibeienRkQ5aXUoc-2DGqH2Biov3Cu6_Lt@mail.gmail.com>	<94DF5568-CBE9-4049-BC82-1396AF88D8F3@comcast.net>
	<AANLkTikpctkCnj50x2XbaZCNxqhCjUqPLqgXaFEhVgct@mail.gmail.com>
Message-ID: <4CBF7B45.5080509@fhcrc.org>

On 10/20/2010 04:25 PM, Dominick Samperi wrote:
> Thanks David, but this doesn't work. Under R 2.12.0 the "Loading required
> packages"
> messages appear under R 2.12.0 when I use, for example:
> 
> Rscript --vanilla -e "{ invisible(library(cxxPack)); cat(sqrt(2)) }"

?suppressPackageStartupMessages

though you'll still get warnings / errors.

Martin

> 
> On Wed, Oct 20, 2010 at 7:00 PM, David Winsemius <dwinsemius at comcast.net>wrote:
> 
>>
>> On Oct 20, 2010, at 6:49 PM, Dominick Samperi wrote:
>>
>>  Hello,
>>>
>>> The library verbose option does not stop numerous messages
>>> of the form "Loading required package: XYZ". This is inconvenient
>>> when a package is loaded repeatedly using Rscript.
>>>
>>> Is there a way to turn off the "Loading required package"
>>> messages?
>>>
>>
>> ?invisible
>>> invisible(require(Hmisc))
>>> invisible(library(rms)  )  # no console messages
>>
>> I do not think this suppress the messages when you attempt to load a
>> non-existent package. For that you may need to look at the options() setting
>> for warn and warning.expression
>>
>>>
>>> One possible work-around is to make packages Suggested
>>> instead of Required, but this introduces other issues.
>>>
>>> Thanks,
>>> Dominick
>>>
>>>        [[alternative HTML version deleted]]
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>
>> David Winsemius, MD
>> West Hartford, CT
>>
>>
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


-- 
Computational Biology
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N. PO Box 19024 Seattle, WA 98109

Location: M1-B861
Telephone: 206 667-2793


From shane.conway at gmail.com  Thu Oct 21 16:33:35 2010
From: shane.conway at gmail.com (Shane Conway)
Date: Thu, 21 Oct 2010 10:33:35 -0400
Subject: [Rd] Scripting SVG with R
In-Reply-To: <AANLkTinLPOG0W5XXjr60iKw4xWrRxRW-P21i5qkOtBac@mail.gmail.com>
References: <4CB5D0A8.5040901@embl.de>
	<AANLkTinLPOG0W5XXjr60iKw4xWrRxRW-P21i5qkOtBac@mail.gmail.com>
Message-ID: <AANLkTinogrxfTLHghk8NFVDBxKzSQTrNX5c_6xRE2=BJ@mail.gmail.com>

This is slightly tangential, but I would just add some notes related
to things that I had worked on (in various stages of completion).
This relates more to parsing SVG and Javascript from within R, rather
than R from within Javascript:

1) I wrapped most of the Protovis primitives in an R package called
webvis (http://cran.r-project.org/web/packages/webvis/).  If you're
not familiar, Protovis is an excellent low-level plotting package in
Javascript (http://vis.stanford.edu/protovis/) out of Jeffrey Heer's
lab at Stanford (http://vis.stanford.edu/).  Protovis produces SVG
graphics as the output.  As a first pass, I decided to just use the
web browser to parse the javascript.  You can see how this works by
calling demo("playfairs.wheat") or looking at the plot.webvis help
examples.

2) My goal was to have the next version of webvis parse the javascript
directly in R.  To that end, I started working on another package that
would wrap the javax.script.* library using rJava.  This works for me,
and it allows you to pass code in any scripting language that runs on
the JVM (including Jython, Jaskell, Clojure, and Javascript).  The
problem is that you need more than javascript parsing in order to use
something like Protovis: you need the complete web browser context.
You can get this by using env-js (http://www.envjs.com/).  But that
leads to another problem: the version of the javascript parser (called
Rhino) in javax.script wasn't the latest, so I would need to use Rhino
directly (you can see part of my discussion that here:
http://stackoverflow.com/questions/2664578/using-javax-script-or-rhino-to-run-javascript-in-java-with-browser-context-e-g).
 That's where I stopped.

What would the end result of webvis be so far as it pertains to your
problem?  With a small amount of effort, it would be pretty straight
forward to create interactive graphics that are pure javascript from
R.  I had envisioned that this would be more useful for an interactive
R session, but I know of one project (RNode) that's currently using it
from a browser through Rserve (see
http://squirelove.net/r-node/doku.php).

Hope that this is useful.

Regards,
Shane


On Fri, Oct 15, 2010 at 11:06 AM, Gabriel Becker <gmbecker at ucdavis.edu> wrote:
>
> Wolfgang,
>
> I am currently working on this very thing under Duncan Temple Lang. Or, to
> be more precise what you are describing is one piece of our overarching
> goal, which is to create a system in which R can be run from within a
> browser (currently FireFox) with bi-directional communication occurring
> between the javascript/svg/flash engines and R. This will allow us to, for
> example, build web pages which can contain both R code (which can be
> executed in-browser) and "live"graphics devices in the form of
> javascript/svg/flash canvases, as per your query. It will also, eg, allow
> for the building of rich, easily customizable GUIs for R through the
> (relatively painless though not easy to do well) process of designing
> interactive/multimedia web pages.
>
> Duncan has done quite a bit of work of this nature in the past, even going
> so far as embedding R in the Netscape browser some 10 years ago
> (SNetscape<http://www.omegahat.org/SNetscape/>note this is quite
> outdated now). More recently, last summer he created a
> package (RFirefox, not currently available, see below) which embeds R within
> Firefox (3.5) but currently only allows for communication from javascript
> down into R (so R code can be evaluated and the results passed back up to
> the javascript engine), before handing the project off to me to work on
> under his supervision. Currently the installation/configuration is _very_
> fragile/nonexistent, and as I said, only one direction of communication is
> possible. ?We are currently working on implementing communication with
> javascript (and eventually flash, though this is not a priority)
> objects/methods from within R. This will allow us to draw to draw directly
> to javascript canvases from within an R process, among many other useful
> (and not so useful) capabilities.
>
> We hope to have a usable alpha/proof-of-concept release with bi-directional
> communication between XUL/javascript and R and a mildly-robust installation
> procedure sometime within the next few weeks (3-6), with a paper, live
> examples, and a more complete/robust package to follow.
>
> Glad to see there is some interest :)
>
> Sincerely,
> Gabe Becker
>
> On Wed, Oct 13, 2010 at 8:30 AM, Wolfgang Huber <whuber at embl.de> wrote:
>
> >
> > Since now many browsers support (ECMA/Java-)scripted SVG, I am wondering
> > whether there are already any examples of inserting R code into SVG
> > documents (or a Javascript canvas?) either directly, or perhaps more likely
> > through a JavaScript layer, to dynamically generate graphics or make them
> > interactive?
> >
> > I am aware of the excellent packages gridSVG and SVGAnnotation, which
> > facilitate making R-generated SVG plots more interesting either at
> > construction time or by postprocessing; the above question is about
> > employing R at viewing time.
> >
> > Best wishes
> >
> > Wolfgang Huber
> > EMBL
> > http://www.embl.de/research/units/genome_biology/huber
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >
>
> ? ? ? ?[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From spinuvit.list at gmail.com  Thu Oct 21 17:58:56 2010
From: spinuvit.list at gmail.com (Vitally S.)
Date: Thu, 21 Oct 2010 17:58:56 +0200
Subject: [Rd] new.env does not recognize parents from subclasses
	of	"environment"
In-Reply-To: <4CBF2514.8050409@stanford.edu> (John Chambers's message of "Wed, 
	20 Oct 2010 10:21:24 -0700")
References: <cpnwrpdgod9.fsf@gmail.com> <4CBF2514.8050409@stanford.edu>
Message-ID: <cpn1v7j35bz.fsf@gmail.com>



Here is an infinite recursion error  which occurs only with S4
subclasses assignment.

 setClass("myenv", contains = "environment")
#[1] "myenv"
 env <- new("myenv")
 env[[".me"]] <- env at .xData
#Error: evaluation nested too deeply: infinite recursion / options(expressions=)?
 

With basic types it works as expected:

env1 <- new.env()
env1[[".me"]] <- env1

May be this is related to active bindings that you mentioned,  but I am still
reporting it here.

Vitally.


>  Thanks for the report.  Should now be fixed in r-devel and 2.12 patched (rev 53383).
>
> Please do report any cases where a subclass of environment doesn't work.  There are some known cases in locking and
> active binding, that will be fixed in due course.
>
> The workaround for any such problem is usually as.environment().
>
> On 10/20/10 3:17 AM, Vitaly S. wrote:
>> Dear Developers,
>>
>> A lot has been changed in the R12.0 with respect to behavior of "environment"
>> subclasses.  Many thanks for that.
>>
>> One small irregularity, though; new.env does not allow the parent to be from S4
>> subclass.
>>
>>
>>> setClass("myenv", contains="environment")
>> [1] "myenv"
>>> new.env(parent=new("myenv"))
>> Error in new.env(parent = new("myenv")) : 'enclos' must be an environment
>>
>> I wonder if this is a "planed" behavior.
>>
>> The use of .xData  slot obviously works:
>>> new.env(parent=new("myenv")@.xData)
>> <environment: 063bb9e8>
>> Thanks,
>> Vitaly.
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel>


From spinuvit.list at gmail.com  Thu Oct 21 18:00:01 2010
From: spinuvit.list at gmail.com (Vitally S.)
Date: Thu, 21 Oct 2010 18:00:01 +0200
Subject: [Rd] new.env does not recognize parents from subclasses
	of	"environment"
In-Reply-To: <4CBF2514.8050409@stanford.edu> (John Chambers's message of "Wed, 
	20 Oct 2010 10:21:24 -0700")
References: <cpnwrpdgod9.fsf@gmail.com> <4CBF2514.8050409@stanford.edu>
Message-ID: <cpnzku71qpq.fsf@gmail.com>



Here is an infinite recursion error  which occurs only with S4
subclasses assignment.

 setClass("myenv", contains = "environment")
#[1] "myenv"
 env <- new("myenv")
 env[[".me"]] <- env at .xData
#Error: evaluation nested too deeply: infinite recursion / options(expressions=)?
 

With basic types it works as expected:

env1 <- new.env()
env1[[".me"]] <- env1

May be this is related to active bindings that you mentioned,  but I am still
reporting it here.

Vitally.


>  Thanks for the report.  Should now be fixed in r-devel and 2.12 patched (rev 53383).
>
> Please do report any cases where a subclass of environment doesn't work.  There are some known cases in locking and
> active binding, that will be fixed in due course.
>
> The workaround for any such problem is usually as.environment().
>
> On 10/20/10 3:17 AM, Vitaly S. wrote:
>> Dear Developers,
>>
>> A lot has been changed in the R12.0 with respect to behavior of "environment"
>> subclasses.  Many thanks for that.
>>
>> One small irregularity, though; new.env does not allow the parent to be from S4
>> subclass.
>>
>>
>>> setClass("myenv", contains="environment")
>> [1] "myenv"
>>> new.env(parent=new("myenv"))
>> Error in new.env(parent = new("myenv")) : 'enclos' must be an environment
>>
>> I wonder if this is a "planed" behavior.
>>
>> The use of .xData  slot obviously works:
>>> new.env(parent=new("myenv")@.xData)
>> <environment: 063bb9e8>
>> Thanks,
>> Vitaly.
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel>


From wdunlap at tibco.com  Thu Oct 21 18:21:41 2010
From: wdunlap at tibco.com (William Dunlap)
Date: Thu, 21 Oct 2010 09:21:41 -0700
Subject: [Rd] new.env does not recognize parents from
	subclassesof	"environment"
In-Reply-To: <cpnzku71qpq.fsf@gmail.com>
References: <cpnwrpdgod9.fsf@gmail.com> <4CBF2514.8050409@stanford.edu>
	<cpnzku71qpq.fsf@gmail.com>
Message-ID: <77EB52C6DD32BA4D87471DCD70C8D7000393EF21@NA-PA-VBE03.na.tibco.com>

The traceback looks very similar to a problem
in R 2.11.1 reported earlier this month by Troy Robertson.
  > From: r-devel-bounces at r-project.org 
  > [mailto:r-devel-bounces at r-project.org] On Behalf Of Troy Robertson
  > Sent: Wednesday, October 06, 2010 6:13 PM
  > To: 'r-devel at R-project.org'
  > Subject: Re: [Rd] Recursion error after upgrade to 
  > R_2.11.1[Sec=Unclassified]
It was due to a miscount of how many frames to go
up before evaluating an expression in
getMethod("[[<-",".environment") because setMethod()
introduced a local function in the new method.

Bill Dunlap
Spotfire, TIBCO Software
wdunlap tibco.com  

> -----Original Message-----
> From: r-devel-bounces at r-project.org 
> [mailto:r-devel-bounces at r-project.org] On Behalf Of Vitally S.
> Sent: Thursday, October 21, 2010 9:00 AM
> To: John Chambers
> Cc: r-devel at r-project.org
> Subject: Re: [Rd] new.env does not recognize parents from 
> subclassesof "environment"
> 
> 
> 
> Here is an infinite recursion error  which occurs only with S4
> subclasses assignment.
> 
>  setClass("myenv", contains = "environment")
> #[1] "myenv"
>  env <- new("myenv")
>  env[[".me"]] <- env at .xData
> #Error: evaluation nested too deeply: infinite recursion / 
> options(expressions=)?
>  
> 
> With basic types it works as expected:
> 
> env1 <- new.env()
> env1[[".me"]] <- env1
> 
> May be this is related to active bindings that you mentioned, 
>  but I am still
> reporting it here.
> 
> Vitally.
> 
> 
> >  Thanks for the report.  Should now be fixed in r-devel and 
> 2.12 patched (rev 53383).
> >
> > Please do report any cases where a subclass of environment 
> doesn't work.  There are some known cases in locking and
> > active binding, that will be fixed in due course.
> >
> > The workaround for any such problem is usually as.environment().
> >
> > On 10/20/10 3:17 AM, Vitaly S. wrote:
> >> Dear Developers,
> >>
> >> A lot has been changed in the R12.0 with respect to 
> behavior of "environment"
> >> subclasses.  Many thanks for that.
> >>
> >> One small irregularity, though; new.env does not allow the 
> parent to be from S4
> >> subclass.
> >>
> >>
> >>> setClass("myenv", contains="environment")
> >> [1] "myenv"
> >>> new.env(parent=new("myenv"))
> >> Error in new.env(parent = new("myenv")) : 'enclos' must be 
> an environment
> >>
> >> I wonder if this is a "planed" behavior.
> >>
> >> The use of .xData  slot obviously works:
> >>> new.env(parent=new("myenv")@.xData)
> >> <environment: 063bb9e8>
> >> Thanks,
> >> Vitaly.
> >>
> >> ______________________________________________
> >> R-devel at r-project.org mailing list
> >> https://stat.ethz.ch/mailman/listinfo/r-devel>
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 


From rhurlin at gwdg.de  Thu Oct 21 18:42:18 2010
From: rhurlin at gwdg.de (Rainer Hurling)
Date: Thu, 21 Oct 2010 18:42:18 +0200
Subject: [Rd] [R] R-2.12.0 hangs while loading RGtk2 on FreeBSD
In-Reply-To: <alpine.LFD.2.00.1010211704340.7969@toucan.stats.ox.ac.uk>
References: <4CC03E47.2010800@gwdg.de>
	<alpine.LFD.2.00.1010211508350.5999@toucan.stats.ox.ac.uk>
	<4CC052D6.3030106@gwdg.de>
	<alpine.LFD.2.00.1010211704340.7969@toucan.stats.ox.ac.uk>
Message-ID: <4CC06D6A.8040609@gwdg.de>

[moved from R-help]

On 21.10.2010 18:09 (UTC+1), Prof Brian Ripley wrote:
> If you do R CMD INSTALL --no-test-load this will skip the part that is
> hanging and you can try loading in stages (e.g. dyn.load on the RGtk2.so).

With '--no-test-load' it installs and ends normal. Loading per 
dyn.load("RGtk2.so") works, just as dyn.load("RGtk2.so",F) and 
dyn.load("RGtk2.so",,F). Unloading works, too.

Normal loading over library(RGtk2) within R does not work. R than is 
hanging.

It seems the problem is not with the library itself?

> I think this is rather technical for R-help, so maybe move to R-devel?

I moved to R-devel.

> And can you check the RGtk2 version? A recent but not current version
> (2.12.17?) did hang initializing Gtk+ on some platforms and Michael
> Lawrence had to be involved.

I am using RGtk2_2.12.18.tar.gz for month now.

> On Thu, 21 Oct 2010, Rainer Hurling wrote:
>
>> Am 21.10.2010 16:12 (UTC+1) schrieb Prof Brian Ripley:
>>> On Thu, 21 Oct 2010, Rainer Hurling wrote:
>>>
>>>> I am working with R-2.12.0 on FreeBSD 9.0-CURRENT for a while now. I
>>>> successfully installed more than 300 packages (most as dependencies of
>>>> others).
>>>>
>>>> There are two packages I am not able to install: RGtk2 and rggobi.
>>>>
>>>> For example rggobi builds fine and after that it wants to load:
>>>>
>>>> ------------------------------------------------------
>>>> # R CMD INSTALL rggobi_2.1.16.tar.gz
>>>> [..SNIP..]
>>>> gcc -std=gnu99 -shared -L/usr/local/lib -o rggobi.so RSEval.o brush.o
>>>> colorSchemes.o conversion.o data.o dataset.o display.o displays.o
>>>> edges.o ggobi.o identify.o init.o io.o keyHandlers.o longitudinal.o
>>>> modes.o plot.o plots.o plugins.o print.o session.o smooth.o ui.o
>>>> utils.o -pthread -L/usr/local/lib -lggobi -lgtk-x11-2.0 -lxml2
>>>> -lgdk-x11-2.0 -latk-1.0 -lgdk_pixbuf-2.0 -lpangocairo-1.0 -lXext
>>>> -lXrender -lXinerama -lXi -lXrandr -lXcursor -lXcomposite -lXdamage
>>>> -lpangoft2-1.0 -lgio-2.0 -lXfixes -lcairo -lX11 -lpango-1.0 -lm
>>>> -lfreetype -lfontconfig -lgobject-2.0 -lgmodule-2.0 -lgthread-2.0
>>>> -lglib-2.0
>>>> installiert nach /usr/local/lib/R/library/rggobi/libs
>>>> ** R
>>>> ** data
>>>> ** moving datasets to lazyload DB
>>>> ** demo
>>>> ** preparing package for lazy loading
>>>> ------------------------------------------------------
>>>>
>>>> At this point the install process is hanging, R utilises no more CPU
>>>> time. Same with package RGtk2.
>>>>
>>>> Is this a known error? Please let me know if I can give more
>>>> information or try something different.
>>>
>>> Well, those are exactly the two packages using Gtk+.
>>>
>>> There is no known general problem, and as you could have checked from
>>> the CRAN check pages, those packages install without problems on several
>>> platforms. (Not Solaris, where ggobi does not install and RGtk2 requires
>>> gcc, and not x64 Windows where both need to be patched.)
>>>
>>> So it does look very like there is a problem with loading against the
>>> Gtk+ system libraries on your system.
>>
>> I think you are right. With previous versions of R (until R-2.10.x) I
>> did not have this hanging when loading RGtk2 ... And I am pretty sure
>> that I have no problems with gtk2 outside of R on my FreeBSD system.
>>
>> In the meantime I found out that the reported loading error of rggobi
>> is a loading error of RGtk2, which fails (hangs). So there remains
>> only a loading error with RGtk2. (Because of that I changed the subject.)
>>
>> After building/installing RGtk2, there are the following messages:
>>
>> ------------------------------------------------------
>> [..SNIP..]
>> gcc -std=gnu99 -shared -L/usr/local/lib -o RGtk2.so RGtkDataFrame.o
>> Rgtk.o atkAccessors.o atkClasses.o atkConversion.o atkFuncs.o
>> atkManuals.o atkUserFuncs.o cairo-enums.o cairoAccessors.o
>> cairoConversion.o cairoFuncs.o cairoManuals.o cairoUserFuncs.o
>> classes.o conversion.o eventLoop.o gdkAccessors.o gdkClasses.o
>> gdkConversion.o gdkFuncs.o gdkManuals.o gdkUserFuncs.o glib.o
>> gobject.o gtkAccessors.o gtkClasses.o gtkConversion.o gtkFuncs.o
>> gtkManuals.o gtkUserFuncs.o libgladeAccessors.o libgladeFuncs.o
>> libgladeManuals.o libgladeUserFuncs.o pangoAccessors.o pangoClasses.o
>> pangoConversion.o pangoFuncs.o pangoManuals.o pangoUserFuncs.o utils.o
>> zcompat.o -pthread -L/usr/local/lib -lglade-2.0 -lgtk-x11-2.0 -lxml2
>> -lgdk-x11-2.0 -latk-1.0 -lgdk_pixbuf-2.0 -lpangocairo-1.0 -lXext
>> -lXrender -lXinerama -lXi -lXrandr -lXcursor -lXcomposite -lXdamage
>> -lpangoft2-1.0 -lgio-2.0 -lXfixes -lcairo -lX11 -lpango-1.0 -lm
>> -lfreetype -lfontconfig -lgobject-2.0 -lgmodule-2.0 -lgthread-2.0
>> -lglib-2.0 -pthread -L/usr/local/lib -lgthread-2.0 -lglib-2.0
>> installiert nach /usr/local/lib/R/library/RGtk2/libs
>> ** R
>> ** demo
>> ** inst
>> ** preparing package for lazy loading
>> ** help
>> *** installing help indices
>> ** building package indices ...
>> ** testing if installed package can be loaded [..hanging from here..]
>> ------------------------------------------------------
>>
>> Is there a chance to find out what is wrong with loading RGtk2 on my
>> system? Unfortunately I have almost no experience with real debugging
>> methods on R. But of course I am willing to help and try out ...


From jmc4 at stanford.edu  Thu Oct 21 19:26:20 2010
From: jmc4 at stanford.edu (John Chambers)
Date: Thu, 21 Oct 2010 10:26:20 -0700
Subject: [Rd] new.env does not recognize parents from
	subclassesof	"environment"
In-Reply-To: <77EB52C6DD32BA4D87471DCD70C8D7000393EF21@NA-PA-VBE03.na.tibco.com>
References: <cpnwrpdgod9.fsf@gmail.com> <4CBF2514.8050409@stanford.edu>
	<cpnzku71qpq.fsf@gmail.com>
	<77EB52C6DD32BA4D87471DCD70C8D7000393EF21@NA-PA-VBE03.na.tibco.com>
Message-ID: <4CC077BC.5050209@stanford.edu>

  This is a problem related to the introduction of exact= into the [[ 
and [[<- functions. As Bill says, the current method misuses 
eval.parent() when that argument is added.

However, a simpler and more efficient solution is to migrate the checks 
for subclasses of "environment" used in other base code into the code 
for [[<- (and for $<-), at which point the methods for these functions 
are no longer needed.

A solution on these lines is being tested now and will find its way into 
r-devel and 2.12 patched.

One other point about the original posting:

Please don't use constructions like env at .xData. This depends on the 
current implementation and is not part of the user-level definition. Use 
as(env, "environment") or equivalent. (In this case, the assignment of 
the object's own environment was irrelevant to the error.)

John Chambers

On 10/21/10 9:21 AM, William Dunlap wrote:
> The traceback looks very similar to a problem
> in R 2.11.1 reported earlier this month by Troy Robertson.
>    >  From: r-devel-bounces at r-project.org
>    >  [mailto:r-devel-bounces at r-project.org] On Behalf Of Troy Robertson
>    >  Sent: Wednesday, October 06, 2010 6:13 PM
>    >  To: 'r-devel at R-project.org'
>    >  Subject: Re: [Rd] Recursion error after upgrade to
>    >  R_2.11.1[Sec=Unclassified]
> It was due to a miscount of how many frames to go
> up before evaluating an expression in
> getMethod("[[<-",".environment") because setMethod()
> introduced a local function in the new method.
>
> Bill Dunlap
> Spotfire, TIBCO Software
> wdunlap tibco.com
>
>> -----Original Message-----
>> From: r-devel-bounces at r-project.org
>> [mailto:r-devel-bounces at r-project.org] On Behalf Of Vitally S.
>> Sent: Thursday, October 21, 2010 9:00 AM
>> To: John Chambers
>> Cc: r-devel at r-project.org
>> Subject: Re: [Rd] new.env does not recognize parents from
>> subclassesof "environment"
>>
>>
>>
>> Here is an infinite recursion error  which occurs only with S4
>> subclasses assignment.
>>
>>   setClass("myenv", contains = "environment")
>> #[1] "myenv"
>>   env<- new("myenv")
>>   env[[".me"]]<- ?
>> #Error: evaluation nested too deeply: infinite recursion /
>> options(expressions=)?
>>
>>
>> With basic types it works as expected:
>>
>> env1<- new.env()
>> env1[[".me"]]<- env1
>>
>> May be this is related to active bindings that you mentioned,
>>   but I am still
>> reporting it here.
>>
>> Vitally.
>>
>>
>>>   Thanks for the report.  Should now be fixed in r-devel and
>> 2.12 patched (rev 53383).
>>> Please do report any cases where a subclass of environment
>> doesn't work.  There are some known cases in locking and
>>> active binding, that will be fixed in due course.
>>>
>>> The workaround for any such problem is usually as.environment().
>>>
>>> On 10/20/10 3:17 AM, Vitaly S. wrote:
>>>> Dear Developers,
>>>>
>>>> A lot has been changed in the R12.0 with respect to
>> behavior of "environment"
>>>> subclasses.  Many thanks for that.
>>>>
>>>> One small irregularity, though; new.env does not allow the
>> parent to be from S4
>>>> subclass.
>>>>
>>>>
>>>>> setClass("myenv", contains="environment")
>>>> [1] "myenv"
>>>>> new.env(parent=new("myenv"))
>>>> Error in new.env(parent = new("myenv")) : 'enclos' must be
>> an environment
>>>> I wonder if this is a "planed" behavior.
>>>>
>>>> The use of .xData  slot obviously works:
>>>>> new.env(parent=new("myenv")@.xData)
>>>> <environment: 063bb9e8>
>>>> Thanks,
>>>> Vitaly.
>>>>
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>


From hpages at fhcrc.org  Fri Oct 22 08:02:05 2010
From: hpages at fhcrc.org (=?ISO-8859-1?Q?Herv=E9_Pag=E8s?=)
Date: Thu, 21 Oct 2010 23:02:05 -0700
Subject: [Rd] cannot connect to an FTP server with long HELLO message
Message-ID: <4CC128DD.8030703@fhcrc.org>

Hi,

Trying to access files on the ftp server at ftp.ncbi.nih.gov
will either give a time out or sometimes even a segfault on Linux.
The 2 following methods give the same results:

   f <- 
url("ftp://ftp.ncbi.nih.gov/pub/geo/DATA/SOFT/GDS/GDS10.soft.gz", open="r")

 
download.file("ftp://ftp.ncbi.nih.gov/pub/geo/DATA/SOFT/GDS/GDS10.soft.gz", 
destfile=tempfile())

I've tried one or the other method with all release versions >= 2.8
and with current R devel and they always fail to connect to this
FTP server.

What's particular about this FTP server is that it sends a long HELLO
message before it finally sends the 220 control code.
Using the Unix ftp client:

-----------------------------------------------------------------------------
hpages at latitude:~$ ftp ftp.ncbi.nih.gov
Connected to ftp.ncbi.nih.gov.
220-
  Warning Notice!

  This is a U.S. Government computer system, which may be accessed and used
  only for authorized Government business by authorized personnel.
  Unauthorized access or use of this computer system may subject 
violators to
  criminal, civil, and/or administrative action.

  All information on this computer system may be intercepted, recorded, 
read,
  copied, and disclosed by and to authorized personnel for official 
purposes,
  including criminal investigations. Such information includes sensitive 
data
  encrypted to comply with confidentiality and privacy requirements. Access
  or use of this computer system by any person, whether authorized or
  unauthorized, constitutes consent to these terms. There is no right of
  privacy in this system.
  ---
  Welcome to the NCBI ftp server! The official anonymous access URL is 
ftp://ftp.ncbi.nih.gov

  Public data may be downloaded by logging in as "anonymous" using your 
E-mail address as a password.

  Please see ftp://ftp.ncbi.nih.gov/README.ftp for hints on large file 
transfers
220 FTP Server ready.
-----------------------------------------------------------------------------

This seems to cause problems to the nanoftp module
(src/modules/internet/nanoftp.c) used by url() and download.file()
as it doesn't seem to be able to catch the 220 control code.

I'm not familiar with the nanoftp module, or with socket programming in
general, or with RFC 959 (FTP protocal), so I'm not really in a position
to say what's going wrong exactly in the module but it seems that
increasing the value of FTP_BUF_SIZE (size of the buffer for data
received from the control connection) fixes the problem.
Currently this is:

#define FTP_BUF_SIZE            1024

but, interestingly, *any* value > 1024 seems to fix the problem (even
though the long HELLO message above is 1091 bytes).

Any idea what's going on?

Thanks,
H.

-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M2-B876
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fhcrc.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From nick.sabbe at ugent.be  Fri Oct 22 11:30:42 2010
From: nick.sabbe at ugent.be (Nick Sabbe)
Date: Fri, 22 Oct 2010 11:30:42 +0200
Subject: [Rd] Linking to lapack
Message-ID: <017f01cb71cb$cc475dc0$64d61940$@sabbe@ugent.be>

Hello all.

I'm developing a package for R holding a Gibbs sampler, which tends to have
better performance when written in C than in R.
During each iteration in the Gibbs sampler, I need the inverse of a
symmetric matrix.
For this, I wish to use lapack, as is concisely suggested in "Writing R
extensions", since this will have better performance than I could ever write
myself.

After some twiddling I have got my code to compile by including
"R_ext/Lapack.h" and using "F77_CALL(dpotrf)", but unfortunately, I don't
get this to link properly.
I get this message: " testc.o:testc.c:(.text+0x255): undefined reference to
`dpotrf_'" which seems logical to me as far as my understanding of C
reaches, but I don't know how to resolve it. I'm quite sure I need some
extra parameters in my makefile, but as I come from a world where all these
complexities are happily abstracted away for me by an IDE, I have no actual
clue on how to surmount this.

However: when I'm done with all my code, I wish to build a package for
publication on CRAN, so I want to be sure that not only I can build it on my
system, but it will also work well when distributed to other computers (if I
understand the package process well, source files are compiled and linked
during installation of the package), so I would also like to know how to do
this.

It should not be relevant, but either way: I'm doing all this on a Windows 7
machine, though the package will probably be used on Linux-based servers
eventually.

Finally: I have found no comprehensive list of the functions available to an
R package developer, nor, strangely, questions about that. Does such a thing
exist, or are we up to hoping we find what we are looking for in the header
files? If it does not exist already, I would surely be willing to work on
it.

Thanks for any input.

Nick Sabbe
--
ping: nick.sabbe at ugent.be
link: http://biomath.ugent.be
wink: A1.056, Coupure Links 653, 9000 Gent
ring: 09/264.59.36

-- Do Not Disapprove


From bates at stat.wisc.edu  Fri Oct 22 14:56:03 2010
From: bates at stat.wisc.edu (Douglas Bates)
Date: Fri, 22 Oct 2010 07:56:03 -0500
Subject: [Rd] Linking to lapack
In-Reply-To: <4534492540076965307@unknownmsgid>
References: <4534492540076965307@unknownmsgid>
Message-ID: <AANLkTikkPH6TFUNkOL6vUpvMd-B=Xo8Mv+WwY+C8L_Wt@mail.gmail.com>

On Fri, Oct 22, 2010 at 4:30 AM, Nick Sabbe <nick.sabbe at ugent.be> wrote:
> Hello all.

> I'm developing a package for R holding a Gibbs sampler, which tends to have
> better performance when written in C than in R.
> During each iteration in the Gibbs sampler, I need the inverse of a
> symmetric matrix.

You may want to check that.  The first rule of numerical linear
algebra is that you hardly ever need to invert a matrix.  If you need
to solve a linear system, you use a factorization, as below and then
use one of the solvers based on that factorization.  If the matrix is
small calculating the inverse is not a big problem.  If it is large
and you do so within each iteration of your sampler then you are
probably wasting time.

> For this, I wish to use lapack, as is concisely suggested in "Writing R
> extensions", since this will have better performance than I could ever write
> myself.
>
> After some twiddling I have got my code to compile by including
> "R_ext/Lapack.h" and using "F77_CALL(dpotrf)", but unfortunately, I don't
> get this to link properly.
> I get this message: " testc.o:testc.c:(.text+0x255): undefined reference to
> `dpotrf_'" which seems logical to me as far as my understanding of C
> reaches, but I don't know how to resolve it. I'm quite sure I need some
> extra parameters in my makefile, but as I come from a world where all these
> complexities are happily abstracted away for me by an IDE, I have no actual
> clue on how to surmount this.

Go back to section 1.2.1 of "Writing R Extensions" that deals with
"Using Makevars".

> However: when I'm done with all my code, I wish to build a package for
> publication on CRAN, so I want to be sure that not only I can build it on my
> system, but it will also work well when distributed to other computers (if I
> understand the package process well, source files are compiled and linked
> during installation of the package), so I would also like to know how to do
> this.
>
> It should not be relevant, but either way: I'm doing all this on a Windows 7
> machine, though the package will probably be used on Linux-based servers
> eventually.
>
> Finally: I have found no comprehensive list of the functions available to an
> R package developer, nor, strangely, questions about that. Does such a thing
> exist, or are we up to hoping we find what we are looking for in the header
> files? If it does not exist already, I would surely be willing to work on
> it.

Do you mean other than the section on "The R API" in the "Writing R
Extensions" manual?
> Thanks for any input.
>
> Nick Sabbe
> --
> ping: nick.sabbe at ugent.be
> link: http://biomath.ugent.be
> wink: A1.056, Coupure Links 653, 9000 Gent
> ring: 09/264.59.36
>
> -- Do Not Disapprove
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From lawrence.michael at gene.com  Fri Oct 22 14:57:24 2010
From: lawrence.michael at gene.com (Michael Lawrence)
Date: Fri, 22 Oct 2010 05:57:24 -0700
Subject: [Rd] [R] R-2.12.0 hangs while loading RGtk2 on FreeBSD
In-Reply-To: <4CC06D6A.8040609@gwdg.de>
References: <4CC03E47.2010800@gwdg.de>
	<alpine.LFD.2.00.1010211508350.5999@toucan.stats.ox.ac.uk>
	<4CC052D6.3030106@gwdg.de>
	<alpine.LFD.2.00.1010211704340.7969@toucan.stats.ox.ac.uk>
	<4CC06D6A.8040609@gwdg.de>
Message-ID: <AANLkTimAmo0ro2Tiw_rWAJ732R+ATRgNdS0SvuO6hYq+@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20101022/42b31545/attachment.pl>

From shotwelm at musc.edu  Fri Oct 22 15:13:15 2010
From: shotwelm at musc.edu (Matt Shotwell)
Date: Fri, 22 Oct 2010 09:13:15 -0400
Subject: [Rd] Linking to lapack
In-Reply-To: <017f01cb71cb$cc475dc0$64d61940$@sabbe@ugent.be>
References: <017f01cb71cb$cc475dc0$64d61940$@sabbe@ugent.be>
Message-ID: <1287753195.1636.58.camel@matt-laptop>

On Fri, 2010-10-22 at 05:30 -0400, Nick Sabbe wrote:
> Hello all.
> 
> I'm developing a package for R holding a Gibbs sampler, which tends to have
> better performance when written in C than in R.
> During each iteration in the Gibbs sampler, I need the inverse of a
> symmetric matrix.
> For this, I wish to use lapack, as is concisely suggested in "Writing R
> extensions", since this will have better performance than I could ever write
> myself.
> 
> After some twiddling I have got my code to compile by including
> "R_ext/Lapack.h" and using "F77_CALL(dpotrf)", but unfortunately, I don't
> get this to link properly.
> I get this message: " testc.o:testc.c:(.text+0x255): undefined reference to
> `dpotrf_'" which seems logical to me as far as my understanding of C
> reaches, but I don't know how to resolve it. I'm quite sure I need some
> extra parameters in my makefile, but as I come from a world where all these
> complexities are happily abstracted away for me by an IDE, I have no actual
> clue on how to surmount this.

Yes. You need to ensure that your program is linked with a Lapack
library where the symbol dpotrf_ is defined. In an R package, using a
'Makevars' file in your 'src' directory is used to specify additional
linking. See "Writing R Extensions" section 1.2.1 Using ?Makevars?. If
you are compiling your code with a custom Makefile, then you will need
to add an argument to the linker/compiler specifying a Lapack library to
be linked. For example, here is a command that dynamically links the R
Lapack and Blas libraries to a pre-compiled 'test.o' on my system:

gcc -std=gnu99 -shared -L/usr/local/lib -o test.so test.o
-L/usr/local/lib/R/lib -lRlapack -L/usr/local/lib/R/lib -lRblas
-lgfortran -lm

> However: when I'm done with all my code, I wish to build a package for
> publication on CRAN, so I want to be sure that not only I can build it on my
> system, but it will also work well when distributed to other computers (if I
> understand the package process well, source files are compiled and linked
> during installation of the package), so I would also like to know how to do
> this.

It might be a good idea to build your package simultaneously with your
code, and use a Makevars file.

> It should not be relevant, but either way: I'm doing all this on a Windows 7
> machine, though the package will probably be used on Linux-based servers
> eventually.
> 
> Finally: I have found no comprehensive list of the functions available to an
> R package developer, nor, strangely, questions about that. Does such a thing
> exist, or are we up to hoping we find what we are looking for in the header
> files? If it does not exist already, I would surely be willing to work on
> it.

Three of the R manuals (R-exts, R-ints, R-admin;
http://cran.r-project.org/doc/manuals/) partially describe some aspect
of the R API, where "Writing R Extensions" is the most comprehensive.
Function descriptions are generally not biolerplate. For good or bad, a
look into the C headers is often necessary to use an R API function.

-Matt

> Thanks for any input.
> 
> Nick Sabbe
> --
> ping: nick.sabbe at ugent.be
> link: http://biomath.ugent.be
> wink: A1.056, Coupure Links 653, 9000 Gent
> ring: 09/264.59.36
> 
> -- Do Not Disapprove
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Matthew S. Shotwell
Graduate Student 
Division of Biostatistics and Epidemiology
Medical University of South Carolina


From rhurlin at gwdg.de  Fri Oct 22 16:18:51 2010
From: rhurlin at gwdg.de (Rainer Hurling)
Date: Fri, 22 Oct 2010 16:18:51 +0200
Subject: [Rd] [R] R-2.12.0 hangs while loading RGtk2 on FreeBSD
In-Reply-To: <AANLkTimAmo0ro2Tiw_rWAJ732R+ATRgNdS0SvuO6hYq+@mail.gmail.com>
References: <4CC03E47.2010800@gwdg.de>	<alpine.LFD.2.00.1010211508350.5999@toucan.stats.ox.ac.uk>	<4CC052D6.3030106@gwdg.de>	<alpine.LFD.2.00.1010211704340.7969@toucan.stats.ox.ac.uk>	<4CC06D6A.8040609@gwdg.de>
	<AANLkTimAmo0ro2Tiw_rWAJ732R+ATRgNdS0SvuO6hYq+@mail.gmail.com>
Message-ID: <4CC19D4B.6070605@gwdg.de>

On 22.10.2010 14:57 (UTC+1), Michael Lawrence wrote:
>
>
> On Thu, Oct 21, 2010 at 9:42 AM, Rainer Hurling <rhurlin at gwdg.de
> <mailto:rhurlin at gwdg.de>> wrote:
>
>     [moved from R-help]
>
>     On 21.10.2010 18:09 (UTC+1), Prof Brian Ripley wrote:
>
>         If you do R CMD INSTALL --no-test-load this will skip the part
>         that is
>         hanging and you can try loading in stages (e.g. dyn.load on the
>         RGtk2.so).
>
>
>     With '--no-test-load' it installs and ends normal. Loading per
>     dyn.load("RGtk2.so") works, just as dyn.load("RGtk2.so",F) and
>     dyn.load("RGtk2.so",,F). Unloading works, too.
>
>     Normal loading over library(RGtk2) within R does not work. R than is
>     hanging.
>
>     It seems the problem is not with the library itself?
>
>
> It looks like something is happening when initializing GTK+ and the
> event loop. This happens in the function R_gtkInit in Rgtk.c. If you
> could run R -d gdb and break on that function, perhaps you could step
> through until it hangs.

Michael, thank you for answering. As I wrote earlier (on R-help@), 
unfortunately I have no experience with debugging (I am not a 
programmer). So I would need some more assistence.

Is  there a difference between 'library(RGtk2)' and 'dyn.load(RGtk2)' in 
initializing GTK+? I am able to dyn.load, but library does not work.

After starting with 'R -d gdb' is the following right?

   (gdb) break R_gtkInit
   Function "R_gtkInit" not defined.
   Make breakpoint pending on future shared library load? (y or [n]) y
   Breakpoint 1 (R_gtkInit) pending.

When I try to proceed, it gives me the following message

   (gdb) run
   Starting program: /usr/local/lib/R/bin/exec/R
   /libexec/ld-elf.so.1: Shared object "libRblas.so" not found,
   required by "R"
   Program exited with code 01.

Obviously there is some wrong with my try?

Thanks again,
Rainer


> Thanks,
> Michael
>
>         I think this is rather technical for R-help, so maybe move to
>         R-devel?
>
>
>     I moved to R-devel.
>
>         And can you check the RGtk2 version? A recent but not current
>         version
>         (2.12.17?) did hang initializing Gtk+ on some platforms and Michael
>         Lawrence had to be involved.
>
>
>     I am using RGtk2_2.12.18.tar.gz for month now.
>
>
>         On Thu, 21 Oct 2010, Rainer Hurling wrote:
>
>             Am 21.10.2010 16:12 (UTC+1) schrieb Prof Brian Ripley:
>
>                 On Thu, 21 Oct 2010, Rainer Hurling wrote:
>
>                     I am working with R-2.12.0 on FreeBSD 9.0-CURRENT
>                     for a while now. I
>                     successfully installed more than 300 packages (most
>                     as dependencies of
>                     others).
>
>                     There are two packages I am not able to install:
>                     RGtk2 and rggobi.
>
>                     For example rggobi builds fine and after that it
>                     wants to load:
>
>                     ------------------------------------------------------
>                     # R CMD INSTALL rggobi_2.1.16.tar.gz
>                     [..SNIP..]
>                     gcc -std=gnu99 -shared -L/usr/local/lib -o rggobi.so
>                     RSEval.o brush.o
>                     colorSchemes.o conversion.o data.o dataset.o
>                     display.o displays.o
>                     edges.o ggobi.o identify.o init.o io.o keyHandlers.o
>                     longitudinal.o
>                     modes.o plot.o plots.o plugins.o print.o session.o
>                     smooth.o ui.o
>                     utils.o -pthread -L/usr/local/lib -lggobi
>                     -lgtk-x11-2.0 -lxml2
>                     -lgdk-x11-2.0 -latk-1.0 -lgdk_pixbuf-2.0
>                     -lpangocairo-1.0 -lXext
>                     -lXrender -lXinerama -lXi -lXrandr -lXcursor
>                     -lXcomposite -lXdamage
>                     -lpangoft2-1.0 -lgio-2.0 -lXfixes -lcairo -lX11
>                     -lpango-1.0 -lm
>                     -lfreetype -lfontconfig -lgobject-2.0 -lgmodule-2.0
>                     -lgthread-2.0
>                     -lglib-2.0
>                     installiert nach /usr/local/lib/R/library/rggobi/libs
>                     ** R
>                     ** data
>                     ** moving datasets to lazyload DB
>                     ** demo
>                     ** preparing package for lazy loading
>                     ------------------------------------------------------
>
>                     At this point the install process is hanging, R
>                     utilises no more CPU
>                     time. Same with package RGtk2.
>
>                     Is this a known error? Please let me know if I can
>                     give more
>                     information or try something different.
>
>
>                 Well, those are exactly the two packages using Gtk+.
>
>                 There is no known general problem, and as you could have
>                 checked from
>                 the CRAN check pages, those packages install without
>                 problems on several
>                 platforms. (Not Solaris, where ggobi does not install
>                 and RGtk2 requires
>                 gcc, and not x64 Windows where both need to be patched.)
>
>                 So it does look very like there is a problem with
>                 loading against the
>                 Gtk+ system libraries on your system.
>
>
>             I think you are right. With previous versions of R (until
>             R-2.10.x) I
>             did not have this hanging when loading RGtk2 ... And I am
>             pretty sure
>             that I have no problems with gtk2 outside of R on my FreeBSD
>             system.
>
>             In the meantime I found out that the reported loading error
>             of rggobi
>             is a loading error of RGtk2, which fails (hangs). So there
>             remains
>             only a loading error with RGtk2. (Because of that I changed
>             the subject.)
>
>             After building/installing RGtk2, there are the following
>             messages:
>
>             ------------------------------------------------------
>             [..SNIP..]
>             gcc -std=gnu99 -shared -L/usr/local/lib -o RGtk2.so
>             RGtkDataFrame.o
>             Rgtk.o atkAccessors.o atkClasses.o atkConversion.o atkFuncs.o
>             atkManuals.o atkUserFuncs.o cairo-enums.o cairoAccessors.o
>             cairoConversion.o cairoFuncs.o cairoManuals.o cairoUserFuncs.o
>             classes.o conversion.o eventLoop.o gdkAccessors.o gdkClasses.o
>             gdkConversion.o gdkFuncs.o gdkManuals.o gdkUserFuncs.o glib.o
>             gobject.o gtkAccessors.o gtkClasses.o gtkConversion.o gtkFuncs.o
>             gtkManuals.o gtkUserFuncs.o libgladeAccessors.o libgladeFuncs.o
>             libgladeManuals.o libgladeUserFuncs.o pangoAccessors.o
>             pangoClasses.o
>             pangoConversion.o pangoFuncs.o pangoManuals.o
>             pangoUserFuncs.o utils.o
>             zcompat.o -pthread -L/usr/local/lib -lglade-2.0
>             -lgtk-x11-2.0 -lxml2
>             -lgdk-x11-2.0 -latk-1.0 -lgdk_pixbuf-2.0 -lpangocairo-1.0 -lXext
>             -lXrender -lXinerama -lXi -lXrandr -lXcursor -lXcomposite
>             -lXdamage
>             -lpangoft2-1.0 -lgio-2.0 -lXfixes -lcairo -lX11 -lpango-1.0 -lm
>             -lfreetype -lfontconfig -lgobject-2.0 -lgmodule-2.0
>             -lgthread-2.0
>             -lglib-2.0 -pthread -L/usr/local/lib -lgthread-2.0 -lglib-2.0
>             installiert nach /usr/local/lib/R/library/RGtk2/libs
>             ** R
>             ** demo
>             ** inst
>             ** preparing package for lazy loading
>             ** help
>             *** installing help indices
>             ** building package indices ...
>             ** testing if installed package can be loaded [..hanging
>             from here..]
>             ------------------------------------------------------
>
>             Is there a chance to find out what is wrong with loading
>             RGtk2 on my
>             system? Unfortunately I have almost no experience with real
>             debugging
>             methods on R. But of course I am willing to help and try out ...


From jon.clayden at gmail.com  Fri Oct 22 16:21:03 2010
From: jon.clayden at gmail.com (Jon Clayden)
Date: Fri, 22 Oct 2010 15:21:03 +0100
Subject: [Rd] Reference classes
Message-ID: <AANLkTik+o=SgwXO5augahHC18Hv9hBL87VOyGVG8LqN_@mail.gmail.com>

Dear all,

First, many thanks to John Chambers, and anyone else who was involved,
for the new support for "reference classes" in R 2.12.0. It's nice to
see this kind of functionality appear in a relatively R-like form, and
with the blessing of the core team. In some contexts it is undoubtedly
appealing to associate a set of methods with a class directly, rather
than defining a load of generics which are only ever likely to be
implemented for a single class, or some other such arrangement. (I was
actually in the process of writing a package which did something
similar to the reference class idea, although it is less fully
realised.)

My initial experiences with this functionality have been very
positive. I've stumbled over one minor issue so far: default values of
method parameters are not displayed by the help() method, viz.

> library(methods)
> Regex <- setRefClass("Regex", fields="string", methods=list(
+     isMatch = function (text, ignoreCase = FALSE)
+     {
+         'Returns a logical vector of the same length as "text",
indicating whether or not each element is a match to the regular
expression.'
+         grepl(string, text, ignore.case=ignoreCase, perl=TRUE)
+     }
+ ))
> Regex$help("isMatch")
Call: $isMatch(text, ignoreCase = )

Returns a logical vector of the same length as "text", indicating
whether or not each element is a match to the regular expression.

It seems unlikely that this is intentional, but correct me if I'm
wrong. It still seems to happen with the latest R-patched (Mac OS X
10.5.8).

As a suggestion, it would be nice if the accessors() method could be
used to create just "getters" or just "setters" for particular fields,
although I realise this can be worked around by removing the unwanted
methods afterwards.

More generally, I was wondering how firm the commitment is to
providing this kind of programming mechanism. I know it's likely to
change in some ways in future releases, but can I use it in packages,
trusting that only a few tweaks will be needed for compatibility with
future versions of R, or is it possible that the whole infrastructure
will be removed in future?

All the best,
Jon


From hb at stat.berkeley.edu  Fri Oct 22 19:00:56 2010
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Fri, 22 Oct 2010 10:00:56 -0700
Subject: [Rd] CRAN: Windows builds/pages outdated?
Message-ID: <AANLkTikMy_CevJkbtZ4Us8fBDsPOzPUCrQfQYTO_WtXF@mail.gmail.com>

FYI, in case you are not aware of it,

both

http://cran.r-project.org/bin/windows/base/rpatched.html
http://cran.r-project.org/bin/windows/base/rdevel.html

link to old builds ("2010-10-14 r53300").

/Henrik


From spinuvit.list at gmail.com  Fri Oct 22 19:20:39 2010
From: spinuvit.list at gmail.com (Vitally S.)
Date: Fri, 22 Oct 2010 19:20:39 +0200
Subject: [Rd] new.env does not recognize parents from
	subclassesof	"environment"
In-Reply-To: <4CC077BC.5050209@stanford.edu> (John Chambers's message of "Thu, 
	21 Oct 2010 10:26:20 -0700")
References: <cpnwrpdgod9.fsf@gmail.com> <4CBF2514.8050409@stanford.edu>
	<cpnzku71qpq.fsf@gmail.com>
	<77EB52C6DD32BA4D87471DCD70C8D7000393EF21@NA-PA-VBE03.na.tibco.com>
	<4CC077BC.5050209@stanford.edu>
Message-ID: <cpnvd4u16vs.fsf@gmail.com>


Yet another inconsistency. environment<- does not work with S4:


> setClass("myenv", contains = "environment")
[1] "myenv"
> env <- new("myenv")
> tf <- function(x){x}
> environment(tf) <- env
Error in environment(tf) <- env : 
  replacement object is not an environment


Vitally.


John Chambers <jmc4 at stanford.edu> writes:
>  This is a problem related to the introduction of exact= into the [[ and [[<- functions. As Bill says, the current
> method misuses eval.parent() when that argument is added.
>
> However, a simpler and more efficient solution is to migrate the checks for subclasses of "environment" used in
> other base code into the code for [[<- (and for $<-), at which point the methods for these functions are no longer
> needed.
>
> A solution on these lines is being tested now and will find its way into r-devel and 2.12 patched.
>
> One other point about the original posting:
>
> Please don't use constructions like env at .xData. This depends on the current implementation and is not part of the
> user-level definition. Use as(env, "environment") or equivalent. (In this case, the assignment of the object's own
> environment was irrelevant to the error.)
>
> John Chambers
>
> On 10/21/10 9:21 AM, William Dunlap wrote:
>> The traceback looks very similar to a problem
>> in R 2.11.1 reported earlier this month by Troy Robertson.
>>    >  From: r-devel-bounces at r-project.org
>>    >  [mailto:r-devel-bounces at r-project.org] On Behalf Of Troy Robertson
>>    >  Sent: Wednesday, October 06, 2010 6:13 PM
>>    >  To: 'r-devel at R-project.org'
>>    >  Subject: Re: [Rd] Recursion error after upgrade to
>>    >  R_2.11.1[Sec=Unclassified]
>> It was due to a miscount of how many frames to go
>> up before evaluating an expression in
>> getMethod("[[<-",".environment") because setMethod()
>> introduced a local function in the new method.
>>
>> Bill Dunlap
>> Spotfire, TIBCO Software
>> wdunlap tibco.com
>>
>>> -----Original Message-----
>>> From: r-devel-bounces at r-project.org
>>> [mailto:r-devel-bounces at r-project.org] On Behalf Of Vitally S.
>>> Sent: Thursday, October 21, 2010 9:00 AM
>>> To: John Chambers
>>> Cc: r-devel at r-project.org
>>> Subject: Re: [Rd] new.env does not recognize parents from
>>> subclassesof "environment"
>>>
>>>
>>>
>>> Here is an infinite recursion error  which occurs only with S4
>>> subclasses assignment.
>>>
>>>   setClass("myenv", contains = "environment")
>>> #[1] "myenv"
>>>   env<- new("myenv")
>>>   env[[".me"]]<- ?
>>> #Error: evaluation nested too deeply: infinite recursion /
>>> options(expressions=)?
>>>
>>>
>>> With basic types it works as expected:
>>>
>>> env1<- new.env()
>>> env1[[".me"]]<- env1
>>>
>>> May be this is related to active bindings that you mentioned,
>>>   but I am still
>>> reporting it here.
>>>
>>> Vitally.
>>>
>>>
>>>>   Thanks for the report.  Should now be fixed in r-devel and
>>> 2.12 patched (rev 53383).
>>>> Please do report any cases where a subclass of environment
>>> doesn't work.  There are some known cases in locking and
>>>> active binding, that will be fixed in due course.
>>>>
>>>> The workaround for any such problem is usually as.environment().
>>>>
>>>> On 10/20/10 3:17 AM, Vitaly S. wrote:
>>>>> Dear Developers,
>>>>>
>>>>> A lot has been changed in the R12.0 with respect to
>>> behavior of "environment"
>>>>> subclasses.  Many thanks for that.
>>>>>
>>>>> One small irregularity, though; new.env does not allow the
>>> parent to be from S4
>>>>> subclass.
>>>>>
>>>>>
>>>>>> setClass("myenv", contains="environment")
>>>>> [1] "myenv"
>>>>>> new.env(parent=new("myenv"))
>>>>> Error in new.env(parent = new("myenv")) : 'enclos' must be
>>> an environment
>>>>> I wonder if this is a "planed" behavior.
>>>>>
>>>>> The use of .xData  slot obviously works:
>>>>>> new.env(parent=new("myenv")@.xData)
>>>>> <environment: 063bb9e8>
>>>>> Thanks,
>>>>> Vitaly.
>>>>>
>>>>> ______________________________________________
>>>>> R-devel at r-project.org mailing list
>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From jmc at r-project.org  Fri Oct 22 19:55:10 2010
From: jmc at r-project.org (John Chambers)
Date: Fri, 22 Oct 2010 10:55:10 -0700
Subject: [Rd] Reference classes
In-Reply-To: <AANLkTik+o=SgwXO5augahHC18Hv9hBL87VOyGVG8LqN_@mail.gmail.com>
References: <AANLkTik+o=SgwXO5augahHC18Hv9hBL87VOyGVG8LqN_@mail.gmail.com>
Message-ID: <4CC1CFFE.5080402@r-project.org>

Last question first:

 >
 > More generally, I was wondering how firm the commitment is to
 > providing this kind of programming mechanism. I know it's likely to
 > change in some ways in future releases, but can I use it in packages,
 > trusting that only a few tweaks will be needed for compatibility with
 > future versions of R, or is it possible that the whole infrastructure
 > will be removed in future?
 >

Speaking just for myself, I'd say it's pretty solid.  Reasons:

  - it's essentially an add-on and essentially all R code, so as long as 
there is some interest, it's not hurting other code--it builds directly 
on some valuable existing tools for environments, such as active bindings;

  - this is something I've wanted to do for a while.  The essential step 
was being able to subclass environments, and that has been in place for 
some time now;

  - initial experience has been largely positive.  The Rcpp package in 
its newest version depends on reference classes.

Now as to what "tweaks" will be needed, that remains to be seen.  But my 
guess is that most will be issues of implementation.  The user interface 
is sufficiently standardized among languages that it has a reasonable 
chance to stay compatible.

Other comments below.

John


On 10/22/10 7:21 AM, Jon Clayden wrote:
> Dear all,
>
> First, many thanks to John Chambers, and anyone else who was involved,
> for the new support for "reference classes" in R 2.12.0. It's nice to
> see this kind of functionality appear in a relatively R-like form, and
> with the blessing of the core team. In some contexts it is undoubtedly
> appealing to associate a set of methods with a class directly, rather
> than defining a load of generics which are only ever likely to be
> implemented for a single class, or some other such arrangement. (I was
> actually in the process of writing a package which did something
> similar to the reference class idea, although it is less fully
> realised.)
>
> My initial experiences with this functionality have been very
> positive. I've stumbled over one minor issue so far: default values of
> method parameters are not displayed by the help() method, viz.
>
>> library(methods)
>> Regex<- setRefClass("Regex", fields="string", methods=list(
> +     isMatch = function (text, ignoreCase = FALSE)
> +     {
> +         'Returns a logical vector of the same length as "text",
> indicating whether or not each element is a match to the regular
> expression.'
> +         grepl(string, text, ignore.case=ignoreCase, perl=TRUE)
> +     }
> + ))
>> Regex$help("isMatch")
> Call: $isMatch(text, ignoreCase = )
>
> Returns a logical vector of the same length as "text", indicating
> whether or not each element is a match to the regular expression.
>
> It seems unlikely that this is intentional, but correct me if I'm
> wrong. It still seems to happen with the latest R-patched (Mac OS X
> 10.5.8).

It's a bug.
>
> As a suggestion, it would be nice if the accessors() method could be
> used to create just "getters" or just "setters" for particular fields,
> although I realise this can be worked around by removing the unwanted
> methods afterwards.

In other words, read-only fields.  There is a facility for that 
implemented already, but it didn't yet make it into the documentation, 
and it could use some more testing.  The generator object has a $lock() 
method that inserts a write-once type of method for one or more fields. 
  Example:

 > fg <- setRefClass("foo", list(bar = "numeric", flag = "character"),
+             methods = list(
+             addToBar = function(incr) {
+                 b = bar + incr
+                 bar <<- b
+                 b
+             }
+             ))
 > fg$lock("bar")
 > ff = new("foo", bar = 1.5)
 > ff$bar <- 2
Error in function (value)  : Field "bar" is read-only

A revision will document this soon.

(And no, the workaround is not to remove methods.  To customize access 
to a field, the technique is to write an accessor function for the field 
that, in this case, throws an error if it gets an argument.  See the 
documentation for the fields argument.  The convention here and the 
underlying mechanism are taken from active bindings for environments.)

>
> More generally, I was wondering how firm the commitment is to
> providing this kind of programming mechanism. I know it's likely to
> change in some ways in future releases, but can I use it in packages,
> trusting that only a few tweaks will be needed for compatibility with
> future versions of R, or is it possible that the whole infrastructure
> will be removed in future?
>
> All the best,
> Jon
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From jmc4 at stanford.edu  Fri Oct 22 20:03:23 2010
From: jmc4 at stanford.edu (John Chambers)
Date: Fri, 22 Oct 2010 11:03:23 -0700
Subject: [Rd] new.env does not recognize parents
	from	subclassesof	"environment"
In-Reply-To: <cpnvd4u16vs.fsf@gmail.com>
References: <cpnwrpdgod9.fsf@gmail.com>
	<4CBF2514.8050409@stanford.edu>	<cpnzku71qpq.fsf@gmail.com>	<77EB52C6DD32BA4D87471DCD70C8D7000393EF21@NA-PA-VBE03.na.tibco.com>	<4CC077BC.5050209@stanford.edu>
	<cpnvd4u16vs.fsf@gmail.com>
Message-ID: <4CC1D1EB.1040102@stanford.edu>

 You need to update your version of R (r-devel or 2.12 patched) to rev
53385 or later, and read NEWS, particularly the line:


- Assignment of an environment to functions or as an attribute to other
objects now works for subclasses of "environment".



On 10/22/10 10:20 AM, Vitally S. wrote:
> Yet another inconsistency. environment<- does not work with S4:
>
>
>> setClass("myenv", contains = "environment")
> [1] "myenv"
>> env <- new("myenv")
>> tf <- function(x){x}
>> environment(tf) <- env
> Error in environment(tf) <- env : 
>   replacement object is not an environment
>
>
> Vitally.
>
>
> John Chambers <jmc4 at stanford.edu> writes:
>>  This is a problem related to the introduction of exact= into the [[ and [[<- functions. As Bill says, the current
>> method misuses eval.parent() when that argument is added.
>>
>> However, a simpler and more efficient solution is to migrate the checks for subclasses of "environment" used in
>> other base code into the code for [[<- (and for $<-), at which point the methods for these functions are no longer
>> needed.
>>
>> A solution on these lines is being tested now and will find its way into r-devel and 2.12 patched.
>>
>> One other point about the original posting:
>>
>> Please don't use constructions like env at .xData. This depends on the current implementation and is not part of the
>> user-level definition. Use as(env, "environment") or equivalent. (In this case, the assignment of the object's own
>> environment was irrelevant to the error.)
>>
>> John Chambers
>>
>> On 10/21/10 9:21 AM, William Dunlap wrote:
>>> The traceback looks very similar to a problem
>>> in R 2.11.1 reported earlier this month by Troy Robertson.
>>>    >  From: r-devel-bounces at r-project.org
>>>    >  [mailto:r-devel-bounces at r-project.org] On Behalf Of Troy Robertson
>>>    >  Sent: Wednesday, October 06, 2010 6:13 PM
>>>    >  To: 'r-devel at R-project.org'
>>>    >  Subject: Re: [Rd] Recursion error after upgrade to
>>>    >  R_2.11.1[Sec=Unclassified]
>>> It was due to a miscount of how many frames to go
>>> up before evaluating an expression in
>>> getMethod("[[<-",".environment") because setMethod()
>>> introduced a local function in the new method.
>>>
>>> Bill Dunlap
>>> Spotfire, TIBCO Software
>>> wdunlap tibco.com
>>>
>>>> -----Original Message-----
>>>> From: r-devel-bounces at r-project.org
>>>> [mailto:r-devel-bounces at r-project.org] On Behalf Of Vitally S.
>>>> Sent: Thursday, October 21, 2010 9:00 AM
>>>> To: John Chambers
>>>> Cc: r-devel at r-project.org
>>>> Subject: Re: [Rd] new.env does not recognize parents from
>>>> subclassesof "environment"
>>>>
>>>>
>>>>
>>>> Here is an infinite recursion error  which occurs only with S4
>>>> subclasses assignment.
>>>>
>>>>   setClass("myenv", contains = "environment")
>>>> #[1] "myenv"
>>>>   env<- new("myenv")
>>>>   env[[".me"]]<- ?
>>>> #Error: evaluation nested too deeply: infinite recursion /
>>>> options(expressions=)?
>>>>
>>>>
>>>> With basic types it works as expected:
>>>>
>>>> env1<- new.env()
>>>> env1[[".me"]]<- env1
>>>>
>>>> May be this is related to active bindings that you mentioned,
>>>>   but I am still
>>>> reporting it here.
>>>>
>>>> Vitally.
>>>>
>>>>
>>>>>   Thanks for the report.  Should now be fixed in r-devel and
>>>> 2.12 patched (rev 53383).
>>>>> Please do report any cases where a subclass of environment
>>>> doesn't work.  There are some known cases in locking and
>>>>> active binding, that will be fixed in due course.
>>>>>
>>>>> The workaround for any such problem is usually as.environment().
>>>>>
>>>>> On 10/20/10 3:17 AM, Vitaly S. wrote:
>>>>>> Dear Developers,
>>>>>>
>>>>>> A lot has been changed in the R12.0 with respect to
>>>> behavior of "environment"
>>>>>> subclasses.  Many thanks for that.
>>>>>>
>>>>>> One small irregularity, though; new.env does not allow the
>>>> parent to be from S4
>>>>>> subclass.
>>>>>>
>>>>>>
>>>>>>> setClass("myenv", contains="environment")
>>>>>> [1] "myenv"
>>>>>>> new.env(parent=new("myenv"))
>>>>>> Error in new.env(parent = new("myenv")) : 'enclos' must be
>>>> an environment
>>>>>> I wonder if this is a "planed" behavior.
>>>>>>
>>>>>> The use of .xData  slot obviously works:
>>>>>>> new.env(parent=new("myenv")@.xData)
>>>>>> <environment: 063bb9e8>
>>>>>> Thanks,
>>>>>> Vitaly.
>>>>>>
>>>>>> ______________________________________________
>>>>>> R-devel at r-project.org mailing list
>>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From jmc at r-project.org  Fri Oct 22 20:30:54 2010
From: jmc at r-project.org (John Chambers)
Date: Fri, 22 Oct 2010 11:30:54 -0700
Subject: [Rd] Reference classes
In-Reply-To: <4CC1CFFE.5080402@r-project.org>
References: <AANLkTik+o=SgwXO5augahHC18Hv9hBL87VOyGVG8LqN_@mail.gmail.com>
	<4CC1CFFE.5080402@r-project.org>
Message-ID: <4CC1D85E.8080700@r-project.org>

One correction:

On 10/22/10 10:55 AM, John Chambers wrote:
.....

>> As a suggestion, it would be nice if the accessors() method could be
>> used to create just "getters" or just "setters" for particular fields,
>> although I realise this can be worked around by removing the unwanted
>> methods afterwards.
>
> In other words, read-only fields. There is a facility for that
> implemented already, but it didn't yet make it into the documentation,
> and it could use some more testing. The generator object has a $lock()
> method that inserts a write-once type of method for one or more fields.
> Example:
>
>  > fg <- setRefClass("foo", list(bar = "numeric", flag = "character"),
> + methods = list(
> + addToBar = function(incr) {
> + b = bar + incr
> + bar <<- b
> + b
> + }
> + ))
>  > fg$lock("bar")
>  > ff = new("foo", bar = 1.5)
>  > ff$bar <- 2
> Error in function (value) : Field "bar" is read-only
>
>

Actually it is documented in the section on generator objects.  But 
since I also didn't see it, maybe it needs an example.  ;-)

John


From spinuvit.list at gmail.com  Fri Oct 22 21:54:12 2010
From: spinuvit.list at gmail.com (Vitally S.)
Date: Fri, 22 Oct 2010 21:54:12 +0200
Subject: [Rd] new.env does not recognize parents
	from	subclassesof	"environment"
References: <cpnwrpdgod9.fsf@gmail.com> <4CBF2514.8050409@stanford.edu>
	<cpnzku71qpq.fsf@gmail.com>
	<77EB52C6DD32BA4D87471DCD70C8D7000393EF21@NA-PA-VBE03.na.tibco.com>
	<4CC077BC.5050209@stanford.edu> <cpnvd4u16vs.fsf@gmail.com>
	<4CC1D1EB.1040102@stanford.edu>
Message-ID: <cpnr5fi0zrv.fsf@gmail.com>




John Chambers <jmc4 at stanford.edu> writes:

>  You need to update your version of R (r-devel or 2.12 patched) to rev
> 53385 or later, and read NEWS, particularly the line:
>
> - Assignment of an environment to functions or as an attribute to other
> objects now works for subclasses of "environment".
>

I am following the news in daily snapshots from here
ftp://ftp.stat.math.ethz.ch/Software/R
and  the above line is still not in the NEWS of today's version.

Thanks for the patch. Looking forward to the stable release.

Vitally.

> On 10/22/10 10:20 AM, Vitally S. wrote:
>> Yet another inconsistency. environment<- does not work with S4:
>>
>>
>>> setClass("myenv", contains = "environment")
>> [1] "myenv"
>>> env <- new("myenv")
>>> tf <- function(x){x}
>>> environment(tf) <- env
>> Error in environment(tf) <- env : 
>>   replacement object is not an environment
>>
>>
>> Vitally.
>>
>>
>> John Chambers <jmc4 at stanford.edu> writes:
>>> This is a problem related to the introduction of exact= into the [[ and [[<- functions. As Bill says, the
> current
>>> method misuses eval.parent() when that argument is added.
>>>
>>> However, a simpler and more efficient solution is to migrate the checks for subclasses of "environment" used in
>>> other base code into the code for [[<- (and for $<-), at which point the methods for these functions are no
> longer
>>> needed.
>>>
>>> A solution on these lines is being tested now and will find its way into r-devel and 2.12 patched.
>>>
>>> One other point about the original posting:
>>>
>>> Please don't use constructions like env at .xData. This depends on the current implementation and is not part of
> the
>>> user-level definition. Use as(env, "environment") or equivalent. (In this case, the assignment of the object's
> own
>>> environment was irrelevant to the error.)
>>>
>>> John Chambers
>>>
>>> On 10/21/10 9:21 AM, William Dunlap wrote:
>>>> The traceback looks very similar to a problem
>>>> in R 2.11.1 reported earlier this month by Troy Robertson.
>>>>    >  From: r-devel-bounces at r-project.org
>>>>    >  [mailto:r-devel-bounces at r-project.org] On Behalf Of Troy Robertson
>>>>    >  Sent: Wednesday, October 06, 2010 6:13 PM
>>>>    >  To: 'r-devel at R-project.org'
>>>>    >  Subject: Re: [Rd] Recursion error after upgrade to
>>>>    >  R_2.11.1[Sec=Unclassified]
>>>> It was due to a miscount of how many frames to go
>>>> up before evaluating an expression in
>>>> getMethod("[[<-",".environment") because setMethod()
>>>> introduced a local function in the new method.
>>>>
>>>> Bill Dunlap
>>>> Spotfire, TIBCO Software
>>>> wdunlap tibco.com
>>>>
>>>>> -----Original Message-----
>>>>> From: r-devel-bounces at r-project.org
>>>>> [mailto:r-devel-bounces at r-project.org] On Behalf Of Vitally S.
>>>>> Sent: Thursday, October 21, 2010 9:00 AM
>>>>> To: John Chambers
>>>>> Cc: r-devel at r-project.org
>>>>> Subject: Re: [Rd] new.env does not recognize parents from
>>>>> subclassesof "environment"
>>>>>
>>>>>
>>>>>
>>>>> Here is an infinite recursion error  which occurs only with S4
>>>>> subclasses assignment.
>>>>>
>>>>>   setClass("myenv", contains = "environment")
>>>>> #[1] "myenv"
>>>>>   env<- new("myenv")
>>>>>   env[[".me"]]<- ?
>>>>> #Error: evaluation nested too deeply: infinite recursion /
>>>>> options(expressions=)?
>>>>>
>>>>>
>>>>> With basic types it works as expected:
>>>>>
>>>>> env1<- new.env()
>>>>> env1[[".me"]]<- env1
>>>>>
>>>>> May be this is related to active bindings that you mentioned,
>>>>>   but I am still
>>>>> reporting it here.
>>>>>
>>>>> Vitally.
>>>>>
>>>>>
>>>>>>   Thanks for the report.  Should now be fixed in r-devel and
>>>>> 2.12 patched (rev 53383).
>>>>>> Please do report any cases where a subclass of environment
>>>>> doesn't work.  There are some known cases in locking and
>>>>>> active binding, that will be fixed in due course.
>>>>>>
>>>>>> The workaround for any such problem is usually as.environment().
>>>>>>
>>>>>> On 10/20/10 3:17 AM, Vitaly S. wrote:
>>>>>>> Dear Developers,
>>>>>>>
>>>>>>> A lot has been changed in the R12.0 with respect to
>>>>> behavior of "environment"
>>>>>>> subclasses.  Many thanks for that.
>>>>>>>
>>>>>>> One small irregularity, though; new.env does not allow the
>>>>> parent to be from S4
>>>>>>> subclass.
>>>>>>>
>>>>>>>
>>>>>>>> setClass("myenv", contains="environment")
>>>>>>> [1] "myenv"
>>>>>>>> new.env(parent=new("myenv"))
>>>>>>> Error in new.env(parent = new("myenv")) : 'enclos' must be
>>>>> an environment
>>>>>>> I wonder if this is a "planed" behavior.
>>>>>>>
>>>>>>> The use of .xData  slot obviously works:
>>>>>>>> new.env(parent=new("myenv")@.xData)
>>>>>>> <environment: 063bb9e8>
>>>>>>> Thanks,
>>>>>>> Vitaly.
>>>>>>>
>>>>>>> ______________________________________________
>>>>>>> R-devel at r-project.org mailing list
>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel>>> ______________________________________________
>>>>> R-devel at r-project.org mailing list
>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel>>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From rhurlin at gwdg.de  Fri Oct 22 22:10:56 2010
From: rhurlin at gwdg.de (Rainer Hurling)
Date: Fri, 22 Oct 2010 22:10:56 +0200
Subject: [Rd] [R] R-2.12.0 hangs while loading RGtk2 on FreeBSD
In-Reply-To: <4CC19D4B.6070605@gwdg.de>
References: <4CC03E47.2010800@gwdg.de>	<alpine.LFD.2.00.1010211508350.5999@toucan.stats.ox.ac.uk>	<4CC052D6.3030106@gwdg.de>	<alpine.LFD.2.00.1010211704340.7969@toucan.stats.ox.ac.uk>	<4CC06D6A.8040609@gwdg.de>	<AANLkTimAmo0ro2Tiw_rWAJ732R+ATRgNdS0SvuO6hYq+@mail.gmail.com>
	<4CC19D4B.6070605@gwdg.de>
Message-ID: <4CC1EFD0.40400@gwdg.de>

On 22.10.2010 16:18 (UTC+2), Rainer Hurling wrote:
> On 22.10.2010 14:57 (UTC+1), Michael Lawrence wrote:
>>
>>
>> On Thu, Oct 21, 2010 at 9:42 AM, Rainer Hurling <rhurlin at gwdg.de
>> <mailto:rhurlin at gwdg.de>> wrote:
>>
>> [moved from R-help]
>>
>> On 21.10.2010 18:09 (UTC+1), Prof Brian Ripley wrote:
>>
>> If you do R CMD INSTALL --no-test-load this will skip the part
>> that is
>> hanging and you can try loading in stages (e.g. dyn.load on the
>> RGtk2.so).
>>
>>
>> With '--no-test-load' it installs and ends normal. Loading per
>> dyn.load("RGtk2.so") works, just as dyn.load("RGtk2.so",F) and
>> dyn.load("RGtk2.so",,F). Unloading works, too.
>>
>> Normal loading over library(RGtk2) within R does not work. R than is
>> hanging.
>>
>> It seems the problem is not with the library itself?
>>
>>
>> It looks like something is happening when initializing GTK+ and the
>> event loop. This happens in the function R_gtkInit in Rgtk.c. If you
>> could run R -d gdb and break on that function, perhaps you could step
>> through until it hangs.
>
> Michael, thank you for answering. As I wrote earlier (on R-help@),
> unfortunately I have no experience with debugging (I am not a
> programmer). So I would need some more assistence.
>
> Is there a difference between 'library(RGtk2)' and 'dyn.load(RGtk2)' in
> initializing GTK+? I am able to dyn.load, but library does not work.
>
> After starting with 'R -d gdb' is the following right?
>
> (gdb) break R_gtkInit
> Function "R_gtkInit" not defined.
> Make breakpoint pending on future shared library load? (y or [n]) y
> Breakpoint 1 (R_gtkInit) pending.
>
> When I try to proceed, it gives me the following message
>
> (gdb) run
> Starting program: /usr/local/lib/R/bin/exec/R
> /libexec/ld-elf.so.1: Shared object "libRblas.so" not found,
> required by "R"
> Program exited with code 01.

Ok, I am one step further now:


(gdb) run
Starting program: /usr/local/lib/R/bin/exec/R
[..SNIP..]
 > library(RGtk2)
[New LWP 100174]
Breakpoint 2 at 0x318bd490: file Rgtk.c, line 104.
Pending breakpoint "R_gtkInit" resolved
[New Thread 2f408b00 (LWP 100174)]
[Switching to Thread 2f408b00 (LWP 100174)]

Breakpoint 2, R_gtkInit (rargc=0x30b11d10, rargv=0x30a98458, 
success=0x30afbad0) at Rgtk.c:104
104     Rgtk.c: No such file or directory.
         in Rgtk.c
(gdb)


What do you suggest I should do next?


> Thanks again,
> Rainer
>
>
>> Thanks,
>> Michael
>>
>> I think this is rather technical for R-help, so maybe move to
>> R-devel?
>>
>>
>> I moved to R-devel.
>>
>> And can you check the RGtk2 version? A recent but not current
>> version
>> (2.12.17?) did hang initializing Gtk+ on some platforms and Michael
>> Lawrence had to be involved.
>>
>>
>> I am using RGtk2_2.12.18.tar.gz for month now.
>>
>>
>> On Thu, 21 Oct 2010, Rainer Hurling wrote:
>>
>> Am 21.10.2010 16:12 (UTC+1) schrieb Prof Brian Ripley:
>>
>> On Thu, 21 Oct 2010, Rainer Hurling wrote:
>>
>> I am working with R-2.12.0 on FreeBSD 9.0-CURRENT
>> for a while now. I
>> successfully installed more than 300 packages (most
>> as dependencies of
>> others).
>>
>> There are two packages I am not able to install:
>> RGtk2 and rggobi.
>>
>> For example rggobi builds fine and after that it
>> wants to load:
>>
>> ------------------------------------------------------
>> # R CMD INSTALL rggobi_2.1.16.tar.gz
>> [..SNIP..]
>> gcc -std=gnu99 -shared -L/usr/local/lib -o rggobi.so
>> RSEval.o brush.o
>> colorSchemes.o conversion.o data.o dataset.o
>> display.o displays.o
>> edges.o ggobi.o identify.o init.o io.o keyHandlers.o
>> longitudinal.o
>> modes.o plot.o plots.o plugins.o print.o session.o
>> smooth.o ui.o
>> utils.o -pthread -L/usr/local/lib -lggobi
>> -lgtk-x11-2.0 -lxml2
>> -lgdk-x11-2.0 -latk-1.0 -lgdk_pixbuf-2.0
>> -lpangocairo-1.0 -lXext
>> -lXrender -lXinerama -lXi -lXrandr -lXcursor
>> -lXcomposite -lXdamage
>> -lpangoft2-1.0 -lgio-2.0 -lXfixes -lcairo -lX11
>> -lpango-1.0 -lm
>> -lfreetype -lfontconfig -lgobject-2.0 -lgmodule-2.0
>> -lgthread-2.0
>> -lglib-2.0
>> installiert nach /usr/local/lib/R/library/rggobi/libs
>> ** R
>> ** data
>> ** moving datasets to lazyload DB
>> ** demo
>> ** preparing package for lazy loading
>> ------------------------------------------------------
>>
>> At this point the install process is hanging, R
>> utilises no more CPU
>> time. Same with package RGtk2.
>>
>> Is this a known error? Please let me know if I can
>> give more
>> information or try something different.
>>
>>
>> Well, those are exactly the two packages using Gtk+.
>>
>> There is no known general problem, and as you could have
>> checked from
>> the CRAN check pages, those packages install without
>> problems on several
>> platforms. (Not Solaris, where ggobi does not install
>> and RGtk2 requires
>> gcc, and not x64 Windows where both need to be patched.)
>>
>> So it does look very like there is a problem with
>> loading against the
>> Gtk+ system libraries on your system.
>>
>>
>> I think you are right. With previous versions of R (until
>> R-2.10.x) I
>> did not have this hanging when loading RGtk2 ... And I am
>> pretty sure
>> that I have no problems with gtk2 outside of R on my FreeBSD
>> system.
>>
>> In the meantime I found out that the reported loading error
>> of rggobi
>> is a loading error of RGtk2, which fails (hangs). So there
>> remains
>> only a loading error with RGtk2. (Because of that I changed
>> the subject.)
>>
>> After building/installing RGtk2, there are the following
>> messages:
>>
>> ------------------------------------------------------
>> [..SNIP..]
>> gcc -std=gnu99 -shared -L/usr/local/lib -o RGtk2.so
>> RGtkDataFrame.o
>> Rgtk.o atkAccessors.o atkClasses.o atkConversion.o atkFuncs.o
>> atkManuals.o atkUserFuncs.o cairo-enums.o cairoAccessors.o
>> cairoConversion.o cairoFuncs.o cairoManuals.o cairoUserFuncs.o
>> classes.o conversion.o eventLoop.o gdkAccessors.o gdkClasses.o
>> gdkConversion.o gdkFuncs.o gdkManuals.o gdkUserFuncs.o glib.o
>> gobject.o gtkAccessors.o gtkClasses.o gtkConversion.o gtkFuncs.o
>> gtkManuals.o gtkUserFuncs.o libgladeAccessors.o libgladeFuncs.o
>> libgladeManuals.o libgladeUserFuncs.o pangoAccessors.o
>> pangoClasses.o
>> pangoConversion.o pangoFuncs.o pangoManuals.o
>> pangoUserFuncs.o utils.o
>> zcompat.o -pthread -L/usr/local/lib -lglade-2.0
>> -lgtk-x11-2.0 -lxml2
>> -lgdk-x11-2.0 -latk-1.0 -lgdk_pixbuf-2.0 -lpangocairo-1.0 -lXext
>> -lXrender -lXinerama -lXi -lXrandr -lXcursor -lXcomposite
>> -lXdamage
>> -lpangoft2-1.0 -lgio-2.0 -lXfixes -lcairo -lX11 -lpango-1.0 -lm
>> -lfreetype -lfontconfig -lgobject-2.0 -lgmodule-2.0
>> -lgthread-2.0
>> -lglib-2.0 -pthread -L/usr/local/lib -lgthread-2.0 -lglib-2.0
>> installiert nach /usr/local/lib/R/library/RGtk2/libs
>> ** R
>> ** demo
>> ** inst
>> ** preparing package for lazy loading
>> ** help
>> *** installing help indices
>> ** building package indices ...
>> ** testing if installed package can be loaded [..hanging
>> from here..]
>> ------------------------------------------------------
>>
>> Is there a chance to find out what is wrong with loading
>> RGtk2 on my
>> system? Unfortunately I have almost no experience with real
>> debugging
>> methods on R. But of course I am willing to help and try out ...
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From jon.clayden at gmail.com  Sat Oct 23 01:52:02 2010
From: jon.clayden at gmail.com (Jon Clayden)
Date: Sat, 23 Oct 2010 00:52:02 +0100
Subject: [Rd] Reference classes
In-Reply-To: <4CC1CFFE.5080402@r-project.org>
References: <AANLkTik+o=SgwXO5augahHC18Hv9hBL87VOyGVG8LqN_@mail.gmail.com>
	<4CC1CFFE.5080402@r-project.org>
Message-ID: <AANLkTinrSDJ6ZxinQNF3F9EVnnU=x0VeaxYoq6+t41fe@mail.gmail.com>

On 22 October 2010 18:55, John Chambers <jmc at r-project.org> wrote:

>> As a suggestion, it would be nice if the accessors() method could be
>> used to create just "getters" or just "setters" for particular fields,
>> although I realise this can be worked around by removing the unwanted
>> methods afterwards.
>
> In other words, read-only fields. ?There is a facility for that implemented
> already, but it didn't yet make it into the documentation, and it could use
> some more testing. ?The generator object has a $lock() method that inserts a
> write-once type of method for one or more fields. ?Example:
>
>> fg <- setRefClass("foo", list(bar = "numeric", flag = "character"),
> + ? ? ? ? ? ? methods = list(
> + ? ? ? ? ? ? addToBar = function(incr) {
> + ? ? ? ? ? ? ? ? b = bar + incr
> + ? ? ? ? ? ? ? ? bar <<- b
> + ? ? ? ? ? ? ? ? b
> + ? ? ? ? ? ? }
> + ? ? ? ? ? ? ))
>> fg$lock("bar")
>> ff = new("foo", bar = 1.5)
>> ff$bar <- 2
> Error in function (value) ?: Field "bar" is read-only
>
> A revision will document this soon.
>
> (And no, the workaround is not to remove methods. ?To customize access to a
> field, the technique is to write an accessor function for the field that, in
> this case, throws an error if it gets an argument. ?See the documentation
> for the fields argument. ?The convention here and the underlying mechanism
> are taken from active bindings for environments.)

OK, yes - I see. This is clearly much less superficial than removing
the setter method for a field which can be directly set anyway. I'll
have to try out field accessor functions and get a feel for the
semantics.

Many thanks for the rapid and very helpful response.

Regards,
Jon


From charlie at stat.umn.edu  Sat Oct 23 05:59:13 2010
From: charlie at stat.umn.edu (Charles Geyer)
Date: Fri, 22 Oct 2010 22:59:13 -0500
Subject: [Rd] possible error checking bug and documentation bug in ts
Message-ID: <AANLkTinR7fexy5Z3g3EnWx9sCLev7_hXoJCXyXHKS0Wj@mail.gmail.com>

The documentation for ts says "Only one of ?frequency? or ?deltat? should
be provided" but why doesn't it enforce this with

??? stopifnot(missing(frequency) || missing(deltat))

Wouldn't that work?? Also the documentation does not say what valid
time series parameters are.  To find that out one must know to RTFS
in src/main/attrib.c and find that

??? end - start? = (n - 1) / frequency

or

?? end - start? = (n - 1)? * deltat

is required to avoid an error, where
n is either length(data) or nrow(data).
Why can the help page for ts say that?

I suppose this is picky, but a newbie just wasted a couple of days
with the mysterious error thrown in badtsp in src/main/attrib.c
when he ran afoul of R's argument matching rules and
unintentionally supplied both frequency and deltat (thinking he
was supplying deltat and ts.eps).? It took me more time that it
should have to figure it out too.
--
Charles Geyer
Professor, School of Statistics
University of Minnesota
charlie at stat.umn.edu


From rhurlin at gwdg.de  Sat Oct 23 11:49:44 2010
From: rhurlin at gwdg.de (Rainer Hurling)
Date: Sat, 23 Oct 2010 11:49:44 +0200
Subject: [Rd] R-2.12.0 hangs while loading RGtk2 on FreeBSD
In-Reply-To: <4CC1EFD0.40400@gwdg.de>
References: <4CC03E47.2010800@gwdg.de>	<alpine.LFD.2.00.1010211508350.5999@toucan.stats.ox.ac.uk>	<4CC052D6.3030106@gwdg.de>	<alpine.LFD.2.00.1010211704340.7969@toucan.stats.ox.ac.uk>	<4CC06D6A.8040609@gwdg.de>	<AANLkTimAmo0ro2Tiw_rWAJ732R+ATRgNdS0SvuO6hYq+@mail.gmail.com>	<4CC19D4B.6070605@gwdg.de>
	<4CC1EFD0.40400@gwdg.de>
Message-ID: <4CC2AFB8.1060404@gwdg.de>

On 22.10.2010 22:10 (UTC+1), Rainer Hurling wrote:
> On 22.10.2010 16:18 (UTC+2), Rainer Hurling wrote:
>> On 22.10.2010 14:57 (UTC+1), Michael Lawrence wrote:
>>>
>>>
>>> On Thu, Oct 21, 2010 at 9:42 AM, Rainer Hurling <rhurlin at gwdg.de
>>> <mailto:rhurlin at gwdg.de>> wrote:
>>>
>>> [moved from R-help]
>>>
>>> On 21.10.2010 18:09 (UTC+1), Prof Brian Ripley wrote:
>>>
>>> If you do R CMD INSTALL --no-test-load this will skip the part
>>> that is
>>> hanging and you can try loading in stages (e.g. dyn.load on the
>>> RGtk2.so).
>>>
>>>
>>> With '--no-test-load' it installs and ends normal. Loading per
>>> dyn.load("RGtk2.so") works, just as dyn.load("RGtk2.so",F) and
>>> dyn.load("RGtk2.so",,F). Unloading works, too.
>>>
>>> Normal loading over library(RGtk2) within R does not work. R than is
>>> hanging.
>>>
>>> It seems the problem is not with the library itself?
>>>
>>>
>>> It looks like something is happening when initializing GTK+ and the
>>> event loop. This happens in the function R_gtkInit in Rgtk.c. If you
>>> could run R -d gdb and break on that function, perhaps you could step
>>> through until it hangs.
>>
>> Michael, thank you for answering. As I wrote earlier (on R-help@),
>> unfortunately I have no experience with debugging (I am not a
>> programmer). So I would need some more assistence.
>>
>> Is there a difference between 'library(RGtk2)' and 'dyn.load(RGtk2)' in
>> initializing GTK+? I am able to dyn.load, but library does not work.
>>
>> After starting with 'R -d gdb' is the following right?
>>
>> (gdb) break R_gtkInit
>> Function "R_gtkInit" not defined.
>> Make breakpoint pending on future shared library load? (y or [n]) y
>> Breakpoint 1 (R_gtkInit) pending.
>>
>> When I try to proceed, it gives me the following message
>>
>> (gdb) run
>> Starting program: /usr/local/lib/R/bin/exec/R
>> /libexec/ld-elf.so.1: Shared object "libRblas.so" not found,
>> required by "R"
>> Program exited with code 01.
>
> Ok, I am one step further now:
>
>
> (gdb) run
> Starting program: /usr/local/lib/R/bin/exec/R
> [..SNIP..]
>  > library(RGtk2)
> [New LWP 100174]
> Breakpoint 2 at 0x318bd490: file Rgtk.c, line 104.
> Pending breakpoint "R_gtkInit" resolved
> [New Thread 2f408b00 (LWP 100174)]
> [Switching to Thread 2f408b00 (LWP 100174)]
>
> Breakpoint 2, R_gtkInit (rargc=0x30b11d10, rargv=0x30a98458,
> success=0x30afbad0) at Rgtk.c:104
> 104 Rgtk.c: No such file or directory.
> in Rgtk.c
> (gdb)
>
>
> What do you suggest I should do next?

Rgtk.c was not found from gdb because RGtk2 was not build with DEBUG=T 
and R_KEEP_PKG_SOURCE=yes.

So this is the next try. I can trace the code until it hangs:


library(RGtk2)
[New LWP 100250]
Breakpoint 2 at 0x458bd490: file Rgtk.c, line 104.
Pending breakpoint "R_gtkInit" resolved
[New Thread 4322ef00 (LWP 100250)]
[Switching to Thread 4322ef00 (LWP 100250)]

Breakpoint 2, R_gtkInit (rargc=0x446d0980, rargv=0x44698618, 
success=0x446d09e0) at Rgtk.c:104
104     {
(gdb) n
107       argc = (int) *rargc;
(gdb) n
104     {
(gdb) n
107       argc = (int) *rargc;
(gdb) n
109       if (!gdk_display_get_default()) {
(gdb) n
110         gtk_disable_setlocale();
(gdb) n
111         if (!gtk_init_check(&argc, &rargv)) {
(gdb) n
121         if (!GDK_DISPLAY()) {
(gdb) n
127         addInputHandler(R_InputHandlers, 
ConnectionNumber(GDK_DISPLAY()),
(gdb) n
132         if (!pipe(fds)) {
(gdb) n
133           ifd = fds[0];
(gdb) n
134           ofd = fds[1];
(gdb) n
135           addInputHandler(R_InputHandlers, ifd, 
R_gtk_timerInputHandler, 32);
(gdb) n
133           ifd = fds[0];
(gdb) n
134           ofd = fds[1];
(gdb) n
135           addInputHandler(R_InputHandlers, ifd, 
R_gtk_timerInputHandler, 32);
(gdb) n
136           if (!g_thread_supported ()) g_thread_init (NULL);
(gdb) n
137           g_thread_create(R_gtk_timerThreadFunc, NULL, FALSE, NULL);
(gdb) n

Line 138 (R_CStackLimit = -1;) is hanging. It seems there is something 
wrong with piping the file descriptor?


>> Thanks again,
>> Rainer
>>
>>
>>> Thanks,
>>> Michael
>>>
>>> I think this is rather technical for R-help, so maybe move to
>>> R-devel?
>>>
>>>
>>> I moved to R-devel.
>>>
>>> And can you check the RGtk2 version? A recent but not current
>>> version
>>> (2.12.17?) did hang initializing Gtk+ on some platforms and Michael
>>> Lawrence had to be involved.
>>>
>>>
>>> I am using RGtk2_2.12.18.tar.gz for month now.
>>>
>>>
>>> On Thu, 21 Oct 2010, Rainer Hurling wrote:
>>>
>>> Am 21.10.2010 16:12 (UTC+1) schrieb Prof Brian Ripley:
>>>
>>> On Thu, 21 Oct 2010, Rainer Hurling wrote:
>>>
>>> I am working with R-2.12.0 on FreeBSD 9.0-CURRENT
>>> for a while now. I
>>> successfully installed more than 300 packages (most
>>> as dependencies of
>>> others).
>>>
>>> There are two packages I am not able to install:
>>> RGtk2 and rggobi.
>>>
>>> For example rggobi builds fine and after that it
>>> wants to load:
>>>
>>> ------------------------------------------------------
>>> # R CMD INSTALL rggobi_2.1.16.tar.gz
>>> [..SNIP..]
>>> gcc -std=gnu99 -shared -L/usr/local/lib -o rggobi.so
>>> RSEval.o brush.o
>>> colorSchemes.o conversion.o data.o dataset.o
>>> display.o displays.o
>>> edges.o ggobi.o identify.o init.o io.o keyHandlers.o
>>> longitudinal.o
>>> modes.o plot.o plots.o plugins.o print.o session.o
>>> smooth.o ui.o
>>> utils.o -pthread -L/usr/local/lib -lggobi
>>> -lgtk-x11-2.0 -lxml2
>>> -lgdk-x11-2.0 -latk-1.0 -lgdk_pixbuf-2.0
>>> -lpangocairo-1.0 -lXext
>>> -lXrender -lXinerama -lXi -lXrandr -lXcursor
>>> -lXcomposite -lXdamage
>>> -lpangoft2-1.0 -lgio-2.0 -lXfixes -lcairo -lX11
>>> -lpango-1.0 -lm
>>> -lfreetype -lfontconfig -lgobject-2.0 -lgmodule-2.0
>>> -lgthread-2.0
>>> -lglib-2.0
>>> installiert nach /usr/local/lib/R/library/rggobi/libs
>>> ** R
>>> ** data
>>> ** moving datasets to lazyload DB
>>> ** demo
>>> ** preparing package for lazy loading
>>> ------------------------------------------------------
>>>
>>> At this point the install process is hanging, R
>>> utilises no more CPU
>>> time. Same with package RGtk2.
>>>
>>> Is this a known error? Please let me know if I can
>>> give more
>>> information or try something different.
>>>
>>>
>>> Well, those are exactly the two packages using Gtk+.
>>>
>>> There is no known general problem, and as you could have
>>> checked from
>>> the CRAN check pages, those packages install without
>>> problems on several
>>> platforms. (Not Solaris, where ggobi does not install
>>> and RGtk2 requires
>>> gcc, and not x64 Windows where both need to be patched.)
>>>
>>> So it does look very like there is a problem with
>>> loading against the
>>> Gtk+ system libraries on your system.
>>>
>>>
>>> I think you are right. With previous versions of R (until
>>> R-2.10.x) I
>>> did not have this hanging when loading RGtk2 ... And I am
>>> pretty sure
>>> that I have no problems with gtk2 outside of R on my FreeBSD
>>> system.
>>>
>>> In the meantime I found out that the reported loading error
>>> of rggobi
>>> is a loading error of RGtk2, which fails (hangs). So there
>>> remains
>>> only a loading error with RGtk2. (Because of that I changed
>>> the subject.)
>>>
>>> After building/installing RGtk2, there are the following
>>> messages:
>>>
>>> ------------------------------------------------------
>>> [..SNIP..]
>>> gcc -std=gnu99 -shared -L/usr/local/lib -o RGtk2.so
>>> RGtkDataFrame.o
>>> Rgtk.o atkAccessors.o atkClasses.o atkConversion.o atkFuncs.o
>>> atkManuals.o atkUserFuncs.o cairo-enums.o cairoAccessors.o
>>> cairoConversion.o cairoFuncs.o cairoManuals.o cairoUserFuncs.o
>>> classes.o conversion.o eventLoop.o gdkAccessors.o gdkClasses.o
>>> gdkConversion.o gdkFuncs.o gdkManuals.o gdkUserFuncs.o glib.o
>>> gobject.o gtkAccessors.o gtkClasses.o gtkConversion.o gtkFuncs.o
>>> gtkManuals.o gtkUserFuncs.o libgladeAccessors.o libgladeFuncs.o
>>> libgladeManuals.o libgladeUserFuncs.o pangoAccessors.o
>>> pangoClasses.o
>>> pangoConversion.o pangoFuncs.o pangoManuals.o
>>> pangoUserFuncs.o utils.o
>>> zcompat.o -pthread -L/usr/local/lib -lglade-2.0
>>> -lgtk-x11-2.0 -lxml2
>>> -lgdk-x11-2.0 -latk-1.0 -lgdk_pixbuf-2.0 -lpangocairo-1.0 -lXext
>>> -lXrender -lXinerama -lXi -lXrandr -lXcursor -lXcomposite
>>> -lXdamage
>>> -lpangoft2-1.0 -lgio-2.0 -lXfixes -lcairo -lX11 -lpango-1.0 -lm
>>> -lfreetype -lfontconfig -lgobject-2.0 -lgmodule-2.0
>>> -lgthread-2.0
>>> -lglib-2.0 -pthread -L/usr/local/lib -lgthread-2.0 -lglib-2.0
>>> installiert nach /usr/local/lib/R/library/RGtk2/libs
>>> ** R
>>> ** demo
>>> ** inst
>>> ** preparing package for lazy loading
>>> ** help
>>> *** installing help indices
>>> ** building package indices ...
>>> ** testing if installed package can be loaded [..hanging
>>> from here..]
>>> ------------------------------------------------------
>>>
>>> Is there a chance to find out what is wrong with loading
>>> RGtk2 on my
>>> system? Unfortunately I have almost no experience with real
>>> debugging
>>> methods on R. But of course I am willing to help and try out ...


From spinuvit.list at gmail.com  Sat Oct 23 14:43:56 2010
From: spinuvit.list at gmail.com (Vitalie S.)
Date: Sat, 23 Oct 2010 14:43:56 +0200
Subject: [Rd] Plans for tighter integration of reference classes in R.
Message-ID: <cpn62wt13lf.fsf@gmail.com>


Hello Everyone!  Here are a couple of thought/questions on refClasses
integration in R core functionality.

First, coexistence with S4:

> X <- setRefClass("classX", fields = c("a", "b"),
+                  representation = list(c = "character"))
> x <- X$new()
> x at c <- "sss"
> x
An object of class "classX"
<environment: 059bf6a4>
Slot "c":
[1] "sss"

The above is cool, S4 and refClasses apparently live happily together.
But, 

> x$.self
An object of class "classX"
<environment: 059bf6a4>
Slot "c":
character(0)

This is not a surprise, taking into account the copping paradigm of R.
Are there any plans to tighten S4<>refClasses integration? Or it's just not a
good idea to mix them as in the above example?


Second, R core integration (this bothers me much more):

> X$methods(m = function(t) a*t)
> environment(x$m)
<environment: 059bf6a4>

environment(..) does not return the refObject but the basic type. I assume that
it is the same with other core functionality. Usage of refObjects as parent.env
is also probably precluded in the similar way (don't have a patched R, so can
not test yet).

Would it be possible, some day, to use refObjects as parent.env or function's
environment  without "loosing the class"?

Parenthetically, the attributes of an object (including S3 classes) are not lost:

> env <- structure(new.env(), a1 = "fdsf", class = "old_class")
> tf <- function(x)x
> environment(tf) <- env
> environment(tf)
<environment: 056570a0>
attr(,"a1")
[1] "fdsf"
attr(,"class")
[1] "old_class"
> class(environment(tf))
[1] "old_class"
> 

Thanks,
Vitalie.


From ligges at statistik.tu-dortmund.de  Sat Oct 23 17:08:05 2010
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Sat, 23 Oct 2010 17:08:05 +0200
Subject: [Rd] new.env does not recognize
	parents	from	subclassesof	"environment"
In-Reply-To: <cpnr5fi0zrv.fsf@gmail.com>
References: <cpnwrpdgod9.fsf@gmail.com>
	<4CBF2514.8050409@stanford.edu>	<cpnzku71qpq.fsf@gmail.com>	<77EB52C6DD32BA4D87471DCD70C8D7000393EF21@NA-PA-VBE03.na.tibco.com>	<4CC077BC.5050209@stanford.edu>
	<cpnvd4u16vs.fsf@gmail.com>	<4CC1D1EB.1040102@stanford.edu>
	<cpnr5fi0zrv.fsf@gmail.com>
Message-ID: <4CC2FA55.8000207@statistik.tu-dortmund.de>

Looks like those ETH pages were nnot updated after the R-2.12.0 release 
(they do not show current R-tached / R-devel), hence CCing Martin Maechler.

Best,
Uwe Ligges





On 22.10.2010 21:54, Vitally S. wrote:
>
>
>
> John Chambers<jmc4 at stanford.edu>  writes:
>
>>   You need to update your version of R (r-devel or 2.12 patched) to rev
>> 53385 or later, and read NEWS, particularly the line:
>>
>> - Assignment of an environment to functions or as an attribute to other
>> objects now works for subclasses of "environment".
>>
>
> I am following the news in daily snapshots from here
> ftp://ftp.stat.math.ethz.ch/Software/R
> and  the above line is still not in the NEWS of today's version.
>
> Thanks for the patch. Looking forward to the stable release.
>
> Vitally.
>
>> On 10/22/10 10:20 AM, Vitally S. wrote:
>>> Yet another inconsistency. environment<- does not work with S4:
>>>
>>>
>>>> setClass("myenv", contains = "environment")
>>> [1] "myenv"
>>>> env<- new("myenv")
>>>> tf<- function(x){x}
>>>> environment(tf)<- env
>>> Error in environment(tf)<- env :
>>>    replacement object is not an environment
>>>
>>>
>>> Vitally.
>>>
>>>
>>> John Chambers<jmc4 at stanford.edu>  writes:
>>>> This is a problem related to the introduction of exact= into the [[ and [[<- functions. As Bill says, the
>> current
>>>> method misuses eval.parent() when that argument is added.
>>>>
>>>> However, a simpler and more efficient solution is to migrate the checks for subclasses of "environment" used in
>>>> other base code into the code for [[<- (and for $<-), at which point the methods for these functions are no
>> longer
>>>> needed.
>>>>
>>>> A solution on these lines is being tested now and will find its way into r-devel and 2.12 patched.
>>>>
>>>> One other point about the original posting:
>>>>
>>>> Please don't use constructions like env at .xData. This depends on the current implementation and is not part of
>> the
>>>> user-level definition. Use as(env, "environment") or equivalent. (In this case, the assignment of the object's
>> own
>>>> environment was irrelevant to the error.)
>>>>
>>>> John Chambers
>>>>
>>>> On 10/21/10 9:21 AM, William Dunlap wrote:
>>>>> The traceback looks very similar to a problem
>>>>> in R 2.11.1 reported earlier this month by Troy Robertson.
>>>>>     >   From: r-devel-bounces at r-project.org
>>>>>     >   [mailto:r-devel-bounces at r-project.org] On Behalf Of Troy Robertson
>>>>>     >   Sent: Wednesday, October 06, 2010 6:13 PM
>>>>>     >   To: 'r-devel at R-project.org'
>>>>>     >   Subject: Re: [Rd] Recursion error after upgrade to
>>>>>     >   R_2.11.1[Sec=Unclassified]
>>>>> It was due to a miscount of how many frames to go
>>>>> up before evaluating an expression in
>>>>> getMethod("[[<-",".environment") because setMethod()
>>>>> introduced a local function in the new method.
>>>>>
>>>>> Bill Dunlap
>>>>> Spotfire, TIBCO Software
>>>>> wdunlap tibco.com
>>>>>
>>>>>> -----Original Message-----
>>>>>> From: r-devel-bounces at r-project.org
>>>>>> [mailto:r-devel-bounces at r-project.org] On Behalf Of Vitally S.
>>>>>> Sent: Thursday, October 21, 2010 9:00 AM
>>>>>> To: John Chambers
>>>>>> Cc: r-devel at r-project.org
>>>>>> Subject: Re: [Rd] new.env does not recognize parents from
>>>>>> subclassesof "environment"
>>>>>>
>>>>>>
>>>>>>
>>>>>> Here is an infinite recursion error  which occurs only with S4
>>>>>> subclasses assignment.
>>>>>>
>>>>>>    setClass("myenv", contains = "environment")
>>>>>> #[1] "myenv"
>>>>>>    env<- new("myenv")
>>>>>>    env[[".me"]]<- ?
>>>>>> #Error: evaluation nested too deeply: infinite recursion /
>>>>>> options(expressions=)?
>>>>>>
>>>>>>
>>>>>> With basic types it works as expected:
>>>>>>
>>>>>> env1<- new.env()
>>>>>> env1[[".me"]]<- env1
>>>>>>
>>>>>> May be this is related to active bindings that you mentioned,
>>>>>>    but I am still
>>>>>> reporting it here.
>>>>>>
>>>>>> Vitally.
>>>>>>
>>>>>>
>>>>>>>    Thanks for the report.  Should now be fixed in r-devel and
>>>>>> 2.12 patched (rev 53383).
>>>>>>> Please do report any cases where a subclass of environment
>>>>>> doesn't work.  There are some known cases in locking and
>>>>>>> active binding, that will be fixed in due course.
>>>>>>>
>>>>>>> The workaround for any such problem is usually as.environment().
>>>>>>>
>>>>>>> On 10/20/10 3:17 AM, Vitaly S. wrote:
>>>>>>>> Dear Developers,
>>>>>>>>
>>>>>>>> A lot has been changed in the R12.0 with respect to
>>>>>> behavior of "environment"
>>>>>>>> subclasses.  Many thanks for that.
>>>>>>>>
>>>>>>>> One small irregularity, though; new.env does not allow the
>>>>>> parent to be from S4
>>>>>>>> subclass.
>>>>>>>>
>>>>>>>>
>>>>>>>>> setClass("myenv", contains="environment")
>>>>>>>> [1] "myenv"
>>>>>>>>> new.env(parent=new("myenv"))
>>>>>>>> Error in new.env(parent = new("myenv")) : 'enclos' must be
>>>>>> an environment
>>>>>>>> I wonder if this is a "planed" behavior.
>>>>>>>>
>>>>>>>> The use of .xData  slot obviously works:
>>>>>>>>> new.env(parent=new("myenv")@.xData)
>>>>>>>> <environment: 063bb9e8>
>>>>>>>> Thanks,
>>>>>>>> Vitaly.
>>>>>>>>
>>>>>>>> ______________________________________________
>>>>>>>> R-devel at r-project.org mailing list
>>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel>>>  ______________________________________________
>>>>>> R-devel at r-project.org mailing list
>>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel>>>>  ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel>  ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From ligges at statistik.tu-dortmund.de  Sat Oct 23 17:08:35 2010
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Sat, 23 Oct 2010 17:08:35 +0200
Subject: [Rd] new.env does not recognize
	parents	from	subclassesof	"environment"
In-Reply-To: <4CC2FA55.8000207@statistik.tu-dortmund.de>
References: <cpnwrpdgod9.fsf@gmail.com>
	<4CBF2514.8050409@stanford.edu>	<cpnzku71qpq.fsf@gmail.com>	<77EB52C6DD32BA4D87471DCD70C8D7000393EF21@NA-PA-VBE03.na.tibco.com>	<4CC077BC.5050209@stanford.edu>
	<cpnvd4u16vs.fsf@gmail.com>	<4CC1D1EB.1040102@stanford.edu>
	<cpnr5fi0zrv.fsf@gmail.com>
	<4CC2FA55.8000207@statistik.tu-dortmund.de>
Message-ID: <4CC2FA73.7050609@statistik.tu-dortmund.de>



On 23.10.2010 17:08, Uwe Ligges wrote:
> Looks like those ETH pages were nnot updated after the R-2.12.0 release
> (they do not show current R-tached / R-devel), hence CCing Martin Maechler.


... which I actually do now...

Uwe


> Best,
> Uwe Ligges
>
>
>
>
>
> On 22.10.2010 21:54, Vitally S. wrote:
>>
>>
>>
>> John Chambers<jmc4 at stanford.edu> writes:
>>
>>> You need to update your version of R (r-devel or 2.12 patched) to rev
>>> 53385 or later, and read NEWS, particularly the line:
>>>
>>> - Assignment of an environment to functions or as an attribute to other
>>> objects now works for subclasses of "environment".
>>>
>>
>> I am following the news in daily snapshots from here
>> ftp://ftp.stat.math.ethz.ch/Software/R
>> and the above line is still not in the NEWS of today's version.
>>
>> Thanks for the patch. Looking forward to the stable release.
>>
>> Vitally.
>>
>>> On 10/22/10 10:20 AM, Vitally S. wrote:
>>>> Yet another inconsistency. environment<- does not work with S4:
>>>>
>>>>
>>>>> setClass("myenv", contains = "environment")
>>>> [1] "myenv"
>>>>> env<- new("myenv")
>>>>> tf<- function(x){x}
>>>>> environment(tf)<- env
>>>> Error in environment(tf)<- env :
>>>> replacement object is not an environment
>>>>
>>>>
>>>> Vitally.
>>>>
>>>>
>>>> John Chambers<jmc4 at stanford.edu> writes:
>>>>> This is a problem related to the introduction of exact= into the [[
>>>>> and [[<- functions. As Bill says, the
>>> current
>>>>> method misuses eval.parent() when that argument is added.
>>>>>
>>>>> However, a simpler and more efficient solution is to migrate the
>>>>> checks for subclasses of "environment" used in
>>>>> other base code into the code for [[<- (and for $<-), at which
>>>>> point the methods for these functions are no
>>> longer
>>>>> needed.
>>>>>
>>>>> A solution on these lines is being tested now and will find its way
>>>>> into r-devel and 2.12 patched.
>>>>>
>>>>> One other point about the original posting:
>>>>>
>>>>> Please don't use constructions like env at .xData. This depends on the
>>>>> current implementation and is not part of
>>> the
>>>>> user-level definition. Use as(env, "environment") or equivalent.
>>>>> (In this case, the assignment of the object's
>>> own
>>>>> environment was irrelevant to the error.)
>>>>>
>>>>> John Chambers
>>>>>
>>>>> On 10/21/10 9:21 AM, William Dunlap wrote:
>>>>>> The traceback looks very similar to a problem
>>>>>> in R 2.11.1 reported earlier this month by Troy Robertson.
>>>>>> > From: r-devel-bounces at r-project.org
>>>>>> > [mailto:r-devel-bounces at r-project.org] On Behalf Of Troy Robertson
>>>>>> > Sent: Wednesday, October 06, 2010 6:13 PM
>>>>>> > To: 'r-devel at R-project.org'
>>>>>> > Subject: Re: [Rd] Recursion error after upgrade to
>>>>>> > R_2.11.1[Sec=Unclassified]
>>>>>> It was due to a miscount of how many frames to go
>>>>>> up before evaluating an expression in
>>>>>> getMethod("[[<-",".environment") because setMethod()
>>>>>> introduced a local function in the new method.
>>>>>>
>>>>>> Bill Dunlap
>>>>>> Spotfire, TIBCO Software
>>>>>> wdunlap tibco.com
>>>>>>
>>>>>>> -----Original Message-----
>>>>>>> From: r-devel-bounces at r-project.org
>>>>>>> [mailto:r-devel-bounces at r-project.org] On Behalf Of Vitally S.
>>>>>>> Sent: Thursday, October 21, 2010 9:00 AM
>>>>>>> To: John Chambers
>>>>>>> Cc: r-devel at r-project.org
>>>>>>> Subject: Re: [Rd] new.env does not recognize parents from
>>>>>>> subclassesof "environment"
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>> Here is an infinite recursion error which occurs only with S4
>>>>>>> subclasses assignment.
>>>>>>>
>>>>>>> setClass("myenv", contains = "environment")
>>>>>>> #[1] "myenv"
>>>>>>> env<- new("myenv")
>>>>>>> env[[".me"]]<- ?
>>>>>>> #Error: evaluation nested too deeply: infinite recursion /
>>>>>>> options(expressions=)?
>>>>>>>
>>>>>>>
>>>>>>> With basic types it works as expected:
>>>>>>>
>>>>>>> env1<- new.env()
>>>>>>> env1[[".me"]]<- env1
>>>>>>>
>>>>>>> May be this is related to active bindings that you mentioned,
>>>>>>> but I am still
>>>>>>> reporting it here.
>>>>>>>
>>>>>>> Vitally.
>>>>>>>
>>>>>>>
>>>>>>>> Thanks for the report. Should now be fixed in r-devel and
>>>>>>> 2.12 patched (rev 53383).
>>>>>>>> Please do report any cases where a subclass of environment
>>>>>>> doesn't work. There are some known cases in locking and
>>>>>>>> active binding, that will be fixed in due course.
>>>>>>>>
>>>>>>>> The workaround for any such problem is usually as.environment().
>>>>>>>>
>>>>>>>> On 10/20/10 3:17 AM, Vitaly S. wrote:
>>>>>>>>> Dear Developers,
>>>>>>>>>
>>>>>>>>> A lot has been changed in the R12.0 with respect to
>>>>>>> behavior of "environment"
>>>>>>>>> subclasses. Many thanks for that.
>>>>>>>>>
>>>>>>>>> One small irregularity, though; new.env does not allow the
>>>>>>> parent to be from S4
>>>>>>>>> subclass.
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>> setClass("myenv", contains="environment")
>>>>>>>>> [1] "myenv"
>>>>>>>>>> new.env(parent=new("myenv"))
>>>>>>>>> Error in new.env(parent = new("myenv")) : 'enclos' must be
>>>>>>> an environment
>>>>>>>>> I wonder if this is a "planed" behavior.
>>>>>>>>>
>>>>>>>>> The use of .xData slot obviously works:
>>>>>>>>>> new.env(parent=new("myenv")@.xData)
>>>>>>>>> <environment: 063bb9e8>
>>>>>>>>> Thanks,
>>>>>>>>> Vitaly.
>>>>>>>>>
>>>>>>>>> ______________________________________________
>>>>>>>>> R-devel at r-project.org mailing list
>>>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel>>>
>>>>>>>>> ______________________________________________
>>>>>>> R-devel at r-project.org mailing list
>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel>>>>
>>>>>>> ______________________________________________
>>>>> R-devel at r-project.org mailing list
>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel>
>>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel


From maechler at stat.math.ethz.ch  Sat Oct 23 17:25:44 2010
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Sat, 23 Oct 2010 17:25:44 +0200
Subject: [Rd] new.env does not recognize parents from subclassesof
	"environment"
In-Reply-To: <4CC2FA73.7050609@statistik.tu-dortmund.de>
References: <cpnwrpdgod9.fsf@gmail.com> <4CBF2514.8050409@stanford.edu>
	<cpnzku71qpq.fsf@gmail.com>
	<77EB52C6DD32BA4D87471DCD70C8D7000393EF21@NA-PA-VBE03.na.tibco.com>
	<4CC077BC.5050209@stanford.edu> <cpnvd4u16vs.fsf@gmail.com>
	<4CC1D1EB.1040102@stanford.edu> <cpnr5fi0zrv.fsf@gmail.com>
	<4CC2FA55.8000207@statistik.tu-dortmund.de>
	<4CC2FA73.7050609@statistik.tu-dortmund.de>
Message-ID: <AANLkTinzfqSPAzRd0Wc4bYJ=N6DES-c1q=S7ZekCEO_R@mail.gmail.com>

2010/10/23 Uwe Ligges <ligges at statistik.tu-dortmund.de>:
>
>
> On 23.10.2010 17:08, Uwe Ligges wrote:
>>
>> Looks like those ETH pages were nnot updated after the R-2.12.0 release
>> (they do not show current R-tached / R-devel), hence CCing Martin
>> Maechler.
>
>
> ... which I actually do now...

Hmm, but why?
The daily snapshot page *does* show the current R-patched and R-devel
tar balls ?

Or what were you talking about ?

Regards,
Martin

>
> Uwe
>
>
>> Best,
>> Uwe Ligges
>>
>>
>>
>>
>>
>> On 22.10.2010 21:54, Vitally S. wrote:
>>>
>>>
>>>
>>> John Chambers<jmc4 at stanford.edu> writes:
>>>
>>>> You need to update your version of R (r-devel or 2.12 patched) to rev
>>>> 53385 or later, and read NEWS, particularly the line:
>>>>
>>>> - Assignment of an environment to functions or as an attribute to other
>>>> objects now works for subclasses of "environment".
>>>>
>>>
>>> I am following the news in daily snapshots from here
>>> ftp://ftp.stat.math.ethz.ch/Software/R
>>> and the above line is still not in the NEWS of today's version.
>>>
>>> Thanks for the patch. Looking forward to the stable release.
>>>
>>> Vitally.
>>>
>>>> On 10/22/10 10:20 AM, Vitally S. wrote:
>>>>>
>>>>> Yet another inconsistency. environment<- does not work with S4:
>>>>>
>>>>>
>>>>>> setClass("myenv", contains = "environment")
>>>>>
>>>>> [1] "myenv"
>>>>>>
>>>>>> env<- new("myenv")
>>>>>> tf<- function(x){x}
>>>>>> environment(tf)<- env
>>>>>
>>>>> Error in environment(tf)<- env :
>>>>> replacement object is not an environment
>>>>>
>>>>>
>>>>> Vitally.
>>>>>
>>>>>
>>>>> John Chambers<jmc4 at stanford.edu> writes:
>>>>>>
>>>>>> This is a problem related to the introduction of exact= into the [[
>>>>>> and [[<- functions. As Bill says, the
>>>>
>>>> current
>>>>>>
>>>>>> method misuses eval.parent() when that argument is added.
>>>>>>
>>>>>> However, a simpler and more efficient solution is to migrate the
>>>>>> checks for subclasses of "environment" used in
>>>>>> other base code into the code for [[<- (and for $<-), at which
>>>>>> point the methods for these functions are no
>>>>
>>>> longer
>>>>>>
>>>>>> needed.
>>>>>>
>>>>>> A solution on these lines is being tested now and will find its way
>>>>>> into r-devel and 2.12 patched.
>>>>>>
>>>>>> One other point about the original posting:
>>>>>>
>>>>>> Please don't use constructions like env at .xData. This depends on the
>>>>>> current implementation and is not part of
>>>>
>>>> the
>>>>>>
>>>>>> user-level definition. Use as(env, "environment") or equivalent.
>>>>>> (In this case, the assignment of the object's
>>>>
>>>> own
>>>>>>
>>>>>> environment was irrelevant to the error.)
>>>>>>
>>>>>> John Chambers
>>>>>>
>>>>>> On 10/21/10 9:21 AM, William Dunlap wrote:
>>>>>>>
>>>>>>> The traceback looks very similar to a problem
>>>>>>> in R 2.11.1 reported earlier this month by Troy Robertson.
>>>>>>> > From: r-devel-bounces at r-project.org
>>>>>>> > [mailto:r-devel-bounces at r-project.org] On Behalf Of Troy Robertson
>>>>>>> > Sent: Wednesday, October 06, 2010 6:13 PM
>>>>>>> > To: 'r-devel at R-project.org'
>>>>>>> > Subject: Re: [Rd] Recursion error after upgrade to
>>>>>>> > R_2.11.1[Sec=Unclassified]
>>>>>>> It was due to a miscount of how many frames to go
>>>>>>> up before evaluating an expression in
>>>>>>> getMethod("[[<-",".environment") because setMethod()
>>>>>>> introduced a local function in the new method.
>>>>>>>
>>>>>>> Bill Dunlap
>>>>>>> Spotfire, TIBCO Software
>>>>>>> wdunlap tibco.com
>>>>>>>
>>>>>>>> -----Original Message-----
>>>>>>>> From: r-devel-bounces at r-project.org
>>>>>>>> [mailto:r-devel-bounces at r-project.org] On Behalf Of Vitally S.
>>>>>>>> Sent: Thursday, October 21, 2010 9:00 AM
>>>>>>>> To: John Chambers
>>>>>>>> Cc: r-devel at r-project.org
>>>>>>>> Subject: Re: [Rd] new.env does not recognize parents from
>>>>>>>> subclassesof "environment"
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>> Here is an infinite recursion error which occurs only with S4
>>>>>>>> subclasses assignment.
>>>>>>>>
>>>>>>>> setClass("myenv", contains = "environment")
>>>>>>>> #[1] "myenv"
>>>>>>>> env<- new("myenv")
>>>>>>>> env[[".me"]]<- ?
>>>>>>>> #Error: evaluation nested too deeply: infinite recursion /
>>>>>>>> options(expressions=)?
>>>>>>>>
>>>>>>>>
>>>>>>>> With basic types it works as expected:
>>>>>>>>
>>>>>>>> env1<- new.env()
>>>>>>>> env1[[".me"]]<- env1
>>>>>>>>
>>>>>>>> May be this is related to active bindings that you mentioned,
>>>>>>>> but I am still
>>>>>>>> reporting it here.
>>>>>>>>
>>>>>>>> Vitally.
>>>>>>>>
>>>>>>>>
>>>>>>>>> Thanks for the report. Should now be fixed in r-devel and
>>>>>>>>
>>>>>>>> 2.12 patched (rev 53383).
>>>>>>>>>
>>>>>>>>> Please do report any cases where a subclass of environment
>>>>>>>>
>>>>>>>> doesn't work. There are some known cases in locking and
>>>>>>>>>
>>>>>>>>> active binding, that will be fixed in due course.
>>>>>>>>>
>>>>>>>>> The workaround for any such problem is usually as.environment().
>>>>>>>>>
>>>>>>>>> On 10/20/10 3:17 AM, Vitaly S. wrote:
>>>>>>>>>>
>>>>>>>>>> Dear Developers,
>>>>>>>>>>
>>>>>>>>>> A lot has been changed in the R12.0 with respect to
>>>>>>>>
>>>>>>>> behavior of "environment"
>>>>>>>>>>
>>>>>>>>>> subclasses. Many thanks for that.
>>>>>>>>>>
>>>>>>>>>> One small irregularity, though; new.env does not allow the
>>>>>>>>
>>>>>>>> parent to be from S4
>>>>>>>>>>
>>>>>>>>>> subclass.
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>> setClass("myenv", contains="environment")
>>>>>>>>>>
>>>>>>>>>> [1] "myenv"
>>>>>>>>>>>
>>>>>>>>>>> new.env(parent=new("myenv"))
>>>>>>>>>>
>>>>>>>>>> Error in new.env(parent = new("myenv")) : 'enclos' must be
>>>>>>>>
>>>>>>>> an environment
>>>>>>>>>>
>>>>>>>>>> I wonder if this is a "planed" behavior.
>>>>>>>>>>
>>>>>>>>>> The use of .xData slot obviously works:
>>>>>>>>>>>
>>>>>>>>>>> new.env(parent=new("myenv")@.xData)
>>>>>>>>>>
>>>>>>>>>> <environment: 063bb9e8>
>>>>>>>>>> Thanks,
>>>>>>>>>> Vitaly.
>>>>>>>>>>
>>>>>>>>>> ______________________________________________
>>>>>>>>>> R-devel at r-project.org mailing list
>>>>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel>>>
>>>>>>>>>> ______________________________________________
>>>>>>>>
>>>>>>>> R-devel at r-project.org mailing list
>>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel>>>>
>>>>>>>> ______________________________________________
>>>>>>
>>>>>> R-devel at r-project.org mailing list
>>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel>
>>>>>> ______________________________________________
>>>>>
>>>>> R-devel at r-project.org mailing list
>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From ligges at statistik.tu-dortmund.de  Sat Oct 23 17:27:10 2010
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Sat, 23 Oct 2010 17:27:10 +0200
Subject: [Rd] new.env does not recognize parents from subclassesof
	"environment"
In-Reply-To: <AANLkTinzfqSPAzRd0Wc4bYJ=N6DES-c1q=S7ZekCEO_R@mail.gmail.com>
References: <cpnwrpdgod9.fsf@gmail.com>	<4CBF2514.8050409@stanford.edu>	<cpnzku71qpq.fsf@gmail.com>	<77EB52C6DD32BA4D87471DCD70C8D7000393EF21@NA-PA-VBE03.na.tibco.com>	<4CC077BC.5050209@stanford.edu>	<cpnvd4u16vs.fsf@gmail.com>	<4CC1D1EB.1040102@stanford.edu>	<cpnr5fi0zrv.fsf@gmail.com>	<4CC2FA55.8000207@statistik.tu-dortmund.de>	<4CC2FA73.7050609@statistik.tu-dortmund.de>
	<AANLkTinzfqSPAzRd0Wc4bYJ=N6DES-c1q=S7ZekCEO_R@mail.gmail.com>
Message-ID: <4CC2FECE.5080105@statistik.tu-dortmund.de>



On 23.10.2010 17:25, Martin Maechler wrote:
> 2010/10/23 Uwe Ligges<ligges at statistik.tu-dortmund.de>:
>>
>>
>> On 23.10.2010 17:08, Uwe Ligges wrote:
>>>
>>> Looks like those ETH pages were nnot updated after the R-2.12.0 release
>>> (they do not show current R-tached / R-devel), hence CCing Martin
>>> Maechler.
>>
>>
>> ... which I actually do now...
>
> Hmm, but why?
> The daily snapshot page *does* show the current R-patched and R-devel
> tar balls ?
>
> Or what were you talking about ?

We are talking about the

http://stat.ethz.ch/R-manual/

page. R-devel NEWS show R-2.12.0, just as on example.

Uwe




> Regards,
> Martin
>
>>
>> Uwe
>>
>>
>>> Best,
>>> Uwe Ligges
>>>
>>>
>>>
>>>
>>>
>>> On 22.10.2010 21:54, Vitally S. wrote:
>>>>
>>>>
>>>>
>>>> John Chambers<jmc4 at stanford.edu>  writes:
>>>>
>>>>> You need to update your version of R (r-devel or 2.12 patched) to rev
>>>>> 53385 or later, and read NEWS, particularly the line:
>>>>>
>>>>> - Assignment of an environment to functions or as an attribute to other
>>>>> objects now works for subclasses of "environment".
>>>>>
>>>>
>>>> I am following the news in daily snapshots from here
>>>> ftp://ftp.stat.math.ethz.ch/Software/R
>>>> and the above line is still not in the NEWS of today's version.
>>>>
>>>> Thanks for the patch. Looking forward to the stable release.
>>>>
>>>> Vitally.
>>>>
>>>>> On 10/22/10 10:20 AM, Vitally S. wrote:
>>>>>>
>>>>>> Yet another inconsistency. environment<- does not work with S4:
>>>>>>
>>>>>>
>>>>>>> setClass("myenv", contains = "environment")
>>>>>>
>>>>>> [1] "myenv"
>>>>>>>
>>>>>>> env<- new("myenv")
>>>>>>> tf<- function(x){x}
>>>>>>> environment(tf)<- env
>>>>>>
>>>>>> Error in environment(tf)<- env :
>>>>>> replacement object is not an environment
>>>>>>
>>>>>>
>>>>>> Vitally.
>>>>>>
>>>>>>
>>>>>> John Chambers<jmc4 at stanford.edu>  writes:
>>>>>>>
>>>>>>> This is a problem related to the introduction of exact= into the [[
>>>>>>> and [[<- functions. As Bill says, the
>>>>>
>>>>> current
>>>>>>>
>>>>>>> method misuses eval.parent() when that argument is added.
>>>>>>>
>>>>>>> However, a simpler and more efficient solution is to migrate the
>>>>>>> checks for subclasses of "environment" used in
>>>>>>> other base code into the code for [[<- (and for $<-), at which
>>>>>>> point the methods for these functions are no
>>>>>
>>>>> longer
>>>>>>>
>>>>>>> needed.
>>>>>>>
>>>>>>> A solution on these lines is being tested now and will find its way
>>>>>>> into r-devel and 2.12 patched.
>>>>>>>
>>>>>>> One other point about the original posting:
>>>>>>>
>>>>>>> Please don't use constructions like env at .xData. This depends on the
>>>>>>> current implementation and is not part of
>>>>>
>>>>> the
>>>>>>>
>>>>>>> user-level definition. Use as(env, "environment") or equivalent.
>>>>>>> (In this case, the assignment of the object's
>>>>>
>>>>> own
>>>>>>>
>>>>>>> environment was irrelevant to the error.)
>>>>>>>
>>>>>>> John Chambers
>>>>>>>
>>>>>>> On 10/21/10 9:21 AM, William Dunlap wrote:
>>>>>>>>
>>>>>>>> The traceback looks very similar to a problem
>>>>>>>> in R 2.11.1 reported earlier this month by Troy Robertson.
>>>>>>>>> From: r-devel-bounces at r-project.org
>>>>>>>>> [mailto:r-devel-bounces at r-project.org] On Behalf Of Troy Robertson
>>>>>>>>> Sent: Wednesday, October 06, 2010 6:13 PM
>>>>>>>>> To: 'r-devel at R-project.org'
>>>>>>>>> Subject: Re: [Rd] Recursion error after upgrade to
>>>>>>>>> R_2.11.1[Sec=Unclassified]
>>>>>>>> It was due to a miscount of how many frames to go
>>>>>>>> up before evaluating an expression in
>>>>>>>> getMethod("[[<-",".environment") because setMethod()
>>>>>>>> introduced a local function in the new method.
>>>>>>>>
>>>>>>>> Bill Dunlap
>>>>>>>> Spotfire, TIBCO Software
>>>>>>>> wdunlap tibco.com
>>>>>>>>
>>>>>>>>> -----Original Message-----
>>>>>>>>> From: r-devel-bounces at r-project.org
>>>>>>>>> [mailto:r-devel-bounces at r-project.org] On Behalf Of Vitally S.
>>>>>>>>> Sent: Thursday, October 21, 2010 9:00 AM
>>>>>>>>> To: John Chambers
>>>>>>>>> Cc: r-devel at r-project.org
>>>>>>>>> Subject: Re: [Rd] new.env does not recognize parents from
>>>>>>>>> subclassesof "environment"
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>>> Here is an infinite recursion error which occurs only with S4
>>>>>>>>> subclasses assignment.
>>>>>>>>>
>>>>>>>>> setClass("myenv", contains = "environment")
>>>>>>>>> #[1] "myenv"
>>>>>>>>> env<- new("myenv")
>>>>>>>>> env[[".me"]]<- ?
>>>>>>>>> #Error: evaluation nested too deeply: infinite recursion /
>>>>>>>>> options(expressions=)?
>>>>>>>>>
>>>>>>>>>
>>>>>>>>> With basic types it works as expected:
>>>>>>>>>
>>>>>>>>> env1<- new.env()
>>>>>>>>> env1[[".me"]]<- env1
>>>>>>>>>
>>>>>>>>> May be this is related to active bindings that you mentioned,
>>>>>>>>> but I am still
>>>>>>>>> reporting it here.
>>>>>>>>>
>>>>>>>>> Vitally.
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>> Thanks for the report. Should now be fixed in r-devel and
>>>>>>>>>
>>>>>>>>> 2.12 patched (rev 53383).
>>>>>>>>>>
>>>>>>>>>> Please do report any cases where a subclass of environment
>>>>>>>>>
>>>>>>>>> doesn't work. There are some known cases in locking and
>>>>>>>>>>
>>>>>>>>>> active binding, that will be fixed in due course.
>>>>>>>>>>
>>>>>>>>>> The workaround for any such problem is usually as.environment().
>>>>>>>>>>
>>>>>>>>>> On 10/20/10 3:17 AM, Vitaly S. wrote:
>>>>>>>>>>>
>>>>>>>>>>> Dear Developers,
>>>>>>>>>>>
>>>>>>>>>>> A lot has been changed in the R12.0 with respect to
>>>>>>>>>
>>>>>>>>> behavior of "environment"
>>>>>>>>>>>
>>>>>>>>>>> subclasses. Many thanks for that.
>>>>>>>>>>>
>>>>>>>>>>> One small irregularity, though; new.env does not allow the
>>>>>>>>>
>>>>>>>>> parent to be from S4
>>>>>>>>>>>
>>>>>>>>>>> subclass.
>>>>>>>>>>>
>>>>>>>>>>>
>>>>>>>>>>>> setClass("myenv", contains="environment")
>>>>>>>>>>>
>>>>>>>>>>> [1] "myenv"
>>>>>>>>>>>>
>>>>>>>>>>>> new.env(parent=new("myenv"))
>>>>>>>>>>>
>>>>>>>>>>> Error in new.env(parent = new("myenv")) : 'enclos' must be
>>>>>>>>>
>>>>>>>>> an environment
>>>>>>>>>>>
>>>>>>>>>>> I wonder if this is a "planed" behavior.
>>>>>>>>>>>
>>>>>>>>>>> The use of .xData slot obviously works:
>>>>>>>>>>>>
>>>>>>>>>>>> new.env(parent=new("myenv")@.xData)
>>>>>>>>>>>
>>>>>>>>>>> <environment: 063bb9e8>
>>>>>>>>>>> Thanks,
>>>>>>>>>>> Vitaly.
>>>>>>>>>>>
>>>>>>>>>>> ______________________________________________
>>>>>>>>>>> R-devel at r-project.org mailing list
>>>>>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel>>>
>>>>>>>>>>> ______________________________________________
>>>>>>>>>
>>>>>>>>> R-devel at r-project.org mailing list
>>>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel>>>>
>>>>>>>>> ______________________________________________
>>>>>>>
>>>>>>> R-devel at r-project.org mailing list
>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel>
>>>>>>> ______________________________________________
>>>>>>
>>>>>> R-devel at r-project.org mailing list
>>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>>
>>>>> ______________________________________________
>>>>> R-devel at r-project.org mailing list
>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>


From pdalgd at gmail.com  Sat Oct 23 18:23:51 2010
From: pdalgd at gmail.com (Peter Dalgaard)
Date: Sat, 23 Oct 2010 18:23:51 +0200
Subject: [Rd] new.env does not recognize parents from subclassesof
	"environment"
In-Reply-To: <4CC2FECE.5080105@statistik.tu-dortmund.de>
References: <cpnwrpdgod9.fsf@gmail.com>	<4CBF2514.8050409@stanford.edu>	<cpnzku71qpq.fsf@gmail.com>	<77EB52C6DD32BA4D87471DCD70C8D7000393EF21@NA-PA-VBE03.na.tibco.com>	<4CC077BC.5050209@stanford.edu>	<cpnvd4u16vs.fsf@gmail.com>	<4CC1D1EB.1040102@stanford.edu>	<cpnr5fi0zrv.fsf@gmail.com>	<4CC2FA55.8000207@statistik.tu-dortmund.de>	<4CC2FA73.7050609@statistik.tu-dortmund.de>	<AANLkTinzfqSPAzRd0Wc4bYJ=N6DES-c1q=S7ZekCEO_R@mail.gmail.com>
	<4CC2FECE.5080105@statistik.tu-dortmund.de>
Message-ID: <4CC30C17.9090309@gmail.com>

On 10/23/2010 05:27 PM, Uwe Ligges wrote:
> 
> 
> On 23.10.2010 17:25, Martin Maechler wrote:
>> 2010/10/23 Uwe Ligges<ligges at statistik.tu-dortmund.de>:
>>>
>>>
>>> On 23.10.2010 17:08, Uwe Ligges wrote:
>>>>
>>>> Looks like those ETH pages were nnot updated after the R-2.12.0 release
>>>> (they do not show current R-tached / R-devel), hence CCing Martin
>>>> Maechler.
>>>
>>>
>>> ... which I actually do now...
>>
>> Hmm, but why?
>> The daily snapshot page *does* show the current R-patched and R-devel
>> tar balls ?
>>
>> Or what were you talking about ?
> 
> We are talking about the
> 
> http://stat.ethz.ch/R-manual/
> 
> page. R-devel NEWS show R-2.12.0, just as on example.
> 
> Uwe
> 

You need to get NEWS from $BUILDDIR these days. Anything left in $SRCDIR
is probably a relic.

-- 
Peter Dalgaard
Center for Statistics, Copenhagen Business School
Phone: (+45)38153501
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From jmc at r-project.org  Sat Oct 23 19:44:12 2010
From: jmc at r-project.org (John Chambers)
Date: Sat, 23 Oct 2010 10:44:12 -0700
Subject: [Rd] Plans for tighter integration of reference classes in R.
In-Reply-To: <cpn62wt13lf.fsf@gmail.com>
References: <cpn62wt13lf.fsf@gmail.com>
Message-ID: <4CC31EEC.3040700@r-project.org>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20101023/b7003642/attachment.pl>

From maechler at stat.math.ethz.ch  Sat Oct 23 19:53:13 2010
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Sat, 23 Oct 2010 19:53:13 +0200
Subject: [Rd] new.env does not recognize parents from subclassesof
	"environment"
In-Reply-To: <4CC30C17.9090309@gmail.com>
References: <cpnwrpdgod9.fsf@gmail.com> <4CBF2514.8050409@stanford.edu>
	<cpnzku71qpq.fsf@gmail.com>
	<77EB52C6DD32BA4D87471DCD70C8D7000393EF21@NA-PA-VBE03.na.tibco.com>
	<4CC077BC.5050209@stanford.edu> <cpnvd4u16vs.fsf@gmail.com>
	<4CC1D1EB.1040102@stanford.edu> <cpnr5fi0zrv.fsf@gmail.com>
	<4CC2FA55.8000207@statistik.tu-dortmund.de>
	<4CC2FA73.7050609@statistik.tu-dortmund.de>
	<AANLkTinzfqSPAzRd0Wc4bYJ=N6DES-c1q=S7ZekCEO_R@mail.gmail.com>
	<4CC2FECE.5080105@statistik.tu-dortmund.de>
	<4CC30C17.9090309@gmail.com>
Message-ID: <AANLkTimPpzA0jSWee34DiZ5Y2PC2TFA73_VfD6x6p+ME@mail.gmail.com>

On Sat, Oct 23, 2010 at 18:23, Peter Dalgaard <pdalgd at gmail.com> wrote:
> On 10/23/2010 05:27 PM, Uwe Ligges wrote:
>>
>>
>> On 23.10.2010 17:25, Martin Maechler wrote:
>>> 2010/10/23 Uwe Ligges<ligges at statistik.tu-dortmund.de>:
>>>>
>>>>
>>>> On 23.10.2010 17:08, Uwe Ligges wrote:
>>>>>
>>>>> Looks like those ETH pages were nnot updated after the R-2.12.0 release
>>>>> (they do not show current R-tached / R-devel), hence CCing Martin
>>>>> Maechler.
>>>>
>>>>
>>>> ... which I actually do now...
>>>
>>> Hmm, but why?
>>> The daily snapshot page *does* show the current R-patched and R-devel
>>> tar balls ?
>>>
>>> Or what were you talking about ?
>>
>> We are talking about the
>>
>> http://stat.ethz.ch/R-manual/
>>

Thank you Uwe.   The other e-mail cited John mentioning the ./Software/ page.
Indeed those are outdated.

and for about 6 weeks.
The reason has been  ssh host keys changed, disabling a cron job to
run the updates...

I hope this will be ok, within a couple of hours.

>> page. R-devel NEWS show R-2.12.0, just as on example.
>>
>> Uwe
>
> You need to get NEWS from $BUILDDIR these days. Anything left in $SRCDIR
> is probably a relic.

Yes, of course, but that has not been the problem here.

Thank you Peter (and Uwe)
Martin
>
> --
> Peter Dalgaard
> Center for Statistics, Copenhagen Business School
> Phone: (+45)38153501
> Email: pd.mes at cbs.dk ?Priv: PDalgd at gmail.com
>
>


From spinuvit.list at gmail.com  Sun Oct 24 11:53:41 2010
From: spinuvit.list at gmail.com (Vitalie S.)
Date: Sun, 24 Oct 2010 11:53:41 +0200
Subject: [Rd] Plans for tighter integration of reference classes in R.
In-Reply-To: <4CC31EEC.3040700@r-project.org> (John Chambers's message of
	"Sat, 23 Oct 2010 10:44:12 -0700")
References: <cpn62wt13lf.fsf@gmail.com> <4CC31EEC.3040700@r-project.org>
Message-ID: <cpn1v7f29y2.fsf@gmail.com>


Thank you for the answer, John.

John Chambers <jmc at r-project.org> writes:
> Second point first:  The actual environment of a function is tightly 
> bound to low-level implementation at the C level.  Only a _really_ 
> strong practical argument would even tempt us to change that, such as by 
> going away from the requirement that the type of the environment be 
> ENVSXP.

But, how about parent.env() functionality? The "S4" envelope is lost:

> setClass("myenv", contains = "environment")
[1] "myenv"
> env <- new("myenv")
> envp <- new("myenv")
> parent.env(env) <- envp
> parent.env(env)
<environment: 0247a650>

Here I have in mind, as an application, the "prototype" programing paradigm
(akin to JavaScript, also implemented in R's proto package).

If environment manipulation functions would not strip the "S4" envelope from
environments, a considerably wider scope for implementation of "foreign"
programing paradigms would open up. All, by using the "existing techniques"
already available in S4 system.

Proto package makes it possible by using S3 classes, because they are not
striped away. Currently I am struggling to build a prototype based system, similar to
proto,  but in S4 framework. With all the advantages of S4, I am still doubting
that I made a right decision.

Thanks,
Vitalie.

> ... (As mentioned in another thread, one point in favor of 
> reference classes is that they have not messed with internals of R 
> evaluation, just used existing techniques.)
>
> The API  says nothing about what the environment of a reference method 
> is, only that you aren't allowed to use any of the other R tricks that 
> depend on the environment, such as generic functions.
>
> Assigning attributes directly to an environment is a bad idea, as 
> discussed in the past on this list.  That's why we went to the S4 
> mechanism for subclasses of environments.
>
> As for .self, the documentation says that the "entire object can be 
> referred to in a method by the reserved name .self|"|.  That's a bit 
> vague, and it's possible that one could update the slots of .self as 
> part of slot assignment, but absent a serious example, it may be better 
> to just clarify the documentation.
>
> On 10/23/10 5:43 AM, Vitalie S. wrote:
>> Hello Everyone!  Here are a couple of thought/questions on refClasses
>> integration in R core functionality.
>>
>> First, coexistence with S4:
>>
>>> X<- setRefClass("classX", fields = c("a", "b"),
>> +                  representation = list(c = "character"))
>>> x<- X$new()
>>> x at c<- "sss"
>>> x
>> An object of class "classX"
>> <environment: 059bf6a4>
>> Slot "c":
>> [1] "sss"
>>
>> The above is cool, S4 and refClasses apparently live happily together.
>> But,
>>
>>> x$.self
>> An object of class "classX"
>> <environment: 059bf6a4>
>> Slot "c":
>> character(0)
>>
>> This is not a surprise, taking into account the copping paradigm of R.
>> Are there any plans to tighten S4<>refClasses integration? Or it's just not a
>> good idea to mix them as in the above example?
>>
>>
>> Second, R core integration (this bothers me much more):
>>
>>> X$methods(m = function(t) a*t)
>>> environment(x$m)
>> <environment: 059bf6a4>
>>
>> environment(..) does not return the refObject but the basic type. I assume that
>> it is the same with other core functionality. Usage of refObjects as parent.env
>> is also probably precluded in the similar way (don't have a patched R, so can
>> not test yet).
>>
>> Would it be possible, some day, to use refObjects as parent.env or function's
>> environment  without "loosing the class"?
>>
>> Parenthetically, the attributes of an object (including S3 classes) are not lost:
>>
>>> env<- structure(new.env(), a1 = "fdsf", class = "old_class")
>>> tf<- function(x)x
>>> environment(tf)<- env
>>> environment(tf)
>> <environment: 056570a0>
>> attr(,"a1")
>> [1] "fdsf"
>> attr(,"class")
>> [1] "old_class"
>>> class(environment(tf))
>> [1] "old_class"
>> Thanks,
>> Vitalie.
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel>
>
> 	[[alternative HTML version deleted]]


From spinuvit.list at gmail.com  Sun Oct 24 14:35:38 2010
From: spinuvit.list at gmail.com (Vitalie S.)
Date: Sun, 24 Oct 2010 14:35:38 +0200
Subject: [Rd] "$<-" fails (invalid subscript type 'language')
Message-ID: <cpnwrp7zs2t.fsf@gmail.com>


This might be just beyond of my understanding of how assignment works in R, but
the documentation does not say anything about:

> tv <- c(a="dsf", b="sss")
> tl <- list(232)
> `$<-`(tl, tv[[1]], "sdfdsfdsfsd")
Error: invalid subscript type 'language'

This happens even before the method is dispatched. I can not handle the
"name" argument in my S4 method, because it's not even entered.

Thanks,
Vitalie.


From spinuvit.list at gmail.com  Sun Oct 24 15:09:53 2010
From: spinuvit.list at gmail.com (Vitalie S.)
Date: Sun, 24 Oct 2010 15:09:53 +0200
Subject: [Rd] "$<-" fails (invalid subscript type 'language')
References: <cpnwrp7zs2t.fsf@gmail.com>
Message-ID: <cpnsjzvzqhq.fsf@gmail.com>


spinuvit.list at gmail.com (Vitalie S.) writes:
> This might be just beyond of my understanding of how assignment works in R, but
> the documentation does not say anything about:
>
>> tv <- c(a="dsf", b="sss")
>> tl <- list(232)
>> `$<-`(tl, tv[[1]], "sdfdsfdsfsd")
> Error: invalid subscript type 'language'
>

I can partially solve this with do.call, but there is another problem. Quoted
expressions are evaluated during the assignment:

te <- new.env()
> tq <- quote(print("!!!!"))
> do.call("$<-", list(te, "aa", tq))
[1] "!!!!"

This is some weird do.call and $<- interaction. Does not happen with other
functions.

> This happens even before the method is dispatched. I can not handle the
> "name" argument in my S4 method, because it's not even entered.
>
> Thanks,
> Vitalie.


From dwinsemius at comcast.net  Sun Oct 24 15:34:51 2010
From: dwinsemius at comcast.net (David Winsemius)
Date: Sun, 24 Oct 2010 06:34:51 -0700
Subject: [Rd] "$<-" fails (invalid subscript type 'language')
In-Reply-To: <cpnwrp7zs2t.fsf@gmail.com>
References: <cpnwrp7zs2t.fsf@gmail.com>
Message-ID: <FB9D7384-795F-4EB1-8ABE-A1C1BD11977D@comcast.net>


On Oct 24, 2010, at 5:35 AM, Vitalie S. wrote:

>
> This might be just beyond of my understanding of how assignment  
> works in R, but
> the documentation does not say anything about:
>
>> tv <- c(a="dsf", b="sss")
>> tl <- list(232)
>> `$<-`(tl, tv[[1]], "sdfdsfdsfsd")
> Error: invalid subscript type 'language'

Are either of these what you should have done to get what it appears  
you were aiming for but didn't specify?

  `$<-`(tl, "sdfdsfdsfsd", tv[[1]])
# yields
[[1]]
[1] 232

$sdfdsfdsfsd
[1] "dsf"

 > `[<-`(tl, tv[[1]], "sdfdsfdsfsd")
[[1]]
[1] 232

$dsf
[1] "sdfdsfdsfsd"

The "$" operator does not evaluate the index whereas the "[" function  
does. And the documentation is quite clear about that distinction.

-- 
David Winsemius.


>
> This happens even before the method is dispatched. I can not handle  
> the
> "name" argument in my S4 method, because it's not even entered.
>
> Thanks,
> Vitalie.


From jmc at r-project.org  Sun Oct 24 17:54:16 2010
From: jmc at r-project.org (John Chambers)
Date: Sun, 24 Oct 2010 08:54:16 -0700
Subject: [Rd] Plans for tighter integration of reference classes in R.
In-Reply-To: <cpn1v7f29y2.fsf@gmail.com>
References: <cpn62wt13lf.fsf@gmail.com> <4CC31EEC.3040700@r-project.org>
	<cpn1v7f29y2.fsf@gmail.com>
Message-ID: <4CC456A8.1060007@r-project.org>

On 10/24/10 2:53 AM, Vitalie S. wrote:
>
> Thank you for the answer, John.
>
> John Chambers<jmc at r-project.org>  writes:
>> Second point first:  The actual environment of a function is tightly
>> bound to low-level implementation at the C level.  Only a _really_
>> strong practical argument would even tempt us to change that, such as by
>> going away from the requirement that the type of the environment be
>> ENVSXP.
>
> But, how about parent.env() functionality? The "S4" envelope is lost:
>
>> setClass("myenv", contains = "environment")
> [1] "myenv"
>> env<- new("myenv")
>> envp<- new("myenv")
>> parent.env(env)<- envp
>> parent.env(env)
> <environment: 0247a650>

If you're talking about new R code, consider writing methods for 
parent.env() or for environment().

If you mean reprogramming the internals of the evaluator, not a chance 
in the foreseeable future.

>
> Here I have in mind, as an application, the "prototype" programing paradigm
> (akin to JavaScript, also implemented in R's proto package).
>
> If environment manipulation functions would not strip the "S4" envelope from
> environments, a considerably wider scope for implementation of "foreign"
> programing paradigms would open up. All, by using the "existing techniques"
> already available in S4 system.
>
> Proto package makes it possible by using S3 classes, because they are not
> striped away. Currently I am struggling to build a prototype based system, similar to
> proto,  but in S4 framework. With all the advantages of S4, I am still doubting
> that I made a right decision.
>
> Thanks,
> Vitalie.
>
>> ... (As mentioned in another thread, one point in favor of
>> reference classes is that they have not messed with internals of R
>> evaluation, just used existing techniques.)
>>
>> The API  says nothing about what the environment of a reference method
>> is, only that you aren't allowed to use any of the other R tricks that
>> depend on the environment, such as generic functions.
>>
>> Assigning attributes directly to an environment is a bad idea, as
>> discussed in the past on this list.  That's why we went to the S4
>> mechanism for subclasses of environments.
>>
>> As for .self, the documentation says that the "entire object can be
>> referred to in a method by the reserved name .self|"|.  That's a bit
>> vague, and it's possible that one could update the slots of .self as
>> part of slot assignment, but absent a serious example, it may be better
>> to just clarify the documentation.
>>
>> On 10/23/10 5:43 AM, Vitalie S. wrote:
>>> Hello Everyone!  Here are a couple of thought/questions on refClasses
>>> integration in R core functionality.
>>>
>>> First, coexistence with S4:
>>>
>>>> X<- setRefClass("classX", fields = c("a", "b"),
>>> +                  representation = list(c = "character"))
>>>> x<- X$new()
>>>> x at c<- "sss"
>>>> x
>>> An object of class "classX"
>>> <environment: 059bf6a4>
>>> Slot "c":
>>> [1] "sss"
>>>
>>> The above is cool, S4 and refClasses apparently live happily together.
>>> But,
>>>
>>>> x$.self
>>> An object of class "classX"
>>> <environment: 059bf6a4>
>>> Slot "c":
>>> character(0)
>>>
>>> This is not a surprise, taking into account the copping paradigm of R.
>>> Are there any plans to tighten S4<>refClasses integration? Or it's just not a
>>> good idea to mix them as in the above example?
>>>
>>>
>>> Second, R core integration (this bothers me much more):
>>>
>>>> X$methods(m = function(t) a*t)
>>>> environment(x$m)
>>> <environment: 059bf6a4>
>>>
>>> environment(..) does not return the refObject but the basic type. I assume that
>>> it is the same with other core functionality. Usage of refObjects as parent.env
>>> is also probably precluded in the similar way (don't have a patched R, so can
>>> not test yet).
>>>
>>> Would it be possible, some day, to use refObjects as parent.env or function's
>>> environment  without "loosing the class"?
>>>
>>> Parenthetically, the attributes of an object (including S3 classes) are not lost:
>>>
>>>> env<- structure(new.env(), a1 = "fdsf", class = "old_class")
>>>> tf<- function(x)x
>>>> environment(tf)<- env
>>>> environment(tf)
>>> <environment: 056570a0>
>>> attr(,"a1")
>>> [1] "fdsf"
>>> attr(,"class")
>>> [1] "old_class"
>>>> class(environment(tf))
>>> [1] "old_class"
>>> Thanks,
>>> Vitalie.
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel>
>>
>> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From spinuvit.list at gmail.com  Sun Oct 24 22:21:42 2010
From: spinuvit.list at gmail.com (Vitalie S.)
Date: Sun, 24 Oct 2010 22:21:42 +0200
Subject: [Rd] "$<-" fails (invalid subscript type 'language')
In-Reply-To: <FB9D7384-795F-4EB1-8ABE-A1C1BD11977D@comcast.net> (David
	Winsemius's message of "Sun, 24 Oct 2010 06:34:51 -0700")
References: <cpnwrp7zs2t.fsf@gmail.com>
	<FB9D7384-795F-4EB1-8ABE-A1C1BD11977D@comcast.net>
Message-ID: <87fwvv7355.fsf@gmail.com>

David Winsemius <dwinsemius at comcast.net> writes:

> On Oct 24, 2010, at 5:35 AM, Vitalie S. wrote:
>
>>
>> This might be just beyond of my understanding of how assignment works in R, but
>> the documentation does not say anything about:
>>
>>> tv <- c(a="dsf", b="sss")
>>> tl <- list(232)
>>> `$<-`(tl, tv[[1]], "sdfdsfdsfsd")
>> Error: invalid subscript type 'language'
>
> Are either of these what you should have done to get what it appears you were aiming for but didn't specify?
>

I meant what I wrote there. After the assignment, the list tl  should have element 'dsf' with the
value "sdfdsfdsfsd" (sorry for bad names).

>  `$<-`(tl, "sdfdsfdsfsd", tv[[1]])
> # yields
> [[1]]
> [1] 232
>
> $sdfdsfdsfsd
> [1] "dsf"
>
>> `[<-`(tl, tv[[1]], "sdfdsfdsfsd")
> [[1]]
> [1] 232
>
> $dsf
> [1] "sdfdsfdsfsd"
>
> The "$" operator does not evaluate the index whereas the "[" function does. And the documentation is quite clear
> about that distinction.
>

If it is evaluated or not it is hardly an explanation for the error. It throws
the error before the method is even dispatched. If the index (in $'s case the
name) is unevaluated then my methods should get an expression 'tv[[1]]', which I
can then handle.

Example:

setClass("classX", contains="list")
setMethod("$<-", "classX",
          function(x, name, value){
              print("I am here!!")
              x
          })

x <- new("classX")
tv <- c("aa", "bb")
`$<-`(x, tv[[1]], 4343)
#gives
Error: invalid subscript type 'language'


> --
> David Winsemius.
>
>>
>> This happens even before the method is dispatched. I can not handle the
>> "name" argument in my S4 method, because it's not even entered.
>>
>> Thanks,
>> Vitalie.


From spinuvit.list at gmail.com  Sun Oct 24 22:43:18 2010
From: spinuvit.list at gmail.com (Vitalie S.)
Date: Sun, 24 Oct 2010 22:43:18 +0200
Subject: [Rd] Plans for tighter integration of reference classes in R.
In-Reply-To: <4CC456A8.1060007@r-project.org> (John Chambers's message of
	"Sun, 24 Oct 2010 08:54:16 -0700")
References: <cpn62wt13lf.fsf@gmail.com> <4CC31EEC.3040700@r-project.org>
	<cpn1v7f29y2.fsf@gmail.com> <4CC456A8.1060007@r-project.org>
Message-ID: <87bp6j7255.fsf@gmail.com>

John Chambers <jmc at r-project.org> writes:

> On 10/24/10 2:53 AM, Vitalie S. wrote:
>>
>> Thank you for the answer, John.
>>
>> John Chambers<jmc at r-project.org>  writes:
>>> Second point first:  The actual environment of a function is tightly
>>> bound to low-level implementation at the C level.  Only a _really_
>>> strong practical argument would even tempt us to change that, such as by
>>> going away from the requirement that the type of the environment be
>>> ENVSXP.
>>
>> But, how about parent.env() functionality? The "S4" envelope is lost:
>>
>>> setClass("myenv", contains = "environment")
>> [1] "myenv"
>>> env<- new("myenv")
>>> envp<- new("myenv")
>>> parent.env(env)<- envp
>>> parent.env(env)
>> <environment: 0247a650>
>
> If you're talking about new R code, consider writing methods for parent.env() or for environment().
>
> If you mean reprogramming the internals of the evaluator, not a chance in the
> foreseeable future.

Not internals of the  evaluator, the .environment class.
Something like:
  - move the .self into a  super-class of envRefClass (in this case .environment),
  - make the method for `@` for .environment, such that any update of the
  slots of the object will update the .self, making it virtually a mirror of the
  object.
  - make functions like parent.env and environment recognize the .self and
  return it instead of the internal environment object (writing methods would be probably
  quite an overhead).

This way, envRefClass is not affected, and people will have much nicer time in
programming with subclasses of .environment. Particularly I will be writing my
protoRefClasses happily, and not bother to overwrite core functions:)

>
>>
>> Here I have in mind, as an application, the "prototype" programing paradigm
>> (akin to JavaScript, also implemented in R's proto package).
>>
>> If environment manipulation functions would not strip the "S4" envelope from
>> environments, a considerably wider scope for implementation of "foreign"
>> programing paradigms would open up. All, by using the "existing techniques"
>> already available in S4 system.
>>
>> Proto package makes it possible by using S3 classes, because they are not
>> striped away. Currently I am struggling to build a prototype based system, similar to
>> proto,  but in S4 framework. With all the advantages of S4, I am still doubting
>> that I made a right decision.
>>
>> Thanks,
>> Vitalie.
>>
>>> ... (As mentioned in another thread, one point in favor of
>>> reference classes is that they have not messed with internals of R
>>> evaluation, just used existing techniques.)
>>>
>>> The API  says nothing about what the environment of a reference method
>>> is, only that you aren't allowed to use any of the other R tricks that
>>> depend on the environment, such as generic functions.
>>>
>>> Assigning attributes directly to an environment is a bad idea, as
>>> discussed in the past on this list.  That's why we went to the S4
>>> mechanism for subclasses of environments.
>>>
>>> As for .self, the documentation says that the "entire object can be
>>> referred to in a method by the reserved name .self|"|.  That's a bit
>>> vague, and it's possible that one could update the slots of .self as
>>> part of slot assignment, but absent a serious example, it may be better
>>> to just clarify the documentation.
>>>
>>> On 10/23/10 5:43 AM, Vitalie S. wrote:
>>>> Hello Everyone!  Here are a couple of thought/questions on refClasses
>>>> integration in R core functionality.
>>>>
>>>> First, coexistence with S4:
>>>>
>>>>> X<- setRefClass("classX", fields = c("a", "b"),
>>>> +                  representation = list(c = "character"))
>>>>> x<- X$new()
>>>>> x at c<- "sss"
>>>>> x
>>>> An object of class "classX"
>>>> <environment: 059bf6a4>
>>>> Slot "c":
>>>> [1] "sss"
>>>>
>>>> The above is cool, S4 and refClasses apparently live happily together.
>>>> But,
>>>>
>>>>> x$.self
>>>> An object of class "classX"
>>>> <environment: 059bf6a4>
>>>> Slot "c":
>>>> character(0)
>>>>
>>>> This is not a surprise, taking into account the copping paradigm of R.
>>>> Are there any plans to tighten S4<>refClasses integration? Or it's just not a
>>>> good idea to mix them as in the above example?
>>>>
>>>>
>>>> Second, R core integration (this bothers me much more):
>>>>
>>>>> X$methods(m = function(t) a*t)
>>>>> environment(x$m)
>>>> <environment: 059bf6a4>
>>>>
>>>> environment(..) does not return the refObject but the basic type. I assume that
>>>> it is the same with other core functionality. Usage of refObjects as parent.env
>>>> is also probably precluded in the similar way (don't have a patched R, so can
>>>> not test yet).
>>>>
>>>> Would it be possible, some day, to use refObjects as parent.env or function's
>>>> environment  without "loosing the class"?
>>>>
>>>> Parenthetically, the attributes of an object (including S3 classes) are not lost:
>>>>
>>>>> env<- structure(new.env(), a1 = "fdsf", class = "old_class")
>>>>> tf<- function(x)x
>>>>> environment(tf)<- env
>>>>> environment(tf)
>>>> <environment: 056570a0>
>>>> attr(,"a1")
>>>> [1] "fdsf"
>>>> attr(,"class")
>>>> [1] "old_class"
>>>>> class(environment(tf))
>>>> [1] "old_class"
>>>> Thanks,
>>>> Vitalie.
>>>>
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel>>>
>>> 	[[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel>


From mtmorgan at fhcrc.org  Sun Oct 24 22:45:22 2010
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Sun, 24 Oct 2010 13:45:22 -0700
Subject: [Rd] R-devel CMD build fails when vignette present
Message-ID: <4CC49AE2.9050205@fhcrc.org>

If I try to build a package with a vignette

  R CMD build Biobase

I see

* checking for file 'Biobase/DESCRIPTION' ... OK
* preparing 'Biobase':
* checking DESCRIPTION meta-information ... OK
* cleaning src
* installing the package to re-build vignettes
* creating vignettes ... OK
* cleaning src
Error in setwd(pkgname) : cannot change working directory
Execution halted

This is because prepare_pkg invoked at tools/R/build.R:605 changes the
directory (e.g., from /tmp/RtmprGGHhU/Rbuild257d6d93 to
/tmp/RtmprGGHhU/Rbuild257d6d93/Biobase), in turn because the on.exit at
build.R:223 is usurped by on.exit at build.R:256/259.

Martin
-- 
Computational Biology
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N. PO Box 19024 Seattle, WA 98109

Location: M1-B861
Telephone: 206 667-2793


From simon.urbanek at r-project.org  Sun Oct 24 22:47:02 2010
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Sun, 24 Oct 2010 16:47:02 -0400
Subject: [Rd] "$<-" fails (invalid subscript type 'language')
In-Reply-To: <87fwvv7355.fsf@gmail.com>
References: <cpnwrp7zs2t.fsf@gmail.com>
	<FB9D7384-795F-4EB1-8ABE-A1C1BD11977D@comcast.net>
	<87fwvv7355.fsf@gmail.com>
Message-ID: <D5C66B87-3C04-4AD1-9573-FC10DCCFD32B@r-project.org>


On Oct 24, 2010, at 4:21 PM, Vitalie S. wrote:

> David Winsemius <dwinsemius at comcast.net> writes:
> 
>> On Oct 24, 2010, at 5:35 AM, Vitalie S. wrote:
>> 
>>> 
>>> This might be just beyond of my understanding of how assignment works in R, but
>>> the documentation does not say anything about:
>>> 
>>>> tv <- c(a="dsf", b="sss")
>>>> tl <- list(232)
>>>> `$<-`(tl, tv[[1]], "sdfdsfdsfsd")
>>> Error: invalid subscript type 'language'
>> 
>> Are either of these what you should have done to get what it appears you were aiming for but didn't specify?
>> 
> 
> I meant what I wrote there. After the assignment, the list tl  should have element 'dsf' with the
> value "sdfdsfdsfsd" (sorry for bad names).
> 

No, as David pointed out the documentation tells you unmistakably:
"[...] The main difference is that ?$? does not allow computed indices [...]"
so you want to use `[[` instead since `$` is defined exactly to not allow just what you're doing: the index argument must be a symbol or a character vector of length one - anything else is an error as you see.

Cheers,
Simon


>> `$<-`(tl, "sdfdsfdsfsd", tv[[1]])
>> # yields
>> [[1]]
>> [1] 232
>> 
>> $sdfdsfdsfsd
>> [1] "dsf"
>> 
>>> `[<-`(tl, tv[[1]], "sdfdsfdsfsd")
>> [[1]]
>> [1] 232
>> 
>> $dsf
>> [1] "sdfdsfdsfsd"
>> 
>> The "$" operator does not evaluate the index whereas the "[" function does. And the documentation is quite clear
>> about that distinction.
>> 
> 
> If it is evaluated or not it is hardly an explanation for the error. It throws
> the error before the method is even dispatched. If the index (in $'s case the
> name) is unevaluated then my methods should get an expression 'tv[[1]]', which I
> can then handle.
> 
> Example:
> 
> setClass("classX", contains="list")
> setMethod("$<-", "classX",
>          function(x, name, value){
>              print("I am here!!")
>              x
>          })
> 
> x <- new("classX")
> tv <- c("aa", "bb")
> `$<-`(x, tv[[1]], 4343)
> #gives
> Error: invalid subscript type 'language'
> 
> 
>> --
>> David Winsemius.
>> 
>>> 
>>> This happens even before the method is dispatched. I can not handle the
>>> "name" argument in my S4 method, because it's not even entered.
>>> 
>>> Thanks,
>>> Vitalie.
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 


From pdalgd at gmail.com  Sun Oct 24 23:02:52 2010
From: pdalgd at gmail.com (Peter Dalgaard)
Date: Sun, 24 Oct 2010 23:02:52 +0200
Subject: [Rd] "$<-" fails (invalid subscript type 'language')
In-Reply-To: <87fwvv7355.fsf@gmail.com>
References: <cpnwrp7zs2t.fsf@gmail.com>	<FB9D7384-795F-4EB1-8ABE-A1C1BD11977D@comcast.net>
	<87fwvv7355.fsf@gmail.com>
Message-ID: <4CC49EFC.7090801@gmail.com>

On 10/24/2010 10:21 PM, Vitalie S. wrote:
> David Winsemius <dwinsemius at comcast.net> writes:
> 
>> On Oct 24, 2010, at 5:35 AM, Vitalie S. wrote:
>>
>>>
>>> This might be just beyond of my understanding of how assignment works in R, but
>>> the documentation does not say anything about:
>>>
>>>> tv <- c(a="dsf", b="sss")
>>>> tl <- list(232)
>>>> `$<-`(tl, tv[[1]], "sdfdsfdsfsd")
>>> Error: invalid subscript type 'language'
>>
>> Are either of these what you should have done to get what it appears you were aiming for but didn't specify?
>>
> 
> I meant what I wrote there. After the assignment, the list tl  should have element 'dsf' with the
> value "sdfdsfdsfsd" (sorry for bad names).
> 
>>  `$<-`(tl, "sdfdsfdsfsd", tv[[1]])
>> # yields
>> [[1]]
>> [1] 232
>>
>> $sdfdsfdsfsd
>> [1] "dsf"
>>
>>> `[<-`(tl, tv[[1]], "sdfdsfdsfsd")
>> [[1]]
>> [1] 232
>>
>> $dsf
>> [1] "sdfdsfdsfsd"
>>
>> The "$" operator does not evaluate the index whereas the "[" function does. And the documentation is quite clear
>> about that distinction.
>>
> 
> If it is evaluated or not it is hardly an explanation for the error. It throws
> the error before the method is even dispatched. If the index (in $'s case the
> name) is unevaluated then my methods should get an expression 'tv[[1]]', which I
> can then handle.
> 
> Example:
> 
> setClass("classX", contains="list")
> setMethod("$<-", "classX",
>           function(x, name, value){
>               print("I am here!!")
>               x
>           })
> 
> x <- new("classX")
> tv <- c("aa", "bb")
> `$<-`(x, tv[[1]], 4343)
> #gives
> Error: invalid subscript type 'language'
> 
> 
>> --
>> David Winsemius.
>>
>>>
>>> This happens even before the method is dispatched. I can not handle the
>>> "name" argument in my S4 method, because it's not even entered.

There are some things you are not really supposed to mess with in R...
Computing the index to $-constructs is one of them (trying to set up a
for loop as a call to `for` is another). It can be done, it's just
rather painful, and most likely not what you wanted in the first place.

The second argument to `$` and `$<-` is passed unevaluated and expected
to be of mode "name" (i.e., a symbol). Trying to compute it inline is
going to pass an unevaluated expression, which has mode "language".

If you insist, you can do things like

eval(bquote(`$<-`(x, .(as.name(tv[[1]])), 4343)))

or similar constructs using substitute().

However, the whole situation suggests that you are really looking for
methods for "[[<-".



-- 
Peter Dalgaard
Center for Statistics, Copenhagen Business School
Phone: (+45)38153501
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From jmc at r-project.org  Sun Oct 24 23:42:39 2010
From: jmc at r-project.org (John Chambers)
Date: Sun, 24 Oct 2010 14:42:39 -0700
Subject: [Rd] Plans for tighter integration of reference classes in R.
In-Reply-To: <87bp6j7255.fsf@gmail.com>
References: <cpn62wt13lf.fsf@gmail.com>
	<4CC31EEC.3040700@r-project.org>	<cpn1v7f29y2.fsf@gmail.com>
	<4CC456A8.1060007@r-project.org> <87bp6j7255.fsf@gmail.com>
Message-ID: <4CC4A84F.8000403@r-project.org>



On 10/24/10 1:43 PM, Vitalie S. wrote:
> John Chambers<jmc at r-project.org>  writes:
>
>> On 10/24/10 2:53 AM, Vitalie S. wrote:
>>>
>>> Thank you for the answer, John.
>>>
>>> John Chambers<jmc at r-project.org>   writes:
>>>> Second point first:  The actual environment of a function is tightly
>>>> bound to low-level implementation at the C level.  Only a _really_
>>>> strong practical argument would even tempt us to change that, such as by
>>>> going away from the requirement that the type of the environment be
>>>> ENVSXP.
>>>
>>> But, how about parent.env() functionality? The "S4" envelope is lost:
>>>
>>>> setClass("myenv", contains = "environment")
>>> [1] "myenv"
>>>> env<- new("myenv")
>>>> envp<- new("myenv")
>>>> parent.env(env)<- envp
>>>> parent.env(env)
>>> <environment: 0247a650>
>>
>> If you're talking about new R code, consider writing methods for parent.env() or for environment().
>>
>> If you mean reprogramming the internals of the evaluator, not a chance in the
>> foreseeable future.
>
> Not internals of the  evaluator, the .environment class.
> Something like:
>    - move the .self into a  super-class of envRefClass (in this case .environment),
>    - make the method for `@` for .environment, such that any update of the
>    slots of the object will update the .self, making it virtually a mirror of the
>    object.
>    - make functions like parent.env and environment recognize the .self and
>    return it instead of the internal environment object (writing methods would be probably
>    quite an overhead).

I'm sorry, this is not likely to happen soon, if you expect the core 
developers to do it for you.  If you want to implement something like 
you suggest via methods for your classes and find it works well, we can 
consider implementing related code for the core .environment class.

Whether you think the overhead of _writing_ the methods is large or not, 
the way such development in R works best is that those interested in new 
features implement them; particularly useful or attractive features may 
be absorbed into the core later if that makes sense.

Meanwhile, the overhead of _using_ methods for these functions (i.e., 
the need to dispatch methods for the newly generic functions) will not 
be passed on to other applications that subclass environment.



>
> This way, envRefClass is not affected, and people will have much nicer time in
> programming with subclasses of .environment. Particularly I will be writing my
> protoRefClasses happily, and not bother to overwrite core functions:)
>
>>
>>>
>>> Here I have in mind, as an application, the "prototype" programing paradigm
>>> (akin to JavaScript, also implemented in R's proto package).
>>>
>>> If environment manipulation functions would not strip the "S4" envelope from
>>> environments, a considerably wider scope for implementation of "foreign"
>>> programing paradigms would open up. All, by using the "existing techniques"
>>> already available in S4 system.
>>>
>>> Proto package makes it possible by using S3 classes, because they are not
>>> striped away. Currently I am struggling to build a prototype based system, similar to
>>> proto,  but in S4 framework. With all the advantages of S4, I am still doubting
>>> that I made a right decision.
>>>
>>> Thanks,
>>> Vitalie.
>>>
>>>> ... (As mentioned in another thread, one point in favor of
>>>> reference classes is that they have not messed with internals of R
>>>> evaluation, just used existing techniques.)
>>>>
>>>> The API  says nothing about what the environment of a reference method
>>>> is, only that you aren't allowed to use any of the other R tricks that
>>>> depend on the environment, such as generic functions.
>>>>
>>>> Assigning attributes directly to an environment is a bad idea, as
>>>> discussed in the past on this list.  That's why we went to the S4
>>>> mechanism for subclasses of environments.
>>>>
>>>> As for .self, the documentation says that the "entire object can be
>>>> referred to in a method by the reserved name .self|"|.  That's a bit
>>>> vague, and it's possible that one could update the slots of .self as
>>>> part of slot assignment, but absent a serious example, it may be better
>>>> to just clarify the documentation.
>>>>
>>>> On 10/23/10 5:43 AM, Vitalie S. wrote:
>>>>> Hello Everyone!  Here are a couple of thought/questions on refClasses
>>>>> integration in R core functionality.
>>>>>
>>>>> First, coexistence with S4:
>>>>>
>>>>>> X<- setRefClass("classX", fields = c("a", "b"),
>>>>> +                  representation = list(c = "character"))
>>>>>> x<- X$new()
>>>>>> x at c<- "sss"
>>>>>> x
>>>>> An object of class "classX"
>>>>> <environment: 059bf6a4>
>>>>> Slot "c":
>>>>> [1] "sss"
>>>>>
>>>>> The above is cool, S4 and refClasses apparently live happily together.
>>>>> But,
>>>>>
>>>>>> x$.self
>>>>> An object of class "classX"
>>>>> <environment: 059bf6a4>
>>>>> Slot "c":
>>>>> character(0)
>>>>>
>>>>> This is not a surprise, taking into account the copping paradigm of R.
>>>>> Are there any plans to tighten S4<>refClasses integration? Or it's just not a
>>>>> good idea to mix them as in the above example?
>>>>>
>>>>>
>>>>> Second, R core integration (this bothers me much more):
>>>>>
>>>>>> X$methods(m = function(t) a*t)
>>>>>> environment(x$m)
>>>>> <environment: 059bf6a4>
>>>>>
>>>>> environment(..) does not return the refObject but the basic type. I assume that
>>>>> it is the same with other core functionality. Usage of refObjects as parent.env
>>>>> is also probably precluded in the similar way (don't have a patched R, so can
>>>>> not test yet).
>>>>>
>>>>> Would it be possible, some day, to use refObjects as parent.env or function's
>>>>> environment  without "loosing the class"?
>>>>>
>>>>> Parenthetically, the attributes of an object (including S3 classes) are not lost:
>>>>>
>>>>>> env<- structure(new.env(), a1 = "fdsf", class = "old_class")
>>>>>> tf<- function(x)x
>>>>>> environment(tf)<- env
>>>>>> environment(tf)
>>>>> <environment: 056570a0>
>>>>> attr(,"a1")
>>>>> [1] "fdsf"
>>>>> attr(,"class")
>>>>> [1] "old_class"
>>>>>> class(environment(tf))
>>>>> [1] "old_class"
>>>>> Thanks,
>>>>> Vitalie.
>>>>>
>>>>> ______________________________________________
>>>>> R-devel at r-project.org mailing list
>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel>>>
>>>> 	[[alternative HTML version deleted]]
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From alex at bedatadriven.com  Mon Oct 25 04:53:27 2010
From: alex at bedatadriven.com (Bertram, Alexander)
Date: Mon, 25 Oct 2010 04:53:27 +0200
Subject: [Rd] R on the JVM, anyone else interested in joining?
Message-ID: <AANLkTinS1A444KH84OnqrMHoe15TLuaghYBvdCu0uSHD@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20101025/b1f0b1e1/attachment.pl>

From spinuvit.list at gmail.com  Mon Oct 25 09:45:40 2010
From: spinuvit.list at gmail.com (Vitalie S.)
Date: Mon, 25 Oct 2010 09:45:40 +0200
Subject: [Rd] "$<-" fails (invalid subscript type 'language')
In-Reply-To: <4CC49EFC.7090801@gmail.com> (Peter Dalgaard's message of "Sun,
	24 Oct 2010 23:02:52 +0200")
References: <cpnwrp7zs2t.fsf@gmail.com>
	<FB9D7384-795F-4EB1-8ABE-A1C1BD11977D@comcast.net>
	<87fwvv7355.fsf@gmail.com> <4CC49EFC.7090801@gmail.com>
Message-ID: <874oca7m1n.fsf@gmail.com>


> There are some things you are not really supposed to mess with in R...
> Computing the index to $-constructs is one of them (trying to set up a
> for loop as a call to `for` is another). It can be done, it's just
> rather painful, and most likely not what you wanted in the first place.
>
Sorry, I was somewhat sloppy and in imprecise. For my class, I really need `$` to behave
as usually [[ behaves in R. So to say, to evaluate the "name" argument.  To be
short, my "$" is part of an user interface (lots of checks, very slow), [[ and
[  are left unattached and are part of "programing" interface for  my classes.

There are not to many symbols in R to use as accessors of the internals of
the objects. Wouldn't  it be natural that the programmer to decide
how to implement his "$" for himself?

> The second argument to `$` and `$<-` is passed unevaluated and expected
> to be of mode "name" (i.e., a symbol). Trying to compute it inline is
> going to pass an unevaluated expression, which has mode "language".
>

I would expect the following to behave identically:

> tv <- c(a="dsf", b="sss")
> tl <- list(232)

> `$<-`(tl, tv[[1]], "sdfdsfdsfsd")
Error: invalid subscript type 'language'

> tl$`tv[[1]]` <- "sdfdsfdsfsd"
> tl
[[1]]
[1] 232

$`tv[[1]]`
[1] "sdfdsfdsfsd"

So what is relay going on? In one case the name is expected, in another case any
"language" object would work?


> If you insist, you can do things like
>
> eval(bquote(`$<-`(x, .(as.name(tv[[1]])), 4343)))
>
> or similar constructs using substitute().
>
> However, the whole situation suggests that you are really looking for
> methods for "[[<-".


From spinuvit.list at gmail.com  Mon Oct 25 09:51:03 2010
From: spinuvit.list at gmail.com (Vitalie S.)
Date: Mon, 25 Oct 2010 09:51:03 +0200
Subject: [Rd] "$<-" fails (invalid subscript type 'language')
In-Reply-To: <D5C66B87-3C04-4AD1-9573-FC10DCCFD32B@r-project.org> (Simon
	Urbanek's message of "Sun, 24 Oct 2010 16:47:02 -0400")
References: <cpnwrp7zs2t.fsf@gmail.com>
	<FB9D7384-795F-4EB1-8ABE-A1C1BD11977D@comcast.net>
	<87fwvv7355.fsf@gmail.com>
	<D5C66B87-3C04-4AD1-9573-FC10DCCFD32B@r-project.org>
Message-ID: <87zku26788.fsf@gmail.com>

Simon Urbanek <simon.urbanek at r-project.org> writes:

> On Oct 24, 2010, at 4:21 PM, Vitalie S. wrote:
>
>> David Winsemius <dwinsemius at comcast.net> writes:
>> 
>>> On Oct 24, 2010, at 5:35 AM, Vitalie S. wrote:
>>> 
>>>> 
>>>> This might be just beyond of my understanding of how assignment works in R, but
>>>> the documentation does not say anything about:
>>>> 
>>>>> tv <- c(a="dsf", b="sss")
>>>>> tl <- list(232)
>>>>> `$<-`(tl, tv[[1]], "sdfdsfdsfsd")
>>>> Error: invalid subscript type 'language'
>>> 
>>> Are either of these what you should have done to get what it appears you were aiming for but didn't specify?
>>> 
>> 
>> I meant what I wrote there. After the assignment, the list tl  should have element 'dsf' with the
>> value "sdfdsfdsfsd" (sorry for bad names).
>> 
>
> No, as David pointed out the documentation tells you unmistakably:
> "[...] The main difference is that ?$? does not allow computed indices [...]"
> so you want to use `[[` instead since `$` is defined exactly to not allow just what you're doing: the index
> argument must be a symbol or a character vector of length one - anything else is an error as you see.
>

Oh,  that was really stupid from my part. I meant that functionality for my
specific class, not for lists of course.

For list I would expect, 

`$<-`(tl, tv[[1]], "sdfdsfdsfsd")
 tl$`tv[[1]]` <- "sdfdsfdsfsd"

to give the same result.

I just gave this artificial example with lists to illustrate the error. Didn't
want to bring the definition of my classes here.

Vitalie.

> Cheers,
> Simon
>
>>> `$<-`(tl, "sdfdsfdsfsd", tv[[1]])
>>> # yields
>>> [[1]]
>>> [1] 232
>>> 
>>> $sdfdsfdsfsd
>>> [1] "dsf"
>>> 
>>>> `[<-`(tl, tv[[1]], "sdfdsfdsfsd")
>>> [[1]]
>>> [1] 232
>>> 
>>> $dsf
>>> [1] "sdfdsfdsfsd"
>>> 
>>> The "$" operator does not evaluate the index whereas the "[" function does. And the documentation is quite clear
>>> about that distinction.
>>> 
>> 
>> If it is evaluated or not it is hardly an explanation for the error. It throws
>> the error before the method is even dispatched. If the index (in $'s case the
>> name) is unevaluated then my methods should get an expression 'tv[[1]]', which I
>> can then handle.
>> 
>> Example:
>> 
>> setClass("classX", contains="list")
>> setMethod("$<-", "classX",
>>          function(x, name, value){
>>              print("I am here!!")
>>              x
>>          })
>> 
>> x <- new("classX")
>> tv <- c("aa", "bb")
>> `$<-`(x, tv[[1]], 4343)
>> #gives
>> Error: invalid subscript type 'language'
>> 
>> 
>>> --
>>> David Winsemius.
>>> 
>>>> 
>>>> This happens even before the method is dispatched. I can not handle the
>>>> "name" argument in my S4 method, because it's not even entered.
>>>> 
>>>> Thanks,
>>>> Vitalie.
>> 
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel> 
>> 


From spinuvit.list at gmail.com  Mon Oct 25 10:03:46 2010
From: spinuvit.list at gmail.com (Vitalie S.)
Date: Mon, 25 Oct 2010 10:03:46 +0200
Subject: [Rd] Plans for tighter integration of reference classes in R.
References: <cpn62wt13lf.fsf@gmail.com> <4CC31EEC.3040700@r-project.org>
	<cpn1v7f29y2.fsf@gmail.com> <4CC456A8.1060007@r-project.org>
	<87bp6j7255.fsf@gmail.com> <4CC4A84F.8000403@r-project.org>
Message-ID: <87vd4q66n1.fsf@gmail.com>


John Chambers <jmc at r-project.org> writes:
>>
>> Not internals of the  evaluator, the .environment class.
>> Something like:
>>    - move the .self into a  super-class of envRefClass (in this case .environment),
>>    - make the method for `@` for .environment, such that any update of the
>>    slots of the object will update the .self, making it virtually a mirror of the
>>    object.
>>    - make functions like parent.env and environment recognize the .self and
>>    return it instead of the internal environment object (writing methods would be probably
>>    quite an overhead).
>
> I'm sorry, this is not likely to happen soon, if you expect the core developers to do it for you.  If you want to
> implement something like you suggest via methods for your classes and find it works well, we can consider
> implementing related code for the core .environment class.
>
> Whether you think the overhead of _writing_ the methods is large or not, the way such development in R works best
> is that those interested in new features implement them; particularly useful or attractive features may be absorbed
> into the core later if that makes sense.
>
> Meanwhile, the overhead of _using_ methods for these functions (i.e., the need to dispatch methods for the newly
> generic functions) will not be passed on to other applications that subclass environment.
>
 :))
 I was so enthusiastic about the idea that  _using_ and  _writing_ had the
 same meaning for me. Of course I meant _using_ there. Writing should be easy.

 Thanks,
 Vitalie.


From ripley at stats.ox.ac.uk  Mon Oct 25 12:21:36 2010
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 25 Oct 2010 11:21:36 +0100 (BST)
Subject: [Rd] R-devel CMD build fails when vignette present
In-Reply-To: <4CC49AE2.9050205@fhcrc.org>
References: <4CC49AE2.9050205@fhcrc.org>
Message-ID: <alpine.LFD.2.00.1010251120190.1811@gannet.stats.ox.ac.uk>

Biobase is not self-contained so I cannot easily test it, but as far 
as I know this is now resolved.

On Sun, 24 Oct 2010, Martin Morgan wrote:

> If I try to build a package with a vignette
>
>  R CMD build Biobase
>
> I see
>
> * checking for file 'Biobase/DESCRIPTION' ... OK
> * preparing 'Biobase':
> * checking DESCRIPTION meta-information ... OK
> * cleaning src
> * installing the package to re-build vignettes
> * creating vignettes ... OK
> * cleaning src
> Error in setwd(pkgname) : cannot change working directory
> Execution halted
>
> This is because prepare_pkg invoked at tools/R/build.R:605 changes the
> directory (e.g., from /tmp/RtmprGGHhU/Rbuild257d6d93 to
> /tmp/RtmprGGHhU/Rbuild257d6d93/Biobase), in turn because the on.exit at
> build.R:223 is usurped by on.exit at build.R:256/259.
>
> Martin
> -- 
> Computational Biology
> Fred Hutchinson Cancer Research Center
> 1100 Fairview Ave. N. PO Box 19024 Seattle, WA 98109
>
> Location: M1-B861
> Telephone: 206 667-2793
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From mtmorgan at fhcrc.org  Mon Oct 25 13:36:10 2010
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Mon, 25 Oct 2010 04:36:10 -0700
Subject: [Rd] R-devel CMD build fails when vignette present
In-Reply-To: <alpine.LFD.2.00.1010251120190.1811@gannet.stats.ox.ac.uk>
References: <4CC49AE2.9050205@fhcrc.org>
	<alpine.LFD.2.00.1010251120190.1811@gannet.stats.ox.ac.uk>
Message-ID: <4CC56BAA.8030208@fhcrc.org>

On 10/25/2010 03:21 AM, Prof Brian Ripley wrote:
> Biobase is not self-contained so I cannot easily test it, but as far as
> I know this is now resolved.

Thank you it is. Martin

> 
> On Sun, 24 Oct 2010, Martin Morgan wrote:
> 
>> If I try to build a package with a vignette
>>
>>  R CMD build Biobase
>>
>> I see
>>
>> * checking for file 'Biobase/DESCRIPTION' ... OK
>> * preparing 'Biobase':
>> * checking DESCRIPTION meta-information ... OK
>> * cleaning src
>> * installing the package to re-build vignettes
>> * creating vignettes ... OK
>> * cleaning src
>> Error in setwd(pkgname) : cannot change working directory
>> Execution halted
>>
>> This is because prepare_pkg invoked at tools/R/build.R:605 changes the
>> directory (e.g., from /tmp/RtmprGGHhU/Rbuild257d6d93 to
>> /tmp/RtmprGGHhU/Rbuild257d6d93/Biobase), in turn because the on.exit at
>> build.R:223 is usurped by on.exit at build.R:256/259.
>>
>> Martin
>> -- 
>> Computational Biology
>> Fred Hutchinson Cancer Research Center
>> 1100 Fairview Ave. N. PO Box 19024 Seattle, WA 98109
>>
>> Location: M1-B861
>> Telephone: 206 667-2793
>>
> 


-- 
Computational Biology
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N. PO Box 19024 Seattle, WA 98109

Location: M1-B861
Telephone: 206 667-2793


From spinuvit.list at gmail.com  Mon Oct 25 14:14:18 2010
From: spinuvit.list at gmail.com (Vitalie S.)
Date: Mon, 25 Oct 2010 14:14:18 +0200
Subject: [Rd] "$<-" fails (invalid subscript type 'language')
References: <cpnwrp7zs2t.fsf@gmail.com>
	<FB9D7384-795F-4EB1-8ABE-A1C1BD11977D@comcast.net>
	<87fwvv7355.fsf@gmail.com> <4CC49EFC.7090801@gmail.com>
	<874oca7m1n.fsf@gmail.com>
Message-ID: <cpnlj5mzcyt.fsf@gmail.com>

spinuvit.list at gmail.com (Vitalie S.) writes:

>
> I would expect the following to behave identically:
>
>> tv <- c(a="dsf", b="sss")
>> tl <- list(232)
>
>> `$<-`(tl, tv[[1]], "sdfdsfdsfsd")
> Error: invalid subscript type 'language'
>
>> tl$`tv[[1]]` <- "sdfdsfdsfsd"
>> tl
> [[1]]
> [1] 232
>
> $`tv[[1]]`
> [1] "sdfdsfdsfsd"
>
> So what is relay going on? In one case the name is expected, in another case any
> "language" object would work?


>
>> If you insist, you can do things like
>>
>> eval(bquote(`$<-`(x, .(as.name(tv[[1]])), 4343)))
>>
>> or similar constructs using substitute().
>>
>> However, the whole situation suggests that you are really looking for
>> methods for "[[<-".

Yap, I see now, `tv[[1]]` is a name. So no contradiction.

To conclude, only the symbol is allowed as index and I can not do absolutely
anything to make my custom "$" "smarter":(.

Thanks everyone for helping me filter some noise in my head.


From simon.urbanek at r-project.org  Mon Oct 25 15:00:35 2010
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Mon, 25 Oct 2010 09:00:35 -0400
Subject: [Rd] "$<-" fails (invalid subscript type 'language')
In-Reply-To: <87zku26788.fsf@gmail.com>
References: <cpnwrp7zs2t.fsf@gmail.com>
	<FB9D7384-795F-4EB1-8ABE-A1C1BD11977D@comcast.net>
	<87fwvv7355.fsf@gmail.com>
	<D5C66B87-3C04-4AD1-9573-FC10DCCFD32B@r-project.org>
	<87zku26788.fsf@gmail.com>
Message-ID: <6F3C1489-1DB9-4C14-A4E3-67117602F93B@r-project.org>


On Oct 25, 2010, at 3:51 AM, Vitalie S. wrote:

> Simon Urbanek <simon.urbanek at r-project.org> writes:
> 
>> On Oct 24, 2010, at 4:21 PM, Vitalie S. wrote:
>> 
>>> David Winsemius <dwinsemius at comcast.net> writes:
>>> 
>>>> On Oct 24, 2010, at 5:35 AM, Vitalie S. wrote:
>>>> 
>>>>> 
>>>>> This might be just beyond of my understanding of how assignment works in R, but
>>>>> the documentation does not say anything about:
>>>>> 
>>>>>> tv <- c(a="dsf", b="sss")
>>>>>> tl <- list(232)
>>>>>> `$<-`(tl, tv[[1]], "sdfdsfdsfsd")
>>>>> Error: invalid subscript type 'language'
>>>> 
>>>> Are either of these what you should have done to get what it appears you were aiming for but didn't specify?
>>>> 
>>> 
>>> I meant what I wrote there. After the assignment, the list tl  should have element 'dsf' with the
>>> value "sdfdsfdsfsd" (sorry for bad names).
>>> 
>> 
>> No, as David pointed out the documentation tells you unmistakably:
>> "[...] The main difference is that ?$? does not allow computed indices [...]"
>> so you want to use `[[` instead since `$` is defined exactly to not allow just what you're doing: the index
>> argument must be a symbol or a character vector of length one - anything else is an error as you see.
>> 
> 
> Oh,  that was really stupid from my part. I meant that functionality for my
> specific class, not for lists of course.
> 
> For list I would expect, 
> 
> `$<-`(tl, tv[[1]], "sdfdsfdsfsd")
> tl$`tv[[1]]` <- "sdfdsfdsfsd"
> 
> to give the same result.
> 

Nope, you're passing different arguments - to make them equivalent you have to use

`$<-`(tl, `tv[[1]]`, "sdfdsfdsfsd")

which works -- you need to quote the symbol in both cases not just one ;).

Cheers,
Simon



> I just gave this artificial example with lists to illustrate the error. Didn't
> want to bring the definition of my classes here.
> 
> Vitalie.
> 
>> Cheers,
>> Simon
>> 
>>>> `$<-`(tl, "sdfdsfdsfsd", tv[[1]])
>>>> # yields
>>>> [[1]]
>>>> [1] 232
>>>> 
>>>> $sdfdsfdsfsd
>>>> [1] "dsf"
>>>> 
>>>>> `[<-`(tl, tv[[1]], "sdfdsfdsfsd")
>>>> [[1]]
>>>> [1] 232
>>>> 
>>>> $dsf
>>>> [1] "sdfdsfdsfsd"
>>>> 
>>>> The "$" operator does not evaluate the index whereas the "[" function does. And the documentation is quite clear
>>>> about that distinction.
>>>> 
>>> 
>>> If it is evaluated or not it is hardly an explanation for the error. It throws
>>> the error before the method is even dispatched. If the index (in $'s case the
>>> name) is unevaluated then my methods should get an expression 'tv[[1]]', which I
>>> can then handle.
>>> 
>>> Example:
>>> 
>>> setClass("classX", contains="list")
>>> setMethod("$<-", "classX",
>>>         function(x, name, value){
>>>             print("I am here!!")
>>>             x
>>>         })
>>> 
>>> x <- new("classX")
>>> tv <- c("aa", "bb")
>>> `$<-`(x, tv[[1]], 4343)
>>> #gives
>>> Error: invalid subscript type 'language'
>>> 
>>> 
>>>> --
>>>> David Winsemius.
>>>> 
>>>>> 
>>>>> This happens even before the method is dispatched. I can not handle the
>>>>> "name" argument in my S4 method, because it's not even entered.
>>>>> 
>>>>> Thanks,
>>>>> Vitalie.
>>> 
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel> 
>>> 
> 
> 


From gchappi at gmail.com  Mon Oct 25 16:01:04 2010
From: gchappi at gmail.com (Hans-Peter Suter)
Date: Mon, 25 Oct 2010 16:01:04 +0200
Subject: [Rd] Possible bug with scrambled messages on Win7-64bit using
 R2.12.0 (32/64 bit version)
Message-ID: <AANLkTikC8kd+fq=Y8g_vK2H=rDrKz9Pki5=tsttK1BMi@mail.gmail.com>

When executing 'dyn.load("this/dll/does/not/exist.dll")' the resulting
error message is scrambled. Not all characters will be displayed and
when I select the empty region text disappears/reappears.

For a screenshot see:
http://dl.dropbox.com/u/2602516/dyn.load_error1.PNG and
http://dl.dropbox.com/u/2602516/dyn.load_error2.PNG.

Note: I had the same problem with xlsReadWrite startup messages with
R2.12.0. The solution was to replace my 'CRLF' (windows) line endings
with 'LF' (unix). While debugging the issue, I noticed that the
problem only occurs on my Win7-64bit platform but not on WinXP-32bit.

Cheers,
Hans-Peter

> dyn.load("this/dll/does/not/exist.dll")
Error in inDL(x, as.logical(local), as.logical(now), ...) :
  unable to load shared object 'C:/Program
Files/R/R-2.12.0/bin/i386/this/dll/does/not/exist.dll':
  LoadLibrary failure:  Das angegebene Modul wurde nicht gefunden.
<--- THIS LINE DOES NOT SHOW IN RGUI

> sessionInfo()
R version 2.12.0 (2010-10-15)
Platform: i386-pc-mingw32/i386 (32-bit)

locale:
[1] LC_COLLATE=German_Switzerland.1252  LC_CTYPE=German_Switzerland.1252
[3] LC_MONETARY=German_Switzerland.1252 LC_NUMERIC=C
[5] LC_TIME=German_Switzerland.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base
> Sys.getlocale()
[1] "LC_COLLATE=German_Switzerland.1252;LC_CTYPE=German_Switzerland.1252;LC_MONETARY=German_Switzerland.1252;LC_NUMERIC=C;LC_TIME=German_Switzerland.1252"
>


From diggsb at ohsu.edu  Mon Oct 25 23:50:23 2010
From: diggsb at ohsu.edu (Brian Diggs)
Date: Mon, 25 Oct 2010 14:50:23 -0700
Subject: [Rd] Sweave and absolute escaped backslashed Windows paths in R
	2.12.0
Message-ID: <4CC5FB9F.9070107@ohsu.edu>

I've noticed a change in behavior in R 2.12.0 from 2.11.1 regarding the 
treatment of absolute paths in the file argument of Sweave in a Windows 
environment.

Consider the minimal Rnw file, attached and reproduced below my 
signature in case .Rnw files get stripped.  This file is stored on my 
(Windows) computer in H:/My Documents.  Using an absolute path with the 
standard window's escaped backslahes path gives an error:

 > Sweave("H:\\My Documents\\test.Rnw")
Writing to file test.tex
Processing code chunks ...
  1 : echo term verbatim

Error:  chunk 1
Error : '\M' is an unrecognized escape in character string starting "H:\M"

Nothing in the chuck explicitly references the path, but something 
Sweave does triggers this.  This did not happen in 2.11.1.  Specifying 
the path using slashes or as a relative path works.

 > Sweave("H:/My Documents/test.Rnw")
Writing to file test.tex
Processing code chunks ...
  1 : echo term verbatim

You can now run LaTeX on 'test.tex'
 > Sweave("test.Rnw")
Writing to file test.tex
Processing code chunks ...
  1 : echo term verbatim

You can now run LaTeX on 'test.tex'

I discovered this problem from a feature ESS has which has a keybinding 
that executes Sweave using the command:

 > local({..od <- getwd(); setwd("h:\\My Documents\\"); Sweave("h:\\My 
Documents\\test.Rnw"); setwd(..od) })
Writing to file test.tex
Processing code chunks ...
  1 : echo term verbatim

Error:  chunk 1
Error : '\M' is an unrecognized escape in character string starting "h:\M"

I can certainly work around it by manually executing Sweave with slashed 
or relative paths, but it is an inconvient change in behavior that I 
don't recall seeing a reference to in NEWS.

I'm guessing something in Sweave is taking the string
"H:\\My Documents\\test.Rnw"
and turning it into
"H:\My Documents\test.Rnw"
which when treated as a string is not valid (as \M is not a valid 
escape).  However, I don't know what is doing this.  Could it be related 
to the ability to give context sensitive errors ("Parsing errors 
detected during Sweave() processing will now be reported referencing 
their original location in the source file.") which is new in 2.12.0?

 > sessionInfo()
R version 2.12.0 (2010-10-15)
Platform: i386-pc-mingw32/i386 (32-bit)

locale:
[1] LC_COLLATE=English_United States.1252
[2] LC_CTYPE=English_United States.1252
[3] LC_MONETARY=English_United States.1252
[4] LC_NUMERIC=C
[5] LC_TIME=English_United States.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

-- 
Brian S. Diggs, PhD
Senior Research Associate, Department of Surgery
Oregon Health & Science University


test.Rnw:

\documentclass{article}

\begin{document}
<<>>=
1
@

\end{document}
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: test.Rnw
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20101025/4def1705/attachment.pl>

From murdoch.duncan at gmail.com  Tue Oct 26 00:24:01 2010
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Mon, 25 Oct 2010 18:24:01 -0400
Subject: [Rd] Sweave and absolute escaped backslashed Windows paths in R
 2.12.0
In-Reply-To: <4CC5FB9F.9070107@ohsu.edu>
References: <4CC5FB9F.9070107@ohsu.edu>
Message-ID: <4CC60381.6030903@gmail.com>

Brian Diggs wrote:
> I've noticed a change in behavior in R 2.12.0 from 2.11.1 regarding the 
> treatment of absolute paths in the file argument of Sweave in a Windows 
> environment.

Looks like a bug to me, probably related to the new error reporting.

Duncan Murdoch

> 
> Consider the minimal Rnw file, attached and reproduced below my 
> signature in case .Rnw files get stripped.  This file is stored on my 
> (Windows) computer in H:/My Documents.  Using an absolute path with the 
> standard window's escaped backslahes path gives an error:
> 
>  > Sweave("H:\\My Documents\\test.Rnw")
> Writing to file test.tex
> Processing code chunks ...
>   1 : echo term verbatim
> 
> Error:  chunk 1
> Error : '\M' is an unrecognized escape in character string starting "H:\M"
> 
> Nothing in the chuck explicitly references the path, but something 
> Sweave does triggers this.  This did not happen in 2.11.1.  Specifying 
> the path using slashes or as a relative path works.
> 
>  > Sweave("H:/My Documents/test.Rnw")
> Writing to file test.tex
> Processing code chunks ...
>   1 : echo term verbatim
> 
> You can now run LaTeX on 'test.tex'
>  > Sweave("test.Rnw")
> Writing to file test.tex
> Processing code chunks ...
>   1 : echo term verbatim
> 
> You can now run LaTeX on 'test.tex'
> 
> I discovered this problem from a feature ESS has which has a keybinding 
> that executes Sweave using the command:
> 
>  > local({..od <- getwd(); setwd("h:\\My Documents\\"); Sweave("h:\\My 
> Documents\\test.Rnw"); setwd(..od) })
> Writing to file test.tex
> Processing code chunks ...
>   1 : echo term verbatim
> 
> Error:  chunk 1
> Error : '\M' is an unrecognized escape in character string starting "h:\M"
> 
> I can certainly work around it by manually executing Sweave with slashed 
> or relative paths, but it is an inconvient change in behavior that I 
> don't recall seeing a reference to in NEWS.
> 
> I'm guessing something in Sweave is taking the string
> "H:\\My Documents\\test.Rnw"
> and turning it into
> "H:\My Documents\test.Rnw"
> which when treated as a string is not valid (as \M is not a valid 
> escape).  However, I don't know what is doing this.  Could it be related 
> to the ability to give context sensitive errors ("Parsing errors 
> detected during Sweave() processing will now be reported referencing 
> their original location in the source file.") which is new in 2.12.0?
> 
>  > sessionInfo()
> R version 2.12.0 (2010-10-15)
> Platform: i386-pc-mingw32/i386 (32-bit)
> 
> locale:
> [1] LC_COLLATE=English_United States.1252
> [2] LC_CTYPE=English_United States.1252
> [3] LC_MONETARY=English_United States.1252
> [4] LC_NUMERIC=C
> [5] LC_TIME=English_United States.1252
> 
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
> 
> 
> 
> ------------------------------------------------------------------------
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From murdoch.duncan at gmail.com  Tue Oct 26 02:18:41 2010
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Mon, 25 Oct 2010 20:18:41 -0400
Subject: [Rd] Sweave and absolute escaped backslashed Windows paths in R
 2.12.0
In-Reply-To: <4CC60381.6030903@gmail.com>
References: <4CC5FB9F.9070107@ohsu.edu> <4CC60381.6030903@gmail.com>
Message-ID: <4CC61E61.3060300@gmail.com>

On 25/10/2010 6:24 PM, Duncan Murdoch wrote:
> Brian Diggs wrote:
>> I've noticed a change in behavior in R 2.12.0 from 2.11.1 regarding the
>> treatment of absolute paths in the file argument of Sweave in a Windows
>> environment.
>
> Looks like a bug to me, probably related to the new error reporting.

It was a bug, now fixed in R-devel and R-patched (as of r53428).

Duncan Murdoch

>
> Duncan Murdoch
>
>>
>> Consider the minimal Rnw file, attached and reproduced below my
>> signature in case .Rnw files get stripped.  This file is stored on my
>> (Windows) computer in H:/My Documents.  Using an absolute path with the
>> standard window's escaped backslahes path gives an error:
>>
>>   >  Sweave("H:\\My Documents\\test.Rnw")
>> Writing to file test.tex
>> Processing code chunks ...
>>    1 : echo term verbatim
>>
>> Error:  chunk 1
>> Error : '\M' is an unrecognized escape in character string starting "H:\M"
>>
>> Nothing in the chuck explicitly references the path, but something
>> Sweave does triggers this.  This did not happen in 2.11.1.  Specifying
>> the path using slashes or as a relative path works.
>>
>>   >  Sweave("H:/My Documents/test.Rnw")
>> Writing to file test.tex
>> Processing code chunks ...
>>    1 : echo term verbatim
>>
>> You can now run LaTeX on 'test.tex'
>>   >  Sweave("test.Rnw")
>> Writing to file test.tex
>> Processing code chunks ...
>>    1 : echo term verbatim
>>
>> You can now run LaTeX on 'test.tex'
>>
>> I discovered this problem from a feature ESS has which has a keybinding
>> that executes Sweave using the command:
>>
>>   >  local({..od<- getwd(); setwd("h:\\My Documents\\"); Sweave("h:\\My
>> Documents\\test.Rnw"); setwd(..od) })
>> Writing to file test.tex
>> Processing code chunks ...
>>    1 : echo term verbatim
>>
>> Error:  chunk 1
>> Error : '\M' is an unrecognized escape in character string starting "h:\M"
>>
>> I can certainly work around it by manually executing Sweave with slashed
>> or relative paths, but it is an inconvient change in behavior that I
>> don't recall seeing a reference to in NEWS.
>>
>> I'm guessing something in Sweave is taking the string
>> "H:\\My Documents\\test.Rnw"
>> and turning it into
>> "H:\My Documents\test.Rnw"
>> which when treated as a string is not valid (as \M is not a valid
>> escape).  However, I don't know what is doing this.  Could it be related
>> to the ability to give context sensitive errors ("Parsing errors
>> detected during Sweave() processing will now be reported referencing
>> their original location in the source file.") which is new in 2.12.0?
>>
>>   >  sessionInfo()
>> R version 2.12.0 (2010-10-15)
>> Platform: i386-pc-mingw32/i386 (32-bit)
>>
>> locale:
>> [1] LC_COLLATE=English_United States.1252
>> [2] LC_CTYPE=English_United States.1252
>> [3] LC_MONETARY=English_United States.1252
>> [4] LC_NUMERIC=C
>> [5] LC_TIME=English_United States.1252
>>
>> attached base packages:
>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>
>>
>>
>> ------------------------------------------------------------------------
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From ripley at stats.ox.ac.uk  Tue Oct 26 11:01:46 2010
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 26 Oct 2010 10:01:46 +0100 (BST)
Subject: [Rd] cannot connect to an FTP server with long HELLO message
In-Reply-To: <4CC128DD.8030703@fhcrc.org>
References: <4CC128DD.8030703@fhcrc.org>
Message-ID: <alpine.LFD.2.00.1010251608080.26229@gannet.stats.ox.ac.uk>

The example works for me (eventually: the site was very slow to 
respond) --- nanoftp reads the response in 1024 byte chunks and makes 
sense of it.

We do provide debugging facilites via, say,
options(internet.info=0, warn=1, warning.length=4000)
which may help you debug this.  Simply fiddling with the buffer size 
doesn't help understanding and might well break something else.

The code is essentially unchanged since 2006 when inter alia the 
buffer size was doubled to 1024 (because libxml2 2.6.6 did), and 
AFAICS is essentially unchanged in the current snapshots of libxml2.

I can surmise that the nanoftp C code might break if the actual 
control code spanned 1024-byte chunks, but it needs someone with the 
problem to debug in more detail.

On Thu, 21 Oct 2010, Herv? Pag?s wrote:

> Hi,
>
> Trying to access files on the ftp server at ftp.ncbi.nih.gov
> will either give a time out or sometimes even a segfault on Linux.
> The 2 following methods give the same results:
>
>  f <- url("ftp://ftp.ncbi.nih.gov/pub/geo/DATA/SOFT/GDS/GDS10.soft.gz", 
> open="r")
>
>
> download.file("ftp://ftp.ncbi.nih.gov/pub/geo/DATA/SOFT/GDS/GDS10.soft.gz", 
> destfile=tempfile())
>
> I've tried one or the other method with all release versions >= 2.8
> and with current R devel and they always fail to connect to this
> FTP server.
>
> What's particular about this FTP server is that it sends a long HELLO
> message before it finally sends the 220 control code.
> Using the Unix ftp client:

Well, one of many such.

>
> -----------------------------------------------------------------------------
> hpages at latitude:~$ ftp ftp.ncbi.nih.gov
> Connected to ftp.ncbi.nih.gov.
> 220-
> Warning Notice!
>
> This is a U.S. Government computer system, which may be accessed and used
> only for authorized Government business by authorized personnel.
> Unauthorized access or use of this computer system may subject violators to
> criminal, civil, and/or administrative action.
>
> All information on this computer system may be intercepted, recorded, read,
> copied, and disclosed by and to authorized personnel for official purposes,
> including criminal investigations. Such information includes sensitive data
> encrypted to comply with confidentiality and privacy requirements. Access
> or use of this computer system by any person, whether authorized or
> unauthorized, constitutes consent to these terms. There is no right of
> privacy in this system.
> ---
> Welcome to the NCBI ftp server! The official anonymous access URL is 
> ftp://ftp.ncbi.nih.gov
>
> Public data may be downloaded by logging in as "anonymous" using your E-mail 
> address as a password.
>
> Please see ftp://ftp.ncbi.nih.gov/README.ftp for hints on large file 
> transfers
> 220 FTP Server ready.
> -----------------------------------------------------------------------------
>
> This seems to cause problems to the nanoftp module
> (src/modules/internet/nanoftp.c) used by url() and download.file()
> as it doesn't seem to be able to catch the 220 control code.
>
> I'm not familiar with the nanoftp module, or with socket programming in
> general, or with RFC 959 (FTP protocal), so I'm not really in a position
> to say what's going wrong exactly in the module but it seems that
> increasing the value of FTP_BUF_SIZE (size of the buffer for data
> received from the control connection) fixes the problem.
> Currently this is:
>
> #define FTP_BUF_SIZE            1024
>
> but, interestingly, *any* value > 1024 seems to fix the problem (even
> though the long HELLO message above is 1091 bytes).
>
> Any idea what's going on?
>
> Thanks,
> H.
>
> -- 
> Herv? Pag?s
>
> Program in Computational Biology
> Division of Public Health Sciences
> Fred Hutchinson Cancer Research Center
> 1100 Fairview Ave. N, M2-B876
> P.O. Box 19024
> Seattle, WA 98109-1024
>
> E-mail: hpages at fhcrc.org
> Phone:  (206) 667-5791
> Fax:    (206) 667-1319
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From rksh1 at cam.ac.uk  Tue Oct 26 12:53:49 2010
From: rksh1 at cam.ac.uk (Robin Hankin)
Date: Tue, 26 Oct 2010 11:53:49 +0100
Subject: [Rd] S4 methods for rbind()
Message-ID: <4CC6B33D.5050106@cam.ac.uk>

Hello.

I am trying to write an S4 method for rbind(). I have a class of objects
called 'mdm', and I want to be able to rbind() them to one another.

I do not want the method for rbind() to coerce anything to an mdm object.
I want rbind(x1,x2,x1,x2) to work as expected [ie rbind() should take any
number of arguments].

This is what I have so far:


setGeneric(".rbind_pair", function(x,y){standardGeneric(".rbind_pair")})
setMethod(".rbind_pair", c("mdm", "mdm"), function(x,y){.mdm.cPair(x,y)})
setMethod(".rbind_pair", c("mdm", "ANY"),
function(x,y){.mdm_rbind_error(x,y)})
setMethod(".rbind_pair", c("ANY", "mdm"),
function(x,y){.mdm_rbind_error(x,y)})
setMethod(".rbind_pair", c("ANY", "ANY"),
function(x,y){.mdm_rbind_error(x,y)})

".mdm_rbind_error" <- function(x,y){
stop("an mdm object may only be rbinded to another mdm object")
}

".mdm.rbind_pair" <- function(x,y){
stopifnot(compatible(x,y))
mdm(rbind(xold(x),xold(y)),c(types(x),types(y))) # this is the "meat" of
the rbind functionality
}

setGeneric("rbind")
setMethod("rbind", signature="mdm", function(x, ...) {
if(nargs()<3)
.mdm_rbind_pair(x,...)
else
.mdm_rbind_pair(x, Recall(...))
})


But


LE223:~/packages% sudo R CMD INSTALL ./multivator
[snip]
Creating a new generic function for "tail" in "multivator"
Error in conformMethod(signature, mnames, fnames, f, fdef, definition) :
in method for ?rbind? with signature ?deparse.level="mdm"?: formal
arguments (... = "mdm", deparse.level = "mdm") omitted in the method
definition cannot be in the signature
Error : unable to load R code in package 'multivator'
ERROR: lazy loading failed for package ?multivator?
* removing ?/usr/local/lib64/R/library/multivator?
* restoring previous ?/usr/local/lib64/R/library/multivator?
LE223:~/packages%


I can't understand what the error message is trying to say.

Can anyone advise on a fix for this?


-- 
Robin K. S. Hankin
Uncertainty Analyst
University of Cambridge
19 Silver Street
Cambridge CB3 9EP
01223-764877


From jon.clayden at gmail.com  Tue Oct 26 13:57:46 2010
From: jon.clayden at gmail.com (Jon Clayden)
Date: Tue, 26 Oct 2010 12:57:46 +0100
Subject: [Rd] Reference classes
In-Reply-To: <AANLkTinrSDJ6ZxinQNF3F9EVnnU=x0VeaxYoq6+t41fe@mail.gmail.com>
References: <AANLkTik+o=SgwXO5augahHC18Hv9hBL87VOyGVG8LqN_@mail.gmail.com>
	<4CC1CFFE.5080402@r-project.org>
	<AANLkTinrSDJ6ZxinQNF3F9EVnnU=x0VeaxYoq6+t41fe@mail.gmail.com>
Message-ID: <AANLkTinYqjXnO97aM19PhR+V8-qdOrE=jPeXOYFpAe3Z@mail.gmail.com>

On 23 October 2010 00:52, Jon Clayden <jon.clayden at gmail.com> wrote:
> On 22 October 2010 18:55, John Chambers <jmc at r-project.org> wrote:
>
>>> As a suggestion, it would be nice if the accessors() method could be
>>> used to create just "getters" or just "setters" for particular fields,
>>> although I realise this can be worked around by removing the unwanted
>>> methods afterwards.
>>
>> In other words, read-only fields. ?There is a facility for that implemented
>> already, but it didn't yet make it into the documentation, and it could use
>> some more testing. ?The generator object has a $lock() method that inserts a
>> write-once type of method for one or more fields. ?Example:
>>
>>> fg <- setRefClass("foo", list(bar = "numeric", flag = "character"),
>> + ? ? ? ? ? ? methods = list(
>> + ? ? ? ? ? ? addToBar = function(incr) {
>> + ? ? ? ? ? ? ? ? b = bar + incr
>> + ? ? ? ? ? ? ? ? bar <<- b
>> + ? ? ? ? ? ? ? ? b
>> + ? ? ? ? ? ? }
>> + ? ? ? ? ? ? ))
>>> fg$lock("bar")
>>> ff = new("foo", bar = 1.5)
>>> ff$bar <- 2
>> Error in function (value) ?: Field "bar" is read-only
>>
>> A revision will document this soon.
>>
>> (And no, the workaround is not to remove methods. ?To customize access to a
>> field, the technique is to write an accessor function for the field that, in
>> this case, throws an error if it gets an argument. ?See the documentation
>> for the fields argument. ?The convention here and the underlying mechanism
>> are taken from active bindings for environments.)
>
> OK, yes - I see. This is clearly much less superficial than removing
> the setter method for a field which can be directly set anyway. I'll
> have to try out field accessor functions and get a feel for the
> semantics.

Unfortunately, I'm having difficulty working out the accessor function
approach. I've looked in the Rcpp package for examples, but it doesn't
seem to use this feature. If I define

Foo <- setRefClass("Foo", fields=list(bar=function (newBar) {
                                            if (missing(newBar)) bar
                                            else stop("bar is read-only") }),
                          methods=list(barExists=function ()
print(exists("bar"))))

then I can't access the value of "bar" due to infinite recursion.
Using ".self$bar" in the accessor produces the same effect.

> f <- Foo$new()
> f$barExists()
[1] TRUE
> f$bar
Error: evaluation nested too deeply: infinite recursion / options(expressions=)?
> f$bar()
Error: evaluation nested too deeply: infinite recursion / options(expressions=)?

I can guess why this is happening (accessing "bar" within the accessor
calls itself), but how can I get at the value of "bar" within the
accessor without this occurring?

The other problem is that I can't even set a value at the time of
creation of the object, viz.

> f <- Foo$new(bar=2)
Error in function (newBar)  : bar is read-only

Is there a way to test whether "bar" has already been set in the
accessor, so that I can allow it to be set once? (I know lock() allows
this, but it would be useful to be able to replicate the effect using
accessors, so that it can be generalised further where needed.)
Clearly, exists("bar") doesn't do this, as seen above -- presumably
because it sees the method rather than the field, or there is some
default value.

Thanks in advance,
Jon


From mtmorgan at fhcrc.org  Tue Oct 26 14:49:39 2010
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Tue, 26 Oct 2010 05:49:39 -0700
Subject: [Rd] S4 methods for rbind()
In-Reply-To: <4CC6B33D.5050106@cam.ac.uk>
References: <4CC6B33D.5050106@cam.ac.uk>
Message-ID: <4CC6CE63.3050300@fhcrc.org>

On 10/26/2010 03:53 AM, Robin Hankin wrote:
> Hello.
> 
> I am trying to write an S4 method for rbind(). I have a class of objects
> called 'mdm', and I want to be able to rbind() them to one another.
> 
> I do not want the method for rbind() to coerce anything to an mdm object.
> I want rbind(x1,x2,x1,x2) to work as expected [ie rbind() should take any
> number of arguments].
> 
> This is what I have so far:
> 
> 
> setGeneric(".rbind_pair", function(x,y){standardGeneric(".rbind_pair")})
> setMethod(".rbind_pair", c("mdm", "mdm"), function(x,y){.mdm.cPair(x,y)})
> setMethod(".rbind_pair", c("mdm", "ANY"),
> function(x,y){.mdm_rbind_error(x,y)})
> setMethod(".rbind_pair", c("ANY", "mdm"),
> function(x,y){.mdm_rbind_error(x,y)})
> setMethod(".rbind_pair", c("ANY", "ANY"),
> function(x,y){.mdm_rbind_error(x,y)})
> 
> ".mdm_rbind_error" <- function(x,y){
> stop("an mdm object may only be rbinded to another mdm object")
> }
> 
> ".mdm.rbind_pair" <- function(x,y){
> stopifnot(compatible(x,y))
> mdm(rbind(xold(x),xold(y)),c(types(x),types(y))) # this is the "meat" of
> the rbind functionality
> }
> 
> setGeneric("rbind")
> setMethod("rbind", signature="mdm", function(x, ...) {
> if(nargs()<3)
> .mdm_rbind_pair(x,...)
> else
> .mdm_rbind_pair(x, Recall(...))
> })
> 
> 
> But
> 
> 
> LE223:~/packages% sudo R CMD INSTALL ./multivator
> [snip]
> Creating a new generic function for "tail" in "multivator"
> Error in conformMethod(signature, mnames, fnames, f, fdef, definition) :
> in method for ?rbind? with signature ?deparse.level="mdm"?: formal
> arguments (... = "mdm", deparse.level = "mdm") omitted in the method
> definition cannot be in the signature

Hi Robin

try getGeneric("rbind") and showMethods("rbind") after your setGeneric;.
The generic is dispatching on 'deparse.level'. 'deparse.level' is
missing from your method definition, and so can't be used as the
signature for your method. Try to set the ... explicitly as the
signature to be used for dispatch.

setGeneric("rbind",
    function(..., deparse.level=1) standardGeneric("rbind"),
    signature = "...")

Martin

> Error : unable to load R code in package 'multivator'
> ERROR: lazy loading failed for package ?multivator?
> * removing ?/usr/local/lib64/R/library/multivator?
> * restoring previous ?/usr/local/lib64/R/library/multivator?
> LE223:~/packages%
> 
> 
> I can't understand what the error message is trying to say.
> 
> Can anyone advise on a fix for this?
> 
> 


-- 
Computational Biology
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N. PO Box 19024 Seattle, WA 98109

Location: M1-B861
Telephone: 206 667-2793


From rksh1 at cam.ac.uk  Tue Oct 26 15:34:07 2010
From: rksh1 at cam.ac.uk (Robin Hankin)
Date: Tue, 26 Oct 2010 14:34:07 +0100
Subject: [Rd] S4 methods for rbind()
In-Reply-To: <4CC6CE63.3050300@fhcrc.org>
References: <4CC6B33D.5050106@cam.ac.uk> <4CC6CE63.3050300@fhcrc.org>
Message-ID: <4CC6D8CF.1010309@cam.ac.uk>

Thank you very much for this Martin.

It works!

There were two gotchas:

1.  One has to add 'deparse.level=1' to the setMethod() function
argument list

2.  Adding deparse.level=1 increments nargs() ...so the 3 should be 4.

But now it works!

Best wishes

Robin




On 26/10/10 13:49, Martin Morgan wrote:
> On 10/26/2010 03:53 AM, Robin Hankin wrote:
>   
>> Hello.
>>
>> I am trying to write an S4 method for rbind(). I have a class of objects
>> called 'mdm', and I want to be able to rbind() them to one another.
>>
>> I do not want the method for rbind() to coerce anything to an mdm object.
>> I want rbind(x1,x2,x1,x2) to work as expected [ie rbind() should take any
>> number of arguments].
>>
>> This is what I have so far:
>>
>>
>> setGeneric(".rbind_pair", function(x,y){standardGeneric(".rbind_pair")})
>> setMethod(".rbind_pair", c("mdm", "mdm"), function(x,y){.mdm.cPair(x,y)})
>> setMethod(".rbind_pair", c("mdm", "ANY"),
>> function(x,y){.mdm_rbind_error(x,y)})
>> setMethod(".rbind_pair", c("ANY", "mdm"),
>> function(x,y){.mdm_rbind_error(x,y)})
>> setMethod(".rbind_pair", c("ANY", "ANY"),
>> function(x,y){.mdm_rbind_error(x,y)})
>>
>> ".mdm_rbind_error" <- function(x,y){
>> stop("an mdm object may only be rbinded to another mdm object")
>> }
>>
>> ".mdm.rbind_pair" <- function(x,y){
>> stopifnot(compatible(x,y))
>> mdm(rbind(xold(x),xold(y)),c(types(x),types(y))) # this is the "meat" of
>> the rbind functionality
>> }
>>
>> setGeneric("rbind")
>> setMethod("rbind", signature="mdm", function(x, ...) {
>> if(nargs()<3)
>> .mdm_rbind_pair(x,...)
>> else
>> .mdm_rbind_pair(x, Recall(...))
>> })
>>
>>
>> But
>>
>>
>> LE223:~/packages% sudo R CMD INSTALL ./multivator
>> [snip]
>> Creating a new generic function for "tail" in "multivator"
>> Error in conformMethod(signature, mnames, fnames, f, fdef, definition) :
>> in method for ?rbind? with signature ?deparse.level="mdm"?: formal
>> arguments (... = "mdm", deparse.level = "mdm") omitted in the method
>> definition cannot be in the signature
>>     
> Hi Robin
>
> try getGeneric("rbind") and showMethods("rbind") after your setGeneric;.
> The generic is dispatching on 'deparse.level'. 'deparse.level' is
> missing from your method definition, and so can't be used as the
> signature for your method. Try to set the ... explicitly as the
> signature to be used for dispatch.
>
> setGeneric("rbind",
>     function(..., deparse.level=1) standardGeneric("rbind"),
>     signature = "...")
>
> Martin
>
>   
>> Error : unable to load R code in package 'multivator'
>> ERROR: lazy loading failed for package ?multivator?
>> * removing ?/usr/local/lib64/R/library/multivator?
>> * restoring previous ?/usr/local/lib64/R/library/multivator?
>> LE223:~/packages%
>>
>>
>> I can't understand what the error message is trying to say.
>>
>> Can anyone advise on a fix for this?
>>
>>
>>     
>
>   


-- 
Robin K. S. Hankin
Uncertainty Analyst
University of Cambridge
19 Silver Street
Cambridge CB3 9EP
01223-764877


From jmc at r-project.org  Tue Oct 26 17:57:55 2010
From: jmc at r-project.org (John Chambers)
Date: Tue, 26 Oct 2010 08:57:55 -0700
Subject: [Rd] Reference classes
In-Reply-To: <AANLkTinYqjXnO97aM19PhR+V8-qdOrE=jPeXOYFpAe3Z@mail.gmail.com>
References: <AANLkTik+o=SgwXO5augahHC18Hv9hBL87VOyGVG8LqN_@mail.gmail.com>	<4CC1CFFE.5080402@r-project.org>	<AANLkTinrSDJ6ZxinQNF3F9EVnnU=x0VeaxYoq6+t41fe@mail.gmail.com>
	<AANLkTinYqjXnO97aM19PhR+V8-qdOrE=jPeXOYFpAe3Z@mail.gmail.com>
Message-ID: <4CC6FA83.2090002@r-project.org>

What you've written will certainly generate an infinite recursion.  How 
could it not?

Specifying an accessor function says to the system "Any reference to 
this field should be evaluated by calling this function."  But then you 
refer to the field in the function itself, which will result in a call 
to the function, which ....

Accessor functions are typically used when the field is a proxy for some 
data stored in a less convenient form (in a C++ object in the case of 
Rcpp).  As a self-contained example:

 > ss <- setRefClass("silly", fields = list(now = function(value) {
+ if(missing(value)) Sys.time()
+ else stop("You can't change the time, dummy!")
+ }))
 > s1 <- ss$new()
 > s1$now
[1] "2010-10-26 08:50:36 PDT"
 > s1$now <- "Never"
Error in function (value)  : You can't change the time, dummy!



On 10/26/10 4:57 AM, Jon Clayden wrote:
> On 23 October 2010 00:52, Jon Clayden<jon.clayden at gmail.com>  wrote:
>> On 22 October 2010 18:55, John Chambers<jmc at r-project.org>  wrote:
>>
>>>> As a suggestion, it would be nice if the accessors() method could be
>>>> used to create just "getters" or just "setters" for particular fields,
>>>> although I realise this can be worked around by removing the unwanted
>>>> methods afterwards.
>>>
>>> In other words, read-only fields.  There is a facility for that implemented
>>> already, but it didn't yet make it into the documentation, and it could use
>>> some more testing.  The generator object has a $lock() method that inserts a
>>> write-once type of method for one or more fields.  Example:
>>>
>>>> fg<- setRefClass("foo", list(bar = "numeric", flag = "character"),
>>> +             methods = list(
>>> +             addToBar = function(incr) {
>>> +                 b = bar + incr
>>> +                 bar<<- b
>>> +                 b
>>> +             }
>>> +             ))
>>>> fg$lock("bar")
>>>> ff = new("foo", bar = 1.5)
>>>> ff$bar<- 2
>>> Error in function (value)  : Field "bar" is read-only
>>>
>>> A revision will document this soon.
>>>
>>> (And no, the workaround is not to remove methods.  To customize access to a
>>> field, the technique is to write an accessor function for the field that, in
>>> this case, throws an error if it gets an argument.  See the documentation
>>> for the fields argument.  The convention here and the underlying mechanism
>>> are taken from active bindings for environments.)
>>
>> OK, yes - I see. This is clearly much less superficial than removing
>> the setter method for a field which can be directly set anyway. I'll
>> have to try out field accessor functions and get a feel for the
>> semantics.
>
> Unfortunately, I'm having difficulty working out the accessor function
> approach. I've looked in the Rcpp package for examples, but it doesn't
> seem to use this feature. If I define
>
> Foo<- setRefClass("Foo", fields=list(bar=function (newBar) {
>                                              if (missing(newBar)) bar
>                                              else stop("bar is read-only") }),
>                            methods=list(barExists=function ()
> print(exists("bar"))))
>
> then I can't access the value of "bar" due to infinite recursion.
> Using ".self$bar" in the accessor produces the same effect.
>
>> f<- Foo$new()
>> f$barExists()
> [1] TRUE
>> f$bar
> Error: evaluation nested too deeply: infinite recursion / options(expressions=)?
>> f$bar()
> Error: evaluation nested too deeply: infinite recursion / options(expressions=)?
>
> I can guess why this is happening (accessing "bar" within the accessor
> calls itself), but how can I get at the value of "bar" within the
> accessor without this occurring?
>
> The other problem is that I can't even set a value at the time of
> creation of the object, viz.
>
>> f<- Foo$new(bar=2)
> Error in function (newBar)  : bar is read-only
>
> Is there a way to test whether "bar" has already been set in the
> accessor, so that I can allow it to be set once? (I know lock() allows
> this, but it would be useful to be able to replicate the effect using
> accessors, so that it can be generalised further where needed.)
> Clearly, exists("bar") doesn't do this, as seen above -- presumably
> because it sees the method rather than the field, or there is some
> default value.
>
> Thanks in advance,
> Jon
>


From hpages at fhcrc.org  Tue Oct 26 19:33:05 2010
From: hpages at fhcrc.org (=?ISO-8859-15?Q?Herv=E9_Pag=E8s?=)
Date: Tue, 26 Oct 2010 10:33:05 -0700
Subject: [Rd] cannot connect to an FTP server with long HELLO message
In-Reply-To: <alpine.LFD.2.00.1010251608080.26229@gannet.stats.ox.ac.uk>
References: <4CC128DD.8030703@fhcrc.org>
	<alpine.LFD.2.00.1010251608080.26229@gannet.stats.ox.ac.uk>
Message-ID: <4CC710D1.3000905@fhcrc.org>

Hi,

On 10/26/2010 02:01 AM, Prof Brian Ripley wrote:
> The example works for me (eventually: the site was very slow to respond)
> --- nanoftp reads the response in 1024 byte chunks and makes sense of it.
>
> We do provide debugging facilites via, say,
> options(internet.info=0, warn=1, warning.length=4000)
> which may help you debug this. Simply fiddling with the buffer size
> doesn't help understanding and might well break something else.

I'll have a second look at this and will try to provide more
information. Thanks for your answer.

>
> The code is essentially unchanged since 2006 when inter alia the buffer
> size was doubled to 1024 (because libxml2 2.6.6 did), and AFAICS is
> essentially unchanged in the current snapshots of libxml2.
>
> I can surmise that the nanoftp C code might break if the actual control
> code spanned 1024-byte chunks, but it needs someone with the problem to
> debug in more detail.

This seems to be actually the case. I've added some printf statements
to the nanoftp module and what happens to the 220 code is the same as
here:

host <- "ftp.ncbi.nih.gov"

get.ftp.hello <- function(host)
{
   port <- 21L
   sk <- make.socket(host, port)
   on.exit(close.socket(sk))
   output <- character(0)
   i <- 1L
   repeat {
     ss <- read.socket(sk, maxlen = 1024)
     if (ss == "") break
     cat(i, ": ", ss, "\n", sep="")
     i <- i + 1L
     output <- append(output, ss)
   }
   output
}

 > hello <- get.ftp.hello(host)
1: 220-

2:  Warning Notice!

  This is a U.S. Gov
3: ernment computer system, which may be accessed and used
  only for authorized Government business by authorized personnel.
  Unauthorized access or use of this computer system may subject 
violators to
  criminal, civil, and/or administrative action.

  All information on this computer system may be intercepted, recorded, 
read,
  copied, and disclosed by and to authorized personnel for official 
purposes,
  including criminal investigations. Such information includes sensitive 
data
  encrypted to comply with confidentiality and privacy requirements. Access
  or use of this computer system by any person, whether authorized or
  unauthorized, constitutes consent to these terms. There is no right of
  privacy in this system.
  ---
  Welcome to the NCBI ftp server! The official anonymous access URL is 
ftp://ftp.ncbi.nih.gov

  Public data may be downloaded by logging in as "anonymous" using your 
E-mail address as a password.

  Please see ftp://ftp.ncbi.nih.gov/README.ftp for hints on large file 
transfers
22
4: 0 FTP Server ready.

5: 421 Login Timeout (60 seconds): closing control connection.

 > nchar(hello)
[1]    6   40 1024   21   61

But there seems to be something else going on, because, as I mentioned
earlier, sometimes (once every 20 attempts or so) I get a segfault when
trying to open this url with url().

Cheers,
H.


>
> On Thu, 21 Oct 2010, Herv? Pag?s wrote:
>
>> Hi,
>>
>> Trying to access files on the ftp server at ftp.ncbi.nih.gov
>> will either give a time out or sometimes even a segfault on Linux.
>> The 2 following methods give the same results:
>>
>> f <- url("ftp://ftp.ncbi.nih.gov/pub/geo/DATA/SOFT/GDS/GDS10.soft.gz",
>> open="r")
>>
>>
>> download.file("ftp://ftp.ncbi.nih.gov/pub/geo/DATA/SOFT/GDS/GDS10.soft.gz",
>> destfile=tempfile())
>>
>> I've tried one or the other method with all release versions >= 2.8
>> and with current R devel and they always fail to connect to this
>> FTP server.
>>
>> What's particular about this FTP server is that it sends a long HELLO
>> message before it finally sends the 220 control code.
>> Using the Unix ftp client:
>
> Well, one of many such.
>
>>
>> -----------------------------------------------------------------------------
>>
>> hpages at latitude:~$ ftp ftp.ncbi.nih.gov
>> Connected to ftp.ncbi.nih.gov.
>> 220-
>> Warning Notice!
>>
>> This is a U.S. Government computer system, which may be accessed and used
>> only for authorized Government business by authorized personnel.
>> Unauthorized access or use of this computer system may subject
>> violators to
>> criminal, civil, and/or administrative action.
>>
>> All information on this computer system may be intercepted, recorded,
>> read,
>> copied, and disclosed by and to authorized personnel for official
>> purposes,
>> including criminal investigations. Such information includes sensitive
>> data
>> encrypted to comply with confidentiality and privacy requirements. Access
>> or use of this computer system by any person, whether authorized or
>> unauthorized, constitutes consent to these terms. There is no right of
>> privacy in this system.
>> ---
>> Welcome to the NCBI ftp server! The official anonymous access URL is
>> ftp://ftp.ncbi.nih.gov
>>
>> Public data may be downloaded by logging in as "anonymous" using your
>> E-mail address as a password.
>>
>> Please see ftp://ftp.ncbi.nih.gov/README.ftp for hints on large file
>> transfers
>> 220 FTP Server ready.
>> -----------------------------------------------------------------------------
>>
>>
>> This seems to cause problems to the nanoftp module
>> (src/modules/internet/nanoftp.c) used by url() and download.file()
>> as it doesn't seem to be able to catch the 220 control code.
>>
>> I'm not familiar with the nanoftp module, or with socket programming in
>> general, or with RFC 959 (FTP protocal), so I'm not really in a position
>> to say what's going wrong exactly in the module but it seems that
>> increasing the value of FTP_BUF_SIZE (size of the buffer for data
>> received from the control connection) fixes the problem.
>> Currently this is:
>>
>> #define FTP_BUF_SIZE 1024
>>
>> but, interestingly, *any* value > 1024 seems to fix the problem (even
>> though the long HELLO message above is 1091 bytes).
>>
>> Any idea what's going on?
>>
>> Thanks,
>> H.
>>
>> --
>> Herv? Pag?s
>>
>> Program in Computational Biology
>> Division of Public Health Sciences
>> Fred Hutchinson Cancer Research Center
>> 1100 Fairview Ave. N, M2-B876
>> P.O. Box 19024
>> Seattle, WA 98109-1024
>>
>> E-mail: hpages at fhcrc.org
>> Phone: (206) 667-5791
>> Fax: (206) 667-1319
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>


-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M2-B876
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fhcrc.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From diggsb at ohsu.edu  Wed Oct 27 01:38:28 2010
From: diggsb at ohsu.edu (Brian Diggs)
Date: Tue, 26 Oct 2010 16:38:28 -0700
Subject: [Rd] Link to R 2.12.0 patched build for windows
Message-ID: <4CC76674.8060000@ohsu.edu>

On the download page for windows builds of R 2.12.0:

http://cran.r-project.org/bin/windows/base/

The link for "r-patched snapshot build" goes to:

http://cran.r-project.org/bin/windows/base/rpatched.html

which has a link for R-2.11.1 patched.  I believe that link should go to:

http://cran.r-project.org/bin/windows/base/rtest.html

which does have a link for R-2.12.0 patched. Or the "rpatched.html" page 
should be updated with a link to R-2.12.0 patched.

-- 
Brian S. Diggs, PhD
Senior Research Associate, Department of Surgery
Oregon Health & Science University


From michael.m.spiegel at gmail.com  Wed Oct 27 03:04:31 2010
From: michael.m.spiegel at gmail.com (Michael Spiegel)
Date: Tue, 26 Oct 2010 21:04:31 -0400
Subject: [Rd] windows 64-bit package build on 32-bit machine
Message-ID: <AANLkTina2USCfqaxerb-Q3X_5kdq6zD45AJy9gekiYRJ@mail.gmail.com>

Hello,

Is it possible to build a 64-bit package on a 32-bit machine on
windows? I can cross-compile for x86, x86_64, and ppc on a 32-bit OS X
machine.  And it looks like I could build a 32-bit library on a 64-bit
windows machine.  But it doesn't look possible to build a 64-bit
library on a 32-bit windows machine?

Thanks,
--Michael


From simon.urbanek at r-project.org  Wed Oct 27 04:41:08 2010
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Tue, 26 Oct 2010 22:41:08 -0400
Subject: [Rd] windows 64-bit package build on 32-bit machine
In-Reply-To: <AANLkTina2USCfqaxerb-Q3X_5kdq6zD45AJy9gekiYRJ@mail.gmail.com>
References: <AANLkTina2USCfqaxerb-Q3X_5kdq6zD45AJy9gekiYRJ@mail.gmail.com>
Message-ID: <0CCBB231-E4E2-48FC-8E75-41EFA22AA57C@r-project.org>


On Oct 26, 2010, at 9:04 PM, Michael Spiegel wrote:

> Hello,
> 
> Is it possible to build a 64-bit package on a 32-bit machine on
> windows? I can cross-compile for x86, x86_64, and ppc on a 32-bit OS X
> machine.  And it looks like I could build a 32-bit library on a 64-bit
> windows machine.  But it doesn't look possible to build a 64-bit
> library on a 32-bit windows machine?
> 

Why not? It works for me without problems ...

Cheers,
Simon


From michael.m.spiegel at gmail.com  Wed Oct 27 05:10:15 2010
From: michael.m.spiegel at gmail.com (Michael Spiegel)
Date: Tue, 26 Oct 2010 23:10:15 -0400
Subject: [Rd] windows 64-bit package build on 32-bit machine
In-Reply-To: <0CCBB231-E4E2-48FC-8E75-41EFA22AA57C@r-project.org>
References: <AANLkTina2USCfqaxerb-Q3X_5kdq6zD45AJy9gekiYRJ@mail.gmail.com>
	<0CCBB231-E4E2-48FC-8E75-41EFA22AA57C@r-project.org>
Message-ID: <AANLkTikp4=PVXJ-5Edbr6NfoPn-gcwRZMAV+peqc4rOP@mail.gmail.com>

Hmm.  So our package does not have no src/Makefile.win and only an
empty configure.win.  We usually build a binary version with R CMD
INSTALL --build.

R --arch x64 CMD INSTALL --build yields the message "The system cannot
find the path specified."

On Tue, Oct 26, 2010 at 10:41 PM, Simon Urbanek
<simon.urbanek at r-project.org> wrote:
>
> On Oct 26, 2010, at 9:04 PM, Michael Spiegel wrote:
>
>> Hello,
>>
>> Is it possible to build a 64-bit package on a 32-bit machine on
>> windows? I can cross-compile for x86, x86_64, and ppc on a 32-bit OS X
>> machine. ?And it looks like I could build a 32-bit library on a 64-bit
>> windows machine. ?But it doesn't look possible to build a 64-bit
>> library on a 32-bit windows machine?
>>
>
> Why not? It works for me without problems ...
>
> Cheers,
> Simon
>
>


From hpages at fhcrc.org  Wed Oct 27 07:31:55 2010
From: hpages at fhcrc.org (=?ISO-8859-1?Q?Herv=E9_Pag=E8s?=)
Date: Tue, 26 Oct 2010 22:31:55 -0700
Subject: [Rd] windows 64-bit package build on 32-bit machine
In-Reply-To: <AANLkTina2USCfqaxerb-Q3X_5kdq6zD45AJy9gekiYRJ@mail.gmail.com>
References: <AANLkTina2USCfqaxerb-Q3X_5kdq6zD45AJy9gekiYRJ@mail.gmail.com>
Message-ID: <4CC7B94B.6030003@fhcrc.org>

Hi Michael,

My understanding is that this should work.
According to section "D.4.2 64-bit toolchain" of the "R Installation
and Administration" manual:

   The toolchain we use is technically a cross-compiler: the tools run
   under 32-bit Windows but produce code to run under 64-bit Windows.

BTW, as reported here 
https://stat.ethz.ch/pipermail/r-devel/2010-June/057668.html
in June, the following links in the Table of Contents of this manual
are broken:

   3.1.10 64-bit Windows builds
   C.4.1 64-bit Leopard builds
   D.4.1 32-bit toolchain
   D.4.2 64-bit toolchain

Seems like only the sections with a title starting with a digit have
this problem.

Cheers,
H.


On 10/26/2010 06:04 PM, Michael Spiegel wrote:
> Hello,
>
> Is it possible to build a 64-bit package on a 32-bit machine on
> windows? I can cross-compile for x86, x86_64, and ppc on a 32-bit OS X
> machine.  And it looks like I could build a 32-bit library on a 64-bit
> windows machine.  But it doesn't look possible to build a 64-bit
> library on a 32-bit windows machine?
>
> Thanks,
> --Michael
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M2-B876
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fhcrc.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From ripley at stats.ox.ac.uk  Wed Oct 27 07:52:21 2010
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 27 Oct 2010 06:52:21 +0100 (BST)
Subject: [Rd] windows 64-bit package build on 32-bit machine
In-Reply-To: <0CCBB231-E4E2-48FC-8E75-41EFA22AA57C@r-project.org>
References: <AANLkTina2USCfqaxerb-Q3X_5kdq6zD45AJy9gekiYRJ@mail.gmail.com>
	<0CCBB231-E4E2-48FC-8E75-41EFA22AA57C@r-project.org>
Message-ID: <alpine.LFD.2.00.1010270638270.15671@gannet.stats.ox.ac.uk>

On Tue, 26 Oct 2010, Simon Urbanek wrote:

>
> On Oct 26, 2010, at 9:04 PM, Michael Spiegel wrote:
>
>> Hello,
>>
>> Is it possible to build a 64-bit package on a 32-bit machine on
>> windows? I can cross-compile for x86, x86_64, and ppc on a 32-bit OS X
>> machine.  And it looks like I could build a 32-bit library on a 64-bit
>> windows machine.  But it doesn't look possible to build a 64-bit
>> library on a 32-bit windows machine?
>>
>
> Why not? It works for me without problems ...

Depends what is meant by 'build': I would pretty sure it does not mean 
'R CMD build': it might mean R CMD INSTALL --build.

What you can't do is test loading, so you need INSTALL --no-test-load. 
Multi-arch packages only test loading for the primary architecture, 
which is why you can install for ppc on Intel Mac OS X machines.  So 
you can INSTALL bi-arch packages on Windows on an i386 OS, but you 
cannot fully install a '64-bit package on a 32-bit machine on 
windows'.

Given that almst everybody who wants to distribute 64-bit packages 
nowadays wants bi-arch packages and needs access to a 64-bit OS for 
testing, we don't bother to test and document what other combinations 
might be possible.  (We don't make it easy for you to install a 
bi-arch R on a 32-bit OS either, to avoid end-user mistakes leading to 
increased support demands.)

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Wed Oct 27 07:56:50 2010
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 27 Oct 2010 06:56:50 +0100 (BST)
Subject: [Rd] Link to R 2.12.0 patched build for windows
In-Reply-To: <4CC76674.8060000@ohsu.edu>
References: <4CC76674.8060000@ohsu.edu>
Message-ID: <alpine.LFD.2.00.1010270652430.15671@gannet.stats.ox.ac.uk>

Wrong list.  Only the person who maintains that area (documented on 
the page above) can change this, and he is aware of it.

It is never correct to report problems about the CRAN website on 
R-devel: there is a contact address for the CRAN webmasters 
(CRAN-admin at r-project.org as I recall).

On Tue, 26 Oct 2010, Brian Diggs wrote:

> On the download page for windows builds of R 2.12.0:
>
> http://cran.r-project.org/bin/windows/base/
>
> The link for "r-patched snapshot build" goes to:
>
> http://cran.r-project.org/bin/windows/base/rpatched.html
>
> which has a link for R-2.11.1 patched.  I believe that link should go to:
>
> http://cran.r-project.org/bin/windows/base/rtest.html

That page should not currently be active.

> which does have a link for R-2.12.0 patched. Or the "rpatched.html" page 
> should be updated with a link to R-2.12.0 patched.
>
> -- 
> Brian S. Diggs, PhD
> Senior Research Associate, Department of Surgery
> Oregon Health & Science University
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From simon.urbanek at r-project.org  Wed Oct 27 09:20:39 2010
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Wed, 27 Oct 2010 03:20:39 -0400
Subject: [Rd] windows 64-bit package build on 32-bit machine
In-Reply-To: <AANLkTikp4=PVXJ-5Edbr6NfoPn-gcwRZMAV+peqc4rOP@mail.gmail.com>
References: <AANLkTina2USCfqaxerb-Q3X_5kdq6zD45AJy9gekiYRJ@mail.gmail.com>
	<0CCBB231-E4E2-48FC-8E75-41EFA22AA57C@r-project.org>
	<AANLkTikp4=PVXJ-5Edbr6NfoPn-gcwRZMAV+peqc4rOP@mail.gmail.com>
Message-ID: <8937DC4A-56FA-4C24-86DF-CEC90A7A7A33@r-project.org>


On Oct 26, 2010, at 11:10 PM, Michael Spiegel wrote:

> Hmm.  So our package does not have no src/Makefile.win and only an
> empty configure.win.  We usually build a binary version with R CMD
> INSTALL --build.
> 
> R --arch x64 CMD INSTALL --build yields the message "The system cannot
> find the path specified."
> 

Well, it probably means you don't have x64 binaries in your R - that has nothing to do with cross-compilation. You should make sure that you have both i386 and x64 archs in your R to start with.

Also I would not expect R --arch x64 to work regardless since you can't run 64-bit binary of R on 32-bit Windows. The same applies on OS X - you can cross compile for ppc64 (i.e. install multi-arch if the package has no Makefile/configure) but you can't run ppc64 R on Intel Macs (and hence you cannot install packages with configure/Makefile).

Cheers,
Simon



> On Tue, Oct 26, 2010 at 10:41 PM, Simon Urbanek
> <simon.urbanek at r-project.org> wrote:
>> 
>> On Oct 26, 2010, at 9:04 PM, Michael Spiegel wrote:
>> 
>>> Hello,
>>> 
>>> Is it possible to build a 64-bit package on a 32-bit machine on
>>> windows? I can cross-compile for x86, x86_64, and ppc on a 32-bit OS X
>>> machine.  And it looks like I could build a 32-bit library on a 64-bit
>>> windows machine.  But it doesn't look possible to build a 64-bit
>>> library on a 32-bit windows machine?
>>> 
>> 
>> Why not? It works for me without problems ...
>> 
>> Cheers,
>> Simon
>> 
>> 
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 


From murdoch.duncan at gmail.com  Wed Oct 27 14:26:12 2010
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Wed, 27 Oct 2010 08:26:12 -0400
Subject: [Rd] Link to R 2.12.0 patched build for windows
In-Reply-To: <4CC76674.8060000@ohsu.edu>
References: <4CC76674.8060000@ohsu.edu>
Message-ID: <4CC81A64.2030704@gmail.com>

On 26/10/2010 7:38 PM, Brian Diggs wrote:
> On the download page for windows builds of R 2.12.0:
>
> http://cran.r-project.org/bin/windows/base/
>
> The link for "r-patched snapshot build" goes to:
>
> http://cran.r-project.org/bin/windows/base/rpatched.html
>
> which has a link for R-2.11.1 patched.  I believe that link should go to:
>
> http://cran.r-project.org/bin/windows/base/rtest.html
>
> which does have a link for R-2.12.0 patched. Or the "rpatched.html" page
> should be updated with a link to R-2.12.0 patched.
>

There was a typo in one of the build scripts, which has now been fixed.  
The files should be fine later today or tomorrow.

Duncan Murdoch


From lawrence.michael at gene.com  Wed Oct 27 15:07:47 2010
From: lawrence.michael at gene.com (Michael Lawrence)
Date: Wed, 27 Oct 2010 06:07:47 -0700
Subject: [Rd] R-2.12.0 hangs while loading RGtk2 on FreeBSD
In-Reply-To: <4CC2AFB8.1060404@gwdg.de>
References: <4CC03E47.2010800@gwdg.de>
	<alpine.LFD.2.00.1010211508350.5999@toucan.stats.ox.ac.uk>
	<4CC052D6.3030106@gwdg.de>
	<alpine.LFD.2.00.1010211704340.7969@toucan.stats.ox.ac.uk>
	<4CC06D6A.8040609@gwdg.de>
	<AANLkTimAmo0ro2Tiw_rWAJ732R+ATRgNdS0SvuO6hYq+@mail.gmail.com>
	<4CC19D4B.6070605@gwdg.de> <4CC1EFD0.40400@gwdg.de>
	<4CC2AFB8.1060404@gwdg.de>
Message-ID: <AANLkTimWCP-XH+NcUNFA13Qq0Szhk_MPQ8_3dbAoUZMq@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20101027/06cdeb2b/attachment.pl>

From djsamperi at gmail.com  Wed Oct 27 19:22:08 2010
From: djsamperi at gmail.com (Dominick Samperi)
Date: Wed, 27 Oct 2010 13:22:08 -0400
Subject: [Rd] Sections 5.8.1 and 5.8.2 of Writing R Extensions (LinkingTo)
Message-ID: <AANLkTikcv4Pi5G4pcSn=Z6ie9gjgXeBBR7Kie78wOZaC@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20101027/68f4654b/attachment.pl>

From proebuck at mdanderson.org  Wed Oct 27 19:56:02 2010
From: proebuck at mdanderson.org (Roebuck,Paul L)
Date: Wed, 27 Oct 2010 12:56:02 -0500
Subject: [Rd] documentation for representation() typo
Message-ID: <C8EDD1E2.DFE4%proebuck@mdanderson.org>

<https://svn.r-project.org/R/trunk/src/library/methods/man/representation.R>


50c50
<  The value of \code{representation} is just the list of arguments
---
>  The value pf \code{representation}  is just the list of arguments, after
these have been checked


51c51
<  after these have been checked for validity.
---
>  for validity.


From simon.urbanek at r-project.org  Wed Oct 27 20:43:01 2010
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Wed, 27 Oct 2010 14:43:01 -0400
Subject: [Rd] Sections 5.8.1 and 5.8.2 of Writing R Extensions
	(LinkingTo)
In-Reply-To: <AANLkTikcv4Pi5G4pcSn=Z6ie9gjgXeBBR7Kie78wOZaC@mail.gmail.com>
References: <AANLkTikcv4Pi5G4pcSn=Z6ie9gjgXeBBR7Kie78wOZaC@mail.gmail.com>
Message-ID: <BC213552-F93E-4C22-939D-81F085F920D5@r-project.org>


On Oct 27, 2010, at 1:22 PM, Dominick Samperi wrote:

> Hello,
> 
> In Sections 5.8.1 and 5.8.2 of Writing R Extensions the following pattern is
> suggested
> for getting the path to a file in another package:
> 
> PKGB_PATH=?echo ?library(packB); cat(system.file("libs", package="packB"))?
> \
> | ${R_HOME}/bin/R --vanilla --slave?
> 
> Is the library(packB) really needed here?

Not that I'm aware of - it's just a check that that package can be used. If you omit it you will get an empty string and no error on failure.


> It is not needed on two systems
> that
> I have tested: Windows and Linux. What about MacOS?
> 
> If loading packB requires loading many other packages or doing expensive
> initialization it would be much more efficient if we could omit
> library(packB)
> here.
> 
> On the other hand, keeping library(packB) has one possible advantage,
> namely,
> it may eliminate the need to add packB.dll to the loader's search path.

Not really since that sub-process will die when finished so it won't have any effect on any search path.


BTW: system.file("libs",...)  doesn't do the job these days since it will be missing R_ARCH so you need something like
system.file("libs",.Platform$r_arch, package=...)
for any more recent R.

Cheers,
Simon


> So
> there
> is a trade-off of convenience vs efficiency.
> 
> Thanks,
> Dominick
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From rhurlin at gwdg.de  Wed Oct 27 21:09:07 2010
From: rhurlin at gwdg.de (Rainer Hurling)
Date: Wed, 27 Oct 2010 21:09:07 +0200
Subject: [Rd] R-2.12.0 hangs while loading RGtk2 on FreeBSD
In-Reply-To: <AANLkTimWCP-XH+NcUNFA13Qq0Szhk_MPQ8_3dbAoUZMq@mail.gmail.com>
References: <4CC03E47.2010800@gwdg.de>	<alpine.LFD.2.00.1010211508350.5999@toucan.stats.ox.ac.uk>	<4CC052D6.3030106@gwdg.de>	<alpine.LFD.2.00.1010211704340.7969@toucan.stats.ox.ac.uk>	<4CC06D6A.8040609@gwdg.de>	<AANLkTimAmo0ro2Tiw_rWAJ732R+ATRgNdS0SvuO6hYq+@mail.gmail.com>	<4CC19D4B.6070605@gwdg.de>	<4CC1EFD0.40400@gwdg.de>	<4CC2AFB8.1060404@gwdg.de>
	<AANLkTimWCP-XH+NcUNFA13Qq0Szhk_MPQ8_3dbAoUZMq@mail.gmail.com>
Message-ID: <4CC878D3.80107@gwdg.de>

On 27.10.2010 15:07 (UTC+1), Michael Lawrence wrote:
> On Sat, Oct 23, 2010 at 2:49 AM, Rainer Hurling <rhurlin at gwdg.de
> <mailto:rhurlin at gwdg.de>> wrote:
>     On 22.10.2010 22:10 (UTC+1), Rainer Hurling wrote:
>         On 22.10.2010 16:18 (UTC+2), Rainer Hurling wrote:
>             On 22.10.2010 14:57 (UTC+1), Michael Lawrence wrote:
>
>                 On Thu, Oct 21, 2010 at 9:42 AM, Rainer Hurling
>                 <rhurlin at gwdg.de <mailto:rhurlin at gwdg.de>
>                 <mailto:rhurlin at gwdg.de <mailto:rhurlin at gwdg.de>>> wrote:
>
>                 [moved from R-help]
>
>                 On 21.10.2010 18:09 (UTC+1), Prof Brian Ripley wrote:
>
>                 If you do R CMD INSTALL --no-test-load this will skip
>                 the part
>                 that is
>                 hanging and you can try loading in stages (e.g. dyn.load
>                 on the
>                 RGtk2.so).
>
>                 With '--no-test-load' it installs and ends normal.
>                 Loading per
>                 dyn.load("RGtk2.so") works, just as
>                 dyn.load("RGtk2.so",F) and
>                 dyn.load("RGtk2.so",,F). Unloading works, too.
>
>                 Normal loading over library(RGtk2) within R does not
>                 work. R than is
>                 hanging.
>
>                 It seems the problem is not with the library itself?
>
>                 It looks like something is happening when initializing
>                 GTK+ and the
>                 event loop. This happens in the function R_gtkInit in
>                 Rgtk.c. If you
>                 could run R -d gdb and break on that function, perhaps
>                 you could step
>                 through until it hangs.
>
>             Michael, thank you for answering. As I wrote earlier (on
>             R-help@),
>             unfortunately I have no experience with debugging (I am not a
>             programmer). So I would need some more assistence.
>
>             Is there a difference between 'library(RGtk2)' and
>             'dyn.load(RGtk2)' in
>             initializing GTK+? I am able to dyn.load, but library does
>             not work.
>
>             After starting with 'R -d gdb' is the following right?
>
>             (gdb) break R_gtkInit
>             Function "R_gtkInit" not defined.
>             Make breakpoint pending on future shared library load? (y or
>             [n]) y
>             Breakpoint 1 (R_gtkInit) pending.
>
>             When I try to proceed, it gives me the following message
>
>             (gdb) run
>             Starting program: /usr/local/lib/R/bin/exec/R
>             /libexec/ld-elf.so.1: Shared object "libRblas.so" not found,
>             required by "R"
>             Program exited with code 01.
>
>         Ok, I am one step further now:
>
>         (gdb) run
>         Starting program: /usr/local/lib/R/bin/exec/R
>         [..SNIP..]
>          > library(RGtk2)
>         [New LWP 100174]
>         Breakpoint 2 at 0x318bd490: file Rgtk.c, line 104.
>         Pending breakpoint "R_gtkInit" resolved
>         [New Thread 2f408b00 (LWP 100174)]
>         [Switching to Thread 2f408b00 (LWP 100174)]
>
>         Breakpoint 2, R_gtkInit (rargc=0x30b11d10, rargv=0x30a98458,
>         success=0x30afbad0) at Rgtk.c:104
>         104 Rgtk.c: No such file or directory.
>         in Rgtk.c
>         (gdb)
>
>         What do you suggest I should do next?
>
>     Rgtk.c was not found from gdb because RGtk2 was not build with
>     DEBUG=T and R_KEEP_PKG_SOURCE=yes.
>
>     So this is the next try. I can trace the code until it hangs:
>
>     library(RGtk2)
>     [New LWP 100250]
>     Breakpoint 2 at 0x458bd490: file Rgtk.c, line 104.
>
>     Pending breakpoint "R_gtkInit" resolved
>     [New Thread 4322ef00 (LWP 100250)]
>     [Switching to Thread 4322ef00 (LWP 100250)]
>
>     Breakpoint 2, R_gtkInit (rargc=0x446d0980, rargv=0x44698618,
>     success=0x446d09e0) at Rgtk.c:104
>     104     {
>     (gdb) n
>     107       argc = (int) *rargc;
>     (gdb) n
>     104     {
>     (gdb) n
>     107       argc = (int) *rargc;
>     (gdb) n
>     109       if (!gdk_display_get_default()) {
>     (gdb) n
>     110         gtk_disable_setlocale();
>     (gdb) n
>     111         if (!gtk_init_check(&argc, &rargv)) {
>     (gdb) n
>     121         if (!GDK_DISPLAY()) {
>     (gdb) n
>     127         addInputHandler(R_InputHandlers,
>     ConnectionNumber(GDK_DISPLAY()),
>     (gdb) n
>     132         if (!pipe(fds)) {
>     (gdb) n
>     133           ifd = fds[0];
>     (gdb) n
>     134           ofd = fds[1];
>     (gdb) n
>     135           addInputHandler(R_InputHandlers, ifd,
>     R_gtk_timerInputHandler, 32);
>     (gdb) n
>     133           ifd = fds[0];
>     (gdb) n
>     134           ofd = fds[1];
>     (gdb) n
>     135           addInputHandler(R_InputHandlers, ifd,
>     R_gtk_timerInputHandler, 32);
>     (gdb) n
>     136           if (!g_thread_supported ()) g_thread_init (NULL);
>     (gdb) n
>     137           g_thread_create(R_gtk_timerThreadFunc, NULL, FALSE, NULL);
>     (gdb) n
>
>     Line 138 (R_CStackLimit = -1;) is hanging. It seems there is
>     something wrong with piping the file descriptor?
>
> Thanks for looking into this. It looks like the g_thread_create line is
> hanging. I wonder if your version of GTK+/GLib is not built with
> threading support? But if that were the case, g_thread_init() should
> have aborted. You could try breaking on the R_gtk_timerThreadFunc just
> to see if the thread is executed at all or where it is hanging.


Michael, I have to thank you :-)  I set a break at 
'R_gtk_timerThreadFunc'. It seems this function does not return:


[..see above..]
library(RGtk2)
[New LWP 100172]
Breakpoint 2 at 0x458bd5c0: file Rgtk.c, line 78.
Pending breakpoint "R_gtk_timerThreadFunc" resolved
[New Thread 4322ef00 (LWP 100172)]
[..hanging from here on..]


Next I tried a new run with break at 'g_main_context_new' (line 79), 
which steps into glib-2.0.so.0, before it hangs:


library(RGtk2)
[New LWP 100195]
Breakpoint 2 at 0x47c7c660
Pending breakpoint "g_main_context_new" resolved
[New Thread 4322ef00 (LWP 100195)]
[Switching to Thread 4322ef00 (LWP 100195)]
Breakpoint 2, 0x0000000047c7c660 in g_main_context_new () from 
/usr/local/lib/libglib-2.0.so.0
(gdb) n
Single stepping until exit from function g_main_context_new,
which has no line number information.
0x0000000047c7aed0 in g_source_set_priority () from 
/usr/local/lib/libglib-2.0.so.0
(gdb) n
Single stepping until exit from function g_source_set_priority,
which has no line number information.
0x0000000047c7ac70 in g_main_loop_quit () from 
/usr/local/lib/libglib-2.0.so.0
(gdb) n
Single stepping until exit from function g_main_loop_quit,
which has no line number information.
0x0000000047c7a280 in g_source_get_context () from 
/usr/local/lib/libglib-2.0.so.0
(gdb) n
Single stepping until exit from function g_source_get_context,
which has no line number information.
0x0000000047c7c6f3 in g_main_context_new () from 
/usr/local/lib/libglib-2.0.so.0
(gdb) p ctx
No symbol "ctx" in current context.
(gdb) p data
No symbol "data" in current context.
(gdb) n
Single stepping until exit from function g_main_context_new,
which has no line number information.
0x0000000047c7c8b2 in g_main_context_default () from 
/usr/local/lib/libglib-2.0.so.0
(gdb) n
Single stepping until exit from function g_main_context_default,
which has no line number information.
0x0000000047c7dea5 in g_source_attach () from 
/usr/local/lib/libglib-2.0.so.0
(gdb) n
Single stepping until exit from function g_source_attach,
which has no line number information.
0x0000000047c79c50 in g_list_remove_link () from 
/usr/local/lib/libglib-2.0.so.0
(gdb) n
Single stepping until exit from function g_list_remove_link,
which has no line number information.
0x0000000047c7dde6 in g_source_attach () from 
/usr/local/lib/libglib-2.0.so.0
(gdb) n
Single stepping until exit from function g_source_attach,
which has no line number information.
0x0000000047c7ac70 in g_main_loop_quit () from 
/usr/local/lib/libglib-2.0.so.0
(gdb) n
Single stepping until exit from function g_main_loop_quit,
which has no line number information.
0x0000000047c7a280 in g_source_get_context () from 
/usr/local/lib/libglib-2.0.so.0
(gdb) n
Single stepping until exit from function g_source_get_context,
which has no line number information.
0x0000000047c7de00 in g_source_attach () from 
/usr/local/lib/libglib-2.0.so.0
(gdb) n
Single stepping until exit from function g_source_attach,
which has no line number information.
0x0000000047c7a280 in g_source_get_context () from 
/usr/local/lib/libglib-2.0.so.0
(gdb) n
Single stepping until exit from function g_source_get_context,
which has no line number information.
0x0000000047c7de11 in g_source_attach () from 
/usr/local/lib/libglib-2.0.so.0
(gdb) n
Single stepping until exit from function g_source_attach,
which has no line number information.
0x000000004608eec8 in gdk_add_client_message_filter () from 
/usr/local/lib/libgdk-x11-2.0.so.0
(gdb) n
Single stepping until exit from function gdk_add_client_message_filter,
which has no line number information.
[..hanging from here on..]


Is there an easy way to find out if GTK+/GLib is built with threading 
support?

Thanks, Rainer


> Thanks again for taking the time to work on this. Sorry I have been
> non-responsive.
>
> Michael

[..mail deleted from here on..]


From djsamperi at gmail.com  Wed Oct 27 21:17:24 2010
From: djsamperi at gmail.com (Dominick Samperi)
Date: Wed, 27 Oct 2010 15:17:24 -0400
Subject: [Rd] Sections 5.8.1 and 5.8.2 of Writing R Extensions
	(LinkingTo)
In-Reply-To: <BC213552-F93E-4C22-939D-81F085F920D5@r-project.org>
References: <AANLkTikcv4Pi5G4pcSn=Z6ie9gjgXeBBR7Kie78wOZaC@mail.gmail.com>
	<BC213552-F93E-4C22-939D-81F085F920D5@r-project.org>
Message-ID: <AANLkTimcqF_M7Hj0hAJekivG9u0HMvKph2bAYscZ4THH@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20101027/a36730df/attachment.pl>

From hb at stat.berkeley.edu  Wed Oct 27 21:54:15 2010
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Wed, 27 Oct 2010 12:54:15 -0700
Subject: [Rd] Documentation of option 'help.ports' not in help("options")
Message-ID: <AANLkTin0f_qrpjKH9PSaAZD6FQ7UkegY7-xVKRUryfs+@mail.gmail.com>

FYI,

the option 'help.ports' is not document under help("options").  Should
it?  It is documented under help("startDynamicHelp", package="tools").

This is for for R v2.13.0dev and Rv2.12.0.

/Henrik


From atp at piskorski.com  Thu Oct 28 01:43:47 2010
From: atp at piskorski.com (Andrew Piskorski)
Date: Wed, 27 Oct 2010 19:43:47 -0400
Subject: [Rd] must .Call C functions return SEXP?
Message-ID: <20101027234347.GA69179@piskorski.com>

For using R's .Call interface to C functions, all the examples I've
seen have the C function return type SEXP.  Why?  What does R actually
do with this return type?  What happens if I *don't* return a SEXP?

Reason I ask, is I've written some R code which allocates two long
lists, and then calls a C function with .Call.  My C code writes to
those two pre-allocated lists, thus, I thought I should NOT need to
return any SEXP from my C function.  However, if I do that, it
segfaults somewhere in "src/main/memory.c".

If I instead return the SEXP for one of my two result lists it appears
to work fine...  But of course I don't understand what's going on here
and so don't trust it.  The list SEXP I am returning was allocated by
R, not by my C code, so why does it make any difference whether my C
function returns it or not?

>From "src/main/names.c" I see that .Call is implemented by do_dotcall
in "src/main/dotcode.c".  I don't necessarily understand what that
really does, but AFAICT if my C function returns nothing, the
do_dotcall's retval should simply remain set to R_NilValue, which
should be fine.

I must be misunderstanding something here, but I don't know what, and
would definitely appreciate any help.  Thanks!


My R code looks like this:

  result.1 <- vector("list" ,1e6)
  result.2 <- vector("list" ,1e6)
  .Call("my_C_function", result.1, result.2, other.input)

My C code looks like this:

  SEXP result_v; 
  result_v = Rf_allocVector(REALSXP, 5); 
  SET_VECTOR_ELT(result_list_1, k1, result_v); 
  REAL(result_v)[0] = some_number; 
  REAL(result_v)[1] = another_number; 
  /* Also do the same sort of thing for result_list_2. */
  return(result_list_1);  /* Appears to work ok. */
  /* return; */  /* Segfaults. */

-- 
Andrew Piskorski <atp at piskorski.com>
http://www.piskorski.com/


From edd at debian.org  Thu Oct 28 02:19:51 2010
From: edd at debian.org (Dirk Eddelbuettel)
Date: Wed, 27 Oct 2010 19:19:51 -0500
Subject: [Rd] must .Call C functions return SEXP?
In-Reply-To: <20101027234347.GA69179@piskorski.com>
References: <20101027234347.GA69179@piskorski.com>
Message-ID: <19656.49575.207641.296016@max.nulle.part>


On 27 October 2010 at 19:43, Andrew Piskorski wrote:
| For using R's .Call interface to C functions, all the examples I've
| seen have the C function return type SEXP.  Why?  What does R actually
| do with this return type?  What happens if I *don't* return a SEXP?
| 
| Reason I ask, is I've written some R code which allocates two long
| lists, and then calls a C function with .Call.  My C code writes to
| those two pre-allocated lists, thus, I thought I should NOT need to
| return any SEXP from my C function.  However, if I do that, it
| segfaults somewhere in "src/main/memory.c".
| 
| If I instead return the SEXP for one of my two result lists it appears
| to work fine...  But of course I don't understand what's going on here
| and so don't trust it.  The list SEXP I am returning was allocated by
| R, not by my C code, so why does it make any difference whether my C
| function returns it or not?
| 
| >From "src/main/names.c" I see that .Call is implemented by do_dotcall
| in "src/main/dotcode.c".  I don't necessarily understand what that
| really does, but AFAICT if my C function returns nothing, the
| do_dotcall's retval should simply remain set to R_NilValue, which
| should be fine.
| 
| I must be misunderstanding something here, but I don't know what, and
| would definitely appreciate any help.  Thanks!
| 
| 
| My R code looks like this:
| 
|   result.1 <- vector("list" ,1e6)
|   result.2 <- vector("list" ,1e6)
|   .Call("my_C_function", result.1, result.2, other.input)
| 
| My C code looks like this:
| 
|   SEXP result_v; 
|   result_v = Rf_allocVector(REALSXP, 5); 
|   SET_VECTOR_ELT(result_list_1, k1, result_v); 
|   REAL(result_v)[0] = some_number; 
|   REAL(result_v)[1] = another_number; 
|   /* Also do the same sort of thing for result_list_2. */
|   return(result_list_1);  /* Appears to work ok. */
|   /* return; */  /* Segfaults. */


I don't deal with the C API when I can avoid it. Here is your setup in a
simple, self-contanined Rcpp example using inline:

-----------------------------------------------------------------------------

library(inline)

# body of C++ function
src <- 'Rcpp::NumericVector vc = Rcpp::NumericVector(vr);
        Rcpp::IntegerVector wc = Rcpp::IntegerVector(wr);

        vc[1] = 2*vc[1];
        wc[2] = 3*wc[2];

        return Rcpp::wrap(0L);
        '

# create it
fun <- cxxfunction(signature(vr="numeric", wr="integer"), src, plugin="Rcpp")

vr <- seq(1.5, 3.5)
wr <- seq(1L,  3L)

# call it 
print(fun(vr, wr))
print(vr)
print(wr)

-----------------------------------------------------------------------------

We create 'vr' and 'wr' at the R level, pass them to C++ where they are taken
as numeric and int vectors (with type checking and casts).   

Your hunch is correct -- SEXP pointer changes continue back to the R level.
We do return something (R_NilValue is an option too) as that is how .Call()
declared, pure and simple.

If I run this in my emacs shell buffer, I get this:

-----------------------------------------------------------------------------
edd at max:~$ r /tmp/andrew.R 
Loading required package: methods
[1] 0
[1] 1.5 5.0 3.5
[1] 1 2 9
edd at max:~$ 
-----------------------------------------------------------------------------

First the zero, then the two (changed) vectors even though I didn't
explicitly return them. So this does work -- but I don't like hidden side
effects.  Much better, in my book, to explicitly return as you'd do with

    return Rcpp::List::create(Rcpp::Named("newv"=vc,
                              Rcpp::Named("neww"=wc)));

which will get you a named list at the R level.

Feel free to come over to rcpp-devel is you have questions about the Rcpp and
inline parts.

Dirk

-- 
Dirk Eddelbuettel | edd at debian.org | http://dirk.eddelbuettel.com


From therneau at mayo.edu  Thu Oct 28 04:43:35 2010
From: therneau at mayo.edu (Terry Therneau)
Date: Wed, 27 Oct 2010 21:43:35 -0500
Subject: [Rd] Rbuildignore and mercurial
Message-ID: <201010280243.o9S2hZc7010877@punchbuggy.mayo.edu>

  I've changed to Mercurial for my working copies of survival for a number or resons not relevant to this post.  When I do R CMD check, I get some warnings
about certain files in the .hg directory with odd names.  I've added the following 2 lines to my .Rbuildignore file without effect
^\.hg$
^\.hg.*

I'm not a Perl user so perhaps I'm reading the help page wrong.  Any pointers?
This doesn't affect Rforge since I don't push any of those files up to there.

Terry T.


From ggrothendieck at gmail.com  Thu Oct 28 05:06:15 2010
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Wed, 27 Oct 2010 23:06:15 -0400
Subject: [Rd] Rbuildignore and mercurial
In-Reply-To: <201010280243.o9S2hZc7010877@punchbuggy.mayo.edu>
References: <201010280243.o9S2hZc7010877@punchbuggy.mayo.edu>
Message-ID: <AANLkTinRA6LJVaFuObQtpTRSinZmLDmP1i-ydhf=LSMA@mail.gmail.com>

On Wed, Oct 27, 2010 at 10:43 PM, Terry Therneau <therneau at mayo.edu> wrote:
> ?I've changed to Mercurial for my working copies of survival for a number or resons not relevant to this post. ?When I do R CMD check, I get some warnings
> about certain files in the .hg directory with odd names. ?I've added the following 2 lines to my .Rbuildignore file without effect
> ^\.hg$
> ^\.hg.*
>
> I'm not a Perl user so perhaps I'm reading the help page wrong. ?Any pointers?
> This doesn't affect Rforge since I don't push any of those files up to there.
>

.hg files are automatically excluded from the build so if you were to
check your built file, i.e. your .tar.gz file, instead then you should
not need any .Rbuildignore file in the first place.

-- 
Statistics & Software Consulting
GKX Group, GKX Associates Inc.
tel: 1-877-GKX-GROUP
email: ggrothendieck at gmail.com


From hadley at rice.edu  Thu Oct 28 06:12:40 2010
From: hadley at rice.edu (Hadley Wickham)
Date: Wed, 27 Oct 2010 22:12:40 -0600
Subject: [Rd] Rbuildignore and mercurial
In-Reply-To: <201010280243.o9S2hZc7010877@punchbuggy.mayo.edu>
References: <201010280243.o9S2hZc7010877@punchbuggy.mayo.edu>
Message-ID: <AANLkTi=tczN=HeD7wV3aFPMwih=b=299H12Arj8Z_s5+@mail.gmail.com>

> ?I've changed to Mercurial for my working copies of survival for a number or resons not relevant to this post. ?When I do R CMD check, I get some warnings
> about certain files in the .hg directory with odd names. ?I've added the following 2 lines to my .Rbuildignore file without effect
> ^\.hg$
> ^\.hg.*

Unfortunately that only affects building, not checking.  You have two
options: (1) ignore the warning (2) check the built package.

Hadley

-- 
Assistant Professor / Dobelman Family Junior Chair
Department of Statistics / Rice University
http://had.co.nz/


From simon.urbanek at r-project.org  Thu Oct 28 06:15:56 2010
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Thu, 28 Oct 2010 00:15:56 -0400
Subject: [Rd] must .Call C functions return SEXP?
In-Reply-To: <20101027234347.GA69179@piskorski.com>
References: <20101027234347.GA69179@piskorski.com>
Message-ID: <1E6722DD-D3E2-4BDD-A9BE-C07271B3D1FC@r-project.org>


On Oct 27, 2010, at 7:43 PM, Andrew Piskorski wrote:

> For using R's .Call interface to C functions, all the examples I've
> seen have the C function return type SEXP.  Why?  What does R actually
> do with this return type?  What happens if I *don't* return a SEXP?
> 

You are breaking the API = bad things happen.

.Call behaves like any function in R which means it takes arguments are returns a value. The result of .Call will be exactly the SEXP that you return from your C code hence you have to return something. It's quite common to R_NilValue which is NULL in R if you have nothing to do.


> Reason I ask, is I've written some R code which allocates two long
> lists, and then calls a C function with .Call.  My C code writes to
> those two pre-allocated lists,

That's bad! All arguments are essentially read-only so you should never write into them! R has pass-by-value(!) semantics, so semantically you code has nothing to do with the result.1 and result.2 variables since only their *values* are guaranteed to be passed (possibly a copy). The fact that internally R attempts to avoid copying for performance reasons is the only reason why your code may have appeared to work, but it's invalid!

So what you really want to do is to have just

.Call("my_C_function", other.input)

and in your C code you have

SEXP result_1 = PROTECT(allocVector(VECSXP, 1e6));
SEXP result_2 = PROTECT(allocVector(VECSXP, 1e6));

/* do something ... */

and in order to pass it out you just create a list and return it:

SEXP result = PROTECT(allocVector(VECSXP, 2));
SET_VECTOR_ELT(result, 0, result_1);
SET_VECTOR_ELT(result, 1, result_2);
UNPROTECT(3);
return result;


Accordingly you get:
l = .Call("my_C_function", other.input)
result_1 = l[[1]]
result_2 = l[[2]]


Cheers,
Simon



> thus, I thought I should NOT need to
> return any SEXP from my C function.  However, if I do that, it
> segfaults somewhere in "src/main/memory.c".
> 
> If I instead return the SEXP for one of my two result lists it appears
> to work fine...  But of course I don't understand what's going on here
> and so don't trust it.  The list SEXP I am returning was allocated by
> R, not by my C code, so why does it make any difference whether my C
> function returns it or not?
> 
>> From "src/main/names.c" I see that .Call is implemented by do_dotcall
> in "src/main/dotcode.c".  I don't necessarily understand what that
> really does, but AFAICT if my C function returns nothing, the
> do_dotcall's retval should simply remain set to R_NilValue, which
> should be fine.
> 
> I must be misunderstanding something here, but I don't know what, and
> would definitely appreciate any help.  Thanks!
> 
> 
> My R code looks like this:
> 
>  result.1 <- vector("list" ,1e6)
>  result.2 <- vector("list" ,1e6)
>  .Call("my_C_function", result.1, result.2, other.input)
> 
> My C code looks like this:
> 
>  SEXP result_v; 
>  result_v = Rf_allocVector(REALSXP, 5); 
>  SET_VECTOR_ELT(result_list_1, k1, result_v); 
>  REAL(result_v)[0] = some_number; 
>  REAL(result_v)[1] = another_number; 
>  /* Also do the same sort of thing for result_list_2. */
>  return(result_list_1);  /* Appears to work ok. */
>  /* return; */  /* Segfaults. */
> 
> -- 
> Andrew Piskorski <atp at piskorski.com>
> http://www.piskorski.com/
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 


From djsamperi at gmail.com  Thu Oct 28 08:27:47 2010
From: djsamperi at gmail.com (Dominick Samperi)
Date: Thu, 28 Oct 2010 02:27:47 -0400
Subject: [Rd] TEXINPUTS and Sweave
Message-ID: <AANLkTi=aYGWVtBFihL2q-eT30pi_s-6j97U3QgvZ4JTX@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20101028/3c9d0355/attachment.pl>

From spinuvit.list at gmail.com  Thu Oct 28 11:49:52 2010
From: spinuvit.list at gmail.com (Vitalie S.)
Date: Thu, 28 Oct 2010 11:49:52 +0200
Subject: [Rd] expressions as active bindings?
Message-ID: <cpnd3qu63zz.fsf@gmail.com>


Hello everyone!

Would it be possible some day to use expressions as active bindings?
Something like

  makeActiveExpression("foo", Expr0,  env)

where Expr0 is executed in _env_ whenever "foo" is refereed.

The motivation for this question is fourfold:
 - need to use <<- if the active binding is a function,
 - need to create objects in the environments beforehand, to make sure <<- does
 not assign them in a wrong place.
 - need to set the environment for function
 - active expressions would be faster (would not require the function invocation)

 
So instead of :

te <- new.env()
te$tempa <- 0
myfun <- function(x){tempa <<- 33}
environment(myfun) <- te
makeActiveBinding("a", myfun, te)

one would just use:

makeActiveExpression("a", tempa <- 33) ? 



I noticed that active bindings are very fast:

te$b <- expression(tempb <- 55)
system.time(evalq(for(i in 1:1e5) a, te))
   user  system elapsed 
   0.14    0.00    0.14 
system.time(evalq(for(i in 1:1e5) eval(b), te))
   user  system elapsed 
   0.57    0.02    0.57 

So, I would assume the active expressions would be even faster.

Thanks,
Vitalie.


From atp at piskorski.com  Thu Oct 28 15:48:21 2010
From: atp at piskorski.com (Andrew Piskorski)
Date: Thu, 28 Oct 2010 09:48:21 -0400
Subject: [Rd] must .Call C functions return SEXP?
In-Reply-To: <1E6722DD-D3E2-4BDD-A9BE-C07271B3D1FC@r-project.org>
References: <20101027234347.GA69179@piskorski.com>
	<1E6722DD-D3E2-4BDD-A9BE-C07271B3D1FC@r-project.org>
Message-ID: <20101028134821.GA49312@piskorski.com>

On Thu, Oct 28, 2010 at 12:15:56AM -0400, Simon Urbanek wrote:

> > Reason I ask, is I've written some R code which allocates two long
> > lists, and then calls a C function with .Call.  My C code writes to
> > those two pre-allocated lists,

> That's bad! All arguments are essentially read-only so you should
> never write into them! 

I don't see how.  (So, what am I missing?)  The R docs themselves
state that the main point of using .Call rather than .C is that .Call
does not do any extra copying and gives one direct access to the R
objects.  (This is indeed very useful, e.g. to reorder a large matrix
in seconds rather than hours.)

I could allocate the two lists in my C code, but so far it was more
convenient to so in R.  What possible difference in behavior can there
be between the two approaches?

> R has pass-by-value(!) semantics, so semantically you code has
> nothing to do with the result.1 and result.2 variables since only
> their *values* are guaranteed to be passed (possibly a copy).

Clearly C code called from .Call must be allowed to construct R
objects, as that's how much of R itself is implemented, and further
down, it's what you recommend I should do instead.

But why does it follow that C code must never modify an object
initially allocated by R code?  Are you saying there is some special
magic difference in the state of an object allocated by R's C code
vs. one allocated by R code?  If so, what is it?

What is the potential problem here, that the garbage collector will
suddenly run while my C code is in the middle of writing to an R list?
Yes, if the gc is going to move the object elsewhere, that would be
very bad.  But it looks to me like that cannot happen, because lots of
the R implementation itself would fail badly if it did.

E.g.:  The PROTECT call is used to increment reference counts, but I
see no guarantees that it is atomic with the operations that allocate
objects.  I see no mutexes or other barriers in C code to prevent the
gc from running, thus implying that it *can't* run until the C
function completes.

And R is single threaded, of course.  But what about signal handlers,
could they ever invoke R's gc?

Also, I was initially surprised not to find any matrix C APIs, but
grepping for examples (sorry, I don't remember exactly which
functions) showed me that the apparently accepted way to do matrix
operations from C is to simply assume R's column-first dense matrix
order, and access the 2D matrix as a flat 1D vector.  (Which is easy.)

> The fact that internally R attempts to avoid copying for performance
> reasons is the only reason why your code may have appeared to work,
> but it's invalid!

I will probably change my code to allocate a new list from the C code
and return that, as you recommend.  My main reason for doing the
allocation in R was just that it was simpler, especially given the
very limited documentation of R's C API.

But, I didn't see anything in the "Writing R Extensions" doc saying
that what my code is doing is "invalid", and more importantly, I don't
see why it would or should be invalid...

I'd still like to better understand why you think doing the initial
allocation of an object in R rather than C code is such a problem.  So
far, I don't see any way that the R interpreter could ever tell the
difference.

Wait, or is the only objection here that I'm using C in a way that
makes pass-by-reference semantics visible to my R code?  Which will
work completely correctly, but is not the The Proper R Way?

I don't actually need pass-by-reference behavior here at all, but I
can imagine cases where I might want it, so I'd like to understand
your objections better.  Is using C to implement pass-by-reference
actually Broken, or merely Ugly?  From my reasons above, I think it
will always work correctly and thus is not Broken.  But of course
given R's devotion to pass-by-value, it could be considered
unacceptably Ugly.

-- 
Andrew Piskorski <atp at piskorski.com>
http://www.piskorski.com/


From bearlee at alum.mit.edu  Thu Oct 28 16:13:43 2010
From: bearlee at alum.mit.edu (Daniel Lee)
Date: Thu, 28 Oct 2010 10:13:43 -0400
Subject: [Rd] Reference Classes: Generalizing Reference Class Generator
	objects?
Message-ID: <4CC98517.3050605@alum.mit.edu>

Is it possible to override the $new(...) in the reference class 
generator? I have tried adding a "new" method to the methods of the 
class, but that is obviously not correct. I have also tried adding it to 
the class generator, but the class generator still uses the default 
constructor.

As a simple example, this is the current interface:
TestClass <- setRefClass ("TestClass",
         fields = list (text = "character"),
         methods = list (
                 print = function ()  {cat(text)})
)
test <- TestClass$new (text="Hello World")
test$print()

I would like to override $new(...) to be something like (add a "\n" to 
the end of the input, no need to specify input fields):
TestClass$methods (new = function (text) {
             text <- paste (text, "\n")
             methods:::new (def, text=text)
         })

The constructor would then be:
test <- TestClass$new ("Hello World")

This is a subtle, but useful change. I have also tried adding to 
TestClass a method $newInstance(text), but that was not successful. If 
this is not possible, could we consider augmenting the Reference Class 
interface to include constructors?


From simon.urbanek at r-project.org  Thu Oct 28 16:59:26 2010
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Thu, 28 Oct 2010 10:59:26 -0400
Subject: [Rd] must .Call C functions return SEXP?
In-Reply-To: <20101028134821.GA49312@piskorski.com>
References: <20101027234347.GA69179@piskorski.com>
	<1E6722DD-D3E2-4BDD-A9BE-C07271B3D1FC@r-project.org>
	<20101028134821.GA49312@piskorski.com>
Message-ID: <14761267-D550-4BAC-9498-F1E0D32465E3@r-project.org>


On Oct 28, 2010, at 9:48 AM, Andrew Piskorski wrote:

> On Thu, Oct 28, 2010 at 12:15:56AM -0400, Simon Urbanek wrote:
> 
>>> Reason I ask, is I've written some R code which allocates two long
>>> lists, and then calls a C function with .Call.  My C code writes to
>>> those two pre-allocated lists,
> 
>> That's bad! All arguments are essentially read-only so you should
>> never write into them! 
> 
> I don't see how.  (So, what am I missing?)  The R docs themselves
> state that the main point of using .Call rather than .C is that .Call
> does not do any extra copying and gives one direct access to the R
> objects.  (This is indeed very useful, e.g. to reorder a large matrix
> in seconds rather than hours.)
> 

Exactly - direct access without copying which means that you are responsible for not modifying anything you don't own. Again, remember that R has copy by value semantics so functions can never modify their arguments (at least from user's point of view).


> I could allocate the two lists in my C code, but so far it was more convenient to so in R.  

You don't just allocate them, you also assign them to an environment which is where the trouble starts. Let's look at a very simple example:

/* do NOT do that kids!! */
SEXP foo(SEXP x) {
  REAL(x)[0] = 1;
  return x;
}

The expected behavior if R was not performing any tricks behind the scenes should be in theory:

> a = 0
> .Call("foo", a)
[1] 1
> a
[1] 0

The reason is that in the S language all arguments are passed by value so .Call("foo", a) really means .Call("foo", 0) so you only change the "0" but not a. However, R attempts to prevent copying so both the environment holding "a" *and* the argument passed to .Call will share memory.
Now, why is it a bad idea to modify arguments? This is why (this is actually run in R):

> a = 0
> b = a
> .Call("foo", a)
[1] 1
> a
[1] 1
> b
[1] 1

Because R assumes that you don't mess with the arguments, it also optimizes b to point to the same object as a which you then modify. Therefor the moment you start modifying argument all bets are off, because you cannot know which objects have been optimized to share the same memory so you don't know what else you'll modify. (More on how you can detect it further down).

There are also rational problems with that:
> .Call("foo", 0)
[1] 1
How can you change a "0" constant to 1 ?!?


> What possible difference in behavior can there be between the two approaches?
> 

The only way to allocate vectors is with things like numeric(10) but you may *not* assign it anywhere - that's why .C uses construct like .C(numeric(10), ...) to create result space for DUP=FALSE but the only reason to do so is because it has no choice. You could call .Call(numeric(10), ...) but that sort of defeats the purpose and is somewhat dangerous from user's point of view since your C code would assume that you don't pass anything else (like a variable or a constant) but a "malicious" user could pass anything...


>> R has pass-by-value(!) semantics, so semantically you code has
>> nothing to do with the result.1 and result.2 variables since only
>> their *values* are guaranteed to be passed (possibly a copy).
> 
> Clearly C code called from .Call must be allowed to construct R
> objects, as that's how much of R itself is implemented, and further
> down, it's what you recommend I should do instead.
> 
> But why does it follow that C code must never modify an object
> initially allocated by R code?  Are you saying there is some special
> magic difference in the state of an object allocated by R's C code
> vs. one allocated by R code?  If so, what is it?
> 

It's magic of all objects - regardless where they are allocated - and it is essentially the NAMED bits that decide whether an object is to be copied or not. The object you passed from R was not "yours" in that it was shared with the environment you assigned it to (using result.1 <- ..) and your function. If you allocate it in C you know that it's not owned by anyone else so you can safely modify it.

Now, we can go more into the internals and you can actually use NAMED to detect the cases. I'm still not recommending it for the use you mentioned (mostly because it may change without notice), but it should give you the full picture. Let's modify the example above by adding Rprintf("NAMED=%d\n", NAMED(x));

Here are the different cases:

> .Call("foo", numeric(1))
NAMED=0
[1] 1
# numeric(1) is a direct allocation so it has no reference

> a = numeric(1)
> .Call("foo", a)
NAMED=1
[1] 1
# numeric(1) was direct allocation then assigned to a - so it has one reference

> b = a
> .Call("foo", a)
NAMED=2
[1] 1
# the numeric(1) value in both a and b has now two references
# note that it is not a real reference count - it has only the three states above, so removing b doesn't help

> .Call("foo", 1)
NAMED=2
[1] 1
# constants are always flagged to duplicate because they all could share memory (the real story is a bit different but that's one explanation ;))

So if you wanted to optimize you could treat the above cases differently and, yes, using a=numeric(1); .Call("foo",a) *should* have NAMED=1 and thus be safe to modify - but I would worry about any code that doesn't check that since it can have unwanted effects without anyone noticing.


> What is the potential problem here, that the garbage collector will suddenly run while my C code is in the middle of writing to an R list? Yes, if the gc is going to move the object elsewhere, that would be very bad.

GC doesn't move anything - it only releases unreferenced objects.


>  But it looks to me like that cannot happen, because lots of the R implementation itself would fail badly if it did.
> 
> E.g.:  The PROTECT call is used to increment reference counts,

There are no reference counts in R, PROTECT just adds the object to the protection stack (which is that same as adding it to any list or vector that is protected).


> but I see no guarantees that it is atomic with the operations that allocate objects.  I see no mutexes or other barriers in C code to prevent the gc from running, thus implying that it *can't* run until the C function completes. And R is single threaded, of course.  But what about signal handlers, could they ever invoke R's gc?

C code cannot be interrupted exactly for this reason. However, gc can occur in any call to R API which is why PROTECT is needed in those cases.


> Also, I was initially surprised not to find any matrix C APIs, but grepping for examples (sorry, I don't remember exactly which functions) showed me that the apparently accepted way to do matrix operations from C is to simply assume R's column-first dense matrix order, and access the 2D matrix as a flat 1D vector.  (Which is easy.)
> 

Yes, that's what most sane programs handling matrices do ;).


>> The fact that internally R attempts to avoid copying for performance
>> reasons is the only reason why your code may have appeared to work,
>> but it's invalid!
> 
> I will probably change my code to allocate a new list from the C code
> and return that, as you recommend.  My main reason for doing the
> allocation in R was just that it was simpler, especially given the
> very limited documentation of R's C API.
> 
> But, I didn't see anything in the "Writing R Extensions" doc saying
> that what my code is doing is "invalid", and more importantly, I don't
> see why it would or should be invalid...
> 
> I'd still like to better understand why you think doing the initial
> allocation of an object in R rather than C code is such a problem.  So
> far, I don't see any way that the R interpreter could ever tell the
> difference.
> 
> Wait, or is the only objection here that I'm using C in a way that
> makes pass-by-reference semantics visible to my R code?  Which will
> work completely correctly, but is not the The Proper R Way?
> 

See above - it breaks the assumptions that R makes so you can change things you don't intend to. Also the internal optimizations may change in the future so I would not count on it.


> I don't actually need pass-by-reference behavior here at all, but I
> can imagine cases where I might want it, so I'd like to understand
> your objections better.  Is using C to implement pass-by-reference
> actually Broken, or merely Ugly?  From my reasons above, I think it
> will always work correctly and thus is not Broken.  But of course
> given R's devotion to pass-by-value, it could be considered
> unacceptably Ugly.
> 


I hope it sheds some light on it.

Cheers,
Simon


From wdunlap at tibco.com  Thu Oct 28 17:28:11 2010
From: wdunlap at tibco.com (William Dunlap)
Date: Thu, 28 Oct 2010 08:28:11 -0700
Subject: [Rd] must .Call C functions return SEXP?
In-Reply-To: <20101028134821.GA49312@piskorski.com>
References: <20101027234347.GA69179@piskorski.com><1E6722DD-D3E2-4BDD-A9BE-C07271B3D1FC@r-project.org>
	<20101028134821.GA49312@piskorski.com>
Message-ID: <77EB52C6DD32BA4D87471DCD70C8D7000393FB14@NA-PA-VBE03.na.tibco.com>

> -----Original Message-----
> From: r-devel-bounces at r-project.org 
> [mailto:r-devel-bounces at r-project.org] On Behalf Of Andrew Piskorski
> Sent: Thursday, October 28, 2010 6:48 AM
> To: Simon Urbanek
> Cc: r-devel at r-project.org
> Subject: Re: [Rd] must .Call C functions return SEXP?
> 
> On Thu, Oct 28, 2010 at 12:15:56AM -0400, Simon Urbanek wrote:
> 
> > > Reason I ask, is I've written some R code which allocates two long
> > > lists, and then calls a C function with .Call.  My C code 
> writes to
> > > those two pre-allocated lists,
> 
> > That's bad! All arguments are essentially read-only so you should
> > never write into them! 
> 
> I don't see how.  (So, what am I missing?)  The R docs themselves
> state that the main point of using .Call rather than .C is that .Call
> does not do any extra copying and gives one direct access to the R
> objects.  (This is indeed very useful, e.g. to reorder a large matrix
> in seconds rather than hours.)
> 
> I could allocate the two lists in my C code, but so far it was more
> convenient to so in R.  What possible difference in behavior can there
> be between the two approaches?

Here is an example of how you break the rule that R-language functions
do not change their arguments if you use .Call in the way that you
describe.  The C code is in alter_argument.c:

#include <R.h>
#include <Rinternals.h>

SEXP alter_argument(SEXP arg)
{
    SEXP dim ;
    PROTECT(dim = allocVector(INTSXP, 2));
    INTEGER(dim)[0] = 1 ;
    INTEGER(dim)[1] = LENGTH(arg) ;
    setAttrib(arg, R_DimSymbol, dim);
    UNPROTECT(1) ;
    return dim ;
}

Make a shared library out of this.  E.g., on Linux do
    R CMD SHLIB -o Ralter_argument.so alter_argument.so
and load it into R with
    dyn.open("./Ralter_argument.so")
(Or, on any platform, put it into a package along with
the following R code and build it.)

The associated R code is
     myDim <- function(v).Call("alter_argument", v)
     f <- function(z) myDim(z)[2]
Now try using it:
     > myData <- 6:10
     > myData
     [1]  6  7  8  9 10
     > f(myData)
     [1] 5
     > myData
          [,1] [,2] [,3] [,4] [,5]
     [1,]    6    7    8    9   10
The argument to f was changed!  This should never happen in R.

If you are very careful you might be able ensure that
no part of the argument to be altered can come from
outside the function calling .Call().  It can be tricky
to ensure that, especially when the argument is more complicated
than an atomic vector.

"If you live outside the law you must be honest" - Bob Dylan.

In R, .Call() does not copy its arguments but the C code
writer is expected to do so if they will be altered.
In S+ (and S), .Call() copies the arguments if altering
them would make a user-visible change in the environment,
unless you specify that the C code will not be altering them.

Bill Dunlap
Spotfire, TIBCO Software
wdunlap tibco.com 

> > R has pass-by-value(!) semantics, so semantically you code has
> > nothing to do with the result.1 and result.2 variables since only
> > their *values* are guaranteed to be passed (possibly a copy).
> 
> Clearly C code called from .Call must be allowed to construct R
> objects, as that's how much of R itself is implemented, and further
> down, it's what you recommend I should do instead.
> 
> But why does it follow that C code must never modify an object
> initially allocated by R code?  Are you saying there is some special
> magic difference in the state of an object allocated by R's C code
> vs. one allocated by R code?  If so, what is it?
> 
> What is the potential problem here, that the garbage collector will
> suddenly run while my C code is in the middle of writing to an R list?
> Yes, if the gc is going to move the object elsewhere, that would be
> very bad.  But it looks to me like that cannot happen, because lots of
> the R implementation itself would fail badly if it did.
> 
> E.g.:  The PROTECT call is used to increment reference counts, but I
> see no guarantees that it is atomic with the operations that allocate
> objects.  I see no mutexes or other barriers in C code to prevent the
> gc from running, thus implying that it *can't* run until the C
> function completes.
> 
> And R is single threaded, of course.  But what about signal handlers,
> could they ever invoke R's gc?
> 
> Also, I was initially surprised not to find any matrix C APIs, but
> grepping for examples (sorry, I don't remember exactly which
> functions) showed me that the apparently accepted way to do matrix
> operations from C is to simply assume R's column-first dense matrix
> order, and access the 2D matrix as a flat 1D vector.  (Which is easy.)
> 
> > The fact that internally R attempts to avoid copying for performance
> > reasons is the only reason why your code may have appeared to work,
> > but it's invalid!
> 
> I will probably change my code to allocate a new list from the C code
> and return that, as you recommend.  My main reason for doing the
> allocation in R was just that it was simpler, especially given the
> very limited documentation of R's C API.
> 
> But, I didn't see anything in the "Writing R Extensions" doc saying
> that what my code is doing is "invalid", and more importantly, I don't
> see why it would or should be invalid...
> 
> I'd still like to better understand why you think doing the initial
> allocation of an object in R rather than C code is such a problem.  So
> far, I don't see any way that the R interpreter could ever tell the
> difference.
> 
> Wait, or is the only objection here that I'm using C in a way that
> makes pass-by-reference semantics visible to my R code?  Which will
> work completely correctly, but is not the The Proper R Way?
> 
> I don't actually need pass-by-reference behavior here at all, but I
> can imagine cases where I might want it, so I'd like to understand
> your objections better.  Is using C to implement pass-by-reference
> actually Broken, or merely Ugly?  From my reasons above, I think it
> will always work correctly and thus is not Broken.  But of course
> given R's devotion to pass-by-value, it could be considered
> unacceptably Ugly.
> 
> -- 
> Andrew Piskorski <atp at piskorski.com>
> http://www.piskorski.com/
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 


From jon.clayden at gmail.com  Thu Oct 28 18:07:55 2010
From: jon.clayden at gmail.com (Jon Clayden)
Date: Thu, 28 Oct 2010 17:07:55 +0100
Subject: [Rd] Reference Classes: Generalizing Reference Class Generator
	objects?
In-Reply-To: <4CC98517.3050605@alum.mit.edu>
References: <4CC98517.3050605@alum.mit.edu>
Message-ID: <AANLkTim3mz2eX06mKJd31euAPT3o_539RpiHUJ8iGGBL@mail.gmail.com>

Hi Daniel,

I think you want to define an "initialize" method, as in

TestClass <- setRefClass ("TestClass",
       fields = list (text = "character"),
       methods = list (
               initialize = function (text) { object <-
initFields(text=paste(text,"\n")) },
               print = function ()  { cat(text) } )
)

This seems to work as you intend:

> x <- TestClass$new("test")
> x$print()
test


All the best,
Jon

On 28 October 2010 15:13, Daniel Lee <bearlee at alum.mit.edu> wrote:
> Is it possible to override the $new(...) in the reference class generator? I
> have tried adding a "new" method to the methods of the class, but that is
> obviously not correct. I have also tried adding it to the class generator,
> but the class generator still uses the default constructor.
>
> As a simple example, this is the current interface:
> TestClass <- setRefClass ("TestClass",
> ? ? ? ?fields = list (text = "character"),
> ? ? ? ?methods = list (
> ? ? ? ? ? ? ? ?print = function () ?{cat(text)})
> )
> test <- TestClass$new (text="Hello World")
> test$print()
>
> I would like to override $new(...) to be something like (add a "\n" to the
> end of the input, no need to specify input fields):
> TestClass$methods (new = function (text) {
> ? ? ? ? ? ?text <- paste (text, "\n")
> ? ? ? ? ? ?methods:::new (def, text=text)
> ? ? ? ?})
>
> The constructor would then be:
> test <- TestClass$new ("Hello World")
>
> This is a subtle, but useful change. I have also tried adding to TestClass a
> method $newInstance(text), but that was not successful. If this is not
> possible, could we consider augmenting the Reference Class interface to
> include constructors?
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From jon.clayden at gmail.com  Thu Oct 28 18:12:48 2010
From: jon.clayden at gmail.com (Jon Clayden)
Date: Thu, 28 Oct 2010 17:12:48 +0100
Subject: [Rd] Reference Classes: Generalizing Reference Class Generator
	objects?
In-Reply-To: <4CC98517.3050605@alum.mit.edu>
References: <4CC98517.3050605@alum.mit.edu>
Message-ID: <AANLkTin6WXF-mMy_whb_cYuiKqrYw+Q3yP+D8NbRRpcO@mail.gmail.com>

Sorry - you don't need to assign the value of initFields(). I was
going to do it in two lines but then realised one was enough... :)

TestClass <- setRefClass ("TestClass",
       fields = list (text = "character"),
       methods = list (
               initialize = function (text) {
initFields(text=paste(text,"\n")) },
               print = function ()  { cat(text) } )
)

All the best,
Jon


On 28 October 2010 15:13, Daniel Lee <bearlee at alum.mit.edu> wrote:
> Is it possible to override the $new(...) in the reference class generator? I
> have tried adding a "new" method to the methods of the class, but that is
> obviously not correct. I have also tried adding it to the class generator,
> but the class generator still uses the default constructor.
>
> As a simple example, this is the current interface:
> TestClass <- setRefClass ("TestClass",
> ? ? ? ?fields = list (text = "character"),
> ? ? ? ?methods = list (
> ? ? ? ? ? ? ? ?print = function () ?{cat(text)})
> )
> test <- TestClass$new (text="Hello World")
> test$print()
>
> I would like to override $new(...) to be something like (add a "\n" to the
> end of the input, no need to specify input fields):
> TestClass$methods (new = function (text) {
> ? ? ? ? ? ?text <- paste (text, "\n")
> ? ? ? ? ? ?methods:::new (def, text=text)
> ? ? ? ?})
>
> The constructor would then be:
> test <- TestClass$new ("Hello World")
>
> This is a subtle, but useful change. I have also tried adding to TestClass a
> method $newInstance(text), but that was not successful. If this is not
> possible, could we consider augmenting the Reference Class interface to
> include constructors?
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From cgb at datanalytics.com  Thu Oct 28 19:11:32 2010
From: cgb at datanalytics.com (Carlos J. Gil Bellosta )
Date: Thu, 28 Oct 2010 19:11:32 +0200
Subject: [Rd] Unexpected behabiour of min,
	tapply and POSIXct/POSIXlt classes?
Message-ID: <AANLkTimg4ECuKp7Mx76XyABfqaAGzNdTaMymu+gAsbGV@mail.gmail.com>

Hello,

I found rather surprising the behaviour of POSIXct and POSIXlt classes
when combined with min and tapply.

The details can be deduced from the script below:

############# Start of the script ####################

before <- Sys.time()

Sys.sleep( 1 )

now1 <- now2 <- Sys.time()

my.times <- c( before,  now1, now2 )

class( my.times )				## [1] "POSIXct" "POSIXt"

min( my.times )					## [1] "2010-10-28 18:52:17 CEST"

### So far, so good... but:

my.period <- c( "a", "b", "b" )
tapply( my.times, my.period, min )

##          a          b
## 1288284737 1288284780

## Where did my POSIXct class go?


my.times.lt <- as.POSIXlt( my.times )

min( my.times.lt )				## [1] "2010-10-28 18:52:17 CEST"; good!

tapply( my.times.lt, my.period, min )

# $a
# [1] 17.449
#
# $b
# [1] 52
#
# Mensajes de aviso perdidos
# In ansmat[index] <- ans :
#   n?mero de items para para sustituir no es un m?ltiplo de la
longitud del reemplazo
#
# ??  :(


############# End of the script ####################

Here are the details of my session (as reported by sessionInfo):

R version 2.12.0 (2010-10-15)
Platform: i386-pc-mingw32/i386 (32-bit)

locale:
[1] LC_COLLATE=Spanish_Spain.1252  LC_CTYPE=Spanish_Spain.1252
LC_MONETARY=Spanish_Spain.1252 LC_NUMERIC=C
[5] LC_TIME=Spanish_Spain.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] RODBC_1.3-2 plotrix_3.0

loaded via a namespace (and not attached):
[1] tools_2.12.0

I am running R on a Windows XP Box.


Thank you very much,

Carlos J. Gil Bellosta
http://www.datanalytics.com


From jorismeys at gmail.com  Thu Oct 28 19:24:31 2010
From: jorismeys at gmail.com (Joris Meys)
Date: Thu, 28 Oct 2010 19:24:31 +0200
Subject: [Rd] Unexpected behabiour of min,
	tapply and POSIXct/POSIXlt classes?
In-Reply-To: <AANLkTimg4ECuKp7Mx76XyABfqaAGzNdTaMymu+gAsbGV@mail.gmail.com>
References: <AANLkTimg4ECuKp7Mx76XyABfqaAGzNdTaMymu+gAsbGV@mail.gmail.com>
Message-ID: <AANLkTincYrp0tREUh3H94goBiA0Ak4Mz+jdDhEZymWGh@mail.gmail.com>

Hi Carlos,

this definitely does not belong to r-devel, just ask it on the normal
help list or on www.stackoverflow.com next time.

If you read the help file, this behaviour is exactly as expected :
---start quote---
Note that if the return value has a class (e.g. an object of class
"Date") the class is discarded.
---end quote---

see ?tapply.

So you do:
tapply( my.times, my.period, min , simplify=F)

There's your class.

Cheers
Joris





On Thu, Oct 28, 2010 at 7:11 PM, Carlos J. Gil Bellosta
<cgb at datanalytics.com> wrote:
> Hello,
>
> I found rather surprising the behaviour of POSIXct and POSIXlt classes
> when combined with min and tapply.
>
> The details can be deduced from the script below:
>
> ############# Start of the script ####################
>
> before <- Sys.time()
>
> Sys.sleep( 1 )
>
> now1 <- now2 <- Sys.time()
>
> my.times <- c( before, ?now1, now2 )
>
> class( my.times ) ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ## [1] "POSIXct" "POSIXt"
>
> min( my.times ) ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ## [1] "2010-10-28 18:52:17 CEST"
>
> ### So far, so good... but:
>
> my.period <- c( "a", "b", "b" )
> tapply( my.times, my.period, min )
>
> ## ? ? ? ? ?a ? ? ? ? ?b
> ## 1288284737 1288284780
>
> ## Where did my POSIXct class go?
>
>
> my.times.lt <- as.POSIXlt( my.times )
>
> min( my.times.lt ) ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?## [1] "2010-10-28 18:52:17 CEST"; good!
>
> tapply( my.times.lt, my.period, min )
>
> # $a
> # [1] 17.449
> #
> # $b
> # [1] 52
> #
> # Mensajes de aviso perdidos
> # In ansmat[index] <- ans :
> # ? n?mero de items para para sustituir no es un m?ltiplo de la
> longitud del reemplazo
> #
> # ?? ?:(
>
>
> ############# End of the script ####################
>
> Here are the details of my session (as reported by sessionInfo):
>
> R version 2.12.0 (2010-10-15)
> Platform: i386-pc-mingw32/i386 (32-bit)
>
> locale:
> [1] LC_COLLATE=Spanish_Spain.1252 ?LC_CTYPE=Spanish_Spain.1252
> LC_MONETARY=Spanish_Spain.1252 LC_NUMERIC=C
> [5] LC_TIME=Spanish_Spain.1252
>
> attached base packages:
> [1] stats ? ? graphics ?grDevices utils ? ? datasets ?methods ? base
>
> other attached packages:
> [1] RODBC_1.3-2 plotrix_3.0
>
> loaded via a namespace (and not attached):
> [1] tools_2.12.0
>
> I am running R on a Windows XP Box.
>
>
> Thank you very much,
>
> Carlos J. Gil Bellosta
> http://www.datanalytics.com
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>



-- 
Joris Meys
Statistical consultant

Ghent University
Faculty of Bioscience Engineering
Department of Applied mathematics, biometrics and process control

tel : +32 9 264 59 87
Joris.Meys at Ugent.be
-------------------------------
Disclaimer : http://helpdesk.ugent.be/e-maildisclaimer.php


From bearlee at alum.mit.edu  Thu Oct 28 19:25:31 2010
From: bearlee at alum.mit.edu (Daniel Lee)
Date: Thu, 28 Oct 2010 13:25:31 -0400
Subject: [Rd] Reference Classes: Generalizing Reference Class Generator
 objects?
In-Reply-To: <AANLkTin6WXF-mMy_whb_cYuiKqrYw+Q3yP+D8NbRRpcO@mail.gmail.com>
References: <4CC98517.3050605@alum.mit.edu>
	<AANLkTin6WXF-mMy_whb_cYuiKqrYw+Q3yP+D8NbRRpcO@mail.gmail.com>
Message-ID: <4CC9B20B.1020204@alum.mit.edu>

Thank you. Your example really clarifies what the $initialize(...) 
function is supposed to do.

Do you know if there is a straightforward way to dispatch the $new(...) 
method based on the signature of the arguments? I am thinking along the 
lines of S4 methods with valid signatures.

Thanks again for the example.


On 10/28/2010 12:12 PM, Jon Clayden wrote:
> Sorry - you don't need to assign the value of initFields(). I was
> going to do it in two lines but then realised one was enough... :)
>
> TestClass<- setRefClass ("TestClass",
>         fields = list (text = "character"),
>         methods = list (
>                 initialize = function (text) {
> initFields(text=paste(text,"\n")) },
>                 print = function ()  { cat(text) } )
> )
>
> All the best,
> Jon
>
>
> On 28 October 2010 15:13, Daniel Lee<bearlee at alum.mit.edu>  wrote:
>> Is it possible to override the $new(...) in the reference class generator? I
>> have tried adding a "new" method to the methods of the class, but that is
>> obviously not correct. I have also tried adding it to the class generator,
>> but the class generator still uses the default constructor.
>>
>> As a simple example, this is the current interface:
>> TestClass<- setRefClass ("TestClass",
>>         fields = list (text = "character"),
>>         methods = list (
>>                 print = function ()  {cat(text)})
>> )
>> test<- TestClass$new (text="Hello World")
>> test$print()
>>
>> I would like to override $new(...) to be something like (add a "\n" to the
>> end of the input, no need to specify input fields):
>> TestClass$methods (new = function (text) {
>>             text<- paste (text, "\n")
>>             methods:::new (def, text=text)
>>         })
>>
>> The constructor would then be:
>> test<- TestClass$new ("Hello World")
>>
>> This is a subtle, but useful change. I have also tried adding to TestClass a
>> method $newInstance(text), but that was not successful. If this is not
>> possible, could we consider augmenting the Reference Class interface to
>> include constructors?
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>


From jon.clayden at gmail.com  Thu Oct 28 19:55:59 2010
From: jon.clayden at gmail.com (Jon Clayden)
Date: Thu, 28 Oct 2010 18:55:59 +0100
Subject: [Rd] Reference Classes: Generalizing Reference Class Generator
	objects?
In-Reply-To: <4CC9B20B.1020204@alum.mit.edu>
References: <4CC98517.3050605@alum.mit.edu>
	<AANLkTin6WXF-mMy_whb_cYuiKqrYw+Q3yP+D8NbRRpcO@mail.gmail.com>
	<4CC9B20B.1020204@alum.mit.edu>
Message-ID: <AANLkTineuXeTVGMGfpWJRi0P0G5BYhqwGej5-TFU9txs@mail.gmail.com>

?ReferenceClasses says "Reference methods can not themselves be
generic functions; if you want additional function-based method
dispatch, write a separate generic function and call that from the
method". So I think you'd need to take that approach in your
"initialize" method.

Hope this helps,
Jon


On 28 October 2010 18:25, Daniel Lee <bearlee at alum.mit.edu> wrote:
> Thank you. Your example really clarifies what the $initialize(...) function
> is supposed to do.
>
> Do you know if there is a straightforward way to dispatch the $new(...)
> method based on the signature of the arguments? I am thinking along the
> lines of S4 methods with valid signatures.
>
> Thanks again for the example.
>
>
> On 10/28/2010 12:12 PM, Jon Clayden wrote:
>>
>> Sorry - you don't need to assign the value of initFields(). I was
>> going to do it in two lines but then realised one was enough... :)
>>
>> TestClass<- setRefClass ("TestClass",
>> ? ? ? ?fields = list (text = "character"),
>> ? ? ? ?methods = list (
>> ? ? ? ? ? ? ? ?initialize = function (text) {
>> initFields(text=paste(text,"\n")) },
>> ? ? ? ? ? ? ? ?print = function () ?{ cat(text) } )
>> )
>>
>> All the best,
>> Jon
>>
>>
>> On 28 October 2010 15:13, Daniel Lee<bearlee at alum.mit.edu> ?wrote:
>>>
>>> Is it possible to override the $new(...) in the reference class
>>> generator? I
>>> have tried adding a "new" method to the methods of the class, but that is
>>> obviously not correct. I have also tried adding it to the class
>>> generator,
>>> but the class generator still uses the default constructor.
>>>
>>> As a simple example, this is the current interface:
>>> TestClass<- setRefClass ("TestClass",
>>> ? ? ? ?fields = list (text = "character"),
>>> ? ? ? ?methods = list (
>>> ? ? ? ? ? ? ? ?print = function () ?{cat(text)})
>>> )
>>> test<- TestClass$new (text="Hello World")
>>> test$print()
>>>
>>> I would like to override $new(...) to be something like (add a "\n" to
>>> the
>>> end of the input, no need to specify input fields):
>>> TestClass$methods (new = function (text) {
>>> ? ? ? ? ? ?text<- paste (text, "\n")
>>> ? ? ? ? ? ?methods:::new (def, text=text)
>>> ? ? ? ?})
>>>
>>> The constructor would then be:
>>> test<- TestClass$new ("Hello World")
>>>
>>> This is a subtle, but useful change. I have also tried adding to
>>> TestClass a
>>> method $newInstance(text), but that was not successful. If this is not
>>> possible, could we consider augmenting the Reference Class interface to
>>> include constructors?
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>


From lawrence.michael at gene.com  Thu Oct 28 20:07:14 2010
From: lawrence.michael at gene.com (Michael Lawrence)
Date: Thu, 28 Oct 2010 11:07:14 -0700
Subject: [Rd] R-2.12.0 hangs while loading RGtk2 on FreeBSD
In-Reply-To: <4CC878D3.80107@gwdg.de>
References: <4CC03E47.2010800@gwdg.de>
	<alpine.LFD.2.00.1010211508350.5999@toucan.stats.ox.ac.uk>
	<4CC052D6.3030106@gwdg.de>
	<alpine.LFD.2.00.1010211704340.7969@toucan.stats.ox.ac.uk>
	<4CC06D6A.8040609@gwdg.de>
	<AANLkTimAmo0ro2Tiw_rWAJ732R+ATRgNdS0SvuO6hYq+@mail.gmail.com>
	<4CC19D4B.6070605@gwdg.de> <4CC1EFD0.40400@gwdg.de>
	<4CC2AFB8.1060404@gwdg.de>
	<AANLkTimWCP-XH+NcUNFA13Qq0Szhk_MPQ8_3dbAoUZMq@mail.gmail.com>
	<4CC878D3.80107@gwdg.de>
Message-ID: <AANLkTi=LwAKHF-9TXpJR2GDo+H8UqW5XrFQv2Nbv1diy@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20101028/7874084c/attachment.pl>

From Andy.Bunn at wwu.edu  Thu Oct 28 20:10:48 2010
From: Andy.Bunn at wwu.edu (Andy Bunn)
Date: Thu, 28 Oct 2010 11:10:48 -0700
Subject: [Rd] make check-all error on Win 7 with 2-12-.0: vfork: Resource
 temporarily unavailable
Message-ID: <7E6EA3F4372E474F8F3F850DD262FDA903F0ADD82B@ExchMailbox3.univ.dir.wwu.edu>

Hi all, I just built R from src on Windows 7 using Rtools212.exe. The build went as usual (R, bitmaps, and manuals all OK) but make check-all failed when running the examples for package 'tcltk':


...
running code in 'demos2.R' ... OK
running tests of primitives
running code in 'primitives.R' ... OK
make[2]: vfork: Resource temporarily unavailable
make[1]: *** [test-all-devel] Error 1
make: *** [check-all] Error 2

There was no error when I ran make check-all a second time. Just FYI in case this means anything to the heavy-weight developers out there.

-Andy


From djsamperi at gmail.com  Thu Oct 28 20:44:12 2010
From: djsamperi at gmail.com (Dominick Samperi)
Date: Thu, 28 Oct 2010 14:44:12 -0400
Subject: [Rd] must .Call C functions return SEXP?
In-Reply-To: <77EB52C6DD32BA4D87471DCD70C8D7000393FB14@NA-PA-VBE03.na.tibco.com>
References: <20101027234347.GA69179@piskorski.com>
	<1E6722DD-D3E2-4BDD-A9BE-C07271B3D1FC@r-project.org>
	<20101028134821.GA49312@piskorski.com>
	<77EB52C6DD32BA4D87471DCD70C8D7000393FB14@NA-PA-VBE03.na.tibco.com>
Message-ID: <AANLkTi=wz8pbUJ4JNWToOQWaSQ5Zk2NxC6M+Gbm-4+kf@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20101028/019d3180/attachment.pl>

From rhurlin at gwdg.de  Thu Oct 28 21:24:38 2010
From: rhurlin at gwdg.de (Rainer Hurling)
Date: Thu, 28 Oct 2010 21:24:38 +0200
Subject: [Rd] R-2.12.0 hangs while loading RGtk2 on FreeBSD
In-Reply-To: <AANLkTi=LwAKHF-9TXpJR2GDo+H8UqW5XrFQv2Nbv1diy@mail.gmail.com>
References: <4CC03E47.2010800@gwdg.de>	<alpine.LFD.2.00.1010211508350.5999@toucan.stats.ox.ac.uk>	<4CC052D6.3030106@gwdg.de>	<alpine.LFD.2.00.1010211704340.7969@toucan.stats.ox.ac.uk>	<4CC06D6A.8040609@gwdg.de>	<AANLkTimAmo0ro2Tiw_rWAJ732R+ATRgNdS0SvuO6hYq+@mail.gmail.com>	<4CC19D4B.6070605@gwdg.de>	<4CC1EFD0.40400@gwdg.de>	<4CC2AFB8.1060404@gwdg.de>	<AANLkTimWCP-XH+NcUNFA13Qq0Szhk_MPQ8_3dbAoUZMq@mail.gmail.com>	<4CC878D3.80107@gwdg.de>
	<AANLkTi=LwAKHF-9TXpJR2GDo+H8UqW5XrFQv2Nbv1diy@mail.gmail.com>
Message-ID: <4CC9CDF6.6060309@gwdg.de>

On 28.10.2010 20:07 (UTC+1), Michael Lawrence wrote:
> On Wed, Oct 27, 2010 at 12:09 PM, Rainer Hurling <rhurlin at gwdg.de
> <mailto:rhurlin at gwdg.de>> wrote:
>
>     On 27.10.2010 15:07 (UTC+1), Michael Lawrence wrote:
>
>         On Sat, Oct 23, 2010 at 2:49 AM, Rainer Hurling <rhurlin at gwdg.de
>         <mailto:rhurlin at gwdg.de>
>         <mailto:rhurlin at gwdg.de <mailto:rhurlin at gwdg.de>>> wrote:
>             On 22.10.2010 22:10 (UTC+1), Rainer Hurling wrote:
>                 On 22.10.2010 16:18 (UTC+2), Rainer Hurling wrote:
>                     On 22.10.2010 14:57 (UTC+1), Michael Lawrence wrote:
>
>                         On Thu, Oct 21, 2010 at 9:42 AM, Rainer Hurling
>         <rhurlin at gwdg.de <mailto:rhurlin at gwdg.de>
>         <mailto:rhurlin at gwdg.de <mailto:rhurlin at gwdg.de>>
>         <mailto:rhurlin at gwdg.de <mailto:rhurlin at gwdg.de>
>         <mailto:rhurlin at gwdg.de <mailto:rhurlin at gwdg.de>>>> wrote:
>
>                         [moved from R-help]
>
>                         On 21.10.2010 18:09 (UTC+1), Prof Brian Ripley
>         wrote:
>
>                         If you do R CMD INSTALL --no-test-load this will
>         skip
>                         the part
>                         that is
>                         hanging and you can try loading in stages (e.g.
>         dyn.load
>                         on the
>                         RGtk2.so).
>
>                         With '--no-test-load' it installs and ends normal.
>                         Loading per
>                         dyn.load("RGtk2.so") works, just as
>                         dyn.load("RGtk2.so",F) and
>                         dyn.load("RGtk2.so",,F). Unloading works, too.
>
>                         Normal loading over library(RGtk2) within R does not
>                         work. R than is
>                         hanging.
>
>                         It seems the problem is not with the library itself?
>
>                         It looks like something is happening when
>         initializing
>                         GTK+ and the
>                         event loop. This happens in the function
>         R_gtkInit in
>                         Rgtk.c. If you
>                         could run R -d gdb and break on that function,
>         perhaps
>                         you could step
>                         through until it hangs.
>
>                     Michael, thank you for answering. As I wrote earlier (on
>                     R-help@),
>                     unfortunately I have no experience with debugging (I
>         am not a
>                     programmer). So I would need some more assistence.
>
>                     Is there a difference between 'library(RGtk2)' and
>         'dyn.load(RGtk2)' in
>                     initializing GTK+? I am able to dyn.load, but
>         library does
>                     not work.
>
>                     After starting with 'R -d gdb' is the following right?
>
>                     (gdb) break R_gtkInit
>                     Function "R_gtkInit" not defined.
>                     Make breakpoint pending on future shared library
>         load? (y or
>                     [n]) y
>                     Breakpoint 1 (R_gtkInit) pending.
>
>                     When I try to proceed, it gives me the following message
>
>                     (gdb) run
>                     Starting program: /usr/local/lib/R/bin/exec/R
>                     /libexec/ld-elf.so.1: Shared object "libRblas.so"
>         not found,
>                     required by "R"
>                     Program exited with code 01.
>
>                 Ok, I am one step further now:
>
>                 (gdb) run
>                 Starting program: /usr/local/lib/R/bin/exec/R
>                 [..SNIP..]
>          > library(RGtk2)
>                 [New LWP 100174]
>                 Breakpoint 2 at 0x318bd490: file Rgtk.c, line 104.
>                 Pending breakpoint "R_gtkInit" resolved
>                 [New Thread 2f408b00 (LWP 100174)]
>                 [Switching to Thread 2f408b00 (LWP 100174)]
>
>                 Breakpoint 2, R_gtkInit (rargc=0x30b11d10, rargv=0x30a98458,
>                 success=0x30afbad0) at Rgtk.c:104
>                 104 Rgtk.c: No such file or directory.
>                 in Rgtk.c
>                 (gdb)
>
>                 What do you suggest I should do next?
>
>             Rgtk.c was not found from gdb because RGtk2 was not build with
>             DEBUG=T and R_KEEP_PKG_SOURCE=yes.
>
>             So this is the next try. I can trace the code until it hangs:
>
>             library(RGtk2)
>             [New LWP 100250]
>             Breakpoint 2 at 0x458bd490: file Rgtk.c, line 104.
>
>             Pending breakpoint "R_gtkInit" resolved
>             [New Thread 4322ef00 (LWP 100250)]
>             [Switching to Thread 4322ef00 (LWP 100250)]
>
>             Breakpoint 2, R_gtkInit (rargc=0x446d0980, rargv=0x44698618,
>             success=0x446d09e0) at Rgtk.c:104
>             104     {
>             (gdb) n
>             107       argc = (int) *rargc;
>             (gdb) n
>             104     {
>             (gdb) n
>             107       argc = (int) *rargc;
>             (gdb) n
>             109       if (!gdk_display_get_default()) {
>             (gdb) n
>             110         gtk_disable_setlocale();
>             (gdb) n
>             111         if (!gtk_init_check(&argc, &rargv)) {
>             (gdb) n
>             121         if (!GDK_DISPLAY()) {
>             (gdb) n
>             127         addInputHandler(R_InputHandlers,
>             ConnectionNumber(GDK_DISPLAY()),
>             (gdb) n
>             132         if (!pipe(fds)) {
>             (gdb) n
>             133           ifd = fds[0];
>             (gdb) n
>             134           ofd = fds[1];
>             (gdb) n
>             135           addInputHandler(R_InputHandlers, ifd,
>             R_gtk_timerInputHandler, 32);
>             (gdb) n
>             133           ifd = fds[0];
>             (gdb) n
>             134           ofd = fds[1];
>             (gdb) n
>             135           addInputHandler(R_InputHandlers, ifd,
>             R_gtk_timerInputHandler, 32);
>             (gdb) n
>             136           if (!g_thread_supported ()) g_thread_init (NULL);
>             (gdb) n
>             137           g_thread_create(R_gtk_timerThreadFunc, NULL,
>         FALSE, NULL);
>             (gdb) n
>
>             Line 138 (R_CStackLimit = -1;) is hanging. It seems there is
>             something wrong with piping the file descriptor?
>
>         Thanks for looking into this. It looks like the g_thread_create
>         line is
>         hanging. I wonder if your version of GTK+/GLib is not built with
>         threading support? But if that were the case, g_thread_init() should
>         have aborted. You could try breaking on the
>         R_gtk_timerThreadFunc just
>         to see if the thread is executed at all or where it is hanging.
>
>
>
>     Michael, I have to thank you :-)  I set a break at
>     'R_gtk_timerThreadFunc'. It seems this function does not return:
>
>
>     [..see above..]
>     library(RGtk2)
>     [New LWP 100172]
>     Breakpoint 2 at 0x458bd5c0: file Rgtk.c, line 78.
>     Pending breakpoint "R_gtk_timerThreadFunc" resolved
>     [New Thread 4322ef00 (LWP 100172)]
>     [..hanging from here on..]
>
>
>     Next I tried a new run with break at 'g_main_context_new' (line 79),
>     which steps into glib-2.0.so.0, before it hangs:
>
>
>     library(RGtk2)
>     [New LWP 100195]
>     Breakpoint 2 at 0x47c7c660
>     Pending breakpoint "g_main_context_new" resolved
>     [New Thread 4322ef00 (LWP 100195)]
>     [Switching to Thread 4322ef00 (LWP 100195)]
>     Breakpoint 2, 0x0000000047c7c660 in g_main_context_new () from
>     /usr/local/lib/libglib-2.0.so.0
>     (gdb) n
>     Single stepping until exit from function g_main_context_new,
>     which has no line number information.
>     0x0000000047c7aed0 in g_source_set_priority () from
>     /usr/local/lib/libglib-2.0.so.0
>     (gdb) n
>     Single stepping until exit from function g_source_set_priority,
>     which has no line number information.
>     0x0000000047c7ac70 in g_main_loop_quit () from
>     /usr/local/lib/libglib-2.0.so.0
>     (gdb) n
>     Single stepping until exit from function g_main_loop_quit,
>     which has no line number information.
>     0x0000000047c7a280 in g_source_get_context () from
>     /usr/local/lib/libglib-2.0.so.0
>     (gdb) n
>     Single stepping until exit from function g_source_get_context,
>     which has no line number information.
>     0x0000000047c7c6f3 in g_main_context_new () from
>     /usr/local/lib/libglib-2.0.so.0
>     (gdb) p ctx
>     No symbol "ctx" in current context.
>     (gdb) p data
>     No symbol "data" in current context.
>     (gdb) n
>     Single stepping until exit from function g_main_context_new,
>     which has no line number information.
>     0x0000000047c7c8b2 in g_main_context_default () from
>     /usr/local/lib/libglib-2.0.so.0
>     (gdb) n
>     Single stepping until exit from function g_main_context_default,
>     which has no line number information.
>     0x0000000047c7dea5 in g_source_attach () from
>     /usr/local/lib/libglib-2.0.so.0
>     (gdb) n
>     Single stepping until exit from function g_source_attach,
>     which has no line number information.
>     0x0000000047c79c50 in g_list_remove_link () from
>     /usr/local/lib/libglib-2.0.so.0
>     (gdb) n
>     Single stepping until exit from function g_list_remove_link,
>     which has no line number information.
>     0x0000000047c7dde6 in g_source_attach () from
>     /usr/local/lib/libglib-2.0.so.0
>     (gdb) n
>     Single stepping until exit from function g_source_attach,
>     which has no line number information.
>     0x0000000047c7ac70 in g_main_loop_quit () from
>     /usr/local/lib/libglib-2.0.so.0
>     (gdb) n
>     Single stepping until exit from function g_main_loop_quit,
>     which has no line number information.
>     0x0000000047c7a280 in g_source_get_context () from
>     /usr/local/lib/libglib-2.0.so.0
>     (gdb) n
>     Single stepping until exit from function g_source_get_context,
>     which has no line number information.
>     0x0000000047c7de00 in g_source_attach () from
>     /usr/local/lib/libglib-2.0.so.0
>     (gdb) n
>     Single stepping until exit from function g_source_attach,
>     which has no line number information.
>     0x0000000047c7a280 in g_source_get_context () from
>     /usr/local/lib/libglib-2.0.so.0
>     (gdb) n
>     Single stepping until exit from function g_source_get_context,
>     which has no line number information.
>     0x0000000047c7de11 in g_source_attach () from
>     /usr/local/lib/libglib-2.0.so.0
>     (gdb) n
>     Single stepping until exit from function g_source_attach,
>     which has no line number information.
>     0x000000004608eec8 in gdk_add_client_message_filter () from
>     /usr/local/lib/libgdk-x11-2.0.so.0
>     (gdb) n
>     Single stepping until exit from function gdk_add_client_message_filter,
>     which has no line number information.
>     [..hanging from here on..]
>
>
>     Is there an easy way to find out if GTK+/GLib is built with
>     threading support?
>
>
> The g_thread_init() call should abort the program if there is no
> threading support, so I'm assuming it's there. I'm not sure what's wrong
> here, but maybe I'll just #ifdef out the threaded event handling for
> FreeBSD. A new RGtk2 will be released in the next few days.

Great news! I could test the unthreaded version before releasing if you 
would like to. Thanks so far,

Rainer


> Michael
>
>     Thanks, Rainer
>
>
>
>         Thanks again for taking the time to work on this. Sorry I have been
>         non-responsive.
>
>         Michael
>
>
>     [..mail deleted from here on..]


From atp at piskorski.com  Thu Oct 28 22:07:40 2010
From: atp at piskorski.com (Andrew Piskorski)
Date: Thu, 28 Oct 2010 16:07:40 -0400
Subject: [Rd] must .Call C functions return SEXP?
In-Reply-To: <14761267-D550-4BAC-9498-F1E0D32465E3@r-project.org>
References: <20101027234347.GA69179@piskorski.com>
	<1E6722DD-D3E2-4BDD-A9BE-C07271B3D1FC@r-project.org>
	<20101028134821.GA49312@piskorski.com>
	<14761267-D550-4BAC-9498-F1E0D32465E3@r-project.org>
Message-ID: <20101028200740.GA60469@piskorski.com>

On Thu, Oct 28, 2010 at 10:59:26AM -0400, Simon Urbanek wrote:

> Because R assumes that you don't mess with the arguments, it also
> optimizes b to point to the same object as a which you then modify.

> I hope it sheds some light on it.

Indeed!  Thank you Simon, that was a thorough and illuminating answer.

(Now I have better understanding of how the machine works, and what
the dangerous sharp bits are.  :)

-- 
Andrew Piskorski <atp at piskorski.com>
http://www.piskorski.com/


From ripley at stats.ox.ac.uk  Thu Oct 28 23:30:53 2010
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 28 Oct 2010 22:30:53 +0100 (BST)
Subject: [Rd] make check-all error on Win 7 with 2-12-.0: vfork:
 Resource temporarily unavailable
In-Reply-To: <7E6EA3F4372E474F8F3F850DD262FDA903F0ADD82B@ExchMailbox3.univ.dir.wwu.edu>
References: <7E6EA3F4372E474F8F3F850DD262FDA903F0ADD82B@ExchMailbox3.univ.dir.wwu.edu>
Message-ID: <alpine.LFD.2.00.1010282229360.5987@gannet.stats.ox.ac.uk>

This is a problem in the toolset (Cygwin), not in R, and indicates the 
machine was too busy (more or less as it says).

On Thu, 28 Oct 2010, Andy Bunn wrote:

> Hi all, I just built R from src on Windows 7 using Rtools212.exe. The build went as usual (R, bitmaps, and manuals all OK) but make check-all failed when running the examples for package 'tcltk':
>
>
> ...
> running code in 'demos2.R' ... OK
> running tests of primitives
> running code in 'primitives.R' ... OK
> make[2]: vfork: Resource temporarily unavailable
> make[1]: *** [test-all-devel] Error 1
> make: *** [check-all] Error 2
>
> There was no error when I ran make check-all a second time. Just FYI in case this means anything to the heavy-weight developers out there.
>
> -Andy
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From bates at stat.wisc.edu  Fri Oct 29 00:04:20 2010
From: bates at stat.wisc.edu (Douglas Bates)
Date: Thu, 28 Oct 2010 17:04:20 -0500
Subject: [Rd] [Rcpp-devel]  must .Call C functions return SEXP?
In-Reply-To: <AANLkTi=wz8pbUJ4JNWToOQWaSQ5Zk2NxC6M+Gbm-4+kf@mail.gmail.com>
References: <20101027234347.GA69179@piskorski.com>
	<1E6722DD-D3E2-4BDD-A9BE-C07271B3D1FC@r-project.org>
	<20101028134821.GA49312@piskorski.com>
	<77EB52C6DD32BA4D87471DCD70C8D7000393FB14@NA-PA-VBE03.na.tibco.com>
	<AANLkTi=wz8pbUJ4JNWToOQWaSQ5Zk2NxC6M+Gbm-4+kf@mail.gmail.com>
Message-ID: <AANLkTikz10gR6ThFAy-=p0tJMRqcti34eT8Nb89qsfkf@mail.gmail.com>

On Thu, Oct 28, 2010 at 1:44 PM, Dominick Samperi <djsamperi at gmail.com> wrote:
> See comments on Rcpp below.
>
> On Thu, Oct 28, 2010 at 11:28 AM, William Dunlap <wdunlap at tibco.com> wrote:
>>
>> > -----Original Message-----
>> > From: r-devel-bounces at r-project.org
>> > [mailto:r-devel-bounces at r-project.org] On Behalf Of Andrew Piskorski
>> > Sent: Thursday, October 28, 2010 6:48 AM
>> > To: Simon Urbanek
>> > Cc: r-devel at r-project.org
>> > Subject: Re: [Rd] must .Call C functions return SEXP?
>> >
>> > On Thu, Oct 28, 2010 at 12:15:56AM -0400, Simon Urbanek wrote:
>> >
>> > > > Reason I ask, is I've written some R code which allocates two long
>> > > > lists, and then calls a C function with .Call. ?My C code
>> > writes to
>> > > > those two pre-allocated lists,
>> >
>> > > That's bad! All arguments are essentially read-only so you should
>> > > never write into them!
>> >
>> > I don't see how. ?(So, what am I missing?) ?The R docs themselves
>> > state that the main point of using .Call rather than .C is that .Call
>> > does not do any extra copying and gives one direct access to the R
>> > objects. ?(This is indeed very useful, e.g. to reorder a large matrix
>> > in seconds rather than hours.)
>> >
>> > I could allocate the two lists in my C code, but so far it was more
>> > convenient to so in R. ?What possible difference in behavior can there
>> > be between the two approaches?
>>
>> Here is an example of how you break the rule that R-language functions
>> do not change their arguments if you use .Call in the way that you
>> describe. ?The C code is in alter_argument.c:
>>
>> #include <R.h>
>> #include <Rinternals.h>
>>
>> SEXP alter_argument(SEXP arg)
>> {
>> ? ?SEXP dim ;
>> ? ?PROTECT(dim = allocVector(INTSXP, 2));
>> ? ?INTEGER(dim)[0] = 1 ;
>> ? ?INTEGER(dim)[1] = LENGTH(arg) ;
>> ? ?setAttrib(arg, R_DimSymbol, dim);
>> ? ?UNPROTECT(1) ;
>> ? ?return dim ;
>> }
>>
>> Make a shared library out of this. ?E.g., on Linux do
>> ? ?R CMD SHLIB -o Ralter_argument.so alter_argument.so
>> and load it into R with
>> ? ?dyn.open("./Ralter_argument.so")
>> (Or, on any platform, put it into a package along with
>> the following R code and build it.)
>>
>> The associated R code is
>> ? ? myDim <- function(v).Call("alter_argument", v)
>> ? ? f <- function(z) myDim(z)[2]
>> Now try using it:
>> ? ? > myData <- 6:10
>> ? ? > myData
>> ? ? [1] ?6 ?7 ?8 ?9 10
>> ? ? > f(myData)
>> ? ? [1] 5
>> ? ? > myData
>> ? ? ? ? ?[,1] [,2] [,3] [,4] [,5]
>> ? ? [1,] ? ?6 ? ?7 ? ?8 ? ?9 ? 10
>> The argument to f was changed! ?This should never happen in R.
>>
>> If you are very careful you might be able ensure that
>> no part of the argument to be altered can come from
>> outside the function calling .Call(). ?It can be tricky
>> to ensure that, especially when the argument is more complicated
>> than an atomic vector.
>>
>> "If you live outside the law you must be honest" - Bob Dylan.
>
> This thread seems to suggest (following Bob Dylan) that one needs
> to be very careful when using C/C++ to modify R's memory
> directly, because you may modify other R variables that point
> to the same memory (due to R's copy-by-value semantics and
> optimizations).
>
> What are the implications for the Rcpp package where R
> objects are exposed to the C++ side in precisely this way,
> permitting unrestricted modifications? (In the original
> or "classic" version of this package direct writes to R's
> memory were done only for performance reasons.)
>
> Seems like extra precautions need to be taken to
> avoid the aliasing problem.

The current Rcpp facilities has the same benefits and dangers as the C
macros used in .Call.  You get access to the memory of the R object
passed as an argument, saving a copy step.  You shouldn't modify that
memory.  If you do, bad things can happen and they will be your fault.
 If you want to get a read-write copy you clone the argument (in Rcpp
terminology).

To Bill:  I seem to remember the Dylan quote as "To live outside the
law you must be honest."


>
> Dominick
>
>> In R, .Call() does not copy its arguments but the C code
>> writer is expected to do so if they will be altered.
>> In S+ (and S), .Call() copies the arguments if altering
>> them would make a user-visible change in the environment,
>> unless you specify that the C code will not be altering them.
>>
>> Bill Dunlap
>> Spotfire, TIBCO Software
>> wdunlap tibco.com
>>
>> > > R has pass-by-value(!) semantics, so semantically you code has
>> > > nothing to do with the result.1 and result.2 variables since only
>> > > their *values* are guaranteed to be passed (possibly a copy).
>> >
>> > Clearly C code called from .Call must be allowed to construct R
>> > objects, as that's how much of R itself is implemented, and further
>> > down, it's what you recommend I should do instead.
>> >
>> > But why does it follow that C code must never modify an object
>> > initially allocated by R code? ?Are you saying there is some special
>> > magic difference in the state of an object allocated by R's C code
>> > vs. one allocated by R code? ?If so, what is it?
>> >
>> > What is the potential problem here, that the garbage collector will
>> > suddenly run while my C code is in the middle of writing to an R list?
>> > Yes, if the gc is going to move the object elsewhere, that would be
>> > very bad. ?But it looks to me like that cannot happen, because lots of
>> > the R implementation itself would fail badly if it did.
>> >
>> > E.g.: ?The PROTECT call is used to increment reference counts, but I
>> > see no guarantees that it is atomic with the operations that allocate
>> > objects. ?I see no mutexes or other barriers in C code to prevent the
>> > gc from running, thus implying that it *can't* run until the C
>> > function completes.
>> >
>> > And R is single threaded, of course. ?But what about signal handlers,
>> > could they ever invoke R's gc?
>> >
>> > Also, I was initially surprised not to find any matrix C APIs, but
>> > grepping for examples (sorry, I don't remember exactly which
>> > functions) showed me that the apparently accepted way to do matrix
>> > operations from C is to simply assume R's column-first dense matrix
>> > order, and access the 2D matrix as a flat 1D vector. ?(Which is easy.)
>> >
>> > > The fact that internally R attempts to avoid copying for performance
>> > > reasons is the only reason why your code may have appeared to work,
>> > > but it's invalid!
>> >
>> > I will probably change my code to allocate a new list from the C code
>> > and return that, as you recommend. ?My main reason for doing the
>> > allocation in R was just that it was simpler, especially given the
>> > very limited documentation of R's C API.
>> >
>> > But, I didn't see anything in the "Writing R Extensions" doc saying
>> > that what my code is doing is "invalid", and more importantly, I don't
>> > see why it would or should be invalid...
>> >
>> > I'd still like to better understand why you think doing the initial
>> > allocation of an object in R rather than C code is such a problem. ?So
>> > far, I don't see any way that the R interpreter could ever tell the
>> > difference.
>> >
>> > Wait, or is the only objection here that I'm using C in a way that
>> > makes pass-by-reference semantics visible to my R code? ?Which will
>> > work completely correctly, but is not the The Proper R Way?
>> >
>> > I don't actually need pass-by-reference behavior here at all, but I
>> > can imagine cases where I might want it, so I'd like to understand
>> > your objections better. ?Is using C to implement pass-by-reference
>> > actually Broken, or merely Ugly? ?From my reasons above, I think it
>> > will always work correctly and thus is not Broken. ?But of course
>> > given R's devotion to pass-by-value, it could be considered
>> > unacceptably Ugly.
>> >
>> > --
>> > Andrew Piskorski <atp at piskorski.com>
>> > http://www.piskorski.com/
>> >
>> > ______________________________________________
>> > R-devel at r-project.org mailing list
>> > https://stat.ethz.ch/mailman/listinfo/r-devel
>> >
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>
> _______________________________________________
> Rcpp-devel mailing list
> Rcpp-devel at lists.r-forge.r-project.org
> https://lists.r-forge.r-project.org/cgi-bin/mailman/listinfo/rcpp-devel
>
>


From djsamperi at gmail.com  Fri Oct 29 06:37:14 2010
From: djsamperi at gmail.com (Dominick Samperi)
Date: Fri, 29 Oct 2010 00:37:14 -0400
Subject: [Rd] [Rcpp-devel]  must .Call C functions return SEXP?
In-Reply-To: <AANLkTikz10gR6ThFAy-=p0tJMRqcti34eT8Nb89qsfkf@mail.gmail.com>
References: <20101027234347.GA69179@piskorski.com>
	<1E6722DD-D3E2-4BDD-A9BE-C07271B3D1FC@r-project.org>
	<20101028134821.GA49312@piskorski.com>
	<77EB52C6DD32BA4D87471DCD70C8D7000393FB14@NA-PA-VBE03.na.tibco.com>
	<AANLkTi=wz8pbUJ4JNWToOQWaSQ5Zk2NxC6M+Gbm-4+kf@mail.gmail.com>
	<AANLkTikz10gR6ThFAy-=p0tJMRqcti34eT8Nb89qsfkf@mail.gmail.com>
Message-ID: <AANLkTi=oLmrYLPW31F+pgR6ZE1SkcNWCfNrUW=GshLpb@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20101029/28eebbc0/attachment.pl>

From hpages at fhcrc.org  Fri Oct 29 07:53:01 2010
From: hpages at fhcrc.org (=?ISO-8859-1?Q?Herv=E9_Pag=E8s?=)
Date: Thu, 28 Oct 2010 22:53:01 -0700
Subject: [Rd] list2env() is broken
Message-ID: <4CCA613D.3050802@fhcrc.org>

Hi,

The following code produces different kinds of problems depending
on which platform you run it:

   x <- as.list(1:200000)
   names(x) <- paste("A", 1:200000, sep="")
   e <- list2env(x)

Timeout on Linux, crash on Mac and Windows, with R 2.12.0 and
current R devel.

The "multi-assign" mode (i.e. when the 'envir' arg is supplied)
doesn't seem to have this problem.

Cheers,
H.

-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M2-B876
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fhcrc.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From ripley at stats.ox.ac.uk  Fri Oct 29 09:17:26 2010
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 29 Oct 2010 08:17:26 +0100 (BST)
Subject: [Rd] list2env() is broken
In-Reply-To: <4CCA613D.3050802@fhcrc.org>
References: <4CCA613D.3050802@fhcrc.org>
Message-ID: <alpine.LFD.2.00.1010290812150.1613@gannet.stats.ox.ac.uk>

I have no idea what 'timeout' means, but that *should* take an 
extraordinarily long time (it is at least quadratic in the input 
length).  This is the point of hashing -- you *need* hash=TRUE, and 
you should probably also set 'size' in new.env.

There was an obvious missing PROTECT in this function.

I do wonder if you are yet familiar with the debugging tools described 
in 'Writing R Extensions' -- please do use them before reporting.

On Thu, 28 Oct 2010, Herv? Pag?s wrote:

> Hi,
>
> The following code produces different kinds of problems depending
> on which platform you run it:
>
>  x <- as.list(1:200000)
>  names(x) <- paste("A", 1:200000, sep="")
>  e <- list2env(x)
>
> Timeout on Linux, crash on Mac and Windows, with R 2.12.0 and
> current R devel.
>
> The "multi-assign" mode (i.e. when the 'envir' arg is supplied)
> doesn't seem to have this problem.
>
> Cheers,
> H.
>
> -- 
> Herv? Pag?s
>
> Program in Computational Biology
> Division of Public Health Sciences
> Fred Hutchinson Cancer Research Center
> 1100 Fairview Ave. N, M2-B876
> P.O. Box 19024
> Seattle, WA 98109-1024
>
> E-mail: hpages at fhcrc.org
> Phone:  (206) 667-5791
> Fax:    (206) 667-1319
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From lawrence.michael at gene.com  Fri Oct 29 14:46:09 2010
From: lawrence.michael at gene.com (Michael Lawrence)
Date: Fri, 29 Oct 2010 05:46:09 -0700
Subject: [Rd] Scripting SVG with R
In-Reply-To: <4CB5D0A8.5040901@embl.de>
References: <4CB5D0A8.5040901@embl.de>
Message-ID: <AANLkTinH+QX25y6KJCx6+MJZZ8k6ZQXx-QR0naZzbLDR@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20101029/ad953367/attachment.pl>

From jmc at r-project.org  Fri Oct 29 18:56:53 2010
From: jmc at r-project.org (John Chambers)
Date: Fri, 29 Oct 2010 09:56:53 -0700
Subject: [Rd] Reference Classes: Generalizing Reference Class Generator
 objects?
In-Reply-To: <AANLkTineuXeTVGMGfpWJRi0P0G5BYhqwGej5-TFU9txs@mail.gmail.com>
References: <4CC98517.3050605@alum.mit.edu>	<AANLkTin6WXF-mMy_whb_cYuiKqrYw+Q3yP+D8NbRRpcO@mail.gmail.com>	<4CC9B20B.1020204@alum.mit.edu>
	<AANLkTineuXeTVGMGfpWJRi0P0G5BYhqwGej5-TFU9txs@mail.gmail.com>
Message-ID: <4CCAFCD5.5040106@r-project.org>

Good diagnoses.

This thread brought up a point or two that needed some fixes to the 
documentation and code.  They should be in r-devel and 2.12 patched 
(from rev. 53471).

Briefly:

- Initialization methods should take account of future subclasses to 
your class by including and passing on the ... argument, so that 
additional fields can be specified.  Discussed briefly now in the 
$new(...) section of ?ReferenceClasses.

- The InitFields() method is fine but was an early kludge when 
callSuper() didn't work for initialize().  To allow for the case that 
your class has a superclass with an initialize() method, use the 
callSuper() approach.  There is an example now in the documentation.

John

On 10/28/10 10:55 AM, Jon Clayden wrote:
> ?ReferenceClasses says "Reference methods can not themselves be
> generic functions; if you want additional function-based method
> dispatch, write a separate generic function and call that from the
> method". So I think you'd need to take that approach in your
> "initialize" method.
>
> Hope this helps,
> Jon
>
>
> On 28 October 2010 18:25, Daniel Lee<bearlee at alum.mit.edu>  wrote:
>> Thank you. Your example really clarifies what the $initialize(...) function
>> is supposed to do.
>>
>> Do you know if there is a straightforward way to dispatch the $new(...)
>> method based on the signature of the arguments? I am thinking along the
>> lines of S4 methods with valid signatures.
>>
>> Thanks again for the example.
>>
>>
>> On 10/28/2010 12:12 PM, Jon Clayden wrote:
>>>
>>> Sorry - you don't need to assign the value of initFields(). I was
>>> going to do it in two lines but then realised one was enough... :)
>>>
>>> TestClass<- setRefClass ("TestClass",
>>>         fields = list (text = "character"),
>>>         methods = list (
>>>                 initialize = function (text) {
>>> initFields(text=paste(text,"\n")) },
>>>                 print = function ()  { cat(text) } )
>>> )
>>>
>>> All the best,
>>> Jon
>>>
>>>
>>> On 28 October 2010 15:13, Daniel Lee<bearlee at alum.mit.edu>    wrote:
>>>>
>>>> Is it possible to override the $new(...) in the reference class
>>>> generator? I
>>>> have tried adding a "new" method to the methods of the class, but that is
>>>> obviously not correct. I have also tried adding it to the class
>>>> generator,
>>>> but the class generator still uses the default constructor.
>>>>
>>>> As a simple example, this is the current interface:
>>>> TestClass<- setRefClass ("TestClass",
>>>>         fields = list (text = "character"),
>>>>         methods = list (
>>>>                 print = function ()  {cat(text)})
>>>> )
>>>> test<- TestClass$new (text="Hello World")
>>>> test$print()
>>>>
>>>> I would like to override $new(...) to be something like (add a "\n" to
>>>> the
>>>> end of the input, no need to specify input fields):
>>>> TestClass$methods (new = function (text) {
>>>>             text<- paste (text, "\n")
>>>>             methods:::new (def, text=text)
>>>>         })
>>>>
>>>> The constructor would then be:
>>>> test<- TestClass$new ("Hello World")
>>>>
>>>> This is a subtle, but useful change. I have also tried adding to
>>>> TestClass a
>>>> method $newInstance(text), but that was not successful. If this is not
>>>> possible, could we consider augmenting the Reference Class interface to
>>>> include constructors?
>>>>
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From hpages at fhcrc.org  Fri Oct 29 19:53:44 2010
From: hpages at fhcrc.org (=?ISO-8859-1?Q?Herv=E9_Pag=E8s?=)
Date: Fri, 29 Oct 2010 10:53:44 -0700
Subject: [Rd] list2env() is broken
In-Reply-To: <alpine.LFD.2.00.1010290812150.1613@gannet.stats.ox.ac.uk>
References: <4CCA613D.3050802@fhcrc.org>
	<alpine.LFD.2.00.1010290812150.1613@gannet.stats.ox.ac.uk>
Message-ID: <4CCB0A28.2040407@fhcrc.org>

Hi,

On 10/29/2010 12:17 AM, Prof Brian Ripley wrote:
> I have no idea what 'timeout' means, but that *should* take an
> extraordinarily long time (it is at least quadratic in the input
> length). This is the point of hashing -- you *need* hash=TRUE, and you
> should probably also set 'size' in new.env.

I can see that this has just been changed and now list2env() decides
to use hash=TRUE for me (when length(x) > 100). Sounds reasonable since
I *need* it.
Also the man page didn't mention anything about the purpose of
hash=TRUE (now it does, thanks), it was just saying "see new.env"
but the man page for new.env() doesn't say much either (in particular
it doesn't say anything about the quadratic behavior when hash=FALSE).

>
> There was an obvious missing PROTECT in this function.

Thanks for catching and fixing this.

>
> I do wonder if you are yet familiar with the debugging tools described
> in 'Writing R Extensions' -- please do use them before reporting.

Please note that I've tried to put as much details as possible in the
last 10 bug reports or so that I've made (most of the time even
suggesting solutions). Sometimes I don't have time to debug or to come
with a solution but I think it's still worth reporting the problem,
especially when it's a crash. Also AFAIK the posting guide says nothing
about me having to use the debugging tools or come up with a solution
before I report a problem.

Thanks again for the fix,
H.

>
> On Thu, 28 Oct 2010, Herv? Pag?s wrote:
>
>> Hi,
>>
>> The following code produces different kinds of problems depending
>> on which platform you run it:
>>
>> x <- as.list(1:200000)
>> names(x) <- paste("A", 1:200000, sep="")
>> e <- list2env(x)
>>
>> Timeout on Linux, crash on Mac and Windows, with R 2.12.0 and
>> current R devel.
>>
>> The "multi-assign" mode (i.e. when the 'envir' arg is supplied)
>> doesn't seem to have this problem.
>>
>> Cheers,
>> H.
>>
>> --
>> Herv? Pag?s
>>
>> Program in Computational Biology
>> Division of Public Health Sciences
>> Fred Hutchinson Cancer Research Center
>> 1100 Fairview Ave. N, M2-B876
>> P.O. Box 19024
>> Seattle, WA 98109-1024
>>
>> E-mail: hpages at fhcrc.org
>> Phone: (206) 667-5791
>> Fax: (206) 667-1319
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>


-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M2-B876
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fhcrc.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From spinuvit.list at gmail.com  Fri Oct 29 22:42:08 2010
From: spinuvit.list at gmail.com (Vitalie S.)
Date: Fri, 29 Oct 2010 22:42:08 +0200
Subject: [Rd] Reference Classes: Generalizing Reference Class Generator
	objects?
In-Reply-To: <4CCAFCD5.5040106@r-project.org> (John Chambers's message of
	"Fri, 29 Oct 2010 09:56:53 -0700")
References: <4CC98517.3050605@alum.mit.edu>
	<AANLkTin6WXF-mMy_whb_cYuiKqrYw+Q3yP+D8NbRRpcO@mail.gmail.com>
	<4CC9B20B.1020204@alum.mit.edu>
	<AANLkTineuXeTVGMGfpWJRi0P0G5BYhqwGej5-TFU9txs@mail.gmail.com>
	<4CCAFCD5.5040106@r-project.org>
Message-ID: <8739ro689r.fsf@gmail.com>

John Chambers <jmc at r-project.org> writes:

> Good diagnoses.
>
> This thread brought up a point or two that needed some fixes to the documentation and code.  They should be in
> r-devel and 2.12 patched (from rev. 53471).
>
> Briefly:
>
> - Initialization methods should take account of future subclasses to your class by including and passing on the
> ... argument, so that additional fields can be specified.  Discussed briefly now in the $new(...) section of
> ?ReferenceClasses.
>
> - The InitFields() method is fine but was an early kludge when callSuper() didn't work for initialize().  To allow
> for the case that your class has a superclass with an initialize() method, use the callSuper() approach.  There is
> an example now in the documentation.

What about, extending the generator class in general? Looking at the source I
can infer that there is little that can be done about it (except rewriting the
setRefClass function itself). Does that mean that the refObjectGenerator class is
not supposed to be extended?

Also, tangentially related to above, why generator objects in the first place?
It might have been implemented as S4 class with the slot "def" to hold the
representation of refClasses. No additional generators would hang around,
extension of generators would be easier and departure from S4 would be minimal.

The only reason I could think off, is the inability to write ref style methods
for it. But, I must be definitely missing something here.

Thanks,
Vitalie.
>
> On 10/28/10 10:55 AM, Jon Clayden wrote:
>> ?ReferenceClasses says "Reference methods can not themselves be
>> generic functions; if you want additional function-based method
>> dispatch, write a separate generic function and call that from the
>> method". So I think you'd need to take that approach in your
>> "initialize" method.
>>
>> Hope this helps,
>> Jon
>>
>>
>> On 28 October 2010 18:25, Daniel Lee<bearlee at alum.mit.edu>  wrote:
>>> Thank you. Your example really clarifies what the $initialize(...) function
>>> is supposed to do.
>>>
>>> Do you know if there is a straightforward way to dispatch the $new(...)
>>> method based on the signature of the arguments? I am thinking along the
>>> lines of S4 methods with valid signatures.
>>>
>>> Thanks again for the example.
>>>
>>>
>>> On 10/28/2010 12:12 PM, Jon Clayden wrote:
>>>>
>>>> Sorry - you don't need to assign the value of initFields(). I was
>>>> going to do it in two lines but then realised one was enough... :)
>>>>
>>>> TestClass<- setRefClass ("TestClass",
>>>>         fields = list (text = "character"),
>>>>         methods = list (
>>>>                 initialize = function (text) {
>>>> initFields(text=paste(text,"\n")) },
>>>>                 print = function ()  { cat(text) } )
>>>> )
>>>>
>>>> All the best,
>>>> Jon
>>>>
>>>>
>>>> On 28 October 2010 15:13, Daniel Lee<bearlee at alum.mit.edu>    wrote:
>>>>>
>>>>> Is it possible to override the $new(...) in the reference class
>>>>> generator? I
>>>>> have tried adding a "new" method to the methods of the class, but that is
>>>>> obviously not correct. I have also tried adding it to the class
>>>>> generator,
>>>>> but the class generator still uses the default constructor.
>>>>>
>>>>> As a simple example, this is the current interface:
>>>>> TestClass<- setRefClass ("TestClass",
>>>>>         fields = list (text = "character"),
>>>>>         methods = list (
>>>>>                 print = function ()  {cat(text)})
>>>>> )
>>>>> test<- TestClass$new (text="Hello World")
>>>>> test$print()
>>>>>
>>>>> I would like to override $new(...) to be something like (add a "\n" to
>>>>> the
>>>>> end of the input, no need to specify input fields):
>>>>> TestClass$methods (new = function (text) {
>>>>>             text<- paste (text, "\n")
>>>>>             methods:::new (def, text=text)
>>>>>         })
>>>>>
>>>>> The constructor would then be:
>>>>> test<- TestClass$new ("Hello World")
>>>>>
>>>>> This is a subtle, but useful change. I have also tried adding to
>>>>> TestClass a
>>>>> method $newInstance(text), but that was not successful. If this is not
>>>>> possible, could we consider augmenting the Reference Class interface to
>>>>> include constructors?
>>>>>
>>>>> ______________________________________________
>>>>> R-devel at r-project.org mailing list
>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel>>>>
>>>
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel>


From hb at stat.berkeley.edu  Fri Oct 29 22:56:54 2010
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Fri, 29 Oct 2010 13:56:54 -0700
Subject: [Rd] list2env() is broken
In-Reply-To: <4CCB0A28.2040407@fhcrc.org>
References: <4CCA613D.3050802@fhcrc.org>
	<alpine.LFD.2.00.1010290812150.1613@gannet.stats.ox.ac.uk>
	<4CCB0A28.2040407@fhcrc.org>
Message-ID: <AANLkTimdwwXrinn5tfcfR2z2Aaai2-p-R5SMzw8WohJB@mail.gmail.com>

On Fri, Oct 29, 2010 at 10:53 AM, Herv? Pag?s <hpages at fhcrc.org> wrote:
> Hi,
>
> On 10/29/2010 12:17 AM, Prof Brian Ripley wrote:
>>
>> I have no idea what 'timeout' means, but that *should* take an
>> extraordinarily long time (it is at least quadratic in the input
>> length). This is the point of hashing -- you *need* hash=TRUE, and you
>> should probably also set 'size' in new.env.
>
> I can see that this has just been changed and now list2env() decides
> to use hash=TRUE for me (when length(x) > 100). Sounds reasonable since
> I *need* it.
> Also the man page didn't mention anything about the purpose of
> hash=TRUE (now it does, thanks), it was just saying "see new.env"
> but the man page for new.env() doesn't say much either (in particular
> it doesn't say anything about the quadratic behavior when hash=FALSE).
>
>>
>> There was an obvious missing PROTECT in this function.
>
> Thanks for catching and fixing this.
>
>>
>> I do wonder if you are yet familiar with the debugging tools described
>> in 'Writing R Extensions' -- please do use them before reporting.
>
> Please note that I've tried to put as much details as possible in the
> last 10 bug reports or so that I've made (most of the time even
> suggesting solutions). Sometimes I don't have time to debug or to come
> with a solution but I think it's still worth reporting the problem,
> especially when it's a crash. Also AFAIK the posting guide says nothing
> about me having to use the debugging tools or come up with a solution
> before I report a problem.

I second this; it is better to share potential issues than being
silent about them; others might observe the same thing and pitch in.

I also agree that everyone should try to troubleshoot as much as
possible to minimize the efforts required by anyone trying to solve
the problem.  It's a fine balance, it's a pain as a maintainer having
to do the last bit of troubleshooting just to find out in the end that
it was an error by the user/report, but we have to accept some false
positives in order to catch more true positives.  As often done on
this list, FPs are accepted but when a user keep reporting many of
them, it is made clear to them that he/she needs to do more
troubleshooting before reporting.  It seems to work in most cases.

We need to embrace testers and reports on potential issues without
requiring them to provide the actually fixes or even understanding the
code.

/Henrik
/Henrik

>
> Thanks again for the fix,
> H.
>
>>
>> On Thu, 28 Oct 2010, Herv? Pag?s wrote:
>>
>>> Hi,
>>>
>>> The following code produces different kinds of problems depending
>>> on which platform you run it:
>>>
>>> x <- as.list(1:200000)
>>> names(x) <- paste("A", 1:200000, sep="")
>>> e <- list2env(x)
>>>
>>> Timeout on Linux, crash on Mac and Windows, with R 2.12.0 and
>>> current R devel.
>>>
>>> The "multi-assign" mode (i.e. when the 'envir' arg is supplied)
>>> doesn't seem to have this problem.
>>>
>>> Cheers,
>>> H.
>>>
>>> --
>>> Herv? Pag?s
>>>
>>> Program in Computational Biology
>>> Division of Public Health Sciences
>>> Fred Hutchinson Cancer Research Center
>>> 1100 Fairview Ave. N, M2-B876
>>> P.O. Box 19024
>>> Seattle, WA 98109-1024
>>>
>>> E-mail: hpages at fhcrc.org
>>> Phone: (206) 667-5791
>>> Fax: (206) 667-1319
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>
>
>
> --
> Herv? Pag?s
>
> Program in Computational Biology
> Division of Public Health Sciences
> Fred Hutchinson Cancer Research Center
> 1100 Fairview Ave. N, M2-B876
> P.O. Box 19024
> Seattle, WA 98109-1024
>
> E-mail: hpages at fhcrc.org
> Phone: ?(206) 667-5791
> Fax: ? ?(206) 667-1319
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From simon.urbanek at r-project.org  Fri Oct 29 23:57:45 2010
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Fri, 29 Oct 2010 17:57:45 -0400
Subject: [Rd] list2env() is broken
In-Reply-To: <AANLkTimdwwXrinn5tfcfR2z2Aaai2-p-R5SMzw8WohJB@mail.gmail.com>
References: <4CCA613D.3050802@fhcrc.org>
	<alpine.LFD.2.00.1010290812150.1613@gannet.stats.ox.ac.uk>
	<4CCB0A28.2040407@fhcrc.org>
	<AANLkTimdwwXrinn5tfcfR2z2Aaai2-p-R5SMzw8WohJB@mail.gmail.com>
Message-ID: <7C129F9F-79DA-4D7D-B974-88F8A6F06CAA@r-project.org>


On Oct 29, 2010, at 4:56 PM, Henrik Bengtsson wrote:

> On Fri, Oct 29, 2010 at 10:53 AM, Herv? Pag?s <hpages at fhcrc.org> wrote:
>> Hi,
>> 
>> On 10/29/2010 12:17 AM, Prof Brian Ripley wrote:
>>> 
>>> I have no idea what 'timeout' means, but that *should* take an
>>> extraordinarily long time (it is at least quadratic in the input
>>> length). This is the point of hashing -- you *need* hash=TRUE, and you
>>> should probably also set 'size' in new.env.
>> 
>> I can see that this has just been changed and now list2env() decides
>> to use hash=TRUE for me (when length(x) > 100). Sounds reasonable since
>> I *need* it.
>> Also the man page didn't mention anything about the purpose of
>> hash=TRUE (now it does, thanks), it was just saying "see new.env"
>> but the man page for new.env() doesn't say much either (in particular
>> it doesn't say anything about the quadratic behavior when hash=FALSE).
>> 
>>> 
>>> There was an obvious missing PROTECT in this function.
>> 
>> Thanks for catching and fixing this.
>> 
>>> 
>>> I do wonder if you are yet familiar with the debugging tools described
>>> in 'Writing R Extensions' -- please do use them before reporting.
>> 
>> Please note that I've tried to put as much details as possible in the
>> last 10 bug reports or so that I've made (most of the time even
>> suggesting solutions). Sometimes I don't have time to debug or to come
>> with a solution but I think it's still worth reporting the problem,
>> especially when it's a crash. Also AFAIK the posting guide says nothing
>> about me having to use the debugging tools or come up with a solution
>> before I report a problem.
> 
> I second this; it is better to share potential issues than being
> silent about them; others might observe the same thing and pitch in.
> 

That part yes, but I think Herve took it the wrong way - no one is asking people for solutions as they are very often wrong and may be leading away form the real cause. What is more important are precise facts. I think Brian's point was that reports should have enough details to be useful and Herve's "timeout on Linux, crash on Mac and Windows" is so vague and uninformative (timeout of what? when? crash where?) that it's essentially useless (the example was not - which I think was the only reason someone looked at it). If you have a crash, it's good idea to include a crash report. Also there is no such thing as "timeout" in this context - Herve meant probably hanging R which you should look at by attaching a debugger to get a backtrace to see where it is (on Mac you get an automatic backtrace if you force-quite the app which makes it easier). I think Herve is experienced enough to know better ;).

Cheers,
Simon


> I also agree that everyone should try to troubleshoot as much as
> possible to minimize the efforts required by anyone trying to solve
> the problem.  It's a fine balance, it's a pain as a maintainer having
> to do the last bit of troubleshooting just to find out in the end that
> it was an error by the user/report, but we have to accept some false
> positives in order to catch more true positives.  As often done on
> this list, FPs are accepted but when a user keep reporting many of
> them, it is made clear to them that he/she needs to do more
> troubleshooting before reporting.  It seems to work in most cases.
> 
> We need to embrace testers and reports on potential issues without
> requiring them to provide the actually fixes or even understanding the
> code.
> 

Yes, exactly and 

> /Henrik
> /Henrik
> 
>> 
>> Thanks again for the fix,
>> H.
>> 
>>> 
>>> On Thu, 28 Oct 2010, Herv? Pag?s wrote:
>>> 
>>>> Hi,
>>>> 
>>>> The following code produces different kinds of problems depending
>>>> on which platform you run it:
>>>> 
>>>> x <- as.list(1:200000)
>>>> names(x) <- paste("A", 1:200000, sep="")
>>>> e <- list2env(x)
>>>> 
>>>> Timeout on Linux, crash on Mac and Windows, with R 2.12.0 and
>>>> current R devel.
>>>> 
>>>> The "multi-assign" mode (i.e. when the 'envir' arg is supplied)
>>>> doesn't seem to have this problem.
>>>> 
>>>> Cheers,
>>>> H.
>>>> 
>>>> --
>>>> Herv? Pag?s
>>>> 
>>>> Program in Computational Biology
>>>> Division of Public Health Sciences
>>>> Fred Hutchinson Cancer Research Center
>>>> 1100 Fairview Ave. N, M2-B876
>>>> P.O. Box 19024
>>>> Seattle, WA 98109-1024
>>>> 
>>>> E-mail: hpages at fhcrc.org
>>>> Phone: (206) 667-5791
>>>> Fax: (206) 667-1319
>>>> 
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>> 
>>> 
>> 
>> 
>> --
>> Herv? Pag?s
>> 
>> Program in Computational Biology
>> Division of Public Health Sciences
>> Fred Hutchinson Cancer Research Center
>> 1100 Fairview Ave. N, M2-B876
>> P.O. Box 19024
>> Seattle, WA 98109-1024
>> 
>> E-mail: hpages at fhcrc.org
>> Phone:  (206) 667-5791
>> Fax:    (206) 667-1319
>> 
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>> 
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 


From hpages at fhcrc.org  Sat Oct 30 00:59:09 2010
From: hpages at fhcrc.org (=?ISO-8859-1?Q?Herv=E9_Pag=E8s?=)
Date: Fri, 29 Oct 2010 15:59:09 -0700
Subject: [Rd] list2env() is broken
In-Reply-To: <7C129F9F-79DA-4D7D-B974-88F8A6F06CAA@r-project.org>
References: <4CCA613D.3050802@fhcrc.org>	<alpine.LFD.2.00.1010290812150.1613@gannet.stats.ox.ac.uk>	<4CCB0A28.2040407@fhcrc.org>	<AANLkTimdwwXrinn5tfcfR2z2Aaai2-p-R5SMzw8WohJB@mail.gmail.com>
	<7C129F9F-79DA-4D7D-B974-88F8A6F06CAA@r-project.org>
Message-ID: <4CCB51BD.7090700@fhcrc.org>

Hi Simon,

On 10/29/2010 02:57 PM, Simon Urbanek wrote:
>
> On Oct 29, 2010, at 4:56 PM, Henrik Bengtsson wrote:
>
>> On Fri, Oct 29, 2010 at 10:53 AM, Herv? Pag?s<hpages at fhcrc.org>  wrote:
>>> Hi,
>>>
>>> On 10/29/2010 12:17 AM, Prof Brian Ripley wrote:
>>>>
>>>> I have no idea what 'timeout' means, but that *should* take an
>>>> extraordinarily long time (it is at least quadratic in the input
>>>> length). This is the point of hashing -- you *need* hash=TRUE, and you
>>>> should probably also set 'size' in new.env.
>>>
>>> I can see that this has just been changed and now list2env() decides
>>> to use hash=TRUE for me (when length(x)>  100). Sounds reasonable since
>>> I *need* it.
>>> Also the man page didn't mention anything about the purpose of
>>> hash=TRUE (now it does, thanks), it was just saying "see new.env"
>>> but the man page for new.env() doesn't say much either (in particular
>>> it doesn't say anything about the quadratic behavior when hash=FALSE).
>>>
>>>>
>>>> There was an obvious missing PROTECT in this function.
>>>
>>> Thanks for catching and fixing this.
>>>
>>>>
>>>> I do wonder if you are yet familiar with the debugging tools described
>>>> in 'Writing R Extensions' -- please do use them before reporting.
>>>
>>> Please note that I've tried to put as much details as possible in the
>>> last 10 bug reports or so that I've made (most of the time even
>>> suggesting solutions). Sometimes I don't have time to debug or to come
>>> with a solution but I think it's still worth reporting the problem,
>>> especially when it's a crash. Also AFAIK the posting guide says nothing
>>> about me having to use the debugging tools or come up with a solution
>>> before I report a problem.
>>
>> I second this; it is better to share potential issues than being
>> silent about them; others might observe the same thing and pitch in.
>>
>
> That part yes, but I think Herve took it the wrong way - no one is asking people for solutions as they are very often wrong and may be leading away form the real cause. What is more important are precise facts. I think Brian's point was that reports should have enough details to be useful and Herve's "timeout on Linux, crash on Mac and Windows" is so vague and uninformative (timeout of what? when? crash where?) that it's essentially useless (the example was not - which I think was the only reason someone looked at it). If you have a crash, it's good idea to include a crash report. Also there is no such thing as "timeout" in this context - Herve meant probably hanging R which you should look at by attaching a debugger to get a backtrace to see where it is (on Mac you get an automatic backtrace if you force-quite the app which makes it easier). I think Herve is experienced enough to know better ;).
>

I think my report was as useful as it can be. Useful in the sense that
someone could actually use it to reproduce the problem and come up with
a fix. See: the fix was made less than 2 hours after I reported the
problem. Much faster than any of the other bugs/problems I've reported
on this list in the past 2 or 3 months.

So again, thanks for the prompt fix and useful improvements to the
function!

And sorry for using the term "timeout" in the inappropriate context.
Was 11 pm when I reported the problem last night and I was trying
to understand why this package times out on our build system:

 
http://bioconductor.org/checkResults/2.8/bioc-LATEST/CoCiteStats/lamb2-checksrc.html

Ah, and about the traceback. Well it was not that useful so that's why
I didn't include it:

 >   x <- as.list(1:200000)
 >   names(x) <- paste("A", 1:200000, sep="")
 >   e <- list2env(x)

  *** caught bus error ***
address 0x18, cause 'non-existent physical address'

Traceback:
  1: list2env(x)

Also I don't see that it is a requirement in the posting guide
(but I do agree that a traceback is generally a must).

Cheers,
H.


> Cheers,
> Simon
>
>
>> I also agree that everyone should try to troubleshoot as much as
>> possible to minimize the efforts required by anyone trying to solve
>> the problem.  It's a fine balance, it's a pain as a maintainer having
>> to do the last bit of troubleshooting just to find out in the end that
>> it was an error by the user/report, but we have to accept some false
>> positives in order to catch more true positives.  As often done on
>> this list, FPs are accepted but when a user keep reporting many of
>> them, it is made clear to them that he/she needs to do more
>> troubleshooting before reporting.  It seems to work in most cases.
>>
>> We need to embrace testers and reports on potential issues without
>> requiring them to provide the actually fixes or even understanding the
>> code.
>>
>
> Yes, exactly and
>
>> /Henrik
>> /Henrik
>>
>>>
>>> Thanks again for the fix,
>>> H.
>>>
>>>>
>>>> On Thu, 28 Oct 2010, Herv? Pag?s wrote:
>>>>
>>>>> Hi,
>>>>>
>>>>> The following code produces different kinds of problems depending
>>>>> on which platform you run it:
>>>>>
>>>>> x<- as.list(1:200000)
>>>>> names(x)<- paste("A", 1:200000, sep="")
>>>>> e<- list2env(x)
>>>>>
>>>>> Timeout on Linux, crash on Mac and Windows, with R 2.12.0 and
>>>>> current R devel.
>>>>>
>>>>> The "multi-assign" mode (i.e. when the 'envir' arg is supplied)
>>>>> doesn't seem to have this problem.
>>>>>
>>>>> Cheers,
>>>>> H.
>>>>>
>>>>> --
>>>>> Herv? Pag?s
>>>>>
>>>>> Program in Computational Biology
>>>>> Division of Public Health Sciences
>>>>> Fred Hutchinson Cancer Research Center
>>>>> 1100 Fairview Ave. N, M2-B876
>>>>> P.O. Box 19024
>>>>> Seattle, WA 98109-1024
>>>>>
>>>>> E-mail: hpages at fhcrc.org
>>>>> Phone: (206) 667-5791
>>>>> Fax: (206) 667-1319
>>>>>
>>>>> ______________________________________________
>>>>> R-devel at r-project.org mailing list
>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>>
>>>>
>>>
>>>
>>> --
>>> Herv? Pag?s
>>>
>>> Program in Computational Biology
>>> Division of Public Health Sciences
>>> Fred Hutchinson Cancer Research Center
>>> 1100 Fairview Ave. N, M2-B876
>>> P.O. Box 19024
>>> Seattle, WA 98109-1024
>>>
>>> E-mail: hpages at fhcrc.org
>>> Phone:  (206) 667-5791
>>> Fax:    (206) 667-1319
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M2-B876
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fhcrc.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From jc at or.psychology.dal.ca  Sat Oct 30 18:28:57 2010
From: jc at or.psychology.dal.ca (John Christie)
Date: Sat, 30 Oct 2010 13:28:57 -0300
Subject: [Rd] IQR modification recommendation (with code!! :) )
Message-ID: <B2007DB0-8A10-4A1A-9A1C-FDC45D7930D1@or.psychology.dal.ca>

Hi,

Teaching this year I was noticing that there seems to be an odd limitation in

the IQR function.  It doesn't allow one to set the quantile type.  It seems to
me an easy thing to fix.  The current function is?


IQR <- function (x, na.rm = FALSE)  diff(quantile(as.numeric(x), c(0.25, 0.75),
na.rm = na.rm, names = FALSE))


I propose that it be changed to?


IQR <- function (x, ...)  diff(quantile(as.numeric(x), c(0.25, 0.75), names =
FALSE, ...))


The new version has exactly the same default behaviour but allows one to set all
features of the quantile function from the IQR function.  A simple pointer in
the docs to quantile, na.rm option, and maybe even mention of types (especially
type 6 when teaching students hand calculations) would be all that would be
needed.


Would this be a bad thing in any way?


John Christie

From michael.m.spiegel at gmail.com  Sun Oct 31 17:41:24 2010
From: michael.m.spiegel at gmail.com (Michael Spiegel)
Date: Sun, 31 Oct 2010 12:41:24 -0400
Subject: [Rd] BLAS benchmarks on R 2.12.0
Message-ID: <AANLkTi=Er4FQYh-JO4eSA3PFefWdT6fuHr2S1ocwEe7t@mail.gmail.com>

Hi,

I saw on the mailing list and in the NEWS file that some unsafe math
transformations were disabled for the reference BLAS implementation
that is used in R.  We have a set of performance tests for the OpenMx
library, and some of the tests have a x3-10 slowdown in R 2.12.0
versus 2.11.1.  When I copy the shared library libRblas.0.dylib from
the 2.11.1 installation into the 2.12.0 installation, the slowdown
goes away.  It seems reasonable that BLAS should conform to IEEE
requirements.  For the purposes of our library, we are considering two
options but I need some advice on both choices:

1) Compile the reference BLAS implementation with unsafe optimizations
and include it as a part of the OpenMx library.  I can't seem to
reproduce the speed of the 2.11.1 reference BLAS library.  What
compiler, which version of the compiler, and what flags are used when
an R binary is distributed? My test machine is a Mac Pro, that may
change the answer.

2) Is there any support for adding a libRblas.unsafe.dylib shared
library in the R installation, much like libRblas.veclib.dylib is
currently included in OS X binaries? Then we could just change the
OpenMx shared library to use the unsafe library when we give it to
users.  We currently change the OpenMx shared library to use the
reference blas implementation, because it is faster than the veclib
implementation for small matrices.

Thank you!
--Michael

