From maechler at stat.math.ethz.ch  Tue Jul  1 12:05:14 2008
From: maechler at stat.math.ethz.ch (maechler at stat.math.ethz.ch)
Date: Tue,  1 Jul 2008 12:05:14 +0200 (CEST)
Subject: [Rd] Bug in plnorm (PR#11867)
Message-ID: <20080701100514.55EBC282EFF1@mail.pubhealth.ku.dk>

Thank you, Goran,

that's indeed a buglet  (also for  lower.tail=TRUE) that will be fixed
shortly.

Regards,
Martin 

>>>>> "GB" == G????????????ran Brostr????????????m <gb at stat.umu.se>
>>>>>     on Mon, 30 Jun 2008 00:45:21 +0200 (CEST) writes:

    GB> Full_Name: G??ran Brostr??m Version: 2.7.1 OS: Ubuntu 8.04
    GB> (x86_64) Submission from: (NULL) (85.11.40.53)


    >> plnorm(0, lower.tail = FALSE, log.p = TRUE)

    GB> returns 1 instead of the correct 0 (zero).

    GB> The same seems to hold for

    >> plnorm(x, lower.tail = FALSE, log.p = TRUE)

    GB> for any negative value of x.

    GB> ______________________________________________
    GB> R-devel at r-project.org mailing list
    GB> https://stat.ethz.ch/mailman/listinfo/r-devel


From nakama at ki.rim.or.jp  Tue Jul  1 15:05:51 2008
From: nakama at ki.rim.or.jp (Ei-ji Nakama)
Date: Tue, 1 Jul 2008 22:05:51 +0900
Subject: [Rd] AIX 5.3 --enable-R-shlib make error with R-2.7.1
In-Reply-To: <8A880C79FFE28546933CE022FE244C7C02BDC611@msgswbiadsm48.wellsfargo.com>
References: <8A880C79FFE28546933CE022FE244C7C02BDC611@msgswbiadsm48.wellsfargo.com>
Message-ID: <dc41e1260807010605l25659e6dl9514c1c31a7b00c7@mail.gmail.com>

Hi

Perhaps I think that there is a possibility that success of former link
was my hallucination...

Please try this patch if you like.
http://prs.ism.ac.jp/~nakama/AIX/aix_R-2.7.1_Rshlib_include_configure.patch

Some problems are left in gcc, but think that the make is possible.

If you want to eat iconv, please cook the following.
http://prs.ism.ac.jp/~nakama/AIX/AIX_iconv_CookBook.txt

However, a problem occurred in checkFF and nls when I built it in gcc.

Because nls and checkFF do not have any problem with a commercial
compiler, I think that there is a problem in recent gcc side

2008/7/1  <Jagat.K.Sheth at wellsfargo.com>:
> Using AIX 5.3 and gcc-4.2.1 for building R-2.7.1 with the following
> configure flags
>
> OBJECT_MODE=64
> CC="gcc -maix64"
> CXX="g++ -maix64"
> F77="gfortran -maix64"
> FC="gfortran -maix64"
> CFLAGS="-g -O3"
> CXXFLAGS="-g -O3"
> FFLAGS="-g -O3"
> FCFLAGS="-g -O3"
> LDFLAGS="-L/$HOME/usr/local/lib/ppc64 -L/$HOME/usr/local/lib"
> CPPFLAGS="-I/$HOME/usr/include"
> ./configure --disable-nls --without-iconv --prefix=$HOME/usr/local
> --enable-R-shlib
>
> After a successful configuration, the make stops with the following
> error on this system
>
> make[3]: Entering directory
> `/home/apps/crm_cm/n731661x/src/R-2.7.1/src/main'
> gcc -maix64 -std=gnu99 -I../../src/extra/zlib -I../../src/extra/bzip2
> -I../../src/extra/pcre  -I. -I../../src/include -I../../src/include
> -I//users/apps/crm_cm/n731661x/usr/include -DHAVE_CONFIG_H
> -mminimal-toc   -g -O3 -c Rmain.c -o Rmain.o
> gcc -maix64 -std=gnu99 -Wl,-brtl -Wl,-bexpall -Wl,-bpT:0x100000000
> -Wl,-bpD:0x110000000 -lc
> -L//users/apps/crm_cm/n731661x/usr/local/lib/ppc64
> -L//users/apps/crm_cm/n731661x/usr/local/lib -o R.bin Rmain.o
> -L../../lib -lR
> ld: 0711-317 ERROR: Undefined symbol: R_running_as_main_program
> ld: 0711-345 Use the -bloadmap or -bnoquiet option to obtain more
> information.
> collect2: ld returned 8 exit status
> make[3]: *** [R.bin] Error 1
> make[3]: Leaving directory
> `/home/apps/crm_cm/n731661x/src/R-2.7.1/src/main'
> make[2]: *** [R] Error 2
> make[2]: Leaving directory
> `/home/apps/crm_cm/n731661x/src/R-2.7.1/src/main'
> make[1]: *** [R] Error 1
> make[1]: Leaving directory `/home/apps/crm_cm/n731661x/src/R-2.7.1/src'
> make: *** [R] Error 1
>
> On the other hand, no problems on this system with the above
> configuration building R<=2.6.2. Can also successfully build R-2.7.1
> here without --enable-R-shlib.
>
> Will be glad to experiment or provide more details if needed anytime.
>
> Thanks,
> Jagat
>
>
> --
> Jagat K. Sheth
> Prepayment Modeling and Economics
> Wells Fargo Home Mortgage
> 7911 Forsyth Boulevard
> Suite 500, M5001-061
> Clayton, MO 63105
>
> Tel: (314)-726-4496
> Fax: (314)-726-4483
> jagat.k.sheth at wellsfargo.com
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>
>



-- 
EI-JI Nakama <nakama at ki.rim.or.jp>
"\u4e2d\u9593\u6804\u6cbb" <nakama at ki.rim.or.jp>


From tobias.verbeke at telenet.be  Tue Jul  1 15:57:16 2008
From: tobias.verbeke at telenet.be (Tobias Verbeke)
Date: Tue, 01 Jul 2008 13:57:16 +0000
Subject: [Rd] Autoconf / Windows package building problem for device package
Message-ID: <W1956210678187551214920636@nocme1bl6.telenet-ops.be>

Dear list,

Tadashi Kadowaki has developed a pdf device package
that allows to add hyperlinks and popups
to (currently) text, mtext and rect calls.

The package passes R CMD check (minor warnings) and compiles
on MacOS X and GNU/Linux, but we do not succeed in building
the package for Windows.

The current version of the package can be
checked out as

svn checkout svn://svn.r-forge.r-project.org/svnroot/pdf2/trunk

Please find the 00install.out below.

Could anyone tell why config.h is not found?

My practical experience with the GNU build
tools is very limited but I would have hoped
config.h.in would be processed into config.h.

Any pointer or hint will be appreciated.

Many thanks in advance,
Tobias

P.S. 00install.out (using R 2.7.1 and a current Rtools28.exe):



installing R.css in C:/DOCUME~1/tverbeke/WORKSP~2/pdf2/TRUNK~1.RCH


---------- Making package trunk ------------

   **********************************************
   WARNING: this package has a configure script
         It probably needs manual configuration
   **********************************************

  adding build stamp to DESCRIPTION
  installing NAMESPACE file and metadata
  making DLL ...
gcc  -std=gnu99  -Ic:/R/R-2.7.0/include   -Iinclude -DHAVE_CONFIG_H  -O3 -Wall  -c devPS.c -o devPS.o
devPS.c:26:20: error: config.h: No such file or directory
In file included from devPS.c:29:
include/Defn.h:1022: error: expected '=', ',', ';', 'asm' or '__attribute__' before 'Rf_onsigusr1'
include/Defn.h:1023: error: expected '=', ',', ';', 'asm' or '__attribute__' before 'Rf_onsigusr2'
In file included from c:\rtools\mingw\bin\../lib/gcc/mingw32/4.2.1-sjlj/../../../../include/wchar.h:352,
                 from include/Defn.h:1126,
                 from devPS.c:29:
c:\rtools\mingw\bin\../lib/gcc/mingw32/4.2.1-sjlj/../../../../include/stdint.h:66: error: conflicting types for 'intptr_t'
include/Defn.h:204: error: previous declaration of 'intptr_t' was here
c:\rtools\mingw\bin\../lib/gcc/mingw32/4.2.1-sjlj/../../../../include/stdint.h:75: error: conflicting types for 'uintptr_t'
include/Defn.h:207: error: previous declaration of 'uintptr_t' was here
devPS.c: In function 'pathcmp':
devPS.c:449: error: 'FILESEP' undeclared (first use in this function)
devPS.c:449: error: (Each undeclared identifier is reported only once
devPS.c:449: error: for each function it appears in.)
devPS.c: In function 'LoadEncoding':
devPS.c:515: error: 'FILESEP' undeclared (first use in this function)
devPS.c: In function 'PostScriptLoadFontMetrics':
devPS.c:560: error: 'FILESEP' undeclared (first use in this function)
devPS.c: In function 'PostScriptMetricInfo':
devPS.c:862: warning: implicit declaration of function 'Riconv_open'
devPS.c:862: warning: assignment makes pointer from integer without a cast
devPS.c:872: warning: implicit declaration of function 'Riconv'
devPS.c:874: warning: implicit declaration of function 'Riconv_close'
devPS.c: In function 'mbcsToSbcs':
devPS.c:4020: warning: assignment makes pointer from integer without a cast
devPS.c:4029: error: 'EILSEQ' undeclared (first use in this function)
devPS.c: In function 'PDF_NewPage':
devPS.c:6406: warning: unused variable 'i'
devPS.c: In function 'PDF_StrSize':
devPS.c:7129: warning: unused variable 'face'
devPS.c:7128: warning: unused variable 'pd'
devPS.c: In function 'PDFAnnotBox':
devPS.c:7469: warning: passing argument 5 of 'Rf_GConvert' from incompatible pointer type
devPS.c:7470: warning: passing argument 5 of 'Rf_GConvert' from incompatible pointer type
make[3]: *** [devPS.o] Error 1
make[2]: *** [srcDynlib] Error 2
make[1]: *** [all] Error 2
make: *** [pkg-trunk] Error 2
*** Installation of trunk failed ***

Removing 'C:/DOCUME~1/tverbeke/WORKSP~2/pdf2/TRUNK~1.RCH/trunk'


From simon.urbanek at r-project.org  Tue Jul  1 17:01:45 2008
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Tue, 1 Jul 2008 11:01:45 -0400
Subject: [Rd] Autoconf / Windows package building problem for device
	package
In-Reply-To: <W1956210678187551214920636@nocme1bl6.telenet-ops.be>
References: <W1956210678187551214920636@nocme1bl6.telenet-ops.be>
Message-ID: <BA263532-73BC-434C-90C1-8B6164331C3B@r-project.org>

Tobias,

that package uses headers internal to R (a really bad thing to do).  
Although it attempts to supply them (very dangerous again since they  
are R-version-dependent) they rely on configured R sources which are  
not present on Windows. I don't have a Windows machine handy, but I  
dimly remember that you can find manually created config.h for Windows  
in fixed-h directory under gnuwin32. It's a hack (and I'm not sure if  
it helps), though, so I'd strongly suggest Tadashi to fix his package  
to use official API as was suggested a few times already.

Cheers,
Simon


On Jul 1, 2008, at 9:57 AM, Tobias Verbeke wrote:

> Dear list,
>
> Tadashi Kadowaki has developed a pdf device package
> that allows to add hyperlinks and popups
> to (currently) text, mtext and rect calls.
>
> The package passes R CMD check (minor warnings) and compiles
> on MacOS X and GNU/Linux, but we do not succeed in building
> the package for Windows.
>
> The current version of the package can be
> checked out as
>
> svn checkout svn://svn.r-forge.r-project.org/svnroot/pdf2/trunk
>
> Please find the 00install.out below.
>
> Could anyone tell why config.h is not found?
>
> My practical experience with the GNU build
> tools is very limited but I would have hoped
> config.h.in would be processed into config.h.
>
> Any pointer or hint will be appreciated.
>
> Many thanks in advance,
> Tobias
>
> P.S. 00install.out (using R 2.7.1 and a current Rtools28.exe):
>
>
>
> installing R.css in C:/DOCUME~1/tverbeke/WORKSP~2/pdf2/TRUNK~1.RCH
>
>
> ---------- Making package trunk ------------
>
>   **********************************************
>   WARNING: this package has a configure script
>         It probably needs manual configuration
>   **********************************************
>
>  adding build stamp to DESCRIPTION
>  installing NAMESPACE file and metadata
>  making DLL ...
> gcc  -std=gnu99  -Ic:/R/R-2.7.0/include   -Iinclude -DHAVE_CONFIG_H   
> -O3 -Wall  -c devPS.c -o devPS.o
> devPS.c:26:20: error: config.h: No such file or directory
> In file included from devPS.c:29:
> include/Defn.h:1022: error: expected '=', ',', ';', 'asm' or  
> '__attribute__' before 'Rf_onsigusr1'
> include/Defn.h:1023: error: expected '=', ',', ';', 'asm' or  
> '__attribute__' before 'Rf_onsigusr2'
> In file included from c:\rtools\mingw\bin\../lib/gcc/mingw32/4.2.1- 
> sjlj/../../../../include/wchar.h:352,
>                 from include/Defn.h:1126,
>                 from devPS.c:29:
> c:\rtools\mingw\bin\../lib/gcc/mingw32/4.2.1-sjlj/../../../../ 
> include/stdint.h:66: error: conflicting types for 'intptr_t'
> include/Defn.h:204: error: previous declaration of 'intptr_t' was here
> c:\rtools\mingw\bin\../lib/gcc/mingw32/4.2.1-sjlj/../../../../ 
> include/stdint.h:75: error: conflicting types for 'uintptr_t'
> include/Defn.h:207: error: previous declaration of 'uintptr_t' was  
> here
> devPS.c: In function 'pathcmp':
> devPS.c:449: error: 'FILESEP' undeclared (first use in this function)
> devPS.c:449: error: (Each undeclared identifier is reported only once
> devPS.c:449: error: for each function it appears in.)
> devPS.c: In function 'LoadEncoding':
> devPS.c:515: error: 'FILESEP' undeclared (first use in this function)
> devPS.c: In function 'PostScriptLoadFontMetrics':
> devPS.c:560: error: 'FILESEP' undeclared (first use in this function)
> devPS.c: In function 'PostScriptMetricInfo':
> devPS.c:862: warning: implicit declaration of function 'Riconv_open'
> devPS.c:862: warning: assignment makes pointer from integer without  
> a cast
> devPS.c:872: warning: implicit declaration of function 'Riconv'
> devPS.c:874: warning: implicit declaration of function 'Riconv_close'
> devPS.c: In function 'mbcsToSbcs':
> devPS.c:4020: warning: assignment makes pointer from integer without  
> a cast
> devPS.c:4029: error: 'EILSEQ' undeclared (first use in this function)
> devPS.c: In function 'PDF_NewPage':
> devPS.c:6406: warning: unused variable 'i'
> devPS.c: In function 'PDF_StrSize':
> devPS.c:7129: warning: unused variable 'face'
> devPS.c:7128: warning: unused variable 'pd'
> devPS.c: In function 'PDFAnnotBox':
> devPS.c:7469: warning: passing argument 5 of 'Rf_GConvert' from  
> incompatible pointer type
> devPS.c:7470: warning: passing argument 5 of 'Rf_GConvert' from  
> incompatible pointer type
> make[3]: *** [devPS.o] Error 1
> make[2]: *** [srcDynlib] Error 2
> make[1]: *** [all] Error 2
> make: *** [pkg-trunk] Error 2
> *** Installation of trunk failed ***
>
> Removing 'C:/DOCUME~1/tverbeke/WORKSP~2/pdf2/TRUNK~1.RCH/trunk'
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From timhesterberg at gmail.com  Tue Jul  1 20:20:46 2008
From: timhesterberg at gmail.com (Tim Hesterberg)
Date: Tue, 1 Jul 2008 11:20:46 -0700
Subject: [Rd] [.data.frame speedup
Message-ID: <e21d304c0807011120i23d873b9n8a913f54cac7f357@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20080701/605af45a/attachment.pl>

From timhesterberg at gmail.com  Wed Jul  2 00:23:53 2008
From: timhesterberg at gmail.com (Tim Hesterberg)
Date: Tue, 1 Jul 2008 15:23:53 -0700
Subject: [Rd] [.data.frame speedup
In-Reply-To: <e21d304c0807011120i23d873b9n8a913f54cac7f357@mail.gmail.com>
References: <e21d304c0807011120i23d873b9n8a913f54cac7f357@mail.gmail.com>
Message-ID: <e21d304c0807011523y6b47a6ft7dd8edf32d62f7de@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20080701/c3c6f0d2/attachment.pl>

From murdoch at stats.uwo.ca  Wed Jul  2 02:29:06 2008
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Tue, 01 Jul 2008 20:29:06 -0400
Subject: [Rd] get ...
In-Reply-To: <alpine.LFD.1.10.0806300950510.2815@nokomis.stat.uiowa.edu>
References: <971536df0806281246o75249479gaab3a059952e0f85@mail.gmail.com>	<4866A174.4050706@biostat.ku.dk>
	<alpine.LFD.1.10.0806300950510.2815@nokomis.stat.uiowa.edu>
Message-ID: <486ACBD2.60409@stats.uwo.ca>

On 30/06/2008 10:56 AM, Luke Tierney wrote:
> On Sat, 28 Jun 2008, Peter Dalgaard wrote:
> 
>> Gabor Grothendieck wrote:
>>> Suppose we do this:
>>>
>>>
>>>> f <- function(...) environment()
>>>> e <- f(a = 1, b = 2)
>>>> ls(e, all = TRUE)
>>>>
>>> [1] "..."
>>>
>>>> e$...
>>>>
>>> <...>
>>>
>>>> class(e$...)
>>>>
>>> [1] "..."
>>>
>>> Is there any way of getting a and b given e without
>>> modifying f?
>>>
>>> evalq(list(...),e)
>> $a
>> [1] 1
>>
>> $b
>> [1] 2
>>
>>
> 
> I'm wondering though whether we should allow the internal DOTSXP value
> of "..." to escape to the user level.  Might be more appropriate for
> get(e,"..."), e$... (and as.list.environment and maybe a few other
> things) to give the "Error: '...' used in an incorrect context" error
> if the value is a DOTSXP.

On the other hand, what Gabor sees in e is what he would see inside f:

> f <- function(...) { ls(all=T) }
> f(a=1, b=2)
[1] "..."
I don't think we should distinguish between user level in .GlobalEnv and 
what a user sees inside a function he writes.  Stopping a user from 
seeing ... inside a function would break all sorts of things.

Duncan Murdoch


From timhesterberg at gmail.com  Wed Jul  2 03:00:20 2008
From: timhesterberg at gmail.com (Tim Hesterberg)
Date: Tue, 1 Jul 2008 18:00:20 -0700
Subject: [Rd] [.data.frame speedup
In-Reply-To: <e21d304c0807011523y6b47a6ft7dd8edf32d62f7de@mail.gmail.com>
References: <e21d304c0807011120i23d873b9n8a913f54cac7f357@mail.gmail.com>
	<e21d304c0807011523y6b47a6ft7dd8edf32d62f7de@mail.gmail.com>
Message-ID: <e21d304c0807011800k38a8aad3k56466f69d56400b0@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20080701/b606f045/attachment.pl>

From kurt.van.dijck at skynet.be  Wed Jul  2 10:00:40 2008
From: kurt.van.dijck at skynet.be (Kurt Van Dijck)
Date: Wed, 02 Jul 2008 10:00:40 +0200
Subject: [Rd] spss long labels
Message-ID: <486B35A8.5000700@skynet.be>

Hi,

A frequently seen issue with importing SPSS data files, is that R does
not import the 'long variable names'.
I built a patch on the R-project's foreign module, in order to import
the 'long variable names' from SPSS (record 7, subtype 13).
To complete the job, I had to expand the "struct variable" definition
to have 64 +1 charachters. I'm not aware of side effects.
The sfm-read.c code works fine.
I didn't test a variety of platforms, as I don't have an idea of what is
regarded as sufficient testing. Anyway, I don't expect major troubles there
(no byteswapping problems, no 32<->64 bit issues) as it's mainly character processing.
The patch is relative to the foreign directory. It was created
against the trunk of R-project yesterday.

We would appreciate that you import such patch into the main tree.

Kind regards,

Kurt Van Dijck (C programmer) & Ilse Laurijssen (R user)
Belgium

Index: src/sfm-read.c
===================================================================
--- src/sfm-read.c	(revision 5168)
+++ src/sfm-read.c	(working copy)
@@ -188,6 +188,8 @@
  static int read_variables (struct file_handle * h, struct variable *** var_by_index);
  static int read_machine_int32_info (struct file_handle * h, int size, int count, int *encoding);
  static int read_machine_flt64_info (struct file_handle * h, int size, int count);
+static int read_long_var_names (struct file_handle * h, struct dictionary *
+		, unsigned long size, unsigned int count);
  static int read_documents (struct file_handle * h);

  /* Displays the message X with corrupt_msg, then jumps to the lossage
@@ -418,11 +420,15 @@
  		break;

  	      case 7: /* Multiple-response sets (later versions of SPSS). */
-	      case 13:  /* long variable names. PSPP now has code for these
-			   that could be ported if someone is interested. */
  		skip = 1;
  		break;

+	      case 13:	/* long variable names. PSPP now has code for these
+			   that could be ported if someone is interested. */
+		if (!read_long_var_names(h, ext->dict, data.size, data.count))
+		  goto lossage;
+		break;
+
  	      case 16: /* See http://www.nabble.com/problem-loading-SPSS-15.0-save-files-t2726500.html */
  		skip = 1;
  		break;
@@ -584,14 +590,72 @@
    return 0;
  }

+/* Read record type 7, subtype 13.
+ * long variable names
+ */
  static int
+read_long_var_names (struct file_handle * h, struct dictionary * dict
+		, unsigned long size, unsigned int count)
+{
+  char * data;
+  unsigned int j;
+  struct variable ** lp;
+  struct variable ** end;
+  char * p;
+  char * endp;
+  char * val;
+  if ((1 != size)||(0 == count)) {
+    warning("%s: strange record info seen, size=%u, count=%u"
+      ", ignoring long variable names"
+      , h->fn, size, count);
+    return 0;
+  }
+  size *= count;
+  data = Calloc (size +1, char);
+  bufread(h, data, size, 0);
+  /* parse */
+  end = &dict->var[dict->nvar];
+  p = data;
+  do {
+    if (0 != (endp = strchr(p, '\t')))
+      *endp = 0; /* put null terminator */
+    if (0 == (val = strchr(p, '='))) {
+      warning("%s: no long variable name for variable '%s'", h->fn, p);
+    } else {
+      *val = 0;
+      ++val;
+      /* now, p is key, val is long name */
+      for (lp = dict->var; lp < end; ++lp) {
+        if (!strcmp(lp[0]->name, p)) {
+          strncpy(lp[0]->name, val, sizeof(lp[0]->name));
+          break;
+        }
+      }
+      if (lp >= end) {
+        warning("%s: long variable name mapping '%s' to '%s'"
+        "for variable which does not exist"
+        , h->fn, p, val);
+      }
+    }
+    p = &endp[1]; /* put to next */
+  } while (endp);
+
+  free(data);
+  return 1;
+
+lossage:
+  free(data);
+  return 0;
+}
+
+static int
  read_header (struct file_handle * h, struct sfm_read_info * inf)
  {
    struct sfm_fhuser_ext *ext = h->ext;	/* File extension strcut. */
    struct sysfile_header hdr;		/* Disk buffer. */
    struct dictionary *dict;		/* File dictionary. */
    char prod_name[sizeof hdr.prod_name + 1];	/* Buffer for product name. */
-  int skip_amt = 0;		        /* Amount of product name to omit. */
+  int skip_amt = 0;			/* Amount of product name to omit. */
    int i;

    /* Create the dictionary. */
@@ -1495,7 +1559,7 @@
  /* Reads one case from system file H into the value array PERM
     according to the instructions given in associated dictionary DICT,
     which must have the get.* elements appropriately set.  Returns
-   nonzero only if successful.  */
+   nonzero only if successful.	*/
  int
  sfm_read_case (struct file_handle * h, union value * perm, struct dictionary * dict)
  {
Index: src/var.h.in
===================================================================
--- src/var.h.in	(revision 5168)
+++ src/var.h.in	(working copy)
@@ -41,6 +41,10 @@
  #error MAX_SHORT_STRING must be less than 8.
  #endif

+/* VAR_NAME_LEN: the length of a variable.
+ * SPSS supports names of 64 long
+ */
+#define VAR_NAME_LEN 64
  /* Special values. */
  #define SYSMIS (-DBL_MAX)
  #define LOWEST second_lowest_double_val()
@@ -228,7 +232,7 @@
  /* MODIFY VARS private data. */
  struct modify_vars_proc
    {
-    char new_name[9];		/* Variable's new name. */
+    char new_name[VAR_NAME_LEN +1];		/* Variable's new name. */
      int drop_this_var;		/* 0=keep this var, 1=drop this var. */
      struct variable *next;	/* Next in linked list. */
    };
@@ -302,7 +306,7 @@
  struct variable
    {
      /* Required by parse_variables() to be in this order.  */
-    char name[9];		/* As a string. */
+    char name[VAR_NAME_LEN +1];	/* As a string. */
      int index;			/* Index into its dictionary's var[]. */
      int type;			/* NUMERIC or ALPHA. */
      int foo;			/* Used for temporary storage. */
@@ -373,9 +377,9 @@

      int weight_index;		/* `value' index of $WEIGHT, or -1 if none.
  				   Call update_weighting() before using! */
-    char weight_var[9];		/* Name of WEIGHT variable. */
+    char weight_var[VAR_NAME_LEN];/* Name of WEIGHT variable. */

-    char filter_var[9];		/* Name of FILTER variable. */
+    char filter_var[VAR_NAME_LEN];/* Name of FILTER variable. */
      /* Do not make another field the last field! or see
         temporary.c:restore_dictionary() before doing so! */
    };


From ravichandra.kurapati at alcatel-lucent.com  Wed Jul  2 12:20:51 2008
From: ravichandra.kurapati at alcatel-lucent.com (Kurapati,
	Ravichandra (Ravichandra))
Date: Wed, 2 Jul 2008 15:50:51 +0530
Subject: [Rd] how to concatenate two strings
Message-ID: <46404CB7389F1E4092DC68115C00B3EEE45F96@INEXC1U01.in.lucent.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20080702/fa40adc4/attachment.pl>

From murdoch at stats.uwo.ca  Wed Jul  2 12:29:58 2008
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Wed, 02 Jul 2008 06:29:58 -0400
Subject: [Rd] how to concatenate two strings
In-Reply-To: <46404CB7389F1E4092DC68115C00B3EEE45F96@INEXC1U01.in.lucent.com>
References: <46404CB7389F1E4092DC68115C00B3EEE45F96@INEXC1U01.in.lucent.com>
Message-ID: <486B58A6.8030902@stats.uwo.ca>

Kurapati, Ravichandra (Ravichandra) wrote:
>  Is there any function in R
>
>  To concatenate the two strings
>
>  
paste() is what you want.

(Generally questions like this should go to the R-help list.  R-devel is 
more for development of R, or low-level programming with it.)

Duncan Murdoch


From tadakado at gmail.com  Wed Jul  2 12:41:51 2008
From: tadakado at gmail.com (Tadashi Kadowaki)
Date: Wed, 2 Jul 2008 19:41:51 +0900
Subject: [Rd] Autoconf / Windows package building problem for device
	package
In-Reply-To: <BA263532-73BC-434C-90C1-8B6164331C3B@r-project.org>
References: <W1956210678187551214920636@nocme1bl6.telenet-ops.be>
	<BA263532-73BC-434C-90C1-8B6164331C3B@r-project.org>
Message-ID: <dcb3073c0807020341u67fadcddgf12f49b7fa0e5312@mail.gmail.com>

Simon,

Now, pdf2 does not use "manually created config.h", but create own
config.h by itself.
The package also does not refer internal headers installed with R.
However, the package
needs internal headers, because original pdf device code needs them.
Therefore, It has
local copies of the headers.
Your suggestion is quite proper, and this is still bad implementation.
But, to catch up the
development of pdf device in the R core, my approach is pragmatic. I'll release
version-specific packages by using internal headers of each R
versions. If the package
checks R version strictly, this approach should be not so dangerous,
because almost
all code of pdf2 is from original pdf device code.
(I know I have to use pdf device code and headers from R 2.7.1 now)

Regards,
Tadashi Kadowaki

2008/7/2 Simon Urbanek <simon.urbanek at r-project.org>:
> Tobias,
>
> that package uses headers internal to R (a really bad thing to do). Although
> it attempts to supply them (very dangerous again since they are
> R-version-dependent) they rely on configured R sources which are not present
> on Windows. I don't have a Windows machine handy, but I dimly remember that
> you can find manually created config.h for Windows in fixed-h directory
> under gnuwin32. It's a hack (and I'm not sure if it helps), though, so I'd
> strongly suggest Tadashi to fix his package to use official API as was
> suggested a few times already.
>
> Cheers,
> Simon
>
>
> On Jul 1, 2008, at 9:57 AM, Tobias Verbeke wrote:
>
>> Dear list,
>>
>> Tadashi Kadowaki has developed a pdf device package
>> that allows to add hyperlinks and popups
>> to (currently) text, mtext and rect calls.
>>
>> The package passes R CMD check (minor warnings) and compiles
>> on MacOS X and GNU/Linux, but we do not succeed in building
>> the package for Windows.
>>
>> The current version of the package can be
>> checked out as
>>
>> svn checkout svn://svn.r-forge.r-project.org/svnroot/pdf2/trunk
>>
>> Please find the 00install.out below.
>>
>> Could anyone tell why config.h is not found?
>>
>> My practical experience with the GNU build
>> tools is very limited but I would have hoped
>> config.h.in would be processed into config.h.
>>
>> Any pointer or hint will be appreciated.
>>
>> Many thanks in advance,
>> Tobias
>>
>> P.S. 00install.out (using R 2.7.1 and a current Rtools28.exe):
>>
>>
>>
>> installing R.css in C:/DOCUME~1/tverbeke/WORKSP~2/pdf2/TRUNK~1.RCH
>>
>>
>> ---------- Making package trunk ------------
>>
>>  **********************************************
>>  WARNING: this package has a configure script
>>        It probably needs manual configuration
>>  **********************************************
>>
>>  adding build stamp to DESCRIPTION
>>  installing NAMESPACE file and metadata
>>  making DLL ...
>> gcc  -std=gnu99  -Ic:/R/R-2.7.0/include   -Iinclude -DHAVE_CONFIG_H  -O3
>> -Wall  -c devPS.c -o devPS.o
>> devPS.c:26:20: error: config.h: No such file or directory
>> In file included from devPS.c:29:
>> include/Defn.h:1022: error: expected '=', ',', ';', 'asm' or
>> '__attribute__' before 'Rf_onsigusr1'
>> include/Defn.h:1023: error: expected '=', ',', ';', 'asm' or
>> '__attribute__' before 'Rf_onsigusr2'
>> In file included from
>> c:\rtools\mingw\bin\../lib/gcc/mingw32/4.2.1-sjlj/../../../../include/wchar.h:352,
>>                from include/Defn.h:1126,
>>                from devPS.c:29:
>>
>> c:\rtools\mingw\bin\../lib/gcc/mingw32/4.2.1-sjlj/../../../../include/stdint.h:66:
>> error: conflicting types for 'intptr_t'
>> include/Defn.h:204: error: previous declaration of 'intptr_t' was here
>>
>> c:\rtools\mingw\bin\../lib/gcc/mingw32/4.2.1-sjlj/../../../../include/stdint.h:75:
>> error: conflicting types for 'uintptr_t'
>> include/Defn.h:207: error: previous declaration of 'uintptr_t' was here
>> devPS.c: In function 'pathcmp':
>> devPS.c:449: error: 'FILESEP' undeclared (first use in this function)
>> devPS.c:449: error: (Each undeclared identifier is reported only once
>> devPS.c:449: error: for each function it appears in.)
>> devPS.c: In function 'LoadEncoding':
>> devPS.c:515: error: 'FILESEP' undeclared (first use in this function)
>> devPS.c: In function 'PostScriptLoadFontMetrics':
>> devPS.c:560: error: 'FILESEP' undeclared (first use in this function)
>> devPS.c: In function 'PostScriptMetricInfo':
>> devPS.c:862: warning: implicit declaration of function 'Riconv_open'
>> devPS.c:862: warning: assignment makes pointer from integer without a cast
>> devPS.c:872: warning: implicit declaration of function 'Riconv'
>> devPS.c:874: warning: implicit declaration of function 'Riconv_close'
>> devPS.c: In function 'mbcsToSbcs':
>> devPS.c:4020: warning: assignment makes pointer from integer without a
>> cast
>> devPS.c:4029: error: 'EILSEQ' undeclared (first use in this function)
>> devPS.c: In function 'PDF_NewPage':
>> devPS.c:6406: warning: unused variable 'i'
>> devPS.c: In function 'PDF_StrSize':
>> devPS.c:7129: warning: unused variable 'face'
>> devPS.c:7128: warning: unused variable 'pd'
>> devPS.c: In function 'PDFAnnotBox':
>> devPS.c:7469: warning: passing argument 5 of 'Rf_GConvert' from
>> incompatible pointer type
>> devPS.c:7470: warning: passing argument 5 of 'Rf_GConvert' from
>> incompatible pointer type
>> make[3]: *** [devPS.o] Error 1
>> make[2]: *** [srcDynlib] Error 2
>> make[1]: *** [all] Error 2
>> make: *** [pkg-trunk] Error 2
>> *** Installation of trunk failed ***
>>
>> Removing 'C:/DOCUME~1/tverbeke/WORKSP~2/pdf2/TRUNK~1.RCH/trunk'
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>



-- 
?????
tadakado at gmail.com


From simon.urbanek at r-project.org  Wed Jul  2 15:12:52 2008
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Wed, 2 Jul 2008 09:12:52 -0400
Subject: [Rd] Autoconf / Windows package building problem for device
	package
In-Reply-To: <dcb3073c0807020341u67fadcddgf12f49b7fa0e5312@mail.gmail.com>
References: <W1956210678187551214920636@nocme1bl6.telenet-ops.be>
	<BA263532-73BC-434C-90C1-8B6164331C3B@r-project.org>
	<dcb3073c0807020341u67fadcddgf12f49b7fa0e5312@mail.gmail.com>
Message-ID: <F2312D54-A8E5-45A3-96B9-A82FF1F671D8@r-project.org>


On Jul 2, 2008, at 6:41 AM, Tadashi Kadowaki wrote:

> Simon,
>
> Now, pdf2 does not use "manually created config.h",

I was referring to R - there is no configure step in the Windows build  
so config.h is created "manually" (or semi-automatically if you wish)  
and then shipped with R in a special location.


> but create own config.h by itself.
> The package also does not refer internal headers installed with R.

There are no internal header files installed with R ;) [modulo OS X  
and those are private] - you are simply copying them from R and  
referring to those. This is very tedious and difficult to do right for  
all platforms since you have to test them all (as you see ;)). However  
you don't really need to do that.


>  However, the package needs internal headers, because original pdf  
> device code needs them.

Your package contains way too many things that are not needed (and are  
dangerous because they override R's own functions unnecessarily). It  
would be much simpler if you just added the code that is necessary  
(both R and C) and not just copy everything blindly. There is no real  
need to use internal R headers from graphics devices. If I recall  
correctly that is what Brian Ripley suggested before and it would save  
you a lot of trouble.

Cheers,
Simon


>
> Therefore, It has local copies of the headers.
> Your suggestion is quite proper, and this is still bad implementation.
> But, to catch up the development of pdf device in the R core, my  
> approach is pragmatic. I'll release version-specific packages by  
> using internal headers of each R versions. If the package checks R  
> version strictly, this approach should be not so dangerous, because  
> almost all code of pdf2 is from original pdf device code.
> (I know I have to use pdf device code and headers from R 2.7.1 now)
>
> Regards,
> Tadashi Kadowaki
>
> 2008/7/2 Simon Urbanek <simon.urbanek at r-project.org>:
>> Tobias,
>>
>> that package uses headers internal to R (a really bad thing to do).  
>> Although
>> it attempts to supply them (very dangerous again since they are
>> R-version-dependent) they rely on configured R sources which are  
>> not present
>> on Windows. I don't have a Windows machine handy, but I dimly  
>> remember that
>> you can find manually created config.h for Windows in fixed-h  
>> directory
>> under gnuwin32. It's a hack (and I'm not sure if it helps), though,  
>> so I'd
>> strongly suggest Tadashi to fix his package to use official API as  
>> was
>> suggested a few times already.
>>
>> Cheers,
>> Simon
>>
>>
>> On Jul 1, 2008, at 9:57 AM, Tobias Verbeke wrote:
>>
>>> Dear list,
>>>
>>> Tadashi Kadowaki has developed a pdf device package
>>> that allows to add hyperlinks and popups
>>> to (currently) text, mtext and rect calls.
>>>
>>> The package passes R CMD check (minor warnings) and compiles
>>> on MacOS X and GNU/Linux, but we do not succeed in building
>>> the package for Windows.
>>>
>>> The current version of the package can be
>>> checked out as
>>>
>>> svn checkout svn://svn.r-forge.r-project.org/svnroot/pdf2/trunk
>>>
>>> Please find the 00install.out below.
>>>
>>> Could anyone tell why config.h is not found?
>>>
>>> My practical experience with the GNU build
>>> tools is very limited but I would have hoped
>>> config.h.in would be processed into config.h.
>>>
>>> Any pointer or hint will be appreciated.
>>>
>>> Many thanks in advance,
>>> Tobias
>>>
>>> P.S. 00install.out (using R 2.7.1 and a current Rtools28.exe):
>>>
>>>
>>>
>>> installing R.css in C:/DOCUME~1/tverbeke/WORKSP~2/pdf2/TRUNK~1.RCH
>>>
>>>
>>> ---------- Making package trunk ------------
>>>
>>> **********************************************
>>> WARNING: this package has a configure script
>>>       It probably needs manual configuration
>>> **********************************************
>>>
>>> adding build stamp to DESCRIPTION
>>> installing NAMESPACE file and metadata
>>> making DLL ...
>>> gcc  -std=gnu99  -Ic:/R/R-2.7.0/include   -Iinclude - 
>>> DHAVE_CONFIG_H  -O3
>>> -Wall  -c devPS.c -o devPS.o
>>> devPS.c:26:20: error: config.h: No such file or directory
>>> In file included from devPS.c:29:
>>> include/Defn.h:1022: error: expected '=', ',', ';', 'asm' or
>>> '__attribute__' before 'Rf_onsigusr1'
>>> include/Defn.h:1023: error: expected '=', ',', ';', 'asm' or
>>> '__attribute__' before 'Rf_onsigusr2'
>>> In file included from
>>> c:\rtools\mingw\bin\../lib/gcc/mingw32/4.2.1-sjlj/../../../../ 
>>> include/wchar.h:352,
>>>               from include/Defn.h:1126,
>>>               from devPS.c:29:
>>>
>>> c:\rtools\mingw\bin\../lib/gcc/mingw32/4.2.1-sjlj/../../../../ 
>>> include/stdint.h:66:
>>> error: conflicting types for 'intptr_t'
>>> include/Defn.h:204: error: previous declaration of 'intptr_t' was  
>>> here
>>>
>>> c:\rtools\mingw\bin\../lib/gcc/mingw32/4.2.1-sjlj/../../../../ 
>>> include/stdint.h:75:
>>> error: conflicting types for 'uintptr_t'
>>> include/Defn.h:207: error: previous declaration of 'uintptr_t' was  
>>> here
>>> devPS.c: In function 'pathcmp':
>>> devPS.c:449: error: 'FILESEP' undeclared (first use in this  
>>> function)
>>> devPS.c:449: error: (Each undeclared identifier is reported only  
>>> once
>>> devPS.c:449: error: for each function it appears in.)
>>> devPS.c: In function 'LoadEncoding':
>>> devPS.c:515: error: 'FILESEP' undeclared (first use in this  
>>> function)
>>> devPS.c: In function 'PostScriptLoadFontMetrics':
>>> devPS.c:560: error: 'FILESEP' undeclared (first use in this  
>>> function)
>>> devPS.c: In function 'PostScriptMetricInfo':
>>> devPS.c:862: warning: implicit declaration of function 'Riconv_open'
>>> devPS.c:862: warning: assignment makes pointer from integer  
>>> without a cast
>>> devPS.c:872: warning: implicit declaration of function 'Riconv'
>>> devPS.c:874: warning: implicit declaration of function  
>>> 'Riconv_close'
>>> devPS.c: In function 'mbcsToSbcs':
>>> devPS.c:4020: warning: assignment makes pointer from integer  
>>> without a
>>> cast
>>> devPS.c:4029: error: 'EILSEQ' undeclared (first use in this  
>>> function)
>>> devPS.c: In function 'PDF_NewPage':
>>> devPS.c:6406: warning: unused variable 'i'
>>> devPS.c: In function 'PDF_StrSize':
>>> devPS.c:7129: warning: unused variable 'face'
>>> devPS.c:7128: warning: unused variable 'pd'
>>> devPS.c: In function 'PDFAnnotBox':
>>> devPS.c:7469: warning: passing argument 5 of 'Rf_GConvert' from
>>> incompatible pointer type
>>> devPS.c:7470: warning: passing argument 5 of 'Rf_GConvert' from
>>> incompatible pointer type
>>> make[3]: *** [devPS.o] Error 1
>>> make[2]: *** [srcDynlib] Error 2
>>> make[1]: *** [all] Error 2
>>> make: *** [pkg-trunk] Error 2
>>> *** Installation of trunk failed ***
>>>
>>> Removing 'C:/DOCUME~1/tverbeke/WORKSP~2/pdf2/TRUNK~1.RCH/trunk'
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>>
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
>
>
> -- 
> ?????
> tadakado at gmail.com
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From luke at stat.uiowa.edu  Wed Jul  2 16:57:18 2008
From: luke at stat.uiowa.edu (Luke Tierney)
Date: Wed, 2 Jul 2008 09:57:18 -0500 (CDT)
Subject: [Rd] get ...
In-Reply-To: <486ACBD2.60409@stats.uwo.ca>
References: <971536df0806281246o75249479gaab3a059952e0f85@mail.gmail.com>
	<4866A174.4050706@biostat.ku.dk>
	<alpine.LFD.1.10.0806300950510.2815@nokomis.stat.uiowa.edu>
	<486ACBD2.60409@stats.uwo.ca>
Message-ID: <Pine.LNX.4.64.0807020952220.18218@itasca2.wildberry.org>

On Tue, 1 Jul 2008, Duncan Murdoch wrote:

> On 30/06/2008 10:56 AM, Luke Tierney wrote:
>> On Sat, 28 Jun 2008, Peter Dalgaard wrote:
>> 
>>> Gabor Grothendieck wrote:
>>>> Suppose we do this:
>>>> 
>>>> 
>>>>> f <- function(...) environment()
>>>>> e <- f(a = 1, b = 2)
>>>>> ls(e, all = TRUE)
>>>>> 
>>>> [1] "..."
>>>> 
>>>>> e$...
>>>>> 
>>>> <...>
>>>> 
>>>>> class(e$...)
>>>>> 
>>>> [1] "..."
>>>> 
>>>> Is there any way of getting a and b given e without
>>>> modifying f?
>>>> 
>>>> evalq(list(...),e)
>>> $a
>>> [1] 1
>>> 
>>> $b
>>> [1] 2
>>> 
>>> 
>> 
>> I'm wondering though whether we should allow the internal DOTSXP value
>> of "..." to escape to the user level.  Might be more appropriate for
>> get(e,"..."), e$... (and as.list.environment and maybe a few other
>> things) to give the "Error: '...' used in an incorrect context" error
>> if the value is a DOTSXP.
>
> On the other hand, what Gabor sees in e is what he would see inside f:
>
>> f <- function(...) { ls(all=T) }
>> f(a=1, b=2)
> [1] "..."
> I don't think we should distinguish between user level in .GlobalEnv and what 
> a user sees inside a function he writes.  Stopping a user from seeing ... 
> inside a function would break all sorts of things.

Huh??

Noone is proposing that ls or exist, for example change.  ... is a
special variable that can only be used in special contexts.  Just
evaluating ... gives an error; get("...") used in the same context
probably ought to as well.  What we do now is clearly wrong: return an
undocumented object that can't be used for anyting useful (and
reflects an internal implementation we might want to change).  We need
to either prevent the R_DOTSXP values from leaking out or document
them , define [ methods and figure out what they should do, etc.
Preventing them from leaking out is the sensible thing to do.

luke

>
> Duncan Murdoch
>

-- 
Luke Tierney
Chair, Statistics and Actuarial Science
Ralph E. Wareham Professor of Mathematical Sciences
University of Iowa                  Phone:             319-335-3386
Department of Statistics and        Fax:               319-335-3017
    Actuarial Science
241 Schaeffer Hall                  email:      luke at stat.uiowa.edu
Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu


From ggrothendieck at gmail.com  Wed Jul  2 17:03:27 2008
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Wed, 2 Jul 2008 11:03:27 -0400
Subject: [Rd] get ...
In-Reply-To: <Pine.LNX.4.64.0807020952220.18218@itasca2.wildberry.org>
References: <971536df0806281246o75249479gaab3a059952e0f85@mail.gmail.com>
	<4866A174.4050706@biostat.ku.dk>
	<alpine.LFD.1.10.0806300950510.2815@nokomis.stat.uiowa.edu>
	<486ACBD2.60409@stats.uwo.ca>
	<Pine.LNX.4.64.0807020952220.18218@itasca2.wildberry.org>
Message-ID: <971536df0807020803y10c984m42730b284c20e455@mail.gmail.com>

If access is removed it would be important to provide
an alternative first -- removing access and only providing
an alternative some time later does not seem prudent.

On Wed, Jul 2, 2008 at 10:57 AM, Luke Tierney <luke at stat.uiowa.edu> wrote:
> On Tue, 1 Jul 2008, Duncan Murdoch wrote:
>
>> On 30/06/2008 10:56 AM, Luke Tierney wrote:
>>>
>>> On Sat, 28 Jun 2008, Peter Dalgaard wrote:
>>>
>>>> Gabor Grothendieck wrote:
>>>>>
>>>>> Suppose we do this:
>>>>>
>>>>>
>>>>>> f <- function(...) environment()
>>>>>> e <- f(a = 1, b = 2)
>>>>>> ls(e, all = TRUE)
>>>>>>
>>>>> [1] "..."
>>>>>
>>>>>> e$...
>>>>>>
>>>>> <...>
>>>>>
>>>>>> class(e$...)
>>>>>>
>>>>> [1] "..."
>>>>>
>>>>> Is there any way of getting a and b given e without
>>>>> modifying f?
>>>>>
>>>>> evalq(list(...),e)
>>>>
>>>> $a
>>>> [1] 1
>>>>
>>>> $b
>>>> [1] 2
>>>>
>>>>
>>>
>>> I'm wondering though whether we should allow the internal DOTSXP value
>>> of "..." to escape to the user level.  Might be more appropriate for
>>> get(e,"..."), e$... (and as.list.environment and maybe a few other
>>> things) to give the "Error: '...' used in an incorrect context" error
>>> if the value is a DOTSXP.
>>
>> On the other hand, what Gabor sees in e is what he would see inside f:
>>
>>> f <- function(...) { ls(all=T) }
>>> f(a=1, b=2)
>>
>> [1] "..."
>> I don't think we should distinguish between user level in .GlobalEnv and
>> what a user sees inside a function he writes.  Stopping a user from seeing
>> ... inside a function would break all sorts of things.
>
> Huh??
>
> Noone is proposing that ls or exist, for example change.  ... is a
> special variable that can only be used in special contexts.  Just
> evaluating ... gives an error; get("...") used in the same context
> probably ought to as well.  What we do now is clearly wrong: return an
> undocumented object that can't be used for anyting useful (and
> reflects an internal implementation we might want to change).  We need
> to either prevent the R_DOTSXP values from leaking out or document
> them , define [ methods and figure out what they should do, etc.
> Preventing them from leaking out is the sensible thing to do.
>
> luke
>
>>
>> Duncan Murdoch
>>
>
> --
> Luke Tierney
> Chair, Statistics and Actuarial Science
> Ralph E. Wareham Professor of Mathematical Sciences
> University of Iowa                  Phone:             319-335-3386
> Department of Statistics and        Fax:               319-335-3017
>   Actuarial Science
> 241 Schaeffer Hall                  email:      luke at stat.uiowa.edu
> Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu
>


From luke at stat.uiowa.edu  Wed Jul  2 17:24:58 2008
From: luke at stat.uiowa.edu (Luke Tierney)
Date: Wed, 2 Jul 2008 10:24:58 -0500 (CDT)
Subject: [Rd] get ...
In-Reply-To: <971536df0807020803y10c984m42730b284c20e455@mail.gmail.com>
References: <971536df0806281246o75249479gaab3a059952e0f85@mail.gmail.com> 
	<4866A174.4050706@biostat.ku.dk>
	<alpine.LFD.1.10.0806300950510.2815@nokomis.stat.uiowa.edu>
	<486ACBD2.60409@stats.uwo.ca>
	<Pine.LNX.4.64.0807020952220.18218@itasca2.wildberry.org>
	<971536df0807020803y10c984m42730b284c20e455@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0807021018120.18218@itasca2.wildberry.org>

ACCESS TO WHAT FOR CRYING OUT LOUD!!!!!! What we have now is a way for
a useless internal object that is in any case subject to change to
leak out.  How is that useful, never mind essential?  Exists works, as
it should, ls works, as it should.  In the language, ... arguments in
functions are special, so it is appropriate for variables named
... that are being used in the special context (i.e. have values that
are R_DOTSXP) to behave in a special way, as do variables in
environments that correspond to missing arguments in functions.  The
behavior of assign("...", x, env = e) will not be unaffected for any
valye of x accessible at the R level.

luke

On Wed, 2 Jul 2008, Gabor Grothendieck wrote:

> If access is removed it would be important to provide
> an alternative first -- removing access and only providing
> an alternative some time later does not seem prudent.
>
> On Wed, Jul 2, 2008 at 10:57 AM, Luke Tierney <luke at stat.uiowa.edu> wrote:
>> On Tue, 1 Jul 2008, Duncan Murdoch wrote:
>>
>>> On 30/06/2008 10:56 AM, Luke Tierney wrote:
>>>>
>>>> On Sat, 28 Jun 2008, Peter Dalgaard wrote:
>>>>
>>>>> Gabor Grothendieck wrote:
>>>>>>
>>>>>> Suppose we do this:
>>>>>>
>>>>>>
>>>>>>> f <- function(...) environment()
>>>>>>> e <- f(a = 1, b = 2)
>>>>>>> ls(e, all = TRUE)
>>>>>>>
>>>>>> [1] "..."
>>>>>>
>>>>>>> e$...
>>>>>>>
>>>>>> <...>
>>>>>>
>>>>>>> class(e$...)
>>>>>>>
>>>>>> [1] "..."
>>>>>>
>>>>>> Is there any way of getting a and b given e without
>>>>>> modifying f?
>>>>>>
>>>>>> evalq(list(...),e)
>>>>>
>>>>> $a
>>>>> [1] 1
>>>>>
>>>>> $b
>>>>> [1] 2
>>>>>
>>>>>
>>>>
>>>> I'm wondering though whether we should allow the internal DOTSXP value
>>>> of "..." to escape to the user level.  Might be more appropriate for
>>>> get(e,"..."), e$... (and as.list.environment and maybe a few other
>>>> things) to give the "Error: '...' used in an incorrect context" error
>>>> if the value is a DOTSXP.
>>>
>>> On the other hand, what Gabor sees in e is what he would see inside f:
>>>
>>>> f <- function(...) { ls(all=T) }
>>>> f(a=1, b=2)
>>>
>>> [1] "..."
>>> I don't think we should distinguish between user level in .GlobalEnv and
>>> what a user sees inside a function he writes.  Stopping a user from seeing
>>> ... inside a function would break all sorts of things.
>>
>> Huh??
>>
>> Noone is proposing that ls or exist, for example change.  ... is a
>> special variable that can only be used in special contexts.  Just
>> evaluating ... gives an error; get("...") used in the same context
>> probably ought to as well.  What we do now is clearly wrong: return an
>> undocumented object that can't be used for anyting useful (and
>> reflects an internal implementation we might want to change).  We need
>> to either prevent the R_DOTSXP values from leaking out or document
>> them , define [ methods and figure out what they should do, etc.
>> Preventing them from leaking out is the sensible thing to do.
>>
>> luke
>>
>>>
>>> Duncan Murdoch
>>>
>>
>> --
>> Luke Tierney
>> Chair, Statistics and Actuarial Science
>> Ralph E. Wareham Professor of Mathematical Sciences
>> University of Iowa                  Phone:             319-335-3386
>> Department of Statistics and        Fax:               319-335-3017
>>   Actuarial Science
>> 241 Schaeffer Hall                  email:      luke at stat.uiowa.edu
>> Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu
>>
>

-- 
Luke Tierney
Chair, Statistics and Actuarial Science
Ralph E. Wareham Professor of Mathematical Sciences
University of Iowa                  Phone:             319-335-3386
Department of Statistics and        Fax:               319-335-3017
    Actuarial Science
241 Schaeffer Hall                  email:      luke at stat.uiowa.edu
Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu


From murdoch at stats.uwo.ca  Wed Jul  2 17:27:08 2008
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Wed, 02 Jul 2008 11:27:08 -0400
Subject: [Rd] get ...
In-Reply-To: <Pine.LNX.4.64.0807020952220.18218@itasca2.wildberry.org>
References: <971536df0806281246o75249479gaab3a059952e0f85@mail.gmail.com>
	<4866A174.4050706@biostat.ku.dk>
	<alpine.LFD.1.10.0806300950510.2815@nokomis.stat.uiowa.edu>
	<486ACBD2.60409@stats.uwo.ca>
	<Pine.LNX.4.64.0807020952220.18218@itasca2.wildberry.org>
Message-ID: <486B9E4C.4090708@stats.uwo.ca>

On 7/2/2008 10:57 AM, Luke Tierney wrote:
> On Tue, 1 Jul 2008, Duncan Murdoch wrote:
> 
>> On 30/06/2008 10:56 AM, Luke Tierney wrote:
>>> On Sat, 28 Jun 2008, Peter Dalgaard wrote:
>>> 
>>>> Gabor Grothendieck wrote:
>>>>> Suppose we do this:
>>>>> 
>>>>> 
>>>>>> f <- function(...) environment()
>>>>>> e <- f(a = 1, b = 2)
>>>>>> ls(e, all = TRUE)
>>>>>> 
>>>>> [1] "..."
>>>>> 
>>>>>> e$...
>>>>>> 
>>>>> <...>
>>>>> 
>>>>>> class(e$...)
>>>>>> 
>>>>> [1] "..."
>>>>> 
>>>>> Is there any way of getting a and b given e without
>>>>> modifying f?
>>>>> 
>>>>> evalq(list(...),e)
>>>> $a
>>>> [1] 1
>>>> 
>>>> $b
>>>> [1] 2
>>>> 
>>>> 
>>> 
>>> I'm wondering though whether we should allow the internal DOTSXP value
>>> of "..." to escape to the user level.  Might be more appropriate for
>>> get(e,"..."), e$... (and as.list.environment and maybe a few other
>>> things) to give the "Error: '...' used in an incorrect context" error
>>> if the value is a DOTSXP.
>>
>> On the other hand, what Gabor sees in e is what he would see inside f:
>>
>>> f <- function(...) { ls(all=T) }
>>> f(a=1, b=2)
>> [1] "..."
>> I don't think we should distinguish between user level in .GlobalEnv and what 
>> a user sees inside a function he writes.  Stopping a user from seeing ... 
>> inside a function would break all sorts of things.
> 
> Huh??
> 
> Noone is proposing that ls or exist, for example change.  ... is a
> special variable that can only be used in special contexts.  Just
> evaluating ... gives an error; get("...") used in the same context
> probably ought to as well.  What we do now is clearly wrong: return an
> undocumented object that can't be used for anyting useful (and
> reflects an internal implementation we might want to change).  We need
> to either prevent the R_DOTSXP values from leaking out or document
> them , define [ methods and figure out what they should do, etc.
> Preventing them from leaking out is the sensible thing to do.

Sorry, I misunderstood what you were suggesting.  So you wouldn't 
propose to change the behaviour of Peter's evalq(list(...),e)?

Duncan Murdoch


From Jagat.K.Sheth at wellsfargo.com  Wed Jul  2 15:42:50 2008
From: Jagat.K.Sheth at wellsfargo.com (Jagat.K.Sheth at wellsfargo.com)
Date: Wed, 2 Jul 2008 08:42:50 -0500
Subject: [Rd] AIX 5.3 --enable-R-shlib make error with R-2.7.1
References: <8A880C79FFE28546933CE022FE244C7C02BDC611@msgswbiadsm48.wellsfargo.com>
	<dc41e1260807010605l25659e6dl9514c1c31a7b00c7@mail.gmail.com>
Message-ID: <8A880C79FFE28546933CE022FE244C7C02C08234@msgswbiadsm48.wellsfargo.com>

The patches were successful on this end. 

Many thanks to Ei-ji.


-----Original Message-----
From: rim.nakama at gmail.com [mailto:rim.nakama at gmail.com] On Behalf Of
Ei-ji Nakama
Sent: Tuesday, July 01, 2008 8:06 AM
To: Sheth, Jagat K
Cc: r-devel at r-project.org
Subject: Re: [Rd] AIX 5.3 --enable-R-shlib make error with R-2.7.1

Hi

Perhaps I think that there is a possibility that success of former link
was my hallucination...

Please try this patch if you like.
http://prs.ism.ac.jp/~nakama/AIX/aix_R-2.7.1_Rshlib_include_configure.pa
tch

Some problems are left in gcc, but think that the make is possible.

If you want to eat iconv, please cook the following.
http://prs.ism.ac.jp/~nakama/AIX/AIX_iconv_CookBook.txt

However, a problem occurred in checkFF and nls when I built it in gcc.

Because nls and checkFF do not have any problem with a commercial
compiler, I think that there is a problem in recent gcc side

2008/7/1  <Jagat.K.Sheth at wellsfargo.com>:
> Using AIX 5.3 and gcc-4.2.1 for building R-2.7.1 with the following 
> configure flags
>
> OBJECT_MODE=64
> CC="gcc -maix64"
> CXX="g++ -maix64"
> F77="gfortran -maix64"
> FC="gfortran -maix64"
> CFLAGS="-g -O3"
> CXXFLAGS="-g -O3"
> FFLAGS="-g -O3"
> FCFLAGS="-g -O3"
> LDFLAGS="-L/$HOME/usr/local/lib/ppc64 -L/$HOME/usr/local/lib"
> CPPFLAGS="-I/$HOME/usr/include"
> ./configure --disable-nls --without-iconv --prefix=$HOME/usr/local 
> --enable-R-shlib
>
> After a successful configuration, the make stops with the following 
> error on this system
>
> make[3]: Entering directory
> `/home/apps/crm_cm/n731661x/src/R-2.7.1/src/main'
> gcc -maix64 -std=gnu99 -I../../src/extra/zlib -I../../src/extra/bzip2 
> -I../../src/extra/pcre  -I. -I../../src/include -I../../src/include 
> -I//users/apps/crm_cm/n731661x/usr/include -DHAVE_CONFIG_H
> -mminimal-toc   -g -O3 -c Rmain.c -o Rmain.o
> gcc -maix64 -std=gnu99 -Wl,-brtl -Wl,-bexpall -Wl,-bpT:0x100000000 
> -Wl,-bpD:0x110000000 -lc
> -L//users/apps/crm_cm/n731661x/usr/local/lib/ppc64
> -L//users/apps/crm_cm/n731661x/usr/local/lib -o R.bin Rmain.o 
> -L../../lib -lR
> ld: 0711-317 ERROR: Undefined symbol: R_running_as_main_program
> ld: 0711-345 Use the -bloadmap or -bnoquiet option to obtain more 
> information.
> collect2: ld returned 8 exit status
> make[3]: *** [R.bin] Error 1
> make[3]: Leaving directory
> `/home/apps/crm_cm/n731661x/src/R-2.7.1/src/main'
> make[2]: *** [R] Error 2
> make[2]: Leaving directory
> `/home/apps/crm_cm/n731661x/src/R-2.7.1/src/main'
> make[1]: *** [R] Error 1
> make[1]: Leaving directory
`/home/apps/crm_cm/n731661x/src/R-2.7.1/src'
> make: *** [R] Error 1
>
> On the other hand, no problems on this system with the above 
> configuration building R<=2.6.2. Can also successfully build R-2.7.1 
> here without --enable-R-shlib.
>
> Will be glad to experiment or provide more details if needed anytime.
>
> Thanks,
> Jagat
>
>
> --
> Jagat K. Sheth
> Prepayment Modeling and Economics
> Wells Fargo Home Mortgage
> 7911 Forsyth Boulevard
> Suite 500, M5001-061
> Clayton, MO 63105
>
> Tel: (314)-726-4496
> Fax: (314)-726-4483
> jagat.k.sheth at wellsfargo.com
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>
>



--
EI-JI Nakama <nakama at ki.rim.or.jp>
"\u4e2d\u9593\u6804\u6cbb" <nakama at ki.rim.or.jp>


From mtt2108 at columbia.edu  Wed Jul  2 16:05:04 2008
From: mtt2108 at columbia.edu (mtt2108 at columbia.edu)
Date: Wed,  2 Jul 2008 16:05:04 +0200 (CEST)
Subject: [Rd] Data editor duplicates pairs of backslashes (PR#11897)
Message-ID: <20080702140504.959EE283416A@mail.pubhealth.ku.dk>

Full_Name: Magnus Torfason
Version: 2.7.0
OS: Windows Vista
Submission from: (NULL) (128.59.140.167)


Each time a string is edited in the data editor (on Windows at least), any pairs
of backslashes (an escaped backslash) are duplicated on each edit of the string.
Note that one must actually double click the value for the bug to show up.

Behavior/Replication:

> # Create data frame
> d=data.frame(a="\\")
> # Edit data frame, and while editing, double click 
> # value several times to edit (selecting something 
> # different between each doubleclick)
> d=edit(d)
> d
                 a
1 \\\\\\\\\\\\\\\\


From murdoch at stats.uwo.ca  Wed Jul  2 18:59:26 2008
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Wed, 02 Jul 2008 12:59:26 -0400
Subject: [Rd] Data editor duplicates pairs of backslashes (PR#11897)
In-Reply-To: <20080702140504.959EE283416A@mail.pubhealth.ku.dk>
References: <20080702140504.959EE283416A@mail.pubhealth.ku.dk>
Message-ID: <486BB3EE.6030103@stats.uwo.ca>

On 7/2/2008 10:05 AM, mtt2108 at columbia.edu wrote:
> Full_Name: Magnus Torfason
> Version: 2.7.0
> OS: Windows Vista
> Submission from: (NULL) (128.59.140.167)
> 
> 
> Each time a string is edited in the data editor (on Windows at least), any pairs
> of backslashes (an escaped backslash) are duplicated on each edit of the string.
> Note that one must actually double click the value for the bug to show up.
> 
> Behavior/Replication:
> 
>> # Create data frame
>> d=data.frame(a="\\")
>> # Edit data frame, and while editing, double click 
>> # value several times to edit (selecting something 
>> # different between each doubleclick)
>> d=edit(d)
>> d
>                  a
> 1 \\\\\\\\\\\\\\\\

Thanks for the report, I can reproduce it in 2.7.1 and R-devel, on Linux 
as well as Windows.

I think we really do want the double backslash to be displayed, so that 
what you are working on in the editor can contain escape sequences; the 
bug is that they are being treated literally after the edit.

I'll see if I can fix it.

Duncan Murdoch


From yozhik at computer.org  Thu Jul  3 01:27:16 2008
From: yozhik at computer.org (Tom Murray)
Date: Wed, 2 Jul 2008 16:27:16 -0700
Subject: [Rd] Constructing logical expressions dynamically
Message-ID: <39abe3570807021627y211f35e8u33d096dda7e5d2d@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20080702/f4b2e4e3/attachment.pl>

From murdoch at stats.uwo.ca  Thu Jul  3 02:38:00 2008
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Wed, 02 Jul 2008 20:38:00 -0400
Subject: [Rd] Constructing logical expressions dynamically
In-Reply-To: <39abe3570807021627y211f35e8u33d096dda7e5d2d@mail.gmail.com>
References: <39abe3570807021627y211f35e8u33d096dda7e5d2d@mail.gmail.com>
Message-ID: <486C1F68.2010608@stats.uwo.ca>

On 02/07/2008 7:27 PM, Tom Murray wrote:
> Hello,
> 
> I am trying to construct a logical expression dynamically, for use in the
> subset() function. I am puzzled by problems with the code that follows
> below.
> 
> Probably there's an easier way to select rows of a data frame according to
> some dynamic criteria--and I'd love to hear about it--but I'd also like to
> understand what I'm doing incorrectly in constructing the expression in my
> code.
> 
> Thanks in advance,
> 
> tm
> 
> 
> 
> # These two expressions print the same, at least.
> e1 = expression(name == 'a')

e1 is an object of class "expression":

 > class(e1)
[1] "expression"

It prints looking like a function call because R doesn't know any other 
way to print an expression.

> e2 = substitute(expression(cname == 'a'), list(cname=as.symbol('name')))

e2 is not, it's an unevaluated function call:

 > class(e2)
[1] "call"

It really is a function call, as class() tells us.

If you evaluate it, you get something just like e1:

 > class(eval(e2))
[1] "expression"


> print (e1)
> print (e2)
> 
> # But they do not evaluate the same!
> 
> # This works.
> data = data.frame(name=c('a', 'b', 'c', 'a'), age=c(1,2,3,4))
> d1 = subset(data, eval(e1))
> print (d1)
> 
> # This gives the error:
> #     Error in subset.data.frame(data, eval(e2)) :
> #       'subset' must evaluate to logical
> d2 = subset(data, eval(e2))
> print (d2)

The problem here is that eval(e2) is an expression; you need to evaluate 
it to get the logical vector, i.e.

d2 <- subset(data, eval(eval(e2)))

Duncan Murdoch


From tadakado at gmail.com  Thu Jul  3 02:50:11 2008
From: tadakado at gmail.com (Tadashi Kadowaki)
Date: Thu, 3 Jul 2008 09:50:11 +0900
Subject: [Rd] Autoconf / Windows package building problem for device
	package
In-Reply-To: <F2312D54-A8E5-45A3-96B9-A82FF1F671D8@r-project.org>
References: <W1956210678187551214920636@nocme1bl6.telenet-ops.be>
	<BA263532-73BC-434C-90C1-8B6164331C3B@r-project.org>
	<dcb3073c0807020341u67fadcddgf12f49b7fa0e5312@mail.gmail.com>
	<F2312D54-A8E5-45A3-96B9-A82FF1F671D8@r-project.org>
Message-ID: <dcb3073c0807021750yf92781dm9ea2755b7b5095ee@mail.gmail.com>

Simon,

>> Now, pdf2 does not use "manually created config.h",
>
> I was referring to R - there is no configure step in the Windows build so
> config.h is created "manually" (or semi-automatically if you wish) and then
> shipped with R in a special location.

I misunderstand what you meant. I found src/gnuwin32/fixed/h/config.h in
source distribution of R. Thank you for that. It would be useful for building
pdf2 package in Windows.

>> but create own config.h by itself.
>> The package also does not refer internal headers installed with R.
>
> There are no internal header files installed with R ;) [modulo OS X and
> those are private] - you are simply copying them from R and referring to
> those. This is very tedious and difficult to do right for all platforms
> since you have to test them all (as you see ;)). However you don't really
> need to do that.
>
>
>>  However, the package needs internal headers, because original pdf device
>> code needs them.
>
> Your package contains way too many things that are not needed (and are
> dangerous because they override R's own functions unnecessarily).

If you say the package is dangerous because of overriding R's own functions
unnecessarily, it is not correct. I carefully choose functions to be overridden.
Following functions are minimals for adding new features of pdf device.

 > library(pdf2)
 Attaching package: 'pdf2'
	The following object(s) are masked from package:graphics :
	 mtext,
	 rect,
	 text
	The following object(s) are masked from package:grDevices :
	 pdf,
	 pdf.options,
	 pdfFonts

> It would
> be much simpler if you just added the code that is necessary (both R and C)
> and not just copy everything blindly. There is no real need to use internal
> R headers from graphics devices. If I recall correctly that is what Brian
> Ripley suggested before and it would save you a lot of trouble.

For writing a proper package of R, you are completely correct.
However, I don't want to pay efforts for simplifying the code.
I think the pdf2 package is designed for proof of the concept of
adding pdf specific features, such as pop-up text and url link.
Therefore, I want to keep devPS.c of the pdf2 replaceable with that of R.
This is also better for following the edge of R development.

Regards,
Tadashi Kadowaki

>
> Cheers,
> Simon
>
>
>>
>> Therefore, It has local copies of the headers.
>> Your suggestion is quite proper, and this is still bad implementation.
>> But, to catch up the development of pdf device in the R core, my approach
>> is pragmatic. I'll release version-specific packages by using internal
>> headers of each R versions. If the package checks R version strictly, this
>> approach should be not so dangerous, because almost all code of pdf2 is from
>> original pdf device code.
>> (I know I have to use pdf device code and headers from R 2.7.1 now)
>>
>> Regards,
>> Tadashi Kadowaki
>>
>> 2008/7/2 Simon Urbanek <simon.urbanek at r-project.org>:
>>>
>>> Tobias,
>>>
>>> that package uses headers internal to R (a really bad thing to do).
>>> Although
>>> it attempts to supply them (very dangerous again since they are
>>> R-version-dependent) they rely on configured R sources which are not
>>> present
>>> on Windows. I don't have a Windows machine handy, but I dimly remember
>>> that
>>> you can find manually created config.h for Windows in fixed-h directory
>>> under gnuwin32. It's a hack (and I'm not sure if it helps), though, so
>>> I'd
>>> strongly suggest Tadashi to fix his package to use official API as was
>>> suggested a few times already.
>>>
>>> Cheers,
>>> Simon
>>>
>>>
>>> On Jul 1, 2008, at 9:57 AM, Tobias Verbeke wrote:
>>>
>>>> Dear list,
>>>>
>>>> Tadashi Kadowaki has developed a pdf device package
>>>> that allows to add hyperlinks and popups
>>>> to (currently) text, mtext and rect calls.
>>>>
>>>> The package passes R CMD check (minor warnings) and compiles
>>>> on MacOS X and GNU/Linux, but we do not succeed in building
>>>> the package for Windows.
>>>>
>>>> The current version of the package can be
>>>> checked out as
>>>>
>>>> svn checkout svn://svn.r-forge.r-project.org/svnroot/pdf2/trunk
>>>>
>>>> Please find the 00install.out below.
>>>>
>>>> Could anyone tell why config.h is not found?
>>>>
>>>> My practical experience with the GNU build
>>>> tools is very limited but I would have hoped
>>>> config.h.in would be processed into config.h.
>>>>
>>>> Any pointer or hint will be appreciated.
>>>>
>>>> Many thanks in advance,
>>>> Tobias
>>>>
>>>> P.S. 00install.out (using R 2.7.1 and a current Rtools28.exe):
>>>>
>>>>
>>>>
>>>> installing R.css in C:/DOCUME~1/tverbeke/WORKSP~2/pdf2/TRUNK~1.RCH
>>>>
>>>>
>>>> ---------- Making package trunk ------------
>>>>
>>>> **********************************************
>>>> WARNING: this package has a configure script
>>>>      It probably needs manual configuration
>>>> **********************************************
>>>>
>>>> adding build stamp to DESCRIPTION
>>>> installing NAMESPACE file and metadata
>>>> making DLL ...
>>>> gcc  -std=gnu99  -Ic:/R/R-2.7.0/include   -Iinclude -DHAVE_CONFIG_H  -O3
>>>> -Wall  -c devPS.c -o devPS.o
>>>> devPS.c:26:20: error: config.h: No such file or directory
>>>> In file included from devPS.c:29:
>>>> include/Defn.h:1022: error: expected '=', ',', ';', 'asm' or
>>>> '__attribute__' before 'Rf_onsigusr1'
>>>> include/Defn.h:1023: error: expected '=', ',', ';', 'asm' or
>>>> '__attribute__' before 'Rf_onsigusr2'
>>>> In file included from
>>>>
>>>> c:\rtools\mingw\bin\../lib/gcc/mingw32/4.2.1-sjlj/../../../../include/wchar.h:352,
>>>>              from include/Defn.h:1126,
>>>>              from devPS.c:29:
>>>>
>>>>
>>>> c:\rtools\mingw\bin\../lib/gcc/mingw32/4.2.1-sjlj/../../../../include/stdint.h:66:
>>>> error: conflicting types for 'intptr_t'
>>>> include/Defn.h:204: error: previous declaration of 'intptr_t' was here
>>>>
>>>>
>>>> c:\rtools\mingw\bin\../lib/gcc/mingw32/4.2.1-sjlj/../../../../include/stdint.h:75:
>>>> error: conflicting types for 'uintptr_t'
>>>> include/Defn.h:207: error: previous declaration of 'uintptr_t' was here
>>>> devPS.c: In function 'pathcmp':
>>>> devPS.c:449: error: 'FILESEP' undeclared (first use in this function)
>>>> devPS.c:449: error: (Each undeclared identifier is reported only once
>>>> devPS.c:449: error: for each function it appears in.)
>>>> devPS.c: In function 'LoadEncoding':
>>>> devPS.c:515: error: 'FILESEP' undeclared (first use in this function)
>>>> devPS.c: In function 'PostScriptLoadFontMetrics':
>>>> devPS.c:560: error: 'FILESEP' undeclared (first use in this function)
>>>> devPS.c: In function 'PostScriptMetricInfo':
>>>> devPS.c:862: warning: implicit declaration of function 'Riconv_open'
>>>> devPS.c:862: warning: assignment makes pointer from integer without a
>>>> cast
>>>> devPS.c:872: warning: implicit declaration of function 'Riconv'
>>>> devPS.c:874: warning: implicit declaration of function 'Riconv_close'
>>>> devPS.c: In function 'mbcsToSbcs':
>>>> devPS.c:4020: warning: assignment makes pointer from integer without a
>>>> cast
>>>> devPS.c:4029: error: 'EILSEQ' undeclared (first use in this function)
>>>> devPS.c: In function 'PDF_NewPage':
>>>> devPS.c:6406: warning: unused variable 'i'
>>>> devPS.c: In function 'PDF_StrSize':
>>>> devPS.c:7129: warning: unused variable 'face'
>>>> devPS.c:7128: warning: unused variable 'pd'
>>>> devPS.c: In function 'PDFAnnotBox':
>>>> devPS.c:7469: warning: passing argument 5 of 'Rf_GConvert' from
>>>> incompatible pointer type
>>>> devPS.c:7470: warning: passing argument 5 of 'Rf_GConvert' from
>>>> incompatible pointer type
>>>> make[3]: *** [devPS.o] Error 1
>>>> make[2]: *** [srcDynlib] Error 2
>>>> make[1]: *** [all] Error 2
>>>> make: *** [pkg-trunk] Error 2
>>>> *** Installation of trunk failed ***
>>>>
>>>> Removing 'C:/DOCUME~1/tverbeke/WORKSP~2/pdf2/TRUNK~1.RCH/trunk'
>>>>
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>
>>>>
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>
>>
>>
>> --
>> ?????
>> tadakado at gmail.com
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
>
>


From b.h.mevik at usit.uio.no  Thu Jul  3 10:58:26 2008
From: b.h.mevik at usit.uio.no (=?iso-8859-1?Q?Bj=F8rn-Helge?= Mevik)
Date: Thu, 03 Jul 2008 10:58:26 +0200
Subject: [Rd] --enable-BLAS-shlib conflict with --with-lapack in configure?
Message-ID: <s3s7ic3l4y5.fsf@slagelg.uio.no>

Dear developeRs,

I'm trying to build R (2.7.1, on an x86_64 running Linux, but I believe
I have observed this on x86 and with earlier versions of R as well)
using external BLAS and LAPACK libraries _and_ generating libR.so,
libRblas.so and libRlapack.so.

Without --enable-BLAS-shlib, configure is able to find and use the
external LAPACK library:

./configure \
  --with-blas="-L/site/intel/cmkl/8.1/lib/em64t -lmkl -lvml -lguide -lpthread" \
  --with-lapack="-L/site/intel/cmkl/8.1/lib/em64t -lmkl_lapack64 -lmkl" \
  --enable-R-shlib
[...]
  External libraries:        readline, BLAS(generic), LAPACK(generic)
  Additional capabilities:   PNG, JPEG, iconv, MBCS, NLS
  Options enabled:           shared R library, R profiling, Java

However, if I add --enable-BLAS-shlib, the external LAPACK will not be
used:

./configure \
  --with-blas="-L/site/intel/cmkl/8.1/lib/em64t -lmkl -lvml -lguide -lpthread" \
  --with-lapack="-L/site/intel/cmkl/8.1/lib/em64t -lmkl_lapack64 -lmkl" \
  --enable-R-shlib --enable-BLAS-shlib
[...]
checking for zgeev_ in -L/site/intel/cmkl/8.1/lib/em64t -lmkl_lapack64 -lmkl... no
checking for zgeev_ in -llapack... no
[...]
  External libraries:        readline, BLAS(generic)
  Additional capabilities:   PNG, JPEG, iconv, MBCS, NLS
  Options enabled:           shared R library, shared BLAS, R profiling, Java

>From config.log, it seems configure is trying to link with libRblas when
testing for LAPACK -- but that has not been built yet:

configure:37825: checking for zgeev_
configure:37889: gcc -std=gnu99 -o conftest -g -O2 -fpic  -I/usr/local/include  -L/usr/local/lib64 conftest.c 
-L$(R_HOME)/lib$(R_ARCH) -lRblas  -lg2c -lm -ldl -lm  >&5
/usr/bin/ld: cannot find -lRblas
[...]
configure:37924: checking for zgeev_ in -L/site/intel/cmkl/8.1/lib/em64t -lmkl_lapack64 -lmkl
configure:37962: gcc -std=gnu99 -o conftest -g -O2 -fpic  -I/usr/local/include  -L/usr/local/lib64 conftest.c 
-L/site/intel/cmkl/8.1/lib/em64t -lmkl_lapack64 -lmkl -L$(R_HOME)/lib$(R_ARCH) -lRblas  -lg2c -lm -ldl -lm  >&
5
/usr/bin/ld: cannot find -lRblas
[...]
configure:37993: checking for zgeev_ in -llapack
configure:38036: gcc -std=gnu99 -o conftest -g -O2 -fpic  -I/usr/local/include  -L/usr/local/lib64 conftest.c 
-llapack  -L$(R_HOME)/lib$(R_ARCH) -lRblas  -lg2c -lm -ldl -lm  >&5
/usr/bin/ld: cannot find -lRblas

(Removing the --enable-R-shlib does not make a difference in this
respect.)

Is this intentional or a bug?  Am I doing something wrong here?

-- 
Regards,
Bj?rn-Helge Mevik


From ripley at stats.ox.ac.uk  Thu Jul  3 11:52:35 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 3 Jul 2008 10:52:35 +0100 (BST)
Subject: [Rd] --enable-BLAS-shlib conflict with --with-lapack in
 configure?
In-Reply-To: <s3s7ic3l4y5.fsf@slagelg.uio.no>
References: <s3s7ic3l4y5.fsf@slagelg.uio.no>
Message-ID: <alpine.LFD.1.10.0807031043320.11148@gannet.stats.ox.ac.uk>

This is intentional.  Please note what the R-admin manual says about
--with-lapack, including 'definitely *not* recommended'

If you are concerned about performance you definitely do not want to use 
shared R, not a shared BLAS.

On Thu, 3 Jul 2008, Bj?rn-Helge Mevik wrote:

> Dear developeRs,
>
> I'm trying to build R (2.7.1, on an x86_64 running Linux, but I believe
> I have observed this on x86 and with earlier versions of R as well)
> using external BLAS and LAPACK libraries _and_ generating libR.so,
> libRblas.so and libRlapack.so.
>
> Without --enable-BLAS-shlib, configure is able to find and use the
> external LAPACK library:
>
> ./configure \
>  --with-blas="-L/site/intel/cmkl/8.1/lib/em64t -lmkl -lvml -lguide -lpthread" \
>  --with-lapack="-L/site/intel/cmkl/8.1/lib/em64t -lmkl_lapack64 -lmkl" \
>  --enable-R-shlib
> [...]
>  External libraries:        readline, BLAS(generic), LAPACK(generic)
>  Additional capabilities:   PNG, JPEG, iconv, MBCS, NLS
>  Options enabled:           shared R library, R profiling, Java
>
> However, if I add --enable-BLAS-shlib, the external LAPACK will not be
> used:
>
> ./configure \
>  --with-blas="-L/site/intel/cmkl/8.1/lib/em64t -lmkl -lvml -lguide -lpthread" \
>  --with-lapack="-L/site/intel/cmkl/8.1/lib/em64t -lmkl_lapack64 -lmkl" \
>  --enable-R-shlib --enable-BLAS-shlib
> [...]
> checking for zgeev_ in -L/site/intel/cmkl/8.1/lib/em64t -lmkl_lapack64 -lmkl... no
> checking for zgeev_ in -llapack... no
> [...]
>  External libraries:        readline, BLAS(generic)
>  Additional capabilities:   PNG, JPEG, iconv, MBCS, NLS
>  Options enabled:           shared R library, shared BLAS, R profiling, Java
>
>> From config.log, it seems configure is trying to link with libRblas when
> testing for LAPACK -- but that has not been built yet:
>
> configure:37825: checking for zgeev_
> configure:37889: gcc -std=gnu99 -o conftest -g -O2 -fpic  -I/usr/local/include  -L/usr/local/lib64 conftest.c
> -L$(R_HOME)/lib$(R_ARCH) -lRblas  -lg2c -lm -ldl -lm  >&5
> /usr/bin/ld: cannot find -lRblas
> [...]
> configure:37924: checking for zgeev_ in -L/site/intel/cmkl/8.1/lib/em64t -lmkl_lapack64 -lmkl
> configure:37962: gcc -std=gnu99 -o conftest -g -O2 -fpic  -I/usr/local/include  -L/usr/local/lib64 conftest.c
> -L/site/intel/cmkl/8.1/lib/em64t -lmkl_lapack64 -lmkl -L$(R_HOME)/lib$(R_ARCH) -lRblas  -lg2c -lm -ldl -lm  >&
> 5
> /usr/bin/ld: cannot find -lRblas
> [...]
> configure:37993: checking for zgeev_ in -llapack
> configure:38036: gcc -std=gnu99 -o conftest -g -O2 -fpic  -I/usr/local/include  -L/usr/local/lib64 conftest.c
> -llapack  -L$(R_HOME)/lib$(R_ARCH) -lRblas  -lg2c -lm -ldl -lm  >&5
> /usr/bin/ld: cannot find -lRblas
>
> (Removing the --enable-R-shlib does not make a difference in this
> respect.)
>
> Is this intentional or a bug?  Am I doing something wrong here?
>
> -- 
> Regards,
> Bj?rn-Helge Mevik
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From Richard.Cotton at hsl.gov.uk  Thu Jul  3 12:43:50 2008
From: Richard.Cotton at hsl.gov.uk (Richard Cotton)
Date: Thu, 3 Jul 2008 03:43:50 -0700 (PDT)
Subject: [Rd]  Filename bug in png
Message-ID: <18256526.post@talk.nabble.com>


In R2.7.1, the first line of the body of png() reads:
checkIntFormat(filename)

This should really be: 
if (!checkIntFormat(file)) 
        stop("invalid 'file'")

Otherwise a command such as png("foo%s.png") causes R to crash (see bug
#10571).

-----
Regards,
Richie.

Mathematical Sciences Unit
HSL
-- 
View this message in context: http://www.nabble.com/Filename-bug-in-png-tp18256526p18256526.html
Sent from the R devel mailing list archive at Nabble.com.


From b.h.mevik at usit.uio.no  Thu Jul  3 13:37:04 2008
From: b.h.mevik at usit.uio.no (=?iso-8859-1?Q?Bj=F8rn-Helge?= Mevik)
Date: Thu, 03 Jul 2008 13:37:04 +0200
Subject: [Rd] --enable-BLAS-shlib conflict with --with-lapack in
	configure?
In-Reply-To: <alpine.LFD.1.10.0807031043320.11148@gannet.stats.ox.ac.uk>
	(Brian Ripley's message of "Thu, 3 Jul 2008 10:52:35 +0100 (BST)")
References: <s3s7ic3l4y5.fsf@slagelg.uio.no>
	<alpine.LFD.1.10.0807031043320.11148@gannet.stats.ox.ac.uk>
Message-ID: <s3sod5fjj1b.fsf@slagelg.uio.no>

Prof Brian Ripley <ripley at stats.ox.ac.uk> writes:

> This is intentional.

Ok.

> Please note what the R-admin manual says about
> --with-lapack, including 'definitely *not* recommended'

Oh.  I have always understood that as referring to --with-lapack, not
--with-lapack="-L/something...".

> If you are concerned about performance you definitely do not want to use
> shared R, not a shared BLAS.

I'm sorry, I don't quite follow you here.  Do you mean not create a shared R
and not create a shared BLAS, or was there a "not" too many?

-- 
Bj?rn-Helge Mevik


From ripley at stats.ox.ac.uk  Thu Jul  3 13:50:43 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 3 Jul 2008 12:50:43 +0100 (BST)
Subject: [Rd] --enable-BLAS-shlib conflict with --with-lapack in
 configure?
In-Reply-To: <s3sod5fjj1b.fsf@slagelg.uio.no>
References: <s3s7ic3l4y5.fsf@slagelg.uio.no>
	<alpine.LFD.1.10.0807031043320.11148@gannet.stats.ox.ac.uk>
	<s3sod5fjj1b.fsf@slagelg.uio.no>
Message-ID: <alpine.LFD.1.10.0807031248350.14214@gannet.stats.ox.ac.uk>

On Thu, 3 Jul 2008, Bj?rn-Helge Mevik wrote:

> Prof Brian Ripley <ripley at stats.ox.ac.uk> writes:
>
>> This is intentional.
>
> Ok.
>
>> Please note what the R-admin manual says about
>> --with-lapack, including 'definitely *not* recommended'
>
> Oh.  I have always understood that as referring to --with-lapack, not
> --with-lapack="-L/something...".

It applies to both.

>> If you are concerned about performance you definitely do not want to use
>> shared R, not a shared BLAS.
>
> I'm sorry, I don't quite follow you here.  Do you mean not create a shared R
> and not create a shared BLAS, or was there a "not" too many?

Yes, create neither.  Using shared objects has a noticeable performance 
overhead.

>
> -- 
> Bj?rn-Helge Mevik
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From b.h.mevik at usit.uio.no  Thu Jul  3 13:56:39 2008
From: b.h.mevik at usit.uio.no (=?iso-8859-1?Q?Bj=F8rn-Helge?= Mevik)
Date: Thu, 03 Jul 2008 13:56:39 +0200
Subject: [Rd] --enable-BLAS-shlib conflict with --with-lapack in
	configure?
In-Reply-To: <alpine.LFD.1.10.0807031248350.14214@gannet.stats.ox.ac.uk>
	(Brian Ripley's message of "Thu, 3 Jul 2008 12:50:43 +0100 (BST)")
References: <s3s7ic3l4y5.fsf@slagelg.uio.no>
	<alpine.LFD.1.10.0807031043320.11148@gannet.stats.ox.ac.uk>
	<s3sod5fjj1b.fsf@slagelg.uio.no>
	<alpine.LFD.1.10.0807031248350.14214@gannet.stats.ox.ac.uk>
Message-ID: <s3sk5g3ji4o.fsf@slagelg.uio.no>

Thank you for the advice!

-- 
Bj?rn-Helge Mevik


From P.Dalgaard at biostat.ku.dk  Thu Jul  3 14:08:11 2008
From: P.Dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Thu, 03 Jul 2008 14:08:11 +0200
Subject: [Rd] --enable-BLAS-shlib conflict with --with-lapack
	in	configure?
In-Reply-To: <s3sod5fjj1b.fsf@slagelg.uio.no>
References: <s3s7ic3l4y5.fsf@slagelg.uio.no>	<alpine.LFD.1.10.0807031043320.11148@gannet.stats.ox.ac.uk>
	<s3sod5fjj1b.fsf@slagelg.uio.no>
Message-ID: <486CC12B.9030404@biostat.ku.dk>

Bj?rn-Helge Mevik wrote:
>> If you are concerned about performance you definitely do not want to use
>> shared R, not a shared BLAS.
>>     
>
> I'm sorry, I don't quite follow you here.  Do you mean not create a shared R
> and not create a shared BLAS, or was there a "not" too many?
>   
"Nor", I think. (One of a set of confusing typos. Others include "not"
instead of "now" or "note". Note that I would ever make such silly
mistakes.)

As for the subject matter, you _can_ actually create such at thing as an
optimized, shared BLAS/Lapack, and it is probably faster than an
unoptimized, shared one (well, at least you could create them when I
played with this some years ago). It's just that people think it is a
bit silly, so they are not doing it for you, and as I recall it, you
also need to tinker a bit more than usual with the build process of the
libraries.

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907


From edd at debian.org  Thu Jul  3 14:40:39 2008
From: edd at debian.org (Dirk Eddelbuettel)
Date: Thu, 3 Jul 2008 07:40:39 -0500
Subject: [Rd] --enable-BLAS-shlib conflict with
	--with-lapack	in	configure?
In-Reply-To: <486CC12B.9030404@biostat.ku.dk>
References: <s3s7ic3l4y5.fsf@slagelg.uio.no>
	<alpine.LFD.1.10.0807031043320.11148@gannet.stats.ox.ac.uk>
	<s3sod5fjj1b.fsf@slagelg.uio.no> <486CC12B.9030404@biostat.ku.dk>
Message-ID: <18540.51399.717375.219644@ron.nulle.part>


On 3 July 2008 at 14:08, Peter Dalgaard wrote:
| As for the subject matter, you _can_ actually create such at thing as an
| optimized, shared BLAS/Lapack, and it is probably faster than an
| unoptimized, shared one (well, at least you could create them when I
| played with this some years ago). It's just that people think it is a
| bit silly, so they are not doing it for you, and as I recall it, you

Debian has provided optimised Atlas libraries, compiled as shared libraries,
for over eight years. So not everybody sees this as 'silly'. We set up our R
builds to transparently use them.  That way you'd get tuned linear algebra as
a plug-in -- and the plugin is made possible because of the shared-library
build.

So not everybody agrees with BDR's resolute statement implying static-only
builds if one is concerned about performance.  Performance is almost always
relative, and often relative to several possibly conflicting baselines.

Dirk

-- 
Three out of two people have difficulties with fractions.


From P.Dalgaard at biostat.ku.dk  Thu Jul  3 15:03:57 2008
From: P.Dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Thu, 03 Jul 2008 15:03:57 +0200
Subject: [Rd] Bug repository down Friday
Message-ID: <486CCE3D.1050703@biostat.ku.dk>

There needs to be a physical relocation of servers tomorrow (email and
home directories), so things are likely to be dysfunctional for the day
(hopefully not more).

I'll be out of email reach myself, for the same reason.

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907


From tyler.smith at mail.mcgill.ca  Thu Jul  3 15:13:20 2008
From: tyler.smith at mail.mcgill.ca (tyler)
Date: Thu, 03 Jul 2008 10:13:20 -0300
Subject: [Rd] GetRNGstate and PutRNGstate
Message-ID: <878wwjkt5b.fsf@blackbart.sedgenet>

Hi,

I've got a simulation function, written in C and called from R, that
uses the R random number functions. It's not a very complicated
simulation - 280 lines total, with the main function (the one called
with .C) repeatedly calling another function, with multiple calls to
unif_rand() in both functions. At the beginning of the main function I
call GetRNGstate(), and the last thing I do before returning to R is
PutRNGstate().

On rereading Chapter 5 of the R Extensions manual, I'm not sure I
understand the GetRNGstate/PutRNGstate calls. Should I also include them
in the helper function? Do I need to wrap every call to unif_rand with
these calls, or is it ok that I've just used them at the beginning and
end of the C code? 

I'm getting different results from different simulations, so what I've
done appears ok, but I'm not sure I would be able to detect if every
call to the helper function was returning the same result.

Thanks,

Tyler

--


From ripley at stats.ox.ac.uk  Thu Jul  3 15:24:09 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 3 Jul 2008 14:24:09 +0100 (BST)
Subject: [Rd] GetRNGstate and PutRNGstate
In-Reply-To: <878wwjkt5b.fsf@blackbart.sedgenet>
References: <878wwjkt5b.fsf@blackbart.sedgenet>
Message-ID: <alpine.LFD.1.10.0807031420130.16301@gannet.stats.ox.ac.uk>

On Thu, 3 Jul 2008, tyler wrote:

> Hi,
>
> I've got a simulation function, written in C and called from R, that
> uses the R random number functions. It's not a very complicated
> simulation - 280 lines total, with the main function (the one called
> with .C) repeatedly calling another function, with multiple calls to
> unif_rand() in both functions. At the beginning of the main function I
> call GetRNGstate(), and the last thing I do before returning to R is
> PutRNGstate().
>
> On rereading Chapter 5 of the R Extensions manual, I'm not sure I
> understand the GetRNGstate/PutRNGstate calls. Should I also include them
> in the helper function? Do I need to wrap every call to unif_rand with
> these calls, or is it ok that I've just used them at the beginning and
> end of the C code?

I find the manual very much clearer than your email:

   However, before these are used, the user must call

      GetRNGstate();

   and after all the required variates have been generated, call

      PutRNGstate();

So in so far as I understand your prose, you followed that advice by 
calling *one of* them 'at the beginning and end of the C code'.


> I'm getting different results from different simulations, so what I've
> done appears ok, but I'm not sure I would be able to detect if every
> call to the helper function was returning the same result.
>
> Thanks,
>
> Tyler
>
> --
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ksdori at gmail.com  Thu Jul  3 11:35:03 2008
From: ksdori at gmail.com (ksdori at gmail.com)
Date: Thu,  3 Jul 2008 11:35:03 +0200 (CEST)
Subject: [Rd] Rgui.exe(R.dll) crashes when set the locale to "Korean"
	(PR#11903)
Message-ID: <20080703093503.F022A283461C@mail.pubhealth.ku.dk>

Full_Name: Sang Hyun Koh
Version: 2.7.0, 2.7.1
OS: MS Windows XP, Server 2003
Submission from: (NULL) (202.30.14.68)


Since R 2.7.0 & recent 2.7.1, Rgui.exe crashes on Korean Windows XP and 2003.

After change the locale language to Japanese, Chinese, English, and etc on
control panel, I had no problem in running 2.7.x on Korean Windows.

And I re-install Windows XP, English version, and I could reproduce the bug by
changing locale language to Korean on control panel. of course, no other
language setting made the problem.

So, It must be a problem between Korean language localization on windows and
Rgui.exe.

Please, help to remove the bug.


From maechler at stat.math.ethz.ch  Thu Jul  3 22:08:34 2008
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Thu, 3 Jul 2008 22:08:34 +0200
Subject: [Rd] [.data.frame speedup
In-Reply-To: <e21d304c0807011523y6b47a6ft7dd8edf32d62f7de@mail.gmail.com>
References: <e21d304c0807011120i23d873b9n8a913f54cac7f357@mail.gmail.com>
	<e21d304c0807011523y6b47a6ft7dd8edf32d62f7de@mail.gmail.com>
Message-ID: <18541.12738.106851.758332@cmath-5.math.ethz.ch>

>>>>> "TH" == Tim Hesterberg <timhesterberg at gmail.com>
>>>>>     on Tue, 1 Jul 2008 15:23:53 -0700 writes:

    TH> There is a bug in the standard version of [.data.frame;
    TH> it mixes up handling duplicates and NAs when subscripting rows.

    TH> x <- data.frame(x=1:3, y=2:4, row.names=c("a","b","NA"))
    TH> y <- x[c(2:3, NA),]
    TH> y

    TH> It creates a data frame with duplicate rows, but won't print.

and that's a bug, indeed
("introduced" to R version 2.5.0, when the [.data.frame  code was much
optimized for speed, with quite some care), and I have commited
a fix (and a regression test) to both R-devel and R-patched.

Thanks a lot for the bug report, Tim!

Now about your newly proposed code:
I'm sorry to say that it looks so much different from the source
code in
      https://svn.r-project.org/R/trunk/src/library/base/R/dataframe.R
that I don't think we would accept it as a substitute, easily.

Could you try to provide a minimal patch against the source code
and also a selfcontained example that exhibits the speed gain
you are aiming for ?

Best regards,
Martin Maechler, ETH Zurich

[.........................]


    TH> On Tue, Jul 1, 2008 at 11:20 AM, Tim Hesterberg <timhesterberg at gmail.com>
    TH> wrote:

    >> Below is a version of [.data.frame that is faster
    >> for subscripting rows of large data frames; it avoids calling
    >> duplicated(rows)
    >> if there is no need to check for duplicate row names, when:
    >> i is logical
    >> attr(x, "dup.row.names") is not NULL (S+ compatibility)
    >> i is numeric and negative
    >> i is strictly increasing
    >> 

    TH> [[alternative HTML version deleted]]

    TH> ______________________________________________
    TH> R-devel at r-project.org mailing list
    TH> https://stat.ethz.ch/mailman/listinfo/r-devel


From timhesterberg at gmail.com  Fri Jul  4 02:04:24 2008
From: timhesterberg at gmail.com (Tim Hesterberg)
Date: Thu, 3 Jul 2008 17:04:24 -0700
Subject: [Rd] [.data.frame speedup
In-Reply-To: <18541.12738.106851.758332@cmath-5.math.ethz.ch>
References: <e21d304c0807011120i23d873b9n8a913f54cac7f357@mail.gmail.com>
	<e21d304c0807011523y6b47a6ft7dd8edf32d62f7de@mail.gmail.com>
	<18541.12738.106851.758332@cmath-5.math.ethz.ch>
Message-ID: <e21d304c0807031704h5582728ah8f89ea9a9030fd8f@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20080703/ce054753/attachment.pl>

From bolker at ufl.edu  Fri Jul  4 04:36:09 2008
From: bolker at ufl.edu (Ben Bolker)
Date: Thu, 03 Jul 2008 22:36:09 -0400
Subject: [Rd] update on dnbinom with large "size"
Message-ID: <486D8C99.2050006@ufl.edu>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1


~  turns out I don't need to look at the C code.

~  if one uses the mu/size parameterization of the
negative binomial, R computes size/(size+mu) to
switch parameterizations.  If size>>mu this
gets rounded to 1 ... should be easy enough
to test and return NA under these circumstances?

function (x, size, prob, mu, log = FALSE)
{
~    if (!missing(mu)) {
~        if (!missing(prob))
~            stop("'prob' and 'mu' both specified")
~        prob <- size/(size + mu)
~    }
~    .Internal(dnbinom(x, size, prob, log))
}

~  Ben Bolker


- --------------------------
~  Check it out:

curve(dnbinom(1,mu=0.5,size=x),log="x",from=1,to=1e18)
abline(h=dpois(1,lambda=0.5),col=2,lty=2)
text(1,dpois(1,lambda=0.5)+0.02,"Poisson",col=2,pos=4)

~  I will take a look in the C code when I get
a chance to see if I can offer
a patch, but in the meantime wanted to alert people to
this "feature" ...  (it looks like I will have to go
through dnbinom and dbinom_raw to see where the problem
is ...)

~   Ben Bolker

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org

iD8DBQFIbYyRc5UpGjwzenMRAh57AJ49SUuWs1++D7sacUnFZud2MAROhACfThzD
OmM9WuuFZrk4kO1s9MafLlk=
=wzaH
-----END PGP SIGNATURE-----


From gkerns at ysu.edu  Fri Jul  4 08:02:37 2008
From: gkerns at ysu.edu (G. Jay Kerns)
Date: Fri, 4 Jul 2008 02:02:37 -0400
Subject: [Rd] education task view
Message-ID: <a695148b0807032302v45bcab71s55ca7d6503a27c07@mail.gmail.com>

Dear R-Devel,

I have had it in my mind for some time now that a Task View related to
R and education might be a good thing.

There are currently 19 Task Views, covering a broad spectrum of
general topics for which R may be used.  The homepage lists 64 books
related to R, and several of them have accompanying packages on CRAN.
There is a wiki and a host of contributed documentation. We also have
a SIG-Teaching mailing list.

But the resources for professors seems scattered, and there doesn't
appear to be a fully developed consensus on exactly what types of
educational resources are out there.  Further, CRAN is so large that
it takes a careful and patient eye to get an idea of what is
available.

What might an Education Task View look like?  Right off the top of my
head, there seem to be at least the following four loose categories:


* packages associated with a specific book/text/monograph (many of these...)

* packages specifically designed with education in mind (e.g.
TeachingDemos, LearnBayes, epibasix, tutoR, schoolmath, ...)

* packages perhaps not specifically designed for educ, but
nevertheless are useful in the classroom (actuar, distr family,
financial, hints, urn, ...)

* GUIs: selected GUIs that provide interfaces to common course
topics/demos, or that professors might use to introduce students to R
(Rcmdr, pmg, RWinEdt, rattle, SciViews,...).


With only a _cursory_ glance on CRAN I found 69 packages which, from
their subject line, appeared to fall into one of the above.  You can
see what I am talking about at

http://www.cc.ysu.edu/~gjkerns/educationR.pdf

At 70+, an education task view would fall in the upper 20% with
respect to the number of packages, but it would not be the largest...
nobody can beat "Multivariate". :-)

Yes, there are probably some packages missing from the list.  Yes,
there are additional packages for which an argument could be made that
they are useful for teaching something.  Yes, the above categories are
broad and could be tweeked/reorganized or slimmed down.

My point is this: R is already being used in academia worldwide.
There does not exist (yet) an organized, semi-comprehensive CRAN
package representation of what R has to offer the classroom.  Such a
thing would - in my view - be a useful addition to the R community,
and might make many, many professors' lives easier.  A Task View may
be a step in the right direction.

I am confident that the R leadership knows individuals that are
perfectly suited to spearhead something like this if it were decided
to move forward.  By all means: go for it.

If there is trouble finding volunteers, then you're looking (reading?) at one.

Best,
Jay



--

***************************************************
G. Jay Kerns, Ph.D.
Assistant Professor / Statistics Coordinator
Department of Mathematics & Statistics
Youngstown State University
Youngstown, OH 44555-0002 USA
Office: 1035 Cushwa Hall
Phone: (330) 941-3310 Office (voice mail)
-3302 Department
-3170 FAX
E-mail: gkerns at ysu.edu
http://www.cc.ysu.edu/~gjkerns/


From bolker at zoology.ufl.edu  Fri Jul  4 02:58:04 2008
From: bolker at zoology.ufl.edu (Ben Bolker)
Date: Thu, 03 Jul 2008 20:58:04 -0400
Subject: [Rd] dnbinom unreliable for absurdly large "size" parameter
Message-ID: <486D759C.4050003@zoology.ufl.edu>


   Check it out:

curve(dnbinom(1,mu=0.5,size=x),log="x",from=1,to=1e18)
abline(h=dpois(1,lambda=0.5),col=2,lty=2)
text(1,dpois(1,lambda=0.5)+0.02,"Poisson",col=2,pos=4)

   I will take a look in the C code when I get
a chance to see if I can offer
a patch, but in the meantime wanted to alert people to
this "feature" ...  (it looks like I will have to go
through dnbinom and dbinom_raw to see where the problem
is ...)

    Ben Bolker


-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 252 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20080703/c4819de8/attachment.bin>

From ripley at stats.ox.ac.uk  Fri Jul  4 10:02:21 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 4 Jul 2008 09:02:21 +0100 (BST)
Subject: [Rd] update on dnbinom with large "size"
In-Reply-To: <486D8C99.2050006@ufl.edu>
References: <486D8C99.2050006@ufl.edu>
Message-ID: <alpine.LFD.1.10.0807040851240.21565@gannet.stats.ox.ac.uk>

On Thu, 3 Jul 2008, Ben Bolker wrote:

> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
>
> ~  turns out I don't need to look at the C code.
>
> ~  if one uses the mu/size parameterization of the
> negative binomial, R computes size/(size+mu) to
> switch parameterizations.  If size>>mu this
> gets rounded to 1 ... should be easy enough
> to test and return NA under these circumstances?

It is all vectorized, so not so easy.  But why is NA appropriate, when a 
Poisson approximation seems more appropriate?

The same issue affects [pqr]nbinom, of course.

The short-term advice is of course 'don't do that' but use a suitable 
approximation such as Poisson.  Maybe there are reasons to support values 
of size > 1e10, but I suspect only for completeness and maybe it is better 
to at least give a warning.

>
> function (x, size, prob, mu, log = FALSE)
> {
> ~    if (!missing(mu)) {
> ~        if (!missing(prob))
> ~            stop("'prob' and 'mu' both specified")
> ~        prob <- size/(size + mu)
> ~    }
> ~    .Internal(dnbinom(x, size, prob, log))
> }
>
> ~  Ben Bolker
>
>
> - --------------------------
> ~  Check it out:
>
> curve(dnbinom(1,mu=0.5,size=x),log="x",from=1,to=1e18)
> abline(h=dpois(1,lambda=0.5),col=2,lty=2)
> text(1,dpois(1,lambda=0.5)+0.02,"Poisson",col=2,pos=4)
>
> ~  I will take a look in the C code when I get
> a chance to see if I can offer
> a patch, but in the meantime wanted to alert people to
> this "feature" ...  (it looks like I will have to go
> through dnbinom and dbinom_raw to see where the problem
> is ...)
>
> ~   Ben Bolker
>
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v1.4.6 (GNU/Linux)
> Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org
>
> iD8DBQFIbYyRc5UpGjwzenMRAh57AJ49SUuWs1++D7sacUnFZud2MAROhACfThzD
> OmM9WuuFZrk4kO1s9MafLlk=
> =wzaH
> -----END PGP SIGNATURE-----
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From maechler at stat.math.ethz.ch  Fri Jul  4 11:51:02 2008
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Fri, 4 Jul 2008 11:51:02 +0200
Subject: [Rd] update on dnbinom with large "size"
In-Reply-To: <alpine.LFD.1.10.0807040851240.21565@gannet.stats.ox.ac.uk>
References: <486D8C99.2050006@ufl.edu>
	<alpine.LFD.1.10.0807040851240.21565@gannet.stats.ox.ac.uk>
Message-ID: <18541.62086.316695.451171@stat.math.ethz.ch>

>>>>> "BDR" == Prof Brian Ripley <ripley at stats.ox.ac.uk>
>>>>>     on Fri, 4 Jul 2008 09:02:21 +0100 (BST) writes:

    BDR> On Thu, 3 Jul 2008, Ben Bolker wrote:
    >> -----BEGIN PGP SIGNED MESSAGE----- Hash: SHA1
    >> 
    >> 
    >> ~ turns out I don't need to look at the C code.
    >> 
    >> ~ if one uses the mu/size parameterization of the
    >> negative binomial, R computes size/(size+mu) to switch
    >> parameterizations.  If size>>mu this gets rounded to 1
    >> ... should be easy enough to test and return NA under
    >> these circumstances?

    BDR> It is all vectorized, so not so easy.  But why is NA
    BDR> appropriate, when a Poisson approximation seems more
    BDR> appropriate?

yes, definitely more appropriate.

    BDR> The same issue affects [pqr]nbinom, of course.

indeed.

    BDR> The short-term advice is of course 'don't do that' 
:-)

    BDR> but use a suitable approximation such as Poisson.  Maybe
    BDR> there are reasons to support values of size > 1e10, but
    BDR> I suspect only for completeness and maybe it is better
    BDR> to at least give a warning.

As you know I'm very much in favor of "completeness" here (and
have already spent an unreasonable/unpayable amount of hours to
achieve that in quite a few cases for R in the past).

I'd much prefer a solution without a warning that used the
appropriate approximation when needed.
I'm now between a workshop and a week of vacation, so I am not
promising anything, but I'd plan to get this fixed before the
end of the summer.

    >> - --------------------------
    >> ~ Check it out:
    >> 
    >> curve(dnbinom(1,mu=0.5,size=x),log="x",from=1,to=1e18)
    >> abline(h=dpois(1,lambda=0.5),col=2,lty=2)
    >> text(1,dpois(1,lambda=0.5)+0.02,"Poisson",col=2,pos=4)

a very nice example, thank you, Ben!

Regards, Martin

    >> 
    >> ~ I will take a look in the C code when I get a chance to
    >> see if I can offer a patch, but in the meantime wanted to
    >> alert people to this "feature" ...  (it looks like I will
    >> have to go through dnbinom and dbinom_raw to see where
    >> the problem is ...)
    >> 
    >> ~ Ben Bolker


From ripley at stats.ox.ac.uk  Fri Jul  4 11:56:41 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 4 Jul 2008 10:56:41 +0100 (BST)
Subject: [Rd] update on dnbinom with large "size"
In-Reply-To: <18541.62086.316695.451171@stat.math.ethz.ch>
References: <486D8C99.2050006@ufl.edu>
	<alpine.LFD.1.10.0807040851240.21565@gannet.stats.ox.ac.uk>
	<18541.62086.316695.451171@stat.math.ethz.ch>
Message-ID: <alpine.LFD.1.10.0807041052510.1828@gannet.stats.ox.ac.uk>

On Fri, 4 Jul 2008, Martin Maechler wrote:

>>>>>> "BDR" == Prof Brian Ripley <ripley at stats.ox.ac.uk>
>>>>>>     on Fri, 4 Jul 2008 09:02:21 +0100 (BST) writes:
>
>    BDR> On Thu, 3 Jul 2008, Ben Bolker wrote:
>    >> -----BEGIN PGP SIGNED MESSAGE----- Hash: SHA1
>    >>
>    >>
>    >> ~ turns out I don't need to look at the C code.
>    >>
>    >> ~ if one uses the mu/size parameterization of the
>    >> negative binomial, R computes size/(size+mu) to switch
>    >> parameterizations.  If size>>mu this gets rounded to 1
>    >> ... should be easy enough to test and return NA under
>    >> these circumstances?
>
>    BDR> It is all vectorized, so not so easy.  But why is NA
>    BDR> appropriate, when a Poisson approximation seems more
>    BDR> appropriate?
>
> yes, definitely more appropriate.
>
>    BDR> The same issue affects [pqr]nbinom, of course.
>
> indeed.
>
>    BDR> The short-term advice is of course 'don't do that'
> :-)
>
>    BDR> but use a suitable approximation such as Poisson.  Maybe
>    BDR> there are reasons to support values of size > 1e10, but
>    BDR> I suspect only for completeness and maybe it is better
>    BDR> to at least give a warning.
>
> As you know I'm very much in favor of "completeness" here (and
> have already spent an unreasonable/unpayable amount of hours to
> achieve that in quite a few cases for R in the past).
>
> I'd much prefer a solution without a warning that used the
> appropriate approximation when needed.

The argument for warning is that one possible reason for doing this is to 
explore the difference between negative binomial and Poisson, and so it 
would be helpful to be warned that a Poisson had been used (as we warn in 
some other cases where accuracy is lost, if not entirely consistently).

> I'm now between a workshop and a week of vacation, so I am not
> promising anything, but I'd plan to get this fixed before the
> end of the summer.
>
>    >> - --------------------------
>    >> ~ Check it out:
>    >>
>    >> curve(dnbinom(1,mu=0.5,size=x),log="x",from=1,to=1e18)
>    >> abline(h=dpois(1,lambda=0.5),col=2,lty=2)
>    >> text(1,dpois(1,lambda=0.5)+0.02,"Poisson",col=2,pos=4)
>
> a very nice example, thank you, Ben!
>
> Regards, Martin
>
>    >>
>    >> ~ I will take a look in the C code when I get a chance to
>    >> see if I can offer a patch, but in the meantime wanted to
>    >> alert people to this "feature" ...  (it looks like I will
>    >> have to go through dnbinom and dbinom_raw to see where
>    >> the problem is ...)
>    >>
>    >> ~ Ben Bolker
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From Achim.Zeileis at wu-wien.ac.at  Fri Jul  4 12:59:51 2008
From: Achim.Zeileis at wu-wien.ac.at (Achim Zeileis)
Date: Fri, 4 Jul 2008 12:59:51 +0200 (CEST)
Subject: [Rd] education task view
In-Reply-To: <a695148b0807032302v45bcab71s55ca7d6503a27c07@mail.gmail.com>
References: <a695148b0807032302v45bcab71s55ca7d6503a27c07@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0807041222210.11313@paninaro.stat-math.wu-wien.ac.at>

Jay,

thanks for your suggestion and for the effort you already put into this.

> I have had it in my mind for some time now that a Task View related to
> R and education might be a good thing.

When I read your subject line, I thought: Yes, good idea. But reading 
through your suggestions I realized that it might a bit difficult to 
define what should go in there and what not.

> What might an Education Task View look like?  Right off the top of my
> head, there seem to be at least the following four loose categories:
>
> * packages associated with a specific book/text/monograph (many of these...)

I don't think that this should be among the inclusion criteria because not 
all books are designed for teaching in a narrower sense (and all 
publications are designed for education in a wider sense).

> * packages specifically designed with education in mind (e.g.
> TeachingDemos, LearnBayes, epibasix, tutoR, schoolmath, ...)

This might be feasible.

> * packages perhaps not specifically designed for educ, but
> nevertheless are useful in the classroom (actuar, distr family,
> financial, hints, urn, ...)

It is unclear to me what this could mean. Almost every package might be 
"useful in the classroom" if you're teaching the topic that the package 
addresses.

> * GUIs: selected GUIs that provide interfaces to common course
> topics/demos, or that professors might use to introduce students to R
> (Rcmdr, pmg, RWinEdt, rattle, SciViews,...).

This should also be feasible.

After reading through this, I think that the following might work:
Focus on directly teaching-related packages, especially for teaching basic 
stats, e.g., packages with demos, data, functions, or user interfaces 
(graphical or not) designed specifically for basic/introductory stats 
and/or use of R. "Teaching" might also be somewhat more focused than 
"Education".

> With only a _cursory_ glance on CRAN I found 69 packages which, from
> their subject line, appeared to fall into one of the above.  You can
> see what I am talking about at
>
> http://www.cc.ysu.edu/~gjkerns/educationR.pdf
>
> At 70+, an education task view would fall in the upper 20% with
> respect to the number of packages, but it would not be the largest...
> nobody can beat "Multivariate". :-)

Note that the goal is to have focused task views not to have large task 
views. To be useful, it should be clear to authors and readers what the 
task view is about.

> If there is trouble finding volunteers, then you're looking (reading?) 
> at one.

Great, thanks! Please look at
   vignette("ctv-howto", package = "ctv")
(it's only two pages) and produce a Teaching.ctv. Then send it directly to 
me and I'll have another look and give you some feedback. Then, we can 
move it to CRAN and you can ask for further feedback on the mailing lists. 
If anybody wants to post ideas now, that's of course fine as well.

Best,
Z


From bolker at ufl.edu  Fri Jul  4 14:43:21 2008
From: bolker at ufl.edu (Ben Bolker)
Date: Fri, 04 Jul 2008 08:43:21 -0400
Subject: [Rd] update on dnbinom with large "size"
In-Reply-To: <alpine.LFD.1.10.0807041052510.1828@gannet.stats.ox.ac.uk>
References: <486D8C99.2050006@ufl.edu>
	<alpine.LFD.1.10.0807040851240.21565@gannet.stats.ox.ac.uk>
	<18541.62086.316695.451171@stat.math.ethz.ch>
	<alpine.LFD.1.10.0807041052510.1828@gannet.stats.ox.ac.uk>
Message-ID: <486E1AE9.5020501@ufl.edu>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

~  thanks!
~  Poisson+warning seems very sensible.
~  Looks like things start to get wonky around size=5e14
(this is for mu=1)
but thinking a little harder about the numerical analysis
will probably give a more precise criterion.

curve(dnbinom(1,mu=1,size=x),from=5e14,to=1e16,log="x",ylim=c(0.32,0.37))

~  Ben Bolker


Prof Brian Ripley wrote:
| On Fri, 4 Jul 2008, Martin Maechler wrote:
|
|>>>>>> "BDR" == Prof Brian Ripley <ripley at stats.ox.ac.uk>
|>>>>>>     on Fri, 4 Jul 2008 09:02:21 +0100 (BST) writes:
|>
|>    BDR> On Thu, 3 Jul 2008, Ben Bolker wrote:
|>    >> -----BEGIN PGP SIGNED MESSAGE----- Hash: SHA1
|>    >>
|>    >>
|>    >> ~ turns out I don't need to look at the C code.
|>    >>
|>    >> ~ if one uses the mu/size parameterization of the
|>    >> negative binomial, R computes size/(size+mu) to switch
|>    >> parameterizations.  If size>>mu this gets rounded to 1
|>    >> ... should be easy enough to test and return NA under
|>    >> these circumstances?
|>
|>    BDR> It is all vectorized, so not so easy.  But why is NA
|>    BDR> appropriate, when a Poisson approximation seems more
|>    BDR> appropriate?
|>
|> yes, definitely more appropriate.
|>
|>    BDR> The same issue affects [pqr]nbinom, of course.
|>
|> indeed.
|>
|>    BDR> The short-term advice is of course 'don't do that'
|> :-)
|>
|>    BDR> but use a suitable approximation such as Poisson.  Maybe
|>    BDR> there are reasons to support values of size > 1e10, but
|>    BDR> I suspect only for completeness and maybe it is better
|>    BDR> to at least give a warning.
|>
|> As you know I'm very much in favor of "completeness" here (and
|> have already spent an unreasonable/unpayable amount of hours to
|> achieve that in quite a few cases for R in the past).
|>
|> I'd much prefer a solution without a warning that used the
|> appropriate approximation when needed.
|
| The argument for warning is that one possible reason for doing this is
| to explore the difference between negative binomial and Poisson, and so
| it would be helpful to be warned that a Poisson had been used (as we
| warn in some other cases where accuracy is lost, if not entirely
| consistently).
|
|> I'm now between a workshop and a week of vacation, so I am not
|> promising anything, but I'd plan to get this fixed before the
|> end of the summer.
|>
|>    >> - --------------------------
|>    >> ~ Check it out:
|>    >>
|>    >> curve(dnbinom(1,mu=0.5,size=x),log="x",from=1,to=1e18)
|>    >> abline(h=dpois(1,lambda=0.5),col=2,lty=2)
|>    >> text(1,dpois(1,lambda=0.5)+0.02,"Poisson",col=2,pos=4)
|>
|> a very nice example, thank you, Ben!
|>
|> Regards, Martin
|>
|>    >>
|>    >> ~ I will take a look in the C code when I get a chance to
|>    >> see if I can offer a patch, but in the meantime wanted to
|>    >> alert people to this "feature" ...  (it looks like I will
|>    >> have to go through dnbinom and dbinom_raw to see where
|>    >> the problem is ...)
|>    >>
|>    >> ~ Ben Bolker
|>
|

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org

iD8DBQFIbhrpc5UpGjwzenMRAmCsAJ91HwBzzl29NiJ+LyqpMEr9ROC2DgCeNoMC
n+2CjBTgBn7uPXfr2lo5ydc=
=Kcj0
-----END PGP SIGNATURE-----


From gkerns at ysu.edu  Fri Jul  4 15:16:57 2008
From: gkerns at ysu.edu (G. Jay Kerns)
Date: Fri, 4 Jul 2008 09:16:57 -0400
Subject: [Rd] education task view
In-Reply-To: <Pine.LNX.4.64.0807041222210.11313@paninaro.stat-math.wu-wien.ac.at>
References: <a695148b0807032302v45bcab71s55ca7d6503a27c07@mail.gmail.com>
	<Pine.LNX.4.64.0807041222210.11313@paninaro.stat-math.wu-wien.ac.at>
Message-ID: <a695148b0807040616m3c55f949x821944bf838f1851@mail.gmail.com>

Dear Achim,

On Fri, Jul 4, 2008 at 6:59 AM, Achim Zeileis
<Achim.Zeileis at wu-wien.ac.at> wrote:


>
> When I read your subject line, I thought: Yes, good idea. But reading
> through your suggestions I realized that it might a bit difficult to define
> what should go in there and what not.

Yes, agreed.


>
>> What might an Education Task View look like?  Right off the top of my
>> head, there seem to be at least the following four loose categories:
>>
>> * packages associated with a specific book/text/monograph (many of
>> these...)
>
> I don't think that this should be among the inclusion criteria because not
> all books are designed for teaching in a narrower sense (and all
> publications are designed for education in a wider sense).

Well said!  :-)


>
>> * packages specifically designed with education in mind (e.g.
>> TeachingDemos, LearnBayes, epibasix, tutoR, schoolmath, ...)
>
> This might be feasible.
>
>> * packages perhaps not specifically designed for educ, but
>> nevertheless are useful in the classroom (actuar, distr family,
>> financial, hints, urn, ...)
>
> It is unclear to me what this could mean. Almost every package might be
> "useful in the classroom" if you're teaching the topic that the package
> addresses.

You are right.


>
>> * GUIs: selected GUIs that provide interfaces to common course
>> topics/demos, or that professors might use to introduce students to R
>> (Rcmdr, pmg, RWinEdt, rattle, SciViews,...).
>
> This should also be feasible.
>
> After reading through this, I think that the following might work:
> Focus on directly teaching-related packages, especially for teaching basic
> stats, e.g., packages with demos, data, functions, or user interfaces
> (graphical or not) designed specifically for basic/introductory stats and/or
> use of R. "Teaching" might also be somewhat more focused than "Education".
>
>> With only a _cursory_ glance on CRAN I found 69 packages which, from
>> their subject line, appeared to fall into one of the above.  You can
>> see what I am talking about at
>>
>> http://www.cc.ysu.edu/~gjkerns/educationR.pdf
>>
>> At 70+, an education task view would fall in the upper 20% with
>> respect to the number of packages, but it would not be the largest...
>> nobody can beat "Multivariate". :-)
>
> Note that the goal is to have focused task views not to have large task
> views. To be useful, it should be clear to authors and readers what the task
> view is about.

:-)


>
>> If there is trouble finding volunteers, then you're looking (reading?) at
>> one.
>
> Great, thanks! Please look at
>  vignette("ctv-howto", package = "ctv")
> (it's only two pages) and produce a Teaching.ctv. Then send it directly to
> me and I'll have another look and give you some feedback. Then, we can move
> it to CRAN and you can ask for further feedback on the mailing lists.

10-4

> If anybody wants to post ideas now, that's of course fine as well.


Thanks for your response, Achim.  I like the idea of a more focused -
and well defined - "teaching" task view, and wholeheartedly agree that
it would be and should be clearer to authors and readers what the view
is about.

I'll put something together, and try to incorporate other comments
that might surface.

Regards,
Jay



***************************************************
G. Jay Kerns, Ph.D.
Assistant Professor / Statistics Coordinator
Department of Mathematics & Statistics
Youngstown State University
Youngstown, OH 44555-0002 USA
Office: 1035 Cushwa Hall
Phone: (330) 941-3310 Office (voice mail)
-3302 Department
-3170 FAX
E-mail: gkerns at ysu.edu
http://www.cc.ysu.edu/~gjkerns/


From maechler at stat.math.ethz.ch  Fri Jul  4 15:23:18 2008
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Fri, 4 Jul 2008 15:23:18 +0200
Subject: [Rd] update on dnbinom with large "size"
In-Reply-To: <486E1AE9.5020501@ufl.edu>
References: <486D8C99.2050006@ufl.edu>
	<alpine.LFD.1.10.0807040851240.21565@gannet.stats.ox.ac.uk>
	<18541.62086.316695.451171@stat.math.ethz.ch>
	<alpine.LFD.1.10.0807041052510.1828@gannet.stats.ox.ac.uk>
	<486E1AE9.5020501@ufl.edu>
Message-ID: <18542.9286.983208.785218@stat.math.ethz.ch>

>>>>> "BB" == Ben Bolker <bolker at ufl.edu>
>>>>>     on Fri, 04 Jul 2008 08:43:21 -0400 writes:

    BB> -----BEGIN PGP SIGNED MESSAGE-----
    BB> Hash: SHA1

    BB> ~  thanks!

    BB> ~  Poisson+warning seems very sensible.

better than now, in the extreme cases,
but far from optimal (in those cases where it is only approximate).
I'm currently working on a much better solution, at least for
[dpr]nbinom();  qnbinom() needs a bit more work, and may have to
wait a bit longer.

Martin

    BB> ~  Looks like things start to get wonky around size=5e14
    BB> (this is for mu=1)
    BB> but thinking a little harder about the numerical analysis
    BB> will probably give a more precise criterion.

    BB> curve(dnbinom(1,mu=1,size=x),from=5e14,to=1e16,log="x",ylim=c(0.32,0.37))

    BB> ~  Ben Bolker


    BB> Prof Brian Ripley wrote:
    BB> | On Fri, 4 Jul 2008, Martin Maechler wrote:
    BB> |
    BB> |>>>>>> "BDR" == Prof Brian Ripley <ripley at stats.ox.ac.uk>
    BB> |>>>>>>     on Fri, 4 Jul 2008 09:02:21 +0100 (BST) writes:
    BB> |>
    BB> |>    BDR> On Thu, 3 Jul 2008, Ben Bolker wrote:
    BB> |>    >> -----BEGIN PGP SIGNED MESSAGE----- Hash: SHA1
    BB> |>    >>
    BB> |>    >>
    BB> |>    >> ~ turns out I don't need to look at the C code.
    BB> |>    >>
    BB> |>    >> ~ if one uses the mu/size parameterization of the
    BB> |>    >> negative binomial, R computes size/(size+mu) to switch
    BB> |>    >> parameterizations.  If size>>mu this gets rounded to 1
    BB> |>    >> ... should be easy enough to test and return NA under
    BB> |>    >> these circumstances?
    BB> |>
    BB> |>    BDR> It is all vectorized, so not so easy.  But why is NA
    BB> |>    BDR> appropriate, when a Poisson approximation seems more
    BB> |>    BDR> appropriate?
    BB> |>
    BB> |> yes, definitely more appropriate.
    BB> |>
    BB> |>    BDR> The same issue affects [pqr]nbinom, of course.
    BB> |>
    BB> |> indeed.
    BB> |>
    BB> |>    BDR> The short-term advice is of course 'don't do that'
    BB> |> :-)
    BB> |>
    BB> |>    BDR> but use a suitable approximation such as Poisson.  Maybe
    BB> |>    BDR> there are reasons to support values of size > 1e10, but
    BB> |>    BDR> I suspect only for completeness and maybe it is better
    BB> |>    BDR> to at least give a warning.
    BB> |>
    BB> |> As you know I'm very much in favor of "completeness" here (and
    BB> |> have already spent an unreasonable/unpayable amount of hours to
    BB> |> achieve that in quite a few cases for R in the past).
    BB> |>
    BB> |> I'd much prefer a solution without a warning that used the
    BB> |> appropriate approximation when needed.
    BB> |
    BB> | The argument for warning is that one possible reason for doing this is
    BB> | to explore the difference between negative binomial and Poisson, and so
    BB> | it would be helpful to be warned that a Poisson had been used (as we
    BB> | warn in some other cases where accuracy is lost, if not entirely
    BB> | consistently).
    BB> |
    BB> |> I'm now between a workshop and a week of vacation, so I am not
    BB> |> promising anything, but I'd plan to get this fixed before the
    BB> |> end of the summer.
    BB> |>
    BB> |>    >> - --------------------------
    BB> |>    >> ~ Check it out:
    BB> |>    >>
    BB> |>    >> curve(dnbinom(1,mu=0.5,size=x),log="x",from=1,to=1e18)
    BB> |>    >> abline(h=dpois(1,lambda=0.5),col=2,lty=2)
    BB> |>    >> text(1,dpois(1,lambda=0.5)+0.02,"Poisson",col=2,pos=4)
    BB> |>
    BB> |> a very nice example, thank you, Ben!
    BB> |>
    BB> |> Regards, Martin
    BB> |>
    BB> |>    >>
    BB> |>    >> ~ I will take a look in the C code when I get a chance to
    BB> |>    >> see if I can offer a patch, but in the meantime wanted to
    BB> |>    >> alert people to this "feature" ...  (it looks like I will
    BB> |>    >> have to go through dnbinom and dbinom_raw to see where
    BB> |>    >> the problem is ...)
    BB> |>    >>
    BB> |>    >> ~ Ben Bolker
    BB> |>
    BB> |

    BB> -----BEGIN PGP SIGNATURE-----
    BB> Version: GnuPG v1.4.6 (GNU/Linux)
    BB> Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org

    BB> iD8DBQFIbhrpc5UpGjwzenMRAmCsAJ91HwBzzl29NiJ+LyqpMEr9ROC2DgCeNoMC
    BB> n+2CjBTgBn7uPXfr2lo5ydc=
    BB> =Kcj0
    BB> -----END PGP SIGNATURE-----


From r.ted.byers at gmail.com  Fri Jul  4 16:47:21 2008
From: r.ted.byers at gmail.com (Ted Byers)
Date: Fri, 4 Jul 2008 10:47:21 -0400
Subject: [Rd] education task view
In-Reply-To: <a695148b0807040616m3c55f949x821944bf838f1851@mail.gmail.com>
References: <a695148b0807032302v45bcab71s55ca7d6503a27c07@mail.gmail.com>
	<Pine.LNX.4.64.0807041222210.11313@paninaro.stat-math.wu-wien.ac.at>
	<a695148b0807040616m3c55f949x821944bf838f1851@mail.gmail.com>
Message-ID: <4f1819890807040747r775dbe24h8ff5b20ef3ce0edb@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20080704/5aa5feaa/attachment.pl>

From r.ted.byers at gmail.com  Fri Jul  4 22:24:24 2008
From: r.ted.byers at gmail.com (Ted)
Date: Fri, 4 Jul 2008 20:24:24 +0000 (UTC)
Subject: [Rd] Interface between fractal geometry and statistics
Message-ID: <loom.20080704T202007-483@post.gmane.org>

Are there any packages that help with statistical analysis in situations where 
fractal geometry is relevant?  Perhaps something that supports computation of 
fractal related statistics, such as the Hurst exponent or fractal dimension?  
Or perhaps which support obvious tasks such as taking samples from a dataset 
at different levels of granularity (such as sampling spatial data at cm, m, km 
spatial resolution, or sampling daily time series at weekly, monthly, quaterly 
or annual resolution)?

Thanks

Ted


From luke at stat.uiowa.edu  Sat Jul  5 01:23:09 2008
From: luke at stat.uiowa.edu (Luke Tierney)
Date: Fri, 4 Jul 2008 18:23:09 -0500 (CDT)
Subject: [Rd] experinental revision of the 'snow' package
Message-ID: <alpine.DEB.1.00.0807041822230.11721@luke-inspiron>

A new version of the 'snow' package for parallel computing in R is
available at

      http://www.stat.uiowa.edu/~luke/R/cluster/snow_0.3-3.tar.gz

This substantially revises the way in which worker processes are
started to allow snow to be used on Windows and Mac/Windows/Linux
combinations. I have successfully used the SOCK version on a
standalone Windows machine and combinations of Windows and Linux; the
MPI version also works for me with DeinoMPI and the Rmpi verision for
DeinoMPI.

I would welcome it if some current snow users could try this verison
in their settings to help iron out any major issues I missed before
release to CRAN.

Thanks,

luke

-- 
Luke Tierney
Chair, Statistics and Actuarial Science
Ralph E. Wareham Professor of Mathematical Sciences
University of Iowa                  Phone:             319-335-3386
Department of Statistics and        Fax:               319-335-3017
     Actuarial Science
241 Schaeffer Hall                  email:      luke at stat.uiowa.edu
Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu


From ggrothendieck at gmail.com  Sat Jul  5 02:12:24 2008
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Fri, 4 Jul 2008 20:12:24 -0400
Subject: [Rd] [[ vs. .subset2
Message-ID: <971536df0807041712x34dafd51xc2ad8dcf0ef30b68@mail.gmail.com>

In the code below test2() gives an error message:

   Error in .subset2(x, i, exact = exact) :
     attempt to select less than one element

even though test(), which is nearly the same, gives
the expected result.  BOD is a data set that comes
with R.   Is this a bug?


idx <- 2

# returns expected result
test <- function(pf = parent.frame()) .subset2(BOD, pf$idx)
test()

# gives error message !!!
test2 <- function(pf = parent.frame()) BOD[[pf$idx]]
test2()


I tried this on Windows Vista under:

> R.version.string
[1] "R version 2.7.1 RC (2008-06-16 r45949)"

and

> R.version.string
[1] "R version 2.8.0 Under development (unstable) (2008-06-28 r46012)"


From spencer.graves at pdf.com  Sat Jul  5 02:38:12 2008
From: spencer.graves at pdf.com (Spencer Graves)
Date: Fri, 04 Jul 2008 17:38:12 -0700
Subject: [Rd] Interface between fractal geometry and statistics
In-Reply-To: <loom.20080704T202007-483@post.gmane.org>
References: <loom.20080704T202007-483@post.gmane.org>
Message-ID: <486EC274.2060608@pdf.com>

      RSiteSearch('fractal', 'fun') returned 68 hits for me just now.  
Might any of those be helpful? 

      Spencer

Ted wrote:
> Are there any packages that help with statistical analysis in situations where 
> fractal geometry is relevant?  Perhaps something that supports computation of 
> fractal related statistics, such as the Hurst exponent or fractal dimension?  
> Or perhaps which support obvious tasks such as taking samples from a dataset 
> at different levels of granularity (such as sampling spatial data at cm, m, km 
> spatial resolution, or sampling daily time series at weekly, monthly, quaterly 
> or annual resolution)?
>
> Thanks
>
> Ted
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From spencer.graves at pdf.com  Sat Jul  5 02:42:35 2008
From: spencer.graves at pdf.com (Spencer Graves)
Date: Fri, 04 Jul 2008 17:42:35 -0700
Subject: [Rd] [[ vs. .subset2
In-Reply-To: <971536df0807041712x34dafd51xc2ad8dcf0ef30b68@mail.gmail.com>
References: <971536df0807041712x34dafd51xc2ad8dcf0ef30b68@mail.gmail.com>
Message-ID: <486EC37B.9020204@pdf.com>

Dear Gabor: 

      Does the following answer your question: 

 > tst <- list(a=1, b=2)
 > tst[numeric(0)]
list()
 > tst[[numeric(0)]]
Error in tst[[numeric(0)]] : attempt to select less than one element

      Spencer

Gabor Grothendieck wrote:
> In the code below test2() gives an error message:
>
>    Error in .subset2(x, i, exact = exact) :
>      attempt to select less than one element
>
> even though test(), which is nearly the same, gives
> the expected result.  BOD is a data set that comes
> with R.   Is this a bug?
>
>
> idx <- 2
>
> # returns expected result
> test <- function(pf = parent.frame()) .subset2(BOD, pf$idx)
> test()
>
> # gives error message !!!
> test2 <- function(pf = parent.frame()) BOD[[pf$idx]]
> test2()
>
>
> I tried this on Windows Vista under:
>
>   
>> R.version.string
>>     
> [1] "R version 2.7.1 RC (2008-06-16 r45949)"
>
> and
>
>   
>> R.version.string
>>     
> [1] "R version 2.8.0 Under development (unstable) (2008-06-28 r46012)"
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From ggrothendieck at gmail.com  Sat Jul  5 03:13:21 2008
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Fri, 4 Jul 2008 21:13:21 -0400
Subject: [Rd] [[ vs. .subset2
In-Reply-To: <486EC37B.9020204@pdf.com>
References: <971536df0807041712x34dafd51xc2ad8dcf0ef30b68@mail.gmail.com>
	<486EC37B.9020204@pdf.com>
Message-ID: <971536df0807041813m63e712d7q14e5e28979d0cc16@mail.gmail.com>

Not really.  The point of this is that promises seem to be
screwing up in conjunction with [[ but in light of the fact
that .subset2 works it suggests that there might be a better
implementation of [[.

Also some insight into what is really driving this problem
so one can more easily recognize it in other places would
be helpful.

This a simplification of an actual problem I had in
a large program and it took some time to track this
one down.  Also, I am not entirely happy with the
workarounds which are to use .subset2, as shown,
or force(pf) since it seems more natural to me that
it should just work out of the box.

On Fri, Jul 4, 2008 at 8:42 PM, Spencer Graves <spencer.graves at pdf.com> wrote:
> Dear Gabor:
>     Does the following answer your question:
>> tst <- list(a=1, b=2)
>> tst[numeric(0)]
> list()
>> tst[[numeric(0)]]
> Error in tst[[numeric(0)]] : attempt to select less than one element
>
>     Spencer
>
> Gabor Grothendieck wrote:
>>
>> In the code below test2() gives an error message:
>>
>>   Error in .subset2(x, i, exact = exact) :
>>     attempt to select less than one element
>>
>> even though test(), which is nearly the same, gives
>> the expected result.  BOD is a data set that comes
>> with R.   Is this a bug?
>>
>>
>> idx <- 2
>>
>> # returns expected result
>> test <- function(pf = parent.frame()) .subset2(BOD, pf$idx)
>> test()
>>
>> # gives error message !!!
>> test2 <- function(pf = parent.frame()) BOD[[pf$idx]]
>> test2()
>>
>>
>> I tried this on Windows Vista under:
>>
>>
>>>
>>> R.version.string
>>>
>>
>> [1] "R version 2.7.1 RC (2008-06-16 r45949)"
>>
>> and
>>
>>
>>>
>>> R.version.string
>>>
>>
>> [1] "R version 2.8.0 Under development (unstable) (2008-06-28 r46012)"
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>


From antonio.fabio at gmail.com  Sat Jul  5 10:06:52 2008
From: antonio.fabio at gmail.com (Antonio, Fabio Di Narzo)
Date: Sat, 5 Jul 2008 10:06:52 +0200
Subject: [Rd] Interface between fractal geometry and statistics
In-Reply-To: <loom.20080704T202007-483@post.gmane.org>
References: <loom.20080704T202007-483@post.gmane.org>
Message-ID: <b0808fdc0807050106g1dad3b3dt33c731e33e262b94@mail.gmail.com>

2008/7/4 Ted <r.ted.byers at gmail.com>:
> Are there any packages that help with statistical analysis in situations where
> fractal geometry is relevant?  Perhaps something that supports computation of
> fractal related statistics, such as the Hurst exponent or fractal dimension?
tseriesChaos has functions for estimating correlation dimension on an
observed (long) time series.

> Or perhaps which support obvious tasks such as taking samples from a dataset
> at different levels of granularity (such as sampling spatial data at cm, m, km
> spatial resolution, or sampling daily time series at weekly, monthly, quaterly
> or annual resolution)?
For time series, look for 'aggregate'.

f.

>
> Thanks
>
> Ted
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>



-- 
Antonio, Fabio Di Narzo
Ph.D. student at
Department of Statistical Sciences
University of Bologna, Italy


From p.dalgaard at biostat.ku.dk  Sat Jul  5 14:04:33 2008
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Sat, 05 Jul 2008 14:04:33 +0200
Subject: [Rd] [[ vs. .subset2
In-Reply-To: <971536df0807041813m63e712d7q14e5e28979d0cc16@mail.gmail.com>
References: <971536df0807041712x34dafd51xc2ad8dcf0ef30b68@mail.gmail.com>	<486EC37B.9020204@pdf.com>
	<971536df0807041813m63e712d7q14e5e28979d0cc16@mail.gmail.com>
Message-ID: <486F6351.8070601@biostat.ku.dk>

Gabor Grothendieck wrote:
> Not really.  The point of this is that promises seem to be
> screwing up in conjunction with [[ but in light of the fact
> that .subset2 works it suggests that there might be a better
> implementation of [[
Not really; .subset2() is a shortcut that bypasses method dispatch, so 
not a drop-in replacement for "[[". You also have

 > test3 <- function(pf = parent.frame()) "[[.data.frame"(BOD, pf$idx)
 > test3()
[1]  8.3 10.3 19.0 16.0 15.6 19.8


Something appears not quite right, but an easy workaround is to force 
the promise:

 > test4 <- function(pf = parent.frame()) {pf;BOD[[pf$idx]]}
 > test4()
[1]  8.3 10.3 19.0 16.0 15.6 19.8



-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907


From mathieu.ribatet at epfl.ch  Sat Jul  5 19:55:09 2008
From: mathieu.ribatet at epfl.ch (Mathieu Ribatet)
Date: Sat, 05 Jul 2008 19:55:09 +0200
Subject: [Rd] Editing the "..." argument
Message-ID: <486FB57D.6010801@epfl.ch>

    Dear all,

I'd like tweaking the ... arguments that one user can pass in my 
function for fitting a model. More precisely, my objective function is 
(really) problematic to optimize using the "optim" function. 
Consequently, I'd like to add in the "control" argument of the latter 
function a "ndeps = rep(something, #par)" and/or "parscale = something" 
if the user has not specified it already.

Do you know a way to deal with this point?
In advance, thanks.

Mathieu

-- 
Institute of Mathematics
Ecole Polytechnique F?d?rale de Lausanne
STAT-IMA-FSB-EPFL, Station 8
CH-1015 Lausanne   Switzerland
http://stat.epfl.ch/
Tel: + 41 (0)21 693 7907


From murdoch at stats.uwo.ca  Sat Jul  5 21:05:21 2008
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Sat, 05 Jul 2008 15:05:21 -0400
Subject: [Rd] Editing the "..." argument
In-Reply-To: <486FB57D.6010801@epfl.ch>
References: <486FB57D.6010801@epfl.ch>
Message-ID: <486FC5F1.2020601@stats.uwo.ca>

On 05/07/2008 1:55 PM, Mathieu Ribatet wrote:
>     Dear all,
> 
> I'd like tweaking the ... arguments that one user can pass in my 
> function for fitting a model. More precisely, my objective function is 
> (really) problematic to optimize using the "optim" function. 
> Consequently, I'd like to add in the "control" argument of the latter 
> function a "ndeps = rep(something, #par)" and/or "parscale = something" 
> if the user has not specified it already.
> 
> Do you know a way to deal with this point?
> In advance, thanks.

It's generally not necessary to edit the ... args, but one way to do it 
is like this:

   dots <- list(...)
   # do some editing
   # instead of optim(a, b, ...), now you do
   do.call(optim, c(list(a, b), dots))

In the particular example you gave, I wouldn't do this; I'd give control 
as an arg to your function, and just edit that.  For example,

myoptim <- function(control = list(), ...) {
   if (is.null(control$ndeps)) control$ndeps <- rep(something, par)
   if (is.null(control$parscale)) control$parscale <- something
   optim(control=control, ...)
}

Duncan Murdoch


From maechler at stat.math.ethz.ch  Sat Jul  5 21:16:09 2008
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Sat, 5 Jul 2008 21:16:09 +0200
Subject: [Rd] [.data.frame speedup
In-Reply-To: <e21d304c0807031704h5582728ah8f89ea9a9030fd8f@mail.gmail.com>
References: <e21d304c0807011120i23d873b9n8a913f54cac7f357@mail.gmail.com>
	<e21d304c0807011523y6b47a6ft7dd8edf32d62f7de@mail.gmail.com>
	<18541.12738.106851.758332@cmath-5.math.ethz.ch>
	<e21d304c0807031704h5582728ah8f89ea9a9030fd8f@mail.gmail.com>
Message-ID: <18543.51321.168721.101539@cmath-5.math.ethz.ch>

>>>>> "TH" == Tim Hesterberg <timhesterberg at gmail.com>
>>>>>     on Thu, 3 Jul 2008 17:04:24 -0700 writes:

    TH> I made a couple of a changes from the previous version:
    TH> - don't use functions anyMissing or notSorted (which aren't in base R)
    TH> - don't check for dup.row.names attribute (need to modify other functions
    TH> before that is useful)
    TH> I have not tested this with a wide variety of inputs; I'm assuming that
    TH> you have some regression tests.

yes, we do (and they are part of the R source).

    TH> Here are the file differences.  Let me know if you'd like a different
    TH> format.


    TH> $ diff -c dataframe.R dataframe2.R
    TH> *** dataframe.R    Thu Jul  3 15:48:12 2008
    TH> --- dataframe2.R    Thu Jul  3 16:36:46 2008
    ...................

context diff is fine (I typically use '-u' but that's not important).

>From your patch,
I've currently ended in this "patch" :

--- dataframe.R.~19~	2008-07-03 02:13:21.000163000 +0200
+++ dataframe.R	2008-07-05 13:02:33.000029000 +0200
@@ -579,14 +579,18 @@
         ## row names might have NAs.
         if(is.null(rows)) rows <- attr(xx, "row.names")
         rows <- rows[i]
-	if((ina <- any(is.na(rows))) | (dup <- any(duplicated(rows)))) {
-	    ## both will coerce integer 'rows' to character:
-	    if (!dup && is.character(rows)) dup <- "NA" %in% rows
-	    if(ina)
-		rows[is.na(rows)] <- "NA"
-	    if(dup)
-		rows <- make.unique(as.character(rows))
-	}
+
+	## Do not want to check for duplicates if don't need to
+	noDuplicateRowNames <-
+	    (is.logical(i) || (li <- length(i)) < 2 ||
+	     (is.numeric(i) && (min(0, i, na.rm=TRUE) < 0 ||
+			       (!any(is.na(i)) && all(i[-li] < i[-1L])))))
+	## TODO: is.unsorted(., strict=FALSE/TRUE)
+	if(any(is.na(rows)))
+	    rows[is.na(rows)] <- "NA" # coerces to integer
+	if(!noDuplicateRowNames && any(duplicated(rows)))
+	    rows <- make.unique(as.character(rows)) # coerces to integer
+
         ## new in 1.8.0  -- might have duplicate columns
         if(any(duplicated(nm <- names(x)))) names(x) <- make.unique(nm)
         if(is.null(rows)) rows <- attr(xx, "row.names")[i]


    TH> Here's some code for testing, and timings

    .................

I've rationalized (wrote functions) and slightly extended your
tests, they are now public at
   ftp://ftp.stat.math.ethz.ch/U/maechler/R/data.frame-TH-ex.R

Unfortunately, they show that "the speedup" is negative in some
cases, e.g. for the 'i <- 1:n' case for n <- 1000 or 10000.
I've replicated every system.time() 12 times, to get a sense of
the precision, and that's still the conclusion.

In other words, your proposed  'noDuplicateRowNames'
computations are sometimes more expensive than the duplicated(.)
call they replace.

To me, that means that the whole exercise was probbaly in vain:
We are not making the code more complicated if it's not a
uniform improvement.  Too bad.....

Martin Maechler, ETH Zurich


From spencer.graves at pdf.com  Sun Jul  6 18:47:37 2008
From: spencer.graves at pdf.com (Spencer Graves)
Date: Sun, 06 Jul 2008 09:47:37 -0700
Subject: [Rd] Comparing dimensions in arrays?
Message-ID: <4870F729.9070303@pdf.com>

      What functions exist to compare dimensions of arrays, other than 
the obvious checks of 'dim' and 'dimnames'? 

      I ask, because I'm about to write something like this for the 
'fda' package, and I'd prefer to use something that is already available. 

      Specifically, I'm thinking of the following: 

           checkDim(x, y, xdim=1, ydim=1, defaultNames, subset=c('xiny', 
'yinx', 'either', 'neither'), ndimsMismatch = c('xiny', 'yinx', 
'either', 'neither') )

      This would return list(xout, yout) where dimension 'xdim' of 
'xout' would match dimension 'ydim' of 'yout', and both would have 
identical dimnames.  If defaultNames = FALSE, it would throw an error if 
the  corresponding dimnames of 'x' and 'y' did not match. 

      Comments?
      Thanks,
      Spencer Graves


From jh910 at juno.com  Sun Jul  6 20:59:03 2008
From: jh910 at juno.com (J. R. M. Hosking)
Date: Sun, 06 Jul 2008 14:59:03 -0400
Subject: [Rd] Editing the "..." argument
In-Reply-To: <486FB57D.6010801@epfl.ch>
References: <486FB57D.6010801@epfl.ch>
Message-ID: <g4r4lm$10a$1@ger.gmane.org>

Mathieu Ribatet wrote:
>    Dear all,
> 
> I'd like tweaking the ... arguments that one user can pass in my 
> function for fitting a model. More precisely, my objective function is 
> (really) problematic to optimize using the "optim" function. 
> Consequently, I'd like to add in the "control" argument of the latter 
> function a "ndeps = rep(something, #par)" and/or "parscale = something" 
> if the user has not specified it already.
> 
> Do you know a way to deal with this point?
> In advance, thanks.
> 
> Mathieu

Package lmom, recently added to CRAN, contains a function 'pelp' that
does exactly what you describe.  Relevant parts of its code:

   # Get the user-supplied arguments for the optimization functions
   dotargs <- list(...)

   # If user didn't supply a "control" argument, create one
   if (is.null(dotargs$control)) dotargs<-c(dotargs,list(control=list()))

   # If user didn't provide "ndeps" or "abstol" elements of the "control"
   # argument, set them to our own defaults
   if (is.null(dotargs$control$ndeps))
     dotargs$control <- c(dotargs$control,list(ndeps=rep(acc,nshape)))
   if (method!="L-BFGS-B" && is.null(dotargs$control$abstol))
     dotargs$control <- c(dotargs$control,abstol=acc^2)

   # Call the optimization function, optim()
   opt <- do.call(optim,c(list(par=start[shape.pos]),fn=critfn,
     method=method,dotargs))


J. R. M. Hosking


From enrique.bengoechea at credit-suisse.com  Mon Jul  7 12:39:05 2008
From: enrique.bengoechea at credit-suisse.com (=?iso-8859-1?Q?Bengoechea_Bartolom=E9_Enrique_=28SIES_73=29?=)
Date: Mon, 7 Jul 2008 12:39:05 +0200
Subject: [Rd] Editing the "..." argument
Message-ID: <19811401A1D8174CB3EAD7F6072E9B50016A2670@chsa1025.share.beluni.net>

The 'modifyList' function on package Utils allows to do that in a very compact way:

do.call("optim", modifyList(list(<your default values>), list(...)))

Regards,

Enrique

Mathieu Ribatet wrote:
> Dear all,
> 
> I'd like tweaking the ... arguments that one user can pass in my 
> function for fitting a model. More precisely, my objective function is
> (really) problematic to optimize using the "optim" function. 
> Consequently, I'd like to add in the "control" argument of the latter 
> function a "ndeps = rep(something, #par)" and/or "parscale = something"
> if the user has not specified it already.
> 
> Do you know a way to deal with this point?
> In advance, thanks.
> 
> Mathieu


From schmidb at ibe.med.uni-muenchen.de  Mon Jul  7 13:30:00 2008
From: schmidb at ibe.med.uni-muenchen.de (Markus Schmidberger)
Date: Mon, 07 Jul 2008 13:30:00 +0200
Subject: [Rd] experinental revision of the 'snow' package
In-Reply-To: <alpine.DEB.1.00.0807041822230.11721@luke-inspiron>
References: <alpine.DEB.1.00.0807041822230.11721@luke-inspiron>
Message-ID: <4871FE38.6060509@ibe.med.uni-muenchen.de>

Hello Luke,

I did several test with our affyPara Testcode. Everything was working 
very well. I think you improved error-handling?
It would be great to have a kind of change log in the package. To know 
the latest changes.

Our system:
Linux, Suse, max. 120 nodes, LAM/MPI: 7.1.3

R version 2.7.1 (2008-06-23)
x86_64-unknown-linux-gnu

locale:
LC_CTYPE=de_DE.UTF-8;LC_NUMERIC=C;LC_TIME=de_DE.UTF-8;LC_COLLATE=de_DE.UTF-8;LC_MONETARY=C;LC_MESSAGES=de_DE.UTF-8;LC_PAPER=de_DE.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=de_DE.UTF-8;LC_IDENTIFICATION=C

attached base packages:
[1] tools     stats     graphics  grDevices utils     datasets  methods 
[8] base    

other attached packages:
[1] hgu95acdf_2.2.0      Rmpi_0.5-6           affyPara_1.1.5     
[4] snow_0.3-3           affy_1.18.2          preprocessCore_1.2.0
[7] affyio_1.8.0         Biobase_2.0.1 


Best regards form Munich
Markus



Luke Tierney schrieb:
> A new version of the 'snow' package for parallel computing in R is
> available at
>
>      http://www.stat.uiowa.edu/~luke/R/cluster/snow_0.3-3.tar.gz
>
> This substantially revises the way in which worker processes are
> started to allow snow to be used on Windows and Mac/Windows/Linux
> combinations. I have successfully used the SOCK version on a
> standalone Windows machine and combinations of Windows and Linux; the
> MPI version also works for me with DeinoMPI and the Rmpi verision for
> DeinoMPI.
>
> I would welcome it if some current snow users could try this verison
> in their settings to help iron out any major issues I missed before
> release to CRAN.
>
> Thanks,
>
> luke
>


-- 
Dipl.-Tech. Math. Markus Schmidberger

Ludwig-Maximilians-Universit?t M?nchen
IBE - Institut f?r medizinische Informationsverarbeitung,
Biometrie und Epidemiologie
Marchioninistr. 15, D-81377 Muenchen
URL: http://ibe.web.med.uni-muenchen.de 
Mail: Markus.Schmidberger [at] ibe.med.uni-muenchen.de
Tel: +49 (089) 7095 - 4599


From Robert.McGehee at geodecapital.com  Tue Jul  8 23:39:53 2008
From: Robert.McGehee at geodecapital.com (McGehee, Robert)
Date: Tue, 8 Jul 2008 17:39:53 -0400
Subject: [Rd] split.Date
Message-ID: <EEBC169715EB8C438D3C9283AF0F201C023E478A@MSGBOSCLM2WIN.DMN1.FMR.COM>

Hello,
I wanted to suggest that the below method for split.Date be added to the
base library to significantly speed up splits with values of class Date.
In the below example I show a speed improvement of 175x for 1000 data
points. On a vector of size 1e6, the time difference was 22 minutes for
split.default versus 0.3 seconds for the split.Date function below (!).
Note that this improvement will also substantially improve performance
for the tapply function on class Date as well.

Thanks,
Robert

split.Date <- function(x, f, drop=FALSE) {
    x <- split.default(as.integer(x), f, drop=drop)
    for (i in seq(along=x)) class(x[[i]]) <- "Date"
    x
}

> vals <- round(1000*rnorm(1e4))
> date <- rep(Sys.Date() + -1:1, length.out=1e4)
> system.time(x1 <- split.default(date, vals))
   user  system elapsed 
  7.718   0.042   7.761 
> system.time(x2 <- split.Date(date, vals))
   user  system elapsed 
  0.044   0.000   0.044 
> all.equal(x1, x2)
[1] TRUE

Robert McGehee, CFA
Geode Capital Management, LLC
One Post Office Square, 28th Floor | Boston, MA | 02109
Tel: 617/392-8396    Fax:617/476-6389
mailto:robert.mcgehee at geodecapital.com



This e-mail, and any attachments hereto, are intended fo...{{dropped:12}}


From kurt.van.dijck at skynet.be  Wed Jul  9 10:05:39 2008
From: kurt.van.dijck at skynet.be (Kurt Van Dijck)
Date: Wed, 09 Jul 2008 10:05:39 +0200
Subject: [Rd]  spss long labels
In-Reply-To: <486B35A8.5000700@skynet.be>
References: <486B35A8.5000700@skynet.be>
Message-ID: <48747153.7080803@skynet.be>

Hi all,

I got no feedback at all concerning the merge of this patch in the source tree.
Am I supposed to do this myself? How should I do this (do I have subversion commit
access)? Is this patch acceptable at all? Is it being tested?

I got some personal reactions on my post, proving there is general interest in
getting rid of the inconvenience of importing long labels from SPSS files.



Kurt Van Dijck wrote:
> Hi,
> 
> A frequently seen issue with importing SPSS data files, is that R does
> not import the 'long variable names'.
> I built a patch on the R-project's foreign module, in order to import
> the 'long variable names' from SPSS (record 7, subtype 13).
> To complete the job, I had to expand the "struct variable" definition
> to have 64 +1 charachters. I'm not aware of side effects.
> The sfm-read.c code works fine.
> I didn't test a variety of platforms, as I don't have an idea of what is
> regarded as sufficient testing. Anyway, I don't expect major troubles there
> (no byteswapping problems, no 32<->64 bit issues) as it's mainly 
> character processing.
> The patch is relative to the foreign directory. It was created
> against the trunk of R-project yesterday.
> 
> We would appreciate that you import such patch into the main tree.
> 
> Kind regards,
> 
> Kurt Van Dijck (C programmer) & Ilse Laurijssen (R user)
> Belgium
> 
> Index: src/sfm-read.c
> ===================================================================
> --- src/sfm-read.c    (revision 5168)
> +++ src/sfm-read.c    (working copy)
> @@ -188,6 +188,8 @@
>  static int read_variables (struct file_handle * h, struct variable *** 
> var_by_index);
>  static int read_machine_int32_info (struct file_handle * h, int size, 
> int count, int *encoding);
>  static int read_machine_flt64_info (struct file_handle * h, int size, 
> int count);
> +static int read_long_var_names (struct file_handle * h, struct 
> dictionary *
> +        , unsigned long size, unsigned int count);
>  static int read_documents (struct file_handle * h);
> 
>  /* Displays the message X with corrupt_msg, then jumps to the lossage
> @@ -418,11 +420,15 @@
>          break;
> 
>            case 7: /* Multiple-response sets (later versions of SPSS). */
> -          case 13:  /* long variable names. PSPP now has code for these
> -               that could be ported if someone is interested. */
>          skip = 1;
>          break;
> 
> +          case 13:    /* long variable names. PSPP now has code for these
> +               that could be ported if someone is interested. */
> +        if (!read_long_var_names(h, ext->dict, data.size, data.count))
> +          goto lossage;
> +        break;
> +
>            case 16: /* See 
> http://www.nabble.com/problem-loading-SPSS-15.0-save-files-t2726500.html */
>          skip = 1;
>          break;
> @@ -584,14 +590,72 @@
>    return 0;
>  }
> 
> +/* Read record type 7, subtype 13.
> + * long variable names
> + */
>  static int
> +read_long_var_names (struct file_handle * h, struct dictionary * dict
> +        , unsigned long size, unsigned int count)
> +{
> +  char * data;
> +  unsigned int j;
> +  struct variable ** lp;
> +  struct variable ** end;
> +  char * p;
> +  char * endp;
> +  char * val;
> +  if ((1 != size)||(0 == count)) {
> +    warning("%s: strange record info seen, size=%u, count=%u"
> +      ", ignoring long variable names"
> +      , h->fn, size, count);
> +    return 0;
> +  }
> +  size *= count;
> +  data = Calloc (size +1, char);
> +  bufread(h, data, size, 0);
> +  /* parse */
> +  end = &dict->var[dict->nvar];
> +  p = data;
> +  do {
> +    if (0 != (endp = strchr(p, '\t')))
> +      *endp = 0; /* put null terminator */
> +    if (0 == (val = strchr(p, '='))) {
> +      warning("%s: no long variable name for variable '%s'", h->fn, p);
> +    } else {
> +      *val = 0;
> +      ++val;
> +      /* now, p is key, val is long name */
> +      for (lp = dict->var; lp < end; ++lp) {
> +        if (!strcmp(lp[0]->name, p)) {
> +          strncpy(lp[0]->name, val, sizeof(lp[0]->name));
> +          break;
> +        }
> +      }
> +      if (lp >= end) {
> +        warning("%s: long variable name mapping '%s' to '%s'"
> +        "for variable which does not exist"
> +        , h->fn, p, val);
> +      }
> +    }
> +    p = &endp[1]; /* put to next */
> +  } while (endp);
> +
> +  free(data);
> +  return 1;
> +
> +lossage:
> +  free(data);
> +  return 0;
> +}
> +
> +static int
>  read_header (struct file_handle * h, struct sfm_read_info * inf)
>  {
>    struct sfm_fhuser_ext *ext = h->ext;    /* File extension strcut. */
>    struct sysfile_header hdr;        /* Disk buffer. */
>    struct dictionary *dict;        /* File dictionary. */
>    char prod_name[sizeof hdr.prod_name + 1];    /* Buffer for product 
> name. */
> -  int skip_amt = 0;                /* Amount of product name to omit. */
> +  int skip_amt = 0;            /* Amount of product name to omit. */
>    int i;
> 
>    /* Create the dictionary. */
> @@ -1495,7 +1559,7 @@
>  /* Reads one case from system file H into the value array PERM
>     according to the instructions given in associated dictionary DICT,
>     which must have the get.* elements appropriately set.  Returns
> -   nonzero only if successful.  */
> +   nonzero only if successful.    */
>  int
>  sfm_read_case (struct file_handle * h, union value * perm, struct 
> dictionary * dict)
>  {
> Index: src/var.h.in
> ===================================================================
> --- src/var.h.in    (revision 5168)
> +++ src/var.h.in    (working copy)
> @@ -41,6 +41,10 @@
>  #error MAX_SHORT_STRING must be less than 8.
>  #endif
> 
> +/* VAR_NAME_LEN: the length of a variable.
> + * SPSS supports names of 64 long
> + */
> +#define VAR_NAME_LEN 64
>  /* Special values. */
>  #define SYSMIS (-DBL_MAX)
>  #define LOWEST second_lowest_double_val()
> @@ -228,7 +232,7 @@
>  /* MODIFY VARS private data. */
>  struct modify_vars_proc
>    {
> -    char new_name[9];        /* Variable's new name. */
> +    char new_name[VAR_NAME_LEN +1];        /* Variable's new name. */
>      int drop_this_var;        /* 0=keep this var, 1=drop this var. */
>      struct variable *next;    /* Next in linked list. */
>    };
> @@ -302,7 +306,7 @@
>  struct variable
>    {
>      /* Required by parse_variables() to be in this order.  */
> -    char name[9];        /* As a string. */
> +    char name[VAR_NAME_LEN +1];    /* As a string. */
>      int index;            /* Index into its dictionary's var[]. */
>      int type;            /* NUMERIC or ALPHA. */
>      int foo;            /* Used for temporary storage. */
> @@ -373,9 +377,9 @@
> 
>      int weight_index;        /* `value' index of $WEIGHT, or -1 if none.
>                     Call update_weighting() before using! */
> -    char weight_var[9];        /* Name of WEIGHT variable. */
> +    char weight_var[VAR_NAME_LEN];/* Name of WEIGHT variable. */
> 
> -    char filter_var[9];        /* Name of FILTER variable. */
> +    char filter_var[VAR_NAME_LEN];/* Name of FILTER variable. */
>      /* Do not make another field the last field! or see
>         temporary.c:restore_dictionary() before doing so! */
>    };
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From bill at insightful.com  Wed Jul  9 20:26:50 2008
From: bill at insightful.com (Bill Dunlap)
Date: Wed, 9 Jul 2008 11:26:50 -0700 (PDT)
Subject: [Rd] memory leak in sub("[range]",...)
Message-ID: <Pine.GSO.4.56.0807091117580.15787@devsun3201.insightful.com>

There is a 2-block memory leak in the sub() (or any other regex-related
function, probably) when the pattern argument involves a range
expression, e.g., '[0-9]'.

% R --debugger=valgrind --debugger-args=--leak-check=full --vanilla
==14519== Memcheck, a memory error detector.
==14519== Copyright (C) 2002-2006, and GNU GPL'd, by Julian Seward et al.
==14519== Using LibVEX rev 1658, a library for dynamic binary translation.
==14519== Copyright (C) 2004-2006, and GNU GPL'd, by OpenWorks LLP.
==14519== Using valgrind-3.2.1, a dynamic binary instrumentation framework.
==14519== Copyright (C) 2000-2006, and GNU GPL'd, by Julian Seward et al.
==14519== For more details, rerun with: -v
==14519==

R version 2.8.0 Under development (unstable) (2008-07-07 r46046)
...
> for(i in 1:1000)sub("[a-c]","+","0abcd")
> q()
==32503==
==32503== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 40 from 2)
==32503== malloc/free: in use at exit: 12,603,409 bytes in 7,915 blocks.
==32503== malloc/free: 61,973 allocs, 54,058 frees, 54,494,371 bytes
allocated.
==32503== For counts of detected errors, rerun with: -v
==32503== searching for pointers to 7,915 not-freed blocks.
==32503== checked 12,616,568 bytes.
==32503==
==32503== 4 bytes in 1 blocks are possibly lost in loss record 1 of 45
==32503==    at 0x40046EE: malloc (vg_replace_malloc.c:149)
==32503==    by 0x4005B9A: realloc (vg_replace_malloc.c:306)
==32503==    by 0x80A5F92: parse_expression (regex.c:5202)
==32503==    by 0x80A614F: parse_branch (regex.c:4707)
==32503==    by 0x80A621A: parse_reg_exp (regex.c:4666)
==32503==    by 0x80A6618: Rf_regcomp (regex.c:4635)
==32503==    by 0x8110CB4: do_gsub (character.c:1355)
==32503==    by 0x80654A4: do_internal (names.c:1135)
==32503==    by 0x815F0EB: Rf_eval (eval.c:461)
==32503==    by 0x8160DA7: do_begin (eval.c:1174)
==32503==    by 0x815F0EB: Rf_eval (eval.c:461)
==32503==    by 0x8162210: Rf_applyClosure (eval.c:667)
==32503==
... ignore 85 byte/4 block leak in readline ...
==32503== 7,980 bytes in 1,995 blocks are definitely lost in loss record 36 of
45
==32503==    at 0x40046EE: malloc (vg_replace_malloc.c:149)
==32503==    by 0x4005B9A: realloc (vg_replace_malloc.c:306)
==32503==    by 0x80A5F92: parse_expression (regex.c:5202)
==32503==    by 0x80A614F: parse_branch (regex.c:4707)
==32503==    by 0x80A621A: parse_reg_exp (regex.c:4666)
==32503==    by 0x80A6618: Rf_regcomp (regex.c:4635)
==32503==    by 0x8110CB4: do_gsub (character.c:1355)
==32503==    by 0x80654A4: do_internal (names.c:1135)
==32503==    by 0x815F0EB: Rf_eval (eval.c:461)
==32503==    by 0x8160DA7: do_begin (eval.c:1174)
==32503==    by 0x815F0EB: Rf_eval (eval.c:461)
==32503==    by 0x8162210: Rf_applyClosure (eval.c:667)

The leaked blocks are allocated in iinternal_function build_range_exp() at
   5200             /* Use realloc since mbcset->range_starts and
mbcset->range_ends
   5201                are NULL if *range_alloc == 0.  */
   5202             new_array_start = re_realloc (mbcset->range_starts,
wchar_t,
   5203                                           new_nranges);
   5204             new_array_end = re_realloc (mbcset->range_ends, wchar_t,
   5205                                         new_nranges);
...
   5210             mbcset->range_starts = new_array_start;
   5211             mbcset->range_ends = new_array_end;

This file, src/main/regex.c, contains a complicated mess of #ifdef's
but range_starts and range_ends are defined and appear to be used
whether or not _LIBC is defined.  However, they are only freed if _LIBC
is defined.  In my setup (Linux, gcc 3.4.5) _LIBC is not defined so
they don't get freed.

After the following change in free_charset() only the 85 byte/4 block
leak in readline remains.

Index: regex.c
===================================================================
--- regex.c     (revision 46046)
+++ regex.c     (working copy)
@@ -6240,9 +6240,9 @@
 # ifdef _LIBC
   re_free (cset->coll_syms);
   re_free (cset->equiv_classes);
+# endif
   re_free (cset->range_starts);
   re_free (cset->range_ends);
-# endif
   re_free (cset->char_classes);
   re_free (cset);
 }

[This report may be a duplicate: I tried submitting it via the form in
http://bugs.r-project.org/cgi-bin/R, but I cannot find it there now.]

----------------------------------------------------------------------------
Bill Dunlap
Insightful Corporation
bill at insightful dot com

 "All statements in this message represent the opinions of the author and do
 not necessarily reflect Insightful Corporation policy or position."


From alienalias at gmail.com  Thu Jul 10 10:24:46 2008
From: alienalias at gmail.com (Yulia Arzhaeva)
Date: Thu, 10 Jul 2008 18:24:46 +1000
Subject: [Rd] package has a loading problem
Message-ID: <976fc29a0807100124k2656e95axc76984467af87722@mail.gmail.com>

Hello,

I have difficulties in finding why I cannot load a custom R package in
Linux (Suse 10). When I run R CMD check for a package source folder I
get the following message:
".....
Error in dyn.load(file, ...) :
  unable to load shared library
'/home/yarz/projects/Riman/Riman.Rcheck/Riman/libs/Rimanlib.so':
  /home/yarz/projects/Riman/Riman.Rcheck/Riman/libs/Rimanlib.so:
undefined symbol: immagnify
Error in library(Riman) : .First.lib failed for 'Riman'
Execution halted

It looks like this package has a loading problem: see the messages for
details.  "

The same message I get when I call library(Riman) inside R after
installation of the package.
The installation via R CMD INSTALL caused no error messages. However,
Riman.so had been built before R CMD INSTALL was called, and put into
the source subfolder Riman/inst/libs. It was built via a usual gcc
call and linked with all the necessary libraries (so it is weird that
references seemed to be undefined).

The strange thing is that when I borrow Riman.so built by some other
person in my group and replace my copy with it, loading problem
disappears!  We both use the same server with Linux Suse 10, the same
R installation, the same version of gcc and the same Makefiles for
building Riman.so . We went through variables I might have omitted to
set correctly, but they seemed OK.

If you could give me any hint on what might be a problem, where else
to look, I would be very happy. Many thanks in advance.

Regards,
Yulia


From mathieu.ribatet at epfl.ch  Thu Jul 10 10:47:58 2008
From: mathieu.ribatet at epfl.ch (Mathieu Ribatet)
Date: Thu, 10 Jul 2008 10:47:58 +0200
Subject: [Rd] package has a loading problem
In-Reply-To: <976fc29a0807100124k2656e95axc76984467af87722@mail.gmail.com>
References: <976fc29a0807100124k2656e95axc76984467af87722@mail.gmail.com>
Message-ID: <4875CCBE.7060602@epfl.ch>

Have you create a zzz.R file in the R folder? I think your issue is 
related to this...

Example of the zzz.R file:

".First.lib" <-
function(lib, pkg)
{
  library.dynam("your_pkd_name", package = pkg, lib.loc = lib)
  return(invisible(0))
}

This is required when you have C/Fortran code. See the writing R 
extension manual.
Best,
Mathieu

Yulia Arzhaeva a ?crit :
> Hello,
>
> I have difficulties in finding why I cannot load a custom R package in
> Linux (Suse 10). When I run R CMD check for a package source folder I
> get the following message:
> ".....
> Error in dyn.load(file, ...) :
>   unable to load shared library
> '/home/yarz/projects/Riman/Riman.Rcheck/Riman/libs/Rimanlib.so':
>   /home/yarz/projects/Riman/Riman.Rcheck/Riman/libs/Rimanlib.so:
> undefined symbol: immagnify
> Error in library(Riman) : .First.lib failed for 'Riman'
> Execution halted
>
> It looks like this package has a loading problem: see the messages for
> details.  "
>
> The same message I get when I call library(Riman) inside R after
> installation of the package.
> The installation via R CMD INSTALL caused no error messages. However,
> Riman.so had been built before R CMD INSTALL was called, and put into
> the source subfolder Riman/inst/libs. It was built via a usual gcc
> call and linked with all the necessary libraries (so it is weird that
> references seemed to be undefined).
>
> The strange thing is that when I borrow Riman.so built by some other
> person in my group and replace my copy with it, loading problem
> disappears!  We both use the same server with Linux Suse 10, the same
> R installation, the same version of gcc and the same Makefiles for
> building Riman.so . We went through variables I might have omitted to
> set correctly, but they seemed OK.
>
> If you could give me any hint on what might be a problem, where else
> to look, I would be very happy. Many thanks in advance.
>
> Regards,
> Yulia
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>   

-- 
Institute of Mathematics
Ecole Polytechnique F?d?rale de Lausanne
STAT-IMA-FSB-EPFL, Station 8
CH-1015 Lausanne   Switzerland
http://stat.epfl.ch/
Tel: + 41 (0)21 693 7907


From termcc at googlemail.com  Thu Jul 10 13:59:02 2008
From: termcc at googlemail.com (Tom McCallum)
Date: Thu, 10 Jul 2008 12:59:02 +0100
Subject: [Rd] RODBC Close Memory Leak Question
Message-ID: <op.ud2rkofkcsmg07@localhost.localdomain>

Hi everyone,

In relation to the RODBC odbcClose bug which was fixed back in the  
changelog below:

Version: 1.2-3 (2008-01-24, released)

	* Plug a memory leak in inRODBCClose (closing a connection),
	reported by Stephan Henne.

	* Use translateChar() on character data sent in.

Background:
I am running some data from a SQL Server database, through unixODBC  
(freetds) into R via the RODBC package.  If I make many calls to  
odbcConnect, perform a query and then close the connection over a period  
of time the memory attached appears never to be freed and the process  
eventually - say 4 hours into the run - dies due to lack of memory.

Research:
I have created a dummy piece of code which shows the growing memory  
allocation shown below.   Each call brings back between 20-100 pieces of  
data which fits into a one column vector - so not a lot of data.  The  
varible x is normally returns from a function and used subsequently but  
for the purposes of this test I have kept it simple.

library("RODBC")
for( i in 1:100 ) {
	conn <- odbcConnect(************)					<-- anonymised
	x <- sqlQuery(conn, "SELECT * FROM table_name");			<-- anonymised
	odbcClose(conn);
}
quit()

I am not sure whether the leak is related to this previous bug or if it is  
related to the way the garbage collection works, but either way if I run  
this piece of code the memory attached to the database handle is never  
freed so as I bring back more and more data over a large number of runs my  
memory slowly fills up and the application crashes, unable to allocate any  
more memory.

Just to make sure I was running the latest and greatest RODBC I installed  
it again from source, but the initial installation was only done last  
month so I presume .install.packages would have got this latest version  
anyway.

Any advice on where to start searching to patch this as it is a real  
pain.   I have included below version information and the valgrind  
output.  If this is a new bug I will add it the bug tracker but I wanted  
to make sure I was not missing anything blindingly obvious to someone in  
the know.

Thanks for your help,

Tom


> version
                _
platform       i686-pc-linux-gnu
arch           i686
os             linux-gnu
system         i686, linux-gnu
status
major          2
minor          7.0
year           2008
month          04
day            22
svn rev        45424
language       R
version.string R version 2.7.0 (2008-04-22)

==8682== Memcheck, a memory error detector.
==8682== Copyright (C) 2002-2005, and GNU GPL'd, by Julian Seward et al.
==8682== Using LibVEX rev 1471, a library for dynamic binary translation.
==8682== Copyright (C) 2004-2005, and GNU GPL'd, by OpenWorks LLP.
==8682== Using valgrind-3.1.0, a dynamic binary instrumentation framework.
==8682== Copyright (C) 2000-2005, and GNU GPL'd, by Julian Seward et al.
==8682== For more details, rerun with: -v
==8682==

R version 2.7.0 (2008-04-22)
Copyright (C) 2008 The R Foundation for Statistical Computing
ISBN 3-900051-07-0

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

   Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> library("RODBC")
--8682-- WARNING: unhandled syscall: 311
--8682-- You may be able to write your own handler.
--8682-- Read the file README_MISSING_SYSCALL_OR_IOCTL.
> for( i in 1:100 ) {
+ conn <- odbcConnect(************)					<-- anonymised
+ x <- sqlQuery(conn, "SELECT * FROM table_name");			<-- anonymised
+ odbcClose(conn);
+ }
> quit()
==8682==
==8682== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 255 from 1)
==8682== malloc/free: in use at exit: 13,470,816 bytes in 6,739 blocks.
==8682== malloc/free: 121,121 allocs, 114,382 frees, 134,084,145 bytes  
allocated.
==8682== For counts of detected errors, rerun with: -v
==8682== searching for pointers to 6,739 not-freed blocks.
==8682== checked 13,332,140 bytes.
==8682==
==8682== 56 bytes in 1 blocks are possibly lost in loss record 15 of 55
==8682==    at 0x40045EB: calloc (vg_replace_malloc.c:279)
==8682==    by 0x805AA60: R_chk_calloc (memory.c:2368)
==8682==    by 0x57C89D6: RODBCDriverConnect (RODBC.c:244)
==8682==    by 0x8160A68: do_dotcall (dotcode.c:863)
==8682==    by 0x81857CE: Rf_eval (eval.c:489)
==8682==    by 0x81895B7: do_set (eval.c:1420)
==8682==    by 0x81855B0: Rf_eval (eval.c:463)
==8682==    by 0x818631E: do_begin (eval.c:1172)
==8682==    by 0x81855B0: Rf_eval (eval.c:463)
==8682==    by 0x81879B4: Rf_applyClosure (eval.c:669)
==8682==    by 0x8185469: Rf_eval (eval.c:507)
==8682==    by 0x818631E: do_begin (eval.c:1172)
==8682==
==8682==
==8682== 56 bytes in 14 blocks are definitely lost in loss record 16 of 55
==8682==    at 0x40051F9: malloc (vg_replace_malloc.c:149)
==8682==    by 0x4005271: realloc (vg_replace_malloc.c:306)
==8682==    by 0x80B47EC: parse_expression (regex.c:5202)
==8682==    by 0x80B4934: parse_branch (regex.c:4714)
==8682==    by 0x80B49BF: parse_reg_exp (regex.c:4666)
==8682==    by 0x80B5317: Rf_regcomp (regex.c:4635)
==8682==    by 0x812A38F: do_gsub (character.c:1356)
==8682==    by 0x806650A: do_internal (names.c:1129)
==8682==    by 0x81855B0: Rf_eval (eval.c:463)
==8682==    by 0x818631E: do_begin (eval.c:1172)
==8682==    by 0x81855B0: Rf_eval (eval.c:463)
==8682==    by 0x81879B4: Rf_applyClosure (eval.c:669)
==8682==
==8682==
==8682== 237 bytes in 9 blocks are definitely lost in loss record 27 of 55
==8682==    at 0x40051F9: malloc (vg_replace_malloc.c:149)
==8682==    by 0x4D6BFC51: xmalloc (in /usr/lib/libreadline.so.5.0)
==8682==    by 0x4D6AA4B9: readline_internal_teardown (in  
/usr/lib/libreadline.so.5.0)
==8682==    by 0x4D6BC1DA: rl_callback_read_char (in  
/usr/lib/libreadline.so.5.0)
==8682==    by 0x80F9A8F: Rstd_ReadConsole (sys-std.c:902)
==8682==    by 0x8058949: Rf_ReplIteration (main.c:206)
==8682==    by 0x8058A89: R_ReplConsole (main.c:306)
==8682==    by 0x8058D67: run_Rmainloop (main.c:967)
==8682==    by 0x8056670: main (Rmain.c:35)
==8682==
==8682==
==8682== 5,544 bytes in 99 blocks are definitely lost in loss record 46 of  
55
==8682==    at 0x40045EB: calloc (vg_replace_malloc.c:279)
==8682==    by 0x805AA60: R_chk_calloc (memory.c:2368)
==8682==    by 0x57C89D6: RODBCDriverConnect (RODBC.c:244)
==8682==    by 0x8160A68: do_dotcall (dotcode.c:863)
==8682==    by 0x81857CE: Rf_eval (eval.c:489)
==8682==    by 0x81895B7: do_set (eval.c:1420)
==8682==    by 0x81855B0: Rf_eval (eval.c:463)
==8682==    by 0x818631E: do_begin (eval.c:1172)
==8682==    by 0x81855B0: Rf_eval (eval.c:463)
==8682==    by 0x81879B4: Rf_applyClosure (eval.c:669)
==8682==    by 0x8185469: Rf_eval (eval.c:507)
==8682==    by 0x818631E: do_begin (eval.c:1172)
==8682==
==8682== LEAK SUMMARY:
==8682==    definitely lost: 5,837 bytes in 122 blocks.
==8682==      possibly lost: 56 bytes in 1 blocks.
==8682==    still reachable: 13,464,923 bytes in 6,616 blocks.
==8682==         suppressed: 0 bytes in 0 blocks.
==8682== Reachable blocks (those to which a pointer was found) are not  
shown.
==8682== To see them, rerun with: --show-reachable=yes


From alienalias at gmail.com  Thu Jul 10 15:16:14 2008
From: alienalias at gmail.com (Yulia Arzhaeva)
Date: Thu, 10 Jul 2008 23:16:14 +1000
Subject: [Rd] package has a loading problem
In-Reply-To: <4875CCBE.7060602@epfl.ch>
References: <976fc29a0807100124k2656e95axc76984467af87722@mail.gmail.com>
	<4875CCBE.7060602@epfl.ch>
Message-ID: <976fc29a0807100616o5dbf2c3cy7d4e557ad8c8b134@mail.gmail.com>

Hi,

Yes I have this file already.

Yulia

On Thu, Jul 10, 2008 at 6:47 PM, Mathieu Ribatet
<mathieu.ribatet at epfl.ch> wrote:
> Have you create a zzz.R file in the R folder? I think your issue is related
> to this...
>
> Example of the zzz.R file:
>
> ".First.lib" <-
> function(lib, pkg)
> {
>  library.dynam("your_pkd_name", package = pkg, lib.loc = lib)
>  return(invisible(0))
> }
>
> This is required when you have C/Fortran code. See the writing R extension
> manual.
> Best,
> Mathieu
>
> Yulia Arzhaeva a ?crit :
>>
>> Hello,
>>
>> I have difficulties in finding why I cannot load a custom R package in
>> Linux (Suse 10). When I run R CMD check for a package source folder I
>> get the following message:
>> ".....
>> Error in dyn.load(file, ...) :
>>  unable to load shared library
>> '/home/yarz/projects/Riman/Riman.Rcheck/Riman/libs/Rimanlib.so':
>>  /home/yarz/projects/Riman/Riman.Rcheck/Riman/libs/Rimanlib.so:
>> undefined symbol: immagnify
>> Error in library(Riman) : .First.lib failed for 'Riman'
>> Execution halted
>>
>> It looks like this package has a loading problem: see the messages for
>> details.  "
>>
>> The same message I get when I call library(Riman) inside R after
>> installation of the package.
>> The installation via R CMD INSTALL caused no error messages. However,
>> Riman.so had been built before R CMD INSTALL was called, and put into
>> the source subfolder Riman/inst/libs. It was built via a usual gcc
>> call and linked with all the necessary libraries (so it is weird that
>> references seemed to be undefined).
>>
>> The strange thing is that when I borrow Riman.so built by some other
>> person in my group and replace my copy with it, loading problem
>> disappears!  We both use the same server with Linux Suse 10, the same
>> R installation, the same version of gcc and the same Makefiles for
>> building Riman.so . We went through variables I might have omitted to
>> set correctly, but they seemed OK.
>>
>> If you could give me any hint on what might be a problem, where else
>> to look, I would be very happy. Many thanks in advance.
>>
>> Regards,
>> Yulia
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
> --
> Institute of Mathematics
> Ecole Polytechnique F?d?rale de Lausanne
> STAT-IMA-FSB-EPFL, Station 8
> CH-1015 Lausanne   Switzerland
> http://stat.epfl.ch/
> Tel: + 41 (0)21 693 7907
>
>
>


From Ray.Brownrigg at mcs.vuw.ac.nz  Tue Jul  8 00:22:19 2008
From: Ray.Brownrigg at mcs.vuw.ac.nz (Ray Brownrigg)
Date: Tue, 8 Jul 2008 10:22:19 +1200
Subject: [Rd] RNGkind() state
Message-ID: <200807081022.19229.Ray.Brownrigg@mcs.vuw.ac.nz>

This looks like a bug to me, and is a bit hard to describe, but easy to reproduce.  
Basically, if RNGkind is saved as something other than the default, and if the first 
operation in a session is a set.seed(), the default is reverted to.  Reproduce by:

cafe-rozo>  R --vanilla

R version 2.7.1 (2008-06-23)
Copyright (C) 2008 The R Foundation for Statistical Computing
ISBN 3-900051-07-0

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> sessionInfo()
R version 2.7.1 (2008-06-23)
i386--netbsdelf

locale:
C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base
> set.seed(1); runif(1)		# check the default
[1] 0.2655087
> RNGkind("Mar")
> RNGkind()
[1] "Marsaglia-Multicarry" "Inversion"
> set.seed(1); runif(1)		# now check again
[1] 0.006153224
> set.seed(1)			# save seed and RNGkind
> q("yes")
cafe-rozo>  R

R version 2.7.1 (2008-06-23)
: etc
[Previously saved workspace restored]

> runif(1)		# with a saved seed, Marsaglia-Multicarry is used
[1] 0.006153224
> set.seed(1); runif(1)
[1] 0.006153224
> q()
Save workspace image? [y/n/c]: n
cafe-rozo> 

R version 2.7.1 (2008-06-23)
: etc
[Previously saved workspace restored]

> set.seed(1); runif(1)		# saved RNGkind is ignored ...
[1] 0.2655087
> RNGkind()		# and overridden ...
[1] "Mersenne-Twister" "Inversion"
> q("no")
cafe-rozo>  R

R version 2.7.1 (2008-06-23)
: etc
[Previously saved workspace restored]

> RNGkind()		# and wrongly reported!
[1] "Mersenne-Twister" "Inversion"
> runif(1)			# Note this is actually using Marsaglia-Multicarry
[1] 0.006153224
>

Ray Brownrigg
Mathematics, Statistics and Computer Science
Victoria University of Wellington
Wellington, NZ


From bill at insightful.com  Thu Jul 10 22:17:03 2008
From: bill at insightful.com (Bill Dunlap)
Date: Thu, 10 Jul 2008 13:17:03 -0700 (PDT)
Subject: [Rd] memory leak in readline code
Message-ID: <Pine.GSO.4.56.0807101311230.21146@devsun3201.insightful.com>

Several folks have previously written that valgrind notices
a memory leak in R's readline code.  It looks like it leaks
a copy of every input line.

% ~/R-svn/r-devel/R/bin/R --debugger=valgrind --debugger-args=--leak-check=full --vanilla
==10725== Memcheck, a memory error detector.
==10725== Copyright (C) 2002-2006, and GNU GPL'd, by Julian Seward et al.
==10725== Using LibVEX rev 1658, a library for dynamic binary translation.
==10725== Copyright (C) 2004-2006, and GNU GPL'd, by OpenWorks LLP.
==10725== Using valgrind-3.2.1, a dynamic binary instrumentation framework.
==10725== Copyright (C) 2000-2006, and GNU GPL'd, by Julian Seward et al.
==10725== For more details, rerun with: -v
==10725==

R version 2.8.0 Under development (unstable) (2008-07-07 r46046)
Type 'q()' to quit R.

> invisible("hello")
> invisible("hello")
> invisible("hello")
> invisible("hello")
> invisible("hello")
> invisible("hello")
> invisible("hello")
> invisible("hello")
> invisible("hello")
> invisible("hello")
> q()

==10743==
==10743== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 40 from 2)
==10743== malloc/free: in use at exit: 12,591,699 bytes in 5,927 blocks.
==10743== malloc/free: 21,015 allocs, 15,088 frees, 27,744,803 bytes allocated.
==10743== For counts of detected errors, rerun with: -v
==10743== searching for pointers to 5,927 not-freed blocks.
==10743== checked 12,612,676 bytes.
==10743==
==10743== 234 bytes in 13 blocks are definitely lost in loss record 20 of 42
==10743==    at 0x40046EE: malloc (vg_replace_malloc.c:149)
==10743==    by 0x68BFF9: xmalloc (in /usr/lib/libreadline.so.4.3)
==10743==    by 0x6770D5: readline_internal_teardown (in /usr/lib/libreadline.so.4.3)
==10743==    by 0x688992: rl_callback_read_char (in /usr/lib/libreadline.so.4.3)
==10743==    by 0x80E739C: Rstd_ReadConsole (sys-std.c:905)
==10743==    by 0x8057F61: Rf_ReplIteration (main.c:205)
==10743==    by 0x805827E: R_ReplConsole (main.c:306)
==10743==    by 0x8058514: run_Rmainloop (main.c:966)
==10743==    by 0x805676D: main (Rmain.c:33)
==10743==
==10743== LEAK SUMMARY:
==10743==    definitely lost: 234 bytes in 13 blocks.
==10743==      possibly lost: 0 bytes in 0 blocks.
==10743==    still reachable: 12,591,465 bytes in 5,914 blocks.
==10743==         suppressed: 0 bytes in 0 blocks.
==10743== Reachable blocks (those to which a pointer was found) are not shown.
==10743== To see them, rerun with: --show-reachable=yes

Some experiments show that the number of blocks leaked from
readline_internal_teardown is the number of input lines plus 2 (11+2=13
in this case) and the number of leaked bytes is the total number of
bytes in those input lines (including the trailing nulls) plus 40
(10*19+4+40=234 in this case).

I think the readline callback function is expected to free
its 'char *line' argument.  The readline manual says the
input line must be freed when using the simple readline()
interface but is silent about memory management when using
the callback interface.  I have not looked in the readline
source code.

See
   http://www.mail-archive.com/freeciv-dev at gna.org/msg04863.html
for a same problem in other software using readline:
   >  Are you sure about this? Does readline really expect callback to free
   >  the line? (and if it does, can it be bug in the specific readline
   >  version you are using?)
   >   - ML
   A cursory look suggests Elmo is right.
   That you should free the returned line is explicitly mentioned when
   using the readline() call:
   http://www.delorie.com/gnu/docs/readline/rlman_24.html#IDX174
   No further mention at the reference for the alternative interface:
   http://www.delorie.com/gnu/docs/readline/rlman_41.html#IDX288

When I added 'free(line)' to src/unix/sys-std.c:readline_handler()
valgrind stopped complaining about the leaks and did not
complain about using freed memory.

It does start complaining a new leak in the readline code,
but it looks like that may be a constant 2 block, 40 byte
leak, not something that grows as the session goes on:

==11246== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 40 from 2)
==11246== malloc/free: in use at exit: 12,591,505 bytes in 5,916 blocks.
==11246== malloc/free: 21,015 allocs, 15,099 frees, 27,744,803 bytes allocated.
==11246== For counts of detected errors, rerun with: -v
==11246== searching for pointers to 5,916 not-freed blocks.
==11246== checked 12,612,676 bytes.
==11246==
==11246== 40 bytes in 2 blocks are definitely lost in loss record 10 of 42
==11246==    at 0x40046EE: malloc (vg_replace_malloc.c:149)
==11246==    by 0x68BFF9: xmalloc (in /usr/lib/libreadline.so.4.3)
==11246==    by 0x68F65B: sh_set_lines_and_columns (in /usr/lib/libreadline.so..3)
==11246==    by 0x688AEE: _rl_get_screen_size (in /usr/lib/libreadline.so.4.3)
==11246==    by 0x68918C: _rl_init_terminal_io (in /usr/lib/libreadline.so.4.3)
==11246==    by 0x677A77: rl_initialize (in /usr/lib/libreadline.so.4.3)
==11246==    by 0x6888C6: (within /usr/lib/libreadline.so.4.3)
==11246==    by 0x80E7303: Rstd_ReadConsole (sys-std.c:505)
==11246==    by 0x8057F61: Rf_ReplIteration (main.c:205)
==11246==    by 0x805827E: R_ReplConsole (main.c:306)
==11246==    by 0x8058514: run_Rmainloop (main.c:966)
==11246==    by 0x805676D: main (Rmain.c:33)
==11246==
==11246== LEAK SUMMARY:
==11246==    definitely lost: 40 bytes in 2 blocks.
==11246==      possibly lost: 0 bytes in 0 blocks.
==11246==    still reachable: 12,591,465 bytes in 5,914 blocks.
==11246==         suppressed: 0 bytes in 0 blocks.
==11246== Reachable blocks (those to which a pointer was found) are not shown.
==11246== To see them, rerun with: --show-reachable=yes

My change is:

Index: sys-std.c
===================================================================
--- sys-std.c	(revision 46046)
+++ sys-std.c	(working copy)
@@ -550,6 +550,7 @@
 	rl_top->readline_buf[0] = '\n';
 	rl_top->readline_buf[1] = '\0';
     }
+    free(line) ;
     rl_top->readline_gotaline = 1;
 }

Here is the info on the session and the shared libraries currently loaded
(readline 4.3 in particular):

> sessionInfo()
R version 2.8.0 Under development (unstable) (2008-07-07 r46046)
i686-pc-linux-gnu

locale:
LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=en_US.UTF-8;LC_COLLATE=en_US.UTF-8;LC_MONETARY=C;LC_MESSAGES=en_US.UTF-8;LC_PAPER=en_US.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US.UTF-8;LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base
> system(paste("pldd", Sys.getpid()))
11304:  /homes/bill/R-svn/r-devel/R/bin/exec/R --vanilla /a/homer.insightful.com/users/bill/R-svn/r-devel/R/library/grDevices/libs/grDevices.so
/a/homer.insightful.com/users/bill/R-svn/r-devel/R/lib/libRblas.so
/usr/lib/libreadline.so.4.3
/lib/ld-2.3.4.so
/lib/tls/libc-2.3.4.so
/lib/tls/libm-2.3.4.so
/lib/libdl-2.3.4.so
/lib/libnss_files-2.3.4.so
/a/homer.insightful.com/users/bill/R-svn/r-devel/R/library/stats/libs/stats.so
/a/homer.insightful.com/users/bill/R-svn/r-devel/R/library/methods/libs/methods.so
/lib/libnsl-2.3.4.so
/usr/lib/gconv/ISO8859-1.so
/lib/libnss_nis-2.3.4.so
/usr/lib/libg2c.so.0.0.0
/usr/lib/libncurses.so.5.4

/usr/lib/gconv/gconv-modules.cache
/a/homer.insightful.com/users/bill/R-svn/r-devel/R/share/locale/en/LC_MESSAGES/R.mo
/usr/lib/locale/locale-archive



----------------------------------------------------------------------------
Bill Dunlap
Insightful Corporation
bill at insightful dot com
360-428-8146

 "All statements in this message represent the opinions of the author and do
 not necessarily reflect Insightful Corporation policy or position."


From hb at stat.berkeley.edu  Fri Jul 11 05:18:30 2008
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Thu, 10 Jul 2008 20:18:30 -0700
Subject: [Rd] Suggestion: 20% speed up of which() with two-character mod
Message-ID: <59d7961d0807102018j3d304d73p56f85bde01747b00@mail.gmail.com>

Hi,

by replacing 'll' with 'wh' in the source code for base::which() one
gets ~20% speed up for *named logical vectors*.

CURRENT CODE:

which <- function(x, arr.ind = FALSE)
{
    if(!is.logical(x))
	stop("argument to 'which' is not logical")
    wh <- seq_along(x)[ll <- x & !is.na(x)]
    m <- length(wh)
    dl <- dim(x)
    if (is.null(dl) || !arr.ind) {
        names(wh) <- names(x)[ll]
    }
    ...
    wh;
}

SUGGESTED CODE: (Remove 'll' and use 'wh')

which2 <- function(x, arr.ind = FALSE)
{
    if(!is.logical(x))
	stop("argument to 'which' is not logical")
    wh <- seq_along(x)[x & !is.na(x)]
    m <- length(wh)
    dl <- dim(x)
    if (is.null(dl) || !arr.ind) {
        names(wh) <- names(x)[wh]
    }
    ...
    wh;
}

That's all.

BENCHMARKING:

# To measure both in same environment
which1 <- base::which;
environment(which1) <- globalenv();  # Needed?

N <- 1e6;
set.seed(0xbeef);
x <- sample(c(TRUE, FALSE), size=N, replace=TRUE);
names(x) <- seq_along(x);
B <- 10;
t1 <- system.time({ for (bb in 1:B) idxs1 <- which1(x); });
t2 <- system.time({ for (bb in 1:B) idxs2 <- which2(x); });
stopifnot(identical(idxs1, idxs2));
print(t1/t2);
# Fair benchmarking
t2 <- system.time({ for (bb in 1:B) idxs2 <- which2(x); });
t1 <- system.time({ for (bb in 1:B) idxs1 <- which1(x); });
print(t1/t2);
##      user    system   elapsed
##   1.283186   1.052632   1.250000

You get similar results if you put for loop outside the system.time()
call (and sum up the timings).

Cheers

Henrik


From edd at debian.org  Fri Jul 11 15:25:06 2008
From: edd at debian.org (Dirk Eddelbuettel)
Date: Fri, 11 Jul 2008 08:25:06 -0500
Subject: [Rd] Type: Frontend ignored in 'Bundle' packages
Message-ID: <18551.24370.242727.398758@ron.nulle.part>


A few weeks ago I started a thread expressing the desire to expand 'R CMD
INSTALL' to also provide a hook for a post-build install step. A Gmane-base
view is here
	http://thread.gmane.org/gmane.comp.lang.r.devel/16827
but it misses at least one further 'in support' message by Greg Warnes.

There has be no follow-up from R Core.

Now, I tried to code around this limitation by 
 - switching to 'Bundle'-style packaging
 - using the 'Type: Frontend' in one part that the other part would depend upon
 - and using a normal package structure in another

But 'R CMD check' fails to recognise 'Type: Frontend' in bundle packages, and
tries to treat it as a normal package, and fails. So I cannot successfully run
'R CMD check' on the whole, and hence could not upload to CRAN.

Is this something that should get fixed in the R tools?  Shall I look into a
patch? 

That said, I would still like to see a 'make install'-alike functionality in
the R CMD INSTALL process.  Could this be revisited?

Regards, Dirk

-- 
Three out of two people have difficulties with fractions.


From j.c.l.ooms at uu.nl  Fri Jul 11 16:21:14 2008
From: j.c.l.ooms at uu.nl (Jeroen Ooms)
Date: Fri, 11 Jul 2008 07:21:14 -0700 (PDT)
Subject: [Rd]  matching predictors and dummies
Message-ID: <18405023.post@talk.nabble.com>


I am trying to make a little web interface for the lm() function. It
calculates both anova F-tests and parameters and returns it in a nice table.
However, I have a problem with matching the Anova predictors with the
regression coefficients: For numeric predictors there is no problem: the
coefficients have the same names as the predictors. However, when a factor
IV is specified, lm() automatically converts this factor to dummy variables,
which (of course) have different names than the orriginal predictor. The lm
model that is returned contains a seperate parameter for every dummy
variable.

Then when you use anova(lm.model) the function seems to know which of the
parameters are dummies of one and the same factor, and takes these together
in the anova-test. The anova() function returns the variance explained by
the orriginal factor, which are all dummies. It does not show the seperate
dummy variables anymore. Of course, this is exactly what you want in an
analysis of variance.

My question is: where in the lm or glm object is stored which of the
parameters are dummies of the same factor? The only thing i could think of
was using lm.model$xlevels, however manipulating these names in the lm-model
did not confuse anova() at all, so I guess there is a better way.

An additional question is if it is possible to specify the names of the
dummy variables that lm/glm creates when a factor is specified as IV? 
-- 
View this message in context: http://www.nabble.com/matching-predictors-and-dummies-tp18405023p18405023.html
Sent from the R devel mailing list archive at Nabble.com.


From cberry at tajo.ucsd.edu  Fri Jul 11 17:57:56 2008
From: cberry at tajo.ucsd.edu (Charles C. Berry)
Date: Fri, 11 Jul 2008 08:57:56 -0700
Subject: [Rd] Suggestion: 20% speed up of which() with two-character mod
In-Reply-To: <59d7961d0807102018j3d304d73p56f85bde01747b00@mail.gmail.com>
References: <59d7961d0807102018j3d304d73p56f85bde01747b00@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0807110856250.14412@tajo.ucsd.edu>

On Thu, 10 Jul 2008, Henrik Bengtsson wrote:

> Hi,
>
> by replacing 'll' with 'wh' in the source code for base::which() one
> gets ~20% speed up for *named logical vectors*.


The amount of speedup depends on how sparse the TRUE values are.

When the proportion of TRUEs gets small the speedup is more than twofold 
on my macbook. For high proportions of TRUE, the speedup is more like the 
20% you cite.

HTH,

Chuck

>
> CURRENT CODE:
>
> which <- function(x, arr.ind = FALSE)
> {
>    if(!is.logical(x))
> 	stop("argument to 'which' is not logical")
>    wh <- seq_along(x)[ll <- x & !is.na(x)]
>    m <- length(wh)
>    dl <- dim(x)
>    if (is.null(dl) || !arr.ind) {
>        names(wh) <- names(x)[ll]
>    }
>    ...
>    wh;
> }
>
> SUGGESTED CODE: (Remove 'll' and use 'wh')
>
> which2 <- function(x, arr.ind = FALSE)
> {
>    if(!is.logical(x))
> 	stop("argument to 'which' is not logical")
>    wh <- seq_along(x)[x & !is.na(x)]
>    m <- length(wh)
>    dl <- dim(x)
>    if (is.null(dl) || !arr.ind) {
>        names(wh) <- names(x)[wh]
>    }
>    ...
>    wh;
> }
>
> That's all.
>
> BENCHMARKING:
>
> # To measure both in same environment
> which1 <- base::which;
> environment(which1) <- globalenv();  # Needed?
>
> N <- 1e6;
> set.seed(0xbeef);
> x <- sample(c(TRUE, FALSE), size=N, replace=TRUE);
> names(x) <- seq_along(x);
> B <- 10;
> t1 <- system.time({ for (bb in 1:B) idxs1 <- which1(x); });
> t2 <- system.time({ for (bb in 1:B) idxs2 <- which2(x); });
> stopifnot(identical(idxs1, idxs2));
> print(t1/t2);
> # Fair benchmarking
> t2 <- system.time({ for (bb in 1:B) idxs2 <- which2(x); });
> t1 <- system.time({ for (bb in 1:B) idxs1 <- which1(x); });
> print(t1/t2);
> ##      user    system   elapsed
> ##   1.283186   1.052632   1.250000
>
> You get similar results if you put for loop outside the system.time()
> call (and sum up the timings).
>
> Cheers
>
> Henrik
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

Charles C. Berry                            (858) 534-2098
                                             Dept of Family/Preventive Medicine
E mailto:cberry at tajo.ucsd.edu	            UC San Diego
http://famprevmed.ucsd.edu/faculty/cberry/  La Jolla, San Diego 92093-0901


From cberry at tajo.ucsd.edu  Fri Jul 11 18:26:33 2008
From: cberry at tajo.ucsd.edu (Charles C. Berry)
Date: Fri, 11 Jul 2008 09:26:33 -0700
Subject: [Rd] matching predictors and dummies
In-Reply-To: <18405023.post@talk.nabble.com>
References: <18405023.post@talk.nabble.com>
Message-ID: <Pine.LNX.4.64.0807110915480.14412@tajo.ucsd.edu>

On Fri, 11 Jul 2008, Jeroen Ooms wrote:

>
> I am trying to make a little web interface for the lm() function. It
> calculates both anova F-tests and parameters and returns it in a nice table.
> However, I have a problem with matching the Anova predictors with the
> regression coefficients: For numeric predictors there is no problem: the
> coefficients have the same names as the predictors. However, when a factor
> IV is specified, lm() automatically converts this factor to dummy variables,
> which (of course) have different names than the orriginal predictor. The lm
> model that is returned contains a seperate parameter for every dummy
> variable.
>
> Then when you use anova(lm.model) the function seems to know which of the
> parameters are dummies of one and the same factor, and takes these together
> in the anova-test. The anova() function returns the variance explained by
> the orriginal factor, which are all dummies. It does not show the seperate
> dummy variables anymore. Of course, this is exactly what you want in an
> analysis of variance.
>
> My question is: where in the lm or glm object is stored which of the
> parameters are dummies of the same factor? The only thing i could think of
> was using lm.model$xlevels, however manipulating these names in the lm-model
> did not confuse anova() at all, so I guess there is a better way.

See
 	?terms
 	?terms.object

and run

 	example( terms.object )

or something like

 	terms( lm( Ozone ~ Temp + factor(Month), airquality ) )

>
> An additional question is if it is possible to specify the names of the
> dummy variables that lm/glm creates when a factor is specified as IV?
> --

I'm guessing a custom contrast function would do this. Have a look at

 	?contrasts
 	page( contr.treatment, 'print' )

Or just hack the names attribute of the relevant pieces in the object 
returned by lm/glm.

You do know to use str(), right?


HTH,

Chuck


> View this message in context: http://www.nabble.com/matching-predictors-and-dummies-tp18405023p18405023.html
> Sent from the R devel mailing list archive at Nabble.com.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

Charles C. Berry                            (858) 534-2098
                                             Dept of Family/Preventive Medicine
E mailto:cberry at tajo.ucsd.edu	            UC San Diego
http://famprevmed.ucsd.edu/faculty/cberry/  La Jolla, San Diego 92093-0901


From j.c.l.ooms at uu.nl  Fri Jul 11 21:20:19 2008
From: j.c.l.ooms at uu.nl (Jeroen Ooms)
Date: Fri, 11 Jul 2008 12:20:19 -0700 (PDT)
Subject: [Rd] matching predictors and dummies
In-Reply-To: <Pine.LNX.4.64.0807110915480.14412@tajo.ucsd.edu>
References: <18405023.post@talk.nabble.com>
	<Pine.LNX.4.64.0807110915480.14412@tajo.ucsd.edu>
Message-ID: <18410832.post@talk.nabble.com>



Charles C. Berry wrote:
> 
> See
>  	?terms
>  	?terms.object
> 
> 
> 

I am sorry but i cannot figure out how i can find out which coefficients
belong to which predictors using the model$terms. If i do
attributes(model$terms) i get a nice list which contains the orriginal
factors and some more information, and from model$xlevels i can see the
levels of these factors. However, it does not say anywhere which of the
model$coefficients belong to which factor. The only thing i can imagine is
assuming that the dummy names are simply the concatenation of the factor
name and the level name, which seems to be the default behavior. But
preferebly i would not want to make my program rely on this assumption. How
could i use the model$terms to extract which coefficients belong to which
factor, the way anova() does it?

-- 
View this message in context: http://www.nabble.com/matching-predictors-and-dummies-tp18405023p18410832.html
Sent from the R devel mailing list archive at Nabble.com.


From mark_difford at yahoo.co.uk  Sat Jul 12 08:22:01 2008
From: mark_difford at yahoo.co.uk (Mark Difford)
Date: Fri, 11 Jul 2008 23:22:01 -0700 (PDT)
Subject: [Rd] matching predictors and dummies
In-Reply-To: <18410832.post@talk.nabble.com>
References: <18405023.post@talk.nabble.com>
	<Pine.LNX.4.64.0807110915480.14412@tajo.ucsd.edu>
	<18410832.post@talk.nabble.com>
Message-ID: <18416554.post@talk.nabble.com>


Hi Jeroen,

>> How could i use the model$terms to extract which coefficients belong to
>> which factor, 
>> the way anova() does it?

There may be a simpler ("canned") way to do it, but why don't you debug
anova.lm to see how it does it?

##
methods("anova")
anova.lm

HTH, Mark.


Jeroen Ooms wrote:
> 
> 
> Charles C. Berry wrote:
>> 
>> See
>>  	?terms
>>  	?terms.object
>> 
>> 
>> 
> 
> I am sorry but i cannot figure out how i can find out which coefficients
> belong to which predictors using the model$terms. If i do
> attributes(model$terms) i get a nice list which contains the orriginal
> factors and some more information, and from model$xlevels i can see the
> levels of these factors. However, it does not say anywhere which of the
> model$coefficients belong to which factor. The only thing i can imagine is
> assuming that the dummy names are simply the concatenation of the factor
> name and the level name, which seems to be the default behavior. But
> preferebly i would not want to make my program rely on this assumption.
> How could i use the model$terms to extract which coefficients belong to
> which factor, the way anova() does it?
> 
> 

-- 
View this message in context: http://www.nabble.com/matching-predictors-and-dummies-tp18405023p18416554.html
Sent from the R devel mailing list archive at Nabble.com.


From pburns at pburns.seanet.com  Sun Jul 13 11:39:21 2008
From: pburns at pburns.seanet.com (Patrick Burns)
Date: Sun, 13 Jul 2008 10:39:21 +0100
Subject: [Rd] multiple names to assign
Message-ID: <4879CD49.2080406@pburns.seanet.com>

'assign' does not give a warning if 'x' has length
greater than 1 -- it just uses the first element:

assign(c('a1', 'a2'), 1:2)

One way of thinking about this is that people using
'assign' get what they deserve.  The other is that it is
used seldom enough that adding a warning isn't going
to slow things down appreciably.


Patrick Burns
patrick at burns-stat.com
+44 (0)20 8525 0696
http://www.burns-stat.com
(home of S Poetry and "A Guide for the Unwilling S User")


From khansen at stat.Berkeley.EDU  Sun Jul 13 18:06:06 2008
From: khansen at stat.Berkeley.EDU (Kasper Daniel Hansen)
Date: Sun, 13 Jul 2008 09:06:06 -0700
Subject: [Rd] multiple names to assign
In-Reply-To: <4879CD49.2080406@pburns.seanet.com>
References: <4879CD49.2080406@pburns.seanet.com>
Message-ID: <503A1D6E-EE7B-40B1-B9ED-C96398A3BAD7@stat.berkeley.edu>

Biobase has multiassign.

Kasper

On Jul 13, 2008, at 2:39 AM, Patrick Burns wrote:

> 'assign' does not give a warning if 'x' has length
> greater than 1 -- it just uses the first element:
>
> assign(c('a1', 'a2'), 1:2)
>
> One way of thinking about this is that people using
> 'assign' get what they deserve.  The other is that it is
> used seldom enough that adding a warning isn't going
> to slow things down appreciably.
>
>
> Patrick Burns
> patrick at burns-stat.com
> +44 (0)20 8525 0696
> http://www.burns-stat.com
> (home of S Poetry and "A Guide for the Unwilling S User")
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From stenka1 at go.com  Mon Jul 14 15:30:17 2008
From: stenka1 at go.com (stephenb)
Date: Mon, 14 Jul 2008 06:30:17 -0700 (PDT)
Subject: [Rd]  dll problem
Message-ID: <18443925.post@talk.nabble.com>


I am trying to load a dll compiled with the latest cygwin into R 2.7.0
R version 2.7.0 (2008-04-22)
Copyright (C) 2008 The R Foundation for Statistical Computing
ISBN 3-900051-07-0

I have:
Sys.getenv("Path")
                                                                                                                                                         
Path
"C:\\Windows\\system32;C:\\Windows;C:\\Windows\\System32\\Wbem;C:\\Program
Files\\MBTrading\\MBT Navigator;C:\\Program
Files\\R\\R-2.7.0\\bin;C:\\cygwin\\bin"

the source is:
!!!     f1.f
       SUBROUTINE f1(a)

      INTEGER :: a, i
      a=2

      RETURN

      END SUBROUTINE f1

compiled by

g77 -shared -o f1.dll f1.f

R freezes and I have to kill it with task manager
when I try:
dyn.load("f1.dll")

Please, help.
-- 
View this message in context: http://www.nabble.com/dll-problem-tp18443925p18443925.html
Sent from the R devel mailing list archive at Nabble.com.


From termcc at googlemail.com  Mon Jul 14 18:40:54 2008
From: termcc at googlemail.com (Tom McCallum)
Date: Mon, 14 Jul 2008 17:40:54 +0100
Subject: [Rd] RODBC Seg Fault
Message-ID: <op.ueajagfbcsmg07@localhost.localdomain>

Hi Everyone,

At the end of this email is a transcript of a problem I have found in  
RODBC version 2.3-1.  It appears that the bug fix in odbcClose for the  
memory leak has meant that the garbage collector is falling over when it  
tries to free up the extPtr attribute of the RODBC connection pointer.

Any advice on how to fix this?

Thanks for your help,

Tom

##---------------------------------------------------------------

platform       i686-pc-linux-gnu
arch           i686
os             linux-gnu
system         i686, linux-gnu
status
major          2
minor          7.1
year           2008
month          06
day            23
svn rev        45970
language       R
version.string R version 2.7.1 (2008-06-23)

##---------------------------------------------------------------

Run using the command
$ R -d gdb

##---------------------------------------------------------------

Starting program: /usr/local/lib/R/bin/exec/R

R version 2.7.1 (2008-06-23)
Copyright (C) 2008 The R Foundation for Statistical Computing
ISBN 3-900051-07-0

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

   Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

[Previously saved workspace restored]

> library("RODBC")
[Thread debugging using libthread_db enabled]
[New Thread -1208248640 (LWP 14060)]
Error while reading shared library symbols:
Cannot find new threads: generic error
> gctorture(TRUE)
> for(i in 1:10) { print(i); conn <- odbcConnect("***", "***", "***");  
> print(conn); odbcClose(conn) }
[1] 1
RODB Connection 2
Details:
   case=nochange
   DSN=***
   UID=***
   PWD=***
[1] 2
RODB Connection 3
Details:
   case=nochange
   DSN=***
   UID=***
   PWD=***
[1] 3

Program received signal SIGSEGV, Segmentation fault.
[Switching to Thread -1208248640 (LWP 14060)]
0x08059036 in R_ClearExternalPtr (s=0x0) at memory.c:2445
2445    memory.c: No such file or directory.
         in memory.c
(gdb) bt
#0  0x08059036 in R_ClearExternalPtr (s=0x0) at memory.c:2445
#1  0x006b17cb in inRODBCClose (thisHandle=0x8c1f358) at RODBC.c:1250
#2  0x006b190d in chanFinalizer (ptr=0x9100380) at RODBC.c:1271
#3  0x0805b6eb in R_RunWeakRefFinalizer (w=0x90da4f8) at memory.c:1062
#4  0x0805b810 in RunFinalizers () at memory.c:1107
#5  0x0805cf17 in R_gc_internal (size_needed=1) at memory.c:2205
#6  0x0805da69 in Rf_allocVector (type=16, length=1) at memory.c:1968
#7  0x006b3955 in RODBCDriverConnect (connection=0x90b0208, id=0x90b0288,  
useNRows=0x90b02c8) at RODBC.c:277
#8  0x08161a19 in do_dotcall (call=0x89b9ba8, op=0x85518dc, args=<value  
optimized out>, env=0x9100e44) at dotcode.c:863
#9  0x0818683f in Rf_eval (e=0x89b9ba8, rho=0x9100e44) at eval.c:489
#10 0x0818a628 in do_set (call=0x89b9b1c, op=0x8546120, args=<value  
optimized out>, rho=0x9100e44) at eval.c:1424
#11 0x08186621 in Rf_eval (e=0x89b9b1c, rho=0x9100e44) at eval.c:463
#12 0x0818737f in do_begin (call=0x89ba260, op=0x8547788, args=0x89b9b00,  
rho=0x9100e44) at eval.c:1176
#13 0x08186621 in Rf_eval (e=0x89ba260, rho=0x9100e44) at eval.c:463
#14 0x08188a15 in Rf_applyClosure (call=0x89bbda4, op=0x89bac60,  
arglist=0x9100bf8, rho=0x9100a38, suppliedenv=0x855a084) at eval.c:669
#15 0x081864da in Rf_eval (e=0x89bbda4, rho=0x9100a38) at eval.c:507
#16 0x0818737f in do_begin (call=0x89bb90c, op=0x8547788, args=0x89bbd88,  
rho=0x9100a38) at eval.c:1176
#17 0x08186621 in Rf_eval (e=0x89bb90c, rho=0x9100a38) at eval.c:463
#18 0x08188a15 in Rf_applyClosure (call=0x8e5bcd0, op=0x89bcc80,  
arglist=0x9100894, rho=0x855a068, suppliedenv=0x855a084) at eval.c:669
#19 0x081864da in Rf_eval (e=0x8e5bcd0, rho=0x855a068) at eval.c:507
#20 0x0818a628 in do_set (call=0x8e5ba30, op=0x8546120, args=<value  
optimized out>, rho=0x855a068) at eval.c:1424
#21 0x08186621 in Rf_eval (e=0x8e5ba30, rho=0x855a068) at eval.c:463
#22 0x0818737f in do_begin (call=0x8e5991c, op=0x8547788, args=0x8e597e8,  
rho=0x855a068) at eval.c:1176
#23 0x08186621 in Rf_eval (e=0x8e5991c, rho=0x855a068) at eval.c:463
#24 0x08189fb3 in do_for (call=0x8e59820, op=0x8536d78, args=0x8e59938,  
rho=0x855a068) at eval.c:1075
#25 0x08186621 in Rf_eval (e=0x8e59820, rho=0x855a068) at eval.c:463
#26 0x080587e0 in Rf_ReplIteration (rho=0x855a068, savestack=0,  
browselevel=0, state=0xbf833d28) at main.c:257
#27 0x08058b4a in R_ReplConsole (rho=0x855a068, savestack=0,  
browselevel=0) at main.c:306
#28 0x08058e28 in run_Rmainloop () at main.c:967
#29 0x08056731 in main (ac=Cannot access memory at address 0x0
) at Rmain.c:35


From murdoch at stats.uwo.ca  Mon Jul 14 19:18:05 2008
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Mon, 14 Jul 2008 13:18:05 -0400
Subject: [Rd] dll problem
In-Reply-To: <18443925.post@talk.nabble.com>
References: <18443925.post@talk.nabble.com>
Message-ID: <487B8A4D.7050809@stats.uwo.ca>

On 7/14/2008 9:30 AM, stephenb wrote:
> I am trying to load a dll compiled with the latest cygwin into R 2.7.0

We don't support Cygwin in R.  I'd suggest using the MinGW tools we 
provide (see www.murdoch-sutherland.com/Rtools).

Duncan Murdoch

> R version 2.7.0 (2008-04-22)
> Copyright (C) 2008 The R Foundation for Statistical Computing
> ISBN 3-900051-07-0
> 
> I have:
> Sys.getenv("Path")
>                                                                                                                                                          
> Path
> "C:\\Windows\\system32;C:\\Windows;C:\\Windows\\System32\\Wbem;C:\\Program
> Files\\MBTrading\\MBT Navigator;C:\\Program
> Files\\R\\R-2.7.0\\bin;C:\\cygwin\\bin"
> 
> the source is:
> !!!     f1.f
>        SUBROUTINE f1(a)
> 
>       INTEGER :: a, i
>       a=2
> 
>       RETURN
> 
>       END SUBROUTINE f1
> 
> compiled by
> 
> g77 -shared -o f1.dll f1.f
> 
> R freezes and I have to kill it with task manager
> when I try:
> dyn.load("f1.dll")
> 
> Please, help.


From murdoch at stats.uwo.ca  Mon Jul 14 23:19:48 2008
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Mon, 14 Jul 2008 17:19:48 -0400
Subject: [Rd] dll problem
In-Reply-To: <2046565686.2591911216068403514.JavaMail.mail@webmail05>
References: <2046565686.2591911216068403514.JavaMail.mail@webmail05>
Message-ID: <487BC2F4.1020208@stats.uwo.ca>

stenka1 at go.com wrote:
>
> Please, note the instructions given for an existing Cygwin install:
>
>  
>
> If you already have a full Cygwin installation, then you should not
> install our Cygwin DLLs in the Rtools/bin directory.  You should make
> sure your existing cygwin/bin directory is on the path (*after* all
> the other entries listed above) and use the DLLs from there.
>
>
> I interpret those as: Cygwin without Mingw is fine.
>

I don't think that's a reasonable interpretation.  What I intended to 
convey is that if you're using Cygwin, then you shouldn't put our Cygwin 
DLLs ahead of yours on the path (because yours might be newer), but you 
need to put all of our other entries ahead of Cygwin on the path.  I 
can't think of a rewrite that would make that clearer:  I even 
emphasized the "*after*".

> Using gfortran from mingw produced loadable dlls, so this is just a 
> suggestion to be more explicit in Rtools.txt.
>

If you can suggest a rewording that you think is more explicit then I'll 
take a look, but I really can't think of one.

Duncan Murdoch
>
> Thanks a lot.
>
>  
>
> Stephen C. Bond
>
>  
>
>  
>
> On Jul 14, 2008, *murdoch at stats.uwo.ca* wrote:
>
>
>     On 7/14/2008 9:30 AM, stephenb wrote:
>     > I am trying to load a dll compiled with the latest cygwin into R
>     2.7.0
>
>     We don't support Cygwin in R.  I'd suggest using the MinGW tools we
>     provide (see www.murdoch-sutherland.com/Rtools).
>
>     Duncan Murdoch
>
>     > R version 2.7.0 (2008-04-22)
>     > Copyright (C) 2008 The R Foundation for Statistical Computing
>     > ISBN 3-900051-07-0
>     >
>     > I have:
>     > Sys.getenv("Path")
>     >                                                                
>                                                                      
>                            
>     > Path
>     >
>     "C:\\Windows\\system32;C:\\Windows;C:\\Windows\\System32\\Wbem;C:\\Program
>     > Files\\MBTrading\\MBT Navigator;C:\\Program
>     > Files\\R\\R-2.7.0\\bin;C:\\cygwin\\bin"
>     >
>     > the source is:
>     > !!!     f1.f
>     >        SUBROUTINE f1(a)
>     >
>     >       INTEGER :: a, i
>     >       a=2
>     >
>     >       RETURN
>     >
>     >       END SUBROUTINE f1
>     >
>     > compiled by
>     >
>     > g77 -shared -o f1.dll f1.f
>     >
>     > R freezes and I have to kill it with task manager
>     > when I try:
>     > dyn.load("f1.dll")
>     >
>     > Please, help.
>


From maechler at stat.math.ethz.ch  Tue Jul 15 09:38:04 2008
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Tue, 15 Jul 2008 09:38:04 +0200
Subject: [Rd] spss long labels
In-Reply-To: <48747153.7080803@skynet.be>
References: <486B35A8.5000700@skynet.be>
	<48747153.7080803@skynet.be>
Message-ID: <18556.21468.48751.243985@stat.math.ethz.ch>

Hi Kurt,

>>>>> "KVD" == Kurt Van Dijck <kurt.van.dijck at skynet.be>
>>>>>     on Wed, 09 Jul 2008 10:05:39 +0200 writes:

    KVD> Hi all, I got no feedback at all concerning the merge
    KVD> of this patch in the source tree.  Am I supposed to do
    KVD> this myself? How should I do this (do I have subversion
    KVD> commit access)? Is this patch acceptable at all? Is it
    KVD> being tested?

I don't know if it's being tested.
It's vacation and traveling time, also for the R core team.

The foreign package source is kept in svn-archive
  https://svn.r-project.org/R-packages/trunk/foreign/

and I have tried to apply your patch (from July 2) to the
sources but 

    patch -p0 < K_Van_Dijck_patch 

    patching file src/sfm-read.c
    Hunk #1 FAILED at 188.
    Hunk #2 FAILED at 420.
    Hunk #3 FAILED at 590.
    Hunk #4 FAILED at 1559.
    4 out of 4 hunks FAILED -- saving rejects to file src/sfm-read.c.rej
    patching file src/var.h.in
    Hunk #1 FAILED at 41.
    Hunk #2 FAILED at 232.
    Hunk #3 FAILED at 306.
    Hunk #4 FAILED at 377.
    4 out of 4 hunks FAILED -- saving rejects to file src/var.h.in.rej


Could you provide a patch against the development code from the
above url ?
(after installing 'subversion', you get the development directory by
   svn co https://svn.r-project.org/R-packages/trunk/foreign/
)

    KVD> I got some personal reactions on my post, proving there
    KVD> is general interest in getting rid of the inconvenience
    KVD> of importing long labels from SPSS files.

My problem is that I cannot do much testing apart from the tests
already present in foreign/tests/spss.R

Could you provide a new small *.sav file and a corresponding
read.spss() call which exhibits the
problems and is fixed by your patch?

Thank you in advance for your contribution!
Best regards,

Martin Maechler,
ETH Zurich and R Core Team.


    KVD> Kurt Van Dijck wrote:
    >> Hi,
    >> 
    >> A frequently seen issue with importing SPSS data files,
    >> is that R does not import the 'long variable names'.  I
    >> built a patch on the R-project's foreign module, in order
    >> to import the 'long variable names' from SPSS (record 7,
    >> subtype 13).  To complete the job, I had to expand the
    >> "struct variable" definition to have 64 +1
    >> charachters. I'm not aware of side effects.  The
    >> sfm-read.c code works fine.  I didn't test a variety of
    >> platforms, as I don't have an idea of what is regarded as
    >> sufficient testing. Anyway, I don't expect major troubles
    >> there (no byteswapping problems, no 32<->64 bit issues)
    >> as it's mainly character processing.  The patch is
    >> relative to the foreign directory. It was created against
    >> the trunk of R-project yesterday.
    >> 
    >> We would appreciate that you import such patch into the
    >> main tree.
    >> 
    >> Kind regards,
    >> 
    >> Kurt Van Dijck (C programmer) & Ilse Laurijssen (R user)
    >> Belgium

    [......... patch deleted .............]


From maechler at stat.math.ethz.ch  Tue Jul 15 10:11:06 2008
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Tue, 15 Jul 2008 10:11:06 +0200
Subject: [Rd] memory leak in sub("[range]",...)
In-Reply-To: <Pine.GSO.4.56.0807091117580.15787@devsun3201.insightful.com>
References: <Pine.GSO.4.56.0807091117580.15787@devsun3201.insightful.com>
Message-ID: <18556.23450.521709.623929@stat.math.ethz.ch>

>>>>> "BD" == Bill Dunlap <bill at insightful.com>
>>>>>     on Wed, 9 Jul 2008 11:26:50 -0700 (PDT) writes:

    BD> There is a 2-block memory leak in the sub() (or any other regex-related
    BD> function, probably) when the pattern argument involves a range
    BD> expression, e.g., '[0-9]'.

    BD> % R --debugger=valgrind --debugger-args=--leak-check=full --vanilla
    BD> ==14519== Memcheck, a memory error detector.
    BD> ==14519== Copyright (C) 2002-2006, and GNU GPL'd, by Julian Seward et al.
    BD> ==14519== Using LibVEX rev 1658, a library for dynamic binary translation.
    BD> ==14519== Copyright (C) 2004-2006, and GNU GPL'd, by OpenWorks LLP.
    BD> ==14519== Using valgrind-3.2.1, a dynamic binary instrumentation framework.
    BD> ==14519== Copyright (C) 2000-2006, and GNU GPL'd, by Julian Seward et al.
    BD> ==14519== For more details, rerun with: -v
    BD> ==14519==

    BD> R version 2.8.0 Under development (unstable) (2008-07-07 r46046)
    BD> ...
    >> for(i in 1:1000)sub("[a-c]","+","0abcd")
    >> q()
    BD> ==32503==
    BD> ==32503== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 40 from 2)
    BD> ==32503== malloc/free: in use at exit: 12,603,409 bytes in 7,915 blocks.
    BD> ==32503== malloc/free: 61,973 allocs, 54,058 frees, 54,494,371 bytes
    BD> allocated.
    BD> ==32503== For counts of detected errors, rerun with: -v
    BD> ==32503== searching for pointers to 7,915 not-freed blocks.
    BD> ==32503== checked 12,616,568 bytes.
    BD> ==32503==
    BD> ==32503== 4 bytes in 1 blocks are possibly lost in loss record 1 of 45
    BD> ==32503==    at 0x40046EE: malloc (vg_replace_malloc.c:149)
    BD> ==32503==    by 0x4005B9A: realloc (vg_replace_malloc.c:306)
    BD> ==32503==    by 0x80A5F92: parse_expression (regex.c:5202)
    BD> ==32503==    by 0x80A614F: parse_branch (regex.c:4707)
    BD> ==32503==    by 0x80A621A: parse_reg_exp (regex.c:4666)
    BD> ==32503==    by 0x80A6618: Rf_regcomp (regex.c:4635)
    BD> ==32503==    by 0x8110CB4: do_gsub (character.c:1355)
    BD> ==32503==    by 0x80654A4: do_internal (names.c:1135)
    BD> ==32503==    by 0x815F0EB: Rf_eval (eval.c:461)
    BD> ==32503==    by 0x8160DA7: do_begin (eval.c:1174)
    BD> ==32503==    by 0x815F0EB: Rf_eval (eval.c:461)
    BD> ==32503==    by 0x8162210: Rf_applyClosure (eval.c:667)
    BD> ==32503==
    BD> ... ignore 85 byte/4 block leak in readline ...
    BD> ==32503== 7,980 bytes in 1,995 blocks are definitely lost in loss record 36 of
    BD> 45
    BD> ==32503==    at 0x40046EE: malloc (vg_replace_malloc.c:149)
    BD> ==32503==    by 0x4005B9A: realloc (vg_replace_malloc.c:306)
    BD> ==32503==    by 0x80A5F92: parse_expression (regex.c:5202)
    BD> ==32503==    by 0x80A614F: parse_branch (regex.c:4707)
    BD> ==32503==    by 0x80A621A: parse_reg_exp (regex.c:4666)
    BD> ==32503==    by 0x80A6618: Rf_regcomp (regex.c:4635)
    BD> ==32503==    by 0x8110CB4: do_gsub (character.c:1355)
    BD> ==32503==    by 0x80654A4: do_internal (names.c:1135)
    BD> ==32503==    by 0x815F0EB: Rf_eval (eval.c:461)
    BD> ==32503==    by 0x8160DA7: do_begin (eval.c:1174)
    BD> ==32503==    by 0x815F0EB: Rf_eval (eval.c:461)
    BD> ==32503==    by 0x8162210: Rf_applyClosure (eval.c:667)

    BD> The leaked blocks are allocated in iinternal_function build_range_exp() at
    BD> 5200             /* Use realloc since mbcset->range_starts and mbcset-> range_ends
    BD> 5201                are NULL if *range_alloc == 0.  */
    BD> 5202             new_array_start = re_realloc (mbcset->range_starts,
    BD> wchar_t,
    BD> 5203                                           new_nranges);
    BD> 5204             new_array_end = re_realloc (mbcset->range_ends, wchar_t,
    BD> 5205                                         new_nranges);
    BD> ...
    BD> 5210             mbcset->range_starts = new_array_start;
    BD> 5211             mbcset->range_ends = new_array_end;

    BD> This file, src/main/regex.c, contains a complicated mess of #ifdef's

((note that these were not

    BD> but range_starts and range_ends are defined and appear to be used
    BD> whether or not _LIBC is defined.  However, they are only freed if _LIBC
    BD> is defined.  In my setup (Linux, gcc 3.4.5) _LIBC is not defined so
    BD> they don't get freed.

Ok; this all makes sense; I've seen the same in the source

Interestingly, my newer setup (Linux, gcc 4.2.x ...) does not show the
memory leak; I've not checked if it's because _LIBC is defined
or for another reason.

I'm applying your patch ---  thank you, Bill.
Martin

    BD> After the following change in free_charset() only the 85 byte/4 block
    BD> leak in readline remains.

    BD> Index: regex.c
    BD> ===================================================================
    BD> --- regex.c     (revision 46046)
    BD> +++ regex.c     (working copy)
    BD> @@ -6240,9 +6240,9 @@
    BD> # ifdef _LIBC
    BD> re_free (cset->coll_syms);
    BD> re_free (cset->equiv_classes);
    BD> +# endif
    BD> re_free (cset->range_starts);
    BD> re_free (cset->range_ends);
    BD> -# endif
    BD> re_free (cset->char_classes);
    BD> re_free (cset);
    BD> }

    BD> [This report may be a duplicate: I tried submitting it via the form in
    BD> http://bugs.r-project.org/cgi-bin/R, but I cannot find it there now.]

neither do I.
The machine running the repository had a (announce by Peter
Dalgaard) downtime a couple of days ago, so this may be related.


    BD> ----------------------------------------------------------------------------
    BD> Bill Dunlap
    BD> Insightful Corporation
    BD> bill at insightful dot com


From maechler at stat.math.ethz.ch  Tue Jul 15 14:21:41 2008
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Tue, 15 Jul 2008 14:21:41 +0200
Subject: [Rd] memory leak in readline code
In-Reply-To: <Pine.GSO.4.56.0807101311230.21146@devsun3201.insightful.com>
References: <Pine.GSO.4.56.0807101311230.21146@devsun3201.insightful.com>
Message-ID: <18556.38485.764402.749472@stat.math.ethz.ch>

>>>>> "BD" == Bill Dunlap <bill at insightful.com>
>>>>>     on Thu, 10 Jul 2008 13:17:03 -0700 (PDT) writes:

    BD> Several folks have previously written that valgrind
    BD> notices a memory leak in R's readline code.  It looks
    BD> like it leaks a copy of every input line.

[............]

Thanks a lot, Bill.

As typically, you are perfectly right, AFAICS,
and I have committed the patch.

Best regards,
Martin


From cgenolin at u-paris10.fr  Tue Jul 15 19:33:33 2008
From: cgenolin at u-paris10.fr (cgenolin at u-paris10.fr)
Date: Tue, 15 Jul 2008 19:33:33 +0200
Subject: [Rd] package.skeleton does invalide regular name...
Message-ID: <20080715193333.7bc7tlovsw0gg0kg@icare.u-paris10.fr>

Hi the list,

I am using package.skeleton on a file that has a very classic name, but 
package.skeleton detect it as a invalid name :

--- 8< -------
package.skeleton(name="packClassicBis",code_files="./packClassic/R/progClassic.R")

Cr?ation des r?pertoires...
Cr?ation de DESCRIPTION...
Cr?ation de 'Read-and-delete-me'...
Recopiage des fichiers de code...
Cr?ation des fichiers d'aide ...
Termin?.
Les ?tapes suivantes sont d?crites dans './packClassic4/Read-and-delete-me'.
Warning message:
In package.skeleton(name = "packClassic4", code_files = 
"./packClassic/R/progClassic.R") :
  Nom(s) de fichier(s) invalide(s) pour du code R ./packClassic4/R:
  'progClassic.R'
sont maintenant renomm?s vers 'z<nom>.R'
--- 8< -------

It create the file "zprogClassic.R" in directorie "packClassicBis\R"
Is there something wrong in my code or is it a bug in package.skeleton ?

Christophe


From murdoch at stats.uwo.ca  Tue Jul 15 20:04:22 2008
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Tue, 15 Jul 2008 14:04:22 -0400
Subject: [Rd] package.skeleton does invalide regular name...
In-Reply-To: <20080715193333.7bc7tlovsw0gg0kg@icare.u-paris10.fr>
References: <20080715193333.7bc7tlovsw0gg0kg@icare.u-paris10.fr>
Message-ID: <487CE6A6.3000209@stats.uwo.ca>

On 7/15/2008 1:33 PM, cgenolin at u-paris10.fr wrote:
> Hi the list,
> 
> I am using package.skeleton on a file that has a very classic name, but 
> package.skeleton detect it as a invalid name :
> 
> --- 8< -------
> package.skeleton(name="packClassicBis",code_files="./packClassic/R/progClassic.R")
> 
> Cr?ation des r?pertoires...
> Cr?ation de DESCRIPTION...
> Cr?ation de 'Read-and-delete-me'...
> Recopiage des fichiers de code...
> Cr?ation des fichiers d'aide ...
> Termin?.
> Les ?tapes suivantes sont d?crites dans './packClassic4/Read-and-delete-me'.
> Warning message:
> In package.skeleton(name = "packClassic4", code_files = 
> "./packClassic/R/progClassic.R") :
>   Nom(s) de fichier(s) invalide(s) pour du code R ./packClassic4/R:
>   'progClassic.R'
> sont maintenant renomm?s vers 'z<nom>.R'
> --- 8< -------
> 
> It create the file "zprogClassic.R" in directorie "packClassicBis\R"
> Is there something wrong in my code or is it a bug in package.skeleton ?


I think you're right, it's a bug.  package.skeleton assumes that 
code_files lists files in the current directory, and will give that 
warning if they are given with qualified paths.

It should be easy to fix; I'll take a look.  Thanks for the report.

Duncan Murdoch


From khansen at stat.Berkeley.EDU  Tue Jul 15 20:11:44 2008
From: khansen at stat.Berkeley.EDU (Kasper Daniel Hansen)
Date: Tue, 15 Jul 2008 11:11:44 -0700
Subject: [Rd] methods/namespaces/possible bug
Message-ID: <8B255C3E-603A-4FA9-9E11-42C2A1E34C92@stat.berkeley.edu>

Using

 > methods("plot")
  [1] plot.Date*          plot.HoltWinters*   plot.POSIXct*
  [4] plot.POSIXlt*       plot.TukeyHSD       plot.acf*
  [7] plot.data.frame*    plot.decomposed.ts* plot.default
[10] plot.dendrogram*    plot.density        plot.ecdf
[13] plot.factor*        plot.formula*       plot.hclust*
[16] plot.histogram*     plot.isoreg*        plot.lm
[19] plot.medpolish*     plot.mlm            plot.ppr*
[22] plot.prcomp*        plot.princomp*      plot.profile.nls*
[25] plot.spec           plot.spec.coherency plot.spec.phase
[28] plot.stepfun        plot.stl*           plot.table*
[31] plot.ts             plot.tskernel*

    Non-visible functions are asterisked

I don't see plot.function listed. As I read the man page for methods I  
would say that the search is just looking for functions with the right  
type of name.

If I define a plot.function in my global workspace, methods("plot")  
picks it up

 > plot.function = function() {print("blah")}
 > methods("plot")
  [1] plot.Date*          plot.HoltWinters*   plot.POSIXct*
  [4] plot.POSIXlt*       plot.TukeyHSD       plot.acf*
  [7] plot.data.frame*    plot.decomposed.ts* plot.default
[10] plot.dendrogram*    plot.density        plot.ecdf
[13] plot.factor*        plot.formula*       plot.function
[16] plot.hclust*        plot.histogram*     plot.isoreg*
[19] plot.lm             plot.medpolish*     plot.mlm
[22] plot.ppr*           plot.prcomp*        plot.princomp*
[25] plot.profile.nls*   plot.spec           plot.spec.coherency
[28] plot.spec.phase     plot.stepfun        plot.stl*
[31] plot.table*         plot.ts             plot.tskernel*

    Non-visible functions are asterisked

Based on this, I think that methods("plot") should return  
plot.function, so I am almost ready to take the bug word in my mouth.

When I debug the methods function it gets to the line
   S3reg <- ls(get(".__S3MethodsTable__.", envir = defenv), pattern =  
name)
where it searches the .__S3MethodsTable__. object. Consulting the help  
page it seems that this object is part of the namespace functionality.

My guess is that something goes wrong because function is a reserved  
word?

Kasper

This has been tested under R-2.7.1 on Mac OS X and under a not too  
recent version of R-devel under x86_64. My sessionInfo for the Mac  
version is

 > sessionInfo()
R version 2.7.1 (2008-06-23)
i386-apple-darwin8.10.1

locale:
en_US.UTF-8/en_US.UTF-8/C/C/en_US.UTF-8/en_US.UTF-8

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

loaded via a namespace (and not attached):
[1] tools_2.7.1


From murdoch at stats.uwo.ca  Tue Jul 15 21:00:57 2008
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Tue, 15 Jul 2008 15:00:57 -0400
Subject: [Rd] methods/namespaces/possible bug
In-Reply-To: <8B255C3E-603A-4FA9-9E11-42C2A1E34C92@stat.berkeley.edu>
References: <8B255C3E-603A-4FA9-9E11-42C2A1E34C92@stat.berkeley.edu>
Message-ID: <487CF3E9.9040509@stats.uwo.ca>

On 7/15/2008 2:11 PM, Kasper Daniel Hansen wrote:
> Using
> 
>  > methods("plot")
>   [1] plot.Date*          plot.HoltWinters*   plot.POSIXct*
>   [4] plot.POSIXlt*       plot.TukeyHSD       plot.acf*
>   [7] plot.data.frame*    plot.decomposed.ts* plot.default
> [10] plot.dendrogram*    plot.density        plot.ecdf
> [13] plot.factor*        plot.formula*       plot.hclust*
> [16] plot.histogram*     plot.isoreg*        plot.lm
> [19] plot.medpolish*     plot.mlm            plot.ppr*
> [22] plot.prcomp*        plot.princomp*      plot.profile.nls*
> [25] plot.spec           plot.spec.coherency plot.spec.phase
> [28] plot.stepfun        plot.stl*           plot.table*
> [31] plot.ts             plot.tskernel*
> 
>     Non-visible functions are asterisked
> 
> I don't see plot.function listed. As I read the man page for methods I  
> would say that the search is just looking for functions with the right  
> type of name.

In a package with a NAMESPACE (like the graphics package, where 
plot.function lives), a function needs to be declared to be an S3method 
to show up in this list.  plot.function is not declared as an S3 method.

I don't know the reason for this, but I assume it's intentional:  take a 
look at the plot() generic:  it has special case code to handle functions.

So if this is a bug, I think it's a documentation bug in the 
?plot.function man page, where plot.function should be documented to act 
a lot like an S3 method, but not identically like one:  notice the 
special handling of the y axis label.


> If I define a plot.function in my global workspace, methods("plot")  
> picks it up
> 
>  > plot.function = function() {print("blah")}
>  > methods("plot")
>   [1] plot.Date*          plot.HoltWinters*   plot.POSIXct*
>   [4] plot.POSIXlt*       plot.TukeyHSD       plot.acf*
>   [7] plot.data.frame*    plot.decomposed.ts* plot.default
> [10] plot.dendrogram*    plot.density        plot.ecdf
> [13] plot.factor*        plot.formula*       plot.function
> [16] plot.hclust*        plot.histogram*     plot.isoreg*
> [19] plot.lm             plot.medpolish*     plot.mlm
> [22] plot.ppr*           plot.prcomp*        plot.princomp*
> [25] plot.profile.nls*   plot.spec           plot.spec.coherency
> [28] plot.spec.phase     plot.stepfun        plot.stl*
> [31] plot.table*         plot.ts             plot.tskernel*


Functions declared in the global workspace are handled by patterns on 
the name, since you can't declare things there:  there's no NAMESPACE file.

>     Non-visible functions are asterisked
> 
> Based on this, I think that methods("plot") should return  
> plot.function, so I am almost ready to take the bug word in my mouth.
> 
> When I debug the methods function it gets to the line
>    S3reg <- ls(get(".__S3MethodsTable__.", envir = defenv), pattern =  
> name)
> where it searches the .__S3MethodsTable__. object. Consulting the help  
> page it seems that this object is part of the namespace functionality.
> 
> My guess is that something goes wrong because function is a reserved  
> word?

I don't think so.

Duncan Murdoch
	
> 
> Kasper
> 
> This has been tested under R-2.7.1 on Mac OS X and under a not too  
> recent version of R-devel under x86_64. My sessionInfo for the Mac  
> version is
> 
>  > sessionInfo()
> R version 2.7.1 (2008-06-23)
> i386-apple-darwin8.10.1
> 
> locale:
> en_US.UTF-8/en_US.UTF-8/C/C/en_US.UTF-8/en_US.UTF-8
> 
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
> 
> loaded via a namespace (and not attached):
> [1] tools_2.7.1
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From cgenolin at u-paris10.fr  Tue Jul 15 22:20:37 2008
From: cgenolin at u-paris10.fr (Christophe Genolini)
Date: Tue, 15 Jul 2008 22:20:37 +0200
Subject: [Rd] package.skeleton does invalide regular name...
In-Reply-To: <487CE6A6.3000209@stats.uwo.ca>
References: <20080715193333.7bc7tlovsw0gg0kg@icare.u-paris10.fr>
	<487CE6A6.3000209@stats.uwo.ca>
Message-ID: <487D0695.8010408@u-paris10.fr>

By the way, will it be a big change to allow the user to give the name 
of a directories instead of a file ? The following code :
code_file=c("dir1\file1.r","dir1\file2.r","dir1\file3.r")

willl become :

code_file=c("dir1\")

Then, reconizing that dir1\ is a directories, skeleton.package will 
include all the file that are in the directorie ?

Christophe


> On 7/15/2008 1:33 PM, cgenolin at u-paris10.fr wrote:
>> Hi the list,
>>
>> I am using package.skeleton on a file that has a very classic name, 
>> but package.skeleton detect it as a invalid name :
>>
>> --- 8< -------
>> package.skeleton(name="packClassicBis",code_files="./packClassic/R/progClassic.R") 
>>
>>
>> Cr?ation des r?pertoires...
>> Cr?ation de DESCRIPTION...
>> Cr?ation de 'Read-and-delete-me'...
>> Recopiage des fichiers de code...
>> Cr?ation des fichiers d'aide ...
>> Termin?.
>> Les ?tapes suivantes sont d?crites dans 
>> './packClassic4/Read-and-delete-me'.
>> Warning message:
>> In package.skeleton(name = "packClassic4", code_files = 
>> "./packClassic/R/progClassic.R") :
>>   Nom(s) de fichier(s) invalide(s) pour du code R ./packClassic4/R:
>>   'progClassic.R'
>> sont maintenant renomm?s vers 'z<nom>.R'
>> --- 8< -------
>>
>> It create the file "zprogClassic.R" in directorie "packClassicBis\R"
>> Is there something wrong in my code or is it a bug in package.skeleton ?
>
>
> I think you're right, it's a bug.  package.skeleton assumes that 
> code_files lists files in the current directory, and will give that 
> warning if they are given with qualified paths.
>
> It should be easy to fix; I'll take a look.  Thanks for the report.
>
> Duncan Murdoch
>


From khansen at stat.Berkeley.EDU  Tue Jul 15 23:19:56 2008
From: khansen at stat.Berkeley.EDU (Kasper Daniel Hansen)
Date: Tue, 15 Jul 2008 14:19:56 -0700
Subject: [Rd] methods/namespaces/possible bug
In-Reply-To: <487CF3E9.9040509@stats.uwo.ca>
References: <8B255C3E-603A-4FA9-9E11-42C2A1E34C92@stat.berkeley.edu>
	<487CF3E9.9040509@stats.uwo.ca>
Message-ID: <62F508AB-D65B-49C0-ACB9-24A8F0D4097A@stat.Berkeley.EDU>


On Jul 15, 2008, at 12:00 PM, Duncan Murdoch wrote:

> On 7/15/2008 2:11 PM, Kasper Daniel Hansen wrote:
>> Using
>> > methods("plot")
>>  [1] plot.Date*          plot.HoltWinters*   plot.POSIXct*
>>  [4] plot.POSIXlt*       plot.TukeyHSD       plot.acf*
>>  [7] plot.data.frame*    plot.decomposed.ts* plot.default
>> [10] plot.dendrogram*    plot.density        plot.ecdf
>> [13] plot.factor*        plot.formula*       plot.hclust*
>> [16] plot.histogram*     plot.isoreg*        plot.lm
>> [19] plot.medpolish*     plot.mlm            plot.ppr*
>> [22] plot.prcomp*        plot.princomp*      plot.profile.nls*
>> [25] plot.spec           plot.spec.coherency plot.spec.phase
>> [28] plot.stepfun        plot.stl*           plot.table*
>> [31] plot.ts             plot.tskernel*
>>    Non-visible functions are asterisked
>> I don't see plot.function listed. As I read the man page for  
>> methods I  would say that the search is just looking for functions  
>> with the right  type of name.
>
> In a package with a NAMESPACE (like the graphics package, where  
> plot.function lives), a function needs to be declared to be an  
> S3method to show up in this list.  plot.function is not declared as  
> an S3 method.
>
> I don't know the reason for this, but I assume it's intentional:   
> take a look at the plot() generic:  it has special case code to  
> handle functions.

Let me just state that if I do

plot(sin)

plot.function gets called. This looks to me (as a somewhat experienced  
R user) as a clear case of method dispatching. I call something that I  
think most of us think of as a generic, with a function argument and I  
cannot see that possibility when I do a methods("plot"). This use case  
is not entirely far out - I have just been teaching and wanted to show  
how I could see what happened when I called plot on sin and lo and  
behold, plot.function is not in the list of methods("plot")

I can see that there is special code in plot for handling dispatching  
on a function. I can see that is it handled differently (ie. not with  
a call to UseMethod) but from my point of view, the call
   plot(sin)
looks and feels like methods dispatching. I would say plot is a generic.

Finally the help page for plot.function states
## S3 method for class 'function':
      plot(x, y = 0, to = 1, from = y, xlim = NULL, ...)

So I think something should be cleaned up here.

Kasper

> So if this is a bug, I think it's a documentation bug in the ? 
> plot.function man page, where plot.function should be documented to  
> act a lot like an S3 method, but not identically like one:  notice  
> the special handling of the y axis label.
>
>
>> If I define a plot.function in my global workspace,  
>> methods("plot")  picks it up
>> > plot.function = function() {print("blah")}
>> > methods("plot")
>>  [1] plot.Date*          plot.HoltWinters*   plot.POSIXct*
>>  [4] plot.POSIXlt*       plot.TukeyHSD       plot.acf*
>>  [7] plot.data.frame*    plot.decomposed.ts* plot.default
>> [10] plot.dendrogram*    plot.density        plot.ecdf
>> [13] plot.factor*        plot.formula*       plot.function
>> [16] plot.hclust*        plot.histogram*     plot.isoreg*
>> [19] plot.lm             plot.medpolish*     plot.mlm
>> [22] plot.ppr*           plot.prcomp*        plot.princomp*
>> [25] plot.profile.nls*   plot.spec           plot.spec.coherency
>> [28] plot.spec.phase     plot.stepfun        plot.stl*
>> [31] plot.table*         plot.ts             plot.tskernel*
>
>
> Functions declared in the global workspace are handled by patterns  
> on the name, since you can't declare things there:  there's no  
> NAMESPACE file.
>
>>    Non-visible functions are asterisked
>> Based on this, I think that methods("plot") should return   
>> plot.function, so I am almost ready to take the bug word in my mouth.
>> When I debug the methods function it gets to the line
>>   S3reg <- ls(get(".__S3MethodsTable__.", envir = defenv), pattern  
>> =  name)
>> where it searches the .__S3MethodsTable__. object. Consulting the  
>> help  page it seems that this object is part of the namespace  
>> functionality.
>> My guess is that something goes wrong because function is a  
>> reserved  word?
>
> I don't think so.
>
> Duncan Murdoch
> 	
>> Kasper
>> This has been tested under R-2.7.1 on Mac OS X and under a not too   
>> recent version of R-devel under x86_64. My sessionInfo for the Mac   
>> version is
>> > sessionInfo()
>> R version 2.7.1 (2008-06-23)
>> i386-apple-darwin8.10.1
>> locale:
>> en_US.UTF-8/en_US.UTF-8/C/C/en_US.UTF-8/en_US.UTF-8
>> attached base packages:
>> [1] stats     graphics  grDevices utils     datasets  methods   base
>> loaded via a namespace (and not attached):
>> [1] tools_2.7.1
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel


From kurt.van.dijck at skynet.be  Tue Jul 15 23:56:50 2008
From: kurt.van.dijck at skynet.be (Kurt Van Dijck)
Date: Tue, 15 Jul 2008 23:56:50 +0200
Subject: [Rd] spss long labels
In-Reply-To: <alpine.LFD.1.10.0807150926110.6110@gannet.stats.ox.ac.uk>
References: <486B35A8.5000700@skynet.be> <48747153.7080803@skynet.be>
	<18556.21468.48751.243985@stat.math.ethz.ch>
	<alpine.LFD.1.10.0807150926110.6110@gannet.stats.ox.ac.uk>
Message-ID: <20080715215650.GA943@e-circ.dyndns.org>

On Tue, Jul 15, 2008 at 09:29:22AM +0100, Prof Brian Ripley wrote:
> On Tue, 15 Jul 2008, Martin Maechler wrote:
> 
> >Hi Kurt,
> >
> >>>>>>"KVD" == Kurt Van Dijck <kurt.van.dijck at skynet.be>
> >>>>>>    on Wed, 09 Jul 2008 10:05:39 +0200 writes:
> >
> >   KVD> Hi all, I got no feedback at all concerning the merge
> >   KVD> of this patch in the source tree.  Am I supposed to do
> >   KVD> this myself? How should I do this (do I have subversion
> >   KVD> commit access)? Is this patch acceptable at all? Is it
> >   KVD> being tested?
> >
> >I don't know if it's being tested.
> >It's vacation and traveling time, also for the R core team.
> 
> Indeed.  This is on my TODO list, but I've been away (and unexpectedly 
> mainly offline) for the last two weeks, and will be again until Friday.
> 
> Hopefully I will have a chance to take a look next week, but we do need 
> at least one example file.  (I could generate SPSS examples, but they may 
> not be what you are trying to test.)
> 
> >
> >The foreign package source is kept in svn-archive
> > https://svn.r-project.org/R-packages/trunk/foreign/
> >
> >and I have tried to apply your patch (from July 2) to the
> >sources but
> >
> >   patch -p0 < K_Van_Dijck_patch
> >
> >   patching file src/sfm-read.c
> >   Hunk #1 FAILED at 188.
> >   Hunk #2 FAILED at 420.
> >   Hunk #3 FAILED at 590.
> >   Hunk #4 FAILED at 1559.
> >   4 out of 4 hunks FAILED -- saving rejects to file src/sfm-read.c.rej
> >   patching file src/var.h.in
> >   Hunk #1 FAILED at 41.
> >   Hunk #2 FAILED at 232.
> >   Hunk #3 FAILED at 306.
> >   Hunk #4 FAILED at 377.
> >   4 out of 4 hunks FAILED -- saving rejects to file src/var.h.in.rej
> >
> >
> >Could you provide a patch against the development code from the
> >above url ?
> >(after installing 'subversion', you get the development directory by
> >  svn co https://svn.r-project.org/R-packages/trunk/foreign/
> >)
I had problems with whitespace in the patch file,
I attached a new one
> >   KVD> I got some personal reactions on my post, proving there
> >   KVD> is general interest in getting rid of the inconvenience
> >   KVD> of importing long labels from SPSS files.
> >
> >My problem is that I cannot do much testing apart from the tests
> >already present in foreign/tests/spss.R
> >
> >Could you provide a new small *.sav file and a corresponding
> >read.spss() call which exhibits the
> >problems and is fixed by your patch?
> >
> >Thank you in advance for your contribution!
> >Best regards,
> >
I ran the spss.R in tests/, it worked fine. Be sure to clean all object
files before compiling.

Ilse made me a test .sav file (attached) with 2 variables (varialbe1 &
      variable2), 3 records.
This piece of R code shows the problem:

# to resolve locale problem
Sys.setlocale (locale="C");
# read spss datafile
library(foreign);
data = read.spss("spss_long.sav", to.data.frame=TRUE);
# to.data.frame not necessary, but gives nicer output
# commands to show the data, the variable names and labels
data;
names(data);
attr(data, "variable.labels");

# result in unpatched version:
# both variable names are in shortened form 
# (max 8 characters; provided in SPSS-file)

#> data;
#  VARIABLE V2_A
#1        1    1
#2        2    1
#3        2    3
#
#> names(data);
#[1] "VARIABLE" "V2_A"    
#
#> attr(data,"variable.labels");
#   VARIABLE        V2_A 
#"variable1" "variable2" 

# and in patched version:
# variable names are the full names as originally defined in the SPSS-file

#> data;
#  variable1 variable2
#1         1         1
#2         2         1
#3         2         3
#> names(data);
#[1] "variable1" "variable2"
#> attr(data, "variable.labels");
#  variable1   variable2 
#"variable1" "variable2" 

Kind regards,
Kurt & Ilse

Index: src/sfm-read.c
===================================================================
--- src/sfm-read.c	(revision 5175)
+++ src/sfm-read.c	(working copy)
@@ -188,6 +188,8 @@
 static int read_variables (struct file_handle * h, struct variable *** var_by_index);
 static int read_machine_int32_info (struct file_handle * h, int size, int count, int *encoding);
 static int read_machine_flt64_info (struct file_handle * h, int size, int count);
+static int read_long_var_names (struct file_handle * h, struct dictionary *
+		, unsigned long size, unsigned int count);
 static int read_documents (struct file_handle * h);
 
 /* Displays the message X with corrupt_msg, then jumps to the lossage
@@ -418,11 +420,15 @@
 		break;
 
 	      case 7: /* Multiple-response sets (later versions of SPSS). */
-	      case 13:  /* long variable names. PSPP now has code for these
-			   that could be ported if someone is interested. */
 		skip = 1;
 		break;
 
+	      case 13:	/* long variable names. PSPP now has code for these
+			   that could be ported if someone is interested. */
+		if (!read_long_var_names(h, ext->dict, data.size, data.count))
+		  goto lossage;
+		break;
+
 	      case 16: /* See http://www.nabble.com/problem-loading-SPSS-15.0-save-files-t2726500.html */
 		skip = 1;
 		break;
@@ -584,14 +590,72 @@
   return 0;
 }
 
+/* Read record type 7, subtype 13.
+ * long variable names
+ */
 static int
+read_long_var_names (struct file_handle * h, struct dictionary * dict
+		, unsigned long size, unsigned int count)
+{
+  char * data;
+  unsigned int j;
+  struct variable ** lp;
+  struct variable ** end;
+  char * p;
+  char * endp;
+  char * val;
+  if ((1 != size)||(0 == count)) {
+    warning("%s: strange record info seen, size=%u, count=%u"
+      ", ignoring long variable names"
+      , h->fn, size, count);
+    return 0;
+  }
+  size *= count;
+  data = Calloc (size +1, char);
+  bufread(h, data, size, 0);
+  /* parse */
+  end = &dict->var[dict->nvar];
+  p = data;
+  do {
+    if (0 != (endp = strchr(p, '\t')))
+      *endp = 0; /* put null terminator */
+    if (0 == (val = strchr(p, '='))) {
+      warning("%s: no long variable name for variable '%s'", h->fn, p);
+    } else {
+      *val = 0;
+      ++val;
+      /* now, p is key, val is long name */
+      for (lp = dict->var; lp < end; ++lp) {
+        if (!strcmp(lp[0]->name, p)) {
+          strncpy(lp[0]->name, val, sizeof(lp[0]->name));
+          break;
+        }
+      }
+      if (lp >= end) {
+        warning("%s: long variable name mapping '%s' to '%s'"
+        "for variable which does not exist"
+        , h->fn, p, val);
+      }
+    }
+    p = &endp[1]; /* put to next */
+  } while (endp);
+
+  free(data);
+  return 1;
+
+lossage:
+  free(data);
+  return 0;
+}
+
+static int
 read_header (struct file_handle * h, struct sfm_read_info * inf)
 {
   struct sfm_fhuser_ext *ext = h->ext;	/* File extension strcut. */
   struct sysfile_header hdr;		/* Disk buffer. */
   struct dictionary *dict;		/* File dictionary. */
   char prod_name[sizeof hdr.prod_name + 1];	/* Buffer for product name. */
-  int skip_amt = 0;		        /* Amount of product name to omit. */
+  int skip_amt = 0;			/* Amount of product name to omit. */
   int i;
 
   /* Create the dictionary. */
@@ -1495,7 +1559,7 @@
 /* Reads one case from system file H into the value array PERM
    according to the instructions given in associated dictionary DICT,
    which must have the get.* elements appropriately set.  Returns
-   nonzero only if successful.  */
+   nonzero only if successful.	*/
 int
 sfm_read_case (struct file_handle * h, union value * perm, struct dictionary * dict)
 {
Index: src/var.h.in
===================================================================
--- src/var.h.in	(revision 5175)
+++ src/var.h.in	(working copy)
@@ -41,6 +41,10 @@
 #error MAX_SHORT_STRING must be less than 8.
 #endif
 
+/* VAR_NAME_LEN: the length of a variable.
+ * SPSS supports names of 64 long
+ */
+#define VAR_NAME_LEN 64
 /* Special values. */
 #define SYSMIS (-DBL_MAX)
 #define LOWEST second_lowest_double_val()
@@ -228,7 +232,7 @@
 /* MODIFY VARS private data. */
 struct modify_vars_proc
   {
-    char new_name[9];		/* Variable's new name. */
+    char new_name[VAR_NAME_LEN +1];		/* Variable's new name. */
     int drop_this_var;		/* 0=keep this var, 1=drop this var. */
     struct variable *next;	/* Next in linked list. */
   };
@@ -302,7 +306,7 @@
 struct variable
   {
     /* Required by parse_variables() to be in this order.  */
-    char name[9];		/* As a string. */
+    char name[VAR_NAME_LEN +1];	/* As a string. */
     int index;			/* Index into its dictionary's var[]. */
     int type;			/* NUMERIC or ALPHA. */
     int foo;			/* Used for temporary storage. */
@@ -373,9 +377,9 @@
 
     int weight_index;		/* `value' index of $WEIGHT, or -1 if none.
 				   Call update_weighting() before using! */
-    char weight_var[9];		/* Name of WEIGHT variable. */
+    char weight_var[VAR_NAME_LEN];/* Name of WEIGHT variable. */
 
-    char filter_var[9];		/* Name of FILTER variable. */
+    char filter_var[VAR_NAME_LEN];/* Name of FILTER variable. */
     /* Do not make another field the last field! or see
        temporary.c:restore_dictionary() before doing so! */
   };

From murdoch at stats.uwo.ca  Wed Jul 16 00:49:56 2008
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Tue, 15 Jul 2008 18:49:56 -0400
Subject: [Rd] methods/namespaces/possible bug
In-Reply-To: <62F508AB-D65B-49C0-ACB9-24A8F0D4097A@stat.Berkeley.EDU>
References: <8B255C3E-603A-4FA9-9E11-42C2A1E34C92@stat.berkeley.edu>	<487CF3E9.9040509@stats.uwo.ca>
	<62F508AB-D65B-49C0-ACB9-24A8F0D4097A@stat.Berkeley.EDU>
Message-ID: <487D2994.1050704@stats.uwo.ca>

On 15/07/2008 5:19 PM, Kasper Daniel Hansen wrote:
> On Jul 15, 2008, at 12:00 PM, Duncan Murdoch wrote:
> 
>> On 7/15/2008 2:11 PM, Kasper Daniel Hansen wrote:
>>> Using
>>>> methods("plot")
>>>  [1] plot.Date*          plot.HoltWinters*   plot.POSIXct*
>>>  [4] plot.POSIXlt*       plot.TukeyHSD       plot.acf*
>>>  [7] plot.data.frame*    plot.decomposed.ts* plot.default
>>> [10] plot.dendrogram*    plot.density        plot.ecdf
>>> [13] plot.factor*        plot.formula*       plot.hclust*
>>> [16] plot.histogram*     plot.isoreg*        plot.lm
>>> [19] plot.medpolish*     plot.mlm            plot.ppr*
>>> [22] plot.prcomp*        plot.princomp*      plot.profile.nls*
>>> [25] plot.spec           plot.spec.coherency plot.spec.phase
>>> [28] plot.stepfun        plot.stl*           plot.table*
>>> [31] plot.ts             plot.tskernel*
>>>    Non-visible functions are asterisked
>>> I don't see plot.function listed. As I read the man page for  
>>> methods I  would say that the search is just looking for functions  
>>> with the right  type of name.
>> In a package with a NAMESPACE (like the graphics package, where  
>> plot.function lives), a function needs to be declared to be an  
>> S3method to show up in this list.  plot.function is not declared as  
>> an S3 method.
>>
>> I don't know the reason for this, but I assume it's intentional:   
>> take a look at the plot() generic:  it has special case code to  
>> handle functions.
> 
> Let me just state that if I do
> 
> plot(sin)
> 
> plot.function gets called. This looks to me (as a somewhat experienced  
> R user) as a clear case of method dispatching. I call something that I  
> think most of us think of as a generic, with a function argument and I  
> cannot see that possibility when I do a methods("plot"). This use case  
> is not entirely far out - I have just been teaching and wanted to show  
> how I could see what happened when I called plot on sin and lo and  
> behold, plot.function is not in the list of methods("plot")
> 
> I can see that there is special code in plot for handling dispatching  
> on a function. I can see that is it handled differently (ie. not with  
> a call to UseMethod) but from my point of view, the call
>    plot(sin)
> looks and feels like methods dispatching. I would say plot is a generic.
> 
> Finally the help page for plot.function states
> ## S3 method for class 'function':
>       plot(x, y = 0, to = 1, from = y, xlim = NULL, ...)
> 
> So I think something should be cleaned up here.

I've made attempts in the past to clean this up, and they introduced 
bugs and/or broke traditional behaviour.  See revisions 42827 through 
43202 to src/library/graphics/R/plot.R.  The big problem is that the 
function has traditionally worked in a way that (as far as I know) an S3 
method can't work, but we'd really like to pretend it is one.

Maybe declaring it as an S3method would be fine, but maybe it would have 
weird side effects, since it isn't being called by UseMethod.  Maybe 
changing the man page to state correctly that it's not an S3 method 
would be the best solution, but it acts so much like one that that might 
be misleading.  However, after my last attempt at improvements I'm 
reluctant to touch it again, though I agree it isn't perfect.

Duncan Murdoch

> 
> Kasper
> 
>> So if this is a bug, I think it's a documentation bug in the ? 
>> plot.function man page, where plot.function should be documented to  
>> act a lot like an S3 method, but not identically like one:  notice  
>> the special handling of the y axis label.
>>
>>
>>> If I define a plot.function in my global workspace,  
>>> methods("plot")  picks it up
>>>> plot.function = function() {print("blah")}
>>>> methods("plot")
>>>  [1] plot.Date*          plot.HoltWinters*   plot.POSIXct*
>>>  [4] plot.POSIXlt*       plot.TukeyHSD       plot.acf*
>>>  [7] plot.data.frame*    plot.decomposed.ts* plot.default
>>> [10] plot.dendrogram*    plot.density        plot.ecdf
>>> [13] plot.factor*        plot.formula*       plot.function
>>> [16] plot.hclust*        plot.histogram*     plot.isoreg*
>>> [19] plot.lm             plot.medpolish*     plot.mlm
>>> [22] plot.ppr*           plot.prcomp*        plot.princomp*
>>> [25] plot.profile.nls*   plot.spec           plot.spec.coherency
>>> [28] plot.spec.phase     plot.stepfun        plot.stl*
>>> [31] plot.table*         plot.ts             plot.tskernel*
>>
>> Functions declared in the global workspace are handled by patterns  
>> on the name, since you can't declare things there:  there's no  
>> NAMESPACE file.
>>
>>>    Non-visible functions are asterisked
>>> Based on this, I think that methods("plot") should return   
>>> plot.function, so I am almost ready to take the bug word in my mouth.
>>> When I debug the methods function it gets to the line
>>>   S3reg <- ls(get(".__S3MethodsTable__.", envir = defenv), pattern  
>>> =  name)
>>> where it searches the .__S3MethodsTable__. object. Consulting the  
>>> help  page it seems that this object is part of the namespace  
>>> functionality.
>>> My guess is that something goes wrong because function is a  
>>> reserved  word?
>> I don't think so.
>>
>> Duncan Murdoch
>> 	
>>> Kasper
>>> This has been tested under R-2.7.1 on Mac OS X and under a not too   
>>> recent version of R-devel under x86_64. My sessionInfo for the Mac   
>>> version is
>>>> sessionInfo()
>>> R version 2.7.1 (2008-06-23)
>>> i386-apple-darwin8.10.1
>>> locale:
>>> en_US.UTF-8/en_US.UTF-8/C/C/en_US.UTF-8/en_US.UTF-8
>>> attached base packages:
>>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>> loaded via a namespace (and not attached):
>>> [1] tools_2.7.1
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From arne.henningsen at googlemail.com  Wed Jul 16 12:40:21 2008
From: arne.henningsen at googlemail.com (Arne Henningsen)
Date: Wed, 16 Jul 2008 12:40:21 +0200
Subject: [Rd] Checking package vignettes: WARNING
Message-ID: <200807161240.25451.arne.henningsen@googlemail.com>

Hi,

I want to have a "vignette" in one of my R packages. Hence, I added an Sweave 
file into the /inst/doc subdirectory of this package. Unfortunately, 'R CMD 
check' gives a warning:

==========================================
[...]
* checking tests ... OK
* checking package vignettes in 'inst/doc' ... WARNING
--- f?hre texi2dvi auf Vignetten aus
* creating sampleSelection-manual.tex ... OK
* checking sampleSelection-manual.tex using pdflatex ... OK

WARNING: There was 1 warning, see
  /home/suapm095/Documents/Econometrics/R/micEcon/micEcon/sampleSelection.Rcheck/00check.log
for details
==========================================

Since the line below "WARNING" is in German, I ran 'LC_ALL="C" R CMD check' 
to get an English message (which I could use in a Google search). However, the 
warning does NOT occur if I run 'R CMD check' in the 'C' locale. I tried a 
lot of different things and I figured out that 'f?hre texi2dvi auf Vignetten 
aus' is the translation of 'running texi2dvi on vignettes', but I did not 
find the reason for the warning message that occurs if 'R CMD check' is run 
in the German locale. If I run Sweave and texi2dvi by hand with both locales, 
the only possibly relevant difference I noticed is that Sweave uses straight 
single quotation marks in the 'C' locale but (italicized) primes in the 
German locale:

'C' locale:
   Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 

German locale:
   Signif. codes:  0 ?***? 0.001 ?**? 0.01 ?*? 0.05 ?.? 0.1 ? ? 1 

System Information:
R 2.7.1
i486-pc-linux-gnu
Kubuntu 8.04 

Any hints are welcome!
Thanks,
Arne

-- 
Arne Henningsen
http://www.arne-henningsen.name


From giuseppe1.milicia at hsbcib.com  Wed Jul 16 13:12:41 2008
From: giuseppe1.milicia at hsbcib.com (giuseppe1.milicia at hsbcib.com)
Date: Wed, 16 Jul 2008 12:12:41 +0100
Subject: [Rd] Problems with snowfall
Message-ID: <OFFB9C4A66.8E3BCB22-ON80257488.003D5DEA-80257488.003D961E@hsbcib.com>


Guys,

Is anyone using snowfall? It seems that the last version is broken. sfinit
contains test code:

    data("config", package = "snowfall")
    configM <- as.matrix(t(config))
    config <- as.list(configM)
    names(config) <- dimnames(configM)[[2]]
    .sfOption$SERVER <<- as.character(config[["SERVER"]])
    .sfOption$PORT <<- as.numeric(config[["PORT"]])
    .sfOption$MAXNODES <<- as.numeric(config[["MAXNODES"]])

Which tries to set up the environment with the test data from "config"

On top of that is assumes the existence in the environment of a variable
"sfOption", without that it doesn't get past the first few lines of code...

I wonder if the package is used by anyone around here?

Cheers,

// Giuseppe

************************************************************
HSBC Bank plc may be solicited in the course of its placement efforts for a
new issue, by investment clients of the firm for whom the Bank as a firm
already provides other services. It may equally decide to allocate to its
own proprietary book or with an associate of HSBC Group. This represents a
potential conflict of interest. HSBC Bank plc has internal arrangements
designed to ensure that the firm would give unbiased and full advice to the
corporate finance client about the valuation and pricing of the offering as
well as internal systems, controls and procedures to identify and manage
conflicts of interest.

HSBC Bank plc
Registered Office: 8 Canada Square, London E14 5HQ, United Kingdom
Registered in England - Number 14259
Authorised and regulated by the Financial Services Authority.
************************************************************


-----------------------------------------
SAVE PAPER - THINK BEFORE YOU PRINT!

This transmission has been issued by a member of the HSBC Group
"HSBC" for the information of the addressee only and should not be
reproduced and/or distributed to any other person. Each page
attached hereto must be read in conjunction with any disclaimer
which forms part of it. Unless otherwise stated, this transmission
is neither an offer nor the solicitation of an offer to sell or
purchase any investment. Its contents are based on information
obtained from sources believed to be reliable but HSBC makes no
representation and accepts no responsibility or liability as to its
completeness or accuracy.


From Bernhard_Pfaff at fra.invesco.com  Wed Jul 16 14:16:05 2008
From: Bernhard_Pfaff at fra.invesco.com (Pfaff, Bernhard Dr.)
Date: Wed, 16 Jul 2008 13:16:05 +0100
Subject: [Rd] Checking package vignettes: WARNING
In-Reply-To: <200807161240.25451.arne.henningsen@googlemail.com>
References: <200807161240.25451.arne.henningsen@googlemail.com>
Message-ID: <B89F0CE41D45644A97CCC93DF548C1C3122F8E02@GBHENXMB02.corp.amvescap.net>

Hello Arne,

I do not know if this matters, but have you used 'results = verbatim' in your R code chunk? See page 13 in: http://www.statistik.lmu.de/~leisch/Sweave/Sweave-manual.pdf

Best,
Bernhard

>
>Hi,
>
>I want to have a "vignette" in one of my R packages. Hence, I 
>added an Sweave 
>file into the /inst/doc subdirectory of this package. 
>Unfortunately, 'R CMD 
>check' gives a warning:
>
>==========================================
>[...]
>* checking tests ... OK
>* checking package vignettes in 'inst/doc' ... WARNING
>--- f?hre texi2dvi auf Vignetten aus
>* creating sampleSelection-manual.tex ... OK
>* checking sampleSelection-manual.tex using pdflatex ... OK
>
>WARNING: There was 1 warning, see
>  
>/home/suapm095/Documents/Econometrics/R/micEcon/micEcon/sampleS
>election.Rcheck/00check.log
>for details
>==========================================
>
>Since the line below "WARNING" is in German, I ran 'LC_ALL="C" 
>R CMD check' 
>to get an English message (which I could use in a Google 
>search). However, the 
>warning does NOT occur if I run 'R CMD check' in the 'C' 
>locale. I tried a 
>lot of different things and I figured out that 'f?hre texi2dvi 
>auf Vignetten 
>aus' is the translation of 'running texi2dvi on vignettes', 
>but I did not 
>find the reason for the warning message that occurs if 'R CMD 
>check' is run 
>in the German locale. If I run Sweave and texi2dvi by hand 
>with both locales, 
>the only possibly relevant difference I noticed is that Sweave 
>uses straight 
>single quotation marks in the 'C' locale but (italicized) 
>primes in the 
>German locale:
>
>'C' locale:
>   Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 
>
>German locale:
>   Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 
>
>System Information:
>R 2.7.1
>i486-pc-linux-gnu
>Kubuntu 8.04 
>
>Any hints are welcome!
>Thanks,
>Arne
>
>-- 
>Arne Henningsen
>http://www.arne-henningsen.name
>
>______________________________________________
>R-devel at r-project.org mailing list
>https://stat.ethz.ch/mailman/listinfo/r-devel
>
*****************************************************************
Confidentiality Note: The information contained in this ...{{dropped:10}}


From maechler at stat.math.ethz.ch  Wed Jul 16 14:26:45 2008
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Wed, 16 Jul 2008 14:26:45 +0200
Subject: [Rd] spss long labels
In-Reply-To: <20080715215650.GA943@e-circ.dyndns.org>
References: <486B35A8.5000700@skynet.be> <48747153.7080803@skynet.be>
	<18556.21468.48751.243985@stat.math.ethz.ch>
	<alpine.LFD.1.10.0807150926110.6110@gannet.stats.ox.ac.uk>
	<20080715215650.GA943@e-circ.dyndns.org>
Message-ID: <18557.59653.643247.563508@stat.math.ethz.ch>

Hi Kurt,

I have committed your patch and your new spss_long.sav
example file, tested things and uploaded a new version of
'foreign', namely 0.8-27 to CRAN.

I vaguely remember that other useRs have asked for long-label
support in the past, so if you are (or know of) such a user,
we'd be glad if you'd test the new foreign package, once it will
be available for update.packages().

Martin Maechler


From arne.henningsen at googlemail.com  Wed Jul 16 14:57:39 2008
From: arne.henningsen at googlemail.com (Arne Henningsen)
Date: Wed, 16 Jul 2008 14:57:39 +0200
Subject: [Rd] Checking package vignettes: WARNING
In-Reply-To: <B89F0CE41D45644A97CCC93DF548C1C3122F8E02@GBHENXMB02.corp.amvescap.net>
References: <200807161240.25451.arne.henningsen@googlemail.com>
	<B89F0CE41D45644A97CCC93DF548C1C3122F8E02@GBHENXMB02.corp.amvescap.net>
Message-ID: <200807161457.41593.arne.henningsen@googlemail.com>

Hi Bernhard!

On Wednesday 16 July 2008 14:16:05, you wrote:
> I do not know if this matters, but have you used 'results = verbatim' in
> your R code chunk? See page 13 in:
> http://www.statistik.lmu.de/~leisch/Sweave/Sweave-manual.pdf

Thank you for this hint. I have tried this option, but it seems to have no 
effect on the quotation marks. Hence, I still do not know whether the 
quotation marks or something else causes the warning.

Arne


> >Hi,
> >
> >I want to have a "vignette" in one of my R packages. Hence, I
> >added an Sweave
> >file into the /inst/doc subdirectory of this package.
> >Unfortunately, 'R CMD
> >check' gives a warning:
> >
> >==========================================
> >[...]
> >* checking tests ... OK
> >* checking package vignettes in 'inst/doc' ... WARNING
> >--- f?hre texi2dvi auf Vignetten aus
> >* creating sampleSelection-manual.tex ... OK
> >* checking sampleSelection-manual.tex using pdflatex ... OK
> >
> >WARNING: There was 1 warning, see
> >
> >/home/suapm095/Documents/Econometrics/R/micEcon/micEcon/sampleS
> >election.Rcheck/00check.log
> >for details
> >==========================================
> >
> >Since the line below "WARNING" is in German, I ran 'LC_ALL="C"
> >R CMD check'
> >to get an English message (which I could use in a Google
> >search). However, the
> >warning does NOT occur if I run 'R CMD check' in the 'C'
> >locale. I tried a
> >lot of different things and I figured out that 'f?hre texi2dvi
> >auf Vignetten
> >aus' is the translation of 'running texi2dvi on vignettes',
> >but I did not
> >find the reason for the warning message that occurs if 'R CMD
> >check' is run
> >in the German locale. If I run Sweave and texi2dvi by hand
> >with both locales,
> >the only possibly relevant difference I noticed is that Sweave
> >uses straight
> >single quotation marks in the 'C' locale but (italicized)
> >primes in the
> >German locale:
> >
> >'C' locale:
> >   Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
> >
> >German locale:
> >   Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
> >
> >System Information:
> >R 2.7.1
> >i486-pc-linux-gnu
> >Kubuntu 8.04
> >
> >Any hints are welcome!
> >Thanks,
> >Arne
> >
> >--
> >Arne Henningsen
> >http://www.arne-henningsen.name
> >
> >______________________________________________
> >R-devel at r-project.org mailing list
> >https://stat.ethz.ch/mailman/listinfo/r-devel
>
> *****************************************************************
> Confidentiality Note: The information contained in this message,
> and any attachments, may contain confidential and/or privileged
> material. It is intended solely for the person(s) or entity to
> which it is addressed. Any review, retransmission, dissemination,
> or taking of any action in reliance upon this information by
> persons or entities other than the intended recipient(s) is
> prohibited. If you received this in error, please contact the
> sender and delete the material from any computer.
> *****************************************************************


-- 
Arne Henningsen
http://www.arne-henningsen.name


From lgautier at gmail.com  Wed Jul 16 15:02:44 2008
From: lgautier at gmail.com (Laurent Gautier)
Date: Wed, 16 Jul 2008 15:02:44 +0200
Subject: [Rd] Embedded R, last errormessage, and stack smashing
In-Reply-To: <27d1e6020806300448r10d55c38jd6400c923e5a74cc@mail.gmail.com>
References: <27d1e6020806300448r10d55c38jd6400c923e5a74cc@mail.gmail.com>
Message-ID: <27d1e6020807160602h52fa23a0v6651dad365b5f00b@mail.gmail.com>

The only way to overcome the problem I can find is to tweak the
R_CStackLimit with:

R_CStackLimit = (uintptr_t) -1;

The question I am having now is: what are the implications of doing
so, that is what are the potential problems ?

The R-extensions manual says:
" Stack-checking can be disabled by seting R_CStackLimit =
(uintptr_t)-1, but it is better to
if possible set appropriate values. (What these are and how to
determine them are OS-specific,
and the stack size limit may differ for secondary threads. If you have
a choice of stack size, at
least 8Mb is recommended.)"
I am not very sure of how an appropriate value can be determined.

I looked around, and the JRI (Java/R Interface) is just disabling
stack checking for example.


Thanks,


Laurent


2008/6/30 Laurent Gautier <lgautier at gmail.com>:
> Dear list,
>
> I am having an embedded R, dying with
> *** stack smashing detected *** in one specific case.
>
> My code is such as I evaluate R expression with C code like
>
> res = R_tryEval(expr, env, &error);
>
> and in case of error, get the error message (usually sucessfully) with
> code like below:
>
> SEXP geterrmessage = findVar(install("geterrmessage"), R_BaseNamespace);
> PROTECT(expr = allocVector(LANGSXP, 1));
> SETCAR(expr, geterrmessage);
> PROTECT(res = Rf_eval(expr, R_GlobalEnv));
> // ---> *** stack smashing detected ***
>
> The call to Rf_eval does not return as the stack smashing error stops the show.
>
> Tracing with gdb where the problem occurs, I follow the path:
> eval -> R_CheckStack in main/error.c -> errorcall in main/error.c
>
>
> In errorcall, I narrow down the origin of the problem around the lines:
> 658    va_start(ap, format);
> 659    verrorcall_dflt(call, format, ap);
> 660    va_end(ap);
> and add a breakpoint on each one of those lines.
>
>
> My gdb session till the stack smashing crashing is then looking like:
>
> Breakpoint 7, Rf_errorcall (call=0x828ef8, format=0x7f4dbdc87698 "C
> stack usage is too close to the limit")
>    at errors.c:658
> 658         va_start(ap, format);
> (gdb) p ap
> $2 = {{gp_offset = 16, fp_offset = 48, overflow_arg_area = 0x41c22f60,
> reg_save_area = 0x41c22e70}}
> (gdb) p format
> $3 = 0x7f4dbdc87698 "C stack usage is too close to the limit"
> (gdb) continue
> Continuing.
>
> Breakpoint 8, Rf_errorcall (call=0x828ef8, format=0x7f4dbdc87698 "C
> stack usage is too close to the limit")
>    at errors.c:659
> 659         verrorcall_dflt(call, format, ap);
> (gdb) continue
> Continuing.
>
> Breakpoint 6, Rf_errorcall (call=0x828ef8, format=0x7f4dbdc87406 "%s")
> at errors.c:648
> 648         if (R_ErrorHook != NULL) {
> (gdb) continue
> Continuing.
>
> Breakpoint 7, Rf_errorcall (call=0x828ef8, format=0x7f4dbdc87406 "%s")
> at errors.c:658
> 658         va_start(ap, format);
> (gdb) continue
> Continuing.
>
> Breakpoint 8, Rf_errorcall (call=0x828ef8, format=0x7f4dbdc87406 "%s")
> at errors.c:659
> 659         verrorcall_dflt(call, format, ap);
> (gdb) continue
> Continuing.
> *** stack smashing detected ***: /usr/bin/python terminated
>
>
> My understanding is that there is a C stack problem about to happen R
> tries to report, but in the process of reporting it
> causes a C stack-related crash. Is there something odd with R handling
> the situation, or should I look for the cause
> of the problem elsewhere ?
>
> Thanks,
>
>
> L.
>


From simon.urbanek at r-project.org  Wed Jul 16 15:28:37 2008
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Wed, 16 Jul 2008 09:28:37 -0400
Subject: [Rd] Embedded R, last errormessage, and stack smashing
In-Reply-To: <27d1e6020807160602h52fa23a0v6651dad365b5f00b@mail.gmail.com>
References: <27d1e6020806300448r10d55c38jd6400c923e5a74cc@mail.gmail.com>
	<27d1e6020807160602h52fa23a0v6651dad365b5f00b@mail.gmail.com>
Message-ID: <9FF11130-6E7D-4004-9189-23DFFFD9B07D@r-project.org>

Laurent,

On Jul 16, 2008, at 9:02 AM, Laurent Gautier wrote:

> The only way to overcome the problem I can find is to tweak the
> R_CStackLimit with:
>
> R_CStackLimit = (uintptr_t) -1;
>
> The question I am having now is: what are the implications of doing
> so, that is what are the potential problems ?
>

The implications are that you are disabling stack checks, i.e. R won't  
be able to detect stack overflows.


> The R-extensions manual says: " Stack-checking can be disabled by  
> seting R_CStackLimit = (uintptr_t)-1, but it is better to if  
> possible set appropriate values. (What these are and how to  
> determine them are OS-specific, and the stack size limit may differ  
> for secondary threads. If you have a choice of stack size, at least  
> 8Mb is recommended.)"
> I am not very sure of how an appropriate value can be determined.
>

You can have a look at R sources which do this - the basic idea (if no  
OS-specific method exists) is to fetch an address of a local variable  
which will be on the stack and then add as much space as the size of  
the stack is. On some systems there is an API to find the stack of the  
current thread. However, this works only if you guarantee that you'll  
be calling R from a specific thread (which is generally a good idea,  
though).


> I looked around, and the JRI (Java/R Interface) is just disabling  
> stack checking for example.
>

JRI is quite general and supports different use models - one allows R  
to be called from different threads (with appropriate care and  
synchronization), so it has no choice but to disable the check because  
the stack will change across threads.

Cheers,
Simon


>
>
>
> 2008/6/30 Laurent Gautier <lgautier at gmail.com>:
>> Dear list,
>>
>> I am having an embedded R, dying with
>> *** stack smashing detected *** in one specific case.
>>
>> My code is such as I evaluate R expression with C code like
>>
>> res = R_tryEval(expr, env, &error);
>>
>> and in case of error, get the error message (usually sucessfully)  
>> with
>> code like below:
>>
>> SEXP geterrmessage = findVar(install("geterrmessage"),  
>> R_BaseNamespace);
>> PROTECT(expr = allocVector(LANGSXP, 1));
>> SETCAR(expr, geterrmessage);
>> PROTECT(res = Rf_eval(expr, R_GlobalEnv));
>> // ---> *** stack smashing detected ***
>>
>> The call to Rf_eval does not return as the stack smashing error  
>> stops the show.
>>
>> Tracing with gdb where the problem occurs, I follow the path:
>> eval -> R_CheckStack in main/error.c -> errorcall in main/error.c
>>
>>
>> In errorcall, I narrow down the origin of the problem around the  
>> lines:
>> 658    va_start(ap, format);
>> 659    verrorcall_dflt(call, format, ap);
>> 660    va_end(ap);
>> and add a breakpoint on each one of those lines.
>>
>>
>> My gdb session till the stack smashing crashing is then looking like:
>>
>> Breakpoint 7, Rf_errorcall (call=0x828ef8, format=0x7f4dbdc87698 "C
>> stack usage is too close to the limit")
>>   at errors.c:658
>> 658         va_start(ap, format);
>> (gdb) p ap
>> $2 = {{gp_offset = 16, fp_offset = 48, overflow_arg_area =  
>> 0x41c22f60,
>> reg_save_area = 0x41c22e70}}
>> (gdb) p format
>> $3 = 0x7f4dbdc87698 "C stack usage is too close to the limit"
>> (gdb) continue
>> Continuing.
>>
>> Breakpoint 8, Rf_errorcall (call=0x828ef8, format=0x7f4dbdc87698 "C
>> stack usage is too close to the limit")
>>   at errors.c:659
>> 659         verrorcall_dflt(call, format, ap);
>> (gdb) continue
>> Continuing.
>>
>> Breakpoint 6, Rf_errorcall (call=0x828ef8, format=0x7f4dbdc87406  
>> "%s")
>> at errors.c:648
>> 648         if (R_ErrorHook != NULL) {
>> (gdb) continue
>> Continuing.
>>
>> Breakpoint 7, Rf_errorcall (call=0x828ef8, format=0x7f4dbdc87406  
>> "%s")
>> at errors.c:658
>> 658         va_start(ap, format);
>> (gdb) continue
>> Continuing.
>>
>> Breakpoint 8, Rf_errorcall (call=0x828ef8, format=0x7f4dbdc87406  
>> "%s")
>> at errors.c:659
>> 659         verrorcall_dflt(call, format, ap);
>> (gdb) continue
>> Continuing.
>> *** stack smashing detected ***: /usr/bin/python terminated
>>
>>
>> My understanding is that there is a C stack problem about to happen R
>> tries to report, but in the process of reporting it
>> causes a C stack-related crash. Is there something odd with R  
>> handling
>> the situation, or should I look for the cause
>> of the problem elsewhere ?
>>
>> Thanks,
>>
>>
>> L.
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From giuseppe1.milicia at hsbcib.com  Wed Jul 16 15:52:55 2008
From: giuseppe1.milicia at hsbcib.com (giuseppe1.milicia at hsbcib.com)
Date: Wed, 16 Jul 2008 14:52:55 +0100
Subject: [Rd] Snow or alternative MPI packages on Windows
Message-ID: <OFA70A477E.B2A86968-ON80257488.004B153F-80257488.004C4191@hsbcib.com>


Guys,

I'm running R on both Windows & Linux. I'm looking at a number of packages
for parallel execution. It seems that the most used packages are "snow" and
"Rmpi".

snow seems more user friendly, but it doesn't run on windows. I see from
searching the mailing list that I'm not the first one to try it on Windows.
There was a message that kind of shed some hope on the subject, but nothing
else.

Rmpi works well on windows (with DeinoMPI) but it's kind of low level, so
before I embark in writing code similar to snow to have some high level
constructs I though I'd ask here about other peoples experiences...

Is anyone around here doing parallel R on Windows? If so could you share
your experience?

Cheers,

// Giuseppe

************************************************************
HSBC Bank plc may be solicited in the course of its placement efforts for a
new issue, by investment clients of the firm for whom the Bank as a firm
already provides other services. It may equally decide to allocate to its
own proprietary book or with an associate of HSBC Group. This represents a
potential conflict of interest. HSBC Bank plc has internal arrangements
designed to ensure that the firm would give unbiased and full advice to the
corporate finance client about the valuation and pricing of the offering as
well as internal systems, controls and procedures to identify and manage
conflicts of interest.

HSBC Bank plc
Registered Office: 8 Canada Square, London E14 5HQ, United Kingdom
Registered in England - Number 14259
Authorised and regulated by the Financial Services Authority.
************************************************************


-----------------------------------------
SAVE PAPER - THINK BEFORE YOU PRINT!

This transmission has been issued by a member of the HSBC Group
"HSBC" for the information of the addressee only and should not be
reproduced and/or distributed to any other person. Each page
attached hereto must be read in conjunction with any disclaimer
which forms part of it. Unless otherwise stated, this transmission
is neither an offer nor the solicitation of an offer to sell or
purchase any investment. Its contents are based on information
obtained from sources believed to be reliable but HSBC makes no
representation and accepts no responsibility or liability as to its
completeness or accuracy.


From mtmorgan at fhcrc.org  Wed Jul 16 16:19:36 2008
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Wed, 16 Jul 2008 07:19:36 -0700
Subject: [Rd] Snow or alternative MPI packages on Windows
In-Reply-To: <OFA70A477E.B2A86968-ON80257488.004B153F-80257488.004C4191@hsbcib.com>
	(giuseppe1's message of "Wed, 16 Jul 2008 14:52:55 +0100")
References: <OFA70A477E.B2A86968-ON80257488.004B153F-80257488.004C4191@hsbcib.com>
Message-ID: <6phfxq9ap3b.fsf@lamprey.fhcrc.org>

giuseppe1.milicia at hsbcib.com writes:

> Guys,
>
> I'm running R on both Windows & Linux. I'm looking at a number of packages
> for parallel execution. It seems that the most used packages are "snow" and
> "Rmpi".
>
> snow seems more user friendly, but it doesn't run on windows. I see from
> searching the mailing list that I'm not the first one to try it on Windows.
> There was a message that kind of shed some hope on the subject, but nothing
> else.
>
> Rmpi works well on windows (with DeinoMPI) but it's kind of low level, so
> before I embark in writing code similar to snow to have some high level
> constructs I though I'd ask here about other peoples experiences...

Rmpi has low-level facilities, but things like mpi.spawn.Rslaves,
mpi.parLapply and mpi.bcast.cmd are high-level in the same way that
snow is.

Hopefully others will comment with windows-specific input.

Martin

> Is anyone around here doing parallel R on Windows? If so could you share
> your experience?
>
> Cheers,
>
> // Giuseppe
>
> ************************************************************
> HSBC Bank plc may be solicited in the course of its placement efforts for a
> new issue, by investment clients of the firm for whom the Bank as a firm
> already provides other services. It may equally decide to allocate to its
> own proprietary book or with an associate of HSBC Group. This represents a
> potential conflict of interest. HSBC Bank plc has internal arrangements
> designed to ensure that the firm would give unbiased and full advice to the
> corporate finance client about the valuation and pricing of the offering as
> well as internal systems, controls and procedures to identify and manage
> conflicts of interest.
>
> HSBC Bank plc
> Registered Office: 8 Canada Square, London E14 5HQ, United Kingdom
> Registered in England - Number 14259
> Authorised and regulated by the Financial Services Authority.
> ************************************************************
>
>
> -----------------------------------------
> SAVE PAPER - THINK BEFORE YOU PRINT!
>
> This transmission has been issued by a member of the HSBC Group
> "HSBC" for the information of the addressee only and should not be
> reproduced and/or distributed to any other person. Each page
> attached hereto must be read in conjunction with any disclaimer
> which forms part of it. Unless otherwise stated, this transmission
> is neither an offer nor the solicitation of an offer to sell or
> purchase any investment. Its contents are based on information
> obtained from sources believed to be reliable but HSBC makes no
> representation and accepts no responsibility or liability as to its
> completeness or accuracy.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Martin Morgan
Computational Biology / Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N.
PO Box 19024 Seattle, WA 98109

Location: Arnold Building M2 B169
Phone: (206) 667-2793


From schmidb at ibe.med.uni-muenchen.de  Wed Jul 16 16:44:09 2008
From: schmidb at ibe.med.uni-muenchen.de (Markus Schmidberger)
Date: Wed, 16 Jul 2008 16:44:09 +0200
Subject: [Rd] Snow or alternative MPI packages on Windows
In-Reply-To: <6phfxq9ap3b.fsf@lamprey.fhcrc.org>
References: <OFA70A477E.B2A86968-ON80257488.004B153F-80257488.004C4191@hsbcib.com>
	<6phfxq9ap3b.fsf@lamprey.fhcrc.org>
Message-ID: <487E0939.2000804@ibe.med.uni-muenchen.de>

Hello,

we are using Rmpi and snow on windows. It is working very well.
We are using Windows Server 2003 and *MPICH2.

I probably will manage to have some tests with the new snow 
(*snow_0.3-3)* version this week.

Best
Markus



Martin Morgan schrieb:
> giuseppe1.milicia at hsbcib.com writes:
>
>   
>> Guys,
>>
>> I'm running R on both Windows & Linux. I'm looking at a number of packages
>> for parallel execution. It seems that the most used packages are "snow" and
>> "Rmpi".
>>
>> snow seems more user friendly, but it doesn't run on windows. I see from
>> searching the mailing list that I'm not the first one to try it on Windows.
>> There was a message that kind of shed some hope on the subject, but nothing
>> else.
>>
>> Rmpi works well on windows (with DeinoMPI) but it's kind of low level, so
>> before I embark in writing code similar to snow to have some high level
>> constructs I though I'd ask here about other peoples experiences...
>>     
>
> Rmpi has low-level facilities, but things like mpi.spawn.Rslaves,
> mpi.parLapply and mpi.bcast.cmd are high-level in the same way that
> snow is.
>
> Hopefully others will comment with windows-specific input.
>
> Martin
>
>   
>> Is anyone around here doing parallel R on Windows? If so could you share
>> your experience?
>>
>> Cheers,
>>
>> // Giuseppe
>>
>> ************************************************************
>> HSBC Bank plc may be solicited in the course of its placement efforts for a
>> new issue, by investment clients of the firm for whom the Bank as a firm
>> already provides other services. It may equally decide to allocate to its
>> own proprietary book or with an associate of HSBC Group. This represents a
>> potential conflict of interest. HSBC Bank plc has internal arrangements
>> designed to ensure that the firm would give unbiased and full advice to the
>> corporate finance client about the valuation and pricing of the offering as
>> well as internal systems, controls and procedures to identify and manage
>> conflicts of interest.
>>
>> HSBC Bank plc
>> Registered Office: 8 Canada Square, London E14 5HQ, United Kingdom
>> Registered in England - Number 14259
>> Authorised and regulated by the Financial Services Authority.
>> ************************************************************
>>
>>
>> -----------------------------------------
>> SAVE PAPER - THINK BEFORE YOU PRINT!
>>
>> This transmission has been issued by a member of the HSBC Group
>> "HSBC" for the information of the addressee only and should not be
>> reproduced and/or distributed to any other person. Each page
>> attached hereto must be read in conjunction with any disclaimer
>> which forms part of it. Unless otherwise stated, this transmission
>> is neither an offer nor the solicitation of an offer to sell or
>> purchase any investment. Its contents are based on information
>> obtained from sources believed to be reliable but HSBC makes no
>> representation and accepts no responsibility or liability as to its
>> completeness or accuracy.
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>     
>
>   


-- 
Dipl.-Tech. Math. Markus Schmidberger

Ludwig-Maximilians-Universit?t M?nchen
IBE - Institut f?r medizinische Informationsverarbeitung,
Biometrie und Epidemiologie
Marchioninistr. 15, D-81377 Muenchen
URL: http://ibe.web.med.uni-muenchen.de 
Mail: Markus.Schmidberger [at] ibe.med.uni-muenchen.de
Tel: +49 (089) 7095 - 4599


From pcovariant at googlemail.com  Wed Jul 16 15:33:22 2008
From: pcovariant at googlemail.com (Peter Jaeger)
Date: Wed, 16 Jul 2008 15:33:22 +0200
Subject: [Rd] Rinterfaces.h
Message-ID: <a564fafa0807160633p6021e560g3eef2e500906a105@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20080716/8989348e/attachment.pl>

From jeff.horner at vanderbilt.edu  Wed Jul 16 17:17:41 2008
From: jeff.horner at vanderbilt.edu (Jeffrey Horner)
Date: Wed, 16 Jul 2008 10:17:41 -0500
Subject: [Rd] Embedded R, last errormessage, and stack smashing
In-Reply-To: <27d1e6020807160602h52fa23a0v6651dad365b5f00b@mail.gmail.com>
References: <27d1e6020806300448r10d55c38jd6400c923e5a74cc@mail.gmail.com>
	<27d1e6020807160602h52fa23a0v6651dad365b5f00b@mail.gmail.com>
Message-ID: <487E1115.2020207@vanderbilt.edu>

Laurent Gautier wrote on 07/16/2008 08:02 AM:
> The only way to overcome the problem I can find is to tweak the
> R_CStackLimit with:
> 
> R_CStackLimit = (uintptr_t) -1;
> 
> The question I am having now is: what are the implications of doing
> so, that is what are the potential problems ?

The problem is a program crash without saving data. Stack overflow is 
usually caused by either infinite recursion or very large stack (i.e. 
local) variables.

I've always disabled stack checking in rapache, and I never knew why the 
checking was added to R, but again wikipedia has merit:

http://en.wikipedia.org/wiki/Stack_overflow

Jeff

> 
> The R-extensions manual says:
> " Stack-checking can be disabled by seting R_CStackLimit =
> (uintptr_t)-1, but it is better to
> if possible set appropriate values. (What these are and how to
> determine them are OS-specific,
> and the stack size limit may differ for secondary threads. If you have
> a choice of stack size, at
> least 8Mb is recommended.)"
> I am not very sure of how an appropriate value can be determined.
> 
> I looked around, and the JRI (Java/R Interface) is just disabling
> stack checking for example.
> 
> 
> Thanks,
> 
> 
> Laurent
> 
> 
> 2008/6/30 Laurent Gautier <lgautier at gmail.com>:
>> Dear list,
>>
>> I am having an embedded R, dying with
>> *** stack smashing detected *** in one specific case.
>>
>> My code is such as I evaluate R expression with C code like
>>
>> res = R_tryEval(expr, env, &error);
>>
>> and in case of error, get the error message (usually sucessfully) with
>> code like below:
>>
>> SEXP geterrmessage = findVar(install("geterrmessage"), R_BaseNamespace);
>> PROTECT(expr = allocVector(LANGSXP, 1));
>> SETCAR(expr, geterrmessage);
>> PROTECT(res = Rf_eval(expr, R_GlobalEnv));
>> // ---> *** stack smashing detected ***
>>
>> The call to Rf_eval does not return as the stack smashing error stops the show.
>>
>> Tracing with gdb where the problem occurs, I follow the path:
>> eval -> R_CheckStack in main/error.c -> errorcall in main/error.c
>>
>>
>> In errorcall, I narrow down the origin of the problem around the lines:
>> 658    va_start(ap, format);
>> 659    verrorcall_dflt(call, format, ap);
>> 660    va_end(ap);
>> and add a breakpoint on each one of those lines.
>>
>>
>> My gdb session till the stack smashing crashing is then looking like:
>>
>> Breakpoint 7, Rf_errorcall (call=0x828ef8, format=0x7f4dbdc87698 "C
>> stack usage is too close to the limit")
>>    at errors.c:658
>> 658         va_start(ap, format);
>> (gdb) p ap
>> $2 = {{gp_offset = 16, fp_offset = 48, overflow_arg_area = 0x41c22f60,
>> reg_save_area = 0x41c22e70}}
>> (gdb) p format
>> $3 = 0x7f4dbdc87698 "C stack usage is too close to the limit"
>> (gdb) continue
>> Continuing.
>>
>> Breakpoint 8, Rf_errorcall (call=0x828ef8, format=0x7f4dbdc87698 "C
>> stack usage is too close to the limit")
>>    at errors.c:659
>> 659         verrorcall_dflt(call, format, ap);
>> (gdb) continue
>> Continuing.
>>
>> Breakpoint 6, Rf_errorcall (call=0x828ef8, format=0x7f4dbdc87406 "%s")
>> at errors.c:648
>> 648         if (R_ErrorHook != NULL) {
>> (gdb) continue
>> Continuing.
>>
>> Breakpoint 7, Rf_errorcall (call=0x828ef8, format=0x7f4dbdc87406 "%s")
>> at errors.c:658
>> 658         va_start(ap, format);
>> (gdb) continue
>> Continuing.
>>
>> Breakpoint 8, Rf_errorcall (call=0x828ef8, format=0x7f4dbdc87406 "%s")
>> at errors.c:659
>> 659         verrorcall_dflt(call, format, ap);
>> (gdb) continue
>> Continuing.
>> *** stack smashing detected ***: /usr/bin/python terminated
>>
>>
>> My understanding is that there is a C stack problem about to happen R
>> tries to report, but in the process of reporting it
>> causes a C stack-related crash. Is there something odd with R handling
>> the situation, or should I look for the cause
>> of the problem elsewhere ?
>>
>> Thanks,
>>
>>
>> L.
>>
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


-- 
http://biostat.mc.vanderbilt.edu/JeffreyHorner


From giuseppe1.milicia at hsbcib.com  Wed Jul 16 18:02:43 2008
From: giuseppe1.milicia at hsbcib.com (giuseppe1.milicia at hsbcib.com)
Date: Wed, 16 Jul 2008 17:02:43 +0100
Subject: [Rd] Snow or alternative MPI packages on Windows
In-Reply-To: <487E0939.2000804@ibe.med.uni-muenchen.de>
Message-ID: <OF85847CDD.8CF90524-ON80257488.0056AD7F-80257488.005823B2@hsbcib.com>

Markus,

That's interesting. I'm using snow_0.3-0 that's the version on CRAN. I see
that on the maintainer's website newer versions are available...

I just tried snow_0.3-3 and as you said it actually works fine!

Thanks a lot for the help, that's exactly what I was looking for!

// Giuseppe



                                                                           
             Markus                                                        
             Schmidberger                                                  
             <schmidb at ibe.med.                                          To 
             uni-muenchen.de>          Martin Morgan <mtmorgan at fhcrc.org>, 
                                       Giuseppe1 MILICIA/IBEU/HSBC at HSBC    
             16/07/2008 15:44                                           cc 
             Mail Size: 7121           r-devel at r-project.org               
                                                                   Subject 
             Please respond to         Re: [Rd] Snow or alternative MPI    
             schmidb at ibe.med.u         packages on Windows                 
              ni-muenchen.de                                        Entity 
                                       Investment Banking Europe - IBEU    
                                                                           
                                                                           
                                                                           
                                                                           
                                                                           
                                                                           




Hello,

we are using Rmpi and snow on windows. It is working very well.
We are using Windows Server 2003 and *MPICH2.

I probably will manage to have some tests with the new snow
(*snow_0.3-3)* version this week.

Best
Markus



Martin Morgan schrieb:
> giuseppe1.milicia at hsbcib.com writes:
>
>
>> Guys,
>>
>> I'm running R on both Windows & Linux. I'm looking at a number of
packages
>> for parallel execution. It seems that the most used packages are "snow"
and
>> "Rmpi".
>>
>> snow seems more user friendly, but it doesn't run on windows. I see from
>> searching the mailing list that I'm not the first one to try it on
Windows.
>> There was a message that kind of shed some hope on the subject, but
nothing
>> else.
>>
>> Rmpi works well on windows (with DeinoMPI) but it's kind of low level,
so
>> before I embark in writing code similar to snow to have some high level
>> constructs I though I'd ask here about other peoples experiences...
>>
>
> Rmpi has low-level facilities, but things like mpi.spawn.Rslaves,
> mpi.parLapply and mpi.bcast.cmd are high-level in the same way that
> snow is.
>
> Hopefully others will comment with windows-specific input.
>
> Martin
>
>
>> Is anyone around here doing parallel R on Windows? If so could you share
>> your experience?
>>
>> Cheers,
>>
>> // Giuseppe
>>
>> ************************************************************
>> HSBC Bank plc may be solicited in the course of its placement efforts
for a
>> new issue, by investment clients of the firm for whom the Bank as a firm
>> already provides other services. It may equally decide to allocate to
its
>> own proprietary book or with an associate of HSBC Group. This represents
a
>> potential conflict of interest. HSBC Bank plc has internal arrangements
>> designed to ensure that the firm would give unbiased and full advice to
the
>> corporate finance client about the valuation and pricing of the offering
as
>> well as internal systems, controls and procedures to identify and manage
>> conflicts of interest.
>>
>> HSBC Bank plc
>> Registered Office: 8 Canada Square, London E14 5HQ, United Kingdom
>> Registered in England - Number 14259
>> Authorised and regulated by the Financial Services Authority.
>> ************************************************************
>>
>>
>> -----------------------------------------
>> SAVE PAPER - THINK BEFORE YOU PRINT!
>>
>> This transmission has been issued by a member of the HSBC Group
>> "HSBC" for the information of the addressee only and should not be
>> reproduced and/or distributed to any other person. Each page
>> attached hereto must be read in conjunction with any disclaimer
>> which forms part of it. Unless otherwise stated, this transmission
>> is neither an offer nor the solicitation of an offer to sell or
>> purchase any investment. Its contents are based on information
>> obtained from sources believed to be reliable but HSBC makes no
>> representation and accepts no responsibility or liability as to its
>> completeness or accuracy.
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
>


--
Dipl.-Tech. Math. Markus Schmidberger

Ludwig-Maximilians-Universit?t M?nchen
IBE - Institut f?r medizinische Informationsverarbeitung,
Biometrie und Epidemiologie
Marchioninistr. 15, D-81377 Muenchen
URL: http://ibe.web.med.uni-muenchen.de
Mail: Markus.Schmidberger [at] ibe.med.uni-muenchen.de
Tel: +49 (089) 7095 - 4599





************************************************************
HSBC Bank plc may be solicited in the course of its placement efforts for a
new issue, by investment clients of the firm for whom the Bank as a firm
already provides other services. It may equally decide to allocate to its
own proprietary book or with an associate of HSBC Group. This represents a
potential conflict of interest. HSBC Bank plc has internal arrangements
designed to ensure that the firm would give unbiased and full advice to the
corporate finance client about the valuation and pricing of the offering as
well as internal systems, controls and procedures to identify and manage
conflicts of interest.

HSBC Bank plc
Registered Office: 8 Canada Square, London E14 5HQ, United Kingdom
Registered in England - Number 14259
Authorised and regulated by the Financial Services Authority.
************************************************************


-----------------------------------------
SAVE PAPER - THINK BEFORE YOU PRINT!

This transmission has been issued by a member of the HSBC Group
"HSBC" for the information of the addressee only and should not be
reproduced and/or distributed to any other person. Each page
attached hereto must be read in conjunction with any disclaimer
which forms part of it. Unless otherwise stated, this transmission
is neither an offer nor the solicitation of an offer to sell or
purchase any investment. Its contents are based on information
obtained from sources believed to be reliable but HSBC makes no
representation and accepts no responsibility or liability as to its
completeness or accuracy.


From Kurt.Hornik at wu-wien.ac.at  Wed Jul 16 18:09:46 2008
From: Kurt.Hornik at wu-wien.ac.at (Kurt Hornik)
Date: Wed, 16 Jul 2008 18:09:46 +0200
Subject: [Rd] split.Date
In-Reply-To: <EEBC169715EB8C438D3C9283AF0F201C023E478A@MSGBOSCLM2WIN.DMN1.FMR.COM>
References: <EEBC169715EB8C438D3C9283AF0F201C023E478A@MSGBOSCLM2WIN.DMN1.FMR.COM>
Message-ID: <18558.7498.496938.359401@fangorn.hornik.net>

>>>>> McGehee, Robert writes:

> Hello,
> I wanted to suggest that the below method for split.Date be added to the
> base library to significantly speed up splits with values of class Date.
> In the below example I show a speed improvement of 175x for 1000 data
> points. On a vector of size 1e6, the time difference was 22 minutes for
> split.default versus 0.3 seconds for the split.Date function below (!).
> Note that this improvement will also substantially improve performance
> for the tapply function on class Date as well.

Thanks for the suggestion.  Looks good to me, so I've just added this to
r-devel.

Best
-k

> Thanks,
> Robert

> split.Date <- function(x, f, drop=FALSE) {
>     x <- split.default(as.integer(x), f, drop=drop)
>     for (i in seq(along=x)) class(x[[i]]) <- "Date"
>     x
> }

>> vals <- round(1000*rnorm(1e4))
>> date <- rep(Sys.Date() + -1:1, length.out=1e4)
>> system.time(x1 <- split.default(date, vals))
>    user  system elapsed 
>   7.718   0.042   7.761 
>> system.time(x2 <- split.Date(date, vals))
>    user  system elapsed 
>   0.044   0.000   0.044 
>> all.equal(x1, x2)
> [1] TRUE

> Robert McGehee, CFA
> Geode Capital Management, LLC
> One Post Office Square, 28th Floor | Boston, MA | 02109
> Tel: 617/392-8396    Fax:617/476-6389
> mailto:robert.mcgehee at geodecapital.com



> This e-mail, and any attachments hereto, are intended fo...{{dropped:12}}

> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From friedrich.leisch at stat.uni-muenchen.de  Wed Jul 16 18:28:07 2008
From: friedrich.leisch at stat.uni-muenchen.de (friedrich.leisch at stat.uni-muenchen.de)
Date: Wed, 16 Jul 2008 18:28:07 +0200
Subject: [Rd] Checking package vignettes: WARNING
In-Reply-To: <200807161457.41593.arne.henningsen@googlemail.com>
References: <200807161240.25451.arne.henningsen@googlemail.com>
	<B89F0CE41D45644A97CCC93DF548C1C3122F8E02@GBHENXMB02.corp.amvescap.net>
	<200807161457.41593.arne.henningsen@googlemail.com>
Message-ID: <18558.8599.507088.919786@ridcully.stat.uni-muenchen.de>

>>>>> On Wed, 16 Jul 2008 14:57:39 +0200,
>>>>> Arne Henningsen (AH) wrote:

  > Hi Bernhard!
  > On Wednesday 16 July 2008 14:16:05, you wrote:
  >> I do not know if this matters, but have you used 'results = verbatim' in
  >> your R code chunk? See page 13 in:
  >> http://www.statistik.lmu.de/~leisch/Sweave/Sweave-manual.pdf

  > Thank you for this hint. I have tried this option, but it seems to have no 
  > effect on the quotation marks. Hence, I still do not know whether the 
  > quotation marks or something else causes the warning.


verbatim is the default, so adding changes nothing if you had no
results=xxx before.  

  >> >German locale:
  >> >
  >> >'C' locale:
  >> >   Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
  >> >
  >> >German locale:
  >> >   Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
  >> >
  >> >System Information:
  >> >R 2.7.1
  >> >i486-pc-linux-gnu
  >> >Kubuntu 8.04
  >> >


In whiche locale are you running? On Debian Linux with de_AT.UTF-8
everything is fine for me.

Of course you also need something like

\usepackage[utf8]{inputenc}

to handle the special characters, but you need that anyway because
every textual output of R may contain Umlaute ...

Hth,
Fritz

-- 
-----------------------------------------------------------------------
Prof. Dr. Friedrich Leisch 

Institut f?r Statistik                          Tel: (+49 89) 2180 3165
Ludwig-Maximilians-Universit?t                  Fax: (+49 89) 2180 5308
Ludwigstra?e 33
D-80539 M?nchen                     http://www.statistik.lmu.de/~leisch
-----------------------------------------------------------------------
   Journal Computational Statistics --- http://www.springer.com/180 
          M?nchner R Kurse --- http://www.statistik.lmu.de/R


From lgautier at gmail.com  Wed Jul 16 19:02:51 2008
From: lgautier at gmail.com (Laurent Gautier)
Date: Wed, 16 Jul 2008 19:02:51 +0200
Subject: [Rd] Embedded R, last errormessage, and stack smashing
In-Reply-To: <487E1115.2020207@vanderbilt.edu>
References: <27d1e6020806300448r10d55c38jd6400c923e5a74cc@mail.gmail.com>
	<27d1e6020807160602h52fa23a0v6651dad365b5f00b@mail.gmail.com>
	<487E1115.2020207@vanderbilt.edu>
Message-ID: <27d1e6020807161002q23c3a83ld51dbf6e22df253b@mail.gmail.com>

2008/7/16 Jeffrey Horner <jeff.horner at vanderbilt.edu>:
> Laurent Gautier wrote on 07/16/2008 08:02 AM:
>>
>> The only way to overcome the problem I can find is to tweak the
>> R_CStackLimit with:
>>
>> R_CStackLimit = (uintptr_t) -1;
>>
>> The question I am having now is: what are the implications of doing
>> so, that is what are the potential problems ?
>
> The problem is a program crash without saving data. Stack overflow is
> usually caused by either infinite recursion or very large stack (i.e. local)
> variables.

I think that R limits the number of recursions by checking how nested
an evaluation is.

> I've always disabled stack checking in rapache, and I never knew why the
> checking was added to R, but again wikipedia has merit:
>
> http://en.wikipedia.org/wiki/Stack_overflow
>
> Jeff
>
>>
>> The R-extensions manual says:
>> " Stack-checking can be disabled by seting R_CStackLimit =
>> (uintptr_t)-1, but it is better to
>> if possible set appropriate values. (What these are and how to
>> determine them are OS-specific,
>> and the stack size limit may differ for secondary threads. If you have
>> a choice of stack size, at
>> least 8Mb is recommended.)"
>> I am not very sure of how an appropriate value can be determined.
>>
>> I looked around, and the JRI (Java/R Interface) is just disabling
>> stack checking for example.
>>
>>
>> Thanks,
>>
>>
>> Laurent
>>
>>
>> 2008/6/30 Laurent Gautier <lgautier at gmail.com>:
>>>
>>> Dear list,
>>>
>>> I am having an embedded R, dying with
>>> *** stack smashing detected *** in one specific case.
>>>
>>> My code is such as I evaluate R expression with C code like
>>>
>>> res = R_tryEval(expr, env, &error);
>>>
>>> and in case of error, get the error message (usually sucessfully) with
>>> code like below:
>>>
>>> SEXP geterrmessage = findVar(install("geterrmessage"), R_BaseNamespace);
>>> PROTECT(expr = allocVector(LANGSXP, 1));
>>> SETCAR(expr, geterrmessage);
>>> PROTECT(res = Rf_eval(expr, R_GlobalEnv));
>>> // ---> *** stack smashing detected ***
>>>
>>> The call to Rf_eval does not return as the stack smashing error stops the
>>> show.
>>>
>>> Tracing with gdb where the problem occurs, I follow the path:
>>> eval -> R_CheckStack in main/error.c -> errorcall in main/error.c
>>>
>>>
>>> In errorcall, I narrow down the origin of the problem around the lines:
>>> 658    va_start(ap, format);
>>> 659    verrorcall_dflt(call, format, ap);
>>> 660    va_end(ap);
>>> and add a breakpoint on each one of those lines.
>>>
>>>
>>> My gdb session till the stack smashing crashing is then looking like:
>>>
>>> Breakpoint 7, Rf_errorcall (call=0x828ef8, format=0x7f4dbdc87698 "C
>>> stack usage is too close to the limit")
>>>   at errors.c:658
>>> 658         va_start(ap, format);
>>> (gdb) p ap
>>> $2 = {{gp_offset = 16, fp_offset = 48, overflow_arg_area = 0x41c22f60,
>>> reg_save_area = 0x41c22e70}}
>>> (gdb) p format
>>> $3 = 0x7f4dbdc87698 "C stack usage is too close to the limit"
>>> (gdb) continue
>>> Continuing.
>>>
>>> Breakpoint 8, Rf_errorcall (call=0x828ef8, format=0x7f4dbdc87698 "C
>>> stack usage is too close to the limit")
>>>   at errors.c:659
>>> 659         verrorcall_dflt(call, format, ap);
>>> (gdb) continue
>>> Continuing.
>>>
>>> Breakpoint 6, Rf_errorcall (call=0x828ef8, format=0x7f4dbdc87406 "%s")
>>> at errors.c:648
>>> 648         if (R_ErrorHook != NULL) {
>>> (gdb) continue
>>> Continuing.
>>>
>>> Breakpoint 7, Rf_errorcall (call=0x828ef8, format=0x7f4dbdc87406 "%s")
>>> at errors.c:658
>>> 658         va_start(ap, format);
>>> (gdb) continue
>>> Continuing.
>>>
>>> Breakpoint 8, Rf_errorcall (call=0x828ef8, format=0x7f4dbdc87406 "%s")
>>> at errors.c:659
>>> 659         verrorcall_dflt(call, format, ap);
>>> (gdb) continue
>>> Continuing.
>>> *** stack smashing detected ***: /usr/bin/python terminated
>>>
>>>
>>> My understanding is that there is a C stack problem about to happen R
>>> tries to report, but in the process of reporting it
>>> causes a C stack-related crash. Is there something odd with R handling
>>> the situation, or should I look for the cause
>>> of the problem elsewhere ?
>>>
>>> Thanks,
>>>
>>>
>>> L.
>>>
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>
> --
> http://biostat.mc.vanderbilt.edu/JeffreyHorner
>


From hpages at fhcrc.org  Thu Jul 17 07:48:00 2008
From: hpages at fhcrc.org (Herve Pages)
Date: Wed, 16 Jul 2008 22:48:00 -0700
Subject: [Rd] rowSums()/colSums() don't preserve the 'integer' storage mode
Message-ID: <487EDD10.8020907@fhcrc.org>

Hi,

Wouldn't that make sense to have rowSums()/colSums() to preserve the
storage mode?

m <- matrix(1:15, nrow=5)

 > storage.mode(m)
[1] "integer"

 > storage.mode(sum(m))
[1] "integer"

 > storage.mode(rowSums(m))
[1] "double" <------------------- surprising!

Cheers,
H.


From Bill.Venables at csiro.au  Thu Jul 17 08:57:02 2008
From: Bill.Venables at csiro.au (Bill.Venables at csiro.au)
Date: Thu, 17 Jul 2008 16:57:02 +1000
Subject: [Rd] rowSums()/colSums() don't preserve the 'integer' storage
	mode
References: <487EDD10.8020907@fhcrc.org>
Message-ID: <B998A44C8986644EA8029CFE6396A92401528AD5@exqld2-bne.nexus.csiro.au>

I don't see the cost of doing so paying off.

storage.mode is really only important if you are passing arguments to
compiled code.

If you are passing to compiled code, you really need to ensure the
storage mode is what you think it is, anyway.

Bill Venables.  



-----Original Message-----
From: r-devel-bounces at r-project.org
[mailto:r-devel-bounces at r-project.org] On Behalf Of Herve Pages
Sent: Thursday, 17 July 2008 3:48 PM
To: R-devel at r-project.org
Subject: [Rd] rowSums()/colSums() don't preserve the 'integer' storage
mode

Hi,

Wouldn't that make sense to have rowSums()/colSums() to preserve the
storage mode?

m <- matrix(1:15, nrow=5)

 > storage.mode(m)
[1] "integer"

 > storage.mode(sum(m))
[1] "integer"

 > storage.mode(rowSums(m))
[1] "double" <------------------- surprising!

Cheers,
H.

______________________________________________
R-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-devel


From arthur.allignol at fdm.uni-freiburg.de  Thu Jul 17 10:41:16 2008
From: arthur.allignol at fdm.uni-freiburg.de (Arthur Allignol)
Date: Thu, 17 Jul 2008 10:41:16 +0200
Subject: [Rd] Problems with snowfall
In-Reply-To: <OFFB9C4A66.8E3BCB22-ON80257488.003D5DEA-80257488.003D961E@hsbcib.com>
References: <OFFB9C4A66.8E3BCB22-ON80257488.003D5DEA-80257488.003D961E@hsbcib.com>
Message-ID: <487F05AC.4090809@fdm.uni-freiburg.de>

Hello,

Problem is fixed in version 1.52, which is on CRAN for some days now.
That missing object was saved in an rda file which somehow got lost on
the first release version. Sorry for this.

Best,
Arthur Allignol

giuseppe1.milicia at hsbcib.com wrote:
> Guys,
> 
> Is anyone using snowfall? It seems that the last version is broken. sfinit
> contains test code:
> 
>     data("config", package = "snowfall")
>     configM <- as.matrix(t(config))
>     config <- as.list(configM)
>     names(config) <- dimnames(configM)[[2]]
>     .sfOption$SERVER <<- as.character(config[["SERVER"]])
>     .sfOption$PORT <<- as.numeric(config[["PORT"]])
>     .sfOption$MAXNODES <<- as.numeric(config[["MAXNODES"]])
> 
> Which tries to set up the environment with the test data from "config"
> 
> On top of that is assumes the existence in the environment of a variable
> "sfOption", without that it doesn't get past the first few lines of code...
> 
> I wonder if the package is used by anyone around here?
> 
> Cheers,
> 
> // Giuseppe
> 
> ************************************************************
> HSBC Bank plc may be solicited in the course of its placement efforts for a
> new issue, by investment clients of the firm for whom the Bank as a firm
> already provides other services. It may equally decide to allocate to its
> own proprietary book or with an associate of HSBC Group. This represents a
> potential conflict of interest. HSBC Bank plc has internal arrangements
> designed to ensure that the firm would give unbiased and full advice to the
> corporate finance client about the valuation and pricing of the offering as
> well as internal systems, controls and procedures to identify and manage
> conflicts of interest.
> 
> HSBC Bank plc
> Registered Office: 8 Canada Square, London E14 5HQ, United Kingdom
> Registered in England - Number 14259
> Authorised and regulated by the Financial Services Authority.
> ************************************************************
> 
> 
> -----------------------------------------
> SAVE PAPER - THINK BEFORE YOU PRINT!
> 
> This transmission has been issued by a member of the HSBC Group
> "HSBC" for the information of the addressee only and should not be
> reproduced and/or distributed to any other person. Each page
> attached hereto must be read in conjunction with any disclaimer
> which forms part of it. Unless otherwise stated, this transmission
> is neither an offer nor the solicitation of an offer to sell or
> purchase any investment. Its contents are based on information
> obtained from sources believed to be reliable but HSBC makes no
> representation and accepts no responsibility or liability as to its
> completeness or accuracy.
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From foylong at gmail.com  Thu Jul 17 12:59:45 2008
From: foylong at gmail.com (=?ISO-8859-1?Q?F=E1n_L=F3ng?=)
Date: Thu, 17 Jul 2008 18:59:45 +0800
Subject: [Rd] AIX 5.3 --enable-R-shlib --with-x ---with-iconv make error
	with R-2.7.0 and R-2.7.1
Message-ID: <e936a3d0807170359p62155163oe85a437d91506b98@mail.gmail.com>

Hi guys,

I am trying to compile a 64bit version of R 2.7.0 on AIX 5.3. And I am
running into some troubles.  I also try the latest version 2.7.1 and
get the very similar errors.

The machine info:
-----------------------
$uname -srvp
AIX 3 5 powerpc
----------------------



My configuration is this:

----------------------------------------------------------
./configure \
           CC="xlc_r -q64" \
           CFLAGS="-O -qstrict" \
           CXX="xlC_r -q64" \
           CXXFLAGS="-O -qstrict" \
           F77="xlf_r -q64" \
           AR="ar -X64" \
           CPPFLAGS="-I/my_libiconv_dir/include -I/usr/lpp/X11/include/X11" \
           LDFLAGS="-L/my_libiconv_dir/lib -L/usr/lib -L/usr/X11R6/lib
-L/my_buildR_dir/R-2.7.0/lib" \
           --prefix=/my_R_dir \
           --enable-R-shlib \
           --enable-BLAS-shlib \
           --with-x \
           --with-readline=no \
           --with-libiconv-prefix="/my_libiconv_dir"
------------------------------------------------------------

I don't have the gcc and gfortran installed on the machine, so I use
the native ones. As the manual says, the AIX native iconv does not
support encodings `latin1' nor `""' and so cannot be used. I install
GNU libiconv to my_libiconv_dir follow the steps in
http://prs.ism.ac.jp/~nakama/AIX/AIX_iconv_CookBook.txt. Thanks Ei-ji
Nakama for this CookBook :)


The configuration step ends OK:

-----------------------------------------------------------

R is now configured for powerpc-ibm-aix5.3.0.0

 Source directory:          .
 Installation directory:    /rnd/homes/my/rdir/AIX/R-2.7.0

 C compiler:                xlc_r -q64 -qlanglvl=extc99  -O -qstrict
 Fortran 77 compiler:       xlf_r -q64  -g

 C++ compiler:              xlC_r -q64  -O -qstrict
 Fortran 90/95 compiler:    xlf95 -g
 Obj-C compiler:

 Interfaces supported:      X11
 External libraries:
 Additional capabilities:   iconv, MBCS, NLS
 Options enabled:           shared BLAS, R profiling, Java

 Recommended packages:      yes

configure: WARNING: you cannot build DVI versions of the R manuals
configure: WARNING: you cannot build info or HTML versions of the R manuals
configure: WARNING: you cannot build PDF versions of the R manuals
configure: WARNING: I could not determine a browser
configure: WARNING: I could not determine a PDF viewer

----------------------------------------------------------------


When trying to compile(gmake), I get the following error message.
The first for R-2.7.0 and the second for R-2.7.1.


-------------------------------------------------------------------------
make[3]: Entering directory `/my_buildR_dir/R-2.7.0/src/library/splines'
building package 'splines'
make[4]: Entering directory `/my_buildR_dir/R-2.7.0/src/library/splines/src'
make[5]: Entering directory `/my_buildR_dir/R-2.7.0/src/library/splines/src'
make[5]: `Makedeps' is up to date.
make[5]: Leaving directory `/my_buildR_dir/R-2.7.0/src/library/splines/src'
make[5]: Entering directory `/my_buildR_dir/R-2.7.0/src/library/splines/src'
xlc_r -q64 -qlanglvl=extc99 -I../../../../include
-I/my_libiconv_dir/include -I/usr/lpp/X11/include/X11      -O -qstrict
-c splines.c -o splines.o
xlc_r -q64 -qlanglvl=extc99 -Wl,-brtl -Wl,-G -Wl,-bexpall
-Wl,-bnoentry -lc -L/my_libiconv_dir/lib -L/usr/lib -L/usr/X11R6/lib
-L/my_buildR_dir/R-2.7.0/lib -o splines.so splines.o   -lm
-L../../../../lib -lR
make[5]: Leaving directory `/my_buildR_dir/R-2.7.0/src/library/splines/src'
make[4]: Leaving directory `/my_buildR_dir/R-2.7.0/src/library/splines/src'
Error in dyn.load(file, DLLpath = DLLpath, ...) :
 unable to load shared library
'/my_buildR_dir/R-2.7.0/library/stats/libs/stats.so':
 rtld: 0712-001 Symbol d1mach was referenced
     from module
/my_buildR_dir/R-2.7.0/library/stats/libs/stats.so(), but a runtime
definition
           of the symbol was not found.
rtld: 0712-001 Symbol interv was referenced
     from module
/my_buildR_dir/R-2.7.0/library/stats/libs/stats.so(), but a runtime
definition
           of the symbol was not found.
rtld: 0712-002 fatal error: exiting.
Calls: <Anonymous> ... asNamespace -> loadNamespace -> library.dynam -> dyn.load
Execution halted
make[3]: *** [all] Error 1
make[3]: Leaving directory `/my_buildR_dir/R-2.7.0/src/library/splines'
make[2]: *** [R] Error 1
make[2]: Leaving directory `/my_buildR_dir/R-2.7.0/src/library'
make[1]: *** [R] Error 1
make[1]: Leaving directory `/my_buildR_dir/R-2.7.0/src'
make: *** [R] Error 1
--------------------------------------------------------------------------



------------------------------------------------------------------------
make[3]: Leaving directory `/my_buildR_dir/R-2.7.1/src/library/base'
make[3]: Entering directory `/my_buildR_dir/R-2.7.1/src/library/tools'
building package 'tools'
mkdir ../../../library/tools/R
mkdir ../../../library/tools/po
mkdir ../../../library/tools/man
make[4]: Entering directory `/my_buildR_dir/R-2.7.1/src/library/tools/src'
make[5]: Entering directory `/my_buildR_dir/R-2.7.1/src/library/tools/src'
make[5]: `Makedeps' is up to date.
make[5]: Leaving directory `/my_buildR_dir/R-2.7.1/src/library/tools/src'
make[5]: Entering directory `/my_buildR_dir/R-2.7.1/src/library/tools/src'
xlc_r -q64 -qlanglvl=extc99 -I../../../../include
-I/my_libiconv_dir/include -I/usr/lpp/X11/include/X11      -O -qstrict
-c text.c -o text.o
xlc_r -q64 -qlanglvl=extc99 -I../../../../include
-I/my_libiconv_dir/include -I/usr/lpp/X11/include/X11      -O -qstrict
-c init.c -o init.o
xlc_r -q64 -qlanglvl=extc99 -I../../../../include
-I/my_libiconv_dir/include -I/usr/lpp/X11/include/X11      -O -qstrict
-c Rmd5.c -o Rmd5.o
xlc_r -q64 -qlanglvl=extc99 -I../../../../include
-I/my_libiconv_dir/include -I/usr/lpp/X11/include/X11      -O -qstrict
-c md5.c -o md5.o
xlc_r -q64 -qlanglvl=extc99 -Wl,-brtl -Wl,-G -Wl,-bexpall
-Wl,-bnoentry -lc -L/my_libiconv_dir/lib -L/usr/lib -L/usr/X11R6/lib
-L/my_buildR_dir/R-2.7.1/lib -o tools.so text.o init.o Rmd5.o md5.o
-lm
make[5]: Leaving directory `/my_buildR_dir/R-2.7.1/src/library/tools/src'
make[4]: Leaving directory `/my_buildR_dir/R-2.7.1/src/library/tools/src'
Error in dyn.load(file, DLLpath = DLLpath, ...) :
 unable to load shared library
'/my_buildR_dir/R-2.7.1/library/tools/libs/tools.so':
 rtld: 0712-001 Symbol TYPEOF was referenced
     from module
/my_buildR_dir/R-2.7.1/library/tools/libs/tools.so(), but a runtime
definition
           of the symbol was not found.
rtld: 0712-001 Symbol LENGTH was referenced
     from module
/my_buildR_dir/R-2.7.1/library/tools/libs/tools.so(), but a runtime
definition
           of the symbol was not found.
rtld: 0712-001 Symbol R_CHAR was referenced
     from module
/my_buildR_dir/R-2.7.1/library/tools/libs/tools.so(), but a runtime
definition
           of the symbol was not found.
rtld: 0712-001 Symbol Rf_isString was referenced
     from module
/my_buildR_dir/R-2.7.1/library/tools/libs/tools.so(), but a runtime
definition
           of the symbol was not found.
rtld: 0712-002 fatal error: exiting.
Calls: ::: ... tryCatch -> tryCatchList -> tryCatchOne -> <Anonymous>
Execution halted
make[3]: *** [all] Error 1
make[3]: Leaving directory `/my_buildR_dir/R-2.7.1/src/library/tools'
make[2]: *** [R] Error 1
make[2]: Leaving directory `/my_buildR_dir/R-2.7.1/src/library'
make[1]: *** [R] Error 1
make[1]: Leaving directory `/my_buildR_dir/R-2.7.1/src'
make: *** [R] Error 1
-----------------------------------------------------------------------------

You see the symbols d1mach, interv, TYPEOF, R_CHAR and Rf_isString,
were not found. As for the library dependence, I add
/my_libiconv_dir/lib to my LIBPATH to make sure libR.so etc. can find
the libiconv. Thus, stats.so and tools.so could have be loaded. I
don't know where I made a mistake. After looking up the R manual and
diving into Google for help, I've got no usable answer.

I think I really need your help.

Below environment variables may associated:
LIBPATH="/my_libiconv_dir/lib:.:/rnd/homes/my/rdir/AIX/R-2.7.0/lib/R/lib:.:/usr/lib:/lib"
PATH="/rnd/homes/my/rdir/AIX/R-2.7.0/bin:/usr/java5_64/bin:/opt/gnu/bin:/usr/java5/bin:/opt/gnu/bin:/usr/bin:/etc:/usr/sbin:/usr/ucb:/usr/bin/X11:/sbin:/usr/java14/jre/bin:/usr/java14/bin:/usr/vacpp/bin:/usr/local/bin:/usr/idebug:."
R_HOME="/rnd/homes/my/rdir/AIX/R-2.7.0"



Thank you in advance,
Foy long


From arne.henningsen at googlemail.com  Thu Jul 17 13:42:15 2008
From: arne.henningsen at googlemail.com (Arne Henningsen)
Date: Thu, 17 Jul 2008 13:42:15 +0200
Subject: [Rd] Checking package vignettes: WARNING
In-Reply-To: <18558.8599.507088.919786@ridcully.stat.uni-muenchen.de>
References: <200807161240.25451.arne.henningsen@googlemail.com>
	<200807161457.41593.arne.henningsen@googlemail.com>
	<18558.8599.507088.919786@ridcully.stat.uni-muenchen.de>
Message-ID: <200807171342.15472.arne.henningsen@googlemail.com>

On Wednesday 16 July 2008 18:28:07, Friedrich Leisch wrote:
>   > On Wednesday 16 July 2008 14:16:05, Bernhard Pfaff wrote:
>   >> I do not know if this matters, but have you used 'results = verbatim'
>   >> in your R code chunk? See page 13 in:
>   >> http://www.statistik.lmu.de/~leisch/Sweave/Sweave-manual.pdf
>   >
>   > Thank you for this hint. I have tried this option, but it seems to have
>   > no effect on the quotation marks. Hence, I still do not know whether
>   > the quotation marks or something else causes the warning.
>
> verbatim is the default, so adding changes nothing if you had no
> results=xxx before.

Thanks for this hint! (I did not have any 'results=xxx' before. Hence, it is 
clear why adding 'results = verbatim' had no effect.)

> In whiche locale are you running? 

de_DE.UTF-8

> On Debian Linux with de_AT.UTF-8 everything is fine for me.
>
> Of course you also need something like
>
> \usepackage[utf8]{inputenc}
>
> to handle the special characters, but you need that anyway because
> every textual output of R may contain Umlaute ...

Yes, I have this command in the preamble of the Rnw file, but I get the 
waning message anyway :-(

I will uploaded the sampleSelection package (version 0.6-1) to 
   ftp://cran.r-project.org/incoming
If the CRAN servers run in the 'C' locale, all tests should pass without a 
warning and the updated package with the vignette will be available on CRAN 
soon. In this case, everybody can download the package and try to figure out 
the reason for the warning message. Any hints are welcome! 

BTW: It would be great if "R CMD check" could return a more informative 
warning message.

Thanks,
Arne

-- 
Arne Henningsen
http://www.arne-henningsen.name


From jayemerson at gmail.com  Thu Jul 17 14:25:49 2008
From: jayemerson at gmail.com (Jay Emerson)
Date: Thu, 17 Jul 2008 08:25:49 -0400
Subject: [Rd] Snow or alternative MPI packages on Windows
Message-ID: <d4588dec0807170525q74c4dfafv4f1a982d3541797a@mail.gmail.com>

Giuseppe,

I've been able to use NetWorkSpaces on all platforms, and have used
snow under Linux.  It's possible to use snow under windows, but you'll
need to build the binary yourself I think.  As an aside, I think this
makes it impossible to write a CRAN-friendly package that Requires: or
Suggests: snow, because it will fail the windows check.  It would be
great if we could get around this some way, but I know this topic has
been covered before (the subtle nature of Suggests: in particular, and
what it really means).  I would like to add SNOW support to two of my
own packages, bcp and bigmemory.

SNOW and NWS are similarly easy to use, at least at the superficial
level which has been my experience.

With NWS, you need both the package (nws, available on CRAN), and a
NWS server (open-source, available on sourceforge).  But REvolution
has a Windows installer available, and are working to make the whole
process easier on the end user/developer on all platforms.  I started
a rough page to help in the interim, and will update it as thing
change to assist the end user/developer:

http://www.stat.yale.edu/~jay/nws/

Jay


<< original message below >>

Guys,

I'm running R on both Windows & Linux. I'm looking at a number of packages
for parallel execution. It seems that the most used packages are "snow" and
"Rmpi".

snow seems more user friendly, but it doesn't run on windows. I see from
searching the mailing list that I'm not the first one to try it on Windows.
There was a message that kind of shed some hope on the subject, but nothing
else.

Rmpi works well on windows (with DeinoMPI) but it's kind of low level, so
before I embark in writing code similar to snow to have some high level
constructs I though I'd ask here about other peoples experiences...

Is anyone around here doing parallel R on Windows? If so could you share
your experience?

// Giuseppe

-- 
John W. Emerson (Jay)
Assistant Professor of Statistics
Department of Statistics
Yale University
http://www.stat.yale.edu/~jay
Statistical Advisor, REvolution Computing


From nakama at ki.rim.or.jp  Thu Jul 17 17:12:25 2008
From: nakama at ki.rim.or.jp (Ei-ji Nakama)
Date: Fri, 18 Jul 2008 00:12:25 +0900
Subject: [Rd] AIX 5.3 --enable-R-shlib --with-x ---with-iconv make error
	with R-2.7.0 and R-2.7.1
In-Reply-To: <e936a3d0807170359p62155163oe85a437d91506b98@mail.gmail.com>
References: <e936a3d0807170359p62155163oe85a437d91506b98@mail.gmail.com>
Message-ID: <dc41e1260807170812q32f9e9f1y4599dfbbbb348f53@mail.gmail.com>

Hi, sorry buggy English.

Did you cook this patch?
http://prs.ism.ac.jp/~nakama/AIX/aix_R-2.7.1_Rshlib_include_configure.patch

However, cooking of this patch is bad on AIX.
Therefore I put the thing which was finished with cooking.

http://prs.ism.ac.jp/~nakama/AIX/R-2.7.1.aix080701.tar.gz

I do a wish of tasting to you.

2008/7/17 F?n L?ng <foylong at gmail.com>:
> ----------------------------------------------------------
> ./configure \
>           CC="xlc_r -q64" \
>           CFLAGS="-O -qstrict" \
>           CXX="xlC_r -q64" \
>           CXXFLAGS="-O -qstrict" \
>           F77="xlf_r -q64" \
>           AR="ar -X64" \
>           CPPFLAGS="-I/my_libiconv_dir/include -I/usr/lpp/X11/include/X11" \
>           LDFLAGS="-L/my_libiconv_dir/lib -L/usr/lib -L/usr/X11R6/lib
> -L/my_buildR_dir/R-2.7.0/lib" \
>           --prefix=/my_R_dir \
>           --enable-R-shlib \
>           --enable-BLAS-shlib \
>           --with-x \
>           --with-readline=no \
>           --with-libiconv-prefix="/my_libiconv_dir"

``export OBJECT_MODE=64'' had better set it.
--with-libiconv-prefix are not reflected.

>  Options enabled:           shared BLAS, R profiling, Java

libjpeg and libjpeg-6b of java do conflict in my environment.
I remove PATH of the JAVA at the time of the construction.

> You see the symbols d1mach, interv, TYPEOF, R_CHAR and Rf_isString,
> were not found. As for the library dependence, I add
> /my_libiconv_dir/lib to my LIBPATH to make sure libR.so etc. can find
> the libiconv. Thus, stats.so and tools.so could have be loaded. I
> don't know where I made a mistake. After looking up the R manual and
> diving into Google for help, I've got no usable answer.

I had the sense that GC of ld turned into recently.
Probably former specifications may be bugs.

> Below environment variables may associated:
> LIBPATH="/my_libiconv_dir/lib:.:/rnd/homes/my/rdir/AIX/R-2.7.0/lib/R/lib:.:/usr/lib:/lib"
     <snip>
> R_HOME="/rnd/homes/my/rdir/AIX/R-2.7.0"

Because R add it in a shell of ``bin/R'', let's add LIBPATH when it
was said that there is not it.

best,
-- 
EI-JI Nakama <nakama (a) ki.rim.or.jp>
"\u4e2d\u9593\u6804\u6cbb" <nakama (a) ki.rim.or.jp>


From hb at stat.berkeley.edu  Thu Jul 17 17:15:27 2008
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Thu, 17 Jul 2008 08:15:27 -0700
Subject: [Rd] rowSums()/colSums() don't preserve the 'integer' storage
	mode
In-Reply-To: <B998A44C8986644EA8029CFE6396A92401528AD5@exqld2-bne.nexus.csiro.au>
References: <487EDD10.8020907@fhcrc.org>
	<B998A44C8986644EA8029CFE6396A92401528AD5@exqld2-bne.nexus.csiro.au>
Message-ID: <59d7961d0807170815y6c7c0e36g198e96fbc154b621@mail.gmail.com>

I had a look at the source code and the coercion to double is only
done one the sum of each row/column, so the "overhead" (e.g. memory)
is only on the summed result.  The integer matrix is *not*coerced to
double before summing, which could be case if done before calling the
native code.  The latter would be consume lots of memory.

My $.02

Henrik

On Wed, Jul 16, 2008 at 11:57 PM,  <Bill.Venables at csiro.au> wrote:
> I don't see the cost of doing so paying off.
>
> storage.mode is really only important if you are passing arguments to
> compiled code.
>
> If you are passing to compiled code, you really need to ensure the
> storage mode is what you think it is, anyway.
>
> Bill Venables.
>
>
>
> -----Original Message-----
> From: r-devel-bounces at r-project.org
> [mailto:r-devel-bounces at r-project.org] On Behalf Of Herve Pages
> Sent: Thursday, 17 July 2008 3:48 PM
> To: R-devel at r-project.org
> Subject: [Rd] rowSums()/colSums() don't preserve the 'integer' storage
> mode
>
> Hi,
>
> Wouldn't that make sense to have rowSums()/colSums() to preserve the
> storage mode?
>
> m <- matrix(1:15, nrow=5)
>
>  > storage.mode(m)
> [1] "integer"
>
>  > storage.mode(sum(m))
> [1] "integer"
>
>  > storage.mode(rowSums(m))
> [1] "double" <------------------- surprising!
>
> Cheers,
> H.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From foylong at gmail.com  Thu Jul 17 17:38:19 2008
From: foylong at gmail.com (=?ISO-8859-1?Q?F=E1n_L=F3ng?=)
Date: Thu, 17 Jul 2008 23:38:19 +0800
Subject: [Rd] AIX 5.3 --enable-R-shlib --with-x ---with-iconv make error
	with R-2.7.0 and R-2.7.1
In-Reply-To: <dc41e1260807170812q32f9e9f1y4599dfbbbb348f53@mail.gmail.com>
References: <e936a3d0807170359p62155163oe85a437d91506b98@mail.gmail.com>
	<dc41e1260807170812q32f9e9f1y4599dfbbbb348f53@mail.gmail.com>
Message-ID: <e936a3d0807170838g540bb139ncca3b2eb64e0286@mail.gmail.com>

Thank you, Ei-ji.

I haven't tried the aix_R-2.7.1_Rshlib_include_configure.patch for two reason:
#1 I have to compile R2.7.0 although I can reproduce the trouble on R-2.7.1.
#2 Actually, I don't know how to use this patch to R-2.7.1. Does this
need AIX admin permission?

And thanks for telling me the pacthed R-2.7.1.aix080701.tar.gz, I will
try this and let you know the result. BTW: do we also have a patched
R-2.7.0?

I will also try to export OBJECT_MODE=64 before configuring without
--with-libiconv-prefix and remove JAVA path from PATH of when
compiling R.

In a word, thank you very much for taking care of this.

Regards,
Long

On Thu, Jul 17, 2008 at 11:12 PM, Ei-ji Nakama <nakama at ki.rim.or.jp> wrote:
> Hi, sorry buggy English.
>
> Did you cook this patch?
> http://prs.ism.ac.jp/~nakama/AIX/aix_R-2.7.1_Rshlib_include_configure.patch
>
> However, cooking of this patch is bad on AIX.
> Therefore I put the thing which was finished with cooking.
>
> http://prs.ism.ac.jp/~nakama/AIX/R-2.7.1.aix080701.tar.gz
>
> I do a wish of tasting to you.
>
> 2008/7/17 F??n L??ng <foylong at gmail.com>:
>> ----------------------------------------------------------
>> ./configure \
>>           CC="xlc_r -q64" \
>>           CFLAGS="-O -qstrict" \
>>           CXX="xlC_r -q64" \
>>           CXXFLAGS="-O -qstrict" \
>>           F77="xlf_r -q64" \
>>           AR="ar -X64" \
>>           CPPFLAGS="-I/my_libiconv_dir/include -I/usr/lpp/X11/include/X11" \
>>           LDFLAGS="-L/my_libiconv_dir/lib -L/usr/lib -L/usr/X11R6/lib
>> -L/my_buildR_dir/R-2.7.0/lib" \
>>           --prefix=/my_R_dir \
>>           --enable-R-shlib \
>>           --enable-BLAS-shlib \
>>           --with-x \
>>           --with-readline=no \
>>           --with-libiconv-prefix="/my_libiconv_dir"
>
> ``export OBJECT_MODE=64'' had better set it.
> --with-libiconv-prefix are not reflected.
>
>>  Options enabled:           shared BLAS, R profiling, Java
>
> libjpeg and libjpeg-6b of java do conflict in my environment.
> I remove PATH of the JAVA at the time of the construction.
>
>> You see the symbols d1mach, interv, TYPEOF, R_CHAR and Rf_isString,
>> were not found. As for the library dependence, I add
>> /my_libiconv_dir/lib to my LIBPATH to make sure libR.so etc. can find
>> the libiconv. Thus, stats.so and tools.so could have be loaded. I
>> don't know where I made a mistake. After looking up the R manual and
>> diving into Google for help, I've got no usable answer.
>
> I had the sense that GC of ld turned into recently.
> Probably former specifications may be bugs.
>
>> Below environment variables may associated:
>> LIBPATH="/my_libiconv_dir/lib:.:/rnd/homes/my/rdir/AIX/R-2.7.0/lib/R/lib:.:/usr/lib:/lib"
>     <snip>
>> R_HOME="/rnd/homes/my/rdir/AIX/R-2.7.0"
>
> Because R add it in a shell of ``bin/R'', let's add LIBPATH when it
> was said that there is not it.
>
> best,
> --
> EI-JI Nakama <nakama (a) ki.rim.or.jp>
> "\u4e2d\u9593\u6804\u6cbb" <nakama (a) ki.rim.or.jp>
>



-- 
?????????x??????????????

From jeff.horner at vanderbilt.edu  Thu Jul 17 17:44:13 2008
From: jeff.horner at vanderbilt.edu (Jeffrey Horner)
Date: Thu, 17 Jul 2008 10:44:13 -0500
Subject: [Rd] Snow or alternative MPI packages on Windows
In-Reply-To: <OFA70A477E.B2A86968-ON80257488.004B153F-80257488.004C4191@hsbcib.com>
References: <OFA70A477E.B2A86968-ON80257488.004B153F-80257488.004C4191@hsbcib.com>
Message-ID: <487F68CD.9000502@vanderbilt.edu>

giuseppe1.milicia at hsbcib.com wrote on 07/16/2008 08:52 AM:
> Guys,
> 
> I'm running R on both Windows & Linux. I'm looking at a number of packages
> for parallel execution. It seems that the most used packages are "snow" and
> "Rmpi".
> 
> snow seems more user friendly, but it doesn't run on windows. I see from
> searching the mailing list that I'm not the first one to try it on Windows.
> There was a message that kind of shed some hope on the subject, but nothing
> else.
> 
> Rmpi works well on windows (with DeinoMPI) but it's kind of low level, so
> before I embark in writing code similar to snow to have some high level
> constructs I though I'd ask here about other peoples experiences...
> 
> Is anyone around here doing parallel R on Windows? If so could you share
> your experience?

I remember working with Jack Dongarra's group back in the late '90's 
when Microsoft donated some money, hardware, and software to ensure that 
pvm, scalapack, and the like worked on Windows. My particular task was 
to port Atlas to Windows and benchmark installs with various compilers 
and commercial BLAS libraries. it was a total PITA, dealing with calling 
conventions between fortran and C/C++, and DLL hell.

Anyway, the main researcher involved in the parallel Windows work 
realized (obviously) the hard problem was remotely connecting to Windows 
machines and spawning tasks, so he spent the majority of his time 
writing an rsh daemon, and it became kind of a stink because he went on 
to commercialize his work, buying the domain name myrshdaemon.com, and 
selling it. No one ever knew how much money he made.

Point being, around ten years have passed and including Windows in a 
parallel setup is still a problem?!? Sheesh!

Jeff
-- 
http://biostat.mc.vanderbilt.edu/JeffreyHorner


From giuseppe1.milicia at hsbcib.com  Thu Jul 17 17:49:11 2008
From: giuseppe1.milicia at hsbcib.com (giuseppe1.milicia at hsbcib.com)
Date: Thu, 17 Jul 2008 16:49:11 +0100
Subject: [Rd] Snow or alternative MPI packages on Windows
In-Reply-To: <487F68CD.9000502@vanderbilt.edu>
Message-ID: <OF656A104B.4E9B980E-ON80257489.0056BA0F-80257489.0056E685@hsbcib.com>

:)

Actually it turns out that DeinoMPI & Rmpi & the new version of snow do the
trick.

Jay Emerson suggested NetWorkSpaces which looks quite neat. For the time
being I'll probably stick to snow/Rmpi though.

So it seems that progress has been made!

// Giuseppe



                                                                           
             Jeffrey Horner                                                
             <jeff.horner at vand                                             
             erbilt.edu>                                                To 
                                       Giuseppe1 MILICIA/IBEU/HSBC at HSBC    
             17/07/2008 16:44                                           cc 
             Mail Size: 5648           r-devel at r-project.org               
                                                                   Subject 
                                       Re: [Rd] Snow or alternative MPI    
                                       packages on Windows                 
                                                                    Entity 
                                       Investment Banking Europe - IBEU    
                                                                           
                                                                           
                                                                           
                                                                           
                                                                           
                                                                           




giuseppe1.milicia at hsbcib.com wrote on 07/16/2008 08:52 AM:
> Guys,
>
> I'm running R on both Windows & Linux. I'm looking at a number of
packages
> for parallel execution. It seems that the most used packages are "snow"
and
> "Rmpi".
>
> snow seems more user friendly, but it doesn't run on windows. I see from
> searching the mailing list that I'm not the first one to try it on
Windows.
> There was a message that kind of shed some hope on the subject, but
nothing
> else.
>
> Rmpi works well on windows (with DeinoMPI) but it's kind of low level, so
> before I embark in writing code similar to snow to have some high level
> constructs I though I'd ask here about other peoples experiences...
>
> Is anyone around here doing parallel R on Windows? If so could you share
> your experience?

I remember working with Jack Dongarra's group back in the late '90's
when Microsoft donated some money, hardware, and software to ensure that
pvm, scalapack, and the like worked on Windows. My particular task was
to port Atlas to Windows and benchmark installs with various compilers
and commercial BLAS libraries. it was a total PITA, dealing with calling
conventions between fortran and C/C++, and DLL hell.

Anyway, the main researcher involved in the parallel Windows work
realized (obviously) the hard problem was remotely connecting to Windows
machines and spawning tasks, so he spent the majority of his time
writing an rsh daemon, and it became kind of a stink because he went on
to commercialize his work, buying the domain name myrshdaemon.com, and
selling it. No one ever knew how much money he made.

Point being, around ten years have passed and including Windows in a
parallel setup is still a problem?!? Sheesh!

Jeff
--
http://biostat.mc.vanderbilt.edu/JeffreyHorner



************************************************************
HSBC Bank plc may be solicited in the course of its placement efforts for a
new issue, by investment clients of the firm for whom the Bank as a firm
already provides other services. It may equally decide to allocate to its
own proprietary book or with an associate of HSBC Group. This represents a
potential conflict of interest. HSBC Bank plc has internal arrangements
designed to ensure that the firm would give unbiased and full advice to the
corporate finance client about the valuation and pricing of the offering as
well as internal systems, controls and procedures to identify and manage
conflicts of interest.

HSBC Bank plc
Registered Office: 8 Canada Square, London E14 5HQ, United Kingdom
Registered in England - Number 14259
Authorised and regulated by the Financial Services Authority.
************************************************************


-----------------------------------------
SAVE PAPER - THINK BEFORE YOU PRINT!

This transmission has been issued by a member of the HSBC Group
"HSBC" for the information of the addressee only and should not be
reproduced and/or distributed to any other person. Each page
attached hereto must be read in conjunction with any disclaimer
which forms part of it. Unless otherwise stated, this transmission
is neither an offer nor the solicitation of an offer to sell or
purchase any investment. Its contents are based on information
obtained from sources believed to be reliable but HSBC makes no
representation and accepts no responsibility or liability as to its
completeness or accuracy.


From kurt.van.dijck at skynet.be  Thu Jul 17 22:06:03 2008
From: kurt.van.dijck at skynet.be (Kurt Van Dijck)
Date: Thu, 17 Jul 2008 22:06:03 +0200
Subject: [Rd] spss endianness bugfix
Message-ID: <20080717200603.GA11015@e-circ.dyndns.org>

Hi,

We just upgraded the MacOSX R with foreign package 0.8.27 with
CRAN to have SPSS long variable names. Script tests/spss.R runs
fine. Thanks for importing the spss long labels patch & having
this available for MacOSX!
The first real-life datafile
does not get loaded with "Unexpected end of file".

The SPSS file was saved on a P4 linux, R running on MacOSX (ppc).
SPSS on MacOSX could read the file. Saving in SPSS there brings the 
same problem when reading on P4 linux. Testing proved that the problem
existed with earlier versions of the foreign package too.

I found the problem in src/sfm-read.c, read_document(). The n_lines
variable does not get byte-swapped.

This patch solves the problem.

Kind regards,
Kurt Van Dijck & Ilse Laurijssen

Index: src/sfm-read.c
===================================================================
--- src/sfm-read.c	(revision 5177)
+++ src/sfm-read.c	(working copy)
@@ -1336,6 +1336,8 @@
 	   h->fn));
 
   assertive_bufread(h, &n_lines, sizeof n_lines, 0);
+  if (ext->reverse_endian)
+    bswap_int32 (&n_lines);
   dict->n_documents = n_lines;
   if (dict->n_documents <= 0)
     lose ((_("%s: Number of document lines (%d) must be greater than 0"),


From bill at insightful.com  Fri Jul 18 02:19:14 2008
From: bill at insightful.com (Bill Dunlap)
Date: Thu, 17 Jul 2008 17:19:14 -0700 (PDT)
Subject: [Rd] Checking package help file examples
Message-ID: <Pine.GSO.4.56.0807171703500.13491@devsun3201.insightful.com>

I am trying to figure out the sanctioned way for
'R CMD check pkg' to make sure that the examples
in help files give the expected results.

Writing R Extensions says that check runs the help
file examples (which INSTALL extracts from pkg/man/*.Rd
and puts into files in pkg/R-ex).  It looks like check
concatenates all the example files, pkg/R-ex/*.R, into one
file, pkg/pkg-Ex.R, which it runs to produce pkg/pkg-Ex.Rout.
If there is an error running these files then check aborts.

I don't seen anything in Writing R Extensions about
checking that correct results were produced.  However,
in R 2.7.0, check will compare pkg/pkg-Ex.Rout to
pkg/tests/Examples/pkg/pkg-Ex.Rout.save, if the latter
file is in your package source, and report any differences.

I don't see any mention of this and was wondering if this
method should be recommended or if there was a preferred
way to check help file examples for correctness.  (It would
be nicer if the example() function could also check for
correctness, and the above method doesn't allow for that.)

----------------------------------------------------------------------------
Bill Dunlap
Insightful Corporation
bill at insightful dot com
360-428-8146

 "All statements in this message represent the opinions of the author and do
 not necessarily reflect Insightful Corporation policy or position."


From forum.query at gmail.com  Fri Jul 18 03:16:54 2008
From: forum.query at gmail.com (egc)
Date: Thu, 17 Jul 2008 21:16:54 -0400
Subject: [Rd] symbolic linking to library files
Message-ID: <458675ec0807171816s55e04060qd91b3c61e420611b@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20080717/1a96295c/attachment.pl>

From hpages at fhcrc.org  Fri Jul 18 03:32:19 2008
From: hpages at fhcrc.org (Herve Pages)
Date: Thu, 17 Jul 2008 18:32:19 -0700
Subject: [Rd] rowSums()/colSums() don't preserve the 'integer' storage
 mode
In-Reply-To: <B998A44C8986644EA8029CFE6396A92401528AD5@exqld2-bne.nexus.csiro.au>
References: <487EDD10.8020907@fhcrc.org>
	<B998A44C8986644EA8029CFE6396A92401528AD5@exqld2-bne.nexus.csiro.au>
Message-ID: <487FF2A3.4090504@fhcrc.org>

Hi Bill,

Bill.Venables at csiro.au wrote:
> I don't see the cost of doing so paying off.

The cost seems rather small. For the "if" block that is tagged /* columns */
in the do_colsum() function (src/main/array.c), that would give something
like:

     if (OP == 0 || OP == 1) { /* columns */
         int ans_type = (type == REALSXP || OP == 1) ? REALSXP : INTSXP;
	int ina = type == INTSXP ? NA_INTEGER : NA_LOGICAL;
         PROTECT(ans = allocVector(ans_type, p));
         for (j = 0; j < p; j++) {
             double rsum = 0.0;
             int isum = 0;
             switch (type) {
             case REALSXP:
                 rx = REAL(x) + n*j;
                 for (i = cnt = 0; i < n; i++, rx++) {
                     if (!ISNAN(*rx)) {cnt++; rsum += *rx;}
                     else if (keepNA) {rsum = NA_REAL; break;}
                 }
                 if (OP == 1) {
                     if (cnt == 0 || ISNAN(rsum))
                         REAL(ans)[j] = NA_REAL;
                     else
                         REAL(ans)[j] = rsum / cnt;
                 } else
                     REAL(ans)[j] = rsum;
             break;
             case INTSXP: case LGLSXP:
                 ix = (type == INTSXP ? INTEGER(x) : LOGICAL(x)) + n*j;
                 for (i = cnt = 0; i < n; i++, ix++) {
                     if (*ix != ina) {cnt++; isum += *ix;}
                     else if (keepNA) {isum = NA_INTEGER; break;}
                 }
                 if (OP == 1) {
                     if (cnt == 0 || isum == NA_INTEGER)
                         REAL(ans)[j] = NA_REAL;
                     else
                         REAL(ans)[j] = ((double) isum) / cnt;
                 } else
                     INTEGER(ans)[j] = isum;
             break;
             default:
                 /* we checked the type above, but be sure */
                 UNIMPLEMENTED_TYPEt("do_colsum", type);
             }
         }
     }

So now you have 42 lines instead of 37 in the current code.
Then do something similar for the "if" block tagged /* rows */.
Basically the new code would not be more complicated than the
current code.

In the end rowSums()/colSums() will do the _right_ thing i.e.
they'll preserve the 'integer' storage mode, and, by doing so, will
behave consistently with the sum() function.

BTW since the LGLSXP type is supported then the "'x' must be numeric"
error msg at the beginning of the do_colsum() function is inappropriate.

Cheers,
H.


> 
> storage.mode is really only important if you are passing arguments to
> compiled code.
> 
> If you are passing to compiled code, you really need to ensure the
> storage mode is what you think it is, anyway.
> 
> Bill Venables.  
> 
> 
> 
> -----Original Message-----
> From: r-devel-bounces at r-project.org
> [mailto:r-devel-bounces at r-project.org] On Behalf Of Herve Pages
> Sent: Thursday, 17 July 2008 3:48 PM
> To: R-devel at r-project.org
> Subject: [Rd] rowSums()/colSums() don't preserve the 'integer' storage
> mode
> 
> Hi,
> 
> Wouldn't that make sense to have rowSums()/colSums() to preserve the
> storage mode?
> 
> m <- matrix(1:15, nrow=5)
> 
>  > storage.mode(m)
> [1] "integer"
> 
>  > storage.mode(sum(m))
> [1] "integer"
> 
>  > storage.mode(rowSums(m))
> [1] "double" <------------------- surprising!
> 
> Cheers,
> H.
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 
>


From hb at stat.berkeley.edu  Fri Jul 18 03:42:22 2008
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Thu, 17 Jul 2008 18:42:22 -0700
Subject: [Rd] rowSums()/colSums() don't preserve the 'integer' storage
	mode
In-Reply-To: <487FF2A3.4090504@fhcrc.org>
References: <487EDD10.8020907@fhcrc.org>
	<B998A44C8986644EA8029CFE6396A92401528AD5@exqld2-bne.nexus.csiro.au>
	<487FF2A3.4090504@fhcrc.org>
Message-ID: <59d7961d0807171842x50942d25s6b15afd2444d6519@mail.gmail.com>

Hi,

there is one more thing to consider: the risk of getting integer
overflow.  Should that be ignored?  How is this handled by sum()?

I think it is good if {col|row}Sums() would return the same data type
as the input object.

Cheers

Henrik

On Thu, Jul 17, 2008 at 6:32 PM, Herve Pages <hpages at fhcrc.org> wrote:
> Hi Bill,
>
> Bill.Venables at csiro.au wrote:
>>
>> I don't see the cost of doing so paying off.
>
> The cost seems rather small. For the "if" block that is tagged /* columns */
> in the do_colsum() function (src/main/array.c), that would give something
> like:
>
>    if (OP == 0 || OP == 1) { /* columns */
>        int ans_type = (type == REALSXP || OP == 1) ? REALSXP : INTSXP;
>        int ina = type == INTSXP ? NA_INTEGER : NA_LOGICAL;
>        PROTECT(ans = allocVector(ans_type, p));
>        for (j = 0; j < p; j++) {
>            double rsum = 0.0;
>            int isum = 0;
>            switch (type) {
>            case REALSXP:
>                rx = REAL(x) + n*j;
>                for (i = cnt = 0; i < n; i++, rx++) {
>                    if (!ISNAN(*rx)) {cnt++; rsum += *rx;}
>                    else if (keepNA) {rsum = NA_REAL; break;}
>                }
>                if (OP == 1) {
>                    if (cnt == 0 || ISNAN(rsum))
>                        REAL(ans)[j] = NA_REAL;
>                    else
>                        REAL(ans)[j] = rsum / cnt;
>                } else
>                    REAL(ans)[j] = rsum;
>            break;
>            case INTSXP: case LGLSXP:
>                ix = (type == INTSXP ? INTEGER(x) : LOGICAL(x)) + n*j;
>                for (i = cnt = 0; i < n; i++, ix++) {
>                    if (*ix != ina) {cnt++; isum += *ix;}
>                    else if (keepNA) {isum = NA_INTEGER; break;}
>                }
>                if (OP == 1) {
>                    if (cnt == 0 || isum == NA_INTEGER)
>                        REAL(ans)[j] = NA_REAL;
>                    else
>                        REAL(ans)[j] = ((double) isum) / cnt;
>                } else
>                    INTEGER(ans)[j] = isum;
>            break;
>            default:
>                /* we checked the type above, but be sure */
>                UNIMPLEMENTED_TYPEt("do_colsum", type);
>            }
>        }
>    }
>
> So now you have 42 lines instead of 37 in the current code.
> Then do something similar for the "if" block tagged /* rows */.
> Basically the new code would not be more complicated than the
> current code.
>
> In the end rowSums()/colSums() will do the _right_ thing i.e.
> they'll preserve the 'integer' storage mode, and, by doing so, will
> behave consistently with the sum() function.
>
> BTW since the LGLSXP type is supported then the "'x' must be numeric"
> error msg at the beginning of the do_colsum() function is inappropriate.
>
> Cheers,
> H.
>
>
>>
>> storage.mode is really only important if you are passing arguments to
>> compiled code.
>>
>> If you are passing to compiled code, you really need to ensure the
>> storage mode is what you think it is, anyway.
>>
>> Bill Venables.
>>
>>
>> -----Original Message-----
>> From: r-devel-bounces at r-project.org
>> [mailto:r-devel-bounces at r-project.org] On Behalf Of Herve Pages
>> Sent: Thursday, 17 July 2008 3:48 PM
>> To: R-devel at r-project.org
>> Subject: [Rd] rowSums()/colSums() don't preserve the 'integer' storage
>> mode
>>
>> Hi,
>>
>> Wouldn't that make sense to have rowSums()/colSums() to preserve the
>> storage mode?
>>
>> m <- matrix(1:15, nrow=5)
>>
>>  > storage.mode(m)
>> [1] "integer"
>>
>>  > storage.mode(sum(m))
>> [1] "integer"
>>
>>  > storage.mode(rowSums(m))
>> [1] "double" <------------------- surprising!
>>
>> Cheers,
>> H.
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From ldimitro at wfubmc.edu  Fri Jul 18 04:08:56 2008
From: ldimitro at wfubmc.edu (Latchezar (Lucho) Dimitrov)
Date: Thu, 17 Jul 2008 22:08:56 -0400
Subject: [Rd] symbolic linking to library files
In-Reply-To: <458675ec0807171816s55e04060qd91b3c61e420611b@mail.gmail.com>
References: <458675ec0807171816s55e04060qd91b3c61e420611b@mail.gmail.com>
Message-ID: <F160BE32A2E5E04497668BBDFE83FEDF2427573D@EXCHVS1.medctr.ad.wfubmc.edu>

It seems not the whole path /home/guru/Blaster is accessible to the
intended users.

Since guru has read access to the R install dirs why don't you try
putting real Blaster dir there and giving guru the ownership or at least
necessary permissions so that (s)he can really actually install Blaster
there? Just a thought 

Regards
Latchezar

> -----Original Message-----
> From: r-devel-bounces at r-project.org 
> [mailto:r-devel-bounces at r-project.org] On Behalf Of egc
> Sent: Thursday, July 17, 2008 9:17 PM
> To: r-devel at r-project.org
> Subject: [Rd] symbolic linking to library files
> 
> I handle SysAdmin for a multi-user Linux box, with R 2.7.1 
> compiled and installed to make usee of ACML (Opteron chips). 
> The library files (packages) are installed to 
> /usr/local/lib64/R/library
> 
> Everything works as it should, except for the following. Say 
> I have a user (an R developer) who has developed a package 
> called Blaster. We'll call the user guru. Now,  
> /home/guru/Blaster, contains the needed directory structure 
> to do a normal install (i.e., R CMD INSTALL Blaster), but the 
> user can't write to /usr/local/lib64/R/library. Sure, said 
> user can do a local install, so *he* can use Blaster, but 
> we'd like it so that changes guru makes to Blaster are 
> available to everyone.
> 
> My first simple-minded solution to this was to simply create 
> a symbolic link to Blaster from within 
> /usr/local/lib64/R/library. However, this doesn't seem to 
> work. Invoking library(Blaster) gives an error message about 
> Blaster not being a valid library.
> 
> Apparently, R CMD INSTALL Blaster does something more than 
> simply copy Blaster to the appropriate directory. I did a 
> quick perusual of what I could find online, but I suspect 
> I've missed something - hopefully not too embarassingly obvious.
> 
> Basically, what I'd like to do is create a symbolic link to 
> 'something' that guru creates, from within 
> /usr/local/lib64/R/library, such that (i) Blaster is 
> available to all users on the system, and (ii) any changes 
> Guru makes to his code are automatically available. Is 
> anything like this feasible?
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 


From Peter.Peyk at unibas.ch  Fri Jul 18 07:06:34 2008
From: Peter.Peyk at unibas.ch (Peter Peyk)
Date: Fri, 18 Jul 2008 07:06:34 +0200
Subject: [Rd] Rcpp from C++
In-Reply-To: <11069970.472841216325644019.JavaMail.nabble@isper.nabble.com>
References: <11069970.472841216325644019.JavaMail.nabble@isper.nabble.com>
Message-ID: <200807180706.34902.Peter.Peyk@unibas.ch>

Hi Sri,

I haven't really elaborated on it having other stuff to prepare first, but as 
far as I got you first assign data to a vector:


#include <R.h>
#include <Rinternals.h>
#undef R_INTERFACE_PTRS
#include <Rembedded.h>
#include "Rcpp.hpp" 
#include <R_ext/Parse.h>
#include <Rinternals.h>
#include <Rdefines.h>

    //assigning a vector
    SEXP ab;
    PROTECT(ab = allocVector(REALSXP, 2));
    REAL(ab)[0] = 123.45;
    REAL(ab)[1] = 67.89;
    UNPROTECT(1);

the attach a R variable name to the data using

void defineVar(SEXP symbol, SEXP value, SEXP rho)
void setVar(SEXP symbol, SEXP value, SEXP rho)

but I haven't tried that yet in detail.

getVar is the other way around and finds the data to an R variable name:

SEXP getVar(SEXP name, SEXP rho)
{
    SEXP ans;     
    if(!isString(name) || length(name) != 1)
        error("name is not a single string");
    if(!isEnvironment(rho))
        error("rho should be an environment");
    ans = findVar(install(CHAR(STRING_ELT(name, 0))), rho);
    return ans;
}   



To get the data of an R-variable you should be able to use the constructors 
from Rcpp that take an SEXP as argument, but i also haven't tried that yet.

What I found to be useful too is the routine for evaluating R-commands:

    //evaluating commands
    int errorOccurred;
    ParseStatus status;
    SEXP cmdSexp, cmdexpr, ans = R_NilValue;
    PROTECT(cmdSexp = Rf_allocVector(LANGSXP, 1));
    char* cArr[4];
    cArr[0] = "a <- seq(1,20)";  
    cArr[1] = "b <- seq(1,20)";
    cArr[2] = "c <- a+ b";
    cArr[3] = "print(c)";
    for (int CommandInd = 0; CommandInd<4; CommandInd++)
    {
        PROTECT(cmdSexp = allocVector(STRSXP, 1));
        SET_STRING_ELT(cmdSexp, 0, mkChar(cArr[CommandInd]));
        cmdexpr = PROTECT(R_ParseVector(cmdSexp, -1, &status, R_NilValue));
        if (status != PARSE_OK) {
            UNPROTECT(2);
            error("invalid call!");
        }
        for(int i = 0; i < length(cmdexpr); i++)
        {
            ans = eval(VECTOR_ELT(cmdexpr, i), R_GlobalEnv);
            Rf_PrintValue(ans);
        }
    }

hope that helps
best
peter

P.S.: let me know if that works and what you find out!


From Bill.Venables at csiro.au  Fri Jul 18 07:09:19 2008
From: Bill.Venables at csiro.au (Bill.Venables at csiro.au)
Date: Fri, 18 Jul 2008 15:09:19 +1000
Subject: [Rd] rowSums()/colSums() don't preserve the 'integer' storage
	mode
References: <487EDD10.8020907@fhcrc.org>
	<B998A44C8986644EA8029CFE6396A92401528AD5@exqld2-bne.nexus.csiro.au>
	<487FF2A3.4090504@fhcrc.org>
Message-ID: <B998A44C8986644EA8029CFE6396A92401528B37@exqld2-bne.nexus.csiro.au>

OK, let's do it, if it could save memory.  I can't see it breaking any
sensibly written existing code.

Bill. 


Bill Venables
CSIRO Laboratories
PO Box 120, Cleveland, 4163
AUSTRALIA
Office Phone (email preferred): +61 7 3826 7251
Fax (if absolutely necessary):  +61 7 3826 7304
Mobile:                         +61 4 8819 4402
Home Phone:                     +61 7 3286 7700
mailto:Bill.Venables at csiro.au
http://www.cmis.csiro.au/bill.venables/ 

-----Original Message-----
From: Herve Pages [mailto:hpages at fhcrc.org] 
Sent: Friday, 18 July 2008 11:32 AM
To: Venables, Bill (CMIS, Cleveland)
Cc: R-devel at r-project.org
Subject: Re: [Rd] rowSums()/colSums() don't preserve the 'integer'
storage mode

Hi Bill,

Bill.Venables at csiro.au wrote:
> I don't see the cost of doing so paying off.

The cost seems rather small. For the "if" block that is tagged /*
columns */
in the do_colsum() function (src/main/array.c), that would give
something
like:

     if (OP == 0 || OP == 1) { /* columns */
         int ans_type = (type == REALSXP || OP == 1) ? REALSXP : INTSXP;
	int ina = type == INTSXP ? NA_INTEGER : NA_LOGICAL;
         PROTECT(ans = allocVector(ans_type, p));
         for (j = 0; j < p; j++) {
             double rsum = 0.0;
             int isum = 0;
             switch (type) {
             case REALSXP:
                 rx = REAL(x) + n*j;
                 for (i = cnt = 0; i < n; i++, rx++) {
                     if (!ISNAN(*rx)) {cnt++; rsum += *rx;}
                     else if (keepNA) {rsum = NA_REAL; break;}
                 }
                 if (OP == 1) {
                     if (cnt == 0 || ISNAN(rsum))
                         REAL(ans)[j] = NA_REAL;
                     else
                         REAL(ans)[j] = rsum / cnt;
                 } else
                     REAL(ans)[j] = rsum;
             break;
             case INTSXP: case LGLSXP:
                 ix = (type == INTSXP ? INTEGER(x) : LOGICAL(x)) + n*j;
                 for (i = cnt = 0; i < n; i++, ix++) {
                     if (*ix != ina) {cnt++; isum += *ix;}
                     else if (keepNA) {isum = NA_INTEGER; break;}
                 }
                 if (OP == 1) {
                     if (cnt == 0 || isum == NA_INTEGER)
                         REAL(ans)[j] = NA_REAL;
                     else
                         REAL(ans)[j] = ((double) isum) / cnt;
                 } else
                     INTEGER(ans)[j] = isum;
             break;
             default:
                 /* we checked the type above, but be sure */
                 UNIMPLEMENTED_TYPEt("do_colsum", type);
             }
         }
     }

So now you have 42 lines instead of 37 in the current code.
Then do something similar for the "if" block tagged /* rows */.
Basically the new code would not be more complicated than the
current code.

In the end rowSums()/colSums() will do the _right_ thing i.e.
they'll preserve the 'integer' storage mode, and, by doing so, will
behave consistently with the sum() function.

BTW since the LGLSXP type is supported then the "'x' must be numeric"
error msg at the beginning of the do_colsum() function is inappropriate.

Cheers,
H.


> 
> storage.mode is really only important if you are passing arguments to
> compiled code.
> 
> If you are passing to compiled code, you really need to ensure the
> storage mode is what you think it is, anyway.
> 
> Bill Venables.  
> 
> 
> 
> -----Original Message-----
> From: r-devel-bounces at r-project.org
> [mailto:r-devel-bounces at r-project.org] On Behalf Of Herve Pages
> Sent: Thursday, 17 July 2008 3:48 PM
> To: R-devel at r-project.org
> Subject: [Rd] rowSums()/colSums() don't preserve the 'integer' storage
> mode
> 
> Hi,
> 
> Wouldn't that make sense to have rowSums()/colSums() to preserve the
> storage mode?
> 
> m <- matrix(1:15, nrow=5)
> 
>  > storage.mode(m)
> [1] "integer"
> 
>  > storage.mode(sum(m))
> [1] "integer"
> 
>  > storage.mode(rowSums(m))
> [1] "double" <------------------- surprising!
> 
> Cheers,
> H.
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 
> 


From arne.henningsen at googlemail.com  Fri Jul 18 08:05:07 2008
From: arne.henningsen at googlemail.com (Arne Henningsen)
Date: Fri, 18 Jul 2008 08:05:07 +0200
Subject: [Rd] Checking package help file examples
In-Reply-To: <Pine.GSO.4.56.0807171703500.13491@devsun3201.insightful.com>
References: <Pine.GSO.4.56.0807171703500.13491@devsun3201.insightful.com>
Message-ID: <200807180805.09930.arne.henningsen@googlemail.com>

On Friday 18 July 2008 02:19:14, Bill Dunlap wrote:
> I am trying to figure out the sanctioned way for
> 'R CMD check pkg' to make sure that the examples
> in help files give the expected results.
>
> Writing R Extensions says that check runs the help
> file examples (which INSTALL extracts from pkg/man/*.Rd
> and puts into files in pkg/R-ex).  It looks like check
> concatenates all the example files, pkg/R-ex/*.R, into one
> file, pkg/pkg-Ex.R, which it runs to produce pkg/pkg-Ex.Rout.
> If there is an error running these files then check aborts.
>
> I don't seen anything in Writing R Extensions about
> checking that correct results were produced.  However,
> in R 2.7.0, check will compare pkg/pkg-Ex.Rout to
> pkg/tests/Examples/pkg/pkg-Ex.Rout.save, if the latter
> file is in your package source, and report any differences.
>
> I don't see any mention of this and was wondering if this
> method should be recommended or if there was a preferred
> way to check help file examples for correctness.  (It would
> be nicer if the example() function could also check for
> correctness, and the above method doesn't allow for that.)

I use *.R and corresponding *.Rout.save files in the subdirectory "tests" for 
checking packages (see e.g., packages systemfit, micEcon, 
sampleSelection, ...). I think that it is better to separate examples from 
testing, because IMHO there should be a few simple examples but tests should 
contain many different function calls with (partly) unusual arguments to 
check (nearly) the entire functionality of each function.

See also the manual "Writing R Extensions"
http://cran.r-project.org/doc/manuals/R-exts.html#Package-subdirectories
======================================
Subdirectory tests is for additional package-specific test code, similar to 
the specific tests that come with the R distribution. Test code can either be 
provided directly in a .R file, or via a .Rin file containing code which in 
turn creates the corresponding .R file (e.g., by collecting all function 
objects in the package and then calling them with the strangest arguments). 
The results of running a .R file are written to a .Rout file. If there is a 
corresponding .Rout.save file, these two are compared, with differences being 
reported but not causing an error. The directory tests is copied to the check 
area, and the tests are run with the copy as the working directory and with 
R_LIBS set to ensure that the copy of the package installed during testing 
will be found by library(pkg_name). 
======================================

Best wishes,
Arne

-- 
Arne Henningsen
http://www.arne-henningsen.name


From khansen at stat.Berkeley.EDU  Fri Jul 18 08:19:39 2008
From: khansen at stat.Berkeley.EDU (Kasper Daniel Hansen)
Date: Thu, 17 Jul 2008 23:19:39 -0700
Subject: [Rd] symbolic linking to library files
In-Reply-To: <458675ec0807171816s55e04060qd91b3c61e420611b@mail.gmail.com>
References: <458675ec0807171816s55e04060qd91b3c61e420611b@mail.gmail.com>
Message-ID: <1F459092-61C8-43BE-A8DD-E5F2176FA16E@stat.berkeley.edu>

I agree with the other poster's advice to just give guru permission to  
write to the R library folder.

But the thing you want is the following. Create a directory somewhere  
that guru has write permission, for example
~guru/library
(although I guess I would recommend somewhere else than guru's home  
directory) and do an R CMD INSTALL into that directory, for example by
   R CMD INSTALL Blaster -l ~guru/library

You can make this directory accessible for all your users by altering  
site.profile to contain for example
   .libPaths("~guru/library")
or by creating an environment variable for all users (how you do that  
can probably be accomplished in many ways), like
   export R_LIBS=/home/guru/library

That should be enough to get you started.

Kasper



On Jul 17, 2008, at 6:16 PM, egc wrote:

> I handle SysAdmin for a multi-user Linux box, with R 2.7.1 compiled  
> and
> installed to make usee of ACML (Opteron chips). The library files  
> (packages)
> are installed to /usr/local/lib64/R/library
>
> Everything works as it should, except for the following. Say I have  
> a user
> (an R developer) who has developed a package called Blaster. We'll  
> call the
> user guru. Now,  /home/guru/Blaster, contains the needed directory  
> structure
> to do a normal install (i.e., R CMD INSTALL Blaster), but the user  
> can't
> write to /usr/local/lib64/R/library. Sure, said user can do a local  
> install,
> so *he* can use Blaster, but we'd like it so that changes guru makes  
> to
> Blaster are available to everyone.
>
> My first simple-minded solution to this was to simply create a  
> symbolic link
> to Blaster from within /usr/local/lib64/R/library. However, this  
> doesn't
> seem to work. Invoking library(Blaster) gives an error message about  
> Blaster
> not being a valid library.
>
> Apparently, R CMD INSTALL Blaster does something more than simply copy
> Blaster to the appropriate directory. I did a quick perusual of what  
> I could
> find online, but I suspect I've missed something - hopefully not too
> embarassingly obvious.
>
> Basically, what I'd like to do is create a symbolic link to  
> 'something' that
> guru creates, from within /usr/local/lib64/R/library, such that (i)  
> Blaster
> is available to all users on the system, and (ii) any changes Guru  
> makes to
> his code are automatically available. Is anything like this feasible?
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From Gregor.Gorjanc at bfro.uni-lj.si  Fri Jul 18 09:13:46 2008
From: Gregor.Gorjanc at bfro.uni-lj.si (Gorjanc Gregor)
Date: Fri, 18 Jul 2008 09:13:46 +0200
Subject: [Rd] Windows: adding R/bin folder to the PATH variable
Message-ID: <F189E18BBAA8B6479F618B9044CF4E9C686C1337BB@owa.bfro.uni-lj.si>

Hi!

Under Windows R is installed, but its bin folder is not added to the system PATH
variable. I know that this is handled properly under *nix like systems and I wonder,
why this is not the default also for the MS Windows? I guess that for most users
a shortcut on the desktop or anywhere else is sufficient, but there are occasions
when one expects to able to lunch R from anywhere - say the Command prompt.

Regards, Gregor


From ripley at stats.ox.ac.uk  Fri Jul 18 10:18:17 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 18 Jul 2008 09:18:17 +0100 (BST)
Subject: [Rd] Windows: adding R/bin folder to the PATH variable
In-Reply-To: <F189E18BBAA8B6479F618B9044CF4E9C686C1337BB@owa.bfro.uni-lj.si>
References: <F189E18BBAA8B6479F618B9044CF4E9C686C1337BB@owa.bfro.uni-lj.si>
Message-ID: <alpine.LFD.1.10.0807180911220.13340@gannet.stats.ox.ac.uk>

On Fri, 18 Jul 2008, Gorjanc Gregor wrote:

> Hi!
>
> Under Windows R is installed, but its bin folder is not added to the 
> system PATH variable. I know that this is handled properly under *nix 
> like systems and I wonder, why this is not the default also for the MS 
> Windows? I guess that for most users a shortcut on the desktop or 
> anywhere else is sufficient, but there are occasions when one expects to 
> able to lunch R from anywhere - say the Command prompt.

This is the normal behaviour of Windows applications.  There are several 
reasons, including length limits on the Windows PATH (which are 
version-specific) and that shells are not normally used -- most Unix 
shells hash the path contents so lookup is (almost) independent of the 
number of applications on the path.

If you run a shell (e.g. the Command prompt) you can set the path for that 
shell, and indeed I have my system setup to use a different path in shells 
than used from the desktop).

Finally, those Windows installers that do add to the PATH frequently fail 
to uninstall correctly.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From Gregor.Gorjanc at bfro.uni-lj.si  Fri Jul 18 11:50:18 2008
From: Gregor.Gorjanc at bfro.uni-lj.si (Gorjanc Gregor)
Date: Fri, 18 Jul 2008 11:50:18 +0200
Subject: [Rd] Windows: adding R/bin folder to the PATH variable
In-Reply-To: <alpine.LFD.1.10.0807180911220.13340@gannet.stats.ox.ac.uk>
References: <F189E18BBAA8B6479F618B9044CF4E9C686C1337BB@owa.bfro.uni-lj.si>,
	<alpine.LFD.1.10.0807180911220.13340@gannet.stats.ox.ac.uk>
Message-ID: <F189E18BBAA8B6479F618B9044CF4E9C686C1337BD@owa.bfro.uni-lj.si>

>> Under Windows R is installed, but its bin folder is not added to the
>> system PATH variable. I know that this is handled properly under *nix
>> like systems and I wonder, why this is not the default also for the MS
>> Windows? I guess that for most users a shortcut on the desktop or
>> anywhere else is sufficient, but there are occasions when one expects to
>> able to lunch R from anywhere - say the Command prompt.
>
> This is the normal behaviour of Windows applications.  There are several
> reasons, including length limits on the Windows PATH (which are
> version-specific) and that shells are not normally used -- most Unix
> shells hash the path contents so lookup is (almost) independent of the
> number of applications on the path.
>
> Finally, those Windows installers that do add to the PATH frequently fail
> to uninstall correctly.

I was not aware about this relevant issues. I understand now why changing the
PATH variable is not so common. Perhaps, the following scheme might work
better

1. Set the R_BIN variable - something like R_BIN=.../R/R-*/bin
2. Add the R_BIN variable to PATH variable - something like PATH=...;%R_BIN%

Though I can see problems with multiple versions etc.

Regards, Gregor


From ggrothendieck at gmail.com  Fri Jul 18 12:16:39 2008
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Fri, 18 Jul 2008 06:16:39 -0400
Subject: [Rd] Windows: adding R/bin folder to the PATH variable
In-Reply-To: <alpine.LFD.1.10.0807180911220.13340@gannet.stats.ox.ac.uk>
References: <F189E18BBAA8B6479F618B9044CF4E9C686C1337BB@owa.bfro.uni-lj.si>
	<alpine.LFD.1.10.0807180911220.13340@gannet.stats.ox.ac.uk>
Message-ID: <971536df0807180316n2431cff3racaaadfacefe4b9e@mail.gmail.com>

On Fri, Jul 18, 2008 at 4:18 AM, Prof Brian Ripley
<ripley at stats.ox.ac.uk> wrote:
> On Fri, 18 Jul 2008, Gorjanc Gregor wrote:
>
>> Hi!
>>
>> Under Windows R is installed, but its bin folder is not added to the
>> system PATH variable. I know that this is handled properly under *nix like
>> systems and I wonder, why this is not the default also for the MS Windows? I
>> guess that for most users a shortcut on the desktop or anywhere else is
>> sufficient, but there are occasions when one expects to able to lunch R from
>> anywhere - say the Command prompt.
>
> This is the normal behaviour of Windows applications.  There are several
> reasons, including length limits on the Windows PATH (which are
> version-specific) and that shells are not normally used -- most Unix shells
> hash the path contents so lookup is (almost) independent of the number of
> applications on the path.
>
> If you run a shell (e.g. the Command prompt) you can set the path for that
> shell, and indeed I have my system setup to use a different path in shells
> than used from the desktop).
>
> Finally, those Windows installers that do add to the PATH frequently fail to
> uninstall correctly.
>

There are two other problems, as well:

- you might want to use two different versions of R on the same
computer

- the directory that normally resides at c:\rtools\bin contains a find
command which conflicts with the Windows find command so if
you keep rtools\bin in your path it can cause other Windows scripts
to fail.

At any rate, note that batchfiles at

http://batchfiles.googlecode.com

has Rcmd.bat, R.bat, Rgui.bat, etc. that you just place anywhere in your
path and they will automatically find R and rtools from the registry and
MiKTeX via a heuristic and then launch the corresponding R .exe .
Just place one of them or all of them anywhere in your path in which case
no path changes are required to run R or to build R packages at all.

They also have the advantage that if you use them you can be sure that the
temporary PATH that they set up and remove on the fly gets set properly which
is an advantage since, based on messages on r-help or r-devel, wrong setting of
PATH is a frequent problem.


From foylong at gmail.com  Thu Jul 17 11:43:46 2008
From: foylong at gmail.com (=?ISO-8859-1?Q?F=E1n_L=F3ng?=)
Date: Thu, 17 Jul 2008 17:43:46 +0800
Subject: [Rd] AIX 5.3 --enable-R-shlib --with-x ---with-iconv make error
	with R-2.7.0 and R-2.7.1
Message-ID: <e936a3d0807170243w7c3d08d8rddbd19364e909c1f@mail.gmail.com>

Hi guys,

I am trying to compile a 64bit version of R 2.7.0 on AIX 5.3. And I am
running into some troubles.  I also try the latest version 2.7.1 and
get the very similar errors.

The machine info:
-----------------------
$uname -srvp
AIX 3 5 powerpc
----------------------



My configuration is this:

----------------------------------------------------------
./configure \
            CC="xlc_r -q64" \
            CFLAGS="-O -qstrict" \
            CXX="xlC_r -q64" \
            CXXFLAGS="-O -qstrict" \
            F77="xlf_r -q64" \
            AR="ar -X64" \
            CPPFLAGS="-I/my_libiconv_dir/include -I/usr/lpp/X11/include/X11" \
            LDFLAGS="-L/my_libiconv_dir/lib -L/usr/lib
-L/usr/X11R6/lib -L/my_buildR_dir/R-2.7.0/lib" \
            --prefix=/my_R_dir \
            --enable-R-shlib \
            --enable-BLAS-shlib \
            --with-x \
            --with-readline=no \
            --with-libiconv-prefix="/my_libiconv_dir"
------------------------------------------------------------

I don't have the gcc and gfortran installed on the machine, so I use
the native ones. As the manual says, the AIX native iconv does not
support encodings `latin1' nor `""' and so cannot be used. I install
GNU libiconv to my_libiconv_dir follow the steps in
http://prs.ism.ac.jp/~nakama/AIX/AIX_iconv_CookBook.txt. Thanks Ei-ji
Nakama for this CookBook :)


The configuration step ends ok:

-----------------------------------------------------------

R is now configured for powerpc-ibm-aix5.3.0.0

  Source directory:          .
  Installation directory:    /rnd/homes/my/rdir/AIX/R-2.7.0

  C compiler:                xlc_r -q64 -qlanglvl=extc99  -O -qstrict
  Fortran 77 compiler:       xlf_r -q64  -g

  C++ compiler:              xlC_r -q64  -O -qstrict
  Fortran 90/95 compiler:    xlf95 -g
  Obj-C compiler:

  Interfaces supported:      X11
  External libraries:
  Additional capabilities:   iconv, MBCS, NLS
  Options enabled:           shared BLAS, R profiling, Java

  Recommended packages:      yes

configure: WARNING: you cannot build DVI versions of the R manuals
configure: WARNING: you cannot build info or HTML versions of the R manuals
configure: WARNING: you cannot build PDF versions of the R manuals
configure: WARNING: I could not determine a browser
configure: WARNING: I could not determine a PDF viewer

----------------------------------------------------------------


When trying to compile(gmake), I get the following error message.
First for R-2.7.0 and second for R-2.7.1.


-------------------------------------------------------------------------
make[3]: Entering directory `/my_buildR_dir/R-2.7.0/src/library/splines'
building package 'splines'
make[4]: Entering directory `/my_buildR_dir/R-2.7.0/src/library/splines/src'
make[5]: Entering directory `/my_buildR_dir/R-2.7.0/src/library/splines/src'
make[5]: `Makedeps' is up to date.
make[5]: Leaving directory `/my_buildR_dir/R-2.7.0/src/library/splines/src'
make[5]: Entering directory `/my_buildR_dir/R-2.7.0/src/library/splines/src'
xlc_r -q64 -qlanglvl=extc99 -I../../../../include
-I/my_libiconv_dir/include -I/usr/lpp/X11/include/X11      -O -qstrict
-c splines.c -o splines.o
xlc_r -q64 -qlanglvl=extc99 -Wl,-brtl -Wl,-G -Wl,-bexpall
-Wl,-bnoentry -lc -L/my_libiconv_dir/lib -L/usr/lib -L/usr/X11R6/lib
-L/my_buildR_dir/R-2.7.0/lib -o splines.so splines.o   -lm
-L../../../../lib -lR
make[5]: Leaving directory `/my_buildR_dir/R-2.7.0/src/library/splines/src'
make[4]: Leaving directory `/my_buildR_dir/R-2.7.0/src/library/splines/src'
Error in dyn.load(file, DLLpath = DLLpath, ...) :
  unable to load shared library
'/my_buildR_dir/R-2.7.0/library/stats/libs/stats.so':
  rtld: 0712-001 Symbol d1mach was referenced
      from module
/my_buildR_dir/R-2.7.0/library/stats/libs/stats.so(), but a runtime
definition
            of the symbol was not found.
rtld: 0712-001 Symbol interv was referenced
      from module
/my_buildR_dir/R-2.7.0/library/stats/libs/stats.so(), but a runtime
definition
            of the symbol was not found.
rtld: 0712-002 fatal error: exiting.
Calls: <Anonymous> ... asNamespace -> loadNamespace -> library.dynam -> dyn.load
Execution halted
make[3]: *** [all] Error 1
make[3]: Leaving directory `/my_buildR_dir/R-2.7.0/src/library/splines'
make[2]: *** [R] Error 1
make[2]: Leaving directory `/my_buildR_dir/R-2.7.0/src/library'
make[1]: *** [R] Error 1
make[1]: Leaving directory `/my_buildR_dir/R-2.7.0/src'
make: *** [R] Error 1
--------------------------------------------------------------------------



------------------------------------------------------------------------
make[3]: Leaving directory `/my_buildR_dir/R-2.7.1/src/library/base'
make[3]: Entering directory `/my_buildR_dir/R-2.7.1/src/library/tools'
building package 'tools'
mkdir ../../../library/tools/R
mkdir ../../../library/tools/po
mkdir ../../../library/tools/man
make[4]: Entering directory `/my_buildR_dir/R-2.7.1/src/library/tools/src'
make[5]: Entering directory `/my_buildR_dir/R-2.7.1/src/library/tools/src'
make[5]: `Makedeps' is up to date.
make[5]: Leaving directory `/my_buildR_dir/R-2.7.1/src/library/tools/src'
make[5]: Entering directory `/my_buildR_dir/R-2.7.1/src/library/tools/src'
xlc_r -q64 -qlanglvl=extc99 -I../../../../include
-I/my_libiconv_dir/include -I/usr/lpp/X11/include/X11      -O -qstrict
-c text.c -o text.o
xlc_r -q64 -qlanglvl=extc99 -I../../../../include
-I/my_libiconv_dir/include -I/usr/lpp/X11/include/X11      -O -qstrict
-c init.c -o init.o
xlc_r -q64 -qlanglvl=extc99 -I../../../../include
-I/my_libiconv_dir/include -I/usr/lpp/X11/include/X11      -O -qstrict
-c Rmd5.c -o Rmd5.o
xlc_r -q64 -qlanglvl=extc99 -I../../../../include
-I/my_libiconv_dir/include -I/usr/lpp/X11/include/X11      -O -qstrict
-c md5.c -o md5.o
xlc_r -q64 -qlanglvl=extc99 -Wl,-brtl -Wl,-G -Wl,-bexpall
-Wl,-bnoentry -lc -L/my_libiconv_dir/lib -L/usr/lib -L/usr/X11R6/lib
-L/my_buildR_dir/R-2.7.1/lib -o tools.so text.o init.o Rmd5.o md5.o
-lm
make[5]: Leaving directory `/my_buildR_dir/R-2.7.1/src/library/tools/src'
make[4]: Leaving directory `/my_buildR_dir/R-2.7.1/src/library/tools/src'
Error in dyn.load(file, DLLpath = DLLpath, ...) :
  unable to load shared library
'/my_buildR_dir/R-2.7.1/library/tools/libs/tools.so':
  rtld: 0712-001 Symbol TYPEOF was referenced
      from module
/my_buildR_dir/R-2.7.1/library/tools/libs/tools.so(), but a runtime
definition
            of the symbol was not found.
rtld: 0712-001 Symbol LENGTH was referenced
      from module
/my_buildR_dir/R-2.7.1/library/tools/libs/tools.so(), but a runtime
definition
            of the symbol was not found.
rtld: 0712-001 Symbol R_CHAR was referenced
      from module
/my_buildR_dir/R-2.7.1/library/tools/libs/tools.so(), but a runtime
definition
            of the symbol was not found.
rtld: 0712-001 Symbol Rf_isString was referenced
      from module
/my_buildR_dir/R-2.7.1/library/tools/libs/tools.so(), but a runtime
definition
            of the symbol was not found.
rtld: 0712-002 fatal error: exiting.
Calls: ::: ... tryCatch -> tryCatchList -> tryCatchOne -> <Anonymous>
Execution halted
make[3]: *** [all] Error 1
make[3]: Leaving directory `/my_buildR_dir/R-2.7.1/src/library/tools'
make[2]: *** [R] Error 1
make[2]: Leaving directory `/my_buildR_dir/R-2.7.1/src/library'
make[1]: *** [R] Error 1
make[1]: Leaving directory `/my_buildR_dir/R-2.7.1/src'
make: *** [R] Error 1
-----------------------------------------------------------------------------

You see the symbols d1mach, interv, TYPEOF, R_CHAR and Rf_isString,
were not found. As for the library dependence, I add
/my_libiconv_dir/lib to my LIBPATH to make sure libR.so etc. can find
the libiconv. Thus, stats.so and tools.so could have be loaded. I
don't know where I made a mistake. After looking up the R manual and
diving into Google for help, I've got no usable answer.


Below environment variables may associated:
LIBPATH="/my_libiconv_dir/lib:.:/rnd/homes/my/rdir/AIX/R-2.7.0/lib/R/lib:.:/usr/lib:/lib"
PATH="/rnd/homes/my/rdir/AIX/R-2.7.0/bin:/usr/java5_64/bin:/opt/gnu/bin:/usr/java5/bin:/opt/gnu/bin:/usr/bin:/etc:/usr/sbin:/usr/ucb:/usr/bin/X11:/sbin:/usr/java14/jre/bin:/usr/java14/bin:/usr/vacpp/bin:/usr/local/bin:/usr/idebug:."
R_HOME="/rnd/homes/my/rdir/AIX/R-2.7.0"



Thank you in advance,
Foylong


From schmidb at ibe.med.uni-muenchen.de  Fri Jul 18 14:23:46 2008
From: schmidb at ibe.med.uni-muenchen.de (Markus Schmidberger)
Date: Fri, 18 Jul 2008 14:23:46 +0200
Subject: [Rd] experinental revision of the 'snow' package
In-Reply-To: <alpine.LFD.1.10.0807071244250.2699@nokomis.stat.uiowa.edu>
References: <alpine.DEB.1.00.0807041822230.11721@luke-inspiron>
	<4871FE38.6060509@ibe.med.uni-muenchen.de>
	<alpine.LFD.1.10.0807071244250.2699@nokomis.stat.uiowa.edu>
Message-ID: <48808B52.50405@ibe.med.uni-muenchen.de>

Hello Luke,

at our windows cluster everything is working very well. We have 8 nodes, 
WindowsServer2003 and mpich2 (1.0.7).
Attached a small testcode and sessionInfo()

I did some bigger tests using my "afyPara" package. There were no problems.
There was an other discussion at the Rd list. Giuseppe confirmed, that 
DeinoMPI & Rmpi & the new version of snow is working very well.

See you in Seattle at the BioC2008 or Developer Day? I will fly to 
Seattle tomorrow.

Best regards
Markus



 > library(Rmpi)
 > library(snow)
 > c1<-makeCluster(3)
        3 slaves are spawned successfully. 0 failed.
 > clusterEvalQ(c1, Sys.info()["nodename"])
[[1]]
nodename
   "CL1"

[[2]]
nodename
   "CL2"

[[3]]
nodename
   "CL3"

 > stopCluster(c1)
[1] 1
 >
 > sessionInfo()
R version 2.7.1 (2008-06-23)
i386-pc-mingw32

locale:
LC_COLLATE=German_Germany.1252;LC_CTYPE=German_Germany.1252;LC_MONETARY=German_Germany.1252;LC_NUMERIC=C;LC_TIME=German_Germany.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base    

other attached packages:
[1] snow_0.3-3 Rmpi_0.5-5




Luke Tierney schrieb:
> Thanks.
>
> Did you have a chance to check this on your WIndows setup?
>
> Best,
>
> luke
>
> On Mon, 7 Jul 2008, Markus Schmidberger wrote:
>
>> Hello Luke,
>>
>> I did several test with our affyPara Testcode. Everything was working 
>> very well. I think you improved error-handling?
>> It would be great to have a kind of change log in the package. To 
>> know the latest changes.
>>
>> Our system:
>> Linux, Suse, max. 120 nodes, LAM/MPI: 7.1.3
>>
>> R version 2.7.1 (2008-06-23)
>> x86_64-unknown-linux-gnu
>>
>> locale:
>> LC_CTYPE=de_DE.UTF-8;LC_NUMERIC=C;LC_TIME=de_DE.UTF-8;LC_COLLATE=de_DE.UTF-8;LC_MONETARY=C;LC_MESSAGES=de_DE.UTF-8;LC_PAPER=de_DE.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=de_DE.UTF-8;LC_IDENTIFICATION=C 
>>
>>
>> attached base packages:
>> [1] tools     stats     graphics  grDevices utils     datasets  
>> methods [8] base other attached packages:
>> [1] hgu95acdf_2.2.0      Rmpi_0.5-6           affyPara_1.1.5     [4] 
>> snow_0.3-3           affy_1.18.2          preprocessCore_1.2.0
>> [7] affyio_1.8.0         Biobase_2.0.1
>> Best regards form Munich
>> Markus
>>
>>
>>
>> Luke Tierney schrieb:
>>> A new version of the 'snow' package for parallel computing in R is
>>> available at
>>>
>>>      http://www.stat.uiowa.edu/~luke/R/cluster/snow_0.3-3.tar.gz
>>>
>>> This substantially revises the way in which worker processes are
>>> started to allow snow to be used on Windows and Mac/Windows/Linux
>>> combinations. I have successfully used the SOCK version on a
>>> standalone Windows machine and combinations of Windows and Linux; the
>>> MPI version also works for me with DeinoMPI and the Rmpi verision for
>>> DeinoMPI.
>>>
>>> I would welcome it if some current snow users could try this verison
>>> in their settings to help iron out any major issues I missed before
>>> release to CRAN.
>>>
>>> Thanks,
>>>
>>> luke
>>>
>>
>>
>>
>


-- 
Dipl.-Tech. Math. Markus Schmidberger

Ludwig-Maximilians-Universit?t M?nchen
IBE - Institut f?r medizinische Informationsverarbeitung,
Biometrie und Epidemiologie
Marchioninistr. 15, D-81377 Muenchen
URL: http://ibe.web.med.uni-muenchen.de 
Mail: Markus.Schmidberger [at] ibe.med.uni-muenchen.de
Tel: +49 (089) 7095 - 4599


From foylong at gmail.com  Fri Jul 18 17:16:28 2008
From: foylong at gmail.com (=?ISO-8859-1?Q?F=E1n_L=F3ng?=)
Date: Fri, 18 Jul 2008 23:16:28 +0800
Subject: [Rd] AIX 5.3 --enable-R-shlib --with-x ---with-iconv make error
	with R-2.7.0 and R-2.7.1
In-Reply-To: <e936a3d0807170838g540bb139ncca3b2eb64e0286@mail.gmail.com>
References: <e936a3d0807170359p62155163oe85a437d91506b98@mail.gmail.com>
	<dc41e1260807170812q32f9e9f1y4599dfbbbb348f53@mail.gmail.com>
	<e936a3d0807170838g540bb139ncca3b2eb64e0286@mail.gmail.com>
Message-ID: <e936a3d0807180816w5a4e92b3m193b9a6bfc757d79@mail.gmail.com>

Build success!

I just use the files out here:
http://prs.ism.ac.jp/~nakama/AIX/changefiles to patch my R-2.7.0 and
add export OBJECT_MODE=64 to my configure parameter. It works.

Thank you very much for your help, Ei-ji.


2008/7/17 F??n L??ng <foylong at gmail.com>:
> Thank you, Ei-ji.
>
> I haven't tried the aix_R-2.7.1_Rshlib_include_configure.patch for two reason:
> #1 I have to compile R2.7.0 although I can reproduce the trouble on R-2.7.1.
> #2 Actually, I don't know how to use this patch to R-2.7.1. Does this
> need AIX admin permission?
>
> And thanks for telling me the pacthed R-2.7.1.aix080701.tar.gz, I will
> try this and let you know the result. BTW: do we also have a patched
> R-2.7.0?
>
> I will also try to export OBJECT_MODE=64 before configuring without
> --with-libiconv-prefix and remove JAVA path from PATH of when
> compiling R.
>
> In a word, thank you very much for taking care of this.
>
> Regards,
> Long
>
> On Thu, Jul 17, 2008 at 11:12 PM, Ei-ji Nakama <nakama at ki.rim.or.jp> wrote:
>> Hi, sorry buggy English.
>>
>> Did you cook this patch?
>> http://prs.ism.ac.jp/~nakama/AIX/aix_R-2.7.1_Rshlib_include_configure.patch
>>
>> However, cooking of this patch is bad on AIX.
>> Therefore I put the thing which was finished with cooking.
>>
>> http://prs.ism.ac.jp/~nakama/AIX/R-2.7.1.aix080701.tar.gz
>>
>> I do a wish of tasting to you.
>>
>> 2008/7/17 F??n L??ng <foylong at gmail.com>:
>>> ----------------------------------------------------------
>>> ./configure \
>>>           CC="xlc_r -q64" \
>>>           CFLAGS="-O -qstrict" \
>>>           CXX="xlC_r -q64" \
>>>           CXXFLAGS="-O -qstrict" \
>>>           F77="xlf_r -q64" \
>>>           AR="ar -X64" \
>>>           CPPFLAGS="-I/my_libiconv_dir/include -I/usr/lpp/X11/include/X11" \
>>>           LDFLAGS="-L/my_libiconv_dir/lib -L/usr/lib -L/usr/X11R6/lib
>>> -L/my_buildR_dir/R-2.7.0/lib" \
>>>           --prefix=/my_R_dir \
>>>           --enable-R-shlib \
>>>           --enable-BLAS-shlib \
>>>           --with-x \
>>>           --with-readline=no \
>>>           --with-libiconv-prefix="/my_libiconv_dir"
>>
>> ``export OBJECT_MODE=64'' had better set it.
>> --with-libiconv-prefix are not reflected.
>>
>>>  Options enabled:           shared BLAS, R profiling, Java
>>
>> libjpeg and libjpeg-6b of java do conflict in my environment.
>> I remove PATH of the JAVA at the time of the construction.
>>
>>> You see the symbols d1mach, interv, TYPEOF, R_CHAR and Rf_isString,
>>> were not found. As for the library dependence, I add
>>> /my_libiconv_dir/lib to my LIBPATH to make sure libR.so etc. can find
>>> the libiconv. Thus, stats.so and tools.so could have be loaded. I
>>> don't know where I made a mistake. After looking up the R manual and
>>> diving into Google for help, I've got no usable answer.
>>
>> I had the sense that GC of ld turned into recently.
>> Probably former specifications may be bugs.
>>
>>> Below environment variables may associated:
>>> LIBPATH="/my_libiconv_dir/lib:.:/rnd/homes/my/rdir/AIX/R-2.7.0/lib/R/lib:.:/usr/lib:/lib"
>>     <snip>
>>> R_HOME="/rnd/homes/my/rdir/AIX/R-2.7.0"
>>
>> Because R add it in a shell of ``bin/R'', let's add LIBPATH when it
>> was said that there is not it.
>>
>> best,
>> --
>> EI-JI Nakama <nakama (a) ki.rim.or.jp>
>> "\u4e2d\u9593\u6804\u6cbb" <nakama (a) ki.rim.or.jp>
>>
>
>
>
> --
> ?????????x??????????????
>



-- 
?????????x??????????????

From bill at insightful.com  Fri Jul 18 19:11:53 2008
From: bill at insightful.com (Bill Dunlap)
Date: Fri, 18 Jul 2008 10:11:53 -0700 (PDT)
Subject: [Rd] Checking package help file examples
In-Reply-To: <200807180805.09930.arne.henningsen@googlemail.com>
References: <Pine.GSO.4.56.0807171703500.13491@devsun3201.insightful.com>
	<200807180805.09930.arne.henningsen@googlemail.com>
Message-ID: <Pine.GSO.4.56.0807180948520.25394@devsun3201.insightful.com>

On Fri, 18 Jul 2008, Arne Henningsen wrote:

> On Friday 18 July 2008 02:19:14, Bill Dunlap wrote:
> > I am trying to figure out the sanctioned way for
> > 'R CMD check pkg' to make sure that the examples
> > in help files give the expected results.
> >
> > Writing R Extensions says that check runs the help
> > file examples (which INSTALL extracts from pkg/man/*.Rd
> > and puts into files in pkg/R-ex).  It looks like check
> > concatenates all the example files, pkg/R-ex/*.R, into one
> > file, pkg/pkg-Ex.R, which it runs to produce pkg/pkg-Ex.Rout.
> > If there is an error running these files then check aborts.
> >
> > I don't seen anything in Writing R Extensions about
> > checking that correct results were produced.  However,
> > in R 2.7.0, check will compare pkg/pkg-Ex.Rout to
> > pkg/tests/Examples/pkg/pkg-Ex.Rout.save, if the latter

oops: pkg/tests/Examples/pkg-Ex.Rout.save

> > file is in your package source, and report any differences.
> >
> > I don't see any mention of this and was wondering if this
> > method should be recommended or if there was a preferred
> > way to check help file examples for correctness.  (It would
> > be nicer if the example() function could also check for
> > correctness, and the above method doesn't allow for that.)
>
> I use *.R and corresponding *.Rout.save files in the subdirectory "tests" for
> checking packages (see e.g., packages systemfit, micEcon,
> sampleSelection, ...). I think that it is better to separate examples from
> testing, because IMHO there should be a few simple examples but tests should
> contain many different function calls with (partly) unusual arguments to
> check (nearly) the entire functionality of each function.
>
> See also the manual "Writing R Extensions"
> http://cran.r-project.org/doc/manuals/R-exts.html#Package-subdirectories

My question was about the undocumented code in R_HOME/bin/check
that compares the output from running the help file examples,
pkg.Rcheck/pkg-Ex.Rout, to the file pkg/tests/Examples/pkg-Ex.Rout.save,
if the latter file is in the package source.

        $log->checking("examples");
        ... ${pkgname}-Ex.R was created by massage-Examples.pl ...
        ... run "R < ${pkgname}-Ex.R > ${pkgname}-Ex.Rout" ...
        ## Try to compare results from running the examples to a saved
        ## previous version.
        my $Rex_out_save =
            &file_path($pkgdir, "tests", "Examples",
                       "${pkgname}-Ex.Rout.save");
        if(-f $Rex_out_save) {
            $log->checking("differences from '${pkgname}-Ex.Rout' to '${pkgname}-Ex.Rout.save'");
            $cmd = join(" ",
                        (${R::Vars::R_CMD},
                         "Rdiff",
                         &shell_quote_file_path("${pkgname}-Ex.Rout"),
                         &shell_quote_file_path("${Rex_out_save}"),
                         "0"));
            if(R_system($cmd)) {
                $log->error();
                $log->print("Comparison failed.\n");
                exit(1);
            }
            $log->result("OK");
        }
    }

A package writer noticed the pkg-Ex.Rout file created by
check and wondered if this was ever compared to a Rout.save
file as is done with other Rout files and I noticed the
above perl code that did so.  I didn't see any CRAN packages
that had a tests/Examples/pkg-Ex.Rout.save file, but some
have a pkg-Ex.Rout.save in a different place.

Should we document the current behavior (should I use this
scheme in Splus packages)?  Should we get rid of the code
or put in comments that it should not be used?

If I were writing this from scratch, I would not put all
the example output into one Rout or Rout.save file, but
put use one Rout file per help file.  Then the results
would not depend on the local collating order.

I agree that detailed tests belong in tests, but since check
runs the help file example to make sure they don't throw
errors, it seems reasonable to also check that they give
the expected results.

> Arne Henningsen
> http://www.arne-henningsen.name

----------------------------------------------------------------------------
Bill Dunlap
Insightful Corporation
bill at insightful dot com

 "All statements in this message represent the opinions of the author and do
 not necessarily reflect Insightful Corporation policy or position."


From forum.query at gmail.com  Sat Jul 19 00:17:31 2008
From: forum.query at gmail.com (egc)
Date: Fri, 18 Jul 2008 18:17:31 -0400
Subject: [Rd] symbolic linking libs | thanks!
Message-ID: <458675ec0807181517w6865c41wa47e2637235be5d6@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20080718/23958d5f/attachment.pl>

From ldimitro at wfubmc.edu  Sat Jul 19 00:57:22 2008
From: ldimitro at wfubmc.edu (Latchezar (Lucho) Dimitrov)
Date: Fri, 18 Jul 2008 18:57:22 -0400
Subject: [Rd] symbolic linking libs | thanks!
In-Reply-To: <458675ec0807181517w6865c41wa47e2637235be5d6@mail.gmail.com>
References: <458675ec0807181517w6865c41wa47e2637235be5d6@mail.gmail.com>
Message-ID: <F160BE32A2E5E04497668BBDFE83FEDF24275744@EXCHVS1.medctr.ad.wfubmc.edu>

Just for the records - I suggested write access or even ownership to
/lib.../Blaster dir only, _Blaster only_ that is.

As for the disaster having a guru user is the largest disaster ;-)

Also think twice before giving read access to guru's home dir to
everybody and trice before giving guru control over common executables.

Good luck!

Latchezar

> -----Original Message-----
> From: r-devel-bounces at r-project.org 
> [mailto:r-devel-bounces at r-project.org] On Behalf Of egc
> Sent: Friday, July 18, 2008 6:18 PM
> To: r-devel at r-project.org
> Subject: [Rd] symbolic linking libs | thanks!
> 
> Several good suggestions were sent my way - much appreciated. 
> In my experience, any solution to a problem that gives a user 
> write access to anything other than their own /home 
> directories is a disaster waiting to happen (spoken as 
> someone who has burned in past doing otherwise). So, I'll 
> pursue some approaches that don't reequire the /lib access option.
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 


From hb at stat.berkeley.edu  Sat Jul 19 20:26:03 2008
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Sat, 19 Jul 2008 11:26:03 -0700
Subject: [Rd] Clash between 'Cairo' and 'EBImage' packages on Windows
Message-ID: <59d7961d0807191126m63511789nf2edbbe45c36aef3@mail.gmail.com>

Hi,

on Windows XP Pro with R version 2.7.1 Patched (2008-06-27 r46012) the
'Cairo' and the 'EBImage' packages does not play well together.

Loading EBImage before Cairo cause the following to happen:

# Rterm --vanilla
> library(EBImage);
> library(Cairo)
Error in inDL(x, as.logical(local), as.logical(now), ...) :
  unable to load shared library 'C:/PROGRA~1/R/R-2.7.1pat/library/Cairo/libs/Cai
ro.dll':
  LoadLibrary failure:  The specified procedure could not be found.

Error : .onLoad failed in 'loadNamespace' for 'Cairo'
Error: package/namespace load failed for 'Cairo'

with a dialog titled 'Rterm.exe - Entry Point Not Found' saying 'The
procedure entry point cairo_pdf_surface_create could not be located in
the dynamic link library libcairo-2.dll'.

Loading the packages in the reverse order works, but the Rterm seems
unstable, e.g. calling q() immediately after will exit the R session
without questions:

# Rterm --vanilla
> library(Cairo)
> library(EBImage)
> q()
[Immediately back to the command line].

I cannot reproduce the problem on R v2.7.1 on Ubuntu Hardy.

> sessionInfo()
R version 2.7.1 Patched (2008-06-27 r46012)
i386-pc-mingw32

locale:
LC_COLLATE=English_United States.1252;LC_CTYPE=English_United States.1252;LC_MON
ETARY=English_United States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252


attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] EBImage_2.4.0 Cairo_1.4-2

Cheers

Henrik


From jh910 at juno.com  Sat Jul 19 22:24:30 2008
From: jh910 at juno.com (J. R. M. Hosking)
Date: Sat, 19 Jul 2008 16:24:30 -0400
Subject: [Rd] axis() ignores supplied value of argument mgp[3]?
Message-ID: <g5tihu$k8u$1@ger.gmane.org>

It seems that when an argument 'mgp' is supplied to axis(),
the mgp[2] value (position of tick mark labels) is honoured
but the mgp[3] value (position of axis line) is ignored.
Example:

   plot(1:5, xaxt='n', ann=FALSE)
   par(mgp=c(0,2,1))
   axis(1, at=2:4, mgp=c(0,-2,-3))

Axis line is plotted at margin line 1, tick mark labels at line -3.

Is this a bug?


J. R. M. Hosking



 > R.version
                _
platform       i386-pc-mingw32
arch           i386
os             mingw32
system         i386, mingw32
status
major          2
minor          7.1
year           2008
month          06
day            23
svn rev        45970
language       R
version.string R version 2.7.1 (2008-06-23)


From ripley at stats.ox.ac.uk  Sun Jul 20 09:22:10 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sun, 20 Jul 2008 08:22:10 +0100 (BST)
Subject: [Rd] multiple names to assign
In-Reply-To: <4879CD49.2080406@pburns.seanet.com>
References: <4879CD49.2080406@pburns.seanet.com>
Message-ID: <alpine.LFD.1.10.0807200807530.11304@gannet.stats.ox.ac.uk>

Warning does seem sensible (and there is already a test for length > 0), 
so I've added one.

Generally R has followed the Unix philosophy of not chatting and trying to 
make sense of the user's inputs (although it has multiple authors, and 
some advocate more of what others see as nannying).  We do see enough 
'what does this error message mean' about *warnings* on R-help to see the 
downside.

On Sun, 13 Jul 2008, Patrick Burns wrote:

> 'assign' does not give a warning if 'x' has length
> greater than 1 -- it just uses the first element:
>
> assign(c('a1', 'a2'), 1:2)
>
> One way of thinking about this is that people using 'assign' get what 
> they deserve.

Or possibly intend, although as the help page incorrectly suggested that 
a quoted character string was needed, they would have had to have read 
the source code to know what should happen.

> The other is that it is used seldom enough that adding a warning isn't 
> going to slow things down appreciably.
>
> Patrick Burns
> patrick at burns-stat.com
> +44 (0)20 8525 0696
> http://www.burns-stat.com
> (home of S Poetry and "A Guide for the Unwilling S User")

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From lgautier at gmail.com  Sun Jul 20 15:01:59 2008
From: lgautier at gmail.com (Laurent Gautier)
Date: Sun, 20 Jul 2008 15:01:59 +0200
Subject: [Rd] garbage collection, "preserved" variables,
	and different outcome depending on "--verbose" or not
Message-ID: <27d1e6020807200601q41312608x7c1c2c5864c83068@mail.gmail.com>

Dear list,

While trying to identify the root of a problem I am having with
garbage collected variables,
I have come across the following oddity: depending on whether --verbose is set
or not, I obtain different results.

I have made a small standalone example to demonstrate it.
The example is very artificial, but I had a hard time reproducing
reliably the problem.

So when I do: (the content of test.R is at the end of this email)

R --no-save < test.R

[The two last lines of the output are:]
> x[1:3]
[1] 0 0 0

while with

R --verbose --no-save < test.R

[The two last lines of the output are:]
> x[1:3]
[1] 3.733188e-317 3.137345e-317 3.137345e-317


The C code is compiled with:
R CMD SHLIB test_lostobject.c


> sessionInfo()
R version 2.7.1 Patched (2008-07-19 r46081)
x86_64-unknown-linux-gnu

locale:
LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=en_US.UTF-8;LC_COLLATE=en_US.UTF-8;LC_MONETARY=C;LC_MESSAGES=en_US.UTF-8;LC_PAPER=en_US.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US.UTF-8;LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base



### -- file test.R

dyn.load("test_lostobject.so")

x = .Call("lostobject", as.integer(5))

x[1:3]


### ---

###--- file lostobject.c

#include <R.h>
#include <Rdefines.h>



SEXP createObject(void)
{
  SEXP x_R;
  int len_x = 1000000;
  PROTECT(x_R = allocVector(REALSXP, len_x));
  Rprintf("Created 'x' at %p\n", x_R);
  Rprintf("  (mode is %i, length is %i)\n", TYPEOF(x_R), LENGTH(x_R));
  Rprintf("  (first element is %d)\n", REAL(x_R)[0]);
  R_PreserveObject(x_R);
  UNPROTECT(1);
  return x_R;
}

void printObject(SEXP sexp)
{
  Rprintf("object at %p\n", sexp);
  Rprintf("  (mode is %i, length is %i, named is %i)\n",
	  TYPEOF(sexp), LENGTH(sexp), NAMED(sexp));
}

SEXP lostobject(SEXP n_R)
{
  /*
   * This function will:
   * 1- create a numerical vector "x" and "preserve it"
   * 2- make call "list(x)"
   * 3- return "x" to R
   */


  SEXP x_R;
  int i;

  int n = INTEGER(n_R)[0];

  /* Create a numerical vector "x_R" */

  for (i=0; i<n; i++) {
    x_R = createObject();
    R_ReleaseObject(x_R);
    printObject(x_R);
    R_gc();
  }

  x_R = createObject();
  printObject(x_R);
  R_gc();
  R_ReleaseObject(x_R);

  Rprintf("Returning 'x' at %p\n", x_R);
  Rprintf("  (first element is %d)\n", REAL(x_R)[0]);
  return x_R;
}


From murdoch at stats.uwo.ca  Sun Jul 20 15:53:08 2008
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Sun, 20 Jul 2008 09:53:08 -0400
Subject: [Rd] garbage collection, "preserved" variables,
 and different outcome depending on "--verbose" or not
In-Reply-To: <27d1e6020807200601q41312608x7c1c2c5864c83068@mail.gmail.com>
References: <27d1e6020807200601q41312608x7c1c2c5864c83068@mail.gmail.com>
Message-ID: <48834344.603@stats.uwo.ca>

On 20/07/2008 9:01 AM, Laurent Gautier wrote:
> Dear list,
> 
> While trying to identify the root of a problem I am having with
> garbage collected variables,
> I have come across the following oddity: depending on whether --verbose is set
> or not, I obtain different results.

You are working with variables without protecting them, so you just get 
lucky whenever the code works.

More below...

> 
> I have made a small standalone example to demonstrate it.
> The example is very artificial, but I had a hard time reproducing
> reliably the problem.
> 
> So when I do: (the content of test.R is at the end of this email)
> 
> R --no-save < test.R
> 
> [The two last lines of the output are:]
>> x[1:3]
> [1] 0 0 0
> 
> while with
> 
> R --verbose --no-save < test.R
> 
> [The two last lines of the output are:]
>> x[1:3]
> [1] 3.733188e-317 3.137345e-317 3.137345e-317
> 
> 
> The C code is compiled with:
> R CMD SHLIB test_lostobject.c
> 
> 
>> sessionInfo()
> R version 2.7.1 Patched (2008-07-19 r46081)
> x86_64-unknown-linux-gnu
> 
> locale:
> LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=en_US.UTF-8;LC_COLLATE=en_US.UTF-8;LC_MONETARY=C;LC_MESSAGES=en_US.UTF-8;LC_PAPER=en_US.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US.UTF-8;LC_IDENTIFICATION=C
> 
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
> 
> 
> 
> ### -- file test.R
> 
> dyn.load("test_lostobject.so")
> 
> x = .Call("lostobject", as.integer(5))
> 
> x[1:3]
> 
> 
> ### ---
> 
> ###--- file lostobject.c
> 
> #include <R.h>
> #include <Rdefines.h>
> 
> 
> 
> SEXP createObject(void)
> {
>   SEXP x_R;
>   int len_x = 1000000;
>   PROTECT(x_R = allocVector(REALSXP, len_x));
>   Rprintf("Created 'x' at %p\n", x_R);
>   Rprintf("  (mode is %i, length is %i)\n", TYPEOF(x_R), LENGTH(x_R));
>   Rprintf("  (first element is %d)\n", REAL(x_R)[0]);
>   R_PreserveObject(x_R);
>   UNPROTECT(1);
>   return x_R;
> }
> 
> void printObject(SEXP sexp)
> {
>   Rprintf("object at %p\n", sexp);
>   Rprintf("  (mode is %i, length is %i, named is %i)\n",
> 	  TYPEOF(sexp), LENGTH(sexp), NAMED(sexp));
> }
> 
> SEXP lostobject(SEXP n_R)
> {
>   /*
>    * This function will:
>    * 1- create a numerical vector "x" and "preserve it"
>    * 2- make call "list(x)"
>    * 3- return "x" to R
>    */
> 
> 
>   SEXP x_R;
>   int i;
> 
>   int n = INTEGER(n_R)[0];
> 
>   /* Create a numerical vector "x_R" */
> 
>   for (i=0; i<n; i++) {
>     x_R = createObject();
>     R_ReleaseObject(x_R);

At this point, the variable is unprotected, i.e. you have declared that 
  its memory is free for the taking.  You should not try to do anything 
with it.  printObject calls several functions, and one of those may have 
overwritten the memory.  It's not surprising that different flags 
(--verbose or not) result in different behaviour.

>     printObject(x_R);
>     R_gc();
>   }
> 
>   x_R = createObject();
>   printObject(x_R);
>   R_gc();
>   R_ReleaseObject(x_R);

Same thing here.  x_R is unprotected now, so you shouldn't use it.

Duncan Murdoch

>   Rprintf("Returning 'x' at %p\n", x_R);
>   Rprintf("  (first element is %d)\n", REAL(x_R)[0]);
>   return x_R;
> }
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From lgautier at gmail.com  Sun Jul 20 16:02:57 2008
From: lgautier at gmail.com (Laurent Gautier)
Date: Sun, 20 Jul 2008 16:02:57 +0200
Subject: [Rd] garbage collection, "preserved" variables,
	and different outcome depending on "--verbose" or not
In-Reply-To: <48834344.603@stats.uwo.ca>
References: <27d1e6020807200601q41312608x7c1c2c5864c83068@mail.gmail.com>
	<48834344.603@stats.uwo.ca>
Message-ID: <27d1e6020807200702sbb97febw96a4bbd7cf43b809@mail.gmail.com>

I tripped on that while crafting the example.

The problem still exists when moving the "releases" in the middle,
and removing the last "release".


#include <R.h>
#include <Rdefines.h>


SEXP createObject(void)
{
  SEXP x_R;
  int len_x = 1000000;
  PROTECT(x_R = allocVector(REALSXP, len_x));
  Rprintf("Created 'x' at %p\n", x_R);
  Rprintf("  (mode is %i, length is %i)\n", TYPEOF(x_R), LENGTH(x_R));
  Rprintf("  (first element is %d)\n", REAL(x_R)[0]);
  R_PreserveObject(x_R);
  UNPROTECT(1);
  return x_R;
}

void printObject(SEXP sexp)
{
  Rprintf("object at %p\n", sexp);
  Rprintf("  (mode is %i, length is %i, named is %i)\n",
	  TYPEOF(sexp), LENGTH(sexp), NAMED(sexp));
}

SEXP lostobject(SEXP n_R)
{
  /*
   * This function will:
   * 1- create a numerical vector "x" and "preserve it"
   * 2- make call "list(x)"
   * 3- return "x" to R
   */


  SEXP x_R;
  int i;

  int n = INTEGER(n_R)[0];

  /* Create a numerical vector "x_R" */

  for (i=0; i<n; i++) {
    x_R = createObject();
    printObject(x_R);
    R_ReleaseObject(x_R);
    R_gc();
  }

  x_R = createObject();
  printObject(x_R);
  R_gc();

  Rprintf("Returning 'x' at %p\n", x_R);
  Rprintf("  (first element is %d)\n", REAL(x_R)[0]);
  return x_R;
}


2008/7/20 Duncan Murdoch <murdoch at stats.uwo.ca>:
> On 20/07/2008 9:01 AM, Laurent Gautier wrote:
>>
>> Dear list,
>>
>> While trying to identify the root of a problem I am having with
>> garbage collected variables,
>> I have come across the following oddity: depending on whether --verbose is
>> set
>> or not, I obtain different results.
>
> You are working with variables without protecting them, so you just get
> lucky whenever the code works.
>
> More below...
>
>>
>> I have made a small standalone example to demonstrate it.
>> The example is very artificial, but I had a hard time reproducing
>> reliably the problem.
>>
>> So when I do: (the content of test.R is at the end of this email)
>>
>> R --no-save < test.R
>>
>> [The two last lines of the output are:]
>>>
>>> x[1:3]
>>
>> [1] 0 0 0
>>
>> while with
>>
>> R --verbose --no-save < test.R
>>
>> [The two last lines of the output are:]
>>>
>>> x[1:3]
>>
>> [1] 3.733188e-317 3.137345e-317 3.137345e-317
>>
>>
>> The C code is compiled with:
>> R CMD SHLIB test_lostobject.c
>>
>>
>>> sessionInfo()
>>
>> R version 2.7.1 Patched (2008-07-19 r46081)
>> x86_64-unknown-linux-gnu
>>
>> locale:
>>
>> LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=en_US.UTF-8;LC_COLLATE=en_US.UTF-8;LC_MONETARY=C;LC_MESSAGES=en_US.UTF-8;LC_PAPER=en_US.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US.UTF-8;LC_IDENTIFICATION=C
>>
>> attached base packages:
>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>
>>
>>
>> ### -- file test.R
>>
>> dyn.load("test_lostobject.so")
>>
>> x = .Call("lostobject", as.integer(5))
>>
>> x[1:3]
>>
>>
>> ### ---
>>
>> ###--- file lostobject.c
>>
>> #include <R.h>
>> #include <Rdefines.h>
>>
>>
>>
>> SEXP createObject(void)
>> {
>>  SEXP x_R;
>>  int len_x = 1000000;
>>  PROTECT(x_R = allocVector(REALSXP, len_x));
>>  Rprintf("Created 'x' at %p\n", x_R);
>>  Rprintf("  (mode is %i, length is %i)\n", TYPEOF(x_R), LENGTH(x_R));
>>  Rprintf("  (first element is %d)\n", REAL(x_R)[0]);
>>  R_PreserveObject(x_R);
>>  UNPROTECT(1);
>>  return x_R;
>> }
>>
>> void printObject(SEXP sexp)
>> {
>>  Rprintf("object at %p\n", sexp);
>>  Rprintf("  (mode is %i, length is %i, named is %i)\n",
>>          TYPEOF(sexp), LENGTH(sexp), NAMED(sexp));
>> }
>>
>> SEXP lostobject(SEXP n_R)
>> {
>>  /*
>>   * This function will:
>>   * 1- create a numerical vector "x" and "preserve it"
>>   * 2- make call "list(x)"
>>   * 3- return "x" to R
>>   */
>>
>>
>>  SEXP x_R;
>>  int i;
>>
>>  int n = INTEGER(n_R)[0];
>>
>>  /* Create a numerical vector "x_R" */
>>
>>  for (i=0; i<n; i++) {
>>    x_R = createObject();
>>    R_ReleaseObject(x_R);
>
> At this point, the variable is unprotected, i.e. you have declared that  its
> memory is free for the taking.  You should not try to do anything with it.
>  printObject calls several functions, and one of those may have overwritten
> the memory.  It's not surprising that different flags (--verbose or not)
> result in different behaviour.
>
>>    printObject(x_R);
>>    R_gc();
>>  }
>>
>>  x_R = createObject();
>>  printObject(x_R);
>>  R_gc();
>>  R_ReleaseObject(x_R);
>
> Same thing here.  x_R is unprotected now, so you shouldn't use it.
>
> Duncan Murdoch
>
>>  Rprintf("Returning 'x' at %p\n", x_R);
>>  Rprintf("  (first element is %d)\n", REAL(x_R)[0]);
>>  return x_R;
>> }
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From murdoch at stats.uwo.ca  Sun Jul 20 16:39:33 2008
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Sun, 20 Jul 2008 10:39:33 -0400
Subject: [Rd] garbage collection, "preserved" variables,
 and different outcome depending on "--verbose" or not
In-Reply-To: <27d1e6020807200702sbb97febw96a4bbd7cf43b809@mail.gmail.com>
References: <27d1e6020807200601q41312608x7c1c2c5864c83068@mail.gmail.com>	<48834344.603@stats.uwo.ca>
	<27d1e6020807200702sbb97febw96a4bbd7cf43b809@mail.gmail.com>
Message-ID: <48834E25.2020602@stats.uwo.ca>

On 20/07/2008 10:02 AM, Laurent Gautier wrote:
> I tripped on that while crafting the example.
> 
> The problem still exists when moving the "releases" in the middle,
> and removing the last "release".

I can't spot any problems in the new version of your code, but I can't 
reproduce the problem, either.  So it appears to be system specific -- I 
was using the identical revision as you, but on Windows, not 
"x86_64-unknown-linux-gnu".  What exact Linux is that?  Can others using 
that system (or similar ones) reproduce it?

Duncan Murdoch

> 
> 
> #include <R.h>
> #include <Rdefines.h>
> 
> 
> SEXP createObject(void)
> {
>   SEXP x_R;
>   int len_x = 1000000;
>   PROTECT(x_R = allocVector(REALSXP, len_x));
>   Rprintf("Created 'x' at %p\n", x_R);
>   Rprintf("  (mode is %i, length is %i)\n", TYPEOF(x_R), LENGTH(x_R));
>   Rprintf("  (first element is %d)\n", REAL(x_R)[0]);
>   R_PreserveObject(x_R);
>   UNPROTECT(1);
>   return x_R;
> }
> 
> void printObject(SEXP sexp)
> {
>   Rprintf("object at %p\n", sexp);
>   Rprintf("  (mode is %i, length is %i, named is %i)\n",
> 	  TYPEOF(sexp), LENGTH(sexp), NAMED(sexp));
> }
> 
> SEXP lostobject(SEXP n_R)
> {
>   /*
>    * This function will:
>    * 1- create a numerical vector "x" and "preserve it"
>    * 2- make call "list(x)"
>    * 3- return "x" to R
>    */
> 
> 
>   SEXP x_R;
>   int i;
> 
>   int n = INTEGER(n_R)[0];
> 
>   /* Create a numerical vector "x_R" */
> 
>   for (i=0; i<n; i++) {
>     x_R = createObject();
>     printObject(x_R);
>     R_ReleaseObject(x_R);
>     R_gc();
>   }
> 
>   x_R = createObject();
>   printObject(x_R);
>   R_gc();
> 
>   Rprintf("Returning 'x' at %p\n", x_R);
>   Rprintf("  (first element is %d)\n", REAL(x_R)[0]);
>   return x_R;
> }
> 
> 
> 2008/7/20 Duncan Murdoch <murdoch at stats.uwo.ca>:
>> On 20/07/2008 9:01 AM, Laurent Gautier wrote:
>>> Dear list,
>>>
>>> While trying to identify the root of a problem I am having with
>>> garbage collected variables,
>>> I have come across the following oddity: depending on whether --verbose is
>>> set
>>> or not, I obtain different results.
>> You are working with variables without protecting them, so you just get
>> lucky whenever the code works.
>>
>> More below...
>>
>>> I have made a small standalone example to demonstrate it.
>>> The example is very artificial, but I had a hard time reproducing
>>> reliably the problem.
>>>
>>> So when I do: (the content of test.R is at the end of this email)
>>>
>>> R --no-save < test.R
>>>
>>> [The two last lines of the output are:]
>>>> x[1:3]
>>> [1] 0 0 0
>>>
>>> while with
>>>
>>> R --verbose --no-save < test.R
>>>
>>> [The two last lines of the output are:]
>>>> x[1:3]
>>> [1] 3.733188e-317 3.137345e-317 3.137345e-317
>>>
>>>
>>> The C code is compiled with:
>>> R CMD SHLIB test_lostobject.c
>>>
>>>
>>>> sessionInfo()
>>> R version 2.7.1 Patched (2008-07-19 r46081)
>>> x86_64-unknown-linux-gnu
>>>
>>> locale:
>>>
>>> LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=en_US.UTF-8;LC_COLLATE=en_US.UTF-8;LC_MONETARY=C;LC_MESSAGES=en_US.UTF-8;LC_PAPER=en_US.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US.UTF-8;LC_IDENTIFICATION=C
>>>
>>> attached base packages:
>>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>>
>>>
>>>
>>> ### -- file test.R
>>>
>>> dyn.load("test_lostobject.so")
>>>
>>> x = .Call("lostobject", as.integer(5))
>>>
>>> x[1:3]
>>>
>>>
>>> ### ---
>>>
>>> ###--- file lostobject.c
>>>
>>> #include <R.h>
>>> #include <Rdefines.h>
>>>
>>>
>>>
>>> SEXP createObject(void)
>>> {
>>>  SEXP x_R;
>>>  int len_x = 1000000;
>>>  PROTECT(x_R = allocVector(REALSXP, len_x));
>>>  Rprintf("Created 'x' at %p\n", x_R);
>>>  Rprintf("  (mode is %i, length is %i)\n", TYPEOF(x_R), LENGTH(x_R));
>>>  Rprintf("  (first element is %d)\n", REAL(x_R)[0]);
>>>  R_PreserveObject(x_R);
>>>  UNPROTECT(1);
>>>  return x_R;
>>> }
>>>
>>> void printObject(SEXP sexp)
>>> {
>>>  Rprintf("object at %p\n", sexp);
>>>  Rprintf("  (mode is %i, length is %i, named is %i)\n",
>>>          TYPEOF(sexp), LENGTH(sexp), NAMED(sexp));
>>> }
>>>
>>> SEXP lostobject(SEXP n_R)
>>> {
>>>  /*
>>>   * This function will:
>>>   * 1- create a numerical vector "x" and "preserve it"
>>>   * 2- make call "list(x)"
>>>   * 3- return "x" to R
>>>   */
>>>
>>>
>>>  SEXP x_R;
>>>  int i;
>>>
>>>  int n = INTEGER(n_R)[0];
>>>
>>>  /* Create a numerical vector "x_R" */
>>>
>>>  for (i=0; i<n; i++) {
>>>    x_R = createObject();
>>>    R_ReleaseObject(x_R);
>> At this point, the variable is unprotected, i.e. you have declared that  its
>> memory is free for the taking.  You should not try to do anything with it.
>>  printObject calls several functions, and one of those may have overwritten
>> the memory.  It's not surprising that different flags (--verbose or not)
>> result in different behaviour.
>>
>>>    printObject(x_R);
>>>    R_gc();
>>>  }
>>>
>>>  x_R = createObject();
>>>  printObject(x_R);
>>>  R_gc();
>>>  R_ReleaseObject(x_R);
>> Same thing here.  x_R is unprotected now, so you shouldn't use it.
>>
>> Duncan Murdoch
>>
>>>  Rprintf("Returning 'x' at %p\n", x_R);
>>>  Rprintf("  (first element is %d)\n", REAL(x_R)[0]);
>>>  return x_R;
>>> }
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From lgautier at gmail.com  Sun Jul 20 16:49:28 2008
From: lgautier at gmail.com (Laurent Gautier)
Date: Sun, 20 Jul 2008 16:49:28 +0200
Subject: [Rd] garbage collection, "preserved" variables,
	and different outcome depending on "--verbose" or not
In-Reply-To: <48834E25.2020602@stats.uwo.ca>
References: <27d1e6020807200601q41312608x7c1c2c5864c83068@mail.gmail.com>
	<48834344.603@stats.uwo.ca>
	<27d1e6020807200702sbb97febw96a4bbd7cf43b809@mail.gmail.com>
	<48834E25.2020602@stats.uwo.ca>
Message-ID: <27d1e6020807200749n16726689k8fd995df66a236a6@mail.gmail.com>

2008/7/20 Duncan Murdoch <murdoch at stats.uwo.ca>:
> On 20/07/2008 10:02 AM, Laurent Gautier wrote:
>>
>> I tripped on that while crafting the example.
>>
>> The problem still exists when moving the "releases" in the middle,
>> and removing the last "release".

I also see that the C code contains old/irrelevant comments at the top
of the function
lostobject. Sorry about that, the bug I am chasing is elusive...

> I can't spot any problems in the new version of your code, but I can't
> reproduce the problem, either.  So it appears to be system specific -- I was
> using the identical revision as you, but on Windows, not
> "x86_64-unknown-linux-gnu".  What exact Linux is that?

Ubuntu (hardy heron).
gcc is 4.2.3
The R source was built with "make clean; ./configure --enable-R-shlib"
before running "make; make install"

>  Can others using that system (or similar ones) reproduce it?
>
> Duncan Murdoch
>
>>
>>
>> #include <R.h>
>> #include <Rdefines.h>
>>
>>
>> SEXP createObject(void)
>> {
>>  SEXP x_R;
>>  int len_x = 1000000;
>>  PROTECT(x_R = allocVector(REALSXP, len_x));
>>  Rprintf("Created 'x' at %p\n", x_R);
>>  Rprintf("  (mode is %i, length is %i)\n", TYPEOF(x_R), LENGTH(x_R));
>>  Rprintf("  (first element is %d)\n", REAL(x_R)[0]);
>>  R_PreserveObject(x_R);
>>  UNPROTECT(1);
>>  return x_R;
>> }
>>
>> void printObject(SEXP sexp)
>> {
>>  Rprintf("object at %p\n", sexp);
>>  Rprintf("  (mode is %i, length is %i, named is %i)\n",
>>          TYPEOF(sexp), LENGTH(sexp), NAMED(sexp));
>> }
>>
>> SEXP lostobject(SEXP n_R)
>> {
>>  /*
>>   * This function will:
>>   * 1- create a numerical vector "x" and "preserve it"
>>   * 2- make call "list(x)"
>>   * 3- return "x" to R
>>   */
>>
>>
>>  SEXP x_R;
>>  int i;
>>
>>  int n = INTEGER(n_R)[0];
>>
>>  /* Create a numerical vector "x_R" */
>>
>>  for (i=0; i<n; i++) {
>>    x_R = createObject();
>>    printObject(x_R);
>>    R_ReleaseObject(x_R);
>>    R_gc();
>>  }
>>
>>  x_R = createObject();
>>  printObject(x_R);
>>  R_gc();
>>
>>  Rprintf("Returning 'x' at %p\n", x_R);
>>  Rprintf("  (first element is %d)\n", REAL(x_R)[0]);
>>  return x_R;
>> }
>>
>>
>> 2008/7/20 Duncan Murdoch <murdoch at stats.uwo.ca>:
>>>
>>> On 20/07/2008 9:01 AM, Laurent Gautier wrote:
>>>>
>>>> Dear list,
>>>>
>>>> While trying to identify the root of a problem I am having with
>>>> garbage collected variables,
>>>> I have come across the following oddity: depending on whether --verbose
>>>> is
>>>> set
>>>> or not, I obtain different results.
>>>
>>> You are working with variables without protecting them, so you just get
>>> lucky whenever the code works.
>>>
>>> More below...
>>>
>>>> I have made a small standalone example to demonstrate it.
>>>> The example is very artificial, but I had a hard time reproducing
>>>> reliably the problem.
>>>>
>>>> So when I do: (the content of test.R is at the end of this email)
>>>>
>>>> R --no-save < test.R
>>>>
>>>> [The two last lines of the output are:]
>>>>>
>>>>> x[1:3]
>>>>
>>>> [1] 0 0 0
>>>>
>>>> while with
>>>>
>>>> R --verbose --no-save < test.R
>>>>
>>>> [The two last lines of the output are:]
>>>>>
>>>>> x[1:3]
>>>>
>>>> [1] 3.733188e-317 3.137345e-317 3.137345e-317
>>>>
>>>>
>>>> The C code is compiled with:
>>>> R CMD SHLIB test_lostobject.c
>>>>
>>>>
>>>>> sessionInfo()
>>>>
>>>> R version 2.7.1 Patched (2008-07-19 r46081)
>>>> x86_64-unknown-linux-gnu
>>>>
>>>> locale:
>>>>
>>>>
>>>> LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=en_US.UTF-8;LC_COLLATE=en_US.UTF-8;LC_MONETARY=C;LC_MESSAGES=en_US.UTF-8;LC_PAPER=en_US.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US.UTF-8;LC_IDENTIFICATION=C
>>>>
>>>> attached base packages:
>>>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>>>
>>>>
>>>>
>>>> ### -- file test.R
>>>>
>>>> dyn.load("test_lostobject.so")
>>>>
>>>> x = .Call("lostobject", as.integer(5))
>>>>
>>>> x[1:3]
>>>>
>>>>
>>>> ### ---
>>>>
>>>> ###--- file lostobject.c
>>>>
>>>> #include <R.h>
>>>> #include <Rdefines.h>
>>>>
>>>>
>>>>
>>>> SEXP createObject(void)
>>>> {
>>>>  SEXP x_R;
>>>>  int len_x = 1000000;
>>>>  PROTECT(x_R = allocVector(REALSXP, len_x));
>>>>  Rprintf("Created 'x' at %p\n", x_R);
>>>>  Rprintf("  (mode is %i, length is %i)\n", TYPEOF(x_R), LENGTH(x_R));
>>>>  Rprintf("  (first element is %d)\n", REAL(x_R)[0]);
>>>>  R_PreserveObject(x_R);
>>>>  UNPROTECT(1);
>>>>  return x_R;
>>>> }
>>>>
>>>> void printObject(SEXP sexp)
>>>> {
>>>>  Rprintf("object at %p\n", sexp);
>>>>  Rprintf("  (mode is %i, length is %i, named is %i)\n",
>>>>         TYPEOF(sexp), LENGTH(sexp), NAMED(sexp));
>>>> }
>>>>
>>>> SEXP lostobject(SEXP n_R)
>>>> {
>>>>  /*
>>>>  * This function will:
>>>>  * 1- create a numerical vector "x" and "preserve it"
>>>>  * 2- make call "list(x)"
>>>>  * 3- return "x" to R
>>>>  */
>>>>
>>>>
>>>>  SEXP x_R;
>>>>  int i;
>>>>
>>>>  int n = INTEGER(n_R)[0];
>>>>
>>>>  /* Create a numerical vector "x_R" */
>>>>
>>>>  for (i=0; i<n; i++) {
>>>>   x_R = createObject();
>>>>   R_ReleaseObject(x_R);
>>>
>>> At this point, the variable is unprotected, i.e. you have declared that
>>>  its
>>> memory is free for the taking.  You should not try to do anything with
>>> it.
>>>  printObject calls several functions, and one of those may have
>>> overwritten
>>> the memory.  It's not surprising that different flags (--verbose or not)
>>> result in different behaviour.
>>>
>>>>   printObject(x_R);
>>>>   R_gc();
>>>>  }
>>>>
>>>>  x_R = createObject();
>>>>  printObject(x_R);
>>>>  R_gc();
>>>>  R_ReleaseObject(x_R);
>>>
>>> Same thing here.  x_R is unprotected now, so you shouldn't use it.
>>>
>>> Duncan Murdoch
>>>
>>>>  Rprintf("Returning 'x' at %p\n", x_R);
>>>>  Rprintf("  (first element is %d)\n", REAL(x_R)[0]);
>>>>  return x_R;
>>>> }
>>>>
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From hb at stat.berkeley.edu  Sun Jul 20 20:34:30 2008
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Sun, 20 Jul 2008 11:34:30 -0700
Subject: [Rd] R CMD check test examples with and without Suggest installed
Message-ID: <59d7961d0807201134m28959230ne9212d3b30fc4c7c@mail.gmail.com>

Hi,

is there a way to have R CMD check test the example():s twice, once
with all Suggest package hidden or once, if $R_check_force_suggests=1,
with all Suggest available?

BACKGROUND: I just had a case where my R.matlab package passed all R
CMD checks on my local machine, but when I uploaded it to CRAN it gave
an error there.  R.matlab has Omegahat's 'Rcompression' package listed
under Suggest: in DESCRIPTION.  I've put it there, because it is
optional.  The example(readMat) scans an inst/ directory for *.mat
files and asserts that they can be read.  One of them required
'Rcompression', which is not installed by the CRAN servers.  I can of
course correct this example code to work both with and without
'Rcompression' installed.  But my question is, how can I have R CMD
check test the two cases where optional packages are installed or not,
so I can catch these errors?

The best solution I found was to set $R_check_force_suggests=0 in
$HOME/.R/check.conf and uninstall (or otherwise hide) the Suggest:ed
packages.

Cheers

Henrik


From ggrothendieck at gmail.com  Mon Jul 21 01:51:50 2008
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sun, 20 Jul 2008 19:51:50 -0400
Subject: [Rd] License Conflict?
Message-ID: <971536df0807201651k1f53ca71p8d387b22329bf846@mail.gmail.com>

Is this a true problem?


Artistic License may conflict with GPL
The source code for R contains references to both the GNU General
Public License 2.0 (GPL) and to the Artistic License. These two
licenses include some contradictory restrictions.

The Ohloh source code parser is exhaustive, and can reveal licensing
requirements which the developers themselves may have overlooked or
forgotten.

This message is merely a warning. There may not actually be any
conflict, because the two licenses may not apply to the exact same
sections of code or the code in question may be available under
multiple licenses. You should review the license requirements for this
project carefully, especially if you are using this code for
commercial purposes.

The GNU Project maintains a guide to GPL compatibility at their web site.

Above is at this page:
http://www.ohloh.net/projects/3926/factoids/632981


From bullard at berkeley.edu  Mon Jul 21 04:16:44 2008
From: bullard at berkeley.edu (James Bullard)
Date: Sun, 20 Jul 2008 19:16:44 -0700
Subject: [Rd] confusion about evaluation.
Message-ID: <4451083D-5D36-4219-A9D5-9D2F21253A57@berkeley.edu>

Hi All, I am confused about the following code. I thought that the  
problem stemmed from lazy evaluation and the fact that 'i' is never  
evaluated within the first lapply. However, I am then confused as to  
why it gets bound to the final element of the lapply. The environments  
of the returned functions are indeed different in both cases and each  
environment has a local binding for 'i' it just happens to be 3 --  
which I will say is wrong, but I await reeducation.

I looked for documentation concerning this, but I wasn't able to find  
anything -- I imagine that this must be documented somewhere as it  
appears like a reasonable thing to do.  Thank you as always for any  
insight. -- jim

## doesn't do what I think it should
x <- lapply(1:3, function(i) {
     function() { i^2 }
})
sapply(1:3, function(i) x[[i]]())

[1] 9 9 9

## does what I expect
x <- lapply(1:3, function(i) {
     print(i)
     function() { i^2 }
})
[1] 1
[1] 2
[1] 3

sapply(1:3, function(i) x[[i]]())

[1] 1 4 9


 > sessionInfo()
R version 2.7.1 Patched (2008-07-20 r46088)
i386-apple-darwin9.4.0

locale:
en_US.UTF-8/en_US.UTF-8/C/C/en_US.UTF-8/en_US.UTF-8

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base


From ripley at stats.ox.ac.uk  Mon Jul 21 08:51:29 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 21 Jul 2008 07:51:29 +0100 (BST)
Subject: [Rd] confusion about evaluation.
In-Reply-To: <4451083D-5D36-4219-A9D5-9D2F21253A57@berkeley.edu>
References: <4451083D-5D36-4219-A9D5-9D2F21253A57@berkeley.edu>
Message-ID: <alpine.LFD.1.10.0807210736390.6686@gannet.stats.ox.ac.uk>

On Sun, 20 Jul 2008, James Bullard wrote:

> Hi All, I am confused about the following code. I thought that the problem 
> stemmed from lazy evaluation and the fact that 'i' is never evaluated within 
> the first lapply. However, I am then confused as to why it gets bound to the 
> final element of the lapply.

Correct.  'i' in the environments is a promise, and it gets the value at 
the time the promise is evaluated from the environment in which the 
promise is created.  Since you don't evaluate it until after the lapply, 
the environment in which the promise is evaluated has the final value at 
that time. BTW, the following variant

x <- vector("list", 4)
for(i in 1:3) x[[i]] <- function() i^2
sapply(1:3, function(i) x[[i]]())

works the same way.

Lazy evaluation works somewhat differently in R and in S -- I've never 
seen a comprehensive discussion as to why (nor exactly how it works in 
either system, although there is a lot about promises in the 'R Internals' 
manual).

> The environments of the returned functions are 
> indeed different in both cases and each environment has a local binding for 
> 'i' it just happens to be 3 -- which I will say is wrong, but I await 
> reeducation.
>
> I looked for documentation concerning this, but I wasn't able to find 
> anything -- I imagine that this must be documented somewhere as it appears 
> like a reasonable thing to do.  Thank you as always for any insight. -- jim

> ## doesn't do what I think it should
> x <- lapply(1:3, function(i) {
>   function() { i^2 }
> })
> sapply(1:3, function(i) x[[i]]())
>
> [1] 9 9 9
>
> ## does what I expect
> x <- lapply(1:3, function(i) {
>   print(i)
>   function() { i^2 }
> })
> [1] 1
> [1] 2
> [1] 3
>
> sapply(1:3, function(i) x[[i]]())
>
> [1] 1 4 9
>
>
>> sessionInfo()
> R version 2.7.1 Patched (2008-07-20 r46088)
> i386-apple-darwin9.4.0
>
> locale:
> en_US.UTF-8/en_US.UTF-8/C/C/en_US.UTF-8/en_US.UTF-8
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From maechler at stat.math.ethz.ch  Mon Jul 21 09:40:44 2008
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Mon, 21 Jul 2008 09:40:44 +0200
Subject: [Rd] License Conflict?
In-Reply-To: <971536df0807201651k1f53ca71p8d387b22329bf846@mail.gmail.com>
References: <971536df0807201651k1f53ca71p8d387b22329bf846@mail.gmail.com>
Message-ID: <18564.15740.477341.500548@stat.math.ethz.ch>

>>>>> "GaGr" == Gabor Grothendieck <ggrothendieck at gmail.com>
>>>>>     on Sun, 20 Jul 2008 19:51:50 -0400 writes:

    GaGr> Is this a true problem?

No;  
as Oholoh mentions there are only two files which mention the
artistic licence, namely src/main/apse.[ch]
and these two contain

>> Copyright (C) by Jarkko Hietaniemi, 1998,1999,2000,2001,2002,2003,2006.
>> All Rights Reserved.
>> 
>> This program is free software; you can redistribute it and/or modify
>> it under the terms of either:
>> 
>> a) the GNU Library General Public License as published by the Free
>>    Software Foundation; either version 2, or (at your option) any
>>    later version, or
>> 
>> b) the "Artistic License" which comes with Perl source code.

so they are exactly from the group mentioned below as

  "the code in question may be available under multiple licenses"

Thank you, Gabor, for asking.

Martin Maechler
ETH Zurich and R Core Team


    GaGr> Artistic License may conflict
    GaGr> with GPL The source code for R contains references to
    GaGr> both the GNU General Public License 2.0 (GPL) and to
    GaGr> the Artistic License. These two licenses include some
    GaGr> contradictory restrictions.

    GaGr> The Ohloh source code parser is exhaustive, and can
    GaGr> reveal licensing requirements which the developers
    GaGr> themselves may have overlooked or forgotten.

    GaGr> This message is merely a warning. There may not
    GaGr> actually be any conflict, because the two licenses may
    GaGr> not apply to the exact same sections of code or the
    GaGr> code in question may be available under multiple
    GaGr> licenses. You should review the license requirements
    GaGr> for this project carefully, especially if you are
    GaGr> using this code for commercial purposes.

    GaGr> The GNU Project maintains a guide to GPL compatibility
    GaGr> at their web site.

    GaGr> Above is at this page:
    GaGr> http://www.ohloh.net/projects/3926/factoids/632981

    GaGr> ______________________________________________
    GaGr> R-devel at r-project.org mailing list
    GaGr> https://stat.ethz.ch/mailman/listinfo/r-devel


From ripley at stats.ox.ac.uk  Mon Jul 21 10:22:02 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 21 Jul 2008 09:22:02 +0100 (BST)
Subject: [Rd] License Conflict?
In-Reply-To: <18564.15740.477341.500548@stat.math.ethz.ch>
References: <971536df0807201651k1f53ca71p8d387b22329bf846@mail.gmail.com>
	<18564.15740.477341.500548@stat.math.ethz.ch>
Message-ID: <alpine.LFD.1.10.0807210909230.18856@gannet.stats.ox.ac.uk>

On Mon, 21 Jul 2008, Martin Maechler wrote:

>>>>>> "GaGr" == Gabor Grothendieck <ggrothendieck at gmail.com>
>>>>>>     on Sun, 20 Jul 2008 19:51:50 -0400 writes:
>
>    GaGr> Is this a true problem?
>
> No;
> as Oholoh mentions there are only two files which mention the
> artistic licence, namely src/main/apse.[ch]

Apart from the licences themselves in share/licenses!  There is a 
potential issue with packages that use an Artistic licence (the quoter 
seems ignorant of the fact that there are more than one), but that applies 
to any package license other than GPL2 and is the responsibility of the 
package owner to check.

Also, some files in share/perl are 'under the same terms as Perl itself', 
that is Artistic or GPL.

> and these two contain
>
>>> Copyright (C) by Jarkko Hietaniemi, 1998,1999,2000,2001,2002,2003,2006.
>>> All Rights Reserved.
>>>
>>> This program is free software; you can redistribute it and/or modify
>>> it under the terms of either:
>>>
>>> a) the GNU Library General Public License as published by the Free
>>>    Software Foundation; either version 2, or (at your option) any
>>>    later version, or
>>>
>>> b) the "Artistic License" which comes with Perl source code.
>
> so they are exactly from the group mentioned below as
>
>  "the code in question may be available under multiple licenses"
>
> Thank you, Gabor, for asking.
>
> Martin Maechler
> ETH Zurich and R Core Team
>
>
>    GaGr> Artistic License may conflict
>    GaGr> with GPL The source code for R contains references to
>    GaGr> both the GNU General Public License 2.0 (GPL) and to
>    GaGr> the Artistic License. These two licenses include some
>    GaGr> contradictory restrictions.
>
>    GaGr> The Ohloh source code parser is exhaustive, and can
>    GaGr> reveal licensing requirements which the developers
>    GaGr> themselves may have overlooked or forgotten.
>
>    GaGr> This message is merely a warning. There may not
>    GaGr> actually be any conflict, because the two licenses may
>    GaGr> not apply to the exact same sections of code or the
>    GaGr> code in question may be available under multiple
>    GaGr> licenses. You should review the license requirements
>    GaGr> for this project carefully, especially if you are
>    GaGr> using this code for commercial purposes.
>
>    GaGr> The GNU Project maintains a guide to GPL compatibility
>    GaGr> at their web site.
>
>    GaGr> Above is at this page:
>    GaGr> http://www.ohloh.net/projects/3926/factoids/632981
>
>    GaGr> ______________________________________________
>    GaGr> R-devel at r-project.org mailing list
>    GaGr> https://stat.ethz.ch/mailman/listinfo/r-devel
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From lgautier at gmail.com  Mon Jul 21 10:40:51 2008
From: lgautier at gmail.com (Laurent Gautier)
Date: Mon, 21 Jul 2008 10:40:51 +0200
Subject: [Rd] garbage collection, "preserved" variables,
	and different outcome depending on "--verbose" or not
In-Reply-To: <27d1e6020807200749n16726689k8fd995df66a236a6@mail.gmail.com>
References: <27d1e6020807200601q41312608x7c1c2c5864c83068@mail.gmail.com>
	<48834344.603@stats.uwo.ca>
	<27d1e6020807200702sbb97febw96a4bbd7cf43b809@mail.gmail.com>
	<48834E25.2020602@stats.uwo.ca>
	<27d1e6020807200749n16726689k8fd995df66a236a6@mail.gmail.com>
Message-ID: <27d1e6020807210140g59953186qd34c47cfb9eb0e73@mail.gmail.com>

I just tried with R-devel (2.8.0 Under development (unstable)
(2008-07-20 r46088),
the problem does not appear with that version.

Thanks,


L.




2008/7/20 Laurent Gautier <lgautier at gmail.com>:
> 2008/7/20 Duncan Murdoch <murdoch at stats.uwo.ca>:
>> On 20/07/2008 10:02 AM, Laurent Gautier wrote:
>>>
>>> I tripped on that while crafting the example.
>>>
>>> The problem still exists when moving the "releases" in the middle,
>>> and removing the last "release".
>
> I also see that the C code contains old/irrelevant comments at the top
> of the function
> lostobject. Sorry about that, the bug I am chasing is elusive...
>
>> I can't spot any problems in the new version of your code, but I can't
>> reproduce the problem, either.  So it appears to be system specific -- I was
>> using the identical revision as you, but on Windows, not
>> "x86_64-unknown-linux-gnu".  What exact Linux is that?
>
> Ubuntu (hardy heron).
> gcc is 4.2.3
> The R source was built with "make clean; ./configure --enable-R-shlib"
> before running "make; make install"
>
>>  Can others using that system (or similar ones) reproduce it?
>>
>> Duncan Murdoch
>>
>>>
>>>
>>> #include <R.h>
>>> #include <Rdefines.h>
>>>
>>>
>>> SEXP createObject(void)
>>> {
>>>  SEXP x_R;
>>>  int len_x = 1000000;
>>>  PROTECT(x_R = allocVector(REALSXP, len_x));
>>>  Rprintf("Created 'x' at %p\n", x_R);
>>>  Rprintf("  (mode is %i, length is %i)\n", TYPEOF(x_R), LENGTH(x_R));
>>>  Rprintf("  (first element is %d)\n", REAL(x_R)[0]);
>>>  R_PreserveObject(x_R);
>>>  UNPROTECT(1);
>>>  return x_R;
>>> }
>>>
>>> void printObject(SEXP sexp)
>>> {
>>>  Rprintf("object at %p\n", sexp);
>>>  Rprintf("  (mode is %i, length is %i, named is %i)\n",
>>>          TYPEOF(sexp), LENGTH(sexp), NAMED(sexp));
>>> }
>>>
>>> SEXP lostobject(SEXP n_R)
>>> {
>>>  /*
>>>   * This function will:
>>>   * 1- create a numerical vector "x" and "preserve it"
>>>   * 2- make call "list(x)"
>>>   * 3- return "x" to R
>>>   */
>>>
>>>
>>>  SEXP x_R;
>>>  int i;
>>>
>>>  int n = INTEGER(n_R)[0];
>>>
>>>  /* Create a numerical vector "x_R" */
>>>
>>>  for (i=0; i<n; i++) {
>>>    x_R = createObject();
>>>    printObject(x_R);
>>>    R_ReleaseObject(x_R);
>>>    R_gc();
>>>  }
>>>
>>>  x_R = createObject();
>>>  printObject(x_R);
>>>  R_gc();
>>>
>>>  Rprintf("Returning 'x' at %p\n", x_R);
>>>  Rprintf("  (first element is %d)\n", REAL(x_R)[0]);
>>>  return x_R;
>>> }
>>>
>>>
>>> 2008/7/20 Duncan Murdoch <murdoch at stats.uwo.ca>:
>>>>
>>>> On 20/07/2008 9:01 AM, Laurent Gautier wrote:
>>>>>
>>>>> Dear list,
>>>>>
>>>>> While trying to identify the root of a problem I am having with
>>>>> garbage collected variables,
>>>>> I have come across the following oddity: depending on whether --verbose
>>>>> is
>>>>> set
>>>>> or not, I obtain different results.
>>>>
>>>> You are working with variables without protecting them, so you just get
>>>> lucky whenever the code works.
>>>>
>>>> More below...
>>>>
>>>>> I have made a small standalone example to demonstrate it.
>>>>> The example is very artificial, but I had a hard time reproducing
>>>>> reliably the problem.
>>>>>
>>>>> So when I do: (the content of test.R is at the end of this email)
>>>>>
>>>>> R --no-save < test.R
>>>>>
>>>>> [The two last lines of the output are:]
>>>>>>
>>>>>> x[1:3]
>>>>>
>>>>> [1] 0 0 0
>>>>>
>>>>> while with
>>>>>
>>>>> R --verbose --no-save < test.R
>>>>>
>>>>> [The two last lines of the output are:]
>>>>>>
>>>>>> x[1:3]
>>>>>
>>>>> [1] 3.733188e-317 3.137345e-317 3.137345e-317
>>>>>
>>>>>
>>>>> The C code is compiled with:
>>>>> R CMD SHLIB test_lostobject.c
>>>>>
>>>>>
>>>>>> sessionInfo()
>>>>>
>>>>> R version 2.7.1 Patched (2008-07-19 r46081)
>>>>> x86_64-unknown-linux-gnu
>>>>>
>>>>> locale:
>>>>>
>>>>>
>>>>> LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=en_US.UTF-8;LC_COLLATE=en_US.UTF-8;LC_MONETARY=C;LC_MESSAGES=en_US.UTF-8;LC_PAPER=en_US.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US.UTF-8;LC_IDENTIFICATION=C
>>>>>
>>>>> attached base packages:
>>>>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>>>>
>>>>>
>>>>>
>>>>> ### -- file test.R
>>>>>
>>>>> dyn.load("test_lostobject.so")
>>>>>
>>>>> x = .Call("lostobject", as.integer(5))
>>>>>
>>>>> x[1:3]
>>>>>
>>>>>
>>>>> ### ---
>>>>>
>>>>> ###--- file lostobject.c
>>>>>
>>>>> #include <R.h>
>>>>> #include <Rdefines.h>
>>>>>
>>>>>
>>>>>
>>>>> SEXP createObject(void)
>>>>> {
>>>>>  SEXP x_R;
>>>>>  int len_x = 1000000;
>>>>>  PROTECT(x_R = allocVector(REALSXP, len_x));
>>>>>  Rprintf("Created 'x' at %p\n", x_R);
>>>>>  Rprintf("  (mode is %i, length is %i)\n", TYPEOF(x_R), LENGTH(x_R));
>>>>>  Rprintf("  (first element is %d)\n", REAL(x_R)[0]);
>>>>>  R_PreserveObject(x_R);
>>>>>  UNPROTECT(1);
>>>>>  return x_R;
>>>>> }
>>>>>
>>>>> void printObject(SEXP sexp)
>>>>> {
>>>>>  Rprintf("object at %p\n", sexp);
>>>>>  Rprintf("  (mode is %i, length is %i, named is %i)\n",
>>>>>         TYPEOF(sexp), LENGTH(sexp), NAMED(sexp));
>>>>> }
>>>>>
>>>>> SEXP lostobject(SEXP n_R)
>>>>> {
>>>>>  /*
>>>>>  * This function will:
>>>>>  * 1- create a numerical vector "x" and "preserve it"
>>>>>  * 2- make call "list(x)"
>>>>>  * 3- return "x" to R
>>>>>  */
>>>>>
>>>>>
>>>>>  SEXP x_R;
>>>>>  int i;
>>>>>
>>>>>  int n = INTEGER(n_R)[0];
>>>>>
>>>>>  /* Create a numerical vector "x_R" */
>>>>>
>>>>>  for (i=0; i<n; i++) {
>>>>>   x_R = createObject();
>>>>>   R_ReleaseObject(x_R);
>>>>
>>>> At this point, the variable is unprotected, i.e. you have declared that
>>>>  its
>>>> memory is free for the taking.  You should not try to do anything with
>>>> it.
>>>>  printObject calls several functions, and one of those may have
>>>> overwritten
>>>> the memory.  It's not surprising that different flags (--verbose or not)
>>>> result in different behaviour.
>>>>
>>>>>   printObject(x_R);
>>>>>   R_gc();
>>>>>  }
>>>>>
>>>>>  x_R = createObject();
>>>>>  printObject(x_R);
>>>>>  R_gc();
>>>>>  R_ReleaseObject(x_R);
>>>>
>>>> Same thing here.  x_R is unprotected now, so you shouldn't use it.
>>>>
>>>> Duncan Murdoch
>>>>
>>>>>  Rprintf("Returning 'x' at %p\n", x_R);
>>>>>  Rprintf("  (first element is %d)\n", REAL(x_R)[0]);
>>>>>  return x_R;
>>>>> }
>>>>>
>>>>> ______________________________________________
>>>>> R-devel at r-project.org mailing list
>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
>


From osklyar at maninvestments.com  Mon Jul 21 11:54:12 2008
From: osklyar at maninvestments.com (Sklyar, Oleg (London))
Date: Mon, 21 Jul 2008 10:54:12 +0100
Subject: [Rd] Clash between 'Cairo' and 'EBImage' packages on Windows
In-Reply-To: <59d7961d0807191126m63511789nf2edbbe45c36aef3@mail.gmail.com>
References: <59d7961d0807191126m63511789nf2edbbe45c36aef3@mail.gmail.com>
Message-ID: <1A68FCB28DE72F4BA3B967E6506CCE43030495F7@mildnpexmb01.maninvestments.ad.man.com>

EBImage is dynamically linked against GTK, which includes cairo
libraries, so those are installed along with GTK. Cairo seems to be
statically linking to libcairo.dll.a. I would assume that if it is
linked statically it should not get confused with a shared library
present elsewhere in the path, but it looks like it does. I have no
solution for that because unlike Cairo I cannot not statically link
EBImage to GTK as it is not one library that I need, but a bunch of
those.

On Linux you won't get this problem as it uses the same centrally
installed Cairo library.

In a way it would be better, if Cairo relied on the gladewin32.sf.net
which normally provides GTK (and thus cairo libraries) for Windows and
linked dynamically, but probably to simplify user installations the
developers wanted to avoid this.

There is not much I can do now about this, but I will follow the thread
if anybody comes up with an idea to change the code if possible

Dr Oleg Sklyar
Technology Group
Man Investments Ltd
+44 (0)20 7144 3803
osklyar at maninvestments.com 

> -----Original Message-----
> From: r-devel-bounces at r-project.org 
> [mailto:r-devel-bounces at r-project.org] On Behalf Of Henrik Bengtsson
> Sent: 19 July 2008 19:26
> To: R-devel
> Subject: [Rd] Clash between 'Cairo' and 'EBImage' packages on Windows
> 
> Hi,
> 
> on Windows XP Pro with R version 2.7.1 Patched (2008-06-27 
> r46012) the 'Cairo' and the 'EBImage' packages does not play 
> well together.
> 
> Loading EBImage before Cairo cause the following to happen:
> 
> # Rterm --vanilla
> > library(EBImage);
> > library(Cairo)
> Error in inDL(x, as.logical(local), as.logical(now), ...) :
>   unable to load shared library 
> 'C:/PROGRA~1/R/R-2.7.1pat/library/Cairo/libs/Cai
> ro.dll':
>   LoadLibrary failure:  The specified procedure could not be found.
> 
> Error : .onLoad failed in 'loadNamespace' for 'Cairo'
> Error: package/namespace load failed for 'Cairo'
> 
> with a dialog titled 'Rterm.exe - Entry Point Not Found' 
> saying 'The procedure entry point cairo_pdf_surface_create 
> could not be located in the dynamic link library libcairo-2.dll'.
> 
> Loading the packages in the reverse order works, but the 
> Rterm seems unstable, e.g. calling q() immediately after will 
> exit the R session without questions:
> 
> # Rterm --vanilla
> > library(Cairo)
> > library(EBImage)
> > q()
> [Immediately back to the command line].
> 
> I cannot reproduce the problem on R v2.7.1 on Ubuntu Hardy.
> 
> > sessionInfo()
> R version 2.7.1 Patched (2008-06-27 r46012)
> i386-pc-mingw32
> 
> locale:
> LC_COLLATE=English_United States.1252;LC_CTYPE=English_United 
> States.1252;LC_MON ETARY=English_United 
> States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252
> 
> 
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
> 
> other attached packages:
> [1] EBImage_2.4.0 Cairo_1.4-2
> 
> Cheers
> 
> Henrik
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 


**********************************************************************
The contents of this email are for the named addressee(s...{{dropped:22}}


From ripley at stats.ox.ac.uk  Mon Jul 21 12:29:20 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 21 Jul 2008 11:29:20 +0100 (BST)
Subject: [Rd] Clash between 'Cairo' and 'EBImage' packages on Windows
In-Reply-To: <1A68FCB28DE72F4BA3B967E6506CCE43030495F7@mildnpexmb01.maninvestments.ad.man.com>
References: <59d7961d0807191126m63511789nf2edbbe45c36aef3@mail.gmail.com>
	<1A68FCB28DE72F4BA3B967E6506CCE43030495F7@mildnpexmb01.maninvestments.ad.man.com>
Message-ID: <alpine.LFD.1.10.0807211106590.8931@gannet.stats.ox.ac.uk>

On Mon, 21 Jul 2008, Sklyar, Oleg (London) wrote:

> EBImage is dynamically linked against GTK, which includes cairo
> libraries, so those are installed along with GTK. Cairo seems to be
> statically linking to libcairo.dll.a. I would assume that if it is

That is an import library, so it is actually linked to libcairo-2.dll, 
which it ships.

> linked statically it should not get confused with a shared library
> present elsewhere in the path, but it looks like it does. I have no
> solution for that because unlike Cairo I cannot not statically link
> EBImage to GTK as it is not one library that I need, but a bunch of
> those.
>
> On Linux you won't get this problem as it uses the same centrally
> installed Cairo library.
>
> In a way it would be better, if Cairo relied on the gladewin32.sf.net
> which normally provides GTK (and thus cairo libraries) for Windows and
> linked dynamically, but probably to simplify user installations the
> developers wanted to avoid this.

It _is_ using dynamic loading, or there would be no conflict.  From the 
names, it looks very like that it is using a DLL from gladewin32.

The real issue looks rather like a versioning problem, that the cairo 
libraries installed as part of GTK and used by EBImage are way too old 
(cairo_pdf_surface_create was added at cairo 1.2, and cairo is at 1.6.4). 
So updating to the current GTK distribution may be all that is needed (and 
Henrik could also try replacing your GTK's libcairo-2.dll by that 
distributed with Cairo).

> There is not much I can do now about this, but I will follow the thread
> if anybody comes up with an idea to change the code if possible

The Cairo package (which ships DLLs) could rename them, as R itself does 
where it builds its own versions.  Or it could link statically (if that 
works, which it does not for e.g. package XML).

I don't really understand why this was posted to R-devel: it is not an R 
issue.


> Dr Oleg Sklyar
> Technology Group
> Man Investments Ltd
> +44 (0)20 7144 3803
> osklyar at maninvestments.com
>
>> -----Original Message-----
>> From: r-devel-bounces at r-project.org
>> [mailto:r-devel-bounces at r-project.org] On Behalf Of Henrik Bengtsson
>> Sent: 19 July 2008 19:26
>> To: R-devel
>> Subject: [Rd] Clash between 'Cairo' and 'EBImage' packages on Windows
>>
>> Hi,
>>
>> on Windows XP Pro with R version 2.7.1 Patched (2008-06-27
>> r46012) the 'Cairo' and the 'EBImage' packages does not play
>> well together.
>>
>> Loading EBImage before Cairo cause the following to happen:
>>
>> # Rterm --vanilla
>>> library(EBImage);
>>> library(Cairo)
>> Error in inDL(x, as.logical(local), as.logical(now), ...) :
>>   unable to load shared library
>> 'C:/PROGRA~1/R/R-2.7.1pat/library/Cairo/libs/Cai
>> ro.dll':
>>   LoadLibrary failure:  The specified procedure could not be found.
>>
>> Error : .onLoad failed in 'loadNamespace' for 'Cairo'
>> Error: package/namespace load failed for 'Cairo'
>>
>> with a dialog titled 'Rterm.exe - Entry Point Not Found'
>> saying 'The procedure entry point cairo_pdf_surface_create
>> could not be located in the dynamic link library libcairo-2.dll'.
>>
>> Loading the packages in the reverse order works, but the
>> Rterm seems unstable, e.g. calling q() immediately after will
>> exit the R session without questions:
>>
>> # Rterm --vanilla
>>> library(Cairo)
>>> library(EBImage)
>>> q()
>> [Immediately back to the command line].
>>
>> I cannot reproduce the problem on R v2.7.1 on Ubuntu Hardy.
>>
>>> sessionInfo()
>> R version 2.7.1 Patched (2008-06-27 r46012)
>> i386-pc-mingw32
>>
>> locale:
>> LC_COLLATE=English_United States.1252;LC_CTYPE=English_United
>> States.1252;LC_MON ETARY=English_United
>> States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252
>>
>>
>> attached base packages:
>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>
>> other attached packages:
>> [1] EBImage_2.4.0 Cairo_1.4-2
>>
>> Cheers
>>
>> Henrik
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
>
> **********************************************************************
> The contents of this email are for the named addressee(s...{{dropped:22}}
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From osklyar at maninvestments.com  Mon Jul 21 12:33:13 2008
From: osklyar at maninvestments.com (Sklyar, Oleg (London))
Date: Mon, 21 Jul 2008 11:33:13 +0100
Subject: [Rd] Clash between 'Cairo' and 'EBImage' packages on Windows
In-Reply-To: <alpine.LFD.1.10.0807211106590.8931@gannet.stats.ox.ac.uk>
References: <59d7961d0807191126m63511789nf2edbbe45c36aef3@mail.gmail.com> 
	<1A68FCB28DE72F4BA3B967E6506CCE43030495F7@mildnpexmb01.maninvestments.ad.man.com>
	<alpine.LFD.1.10.0807211106590.8931@gannet.stats.ox.ac.uk>
Message-ID: <1A68FCB28DE72F4BA3B967E6506CCE43030495FC@mildnpexmb01.maninvestments.ad.man.com>

Thanks fot the response. I will try to recompile EBImage with the newest
GTK and would advise Henrik to update the GTK to the latest one as it
should be backward compatible.

As for where it is posted, it is not a BioC only issue either and too
technical for R-help, so I would rather support Henrik on posting it
here. But please take my apollogies if it is not too appropriate to have
it on R-devel.

Best,
Oleg

Dr Oleg Sklyar
Technology Group
Man Investments Ltd
+44 (0)20 7144 3803
osklyar at maninvestments.com 

> -----Original Message-----
> From: Prof Brian Ripley [mailto:ripley at stats.ox.ac.uk] 
> Sent: 21 July 2008 11:29
> To: Sklyar, Oleg (London)
> Cc: Henrik Bengtsson; R-devel
> Subject: Re: [Rd] Clash between 'Cairo' and 'EBImage' 
> packages on Windows
> 
> On Mon, 21 Jul 2008, Sklyar, Oleg (London) wrote:
> 
> > EBImage is dynamically linked against GTK, which includes cairo 
> > libraries, so those are installed along with GTK. Cairo seems to be 
> > statically linking to libcairo.dll.a. I would assume that if it is
> 
> That is an import library, so it is actually linked to 
> libcairo-2.dll, which it ships.
> 
> > linked statically it should not get confused with a shared library 
> > present elsewhere in the path, but it looks like it does. I have no 
> > solution for that because unlike Cairo I cannot not statically link 
> > EBImage to GTK as it is not one library that I need, but a bunch of 
> > those.
> >
> > On Linux you won't get this problem as it uses the same centrally 
> > installed Cairo library.
> >
> > In a way it would be better, if Cairo relied on the 
> gladewin32.sf.net 
> > which normally provides GTK (and thus cairo libraries) for 
> Windows and 
> > linked dynamically, but probably to simplify user installations the 
> > developers wanted to avoid this.
> 
> It _is_ using dynamic loading, or there would be no conflict. 
>  From the names, it looks very like that it is using a DLL 
> from gladewin32.
> 
> The real issue looks rather like a versioning problem, that 
> the cairo libraries installed as part of GTK and used by 
> EBImage are way too old (cairo_pdf_surface_create was added 
> at cairo 1.2, and cairo is at 1.6.4). 
> So updating to the current GTK distribution may be all that 
> is needed (and Henrik could also try replacing your GTK's 
> libcairo-2.dll by that distributed with Cairo).
> 
> > There is not much I can do now about this, but I will follow the 
> > thread if anybody comes up with an idea to change the code 
> if possible
> 
> The Cairo package (which ships DLLs) could rename them, as R 
> itself does where it builds its own versions.  Or it could 
> link statically (if that works, which it does not for e.g. 
> package XML).
> 
> I don't really understand why this was posted to R-devel: it 
> is not an R issue.
> 
> 
> > Dr Oleg Sklyar
> > Technology Group
> > Man Investments Ltd
> > +44 (0)20 7144 3803
> > osklyar at maninvestments.com
> >
> >> -----Original Message-----
> >> From: r-devel-bounces at r-project.org
> >> [mailto:r-devel-bounces at r-project.org] On Behalf Of Henrik 
> Bengtsson
> >> Sent: 19 July 2008 19:26
> >> To: R-devel
> >> Subject: [Rd] Clash between 'Cairo' and 'EBImage' packages 
> on Windows
> >>
> >> Hi,
> >>
> >> on Windows XP Pro with R version 2.7.1 Patched (2008-06-27
> >> r46012) the 'Cairo' and the 'EBImage' packages does not play
> >> well together.
> >>
> >> Loading EBImage before Cairo cause the following to happen:
> >>
> >> # Rterm --vanilla
> >>> library(EBImage);
> >>> library(Cairo)
> >> Error in inDL(x, as.logical(local), as.logical(now), ...) :
> >>   unable to load shared library
> >> 'C:/PROGRA~1/R/R-2.7.1pat/library/Cairo/libs/Cai
> >> ro.dll':
> >>   LoadLibrary failure:  The specified procedure could not be found.
> >>
> >> Error : .onLoad failed in 'loadNamespace' for 'Cairo'
> >> Error: package/namespace load failed for 'Cairo'
> >>
> >> with a dialog titled 'Rterm.exe - Entry Point Not Found'
> >> saying 'The procedure entry point cairo_pdf_surface_create
> >> could not be located in the dynamic link library libcairo-2.dll'.
> >>
> >> Loading the packages in the reverse order works, but the
> >> Rterm seems unstable, e.g. calling q() immediately after will
> >> exit the R session without questions:
> >>
> >> # Rterm --vanilla
> >>> library(Cairo)
> >>> library(EBImage)
> >>> q()
> >> [Immediately back to the command line].
> >>
> >> I cannot reproduce the problem on R v2.7.1 on Ubuntu Hardy.
> >>
> >>> sessionInfo()
> >> R version 2.7.1 Patched (2008-06-27 r46012)
> >> i386-pc-mingw32
> >>
> >> locale:
> >> LC_COLLATE=English_United States.1252;LC_CTYPE=English_United
> >> States.1252;LC_MON ETARY=English_United
> >> States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252
> >>
> >>
> >> attached base packages:
> >> [1] stats     graphics  grDevices utils     datasets  
> methods   base
> >>
> >> other attached packages:
> >> [1] EBImage_2.4.0 Cairo_1.4-2
> >>
> >> Cheers
> >>
> >> Henrik
> >>
> >> ______________________________________________
> >> R-devel at r-project.org mailing list
> >> https://stat.ethz.ch/mailman/listinfo/r-devel
> >>
> >
> >
> > 
> **********************************************************************
> > The contents of this email are for the named 
> addressee(s...{{dropped:22}}
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >
> 
> -- 
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
> 


**********************************************************************
The contents of this email are for the named addressee(s...{{dropped:22}}


From luke at stat.uiowa.edu  Mon Jul 21 18:18:16 2008
From: luke at stat.uiowa.edu (Luke Tierney)
Date: Mon, 21 Jul 2008 11:18:16 -0500 (CDT)
Subject: [Rd] Snow or alternative MPI packages on Windows
In-Reply-To: <d4588dec0807170525q74c4dfafv4f1a982d3541797a@mail.gmail.com>
References: <d4588dec0807170525q74c4dfafv4f1a982d3541797a@mail.gmail.com>
Message-ID: <alpine.LFD.1.10.0807211116190.16792@nokomis.stat.uiowa.edu>

On Thu, 17 Jul 2008, Jay Emerson wrote:

> Giuseppe,
>
> I've been able to use NetWorkSpaces on all platforms, and have used
> snow under Linux.  It's possible to use snow under windows, but you'll
> need to build the binary yourself I think.  As an aside, I think this
> makes it impossible to write a CRAN-friendly package that Requires: or
> Suggests: snow, because it will fail the windows check.  It would be
> great if we could get around this some way, but I know this topic has
> been covered before (the subtle nature of Suggests: in particular, and
> what it really means).  I would like to add SNOW support to two of my
> own packages, bcp and bigmemory.

Hopefully Windows binaries for snow will become available before long
now that snow works on Windows with at least socket and MPI back ends.

The current version of snow also supports NWS as a communication back
end, thanks to code contributed by the NWS folks.

Best,

luke

>
> SNOW and NWS are similarly easy to use, at least at the superficial
> level which has been my experience.
>
> With NWS, you need both the package (nws, available on CRAN), and a
> NWS server (open-source, available on sourceforge).  But REvolution
> has a Windows installer available, and are working to make the whole
> process easier on the end user/developer on all platforms.  I started
> a rough page to help in the interim, and will update it as thing
> change to assist the end user/developer:
>
> http://www.stat.yale.edu/~jay/nws/
>
> Jay
>
>
> << original message below >>
>
> Guys,
>
> I'm running R on both Windows & Linux. I'm looking at a number of packages
> for parallel execution. It seems that the most used packages are "snow" and
> "Rmpi".
>
> snow seems more user friendly, but it doesn't run on windows. I see from
> searching the mailing list that I'm not the first one to try it on Windows.
> There was a message that kind of shed some hope on the subject, but nothing
> else.
>
> Rmpi works well on windows (with DeinoMPI) but it's kind of low level, so
> before I embark in writing code similar to snow to have some high level
> constructs I though I'd ask here about other peoples experiences...
>
> Is anyone around here doing parallel R on Windows? If so could you share
> your experience?
>
> // Giuseppe
>
>

-- 
Luke Tierney
Chair, Statistics and Actuarial Science
Ralph E. Wareham Professor of Mathematical Sciences
University of Iowa                  Phone:             319-335-3386
Department of Statistics and        Fax:               319-335-3017
    Actuarial Science
241 Schaeffer Hall                  email:      luke at stat.uiowa.edu
Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu


From simon.urbanek at r-project.org  Mon Jul 21 19:40:02 2008
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Mon, 21 Jul 2008 13:40:02 -0400
Subject: [Rd] Clash between 'Cairo' and 'EBImage' packages on Windows
In-Reply-To: <alpine.LFD.1.10.0807211106590.8931@gannet.stats.ox.ac.uk>
References: <59d7961d0807191126m63511789nf2edbbe45c36aef3@mail.gmail.com>
	<1A68FCB28DE72F4BA3B967E6506CCE43030495F7@mildnpexmb01.maninvestments.ad.man.com>
	<alpine.LFD.1.10.0807211106590.8931@gannet.stats.ox.ac.uk>
Message-ID: <F0ADBA94-B1F5-48EC-AA1A-96DBA7EFB25A@r-project.org>

Brian,

thanks for the analysis.

On Jul 21, 2008, at 6:29 , Prof Brian Ripley wrote:

> On Mon, 21 Jul 2008, Sklyar, Oleg (London) wrote:
>
>> EBImage is dynamically linked against GTK, which includes cairo
>> libraries, so those are installed along with GTK. Cairo seems to be
>> statically linking to libcairo.dll.a. I would assume that if it is
>
> That is an import library, so it is actually linked to  
> libcairo-2.dll, which it ships.
>
>> linked statically it should not get confused with a shared library
>> present elsewhere in the path, but it looks like it does. I have no
>> solution for that because unlike Cairo I cannot not statically link
>> EBImage to GTK as it is not one library that I need, but a bunch of
>> those.
>>
>> On Linux you won't get this problem as it uses the same centrally
>> installed Cairo library.
>>
>> In a way it would be better, if Cairo relied on the gladewin32.sf.net
>> which normally provides GTK (and thus cairo libraries) for Windows  
>> and
>> linked dynamically, but probably to simplify user installations the
>> developers wanted to avoid this.
>
> It _is_ using dynamic loading, or there would be no conflict.  From  
> the names, it looks very like that it is using a DLL from gladewin32.
>
> The real issue looks rather like a versioning problem, that the  
> cairo libraries installed as part of GTK and used by EBImage are way  
> too old (cairo_pdf_surface_create was added at cairo 1.2, and cairo  
> is at 1.6.4). So updating to the current GTK distribution may be all  
> that is needed (and Henrik could also try replacing your GTK's  
> libcairo-2.dll by that distributed with Cairo).
>

For compatibility sake I have updated the libcairo binary to 1.6.4  
(based on GTK+ build), so if EBImage gets updated all should be well.


>> There is not much I can do now about this, but I will follow the  
>> thread
>> if anybody comes up with an idea to change the code if possible
>
> The Cairo package (which ships DLLs) could rename them, as R itself  
> does where it builds its own versions.  Or it could link statically  
> (if that works, which it does not for e.g. package XML).
>

I'd rather not maintain my own build of libcairo for Windows since I  
don't use it. I may consider renaming the DLL, but given that I'm not  
building it from sources I'm not sure whether there is a trivial way  
to do that.

Best,
Simon


> I don't really understand why this was posted to R-devel: it is not  
> an R issue.
>
>
>> Dr Oleg Sklyar
>> Technology Group
>> Man Investments Ltd
>> +44 (0)20 7144 3803
>> osklyar at maninvestments.com
>>
>>> -----Original Message-----
>>> From: r-devel-bounces at r-project.org
>>> [mailto:r-devel-bounces at r-project.org] On Behalf Of Henrik Bengtsson
>>> Sent: 19 July 2008 19:26
>>> To: R-devel
>>> Subject: [Rd] Clash between 'Cairo' and 'EBImage' packages on  
>>> Windows
>>>
>>> Hi,
>>>
>>> on Windows XP Pro with R version 2.7.1 Patched (2008-06-27
>>> r46012) the 'Cairo' and the 'EBImage' packages does not play
>>> well together.
>>>
>>> Loading EBImage before Cairo cause the following to happen:
>>>
>>> # Rterm --vanilla
>>>> library(EBImage);
>>>> library(Cairo)
>>> Error in inDL(x, as.logical(local), as.logical(now), ...) :
>>>  unable to load shared library
>>> 'C:/PROGRA~1/R/R-2.7.1pat/library/Cairo/libs/Cai
>>> ro.dll':
>>>  LoadLibrary failure:  The specified procedure could not be found.
>>>
>>> Error : .onLoad failed in 'loadNamespace' for 'Cairo'
>>> Error: package/namespace load failed for 'Cairo'
>>>
>>> with a dialog titled 'Rterm.exe - Entry Point Not Found'
>>> saying 'The procedure entry point cairo_pdf_surface_create
>>> could not be located in the dynamic link library libcairo-2.dll'.
>>>
>>> Loading the packages in the reverse order works, but the
>>> Rterm seems unstable, e.g. calling q() immediately after will
>>> exit the R session without questions:
>>>
>>> # Rterm --vanilla
>>>> library(Cairo)
>>>> library(EBImage)
>>>> q()
>>> [Immediately back to the command line].
>>>
>>> I cannot reproduce the problem on R v2.7.1 on Ubuntu Hardy.
>>>
>>>> sessionInfo()
>>> R version 2.7.1 Patched (2008-06-27 r46012)
>>> i386-pc-mingw32
>>>
>>> locale:
>>> LC_COLLATE=English_United States.1252;LC_CTYPE=English_United
>>> States.1252;LC_MON ETARY=English_United
>>> States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252
>>>
>>>
>>> attached base packages:
>>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>>
>>> other attached packages:
>>> [1] EBImage_2.4.0 Cairo_1.4-2
>>>
>>> Cheers
>>>
>>> Henrik
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>
>>
>> **********************************************************************
>> The contents of this email are for the named addressee(s... 
>> {{dropped:22}}
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
> -- 
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From ripley at stats.ox.ac.uk  Tue Jul 22 10:13:28 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 22 Jul 2008 09:13:28 +0100 (BST)
Subject: [Rd] Clash between 'Cairo' and 'EBImage' packages on Windows
In-Reply-To: <F0ADBA94-B1F5-48EC-AA1A-96DBA7EFB25A@r-project.org>
References: <59d7961d0807191126m63511789nf2edbbe45c36aef3@mail.gmail.com>
	<1A68FCB28DE72F4BA3B967E6506CCE43030495F7@mildnpexmb01.maninvestments.ad.man.com>
	<alpine.LFD.1.10.0807211106590.8931@gannet.stats.ox.ac.uk>
	<F0ADBA94-B1F5-48EC-AA1A-96DBA7EFB25A@r-project.org>
Message-ID: <alpine.LFD.1.10.0807220909580.9401@gannet.stats.ox.ac.uk>

On Mon, 21 Jul 2008, Simon Urbanek wrote:

> Brian,
>
> thanks for the analysis.
>
> On Jul 21, 2008, at 6:29 , Prof Brian Ripley wrote:
>
>> On Mon, 21 Jul 2008, Sklyar, Oleg (London) wrote:
>> 
>>> EBImage is dynamically linked against GTK, which includes cairo
>>> libraries, so those are installed along with GTK. Cairo seems to be
>>> statically linking to libcairo.dll.a. I would assume that if it is
>> 
>> That is an import library, so it is actually linked to libcairo-2.dll, 
>> which it ships.
>> 
>>> linked statically it should not get confused with a shared library
>>> present elsewhere in the path, but it looks like it does. I have no
>>> solution for that because unlike Cairo I cannot not statically link
>>> EBImage to GTK as it is not one library that I need, but a bunch of
>>> those.
>>> 
>>> On Linux you won't get this problem as it uses the same centrally
>>> installed Cairo library.
>>> 
>>> In a way it would be better, if Cairo relied on the gladewin32.sf.net
>>> which normally provides GTK (and thus cairo libraries) for Windows and
>>> linked dynamically, but probably to simplify user installations the
>>> developers wanted to avoid this.
>> 
>> It _is_ using dynamic loading, or there would be no conflict.  From the 
>> names, it looks very like that it is using a DLL from gladewin32.
>> 
>> The real issue looks rather like a versioning problem, that the cairo 
>> libraries installed as part of GTK and used by EBImage are way too old 
>> (cairo_pdf_surface_create was added at cairo 1.2, and cairo is at 1.6.4). 
>> So updating to the current GTK distribution may be all that is needed (and 
>> Henrik could also try replacing your GTK's libcairo-2.dll by that 
>> distributed with Cairo).
>> 
>
> For compatibility sake I have updated the libcairo binary to 1.6.4 (based on 
> GTK+ build), so if EBImage gets updated all should be well.

EBImage relies on a user installation of GTK (AFAICS).  Last night I 
updated my GTK to 2.12.9 and used that's libcairo-2.dll in Cairo. It all 
seemed to work.

>>> There is not much I can do now about this, but I will follow the thread
>>> if anybody comes up with an idea to change the code if possible
>> 
>> The Cairo package (which ships DLLs) could rename them, as R itself does 
>> where it builds its own versions.  Or it could link statically (if that 
>> works, which it does not for e.g. package XML).
>
> I'd rather not maintain my own build of libcairo for Windows since I don't 
> use it. I may consider renaming the DLL, but given that I'm not building it 
> from sources I'm not sure whether there is a trivial way to do that.

If you are not building it yourself, then the only way is to use an editor 
on the DLL to change the embedded name.  I wouldn't suggest you do that (I 
had thought you were building it yourself).

>
> Best,
> Simon
>
>
>> I don't really understand why this was posted to R-devel: it is not an R 
>> issue.
>> 
>> 
>>> Dr Oleg Sklyar
>>> Technology Group
>>> Man Investments Ltd
>>> +44 (0)20 7144 3803
>>> osklyar at maninvestments.com
>>> 
>>>> -----Original Message-----
>>>> From: r-devel-bounces at r-project.org
>>>> [mailto:r-devel-bounces at r-project.org] On Behalf Of Henrik Bengtsson
>>>> Sent: 19 July 2008 19:26
>>>> To: R-devel
>>>> Subject: [Rd] Clash between 'Cairo' and 'EBImage' packages on Windows
>>>> 
>>>> Hi,
>>>> 
>>>> on Windows XP Pro with R version 2.7.1 Patched (2008-06-27
>>>> r46012) the 'Cairo' and the 'EBImage' packages does not play
>>>> well together.
>>>> 
>>>> Loading EBImage before Cairo cause the following to happen:
>>>> 
>>>> # Rterm --vanilla
>>>>> library(EBImage);
>>>>> library(Cairo)
>>>> Error in inDL(x, as.logical(local), as.logical(now), ...) :
>>>> unable to load shared library
>>>> 'C:/PROGRA~1/R/R-2.7.1pat/library/Cairo/libs/Cai
>>>> ro.dll':
>>>> LoadLibrary failure:  The specified procedure could not be found.
>>>> 
>>>> Error : .onLoad failed in 'loadNamespace' for 'Cairo'
>>>> Error: package/namespace load failed for 'Cairo'
>>>> 
>>>> with a dialog titled 'Rterm.exe - Entry Point Not Found'
>>>> saying 'The procedure entry point cairo_pdf_surface_create
>>>> could not be located in the dynamic link library libcairo-2.dll'.
>>>> 
>>>> Loading the packages in the reverse order works, but the
>>>> Rterm seems unstable, e.g. calling q() immediately after will
>>>> exit the R session without questions:
>>>> 
>>>> # Rterm --vanilla
>>>>> library(Cairo)
>>>>> library(EBImage)
>>>>> q()
>>>> [Immediately back to the command line].
>>>> 
>>>> I cannot reproduce the problem on R v2.7.1 on Ubuntu Hardy.
>>>> 
>>>>> sessionInfo()
>>>> R version 2.7.1 Patched (2008-06-27 r46012)
>>>> i386-pc-mingw32
>>>> 
>>>> locale:
>>>> LC_COLLATE=English_United States.1252;LC_CTYPE=English_United
>>>> States.1252;LC_MON ETARY=English_United
>>>> States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252
>>>> 
>>>> 
>>>> attached base packages:
>>>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>>> 
>>>> other attached packages:
>>>> [1] EBImage_2.4.0 Cairo_1.4-2
>>>> 
>>>> Cheers
>>>> 
>>>> Henrik
>>>> 
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>> 
>>> 
>>> 
>>> **********************************************************************
>>> The contents of this email are for the named addressee(s...{{dropped:22}}
>>> 
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>> 
>> 
>> -- 
>> Brian D. Ripley,                  ripley at stats.ox.ac.uk
>> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
>> University of Oxford,             Tel:  +44 1865 272861 (self)
>> 1 South Parks Road,                     +44 1865 272866 (PA)
>> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>> 
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>> 
>> 
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From trevvasspam at gmail.com  Tue Jul 22 11:26:47 2008
From: trevvasspam at gmail.com (Mark Payne)
Date: Tue, 22 Jul 2008 11:26:47 +0200
Subject: [Rd] Parameter names in nls()
Message-ID: <77d47f530807220226n7a210879ja06d30bbe7ee76e2@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20080722/b15fef6d/attachment.pl>

From ripley at stats.ox.ac.uk  Tue Jul 22 11:50:07 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 22 Jul 2008 10:50:07 +0100 (BST)
Subject: [Rd] Parameter names in nls()
In-Reply-To: <77d47f530807220226n7a210879ja06d30bbe7ee76e2@mail.gmail.com>
References: <77d47f530807220226n7a210879ja06d30bbe7ee76e2@mail.gmail.com>
Message-ID: <alpine.LFD.1.10.0807221041040.23268@auk.stats.ox.ac.uk>

They are not 'stripped': nothing says that because you named the starting 
value that other values will be named.

You are misusing nls(): the documented way would be to have

data.x <- 1:50
data.y <- pi*data.x + rnorm(50,sd=20)
fitting.fn <-function(x, a, b) a + b*x
nls(data.y ~ fitting.fn(data.x, a, b),data=data.frame(data.x,data.y),
     start=list(a=0, b=0),trace=TRUE,control=nls.control(tol=1e-8))


On Tue, 22 Jul 2008, Mark Payne wrote:

> Dear R-dev,
>
> I have been having some problems with regards to names in the parameter
> vector being stripped when passed to the objective function when using
> nls(). I was relieved to find that it wasn't me, and that this behaviour has
> previously been reported in optim() also. See eg
> https://stat.ethz.ch/pipermail/r-devel/2006-March/036710.html

Note that you are quoting a comment about a different function in a long 
obsolete version of R, with a very different interface.  That's called 
'clutching at straws'.

> The solution at that time was to make a change so that vector passed into
> the objective function was named (eg see following two discussions).
>
> The problem that I am having is virtually identical, but is occuring with
> nls() instead of optim(). To illustrate the problem, I have put together the
> following example code (see bottom). Basically, it is doing a linear least
> squares by hand, but it also displays the names associated on the parameters
> vector - if you run it, you will see that the names are there for the first
> few function evaluations, but after the first "step", the names are dropped.
>
> I was wondering if I could please ask for a similar fix as that applied to
> optim() to be carried across to nls() also?
>
> Many thanks,
>
> Mark
>
>
> #Setup environment
> rm(list=ls())
> counter <- 1
>
> #Objective function for nls
> fitting.fn <-function(x,params) {
>  #The model - so that it works
>  y <- params[1] + x*params[2]
>  #Referring to the parameters this way stops working after the first "step"
> #  y <- params["a"] + x*params["b"]
>
>  #Display information about function eval and parameter names
>  cat(paste("Evaluation # :",counter,"\t Names :"))
>  print(names(params))
>  counter <<- counter +1
>  return(y)
> }
>
> #Synthetic data
> data.x <- 1:50
> data.y <- pi*data.x + rnorm(50,sd=20)
>
> #Fit objective function
> ips <-  c(a=0,b=0)
> nls("data.y~fitting.fn(data.x,params)",data=data.frame(data.x,data.y),
>      start=list(params=ips),trace=TRUE,control=nls.control(tol=1e-8))
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From S.Ellison at lgc.co.uk  Tue Jul 22 13:36:40 2008
From: S.Ellison at lgc.co.uk (S Ellison)
Date: Tue, 22 Jul 2008 12:36:40 +0100
Subject: [Rd] Is text(..., adj) upside down? (Or am I?)
Message-ID: <s885d468.016@tedmail.lgc.co.uk>

?text says
    "'adj' allows _adj_ustment of the text with respect to '(x,y)'.
     Values of 0, 0.5, and 1 specify left/bottom, middle and
right/top,
     respectively."

But it looks like 0, 1 specify top, bottom respectively in the y
direction.

plot(1:4)
text(2,2, "adj=c(0,0)", adj=c(0,0))
text(2,2, "adj=c(0,1)", adj=c(0,1), col=2) #the red one's below the
black one...

#x-adj is OK
text(3,3, "adj=c(0,0)", adj=c(0,0))
text(3,3, "adj=c(1,0)", adj=c(1,0), col=2)

[I am using r 2.7.1 in windows; adj behaviour is consistent in 2.6.0ff
and for expressions as well as text]

Perhaps a two-word correction to ?text ?

Steve Ellison
Lab of the Government Chemist
UK

*******************************************************************
This email and any attachments are confidential. Any use...{{dropped:8}}


From murdoch at stats.uwo.ca  Tue Jul 22 14:54:15 2008
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Tue, 22 Jul 2008 08:54:15 -0400
Subject: [Rd] Is text(..., adj) upside down? (Or am I?)
In-Reply-To: <s885d468.016@tedmail.lgc.co.uk>
References: <s885d468.016@tedmail.lgc.co.uk>
Message-ID: <4885D877.1070103@stats.uwo.ca>

On 7/22/2008 7:36 AM, S Ellison wrote:
> ?text says
>     "'adj' allows _adj_ustment of the text with respect to '(x,y)'.
>      Values of 0, 0.5, and 1 specify left/bottom, middle and
> right/top,
>      respectively."
> 
> But it looks like 0, 1 specify top, bottom respectively in the y
> direction.
> 
> plot(1:4)
> text(2,2, "adj=c(0,0)", adj=c(0,0))
> text(2,2, "adj=c(0,1)", adj=c(0,1), col=2) #the red one's below the
> black one...
> 
> #x-adj is OK
> text(3,3, "adj=c(0,0)", adj=c(0,0))
> text(3,3, "adj=c(1,0)", adj=c(1,0), col=2)
> 
> [I am using r 2.7.1 in windows; adj behaviour is consistent in 2.6.0ff
> and for expressions as well as text]
> 
> Perhaps a two-word correction to ?text ?

I think it is behaving as I'd expect:  the y adjustment of 0 says that 
the bottom of the text aligns with the specified point, while the y 
adjustment of 1 says that the top of the text aligns there.  This is 
consistent with the description for x:  0 says the left end aligns, 1 
says the right end aligns.

The text may be a little terse, but it is consistent.

Duncan Murdoch


From p.dalgaard at biostat.ku.dk  Tue Jul 22 15:01:39 2008
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Tue, 22 Jul 2008 15:01:39 +0200
Subject: [Rd] Is text(..., adj) upside down? (Or am I?)
In-Reply-To: <s885d468.016@tedmail.lgc.co.uk>
References: <s885d468.016@tedmail.lgc.co.uk>
Message-ID: <4885DA33.6020301@biostat.ku.dk>

S Ellison wrote:
> ?text says
>     "'adj' allows _adj_ustment of the text with respect to '(x,y)'.
>      Values of 0, 0.5, and 1 specify left/bottom, middle and
> right/top,
>      respectively."
>
> But it looks like 0, 1 specify top, bottom respectively in the y
> direction.
>
> plot(1:4)
> text(2,2, "adj=c(0,0)", adj=c(0,0))
> text(2,2, "adj=c(0,1)", adj=c(0,1), col=2) #the red one's below the
> black one...
>
> #x-adj is OK
> text(3,3, "adj=c(0,0)", adj=c(0,0))
> text(3,3, "adj=c(1,0)", adj=c(1,0), col=2)
>
> [I am using r 2.7.1 in windows; adj behaviour is consistent in 2.6.0ff
> and for expressions as well as text]
>
> Perhaps a two-word correction to ?text ?
>   
You're just confused:

TOP adjusted text is BELOW bottom-adjusted text.
RIGHT adjusted text to the LEFT of left-adjusted text.

See?

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907


From ripley at stats.ox.ac.uk  Tue Jul 22 15:28:16 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 22 Jul 2008 14:28:16 +0100 (BST)
Subject: [Rd] Is text(..., adj) upside down? (Or am I?)
In-Reply-To: <s885d468.016@tedmail.lgc.co.uk>
References: <s885d468.016@tedmail.lgc.co.uk>
Message-ID: <alpine.LFD.1.10.0807221348460.22383@gannet.stats.ox.ac.uk>

On Tue, 22 Jul 2008, S Ellison wrote:

> ?text says
>    "'adj' allows _adj_ustment of the text with respect to '(x,y)'.
>     Values of 0, 0.5, and 1 specify left/bottom, middle and
> right/top,
>     respectively."
>
> But it looks like 0, 1 specify top, bottom respectively in the y
> direction.
>
> plot(1:4)
> text(2,2, "adj=c(0,0)", adj=c(0,0))
> text(2,2, "adj=c(0,1)", adj=c(0,1), col=2) #the red one's below the
> black one...

If that comment is what you see (and I do on X11), it is as documented. In 
the first text() call the left bottom of the text box is at the specified 
point. In the second text() call the left top of the text box is at the 
specified point, so the text box should be lower.

> #x-adj is OK
> text(3,3, "adj=c(0,0)", adj=c(0,0))
> text(3,3, "adj=c(1,0)", adj=c(1,0), col=2)
>
> [I am using r 2.7.1 in windows; adj behaviour is consistent in 2.6.0ff
> and for expressions as well as text]

All 'vertical' adjustment is done in the graphics engine: some 
'horizontal' adjustment is done in the devices.

> Perhaps a two-word correction to ?text ?

'adjustment' is not well-defined for text position, whereas 'alignment' or 
'justification' are, so I suggest adding one of those before 
'respectively'.

>
> Steve Ellison
> Lab of the Government Chemist
> UK
>
> *******************************************************************
> This email and any attachments are confidential. Any use...{{dropped:8}}
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From S.Ellison at lgc.co.uk  Tue Jul 22 17:12:43 2008
From: S.Ellison at lgc.co.uk (S Ellison)
Date: Tue, 22 Jul 2008 16:12:43 +0100
Subject: [Rd] Is text(..., adj) upside down? (Or am I?)
Message-ID: <s8860705.092@tedmail.lgc.co.uk>

Yup; you're all right - it IS consistent (and I'd even checked the x-adj
and it did what I expected!!). It's just that ?text is talking about the
position of the 'anchor' point in the text region rather than the
subsequent location of the centre of the text.

Anyway; if anyone is considering a minor tweak to ?text, would it be
clearer if it said 
"Values of 0, 0.5, and 1 specify text towards right/top, middle and
left/bottom of x,y, 
     respectively." ?

(or, of course, "Values of 0, 0.5, and 1 specify x,y at left/bottom,
middle and right/top of text, respectively.")

Steve Ellison
Lab of the Government Chemist
UK



*******************************************************************
This email and any attachments are confidential. Any use...{{dropped:8}}


From pburns at pburns.seanet.com  Tue Jul 22 18:31:20 2008
From: pburns at pburns.seanet.com (Patrick Burns)
Date: Tue, 22 Jul 2008 17:31:20 +0100
Subject: [Rd] Is text(..., adj) upside down? (Or am I?)
In-Reply-To: <s8860705.092@tedmail.lgc.co.uk>
References: <s8860705.092@tedmail.lgc.co.uk>
Message-ID: <48860B58.8040607@pburns.seanet.com>

Basically the only thing in the thread that was clear
to me was Brian's phrasing.  So I'd suggest basing
any changes on that.


Patrick Burns
patrick at burns-stat.com
+44 (0)20 8525 0696
http://www.burns-stat.com
(home of S Poetry and "A Guide for the Unwilling S User")

S Ellison wrote:
> Yup; you're all right - it IS consistent (and I'd even checked the x-adj
> and it did what I expected!!). It's just that ?text is talking about the
> position of the 'anchor' point in the text region rather than the
> subsequent location of the centre of the text.
>
> Anyway; if anyone is considering a minor tweak to ?text, would it be
> clearer if it said 
> "Values of 0, 0.5, and 1 specify text towards right/top, middle and
> left/bottom of x,y, 
>      respectively." ?
>
> (or, of course, "Values of 0, 0.5, and 1 specify x,y at left/bottom,
> middle and right/top of text, respectively.")
>
> Steve Ellison
> Lab of the Government Chemist
> UK
>
>
>
> *******************************************************************
> This email and any attachments are confidential. Any use...{{dropped:8}}
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>
>


From ripley at stats.ox.ac.uk  Wed Jul 23 10:12:42 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 23 Jul 2008 09:12:42 +0100 (BST)
Subject: [Rd] Is text(..., adj) upside down? (Or am I?)
In-Reply-To: <48860B58.8040607@pburns.seanet.com>
References: <s8860705.092@tedmail.lgc.co.uk>
	<48860B58.8040607@pburns.seanet.com>
Message-ID: <alpine.LFD.1.10.0807230905330.28802@gannet.stats.ox.ac.uk>

On Tue, 22 Jul 2008, Patrick Burns wrote:

> Basically the only thing in the thread that was clear
> to me was Brian's phrasing.  So I'd suggest basing
> any changes on that.

I'll add some words.  There is one other thing which needs explaining, 
what 'bottom' means.  For a character string it means the baseline of the 
text, for an expression the bottom of the text box (plotmath) does not 
attempt to compute baselines.  This also affects the computation of 
vertical centering:

plot(1:5, type="n")
abline(v=2); abline(v=4)
abline(h=1)
text(2,1, "fgh", adj=c(0,0), cex=2)
text(4,1, expression(fgh), adj=c(0,0), cex=2)
abline(h=3)
text(2,3, "fgh", adj=c(0,0.5), cex=2)
text(4,3, expression(fgh), adj=c(0,0.5), cex=2)
abline(h=5)
text(4,5, expression(fgh), adj=c(0,1), cex=2)
text(2,5, "fgh", adj=c(0,1), cex=2)

>
>
> Patrick Burns
> patrick at burns-stat.com
> +44 (0)20 8525 0696
> http://www.burns-stat.com
> (home of S Poetry and "A Guide for the Unwilling S User")
>
> S Ellison wrote:
>> Yup; you're all right - it IS consistent (and I'd even checked the x-adj
>> and it did what I expected!!). It's just that ?text is talking about the
>> position of the 'anchor' point in the text region rather than the
>> subsequent location of the centre of the text.
>> 
>> Anyway; if anyone is considering a minor tweak to ?text, would it be
>> clearer if it said "Values of 0, 0.5, and 1 specify text towards right/top, 
>> middle and
>> left/bottom of x,y,      respectively." ?
>> 
>> (or, of course, "Values of 0, 0.5, and 1 specify x,y at left/bottom,
>> middle and right/top of text, respectively.")
>> 
>> Steve Ellison
>> Lab of the Government Chemist
>> UK
>> 
>> 
>> 
>> *******************************************************************
>> This email and any attachments are confidential. Any use...{{dropped:8}}
>> 
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>> 
>> 
>> 
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Wed Jul 23 12:21:29 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 23 Jul 2008 11:21:29 +0100 (BST)
Subject: [Rd] Clash between 'Cairo' and 'EBImage' packages on Windows
In-Reply-To: <alpine.LFD.1.10.0807220909580.9401@gannet.stats.ox.ac.uk>
References: <59d7961d0807191126m63511789nf2edbbe45c36aef3@mail.gmail.com>
	<1A68FCB28DE72F4BA3B967E6506CCE43030495F7@mildnpexmb01.maninvestments.ad.man.com>
	<alpine.LFD.1.10.0807211106590.8931@gannet.stats.ox.ac.uk>
	<F0ADBA94-B1F5-48EC-AA1A-96DBA7EFB25A@r-project.org>
	<alpine.LFD.1.10.0807220909580.9401@gannet.stats.ox.ac.uk>
Message-ID: <alpine.LFD.1.10.0807231117130.32145@gannet.stats.ox.ac.uk>

I updated one of by Windows' boxes to GTK 2.12.9, and replaced the 
libcairo-2.dll in the Cairo binary distribution by that from GTK 2.12.9.
At that point Cairo and EBImage worked together, in either order.

I think Uwe may need to trigger a rebuild of his Cairo binary to pick up 
Simon's updated libcairo-2.dll -- the existing binary is not compatible 
with GTK 2.12.9.

On Tue, 22 Jul 2008, Prof Brian Ripley wrote:

> On Mon, 21 Jul 2008, Simon Urbanek wrote:
>
>> Brian,
>> 
>> thanks for the analysis.
>> 
>> On Jul 21, 2008, at 6:29 , Prof Brian Ripley wrote:
>> 
>>> On Mon, 21 Jul 2008, Sklyar, Oleg (London) wrote:
>>> 
>>>> EBImage is dynamically linked against GTK, which includes cairo
>>>> libraries, so those are installed along with GTK. Cairo seems to be
>>>> statically linking to libcairo.dll.a. I would assume that if it is
>>> 
>>> That is an import library, so it is actually linked to libcairo-2.dll, 
>>> which it ships.
>>> 
>>>> linked statically it should not get confused with a shared library
>>>> present elsewhere in the path, but it looks like it does. I have no
>>>> solution for that because unlike Cairo I cannot not statically link
>>>> EBImage to GTK as it is not one library that I need, but a bunch of
>>>> those.
>>>> 
>>>> On Linux you won't get this problem as it uses the same centrally
>>>> installed Cairo library.
>>>> 
>>>> In a way it would be better, if Cairo relied on the gladewin32.sf.net
>>>> which normally provides GTK (and thus cairo libraries) for Windows and
>>>> linked dynamically, but probably to simplify user installations the
>>>> developers wanted to avoid this.
>>> 
>>> It _is_ using dynamic loading, or there would be no conflict.  From the 
>>> names, it looks very like that it is using a DLL from gladewin32.
>>> 
>>> The real issue looks rather like a versioning problem, that the cairo 
>>> libraries installed as part of GTK and used by EBImage are way too old 
>>> (cairo_pdf_surface_create was added at cairo 1.2, and cairo is at 1.6.4). 
>>> So updating to the current GTK distribution may be all that is needed (and 
>>> Henrik could also try replacing your GTK's libcairo-2.dll by that 
>>> distributed with Cairo).
>>> 
>> 
>> For compatibility sake I have updated the libcairo binary to 1.6.4 (based 
>> on GTK+ build), so if EBImage gets updated all should be well.
>
> EBImage relies on a user installation of GTK (AFAICS).  Last night I updated 
> my GTK to 2.12.9 and used that's libcairo-2.dll in Cairo. It all seemed to 
> work.
>
>>>> There is not much I can do now about this, but I will follow the thread
>>>> if anybody comes up with an idea to change the code if possible
>>> 
>>> The Cairo package (which ships DLLs) could rename them, as R itself does 
>>> where it builds its own versions.  Or it could link statically (if that 
>>> works, which it does not for e.g. package XML).
>> 
>> I'd rather not maintain my own build of libcairo for Windows since I don't 
>> use it. I may consider renaming the DLL, but given that I'm not building it 
>> from sources I'm not sure whether there is a trivial way to do that.
>
> If you are not building it yourself, then the only way is to use an editor on 
> the DLL to change the embedded name.  I wouldn't suggest you do that (I had 
> thought you were building it yourself).
>
>> 
>> Best,
>> Simon
>> 
>> 
>>> I don't really understand why this was posted to R-devel: it is not an R 
>>> issue.
>>> 
>>> 
>>>> Dr Oleg Sklyar
>>>> Technology Group
>>>> Man Investments Ltd
>>>> +44 (0)20 7144 3803
>>>> osklyar at maninvestments.com
>>>> 
>>>>> -----Original Message-----
>>>>> From: r-devel-bounces at r-project.org
>>>>> [mailto:r-devel-bounces at r-project.org] On Behalf Of Henrik Bengtsson
>>>>> Sent: 19 July 2008 19:26
>>>>> To: R-devel
>>>>> Subject: [Rd] Clash between 'Cairo' and 'EBImage' packages on Windows
>>>>> 
>>>>> Hi,
>>>>> 
>>>>> on Windows XP Pro with R version 2.7.1 Patched (2008-06-27
>>>>> r46012) the 'Cairo' and the 'EBImage' packages does not play
>>>>> well together.
>>>>> 
>>>>> Loading EBImage before Cairo cause the following to happen:
>>>>> 
>>>>> # Rterm --vanilla
>>>>>> library(EBImage);
>>>>>> library(Cairo)
>>>>> Error in inDL(x, as.logical(local), as.logical(now), ...) :
>>>>> unable to load shared library
>>>>> 'C:/PROGRA~1/R/R-2.7.1pat/library/Cairo/libs/Cai
>>>>> ro.dll':
>>>>> LoadLibrary failure:  The specified procedure could not be found.
>>>>> 
>>>>> Error : .onLoad failed in 'loadNamespace' for 'Cairo'
>>>>> Error: package/namespace load failed for 'Cairo'
>>>>> 
>>>>> with a dialog titled 'Rterm.exe - Entry Point Not Found'
>>>>> saying 'The procedure entry point cairo_pdf_surface_create
>>>>> could not be located in the dynamic link library libcairo-2.dll'.
>>>>> 
>>>>> Loading the packages in the reverse order works, but the
>>>>> Rterm seems unstable, e.g. calling q() immediately after will
>>>>> exit the R session without questions:
>>>>> 
>>>>> # Rterm --vanilla
>>>>>> library(Cairo)
>>>>>> library(EBImage)
>>>>>> q()
>>>>> [Immediately back to the command line].
>>>>> 
>>>>> I cannot reproduce the problem on R v2.7.1 on Ubuntu Hardy.
>>>>> 
>>>>>> sessionInfo()
>>>>> R version 2.7.1 Patched (2008-06-27 r46012)
>>>>> i386-pc-mingw32
>>>>> 
>>>>> locale:
>>>>> LC_COLLATE=English_United States.1252;LC_CTYPE=English_United
>>>>> States.1252;LC_MON ETARY=English_United
>>>>> States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252
>>>>> 
>>>>> 
>>>>> attached base packages:
>>>>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>>>> 
>>>>> other attached packages:
>>>>> [1] EBImage_2.4.0 Cairo_1.4-2
>>>>> 
>>>>> Cheers
>>>>> 
>>>>> Henrik
>>>>> 
>>>>> ______________________________________________
>>>>> R-devel at r-project.org mailing list
>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>> 
>>>> 
>>>> 
>>>> **********************************************************************
>>>> The contents of this email are for the named addressee(s...{{dropped:22}}
>>>> 
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>> 
>>> 
>>> -- 
>>> Brian D. Ripley,                  ripley at stats.ox.ac.uk
>>> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
>>> University of Oxford,             Tel:  +44 1865 272861 (self)
>>> 1 South Parks Road,                     +44 1865 272866 (PA)
>>> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>>> 
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>> 
>>> 
>> 
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
> -- 
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From simon.urbanek at r-project.org  Wed Jul 23 15:05:13 2008
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Wed, 23 Jul 2008 09:05:13 -0400
Subject: [Rd] Clash between 'Cairo' and 'EBImage' packages on Windows
In-Reply-To: <alpine.LFD.1.10.0807231117130.32145@gannet.stats.ox.ac.uk>
References: <59d7961d0807191126m63511789nf2edbbe45c36aef3@mail.gmail.com>
	<1A68FCB28DE72F4BA3B967E6506CCE43030495F7@mildnpexmb01.maninvestments.ad.man.com>
	<alpine.LFD.1.10.0807211106590.8931@gannet.stats.ox.ac.uk>
	<F0ADBA94-B1F5-48EC-AA1A-96DBA7EFB25A@r-project.org>
	<alpine.LFD.1.10.0807220909580.9401@gannet.stats.ox.ac.uk>
	<alpine.LFD.1.10.0807231117130.32145@gannet.stats.ox.ac.uk>
Message-ID: <D812F553-C405-41F0-9E0E-0F3CB09DEA9C@r-project.org>


On Jul 23, 2008, at 6:21 , Prof Brian Ripley wrote:

> I updated one of by Windows' boxes to GTK 2.12.9, and replaced the  
> libcairo-2.dll in the Cairo binary distribution by that from GTK  
> 2.12.9.
> At that point Cairo and EBImage worked together, in either order.
>
> I think Uwe may need to trigger a rebuild of his Cairo binary to  
> pick up Simon's updated libcairo-2.dll -- the existing binary is not  
> compatible with GTK 2.12.9.
>

I have released a new version of Cario on Monday just to trigger this,  
so once CRAN is updated it should happen automatically.

Thanks,
Simon


> On Tue, 22 Jul 2008, Prof Brian Ripley wrote:
>
>> On Mon, 21 Jul 2008, Simon Urbanek wrote:
>>
>>> Brian,
>>> thanks for the analysis.
>>> On Jul 21, 2008, at 6:29 , Prof Brian Ripley wrote:
>>>> On Mon, 21 Jul 2008, Sklyar, Oleg (London) wrote:
>>>>> EBImage is dynamically linked against GTK, which includes cairo
>>>>> libraries, so those are installed along with GTK. Cairo seems to  
>>>>> be
>>>>> statically linking to libcairo.dll.a. I would assume that if it is
>>>> That is an import library, so it is actually linked to  
>>>> libcairo-2.dll, which it ships.
>>>>> linked statically it should not get confused with a shared library
>>>>> present elsewhere in the path, but it looks like it does. I have  
>>>>> no
>>>>> solution for that because unlike Cairo I cannot not statically  
>>>>> link
>>>>> EBImage to GTK as it is not one library that I need, but a bunch  
>>>>> of
>>>>> those.
>>>>> On Linux you won't get this problem as it uses the same centrally
>>>>> installed Cairo library.
>>>>> In a way it would be better, if Cairo relied on the  
>>>>> gladewin32.sf.net
>>>>> which normally provides GTK (and thus cairo libraries) for  
>>>>> Windows and
>>>>> linked dynamically, but probably to simplify user installations  
>>>>> the
>>>>> developers wanted to avoid this.
>>>> It _is_ using dynamic loading, or there would be no conflict.   
>>>> From the names, it looks very like that it is using a DLL from  
>>>> gladewin32.
>>>> The real issue looks rather like a versioning problem, that the  
>>>> cairo libraries installed as part of GTK and used by EBImage are  
>>>> way too old (cairo_pdf_surface_create was added at cairo 1.2, and  
>>>> cairo is at 1.6.4). So updating to the current GTK distribution  
>>>> may be all that is needed (and Henrik could also try replacing  
>>>> your GTK's libcairo-2.dll by that distributed with Cairo).
>>> For compatibility sake I have updated the libcairo binary to 1.6.4  
>>> (based on GTK+ build), so if EBImage gets updated all should be  
>>> well.
>>
>> EBImage relies on a user installation of GTK (AFAICS).  Last night  
>> I updated my GTK to 2.12.9 and used that's libcairo-2.dll in Cairo.  
>> It all seemed to work.
>>
>>>>> There is not much I can do now about this, but I will follow the  
>>>>> thread
>>>>> if anybody comes up with an idea to change the code if possible
>>>> The Cairo package (which ships DLLs) could rename them, as R  
>>>> itself does where it builds its own versions.  Or it could link  
>>>> statically (if that works, which it does not for e.g. package XML).
>>> I'd rather not maintain my own build of libcairo for Windows since  
>>> I don't use it. I may consider renaming the DLL, but given that  
>>> I'm not building it from sources I'm not sure whether there is a  
>>> trivial way to do that.
>>
>> If you are not building it yourself, then the only way is to use an  
>> editor on the DLL to change the embedded name.  I wouldn't suggest  
>> you do that (I had thought you were building it yourself).
>>
>>> Best,
>>> Simon
>>>> I don't really understand why this was posted to R-devel: it is  
>>>> not an R issue.
>>>>> Dr Oleg Sklyar
>>>>> Technology Group
>>>>> Man Investments Ltd
>>>>> +44 (0)20 7144 3803
>>>>> osklyar at maninvestments.com
>>>>>> -----Original Message-----
>>>>>> From: r-devel-bounces at r-project.org
>>>>>> [mailto:r-devel-bounces at r-project.org] On Behalf Of Henrik  
>>>>>> Bengtsson
>>>>>> Sent: 19 July 2008 19:26
>>>>>> To: R-devel
>>>>>> Subject: [Rd] Clash between 'Cairo' and 'EBImage' packages on  
>>>>>> Windows
>>>>>> Hi,
>>>>>> on Windows XP Pro with R version 2.7.1 Patched (2008-06-27
>>>>>> r46012) the 'Cairo' and the 'EBImage' packages does not play
>>>>>> well together.
>>>>>> Loading EBImage before Cairo cause the following to happen:
>>>>>> # Rterm --vanilla
>>>>>>> library(EBImage);
>>>>>>> library(Cairo)
>>>>>> Error in inDL(x, as.logical(local), as.logical(now), ...) :
>>>>>> unable to load shared library
>>>>>> 'C:/PROGRA~1/R/R-2.7.1pat/library/Cairo/libs/Cai
>>>>>> ro.dll':
>>>>>> LoadLibrary failure:  The specified procedure could not be found.
>>>>>> Error : .onLoad failed in 'loadNamespace' for 'Cairo'
>>>>>> Error: package/namespace load failed for 'Cairo'
>>>>>> with a dialog titled 'Rterm.exe - Entry Point Not Found'
>>>>>> saying 'The procedure entry point cairo_pdf_surface_create
>>>>>> could not be located in the dynamic link library libcairo-2.dll'.
>>>>>> Loading the packages in the reverse order works, but the
>>>>>> Rterm seems unstable, e.g. calling q() immediately after will
>>>>>> exit the R session without questions:
>>>>>> # Rterm --vanilla
>>>>>>> library(Cairo)
>>>>>>> library(EBImage)
>>>>>>> q()
>>>>>> [Immediately back to the command line].
>>>>>> I cannot reproduce the problem on R v2.7.1 on Ubuntu Hardy.
>>>>>>> sessionInfo()
>>>>>> R version 2.7.1 Patched (2008-06-27 r46012)
>>>>>> i386-pc-mingw32
>>>>>> locale:
>>>>>> LC_COLLATE=English_United States.1252;LC_CTYPE=English_United
>>>>>> States.1252;LC_MON ETARY=English_United
>>>>>> States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252
>>>>>> attached base packages:
>>>>>> [1] stats     graphics  grDevices utils     datasets  methods    
>>>>>> base
>>>>>> other attached packages:
>>>>>> [1] EBImage_2.4.0 Cairo_1.4-2
>>>>>> Cheers
>>>>>> Henrik
>>>>>> ______________________________________________
>>>>>> R-devel at r-project.org mailing list
>>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>> **********************************************************************
>>>>> The contents of this email are for the named addressee(s... 
>>>>> {{dropped:22}}
>>>>> ______________________________________________
>>>>> R-devel at r-project.org mailing list
>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>> -- 
>>>> Brian D. Ripley,                  ripley at stats.ox.ac.uk
>>>> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/ 
>>>> ~ripley/
>>>> University of Oxford,             Tel:  +44 1865 272861 (self)
>>>> 1 South Parks Road,                     +44 1865 272866 (PA)
>>>> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>> -- 
>> Brian D. Ripley,                  ripley at stats.ox.ac.uk
>> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
>> University of Oxford,             Tel:  +44 1865 272861 (self)
>> 1 South Parks Road,                     +44 1865 272866 (PA)
>> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
> -- 
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>
>


From ligges at statistik.tu-dortmund.de  Wed Jul 23 17:47:51 2008
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Wed, 23 Jul 2008 17:47:51 +0200
Subject: [Rd] Clash between 'Cairo' and 'EBImage' packages on Windows
In-Reply-To: <D812F553-C405-41F0-9E0E-0F3CB09DEA9C@r-project.org>
References: <59d7961d0807191126m63511789nf2edbbe45c36aef3@mail.gmail.com>
	<1A68FCB28DE72F4BA3B967E6506CCE43030495F7@mildnpexmb01.maninvestments.ad.man.com>
	<alpine.LFD.1.10.0807211106590.8931@gannet.stats.ox.ac.uk>
	<F0ADBA94-B1F5-48EC-AA1A-96DBA7EFB25A@r-project.org>
	<alpine.LFD.1.10.0807220909580.9401@gannet.stats.ox.ac.uk>
	<alpine.LFD.1.10.0807231117130.32145@gannet.stats.ox.ac.uk>
	<D812F553-C405-41F0-9E0E-0F3CB09DEA9C@r-project.org>
Message-ID: <488752A7.5070603@statistik.tu-dortmund.de>



Simon Urbanek wrote:
> 
> On Jul 23, 2008, at 6:21 , Prof Brian Ripley wrote:
> 
>> I updated one of by Windows' boxes to GTK 2.12.9, and replaced the 
>> libcairo-2.dll in the Cairo binary distribution by that from GTK 2.12.9.
>> At that point Cairo and EBImage worked together, in either order.
>>
>> I think Uwe may need to trigger a rebuild of his Cairo binary to pick 
>> up Simon's updated libcairo-2.dll -- the existing binary is not 
>> compatible with GTK 2.12.9.
>>
> 
> I have released a new version of Cario on Monday just to trigger this, 
> so once CRAN is updated it should happen automatically.

Sorry, I'm currently a bit short of time:
- Should I install GTK 2.12.9 or does it work with older versions?
- So do I understand alright that I do not need to trigger anything yet?

Best,
Uwe



> Thanks,
> Simon
> 
> 
>> On Tue, 22 Jul 2008, Prof Brian Ripley wrote:
>>
>>> On Mon, 21 Jul 2008, Simon Urbanek wrote:
>>>
>>>> Brian,
>>>> thanks for the analysis.
>>>> On Jul 21, 2008, at 6:29 , Prof Brian Ripley wrote:
>>>>> On Mon, 21 Jul 2008, Sklyar, Oleg (London) wrote:
>>>>>> EBImage is dynamically linked against GTK, which includes cairo
>>>>>> libraries, so those are installed along with GTK. Cairo seems to be
>>>>>> statically linking to libcairo.dll.a. I would assume that if it is
>>>>> That is an import library, so it is actually linked to 
>>>>> libcairo-2.dll, which it ships.
>>>>>> linked statically it should not get confused with a shared library
>>>>>> present elsewhere in the path, but it looks like it does. I have no
>>>>>> solution for that because unlike Cairo I cannot not statically link
>>>>>> EBImage to GTK as it is not one library that I need, but a bunch of
>>>>>> those.
>>>>>> On Linux you won't get this problem as it uses the same centrally
>>>>>> installed Cairo library.
>>>>>> In a way it would be better, if Cairo relied on the gladewin32.sf.net
>>>>>> which normally provides GTK (and thus cairo libraries) for Windows 
>>>>>> and
>>>>>> linked dynamically, but probably to simplify user installations the
>>>>>> developers wanted to avoid this.
>>>>> It _is_ using dynamic loading, or there would be no conflict.  From 
>>>>> the names, it looks very like that it is using a DLL from gladewin32.
>>>>> The real issue looks rather like a versioning problem, that the 
>>>>> cairo libraries installed as part of GTK and used by EBImage are 
>>>>> way too old (cairo_pdf_surface_create was added at cairo 1.2, and 
>>>>> cairo is at 1.6.4). So updating to the current GTK distribution may 
>>>>> be all that is needed (and Henrik could also try replacing your 
>>>>> GTK's libcairo-2.dll by that distributed with Cairo).
>>>> For compatibility sake I have updated the libcairo binary to 1.6.4 
>>>> (based on GTK+ build), so if EBImage gets updated all should be well.
>>>
>>> EBImage relies on a user installation of GTK (AFAICS).  Last night I 
>>> updated my GTK to 2.12.9 and used that's libcairo-2.dll in Cairo. It 
>>> all seemed to work.
>>>
>>>>>> There is not much I can do now about this, but I will follow the 
>>>>>> thread
>>>>>> if anybody comes up with an idea to change the code if possible
>>>>> The Cairo package (which ships DLLs) could rename them, as R itself 
>>>>> does where it builds its own versions.  Or it could link statically 
>>>>> (if that works, which it does not for e.g. package XML).
>>>> I'd rather not maintain my own build of libcairo for Windows since I 
>>>> don't use it. I may consider renaming the DLL, but given that I'm 
>>>> not building it from sources I'm not sure whether there is a trivial 
>>>> way to do that.
>>>
>>> If you are not building it yourself, then the only way is to use an 
>>> editor on the DLL to change the embedded name.  I wouldn't suggest 
>>> you do that (I had thought you were building it yourself).
>>>
>>>> Best,
>>>> Simon
>>>>> I don't really understand why this was posted to R-devel: it is not 
>>>>> an R issue.
>>>>>> Dr Oleg Sklyar
>>>>>> Technology Group
>>>>>> Man Investments Ltd
>>>>>> +44 (0)20 7144 3803
>>>>>> osklyar at maninvestments.com
>>>>>>> -----Original Message-----
>>>>>>> From: r-devel-bounces at r-project.org
>>>>>>> [mailto:r-devel-bounces at r-project.org] On Behalf Of Henrik Bengtsson
>>>>>>> Sent: 19 July 2008 19:26
>>>>>>> To: R-devel
>>>>>>> Subject: [Rd] Clash between 'Cairo' and 'EBImage' packages on 
>>>>>>> Windows
>>>>>>> Hi,
>>>>>>> on Windows XP Pro with R version 2.7.1 Patched (2008-06-27
>>>>>>> r46012) the 'Cairo' and the 'EBImage' packages does not play
>>>>>>> well together.
>>>>>>> Loading EBImage before Cairo cause the following to happen:
>>>>>>> # Rterm --vanilla
>>>>>>>> library(EBImage);
>>>>>>>> library(Cairo)
>>>>>>> Error in inDL(x, as.logical(local), as.logical(now), ...) :
>>>>>>> unable to load shared library
>>>>>>> 'C:/PROGRA~1/R/R-2.7.1pat/library/Cairo/libs/Cai
>>>>>>> ro.dll':
>>>>>>> LoadLibrary failure:  The specified procedure could not be found.
>>>>>>> Error : .onLoad failed in 'loadNamespace' for 'Cairo'
>>>>>>> Error: package/namespace load failed for 'Cairo'
>>>>>>> with a dialog titled 'Rterm.exe - Entry Point Not Found'
>>>>>>> saying 'The procedure entry point cairo_pdf_surface_create
>>>>>>> could not be located in the dynamic link library libcairo-2.dll'.
>>>>>>> Loading the packages in the reverse order works, but the
>>>>>>> Rterm seems unstable, e.g. calling q() immediately after will
>>>>>>> exit the R session without questions:
>>>>>>> # Rterm --vanilla
>>>>>>>> library(Cairo)
>>>>>>>> library(EBImage)
>>>>>>>> q()
>>>>>>> [Immediately back to the command line].
>>>>>>> I cannot reproduce the problem on R v2.7.1 on Ubuntu Hardy.
>>>>>>>> sessionInfo()
>>>>>>> R version 2.7.1 Patched (2008-06-27 r46012)
>>>>>>> i386-pc-mingw32
>>>>>>> locale:
>>>>>>> LC_COLLATE=English_United States.1252;LC_CTYPE=English_United
>>>>>>> States.1252;LC_MON ETARY=English_United
>>>>>>> States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252
>>>>>>> attached base packages:
>>>>>>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>>>>>> other attached packages:
>>>>>>> [1] EBImage_2.4.0 Cairo_1.4-2
>>>>>>> Cheers
>>>>>>> Henrik
>>>>>>> ______________________________________________
>>>>>>> R-devel at r-project.org mailing list
>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>>> ********************************************************************** 
>>>>>>
>>>>>> The contents of this email are for the named 
>>>>>> addressee(s...{{dropped:22}}
>>>>>> ______________________________________________
>>>>>> R-devel at r-project.org mailing list
>>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>> -- 
>>>>> Brian D. Ripley,                  ripley at stats.ox.ac.uk
>>>>> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
>>>>> University of Oxford,             Tel:  +44 1865 272861 (self)
>>>>> 1 South Parks Road,                     +44 1865 272866 (PA)
>>>>> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>>>>> ______________________________________________
>>>>> R-devel at r-project.org mailing list
>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>> -- 
>>> Brian D. Ripley,                  ripley at stats.ox.ac.uk
>>> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
>>> University of Oxford,             Tel:  +44 1865 272861 (self)
>>> 1 South Parks Road,                     +44 1865 272866 (PA)
>>> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>
>> -- 
>> Brian D. Ripley,                  ripley at stats.ox.ac.uk
>> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
>> University of Oxford,             Tel:  +44 1865 272861 (self)
>> 1 South Parks Road,                     +44 1865 272866 (PA)
>> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>>
>>
>


From simon.urbanek at r-project.org  Wed Jul 23 18:11:05 2008
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Wed, 23 Jul 2008 12:11:05 -0400
Subject: [Rd] Clash between 'Cairo' and 'EBImage' packages on Windows
In-Reply-To: <488752A7.5070603@statistik.tu-dortmund.de>
References: <59d7961d0807191126m63511789nf2edbbe45c36aef3@mail.gmail.com>
	<1A68FCB28DE72F4BA3B967E6506CCE43030495F7@mildnpexmb01.maninvestments.ad.man.com>
	<alpine.LFD.1.10.0807211106590.8931@gannet.stats.ox.ac.uk>
	<F0ADBA94-B1F5-48EC-AA1A-96DBA7EFB25A@r-project.org>
	<alpine.LFD.1.10.0807220909580.9401@gannet.stats.ox.ac.uk>
	<alpine.LFD.1.10.0807231117130.32145@gannet.stats.ox.ac.uk>
	<D812F553-C405-41F0-9E0E-0F3CB09DEA9C@r-project.org>
	<488752A7.5070603@statistik.tu-dortmund.de>
Message-ID: <AD89667C-6A30-47BB-B120-D6546B506549@r-project.org>


On Jul 23, 2008, at 11:47 , Uwe Ligges wrote:

>
>
> Simon Urbanek wrote:
>> On Jul 23, 2008, at 6:21 , Prof Brian Ripley wrote:
>>> I updated one of by Windows' boxes to GTK 2.12.9, and replaced the  
>>> libcairo-2.dll in the Cairo binary distribution by that from GTK  
>>> 2.12.9.
>>> At that point Cairo and EBImage worked together, in either order.
>>>
>>> I think Uwe may need to trigger a rebuild of his Cairo binary to  
>>> pick up Simon's updated libcairo-2.dll -- the existing binary is  
>>> not compatible with GTK 2.12.9.
>>>
>> I have released a new version of Cario on Monday just to trigger  
>> this, so once CRAN is updated it should happen automatically.
>
> Sorry, I'm currently a bit short of time:
> - Should I install GTK 2.12.9 or does it work with older versions?
> - So do I understand alright that I do not need to trigger anything  
> yet?
>

As far as I am concerned nothing needs to be done - Cairo package  
pulls its own copy of libcairo-2 (1.6.4 which comes from GTK+) when  
built and I have submitted a new version of Cairo to CRAN few days ago  
so hopefully it will appear there sometime.
I don't know what EBImage needs, though...

Cheers,
Simon


>
>> Thanks,
>> Simon
>>> On Tue, 22 Jul 2008, Prof Brian Ripley wrote:
>>>
>>>> On Mon, 21 Jul 2008, Simon Urbanek wrote:
>>>>
>>>>> Brian,
>>>>> thanks for the analysis.
>>>>> On Jul 21, 2008, at 6:29 , Prof Brian Ripley wrote:
>>>>>> On Mon, 21 Jul 2008, Sklyar, Oleg (London) wrote:
>>>>>>> EBImage is dynamically linked against GTK, which includes cairo
>>>>>>> libraries, so those are installed along with GTK. Cairo seems  
>>>>>>> to be
>>>>>>> statically linking to libcairo.dll.a. I would assume that if  
>>>>>>> it is
>>>>>> That is an import library, so it is actually linked to  
>>>>>> libcairo-2.dll, which it ships.
>>>>>>> linked statically it should not get confused with a shared  
>>>>>>> library
>>>>>>> present elsewhere in the path, but it looks like it does. I  
>>>>>>> have no
>>>>>>> solution for that because unlike Cairo I cannot not statically  
>>>>>>> link
>>>>>>> EBImage to GTK as it is not one library that I need, but a  
>>>>>>> bunch of
>>>>>>> those.
>>>>>>> On Linux you won't get this problem as it uses the same  
>>>>>>> centrally
>>>>>>> installed Cairo library.
>>>>>>> In a way it would be better, if Cairo relied on the  
>>>>>>> gladewin32.sf.net
>>>>>>> which normally provides GTK (and thus cairo libraries) for  
>>>>>>> Windows and
>>>>>>> linked dynamically, but probably to simplify user  
>>>>>>> installations the
>>>>>>> developers wanted to avoid this.
>>>>>> It _is_ using dynamic loading, or there would be no conflict.   
>>>>>> From the names, it looks very like that it is using a DLL from  
>>>>>> gladewin32.
>>>>>> The real issue looks rather like a versioning problem, that the  
>>>>>> cairo libraries installed as part of GTK and used by EBImage  
>>>>>> are way too old (cairo_pdf_surface_create was added at cairo  
>>>>>> 1.2, and cairo is at 1.6.4). So updating to the current GTK  
>>>>>> distribution may be all that is needed (and Henrik could also  
>>>>>> try replacing your GTK's libcairo-2.dll by that distributed  
>>>>>> with Cairo).
>>>>> For compatibility sake I have updated the libcairo binary to  
>>>>> 1.6.4 (based on GTK+ build), so if EBImage gets updated all  
>>>>> should be well.
>>>>
>>>> EBImage relies on a user installation of GTK (AFAICS).  Last  
>>>> night I updated my GTK to 2.12.9 and used that's libcairo-2.dll  
>>>> in Cairo. It all seemed to work.
>>>>
>>>>>>> There is not much I can do now about this, but I will follow  
>>>>>>> the thread
>>>>>>> if anybody comes up with an idea to change the code if possible
>>>>>> The Cairo package (which ships DLLs) could rename them, as R  
>>>>>> itself does where it builds its own versions.  Or it could link  
>>>>>> statically (if that works, which it does not for e.g. package  
>>>>>> XML).
>>>>> I'd rather not maintain my own build of libcairo for Windows  
>>>>> since I don't use it. I may consider renaming the DLL, but given  
>>>>> that I'm not building it from sources I'm not sure whether there  
>>>>> is a trivial way to do that.
>>>>
>>>> If you are not building it yourself, then the only way is to use  
>>>> an editor on the DLL to change the embedded name.  I wouldn't  
>>>> suggest you do that (I had thought you were building it yourself).
>>>>
>>>>> Best,
>>>>> Simon
>>>>>> I don't really understand why this was posted to R-devel: it is  
>>>>>> not an R issue.
>>>>>>> Dr Oleg Sklyar
>>>>>>> Technology Group
>>>>>>> Man Investments Ltd
>>>>>>> +44 (0)20 7144 3803
>>>>>>> osklyar at maninvestments.com
>>>>>>>> -----Original Message-----
>>>>>>>> From: r-devel-bounces at r-project.org
>>>>>>>> [mailto:r-devel-bounces at r-project.org] On Behalf Of Henrik  
>>>>>>>> Bengtsson
>>>>>>>> Sent: 19 July 2008 19:26
>>>>>>>> To: R-devel
>>>>>>>> Subject: [Rd] Clash between 'Cairo' and 'EBImage' packages on  
>>>>>>>> Windows
>>>>>>>> Hi,
>>>>>>>> on Windows XP Pro with R version 2.7.1 Patched (2008-06-27
>>>>>>>> r46012) the 'Cairo' and the 'EBImage' packages does not play
>>>>>>>> well together.
>>>>>>>> Loading EBImage before Cairo cause the following to happen:
>>>>>>>> # Rterm --vanilla
>>>>>>>>> library(EBImage);
>>>>>>>>> library(Cairo)
>>>>>>>> Error in inDL(x, as.logical(local), as.logical(now), ...) :
>>>>>>>> unable to load shared library
>>>>>>>> 'C:/PROGRA~1/R/R-2.7.1pat/library/Cairo/libs/Cai
>>>>>>>> ro.dll':
>>>>>>>> LoadLibrary failure:  The specified procedure could not be  
>>>>>>>> found.
>>>>>>>> Error : .onLoad failed in 'loadNamespace' for 'Cairo'
>>>>>>>> Error: package/namespace load failed for 'Cairo'
>>>>>>>> with a dialog titled 'Rterm.exe - Entry Point Not Found'
>>>>>>>> saying 'The procedure entry point cairo_pdf_surface_create
>>>>>>>> could not be located in the dynamic link library  
>>>>>>>> libcairo-2.dll'.
>>>>>>>> Loading the packages in the reverse order works, but the
>>>>>>>> Rterm seems unstable, e.g. calling q() immediately after will
>>>>>>>> exit the R session without questions:
>>>>>>>> # Rterm --vanilla
>>>>>>>>> library(Cairo)
>>>>>>>>> library(EBImage)
>>>>>>>>> q()
>>>>>>>> [Immediately back to the command line].
>>>>>>>> I cannot reproduce the problem on R v2.7.1 on Ubuntu Hardy.
>>>>>>>>> sessionInfo()
>>>>>>>> R version 2.7.1 Patched (2008-06-27 r46012)
>>>>>>>> i386-pc-mingw32
>>>>>>>> locale:
>>>>>>>> LC_COLLATE=English_United States.1252;LC_CTYPE=English_United
>>>>>>>> States.1252;LC_MON ETARY=English_United
>>>>>>>> States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252
>>>>>>>> attached base packages:
>>>>>>>> [1] stats     graphics  grDevices utils     datasets   
>>>>>>>> methods   base
>>>>>>>> other attached packages:
>>>>>>>> [1] EBImage_2.4.0 Cairo_1.4-2
>>>>>>>> Cheers
>>>>>>>> Henrik
>>>>>>>> ______________________________________________
>>>>>>>> R-devel at r-project.org mailing list
>>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>>>> **********************************************************************
>>>>>>> The contents of this email are for the named addressee(s... 
>>>>>>> {{dropped:22}}
>>>>>>> ______________________________________________
>>>>>>> R-devel at r-project.org mailing list
>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>>> -- 
>>>>>> Brian D. Ripley,                  ripley at stats.ox.ac.uk
>>>>>> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
>>>>>> University of Oxford,             Tel:  +44 1865 272861 (self)
>>>>>> 1 South Parks Road,                     +44 1865 272866 (PA)
>>>>>> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>>>>>> ______________________________________________
>>>>>> R-devel at r-project.org mailing list
>>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>> ______________________________________________
>>>>> R-devel at r-project.org mailing list
>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>
>>>> -- 
>>>> Brian D. Ripley,                  ripley at stats.ox.ac.uk
>>>> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/ 
>>>> ~ripley/
>>>> University of Oxford,             Tel:  +44 1865 272861 (self)
>>>> 1 South Parks Road,                     +44 1865 272866 (PA)
>>>> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>>>>
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>
>>>
>>> -- 
>>> Brian D. Ripley,                  ripley at stats.ox.ac.uk
>>> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
>>> University of Oxford,             Tel:  +44 1865 272861 (self)
>>> 1 South Parks Road,                     +44 1865 272866 (PA)
>>> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>>>
>>>
>
>


From vogranovich at jumptrading.com  Wed Jul 23 20:53:04 2008
From: vogranovich at jumptrading.com (Vadim Organovich)
Date: Wed, 23 Jul 2008 13:53:04 -0500
Subject: [Rd] [R] shQuote and cat
In-Reply-To: <4887741D.9030804@stats.uwo.ca>
References: <22D850BC39A25742977325ADDE208E770266956391@chiexchange02.w2k.jumptrading.com>,
	<4887741D.9030804@stats.uwo.ca>
Message-ID: <22D850BC39A25742977325ADDE208E770266956392@chiexchange02.w2k.jumptrading.com>

I feel like it now belongs to r-devel more than to r-help.

My output was garbled because I sent the original message as HTML, sorry about that.

Your output, "\"\\"a\\"\"", is what I get too. That is
 > cat(shQuote(shQuote(shQuote("a"))), '\n')
"\"\\"a\\"\""
, which I think should be "\"\\\"a\\\"\"".

Actually, the R's output, "\"\\"a\\"\"", is not even a valid string literal, that is
> x <- "\"\\"a\\"\""
fails.


Now, by cat() being the inverse of shQuote() I mean printing the same literal as it goes into shQuote, quotes included:
> cat(shQuote("a"), '\n')
"a"

whereas
> cat("a", '\n')
a  ## no quotes

If cat() is not the inverse of shQuote() in the above sense, what is?

Thanks,
Vadim
________________________________________
From: Duncan Murdoch [murdoch at stats.uwo.ca]
Sent: Wednesday, July 23, 2008 1:10 PM
To: Vadim Organovich
Cc: r-help at r-project.org
Subject: Re: [R] shQuote and cat

On 7/23/2008 12:20 PM, Vadim Organovich wrote:
> Dear R-users,
>
> It is my understanding that cat(shQuote(a.string)) should print the origintal a.string. Is this right?

No, cat(a.string) should print the original a.string.  shQuote(a.string)
adds quotes so that a.string can be used in the shell.

> I am not sure cat() correctly prints strings which are generated by triple-shQuote():
>
>> shQuote(shQuote("a"))
> [1] "\"\\\"a\\\"\""
>> cat(shQuote(shQuote(shQuote("a"))), '\n')
> "\"\\"a\\"\<file://\\"a\\"\>""

That's a very strange result.  I tried the obsolete version of R that
you're using, and I didn't see it. I get this:

 > cat(shQuote(shQuote(shQuote("a"))), '\n')
"\"\\"a\\"\""

Duncan Murdoch

> As you can see the latter string has fewer quoting '\' than the former.
> cat() of double shQuote works as expected:
>
>> shQuote("a")
> [1] "\"a\""
>> cat(shQuote(shQuote("a")), '\n')
> "\"a\""
>> version
>                _
> platform       i386-pc-mingw32
> arch           i386
> os             mingw32
> system         i386, mingw32
> status
> major          2
> minor          6.1
> year           2007
> month          11
> day            26
> svn rev        43537
> language       R
> version.string R version 2.6.1 (2007-11-26)
> Am I missing something?
>
> Thanks,
> Vadim
>
> ________________________________
> Note: This email is for the confidential use of the named addressee(s) only and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you are hereby notified that any review, dissemination or copying of this email is strictly prohibited, and to please notify the sender immediately and destroy this email and any attachments. Email transmission cannot be guaranteed to be secure or error-free. Jump Trading, therefore, does not make any guarantees as to the completeness or accuracy of this email or any attachments. This email is for informational purposes only and does not constitute a recommendation, offer, request or solicitation of any kind to buy, sell, subscribe, redeem or perform any type of transaction of a financial product.
>
>       [[alternative HTML version deleted]]
>
> ______________________________________________
> R-help at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.

Note: This email is for the confidential use of the named addressee(s) only and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you are hereby notified that any review, dissemination or copying of this email is strictly prohibited, and to please notify the sender immediately and destroy this email and any attachments.  Email transmission cannot be guaranteed to be secure or error-free.  Jump Trading, therefore, does not make any guarantees as to the completeness or accuracy of this email or any attachments.  This email is for informational purposes only and does not constitute a recommendation, offer, request or solicitation of any kind to buy, sell, subscribe, redeem or perform any type of transaction of a financial product.


From murdoch at stats.uwo.ca  Wed Jul 23 21:38:21 2008
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Wed, 23 Jul 2008 15:38:21 -0400
Subject: [Rd] [R] shQuote and cat
In-Reply-To: <22D850BC39A25742977325ADDE208E770266956392@chiexchange02.w2k.jumptrading.com>
References: <22D850BC39A25742977325ADDE208E770266956391@chiexchange02.w2k.jumptrading.com>,
	<4887741D.9030804@stats.uwo.ca>
	<22D850BC39A25742977325ADDE208E770266956392@chiexchange02.w2k.jumptrading.com>
Message-ID: <488788AD.1050605@stats.uwo.ca>

On 7/23/2008 2:53 PM, Vadim Organovich wrote:
> I feel like it now belongs to r-devel more than to r-help.
> 
> My output was garbled because I sent the original message as HTML, sorry about that.
> 
> Your output, "\"\\"a\\"\"", is what I get too. That is
>  > cat(shQuote(shQuote(shQuote("a"))), '\n')
> "\"\\"a\\"\""
> , which I think should be "\"\\\"a\\\"\"".
> 
> Actually, the R's output, "\"\\"a\\"\"", is not even a valid string literal, that is
>> x <- "\"\\"a\\"\""
> fails.

It's not intended to be a string literal in R, it's intended to be input 
to the Windows CMD shell.  If you want a string literal in R, don't use 
cat().  cat() shows you the naked contents of the string without any 
quoting to make it a valid string literal.

> 
> 
> Now, by cat() being the inverse of shQuote() I mean printing the same literal as it goes into shQuote, quotes included:
>> cat(shQuote("a"), '\n')
> "a"
> 
> whereas
>> cat("a", '\n')
> a  ## no quotes
> 
> If cat() is not the inverse of shQuote() in the above sense, what is?

On Unix-like systems I think asking the shell to echo the output, i.e.

system(paste("echo", shQuote(input)), intern=TRUE)

is intended to reproduce the input.  However, the Windows CMD shell is 
different.  I don't know how to strip quotes off a string in it, e.g. I see

C:\WINDOWS\system32 echo "a"
"a"

Nevertheless, the quotes *are* necessary when passing filenames to 
commands, and they'll typically be stripped off when doing that, e.g.

echo hi >"a"

will create a file named a, not named "a", and

echo hi >"a b"

will create a file with a space in the name.

Duncan Murdoch


From vogranovich at jumptrading.com  Wed Jul 23 22:46:07 2008
From: vogranovich at jumptrading.com (Vadim Organovich)
Date: Wed, 23 Jul 2008 15:46:07 -0500
Subject: [Rd] [R] shQuote and cat
In-Reply-To: <488788AD.1050605@stats.uwo.ca>
References: <22D850BC39A25742977325ADDE208E770266956391@chiexchange02.w2k.jumptrading.com>,
	<4887741D.9030804@stats.uwo.ca>
	<22D850BC39A25742977325ADDE208E770266956392@chiexchange02.w2k.jumptrading.com>,
	<488788AD.1050605@stats.uwo.ca>
Message-ID: <22D850BC39A25742977325ADDE208E770266956393@chiexchange02.w2k.jumptrading.com>

It is precizely a shell command that I am trying to generate. To be specific let's try to have R 'output' the following shell command: 'echo "\"a\""'. This is is a valid command, at least in bash:
bash-3.2$ echo "\"a\""
"a"

Now in R:
> x <- 'echo "\"a\""'
> cat(x, '\n')
echo ""a""
> cat(shQuote(x), '\n')
"echo \"\"a\"\""

Whichever way you do it it is not right. Again I think cat('echo "\"a\""') should be printing *echo "\"a\""* (asterics are not a part of the output)

________________________________________
From: Duncan Murdoch [murdoch at stats.uwo.ca]
Sent: Wednesday, July 23, 2008 2:38 PM
To: Vadim Organovich
Cc: r-devel at r-project.org
Subject: Re: [Rd] [R] shQuote and cat

On 7/23/2008 2:53 PM, Vadim Organovich wrote:
> I feel like it now belongs to r-devel more than to r-help.
>
> My output was garbled because I sent the original message as HTML, sorry about that.
>
> Your output, "\"\\"a\\"\"", is what I get too. That is
>  > cat(shQuote(shQuote(shQuote("a"))), '\n')
> "\"\\"a\\"\""
> , which I think should be "\"\\\"a\\\"\"".
>
> Actually, the R's output, "\"\\"a\\"\"", is not even a valid string literal, that is
>> x <- "\"\\"a\\"\""
> fails.

It's not intended to be a string literal in R, it's intended to be input
to the Windows CMD shell.  If you want a string literal in R, don't use
cat().  cat() shows you the naked contents of the string without any
quoting to make it a valid string literal.

>
>
> Now, by cat() being the inverse of shQuote() I mean printing the same literal as it goes into shQuote, quotes included:
>> cat(shQuote("a"), '\n')
> "a"
>
> whereas
>> cat("a", '\n')
> a  ## no quotes
>
> If cat() is not the inverse of shQuote() in the above sense, what is?

On Unix-like systems I think asking the shell to echo the output, i.e.

system(paste("echo", shQuote(input)), intern=TRUE)

is intended to reproduce the input.  However, the Windows CMD shell is
different.  I don't know how to strip quotes off a string in it, e.g. I see

C:\WINDOWS\system32 echo "a"
"a"

Nevertheless, the quotes *are* necessary when passing filenames to
commands, and they'll typically be stripped off when doing that, e.g.

echo hi >"a"

will create a file named a, not named "a", and

echo hi >"a b"

will create a file with a space in the name.

Duncan Murdoch

Note: This email is for the confidential use of the named addressee(s) only and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you are hereby notified that any review, dissemination or copying of this email is strictly prohibited, and to please notify the sender immediately and destroy this email and any attachments.  Email transmission cannot be guaranteed to be secure or error-free.  Jump Trading, therefore, does not make any guarantees as to the completeness or accuracy of this email or any attachments.  This email is for informational purposes only and does not constitute a recommendation, offer, request or solicitation of any kind to buy, sell, subscribe, redeem or perform any type of transaction of a financial product.


From murdoch at stats.uwo.ca  Thu Jul 24 02:04:04 2008
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Wed, 23 Jul 2008 20:04:04 -0400
Subject: [Rd] [R] shQuote and cat
In-Reply-To: <22D850BC39A25742977325ADDE208E770266956393@chiexchange02.w2k.jumptrading.com>
References: <22D850BC39A25742977325ADDE208E770266956391@chiexchange02.w2k.jumptrading.com>,
	<4887741D.9030804@stats.uwo.ca>	<22D850BC39A25742977325ADDE208E770266956392@chiexchange02.w2k.jumptrading.com>,
	<488788AD.1050605@stats.uwo.ca>
	<22D850BC39A25742977325ADDE208E770266956393@chiexchange02.w2k.jumptrading.com>
Message-ID: <4887C6F4.800@stats.uwo.ca>

Vadim Organovich wrote:
> It is precizely a shell command that I am trying to generate. To be specific let's try to have R 'output' the following shell command: 'echo "\"a\""'. This is is a valid command, at least in bash:
> bash-3.2$ echo "\"a\""
> "a"
>
> Now in R:
>   
>> x <- 'echo "\"a\""'
>> cat(x, '\n')
>>     
> echo ""a""
>   
>> cat(shQuote(x), '\n')
>>     
> "echo \"\"a\"\""
>
> Whichever way you do it it is not right. Again I think cat('echo "\"a\""') should be printing *echo "\"a\""* (asterics are not a part of the output)
>   

But you were running on Windows, so the default shell is CMD, not bash.  
shQuote doesn't support bash specifically, but I imagine it uses the 
same quoting rules as sh, so you should use shQuote('"a"', type="sh").  
On my machine that gives '"a"', and echo '"a"' prints "a" as you wanted.

I don't think you want to quote the "echo" in the command, only the 
string that you want it to print, i.e. for the full command you should use

 > cat(paste("echo", shQuote('"a"', type="sh")))
echo '"a"'

Duncan Murdoch
> ________________________________________
> From: Duncan Murdoch [murdoch at stats.uwo.ca]
> Sent: Wednesday, July 23, 2008 2:38 PM
> To: Vadim Organovich
> Cc: r-devel at r-project.org
> Subject: Re: [Rd] [R] shQuote and cat
>
> On 7/23/2008 2:53 PM, Vadim Organovich wrote:
>   
>> I feel like it now belongs to r-devel more than to r-help.
>>
>> My output was garbled because I sent the original message as HTML, sorry about that.
>>
>> Your output, "\"\\"a\\"\"", is what I get too. That is
>>  > cat(shQuote(shQuote(shQuote("a"))), '\n')
>> "\"\\"a\\"\""
>> , which I think should be "\"\\\"a\\\"\"".
>>
>> Actually, the R's output, "\"\\"a\\"\"", is not even a valid string literal, that is
>>     
>>> x <- "\"\\"a\\"\""
>>>       
>> fails.
>>     
>
> It's not intended to be a string literal in R, it's intended to be input
> to the Windows CMD shell.  If you want a string literal in R, don't use
> cat().  cat() shows you the naked contents of the string without any
> quoting to make it a valid string literal.
>
>   
>> Now, by cat() being the inverse of shQuote() I mean printing the same literal as it goes into shQuote, quotes included:
>>     
>>> cat(shQuote("a"), '\n')
>>>       
>> "a"
>>
>> whereas
>>     
>>> cat("a", '\n')
>>>       
>> a  ## no quotes
>>
>> If cat() is not the inverse of shQuote() in the above sense, what is?
>>     
>
> On Unix-like systems I think asking the shell to echo the output, i.e.
>
> system(paste("echo", shQuote(input)), intern=TRUE)
>
> is intended to reproduce the input.  However, the Windows CMD shell is
> different.  I don't know how to strip quotes off a string in it, e.g. I see
>
> C:\WINDOWS\system32 echo "a"
> "a"
>
> Nevertheless, the quotes *are* necessary when passing filenames to
> commands, and they'll typically be stripped off when doing that, e.g.
>
> echo hi >"a"
>
> will create a file named a, not named "a", and
>
> echo hi >"a b"
>
> will create a file with a space in the name.
>
> Duncan Murdoch
>
> Note: This email is for the confidential use of the named addressee(s) only and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you are hereby notified that any review, dissemination or copying of this email is strictly prohibited, and to please notify the sender immediately and destroy this email and any attachments.  Email transmission cannot be guaranteed to be secure or error-free.  Jump Trading, therefore, does not make any guarantees as to the completeness or accuracy of this email or any attachments.  This email is for informational purposes only and does not constitute a recommendation, offer, request or solicitation of any kind to buy, sell, subscribe, redeem or perform any type of transaction of a financial product.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From simon.urbanek at r-project.org  Thu Jul 24 03:08:58 2008
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Wed, 23 Jul 2008 21:08:58 -0400
Subject: [Rd] [R] shQuote and cat
In-Reply-To: <22D850BC39A25742977325ADDE208E770266956393@chiexchange02.w2k.jumptrading.com>
References: <22D850BC39A25742977325ADDE208E770266956391@chiexchange02.w2k.jumptrading.com>,
	<4887741D.9030804@stats.uwo.ca>
	<22D850BC39A25742977325ADDE208E770266956392@chiexchange02.w2k.jumptrading.com>,
	<488788AD.1050605@stats.uwo.ca>
	<22D850BC39A25742977325ADDE208E770266956393@chiexchange02.w2k.jumptrading.com>
Message-ID: <DA220F4A-BCC6-4B94-96A1-29BD06BFE22A@r-project.org>


On Jul 23, 2008, at 4:46 PM, Vadim Organovich wrote:

> It is precizely a shell command that I am trying to generate. To be  
> specific let's try to have R 'output' the following shell command:  
> 'echo "\"a\""'. This is is a valid command, at least in bash:
> bash-3.2$ echo "\"a\""
> "a"
>
> Now in R:
>> x <- 'echo "\"a\""'
>> cat(x, '\n')
> echo ""a""
>> cat(shQuote(x), '\n')
> "echo \"\"a\"\""
>
> Whichever way you do it it is not right.

Well, you input is not right ('\"' is parsed in R into '"') - you have  
to escape the backslash that you want to keep and all is well:

 > x <- 'echo "\\"a\\""'
 > cat(x, '\n')
echo "\"a\""
 > cat(shQuote(x), '\n')
'echo "\"a\""'
 > system(paste("sh -c",shQuote(x,type="sh")))
"a"

Cheers,
Simon


> Again I think cat('echo "\"a\""') should be printing *echo "\"a\""*  
> (asterics are not a part of the output)
>
> ________________________________________
> From: Duncan Murdoch [murdoch at stats.uwo.ca]
> Sent: Wednesday, July 23, 2008 2:38 PM
> To: Vadim Organovich
> Cc: r-devel at r-project.org
> Subject: Re: [Rd] [R] shQuote and cat
>
> On 7/23/2008 2:53 PM, Vadim Organovich wrote:
>> I feel like it now belongs to r-devel more than to r-help.
>>
>> My output was garbled because I sent the original message as HTML,  
>> sorry about that.
>>
>> Your output, "\"\\"a\\"\"", is what I get too. That is
>>> cat(shQuote(shQuote(shQuote("a"))), '\n')
>> "\"\\"a\\"\""
>> , which I think should be "\"\\\"a\\\"\"".
>>
>> Actually, the R's output, "\"\\"a\\"\"", is not even a valid string  
>> literal, that is
>>> x <- "\"\\"a\\"\""
>> fails.
>
> It's not intended to be a string literal in R, it's intended to be  
> input
> to the Windows CMD shell.  If you want a string literal in R, don't  
> use
> cat().  cat() shows you the naked contents of the string without any
> quoting to make it a valid string literal.
>
>>
>>
>> Now, by cat() being the inverse of shQuote() I mean printing the  
>> same literal as it goes into shQuote, quotes included:
>>> cat(shQuote("a"), '\n')
>> "a"
>>
>> whereas
>>> cat("a", '\n')
>> a  ## no quotes
>>
>> If cat() is not the inverse of shQuote() in the above sense, what is?
>
> On Unix-like systems I think asking the shell to echo the output, i.e.
>
> system(paste("echo", shQuote(input)), intern=TRUE)
>
> is intended to reproduce the input.  However, the Windows CMD shell is
> different.  I don't know how to strip quotes off a string in it,  
> e.g. I see
>
> C:\WINDOWS\system32 echo "a"
> "a"
>
> Nevertheless, the quotes *are* necessary when passing filenames to
> commands, and they'll typically be stripped off when doing that, e.g.
>
> echo hi >"a"
>
> will create a file named a, not named "a", and
>
> echo hi >"a b"
>
> will create a file with a space in the name.
>
> Duncan Murdoch
>
> Note: This email is for the confidential use of the named  
> addressee(s) only and may contain proprietary, confidential or  
> privileged information. If you are not the intended recipient, you  
> are hereby notified that any review, dissemination or copying of  
> this email is strictly prohibited, and to please notify the sender  
> immediately and destroy this email and any attachments.  Email  
> transmission cannot be guaranteed to be secure or error-free.  Jump  
> Trading, therefore, does not make any guarantees as to the  
> completeness or accuracy of this email or any attachments.  This  
> email is for informational purposes only and does not constitute a  
> recommendation, offer, request or solicitation of any kind to buy,  
> sell, subscribe, redeem or perform any type of transaction of a  
> financial product.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From felix at nfrac.org  Thu Jul 24 05:16:22 2008
From: felix at nfrac.org (Felix Andrews)
Date: Thu, 24 Jul 2008 13:16:22 +1000
Subject: [Rd] plot.dendrogram xlim/ylim
Message-ID: <94730b8a0807232016k11a953e6pf0b22c80fc6f36f9@mail.gmail.com>

list(...),

I would like to zoom in to the leaves of large trees in a dendrogram
plot. The playwith package allows zooming by passing xlim and ylim
arguments to the plot call (Hmisc does this too I think). But
currently stats:::plot.dendrogram does not accept xlim or ylim. So I
would like to enable that. In place of the existing code chunk:

    xlim <- c(x1 - 1/2, x2 + 1/2)
    ylim <- c(0, yTop)
    if (horiz) {
        xl <- xlim
        xlim <- rev(ylim)
        ylim <- xl
        tmp <- xaxt
        xaxt <- yaxt
        yaxt <- tmp
    }
    plot(0, xlim = xlim, ylim = ylim, ......

I propose something like:

function(..., xlim, ylim)

    xlim0 <- c(x1 - 1/2, x2 + 1/2)
    ylim0 <- c(0, yTop)
    if (horiz) {
        xl <- xlim0
        xlim0 <- rev(ylim0)
        ylim <- xl
        tmp <- xaxt
        xaxt <- yaxt
        yaxt <- tmp
    }
    if (missing(xlim)) xlim <- xlim0
    if (missing(ylim)) ylim <- ylim0
    plot(0, xlim = xlim, ylim = ylim, ......


Regards,
Felix

-- 
Felix Andrews / ???
PhD candidate
Integrated Catchment Assessment and Management Centre
The Fenner School of Environment and Society
The Australian National University (Building 48A), ACT 0200
Beijing Bag, Locked Bag 40, Kingston ACT 2604
http://www.neurofractal.org/felix/
3358 543D AAC6 22C2 D336 80D9 360B 72DD 3E4C F5D8


From Waclaw.Marcin.Kusnierczyk at idi.ntnu.no  Thu Jul 24 09:38:25 2008
From: Waclaw.Marcin.Kusnierczyk at idi.ntnu.no (Wacek Kusnierczyk)
Date: Thu, 24 Jul 2008 09:38:25 +0200
Subject: [Rd] [R] shQuote and cat
In-Reply-To: <4887C6F4.800@stats.uwo.ca>
References: <22D850BC39A25742977325ADDE208E770266956391@chiexchange02.w2k.jumptrading.com>,
	<4887741D.9030804@stats.uwo.ca>	<22D850BC39A25742977325ADDE208E770266956392@chiexchange02.w2k.jumptrading.com>,
	<488788AD.1050605@stats.uwo.ca>	<22D850BC39A25742977325ADDE208E770266956393@chiexchange02.w2k.jumptrading.com>
	<4887C6F4.800@stats.uwo.ca>
Message-ID: <48883171.8030404@idi.ntnu.no>

Duncan Murdoch wrote:
> Vadim Organovich wrote:
>> It is precizely a shell command that I am trying to generate. To be
>> specific let's try to have R 'output' the following shell command:
>> 'echo "\"a\""'. This is is a valid command, at least in bash:
>> bash-3.2$ echo "\"a\""
>> "a"
>>
>> Now in R:
>>  
>>> x <- 'echo "\"a\""'
>>> cat(x, '\n')
>>>     
>> echo ""a""
>>  
>>> cat(shQuote(x), '\n')
>>>     
>> "echo \"\"a\"\""
>>
>> Whichever way you do it it is not right. Again I think cat('echo
>> "\"a\""') should be printing *echo "\"a\""* (asterics are not a part
>> of the output)
>>   
try this:

(x = 'echo "\\"a\\""') # or x = 'echo \"\\\"a\\\"\"')
[1] "echo \"\\\"a\\\"\""

cat(x, "\n")
# echo "\"a\""

as desired.  you need to backslash the backslash.

vQ


From maechler at stat.math.ethz.ch  Thu Jul 24 09:49:39 2008
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Thu, 24 Jul 2008 09:49:39 +0200
Subject: [Rd] plot.dendrogram xlim/ylim
In-Reply-To: <94730b8a0807232016k11a953e6pf0b22c80fc6f36f9@mail.gmail.com>
References: <94730b8a0807232016k11a953e6pf0b22c80fc6f36f9@mail.gmail.com>
Message-ID: <18568.13331.11050.958595@stat.math.ethz.ch>

>>>>> "FA" == Felix Andrews <felix at nfrac.org>
>>>>>     on Thu, 24 Jul 2008 13:16:22 +1000 writes:

    FA> list(...), I would like to zoom in to the leaves of
    FA> large trees in a dendrogram plot. The playwith package
    FA> allows zooming by passing xlim and ylim arguments to the
    FA> plot call (Hmisc does this too I think). But currently
    FA> stats:::plot.dendrogram does not accept xlim or ylim. So
    FA> I would like to enable that. In place of the existing
    FA> code chunk:

  >>     xlim <- c(x1 - 1/2, x2 + 1/2)
  >>     ylim <- c(0, yTop)
  >>     if (horiz) {
  >>         xl <- xlim
  >>         xlim <- rev(ylim)
  >>         ylim <- xl
  >>         tmp <- xaxt
  >>         xaxt <- yaxt
  >>         yaxt <- tmp
  >>     }
  >>     plot(0, xlim = xlim, ylim = ylim, ......
  >> 
  >> I propose something like:
  >> 
  >> function(..., xlim, ylim)
  >> 
  >>     xlim0 <- c(x1 - 1/2, x2 + 1/2)
  >>     ylim0 <- c(0, yTop)
  >>     if (horiz) {
  >>         xl <- xlim0
  >>         xlim0 <- rev(ylim0)
  >>         ylim <- xl
  >>         tmp <- xaxt
  >>         xaxt <- yaxt
  >>         yaxt <- tmp
  >>     }
  >>     if (missing(xlim)) xlim <- xlim0
  >>     if (missing(ylim)) ylim <- ylim0
  >>     plot(0, xlim = xlim, ylim = ylim, ......

Thank you for the suggestion!
Yes, "something like" this will be part of R 2.8.0
(or 'R-devel' as from tomorrow).

Martin Maechler, ETH Zurich

>>  -- 
>>  Felix Andrews / ???
>>  PhD candidate
>>  Integrated Catchment Assessment and Management Centre
>>  The Fenner School of Environment and Society
>>  The Australian National University (Building 48A), ACT 0200
>>  Beijing Bag, Locked Bag 40, Kingston ACT 2604
>>  http://www.neurofractal.org/felix/
>>  3358 543D AAC6 22C2 D336 80D9 360B 72DD 3E4C F5D8


From hb at stat.berkeley.edu  Fri Jul 25 05:10:35 2008
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Thu, 24 Jul 2008 20:10:35 -0700
Subject: [Rd] serialize() to via temporary file is heaps faster than doing
	it directly (on Windows)
Message-ID: <59d7961d0807242010q6dd2d78emb34b222ce38938c0@mail.gmail.com>

Hi,

FYI, I just notice that on Windows (but not Linux) it is orders of
magnitude (below it's 50x) faster to serialize() and object to a
temporary file and then read it back, than to serialize to an object
directly.  This has for instance impact on how fast digest::digest()
can provide a checksum.

Example:
x <- 1:1e7;
t1 <- system.time(raw1 <- serialize(x, connection=NULL));
print(t1);
#    user  system elapsed
#   174.23  129.35  304.70  ## 5 minutes
t2 <- system.time(raw2 <- serialize2(x, connection=NULL));
print(t2);
#     user  system elapsed
#     2.19    0.18    5.72      ## 5 seconds
print(t1/t2);
#      user    system   elapsed
#   79.55708 718.61111  53.26923
stopifnot(identical(raw1, raw2));

where serialize2() is serialize():ing to file and reading the results back:

serialize2 <- function(object, connection, ...) {
  if (is.null(connection)) {
    # It is faster to serialize to a temporary file and read it back
    pathname <- tempfile();
    con <- file(pathname, open="wb");
    on.exit({
      if (!is.null(con))
        close(con);
      if (file.exists(pathname))
        file.remove(pathname);
    });
    base::serialize(object, connection=con, ...);
    close(con);
    con <- NULL;
    fileSize <- file.info(pathname)$size;
    readBin(pathname, what="raw", n=fileSize);
  } else {
    base::serialize(object, connection=connection, ...);
  }
} # serialize2()

The above benchmarking was done in a fresh R v2.7.1 session on WinXP Pro:

> sessionInfo()
R version 2.7.1 Patched (2008-06-27 r46012)
i386-pc-mingw32

locale:
LC_COLLATE=English_United States.1252;LC_CTYPE=English_United States.1252;LC_MON
ETARY=English_United States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base


When I do the same on a Linux machine there is no difference:

> sessionInfo()
R version 2.7.1 (2008-06-23)
x86_64-unknown-linux-gnu

locale:
LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=en_US.UTF-8;LC_COLLATE=en_US.UTF-8;LC_MONETARY=C;LC_MESSAGES=en_US.UTF-8;LC_PAPER=en_US.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US.UTF-8;LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

Is there an obvious reason (and an obvious fix) for this?

Cheers

Henrik


From nicolas.georges at us.calyon.com  Thu Jul 24 16:39:07 2008
From: nicolas.georges at us.calyon.com (NicoNYC)
Date: Thu, 24 Jul 2008 07:39:07 -0700 (PDT)
Subject: [Rd] How to loop through a set of data and to evaluate a function?
Message-ID: <18633260.post@talk.nabble.com>


Hi,
I will explain my problem :
I would like to loop through a set of data taking the set 100 points at a
time.  At each iteration I'd like to evaluate a function over this set.  In
each subsequent iteration i add the next point to my sub set and remove the
oldest and evaluate the function again (something like a moving window).

Small example : this is my data:
1
2
3
..
10

with a moving window of 3 points, i would like to evaluate the following
f(1,2,3)
f(2,3,4)
f(3.4.5)
...
f(8,9,10)

Thank you!
-- 
View this message in context: http://www.nabble.com/How-to-loop-through-a-set-of-data-and-to-evaluate-a-function--tp18633260p18633260.html
Sent from the R devel mailing list archive at Nabble.com.


From Gregor.Gorjanc at bfro.uni-lj.si  Fri Jul 25 13:30:11 2008
From: Gregor.Gorjanc at bfro.uni-lj.si (Gorjanc Gregor)
Date: Fri, 25 Jul 2008 13:30:11 +0200
Subject: [Rd] head() for files
Message-ID: <F189E18BBAA8B6479F618B9044CF4E9C686C1337E2@owa.bfro.uni-lj.si>

Hi!

I was thinking about using the head and tail functions also for files i.e.
show me the first/last few lines of a file. For example:

zz <- file("ex.data", "w")  # open an output file connection
cat("TITLE extra line", "2 3 5 7", "", "11 13 17", file = zz, sep = "\n")
cat("One more line\n", file = zz)
close(zz)
readLines("ex.data")

head.character <- function(x, n=6, ...) readLines(con=x, n=n, ...)

head.character("ex.data")

As can be seen, this is essentially a wrapper for readLines, but a handy one.
Of course, S3 "linking" is needed, perhaps also for class "connection".

I am not prefectly satisfied with it as I would like to see printout line by line.
Any ideas?

--
Lep pozdrav / With regards,
    Gregor Gorjanc
----------------------------------------------------------------------
University of Ljubljana     PhD student
Biotechnical Faculty        www: http://gregor.gorjanc.googlepages.com
Zootechnical Department     blog: http://ggorjan.blogspot.com
Groblje 3                   mail: gregor.gorjanc <at> bfro.uni-lj.si
SI-1230 Domzale             fax: +386 (0)1 72 17 888
Slovenia, Europe            tel: +386 (0)1 72 17 861


From murdoch at stats.uwo.ca  Fri Jul 25 13:53:59 2008
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Fri, 25 Jul 2008 07:53:59 -0400
Subject: [Rd] head() for files
In-Reply-To: <F189E18BBAA8B6479F618B9044CF4E9C686C1337E2@owa.bfro.uni-lj.si>
References: <F189E18BBAA8B6479F618B9044CF4E9C686C1337E2@owa.bfro.uni-lj.si>
Message-ID: <4889BED7.8040402@stats.uwo.ca>

On 25/07/2008 7:30 AM, Gorjanc Gregor wrote:
> Hi!
> 
> I was thinking about using the head and tail functions also for files i.e.
> show me the first/last few lines of a file. For example:
> 
> zz <- file("ex.data", "w")  # open an output file connection
> cat("TITLE extra line", "2 3 5 7", "", "11 13 17", file = zz, sep = "\n")
> cat("One more line\n", file = zz)
> close(zz)
> readLines("ex.data")
> 
> head.character <- function(x, n=6, ...) readLines(con=x, n=n, ...)
> 
> head.character("ex.data")
> 
> As can be seen, this is essentially a wrapper for readLines, but a handy one.
> Of course, S3 "linking" is needed, perhaps also for class "connection".
> 
> I am not prefectly satisfied with it as I would like to see printout line by line.
> Any ideas?

I think you should have called it head.connection, and then

head(file("ex.data"))

would sort of work.  The problems with this are open connections:  what 
should it do on one of those?  Seeking to the start would make sense, 
but not all connections can do that.

Duncan Murdoch


From Gregor.Gorjanc at bfro.uni-lj.si  Fri Jul 25 14:46:29 2008
From: Gregor.Gorjanc at bfro.uni-lj.si (Gorjanc Gregor)
Date: Fri, 25 Jul 2008 14:46:29 +0200
Subject: [Rd] head() for files
In-Reply-To: <4889BED7.8040402@stats.uwo.ca>
References: <F189E18BBAA8B6479F618B9044CF4E9C686C1337E2@owa.bfro.uni-lj.si>,
	<4889BED7.8040402@stats.uwo.ca>
Message-ID: <F189E18BBAA8B6479F618B9044CF4E9C686C1337E3@owa.bfro.uni-lj.si>


>> I was thinking about using the head and tail functions also for files i.e.
>> show me the first/last few lines of a file. For example:
>>
>> zz <- file("ex.data", "w")  # open an output file connection
>> cat("TITLE extra line", "2 3 5 7", "", "11 13 17", file = zz, sep = "\n")
>> cat("One more line\n", file = zz)
>> close(zz)
>> readLines("ex.data")
>>
>> head.character <- function(x, n=6, ...) readLines(con=x, n=n, ...)
>>
>> head.character("ex.data")
>>
>> As can be seen, this is essentially a wrapper for readLines, but a handy one.
>> Of course, S3 "linking" is needed, perhaps also for class "connection".
>>
>> I am not prefectly satisfied with it as I would like to see printout line by line.
>> Any ideas?
>
> I think you should have called it head.connection, and then
>
> head(file("ex.data"))

Yes, but typing head(file("ex.data")) is not that different than readLines(file="ex.data").
However, I do agree that head would work with "character" and "connection" classes.

> would sort of work.  The problems with this are open connections:  what
> should it do on one of those?  Seeking to the start would make sense,
> but not all connections can do that.

Hmm, I am not sure about that since I do not use them often. After a quick look at
?file, I think that file(), url(), gzfile(), bzfile() should work out of the box - see showcases
bellow. unz() can not work without passing a filename, but that is a matter of unz() and
not head.

I also do not know anything about fifos, while pipe could also be useful - btw. I can not find
example for pipe() in ?pipe although the docs say

"For pipe the description is the command line to be piped to or from (see the Examples). This
command line is run in the shell specified by the COMSPEC environment variable."

Regards, gregor

## Some showcases for head()

head.character <- head.connection <- function(x, n=6, ...) readLines(con=x, n=n, ...)
tmp <- function(x)
{
    cat("TITLE extra line", "2 3 5 7", "", "11 13 17", file=x, sep = "\n")
    cat("One more line\n", file=x)
    close(x)
}

head(file("ex.data"))

## file()
zz <- file("ex.data", "w"); tmp(zz)
head.character("ex.data")
head(file("ex.data"))
unlink("ex.data")

## url()
head(url("http://www.r-project.org/index.html"))

## gzfile()
zz <- gzfile("ex.gz", "w"); tmp(zz)
head(gzfile("ex.gz"))
unlink("ex.gz")

## bzfile()
zz <- bzfile("ex.bz2", "w"); tmp(zz)
head(bzfile("ex.bz2"))
unlink("ex.bz2")

## unz()


From felix at nfrac.org  Fri Jul 25 17:19:40 2008
From: felix at nfrac.org (Felix Andrews)
Date: Sat, 26 Jul 2008 01:19:40 +1000
Subject: [Rd] grobX for points?
Message-ID: <94730b8a0807250819n7927b19bi81f975c9b789943c@mail.gmail.com>

Hi R-devel,

It seems that grobX and grobY (from the grid package) do not refer to
the bounding box of a grid.points object.

library(grid)
library(lattice)
xyplot(1:10 ~ 1:10)
downViewport("plot1.panel.1.1.vp")
grob <- grid.get("GRID.points", grep=TRUE)
convertX(grobWidth(grob), "cm")
# 10.3430190058480cm
# (correct, but:)
convertX(grobX(grob, "west"), "cm")
# 5.89552083333333cm
convertX(grobX(grob, "east"), "cm")
# 5.89552083333334cm

So grobX is returning the midpoint, rather than the bounding box. This
is surprising, given that ?grobX says "If the grob describes multiple
shapes, in most cases, the boundary value will correspond to the edge
of a bounding box around all of the shapes."


> sessionInfo()
R version 2.7.1 (2008-06-23)
i386-pc-mingw32

locale:
LC_COLLATE=English_Australia.1252;LC_CTYPE=English_Australia.1252;LC_MONETARY=English_Australia.1252;LC_NUMERIC=C;LC_TIME=English_Australia.1252

attached base packages:
[1] grid      stats     graphics  grDevices utils     datasets
methods   base

other attached packages:
[1] playwith_0.9-10      cairoDevice_2.8      gWidgetsRGtk2_0.0-36
RGtk2_2.12.5-3       gWidgets_0.0-28
[6] lattice_0.17-10

loaded via a namespace (and not attached):
[1] gridBase_0.4-3 tools_2.7.1


-- 
Felix Andrews / ???
PhD candidate
Integrated Catchment Assessment and Management Centre
The Fenner School of Environment and Society
The Australian National University (Building 48A), ACT 0200
Beijing Bag, Locked Bag 40, Kingston ACT 2604
http://www.neurofractal.org/felix/
3358 543D AAC6 22C2 D336 80D9 360B 72DD 3E4C F5D8


From fangzy_2005 at 163.com  Sat Jul 26 04:55:08 2008
From: fangzy_2005 at 163.com (Zhaoyuan Fang)
Date: Sat, 26 Jul 2008 10:55:08 +0800
Subject: [Rd] the C function drawing a rectangle: heatmap() -> image() ->
	do_image() -> GRect() -> GERect() -> rect() -> do_rect() ->
	GRect() ??
Message-ID: <200807261055078432709@163.com>

Hello anyone used to do similar things: search for the final C function that corresponding to the drawing of a rectangle? 

As listed in the subject, I started from heatmap() in R and after several steps reached the GRect() in C. However, then it refers to rect() which further seems to refer to do_rect(), and then, surpringly, do_rect refers to GRect()!!! A dependency circle! How can it work if no functions soly taking the job for drawing a rectangle?  

I know there must be somewhere wrong in my above function "chain", and can you help me to find it out? Many thanks!
 				
--------------
Best wishes,
John

Shanghai Institutes of Biological Sciences,
Chinese Academy of Sciences, 
320 Yue Yang Road, Shanghai 200031
Tel?86-21-54921107
Fax?86-21-54921101

-----------------------------------------------------------------------
The information transmitted in this electronic communication is intended
only for the person or entity to whom it is addressed and may contain
confidential and/or privileged material. Any review, retransmission,
dissemination or other use of or taking of any action in reliance upon this
information by persons or entities other than the intended recipient is
prohibited.
2008-07-26

From p.dalgaard at biostat.ku.dk  Sat Jul 26 09:54:45 2008
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Sat, 26 Jul 2008 09:54:45 +0200
Subject: [Rd] the C function drawing a rectangle: heatmap() -> image()
 ->	do_image() -> GRect() -> GERect() -> rect() -> do_rect() ->	GRect() ??
In-Reply-To: <200807261055078432709@163.com>
References: <200807261055078432709@163.com>
Message-ID: <488AD845.7040200@biostat.ku.dk>

Zhaoyuan Fang wrote:
> Hello anyone used to do similar things: search for the final C function that corresponding to the drawing of a rectangle? 
>
> As listed in the subject, I started from heatmap() in R and after several steps reached the GRect() in C. However, then it refers to rect() which further seems to refer to do_rect(), and then, surpringly, do_rect refers to GRect()!!! A dependency circle! How can it work if no functions soly taking the job for drawing a rectangle?  
>
> I know there must be somewhere wrong in my above function "chain", and can you help me to find it out? Many thanks!
>  				
> https://stat.ethz.ch/mailman/listinfo/r-devel
>   
I see GRect() calling GERect() calling dd->dev->rect(), i.e. a function 
in the current device structure. This will typically have been set to 
something like X11_Rect() or Cairo_Rect() or ....

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907


From fangzy_2005 at 163.com  Sat Jul 26 10:16:12 2008
From: fangzy_2005 at 163.com (=?utf-8?B?Wmhhb3l1YW4gRmFuZw==?=)
Date: Sat, 26 Jul 2008 16:16:12 +0800
Subject: [Rd]
	=?utf-8?q?the_C_function_drawing_a_rectangle=3A_heatmap=28?=
	=?utf-8?b?KSAtPiBpbWFnZSgpLT4JZG9faW1hZ2UoKSAtPiBHUmVjdCgpIC0+IEdF?=
	=?utf-8?b?UmVjdCgpIC0+IHJlY3QoKQ==?=
References: <200807261055078432709@163.com>, <488AD845.7040200@biostat.ku.dk>
Message-ID: <200807261616094217204@163.com>

But rect() still seems to call -> do_rect() -> GRect(), and thus turns back?? How do you consider this strange thing? Thanks!

------------------				 
Best wishes,
Zhaoyuan

-------------------------------------------------------------
????Peter Dalgaard
?????2008-07-26 15:56:39
????fangzy2007 at gmail.com
???R-devel Mailing List
???Re: [Rd] the C function drawing a rectangle: heatmap() -> image()->	do_image() -> GRect() -> GERect() -> rect() 

Zhaoyuan Fang wrote:
> Hello anyone used to do similar things: search for the final C function that corresponding to the drawing of a rectangle? 
>
> As listed in the subject, I started from heatmap() in R and after several steps reached the GRect() in C. However, then it refers to rect() which further seems to refer to do_rect(), and then, surpringly, do_rect refers to GRect()!!! A dependency circle! How can it work if no functions soly taking the job for drawing a rectangle?  
>
> I know there must be somewhere wrong in my above function "chain", and can you help me to find it out? Many thanks!
>  				
> https://stat.ethz.ch/mailman/listinfo/r-devel
>   
I see GRect() calling GERect() calling dd->dev->rect(), i.e. a function 
in the current device structure. This will typically have been set to 
something like X11_Rect() or Cairo_Rect() or ....

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907

______________________________________________
R-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-devel

From p.dalgaard at biostat.ku.dk  Sat Jul 26 10:24:39 2008
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Sat, 26 Jul 2008 10:24:39 +0200
Subject: [Rd] the C function drawing a rectangle: heatmap() -> image()->
 do_image() -> GRect() -> GERect() -> rect()
In-Reply-To: <200807261616094217204@163.com>
References: <200807261055078432709@163.com>,
	<488AD845.7040200@biostat.ku.dk> <200807261616094217204@163.com>
Message-ID: <488ADF47.1020309@biostat.ku.dk>

Zhaoyuan Fang wrote:
> But rect() still seems to call -> do_rect() -> GRect(), and thus turns back?? How do you consider this strange thing? Thanks!
>   
GRect/GERect do NOT call rect()!!!!! Please read what I wrote....
> ------------------				 
> Best wishes,
> Zhaoyuan
>
> -------------------------------------------------------------
> ????Peter Dalgaard
> ?????2008-07-26 15:56:39
> ????fangzy2007 at gmail.com
> ???R-devel Mailing List
> ???Re: [Rd] the C function drawing a rectangle: heatmap() -> image()->	do_image() -> GRect() -> GERect() -> rect() 
>
> Zhaoyuan Fang wrote:
>   
>> Hello anyone used to do similar things: search for the final C function that corresponding to the drawing of a rectangle? 
>>
>> As listed in the subject, I started from heatmap() in R and after several steps reached the GRect() in C. However, then it refers to rect() which further seems to refer to do_rect(), and then, surpringly, do_rect refers to GRect()!!! A dependency circle! How can it work if no functions soly taking the job for drawing a rectangle?  
>>
>> I know there must be somewhere wrong in my above function "chain", and can you help me to find it out? Many thanks!
>>  				
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>   
>>     
> I see GRect() calling GERect() calling dd->dev->rect(), i.e. a function 
> in the current device structure. This will typically have been set to 
> something like X11_Rect() or Cairo_Rect() or ....
>
>   


-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907


From p.murrell at auckland.ac.nz  Sun Jul 27 23:41:12 2008
From: p.murrell at auckland.ac.nz (Paul Murrell)
Date: Mon, 28 Jul 2008 09:41:12 +1200
Subject: [Rd] grobX for points?
In-Reply-To: <94730b8a0807250819n7927b19bi81f975c9b789943c@mail.gmail.com>
References: <94730b8a0807250819n7927b19bi81f975c9b789943c@mail.gmail.com>
Message-ID: <488CEB78.1080901@stat.auckland.ac.nz>

Hi


Felix Andrews wrote:
> Hi R-devel,
> 
> It seems that grobX and grobY (from the grid package) do not refer to
> the bounding box of a grid.points object.
> 
> library(grid)
> library(lattice)
> xyplot(1:10 ~ 1:10)
> downViewport("plot1.panel.1.1.vp")
> grob <- grid.get("GRID.points", grep=TRUE)
> convertX(grobWidth(grob), "cm")
> # 10.3430190058480cm
> # (correct, but:)
> convertX(grobX(grob, "west"), "cm")
> # 5.89552083333333cm
> convertX(grobX(grob, "east"), "cm")
> # 5.89552083333334cm
> 
> So grobX is returning the midpoint, rather than the bounding box. This
> is surprising, given that ?grobX says "If the grob describes multiple
> shapes, in most cases, the boundary value will correspond to the edge
> of a bounding box around all of the shapes."


The grobX() and grobY() calculations for "points" grobs is "imperfect"
because it treats the grob as a set of point locations and does NOT take
into account the size and shape of the actual data symbols.  This means
that a points grob is not treated as multiple shapes, but in fact as a
single set of points.  Hence, the calculations of the boundary for the
shape generate a convex hull around the point locations.  In this case,
the points all lie along a straight line, so the convex hull is a long
thin "cigar" at a 45 degree angle.  The calculation of points on this
boundary draws a line from the centre of the convex hull to the edge.
In this case, the line will intersect the convex hull boundary at the
centre of the set of points for all angles (apart from possibly 45
degrees).

If you want to work with the bounding box for the points, perhaps you
could draw an invisible rectangle based on the range of the data and
work off that, or just use convertX() on the range of the data (?)

Paul


>> sessionInfo()
> R version 2.7.1 (2008-06-23)
> i386-pc-mingw32
> 
> locale:
> LC_COLLATE=English_Australia.1252;LC_CTYPE=English_Australia.1252;LC_MONETARY=English_Australia.1252;LC_NUMERIC=C;LC_TIME=English_Australia.1252
> 
> attached base packages:
> [1] grid      stats     graphics  grDevices utils     datasets
> methods   base
> 
> other attached packages:
> [1] playwith_0.9-10      cairoDevice_2.8      gWidgetsRGtk2_0.0-36
> RGtk2_2.12.5-3       gWidgets_0.0-28
> [6] lattice_0.17-10
> 
> loaded via a namespace (and not attached):
> [1] gridBase_0.4-3 tools_2.7.1
> 
> 

-- 
Dr Paul Murrell
Department of Statistics
The University of Auckland
Private Bag 92019
Auckland
New Zealand
64 9 3737599 x85392
paul at stat.auckland.ac.nz
http://www.stat.auckland.ac.nz/~paul/


From felix at nfrac.org  Mon Jul 28 07:16:00 2008
From: felix at nfrac.org (Felix Andrews)
Date: Mon, 28 Jul 2008 15:16:00 +1000
Subject: [Rd] grobX for points?
In-Reply-To: <488CEB78.1080901@stat.auckland.ac.nz>
References: <94730b8a0807250819n7927b19bi81f975c9b789943c@mail.gmail.com>
	<488CEB78.1080901@stat.auckland.ac.nz>
Message-ID: <94730b8a0807272216kfe89b0drb3a42af6f286bb68@mail.gmail.com>

On Mon, Jul 28, 2008 at 7:41 AM, Paul Murrell <p.murrell at auckland.ac.nz> wrote:
> Hi
>
>
> Felix Andrews wrote:
>> Hi R-devel,
>>
>> It seems that grobX and grobY (from the grid package) do not refer to
>> the bounding box of a grid.points object.
>>
>> library(grid)
>> library(lattice)
>> xyplot(1:10 ~ 1:10)
>> downViewport("plot1.panel.1.1.vp")
>> grob <- grid.get("GRID.points", grep=TRUE)
>> convertX(grobWidth(grob), "cm")
>> # 10.3430190058480cm
>> # (correct, but:)
>> convertX(grobX(grob, "west"), "cm")
>> # 5.89552083333333cm
>> convertX(grobX(grob, "east"), "cm")
>> # 5.89552083333334cm
>>
>> So grobX is returning the midpoint, rather than the bounding box. This
>> is surprising, given that ?grobX says "If the grob describes multiple
>> shapes, in most cases, the boundary value will correspond to the edge
>> of a bounding box around all of the shapes."
>
>
> The grobX() and grobY() calculations for "points" grobs is "imperfect"
> because it treats the grob as a set of point locations and does NOT take
> into account the size and shape of the actual data symbols.  This means
> that a points grob is not treated as multiple shapes, but in fact as a
> single set of points.  Hence, the calculations of the boundary for the
> shape generate a convex hull around the point locations.  In this case,
> the points all lie along a straight line, so the convex hull is a long
> thin "cigar" at a 45 degree angle.  The calculation of points on this
> boundary draws a line from the centre of the convex hull to the edge.
> In this case, the line will intersect the convex hull boundary at the
> centre of the set of points for all angles (apart from possibly 45
> degrees).
>
> If you want to work with the bounding box for the points, perhaps you
> could draw an invisible rectangle based on the range of the data and
> work off that, or just use convertX() on the range of the data (?)

I am doing the latter, which is easy enough. Can I suggest that
grobX.Rd be updated to mention that it returns the convex hull for
points, lines and segments (?) objects? It currently reads

"If the grob describes multiple shapes, in most cases, the boundary
value will correspond to the edge of a bounding box around all of the
shapes. The exception to this is a polygon grob describing multiple
polygons; in that case, the edge corresponds to a convex hull around
all points of all polygons described by the grob."

Regards,
Felix


>
> Paul
>
>
>>> sessionInfo()
>> R version 2.7.1 (2008-06-23)
>> i386-pc-mingw32
>>
>> locale:
>> LC_COLLATE=English_Australia.1252;LC_CTYPE=English_Australia.1252;LC_MONETARY=English_Australia.1252;LC_NUMERIC=C;LC_TIME=English_Australia.1252
>>
>> attached base packages:
>> [1] grid      stats     graphics  grDevices utils     datasets
>> methods   base
>>
>> other attached packages:
>> [1] playwith_0.9-10      cairoDevice_2.8      gWidgetsRGtk2_0.0-36
>> RGtk2_2.12.5-3       gWidgets_0.0-28
>> [6] lattice_0.17-10
>>
>> loaded via a namespace (and not attached):
>> [1] gridBase_0.4-3 tools_2.7.1
>>
>>
>
> --
> Dr Paul Murrell
> Department of Statistics
> The University of Auckland
> Private Bag 92019
> Auckland
> New Zealand
> 64 9 3737599 x85392
> paul at stat.auckland.ac.nz
> http://www.stat.auckland.ac.nz/~paul/
>



-- 
Felix Andrews / ???
PhD candidate
Integrated Catchment Assessment and Management Centre
The Fenner School of Environment and Society
The Australian National University (Building 48A), ACT 0200
Beijing Bag, Locked Bag 40, Kingston ACT 2604
http://www.neurofractal.org/felix/
3358 543D AAC6 22C2 D336 80D9 360B 72DD 3E4C F5D8


From felix at nfrac.org  Mon Jul 28 09:44:49 2008
From: felix at nfrac.org (Felix Andrews)
Date: Mon, 28 Jul 2008 17:44:49 +1000
Subject: [Rd] grid.ls() after grid.remove() fails
Message-ID: <94730b8a0807280044g2fc2a3e2ue18ada3fbc14259b@mail.gmail.com>

Dr Murrell and others,

It seems grid.ls() fails after any use of grid.remove(). It gives an
infinite recursion error even in the simplest cases, and no matter
what arguments are passed to grid.ls.

> library(grid)
> grid.newpage()
> grid.lines(name="foo")
> grid.ls()
foo
> grid.remove("foo")
> grid.ls()
Error: evaluation nested too deeply: infinite recursion / options(expressions=)?
> grid.ls(recursive=FALSE)
Error: evaluation nested too deeply: infinite recursion / options(expressions=)?
> str(grid.ls(print=FALSE))
Error: evaluation nested too deeply: infinite recursion / options(expressions=)?
> traceback()
...etc...
...etc...
...etc...
13: gridList.default(X[[2L]], ...)
12: FUN(X[[2L]], ...)
11: lapply(display.list[1:dl.index], gridList, grobs = grobs,
viewports = viewports,
        fullNames = fullNames, recursive = recursive)
10: gridList.default(X[[2L]], ...)
9: FUN(X[[2L]], ...)
8: lapply(display.list[1:dl.index], gridList, grobs = grobs, viewports
= viewports,
       fullNames = fullNames, recursive = recursive)
7: gridList.default(X[[2L]], ...)
6: FUN(X[[2L]], ...)
5: lapply(display.list[1:dl.index], gridList, grobs = grobs, viewports
= viewports,
       fullNames = fullNames, recursive = recursive)
4: gridList.default(x, grobs = grobs, viewports = viewports, fullNames
= fullNames,
       recursive = recursive)
3: gridList(x, grobs = grobs, viewports = viewports, fullNames = fullNames,
       recursive = recursive)
2: grid.ls(print = FALSE)
1: str(grid.ls(print = FALSE))


> str(current.vpTree())
List of 17
 $ x             :Class 'unit'  atomic [1:1] 0.5
  .. ..- attr(*, "unit")= chr "npc"
  .. ..- attr(*, "valid.unit")= int 0
 $ y             :Class 'unit'  atomic [1:1] 0.5
  .. ..- attr(*, "unit")= chr "npc"
  .. ..- attr(*, "valid.unit")= int 0
 $ width         :Class 'unit'  atomic [1:1] 1
  .. ..- attr(*, "unit")= chr "npc"
  .. ..- attr(*, "valid.unit")= int 0
 $ height        :Class 'unit'  atomic [1:1] 1
  .. ..- attr(*, "unit")= chr "npc"
  .. ..- attr(*, "valid.unit")= int 0
 $ justification : chr "centre"
 $ gp            : list()
  ..- attr(*, "class")= chr "gpar"
 $ clip          : logi TRUE
 $ xscale        : num [1:2] 0 558
 $ yscale        : num [1:2] 557 0
 $ angle         : num 0
 $ layout        : NULL
 $ layout.pos.row: NULL
 $ layout.pos.col: NULL
 $ valid.just    : num [1:2] 0.5 0.5
 $ valid.pos.row : NULL
 $ valid.pos.col : NULL
 $ name          : chr "ROOT"
 - attr(*, "class")= chr "viewport"


> sessionInfo()
R version 2.8.0 Under development (unstable) (2008-07-26 r46127)
i386-pc-mingw32

locale:
LC_COLLATE=English_Australia.1252;LC_CTYPE=English_Australia.1252;LC_MONETARY=English_Australia.1252;LC_NUMERIC=C;LC_TIME=English_Australia.1252

attached base packages:
[1] grid      stats     graphics  grDevices utils     datasets  methods
[8] base


-- 
Felix Andrews / ???
PhD candidate
Integrated Catchment Assessment and Management Centre
The Fenner School of Environment and Society
The Australian National University (Building 48A), ACT 0200
Beijing Bag, Locked Bag 40, Kingston ACT 2604
http://www.neurofractal.org/felix/
3358 543D AAC6 22C2 D336 80D9 360B 72DD 3E4C F5D8


From lgautier at gmail.com  Mon Jul 28 09:50:38 2008
From: lgautier at gmail.com (Laurent Gautier)
Date: Mon, 28 Jul 2008 09:50:38 +0200
Subject: [Rd] cairo device and pch="+"
Message-ID: <27d1e6020807280050p2d9daf38tc9f1b5a5ab1314f0@mail.gmail.com>

Dear list,

I have spotted what could be a memory leak somewhere.

The example below shows how to quickly use up RAM on a linux machine
(the example is taylored for a 2Gb machine, change the size of the matrix m
is needed).

# ---
m <- matrix(rnorm(130), nrow=6000, 6)
X11(type="cairo")
pairs(m)

# --- here the trouble starts (monitor the memory usage as the plot goes).
pairs(m, pch="+")

# this does not seem to act on memory usage of the R process
dev.off()
gc()

# the only way to get back some memory is to kill the R process.




L.


From ripley at stats.ox.ac.uk  Mon Jul 28 12:02:43 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 28 Jul 2008 11:02:43 +0100 (BST)
Subject: [Rd] cairo device and pch="+"
In-Reply-To: <27d1e6020807280050p2d9daf38tc9f1b5a5ab1314f0@mail.gmail.com>
References: <27d1e6020807280050p2d9daf38tc9f1b5a5ab1314f0@mail.gmail.com>
Message-ID: <alpine.LFD.1.10.0807281100200.14149@auk.stats.ox.ac.uk>

We do document (in 'Writing R Extensions') how to find such leaks using 
valgrind, so in would have been very much more helpful to have done so. 
(Note that we know cairo 1.6.4 leaks small amounts of memory, more in 
older versions.)

The problem was in ucstoutf8 and is now fixed.

On Mon, 28 Jul 2008, Laurent Gautier wrote:

> Dear list,
>
> I have spotted what could be a memory leak somewhere.
>
> The example below shows how to quickly use up RAM on a linux machine
> (the example is taylored for a 2Gb machine, change the size of the matrix m
> is needed).
>
> # ---
> m <- matrix(rnorm(130), nrow=6000, 6)
> X11(type="cairo")
> pairs(m)
>
> # --- here the trouble starts (monitor the memory usage as the plot goes).
> pairs(m, pch="+")
>
> # this does not seem to act on memory usage of the R process
> dev.off()
> gc()
>
> # the only way to get back some memory is to kill the R process.
>
>
>
>
> L.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From felix at nfrac.org  Mon Jul 28 15:15:19 2008
From: felix at nfrac.org (Felix Andrews)
Date: Mon, 28 Jul 2008 23:15:19 +1000
Subject: [Rd] equivalent to "require" for imports? (cairoDevice)
Message-ID: <94730b8a0807280615v664236afm65505355a1a35da9@mail.gmail.com>

Hi R-devel

I use the packages RGtk2 and cairoDevice. The cairoDevice package has
a few stand-alone functions, plus "asCairoDevice" which depends on
RGtk2 and calls require(RGtk2). So cairoDevice lists RGtk2 under
"Suggests" in the DESCRIPTION file. It can not Import RGtk2 because
that would force all users to install RGtk2.

The upshot of this is, if you *import* the RGtk2 namespace into
another package and then call asCairoDevice(), RGtk2 is attached to
the user's search path. That is significant because RGtk2 exports a
large number of objects: -- 7476 to be exact -- which can clog up
things like help.search and autocompletion.

What is the recommended solution? Could asCairoDevice call
loadNamespace rather than require?

-- 
Felix Andrews / ???
PhD candidate
Integrated Catchment Assessment and Management Centre
The Fenner School of Environment and Society
The Australian National University (Building 48A), ACT 0200
Beijing Bag, Locked Bag 40, Kingston ACT 2604
http://www.neurofractal.org/felix/
3358 543D AAC6 22C2 D336 80D9 360B 72DD 3E4C F5D8


From ripley at stats.ox.ac.uk  Mon Jul 28 15:33:34 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 28 Jul 2008 14:33:34 +0100 (BST)
Subject: [Rd] equivalent to "require" for imports? (cairoDevice)
In-Reply-To: <94730b8a0807280615v664236afm65505355a1a35da9@mail.gmail.com>
References: <94730b8a0807280615v664236afm65505355a1a35da9@mail.gmail.com>
Message-ID: <alpine.LFD.1.10.0807281428340.5781@gannet.stats.ox.ac.uk>

On Mon, 28 Jul 2008, Felix Andrews wrote:

> Hi R-devel
>
> I use the packages RGtk2 and cairoDevice. The cairoDevice package has
> a few stand-alone functions, plus "asCairoDevice" which depends on
> RGtk2 and calls require(RGtk2). So cairoDevice lists RGtk2 under
> "Suggests" in the DESCRIPTION file. It can not Import RGtk2 because
> that would force all users to install RGtk2.
>
> The upshot of this is, if you *import* the RGtk2 namespace into
> another package and then call asCairoDevice(), RGtk2 is attached to
> the user's search path. That is significant because RGtk2 exports a
> large number of objects: -- 7476 to be exact -- which can clog up
> things like help.search and autocompletion.
>
> What is the recommended solution? Could asCairoDevice call
> loadNamespace rather than require?

The code is

> asCairoDevice
function (widget, pointsize = 10)
{
     if (!require("RGtk2"))
         stop("asGtkDevice requires the RGtk package")
     if (!inherits(widget, "GtkDrawingArea") && !inherits(widget,
         "GdkDrawable")) {
         stop("Object being used as a Cairo Device must be a GtkDrawingArea 
or GdkDrawable")
     }
     .Call("do_asCairoDevice", widget, as.numeric(pointsize),
         PACKAGE = "cairoDevice")
}

Note that the stop() message is wrong (wrong function name, wrong package) 
and seems most likely an error.  But why not ask the package author?

The normal solution is to use :: to load functions from a name space 
required only in rarely used functions in your package.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From mflawren at fhcrc.org  Mon Jul 28 16:30:06 2008
From: mflawren at fhcrc.org (Michael Lawrence)
Date: Mon, 28 Jul 2008 07:30:06 -0700
Subject: [Rd] equivalent to "require" for imports? (cairoDevice)
In-Reply-To: <alpine.LFD.1.10.0807281428340.5781@gannet.stats.ox.ac.uk>
References: <94730b8a0807280615v664236afm65505355a1a35da9@mail.gmail.com>
	<alpine.LFD.1.10.0807281428340.5781@gannet.stats.ox.ac.uk>
Message-ID: <509e0620807280730o3fbd85e1g140f89b944c03fae@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20080728/f2c0605e/attachment.pl>

From jmc at r-project.org  Mon Jul 28 22:13:07 2008
From: jmc at r-project.org (John Chambers)
Date: Mon, 28 Jul 2008 16:13:07 -0400
Subject: [Rd] S4 classes that extend S3 classes
Message-ID: <488E2853.6090105@r-project.org>

Up to now,  writing an S4 class that extends an S3 class (using 
contains= in the call to setClass) has been discouraged for two main 
reasons:

1.  You can't say anything formal about S3 classes, so validating 
objects, having formal slots for their properties, etc. are not 
generally feasible.

2.  In any case, the S3 class, which may have multiple strings in the 
class attribute, was not available in objects from the S4 class; so, 
among other problems, S3 method dispatch would not work for such a class.

The first problem is fairly intrinsic and remains a reason to hesitate.  
But a recent change to the 2.8.0 development version takes some steps to 
reduce the second problem.

The mechanism is to include the S3 class of objects as a special slot in 
any class that extends "oldClass"; therefore, any S3 class registered by 
calling setOldClass(), and any S4 class that extends such a class, will 
have the underlying S3 class available.  S3 method dispatch and the 
inherits() function make use of this information in the latest version 
(revision r46128 of July 27, with a bug fix r46136 July 28).

So if you can live with the limitations of the first point and would 
like to experiment with extending an S3 class, you're invited to try.  
Note that the S3 classes _must_ be registered via setOldClass() for 
extensions to work.

See ?Classes, ?setOldClass and ?S3Class for details.

John


From p.murrell at auckland.ac.nz  Mon Jul 28 22:56:30 2008
From: p.murrell at auckland.ac.nz (Paul Murrell)
Date: Tue, 29 Jul 2008 08:56:30 +1200
Subject: [Rd] grid.ls() after grid.remove() fails
In-Reply-To: <94730b8a0807280044g2fc2a3e2ue18ada3fbc14259b@mail.gmail.com>
References: <94730b8a0807280044g2fc2a3e2ue18ada3fbc14259b@mail.gmail.com>
Message-ID: <488E327E.40404@stat.auckland.ac.nz>

Hi



Felix Andrews wrote:
> Dr Murrell and others,
> 
> It seems grid.ls() fails after any use of grid.remove(). It gives an
> infinite recursion error even in the simplest cases, and no matter
> what arguments are passed to grid.ls.


Yep, blatant error in the code.  I will have a fix in the development
version soon.  Thanks for the report!

Paul


>> library(grid)
>> grid.newpage()
>> grid.lines(name="foo")
>> grid.ls()
> foo
>> grid.remove("foo")
>> grid.ls()
> Error: evaluation nested too deeply: infinite recursion / options(expressions=)?
>> grid.ls(recursive=FALSE)
> Error: evaluation nested too deeply: infinite recursion / options(expressions=)?
>> str(grid.ls(print=FALSE))
> Error: evaluation nested too deeply: infinite recursion / options(expressions=)?
>> traceback()
> ...etc...
> ...etc...
> ...etc...
> 13: gridList.default(X[[2L]], ...)
> 12: FUN(X[[2L]], ...)
> 11: lapply(display.list[1:dl.index], gridList, grobs = grobs,
> viewports = viewports,
>         fullNames = fullNames, recursive = recursive)
> 10: gridList.default(X[[2L]], ...)
> 9: FUN(X[[2L]], ...)
> 8: lapply(display.list[1:dl.index], gridList, grobs = grobs, viewports
> = viewports,
>        fullNames = fullNames, recursive = recursive)
> 7: gridList.default(X[[2L]], ...)
> 6: FUN(X[[2L]], ...)
> 5: lapply(display.list[1:dl.index], gridList, grobs = grobs, viewports
> = viewports,
>        fullNames = fullNames, recursive = recursive)
> 4: gridList.default(x, grobs = grobs, viewports = viewports, fullNames
> = fullNames,
>        recursive = recursive)
> 3: gridList(x, grobs = grobs, viewports = viewports, fullNames = fullNames,
>        recursive = recursive)
> 2: grid.ls(print = FALSE)
> 1: str(grid.ls(print = FALSE))
> 
> 
>> str(current.vpTree())
> List of 17
>  $ x             :Class 'unit'  atomic [1:1] 0.5
>   .. ..- attr(*, "unit")= chr "npc"
>   .. ..- attr(*, "valid.unit")= int 0
>  $ y             :Class 'unit'  atomic [1:1] 0.5
>   .. ..- attr(*, "unit")= chr "npc"
>   .. ..- attr(*, "valid.unit")= int 0
>  $ width         :Class 'unit'  atomic [1:1] 1
>   .. ..- attr(*, "unit")= chr "npc"
>   .. ..- attr(*, "valid.unit")= int 0
>  $ height        :Class 'unit'  atomic [1:1] 1
>   .. ..- attr(*, "unit")= chr "npc"
>   .. ..- attr(*, "valid.unit")= int 0
>  $ justification : chr "centre"
>  $ gp            : list()
>   ..- attr(*, "class")= chr "gpar"
>  $ clip          : logi TRUE
>  $ xscale        : num [1:2] 0 558
>  $ yscale        : num [1:2] 557 0
>  $ angle         : num 0
>  $ layout        : NULL
>  $ layout.pos.row: NULL
>  $ layout.pos.col: NULL
>  $ valid.just    : num [1:2] 0.5 0.5
>  $ valid.pos.row : NULL
>  $ valid.pos.col : NULL
>  $ name          : chr "ROOT"
>  - attr(*, "class")= chr "viewport"
> 
> 
>> sessionInfo()
> R version 2.8.0 Under development (unstable) (2008-07-26 r46127)
> i386-pc-mingw32
> 
> locale:
> LC_COLLATE=English_Australia.1252;LC_CTYPE=English_Australia.1252;LC_MONETARY=English_Australia.1252;LC_NUMERIC=C;LC_TIME=English_Australia.1252
> 
> attached base packages:
> [1] grid      stats     graphics  grDevices utils     datasets  methods
> [8] base
> 
> 

-- 
Dr Paul Murrell
Department of Statistics
The University of Auckland
Private Bag 92019
Auckland
New Zealand
64 9 3737599 x85392
paul at stat.auckland.ac.nz
http://www.stat.auckland.ac.nz/~paul/


From gumpleon at gmail.com  Tue Jul 29 08:27:04 2008
From: gumpleon at gmail.com (Gang Liang)
Date: Mon, 28 Jul 2008 23:27:04 -0700
Subject: [Rd] a package installation problem on windows
Message-ID: <bc33365a0807282327m28b914fj8a4041c45163de95@mail.gmail.com>

Dear all,

I encountered a problem when test installing a package of my own under
the windows platform. The latest Rtools is installed, and Makefile.win
is used for directing the compilation of C++ codes under the src
directory. A sketch of the Makefile.win is as follows:

--- Makefile.win (old) ---------
all: part1.dll part2.dll

%.dll: %.cpp
	R CMD SHLIB $<
---------------------------------------

When I run "R CMD build --binary pakname", the Makefile.win is
executed without error, but to my surprise, the wanted dll files are
not produced as expected; thus, the binary package will be created
without dlls. While if I run make in the src directory manually, all
dll files will be created. This problem can be by-passed using my
updated Makefile.win,

--- Makefile.win (new) ---------
all: part1.dll part2.dll copy

%.dll: %.cpp
	R CMD SHLIB $<

copy: part1.dll part2.dll
	mkdir -p ../inst/libs
	cp *.dll ../inst/libs
---------------------------------------

It is ugly because I have to access the libs directory directly. My
question is what is the right syntax to compile codes using Makefile
then? Thanks very much!

Gang Liang

PS: Re the missing dll problem, my guess is that the command "R CMD
SHLIB ..." is doing the compilation on a memory disk, and the final
result is discarded right away. I even interrupted the compilation
midway, and am still not able to find any intermediate files on my
harddrive. On the other hand, the compilation is clearly done.


From ripley at stats.ox.ac.uk  Tue Jul 29 08:46:13 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 29 Jul 2008 07:46:13 +0100 (BST)
Subject: [Rd] a package installation problem on windows
In-Reply-To: <bc33365a0807282327m28b914fj8a4041c45163de95@mail.gmail.com>
References: <bc33365a0807282327m28b914fj8a4041c45163de95@mail.gmail.com>
Message-ID: <alpine.LFD.1.10.0807290742060.7429@gannet.stats.ox.ac.uk>

Nothing in the documentation says that DLLs created in the source 
directory will be installed -- this applies only to pkgname.dll.

We recommend you use R CMD INSTALL [--build], not R CMD build --binary.

It is very rare to need a src/Makefile.win, but it you choose to use one 
yo do need to ensure that you do understand the package installation 
mechanism.  Being surprised that undocumented things do not work is a sure 
sign that you have not studied the mechanism and documentation.

On Mon, 28 Jul 2008, Gang Liang wrote:

> Dear all,
>
> I encountered a problem when test installing a package of my own under
> the windows platform. The latest Rtools is installed, and Makefile.win
> is used for directing the compilation of C++ codes under the src
> directory. A sketch of the Makefile.win is as follows:
>
> --- Makefile.win (old) ---------
> all: part1.dll part2.dll
>
> %.dll: %.cpp
> 	R CMD SHLIB $<
> ---------------------------------------
>
> When I run "R CMD build --binary pakname", the Makefile.win is
> executed without error, but to my surprise, the wanted dll files are
> not produced as expected; thus, the binary package will be created
> without dlls. While if I run make in the src directory manually, all
> dll files will be created. This problem can be by-passed using my
> updated Makefile.win,
>
> --- Makefile.win (new) ---------
> all: part1.dll part2.dll copy
>
> %.dll: %.cpp
> 	R CMD SHLIB $<
>
> copy: part1.dll part2.dll
> 	mkdir -p ../inst/libs
> 	cp *.dll ../inst/libs
> ---------------------------------------
>
> It is ugly because I have to access the libs directory directly. My
> question is what is the right syntax to compile codes using Makefile
> then? Thanks very much!
>
> Gang Liang
>
> PS: Re the missing dll problem, my guess is that the command "R CMD
> SHLIB ..." is doing the compilation on a memory disk, and the final
> result is discarded right away. I even interrupted the compilation
> midway, and am still not able to find any intermediate files on my
> harddrive. On the other hand, the compilation is clearly done.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Tue Jul 29 15:06:45 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 29 Jul 2008 14:06:45 +0100 (BST)
Subject: [Rd] memory leak in sub("[range]",...)
In-Reply-To: <18556.23450.521709.623929@stat.math.ethz.ch>
References: <Pine.GSO.4.56.0807091117580.15787@devsun3201.insightful.com>
	<18556.23450.521709.623929@stat.math.ethz.ch>
Message-ID: <alpine.LFD.1.10.0807291401080.27222@gannet.stats.ox.ac.uk>

As a belated follow-up (I was away at the time), note that in general we 
don't tamper with code we have ported from other projects as it makes 
future maintenance so much more difficult.  At the very least, we need 
conspicuous comments to ensure that such changes do not get lost (I've 
just added one).

On Tue, 15 Jul 2008, Martin Maechler wrote:

>>>>>> "BD" == Bill Dunlap <bill at insightful.com>
>>>>>>     on Wed, 9 Jul 2008 11:26:50 -0700 (PDT) writes:
>
>    BD> There is a 2-block memory leak in the sub() (or any other regex-related
>    BD> function, probably) when the pattern argument involves a range
>    BD> expression, e.g., '[0-9]'.
>
>    BD> % R --debugger=valgrind --debugger-args=--leak-check=full --vanilla
>    BD> ==14519== Memcheck, a memory error detector.
>    BD> ==14519== Copyright (C) 2002-2006, and GNU GPL'd, by Julian Seward et al.
>    BD> ==14519== Using LibVEX rev 1658, a library for dynamic binary translation.
>    BD> ==14519== Copyright (C) 2004-2006, and GNU GPL'd, by OpenWorks LLP.
>    BD> ==14519== Using valgrind-3.2.1, a dynamic binary instrumentation framework.
>    BD> ==14519== Copyright (C) 2000-2006, and GNU GPL'd, by Julian Seward et al.
>    BD> ==14519== For more details, rerun with: -v
>    BD> ==14519==
>
>    BD> R version 2.8.0 Under development (unstable) (2008-07-07 r46046)
>    BD> ...
>    >> for(i in 1:1000)sub("[a-c]","+","0abcd")
>    >> q()
>    BD> ==32503==
>    BD> ==32503== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 40 from 2)
>    BD> ==32503== malloc/free: in use at exit: 12,603,409 bytes in 7,915 blocks.
>    BD> ==32503== malloc/free: 61,973 allocs, 54,058 frees, 54,494,371 bytes
>    BD> allocated.
>    BD> ==32503== For counts of detected errors, rerun with: -v
>    BD> ==32503== searching for pointers to 7,915 not-freed blocks.
>    BD> ==32503== checked 12,616,568 bytes.
>    BD> ==32503==
>    BD> ==32503== 4 bytes in 1 blocks are possibly lost in loss record 1 of 45
>    BD> ==32503==    at 0x40046EE: malloc (vg_replace_malloc.c:149)
>    BD> ==32503==    by 0x4005B9A: realloc (vg_replace_malloc.c:306)
>    BD> ==32503==    by 0x80A5F92: parse_expression (regex.c:5202)
>    BD> ==32503==    by 0x80A614F: parse_branch (regex.c:4707)
>    BD> ==32503==    by 0x80A621A: parse_reg_exp (regex.c:4666)
>    BD> ==32503==    by 0x80A6618: Rf_regcomp (regex.c:4635)
>    BD> ==32503==    by 0x8110CB4: do_gsub (character.c:1355)
>    BD> ==32503==    by 0x80654A4: do_internal (names.c:1135)
>    BD> ==32503==    by 0x815F0EB: Rf_eval (eval.c:461)
>    BD> ==32503==    by 0x8160DA7: do_begin (eval.c:1174)
>    BD> ==32503==    by 0x815F0EB: Rf_eval (eval.c:461)
>    BD> ==32503==    by 0x8162210: Rf_applyClosure (eval.c:667)
>    BD> ==32503==
>    BD> ... ignore 85 byte/4 block leak in readline ...
>    BD> ==32503== 7,980 bytes in 1,995 blocks are definitely lost in loss record 36 of
>    BD> 45
>    BD> ==32503==    at 0x40046EE: malloc (vg_replace_malloc.c:149)
>    BD> ==32503==    by 0x4005B9A: realloc (vg_replace_malloc.c:306)
>    BD> ==32503==    by 0x80A5F92: parse_expression (regex.c:5202)
>    BD> ==32503==    by 0x80A614F: parse_branch (regex.c:4707)
>    BD> ==32503==    by 0x80A621A: parse_reg_exp (regex.c:4666)
>    BD> ==32503==    by 0x80A6618: Rf_regcomp (regex.c:4635)
>    BD> ==32503==    by 0x8110CB4: do_gsub (character.c:1355)
>    BD> ==32503==    by 0x80654A4: do_internal (names.c:1135)
>    BD> ==32503==    by 0x815F0EB: Rf_eval (eval.c:461)
>    BD> ==32503==    by 0x8160DA7: do_begin (eval.c:1174)
>    BD> ==32503==    by 0x815F0EB: Rf_eval (eval.c:461)
>    BD> ==32503==    by 0x8162210: Rf_applyClosure (eval.c:667)
>
>    BD> The leaked blocks are allocated in iinternal_function build_range_exp() at
>    BD> 5200             /* Use realloc since mbcset->range_starts and mbcset-> range_ends
>    BD> 5201                are NULL if *range_alloc == 0.  */
>    BD> 5202             new_array_start = re_realloc (mbcset->range_starts,
>    BD> wchar_t,
>    BD> 5203                                           new_nranges);
>    BD> 5204             new_array_end = re_realloc (mbcset->range_ends, wchar_t,
>    BD> 5205                                         new_nranges);
>    BD> ...
>    BD> 5210             mbcset->range_starts = new_array_start;
>    BD> 5211             mbcset->range_ends = new_array_end;
>
>    BD> This file, src/main/regex.c, contains a complicated mess of #ifdef's
>
> ((note that these were not
>
>    BD> but range_starts and range_ends are defined and appear to be used
>    BD> whether or not _LIBC is defined.  However, they are only freed if _LIBC
>    BD> is defined.  In my setup (Linux, gcc 3.4.5) _LIBC is not defined so
>    BD> they don't get freed.
>
> Ok; this all makes sense; I've seen the same in the source
>
> Interestingly, my newer setup (Linux, gcc 4.2.x ...) does not show the
> memory leak; I've not checked if it's because _LIBC is defined
> or for another reason.
>
> I'm applying your patch ---  thank you, Bill.
> Martin
>
>    BD> After the following change in free_charset() only the 85 byte/4 block
>    BD> leak in readline remains.
>
>    BD> Index: regex.c
>    BD> ===================================================================
>    BD> --- regex.c     (revision 46046)
>    BD> +++ regex.c     (working copy)
>    BD> @@ -6240,9 +6240,9 @@
>    BD> # ifdef _LIBC
>    BD> re_free (cset->coll_syms);
>    BD> re_free (cset->equiv_classes);
>    BD> +# endif
>    BD> re_free (cset->range_starts);
>    BD> re_free (cset->range_ends);
>    BD> -# endif
>    BD> re_free (cset->char_classes);
>    BD> re_free (cset);
>    BD> }
>
>    BD> [This report may be a duplicate: I tried submitting it via the form in
>    BD> http://bugs.r-project.org/cgi-bin/R, but I cannot find it there now.]
>
> neither do I.
> The machine running the repository had a (announce by Peter
> Dalgaard) downtime a couple of days ago, so this may be related.
>
>
>    BD> ----------------------------------------------------------------------------
>    BD> Bill Dunlap
>    BD> Insightful Corporation
>    BD> bill at insightful dot com
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From chalabi at phys.ethz.ch  Tue Jul 29 15:31:17 2008
From: chalabi at phys.ethz.ch (Yohan Chalabi)
Date: Tue, 29 Jul 2008 15:31:17 +0200
Subject: [Rd] 'R CMD check' and S4 methods
Message-ID: <20080729153117.48900157@mimi>

Dear all,

I was looking for a function to analyze the code of a package and I
went throught the function 'checkUsagePackage' of package:codetools
which is used in 'R CMD check' script.

As far as I understand it, 'checkUsagePackage' does not check the code
usage of  S4 methods because it loads all function names from a given
environment where only the name of the generic function is given for S4
methods.

for example

library(codetools)
setClass("foo", representation(x= "character"))
foo <- new("foo", x = "dummy")
setMethod("show", "foo", function(object) noVisibleGlobalFunction())
print.foo <- function(x, ...) noVisibleGlobalFunction()
## checkUsageEnv detects the problem in print.foo but not with the
## defined method
checkUsageEnv(.GlobalEnv)
## or
checkUsage(show)


One can repeat this exmaple with 'checkUsagePackage'.

Is it right that code usage of S4 methods is not checked with
'R CMD check'?

thanks in advance for your response,
Yohan


From ripley at stats.ox.ac.uk  Tue Jul 29 17:14:17 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 29 Jul 2008 16:14:17 +0100 (BST)
Subject: [Rd] axis() ignores supplied value of argument mgp[3]?
In-Reply-To: <g5tihu$k8u$1@ger.gmane.org>
References: <g5tihu$k8u$1@ger.gmane.org>
Message-ID: <alpine.LFD.1.10.0807291612130.30827@gannet.stats.ox.ac.uk>

What is true is that the line is set before the inline setting of mgp is 
processed: it all depends on what 'supplied' means, and you supplied two 
values.

This is changed in R-patched now.

On Sat, 19 Jul 2008, J. R. M. Hosking wrote:

> It seems that when an argument 'mgp' is supplied to axis(),
> the mgp[2] value (position of tick mark labels) is honoured
> but the mgp[3] value (position of axis line) is ignored.
> Example:
>
>  plot(1:5, xaxt='n', ann=FALSE)
>  par(mgp=c(0,2,1))
>  axis(1, at=2:4, mgp=c(0,-2,-3))
>
> Axis line is plotted at margin line 1, tick mark labels at line -3.
>
> Is this a bug?
>
>
> J. R. M. Hosking
>
>
>
>> R.version
>               _
> platform       i386-pc-mingw32
> arch           i386
> os             mingw32
> system         i386, mingw32
> status
> major          2
> minor          7.1
> year           2008
> month          06
> day            23
> svn rev        45970
> language       R
> version.string R version 2.7.1 (2008-06-23)
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From bolker at zoology.ufl.edu  Tue Jul 29 18:44:20 2008
From: bolker at zoology.ufl.edu (Ben Bolker)
Date: Tue, 29 Jul 2008 12:44:20 -0400
Subject: [Rd] closing View windows after multiple View(x) crashes
Message-ID: <488F48E4.1020203@zoology.ufl.edu>

 > sessionInfo()
R version 2.8.0 Under development (unstable) (2008-07-07 r46046)
i686-pc-linux-gnu

locale:
LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=en_US.UTF-8;LC_COLLATE=en_US.UTF-8;LC_MONETARY=C;LC_MESSAGES=en_US.UTF-8;LC_PAPER=en_US.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US.UTF-8;LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base


x = cbind(a=1:10,b=1:10)

View(x)
View(x)
View(x)
View(x)

   then try to close the latest window by clicking on the "x" 
(close-window) icon in the corner.
   I can usually provoke a segmentation fault this way ...
   Ubuntu Hardy, up to date.

   [on a related topic, can anyone tell me why View() usually
doesn't work when I try it on someone else's Mac?  I don't
use Macs myself so haven't tried to figure this one out -- I
know, I could write to R-SIG-MAC about it ...]

   Ben Bolker

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 252 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20080729/883ecda7/attachment.bin>

From logickledoug at yahoo.com  Tue Jul 29 16:47:32 2008
From: logickledoug at yahoo.com (Logickle)
Date: Tue, 29 Jul 2008 07:47:32 -0700 (PDT)
Subject: [Rd]  R crashes on new laptop
Message-ID: <18713928.post@talk.nabble.com>


The problem is that R crashes with an exception "R for Windows GUI front-end
has encountered a problem and needs to close..."  It doesn't always crash,
but almost always does.

Thanks for any help (fixes, workarounds, or diagnostics) you can provide!

Doug

Specs:
PC: HP 2710p
Graphics HW: Mobile Intel 965 Express Chipset Family / Graphics Media
Accelerator X3100
Graphics Driver: 6.14.10.4964 / 6/27/2008 / Intel Corporation
R version: 2.7.1
OS: WinXP Tablet PC 2005

The R script which produces it is very simple (requires package rgl):

  open3d()
  x <- sort(rnorm(1000))
  y <- rnorm(1000)
  z <- rnorm(1000) + atan2(x,y)
  plot3d(x, y, z, col=rainbow(1000), size=2)

Error details dialog:

http://www.nabble.com/file/p18713928/Error.jpg 

The module ig4icd32.dll is part of the graphics driver.

Unfortunately, the hex dump data can't be copied/pasted from the error
details dialog, nor can I get the .dmp file ("file is in use"). 

Some error information is saved in an xml file:

<?xml version="1.0" encoding="UTF-16"?>
<DATABASE>
<EXE NAME="Rgui.exe" FILTER="GRABMI_FILTER_PRIVACY">
    <MATCHING_FILE NAME="iconv.dll" SIZE="918528" CHECKSUM="0x2B0ADD5D"
MODULE_TYPE="WIN32" PE_CHECKSUM="0xE13B8" LINKER_VERSION="0x10000"
LINK_DATE="02/29/2008 09:10:55" UPTO_LINK_DATE="02/29/2008 09:10:55" />
    <MATCHING_FILE NAME="md5check.exe" SIZE="32768" CHECKSUM="0x1F99EDB5"
BIN_FILE_VERSION="2.71.45970.0" BIN_PRODUCT_VERSION="3.0.0.0"
FILE_DESCRIPTION="R for Windows files checker" FILE_VERSION="2.7.1   
(2008-06-23)" LEGAL_COPYRIGHT="R Development Core Team 1995-2008"
VERFILEDATEHI="0x0" VERFILEDATELO="0x0" VERFILEOS="0x4" VERFILETYPE="0x1"
MODULE_TYPE="WIN32" PE_CHECKSUM="0xC07D" LINKER_VERSION="0x10000"
UPTO_BIN_FILE_VERSION="2.71.45970.0" UPTO_BIN_PRODUCT_VERSION="3.0.0.0"
LINK_DATE="06/23/2008 12:07:36" UPTO_LINK_DATE="06/23/2008 12:07:36"
VER_LANGUAGE="English (United States) [0x409]" />
    <MATCHING_FILE NAME="R.dll" SIZE="2822656" CHECKSUM="0x679DF762"
BIN_FILE_VERSION="2.71.45970.0" BIN_PRODUCT_VERSION="3.0.0.0"
FILE_DESCRIPTION="R for Windows DLL" FILE_VERSION="2.7.1    (2008-06-23)"
LEGAL_COPYRIGHT="R Development Core Team 1995-2008" VERFILEDATEHI="0x0"
VERFILEDATELO="0x0" VERFILEOS="0x4" VERFILETYPE="0x2" MODULE_TYPE="WIN32"
PE_CHECKSUM="0x2B1E89" LINKER_VERSION="0x10000"
UPTO_BIN_FILE_VERSION="2.71.45970.0" UPTO_BIN_PRODUCT_VERSION="3.0.0.0"
LINK_DATE="06/23/2008 12:07:16" UPTO_LINK_DATE="06/23/2008 12:07:16"
VER_LANGUAGE="English (United States) [0x409]" />
    <MATCHING_FILE NAME="R.exe" SIZE="36352" CHECKSUM="0xDE9601D1"
BIN_FILE_VERSION="2.71.45970.0" BIN_PRODUCT_VERSION="3.0.0.0"
FILE_DESCRIPTION="R for Windows front-end" FILE_VERSION="2.7.1   
(2008-06-23)" LEGAL_COPYRIGHT="R Development Core Team 1995-2008"
VERFILEDATEHI="0x0" VERFILEDATELO="0x0" VERFILEOS="0x4" VERFILETYPE="0x1"
MODULE_TYPE="WIN32" PE_CHECKSUM="0x14952" LINKER_VERSION="0x10000"
UPTO_BIN_FILE_VERSION="2.71.45970.0" UPTO_BIN_PRODUCT_VERSION="3.0.0.0"
LINK_DATE="06/23/2008 12:07:36" UPTO_LINK_DATE="06/23/2008 12:07:36"
VER_LANGUAGE="English (United States) [0x409]" />
    <MATCHING_FILE NAME="Rblas.dll" SIZE="169718" CHECKSUM="0xF612961D"
BIN_FILE_VERSION="2.71.45970.0" BIN_PRODUCT_VERSION="3.0.0.0"
FILE_DESCRIPTION="R for Windows DLL" FILE_VERSION="2.7.1    (2008-06-23)"
LEGAL_COPYRIGHT="R Development Core Team 1995-2008" VERFILEDATEHI="0x0"
VERFILEDATELO="0x0" VERFILEOS="0x4" VERFILETYPE="0x2" MODULE_TYPE="WIN32"
PE_CHECKSUM="0x33F83" LINKER_VERSION="0x10000"
UPTO_BIN_FILE_VERSION="2.71.45970.0" UPTO_BIN_PRODUCT_VERSION="3.0.0.0"
LINK_DATE="06/23/2008 12:07:27" UPTO_LINK_DATE="06/23/2008 12:07:27"
VER_LANGUAGE="English (United States) [0x409]" />
    <MATCHING_FILE NAME="Rcmd.exe" SIZE="35840" CHECKSUM="0x512F7D5B"
BIN_FILE_VERSION="2.71.45970.0" BIN_PRODUCT_VERSION="3.0.0.0"
FILE_DESCRIPTION="R for Windows front-end" FILE_VERSION="2.7.1   
(2008-06-23)" LEGAL_COPYRIGHT="R Development Core Team 1995-2008"
VERFILEDATEHI="0x0" VERFILEDATELO="0x0" VERFILEOS="0x4" VERFILETYPE="0x1"
MODULE_TYPE="WIN32" PE_CHECKSUM="0x13506" LINKER_VERSION="0x10000"
UPTO_BIN_FILE_VERSION="2.71.45970.0" UPTO_BIN_PRODUCT_VERSION="3.0.0.0"
LINK_DATE="06/23/2008 12:07:31" UPTO_LINK_DATE="06/23/2008 12:07:31"
VER_LANGUAGE="English (United States) [0x409]" />
    <MATCHING_FILE NAME="Rgraphapp.dll" SIZE="265802" CHECKSUM="0x521E1141"
BIN_FILE_VERSION="2.71.45970.0" BIN_PRODUCT_VERSION="3.0.0.0"
FILE_DESCRIPTION="Graphapp DLL for R" FILE_VERSION="2.7.1    (2008-06-23)"
LEGAL_COPYRIGHT="R Development Core Team 1995-2008" VERFILEDATEHI="0x0"
VERFILEDATELO="0x0" VERFILEOS="0x4" VERFILETYPE="0x2" MODULE_TYPE="WIN32"
PE_CHECKSUM="0x42A3B" LINKER_VERSION="0x10000"
UPTO_BIN_FILE_VERSION="2.71.45970.0" UPTO_BIN_PRODUCT_VERSION="3.0.0.0"
LINK_DATE="06/23/2008 12:06:24" UPTO_LINK_DATE="06/23/2008 12:06:24"
VER_LANGUAGE="English (United States) [0x409]" />
    <MATCHING_FILE NAME="Rgui.exe" SIZE="27648" CHECKSUM="0xC8711AEA"
BIN_FILE_VERSION="2.71.45970.0" BIN_PRODUCT_VERSION="3.0.0.0"
FILE_DESCRIPTION="R for Windows GUI front-end" FILE_VERSION="2.7.1   
(2008-06-23)" LEGAL_COPYRIGHT="R Development Core Team 1995-2008"
VERFILEDATEHI="0x0" VERFILEDATELO="0x0" VERFILEOS="0x4" VERFILETYPE="0x1"
MODULE_TYPE="WIN32" PE_CHECKSUM="0xCC15" LINKER_VERSION="0x10000"
UPTO_BIN_FILE_VERSION="2.71.45970.0" UPTO_BIN_PRODUCT_VERSION="3.0.0.0"
LINK_DATE="06/23/2008 12:07:30" UPTO_LINK_DATE="06/23/2008 12:07:30"
VER_LANGUAGE="English (United States) [0x409]" />
    <MATCHING_FILE NAME="Rlapack.dll" SIZE="1340928" CHECKSUM="0xD5D1B000"
BIN_FILE_VERSION="2.71.45970.0" BIN_PRODUCT_VERSION="3.0.0.0"
FILE_DESCRIPTION="R DLL for lapack" FILE_VERSION="2.7.1    (2008-06-23)"
LEGAL_COPYRIGHT="R Development Core Team 2002-2008" VERFILEDATEHI="0x0"
VERFILEDATELO="0x0" VERFILEOS="0x4" VERFILETYPE="0x2" MODULE_TYPE="WIN32"
PE_CHECKSUM="0x1529FD" LINKER_VERSION="0x10000"
UPTO_BIN_FILE_VERSION="2.71.45970.0" UPTO_BIN_PRODUCT_VERSION="3.0.0.0"
LINK_DATE="06/23/2008 12:09:12" UPTO_LINK_DATE="06/23/2008 12:09:12"
VER_LANGUAGE="English (United States) [0x409]" />
    <MATCHING_FILE NAME="Rproxy.dll" SIZE="59904" CHECKSUM="0xFC76A84D"
BIN_FILE_VERSION="2.71.45970.0" BIN_PRODUCT_VERSION="3.0.0.0"
FILE_DESCRIPTION="R for Windows terminal front-end" FILE_VERSION="2.7.1   
(2008-06-23)" LEGAL_COPYRIGHT="R Development Core Team 1995-2008"
VERFILEDATEHI="0x0" VERFILEDATELO="0x0" VERFILEOS="0x4" VERFILETYPE="0x1"
MODULE_TYPE="WIN32" PE_CHECKSUM="0xFE51" LINKER_VERSION="0x10000"
UPTO_BIN_FILE_VERSION="2.71.45970.0" UPTO_BIN_PRODUCT_VERSION="3.0.0.0"
LINK_DATE="06/23/2008 12:07:35" UPTO_LINK_DATE="06/23/2008 12:07:35"
VER_LANGUAGE="English (United States) [0x409]" />
    <MATCHING_FILE NAME="Rscript.exe" SIZE="31232" CHECKSUM="0x1A6E3137"
BIN_FILE_VERSION="2.71.45970.0" BIN_PRODUCT_VERSION="3.0.0.0"
FILE_DESCRIPTION="R for Windows front-end" FILE_VERSION="2.7.1   
(2008-06-23)" LEGAL_COPYRIGHT="R Development Core Team 1995-2008"
VERFILEDATEHI="0x0" VERFILEDATELO="0x0" VERFILEOS="0x4" VERFILETYPE="0x1"
MODULE_TYPE="WIN32" PE_CHECKSUM="0x11D22" LINKER_VERSION="0x10000"
UPTO_BIN_FILE_VERSION="2.71.45970.0" UPTO_BIN_PRODUCT_VERSION="3.0.0.0"
LINK_DATE="06/23/2008 12:07:37" UPTO_LINK_DATE="06/23/2008 12:07:37"
VER_LANGUAGE="English (United States) [0x409]" />
    <MATCHING_FILE NAME="RSetReg.exe" SIZE="28672" CHECKSUM="0x7ED2B4D7"
BIN_FILE_VERSION="2.71.45970.0" BIN_PRODUCT_VERSION="3.0.0.0"
FILE_DESCRIPTION="R for Windows front-end" FILE_VERSION="2.7.1   
(2008-06-23)" LEGAL_COPYRIGHT="R Development Core Team 1995-2008"
VERFILEDATEHI="0x0" VERFILEDATELO="0x0" VERFILEOS="0x4" VERFILETYPE="0x1"
MODULE_TYPE="WIN32" PE_CHECKSUM="0x15E4A" LINKER_VERSION="0x10000"
UPTO_BIN_FILE_VERSION="2.71.45970.0" UPTO_BIN_PRODUCT_VERSION="3.0.0.0"
LINK_DATE="06/23/2008 12:07:31" UPTO_LINK_DATE="06/23/2008 12:07:31"
VER_LANGUAGE="English (United States) [0x409]" />
    <MATCHING_FILE NAME="Rterm.exe" SIZE="28672" CHECKSUM="0x4B486A15"
BIN_FILE_VERSION="2.71.45970.0" BIN_PRODUCT_VERSION="3.0.0.0"
FILE_DESCRIPTION="R for Windows terminal front-end" FILE_VERSION="2.7.1   
(2008-06-23)" LEGAL_COPYRIGHT="R Development Core Team 1995-2008"
VERFILEDATEHI="0x0" VERFILEDATELO="0x0" VERFILEOS="0x4" VERFILETYPE="0x1"
MODULE_TYPE="WIN32" PE_CHECKSUM="0x13CB5" LINKER_VERSION="0x10000"
UPTO_BIN_FILE_VERSION="2.71.45970.0" UPTO_BIN_PRODUCT_VERSION="3.0.0.0"
LINK_DATE="06/23/2008 12:07:30" UPTO_LINK_DATE="06/23/2008 12:07:30"
VER_LANGUAGE="English (United States) [0x409]" />
    <MATCHING_FILE NAME="Rzlib.dll" SIZE="92826" CHECKSUM="0x6F321612"
MODULE_TYPE="WIN32" PE_CHECKSUM="0x1CAF9" LINKER_VERSION="0x10000"
LINK_DATE="06/23/2008 12:06:51" UPTO_LINK_DATE="06/23/2008 12:06:51" />
</EXE>
<EXE NAME="ig4icd32.dll" FILTER="GRABMI_FILTER_THISFILEONLY">
    <MATCHING_FILE NAME="ig4icd32.dll" SIZE="2412544" CHECKSUM="0x50BD93D8"
BIN_FILE_VERSION="6.14.10.4964" BIN_PRODUCT_VERSION="6.14.10.4964"
PRODUCT_VERSION="6.14.10.4964" FILE_DESCRIPTION="OpenGL(R) Driver for
Intel(R) Graphics Accelerator" COMPANY_NAME="Intel Corporation"
PRODUCT_NAME="Intel Graphics Accelerator Drivers for Windows NT(R)"
FILE_VERSION="6.14.10.4964" ORIGINAL_FILENAME="iglicd32"
INTERNAL_NAME="OpenGL" LEGAL_COPYRIGHT="Copyright (c) 1998-2006 Intel
Corporation." VERFILEDATEHI="0x0" VERFILEDATELO="0x0" VERFILEOS="0x10004"
VERFILETYPE="0x2" MODULE_TYPE="WIN32" PE_CHECKSUM="0x0"
LINKER_VERSION="0x10064" UPTO_BIN_FILE_VERSION="6.14.10.4964"
UPTO_BIN_PRODUCT_VERSION="6.14.10.4964" LINK_DATE="06/27/2008 15:19:30"
UPTO_LINK_DATE="06/27/2008 15:19:30" VER_LANGUAGE="English (United States)
[0x409]" />
</EXE>
<EXE NAME="kernel32.dll" FILTER="GRABMI_FILTER_THISFILEONLY">
    <MATCHING_FILE NAME="kernel32.dll" SIZE="984576" CHECKSUM="0xF0B331F6"
BIN_FILE_VERSION="5.1.2600.3119" BIN_PRODUCT_VERSION="5.1.2600.3119"
PRODUCT_VERSION="5.1.2600.3119" FILE_DESCRIPTION="Windows NT BASE API Client
DLL" COMPANY_NAME="Microsoft Corporation" PRODUCT_NAME="Microsoft? Windows?
Operating System" FILE_VERSION="5.1.2600.3119 (xpsp_sp2_gdr.070416-1301)"
ORIGINAL_FILENAME="kernel32" INTERNAL_NAME="kernel32" LEGAL_COPYRIGHT="?
Microsoft Corporation. All rights reserved." VERFILEDATEHI="0x0"
VERFILEDATELO="0x0" VERFILEOS="0x40004" VERFILETYPE="0x2"
MODULE_TYPE="WIN32" PE_CHECKSUM="0xF9293" LINKER_VERSION="0x50001"
UPTO_BIN_FILE_VERSION="5.1.2600.3119"
UPTO_BIN_PRODUCT_VERSION="5.1.2600.3119" LINK_DATE="04/16/2007 15:52:53"
UPTO_LINK_DATE="04/16/2007 15:52:53" VER_LANGUAGE="English (United States)
[0x409]" />
</EXE>
</DATABASE>

-- 
View this message in context: http://www.nabble.com/R-crashes-on-new-laptop-tp18713928p18713928.html
Sent from the R devel mailing list archive at Nabble.com.


From logickledoug at yahoo.com  Tue Jul 29 18:39:27 2008
From: logickledoug at yahoo.com (Logickle)
Date: Tue, 29 Jul 2008 09:39:27 -0700 (PDT)
Subject: [Rd] R crashes on new laptop
In-Reply-To: <18713928.post@talk.nabble.com>
References: <18713928.post@talk.nabble.com>
Message-ID: <18716390.post@talk.nabble.com>


Found a fix (hack actually, but hey), so I thought I'd pass it on. 

I was desperately googling for a solution to this, and on a game website
found a report from someone experiencing OpenGL problems on a machine with
the Intel 965 chipset. They figured out (God only knows how) that by
downloading from the Intel website the zip file of the 965 Vista drivers
(this is on XP), extracting the file ig4dev32.dll, and dropping it into the
directory of the app that was crashing, the problem went away.

So I downloaded the same DLL, dropped it into R/bin, and voila, no more
crash! 

Here's the link to the Intel Vista drivers:
http://downloadmirror.intel.com/15884/a08/winvista_159.zip

Enjoy!

Doug


Logickle wrote:
> 
> The problem is that R crashes with an exception "R for Windows GUI
> front-end has encountered a problem and needs to close..."  It doesn't
> always crash, but almost always does.
> 
> Thanks for any help (fixes, workarounds, or diagnostics) you can provide!
> 
> Doug
> 
> Specs:
> PC: HP 2710p
> Graphics HW: Mobile Intel 965 Express Chipset Family / Graphics Media
> Accelerator X3100
> Graphics Driver: 6.14.10.4964 / 6/27/2008 / Intel Corporation
> R version: 2.7.1
> OS: WinXP Tablet PC 2005
> 
> The R script which produces it is very simple (requires package rgl):
> 
>   open3d()
>   x <- sort(rnorm(1000))
>   y <- rnorm(1000)
>   z <- rnorm(1000) + atan2(x,y)
>   plot3d(x, y, z, col=rainbow(1000), size=2)
> 
> Error details dialog:
> 
>  http://www.nabble.com/file/p18713928/Error.jpg 
> 
> The module ig4icd32.dll is part of the graphics driver.
> 
> Unfortunately, the hex dump data can't be copied/pasted from the error
> details dialog, nor can I get the .dmp file ("file is in use"). 
> 
> Some error information is saved in an xml file:
> 
> <?xml version="1.0" encoding="UTF-16"?>
> <DATABASE>
> <EXE NAME="Rgui.exe" FILTER="GRABMI_FILTER_PRIVACY">
>     <MATCHING_FILE NAME="iconv.dll" SIZE="918528" CHECKSUM="0x2B0ADD5D"
> MODULE_TYPE="WIN32" PE_CHECKSUM="0xE13B8" LINKER_VERSION="0x10000"
> LINK_DATE="02/29/2008 09:10:55" UPTO_LINK_DATE="02/29/2008 09:10:55" />
>     <MATCHING_FILE NAME="md5check.exe" SIZE="32768" CHECKSUM="0x1F99EDB5"
> BIN_FILE_VERSION="2.71.45970.0" BIN_PRODUCT_VERSION="3.0.0.0"
> FILE_DESCRIPTION="R for Windows files checker" FILE_VERSION="2.7.1   
> (2008-06-23)" LEGAL_COPYRIGHT="R Development Core Team 1995-2008"
> VERFILEDATEHI="0x0" VERFILEDATELO="0x0" VERFILEOS="0x4" VERFILETYPE="0x1"
> MODULE_TYPE="WIN32" PE_CHECKSUM="0xC07D" LINKER_VERSION="0x10000"
> UPTO_BIN_FILE_VERSION="2.71.45970.0" UPTO_BIN_PRODUCT_VERSION="3.0.0.0"
> LINK_DATE="06/23/2008 12:07:36" UPTO_LINK_DATE="06/23/2008 12:07:36"
> VER_LANGUAGE="English (United States) [0x409]" />
>     <MATCHING_FILE NAME="R.dll" SIZE="2822656" CHECKSUM="0x679DF762"
> BIN_FILE_VERSION="2.71.45970.0" BIN_PRODUCT_VERSION="3.0.0.0"
> FILE_DESCRIPTION="R for Windows DLL" FILE_VERSION="2.7.1    (2008-06-23)"
> LEGAL_COPYRIGHT="R Development Core Team 1995-2008" VERFILEDATEHI="0x0"
> VERFILEDATELO="0x0" VERFILEOS="0x4" VERFILETYPE="0x2" MODULE_TYPE="WIN32"
> PE_CHECKSUM="0x2B1E89" LINKER_VERSION="0x10000"
> UPTO_BIN_FILE_VERSION="2.71.45970.0" UPTO_BIN_PRODUCT_VERSION="3.0.0.0"
> LINK_DATE="06/23/2008 12:07:16" UPTO_LINK_DATE="06/23/2008 12:07:16"
> VER_LANGUAGE="English (United States) [0x409]" />
>     <MATCHING_FILE NAME="R.exe" SIZE="36352" CHECKSUM="0xDE9601D1"
> BIN_FILE_VERSION="2.71.45970.0" BIN_PRODUCT_VERSION="3.0.0.0"
> FILE_DESCRIPTION="R for Windows front-end" FILE_VERSION="2.7.1   
> (2008-06-23)" LEGAL_COPYRIGHT="R Development Core Team 1995-2008"
> VERFILEDATEHI="0x0" VERFILEDATELO="0x0" VERFILEOS="0x4" VERFILETYPE="0x1"
> MODULE_TYPE="WIN32" PE_CHECKSUM="0x14952" LINKER_VERSION="0x10000"
> UPTO_BIN_FILE_VERSION="2.71.45970.0" UPTO_BIN_PRODUCT_VERSION="3.0.0.0"
> LINK_DATE="06/23/2008 12:07:36" UPTO_LINK_DATE="06/23/2008 12:07:36"
> VER_LANGUAGE="English (United States) [0x409]" />
>     <MATCHING_FILE NAME="Rblas.dll" SIZE="169718" CHECKSUM="0xF612961D"
> BIN_FILE_VERSION="2.71.45970.0" BIN_PRODUCT_VERSION="3.0.0.0"
> FILE_DESCRIPTION="R for Windows DLL" FILE_VERSION="2.7.1    (2008-06-23)"
> LEGAL_COPYRIGHT="R Development Core Team 1995-2008" VERFILEDATEHI="0x0"
> VERFILEDATELO="0x0" VERFILEOS="0x4" VERFILETYPE="0x2" MODULE_TYPE="WIN32"
> PE_CHECKSUM="0x33F83" LINKER_VERSION="0x10000"
> UPTO_BIN_FILE_VERSION="2.71.45970.0" UPTO_BIN_PRODUCT_VERSION="3.0.0.0"
> LINK_DATE="06/23/2008 12:07:27" UPTO_LINK_DATE="06/23/2008 12:07:27"
> VER_LANGUAGE="English (United States) [0x409]" />
>     <MATCHING_FILE NAME="Rcmd.exe" SIZE="35840" CHECKSUM="0x512F7D5B"
> BIN_FILE_VERSION="2.71.45970.0" BIN_PRODUCT_VERSION="3.0.0.0"
> FILE_DESCRIPTION="R for Windows front-end" FILE_VERSION="2.7.1   
> (2008-06-23)" LEGAL_COPYRIGHT="R Development Core Team 1995-2008"
> VERFILEDATEHI="0x0" VERFILEDATELO="0x0" VERFILEOS="0x4" VERFILETYPE="0x1"
> MODULE_TYPE="WIN32" PE_CHECKSUM="0x13506" LINKER_VERSION="0x10000"
> UPTO_BIN_FILE_VERSION="2.71.45970.0" UPTO_BIN_PRODUCT_VERSION="3.0.0.0"
> LINK_DATE="06/23/2008 12:07:31" UPTO_LINK_DATE="06/23/2008 12:07:31"
> VER_LANGUAGE="English (United States) [0x409]" />
>     <MATCHING_FILE NAME="Rgraphapp.dll" SIZE="265802"
> CHECKSUM="0x521E1141" BIN_FILE_VERSION="2.71.45970.0"
> BIN_PRODUCT_VERSION="3.0.0.0" FILE_DESCRIPTION="Graphapp DLL for R"
> FILE_VERSION="2.7.1    (2008-06-23)" LEGAL_COPYRIGHT="R Development Core
> Team 1995-2008" VERFILEDATEHI="0x0" VERFILEDATELO="0x0" VERFILEOS="0x4"
> VERFILETYPE="0x2" MODULE_TYPE="WIN32" PE_CHECKSUM="0x42A3B"
> LINKER_VERSION="0x10000" UPTO_BIN_FILE_VERSION="2.71.45970.0"
> UPTO_BIN_PRODUCT_VERSION="3.0.0.0" LINK_DATE="06/23/2008 12:06:24"
> UPTO_LINK_DATE="06/23/2008 12:06:24" VER_LANGUAGE="English (United States)
> [0x409]" />
>     <MATCHING_FILE NAME="Rgui.exe" SIZE="27648" CHECKSUM="0xC8711AEA"
> BIN_FILE_VERSION="2.71.45970.0" BIN_PRODUCT_VERSION="3.0.0.0"
> FILE_DESCRIPTION="R for Windows GUI front-end" FILE_VERSION="2.7.1   
> (2008-06-23)" LEGAL_COPYRIGHT="R Development Core Team 1995-2008"
> VERFILEDATEHI="0x0" VERFILEDATELO="0x0" VERFILEOS="0x4" VERFILETYPE="0x1"
> MODULE_TYPE="WIN32" PE_CHECKSUM="0xCC15" LINKER_VERSION="0x10000"
> UPTO_BIN_FILE_VERSION="2.71.45970.0" UPTO_BIN_PRODUCT_VERSION="3.0.0.0"
> LINK_DATE="06/23/2008 12:07:30" UPTO_LINK_DATE="06/23/2008 12:07:30"
> VER_LANGUAGE="English (United States) [0x409]" />
>     <MATCHING_FILE NAME="Rlapack.dll" SIZE="1340928" CHECKSUM="0xD5D1B000"
> BIN_FILE_VERSION="2.71.45970.0" BIN_PRODUCT_VERSION="3.0.0.0"
> FILE_DESCRIPTION="R DLL for lapack" FILE_VERSION="2.7.1    (2008-06-23)"
> LEGAL_COPYRIGHT="R Development Core Team 2002-2008" VERFILEDATEHI="0x0"
> VERFILEDATELO="0x0" VERFILEOS="0x4" VERFILETYPE="0x2" MODULE_TYPE="WIN32"
> PE_CHECKSUM="0x1529FD" LINKER_VERSION="0x10000"
> UPTO_BIN_FILE_VERSION="2.71.45970.0" UPTO_BIN_PRODUCT_VERSION="3.0.0.0"
> LINK_DATE="06/23/2008 12:09:12" UPTO_LINK_DATE="06/23/2008 12:09:12"
> VER_LANGUAGE="English (United States) [0x409]" />
>     <MATCHING_FILE NAME="Rproxy.dll" SIZE="59904" CHECKSUM="0xFC76A84D"
> BIN_FILE_VERSION="2.71.45970.0" BIN_PRODUCT_VERSION="3.0.0.0"
> FILE_DESCRIPTION="R for Windows terminal front-end" FILE_VERSION="2.7.1   
> (2008-06-23)" LEGAL_COPYRIGHT="R Development Core Team 1995-2008"
> VERFILEDATEHI="0x0" VERFILEDATELO="0x0" VERFILEOS="0x4" VERFILETYPE="0x1"
> MODULE_TYPE="WIN32" PE_CHECKSUM="0xFE51" LINKER_VERSION="0x10000"
> UPTO_BIN_FILE_VERSION="2.71.45970.0" UPTO_BIN_PRODUCT_VERSION="3.0.0.0"
> LINK_DATE="06/23/2008 12:07:35" UPTO_LINK_DATE="06/23/2008 12:07:35"
> VER_LANGUAGE="English (United States) [0x409]" />
>     <MATCHING_FILE NAME="Rscript.exe" SIZE="31232" CHECKSUM="0x1A6E3137"
> BIN_FILE_VERSION="2.71.45970.0" BIN_PRODUCT_VERSION="3.0.0.0"
> FILE_DESCRIPTION="R for Windows front-end" FILE_VERSION="2.7.1   
> (2008-06-23)" LEGAL_COPYRIGHT="R Development Core Team 1995-2008"
> VERFILEDATEHI="0x0" VERFILEDATELO="0x0" VERFILEOS="0x4" VERFILETYPE="0x1"
> MODULE_TYPE="WIN32" PE_CHECKSUM="0x11D22" LINKER_VERSION="0x10000"
> UPTO_BIN_FILE_VERSION="2.71.45970.0" UPTO_BIN_PRODUCT_VERSION="3.0.0.0"
> LINK_DATE="06/23/2008 12:07:37" UPTO_LINK_DATE="06/23/2008 12:07:37"
> VER_LANGUAGE="English (United States) [0x409]" />
>     <MATCHING_FILE NAME="RSetReg.exe" SIZE="28672" CHECKSUM="0x7ED2B4D7"
> BIN_FILE_VERSION="2.71.45970.0" BIN_PRODUCT_VERSION="3.0.0.0"
> FILE_DESCRIPTION="R for Windows front-end" FILE_VERSION="2.7.1   
> (2008-06-23)" LEGAL_COPYRIGHT="R Development Core Team 1995-2008"
> VERFILEDATEHI="0x0" VERFILEDATELO="0x0" VERFILEOS="0x4" VERFILETYPE="0x1"
> MODULE_TYPE="WIN32" PE_CHECKSUM="0x15E4A" LINKER_VERSION="0x10000"
> UPTO_BIN_FILE_VERSION="2.71.45970.0" UPTO_BIN_PRODUCT_VERSION="3.0.0.0"
> LINK_DATE="06/23/2008 12:07:31" UPTO_LINK_DATE="06/23/2008 12:07:31"
> VER_LANGUAGE="English (United States) [0x409]" />
>     <MATCHING_FILE NAME="Rterm.exe" SIZE="28672" CHECKSUM="0x4B486A15"
> BIN_FILE_VERSION="2.71.45970.0" BIN_PRODUCT_VERSION="3.0.0.0"
> FILE_DESCRIPTION="R for Windows terminal front-end" FILE_VERSION="2.7.1   
> (2008-06-23)" LEGAL_COPYRIGHT="R Development Core Team 1995-2008"
> VERFILEDATEHI="0x0" VERFILEDATELO="0x0" VERFILEOS="0x4" VERFILETYPE="0x1"
> MODULE_TYPE="WIN32" PE_CHECKSUM="0x13CB5" LINKER_VERSION="0x10000"
> UPTO_BIN_FILE_VERSION="2.71.45970.0" UPTO_BIN_PRODUCT_VERSION="3.0.0.0"
> LINK_DATE="06/23/2008 12:07:30" UPTO_LINK_DATE="06/23/2008 12:07:30"
> VER_LANGUAGE="English (United States) [0x409]" />
>     <MATCHING_FILE NAME="Rzlib.dll" SIZE="92826" CHECKSUM="0x6F321612"
> MODULE_TYPE="WIN32" PE_CHECKSUM="0x1CAF9" LINKER_VERSION="0x10000"
> LINK_DATE="06/23/2008 12:06:51" UPTO_LINK_DATE="06/23/2008 12:06:51" />
> </EXE>
> <EXE NAME="ig4icd32.dll" FILTER="GRABMI_FILTER_THISFILEONLY">
>     <MATCHING_FILE NAME="ig4icd32.dll" SIZE="2412544"
> CHECKSUM="0x50BD93D8" BIN_FILE_VERSION="6.14.10.4964"
> BIN_PRODUCT_VERSION="6.14.10.4964" PRODUCT_VERSION="6.14.10.4964"
> FILE_DESCRIPTION="OpenGL(R) Driver for Intel(R) Graphics Accelerator"
> COMPANY_NAME="Intel Corporation" PRODUCT_NAME="Intel Graphics Accelerator
> Drivers for Windows NT(R)" FILE_VERSION="6.14.10.4964"
> ORIGINAL_FILENAME="iglicd32" INTERNAL_NAME="OpenGL"
> LEGAL_COPYRIGHT="Copyright (c) 1998-2006 Intel Corporation."
> VERFILEDATEHI="0x0" VERFILEDATELO="0x0" VERFILEOS="0x10004"
> VERFILETYPE="0x2" MODULE_TYPE="WIN32" PE_CHECKSUM="0x0"
> LINKER_VERSION="0x10064" UPTO_BIN_FILE_VERSION="6.14.10.4964"
> UPTO_BIN_PRODUCT_VERSION="6.14.10.4964" LINK_DATE="06/27/2008 15:19:30"
> UPTO_LINK_DATE="06/27/2008 15:19:30" VER_LANGUAGE="English (United States)
> [0x409]" />
> </EXE>
> <EXE NAME="kernel32.dll" FILTER="GRABMI_FILTER_THISFILEONLY">
>     <MATCHING_FILE NAME="kernel32.dll" SIZE="984576" CHECKSUM="0xF0B331F6"
> BIN_FILE_VERSION="5.1.2600.3119" BIN_PRODUCT_VERSION="5.1.2600.3119"
> PRODUCT_VERSION="5.1.2600.3119" FILE_DESCRIPTION="Windows NT BASE API
> Client DLL" COMPANY_NAME="Microsoft Corporation" PRODUCT_NAME="Microsoft?
> Windows? Operating System" FILE_VERSION="5.1.2600.3119
> (xpsp_sp2_gdr.070416-1301)" ORIGINAL_FILENAME="kernel32"
> INTERNAL_NAME="kernel32" LEGAL_COPYRIGHT="? Microsoft Corporation. All
> rights reserved." VERFILEDATEHI="0x0" VERFILEDATELO="0x0"
> VERFILEOS="0x40004" VERFILETYPE="0x2" MODULE_TYPE="WIN32"
> PE_CHECKSUM="0xF9293" LINKER_VERSION="0x50001"
> UPTO_BIN_FILE_VERSION="5.1.2600.3119"
> UPTO_BIN_PRODUCT_VERSION="5.1.2600.3119" LINK_DATE="04/16/2007 15:52:53"
> UPTO_LINK_DATE="04/16/2007 15:52:53" VER_LANGUAGE="English (United States)
> [0x409]" />
> </EXE>
> </DATABASE>
> 
> 

-- 
View this message in context: http://www.nabble.com/R-crashes-on-new-laptop-tp18713928p18716390.html
Sent from the R devel mailing list archive at Nabble.com.


From Robert.McGehee at geodecapital.com  Tue Jul 29 21:40:37 2008
From: Robert.McGehee at geodecapital.com (McGehee, Robert)
Date: Tue, 29 Jul 2008 15:40:37 -0400
Subject: [Rd] sapply(Date, is.numeric)
Message-ID: <EEBC169715EB8C438D3C9283AF0F201C023E47B4@MSGBOSCLM2WIN.DMN1.FMR.COM>

FYI, 
I've tried posting the below message twice to the bug tracking system,
once by email (below), and the second time 5 days later directly to the
bugs.r-project.org website. As far as I can tell, the bug tracking
system hasn't picked this up. Also it looks like the latest "incoming"
bug is dated 25 May 2008, so perhaps others are having difficulty as
well. (cc: r-bugs)

Cheers, Robert


-----Original Message-----
From: McGehee, Robert 
Sent: Monday, July 14, 2008 9:51 AM
To: R-bugs at biostat.ku.dk
Subject: sapply(Date, is.numeric)

R-developers,
The results below are inconsistent. From the documentation for
is.numeric, I expect FALSE in both cases.

> x <- data.frame(dt=Sys.Date())
> is.numeric(x$dt)
[1] FALSE
> sapply(x, is.numeric)
  dt
TRUE

## Yet, sapply seems aware of the Date class
> sapply(x, class)
  dt
"Date"

platform       i386-pc-mingw32             
arch           i386                        
os             mingw32                     
system         i386, mingw32               
status                                     
major          2                           
minor          7.0                         
year           2008                        
month          04                          
day            22                          
svn rev        45424                       
language       R                           
version.string R version 2.7.0 (2008-04-22)

Thanks,

Robert McGehee, CFA
Geode Capital Management, LLC
One Post Office Square, 28th Floor | Boston, MA | 02109
Tel: 617/392-8396    Fax:617/476-6389
mailto:robert.mcgehee at geodecapital.com



This e-mail, and any attachments hereto, are intended fo...{{dropped:12}}


From bill at insightful.com  Tue Jul 29 21:59:05 2008
From: bill at insightful.com (Bill Dunlap)
Date: Tue, 29 Jul 2008 12:59:05 -0700 (PDT)
Subject: [Rd] closing View windows after multiple View(x) crashes
In-Reply-To: <488F48E4.1020203@zoology.ufl.edu>
References: <488F48E4.1020203@zoology.ufl.edu>
Message-ID: <Pine.GSO.4.56.0807291249340.20024@devsun3201.insightful.com>

On Tue, 29 Jul 2008, Ben Bolker wrote:

>  > sessionInfo()
> R version 2.8.0 Under development (unstable) (2008-07-07 r46046)
> i686-pc-linux-gnu
> ...
> x = cbind(a=1:10,b=1:10)
>
> View(x)
> View(x)
> View(x)
> View(x)
>
>    then try to close the latest window by clicking on the "x"
> (close-window) icon in the corner.
>    I can usually provoke a segmentation fault this way ...
>    Ubuntu Hardy, up to date.

Does it work any better for you if you edit src/modules/X11/dataentry.c
and add a call to Rsync(DE) after the XDestroyWindow(iodisplay, DE->iowindow)
in closewin()?

I don't get your crash, but I have to click twice on the X button
to get the View window to close and valgrind complains about the use
of freed memory, DE->prot in the event loop in R_ProcessX11Events()
            if(ioevent.xclient.message_type == _XA_WM_PROTOCOLS
               && ioevent.xclient.data.l[0] == DE->prot) {
                /* user clicked on `close' aka `destroy' */
                done = 1;
            }
The trouble seems to be that this code sets done=1, causing the calls
        closewin(DE);
        free(DE);
but without the Rsync call in closewin(), the window doesn't close
immediately and later sends some messages to its event handler, causing
the use of the freed DE.  (I sometimes use the idiom free(DE);DE=NULL;
instead of just free(DE) to make sure no one tries to use DE afterwards,
but valgrind does that job better.)

When I make closewin() call Rsync(DE) then I only have to click
once on the X button to close the View window, the event loop
doesn't get reentered, and valgrind seems happy.

I'm using R on "Red Hat Enterprise Linux WS release 4 (Nahant Update 3)"
with the Cygwin X server on a Windows XP laptop.

----------------------------------------------------------------------------
Bill Dunlap
Insightful Corporation
bill at insightful dot com

 "All statements in this message represent the opinions of the author and do
 not necessarily reflect Insightful Corporation policy or position."


From bill at insightful.com  Tue Jul 29 23:03:59 2008
From: bill at insightful.com (Bill Dunlap)
Date: Tue, 29 Jul 2008 14:03:59 -0700 (PDT)
Subject: [Rd] closing View windows after multiple View(x) crashes
In-Reply-To: <488F8416.9000609@zoology.ufl.edu>
References: <488F48E4.1020203@zoology.ufl.edu>
	<Pine.GSO.4.56.0807291249340.20024@devsun3201.insightful.com>
	<488F8416.9000609@zoology.ufl.edu>
Message-ID: <Pine.GSO.4.56.0807291400160.20024@devsun3201.insightful.com>

On Tue, 29 Jul 2008, Ben Bolker wrote:

>    That works like a charm.  Thanks!
>
>    Ben Bolker

Good.  Here is the patch I used.  (I didn't send it
earlier because my code still had a bunch of Rprintf
calls in it to track the event loop activity.

Index: src/modules/X11/dataentry.c
===================================================================
--- src/modules/X11/dataentry.c	(revision 46139)
+++ src/modules/X11/dataentry.c	(working copy)
@@ -1881,6 +1881,7 @@
 #endif
     XDestroyWindow(iodisplay, DE->iowindow);
     /* XCloseDisplay(iodisplay); */
+    Rsync(DE);
 }

 #define USE_Xt 1

Valgrind reports a slew of memory leaks when R closes
after using View(), but it didn't show any use of freed
or uninitialized memory after that change.

----------------------------------------------------------------------------
Bill Dunlap
Insightful Corporation
bill at insightful dot com

 "All statements in this message represent the opinions of the author and do
 not necessarily reflect Insightful Corporation policy or position."


From ripley at stats.ox.ac.uk  Tue Jul 29 23:37:57 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 29 Jul 2008 22:37:57 +0100 (BST)
Subject: [Rd] closing View windows after multiple View(x) crashes
In-Reply-To: <Pine.GSO.4.56.0807291400160.20024@devsun3201.insightful.com>
References: <488F48E4.1020203@zoology.ufl.edu>
	<Pine.GSO.4.56.0807291249340.20024@devsun3201.insightful.com>
	<488F8416.9000609@zoology.ufl.edu>
	<Pine.GSO.4.56.0807291400160.20024@devsun3201.insightful.com>
Message-ID: <alpine.LFD.1.10.0807292226030.8348@gannet.stats.ox.ac.uk>

We have found elsewhere that the need to use XSync is very dependent on 
the window manager. What manager were you using?

I'll add the call in any case.

On Tue, 29 Jul 2008, Bill Dunlap wrote:

> On Tue, 29 Jul 2008, Ben Bolker wrote:
>
>>    That works like a charm.  Thanks!
>>
>>    Ben Bolker
>
> Good.  Here is the patch I used.  (I didn't send it
> earlier because my code still had a bunch of Rprintf
> calls in it to track the event loop activity.
>
> Index: src/modules/X11/dataentry.c
> ===================================================================
> --- src/modules/X11/dataentry.c	(revision 46139)
> +++ src/modules/X11/dataentry.c	(working copy)
> @@ -1881,6 +1881,7 @@
> #endif
>     XDestroyWindow(iodisplay, DE->iowindow);
>     /* XCloseDisplay(iodisplay); */
> +    Rsync(DE);
> }
>
> #define USE_Xt 1
>
> Valgrind reports a slew of memory leaks when R closes
> after using View(), but it didn't show any use of freed
> or uninitialized memory after that change.
>
> ----------------------------------------------------------------------------
> Bill Dunlap
> Insightful Corporation
> bill at insightful dot com
>
> "All statements in this message represent the opinions of the author and do
> not necessarily reflect Insightful Corporation policy or position."
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From bolker at zoology.ufl.edu  Tue Jul 29 22:56:54 2008
From: bolker at zoology.ufl.edu (Ben Bolker)
Date: Tue, 29 Jul 2008 16:56:54 -0400
Subject: [Rd] closing View windows after multiple View(x) crashes
In-Reply-To: <Pine.GSO.4.56.0807291249340.20024@devsun3201.insightful.com>
References: <488F48E4.1020203@zoology.ufl.edu>
	<Pine.GSO.4.56.0807291249340.20024@devsun3201.insightful.com>
Message-ID: <488F8416.9000609@zoology.ufl.edu>

   That works like a charm.  Thanks!

   Ben Bolker

Bill Dunlap wrote:
> On Tue, 29 Jul 2008, Ben Bolker wrote:
> 
>>  > sessionInfo()
>> R version 2.8.0 Under development (unstable) (2008-07-07 r46046)
>> i686-pc-linux-gnu
>> ...
>> x = cbind(a=1:10,b=1:10)
>>
>> View(x)
>> View(x)
>> View(x)
>> View(x)
>>
>>    then try to close the latest window by clicking on the "x"
>> (close-window) icon in the corner.
>>    I can usually provoke a segmentation fault this way ...
>>    Ubuntu Hardy, up to date.
> 
> Does it work any better for you if you edit src/modules/X11/dataentry.c
> and add a call to Rsync(DE) after the XDestroyWindow(iodisplay, DE->iowindow)
> in closewin()?
> 
> I don't get your crash, but I have to click twice on the X button
> to get the View window to close and valgrind complains about the use
> of freed memory, DE->prot in the event loop in R_ProcessX11Events()
>             if(ioevent.xclient.message_type == _XA_WM_PROTOCOLS
>                && ioevent.xclient.data.l[0] == DE->prot) {
>                 /* user clicked on `close' aka `destroy' */
>                 done = 1;
>             }
> The trouble seems to be that this code sets done=1, causing the calls
>         closewin(DE);
>         free(DE);
> but without the Rsync call in closewin(), the window doesn't close
> immediately and later sends some messages to its event handler, causing
> the use of the freed DE.  (I sometimes use the idiom free(DE);DE=NULL;
> instead of just free(DE) to make sure no one tries to use DE afterwards,
> but valgrind does that job better.)
> 
> When I make closewin() call Rsync(DE) then I only have to click
> once on the X button to close the View window, the event loop
> doesn't get reentered, and valgrind seems happy.
> 
> I'm using R on "Red Hat Enterprise Linux WS release 4 (Nahant Update 3)"
> with the Cygwin X server on a Windows XP laptop.
> 
> ----------------------------------------------------------------------------
> Bill Dunlap
> Insightful Corporation
> bill at insightful dot com
> 
>  "All statements in this message represent the opinions of the author and do
>  not necessarily reflect Insightful Corporation policy or position."


-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 252 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20080729/1d633b3d/attachment.bin>

From maechler at stat.math.ethz.ch  Wed Jul 30 10:04:24 2008
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Wed, 30 Jul 2008 10:04:24 +0200
Subject: [Rd] R-bugs e-mail problems {was "sapply(Date, is.numeric)"}
In-Reply-To: <EEBC169715EB8C438D3C9283AF0F201C023E47B4@MSGBOSCLM2WIN.DMN1.FMR.COM>
References: <EEBC169715EB8C438D3C9283AF0F201C023E47B4@MSGBOSCLM2WIN.DMN1.FMR.COM>
Message-ID: <18576.8328.41686.367609@stat.math.ethz.ch>

>>>>> "RobMcG" == McGehee, Robert <Robert.McGehee at geodecapital.com>
>>>>>     on Tue, 29 Jul 2008 15:40:37 -0400 writes:

    RobMcG> FYI, 
    RobMcG> I've tried posting the below message twice to the bug tracking system,
    RobMcG> once by email (below), and the second time 5 days later directly to the
    RobMcG> bugs.r-project.org website. As far as I can tell, the bug tracking
    RobMcG> system hasn't picked this up. Also it looks like the latest "incoming"
    RobMcG> bug is dated 25 May 2008, so perhaps others are having difficulty as
    RobMcG> well. (cc: r-bugs)

Well, if you look into the *trashcan*, you find the latest ones
to be from  'July 4' , (and it may well have been who cleaned up
the incoming mess, moving 95% of the messages to the trashcan);
so the mail-interface seemed to have stopped at the US national
holiday.

Given how ineffective our spam filters have become there,
it may not be a big harm  :-)

There have plans for a long time to change to a new bug report
system (probably with*out* e-mail interface - alas!),
but there have been diverse reasons why this has never happened.
One of the reasons: We'd want to migrate the current repository
(all the "bug - fix threads", apart from the trashcan) to the
new system, and I think haven't found anyone to do that for us.

We had even considered the R foundation would offer a monetary
amount to someone (smart programmer) to program the one-time
migration, but that somehow failed, too?
I'm getting really off-topic,
but this my be worthwhile theme to open just before meeting many
at the useR!2008 in Dortmund.

Martin Maechler, ETH Zurich and R-Core


From maechler at stat.math.ethz.ch  Wed Jul 30 10:55:04 2008
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Wed, 30 Jul 2008 10:55:04 +0200
Subject: [Rd] sapply(Date, is.numeric)
In-Reply-To: <EEBC169715EB8C438D3C9283AF0F201C023E47B4@MSGBOSCLM2WIN.DMN1.FMR.COM>
References: <EEBC169715EB8C438D3C9283AF0F201C023E47B4@MSGBOSCLM2WIN.DMN1.FMR.COM>
Message-ID: <18576.11368.858281.462289@stat.math.ethz.ch>

>>>>> "RobMcG" == McGehee, Robert <Robert.McGehee at geodecapital.com>
>>>>>     on Tue, 29 Jul 2008 15:40:37 -0400 writes:

    RobMcG> FYI, 
    RobMcG> I've tried posting the below message twice to the bug tracking system,

    [....... r-bugs problems discussed in a separate thread ....]



    RobMcG> R-developers,
    RobMcG> The results below are inconsistent. From the documentation for
    RobMcG> is.numeric, I expect FALSE in both cases.

    >> x <- data.frame(dt=Sys.Date())
    >> is.numeric(x$dt)
    RobMcG> [1] FALSE
    >> sapply(x, is.numeric)
    RobMcG> dt
    RobMcG> TRUE

    RobMcG> ## Yet, sapply seems aware of the Date class
    >> sapply(x, class)
    RobMcG> dt
    RobMcG> "Date"

Yes, thanks a lot, Robert, for the report.

That *is* a bug somewhere in the .Internal(lapply(...)) C code,
when S3 dispatch of primitive functions should happen.

Here's an R scriptlet exposing a 2nd example

### lapply(list, FUN)
### ------------------ seems to sometimes fail for
### .Primitive S3-generic functions

(ds <- seq(from=Sys.Date(), by=1, length=4))
##[1] "2008-07-30" "2008-07-31" "2008-08-01" "2008-08-02"
ll <- list(d=ds)
lapply(list(d=ds), round)
## -> Error in lapply(list(d = ds), round) : dispatch error

## or -- related to bug report by Robert McGehee on R-devel, on 2008-07-29:
sapply(list(d=ds), is.numeric)
## TRUE

## in spite of
is.numeric(`[[`(ll,1)) ## FALSE , because of
is.numeric.date

## or
round(`[[`(ll,1))
## [1] "2008-07-30" "2008-07-31" "2008-08-01" "2008-08-02"

##-----------------------------

But I'm currently too much tied up with other duties,
to find and test bug-fix.

Martin Maechler, ETH Zurich and R-Core Team


From ripley at stats.ox.ac.uk  Wed Jul 30 13:12:00 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 30 Jul 2008 12:12:00 +0100 (BST)
Subject: [Rd] sapply(Date, is.numeric)
In-Reply-To: <EEBC169715EB8C438D3C9283AF0F201C023E47B4@MSGBOSCLM2WIN.DMN1.FMR.COM>
References: <EEBC169715EB8C438D3C9283AF0F201C023E47B4@MSGBOSCLM2WIN.DMN1.FMR.COM>
Message-ID: <alpine.LFD.1.10.0807292203330.7576@gannet.stats.ox.ac.uk>

Try this workaround

> sapply(x, function(x) is.numeric(x))
    dt
FALSE

is.numeric is primitive, and primitive functions don't always play well 
with [sl]apply.

On Tue, 29 Jul 2008, McGehee, Robert wrote:

> FYI,
> I've tried posting the below message twice to the bug tracking system,
> once by email (below), and the second time 5 days later directly to the
> bugs.r-project.org website. As far as I can tell, the bug tracking
> system hasn't picked this up. Also it looks like the latest "incoming"
> bug is dated 25 May 2008, so perhaps others are having difficulty as
> well. (cc: r-bugs)
>
> Cheers, Robert
>
>
> -----Original Message-----
> From: McGehee, Robert
> Sent: Monday, July 14, 2008 9:51 AM
> To: R-bugs at biostat.ku.dk
> Subject: sapply(Date, is.numeric)
>
> R-developers,
> The results below are inconsistent. From the documentation for
> is.numeric, I expect FALSE in both cases.
>
>> x <- data.frame(dt=Sys.Date())
>> is.numeric(x$dt)
> [1] FALSE
>> sapply(x, is.numeric)
>  dt
> TRUE
>
> ## Yet, sapply seems aware of the Date class
>> sapply(x, class)
>  dt
> "Date"
>
> platform       i386-pc-mingw32
> arch           i386
> os             mingw32
> system         i386, mingw32
> status
> major          2
> minor          7.0
> year           2008
> month          04
> day            22
> svn rev        45424
> language       R
> version.string R version 2.7.0 (2008-04-22)
>
> Thanks,
>
> Robert McGehee, CFA
> Geode Capital Management, LLC
> One Post Office Square, 28th Floor | Boston, MA | 02109
> Tel: 617/392-8396    Fax:617/476-6389
> mailto:robert.mcgehee at geodecapital.com
>
>
>
> This e-mail, and any attachments hereto, are intended fo...{{dropped:12}}
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Wed Jul 30 14:29:38 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 30 Jul 2008 13:29:38 +0100 (BST)
Subject: [Rd] sapply(Date, is.numeric)
In-Reply-To: <18576.11368.858281.462289@stat.math.ethz.ch>
References: <EEBC169715EB8C438D3C9283AF0F201C023E47B4@MSGBOSCLM2WIN.DMN1.FMR.COM>
	<18576.11368.858281.462289@stat.math.ethz.ch>
Message-ID: <alpine.LFD.1.10.0807301248250.24325@auk.stats.ox.ac.uk>

On Wed, 30 Jul 2008, Martin Maechler wrote:

>>>>>> "RobMcG" == McGehee, Robert <Robert.McGehee at geodecapital.com>
>>>>>>     on Tue, 29 Jul 2008 15:40:37 -0400 writes:
>
>    RobMcG> FYI,
>    RobMcG> I've tried posting the below message twice to the bug tracking system,
>
>    [....... r-bugs problems discussed in a separate thread ....]
>
>
>
>    RobMcG> R-developers,
>    RobMcG> The results below are inconsistent. From the documentation for
>    RobMcG> is.numeric, I expect FALSE in both cases.
>
>    >> x <- data.frame(dt=Sys.Date())
>    >> is.numeric(x$dt)
>    RobMcG> [1] FALSE
>    >> sapply(x, is.numeric)
>    RobMcG> dt
>    RobMcG> TRUE
>
>    RobMcG> ## Yet, sapply seems aware of the Date class
>    >> sapply(x, class)
>    RobMcG> dt
>    RobMcG> "Date"
>
> Yes, thanks a lot, Robert, for the report.
>
> That *is* a bug somewhere in the .Internal(lapply(...)) C code,
> when S3 dispatch of primitive functions should happen.

The bug is in do_is, which uses CHAR(PRINTNAME(CAR(call))), and when 
called from lapply that gives "FUN" not "is.numeric".  The root cause is 
the following comment

     FUN = CADR(args);  /* must be unevaluated for use in e.g. bquote */

and hence that the function in the *call* passed to do_is can be 
unevaluated.

> Here's an R scriptlet exposing a 2nd example
>
> ### lapply(list, FUN)
> ### ------------------ seems to sometimes fail for
> ### .Primitive S3-generic functions
>
> (ds <- seq(from=Sys.Date(), by=1, length=4))
> ##[1] "2008-07-30" "2008-07-31" "2008-08-01" "2008-08-02"
> ll <- list(d=ds)
> lapply(list(d=ds), round)
> ## -> Error in lapply(list(d = ds), round) : dispatch error

And that's a separate issue, in DispatchGroup which states that arguments 
have been evaluated (true) but the 'call' from lapply gives the 
unevaluated arguments and so there is a mismatch.

I'm testing fixes for both.

> ## or -- related to bug report by Robert McGehee on R-devel, on 2008-07-29:
> sapply(list(d=ds), is.numeric)
> ## TRUE
>
> ## in spite of
> is.numeric(`[[`(ll,1)) ## FALSE , because of
> is.numeric.date
>
> ## or
> round(`[[`(ll,1))
> ## [1] "2008-07-30" "2008-07-31" "2008-08-01" "2008-08-02"
>
> ##-----------------------------
>
> But I'm currently too much tied up with other duties,
> to find and test bug-fix.
>
> Martin Maechler, ETH Zurich and R-Core Team
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From maechler at stat.math.ethz.ch  Wed Jul 30 15:11:12 2008
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Wed, 30 Jul 2008 15:11:12 +0200
Subject: [Rd] sapply(Date, is.numeric)
In-Reply-To: <alpine.LFD.1.10.0807301248250.24325@auk.stats.ox.ac.uk>
References: <EEBC169715EB8C438D3C9283AF0F201C023E47B4@MSGBOSCLM2WIN.DMN1.FMR.COM>
	<18576.11368.858281.462289@stat.math.ethz.ch>
	<alpine.LFD.1.10.0807301248250.24325@auk.stats.ox.ac.uk>
Message-ID: <18576.26736.142076.965510@stat.math.ethz.ch>

>>>>> "BDR" == Prof Brian Ripley <ripley at stats.ox.ac.uk>
>>>>>     on Wed, 30 Jul 2008 13:29:38 +0100 (BST) writes:

    BDR> On Wed, 30 Jul 2008, Martin Maechler wrote:
    >>>>>>> "RobMcG" == McGehee, Robert <Robert.McGehee at geodecapital.com>
    >>>>>>> on Tue, 29 Jul 2008 15:40:37 -0400 writes:
    >> 
    RobMcG> FYI,
    RobMcG> I've tried posting the below message twice to the bug tracking system,
    >> 
    >> [....... r-bugs problems discussed in a separate thread ....]
    >> 
    >> 
    >> 
    RobMcG> R-developers,
    RobMcG> The results below are inconsistent. From the documentation for
    RobMcG> is.numeric, I expect FALSE in both cases.
    >> 
    >> >> x <- data.frame(dt=Sys.Date())
    >> >> is.numeric(x$dt)
    RobMcG> [1] FALSE
    >> >> sapply(x, is.numeric)
    RobMcG> dt
    RobMcG> TRUE
    >> 
    RobMcG> ## Yet, sapply seems aware of the Date class
    >> >> sapply(x, class)
    RobMcG> dt
    RobMcG> "Date"
    >> 
    >> Yes, thanks a lot, Robert, for the report.
    >> 
    >> That *is* a bug somewhere in the .Internal(lapply(...)) C code,
    >> when S3 dispatch of primitive functions should happen.

    BDR> The bug is in do_is, which uses CHAR(PRINTNAME(CAR(call))), and when 
    BDR> called from lapply that gives "FUN" not "is.numeric".  The root cause is 
    BDR> the following comment

    BDR> FUN = CADR(args);  /* must be unevaluated for use in e.g. bquote */

    BDR> and hence that the function in the *call* passed to do_is can be 
    BDR> unevaluated.

aah!  I see.

    >> Here's an R scriptlet exposing a 2nd example
    >> 
    >> ### lapply(list, FUN)
    >> ### ------------------ seems to sometimes fail for
    >> ### .Primitive S3-generic functions
    >> 
    >> (ds <- seq(from=Sys.Date(), by=1, length=4))
    >> ##[1] "2008-07-30" "2008-07-31" "2008-08-01" "2008-08-02"
    >> ll <- list(d=ds)
    >> lapply(list(d=ds), round)
    >> ## -> Error in lapply(list(d = ds), round) : dispatch error


    BDR> And that's a separate issue, in DispatchGroup which states that arguments 
    BDR> have been evaluated (true) but the 'call' from lapply gives the 
    BDR> unevaluated arguments and so there is a mismatch.

yes, I too found that this was a separate issue, the latter
one being new since version 2.7.0

    BDR> I'm testing fixes for both.

Excellent!
Martin


    >> ## or -- related to bug report by Robert McGehee on R-devel, on 2008-07-29:
    >> sapply(list(d=ds), is.numeric)
    >> ## TRUE
    >> 
    >> ## in spite of
    >> is.numeric(`[[`(ll,1)) ## FALSE , because of
    >> is.numeric.date
    >> 
    >> ## or
    >> round(`[[`(ll,1))
    >> ## [1] "2008-07-30" "2008-07-31" "2008-08-01" "2008-08-02"
    >> 
    >> ##-----------------------------
    >> 
    >> But I'm currently too much tied up with other duties,
    >> to find and test bug-fix.
    >> 
    >> Martin Maechler, ETH Zurich and R-Core Team


From bolker at zoology.ufl.edu  Wed Jul 30 15:20:59 2008
From: bolker at zoology.ufl.edu (Ben Bolker)
Date: Wed, 30 Jul 2008 09:20:59 -0400
Subject: [Rd] closing View windows after multiple View(x) crashes
In-Reply-To: <alpine.LFD.1.10.0807292226030.8348@gannet.stats.ox.ac.uk>
References: <488F48E4.1020203@zoology.ufl.edu>
	<Pine.GSO.4.56.0807291249340.20024@devsun3201.insightful.com>
	<488F8416.9000609@zoology.ufl.edu>
	<Pine.GSO.4.56.0807291400160.20024@devsun3201.insightful.com>
	<alpine.LFD.1.10.0807292226030.8348@gannet.stats.ox.ac.uk>
Message-ID: <48906ABB.2030302@zoology.ufl.edu>

   I'm using Gnome.

   Ben

Prof Brian Ripley wrote:
> We have found elsewhere that the need to use XSync is very dependent on 
> the window manager. What manager were you using?
> 
> I'll add the call in any case.
> 
> On Tue, 29 Jul 2008, Bill Dunlap wrote:
> 
>> On Tue, 29 Jul 2008, Ben Bolker wrote:
>>
>>>    That works like a charm.  Thanks!
>>>
>>>    Ben Bolker
>>
>> Good.  Here is the patch I used.  (I didn't send it
>> earlier because my code still had a bunch of Rprintf
>> calls in it to track the event loop activity.
>>
>> Index: src/modules/X11/dataentry.c
>> ===================================================================
>> --- src/modules/X11/dataentry.c    (revision 46139)
>> +++ src/modules/X11/dataentry.c    (working copy)
>> @@ -1881,6 +1881,7 @@
>> #endif
>>     XDestroyWindow(iodisplay, DE->iowindow);
>>     /* XCloseDisplay(iodisplay); */
>> +    Rsync(DE);
>> }
>>
>> #define USE_Xt 1
>>
>> Valgrind reports a slew of memory leaks when R closes
>> after using View(), but it didn't show any use of freed
>> or uninitialized memory after that change.
>>
>> ---------------------------------------------------------------------------- 
>>
>> Bill Dunlap
>> Insightful Corporation
>> bill at insightful dot com
>>
>> "All statements in this message represent the opinions of the author 
>> and do
>> not necessarily reflect Insightful Corporation policy or position."
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>


From ernest.turro at ic.ac.uk  Wed Jul 30 15:45:08 2008
From: ernest.turro at ic.ac.uk (Ernest Turro)
Date: Wed, 30 Jul 2008 14:45:08 +0100
Subject: [Rd] R, Macports and C++ streams
Message-ID: <37E1D80F-D1CB-4B4B-80B1-DDBDB0EF43BD@ic.ac.uk>

Dear all,

R on Macports relies on GCC 4.3 to build packages. I find that  
packages with shared objects that use C++ streams crash R if they're  
compiled using Macports' gcc43, but work fine if compiled in exactly  
the same way using Apple-supplied GCC 4.2. Has anyone here had the  
same issue/know what is causing this problem?

Thanks,

Ernest


From kjell.konis at epfl.ch  Wed Jul 30 16:18:11 2008
From: kjell.konis at epfl.ch (Kjell Konis)
Date: Wed, 30 Jul 2008 16:18:11 +0200
Subject: [Rd] R, Macports and C++ streams
In-Reply-To: <37E1D80F-D1CB-4B4B-80B1-DDBDB0EF43BD@ic.ac.uk>
References: <37E1D80F-D1CB-4B4B-80B1-DDBDB0EF43BD@ic.ac.uk>
Message-ID: <D5AE68F5-E80A-4E84-8988-039A3DF3A97F@epfl.ch>

I found this in Writing R Extensions:

"Using C++ iostreams, as in this example, is best avoided. There is no  
guarantee that the output will appear in the R console, and indeed it  
will not on the R for Windows console. Use R code or the C entry  
points (see Printing) for all I/O if at all possible."

That is, use Rprintf() instead. The fact that your code works with one  
version of gcc and not another can probably be chalked up to  
coincidence.

Kjell

On Jul 30, 2008, at 3:45 PM, Ernest Turro wrote:

> Dear all,
>
> R on Macports relies on GCC 4.3 to build packages. I find that
> packages with shared objects that use C++ streams crash R if they're
> compiled using Macports' gcc43, but work fine if compiled in exactly
> the same way using Apple-supplied GCC 4.2. Has anyone here had the
> same issue/know what is causing this problem?
>
> Thanks,
>
> Ernest
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From simon.urbanek at r-project.org  Wed Jul 30 16:46:39 2008
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Wed, 30 Jul 2008 10:46:39 -0400
Subject: [Rd] R, Macports and C++ streams
In-Reply-To: <37E1D80F-D1CB-4B4B-80B1-DDBDB0EF43BD@ic.ac.uk>
References: <37E1D80F-D1CB-4B4B-80B1-DDBDB0EF43BD@ic.ac.uk>
Message-ID: <25AD1EB9-4E98-4DCB-8C36-43B1247121ED@r-project.org>


On Jul 30, 2008, at 9:45 , Ernest Turro wrote:

> Dear all,
>
> R on Macports relies on GCC 4.3 to build packages. I find that  
> packages with shared objects that use C++ streams crash R if they're  
> compiled using Macports' gcc43, but work fine if compiled in exactly  
> the same way using Apple-supplied GCC 4.2. Has anyone here had the  
> same issue/know what is causing this problem?
>

Using compilers from MacPorts and similar suites (Darwin ports, Fink  
etc.) is strongly discouraged (and outright not supported by the CRAN  
binary) since they have been known to be badly broken in the past and  
when whenever tested so far they were incomplete and incompatible. You  
have to re-compile R yourself with those tools (and you're entirely on  
your own) if you really want to use them. CRAN binaries work only with  
Apple's gcc branches, if you want to use anything else, you have to  
follow the unix R instructions and compile everything from sources.

Cheers,
Simon


From ernest.turro at ic.ac.uk  Wed Jul 30 18:32:51 2008
From: ernest.turro at ic.ac.uk (Ernest Turro)
Date: Wed, 30 Jul 2008 17:32:51 +0100
Subject: [Rd] R, Macports and C++ streams
In-Reply-To: <25AD1EB9-4E98-4DCB-8C36-43B1247121ED@r-project.org>
References: <37E1D80F-D1CB-4B4B-80B1-DDBDB0EF43BD@ic.ac.uk>
	<25AD1EB9-4E98-4DCB-8C36-43B1247121ED@r-project.org>
Message-ID: <33D233DE-7D1D-47E1-BC9C-5659A9C4D215@ic.ac.uk>


On 30 Jul 2008, at 15:46, Simon Urbanek wrote:

>
> On Jul 30, 2008, at 9:45 , Ernest Turro wrote:
>
>> Dear all,
>>
>> R on Macports relies on GCC 4.3 to build packages. I find that  
>> packages with shared objects that use C++ streams crash R if  
>> they're compiled using Macports' gcc43, but work fine if compiled  
>> in exactly the same way using Apple-supplied GCC 4.2. Has anyone  
>> here had the same issue/know what is causing this problem?
>>
>
> Using compilers from MacPorts and similar suites (Darwin ports, Fink  
> etc.) is strongly discouraged (and outright not supported by the  
> CRAN binary) since they have been known to be badly broken in the  
> past and when whenever tested so far they were incomplete and  
> incompatible. You have to re-compile R yourself with those tools  
> (and you're entirely on your own) if you really want to use them.  
> CRAN binaries work only with Apple's gcc branches, if you want to  
> use anything else, you have to follow the unix R instructions and  
> compile everything from sources.

Dear Kjell,

As you can see above, your R port on Macports appears to be broken and  
has a reputation of having been broken for a while. I for one have  
experienced odd problems as described above. To avoid further issues  
with unsuspecting Macports users, perhaps it would be good to pull the  
port from the repository until a decent level of reliability can be  
provided ?

Cheers,

Ernest

>
>
> Cheers,
> Simon
>


From ernest.turro at ic.ac.uk  Wed Jul 30 18:35:05 2008
From: ernest.turro at ic.ac.uk (Ernest Turro)
Date: Wed, 30 Jul 2008 17:35:05 +0100
Subject: [Rd] R, Macports and C++ streams
In-Reply-To: <D5AE68F5-E80A-4E84-8988-039A3DF3A97F@epfl.ch>
References: <37E1D80F-D1CB-4B4B-80B1-DDBDB0EF43BD@ic.ac.uk>
	<D5AE68F5-E80A-4E84-8988-039A3DF3A97F@epfl.ch>
Message-ID: <ABDBB235-09CB-44F3-AE1C-BC7AC9BBCFAF@ic.ac.uk>


On 30 Jul 2008, at 15:18, Kjell Konis wrote:

> I found this in Writing R Extensions:
>
> "Using C++ iostreams, as in this example, is best avoided. There is  
> no guarantee that the output will appear in the R console, and  
> indeed it will not on the R for Windows console. Use R code or the C  
> entry points (see Printing) for all I/O if at all possible."
>
> That is, use Rprintf() instead. The fact that your code works with  
> one version of gcc and not another can probably be chalked up to  
> coincidence.
>

The doc warns that the output to stdout using iostreams may not appear  
on the console, there is no indication that doing this may crash R  
(and this has never happened to me before). Certainly, the use of file  
streams (fstreams) should work just fine.

Ernest


> Kjell
>
> On Jul 30, 2008, at 3:45 PM, Ernest Turro wrote:
>
>> Dear all,
>>
>> R on Macports relies on GCC 4.3 to build packages. I find that
>> packages with shared objects that use C++ streams crash R if they're
>> compiled using Macports' gcc43, but work fine if compiled in exactly
>> the same way using Apple-supplied GCC 4.2. Has anyone here had the
>> same issue/know what is causing this problem?
>>
>> Thanks,
>>
>> Ernest
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From simon.urbanek at r-project.org  Wed Jul 30 18:58:06 2008
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Wed, 30 Jul 2008 12:58:06 -0400
Subject: [Rd] R, Macports and C++ streams
In-Reply-To: <ABDBB235-09CB-44F3-AE1C-BC7AC9BBCFAF@ic.ac.uk>
References: <37E1D80F-D1CB-4B4B-80B1-DDBDB0EF43BD@ic.ac.uk>
	<D5AE68F5-E80A-4E84-8988-039A3DF3A97F@epfl.ch>
	<ABDBB235-09CB-44F3-AE1C-BC7AC9BBCFAF@ic.ac.uk>
Message-ID: <52733F0E-88D3-4583-8FB9-816014FE0A47@r-project.org>


On Jul 30, 2008, at 12:35 , Ernest Turro wrote:

>
> On 30 Jul 2008, at 15:18, Kjell Konis wrote:
>
>> I found this in Writing R Extensions:
>>
>> "Using C++ iostreams, as in this example, is best avoided. There is  
>> no guarantee that the output will appear in the R console, and  
>> indeed it will not on the R for Windows console. Use R code or the  
>> C entry points (see Printing) for all I/O if at all possible."
>>
>> That is, use Rprintf() instead. The fact that your code works with  
>> one version of gcc and not another can probably be chalked up to  
>> coincidence.
>>
>
> The doc warns that the output to stdout using iostreams may not  
> appear on the console, there is no indication that doing this may  
> crash R (and this has never happened to me before). Certainly, the  
> use of file streams (fstreams) should work just fine.
>

FWIW I saw this problem when using mismatching compilers before (long  
time ago when we had to use FSF-built gcc because of bugs in Apple's  
gcc). Its likely cause is a combination of incompatible ABIs and  
libstdc++ mismatch. Note that Apple's gcc build script goes into great  
pains to not mess up system stdc++ because it's asking for trouble.

Cheers,
Simon


>
>
>
>> Kjell
>>
>> On Jul 30, 2008, at 3:45 PM, Ernest Turro wrote:
>>
>>> Dear all,
>>>
>>> R on Macports relies on GCC 4.3 to build packages. I find that
>>> packages with shared objects that use C++ streams crash R if they're
>>> compiled using Macports' gcc43, but work fine if compiled in exactly
>>> the same way using Apple-supplied GCC 4.2. Has anyone here had the
>>> same issue/know what is causing this problem?
>>>
>>> Thanks,
>>>
>>> Ernest
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From simon.urbanek at r-project.org  Wed Jul 30 19:04:39 2008
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Wed, 30 Jul 2008 13:04:39 -0400
Subject: [Rd] R, Macports and C++ streams
In-Reply-To: <33D233DE-7D1D-47E1-BC9C-5659A9C4D215@ic.ac.uk>
References: <37E1D80F-D1CB-4B4B-80B1-DDBDB0EF43BD@ic.ac.uk>
	<25AD1EB9-4E98-4DCB-8C36-43B1247121ED@r-project.org>
	<33D233DE-7D1D-47E1-BC9C-5659A9C4D215@ic.ac.uk>
Message-ID: <036A6389-49F3-47BB-A3A4-73E05D542897@r-project.org>


On Jul 30, 2008, at 12:32 , Ernest Turro wrote:

>
> On 30 Jul 2008, at 15:46, Simon Urbanek wrote:
>
>>
>> On Jul 30, 2008, at 9:45 , Ernest Turro wrote:
>>
>>> Dear all,
>>>
>>> R on Macports relies on GCC 4.3 to build packages. I find that  
>>> packages with shared objects that use C++ streams crash R if  
>>> they're compiled using Macports' gcc43, but work fine if compiled  
>>> in exactly the same way using Apple-supplied GCC 4.2. Has anyone  
>>> here had the same issue/know what is causing this problem?
>>>
>>
>> Using compilers from MacPorts and similar suites (Darwin ports,  
>> Fink etc.) is strongly discouraged (and outright not supported by  
>> the CRAN binary) since they have been known to be badly broken in  
>> the past and when whenever tested so far they were incomplete and  
>> incompatible. You have to re-compile R yourself with those tools  
>> (and you're entirely on your own) if you really want to use them.  
>> CRAN binaries work only with Apple's gcc branches, if you want to  
>> use anything else, you have to follow the unix R instructions and  
>> compile everything from sources.
>
> Dear Kjell,
>
> As you can see above, your R port on Macports appears to be broken  
> and has a reputation of having been broken for a while. I for one  
> have experienced odd problems as described above. To avoid further  
> issues with unsuspecting Macports users, perhaps it would be good to  
> pull the port from the repository until a decent level of  
> reliability can be provided ?
>

Although I do agree on your last point, I just want to clarify that I  
was talking about supported R for Mac setup (as provided in binary  
form on CRAN). Although it should be possible to build R with non- 
Apple gcc, but it must be done very carefully, because there are many  
dangers lurking in the interaction of system libraries with those from  
non-Apple tools. This has nothing to do with R, it's about knowledge  
how things work in OS X and it is very important when compilers are  
involved [unfortunately there are many binaries around from people  
that don't understand the intricacies of OS X well enough and think  
it's almost like a Linux box - I'm not talking about MacPorts in  
particular, it's just a general observation].

Cheers,
Simon


From ernest.turro at ic.ac.uk  Wed Jul 30 19:10:08 2008
From: ernest.turro at ic.ac.uk (Ernest Turro)
Date: Wed, 30 Jul 2008 18:10:08 +0100
Subject: [Rd] R, Macports and C++ streams
In-Reply-To: <52733F0E-88D3-4583-8FB9-816014FE0A47@r-project.org>
References: <37E1D80F-D1CB-4B4B-80B1-DDBDB0EF43BD@ic.ac.uk>
	<D5AE68F5-E80A-4E84-8988-039A3DF3A97F@epfl.ch>
	<ABDBB235-09CB-44F3-AE1C-BC7AC9BBCFAF@ic.ac.uk>
	<52733F0E-88D3-4583-8FB9-816014FE0A47@r-project.org>
Message-ID: <A8504049-3A5A-41F0-983F-222F049354A9@ic.ac.uk>


On 30 Jul 2008, at 17:58, Simon Urbanek wrote:

>
> On Jul 30, 2008, at 12:35 , Ernest Turro wrote:
>
>>
>> On 30 Jul 2008, at 15:18, Kjell Konis wrote:
>>
>>> I found this in Writing R Extensions:
>>>
>>> "Using C++ iostreams, as in this example, is best avoided. There  
>>> is no guarantee that the output will appear in the R console, and  
>>> indeed it will not on the R for Windows console. Use R code or the  
>>> C entry points (see Printing) for all I/O if at all possible."
>>>
>>> That is, use Rprintf() instead. The fact that your code works with  
>>> one version of gcc and not another can probably be chalked up to  
>>> coincidence.
>>>
>>
>> The doc warns that the output to stdout using iostreams may not  
>> appear on the console, there is no indication that doing this may  
>> crash R (and this has never happened to me before). Certainly, the  
>> use of file streams (fstreams) should work just fine.
>>
>
> FWIW I saw this problem when using mismatching compilers before  
> (long time ago when we had to use FSF-built gcc because of bugs in  
> Apple's gcc). Its likely cause is a combination of incompatible ABIs  
> and libstdc++ mismatch. Note that Apple's gcc build script goes into  
> great pains to not mess up system stdc++ because it's asking for  
> trouble.

Yes, this sounds like the most likely culprit. I guess, ultimately,  
Macports GCC maintainers should make sure their build script goes  
through the same hoops as Apple's to avoid this kind of mismatch  
problem with libstdc++. The best thing would be for the R port to  
depend on Apple-supplied gcc rather than the Macports gcc.

Cheers
Ernest


>
>
> Cheers,
> Simon
>
>
>>
>>
>>
>>> Kjell
>>>
>>> On Jul 30, 2008, at 3:45 PM, Ernest Turro wrote:
>>>
>>>> Dear all,
>>>>
>>>> R on Macports relies on GCC 4.3 to build packages. I find that
>>>> packages with shared objects that use C++ streams crash R if  
>>>> they're
>>>> compiled using Macports' gcc43, but work fine if compiled in  
>>>> exactly
>>>> the same way using Apple-supplied GCC 4.2. Has anyone here had the
>>>> same issue/know what is causing this problem?
>>>>
>>>> Thanks,
>>>>
>>>> Ernest
>>>>
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
>


From ernest.turro at ic.ac.uk  Wed Jul 30 19:16:21 2008
From: ernest.turro at ic.ac.uk (Ernest Turro)
Date: Wed, 30 Jul 2008 18:16:21 +0100
Subject: [Rd] R, Macports and C++ streams
In-Reply-To: <036A6389-49F3-47BB-A3A4-73E05D542897@r-project.org>
References: <37E1D80F-D1CB-4B4B-80B1-DDBDB0EF43BD@ic.ac.uk>
	<25AD1EB9-4E98-4DCB-8C36-43B1247121ED@r-project.org>
	<33D233DE-7D1D-47E1-BC9C-5659A9C4D215@ic.ac.uk>
	<036A6389-49F3-47BB-A3A4-73E05D542897@r-project.org>
Message-ID: <441C27EB-A93E-499D-BDD9-DD9645454123@ic.ac.uk>


On 30 Jul 2008, at 18:04, Simon Urbanek wrote:

>
> On Jul 30, 2008, at 12:32 , Ernest Turro wrote:
>
>>
>> On 30 Jul 2008, at 15:46, Simon Urbanek wrote:
>>
>>>
>>> On Jul 30, 2008, at 9:45 , Ernest Turro wrote:
>>>
>>>> Dear all,
>>>>
>>>> R on Macports relies on GCC 4.3 to build packages. I find that  
>>>> packages with shared objects that use C++ streams crash R if  
>>>> they're compiled using Macports' gcc43, but work fine if compiled  
>>>> in exactly the same way using Apple-supplied GCC 4.2. Has anyone  
>>>> here had the same issue/know what is causing this problem?
>>>>
>>>
>>> Using compilers from MacPorts and similar suites (Darwin ports,  
>>> Fink etc.) is strongly discouraged (and outright not supported by  
>>> the CRAN binary) since they have been known to be badly broken in  
>>> the past and when whenever tested so far they were incomplete and  
>>> incompatible. You have to re-compile R yourself with those tools  
>>> (and you're entirely on your own) if you really want to use them.  
>>> CRAN binaries work only with Apple's gcc branches, if you want to  
>>> use anything else, you have to follow the unix R instructions and  
>>> compile everything from sources.
>>
>> Dear Kjell,
>>
>> As you can see above, your R port on Macports appears to be broken  
>> and has a reputation of having been broken for a while. I for one  
>> have experienced odd problems as described above. To avoid further  
>> issues with unsuspecting Macports users, perhaps it would be good  
>> to pull the port from the repository until a decent level of  
>> reliability can be provided ?
>>
>
> Although I do agree on your last point, I just want to clarify that  
> I was talking about supported R for Mac setup (as provided in binary  
> form on CRAN).

Having installed the R binary for Mac, I've noticed that it uses  
Apple's default gcc 4.0.1. The problem with this is that there is no  
OpenMP support in gcc until version 4.2, which is available as a  
preview from apple on ADC. Changing gcc and g++ to gcc-4.2 and g++-4.2  
in the default Makeconf isn't quite enough, as R also needs to look in  
the appropriate header paths, etc...(e.g. to find omp.h). Could you  
recommend an easy way of getting a binary R installation to work with  
apple-supplied gcc 4.2 instead of 4.0 ?

Thanks,

Ernest



> Although it should be possible to build R with non-Apple gcc, but it  
> must be done very carefully, because there are many dangers lurking  
> in the interaction of system libraries with those from non-Apple  
> tools. This has nothing to do with R, it's about knowledge how  
> things work in OS X and it is very important when compilers are  
> involved [unfortunately there are many binaries around from people  
> that don't understand the intricacies of OS X well enough and think  
> it's almost like a Linux box - I'm not talking about MacPorts in  
> particular, it's just a general observation].
>
> Cheers,
> Simon
>
>


From simon.urbanek at r-project.org  Wed Jul 30 20:23:13 2008
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Wed, 30 Jul 2008 14:23:13 -0400
Subject: [Rd] R, Macports and C++ streams
In-Reply-To: <441C27EB-A93E-499D-BDD9-DD9645454123@ic.ac.uk>
References: <37E1D80F-D1CB-4B4B-80B1-DDBDB0EF43BD@ic.ac.uk>
	<25AD1EB9-4E98-4DCB-8C36-43B1247121ED@r-project.org>
	<33D233DE-7D1D-47E1-BC9C-5659A9C4D215@ic.ac.uk>
	<036A6389-49F3-47BB-A3A4-73E05D542897@r-project.org>
	<441C27EB-A93E-499D-BDD9-DD9645454123@ic.ac.uk>
Message-ID: <106C84A2-A236-42C0-9492-C1F395F9277C@r-project.org>


On Jul 30, 2008, at 13:16 , Ernest Turro wrote:

>
> On 30 Jul 2008, at 18:04, Simon Urbanek wrote:
>
>>
>> On Jul 30, 2008, at 12:32 , Ernest Turro wrote:
>>
>>>
>>> On 30 Jul 2008, at 15:46, Simon Urbanek wrote:
>>>
>>>>
>>>> On Jul 30, 2008, at 9:45 , Ernest Turro wrote:
>>>>
>>>>> Dear all,
>>>>>
>>>>> R on Macports relies on GCC 4.3 to build packages. I find that  
>>>>> packages with shared objects that use C++ streams crash R if  
>>>>> they're compiled using Macports' gcc43, but work fine if  
>>>>> compiled in exactly the same way using Apple-supplied GCC 4.2.  
>>>>> Has anyone here had the same issue/know what is causing this  
>>>>> problem?
>>>>>
>>>>
>>>> Using compilers from MacPorts and similar suites (Darwin ports,  
>>>> Fink etc.) is strongly discouraged (and outright not supported by  
>>>> the CRAN binary) since they have been known to be badly broken in  
>>>> the past and when whenever tested so far they were incomplete and  
>>>> incompatible. You have to re-compile R yourself with those tools  
>>>> (and you're entirely on your own) if you really want to use them.  
>>>> CRAN binaries work only with Apple's gcc branches, if you want to  
>>>> use anything else, you have to follow the unix R instructions and  
>>>> compile everything from sources.
>>>
>>> Dear Kjell,
>>>
>>> As you can see above, your R port on Macports appears to be broken  
>>> and has a reputation of having been broken for a while. I for one  
>>> have experienced odd problems as described above. To avoid further  
>>> issues with unsuspecting Macports users, perhaps it would be good  
>>> to pull the port from the repository until a decent level of  
>>> reliability can be provided ?
>>>
>>
>> Although I do agree on your last point, I just want to clarify that  
>> I was talking about supported R for Mac setup (as provided in  
>> binary form on CRAN).
>
> Having installed the R binary for Mac, I've noticed that it uses  
> Apple's default gcc 4.0.1.

That is not exactly true - it uses whatever your gcc version is. You  
can use Apple's gcc 4.0 or 4.2, they both work.


> The problem with this is that there is no OpenMP support in gcc  
> until version 4.2, which is available as a preview from apple on ADC.

FYI it's part of Xcode 3.1 ...


> Changing gcc and g++ to gcc-4.2 and g++-4.2 in the default Makeconf  
> isn't quite enough, as R also needs to look in the appropriate  
> header paths, etc...(e.g. to find omp.h). Could you recommend an  
> easy way of getting a binary R installation to work with apple- 
> supplied gcc 4.2 instead of 4.0 ?
>

I suspect you're confusing several separate issues here - the include  
paths for OMP have nothing to do with R, they are part of the gcc and  
as such added regardless of the include flags. Just try
gcc-4.2 omp.c -o omp -fopenmp
which specifies no include flags and works just fine.

The real issue here is that Apple doesn't provide gcc-4.2 support for  
Tiger, so you cannot use 10.4 SDK unless you also install the  
corresponding libraries. Hence you have two choices:
1) install gcc-4.2 libraries in 10.4u SDK
or
2) build for Leopard-only

As for 1) you can get just the SDK files for Tiger from
http://r.research.att.com/tools/
(you'll need to symlink darwin8 directory to darwin9)
As for 2) you can use the Leopard binaries from
http://r.research.att.com/

Cheers,
Simon


>
>> Although it should be possible to build R with non-Apple gcc, but  
>> it must be done very carefully, because there are many dangers  
>> lurking in the interaction of system libraries with those from non- 
>> Apple tools. This has nothing to do with R, it's about knowledge  
>> how things work in OS X and it is very important when compilers are  
>> involved [unfortunately there are many binaries around from people  
>> that don't understand the intricacies of OS X well enough and think  
>> it's almost like a Linux box - I'm not talking about MacPorts in  
>> particular, it's just a general observation].
>>
>> Cheers,
>> Simon
>>
>>
>
>


From ernest.turro at ic.ac.uk  Wed Jul 30 21:13:02 2008
From: ernest.turro at ic.ac.uk (Ernest Turro)
Date: Wed, 30 Jul 2008 20:13:02 +0100
Subject: [Rd] R, Macports and C++ streams
In-Reply-To: <106C84A2-A236-42C0-9492-C1F395F9277C@r-project.org>
References: <37E1D80F-D1CB-4B4B-80B1-DDBDB0EF43BD@ic.ac.uk>
	<25AD1EB9-4E98-4DCB-8C36-43B1247121ED@r-project.org>
	<33D233DE-7D1D-47E1-BC9C-5659A9C4D215@ic.ac.uk>
	<036A6389-49F3-47BB-A3A4-73E05D542897@r-project.org>
	<441C27EB-A93E-499D-BDD9-DD9645454123@ic.ac.uk>
	<106C84A2-A236-42C0-9492-C1F395F9277C@r-project.org>
Message-ID: <EE3F5C67-0D75-4020-9C8F-B57384F45E34@ic.ac.uk>


On 30 Jul 2008, at 19:23, Simon Urbanek wrote:

>
> On Jul 30, 2008, at 13:16 , Ernest Turro wrote:
>
>>
>> On 30 Jul 2008, at 18:04, Simon Urbanek wrote:
>>
>>>
>>> On Jul 30, 2008, at 12:32 , Ernest Turro wrote:
>>>
>>>>
>>>> On 30 Jul 2008, at 15:46, Simon Urbanek wrote:
>>>>
>>>>>
>>>>> On Jul 30, 2008, at 9:45 , Ernest Turro wrote:
>>>>>
>>>>>> Dear all,
>>>>>>
>>>>>> R on Macports relies on GCC 4.3 to build packages. I find that  
>>>>>> packages with shared objects that use C++ streams crash R if  
>>>>>> they're compiled using Macports' gcc43, but work fine if  
>>>>>> compiled in exactly the same way using Apple-supplied GCC 4.2.  
>>>>>> Has anyone here had the same issue/know what is causing this  
>>>>>> problem?
>>>>>>
>>>>>
>>>>> Using compilers from MacPorts and similar suites (Darwin ports,  
>>>>> Fink etc.) is strongly discouraged (and outright not supported  
>>>>> by the CRAN binary) since they have been known to be badly  
>>>>> broken in the past and when whenever tested so far they were  
>>>>> incomplete and incompatible. You have to re-compile R yourself  
>>>>> with those tools (and you're entirely on your own) if you really  
>>>>> want to use them. CRAN binaries work only with Apple's gcc  
>>>>> branches, if you want to use anything else, you have to follow  
>>>>> the unix R instructions and compile everything from sources.
>>>>
>>>> Dear Kjell,
>>>>
>>>> As you can see above, your R port on Macports appears to be  
>>>> broken and has a reputation of having been broken for a while. I  
>>>> for one have experienced odd problems as described above. To  
>>>> avoid further issues with unsuspecting Macports users, perhaps it  
>>>> would be good to pull the port from the repository until a decent  
>>>> level of reliability can be provided ?
>>>>
>>>
>>> Although I do agree on your last point, I just want to clarify  
>>> that I was talking about supported R for Mac setup (as provided in  
>>> binary form on CRAN).
>>
>> Having installed the R binary for Mac, I've noticed that it uses  
>> Apple's default gcc 4.0.1.
>
> That is not exactly true - it uses whatever your gcc version is. You  
> can use Apple's gcc 4.0 or 4.2, they both work.
>
>
>> The problem with this is that there is no OpenMP support in gcc  
>> until version 4.2, which is available as a preview from apple on ADC.
>
> FYI it's part of Xcode 3.1 ...
>
>
>> Changing gcc and g++ to gcc-4.2 and g++-4.2 in the default Makeconf  
>> isn't quite enough, as R also needs to look in the appropriate  
>> header paths, etc...(e.g. to find omp.h). Could you recommend an  
>> easy way of getting a binary R installation to work with apple- 
>> supplied gcc 4.2 instead of 4.0 ?
>>
>
> I suspect you're confusing several separate issues here - the  
> include paths for OMP have nothing to do with R, they are part of  
> the gcc and as such added regardless of the include flags. Just try
> gcc-4.2 omp.c -o omp -fopenmp
> which specifies no include flags and works just fine.
>
> The real issue here is that Apple doesn't provide gcc-4.2 support  
> for Tiger, so you cannot use 10.4 SDK unless you also install the  
> corresponding libraries. Hence you have two choices:
> 1) install gcc-4.2 libraries in 10.4u SDK
> or
> 2) build for Leopard-only


Thanks. I just realised that what was causing compilation to fail was  
the inclusion of the "-isysroot /Developer/SDKs/MacOSX10.4u.sdk" flag.

So now I have a package that compiles fine I think on most systems (I  
use the AC_OPENMP macro to check for openmp support, which it will  
generally not find on a Mac).

Leopard users wishing to use openmp must:

1) install apple-supplied gcc 4.2 (e.g. via Xcode 3.1)
2) replace gcc and g++ by gcc-4.2 and g++4.2 respectively in Makeconf  
(or create appropriate symlinks)
3) remove all instances of "-isysroot /Developer/SDKs/MacOSX10.4u.sdk"  
in Makeconf

I have found this to work on my system. But is this the easiest  
solution for Mac users wishing to use openmp in the package - or can  
you think of a way of avoiding 3) ?

Thanks for your help,

Ernest


>
>
> As for 1) you can get just the SDK files for Tiger from
> http://r.research.att.com/tools/
> (you'll need to symlink darwin8 directory to darwin9)
> As for 2) you can use the Leopard binaries from
> http://r.research.att.com/
>
> Cheers,
> Simon
>
>
>>
>>> Although it should be possible to build R with non-Apple gcc, but  
>>> it must be done very carefully, because there are many dangers  
>>> lurking in the interaction of system libraries with those from non- 
>>> Apple tools. This has nothing to do with R, it's about knowledge  
>>> how things work in OS X and it is very important when compilers  
>>> are involved [unfortunately there are many binaries around from  
>>> people that don't understand the intricacies of OS X well enough  
>>> and think it's almost like a Linux box - I'm not talking about  
>>> MacPorts in particular, it's just a general observation].
>>>
>>> Cheers,
>>> Simon
>>>
>>>
>>
>>
>


From simon.urbanek at r-project.org  Wed Jul 30 21:25:09 2008
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Wed, 30 Jul 2008 15:25:09 -0400
Subject: [Rd] R, Macports and C++ streams
In-Reply-To: <EE3F5C67-0D75-4020-9C8F-B57384F45E34@ic.ac.uk>
References: <37E1D80F-D1CB-4B4B-80B1-DDBDB0EF43BD@ic.ac.uk>
	<25AD1EB9-4E98-4DCB-8C36-43B1247121ED@r-project.org>
	<33D233DE-7D1D-47E1-BC9C-5659A9C4D215@ic.ac.uk>
	<036A6389-49F3-47BB-A3A4-73E05D542897@r-project.org>
	<441C27EB-A93E-499D-BDD9-DD9645454123@ic.ac.uk>
	<106C84A2-A236-42C0-9492-C1F395F9277C@r-project.org>
	<EE3F5C67-0D75-4020-9C8F-B57384F45E34@ic.ac.uk>
Message-ID: <03C26E85-D0BF-4671-93E9-7C4EF38E3EBC@r-project.org>


On Jul 30, 2008, at 15:13 , Ernest Turro wrote:

>
> On 30 Jul 2008, at 19:23, Simon Urbanek wrote:
>
>>
>> On Jul 30, 2008, at 13:16 , Ernest Turro wrote:
>>
>>>
>>> On 30 Jul 2008, at 18:04, Simon Urbanek wrote:
>>>
>>>>
>>>> On Jul 30, 2008, at 12:32 , Ernest Turro wrote:
>>>>
>>>>>
>>>>> On 30 Jul 2008, at 15:46, Simon Urbanek wrote:
>>>>>
>>>>>>
>>>>>> On Jul 30, 2008, at 9:45 , Ernest Turro wrote:
>>>>>>
>>>>>>> Dear all,
>>>>>>>
>>>>>>> R on Macports relies on GCC 4.3 to build packages. I find that  
>>>>>>> packages with shared objects that use C++ streams crash R if  
>>>>>>> they're compiled using Macports' gcc43, but work fine if  
>>>>>>> compiled in exactly the same way using Apple-supplied GCC 4.2.  
>>>>>>> Has anyone here had the same issue/know what is causing this  
>>>>>>> problem?
>>>>>>>
>>>>>>
>>>>>> Using compilers from MacPorts and similar suites (Darwin ports,  
>>>>>> Fink etc.) is strongly discouraged (and outright not supported  
>>>>>> by the CRAN binary) since they have been known to be badly  
>>>>>> broken in the past and when whenever tested so far they were  
>>>>>> incomplete and incompatible. You have to re-compile R yourself  
>>>>>> with those tools (and you're entirely on your own) if you  
>>>>>> really want to use them. CRAN binaries work only with Apple's  
>>>>>> gcc branches, if you want to use anything else, you have to  
>>>>>> follow the unix R instructions and compile everything from  
>>>>>> sources.
>>>>>
>>>>> Dear Kjell,
>>>>>
>>>>> As you can see above, your R port on Macports appears to be  
>>>>> broken and has a reputation of having been broken for a while. I  
>>>>> for one have experienced odd problems as described above. To  
>>>>> avoid further issues with unsuspecting Macports users, perhaps  
>>>>> it would be good to pull the port from the repository until a  
>>>>> decent level of reliability can be provided ?
>>>>>
>>>>
>>>> Although I do agree on your last point, I just want to clarify  
>>>> that I was talking about supported R for Mac setup (as provided  
>>>> in binary form on CRAN).
>>>
>>> Having installed the R binary for Mac, I've noticed that it uses  
>>> Apple's default gcc 4.0.1.
>>
>> That is not exactly true - it uses whatever your gcc version is.  
>> You can use Apple's gcc 4.0 or 4.2, they both work.
>>
>>
>>> The problem with this is that there is no OpenMP support in gcc  
>>> until version 4.2, which is available as a preview from apple on  
>>> ADC.
>>
>> FYI it's part of Xcode 3.1 ...
>>
>>
>>> Changing gcc and g++ to gcc-4.2 and g++-4.2 in the default  
>>> Makeconf isn't quite enough, as R also needs to look in the  
>>> appropriate header paths, etc...(e.g. to find omp.h). Could you  
>>> recommend an easy way of getting a binary R installation to work  
>>> with apple-supplied gcc 4.2 instead of 4.0 ?
>>>
>>
>> I suspect you're confusing several separate issues here - the  
>> include paths for OMP have nothing to do with R, they are part of  
>> the gcc and as such added regardless of the include flags. Just try
>> gcc-4.2 omp.c -o omp -fopenmp
>> which specifies no include flags and works just fine.
>>
>> The real issue here is that Apple doesn't provide gcc-4.2 support  
>> for Tiger, so you cannot use 10.4 SDK unless you also install the  
>> corresponding libraries. Hence you have two choices:
>> 1) install gcc-4.2 libraries in 10.4u SDK
>> or
>> 2) build for Leopard-only
>
>
> Thanks. I just realised that what was causing compilation to fail  
> was the inclusion of the "-isysroot /Developer/SDKs/MacOSX10.4u.sdk"  
> flag.
>

Yes, as I told you.


> So now I have a package that compiles fine I think on most systems  
> (I use the AC_OPENMP macro to check for openmp support, which it  
> will generally not find on a Mac).
>
> Leopard users wishing to use openmp must:
>
> 1) install apple-supplied gcc 4.2 (e.g. via Xcode 3.1)
> 2) replace gcc and g++ by gcc-4.2 and g++4.2 respectively in  
> Makeconf (or create appropriate symlinks)
> 3) remove all instances of "-isysroot /Developer/SDKs/ 
> MacOSX10.4u.sdk" in Makeconf
>
> I have found this to work on my system. But is this the easiest  
> solution for Mac users wishing to use openmp in the package - or can  
> you think of a way of avoiding 3) ?
>

The easiest solution is 2) in my previous e-mail (it uses gcc-4.2 by  
default and targets Leopard) and that's what you're forcing with your  
patches anyway.

Cheers,
Simon


>
>>
>> As for 1) you can get just the SDK files for Tiger from
>> http://r.research.att.com/tools/
>> (you'll need to symlink darwin8 directory to darwin9)
>> As for 2) you can use the Leopard binaries from
>> http://r.research.att.com/
>>
>> Cheers,
>> Simon
>>
>>
>>>
>>>> Although it should be possible to build R with non-Apple gcc, but  
>>>> it must be done very carefully, because there are many dangers  
>>>> lurking in the interaction of system libraries with those from  
>>>> non-Apple tools. This has nothing to do with R, it's about  
>>>> knowledge how things work in OS X and it is very important when  
>>>> compilers are involved [unfortunately there are many binaries  
>>>> around from people that don't understand the intricacies of OS X  
>>>> well enough and think it's almost like a Linux box - I'm not  
>>>> talking about MacPorts in particular, it's just a general  
>>>> observation].
>>>>
>>>> Cheers,
>>>> Simon
>>>>
>>>>
>>>
>>>
>>
>
>


From ernest.turro at ic.ac.uk  Wed Jul 30 21:30:50 2008
From: ernest.turro at ic.ac.uk (Ernest Turro)
Date: Wed, 30 Jul 2008 20:30:50 +0100
Subject: [Rd] R, Macports and C++ streams
In-Reply-To: <03C26E85-D0BF-4671-93E9-7C4EF38E3EBC@r-project.org>
References: <37E1D80F-D1CB-4B4B-80B1-DDBDB0EF43BD@ic.ac.uk>
	<25AD1EB9-4E98-4DCB-8C36-43B1247121ED@r-project.org>
	<33D233DE-7D1D-47E1-BC9C-5659A9C4D215@ic.ac.uk>
	<036A6389-49F3-47BB-A3A4-73E05D542897@r-project.org>
	<441C27EB-A93E-499D-BDD9-DD9645454123@ic.ac.uk>
	<106C84A2-A236-42C0-9492-C1F395F9277C@r-project.org>
	<EE3F5C67-0D75-4020-9C8F-B57384F45E34@ic.ac.uk>
	<03C26E85-D0BF-4671-93E9-7C4EF38E3EBC@r-project.org>
Message-ID: <0DD31B64-1187-42A7-BB1A-5A648A487051@ic.ac.uk>


On 30 Jul 2008, at 20:25, Simon Urbanek wrote:

>
> On Jul 30, 2008, at 15:13 , Ernest Turro wrote:
>
>>
>> On 30 Jul 2008, at 19:23, Simon Urbanek wrote:
>>
>>>
>>> On Jul 30, 2008, at 13:16 , Ernest Turro wrote:
>>>
>>>>
>>>> On 30 Jul 2008, at 18:04, Simon Urbanek wrote:
>>>>
>>>>>
>>>>> On Jul 30, 2008, at 12:32 , Ernest Turro wrote:
>>>>>
>>>>>>
>>>>>> On 30 Jul 2008, at 15:46, Simon Urbanek wrote:
>>>>>>
>>>>>>>
>>>>>>> On Jul 30, 2008, at 9:45 , Ernest Turro wrote:
>>>>>>>
>>>>>>>> Dear all,
>>>>>>>>
>>>>>>>> R on Macports relies on GCC 4.3 to build packages. I find  
>>>>>>>> that packages with shared objects that use C++ streams crash  
>>>>>>>> R if they're compiled using Macports' gcc43, but work fine if  
>>>>>>>> compiled in exactly the same way using Apple-supplied GCC  
>>>>>>>> 4.2. Has anyone here had the same issue/know what is causing  
>>>>>>>> this problem?
>>>>>>>>
>>>>>>>
>>>>>>> Using compilers from MacPorts and similar suites (Darwin  
>>>>>>> ports, Fink etc.) is strongly discouraged (and outright not  
>>>>>>> supported by the CRAN binary) since they have been known to be  
>>>>>>> badly broken in the past and when whenever tested so far they  
>>>>>>> were incomplete and incompatible. You have to re-compile R  
>>>>>>> yourself with those tools (and you're entirely on your own) if  
>>>>>>> you really want to use them. CRAN binaries work only with  
>>>>>>> Apple's gcc branches, if you want to use anything else, you  
>>>>>>> have to follow the unix R instructions and compile everything  
>>>>>>> from sources.
>>>>>>
>>>>>> Dear Kjell,
>>>>>>
>>>>>> As you can see above, your R port on Macports appears to be  
>>>>>> broken and has a reputation of having been broken for a while.  
>>>>>> I for one have experienced odd problems as described above. To  
>>>>>> avoid further issues with unsuspecting Macports users, perhaps  
>>>>>> it would be good to pull the port from the repository until a  
>>>>>> decent level of reliability can be provided ?
>>>>>>
>>>>>
>>>>> Although I do agree on your last point, I just want to clarify  
>>>>> that I was talking about supported R for Mac setup (as provided  
>>>>> in binary form on CRAN).
>>>>
>>>> Having installed the R binary for Mac, I've noticed that it uses  
>>>> Apple's default gcc 4.0.1.
>>>
>>> That is not exactly true - it uses whatever your gcc version is.  
>>> You can use Apple's gcc 4.0 or 4.2, they both work.
>>>
>>>
>>>> The problem with this is that there is no OpenMP support in gcc  
>>>> until version 4.2, which is available as a preview from apple on  
>>>> ADC.
>>>
>>> FYI it's part of Xcode 3.1 ...
>>>
>>>
>>>> Changing gcc and g++ to gcc-4.2 and g++-4.2 in the default  
>>>> Makeconf isn't quite enough, as R also needs to look in the  
>>>> appropriate header paths, etc...(e.g. to find omp.h). Could you  
>>>> recommend an easy way of getting a binary R installation to work  
>>>> with apple-supplied gcc 4.2 instead of 4.0 ?
>>>>
>>>
>>> I suspect you're confusing several separate issues here - the  
>>> include paths for OMP have nothing to do with R, they are part of  
>>> the gcc and as such added regardless of the include flags. Just try
>>> gcc-4.2 omp.c -o omp -fopenmp
>>> which specifies no include flags and works just fine.
>>>
>>> The real issue here is that Apple doesn't provide gcc-4.2 support  
>>> for Tiger, so you cannot use 10.4 SDK unless you also install the  
>>> corresponding libraries. Hence you have two choices:
>>> 1) install gcc-4.2 libraries in 10.4u SDK
>>> or
>>> 2) build for Leopard-only
>>
>>
>> Thanks. I just realised that what was causing compilation to fail  
>> was the inclusion of the "-isysroot /Developer/SDKs/ 
>> MacOSX10.4u.sdk" flag.
>>
>
> Yes, as I told you.
>
>
>> So now I have a package that compiles fine I think on most systems  
>> (I use the AC_OPENMP macro to check for openmp support, which it  
>> will generally not find on a Mac).
>>
>> Leopard users wishing to use openmp must:
>>
>> 1) install apple-supplied gcc 4.2 (e.g. via Xcode 3.1)
>> 2) replace gcc and g++ by gcc-4.2 and g++4.2 respectively in  
>> Makeconf (or create appropriate symlinks)
>> 3) remove all instances of "-isysroot /Developer/SDKs/ 
>> MacOSX10.4u.sdk" in Makeconf
>>
>> I have found this to work on my system. But is this the easiest  
>> solution for Mac users wishing to use openmp in the package - or  
>> can you think of a way of avoiding 3) ?
>>
>
> The easiest solution is 2) in my previous e-mail (it uses gcc-4.2 by  
> default and targets Leopard) and that's what you're forcing with  
> your patches anyway.

Could you please clarify how you go about building packages for  
Leopard-only without using my patches?

Thanks,
Ernest

>
>
> Cheers,
> Simon
>
>
>>
>>>
>>> As for 1) you can get just the SDK files for Tiger from
>>> http://r.research.att.com/tools/
>>> (you'll need to symlink darwin8 directory to darwin9)
>>> As for 2) you can use the Leopard binaries from
>>> http://r.research.att.com/
>>>
>>> Cheers,
>>> Simon
>>>
>>>
>>>>
>>>>> Although it should be possible to build R with non-Apple gcc,  
>>>>> but it must be done very carefully, because there are many  
>>>>> dangers lurking in the interaction of system libraries with  
>>>>> those from non-Apple tools. This has nothing to do with R, it's  
>>>>> about knowledge how things work in OS X and it is very important  
>>>>> when compilers are involved [unfortunately there are many  
>>>>> binaries around from people that don't understand the  
>>>>> intricacies of OS X well enough and think it's almost like a  
>>>>> Linux box - I'm not talking about MacPorts in particular, it's  
>>>>> just a general observation].
>>>>>
>>>>> Cheers,
>>>>> Simon
>>>>>
>>>>>
>>>>
>>>>
>>>
>>
>>
>


From ggrothendieck at gmail.com  Thu Jul 31 01:41:48 2008
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Wed, 30 Jul 2008 19:41:48 -0400
Subject: [Rd] Name clashes among packages
Message-ID: <971536df0807301641g58fa155eo5faae388d862b50a@mail.gmail.com>

To handle name clashes among packages I wonder if we could
have a namespace setting between exported and not-exported
which is exported but you have to use :: (two dots) to access its
objects.  The difference between mandatory two dot and
three dots in this case is that the
exported objects are intended to be accessed whereas the
three dot ones are not and it may be important to retain
that distinction even though you have to explicitly preface both.

If the package uses this intermediate form of exporting then
it could be guaranteed that there are no name clashes.

Perhaps it should be possible to specify this on an object by object
basis within the package.

This could be useful for larger projects made up of many packages.
Of course one can already just have the convention that one uses
two dots to access package objects but this would enforce it for
certain packages and allow those package to avoid the annoying
name clash warnings when loaded.


From ripley at stats.ox.ac.uk  Thu Jul 31 09:36:22 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 31 Jul 2008 08:36:22 +0100 (BST)
Subject: [Rd] sapply(Date, is.numeric)
In-Reply-To: <18576.26736.142076.965510@stat.math.ethz.ch>
References: <EEBC169715EB8C438D3C9283AF0F201C023E47B4@MSGBOSCLM2WIN.DMN1.FMR.COM>
	<18576.11368.858281.462289@stat.math.ethz.ch>
	<alpine.LFD.1.10.0807301248250.24325@auk.stats.ox.ac.uk>
	<18576.26736.142076.965510@stat.math.ethz.ch>
Message-ID: <alpine.LFD.1.10.0807310830110.10523@gannet.stats.ox.ac.uk>

I've now committed fixes in R-patched and R-devel.

There is one consequence: data.matrix() was testing for numeric columns by 
unlist(lapply(x, is.numeric)) and so incorrectly treating Date and POSIXct 
columns as numeric (which we had decided they were not).  This affects 
package gvlma.

data.matrix() is now working as documented, but as we have an exception 
for factors, do we also want exceptions for Date and POSIXct?

On Wed, 30 Jul 2008, Martin Maechler wrote:

>>>>>> "BDR" == Prof Brian Ripley <ripley at stats.ox.ac.uk>
>>>>>>     on Wed, 30 Jul 2008 13:29:38 +0100 (BST) writes:
>
>    BDR> On Wed, 30 Jul 2008, Martin Maechler wrote:
>    >>>>>>> "RobMcG" == McGehee, Robert <Robert.McGehee at geodecapital.com>
>    >>>>>>> on Tue, 29 Jul 2008 15:40:37 -0400 writes:
>    >>
>    RobMcG> FYI,
>    RobMcG> I've tried posting the below message twice to the bug tracking system,
>    >>
>    >> [....... r-bugs problems discussed in a separate thread ....]
>    >>
>    >>
>    >>
>    RobMcG> R-developers,
>    RobMcG> The results below are inconsistent. From the documentation for
>    RobMcG> is.numeric, I expect FALSE in both cases.
>    >>
>    >> >> x <- data.frame(dt=Sys.Date())
>    >> >> is.numeric(x$dt)
>    RobMcG> [1] FALSE
>    >> >> sapply(x, is.numeric)
>    RobMcG> dt
>    RobMcG> TRUE
>    >>
>    RobMcG> ## Yet, sapply seems aware of the Date class
>    >> >> sapply(x, class)
>    RobMcG> dt
>    RobMcG> "Date"
>    >>
>    >> Yes, thanks a lot, Robert, for the report.
>    >>
>    >> That *is* a bug somewhere in the .Internal(lapply(...)) C code,
>    >> when S3 dispatch of primitive functions should happen.
>
>    BDR> The bug is in do_is, which uses CHAR(PRINTNAME(CAR(call))), and when
>    BDR> called from lapply that gives "FUN" not "is.numeric".  The root cause is
>    BDR> the following comment
>
>    BDR> FUN = CADR(args);  /* must be unevaluated for use in e.g. bquote */
>
>    BDR> and hence that the function in the *call* passed to do_is can be
>    BDR> unevaluated.
>
> aah!  I see.
>
>    >> Here's an R scriptlet exposing a 2nd example
>    >>
>    >> ### lapply(list, FUN)
>    >> ### ------------------ seems to sometimes fail for
>    >> ### .Primitive S3-generic functions
>    >>
>    >> (ds <- seq(from=Sys.Date(), by=1, length=4))
>    >> ##[1] "2008-07-30" "2008-07-31" "2008-08-01" "2008-08-02"
>    >> ll <- list(d=ds)
>    >> lapply(list(d=ds), round)
>    >> ## -> Error in lapply(list(d = ds), round) : dispatch error
>
>
>    BDR> And that's a separate issue, in DispatchGroup which states that arguments
>    BDR> have been evaluated (true) but the 'call' from lapply gives the
>    BDR> unevaluated arguments and so there is a mismatch.
>
> yes, I too found that this was a separate issue, the latter
> one being new since version 2.7.0
>
>    BDR> I'm testing fixes for both.
>
> Excellent!
> Martin
>
>
>    >> ## or -- related to bug report by Robert McGehee on R-devel, on 2008-07-29:
>    >> sapply(list(d=ds), is.numeric)
>    >> ## TRUE
>    >>
>    >> ## in spite of
>    >> is.numeric(`[[`(ll,1)) ## FALSE , because of
>    >> is.numeric.date
>    >>
>    >> ## or
>    >> round(`[[`(ll,1))
>    >> ## [1] "2008-07-30" "2008-07-31" "2008-08-01" "2008-08-02"
>    >>
>    >> ##-----------------------------
>    >>
>    >> But I'm currently too much tied up with other duties,
>    >> to find and test bug-fix.
>    >>
>    >> Martin Maechler, ETH Zurich and R-Core Team
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From maechler at stat.math.ethz.ch  Thu Jul 31 10:13:45 2008
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Thu, 31 Jul 2008 10:13:45 +0200
Subject: [Rd] sapply(Date, is.numeric)
In-Reply-To: <alpine.LFD.1.10.0807310830110.10523@gannet.stats.ox.ac.uk>
References: <EEBC169715EB8C438D3C9283AF0F201C023E47B4@MSGBOSCLM2WIN.DMN1.FMR.COM>
	<18576.11368.858281.462289@stat.math.ethz.ch>
	<alpine.LFD.1.10.0807301248250.24325@auk.stats.ox.ac.uk>
	<18576.26736.142076.965510@stat.math.ethz.ch>
	<alpine.LFD.1.10.0807310830110.10523@gannet.stats.ox.ac.uk>
Message-ID: <18577.29753.76571.661140@stat.math.ethz.ch>

>>>>> "PBR" == Prof Brian Ripley <ripley at stats.ox.ac.uk>
>>>>>     on Thu, 31 Jul 2008 08:36:22 +0100 (BST) writes:

    PBR> I've now committed fixes in R-patched and R-devel.
    PBR> There is one consequence: data.matrix() was testing for numeric columns by 
    PBR> unlist(lapply(x, is.numeric)) and so incorrectly treating Date and POSIXct 
    PBR> columns as numeric (which we had decided they were not).  This affects 
    PBR> package gvlma.

    PBR> data.matrix() is now working as documented, but as we have an exception 
    PBR> for factors, do we also want exceptions for Date and POSIXct?

Yes, that's a good idea, and much in the spirit of
data.matrix()
as I have understood it.

Note the following from  help(data.matrix)

where I think the 'Title' and 'Description' are more liberal
(rightly so) than 'Details' :

 >> Convert a Data Frame to a Numeric Matrix
 >> 
 >> Description:
 >> 
 >>      Return the matrix obtained by converting all the variables in a
 >>      data frame to numeric mode and then binding them together as the
 >>      columns of a matrix.  Factors and ordered factors are replaced by
 >>      their internal codes.

     [...........]

 >> Details:
 >> 
 >>      Supplying a data frame with columns which are not numeric, factor
 >>      or logical is an error.  A warning is given if any non-factor
 >>      column has a class, as then information can be lost.


Do we really have good reasons to give an error if a column is
not numeric (nor of the "exception class")?

Couldn't we just   lapply(., as.numeric)
and if that doesn't give errors 
just "be happy" ?

Martin


    PBR> On Wed, 30 Jul 2008, Martin Maechler wrote:

    >>>>>>> "BDR" == Prof Brian Ripley <ripley at stats.ox.ac.uk>
    >>>>>>> on Wed, 30 Jul 2008 13:29:38 +0100 (BST) writes:
    >> 
    BDR> On Wed, 30 Jul 2008, Martin Maechler wrote:
    >> >>>>>>> "RobMcG" == McGehee, Robert <Robert.McGehee at geodecapital.com>
    >> >>>>>>> on Tue, 29 Jul 2008 15:40:37 -0400 writes:
    >> >>
    RobMcG> FYI,
    RobMcG> I've tried posting the below message twice to the bug tracking system,
    >> >>
    >> >> [....... r-bugs problems discussed in a separate thread ....]
    >> >>
    >> >>
    >> >>
    RobMcG> R-developers,
    RobMcG> The results below are inconsistent. From the documentation for
    RobMcG> is.numeric, I expect FALSE in both cases.
    >> >>
    >> >> >> x <- data.frame(dt=Sys.Date())
    >> >> >> is.numeric(x$dt)
    RobMcG> [1] FALSE
    >> >> >> sapply(x, is.numeric)
    RobMcG> dt
    RobMcG> TRUE
    >> >>
    RobMcG> ## Yet, sapply seems aware of the Date class
    >> >> >> sapply(x, class)
    RobMcG> dt
    RobMcG> "Date"
    >> >>
    >> >> Yes, thanks a lot, Robert, for the report.
    >> >>
    >> >> That *is* a bug somewhere in the .Internal(lapply(...)) C code,
    >> >> when S3 dispatch of primitive functions should happen.
    >> 
    BDR> The bug is in do_is, which uses CHAR(PRINTNAME(CAR(call))), and when
    BDR> called from lapply that gives "FUN" not "is.numeric".  The root cause is
    BDR> the following comment
    >> 
    BDR> FUN = CADR(args);  /* must be unevaluated for use in e.g. bquote */
    >> 
    BDR> and hence that the function in the *call* passed to do_is can be
    BDR> unevaluated.
    >> 
    >> aah!  I see.
    >> 
    >> >> Here's an R scriptlet exposing a 2nd example
    >> >>
    >> >> ### lapply(list, FUN)
    >> >> ### ------------------ seems to sometimes fail for
    >> >> ### .Primitive S3-generic functions
    >> >>
    >> >> (ds <- seq(from=Sys.Date(), by=1, length=4))
    >> >> ##[1] "2008-07-30" "2008-07-31" "2008-08-01" "2008-08-02"
    >> >> ll <- list(d=ds)
    >> >> lapply(list(d=ds), round)
    >> >> ## -> Error in lapply(list(d = ds), round) : dispatch error
    >> 
    >> 
    BDR> And that's a separate issue, in DispatchGroup which states that arguments
    BDR> have been evaluated (true) but the 'call' from lapply gives the
    BDR> unevaluated arguments and so there is a mismatch.
    >> 
    >> yes, I too found that this was a separate issue, the latter
    >> one being new since version 2.7.0
    >> 
    BDR> I'm testing fixes for both.
    >> 
    >> Excellent!
    >> Martin
    >> 
    >> 
    >> >> ## or -- related to bug report by Robert McGehee on R-devel, on 2008-07-29:
    >> >> sapply(list(d=ds), is.numeric)
    >> >> ## TRUE
    >> >>
    >> >> ## in spite of
    >> >> is.numeric(`[[`(ll,1)) ## FALSE , because of
    >> >> is.numeric.date
    >> >>
    >> >> ## or
    >> >> round(`[[`(ll,1))
    >> >> ## [1] "2008-07-30" "2008-07-31" "2008-08-01" "2008-08-02"
    >> >>
    >> >> ##-----------------------------
    >> >>
    >> >> But I'm currently too much tied up with other duties,
    >> >> to find and test bug-fix.
    >> >>
    >> >> Martin Maechler, ETH Zurich and R-Core Team
    >> 
    >> ______________________________________________
    >> R-devel at r-project.org mailing list
    >> https://stat.ethz.ch/mailman/listinfo/r-devel
    >> 

    PBR> -- 
    PBR> Brian D. Ripley,                  ripley at stats.ox.ac.uk
    PBR> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
    PBR> University of Oxford,             Tel:  +44 1865 272861 (self)
    PBR> 1 South Parks Road,                     +44 1865 272866 (PA)
    PBR> Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From kjell.konis at epfl.ch  Thu Jul 31 11:29:07 2008
From: kjell.konis at epfl.ch (Kjell Konis)
Date: Thu, 31 Jul 2008 11:29:07 +0200
Subject: [Rd] R, Macports and C++ streams
In-Reply-To: <33D233DE-7D1D-47E1-BC9C-5659A9C4D215@ic.ac.uk>
References: <37E1D80F-D1CB-4B4B-80B1-DDBDB0EF43BD@ic.ac.uk>
	<25AD1EB9-4E98-4DCB-8C36-43B1247121ED@r-project.org>
	<33D233DE-7D1D-47E1-BC9C-5659A9C4D215@ic.ac.uk>
Message-ID: <B64D9294-A28D-4CFA-B15D-9E770CD9972F@epfl.ch>

Ernest,

Is it possible to provide a reproducible example of your crash?

Kjell


On Jul 30, 2008, at 6:32 PM, Ernest Turro wrote:

>
> On 30 Jul 2008, at 15:46, Simon Urbanek wrote:
>
>>
>> On Jul 30, 2008, at 9:45 , Ernest Turro wrote:
>>
>>> Dear all,
>>>
>>> R on Macports relies on GCC 4.3 to build packages. I find that
>>> packages with shared objects that use C++ streams crash R if
>>> they're compiled using Macports' gcc43, but work fine if compiled
>>> in exactly the same way using Apple-supplied GCC 4.2. Has anyone
>>> here had the same issue/know what is causing this problem?
>>>
>>
>> Using compilers from MacPorts and similar suites (Darwin ports, Fink
>> etc.) is strongly discouraged (and outright not supported by the
>> CRAN binary) since they have been known to be badly broken in the
>> past and when whenever tested so far they were incomplete and
>> incompatible. You have to re-compile R yourself with those tools
>> (and you're entirely on your own) if you really want to use them.
>> CRAN binaries work only with Apple's gcc branches, if you want to
>> use anything else, you have to follow the unix R instructions and
>> compile everything from sources.
>
> Dear Kjell,
>
> As you can see above, your R port on Macports appears to be broken and
> has a reputation of having been broken for a while. I for one have
> experienced odd problems as described above. To avoid further issues
> with unsuspecting Macports users, perhaps it would be good to pull the
> port from the repository until a decent level of reliability can be
> provided ?
>
> Cheers,
>
> Ernest
>
>>
>>
>> Cheers,
>> Simon
>>
>


From rpeng at jhsph.edu  Thu Jul 31 15:35:08 2008
From: rpeng at jhsph.edu (Roger D. Peng)
Date: Thu, 31 Jul 2008 09:35:08 -0400
Subject: [Rd] C versions of serialize/unserialize in packages
Message-ID: <66f3bd910807310635k19c9379dve8f44998ebc164f7@mail.gmail.com>

Are the functions 'R_Unserialize' and 'R_InitFileInPStream' allowed to
be used in R packages?  I guess I'm just not clear on the implications
of this comment in 'Rinternals.h':

/* The connection interface is not yet available to packages.  To
   allow limited use of connection pointers this defines the opaque
   pointer type. */

I have a function in the 'filehash' package that unserializes a bunch
of objects from a file and it seems to run much faster in C than in R.
 But I don't want to release something that uses a non-public
function/interface.

Thanks,
-roger
-- 
Roger D. Peng | http://www.biostat.jhsph.edu/~rpeng/


From hb at stat.berkeley.edu  Thu Jul 31 16:53:17 2008
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Thu, 31 Jul 2008 07:53:17 -0700
Subject: [Rd] C versions of serialize/unserialize in packages
In-Reply-To: <66f3bd910807310635k19c9379dve8f44998ebc164f7@mail.gmail.com>
References: <66f3bd910807310635k19c9379dve8f44998ebc164f7@mail.gmail.com>
Message-ID: <59d7961d0807310753r6395a4c4p38f20a885d8c8581@mail.gmail.com>

Hi,

On Thu, Jul 31, 2008 at 6:35 AM, Roger D. Peng <rpeng at jhsph.edu> wrote:
> Are the functions 'R_Unserialize' and 'R_InitFileInPStream' allowed to
> be used in R packages?  I guess I'm just not clear on the implications
> of this comment in 'Rinternals.h':
>
> /* The connection interface is not yet available to packages.  To
>   allow limited use of connection pointers this defines the opaque
>   pointer type. */
>
> I have a function in the 'filehash' package that unserializes a bunch
> of objects from a file and it seems to run much faster in C than in R.
>  But I don't want to release something that uses a non-public
> function/interface.

You say "much faster".  Could this be related to what I recently observed:

July 24, 2008 thread '[Rd] serialize() to via temporary file is heaps
faster than doing it directly (on Windows)' [
https://stat.ethz.ch/pipermail/r-devel/2008-July/050256.html ].

My $0.02

/Henrik


>
> Thanks,
> -roger
> --
> Roger D. Peng | http://www.biostat.jhsph.edu/~rpeng/
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From rpeng at jhsph.edu  Thu Jul 31 17:17:55 2008
From: rpeng at jhsph.edu (Roger D. Peng)
Date: Thu, 31 Jul 2008 11:17:55 -0400
Subject: [Rd] C versions of serialize/unserialize in packages
In-Reply-To: <59d7961d0807310753r6395a4c4p38f20a885d8c8581@mail.gmail.com>
References: <66f3bd910807310635k19c9379dve8f44998ebc164f7@mail.gmail.com>
	<59d7961d0807310753r6395a4c4p38f20a885d8c8581@mail.gmail.com>
Message-ID: <66f3bd910807310817k41c970d7u7b1f3c0959f5c7d6@mail.gmail.com>

Hmm...I don't think so.  The function I'm talking about loops over a
file many times and does a lot of 'seeks'.  I think just implementing
the loop in C makes it faster.  And besides, I see the speedup on
Linux, which doesn't have the problem you mention.

-roger

On Thu, Jul 31, 2008 at 10:53 AM, Henrik Bengtsson <hb at stat.berkeley.edu> wrote:
> Hi,
>
> On Thu, Jul 31, 2008 at 6:35 AM, Roger D. Peng <rpeng at jhsph.edu> wrote:
>> Are the functions 'R_Unserialize' and 'R_InitFileInPStream' allowed to
>> be used in R packages?  I guess I'm just not clear on the implications
>> of this comment in 'Rinternals.h':
>>
>> /* The connection interface is not yet available to packages.  To
>>   allow limited use of connection pointers this defines the opaque
>>   pointer type. */
>>
>> I have a function in the 'filehash' package that unserializes a bunch
>> of objects from a file and it seems to run much faster in C than in R.
>>  But I don't want to release something that uses a non-public
>> function/interface.
>
> You say "much faster".  Could this be related to what I recently observed:
>
> July 24, 2008 thread '[Rd] serialize() to via temporary file is heaps
> faster than doing it directly (on Windows)' [
> https://stat.ethz.ch/pipermail/r-devel/2008-July/050256.html ].
>
> My $0.02
>
> /Henrik
>
>
>>
>> Thanks,
>> -roger
>> --
>> Roger D. Peng | http://www.biostat.jhsph.edu/~rpeng/
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>



-- 
Roger D. Peng | http://www.biostat.jhsph.edu/~rpeng/


From ripley at stats.ox.ac.uk  Thu Jul 31 17:43:32 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 31 Jul 2008 16:43:32 +0100 (BST)
Subject: [Rd] C versions of serialize/unserialize in packages
In-Reply-To: <66f3bd910807310635k19c9379dve8f44998ebc164f7@mail.gmail.com>
References: <66f3bd910807310635k19c9379dve8f44998ebc164f7@mail.gmail.com>
Message-ID: <alpine.LFD.1.10.0807311623390.654@gannet.stats.ox.ac.uk>

On Thu, 31 Jul 2008, Roger D. Peng wrote:

> Are the functions 'R_Unserialize' and 'R_InitFileInPStream' allowed to
> be used in R packages?  I guess I'm just not clear on the implications
> of this comment in 'Rinternals.h':
>
> /* The connection interface is not yet available to packages.  To
>   allow limited use of connection pointers this defines the opaque
>   pointer type. */

It applies to R_InitFile(In|Out)PStream only, and is conditionalized by
NEED_CONNECTION_PSTREAMS.  You can't create a Rconnection pointer in your 
own C code in a public way.  (The 'yet' has been there for nearly 7 
years.)

So what you are asking about is outside the conditional for that comment.


> I have a function in the 'filehash' package that unserializes a bunch
> of objects from a file and it seems to run much faster in C than in R.
> But I don't want to release something that uses a non-public
> function/interface.
>
> Thanks,
> -roger
> -- 
> Roger D. Peng | http://www.biostat.jhsph.edu/~rpeng/
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ernest.turro at ic.ac.uk  Thu Jul 31 20:16:33 2008
From: ernest.turro at ic.ac.uk (Ernest Turro)
Date: Thu, 31 Jul 2008 19:16:33 +0100
Subject: [Rd] R, Macports and C++ streams
In-Reply-To: <B64D9294-A28D-4CFA-B15D-9E770CD9972F@epfl.ch>
References: <37E1D80F-D1CB-4B4B-80B1-DDBDB0EF43BD@ic.ac.uk>
	<25AD1EB9-4E98-4DCB-8C36-43B1247121ED@r-project.org>
	<33D233DE-7D1D-47E1-BC9C-5659A9C4D215@ic.ac.uk>
	<B64D9294-A28D-4CFA-B15D-9E770CD9972F@epfl.ch>
Message-ID: <29961D22-48E5-4F57-B704-0C81B17F350B@ic.ac.uk>


On 31 Jul 2008, at 10:29, Kjell Konis wrote:

> Ernest,
>
> Is it possible to provide a reproducible example of your crash?

Yes. R on macports depends on gcc43, which is causing the problems.  
The best thing would be to make the port not depend on gcc43, and  
instead depend on apple-supplied gcc (if this is possible).  
Alternatively, the macports gcc43 build script should be fixed (e.g.  
by looking at Apple's script, if available). Reproducible example:

Download and install gcc43 from Macports

cat - > foo.txt
Blah
Blah
^D

cat - > foo.cc
#include <stdio.h>
#include <fstream>
extern "C" {
   void foo() {
     char bar;
     std::ifstream ifs("foo.txt");
     std::ofstream ofs("foo2.txt");
     ifs >> bar;
     ofs << bar;
   }
}
^D

cat - > foo.R
dyn.load("foo.so")
.C("foo")
^D

# Crash:
g++-mp-4.3 -shared -fPIC foo.cc -o foo.so
R --vanilla < foo.R

# Don't crash:
g++-4.2 -shared -fPIC foo.cc -o foo.so
R --vanilla < foo.R



>
>
> Kjell
>
>
> On Jul 30, 2008, at 6:32 PM, Ernest Turro wrote:
>
>>
>> On 30 Jul 2008, at 15:46, Simon Urbanek wrote:
>>
>>>
>>> On Jul 30, 2008, at 9:45 , Ernest Turro wrote:
>>>
>>>> Dear all,
>>>>
>>>> R on Macports relies on GCC 4.3 to build packages. I find that
>>>> packages with shared objects that use C++ streams crash R if
>>>> they're compiled using Macports' gcc43, but work fine if compiled
>>>> in exactly the same way using Apple-supplied GCC 4.2. Has anyone
>>>> here had the same issue/know what is causing this problem?
>>>>
>>>
>>> Using compilers from MacPorts and similar suites (Darwin ports, Fink
>>> etc.) is strongly discouraged (and outright not supported by the
>>> CRAN binary) since they have been known to be badly broken in the
>>> past and when whenever tested so far they were incomplete and
>>> incompatible. You have to re-compile R yourself with those tools
>>> (and you're entirely on your own) if you really want to use them.
>>> CRAN binaries work only with Apple's gcc branches, if you want to
>>> use anything else, you have to follow the unix R instructions and
>>> compile everything from sources.
>>
>> Dear Kjell,
>>
>> As you can see above, your R port on Macports appears to be broken  
>> and
>> has a reputation of having been broken for a while. I for one have
>> experienced odd problems as described above. To avoid further issues
>> with unsuspecting Macports users, perhaps it would be good to pull  
>> the
>> port from the repository until a decent level of reliability can be
>> provided ?
>>
>> Cheers,
>>
>> Ernest
>>
>>>
>>>
>>> Cheers,
>>> Simon
>>>
>>
>


From ripley at stats.ox.ac.uk  Thu Jul 31 20:39:14 2008
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 31 Jul 2008 19:39:14 +0100 (BST)
Subject: [Rd] C versions of serialize/unserialize in packages
In-Reply-To: <alpine.LFD.1.10.0807311623390.654@gannet.stats.ox.ac.uk>
References: <66f3bd910807310635k19c9379dve8f44998ebc164f7@mail.gmail.com>
	<alpine.LFD.1.10.0807311623390.654@gannet.stats.ox.ac.uk>
Message-ID: <alpine.LFD.1.10.0807311938310.26279@gannet.stats.ox.ac.uk>

On Thu, 31 Jul 2008, Prof Brian Ripley wrote:

> On Thu, 31 Jul 2008, Roger D. Peng wrote:
>
>> Are the functions 'R_Unserialize' and 'R_InitFileInPStream' allowed to
>> be used in R packages?  I guess I'm just not clear on the implications
>> of this comment in 'Rinternals.h':
>> 
>> /* The connection interface is not yet available to packages.  To
>>   allow limited use of connection pointers this defines the opaque
>>   pointer type. */
>
> It applies to R_InitFile(In|Out)PStream only, and is conditionalized by
> NEED_CONNECTION_PSTREAMS.  You can't create a Rconnection pointer in your own 
> C code in a public way.  (The 'yet' has been there for nearly 7 years.)

Sorry the cut-and-paste went wrong: R_InitConn(In|Out)PStream only.

>
> So what you are asking about is outside the conditional for that comment.
>
>
>> I have a function in the 'filehash' package that unserializes a bunch
>> of objects from a file and it seems to run much faster in C than in R.
>> But I don't want to release something that uses a non-public
>> function/interface.
>> 
>> Thanks,
>> -roger
>> -- 
>> Roger D. Peng | http://www.biostat.jhsph.edu/~rpeng/
>> 
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>> 
>
> -- 
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


