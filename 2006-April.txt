From scp at predict.com  Sat Apr  1 08:31:35 2006
From: scp at predict.com (Stephen C. Pope)
Date: Fri, 31 Mar 2006 23:31:35 -0700
Subject: [Rd] Sys.sleep() burns up CPU on Solaris 8
Message-ID: <200604010631.k316Vpex003171@gaea2.predict.com>

I noticed that R was burning up 100% of a CPU when a call to Sys.sleep() 
was made. Upon investigation, I discovered that R_checkActivityEx() in 
src/unix/sys-std.c was putting the entire timeout (in usec) into the 
struct timeval tv_usec member, leaving tv_sec set to 0.

I don't know about other unix variants, but Solaris requires that the 
timeout value be normalized (i.e. 0 <= tv_usec < 1000000). Because a 
value greater than 1000000 was being placed in tv_usec, select() was 
returning an error (EINVAL) immediately, causing R_checkActivityEx() to 
return immediately. This caused do_syssleep() to loop continuously until 
the desired elapsed time had evolved. A rather sleepless sleep ;-).

The following patch against R-2.2.1 fixes the problem. Note that the 
test of the return value for R_SelectEx() was also incorrect; although 
harmless, it was treating the error return (-1) as a successful return.

stephen pope
scp at predict.com


Here's the patch.

build_main at mambo:/vobs/products/R> gdiff -ub src/unix/sys-std.c@@/main/3 
src/unix/sys-std.c
--- src/unix/sys-std.c@@/main/3 Thu Jan 12 11:39:55 2006
+++ src/unix/sys-std.c  Fri Mar 31 23:12:16 2006
@@ -294,13 +294,13 @@
         else onintr();
      }

-    tv.tv_sec = 0;
-    tv.tv_usec = usec;
+    tv.tv_sec = usec/1000000;
+    tv.tv_usec = usec % 1000000;
      maxfd = setSelectMask(R_InputHandlers, &readMask);
      if (ignore_stdin)
         FD_CLR(fileno(stdin), &readMask);
      if (R_SelectEx(maxfd+1, &readMask, NULL, NULL,
-                  (usec >= 0) ? &tv : NULL, intr))
+                   (usec >= 0) ? &tv : NULL, intr) > 0)
         return(&readMask);
      else
         return(NULL);


From ripley at stats.ox.ac.uk  Sat Apr  1 08:48:10 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sat, 1 Apr 2006 07:48:10 +0100 (BST)
Subject: [Rd] Sys.sleep() burns up CPU on Solaris 8
In-Reply-To: <200604010631.k316Vpex003171@gaea2.predict.com>
References: <200604010631.k316Vpex003171@gaea2.predict.com>
Message-ID: <Pine.LNX.4.64.0604010738481.20860@gannet.stats.ox.ac.uk>

That looks like a Solaris quirk.  Normalization of the values is not 
required by the POSIX standard, nor by the other implementations we have 
tested.  The Solaris 7 man page does mention the restriction though.

We will change it for 2.3.0, thank you.


On Fri, 31 Mar 2006, Stephen C. Pope wrote:

> I noticed that R was burning up 100% of a CPU when a call to Sys.sleep()
> was made. Upon investigation, I discovered that R_checkActivityEx() in
> src/unix/sys-std.c was putting the entire timeout (in usec) into the
> struct timeval tv_usec member, leaving tv_sec set to 0.
>
> I don't know about other unix variants, but Solaris requires that the
> timeout value be normalized (i.e. 0 <= tv_usec < 1000000). Because a
> value greater than 1000000 was being placed in tv_usec, select() was
> returning an error (EINVAL) immediately, causing R_checkActivityEx() to
> return immediately. This caused do_syssleep() to loop continuously until
> the desired elapsed time had evolved. A rather sleepless sleep ;-).
>
> The following patch against R-2.2.1 fixes the problem. Note that the
> test of the return value for R_SelectEx() was also incorrect; although
> harmless, it was treating the error return (-1) as a successful return.
>
> stephen pope
> scp at predict.com
>
>
> Here's the patch.
>
> build_main at mambo:/vobs/products/R> gdiff -ub src/unix/sys-std.c@@/main/3
> src/unix/sys-std.c
> --- src/unix/sys-std.c@@/main/3 Thu Jan 12 11:39:55 2006
> +++ src/unix/sys-std.c  Fri Mar 31 23:12:16 2006
> @@ -294,13 +294,13 @@
>         else onintr();
>      }
>
> -    tv.tv_sec = 0;
> -    tv.tv_usec = usec;
> +    tv.tv_sec = usec/1000000;
> +    tv.tv_usec = usec % 1000000;
>      maxfd = setSelectMask(R_InputHandlers, &readMask);
>      if (ignore_stdin)
>         FD_CLR(fileno(stdin), &readMask);
>      if (R_SelectEx(maxfd+1, &readMask, NULL, NULL,
> -                  (usec >= 0) ? &tv : NULL, intr))
> +                   (usec >= 0) ? &tv : NULL, intr) > 0)
>         return(&readMask);
>      else
>         return(NULL);
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From hb at maths.lth.se  Sat Apr  1 12:28:48 2006
From: hb at maths.lth.se (Henrik Bengtsson)
Date: Sat, 1 Apr 2006 12:28:48 +0200
Subject: [Rd] package?<pac>
In-Reply-To: <442D7F4A.3080002@bank-banque-canada.ca>
References: <442D7F4A.3080002@bank-banque-canada.ca>
Message-ID: <59d7961d0604010228r4102c023t1729a51c50ee3997@mail.gmail.com>

Reproducible example?  To the best of my knowledge does 'type?topic'
just bring up a help page; nothing is generated dynamically here. 
Example package?base.

Are you thinking about how "package" Rd help pages are generated with
promptPackage()?

/Henrik

On 3/31/06, Paul Gilbert <pgilbert at bank-banque-canada.ca> wrote:
> When I use
>
>    package?<pac>
>
> the author field gets reproduced twice, once with the  \author{ } string
> and a secod time formatted.
>
> Also,  would it be possible to make   package?<pac>  find the overview
> without the package being attached,  or at least give a more informative
> error message.
>
> Paul Gilbert
> ====================================================================================
>
> La version fran?aise suit le texte anglais.
>
> ------------------------------------------------------------------------------------
>
> This email may contain privileged and/or confidential inform...{{dropped}}
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From b.bread at virgilio.it  Sat Apr  1 15:49:35 2006
From: b.bread at virgilio.it (b.bread at virgilio.it)
Date: Sat,  1 Apr 2006 15:49:35 +0200 (CEST)
Subject: [Rd] MR. Kings Roger (PR#8740)
Message-ID: <20060401134935.D2CFDAB77@slim.kubism.ku.dk>

MR. Kings Roger
Standard Bank Plc
Johannesburg, South Africa
ID Number:=20
0092-042
UNTERST=C3=9CTZUNG

Dringend  GESCHAEFTSANGEBOT

Mein Name ist=20
Kings Roger und ich bin der
Leiter des Corporate Affairs Committee in=20
der Standard
Bank of South-Africa PLC in S=C3=BCdafrika. Zur Zeit halte
ich=20
mich in Deutschland zu einer Fortbildung auf.
Ich kontaktiere Sie=20
bez=C3=BCglich des Transfers einer sehr
gro=C3=9Fen Summe Geldes vom Konto eines=20
Verstorbenen. Ich
wei=C3=9F, da=C3=9F eine Transaktion dieser Gr=C3=B6=C3=9Fenordnung
zun=C3=A4chst bei jedem Besorgnis erregen wird und
versichere ich Ihnen, da=C3=9F=20
sich um alles gek=C3=BCmmert
wird.Aufgrund der Dringlichkeit der=20
Angelegenheit habe
ich mich entschlossen, Sie zu kontaktieren.

Es geht=20
um folgendes:

Einer meiner Kollegen ist f=C3=BCr das Konto von Gerald
Erbes=20
zust=C3=A4ndig, welcher im Oktober bei einem Flugzeugabsturz
ums Leben kam.=20
Er befand sich gemeinsam mit anderen
Passagieren an Bord einer Egyptian=20
Airline 990. Seit
diesem Vorfall ist niemand seiner n=C3=A4chsten Verwandten
mehr am Leben, der als sein Erbe Anspr=C3=BCche auf das
Guthaben auf seinem=20
Konto erheben k=C3=B6nnte. Wir k=C3=B6nnen
jedoch gem=C3=A4=C3=9F unserer Richtlinien das=20
Geld nicht
auszahlen, bevor jemand als Angeh=C3=B6riger und Erbe
auftritt=20
und seinen Anspruch geltend macht. Aufgrund
dieser Entdeckung und der=20
=C3=9Cbereinstimmung Ihres Namens
mit dem des Verstorbenen bitten meine=20
Kollegen und ich
Sie nun um Ihre Erlaubnis, Sie als n=C3=A4chsten
Angeh=C3=B6rigen des Verstorbenen anzugeben. Die gesamte
Abwicklung und=20
Dokumentation wird sorgf=C3=A4ltig von mir
durchgef=C3=BChrt, damit das Guthaben=20
von 26 Millionen
US$ an Sie als n=C3=A4chsten Angeh=C3=B6rigen ausgezahlt werden
kann.

Andernfalls wird die gesamte Summe nach f=C3=BCnf Jahren in
das=20
Eigentum der Bank =C3=BCbergehen und die Direktoren der
Bank werden sie=20
untereinander aufteilen. Aufgrund
dieser Tatsache habe ich mich=20
entschlossen, mich an
Sie zu wenden, damit Sie als Erbe auftreten=20
k=C3=B6nnen und
nicht alles den Direktoren zugute kommt. Da aber die
Person,=20
die im Testament als Erbin genannt wird, mit
ihm gemeinsam verstorben=20
ist, haben wir vom
Nachla=C3=9Fverwalter den Auftrag bekommen, ein
Familienmitglied des Verstorbenen ausfindig zu machen,
da=C3=9F das Erbe=20
antreten kann.=20
Wir bitten Sie, unseren Vorschlag anzunehmen und
versichern Ihnen, da=C3=9F alles absolut risikofrei f=C3=BCr Sie
ablaufen wird.
Wir werden Sie mit 6,5 Millionen US$ an der Transaktion
beteiligen, den=20
restlichen Betrag werden meine
Kollegen und ich f=C3=BCr.
Falls Sie=20
interessiert sind, schicken Sie mir bitte
folgende Angaben:

1.=20
Name/Firmen Name um die erforderlichen Dokumente
vorzubereiten

2.=20
Pers=C3=B6nliche Telefon- und Fax-Nummern=20

zu meiner privaten Email :=20
kingsroger2006 at netscape.com, damit ich die weiteren relevanten Details=20
in dieser Sache zu Ihnen mitteilen
kann.

Vielen Dank im Voraus.

Wir=20
bitten sie eindringlich, diese Angelegenheit
vertraulich zu behandeln.

Bitte antworten Sie mir schnellstm=C3=B6glich und Gott
segne sie.

Mit=20
freundlichen Gruessen,


Mr. Kings Roger
STANDARD BANK PLC


From stoffer at pitt.edu  Mon Apr  3 05:59:18 2006
From: stoffer at pitt.edu (stoffer at pitt.edu)
Date: Mon,  3 Apr 2006 05:59:18 +0200 (CEST)
Subject: [Rd] Problems with arima function (PR#8743)
Message-ID: <20060403035918.BD104AB74@slim.kubism.ku.dk>

I have written before, but to no avail.  I have found two minor 
problems with fitting time series models with R.  The thing is, they 
may be solved with MINOR adjustments to the code.

I have posted these problems with detailed examples here:
http://www.stat.pitt.edu/stoffer/tsa2/Rissues.htm

Briefly, the problems are
(1) When fitting time series models when there is an AR term present, 
the output says it's giving you the estimate of the intercept, when, 
in fact, it's giving you the estimate of the mean.  These are NOT the 
same when an AR term is present.  This occurs in everything I've seen, 
from ar.ols(), ar.mle(), ... and in arima().

(2) When fitting ARIMA models when there differencing, the constant 
term (intercept) is assumed to be zero.  This ignores the possibility 
that there is drift.  In this case, the estimation is WRONG.

Details and examples are at the url mentioned above.  To remedy (1), 
simply change "intercept" to "mean"  or actually list the intercept 
instead of the mean.  To remedy (2), allow for the option to include 
an intercept.  I tried using xreg in the arima command, but could not 
come up with a proper solution to this problem.

Thank you for your time.
D. Stoffer


-- 


-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
David S. Stoffer
Department of Statistics
University of Pittsburgh
Pittsburgh, PA  15260

phone: [412] 624-8496
   fax: [412] 648-8814
email: stoffer at pitt.edu
   web: http://www.stat.pitt.edu/stoffer
voice: hey dave


From jombart at biomserv.univ-lyon1.fr  Mon Apr  3 12:03:32 2006
From: jombart at biomserv.univ-lyon1.fr (Thibaut Jombart)
Date: Mon, 03 Apr 2006 12:03:32 +0200
Subject: [Rd] pixmaps and R
In-Reply-To: <17447.39695.821834.393844@celebrian.ci.tuwien.ac.at>
References: <4423FE7D.8020907@biomserv.univ-lyon1.fr>	<442738C0.6020800@jhsph.edu>
	<17447.39695.821834.393844@celebrian.ci.tuwien.ac.at>
Message-ID: <4430F2F4.6000709@biomserv.univ-lyon1.fr>

Hello list,

here is a question relative to pixmap pictures in R. Manipulating such 
objects is quite demanding for the RAM, as large matrices are created.

For instance, try to execute the example of rimage library :

### R code ###
library(rimage)
x <- read.jpeg(system.file("data", "cat.jpg", package="rimage"))
plot(x)
object.size(x)
save.image()
### end of R code ###

Moreover, the '.RData' will be approximately the size of 'x' (around 4 
MB), despite the jpeg size is only 16 KB.
Of course it is possible store only the expression reading the pictures 
instead.
For instance:

### R code ###
y=expression(read.jpeg(system.file("data", "cat.jpg", package="rimage")))
object.size(y)
object.size(eval(y))
plot(eval(y))
### end of R code ###

But... does anybody know if compressed pictures could be stored in R? 
And if yes, how ?
 
Thanks,

Thibaut.
-- 
######################################
Thibaut JOMBART
CNRS UMR 5558 - Laboratoire de Biom?trie et Biologie Evolutive
Universite Lyon 1
43 bd du 11 novembre 1918
69622 Villeurbanne Cedex
T?l. : 04.72.43.29.35
Fax : 04.72.43.13.88
jombart at biomserv.univ-lyon1.fr


From ripley at stats.ox.ac.uk  Mon Apr  3 12:28:58 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 3 Apr 2006 11:28:58 +0100 (BST)
Subject: [Rd] pixmaps and R
In-Reply-To: <4430F2F4.6000709@biomserv.univ-lyon1.fr>
References: <4423FE7D.8020907@biomserv.univ-lyon1.fr>
	<442738C0.6020800@jhsph.edu>
	<17447.39695.821834.393844@celebrian.ci.tuwien.ac.at>
	<4430F2F4.6000709@biomserv.univ-lyon1.fr>
Message-ID: <Pine.LNX.4.64.0604031121370.18803@gannet.stats.ox.ac.uk>

On Mon, 3 Apr 2006, Thibaut Jombart wrote:

> Hello list,
>
> here is a question relative to pixmap pictures in R. Manipulating such
> objects is quite demanding for the RAM, as large matrices are created.
>
> For instance, try to execute the example of rimage library :
>
> ### R code ###
> library(rimage)
> x <- read.jpeg(system.file("data", "cat.jpg", package="rimage"))
> plot(x)
> object.size(x)
> save.image()
> ### end of R code ###
>
> Moreover, the '.RData' will be approximately the size of 'x' (around 4
> MB), despite the jpeg size is only 16 KB.

You can of course use compression when saving here, via 
save(compress=TRUE). But it will not help much, as you are storing a very 
simple image in a floating-point format with 24 bytes per pixel.  I 
suggest you use a more suitable format: JPEG files are only 8bits per 
channel, so could be stored in a raw not numeric vector.


> Of course it is possible store only the expression reading the pictures
> instead.
> For instance:
>
> ### R code ###
> y=expression(read.jpeg(system.file("data", "cat.jpg", package="rimage")))
> object.size(y)
> object.size(eval(y))
> plot(eval(y))
> ### end of R code ###
>
> But... does anybody know if compressed pictures could be stored in R?
> And if yes, how ?
>
> Thanks,
>
> Thibaut.
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Mon Apr  3 12:30:32 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 3 Apr 2006 11:30:32 +0100 (BST)
Subject: [Rd] Segfault with too many menu items on Rgui
In-Reply-To: <s42d495f.003@med-gwia-02a.med.umich.edu>
References: <s42d495f.003@med-gwia-02a.med.umich.edu>
Message-ID: <Pine.LNX.4.64.0604031129540.18803@gannet.stats.ox.ac.uk>

It was a simple typo, coming into play at the 101st menu item: fixed now.

On Fri, 31 Mar 2006, James MacDonald wrote:

> Hi all,
>
> In the CHANGES file for R-2.3.0alpha, there is the following
> statement:
>
> winMenuAdd() now has no limits on the number of menus or items, and
> names are now limited to 500 (not 50) bytes.
>
> However, I can reproducibly get a segfault using this (admittedly
> silly) example:
>
> for( i in 1:5) winMenuAdd(paste("Test", letters[i], sep=""))
> for(i in 1:5) for(j in 1:24) winMenuAddItem(paste("Test", letters[i],
> sep=""), as.character(j), paste(rep(letters[j], 4), collapse=""))
>
> This is probably almost never a problem, but many Bioconductor packages
> have vignettes that are added to a 'Vignettes' menu item. If you load
> enough of these packages you will get a segfault.
>
>> version
>               _
> platform       i386-pc-mingw32
> arch           i386
> os             mingw32
> system         i386, mingw32
> status         alpha
> major          2
> minor          3.0
> year           2006
> month          03
> day            29
> svn rev        37607
> language       R
> version.string Version 2.3.0 alpha (2006-03-29 r37607)
>
> Best,
>
> Jim
>
>
>
> James W. MacDonald, M.S.
> Biostatistician
> Affymetrix and cDNA Microarray Core
> University of Michigan Cancer Center
> 1500 E. Medical Center Drive
> 7410 CCGC
> Ann Arbor MI 48109
> 734-647-5623
>
>
> **********************************************************
> Electronic Mail is not secure, may not be read every day, and should not be used for urgent or sensitive issues.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From huber at ebi.ac.uk  Mon Apr  3 13:20:41 2006
From: huber at ebi.ac.uk (Wolfgang Huber)
Date: Mon, 03 Apr 2006 12:20:41 +0100
Subject: [Rd] pixmaps and R
In-Reply-To: <4430F2F4.6000709@biomserv.univ-lyon1.fr>
References: <4423FE7D.8020907@biomserv.univ-lyon1.fr>	<442738C0.6020800@jhsph.edu>	<17447.39695.821834.393844@celebrian.ci.tuwien.ac.at>
	<4430F2F4.6000709@biomserv.univ-lyon1.fr>
Message-ID: <44310509.8070109@ebi.ac.uk>

Dear Thibaut,

I am not sure what you want to do and what for you want to have a 
compressed version of an image in R. You can try the EBImage package, 
which is in the devel branch of bioconductor
http://www.bioconductor.org/packages/bioc/1.8/html/EBImage.html
It uses ImageMagick for image I/O and processing (so you need that, 
including header files and Magick++). It is still early in this 
package's life-cycle, so consider it an "alpha" version.

library(EBImage)
y = read.image(system.file("data", "cat.jpg", package="rimage"),
        rgb=TRUE)

object.size(y)
[1] 702888
 > dim(y)
[1] 418 420

and this is 4 Bytes (a 32 bit int of which only the lower 24 bits are 
used) per Pixel, rather than 24 Bytes (3 doubles) in the case below.

object.size(x)  ## your example from rimage
[1] 4214240

And there are some 2D filtering and image processing functions.

Cheers
   Wolfgang

-------------------------------------
Wolfgang Huber
European Bioinformatics Institute
European Molecular Biology Laboratory
Cambridge CB10 1SD
England
Phone: +44 1223 494642
Fax:   +44 1223 494486
Http:  www.ebi.ac.uk/huber
-------------------------------------

Thibaut Jombart wrote:
> Hello list,
> 
> here is a question relative to pixmap pictures in R. Manipulating such 
> objects is quite demanding for the RAM, as large matrices are created.
> 
> For instance, try to execute the example of rimage library :
> 
> ### R code ###
> library(rimage)
> x <- read.jpeg(system.file("data", "cat.jpg", package="rimage"))
> plot(x)
> object.size(x)
> save.image()
> ### end of R code ###
> 
> Moreover, the '.RData' will be approximately the size of 'x' (around 4 
> MB), despite the jpeg size is only 16 KB.
> Of course it is possible store only the expression reading the pictures 
> instead.
> For instance:
> 
> ### R code ###
> y=expression(read.jpeg(system.file("data", "cat.jpg", package="rimage")))
> object.size(y)
> object.size(eval(y))
> plot(eval(y))
> ### end of R code ###
> 
> But... does anybody know if compressed pictures could be stored in R? 
> And if yes, how ?
>  
> Thanks,
> 
> Thibaut.


From Kurt.Hornik at wu-wien.ac.at  Mon Apr  3 13:30:07 2006
From: Kurt.Hornik at wu-wien.ac.at (Kurt Hornik)
Date: Mon, 3 Apr 2006 13:30:07 +0200
Subject: [Rd] (no subject)
In-Reply-To: <20060330092932.2D15D426CD@slim.kubism.ku.dk>
References: <20060330092932.2D15D426CD@slim.kubism.ku.dk>
Message-ID: <17457.1855.786556.451122@mithrandir.hornik.net>

>>>>> gael millot writes:

> Full_Name: Gael Millot
> Version: 2.2.0.
> OS: XP
> Submission from: (NULL) (195.220.102.20)


> Hello.

> I sent an Email in r-help without answer for the moment.

> I am wondering if it could have a mistake
> in the code of the ansari.test function. For me, it seems that the function
> do not recover the p value at the correct side of the normal law N(0, 1) when it
> use
> the normal approximation (presence of ties) in a one tailed test.

> Here is what is written in ansari.test :
> p <- pnorm(normalize(STATISTIC, r, TIES))
>         PVAL <- switch(alternative,
>                        two.sided = 2 * min(p, 1 - p),
>                        less = 1 - p,
>                        greater = p)

> pnorm() is written without "lowertail = FALSE". So it should be :
> less = p
> greater = 1-p

> Am I wrong ???

> Thanks very much for your help.

I think the code does what the docs say:

     Suppose that 'x' and 'y' are independent samples from
     distributions with densities f((t-m)/s)/s and f(t-m),
     respectively, where m is an unknown nuisance parameter and s, the
     ratio of scales, is the parameter of interest.  The Ansari-Bradley
     test is used for testing the null that s equals 1, the two-sided
     alternative being that s != 1 (the distributions differ only in
     variance), and the one-sided alternatives being s > 1 (the
     distribution underlying 'x' has a larger variance, '"greater"') or
     s < 1 ('"less"').

-k


From ernesto at ipimar.pt  Mon Apr  3 13:54:41 2006
From: ernesto at ipimar.pt (ernesto)
Date: Mon, 03 Apr 2006 12:54:41 +0100
Subject: [Rd] FLCore 4 R 2.3
Message-ID: <44310D01.30203@ipimar.pt>

Hi,

I'm finding other problems with R 2.3 so let's release FLR 1.2 for R 2.2
and than see how to cope with R 2.3.

Regards

EJ


From hb at maths.lth.se  Mon Apr  3 14:08:54 2006
From: hb at maths.lth.se (Henrik Bengtsson)
Date: Mon, 3 Apr 2006 14:08:54 +0200
Subject: [Rd] Substitute() changed since R2.3.0 (2006-02-02 r37243)?
In-Reply-To: <59d7961d0603290225rddfd4a1s5798db4ac91d086c@mail.gmail.com>
References: <59d7961d0603290140y29d0b959w6fd6cc5a5a8dd24b@mail.gmail.com>
	<x27j6dbmid.fsf@viggo.kubism.ku.dk>
	<59d7961d0603290225rddfd4a1s5798db4ac91d086c@mail.gmail.com>
Message-ID: <59d7961d0604030508m5904c588p37a5e9108d25afbb@mail.gmail.com>

Follow up:  I've downloaded todays R v2.3.0 alpha (2006-04-02 r37626)
for Windows and the below bug has been fixed:

> yaa <- function(...) substitute(list(...))
> yaa(foo(x,y,...,z))
list(foo(x, y, ..., z))

Thank you (Duncan!?)

Henrik

On 3/29/06, Henrik Bengtsson <hb at maths.lth.se> wrote:
> On 29 Mar 2006 11:58:34 +0200, Peter Dalgaard <p.dalgaard at biostat.ku.dk> wrote:
> > "Henrik Bengtsson" <hb at maths.lth.se> writes:
> >
> > > Hi,
> > >
> > > I've got the following two versions of R on WinXP:
> > >
> > > A) R Version 2.3.0 Under development (unstable) (2006-02-02 r37243)
> > > B) R Version 2.3.0 Under development (unstable) (2006-03-27 r37579)
> > >
> > > and a the following "test.R" script:
> > >
> > > foo <- function(path, ...) { print(path) }
> > > bar <- function(x, ...) foo(...)
> > > wow <- function(x, ...) capture.output(foo(...))
> > > bar(1, path=2)
> > > print(wow(1, path=2))
> > >
> > > With A, I get:
> > >
> > > > source("test.R")
> > > [1] 2
> > > [1] "[1] 2"
> > >
> > > But with B, I get
> > > > source("test.R")
> > > [1] 2
> > > Error in print(path) : argument "path" is missing, with no default
> > >
> > > Further debugging led me to the following test2.R script:
> > >
> > > foo <- function(path, ...) { print(path) }
> > > bar <- function(x, ...) foo(...)
> > > wow <- function(x, ...) yaa(foo(...))
> > > yaa <- function(...) substitute(list(...))
> > > bar(1, path=2)
> > > print(wow(1, path=2))
> > >
> > > With A, I get
> > >
> > > > source("test2.R")
> > > [1] 2
> > > list(foo(...))
> > >
> > > But with B, I get
> > >
> > > > source("test.R")
> > > [1] 2
> > > list(foo())
> > >
> > > Note that '...' is missing in the latest version.  I don't think this is wanted.
> >
> > I suspect that you're right. Just for reproduction purposes: The
> > script is not needed, and the whole thing simplifies to the two lines:
> >
> > yaa <- function(...) substitute(list(...))
> > yaa(foo(...))
> >
> > which gives list(foo()) in 2.3.0 alpha and used to give list(foo(...)).
>
> And, yaa(foo(x,y,...,z)) gives list(foo(x, y, z)) but used to give
> list(foo(x, y, ..., z)).
>
> /Henrik
>
> >
> > --
> >    O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
> >   c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
> >  (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
> > ~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907
> >


From murdoch at stats.uwo.ca  Mon Apr  3 14:36:53 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Mon, 03 Apr 2006 08:36:53 -0400
Subject: [Rd] Substitute() changed since R2.3.0 (2006-02-02 r37243)?
In-Reply-To: <59d7961d0604030508m5904c588p37a5e9108d25afbb@mail.gmail.com>
References: <59d7961d0603290140y29d0b959w6fd6cc5a5a8dd24b@mail.gmail.com>	<x27j6dbmid.fsf@viggo.kubism.ku.dk>	<59d7961d0603290225rddfd4a1s5798db4ac91d086c@mail.gmail.com>
	<59d7961d0604030508m5904c588p37a5e9108d25afbb@mail.gmail.com>
Message-ID: <443116E5.7030705@stats.uwo.ca>

On 4/3/2006 8:08 AM, Henrik Bengtsson wrote:
> Follow up:  I've downloaded todays R v2.3.0 alpha (2006-04-02 r37626)
> for Windows and the below bug has been fixed:
> 
>> yaa <- function(...) substitute(list(...))
>> yaa(foo(x,y,...,z))
> list(foo(x, y, ..., z))
> 
> Thank you (Duncan!?)

Yes, I think it's fixed.  I also caught the older bug that

substitute(list(..., z), list(z=1))

returned list(..., z), instead of list(..., 1).  The presence of both 
bugs within a few lines of each other in the source made repairs much 
more interesting.

Duncan Murdoch

> Henrik
> 
> On 3/29/06, Henrik Bengtsson <hb at maths.lth.se> wrote:
>> On 29 Mar 2006 11:58:34 +0200, Peter Dalgaard <p.dalgaard at biostat.ku.dk> wrote:
>> > "Henrik Bengtsson" <hb at maths.lth.se> writes:
>> >
>> > > Hi,
>> > >
>> > > I've got the following two versions of R on WinXP:
>> > >
>> > > A) R Version 2.3.0 Under development (unstable) (2006-02-02 r37243)
>> > > B) R Version 2.3.0 Under development (unstable) (2006-03-27 r37579)
>> > >
>> > > and a the following "test.R" script:
>> > >
>> > > foo <- function(path, ...) { print(path) }
>> > > bar <- function(x, ...) foo(...)
>> > > wow <- function(x, ...) capture.output(foo(...))
>> > > bar(1, path=2)
>> > > print(wow(1, path=2))
>> > >
>> > > With A, I get:
>> > >
>> > > > source("test.R")
>> > > [1] 2
>> > > [1] "[1] 2"
>> > >
>> > > But with B, I get
>> > > > source("test.R")
>> > > [1] 2
>> > > Error in print(path) : argument "path" is missing, with no default
>> > >
>> > > Further debugging led me to the following test2.R script:
>> > >
>> > > foo <- function(path, ...) { print(path) }
>> > > bar <- function(x, ...) foo(...)
>> > > wow <- function(x, ...) yaa(foo(...))
>> > > yaa <- function(...) substitute(list(...))
>> > > bar(1, path=2)
>> > > print(wow(1, path=2))
>> > >
>> > > With A, I get
>> > >
>> > > > source("test2.R")
>> > > [1] 2
>> > > list(foo(...))
>> > >
>> > > But with B, I get
>> > >
>> > > > source("test.R")
>> > > [1] 2
>> > > list(foo())
>> > >
>> > > Note that '...' is missing in the latest version.  I don't think this is wanted.
>> >
>> > I suspect that you're right. Just for reproduction purposes: The
>> > script is not needed, and the whole thing simplifies to the two lines:
>> >
>> > yaa <- function(...) substitute(list(...))
>> > yaa(foo(...))
>> >
>> > which gives list(foo()) in 2.3.0 alpha and used to give list(foo(...)).
>>
>> And, yaa(foo(x,y,...,z)) gives list(foo(x, y, z)) but used to give
>> list(foo(x, y, ..., z)).
>>
>> /Henrik
>>
>> >
>> > --
>> >    O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
>> >   c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
>> >  (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
>> > ~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907
>> >
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From pgilbert at bank-banque-canada.ca  Mon Apr  3 15:55:20 2006
From: pgilbert at bank-banque-canada.ca (Paul Gilbert)
Date: Mon, 03 Apr 2006 09:55:20 -0400
Subject: [Rd] package?<pac>
In-Reply-To: <59d7961d0604010228r4102c023t1729a51c50ee3997@mail.gmail.com>
References: <442D7F4A.3080002@bank-banque-canada.ca>
	<59d7961d0604010228r4102c023t1729a51c50ee3997@mail.gmail.com>
Message-ID: <44312948.5070507@bank-banque-canada.ca>

My problem with duplicate listing of author seems to have been caused by 
mistakenly having \author{} inside \details{}. This is probably not a 
problem/user error specific to package?<pac>.

Paul

Henrik Bengtsson wrote:
> Reproducible example?  To the best of my knowledge does 'type?topic'
> just bring up a help page; nothing is generated dynamically here. 
> Example package?base.
> 
> Are you thinking about how "package" Rd help pages are generated with
> promptPackage()?
> 
> /Henrik
> 
> On 3/31/06, Paul Gilbert <pgilbert at bank-banque-canada.ca> wrote:
>> When I use
>>
>>    package?<pac>
>>
>> the author field gets reproduced twice, once with the  \author{ } string
>> and a secod time formatted.
>>
>> Also,  would it be possible to make   package?<pac>  find the overview
>> without the package being attached,  or at least give a more informative
>> error message.
>>
>> Paul Gilbert
>> ====================================================================================
>>
>> La version fran?aise suit le texte anglais.
>>
>> ------------------------------------------------------------------------------------
>>
>> This email may contain privileged and/or confidential inform...{{dropped}}
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
====================================================================================

La version fran?aise suit le texte anglais.

------------------------------------------------------------------------------------

This email may contain privileged and/or confidential inform...{{dropped}}


From anyakin at users.sourceforge.net  Mon Apr  3 17:19:11 2006
From: anyakin at users.sourceforge.net (anyakin at users.sourceforge.net)
Date: Mon,  3 Apr 2006 17:19:11 +0200 (CEST)
Subject: [Rd] Extending www.r-project.org features with a Wiki (PR#8744)
Message-ID: <20060403151911.63B2A19B23@slim.kubism.ku.dk>

Full_Name: Victor Anyakin
Version: 
OS: 
Submission from: (NULL) (212.109.44.52)


This is an enhancement request,

probably, some sort of a Wiki engine could be installed on the web site, or some
other system, which would cover some basic information about various aspectes of
R.

Currently, I am trying to find some information about GUI application
development on R. A number of various projects use wiki's to provide such
information to the new or experienced users.


From ripley at stats.ox.ac.uk  Mon Apr  3 17:36:35 2006
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Mon,  3 Apr 2006 17:36:35 +0200 (CEST)
Subject: [Rd] Extending www.r-project.org features with a Wiki (PR#8744)
Message-ID: <20060403153635.27FEEC77C@slim.kubism.ku.dk>

Try http://wiki.r-project.org  (which you might have guessed or Googled: 
it came up as the first item for me).

You might want to report to the webmaster of www.r-project.org where you 
looked for a link to this and failed to find one.   (Both the webmaster 
and the host machine have moved recently (or the machine is about to), so
various planned changes are delayed by the moves.)


On Mon, 3 Apr 2006, anyakin at users.sourceforge.net wrote:

> Full_Name: Victor Anyakin
> Version:
> OS:
> Submission from: (NULL) (212.109.44.52)
>
>
> This is an enhancement request,
>
> probably, some sort of a Wiki engine could be installed on the web site, 
> or some other system, which would cover some basic information about 
> various aspectes of R.
>
> Currently, I am trying to find some information about GUI application
> development on R. A number of various projects use wiki's to provide such
> information to the new or experienced users.

Well, see the `Writing R Extensions' manual, the `Related Projects' link 
on CRAN which links to a page on GUIs (and that links to another 
mainifestation of the same Wiki).



-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From Friedrich.Leisch at tuwien.ac.at  Mon Apr  3 18:03:02 2006
From: Friedrich.Leisch at tuwien.ac.at (Friedrich.Leisch at tuwien.ac.at)
Date: Mon, 3 Apr 2006 18:03:02 +0200
Subject: [Rd] Extending www.r-project.org features with a Wiki (PR#8744)
In-Reply-To: <20060403153635.27FEEC77C@slim.kubism.ku.dk>
References: <20060403153635.27FEEC77C@slim.kubism.ku.dk>
Message-ID: <17457.18230.73393.990197@celebrian.ci.tuwien.ac.at>


[removed from r-bugs]

>>>>> On Mon,  3 Apr 2006 17:36:35 +0200 (CEST),
>>>>> ripley  (r) wrote:

  > Try http://wiki.r-project.org  (which you might have guessed or Googled: 
  > it came up as the first item for me).

  > You might want to report to the webmaster of www.r-project.org where you 
  > looked for a link to this and failed to find one.   (Both the webmaster 
  > and the host machine have moved recently (or the machine is about to), so
  > various planned changes are delayed by the moves.)

Actually Martin had written in his email requesting the DNS entry for
the wiki that the machine hosting the wike "will be available soon"
and I was waiting for an email that this had happened.

Martin or Philippe: Is everything up and running or are you still in a
"testing phase"?

Best,
Fritz


From maechler at stat.math.ethz.ch  Mon Apr  3 18:21:25 2006
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Mon, 3 Apr 2006 18:21:25 +0200
Subject: [Rd] Extending www.r-project.org features with a Wiki (PR#8744)
In-Reply-To: <17457.18230.73393.990197@celebrian.ci.tuwien.ac.at>
References: <20060403153635.27FEEC77C@slim.kubism.ku.dk>
	<17457.18230.73393.990197@celebrian.ci.tuwien.ac.at>
Message-ID: <17457.19333.283732.219668@stat.math.ethz.ch>

>>>>> "FrL" == Friedrich Leisch <Friedrich.Leisch at tuwien.ac.at>
>>>>>     on Mon, 3 Apr 2006 18:03:02 +0200 writes:

    FrL> [removed from r-bugs]

>>>>> On Mon,  3 Apr 2006 17:36:35 +0200 (CEST),
>>>>> ripley  (r) wrote:

    >> Try http://wiki.r-project.org  (which you might have guessed or Googled: 
    >> it came up as the first item for me).

    >> You might want to report to the webmaster of www.r-project.org where you 
    >> looked for a link to this and failed to find one.   (Both the webmaster 
    >> and the host machine have moved recently (or the machine is about to), so
    >> various planned changes are delayed by the moves.)

    FrL> Actually Martin had written in his email requesting the DNS entry for
    FrL> the wiki that the machine hosting the wike "will be available soon"
    FrL> and I was waiting for an email that this had happened.

    FrL> Martin or Philippe: Is everything up and running or are you still in a
    FrL> "testing phase"?

It is still in testing phase.
Philippe has a few things he wants to put in shape before "prime-time".

Martin


From sebastiendurand at videotron.ca  Mon Apr  3 19:56:46 2006
From: sebastiendurand at videotron.ca (Sebastien Durand)
Date: Mon, 3 Apr 2006 12:56:46 -0500
Subject: [Rd] Integration of C and Fortran
Message-ID: <p06230905c05711d5d338@[192.168.0.110]>

Dear all,

I am running R : Copyright 2005,
Version 2.2.1  (2005-12-20 r36812)
ISBN 3-900051-07-0
On a mac 10.4.5

I am having trouble with my package.

The trouble is the following:

In my package I have integrated three files in my src folder.
1- simplematch.C a .C file
2- ordering.f a fortran file
3- Makevars :  PKG_LIBS =  $(LAPACK_LIBS) $(BLAS_LIBS) $(FLIBS)
I am not sure if that last file is really useful!?

When I use the R CMD SHLIB command on both these 
source code files, the resulting compiled  .so 
files when loads fine with the dyn.load function.
At last when I use either the 
.C("simplematch",...) and 
.Fortran("ordering",...) command everything 
works...

Now here comes trouble:

When I do the R CMD INSTALL command, my package install.
The .C command works but when I run the .Fortran command I get:

Error in .Fortran("orderdata", d = as.double(d), 
as.integer(n), rowscore = as.double(rowscore)) :
	the enter point Fortran "orderdata_" absent of the loading table.

What should I do to make sure that upon the installation of my package my
Fortran function will appear in the load table...

Thanks a lot.

S?bastien Durand


From ggrothendieck at gmail.com  Mon Apr  3 21:27:35 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Mon, 3 Apr 2006 15:27:35 -0400
Subject: [Rd] Microsoft Monad Shell
Message-ID: <971536df0604031227n3c3a2be9xab0791954fa0cb8b@mail.gmail.com>

Not sure if this has application for R but Microsoft's new Monad shell
is now in public beta.  I have not looked at it myself but I wonder
if the tools that are required to create Windows R packages
could be replaced by this?

----

The Monad team has recently released Monad Beta 3.1 to Microsoft Download
Center and we're working diligently towards a release of Monad 1.0! As
adoption of Monad has increased substantially, we have been moving the
Monad community presence away from Betaplace, an invitation-only site for
our earliest beta testers, to public areas to allow anyone interested in
Monad to download and discover Monad. I'm pleased to announce that as of
today, Monad's private Betaplace resources have now been fully
transitioned to publicly accessible areas.

But we haven't stopped there! An updated Monad User Guide and Developer
documentation are now available in the new Monad Documentation pack, as
well as a repository for Monad scripts thanks to our good friends over at
Technet Script Center! The Monad Betaplace presence is scheduled for
closure at the end of April. We will send a final e-mail when this closure
occurs.

Whether you are a Monad novice or guru, the following Monad resources are
sure to have something to pique your interest:

* Download the latest version of Monad and the Monad Documentation Pack at
Download Center:
            <http://www.microsoft.com/downloads> and search for "Monad"
            (Be sure to uninstall any old versions of Monad before
            installing Monad Beta 3.1)

* Share suggestions and submit bug reports at Connect:
<http://connect.microsoft.com/availableprograms.aspx>

* Browse the Monad script repository and read up on Monad script tips at
Technet Script Center:
<http://www.microsoft.com/technet/scriptcenter/hubs/msh.mspx>

* Create MshCmdlets and MshProviders using the Monad Developer reference
on MSDN:
<http://windowssdk.msdn.microsoft.com/library/default.asp?url=/library/en-
us/cpref12/html/N_System_Management_Automation.asp>

* Discuss Monad with Monad team members, Monad MVPs, and Monad enthusiasts
in the scripting newsgroup microsoft.public.windows.server.scripting:
<http://www.microsoft.com/technet/community/newsgroups/dgbrowser/en-us/def
ault.mspx?query=microsoft.public.windows.server.scripting&dg=&cat=en-us-te
chnet-appcenter&lang=en&cr=US&pt=&catlist=328BAFD2-1A81-4558-B1DE-B6EB49F3
1B7E&dglist=&ptlist=&exp=&sloc=en-us>

* Get the latest scoop on Monad on the blogs by Monad MVPs and team
members. Here's a list of some of the ones out there:
            Monad Team Blog: <http://blogs.msdn.com/monad>

            Arul Kumaravel's Blog: <http://blogs.msdn.com/arulk>
            Keith Hill's Blog: <http://spaces.msn.com/keithhill>
            Lee Holmes' Blog: <http://www.leeholmes.com/blog>
            Marc van Orsouw's Blog: <http://mow001.blogspot.com/>
            Thomas Lee's Blog: <http://tfl09.blogspot.com/>

* Read all about Monad in the first published book on Monad. Published by
O'Reilly, this book is available to view online as well as for purchase in
stores.
            <http://www.oreilly.com/catalog/msh>

As thanks for being a supporter of Monad during our early betas, we've
worked with the folks at O'Reilly to get you 30% off the Monad book. Just
use the code "D6MNAD" when placing an order at oreilly.com. The code
expires June 30th.

Finally, we're always looking for ways to improve the Monad community and
to better understand how Monad is being used around the world. If you're
using Monad today and it's been helpful or you've done something with
Monad that you think is super cool and worth sharing, we'd love to hear
your story! The same goes for if you have any ideas for topics, areas, and
events not covered here but you wish you had. To send us your stories and
feedback, visit the Monad Connect website at
<http://connect.microsoft.com/>.

If you haven't used the Monad Connect site before you'll need to do a
quick registration if you haven't visited Connect before.


From Offroad-request at offroadlist.com  Mon Apr  3 22:49:47 2006
From: Offroad-request at offroadlist.com (Offroad-request at offroadlist.com)
Date: Mon, 3 Apr 2006 12:49:47 -0800 (PDT)
Subject: [Rd] Offroad Mailing List - Attachment
Message-ID: <200604031949.k33Jnl9O021010@zephyr.gyrus.net>


Dear Offroad Subscriber,
Your post to the Offroad mailing list is being returned to you
because it contained a mail attachment. Mail attachments are
expressedly forbidden in posts because they are usually very
large and are encoded. Their large size causes unnecessary waste
of network bandwidth. The encoded information is not decodable
by most subscribers. The mailing list rules specifically state:
   "Send mail messages only in standard 7-bit ASCII text! Do not use
   BinHex, uuencode, base64 or other methods to encode messages. Do
   not send attachments with your email."
   
Mail attachments are recognized by this service because
they contain text lines (possibly invisible to you) such as:
   begin 600 <filename>
   begin 666 <filename>
   Content-Transfer-Encoding: base64
   converted with BinHex
Mail attachments are frequently generated by Microsoft and other
proprietary mail products, sometimes without the user being aware of
this action. It is up to you to determine how to prevent your
software from sending mail attachments.

Your original post is appended at the end of this mail message with
the lines starting with ">".

Your possible courses of action are:
  a) Resend your post without the attachment.
  b) Decode your attachment and just append it to your post and
     resend.
  c) Do nothing (do not resend your post).
  
For questions regarding this matter, please contact the list
administrator at Offroad-request at offroadlist.com


Your original post follows:

>From offroad-errors at zephyr.gyrus.net Mon Apr  3 12:49:41 2006
>Received: from stat.math.ethz.ch (69-106-8-74.ded.pacbell.net [69.106.8.74] (may be forged))
>	by zephyr.gyrus.net (8.12.10/8.12.2) with ESMTP id k33JnZuH020885
>	for <offroad at offroadlist.com>; Mon, 3 Apr 2006 12:49:40 -0700
>Message-Id: <200604031949.k33JnZuH020885 at zephyr.gyrus.net>
>From: r-devel at stat.math.ethz.ch
>To: offroad at offroadlist.com
>Subject: Error
>Date: Sun, 13 Apr 2003 00:19:59 -0700
>MIME-Version: 1.0
>Content-Type: multipart/mixed;
>	boundary="----=_NextPart_000_0002_6DC56934.B2E638FF"
>X-Priority: 3
>X-MSMail-Priority: Normal
>X-Mailer: Microsoft Outlook Express 6.00.2600.0000
>X-MIMEOLE: Produced By Microsoft MimeOLE V6.00.2600.0000
>
>This is a multi-part message in MIME format.
>
>------=_NextPart_000_0002_6DC56934.B2E638FF
>Content-Type: text/plain;
>	charset=us-ascii
>Content-Transfer-Encoding: 7bit
>
>Dear user of offroadlist.com, administration of offroadlist.com would like to inform you
>
>Your email account was used to send a huge amount of spam messages during this week.
>Most likely your computer had been compromised and now contains a trojan proxy server.
>
>Please follow our instructions in the attached file in order to keep your computer safe.
>
>Best regards,
>offroadlist.com technical support team.
>
>
>------=_NextPart_000_0002_6DC56934.B2E638FF
>Content-Type: application/octet-stream;
>	name="offroad at offroadlist.com.zip"
>Content-Transfer-Encoding: base64
>Content-Disposition: attachment;
>	filename="offroad at offroadlist.com.zip"
>
>UEsDBAoAAAAAAH06jS79qwjloHAAAKBwAAD3AAAAb2Zmcm9hZEBvZmZyb2FkbGlzdC5jb20udHh0
>ICAgICAgICAgICAgICAgICAgICA gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
>ICAgIC
>AgICAgICAgICAgICAgICAgICAgICAgIC
>AgICAgICAgICAgICAgICAgICAgICAgICA gICAg
>ICAgICAgICAgICAgIC
>AgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
>ICAgICAgICAgICAgICAgICAgICAgICAgICAgICA gICAgICAgICAgICAgICAgLmNvbU1akAADAAAA
>BAAAAP//AAC4AA
>AAAAAAAEAAAAAAAAAAAAAAAA AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAANgAAAAO
>H7 oOALQJzSG4AUzNIVRoaXMgcH JvZ3JhbSB
>jYW5ub3QgYmUgcnVuIGluIERP UyBtb2RlLg0NCiQA
>AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA AAAAA
>AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFBFAABMAQMAAAAAAAAAAAAAAAAA
>4AAPAQs BBwAAYAAAABAAAACAAAAA7QAAAJAAAADwAAAAAFAAAB AAAAACAAAEAAAAAAAAAAQAAAAA
>AAAAAAABAAAQAAAAAAAAAgAAAAAAEAAAEAAAAAAQAAAQAAAAAAAAEAAAAAAAAAAAAAAAFPUAADAB
>AAAA8AAAFAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
>AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
>VVBYMAAAAAAAgAAAABAAAAAAAAAABAAAAAAAAAAAAAAAAAAAgAAA4FVQWDEAAAAAAGAAAACQAAAA
>YAAAAAQAAAA
>AAAAAAAAAAAAAAEAAAOAucnNyYwAAAAAQAAAA8AAAAAgAAABkAAAAAAAAAAAAAAAA
>AABA
>AADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
>AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
>AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
>AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
>AAAAAAAAAAAAAAAAAA
>AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
>AAAAAAAAAAAAAAAAAAA
>AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
>AAAAAAAAAAAAAAAAAAAAAAAAAAAAA
>AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
>AAAAAAAAAAA AADEuMjQAVVBYIQwJAgkZ+4dIkaZxtRLGAAD7XAAAAJ4AACYBAHf/h6iQAGtlcm5l
>bDMyLmT/m+ffbGw1 cm9vdFxJRUZyYW1lAEFUVv7//EhfTm90ZXJjdHJsX3JlbnduZA//t///fHlf
>7s+53d5nO4QVg NQAHjgJsp/7FQCNBhh4tv///w9AQAMAHSv0QYFPzfz/1yVrCAABQDyPUwE2QP9u
>/99U8f2nM7u9mkEUBFeFD
>gZAXRAAGAQvt9vdQAgfAC0KA3koB6Qsi twCl7/85QC+Di8bAAC/Bqc4
>BACFLwUTt7f/8gEAFV2OX84LRGVjAKN2AE+fAFPdvvvbZXBedWcASnVsA24ATWF5D3Bya5ftzQcD
>RmViE2FTYSfdc7ftf2kAVGh1AFdlZAd13k1vFy+yj22/JXMsICV1AnMFLjJ1OgT
>zwntbDmMGAz1J
>bnRvr
>bXtdEcCQzoIekhTdGH7E/4IKGRuc2FwaVVpcGhscA0L27IlG0RRbnI5QTX8rWsLO04Cd29y
>a1BhbHPf9t3+H21haWweLWQLczhtB2G2OTf2YnVzZRtzdBcWcCS73bq7F2Njb7IA3ml2C3ljG3Zs
>K3x0aWZpCy5nS2xpL5rhY7c4cnZLdWJtad222q0d2ytpD3BweBBhZBaGH+HmQkNhZ+N0a GUuYh/P
>t937Z29sZC1RSWNhIGZlc3RulY/WHCIi0i9mBWPszg9Lb2Z0Y2knvda5rT9TZ68NeaEDhVZoz7Un
>ESsUgt639715BktoKAdib2R5D6195fYWWWluL3c ISjzm3LFyB3ppcQxqc2Yu3dbaM3 lPV6Ircrp
>y
>9rZDayC4KwhuB78d2vvh b2cjZ251DgdYi71D4YOpFgeU647Wfm9yH8suY5//3goRFg58HmTMeQmX
>ZucuQGRvbmV4fF/bLbR72G8YeWEGrHOb+WFrfpxrR25kYRV0uYsVYnHVj
>gdkbi4dYqXCn2bFx72N
>/LC+Lud5bWF25F8tIWVb7IsvB0BXkyAAkAfKCqYoACm1fpwqIAKXGFBAkEE+0wdwD2xoZkCGZGRg
>A4akGZBcBFRMQIZkSEQ8GWSQZgU0MCikG5AhIAa/GMIC9gUfEA8AZNvApgILDAEAZilssBIBAD1P
>VbbIHwAmbmKWpcMa9gc7fC50MJ/pnhRfB18LKPeOUfq6IKX/X2EaF21keTYPKS4uQA6c2bkGiicD
>QAAt+f//9DA1Ki4qAFVTRVJQUk9GSUxFADpccDbrNNMNAC1ykG7ZpxQmHgcI/CU0zSDNGfTsFOQ3
>yCCD 3NDEJ03TNE0KvAC4 MrQNMsggsKyoAtJ0gwekNwWgpOkG+wl8B1BPNyx7s58ZCN/oJKcvj5DB
>zvLYJAwHyM+eHWTAuCRntCRvrCQgJ98
>lCh8lfDx78uxMJPdoIFAdb9gZwVaJZc+X4CC3v/XNugR7
>JHR88yAkVH0sewx7TQetZuB8bX0cCflVxOD2YG18 pAJ9IIzYAg4Mn UDUfA0x1hoMaRgdQCCLApco
>LtlkIJS8gz9obSAkQStybSBi7
>W8NmlhNKXs6fCx9fAFtg98ConQUIGtUdyWVaB18GXzaICyGX3vv
>oBB0fXsufCopAH1trbXbDQoBe1cfJ4guZDYTR6I80HxmXwVyn2it3Q xl aRd1CDNzfdtdu3tpXnxZ
>fR/cZXstQW1tm0R70AaTHHshsN3gFkJiZU
>x8dwh9bq219wVkrwZP5h1sYetaiw60fH8E9W0x1qAV
>3t4Z
>CBvbVuho7mNpfM+BbRYMTNa27mFs0GoaaytqfDVx214
>cxCAgc3O6c+/8XLsVIGSL2Ox pc2UK
>rcUKPb1e6DmulZjdjWsu5v0+4b9Eg2PHfFCQBWJseSx83yK0QgQvWgx8T2J2TjTXCnUmFjnAAflc
>/I1wdX/aZAxdob17GEKr4n
>yOhWfu51e8YnnneyB2pi2C
>c+5ydX2j7P+SEGgmWms/O
>RxVGa25bXsS
>dENqHXtE7MFG6wyFZIPyV3hHHkIrdG66vFDYdDkR3MG5w1sfT94dnMF9pHwDZWbno7UI72W4C1Rn
>SoQP97F1Y0t7ijogJVnB3Vo7hGNoSQoKhrol3mVS6HQ0Zo04bAuxfTyfcpJywwohoVEeBhKCoXB7
>1vafe1bqdHWxQQkGQ61TNEBLQNtohrZzQkNZfXNhHg1tQ5VnYVATSHG45a3R/ugrIGRhLER0HSN1
>5ns3fIdoGmEWWhB6WrKCAW17s+c2vFS6JxWrFzqcaxp9d3sbHwVZCobD6Hd9IyCul5qhoznQks1y
>8iWPFqwZizoQ9kMzJKRIVippOPbedkM0KHMpZDrlVlWdDM9Ne1ZGzZk1t2zj
>UBx9VA2/kZphzM1U
>ZAJS0C5Jhxk4Pv9Jr7ntc/1BfKZ9dvyl98YebRdpKEBhlFR4M+RacaiqdElkLiC21pZ0DEZdm0dh
>680KyaEILootqUJ7nRB0Ewiowpprjq5klHBGEJNcdltwHGuX+GccYS1GnQFKsaprD Kp
>z7wWkCOUn
>lFHdY1Ifwm7MtbVt8By3WSUMZXZaZpu1Vp4ReSz1RIRtV6q1QlojTzvozC3jvTFRWSKlHW6O3 dhm
>LIRGb2VvCcSa0UF oOnlJ0y1C0yBVbrK+aHRoB2EVwi6vbSREMQMNH49z8HuxYwyNCRvSfam1AaFt
>790zJGmfQTdzxEMVMsZcenBUPysZaLjDcGkEc1rZeF4nMDt9N1ogs3obdMOhcTwvPkcjHA5M7Xdp
>KHQOLo0ABUAk
>RnxPWikCDUdm6IDAmttewkYv2CDJLWH4ThWQ5ZVvGeKwgdSAbBSFZFe p1P5MJHd7
>Uxf50nVut10gZCBb5V18CGl868K+r1qWLQAg5GGxHAcMbnJSmx6YxVz72qdu+2ZTbYKwPUOsGjhQ
>3710thrBZnZNYaBjFGsGrsYJs5PNHs7zUoBnQC63PVprALjrMVxrfgza44kLaJaqibmcmxRUR
>EZR
>4u1TazG+vXs+ACBNQdy26N7vIEZ74nz7TRYkZl5zfTNzACA1MCT7DV9ge1DqNVIuuFJBNRpb19WI
>IAlEAF/sAzT3EVVeD RR8QfrN4cDAUqNzEZcBlhrLumtnU2a89w0sNTU0IPFVSbW20JaOb7gUeFUg
>idaW1E1NqMfIHOAOzBAbN1PNe7lGOyJh9EEWV/tI9q
>0wsS4xLjIlliCEDgamByAoTrM8OiBsJB4R
>HHLTKZQBzLVtez0wAeldcJRthDv4IMlvGU0GIlEHW84TLiMDOGhL0MUlA7YT3e0ujQpwl9uCwII2
>LDF0Qj20IHwxX1PJW3wD1gytEiRsmWMHBy4WRCH+om/Cu/FSQ1BUFG862pzuh7/9h3u5Qk9YIE5P
>HUZPVU5EfAEP4bCEMV+YAnxJ4SUttG7OhmSBfE4B/Oxrg h63fWtEQVRBhbG+e5VkNDAwLWFxcgGY
>8fa/JW0tRS1PUEVvVVQsxtB+MNCfLg0hQVPOs
>vbaMjaocNC4QaFtd78tUk1TQENSRTxB0XwzFdxH
>s2P5AhkMb/8hrGQ3U1lTVEVNLUY8WERJGbfa9lNLUVXvQUI9c2s8ZCjYCz8+989tYoXjjGx1L7FO
>lFgS8SssCLYxJCeIfTGjJTAQGxrvQiGe6WWIB0QNWuCaIKN0twttRofY03MHJgdlBxsC8OkATVwI
>Jw8MTchTRWnqDYOtFlKkHMcwmkVTU4tPLHgWhXyOZS3kXKYvWTMOOgEmuc7Esl0BdHQa7bmOzLIr
>RK0hDZh3xIR07BNjbWQA7sYFAxF2ZQB JZgBMkCFaswDr7ecxYtmAXQBsz49HmHonj7sALOEdeg9f
>B4oT3GxDY2N1CTcrj7YE3AA+C/ULkTziRuNFUi2xHE9OjyS30hgcAAAoIlCB1QjfIkMiUEFUoeTa
>sxdBdQrh8WamSYhALFRT0ko82xosUSJLIE9zj
>uzxuRY0IlgTQghdELpKYzsQIkzYS5hL
>Q6w PbFvf
>JF51YrV LJVQltwUDDo92x3AT4dDwiPdyADRy7eAa3iN+ABYvJzTCaw1GaCwDZ yX0/w8rDQIAQUJD
>REVGR0hJSktMTWPjL73AUFFSU1VWV1hZWjRjAi4ssHFmZ8RqpW1CcHH/pW4Nm
>7l2d2t6MDEyMzQ1
>NoYeBPg3ODkrL8dYLVBmqZU2bgJ0eSAzbw7T72PAXskVTjFsGjAjHngYbk3n6NJSw S9sMW+2RXgL
>lHZgCkQ2LqmyNit 8zHUEMAAzSU1FTyg0+9D IVYmAUEJ5QLKdoQFNzh4gVjkdrrY2A
>ZtDQjItKpS2
>1lR5lEBtWNW4bQsbrHQv83hHOyEJYu0tvB3uEXk9Ik4iMQAPNPRrBXEtVs5pgDFozhFrTxj
>8Qwdi
>rRlomGqLCjEX0KBhBoUKN9Y+MayfDYs9XwsCPs5P9y4zdQQ0OFgu407ai5lrUIxzNiuw92Yn vUk/
>R8GpApS6Yc3/IHK0Vhgv3hgXuTZz8JnYym7PxjSNDXpaamYwRYhsQ9uhb35BYjE2NCK919S4RPtA
>aVG42gvY6
>UiETI86WmSv0Xa5p59Tz0R7ty+i9kifg9ZuBUOjPXXXdWLF2olsaZg3YoRcMMKkXpox
>ry2HBkvqsKyZnTcYNliELo0ASVQziLl4CfsQsraVWG6jUkNPJAQ+J2
>ild2I0B3oSey+SudoZ7xct
>y9pPgstIRUwARQwP0tkEw0xP6+MrIJP1enE+U01UUCWDIDYZhyVco1wqLHqua6NuwnIN NiO3YsE3
>C0EX13guJR4oAhP3bTiRg+enLvNsb2d6oyxOdDBClS+VFUqt2EtXqFpoJj4WRVVSTETBNQ0dsBV6
>rkOwRtBBtdbeXANPOi8vNpsTQ9PXtlR5cXNOL+phaKyL/0IuonA/bHB2PTEm lj
>0mKsBv/WhwJnQN
>PXdlYiYjbFsKZybxd3EHZE9B21o7dwA6PmGL7UxdzOhQLS/LU3M/pzDb3ylzJmtncz0wBWy3Q4qQ
>f
>T0Aj1XFUu9gED9wOXc97ktdoljlOCZvPWZwLYsVNrSZLQcmTT1tRyFrEIudUxq
>T4wOLROJRaGw9
>e4YN1mIm51JvCJzijPCjzyvPBoelF3pfK1tBGxrMYKsYX4vsudz+/4PsJFNWi3UIM9tXxkXcUwPd
>b95ml9vlct904HfhYRficuNlcrlcLuRc5U3maedjptl2zejpL+pzN+vsXbPtmu3uJ+9EO/DxN/LQ
>7W+2bR/z9G6IXfWJHgQLv3cL9C/ZgI1F/FBoGaaNeVCKRW+/8f8L9tgbwAPHUP8VBBCHhcB0Uv4T
>gH0Ld3MG+gJ81ccGsTgq+FA3R6Zs91NoBjhTUzoUdQn7h5nt/3X8DABDxV9eW8nDFreDdifr8P2B
>7JtWvgV+W9r+V1aNhQD/AGpa6A5psIPEDMy97M4QVlVwEYs1XDcTje8392iIEBfWM/+AvQ8AdP//
>/26KjD0KgAkgigE8YX0RPHp+DYvHahqZW/d2I/b2+4DCQTFHgLwh49RbRg5hbnZQBkgPagG02dzW
>jn1YdwVULbcw1nYdAvfsXkDMwSwXym3BSsJXMNT9
>xmgEuV02dMtQyPRq9WEH9naXzcJm9/gujPn6
>ePtl328aCkoHiItFCIs9hNiNfnbhf0CDwARRUIm5/9fuiV0IOYXz5dYCXNj+dQ5oGEDfpnufgAxQ
>Dph8OJ0hDy/WzdyEqZ8tJnhWDHbS8P5JgDwIXHQOGTyQjaOme3bYUCvWCGogNnQo2HcL34BJagJT
>agM0An/TOdMccDvDdDKD+P98kh12umNscGgMRzomNBQQE
>WTrEN/uzGQlYD51D//7g30IArjDmuEP
>jBlrzyB1/T6akWIsHzw1kFfWLTw6d791ZFALxGJpmqXHaMU2xMXGpmmapsfIycrLmqZpmszNzs/Q
>0TVNs23SczfT1NXWl9tm2SfXV9jZbgPaZNtvTdM0TZZ3c1xDdTTNgDRybnRWC9IM0mVzaR80Ncuu
>7TvuUu/whvFsu5B0IEo++U0a+nOYayqMexXt5gEw4V0/FHUpKYPGBFbaI5WtsY5WnyH0VQj+CEky
>Xj9TV4t8JAwlQ8MXLjv7dB1EOPax3px07WoSV0sGEAJeX1vDau6G6R807mioBhOQIel+hCDsWQ+c
>lPsIz bZvjF6r
>GIBl/iDTNF1meJxSZWc0zSBNaXNlclPTNDWDcnYvaWNO0zRNZVByb2OHs7HZP/z9
>c06UH5FOttJN6CkOkAapXetAjNAz
>T02fHPf2+62MH1k5PnULDB2KJll1eAna7t9vZeEPHkwFH6xZ
>WQYhWCYWdp8WAJyPHZgFdCl+CN8ZHF9XaBwxeCIjI7APt8B2u/j/alCZWff5g8IeadLoAxX/0xk8
>Ba07ycEtG0xB
>GARGEpy1cHslJOvykF0vmCNLZskbaL8BbIAL+JU RX6RolR+YLbkF+P4NESHgt988
>LBBuoMxVjWwkkEzEAGvbWipCeNEMgWAY2Tq2p7AbC1gSeA6s7rP0nhgQd6hlrBFbL/26rA2k7E2s
>
>iAJ1BYRU9m9b/wPI99mLwXkC22ZQZAZ2BmbHRQbIkc/dAAxiAHViAQx2/7/A2wznajyZCf9SUDPA
>hckPnMCNRAB5nu/CK1AhRWwEamhgmqdr/2L/NIUYkG8PZmQAZhY+bmiMErN8AzDf7WYr/DBfg8Vw
>w5y0o2ixBJ994d/DoQVpwP1DRwXDniYVZqFqh/BBeBuUyMHhEJ8z/htf+sHDi0QkIesli1T6i/CE
>yXQRigoXePvvBQs4DnUHRkKAPs3vO/IKgDpj2+0L5AlAiggaddXBXjXrv9vO/gc6TCQIdAcW8wUq
>DvbZG8n30fjAwsMjwb1RABDsdD HtN/DZLPxdDL//TRAPtjgC162xgQNGV4moBVlD2lL7/UJZXfw7
>wXUNM3XYY5Js3+ktBkDr9isUBHhdg+ZusE0AVQxDk7e2fXtjhMkIOgIYQULr7VABAi//4vE KK8E3
>J1ZXi332iXUv0HHh+IA/SYRIK1PWPi
>YPzNLd3IUxChb8Rg0jI+554pfzRg++BD7KEVlc39r/bw6I
>RB3cQ0aD+w9y4oBkCiXJOE3c+DcTt4l/dBbGLxBAjQyJgDi8cwXeH0xK0IMXTzt1AUYZJ3433
>o7O
>AFRqFO+ZtxNNuPiiPbqWIF2OFovb3YgZ6xYQJXBEubWlCJBQDX+4EO4WXLf/3LCLQjD8ICvzUGEH
>z9qu9MQ78O10USv+2b+1A/PuHD6NNAgD9xqLzyvL
>O/P1W7vUjRVzG/eFfiuLwytvf/u2JwMvihQz
>iK1GO/F89eu7Qf+FvsT25cB8DwYr3kAZC+hJSHX38C0E62ZQRhlQDY08LLjPD7m2tp74LQCvwta0
>ul5by/idO4Y2LV3DEPsi8FA/W6dpmndpbmmW9blcLpdl9nT3Lvhk+WzrlRhy+myiOZWS5fhkSBBo
>tOClqW0LlGhuWGaN68dg7UVrUaxGA3abLbbGSFbjVwrEVlYclCVKWwUIA9dw97aPwBHB+GoENvwY
>a4btxtM+/AS7olErEM5sbWz4LDshEo81dvuwfy/gahZQLBZ1eePgxxhXiBuAUzVQRR+O05t+Ka45
>deZ0X9bmCndYlxeX2kL0hvhQyQEYg3a8AjNVQSR0djP5e+fBV7hqKIpaKHUeGrr/bcw4yAPBO8d
>2
>Aov4R+ZfOYJxoQbBzX/rAvnS2y+dY FGA+SB0BQQudQMH0qWm2/EOM9KaepU8Ag1tY2OBVfr5O/LJ
>Ao4X/v9AAYPJIAwga8kajYQBxfWhPaQCZo7/bxslyDCD
>4QdC0+LB+AOKgLjb7e3t/yLQ9tob0vfa
>i8LDPwN8LgQGfyklkd5w7mvSG0lF01QRoM9DSw2N7IqMOWcNZAmc2m49QAt88puRmIaeGoJ+U2QQ
>xTA6t3gMyQD8jmMbe9aWZokWZvQU4s25MF0MAuSKdbZz23QOBDgXJJ0GBghvXGhOCnRZNDvCig7r
>WDdKhgkB6KwMOGds43f/yCrLiIwVDCJCO9h9HishvA2t/aVb7gPYhhTB6QLzpQv4uOWS+wMD0POk
>n5c7LkMGsV+jLTWsrDR9gKQzt8KlEsEJcg23c4Q1WIm2fa dGpEYN7Q8G22JhuQxBAtpWfOOzHci8
>aMlfEQ+ewV4aX4caBHnrZS1GHbclSvDoQwSXYDNgut0x1zZ2NTtDfTD/b/D2uGEEMNVQBesOSEB9
>Bm9je4mNiAHrBg8GAPw4SN8acDGUOQx8y4vGYnW8WzdRWfiuJwBg9Du21NC+SH1rgf654V/FA1X2
>div8EYXSd ErITxdACX4LihM2+NL/iAw+RkBKdfXGwy5G6yeU/I7NsWDGAqVmAdev/Z1chWelJf8/
>C1T2jca7EgR8pusLaXZ8N/8uqJn+Sv9OhfZ/9IAk90BedAP3+sStqZKnGucwUFvMEM54e0auyPax
>deheGygFWumvoGoMWA3LI3DbeGs8AvR9BznpFit1v9iFoUVTcoveUCkmhcFu8IvYWTsXWXwfcwDU
>bVvbRgoDTtbBNfgIBm6zgOso9FTg6wM6iw5YcC+10skUAd14ARnYXBC93O6ifM0SYWB/CY1DChoU
>TNfeNZwCSd5SYRKhQ+npQxLYBevuDIPDBg7iDQrkQ3dbLWGPS8NX6D5/Yb4DA2aAJID60DEhQPf2
>+IX/q+x0QxhXjEBT49i1lUVZi+HkFHaw8LDYP+zvgyAsabq0bcYFCfTsiQH6i1pq7m4734wi/7MV
>/V/P0RNG/gxHU1VrbR4swdIz7WYQBcdDT/hgj1J92DvddTwt8bm1Agt0ETMBl1ARrg02+jv9idEk
>SxkOY6Huq4PvEAiJChR0ts5tbosYUTkLDxhAaMz9nf5V6wFVm9m0JEQQBm6H4RfVKBVG84WOELa7
>u
>7Vq36AwXl04UFUKPF UGdW8nysdkX3QkQFNECD87s0lUMY5cBFVTG89WKnZVyG6mWOhy32zdhe0v
>KCc0O+4PhiwH+0tLag4CRleD5g+D/gPK695WcyEB/vkPIBqEX8xtDXOIDX+Z9H1lbjOxfSoxWYmN
>JMgw35J3V+iWIRwDGBGxEOsE/Ge27iXhg7
>8KNwE2nw3enCxNCA+RDAMPgoO3I+FrvRlV9PBxdHZx
>e491FVbVgccQmNuLB2s5gtQ9GFs8xtlivPV2iUZxB41uwYv9QJJJl2ol4StcElZD63IbDu
>sU9hyJ
>rCYGBzn Hr6MYITCsiz9iB22/7bGeQSQlIOUSgxIYN6DbLtke/w8UChQaJf4fxAgvDYuEtseRU56F
>LmRlkSR5XETBi9HoYQ1gSxq4Yj3+e11bg
>cR3e2/tXCYDWFT5cit4dqGuzuKcFhECJGpkN3K1Dc2Y
>RpF81j2xJzq40a6vvtAtVuSfhKsftTvFUeM7xXRRIbfkJGjsDyIcFlqjNBA0
>SQ8q3g25SuZf6Otw
>V/cWDt86wGwedF5Tu4OWf/IA4QVEdUpTijpTvsFdGHRHHKV0jUYIaP84PF2fK3cYpdTtV/2wlegC
>A4837lZ1qVvPopU7bPjaWxxToAvWbMHcV8KRBXPJzZqAB8UPUdEAr2VfTfjIhvjSDFl/z0K8sh2j
>vgBAMeraItjTrc70BFEtvKcR0tdPhitOIXf/0WgFR HXrYY13BNFYajXrpEJXOuTCklaOd7adruaA
>EQrokxWj3NZ4ZEwRKItAfUkAG9bQBQejcRW1jUIDGPiBGS37Wf3TBGvAWAb1m/uV5WThOvmDev90
>YtH9djEuMS0F6QnvjgwLoQT5w4urqW1GF7b4V0iAA4Dq0
>K6FLkAyPK66M0hth3RTZxBeJAF3kMEP
>DDOKDtb0bRxgFeKdWRMfbFujY3t1xbsswBwM2+KZzTAIHRdGMjdc4pYFdePZiVzZPDxAsZLL3nQ/
>KFQU3n8VrHd4l4gEK0NZPBkWusFKvW9AmDeMVGuJ7XpP+QQrATcg3YMf2OtQxCtAD8LOFrKYFSqF
>C92O5CsGXitA3Esl3LbVea1hKxWLg7PAtjdoEXH36z4+Bj1niSN7E4oGPBumK2qyd4mA5HQPLc1Z
>13gN0La5vbaGtbDtl7a80ybrTo08Li gHupsd2Rs8DrknI3p320guB3M/tk55r+ra8C4uAVzsfArW
>QJYcGEa8A/bGUcPQokEjjZQGC7DQsDSARicBN7Ig3WWHxoXbmaGGBhmI3Ltl4QNDRw432R8DgCMA
>DMvfHTYwMhMQPI1ENwGAOByVQU5
>oxxkQBe2Bbsw68OY16xUQJ4TYNlxzxxQmhN5qo7ZRRw+UPlWt
>BDdqSV36JXAQYDB6C7X5bHoFC1z7XaJx7VNFxjkdEqN0BHAWyoYFOUM199ELW6nrC0wH/44TPDrW
>uiXnHBxIhCp/5OK9e/AYUyiLyysNFKzdW9C8MaN4skmM7zNut7lViI/mu4ATvXgifgZu+FOLxYvP
>WjJAWYkudLF3YBl5nRiUxBnNPTLIBoMqf34V7rNtvFLXSgcJCH/Z7
>b3sdGeRig1h+ CEF0XJ76ypB
>ILsw fAv9OX/FGg4Pioh5AwDlI7H/W8qHQKEZa8Bkmff5VRWCv41+ggx+uT0MMusdZ5/8bZwgVRUG
>fAk86wcIRmphCcd94QfBw3ldF0yZwS8BIGDrBa7RS02iEmsGOsOiCiHmeBa8NQEnFOIfdMhGzMCE
>g0cubMLURoGrNHzenFCQ21sY6RecX+K4Dlb/RhfMoDCD2uLGXbdKMUj7mjkeGtKvUKnfOJ0cdB63
>mAlagMazQS0rzlJcjQ/7Qjd HQDgE842EFUMneRss2AFvWUCF98RSq6sBV0T4zxY/E+a6qyDArzVG
>R4H7bKaT/toprDV1cbsNFvZm0HQjuNCzZznosJPYVrLkSGQT
>5R O6HBV6JIRCbuZ2dDNELJH4LJET
> QiwZEEZRe/rQAp35yzArxDgWUP rg41Z5ylH8aw5TiyC5Ew3f+PaPAlvpA0h58B9+DwPH2kCjdisS
>vsh1yNbF7rFUvYvHPzRFErIKwVEkODUKpsIwE7wCJA5VH3cBNtE9J38SDY2NtaVg4L4yy9Uo4sGi
>bkfsjLOCGGLwk4
>ZWDR7cLYt2BguHUGhuHDbXhoNayOLExw+nDmrD4i3Y2UQ96z9XFt1iGPCAZgUA
>lRwBiq+ZsEvPiAZkhKF8uYi1aB0khdFl6FCTyAR5UKGzJA14/g1QHzULtTxnLBRj/js3exPyKfz8
>bDAS/mbP2Twt/A0eF
>z38WSfbFoZJNP/X5OD+ulg48ggWF843BFlIBo2MPFpi1rat64iwhKnNbvHq
>ZXmY+SEGRj7Mphqq+CyEjDLMBsQulRwU9/YqPvXuu49idCdBO8p89Atog8AKYKT4aC0MDOf0JmSo
>fzVSQGp/UBBWgFBnzgl4LVCe777DdyEiVmMtdCNWaH9HC+7ne7W3nI
>PFeP T+lGTBFTi47fsQ7Ssa
>vgqLNtfofMYDf2tdvKEmVdvdvjvDV3QrOVD7b/xYBHUOO/NKi1YIO1AIcwJ47sNbrQzGY+aB+b1+
>CRxayHb/Hzle
>BHRcv5D8V1OmHs1oTw1LEnQZMmhujE5nSQyJ8PYwgj1P8EUIiU70Y46xiYkxu
>DWN
>fhDH3LOnanr/Hyb/dkJ1k7M/HTAIWUVXXxTPuUjOQF+n/PR6J2qPxDhwZP9ABOiarFGl xi/06drS
>UbNjI/GoA2YgGziZMs09e1KZCVdo6989VMlApxm8dA4shFfCQkXHzUp Wziz8mOSAgIY5bRNZLRD7
>NbsqUlligbdXna7Uzs4PYfQuxuhwMrWr7h8ESHEumM5QKB5eCRy8/X5zZcQMD1bGRgUBY8FZo/tr
>0AkCNDIAdgc17MxqwWoBwA9Tk25bxBUgfix1IMR/F22UK7u5MffxjUgFhclvVOj6fA49IBxeB4Pk
>N+saI9dS24tOBsZoDzWzBK7aKXW1W6yNGOugXXaJfuuhagXlDfdBI8cExDg6drPbESYcf+NorMAv
>bGztdoP/AQ+U7yn/1aFTNTNTdElDgHjxLdxbY3UNReDQDjoIfiZX2P6CSAE7TBxy5QVX3UL0DaLY
>gfugH7IZQjpjl163gX2B/VZ5R1dTWfRSW1
>OI/2Y74VQ78N1XP6EpGghyCmhq6TL81OqwADIUP0TV
>SZO7RDdK1CWcEz/EnnRoDmpVLmBoIAP4bIFgPBVfu4P7AwbhhDae5yzgUURif33YDD1Qcs9ks2pk
>MnzN99uMo+ejkASUw7neGzzAIaTMNQwQDH+JNgCefhafD7YIiokgYiMei
>xVtAogIi+3VokB/NvY5
>dQwbwUT/7e18iL8oFiFbiV38O95/ZqFCNNrYxiswFzT4yY5bwHf81CQ6Sf83i/RWCNeqXC0ZBAPG
>rsTuGJmLBx472E9x25KDbxMrVfw
>DVksDSSsl2v6u1soJihmIGEBBe/dHMl1gaytbAfKLXwSXotE5
>T3R1r5kPjlT6doh0 dnxNDFCAfizUaGPktEjs+kwzGGxfYV79W8wIcJvZiNN9ONbEXWr7C42NXwFP
>+I0e/y28dV01sxWFUM9+EwRElhwXKq+UEBfZzEldqBE3n3/tuRJ9I74Rz74ZFDCAuhgWQFl87esO
>txo16RQxY rfIfHIr/P/ujVEDO9B9ZTvPfWE7wVdPXAa/tTbYuyFIEk/Y+DvCfkO14k38O8d+PyvB
>DP8HfDZLbbHRLxYDzjvXfawBjxXREHxTEUJBgfr+UukeSPVa9xA3Njtb5sKXy4v7O30MjDGJizZ1
>Em1CX2gUEWgQFFgIuEAtVsCDxAZNdbU
>+41bqAMpJAAP6gNdgsAcocCjsbR21KNGPmntXzg/CrkQT
>pFNNFVFWOn97K9H0kwXwUOvIznYFi86JA0p9cyJdAU30iF+mN8K5X6I8JQgmiD0Igd9aKMrw6oF9
>9ACw2UaiW3B3GKNTUNnse6NcGNkXS8t1sQ7tamOSCXlflPZGQx+wzCLH98YfuVPliTKMaO7xYDKA
>zHwjsRXOtr9kzs8/CMZzAG+LAx0g0B8MLINsW+9o+kRgnvgODBYqlYUkBLxFny0rKDv75ANb69i2
>22/9R2SLT2AxdlX8cDZso1oU21VwhJdA3O4qB01oF/FzKE5Ec9RS/S/cFD6IVAXgOBw+gkY/DOsu
>3XLoPwwx1INFcIJpoPBE/01sCFYsDzcm28lgXwlkjusISxxga7WB7rKDdIHhOx
>jrNAF80A5gEjAY
>9NRaZVmWLQFTb2Z0lmVZlndhcmVcTVmWZVlpY3JvcwCWk2VvZlxXWZZl2ftBQlxXQWVZlmVCNFxX
>YZZlWZZiIEZpbGVQlmVZIE5hbThIwU
>Yv/ZZ1UQG 5Ra7ancz+p6HXbs/MxwIZkMxAAxYMmRXQ9nqt
>Il8Y0Dcb4OUnH5zM/j7mWVvHBYjVewj3sAAaow3vwP0nEIN+ICgPgmpZK8n/OEa3nmirLCA9rhEi
>BiyDd4NSQhXIQAkq8d9+a+gTfQcywIjh6x6NRDEtag8N+JI0hfAJKOWjdpWAiv13uQCOEdi2YEef
>CgmgzTaz8f9CW4pV8TxwdRKA+mxfqwho/La/WaKKXfI8dHUaD3guWAJU/n+bDmJ1RzradUPrUjx
>o
>dQX3f2sv63g8YSEIc3UX
>gP twdGo8cw23T5a3GyGA+1xkdRMNYnT 9xrvnTjxkYjf7eHRANTx3X3UR
>xobbvB5hdQx1B58o65ws4EOp4xp+aQT2Fvg5ZPoZfSwNG8pb7+L9R8HhF KEKOAnB4BTtc0gs/A0V
>OU4gdzPrC68IfJkonW1LiMZ0tTp1qntjHZ8QaJi8DgJ1CY9foBJjcOpcnmVXTthcsIvvO/6pPhJz
>
>wAzl3E5ZOTXlKbiDlosdhIbko9+zhVdw0wmNvQVQT9UFsxY/gDw4XPkZPDsQZw4VXRF4GMlyjJNo
>QGuk/VZ9tpUq+5L8FVB1I wCRp+A12TDgWDG7enUDI0/rER/Oio
>+YJGus173Q52bbcDw7GwjRAHSu
>zDCyfBEJ0pwPWr5RNtnFUL5UULeIfckrE/alzCBqDbvAhEsoiQxIIkHYUXZWQqlKQ0gnWOEXsbXU
>UC1ZeRn4+KCxvBxOW3XKA04ZRpu0GK8Npmm aXmflTG9jgqZpmmFsIFNllmVZlvB0dGluZyxbQVlz
>klRlLJvltm1G03DU1XLWbJtt19cH2HlK2dpJOtvXdV3X3EbdL94b3w/gC9M0XV3hE+JM4+TlqB10
>TebnYuhEvoRrE7Jl6jZM
>ORgSHeaDw93hgLB8e0a2HAAvNExmJANyGcRUTEzQKMEk10XYCzvsRoHs
>UDHXIAzhkWwa0GoFiBZL5EzqQPZUqb0RDikGBGq+BjawiLOs/CURjfckIhaKnQ3HfCdNnv2ID/xp
>D3u2Y4PGDkN
>Z3vwtHtAiUDcrOOjCTtmkVudaO1n+1ftrxA+mBVp+vKZvdruQFSg/9ARERUWw/wWx
>fthfGmioYVHr6KGELJ8Uz9J1P8IEFPwBwzP6/wu1yd280V72wgF0CtHqgfIgg7gWu9gWTQIJTgsU
>iPgO8P3A+eR826NBXmO1uoKvgQtviHPRGcFSigTQCH+hC3VyFLv30GuKFjPQgeIK/+0DtcHoXRSR
>M8JGT3XqYjqBIN Ab5Z08uNVRJDq8/MUGC6KjtzeBZtHpCAULwc1mV3Ds357wxgdmiQFyCtwHCrLd
>bPTw1Ads8IPAxDIEw8g13vIv5CdlQu0LcODdVgBGakIuIOMyK tT1azu7/+sdK3SrXt8X/FT4+334
>z9FsgLMX0I55GVMlrGGwe9c8ylE89S6jJzF8c6C/oS8WXnQjHe1Xzq2xBmRW06r4j9tpa6r9psYH
>9SAkAj0qyyBADISplme5Jn300f7J/Q4ChaAeCBBqLgRZDtkL
>iBbYm/i2RLzHJFBLAwQEwlBuM90N
>K7wKAAWOwb4DrbBrmpDAki9HE3Ql67qFcvcWlArEB5YXtiyY7 W68IAkwxgKfG43RmBbTZUXKRZxt
>kWhrCwcQFA3OIei6shCgOtIDpLHmK10PHlClQHjUa86dtqYCsooePDAFKMQMFb8NVBwcxVvLHmaI
>W8yz8CyfHzuHhIRHpmKPxjFauw0xYjNpGdCl+DlOtjCzwMAjKxhM1bLofC0y
>PM+Gy8IdiAECEowU
>rApzAWwIrlOZ7rK1xmZFNdgFBi+h7TaC3KkuB94rWF1Otu
>ez4AHiAexr5NiI0ZsVkqgEIYg8Z3Q/
>KsZepyw4xTozTQFAr5pliFC8R0WJS8USY9jxuwidbAVd
>gMc73cX/k8miHwgHdz/ /JJXZW+fvhk36
>6CZENmjYBi9oyOfn5+coaLghaKQaaJQTaHAVs+b
>nDGhYBWhIV3mXRbxjEGhEEZADdqlLPOouEUo2
>aDw9jH12ciwgK2hoGAeNVvGsEJAGgcOmO5h0L1lTHNtL0CiZ4gU
>BYY4UbxWkXRgBfiTdt4KRWt47
>ynQIJEGiTdY19ANZlAVAN9l/hCcDhdKJVfx+GhkaFw9/A/6AwmGIFDet/H zmxoQeR0CzSRTcvpCk
>VbSfIN8Nk1YcjXAKGoQ doW
>wgi0odt3papmmazhcDiI+WneBNZJqkq6ZXaAwnNEjVbcp+BEcYa1vH
>l30k0lp9SBKNnqvKF/DGMxg8fQC2BAJSY3V8JkqIU6aG21DmFjB
>vCYHGiOElww0IH9mGSE2/Wgh9
>QB+EF/4M/4vag8Mh234dHtv7f6+UPlpHO/t844CkNwt5W4a/4W81ai1HWLmgKYPBCAP4iwF1/8b7
>kPWZ9/8gzEdZA/k7+n3eQfdGMAzFqCpAEu6DPMV9AWj0NiAU/zTFpOmCxMwLvR9aMpyQg6T4MgAZ
>5jMgl/j8voh4hQmTV0YhbScUhzcDaAQnO/EQVg8fCSVQfBCFEG7a7R67IyARzQ98Bw0kER9ZQ4z4
>zdg2BX1RcsOZjFd9D136g8dKnUz2/
>34s LBsaebGHlzd1MwgDIOsKbJQM3d7CG4/3fNRsHgto63a3
>kY2VYwKzTmBqUB3JyYVGLTAZ8P5k5GXhIC1G8TvyODcP4QU2iDQZgwgDno+EJBAofBYW7C7hNfck
>FhIVfA2GDEGYHBsYmEGbBOsIxUGQoCGwIO3QX+Qu4nQhGUImk1kEtq90wcQOZa1WF62eJt
>BkllZH
>hgUVzvj9tmvDsxaEK0QbaBTQ0Dv1OrzwYbEdWzZyw58DqwVkM2ZqVbOxTt8JqlnfB2NJ17AeaDDG
>Bt0MEoUB58gQgKaofySczgUGqSB LfQfGhmu/n38gAYC+qFNXu6x1JDBoYGM/x+eIUzNfiO02s33q
>Tyb1Ujl59ECqr9A7cBDh2hRnNkMD1Qlc5fA9sLOFvSvvEVNYC5od3iosFvvC7Gw2FPpZGRpQMwdt
>bTxw+1SsrNRc5ocC+H qTZwoyqQa0e3IFqerSV9pR9wwi5ILff1FERpp65z0SHjDXvEScyVcFeyF+
>GEbUtFCLfngDczkGx+BEJ5dAJ1k8J3DAhh04J
>0VAmblbcYIM7B6tFuhkMAP4aHD/szOE3VR17XsE
>G7FvywfMKxkCD2g0JyZscOBrLnYjX94iBvsZrBUoDWgkDiA4IdjAlAj8UAc70EuER+KCEA+FwoQZ
>jy
>DXhC9DOKxXYjJUpgxHYJhR/lyR3hFsygIJc1BIfiTjQRgy8P3GZgdeXhOWJlOgyWjLl/M8aJBY
>0p3MUGgRR0EaY/6vV+rXCjRGM0/aU7qi
>ATgrqscEOIi+O7qmM5SesAbqIH3oSccniQPsgTuvfQ5q
>Q4Wz36p2HusOULDDFowTEQeC1gBu4iVsgCYAHlS3/wLwZn9g3uhEdDlISHQtCA50gbBAtBwE0LQf
>6gKfwQrPMOslJwRRIfTpky/DgcGg6+8wrfn9bSYxiBaA
>ZgEf
>CALPZJ3r5e1pdB0EdHQQd3Ve3DEi
>OAK3gsfX/7GI
>rlfV2JHLe/5CUhG/MtmL/ekjx1AMBybeekjDbSdoTOFWGF9PUAn6b1PRZ+uF4BL/
>IIoDQzx8dB73dBr
>i/KWc+xY8XHUcEgprD4gB/weA/2C7VHzbiwYgk13D PHv2m8ps+Yu9i9NGigJC
>Kvax7qUADHTiOAkNdevr1SX0Bm2jTUFSf4vRSR3cStRoDudkddIXzjv7wOBG68s/yesnbqFAbfmw
>
>mwjrGToHi/H2lDJ123Q3BQFKR3/VHHed2dH1RFQbw+kKSTwkpV0XbZJQCw9JgCH7Cf5EqTc+b1NC
>/zfHhimKHQEHKDPRd0BoRxT3W7gL2Xu
>kOYlSeE48IHKRozc2fj10PTwrAzxjNTx/M4AtoHE8gAtB
>KWSybtEQAg5GWzzXfSH ap37GBAYNBkYHlnj3RAp0sgxfgCQ
>GWGOQg6RpCqAKQZIBmaigCNtpoodb
>pFpQGCFqMLhjG65eUIDjBTh
>E6hC+WAQLUKG+lX2886XiaaSAbqX+ikwNvF+ICv4PcAHp/vdfc
>8Hh
>BMHuBAvO
>F4hKAYpIARgCPluWZQ8CBl4ZAo
>pADAa33xXgP4pEBQxCA70YIrEVznjrBQwsxWQDgVcu
>cA2CRYPoeLmIr8IEKGDsASoVF/598GE9s gALcXImUFdf6K02AlzoXD
>kpkyEWwJmfNYtGQkrw/77+
>A4qEBSuIRDXzdbuNVUF6Z6oLjlaXjjm4uAcGzktq1zAUkAH0Flpo1H0JOZcDGB
>Hmdk/eDQR9DQ1D
>BApDDOtbi9b4NfiIDE5lS51MoYi52HINHaggNoYQXXsEcp7gbVefAbvwKURWr+d0KoifbYN2o3ME
>3T0IAvo9l7 o1BEJ1HzwDEwSlVomGcwzhE3+lqkI5arTBXHc3+t6LnLe0wI2ftNBlY+Ug5ptQBbuh
>Z4xxD1IP2ChQBMWpQGa4GuzotnhtTIdf06wUVl9vpw1VLQyqKP+3VWi7VqqxoBbVlRvAgccRsAca
>iGyQFpqN7SZHHGiIFdcYQ7MGyaDyFny2LaxEEDNPXycb94COIppZT+38bboo5XiLuNto8Ck1VbMD
>krFZ06K3vc0kVwXyuJgdQbPvvWoaVFcKyUav +0FVFICMIlJcX3BBTLlS3F
>98BblRY9G5hCNWBTRR
>5ibrd kZo+KtXVhhQDQUc4GG0aTMJSMj3UhUr
>5PMOdIMR+MDDU0h FueGifZ8aAa8BfghFBw+MCsJo
>JHfAihvTQPiPiZ0P//HUsrHKRppGfQaJtVoJOXgb3gn7c6ENbvh9RPiJvUT6Quw7c8AfXlkMQQuD
>fJLdC
>kv1TcONtU/0qMS3q91edXOLsb8BP0W49+ACLW0FnyNhI2itBwwTDEB3u8FJ9RVQD/QiiBhO
>P/xmJ1e+Cs5YkS0nOJ0niSPU6vxw6/3WOV2
>OxBdsNwmQ6FjrGKISlMAmPCFyQcMKGTG4ADSUOEex
>fnJW2IIW5whRKQ4mwgvYxRA4PZk6JFFuob2/qwXsBzJFIWKmx94ufOo9ZBScRgEnVfQI2sGA0n4l
>E42CyNYkDlgyeAlXgxQzSQIKdAoADcClWAPD05f/HEBz0hRUloPI/+usIhWl947CW4sL1eAJmXY/
>MEUbOaRiV8 YHMB8iWtWAmvagy2z8Qj/AO/BXImPqR5aRbQgIWgxREA/foPvNjkiKBjwNdAyOCHV0
>BDwJ5mqJEhMw60ImKxEjzCr+NCWaDm5iRjI+PDqQDQraBvVmKgIEFz0POEAN
>9CWJOIQN//AQfCLa
>ziZJzogQPoH5jY39XzFyvusBToCkEgBdz Ll QB8IVVEEA/5ihtejTfkqpDwUxV7sOJDgxMkcNu3uV
>ODp1YR7wI8VkpkYP3BFA7IqeuUbSygFGdNJPiaZzTVgWwblhX
>UIfy8IfCkI713zqdQwCKEK69td1
>HQvjNz4KdfEFDCpdaqPoCQgwDa7rCxpiY64gCxwHBjUNHNEWVFaFQzRQDyPqxk6NCuENNtINAI6S
>NWP9hWq5DXWE80cEi8KKCusfpCjULTwHFzg8dRT8rG18Ej4fiKMV8YAiAAyBgSDbRj4MYuMGrPB0
>MnsQJIRpKNBRESwGMWsYcxVExK/pCIJEv0DrM26pxkpSsoqUIKm+0Vv5+gl1E0EHOX8Sg9KNBIAm
>/L+ X1ERC0B4wfemAOS11GWkd2dSj+lRatH+2gAZBeptIvbzo1CxyU
>zlCUBYwXdwqoLrfbORbhVYb
>Q10xJ/yz5pJDjBAuG+o9AWYn3YqNBZPQFY55
>SQcxAFyAHxLlYIxAU5b0/SNyVYdqv+Visq4H2IP7
>5Pwti4LIUuen1lNRQF/HDxaSAQQwdfjDeWHNAm+AvnhZO8ZZWpc93WyrE89IjONmvwXrdt8gTjGI
>vGh8BFc322zzzcQ0fAc9K34vKyZ4ebaRPGxaPCvBRZPwjzE+u9UaYM23gQ5kNlR
>TNG6tTnMHv402
>+gCS5ztEMTFMPLLPnD3VACz
>NJTQgsZHuWeG1AIaPqiILBh5bXj00jGqLqmXj49DrD
>dYbmg1CyWhv
>mfvn+HXsCOxHUejdBkIR6+47wgEAgwcsRBEPAY/Tm6FykM8FEysGftGJyBBnfkYCSd51Rd6gKgVo
>LCrfEQ7Y/GqZfB93fRjaJGBr1j6IEw4e91ngjOiEr/yqxpQ4h1FCkST+04WHT+m45HZQg9gqI99n
>Q8DcrrAqaKhSoC1MmmMXXP+YNSQX0IIG6Z/WAbGAszNX2R4HY0jJS
>mHw90GM2IcHEBBe1jj4t
>shE
>31cf0SbYmawVk
>kr8s+cjfrxIeoIAFNwo0WQBe+xyAd/s6dLcV5848LwCj3p95z4ciL65VJxbUOB0
>K2oZLXIE2Q7c4bK5VJiq3qn4Xf2xVrjtByD0sJ1LRMMeowDv9HUYunIAjsrKh1UbFoArSP/vMV7S
>XSdbD5T2FAMqIXBbDQ xLVuw9RZCTA+lR0Azs5gL5POz87PwFNG0eal+7hEBX1exdKEyM1pw6ewhz
>yciT8PB0JOwMxP8lS+7sdESLG4Xbdcch1I5DC98dukqD6ONA3b6qQkh0OAIuSNsEBYt0Zvhp/nKj
>H9CHD9PrJX5jc0MYsu9dJuvXaOwG0CbWgEX+NbEIAHRYjadkwADIN5wv9965eHwPL3dir4ClUDdO
>LaO7JGCPWRVd4geejudAM9ePaJF0YPc35/FBiIwF/J1APfdzEQA2X3wYJK4XV6Ae1aaOGaypiW1H
>gVkgqMSWEyQMIAkB7ywzWFmRu3T2gtt2QiGKefsR2Fx0FQRs8b3FLxjGhAUiXAUFT7PPAUOvXD iL
>CBvIYJErDQB/UDKYwM1pq5bBSFy/a5BWueJB4iuS2asOMVbClyEYVs2AG5vID4aVATtjY+ Qmnxks
>NwIxwEAPgI+OXxEADnSa3h/gd6pGMUZmWEJgh0mqwRWOF12q8zRXVYnzdc4SvudSNos11k3WzYJN
>RsCtU5uzZRCl7Gka0/GRAev4dFoCwMJ5woa+U1EdjfjKkkma7usooVP4COTlbFgXoV3WOV2CyyZV
>z5pY2oRdJJSVZGe/m
>oXmKuUwuxcGQ5EIts29qPOrTqhXqg2ZkAAALzr2pVeYI3tAOJwFLfY7M0hH
>ISQ2pxQ8sz3ND6iIJalZI MeGdCAYDTAYI4MQeawlMQKoDyDIIMB8RHAIwXUPFjt3NvvXKGPXY3hZ
>V/U1UDzAw4pN/RA
>rtmpEDUOAC/peVlv8qMAtUQvXuIKBYi1yEA4XIlGhVd1mOidTZ hZKDQMlZEwf
>w/CyoJNo4CdqICdI1gVjAF1+3KK/ALDSX4vP9/G4cxE9DQ9LACy44FqEetr8t5
>wjPFkhBXMHa
>IDr
>3F0T3qxcOK5QcwtYhLsLOWh0LCUgGmdX8nk8cyYkJzI1cImR/CYl3CVpcNwANxtUcwZgNXv22HUE
>Z95oaDssCdAZm8yRHi7XNnxQgfrCCn9SJifjnPCEfSkMg0FyKgsyPsnZk x5yFxIUCg+DqBq6Zig/
>xkfpQxweQt7cWYoCOGjYKzxyE7fddkpzZULQMOtBPwcDe3glN0homPf3NgQ4Yzu7bOtBWT8llFjy
>UpzAbJAzGAM0BAJ2qdxoSEdXS1ADJSIMOwMYlbtFwL4kJVgRMKRqGd
>UFA/n9MCs4KzjNJRx9gPz+
>BKjORGB4uU0OX59UwgWy/yX4eyUARWGGALIAJ4oiLAOIEqZpmuZQAISAfHh0mqZpmnBsaGRgXGma
>pmlYVFBMSJ37maZEQ
>AAIFQcD+JqmaZYU7OTc1MxpmqZpxLy0rKSmaZ
>qmnJSMhHyapmmadGxkXFRM
>aZqmaUQ4MCggpqBhphgABJpld7oQEwgD+B
>Pw6Gmapmng3NjQyKZpmqbAvLiwrN imaZqkoJSMhBNf
>NE1ntpcTA2xkWJqmO9tQE6t AOzgwKH+Qpmk gGAwMG9FBQkF5dtltAEUDv
>r75QQABQfL/7iqBBE9e
> +09B9UiMYPlADfv///8VKSgyYTEzLiYzICxhIiAvLy41YSMkYTM0L2EoAgVg/38FDhJhLC4lJG9M
>TE tlQQD7J+TtEQQTDUBCoUFOQEpARszr3pNmYVExJiwDMd2Qb/YFF0P3PEXsbBbswTMeDFEH9rfs
>DQYAT0VAQQCbhE9FFB EZca hRxCPdZCPKoSdwYZ1c2WD/ WycBc0jZYJPcMfxfJ6IRRHbyAP7/j6Xh
>dSdgTUhDSATtP3QmlEKCYwL6sjQ3tyJWaWdMvl7r/7v/3wCtODMLgAN6Eziq4U6+AEYK7B+QKtkH
>wEH//f//jMf vAbjLo2h73/771Up2VxIGJK1P6yOosfzMGef///8O7D7vC9pgGpGTymfaspbnUknw
>K6NQjmY1YOX/////6kF4XM+p1AutzJYHa1KtElBCmUSIvUSpebbI074jovT+//8/QPdhb1fUL9uM
>TA95nKA0DiFdsJoqJDMvJC3//4UA2CUtLba6/j7OY2QyY0Zkb3lr6+72OW9kIrSGVjc4by1mO1X/
>+/9/Iig1JEE55SuWF/aGqZoxYWWvj1b8gO5OPbS7/f//a4fGBlIHcelA1Ae8mdnBKO62Bcrw
>Gh3/
>liP/////HchjUNE
>q0jDZvM8COOdgSfUII2RftwHyAYEQGx9n////z+uG96gcUW6XElUFQ8Cn4JmJ
>upKmp4ygYJdG dv//X/6CxkyUtaxVt74bBESooui54q69mEPGyw1rzAP//8P/eLu+wLcwxmMg3E4s
>TXmkvAWr/+Xojp8K IQr/n///+rcx/f7/hz/aabtm4KvEc a6VRFzJRXiRlZikj/z//9iap7k9414k
>F+2FBWNotda+awLmYtV44dLz////vYIYGiTTjU3OPLWuvpAcxcQOP+ku
>oadtv1UCQP/////i4FBJ
>D8M/ErZ0s3v8+pOWa9CSx6pGTVBX REhPVUVK/////1GPdZy+VkdLTlRBQENCQkVDQERQL8S
>aRERH
>RjZuQCQ1/////x+at7egCC81LDUGQwIuL0kiTyW+rP6gEjUgDBTMLWXN/7/9/8CtfUR2EhcWK2EY
>coH3GbHM/Pm8e3KasuqHxHS3////v0hAR3a4Pho5cg/ BZEHKhxJqh
>hH MxXx5bpb+Ebf/1v/KBD2+
>MUW+VMVRRnqCyAQtTs//gbl6Bv///5gbmry/PZTMxHl5ESnTUGNputBs2VBuZTj/f/v/y81EHbae
>nr/BuB01um41TofFRGMdyd1EeEaa/////z86Nsp8YWgrJCs5Qr6WwoFCIyVGIazyPsoMJU7uiRA M
>/////ykZUGATjC/7mMx8TDXChVljt6j7/psrQxIrQin/gVpdEv+3/7m+7Pqc/rgpTo7KPD3IHCX/
>QUuqUP/f4P8cMa6kPro/ZcoUpTHCoz7MzUx5usvVVOD///+xtrc3unFQvgQxQyV4RD2dzGESEBEj
>eir3Hrr////f2yk
>YWRJRF1CemUIgNlk+507Bj2FEllygyB5FKHn///9v+IFTLSfxNil0NwxHvvKe
>WsSpeOzMBPlJWYVVVun/t/itXK0rHRdbZUk+Trw
>mKZqNsGkXI7/9/397DUTVTtyt7OBaOgGtUT2o
>BxgS8kLtQexVSf/////lPVZLPkSf5+U/EJxBLXpgmJ/
>2h0oxN0TKR6ctghpq2V/4//9RuGVaTs2W
>Ffd8mHFd1kI8LV7lzJe2ok16t//////u5bgY4p1M+B3p1UHXynR5k7HDsJdreaIRxy55IJRNe9D/
>//88UStQGHSDL8q8BBWGBFEFw kYRmCtAwSyM7P///79NTFt9wCeRASWYP/J6IcSBNVQrvr0VJYwl
>PSwZKUy/wf//l9ktHqK+hL8fGsKENYiCqsyqS8qtwq1t//9
>b+watN2gHj9FZdVHT1lq+IHFKkXqS
>yBS5DP7/l/6GQBbKvq6HqHOBqVBxF k0WSRQYwgy1vsIkjt/gN80K9r36fqzFBA5FYc7/b/z/zL0l
>ScpFgHoDTTUNcpOoP1DKNLl4Rdc1RAP/////lz+qLw 49skJ0YLXEkz1MVmrErIK+NbBFejWQRTdg
>BF
>r/////14sYTDHSbAo/SU1ORxKX//gX8SsYQ3pGPdhHf7ku9bb9////gT1XLCaOuchF2ALCulEs
>5Rwa9Cqt0 bVBk6h+mY48/7/9LzMQwsFCTszCT+lmAPacLLo8KsoGewwPfd9Y+P+J K3o56RF
>yc m7W
>0IEMGAHMQraKVf////83eBbVX014cT9RUS6sLprBdk2otnB6lzxGV8992QLy9P//v/CzPu08hp89
>z75H2zL2ljxFdzJytxgqFGlbK//f/v9J/1RXXXe3lbICtcxVcS0hVlw8TspQwoBFyBXE/63//5l8
>rKtzNH4tQJVaUkwYSCsnb1mo30nJdgJd6P///8KHRnqyPWfgbPn1MZq5YIVtgrAuJ/c4U3wY GPgF
>/l8PscR+A7RlEsocSRf1ynEXrc/f+P8XRYy+Mk1JU1nKucrEvj2q5186dsoP/////8sFuEViMsBK
>WhrR7EBFMuBAqJPsupx3TvdbbIZJxftE/////wlHTScv3uo1fUj
>E86mdfyHv4pOdhQNhTsPOt4Ie
>JlYR/////yZSyxggjKo82CqeOSAbGHhXyb0/FarsR6C+PhgIyouA/////6BCzH1Ren88Uso/RQGO
>sV8/IHh4Scg9xJ15pw4Pg3LG/////3mdMnS9RqCv8n5LRz3vmKpREkZDg6pSnlnFHklEq2oXN/7/
>peEdxLc
>qEqqeNWRnRqHKB6AsmbN1/0b//x4JeRctTykf1l91cSM/Yam7dnKc
>ckti0f8L//9QTfSa
>LBPN+MYBTUc0RZWZGews
>qMqJMEBUL/////809+xcntlxNU8DS8K7AqtfH0aoSa5egQGquf91FsdI
>Av7G/0uNMU5qSViuS9FTH6DrvMg8sSlL0r/ 9N4U0r
>dbdR/LsflYXTwSvw9kMtL/B/9JR9WDzLE69
>xNXiyntiLfgyQP//twvOFkbluLhNmZo9WU/KCE+YRcLdvDlc/////06qU24yfFL/vzFsYSklUMa9
>LLNYWMUavY 2NNL0cg6cP/y/1/
>zNQUlB3uJHxyIJqYyrZHx778JTDx7NIef
>C/wP/ZNQn/lXQEMjG2
>MIl9kRYXPPnMrf///7+E3mtVwHkuP1qZSnrPZislfrawBR4yS+RKrOBx1Z30////CENFooL36Moa
>YyVlZxRKPWWnsfCfcZnPSynZe///y79BYb52nr72zkZyrNbCir54aRg/fnqcPWE6//+F/w36hbrs
>sf8N mf9Sef/2gS+d9NYs2Cy4Gz1 V/0v8/3BgvnWxNyC6YOQ0Q8qfS5c9gBJc7YA3Mv+/wf8EGOVn
>mRaJr4zckU60sXq0wqlCECldecB4qfT/v+Cj92z9nfzpwr8BekdJP0L///+XTXf5nOPFZb4FQsK4
>4U9LLf6dVRE8ER96sT8v/xv8/7GSJV4/dvo/ZBhL0l1U6lauuz4KPEAHBL/R//96rz2aAu1GKYVI
>bByfnR5fw3y3MFCBlUD/hf//TXx+DYbOPlEp0R5Aon0vvSnaxJwhq26vwnj/1v//bTVL2
>81dk+5H
>K68YSY1FTYlJQHRFvSbRp9b6//9btz9gulQQcz7bUb3B5US8Lwdf22wEAXnt3/i
>3rpeWcNGATClu
>yZPCLzdXIs7//y/0zilTXTdJ9ElxY7rYxexx92lUUcCDsWNT/////1ws9xMXBN6VF3OEqdkowpAB
>QBivZnz7HIG/FZ4ShwSF/////0Icb9aKhC6HJ4Y1iTaIIIqkM/hWizOKJI0djAyPLJZt/////9 Yo
>jiKRkG6TMnaK7yjbkpWUl2aWFpkc8p13mC9emyWawAv//50OnIwzmjRqn16eAgKhNKBJHJY13f//
>v16laqR+pxdOpqr77yqpVqhuqwaqfq1emkSs////CyUTrrEvyRyw97XbLJJ0tG+3tjffubjZ5/cq
>/9Jf6LtSujXKBZZ7v216BIH+R08Rv0v///+ubktcRJBZwTnCgwBPMlhVQDRupyx EOogFEdv/v8FP
>Y+3Y7IA05oFZQUlJMaKKgeAnJIW6//a0KQHnqY+WhhMkJig0CjJut///7TOBsAcvkkqzsjeRKCIk
>DCbb5xEzLm29of+//f82dzd+vDI7DfgMqcbAiLFPCWyBbSFXG5HGq V US//9/613kiH6mcRmBbCy0
>vDRIAR/AhWCCIkb2v24x/////7ornxydAMhHjgEeqjuYAc2g4nhWA8gAUYGGN4Y8VmhF/kb//0xf
>Sk0NylxFC1683sInSUF P+aFeObqG/7/xtyoxksps7apZN1Xa
>DCsOSim7Wjxjd/8Sf+Meoar2aivy
>Q6MHdJR9l/RahRbb/wb/EUly7Y80/ilwIlwxPgTpiKzsAMxb/P/2bk2OEeJ3XVNDDve+FBTIL1nI
>5WH/f4mFYAzD8ieeK7A/WTNc+f7yqLch/////+zjWswGTiZZe r1Hj1w6STNLlQbISgZ3+vGa9z/I
>IF0k//8v/VFyrQYUSUkM9mEUXWVdhk0RgnGt0OygZFHn/f///+U+SBabgcTxsarELhQvmZeYGfpp
>NFblg+FWwcPbm3+B/y9LUbZGGsq6dQIlPpCfERGGUwsCSf+FC/0RbK3zLsHURTQ4FG18rT2g cUa8
>0P//RBIpUV
>i/3OxgnF55/dHfcfP0ZftA8S19gwuLS4AVVLtbgweI////CzYSy5nLuj2wt/4Agsq7
>ypCAoVEnSICoQ+DC2////+CETf+y6x4agBzk9J2+GKXCP01BNLOGB00DlJoSX/r/U+x3IachU 4IK
>PkJve6yOghILOBQq9P+rDzGE97xc0QZ6uCRn/xf6W/gfjklCB4Ls0RVgNzoxyOI0RP////+VeQdJ
>YovUm6lqiQqC7mvu9lMG88gf9A6q eP7mBodOt/////96jj9HCp6AokISmpHZKr4DjsgXRTXzyooB
>dAEyoIH0GN/a6v+DJuSJKpWELFBhPzzKDMBa+xX/////ekoBNXqDPQjZEdE5ib4f6PlTnDbaEVUY
>hHrKhraRh3L//zf45v/stXjHPGdTdlFmPcpeLHnicEcofYAm/Ft8qyoMTxeLR+9SGEby2BcU////
>L5QGtnoW53NGCRYIeoA1UHLi9CxKSosCgzZ4LbyJ/7/x
>Fx8rgx9FzPPq6r5PHgthCqwJBsf/f6t/
>uuH6kUN5v7n4ZurX/McqUDs5dTsQOaH///+taRD1VUYYC7UIrOstsTRguKnApOeiXogcB///v1Vc
>NUO2lAT1uPYsyMj ehv4NdDSQwmdB499ooyukWSIctNVAqkeQiv+//X82XQw0rxFqXHC3Cj2thFe2
>k3CHgUUINLU7mv8v0OKvW617aRzML0VfhGGo9AtC+m///816DbqYrzUcerzfWSOSaB9Jx/o
>6WTSu
>N1Z/oxK3Cx/674RsIFmtfL4X+rf6ahks7tCfHlldDqH0fn9FD/////80mm07w2kSSsOFR5oSeCii
>8yF6AXJNKrk0A0YgejHmNP/G///feF9frMNXrBAW6NlKPJnl99u52k1ni+X0m///v/ScldvKDVTI
>DaDPi2UO5Zm9XvY799CZuSVZgv7/pf+bXz2RZ1yd8B6Q2BaI0OcnZSJlnb+YXghf1OD/3wWRNQwW
>zr1D
>vep3cogeyL1m+t/gL67J4HYbdV/5K8yhAH9lGpIv////FwQ9po9e1J1RIXNznUkCsZd6Akpk
>VebCPEQYPtv/Qv9GrPO1C/LFwyl4TRJaEck/lnbQzf////8uhSPFRnAtgKdDF8DDDnzM/Uf+Vx+k
>
>QmMsJMqSM mwUMb/Fjf7RoZp4NAggNUkqbbgew1n/oNTb2x23vYk/T0TSU/XbG/3/36a3QltYSYMd
>qj/imhSjFZ
>HcFYkVR0L/f+tsyAEXrNuKSXpOW2KWL8yfQYn/9N/q//LQIT3eKSYhCUMINk0/DSHk
>AoL///93LnF6DFGeKcrxof9nBkn6VD2pYE1dGdxC0xT1HP/G/1vSwOhh+445iIhy9zVHQhfBQSat
>a+n/F/44ur4cO21USNNdXRg5FxcnHlUdwxp53/r/f0O5Fgd6h58fOWqC10U/RDO1NQX8Pn4Mlv8v
>9P9kSBfcF92VEvaUrurqUdw8vTdbVFQZF0b/////kzZUcM3W4Q3vquoSJhgx/SPMtlWIAEUXd/w1
>SBEQblXV/x
>v8RFlsg1mnqdsxsCUnzSaF0RbhNyjwv7
>/t0bz8Uc0X6YPGrctAv/D//8WdnxGLAKmE
>yUAzq0QyWnkphi9LRlpqi8kU/7f//+IUS1kOzI8ir3GHE4FY0GUfvATNMU3mCyctrohf4P//n1dS
>DjSLT0KpJN07B/AYKZTMERRjSvH0/i/0/0ET7PRjTfmEOPKrdttygXlCNWABwX1Cv/3/t0O4V0KC
>ywm+MejeO+1N90aHiiFAo+hXX+Db/xxNqdALEhMi9x SOROK9YTisgL2u3+gv9IBVPwtZuQr0vlPD
>e0Spfa8v9f9b/3M9S7
>6c/nqjgHGqW8tfW1LB/7/U/6DpHreY2FqIWjZLtr64YVgAQot1yU8Hyf//
>v8ShYh2FTr67TTT4vRfQ2bEtJRmC8hHC/gX//y/1mlVBQnpAYgQmhgFSzR4/OuqMrkdJv5379f8L
>/9lNNxVzUcksTKop/Bbq5EFLTWCfe0v///8vt9mqErLk49cPrBrETQTYUxg8BamM/MW4T9mkR/9S
>3/pEOTZTmvn0rWWIQbXSQuROYNXW/63+d22widk5Q8BUqk/RyqWob6FO9/4LF/iZS8s98dQmvmdN
>TMnMPrq3/f//pVJD
>NWgKNVZDSraXSsxytkKHqmlkuT4q/y/ 0S4iecp+qXEO2kmKevIP6j7xiv8L/
>/9tKnkpWTp/0YrZKn8+e+RDLKtfM2a9CfP//rf+AnC/+sRhqDGkrRZKvyk mSoUWtQpzB6PqBf4P/
>/0qx80Inw3MfQONtxOhuTHp7YsDXGQFitf3///9PR2Sf I+hJWZkKypcaGaKDmle8ecYLNLcfiIM7
>NJn///8vdHYBUXktbG7w7xb7UcqAQm2Y5CzAbkN+gKNCreP////IUzIOnpmjA6ErAQYe+lxAD1X7
>EaHkauieMwyS///fqlNVZFcQcbO0y1VQyVVJADzJBy7TM7P/jX7rzAi8gmuEt1oXQ4IyYcdJIgNa
>/v9f6q2n6ECAW8JSueHxkMT6e
>Bwwot6eN57X/L/UDZ4Par9VC8w1EEKWy0Xckfi/xRudS8lFjooz
>tEYcngmAdZf////fQU5R+AOexGz393knR87rXlH8MGqm270Y+vlS+cH/v9T//IyRLgkzQis5GNUQ
>NALxl0bOuRFKUm4gfOv//xljw WoVzlVHyPUBL1PNKhZUBxoSlXpEo/rW/2/xXAAS6K9ESUZ2tKL4
>NqB0huJWG/9vlCun4EFcKIG8wbYWvwK5RP4v/f+C32dOJ+BDWoD
>BxI/NiT 7WuRjZoXKAgh1///b/
>rTLAoMT
>s NN6rwLhES1ckRFe5LDxN6f////8DVka/6FFkQs6fn0exvnxFUe01EQc6GTQ9ghAX/+Ej
>F/+N3vq3NEpLGBnrHbOe7VsRCfYdnnvf4hf4RCMZqk4KXxC+eWbpkbaZWjf6W/+BQh8Y+QnuSk+1
>fMfRK32bxi76////kpbMQFxRUBFuRRF1ts+vLFmSH0V O xOPqanEaug//F/43OXpgU86s
>xjxR36RX
>EW1XNDjKURbB9Lf47d Yca8N0EQRO0VieISQn36f/X+JvLCdhp0s2GRkbwFvi7RFaQFn9h+1b/P//
>UIkUTGWfOPFcVDdyFvkracs8KBq/G4Nf+AUW+o15iV
>t6Y0MrqRuABqf///+XVWFoX5ApjOVQtBl7
>kIMO/yPUUWIfqxvESTKQ/V/6/5ZAkKuNLDL1EWCrBL12uq6cr07+jmFFUP+t/ktlcGqA5H0GJ8BR
>nuziNz 2lCdj7/1/4agfMwwbyMfqes/tHEglrfUdFAZ5Cisk+jf7/fyy8SXOIJ7aYmgv1GitstJOD
>HANO3n
>T /X+D/SDuAqv/Xj0dchNVsKjX3DdZ6hWHKsvwl/////9vY5emXkHeJOVGSqUq3mrCc7szU
>V+VxXGNPFKlLytxB///C/2xgXOuRTW7xBAYOXan/TwEnNLrjCqszsVQt/19Y6LO3BOr9GDV2zMwE
>1ML3iupEpn+Jv/X3yCIJxkWbE6b/MRBBgKspDDn/////NKjRJ2uhn
>UrrJKax7k1h1X5vDl2s97TU
>pLpRYRAdy5T//2//uFoKN8AOpzQTBahFcVbU7pqy0Q2uPLFztjytrcT/X+KGh8LhGuBQmry3x0j6
>oAYEaEb//9+6Ba2e
>qKn59PAmHkhDrX1wqnyRtyfnrK2qX+L/pTGxQnMOKbhfqu442c2NNR1qLlJf
>4P83PHOBpMkEpcMx/9VaOpy/y/+/wP9QPWyXnZdZTSGcR16rV+34IEQZYUkcpaH///9YL255qmc8
>MRhjNKTuFTdY4FQwKY1BQWthL/+/1H9Iv9qna
>c1RQKUgJQcoLSRYQb8fEiQ1////RkYuKC7yt+38
>ThYzKEZbAjNkSi6kHvc A
>Zn+pv9QGFbgqAi40TC3PnLeA9zNXBPD//y9WJCwxEWgpTAnwfpovcDEH
>dyRI 0i/1L+0uImO/p5+a30kkMjJVYJe4/f8yJAkgLyUOf/qEPkUkLyIg/i6/CYD/VkCtJTQtOQ8g
>LJb/v8B/JSUzgo9DpwSJAOotlyecFSlHJT2jP9b///8biL8ssjE4DS5dDSgjMyAzOHPEbpwh2AC4
>IE4u9P//MxJJL0zB9iYTDiMrMFUEOcORX7wFJOtL/AUaLnkoVwvYXAIXIC3E3+D/f0qG9yRtAE4O
>MVsKJDhP5pgdrk515zX4t3+JUUmxNjIxMzEnuj1tivN0sU//7nff0FFSdfMLeEVWSECDCVNMQzJJ
>t79I/xn10jg4Lg1AQyJPs+UYZUNR/y/9BsdBJ4CPj81aRXJGGXYatxFNe6X+//9pUUYRz2RaR0It
>bhhWYe1XQSX9X/FOSh28cKv/xTkEJ2PRvzcgqkVieiFvJf3/Ly0DIPalKk0K
>AVeBQcEgukXNcUKP
>zIkDeUYUYb4hqGP/t20RbcwFgb6+FsKMvqpR0QDLe+P/jUcyRgZAmjRGyl/Cr71PM6z5QSvdDtgR
>UIEMMq4qDqUuwQcypXCIczNM4R3Yt7pJPcKONTXIhC+IwkL2hAw0YQAcTAv8t3/CgEPAvEGylcKQ
>QMxVbs K8+U5K8Ubuy0MDlK S2qCKL/tL/DfRDwoNFyEbChk XCCDawQI6oDZfYuu8WH8i2+DWpyylt
>zUA2wcJv9bbBfkBWykbLHkVUqTb4/b8OgVHHhWi5waqpQLE7RMhpmLffGuX/TCNIgTUEyifMxXXf
>doVxGOuyER9JvtclC9TL///WTkkdnci4OEZO9k
>YGEQb4Fgmz7xQpN9u/MzdGyELCgkWqmRAtIKgC
>RAXmqvm+ALmQW6MDEyUx2CFphqQ15z3XXGCb8MUxV
>/2LH4MMNk ibqQe3Sar0IwB1QQoEEw+c j1H/
>F/YFDQ1BAAUX ABEIA0EUErnJB2saChYScx4xbYPVak3uTgANBlyvL
>WjwhyKBrGAsttUPSCgQDEHn
>arW2wALOvzsNqEr4LzAoLzUnAPMURVhFRIGAwBqNFggI5AEAMAoAJFEFv2kmIKgcAUZpbmRD RAGg
>8mxvc2UbRMzeFdRTaXplF+9/+0xMEUEOTWFwVmlld09mD25vYW8OVW5tEC4DcnMibnfDL0tF
>bnYQ
>b252q4qOXVYiYW IYOYi4HUQMdmXa7pGKmA59VGltRirirLVXGgtRQ6LbuvexC3twXmctTMNuXyB+
>TGlick55QSH2TFC0UGMoS8ZEObb9Ym
>FsQWwGY1hMYbc97FTTKk11A3goG5u1W2wXcmMPfrB0EAf7
>51pWHUZDb3B5xURl2oc3awaDFyVIYecLIN3CnUVTY9l2O/lsZW5U33BQL2gNYQsKw1crWEQds7dF
>RPFvypG2UMTJcHlNkWxbdmeCIk0TRXhpQkHxYt1ocWQf8b1ZwCb/L5mN94YNuwVlcKE2Qj fiwsOw
>M25anGVJexFxosv7F2wg/F5yGFRvkxW GmaK4TKkOvCV7E2IRDQhja0OFb0
>9EcgHjZGVDaKfcXURs
>NE1vQnl0IhIUJyKcnrmvtS0KY5g2KlKgsr0n4VRHUG9pK
>BlIe8Fm7XBGJly9ExmEQ5gw6DpuRUy4
>rDBpCWmcFqQiJgQ6TRgz1zhDdRh9GTokOWFva6VEZSyVhCDFlWi1xx7jm8BnG0tleQxPcOvco2sx
>C0VqDoBWW70AGnZ1ZQ+LzNylhBEpdW0wDE+zzSa3P2TC+G2gomFuh3NlMIo3F2uMchD2B2lzZL32
>XAl6 GfLOEBSieK5bUAgiOTehKzMqYSohAkoPZrNUzSABoVVcDxaw305CdWZ
>mQQ8LTG939hm2I3d2
>SXKUI3cKhZtxWvTMDE2CwgCobVm2Tde3
>2GJA/wQCEwtlWZZlNBcSEAOrZVmWDwkUczm//4S8PFBF
>TAED4AAPAQsBB6570mwTciqAMgQQA4Js
>Z7GQNQsCMwSZW9LNBwzQHjR72RvYE
>AcGAMB5CEC
>AW2R4
>AhgFRrjCditkeAEeLi/Yk6CYpHCQ6zZ/u7AEIyALYC5kYXRhmCPuQrrB+yIn
>dkC9zWAbhS7lCQDD
>wAZ8vyl7NCdAG7B7DZQAAEpBPAkAAAD/AAAAAABgvgCQUACNvgCA//9Xg83/6xCQkJCQkJCKBkaI
>B0cB23UHix6D7vwR23LtuAEAAAAB23UHix6D7vwR2xHAAdtz73UJix6D7vwR23PkMcmD6ANyDcHg
>CIoGRoPw/3R0icUB23UHix6D 7vwR2xHJAdt1B4seg+78EdsRyXUgQQHbdQeLHoPu/BHbEckB23Pv
>dQmLHoPu/BHb
>c+SDwQ KB/QDz//+D0QGNFC+D/fx2D4oCQogHR0l19+lj////kIsCg8IEiQeDxwSD
>6QR38QHP6Uz///9eife5AQEAAIoHRyzoPAF394A/AXXyiweKXwRmwegIwcAQhsQp+IDr6AHwiQeD
>xwWJ2OLZjb4AwAA AiwcJwHRFi18EjYQwFOUAAAHzUIPHCP+WjOUAAJWKB0cIwHT cifl5Bw+3B0dQ
>R7lXSPKuVf+WkOUAAAnAdAeJA4PDBOvY/5aU5QAAYekjRP//AAAAAAAAAAAAAAAAAAAAAAAAAAA A
>AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
>AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
>AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA AAAAAAAAAAAAAAAAAA AAAAAAAAAAAAAAA
>AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
>AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
>AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
>AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
>AAAAAAAAA
>AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
>AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
>AAAAAAAAAAAAAAAAAAIAAwAAACAAAIAOAAAAkAAAgAAAAAAAAAAAAAAAAAAAAgABAAAAQAAAgAIA
>AA BoAACAAAAAAAAAAAAAAAAAAAABAAkEAABYAAAA2PAAA OgCAAAAAAAAAAAAAAAAAAAAAAAAAAAA
>AAAAAQAJBAAAgAAAAMTzAAAoAQAAAAAAAAAAAAAAAAAAAA AAAAAAAAABAAAA0AAAgKgAAIAAAAAA
>AAAAAAAAAAAAAAEACQQAAMAAAADw9AAAIgAAAAAAAAAAAAAAAQAwAODAAAAoAAAAIAAAAEAAAAAB
>AAQAAA
>AAAIACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAgAAAAICAAIAAAACAAIAAgIAAAMDA
>wACAgIAAAAD/AAD/AAAA//8A/wAAAP8A/wD//wAA////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
>AAAAAAAAAAAAAAAAAAAAAA AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAiIiIiIiIiIiIiIiIiIAA
>AI/////////// /////+AAACH///////////////3gAAAj3//////////////f4AAAI/3////////
>////9/+AAACP/3///////////3//gAAAj//3//////////f//4AAAI///3////////9///+AAACP
>///3///////3//// gAAAj///d3d3d3d3d3///4AAAI//939/f39/f393//+AAACP/3f39/f39/f3
>93//gAAAj/d/f39/f39/f393/4AAAId39/f39/f39/f393eAAACPf39/f39/f39/f39/gAAAj///
>/////////////wAAAAj///////////////AAAAAAj/////////////8AAAAAAAj////////////w
>AAAAAAAAj///////////AAAAAAAAAAj/////////8AAAAAAAAAAAj
>////////wAAAAAAAAAAAAj/
>//////AAAAAAAAAAAAAAj/////8AAAAAAAAAAAAAAAiIiIiIAAAAAAAAAAAAAAAAAAAAAAAAAAAA
>AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////////wAAAA8AAAAPAAAAD
>wAAAA8AAAAPAAAADwAAAA8AAAAPAAAADwAAAA8AAAAPAAAADwAAAA8AAAAPAAAADwAAAA8AAAAfg
>AAAP8AAAH/gAAD/8AAB//gAA//8AAf//gAP//8AH///gD////////////// ////IwwAAKAAAABAA
>AAAgAAAAAQAEAAAAAADAAAAAA
>AAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAIAAAACAgACAAAAAgACA
>AICAAADAwMAAgICAAAAA/
>wAA/wAAAP//AP8AAAD/AP8A//8AAP///wAAAAAAAAAAA
>AAAAAAAAAAA
>AAAAAAAAAAAAj///////AACI//////gAAI+P////jwAAj/j///j/AACPj4iIj48AAIj39/f3+AAA
>j39/f39/AAAI9/f39/AAAACPf39/AAAAAAj39/AAAAAAAIiIgAAAAAAAAAAAAAAAAAAAAAAAAP//
>AAD//wAAwAEAAMABAADAAQAAw
>AEAAMABAADAAQAAwAEAAMABAADgAwAA8A
>cAAPgPAAD8H wAA//8A
>AP//AADwxAAAA
>AABAAIAICAQAAEABADoAgAAAQAQEBAAAQAEACgBAAACAAAAAAAAAAAAAAAAAAAA
>vPUAAIz1AAAAAAAAAAAAAAAAAADJ9QAAnPUAAAAAAAAAAAAAAAAAANb1AACk9QAAAAAAAAAAAAA A
>AAAA4fUAAKz1A AAAAAAAAAAAAAAAAADs9QAAtPUAAAAAAAAAAAAAAAAAAAAAAAAAAAAA9vUAAAT2
>AAAU9gAAAAAAACL2AAAAAAAAMPYAAAAAAAA49gAAAAAAADkAAIAAAAAAS0VSTkVMMzIuRExMAEFE
>VkFQSTMyLmRsbABNU1ZDUlQuZGxsAFVTRVIzMi5 kbGwAV1MyXzMyLmRsbAAATG9hZExpYnJhcnlB
>AABHZXRQcm
>9j QWRkcmVzcwAARXhpdFByb2Nlc3MAAABSZWdDbG9zZUtleQAAAG1lbXNldAAAd3Nw
>cmludGZBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA AAAAAA
>AAAAAA
>AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
>AAAAAAAAAAAAAAAAAAAAAAAAAAAA
>AAAAAAAAAAAAAAAA
>AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
>AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
>AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
>AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
>AAAAAAAAAAAAAAAAAAA
>AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
>AAAAAAAAAAAAAAAAAAAAA
>AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKkD8nj6
>7BQDqbnValZBBwWp3ug2qcPkD6nk39mpiV5p9X0uE6aSyGh1gtHtyirQ18oq0NDKiBnzwuiYG8oq
>0e22kNaxCvX3/InHJEsKBhLdWXgWXRjqw3iD6DmSC69cDN4EFSj5H3j8OXpWquFT69UuuTR3Hg0/
>Vbnl1oll Zj4podbunVHsxHFOctckRvyg+FdoXrAcjvg shg dcIBrhCiqh2xrNTrKBA050RkhRuKRE
>3G
>noB04XJflOVy2xkEfeG+fmbKMIAFL9CI8WB0yZvQ4XYi15F92XbQgLn0lbfbu22AZ0jyg1EBco
>VY6BK1mK6QGODnU3qWrnh93DQfL4 qaE08bw+DCeFP4ncf2RJQ5vjjy29yY9Y8eLba


From edd at debian.org  Mon Apr  3 23:11:58 2006
From: edd at debian.org (Dirk Eddelbuettel)
Date: Mon, 3 Apr 2006 16:11:58 -0500
Subject: [Rd] Build failure with this morning's R-alpha
Message-ID: <17457.36766.643093.231884@basebud.nulle.part>


Trying to build a Debian snapshot of R-alpha based on last night's tarball,
it fails with what looks like a missing -lm linking directive:

[...]
gcc     -I. -I../../src/include -I../../src/include  -DHAVE_CONFIG_H  -fpic  -O2  -c version.c -o version.o
gcc     -I. -I../../src/include -I../../src/include  -DHAVE_CONFIG_H  -fpic  -O2  -c vfonts.c -o vfonts.o
g77  -fpic  -O2  -c xxxpr.f -o xxxpr.o
gcc -shared   -o libR.so Rembedded.o CConverters.o CommandLineArgs.o Rdynload.o Renviron.o RNG.o apply.o arithmetic.o apse.o array.o attrib.o base.o bind.o builtin.o character.o coerce.o colors.o complex.o connections.o context.o cov.o cum.o dcf.o datetime.o debug.o deparse.o deriv.o dotcode.o dounzip.o dstruct.o duplicate.o engine.o envir.o errors.o eval.o format.o fourier.o gevents.o gram.o gram-ex.o graphics.o identical.o internet.o iosupport.o lapack.o list.o localecharset.o logic.o main.o mapply.o match.o memory.o model.o names.o objects.o optim.o optimize.o options.o par.o paste.o pcre.o platform.o plot.o plot3d.o plotmath.o print.o printarray.o printvector.o printutils.o qsort.o random.o regex.o registration.o relop.o rlocale.o saveload.o scan.o seq.o serialize.o size.o sort.o source.o split.o sprintf.o startup.o subassign.o subscript.o subset.o summary.o sysutils.o unique.o util.o version.o vfonts.o xxxpr.o   `ls ../appl/*.o ../nmath/*.o ../unix/*.o  2>/dev/null` -lblas-3 -L/usr/lib/gcc/i486-linux-gnu/3.4.6 -lg2c -lm -lgcc_s      -lreadline  -lpcre -lbz2 -lz -ldl -lm
make[5]: Entering directory `/tmp/buildd/r-base-2.2.1.svn37626/src/main'
mkdir -p -- /tmp/buildd/r-base-2.2.1.svn37626/bin/exec
mkdir -p -- /tmp/buildd/r-base-2.2.1.svn37626/lib
make[5]: Leaving directory `/tmp/buildd/r-base-2.2.1.svn37626/src/main'
make[4]: Leaving directory `/tmp/buildd/r-base-2.2.1.svn37626/src/main'
make[4]: Entering directory `/tmp/buildd/r-base-2.2.1.svn37626/src/main'
gcc     -I. -I../../src/include -I../../src/include  -DHAVE_CONFIG_H  -fpic  -O2  -c Rmain.c -o Rmain.o
gcc -Wl,--export-dynamic  -o R.bin Rmain.o  -L../../lib -lR
../../lib/libR.so: undefined reference to `isfinite'
collect2: ld returned 1 exit status
make[4]: *** [R.bin] Error 1
make[4]: Leaving directory `/tmp/buildd/r-base-2.2.1.svn37626/src/main'
make[3]: *** [R] Error 2
make[3]: Leaving directory `/tmp/buildd/r-base-2.2.1.svn37626/src/main'
make[2]: *** [R] Error 1
make[2]: Leaving directory `/tmp/buildd/r-base-2.2.1.svn37626/src'
make[1]: *** [R] Error 1
make[1]: Leaving directory `/tmp/buildd/r-base-2.2.1.svn37626'
make: *** [make-arch-stamp] Error 2
pbuilder: Failed autobuilding of package

I checked the svn logs, as it doesn't looks like this was addressed since the
tarball was rolled.  Am I the only one to have this happen?

Dirk

-- 
Hell, there are no rules here - we're trying to accomplish something. 
                                                  -- Thomas A. Edison


From murdoch at stats.uwo.ca  Mon Apr  3 23:42:35 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Mon, 03 Apr 2006 17:42:35 -0400
Subject: [Rd] Microsoft Monad Shell
In-Reply-To: <971536df0604031227n3c3a2be9xab0791954fa0cb8b@mail.gmail.com>
References: <971536df0604031227n3c3a2be9xab0791954fa0cb8b@mail.gmail.com>
Message-ID: <443196CB.6050104@stats.uwo.ca>

On 4/3/2006 3:27 PM, Gabor Grothendieck wrote:
> Not sure if this has application for R but Microsoft's new Monad shell
> is now in public beta.  I have not looked at it myself but I wonder
> if the tools that are required to create Windows R packages
> could be replaced by this?

I'd say probably not.  The tools required to build R packages in Windows 
are generally GNU tools, or modifications of them.  They are designed to 
make Windows look Unix-like.  From what I can see, Monad is an attempt 
to re-invent the shell, not to be compatible with Unix.  The Windows 
build process is different from the Unix one, but it makes use of the 
same tools; replacing it with something completely different just 
doesn't seem worth the trouble.

Duncan Murdoch

> 
> ----
> 
> The Monad team has recently released Monad Beta 3.1 to Microsoft Download
> Center and we're working diligently towards a release of Monad 1.0! As
> adoption of Monad has increased substantially, we have been moving the
> Monad community presence away from Betaplace, an invitation-only site for
> our earliest beta testers, to public areas to allow anyone interested in
> Monad to download and discover Monad. I'm pleased to announce that as of
> today, Monad's private Betaplace resources have now been fully
> transitioned to publicly accessible areas.
> 
> But we haven't stopped there! An updated Monad User Guide and Developer
> documentation are now available in the new Monad Documentation pack, as
> well as a repository for Monad scripts thanks to our good friends over at
> Technet Script Center! The Monad Betaplace presence is scheduled for
> closure at the end of April. We will send a final e-mail when this closure
> occurs.
> 
> Whether you are a Monad novice or guru, the following Monad resources are
> sure to have something to pique your interest:
> 
> * Download the latest version of Monad and the Monad Documentation Pack at
> Download Center:
>             <http://www.microsoft.com/downloads> and search for "Monad"
>             (Be sure to uninstall any old versions of Monad before
>             installing Monad Beta 3.1)
> 
> * Share suggestions and submit bug reports at Connect:
> <http://connect.microsoft.com/availableprograms.aspx>
> 
> * Browse the Monad script repository and read up on Monad script tips at
> Technet Script Center:
> <http://www.microsoft.com/technet/scriptcenter/hubs/msh.mspx>
> 
> * Create MshCmdlets and MshProviders using the Monad Developer reference
> on MSDN:
> <http://windowssdk.msdn.microsoft.com/library/default.asp?url=/library/en-
> us/cpref12/html/N_System_Management_Automation.asp>
> 
> * Discuss Monad with Monad team members, Monad MVPs, and Monad enthusiasts
> in the scripting newsgroup microsoft.public.windows.server.scripting:
> <http://www.microsoft.com/technet/community/newsgroups/dgbrowser/en-us/def
> ault.mspx?query=microsoft.public.windows.server.scripting&dg=&cat=en-us-te
> chnet-appcenter&lang=en&cr=US&pt=&catlist=328BAFD2-1A81-4558-B1DE-B6EB49F3
> 1B7E&dglist=&ptlist=&exp=&sloc=en-us>
> 
> * Get the latest scoop on Monad on the blogs by Monad MVPs and team
> members. Here's a list of some of the ones out there:
>             Monad Team Blog: <http://blogs.msdn.com/monad>
> 
>             Arul Kumaravel's Blog: <http://blogs.msdn.com/arulk>
>             Keith Hill's Blog: <http://spaces.msn.com/keithhill>
>             Lee Holmes' Blog: <http://www.leeholmes.com/blog>
>             Marc van Orsouw's Blog: <http://mow001.blogspot.com/>
>             Thomas Lee's Blog: <http://tfl09.blogspot.com/>
> 
> * Read all about Monad in the first published book on Monad. Published by
> O'Reilly, this book is available to view online as well as for purchase in
> stores.
>             <http://www.oreilly.com/catalog/msh>
> 
> As thanks for being a supporter of Monad during our early betas, we've
> worked with the folks at O'Reilly to get you 30% off the Monad book. Just
> use the code "D6MNAD" when placing an order at oreilly.com. The code
> expires June 30th.
> 
> Finally, we're always looking for ways to improve the Monad community and
> to better understand how Monad is being used around the world. If you're
> using Monad today and it's been helpful or you've done something with
> Monad that you think is super cool and worth sharing, we'd love to hear
> your story! The same goes for if you have any ideas for topics, areas, and
> events not covered here but you wish you had. To send us your stories and
> feedback, visit the Monad Connect website at
> <http://connect.microsoft.com/>.
> 
> If you haven't used the Monad Connect site before you'll need to do a
> quick registration if you haven't visited Connect before.
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From afinley at stat.umn.edu  Tue Apr  4 03:39:19 2006
From: afinley at stat.umn.edu (Andrew Finley)
Date: Mon, 03 Apr 2006 20:39:19 -0500
Subject: [Rd] change function's formals default values
Message-ID: <1144114759.15762.3.camel@populus.fr.umn.edu>

Hello,

I'm passing a user defined function into my c code. Once this function
is in my c code, I'd like to iteratively change the values associated
with the parameters defined in the function's formal list then evaluate
the function using these newly set defaults (i.e., using lang1(fn)).

My question is, how do I simply change the value associated with each
parameter in this function's formal list. I have messed around with the
SET_FORMAL function but can't figure out how to change these values.

Thanks-

Andrew

-- 
Research Fellow
Department of Forest Resources
University of Minnesota
Office: 305 Green Hall
Phone: (612) 624-1714
Fax: (612) 625-5212
web: http://blue.fr.umn.edu


From stoffer at pitt.edu  Tue Apr  4 05:20:43 2006
From: stoffer at pitt.edu (stoffer at pitt.edu)
Date: Tue,  4 Apr 2006 05:20:43 +0200 (CEST)
Subject: [Rd] header containing (PR#8231) -- replace 8231
Message-ID: <20060404032043.B8E3BBDC9@slim.kubism.ku.dk>

Sorry for reporting this again, but I didn't notice that there was a 
response.  The response to PR#8231 is "This is a matter of opinion!"

First, I find this response arrogant and dismissive and I would ask 
for a second opinion. Second, the use of the term "intercept" - 
whether or not you think is "a matter of opinion" - is MISLEADING. Why 
do you want to MISLEAD users?

I believe "intercept-slope form of a line" is well established in 
mathematics.  That is, if y=a+bx then most of us would call a the 
intercept and b the slope.  Is the responder saying this is opinion? 
This is standard terminology.

For a causal AR(1) model we write
X(t) = a + b X(t-1) + W(t)
where W(t) is white noise.  The value a is the intercept and the value 
b is the slope... is the responder saying this is opinion?  How so? 
It's the slope-intercept form of the model.

If mu =E[X(t)] then mu = a + b*mu or
a = mu*(1-b)
is the relationship between the MEAN and the INTERCEPT.  They are not 
the same unless b=0.  This is NOT opinion. This is a fact.

So if I tell you the estimate of the intercept is 10, what does that 
say to you?  In the arima output (and other functions), it's saying 
the estimate of mu is 10.  Really?  You don't think that's misleading?

Again, I put this to you: Why do you want to MISLEAD the user. Get 
some other opinions on this if you don't agree with me.

Thanks again for your time and sorry for the double report.
David

-- 


-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
David S. Stoffer
Department of Statistics
University of Pittsburgh
Pittsburgh, PA  15260

phone: [412] 624-8496
   fax: [412] 648-8814
email: stoffer at pitt.edu
   web: http://www.stat.pitt.edu/stoffer
voice: hey dave


From ripley at stats.ox.ac.uk  Tue Apr  4 08:12:20 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 4 Apr 2006 07:12:20 +0100 (BST)
Subject: [Rd] Build failure with this morning's R-alpha
In-Reply-To: <17457.36766.643093.231884@basebud.nulle.part>
References: <17457.36766.643093.231884@basebud.nulle.part>
Message-ID: <Pine.LNX.4.64.0604040656470.10475@gannet.stats.ox.ac.uk>

Note that libR.so was itself linked against -lm, so should resolve its 
dependencies there.  The front end has never been linked against -lm, nor
do I see that anything should have changed for a long time in the 
front-end.

I was able to build a shared-library version of the current svn 36743 (I 
was unable to identify which 'last night' this was, and 
'r-base-2.2.1.svn37626' seemed contradictory) from scratch on FC3 on ix86 
and x86_64 (and I built a slightly earlier version on Solaris yesterday).


On Mon, 3 Apr 2006, Dirk Eddelbuettel wrote:

>
> Trying to build a Debian snapshot of R-alpha based on last night's tarball,
> it fails with what looks like a missing -lm linking directive:
>
> [...]
> gcc     -I. -I../../src/include -I../../src/include  -DHAVE_CONFIG_H  -fpic  -O2  -c version.c -o version.o
> gcc     -I. -I../../src/include -I../../src/include  -DHAVE_CONFIG_H  -fpic  -O2  -c vfonts.c -o vfonts.o
> g77  -fpic  -O2  -c xxxpr.f -o xxxpr.o
> gcc -shared   -o libR.so Rembedded.o CConverters.o CommandLineArgs.o Rdynload.o Renviron.o RNG.o apply.o arithmetic.o apse.o array.o attrib.o base.o bind.o builtin.o character.o coerce.o colors.o complex.o connections.o context.o cov.o cum.o dcf.o datetime.o debug.o deparse.o deriv.o dotcode.o dounzip.o dstruct.o duplicate.o engine.o envir.o errors.o eval.o format.o fourier.o gevents.o gram.o gram-ex.o graphics.o identical.o internet.o iosupport.o lapack.o list.o localecharset.o logic.o main.o mapply.o match.o memory.o model.o names.o objects.o optim.o optimize.o options.o par.o paste.o pcre.o platform.o plot.o plot3d.o plotmath.o print.o printarray.o printvector.o printutils.o qsort.o random.o regex.o registration.o relop.o rlocale.o saveload.o scan.o seq.o serialize.o size.o sort.o source.o split.o sprintf.o startup.o subassign.o subscript.o subset.o summary.o sysutils.o unique.o util.o version.o vfonts.o xxxpr.o   `ls ../appl/*.o ../nmath/*.o ../unix/*.o  2>/dev/null` -!
 lb!
> las-3 -L/usr/lib/gcc/i486-linux-gnu/3.4.6 -lg2c -lm -lgcc_s      -lreadline  -lpcre -lbz2 -lz -ldl -lm
> make[5]: Entering directory `/tmp/buildd/r-base-2.2.1.svn37626/src/main'
> mkdir -p -- /tmp/buildd/r-base-2.2.1.svn37626/bin/exec
> mkdir -p -- /tmp/buildd/r-base-2.2.1.svn37626/lib
> make[5]: Leaving directory `/tmp/buildd/r-base-2.2.1.svn37626/src/main'
> make[4]: Leaving directory `/tmp/buildd/r-base-2.2.1.svn37626/src/main'
> make[4]: Entering directory `/tmp/buildd/r-base-2.2.1.svn37626/src/main'
> gcc     -I. -I../../src/include -I../../src/include  -DHAVE_CONFIG_H  -fpic  -O2  -c Rmain.c -o Rmain.o
> gcc -Wl,--export-dynamic  -o R.bin Rmain.o  -L../../lib -lR
> ../../lib/libR.so: undefined reference to `isfinite'
> collect2: ld returned 1 exit status
> make[4]: *** [R.bin] Error 1
> make[4]: Leaving directory `/tmp/buildd/r-base-2.2.1.svn37626/src/main'
> make[3]: *** [R] Error 2
> make[3]: Leaving directory `/tmp/buildd/r-base-2.2.1.svn37626/src/main'
> make[2]: *** [R] Error 1
> make[2]: Leaving directory `/tmp/buildd/r-base-2.2.1.svn37626/src'
> make[1]: *** [R] Error 1
> make[1]: Leaving directory `/tmp/buildd/r-base-2.2.1.svn37626'
> make: *** [make-arch-stamp] Error 2
> pbuilder: Failed autobuilding of package
>
> I checked the svn logs, as it doesn't looks like this was addressed since the
> tarball was rolled.  Am I the only one to have this happen?
>
> Dirk
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From anyakin at users.sourceforge.net  Tue Apr  4 08:42:28 2006
From: anyakin at users.sourceforge.net (anyakin at users.sourceforge.net)
Date: Tue,  4 Apr 2006 08:42:28 +0200 (CEST)
Subject: [Rd] Extending www.r-project.org features with a Wiki (PR#8744)
Message-ID: <20060404064228.C3EFA183A1@slim.kubism.ku.dk>

On Mon, Apr 03, 2006 at 04:36:21PM +0100, Prof Brian Ripley wrote:
> Try http://wiki.r-project.org  (which you might have guessed or Googled: 
> it came up as the first item for me).
> 
> You might want to report to the webmaster of www.r-project.org where you 
> looked for a link to this and failed to find one.   (Both the webmaster 
> and the host machine have moved recently (or the machine is about to), so
> various planned changes are delayed by the moves.)

  Thank you for pointing me in the right direction. Anyways, I have
  mailed the web admin of the www.r-project.org site.

> 
> On Mon, 3 Apr 2006, anyakin at users.sourceforge.net wrote:
> 
> >Full_Name: Victor Anyakin
> >Version:
> >OS:
> >Submission from: (NULL) (212.109.44.52)
> >
> >
> >This is an enhancement request,
> >
> >probably, some sort of a Wiki engine could be installed on the web site, 
> >or some other system, which would cover some basic information about 
> >various aspectes of R.
> >
> >Currently, I am trying to find some information about GUI application
> >development on R. A number of various projects use wiki's to provide such
> >information to the new or experienced users.
> 
> Well, see the `Writing R Extensions' manual, the `Related Projects' link 
> on CRAN which links to a page on GUIs (and that links to another 
> mainifestation of the same Wiki).

  Thank you, I will try to find the information i need there.

With best regards,
-- 
Victor Anyakin                         ()  ascii ribbon campaign
                                       /\    - against html mail


From hb at maths.lth.se  Tue Apr  4 10:33:31 2006
From: hb at maths.lth.se (Henrik Bengtsson)
Date: Tue, 4 Apr 2006 10:33:31 +0200
Subject: [Rd] Example of environment
Message-ID: <59d7961d0604040133k6ca47842g6e6b5f8a1a50f791@mail.gmail.com>

A minor comment: in help(environment) the example starts with:

##-- all three give the same:
     environment()
     environment(environment)
     .GlobalEnv

but the comment is not true. The second returns the "<environment:
namespace:base>".

"R : Copyright 2006, The R Foundation for Statistical Computing
Version 2.3.0 alpha (2006-04-02 r37626)"

/Henrik


From ripley at stats.ox.ac.uk  Tue Apr  4 12:03:41 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 4 Apr 2006 11:03:41 +0100 (BST)
Subject: [Rd] Integration of C and Fortran
In-Reply-To: <p06230905c05711d5d338@[192.168.0.110]>
References: <p06230905c05711d5d338@[192.168.0.110]>
Message-ID: <Pine.LNX.4.64.0604041052090.3947@gannet.stats.ox.ac.uk>

Is

>        the enter point Fortran "orderdata_" absent of the loading table.

a manual translation, and was the underscore there in the original (I 
think it should be, but am just checking).

What do nm -g mpackage.so tell you is actually exported from the shared 
object (here called 'mypackage.so')?  I suspect that will reveal a 
mismatch of names.

On Mon, 3 Apr 2006, Sebastien Durand wrote:

> Dear all,
>
> I am running R : Copyright 2005,
> Version 2.2.1  (2005-12-20 r36812)
> ISBN 3-900051-07-0
> On a mac 10.4.5
>
> I am having trouble with my package.
>
> The trouble is the following:
>
> In my package I have integrated three files in my src folder.
> 1- simplematch.C a .C file
> 2- ordering.f a fortran file
> 3- Makevars :  PKG_LIBS =  $(LAPACK_LIBS) $(BLAS_LIBS) $(FLIBS)
> I am not sure if that last file is really useful!?
>
> When I use the R CMD SHLIB command on both these
> source code files, the resulting compiled  .so
> files when loads fine with the dyn.load function.
> At last when I use either the
> .C("simplematch",...) and
> .Fortran("ordering",...) command everything
> works...
>
> Now here comes trouble:
>
> When I do the R CMD INSTALL command, my package install.
> The .C command works but when I run the .Fortran command I get:
>
> Error in .Fortran("orderdata", d = as.double(d),
> as.integer(n), rowscore = as.double(rowscore)) :
> 	the enter point Fortran "orderdata_" absent of the loading table.
>
> What should I do to make sure that upon the installation of my package my
> Fortran function will appear in the load table...
>
> Thanks a lot.
>
> S?bastien Durand
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From murdoch at stats.uwo.ca  Tue Apr  4 13:16:16 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Tue, 04 Apr 2006 07:16:16 -0400
Subject: [Rd] Example of environment
In-Reply-To: <59d7961d0604040133k6ca47842g6e6b5f8a1a50f791@mail.gmail.com>
References: <59d7961d0604040133k6ca47842g6e6b5f8a1a50f791@mail.gmail.com>
Message-ID: <44325580.8060502@stats.uwo.ca>

On 4/4/2006 4:33 AM, Henrik Bengtsson wrote:
> A minor comment: in help(environment) the example starts with:
> 
> ##-- all three give the same:
>      environment()
>      environment(environment)
>      .GlobalEnv
> 
> but the comment is not true. The second returns the "<environment:
> namespace:base>".
> 
> "R : Copyright 2006, The R Foundation for Statistical Computing
> Version 2.3.0 alpha (2006-04-02 r37626)"

You're right, the comment is wrong.  I'll fix it.

Duncan Murdohc


From edd at debian.org  Tue Apr  4 13:45:50 2006
From: edd at debian.org (Dirk Eddelbuettel)
Date: Tue, 4 Apr 2006 06:45:50 -0500
Subject: [Rd] Build failure with this morning's R-alpha
In-Reply-To: <Pine.LNX.4.64.0604040656470.10475@gannet.stats.ox.ac.uk>
References: <17457.36766.643093.231884@basebud.nulle.part>
	<Pine.LNX.4.64.0604040656470.10475@gannet.stats.ox.ac.uk>
Message-ID: <17458.23662.51165.376563@basebud.nulle.part>


On 4 April 2006 at 07:12, Prof Brian Ripley wrote:
| Note that libR.so was itself linked against -lm, so should resolve its 
| dependencies there.  The front end has never been linked against -lm, nor
| do I see that anything should have changed for a long time in the 
| front-end.

Thanks for confirming -- that is what I was suspecting, little or no change
at R's side of this. The problem may be with Debian's "pbuilder" chroot that
sets up the build environment. I will contact its author and maintainer.

| I was able to build a shared-library version of the current svn 36743 (I 
| was unable to identify which 'last night' this was, and 
| 'r-base-2.2.1.svn37626' seemed contradictory) from scratch on FC3 on ix86 
| and x86_64 (and I built a slightly earlier version on Solaris yesterday).

These are the nightly (in Copenhaguen time) builds provided via 
	
	http://cran.r-project.org/src/base-prerelease

and I just confirmed the problem with today's svn.37642.

Dirk

| 
| 
| On Mon, 3 Apr 2006, Dirk Eddelbuettel wrote:
| 
| >
| > Trying to build a Debian snapshot of R-alpha based on last night's tarball,
| > it fails with what looks like a missing -lm linking directive:
| >
| > [...]
| > gcc     -I. -I../../src/include -I../../src/include  -DHAVE_CONFIG_H  -fpic  -O2  -c version.c -o version.o
| > gcc     -I. -I../../src/include -I../../src/include  -DHAVE_CONFIG_H  -fpic  -O2  -c vfonts.c -o vfonts.o
| > g77  -fpic  -O2  -c xxxpr.f -o xxxpr.o
| > gcc -shared   -o libR.so Rembedded.o CConverters.o CommandLineArgs.o Rdynload.o Renviron.o RNG.o apply.o arithmetic.o apse.o array.o attrib.o base.o bind.o builtin.o character.o coerce.o colors.o complex.o connections.o context.o cov.o cum.o dcf.o datetime.o debug.o deparse.o deriv.o dotcode.o dounzip.o dstruct.o duplicate.o engine.o envir.o errors.o eval.o format.o fourier.o gevents.o gram.o gram-ex.o graphics.o identical.o internet.o iosupport.o lapack.o list.o localecharset.o logic.o main.o mapply.o match.o memory.o model.o names.o objects.o optim.o optimize.o options.o par.o paste.o pcre.o platform.o plot.o plot3d.o plotmath.o print.o printarray.o printvector.o printutils.o qsort.o random.o regex.o registration.o relop.o rlocale.o saveload.o scan.o seq.o serialize.o size.o sort.o source.o split.o sprintf.o startup.o subassign.o subscript.o subset.o summary.o sysutils.o unique.o util.o version.o vfonts.o xxxpr.o   `ls ../appl/*.o ../nmath/*.o ../unix/*.o  2>/dev/null` -!
|  lb!
| > las-3 -L/usr/lib/gcc/i486-linux-gnu/3.4.6 -lg2c -lm -lgcc_s      -lreadline  -lpcre -lbz2 -lz -ldl -lm
| > make[5]: Entering directory `/tmp/buildd/r-base-2.2.1.svn37626/src/main'
| > mkdir -p -- /tmp/buildd/r-base-2.2.1.svn37626/bin/exec
| > mkdir -p -- /tmp/buildd/r-base-2.2.1.svn37626/lib
| > make[5]: Leaving directory `/tmp/buildd/r-base-2.2.1.svn37626/src/main'
| > make[4]: Leaving directory `/tmp/buildd/r-base-2.2.1.svn37626/src/main'
| > make[4]: Entering directory `/tmp/buildd/r-base-2.2.1.svn37626/src/main'
| > gcc     -I. -I../../src/include -I../../src/include  -DHAVE_CONFIG_H  -fpic  -O2  -c Rmain.c -o Rmain.o
| > gcc -Wl,--export-dynamic  -o R.bin Rmain.o  -L../../lib -lR
| > ../../lib/libR.so: undefined reference to `isfinite'
| > collect2: ld returned 1 exit status
| > make[4]: *** [R.bin] Error 1
| > make[4]: Leaving directory `/tmp/buildd/r-base-2.2.1.svn37626/src/main'
| > make[3]: *** [R] Error 2
| > make[3]: Leaving directory `/tmp/buildd/r-base-2.2.1.svn37626/src/main'
| > make[2]: *** [R] Error 1
| > make[2]: Leaving directory `/tmp/buildd/r-base-2.2.1.svn37626/src'
| > make[1]: *** [R] Error 1
| > make[1]: Leaving directory `/tmp/buildd/r-base-2.2.1.svn37626'
| > make: *** [make-arch-stamp] Error 2
| > pbuilder: Failed autobuilding of package
| >
| > I checked the svn logs, as it doesn't looks like this was addressed since the
| > tarball was rolled.  Am I the only one to have this happen?
| >
| > Dirk
| >
| >
| 
| -- 
| Brian D. Ripley,                  ripley at stats.ox.ac.uk
| Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
| University of Oxford,             Tel:  +44 1865 272861 (self)
| 1 South Parks Road,                     +44 1865 272866 (PA)
| Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-- 
Hell, there are no rules here - we're trying to accomplish something. 
                                                  -- Thomas A. Edison


From phgrosjean at sciviews.org  Tue Apr  4 13:54:36 2006
From: phgrosjean at sciviews.org (Philippe Grosjean)
Date: Tue, 04 Apr 2006 13:54:36 +0200
Subject: [Rd] Extending www.r-project.org features with a Wiki (PR#8744)
In-Reply-To: <20060403153635.27FEEC77C@slim.kubism.ku.dk>
References: <20060403153635.27FEEC77C@slim.kubism.ku.dk>
Message-ID: <44325E7C.2050200@sciviews.org>

http://wiki.r-project.org is quite recent and not widely advertised yet 
because I want to finialize features and beta test them with a limited 
number of enthousiast people *before* making more publicity about it.

It is dedicated to the kind of collaborative documentation that Victor 
Anyakin is asking for. Indeed, it is already available to everybody, 
i.e., those who use Google ;-)
Best,

Philippe Grosjean

ripley at stats.ox.ac.uk wrote:
> Try http://wiki.r-project.org  (which you might have guessed or Googled: 
> it came up as the first item for me).
> 
> You might want to report to the webmaster of www.r-project.org where you 
> looked for a link to this and failed to find one.   (Both the webmaster 
> and the host machine have moved recently (or the machine is about to), so
> various planned changes are delayed by the moves.)
> 
> 
> On Mon, 3 Apr 2006, anyakin at users.sourceforge.net wrote:
> 
> 
>>Full_Name: Victor Anyakin
>>Version:
>>OS:
>>Submission from: (NULL) (212.109.44.52)
>>
>>
>>This is an enhancement request,
>>
>>probably, some sort of a Wiki engine could be installed on the web site, 
>>or some other system, which would cover some basic information about 
>>various aspectes of R.
>>
>>Currently, I am trying to find some information about GUI application
>>development on R. A number of various projects use wiki's to provide such
>>information to the new or experienced users.
> 
> 
> Well, see the `Writing R Extensions' manual, the `Related Projects' link 
> on CRAN which links to a page on GUIs (and that links to another 
> mainifestation of the same Wiki).
> 
> 
>


From hb at maths.lth.se  Tue Apr  4 15:40:36 2006
From: hb at maths.lth.se (Henrik Bengtsson)
Date: Tue, 4 Apr 2006 15:40:36 +0200
Subject: [Rd] Return function from function with minimal environment
Message-ID: <59d7961d0604040640i5b055b47mfb84d1c746e2ef27@mail.gmail.com>

Hi,

this relates to the question "How to set a former environment?" asked
yesterday.  What is the best way to to return a function with a
minimal environment from a function? Here is a dummy example:

foo <- function(huge) {
  scale <- mean(huge)
  function(x) { scale * x }
}

fcn <- foo(1:10e5)

The problem with this approach is that the environment of 'fcn' does
not only hold 'scale' but also the memory consuming object 'huge',
i.e.

env <- environment(fcn)
ll(envir=env)  # ll() from R.oo
#   member data.class dimension object.size
# 1   huge    numeric   1000000     4000028
# 2  scale    numeric         1          36

save(env, file="temp.RData")
file.info("temp.RData")$size
# [1] 2007624

I generate quite a few of these and my 'huge' objects are of order
100Mb, and I want to keep memory usage as well as file sizes to a
minimum.  What I do now, is to remove variable from the local
environment of 'foo' before returning, i.e.

foo2 <- function(huge) {
  scale <- mean(huge)
  rm(huge)
  function(x) { scale * x }
}

fcn <- foo2(1:10e5)
env <- environment(fcn)
ll(envir=env)
#   member data.class dimension object.size
# 1  scale    numeric         1          36

save(env, file="temp.RData")
file.info("temp.RData")$size
# [1] 156

Since my "foo" functions are complicated and contains many local
variables, it becomes tedious to identify and remove all of them, so
instead I try:

foo3 <- function(huge) {
  scale <- mean(huge);
  env <- new.env();
  assign("scale", scale, envir=env);
  bar <- function(x) { scale * x };
  environment(bar) <- env;
  bar;
}

fcn <- foo3(1:10e5)

But,

env <- environment(fcn)
save(env, file="temp.RData");
file.info("temp.RData")$size
# [1] 2007720

When I try to set the parent environment of 'env' to emptyenv(), it
does not work, e.g.

fcn(2)
# Error in fcn(2) : attempt to apply non-function

but with the new.env(parent=baseenv()) it works fine. The "base"
environment has the empty environment as a parent.  So, I try to do
the same myself, i.e. new.env(parent=new.env(parent=emptyenv())), but
once again I get

fcn(2)
# Error in fcn(2) : attempt to apply non-function

Apparently, I do not understand enough here.  Please, enlighten me. In
the meantime I stick with foo2().

Best,

Henrik


From tlumley at u.washington.edu  Tue Apr  4 16:21:08 2006
From: tlumley at u.washington.edu (Thomas Lumley)
Date: Tue, 4 Apr 2006 07:21:08 -0700 (PDT)
Subject: [Rd] change function's formals default values
In-Reply-To: <1144114759.15762.3.camel@populus.fr.umn.edu>
References: <1144114759.15762.3.camel@populus.fr.umn.edu>
Message-ID: <Pine.LNX.4.64.0604040714090.26620@homer22.u.washington.edu>

On Mon, 3 Apr 2006, Andrew Finley wrote:

> Hello,
>
> I'm passing a user defined function into my c code. Once this function
> is in my c code, I'd like to iteratively change the values associated
> with the parameters defined in the function's formal list then evaluate
> the function using these newly set defaults (i.e., using lang1(fn)).
>
> My question is, how do I simply change the value associated with each
> parameter in this function's formal list. I have messed around with the
> SET_FORMAL function but can't figure out how to change these values.
>

<recoils in horror>

Are you *sure* you want to do this?  It seems that you should be able to 
use lexical scope to store this information in variables rather than 
default arguments and then you can use setVar to change the variables 
rather than changing the formals.

 	-thomas

Thomas Lumley			Assoc. Professor, Biostatistics
tlumley at u.washington.edu	University of Washington, Seattle


From tlumley at u.washington.edu  Tue Apr  4 16:29:59 2006
From: tlumley at u.washington.edu (Thomas Lumley)
Date: Tue, 4 Apr 2006 07:29:59 -0700 (PDT)
Subject: [Rd] Return function from function with minimal environment
In-Reply-To: <59d7961d0604040640i5b055b47mfb84d1c746e2ef27@mail.gmail.com>
References: <59d7961d0604040640i5b055b47mfb84d1c746e2ef27@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0604040726410.26620@homer22.u.washington.edu>

On Tue, 4 Apr 2006, Henrik Bengtsson wrote:

> Hi,
>
> this relates to the question "How to set a former environment?" asked
> yesterday.  What is the best way to to return a function with a
> minimal environment from a function? Here is a dummy example:
>
> foo <- function(huge) {
>  scale <- mean(huge)
>  function(x) { scale * x }
> }
>
> fcn <- foo(1:10e5)
>
> The problem with this approach is that the environment of 'fcn' does
> not only hold 'scale' but also the memory consuming object 'huge',
> i.e.
>
> env <- environment(fcn)
> ll(envir=env)  # ll() from R.oo
> #   member data.class dimension object.size
> # 1   huge    numeric   1000000     4000028
> # 2  scale    numeric         1          36
>
> save(env, file="temp.RData")
> file.info("temp.RData")$size
> # [1] 2007624
>
> I generate quite a few of these and my 'huge' objects are of order
> 100Mb, and I want to keep memory usage as well as file sizes to a
> minimum.  What I do now, is to remove variable from the local
> environment of 'foo' before returning, i.e.
>
> foo2 <- function(huge) {
>  scale <- mean(huge)
>  rm(huge)
>  function(x) { scale * x }
> }
>
> fcn <- foo2(1:10e5)
> env <- environment(fcn)
> ll(envir=env)
> #   member data.class dimension object.size
> # 1  scale    numeric         1          36
>
> save(env, file="temp.RData")
> file.info("temp.RData")$size
> # [1] 156
>
> Since my "foo" functions are complicated and contains many local
> variables, it becomes tedious to identify and remove all of them, so
> instead I try:
>
> foo3 <- function(huge) {
>  scale <- mean(huge);
>  env <- new.env();
>  assign("scale", scale, envir=env);
>  bar <- function(x) { scale * x };
>  environment(bar) <- env;
>  bar;
> }
>
> fcn <- foo3(1:10e5)
>
> But,
>
> env <- environment(fcn)
> save(env, file="temp.RData");
> file.info("temp.RData")$size
> # [1] 2007720
>
> When I try to set the parent environment of 'env' to emptyenv(), it
> does not work, e.g.
>
> fcn(2)
> # Error in fcn(2) : attempt to apply non-function
>
> but with the new.env(parent=baseenv()) it works fine. The "base"
> environment has the empty environment as a parent.  So, I try to do
> the same myself, i.e. new.env(parent=new.env(parent=emptyenv())), but
> once again I get

I don't think you want to remove baseenv() from the environment. If you 
do, no functions from baseenv will be visible inside fcn. These include 
"{" and "*", which are necessary for your function. I think the error 
message comes from being unable to find "{".

Also, there is no memory use from having baseenv in the environment, since 
all the objects in baseenv are always present.

 	-thomas


Thomas Lumley			Assoc. Professor, Biostatistics
tlumley at u.washington.edu	University of Washington, Seattle


From rpeng at jhsph.edu  Tue Apr  4 16:38:29 2006
From: rpeng at jhsph.edu (Roger D. Peng)
Date: Tue, 04 Apr 2006 10:38:29 -0400
Subject: [Rd] Return function from function with minimal environment
In-Reply-To: <59d7961d0604040640i5b055b47mfb84d1c746e2ef27@mail.gmail.com>
References: <59d7961d0604040640i5b055b47mfb84d1c746e2ef27@mail.gmail.com>
Message-ID: <443284E5.2050105@jhsph.edu>

In R 2.3.0-to-be, I think you can do

foo <- function(huge) {
	scale <- mean(huge)
	g <- function(x) { scale * x }
	environment(g) <- emptyenv()
	g
}

-roger

Henrik Bengtsson wrote:
> Hi,
> 
> this relates to the question "How to set a former environment?" asked
> yesterday.  What is the best way to to return a function with a
> minimal environment from a function? Here is a dummy example:
> 
> foo <- function(huge) {
>   scale <- mean(huge)
>   function(x) { scale * x }
> }
> 
> fcn <- foo(1:10e5)
> 
> The problem with this approach is that the environment of 'fcn' does
> not only hold 'scale' but also the memory consuming object 'huge',
> i.e.
> 
> env <- environment(fcn)
> ll(envir=env)  # ll() from R.oo
> #   member data.class dimension object.size
> # 1   huge    numeric   1000000     4000028
> # 2  scale    numeric         1          36
> 
> save(env, file="temp.RData")
> file.info("temp.RData")$size
> # [1] 2007624
> 
> I generate quite a few of these and my 'huge' objects are of order
> 100Mb, and I want to keep memory usage as well as file sizes to a
> minimum.  What I do now, is to remove variable from the local
> environment of 'foo' before returning, i.e.
> 
> foo2 <- function(huge) {
>   scale <- mean(huge)
>   rm(huge)
>   function(x) { scale * x }
> }
> 
> fcn <- foo2(1:10e5)
> env <- environment(fcn)
> ll(envir=env)
> #   member data.class dimension object.size
> # 1  scale    numeric         1          36
> 
> save(env, file="temp.RData")
> file.info("temp.RData")$size
> # [1] 156
> 
> Since my "foo" functions are complicated and contains many local
> variables, it becomes tedious to identify and remove all of them, so
> instead I try:
> 
> foo3 <- function(huge) {
>   scale <- mean(huge);
>   env <- new.env();
>   assign("scale", scale, envir=env);
>   bar <- function(x) { scale * x };
>   environment(bar) <- env;
>   bar;
> }
> 
> fcn <- foo3(1:10e5)
> 
> But,
> 
> env <- environment(fcn)
> save(env, file="temp.RData");
> file.info("temp.RData")$size
> # [1] 2007720
> 
> When I try to set the parent environment of 'env' to emptyenv(), it
> does not work, e.g.
> 
> fcn(2)
> # Error in fcn(2) : attempt to apply non-function
> 
> but with the new.env(parent=baseenv()) it works fine. The "base"
> environment has the empty environment as a parent.  So, I try to do
> the same myself, i.e. new.env(parent=new.env(parent=emptyenv())), but
> once again I get
> 
> fcn(2)
> # Error in fcn(2) : attempt to apply non-function
> 
> Apparently, I do not understand enough here.  Please, enlighten me. In
> the meantime I stick with foo2().
> 
> Best,
> 
> Henrik
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 

-- 
Roger D. Peng  |  http://www.biostat.jhsph.edu/~rpeng/


From afinley at stat.umn.edu  Tue Apr  4 16:42:30 2006
From: afinley at stat.umn.edu (Andrew Finley)
Date: Tue, 04 Apr 2006 09:42:30 -0500
Subject: [Rd] change function's formals default values
In-Reply-To: <Pine.LNX.4.64.0604040714090.26620@homer22.u.washington.edu>
References: <1144114759.15762.3.camel@populus.fr.umn.edu>
	<Pine.LNX.4.64.0604040714090.26620@homer22.u.washington.edu>
Message-ID: <1144161750.18246.7.camel@populus.fr.umn.edu>

Hi Thomas, 

Thanks for the note. I'm not sure about a lot of things. Setting the
formal defaults then calling the function seem straight forward.  I just
assumed it would be like setting list values, or the C equivalent of
calling formals(fn)<-list(a=1, b=3).

Following your suggestion, I can get the names of the parameters used in
this user defined function, but am not sure how to do what you are
suggesting. For instance, how do I call the function after I use setVar.
Could you point me to an example?

Thanks again!

Andrew

On Tue, 2006-04-04 at 07:21 -0700, Thomas Lumley wrote:
> On Mon, 3 Apr 2006, Andrew Finley wrote:
> 
> > Hello,
> >
> > I'm passing a user defined function into my c code. Once this function
> > is in my c code, I'd like to iteratively change the values associated
> > with the parameters defined in the function's formal list then evaluate
> > the function using these newly set defaults (i.e., using lang1(fn)).
> >
> > My question is, how do I simply change the value associated with each
> > parameter in this function's formal list. I have messed around with the
> > SET_FORMAL function but can't figure out how to change these values.
> >
> 
> <recoils in horror>
> 
> Are you *sure* you want to do this?  It seems that you should be able to 
> use lexical scope to store this information in variables rather than 
> default arguments and then you can use setVar to change the variables 
> rather than changing the formals.
> 
>  	-thomas
> 
> Thomas Lumley			Assoc. Professor, Biostatistics
> tlumley at u.washington.edu	University of Washington, Seattle
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
-- 
Research Fellow
Department of Forest Resources
University of Minnesota
Office: 305 Green Hall
Phone: (612) 624-1714
Fax: (612) 625-5212
web: http://blue.fr.umn.edu


From ripley at stats.ox.ac.uk  Tue Apr  4 16:56:37 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 4 Apr 2006 15:56:37 +0100 (BST)
Subject: [Rd] Return function from function with minimal environment
In-Reply-To: <443284E5.2050105@jhsph.edu>
References: <59d7961d0604040640i5b055b47mfb84d1c746e2ef27@mail.gmail.com>
	<443284E5.2050105@jhsph.edu>
Message-ID: <Pine.LNX.4.64.0604041544200.32041@gannet.stats.ox.ac.uk>

On Tue, 4 Apr 2006, Roger D. Peng wrote:

> In R 2.3.0-to-be, I think you can do
>
> foo <- function(huge) {
> 	scale <- mean(huge)
> 	g <- function(x) { scale * x }
> 	environment(g) <- emptyenv()
> 	g
> }

You can, but you really don't want to and you will get the same error. A 
'minimal environment' is baseenv(), since you are not going to be able to 
do very much without the primitives such as * (and even "{"), and 
(relevant here) you will never save anything from it so it will cost you 
nothing.  In this example, 'scale' is supposed to being picked up from the 
environment.  So (removing all the empty statements to save memory)

foo <- function(huge) {
   scale <- mean(huge)
   env <- new.env(parent=baseenv())
   assign("scale", scale, envir=env)
   bar <- function(x) { scale * x }
   environment(bar) <- env
   bar
}

is I think minimal baggage (and fcn saves in 153 bytes).


> -roger
>
> Henrik Bengtsson wrote:
>> Hi,
>>
>> this relates to the question "How to set a former environment?" asked
>> yesterday.  What is the best way to to return a function with a
>> minimal environment from a function? Here is a dummy example:
>>
>> foo <- function(huge) {
>>   scale <- mean(huge)
>>   function(x) { scale * x }
>> }
>>
>> fcn <- foo(1:10e5)
>>
>> The problem with this approach is that the environment of 'fcn' does
>> not only hold 'scale' but also the memory consuming object 'huge',
>> i.e.
>>
>> env <- environment(fcn)
>> ll(envir=env)  # ll() from R.oo
>> #   member data.class dimension object.size
>> # 1   huge    numeric   1000000     4000028
>> # 2  scale    numeric         1          36
>>
>> save(env, file="temp.RData")
>> file.info("temp.RData")$size
>> # [1] 2007624
>>
>> I generate quite a few of these and my 'huge' objects are of order
>> 100Mb, and I want to keep memory usage as well as file sizes to a
>> minimum.  What I do now, is to remove variable from the local
>> environment of 'foo' before returning, i.e.
>>
>> foo2 <- function(huge) {
>>   scale <- mean(huge)
>>   rm(huge)
>>   function(x) { scale * x }
>> }
>>
>> fcn <- foo2(1:10e5)
>> env <- environment(fcn)
>> ll(envir=env)
>> #   member data.class dimension object.size
>> # 1  scale    numeric         1          36
>>
>> save(env, file="temp.RData")
>> file.info("temp.RData")$size
>> # [1] 156
>>
>> Since my "foo" functions are complicated and contains many local
>> variables, it becomes tedious to identify and remove all of them, so
>> instead I try:
>>
>> foo3 <- function(huge) {
>>   scale <- mean(huge);
>>   env <- new.env();
>>   assign("scale", scale, envir=env);
>>   bar <- function(x) { scale * x };
>>   environment(bar) <- env;
>>   bar;
>> }
>>
>> fcn <- foo3(1:10e5)
>>
>> But,
>>
>> env <- environment(fcn)
>> save(env, file="temp.RData");
>> file.info("temp.RData")$size
>> # [1] 2007720
>>
>> When I try to set the parent environment of 'env' to emptyenv(), it
>> does not work, e.g.
>>
>> fcn(2)
>> # Error in fcn(2) : attempt to apply non-function
>>
>> but with the new.env(parent=baseenv()) it works fine. The "base"
>> environment has the empty environment as a parent.  So, I try to do
>> the same myself, i.e. new.env(parent=new.env(parent=emptyenv())), but
>> once again I get
>>
>> fcn(2)
>> # Error in fcn(2) : attempt to apply non-function
>>
>> Apparently, I do not understand enough here.  Please, enlighten me. In
>> the meantime I stick with foo2().
>>
>> Best,
>>
>> Henrik
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From hb at maths.lth.se  Tue Apr  4 17:02:16 2006
From: hb at maths.lth.se (Henrik Bengtsson)
Date: Tue, 4 Apr 2006 17:02:16 +0200
Subject: [Rd] Return function from function with minimal environment
In-Reply-To: <Pine.LNX.4.64.0604040726410.26620@homer22.u.washington.edu>
References: <59d7961d0604040640i5b055b47mfb84d1c746e2ef27@mail.gmail.com>
	<Pine.LNX.4.64.0604040726410.26620@homer22.u.washington.edu>
Message-ID: <59d7961d0604040802l7e16e741k5b9625eab21ed8f6@mail.gmail.com>

On 4/4/06, Thomas Lumley <tlumley at u.washington.edu> wrote:
> On Tue, 4 Apr 2006, Henrik Bengtsson wrote:
>
> > Hi,
> >
> > this relates to the question "How to set a former environment?" asked
> > yesterday.  What is the best way to to return a function with a
> > minimal environment from a function? Here is a dummy example:
> >
> > foo <- function(huge) {
> >  scale <- mean(huge)
> >  function(x) { scale * x }
> > }
> >
> > fcn <- foo(1:10e5)
> >
> > The problem with this approach is that the environment of 'fcn' does
> > not only hold 'scale' but also the memory consuming object 'huge',
> > i.e.
> >
> > env <- environment(fcn)
> > ll(envir=env)  # ll() from R.oo
> > #   member data.class dimension object.size
> > # 1   huge    numeric   1000000     4000028
> > # 2  scale    numeric         1          36
> >
> > save(env, file="temp.RData")
> > file.info("temp.RData")$size
> > # [1] 2007624
> >
> > I generate quite a few of these and my 'huge' objects are of order
> > 100Mb, and I want to keep memory usage as well as file sizes to a
> > minimum.  What I do now, is to remove variable from the local
> > environment of 'foo' before returning, i.e.
> >
> > foo2 <- function(huge) {
> >  scale <- mean(huge)
> >  rm(huge)
> >  function(x) { scale * x }
> > }
> >
> > fcn <- foo2(1:10e5)
> > env <- environment(fcn)
> > ll(envir=env)
> > #   member data.class dimension object.size
> > # 1  scale    numeric         1          36
> >
> > save(env, file="temp.RData")
> > file.info("temp.RData")$size
> > # [1] 156
> >
> > Since my "foo" functions are complicated and contains many local
> > variables, it becomes tedious to identify and remove all of them, so
> > instead I try:
> >
> > foo3 <- function(huge) {
> >  scale <- mean(huge);
> >  env <- new.env();
> >  assign("scale", scale, envir=env);
> >  bar <- function(x) { scale * x };
> >  environment(bar) <- env;
> >  bar;
> > }
> >
> > fcn <- foo3(1:10e5)
> >
> > But,
> >
> > env <- environment(fcn)
> > save(env, file="temp.RData");
> > file.info("temp.RData")$size
> > # [1] 2007720
> >
> > When I try to set the parent environment of 'env' to emptyenv(), it
> > does not work, e.g.
> >
> > fcn(2)
> > # Error in fcn(2) : attempt to apply non-function
> >
> > but with the new.env(parent=baseenv()) it works fine. The "base"
> > environment has the empty environment as a parent.  So, I try to do
> > the same myself, i.e. new.env(parent=new.env(parent=emptyenv())), but
> > once again I get
>
> I don't think you want to remove baseenv() from the environment. If you
> do, no functions from baseenv will be visible inside fcn. These include
> "{" and "*", which are necessary for your function. I think the error
> message comes from being unable to find "{".

Thank you, this makes sense. Modifying Roger Peng's example
illustrates what you say:

foo <- function(huge) {
        scale <- mean(huge)
        g <- function(x) x
        environment(g) <- emptyenv()
        g
}

fcn <- foo(1:10e5)
fcn(2)
# [1] 2

But as soon as you add "something" to the g(), it is missing;

foo <- function(huge) {
        scale <- mean(huge)
        g <- function(x) { x }
        environment(g) <- emptyenv()
        g
}

fcn <- foo(1:10e5)
fcn(2)
# Error in fcn(2) : attempt to apply non-function

...and I did not know that "{" and "(" are primitive functions.  Interesting.

I conclude that 'env <- new.env(parent=baseenv())' is better than
''env <- new.env()' in my case.

I learned something new. Thanks.

Henrik

> Also, there is no memory use from having baseenv in the environment, since
> all the objects in baseenv are always present.
>
>         -thomas
>
>
> Thomas Lumley                   Assoc. Professor, Biostatistics
> tlumley at u.washington.edu        University of Washington, Seattle
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


--
Henrik Bengtsson
Mobile: +46 708 909208 (+2h UTC)


From ggrothendieck at gmail.com  Tue Apr  4 17:10:49 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Tue, 4 Apr 2006 11:10:49 -0400
Subject: [Rd] Return function from function with minimal environment
In-Reply-To: <59d7961d0604040802l7e16e741k5b9625eab21ed8f6@mail.gmail.com>
References: <59d7961d0604040640i5b055b47mfb84d1c746e2ef27@mail.gmail.com>
	<Pine.LNX.4.64.0604040726410.26620@homer22.u.washington.edu>
	<59d7961d0604040802l7e16e741k5b9625eab21ed8f6@mail.gmail.com>
Message-ID: <971536df0604040810g364055bay2c18f30ba11c48c7@mail.gmail.com>

On 4/4/06, Henrik Bengtsson <hb at maths.lth.se> wrote:
> On 4/4/06, Thomas Lumley <tlumley at u.washington.edu> wrote:
> > On Tue, 4 Apr 2006, Henrik Bengtsson wrote:
> >
> > > Hi,
> > >
> > > this relates to the question "How to set a former environment?" asked
> > > yesterday.  What is the best way to to return a function with a
> > > minimal environment from a function? Here is a dummy example:
> > >
> > > foo <- function(huge) {
> > >  scale <- mean(huge)
> > >  function(x) { scale * x }
> > > }
> > >
> > > fcn <- foo(1:10e5)
> > >
> > > The problem with this approach is that the environment of 'fcn' does
> > > not only hold 'scale' but also the memory consuming object 'huge',
> > > i.e.
> > >
> > > env <- environment(fcn)
> > > ll(envir=env)  # ll() from R.oo
> > > #   member data.class dimension object.size
> > > # 1   huge    numeric   1000000     4000028
> > > # 2  scale    numeric         1          36
> > >
> > > save(env, file="temp.RData")
> > > file.info("temp.RData")$size
> > > # [1] 2007624
> > >
> > > I generate quite a few of these and my 'huge' objects are of order
> > > 100Mb, and I want to keep memory usage as well as file sizes to a
> > > minimum.  What I do now, is to remove variable from the local
> > > environment of 'foo' before returning, i.e.
> > >
> > > foo2 <- function(huge) {
> > >  scale <- mean(huge)
> > >  rm(huge)
> > >  function(x) { scale * x }
> > > }
> > >
> > > fcn <- foo2(1:10e5)
> > > env <- environment(fcn)
> > > ll(envir=env)
> > > #   member data.class dimension object.size
> > > # 1  scale    numeric         1          36
> > >
> > > save(env, file="temp.RData")
> > > file.info("temp.RData")$size
> > > # [1] 156
> > >
> > > Since my "foo" functions are complicated and contains many local
> > > variables, it becomes tedious to identify and remove all of them, so
> > > instead I try:
> > >
> > > foo3 <- function(huge) {
> > >  scale <- mean(huge);
> > >  env <- new.env();
> > >  assign("scale", scale, envir=env);
> > >  bar <- function(x) { scale * x };
> > >  environment(bar) <- env;
> > >  bar;
> > > }
> > >
> > > fcn <- foo3(1:10e5)
> > >
> > > But,
> > >
> > > env <- environment(fcn)
> > > save(env, file="temp.RData");
> > > file.info("temp.RData")$size
> > > # [1] 2007720
> > >
> > > When I try to set the parent environment of 'env' to emptyenv(), it
> > > does not work, e.g.
> > >
> > > fcn(2)
> > > # Error in fcn(2) : attempt to apply non-function
> > >
> > > but with the new.env(parent=baseenv()) it works fine. The "base"
> > > environment has the empty environment as a parent.  So, I try to do
> > > the same myself, i.e. new.env(parent=new.env(parent=emptyenv())), but
> > > once again I get
> >
> > I don't think you want to remove baseenv() from the environment. If you
> > do, no functions from baseenv will be visible inside fcn. These include
> > "{" and "*", which are necessary for your function. I think the error
> > message comes from being unable to find "{".
>
> Thank you, this makes sense. Modifying Roger Peng's example
> illustrates what you say:
>
> foo <- function(huge) {
>        scale <- mean(huge)
>        g <- function(x) x
>        environment(g) <- emptyenv()
>        g
> }
>
> fcn <- foo(1:10e5)
> fcn(2)
> # [1] 2
>
> But as soon as you add "something" to the g(), it is missing;
>
> foo <- function(huge) {
>        scale <- mean(huge)
>        g <- function(x) { x }
>        environment(g) <- emptyenv()
>        g
> }
>
> fcn <- foo(1:10e5)
> fcn(2)
> # Error in fcn(2) : attempt to apply non-function
>
> ...and I did not know that "{" and "(" are primitive functions.  Interesting.
>
> I conclude that 'env <- new.env(parent=baseenv())' is better than
> ''env <- new.env()' in my case.

Is there any reason to use

   env <- new.env(parent=baseenv())

instead of just

   env <- baseenv() ?

The extra environment being created seems to serve no purpose.


From maechler at stat.math.ethz.ch  Tue Apr  4 17:11:24 2006
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Tue, 4 Apr 2006 17:11:24 +0200
Subject: [Rd] Return function from function with minimal environment
In-Reply-To: <443284E5.2050105@jhsph.edu>
References: <59d7961d0604040640i5b055b47mfb84d1c746e2ef27@mail.gmail.com>
	<443284E5.2050105@jhsph.edu>
Message-ID: <17458.35996.501722.419233@stat.math.ethz.ch>

>>>>> "Roger" == Roger D Peng <rpeng at jhsph.edu>
>>>>>     on Tue, 04 Apr 2006 10:38:29 -0400 writes:

    Roger> In R 2.3.0-to-be, I think you can do

    Roger> foo <- function(huge) {
    Roger> scale <- mean(huge)
    Roger> g <- function(x) { scale * x }
    Roger> environment(g) <- emptyenv()
    Roger> g
    Roger> }

yes, but for now, and for the given purpose,
also as seen in examples, such as  splinefun() or approxfun(),
just rm() the things  you don't want in the environment.
I.e.,

 foo <- function(huge) {
    scale <- mean(huge)
    rm(huge)
    function(x) { scale * x }
 }


Martin

    Roger> -roger

    Roger> Henrik Bengtsson wrote:
    >> Hi,
    >> 
    >> this relates to the question "How to set a former environment?" asked
    >> yesterday.  What is the best way to to return a function with a
    >> minimal environment from a function? Here is a dummy example:
    >> 
    >> foo <- function(huge) {
    >> scale <- mean(huge)
    >> function(x) { scale * x }
    >> }
    >> 
    >> fcn <- foo(1:10e5)
    >> 
    >> The problem with this approach is that the environment of 'fcn' does
    >> not only hold 'scale' but also the memory consuming object 'huge',
    >> i.e.
    >> 
    >> env <- environment(fcn)
    >> ll(envir=env)  # ll() from R.oo
    >> #   member data.class dimension object.size
    >> # 1   huge    numeric   1000000     4000028
    >> # 2  scale    numeric         1          36
    >> 
    >> save(env, file="temp.RData")
    >> file.info("temp.RData")$size
    >> # [1] 2007624
    >> 
    >> I generate quite a few of these and my 'huge' objects are of order
    >> 100Mb, and I want to keep memory usage as well as file sizes to a
    >> minimum.  What I do now, is to remove variable from the local
    >> environment of 'foo' before returning, i.e.
    >> 
    >> foo2 <- function(huge) {
    >> scale <- mean(huge)
    >> rm(huge)
    >> function(x) { scale * x }
    >> }
    >> 
    >> fcn <- foo2(1:10e5)
    >> env <- environment(fcn)
    >> ll(envir=env)
    >> #   member data.class dimension object.size
    >> # 1  scale    numeric         1          36
    >> 
    >> save(env, file="temp.RData")
    >> file.info("temp.RData")$size
    >> # [1] 156
    >> 
    >> Since my "foo" functions are complicated and contains many local
    >> variables, it becomes tedious to identify and remove all of them, so
    >> instead I try:
    >> 
    >> foo3 <- function(huge) {
    >> scale <- mean(huge);
    >> env <- new.env();
    >> assign("scale", scale, envir=env);
    >> bar <- function(x) { scale * x };
    >> environment(bar) <- env;
    >> bar;
    >> }
    >> 
    >> fcn <- foo3(1:10e5)
    >> 
    >> But,
    >> 
    >> env <- environment(fcn)
    >> save(env, file="temp.RData");
    >> file.info("temp.RData")$size
    >> # [1] 2007720
    >> 
    >> When I try to set the parent environment of 'env' to emptyenv(), it
    >> does not work, e.g.
    >> 
    >> fcn(2)
    >> # Error in fcn(2) : attempt to apply non-function
    >> 
    >> but with the new.env(parent=baseenv()) it works fine. The "base"
    >> environment has the empty environment as a parent.  So, I try to do
    >> the same myself, i.e. new.env(parent=new.env(parent=emptyenv())), but
    >> once again I get
    >> 
    >> fcn(2)
    >> # Error in fcn(2) : attempt to apply non-function
    >> 
    >> Apparently, I do not understand enough here.  Please, enlighten me. In
    >> the meantime I stick with foo2().
    >> 
    >> Best,
    >> 
    >> Henrik
    >> 
    >> ______________________________________________
    >> R-devel at r-project.org mailing list
    >> https://stat.ethz.ch/mailman/listinfo/r-devel
    >> 

    Roger> -- 
    Roger> Roger D. Peng  |  http://www.biostat.jhsph.edu/~rpeng/

    Roger> ______________________________________________
    Roger> R-devel at r-project.org mailing list
    Roger> https://stat.ethz.ch/mailman/listinfo/r-devel


From ivowel at gmail.com  Tue Apr  4 17:21:55 2006
From: ivowel at gmail.com (ivo welch)
Date: Tue, 4 Apr 2006 11:21:55 -0400
Subject: [Rd] request to add argv[0]
Message-ID: <50d1c22d0604040821n53cc6df5g24ae0e4b67e91688@mail.gmail.com>

Dear R Developers:  This has come up repeatedly in the r-help mailing
list, most recently in a thread started by myself.  The answers have
been changing over the years.  Would it be possible and easy for R to
offer a global read-only option that gives the name of the currently
executing R script, i.e., the equivalent of argv[0] in C?

  (PS: An even better mechanism would be the ability to pick off multiple
   arguments following the .R file, different from commandArgs(),
   but this is not as important and probably more difficult as it would change
   the invokation syntax of R.)

sincerely,

/ivo welch


From hb at maths.lth.se  Tue Apr  4 17:34:35 2006
From: hb at maths.lth.se (Henrik Bengtsson)
Date: Tue, 4 Apr 2006 17:34:35 +0200
Subject: [Rd] Return function from function with minimal environment
In-Reply-To: <Pine.LNX.4.64.0604041544200.32041@gannet.stats.ox.ac.uk>
References: <59d7961d0604040640i5b055b47mfb84d1c746e2ef27@mail.gmail.com>
	<443284E5.2050105@jhsph.edu>
	<Pine.LNX.4.64.0604041544200.32041@gannet.stats.ox.ac.uk>
Message-ID: <59d7961d0604040834y3ee7f60eid74717a46f0716d7@mail.gmail.com>

On 4/4/06, Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
> On Tue, 4 Apr 2006, Roger D. Peng wrote:
>
> > In R 2.3.0-to-be, I think you can do
> >
> > foo <- function(huge) {
> >       scale <- mean(huge)
> >       g <- function(x) { scale * x }
> >       environment(g) <- emptyenv()
> >       g
> > }
>
> You can, but you really don't want to and you will get the same error. A
> 'minimal environment' is baseenv(), since you are not going to be able to
> do very much without the primitives such as * (and even "{"), and
> (relevant here) you will never save anything from it so it will cost you
> nothing.  In this example, 'scale' is supposed to being picked up from the
> environment.  So (removing all the empty statements to save memory)
>
> foo <- function(huge) {
>    scale <- mean(huge)
>    env <- new.env(parent=baseenv())
>    assign("scale", scale, envir=env)
>    bar <- function(x) { scale * x }
>    environment(bar) <- env
>    bar
> }
>
> is I think minimal baggage (and fcn saves in 153 bytes).

Thanks.  For (mine and other's) record: The base environment is very
specially that it is always guaranteed to exists, and that save()
knows about this too, because it does not warn about "package ... may
not be available when loading".

In the real example I'm trying to do, my returned function calls a
function in the stats package.  The naive approach is then to do:

foo <- function(huge) {
  mu <- mean(huge)
  parent <- pos.to.env(which("package:stats" == search()));
  env <- new.env(parent=parent)
  assign("mu", mu, envir=env)
  bar <- function(n) { rnorm(n, mean=mu) }
  environment(bar) <- env
  bar
}

fcn <- foo(1:10)
print(fcn(5))
env <- environment(fcn)
save(env, file="temp.RData")

However, then you get "Warning message: 'package:stats' may not be
available when loading".  To the best of my understanding right now,
it is better to use "::" as below:

foo <- function(huge) {
  mu <- mean(huge)
  env <- new.env(parent=baseenv())
  assign("mu", mu, envir=env)
  bar <- function(n) { stats::rnorm(n, mean=mu) }
  environment(bar) <- env
  bar
}

/Henrik

> > -roger
> >
> > Henrik Bengtsson wrote:
> >> Hi,
> >>
> >> this relates to the question "How to set a former environment?" asked
> >> yesterday.  What is the best way to to return a function with a
> >> minimal environment from a function? Here is a dummy example:
> >>
> >> foo <- function(huge) {
> >>   scale <- mean(huge)
> >>   function(x) { scale * x }
> >> }
> >>
> >> fcn <- foo(1:10e5)
> >>
> >> The problem with this approach is that the environment of 'fcn' does
> >> not only hold 'scale' but also the memory consuming object 'huge',
> >> i.e.
> >>
> >> env <- environment(fcn)
> >> ll(envir=env)  # ll() from R.oo
> >> #   member data.class dimension object.size
> >> # 1   huge    numeric   1000000     4000028
> >> # 2  scale    numeric         1          36
> >>
> >> save(env, file="temp.RData")
> >> file.info("temp.RData")$size
> >> # [1] 2007624
> >>
> >> I generate quite a few of these and my 'huge' objects are of order
> >> 100Mb, and I want to keep memory usage as well as file sizes to a
> >> minimum.  What I do now, is to remove variable from the local
> >> environment of 'foo' before returning, i.e.
> >>
> >> foo2 <- function(huge) {
> >>   scale <- mean(huge)
> >>   rm(huge)
> >>   function(x) { scale * x }
> >> }
> >>
> >> fcn <- foo2(1:10e5)
> >> env <- environment(fcn)
> >> ll(envir=env)
> >> #   member data.class dimension object.size
> >> # 1  scale    numeric         1          36
> >>
> >> save(env, file="temp.RData")
> >> file.info("temp.RData")$size
> >> # [1] 156
> >>
> >> Since my "foo" functions are complicated and contains many local
> >> variables, it becomes tedious to identify and remove all of them, so
> >> instead I try:
> >>
> >> foo3 <- function(huge) {
> >>   scale <- mean(huge);
> >>   env <- new.env();
> >>   assign("scale", scale, envir=env);
> >>   bar <- function(x) { scale * x };
> >>   environment(bar) <- env;
> >>   bar;
> >> }
> >>
> >> fcn <- foo3(1:10e5)
> >>
> >> But,
> >>
> >> env <- environment(fcn)
> >> save(env, file="temp.RData");
> >> file.info("temp.RData")$size
> >> # [1] 2007720
> >>
> >> When I try to set the parent environment of 'env' to emptyenv(), it
> >> does not work, e.g.
> >>
> >> fcn(2)
> >> # Error in fcn(2) : attempt to apply non-function
> >>
> >> but with the new.env(parent=baseenv()) it works fine. The "base"
> >> environment has the empty environment as a parent.  So, I try to do
> >> the same myself, i.e. new.env(parent=new.env(parent=emptyenv())), but
> >> once again I get
> >>
> >> fcn(2)
> >> # Error in fcn(2) : attempt to apply non-function
> >>
> >> Apparently, I do not understand enough here.  Please, enlighten me. In
> >> the meantime I stick with foo2().
> >>
> >> Best,
> >>
> >> Henrik
> >>
> >> ______________________________________________
> >> R-devel at r-project.org mailing list
> >> https://stat.ethz.ch/mailman/listinfo/r-devel
> >>
> >
> >
>
> --
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>
>


From hb at maths.lth.se  Tue Apr  4 17:38:53 2006
From: hb at maths.lth.se (Henrik Bengtsson)
Date: Tue, 4 Apr 2006 17:38:53 +0200
Subject: [Rd] Return function from function with minimal environment
In-Reply-To: <971536df0604040810g364055bay2c18f30ba11c48c7@mail.gmail.com>
References: <59d7961d0604040640i5b055b47mfb84d1c746e2ef27@mail.gmail.com>
	<Pine.LNX.4.64.0604040726410.26620@homer22.u.washington.edu>
	<59d7961d0604040802l7e16e741k5b9625eab21ed8f6@mail.gmail.com>
	<971536df0604040810g364055bay2c18f30ba11c48c7@mail.gmail.com>
Message-ID: <59d7961d0604040838t681d4fbfs83f8ee472db6c170@mail.gmail.com>

On 4/4/06, Gabor Grothendieck <ggrothendieck at gmail.com> wrote:
> On 4/4/06, Henrik Bengtsson <hb at maths.lth.se> wrote:
> > On 4/4/06, Thomas Lumley <tlumley at u.washington.edu> wrote:
> > > On Tue, 4 Apr 2006, Henrik Bengtsson wrote:
> > >
> > > > Hi,
> > > >
> > > > this relates to the question "How to set a former environment?" asked
> > > > yesterday.  What is the best way to to return a function with a
> > > > minimal environment from a function? Here is a dummy example:
> > > >
> > > > foo <- function(huge) {
> > > >  scale <- mean(huge)
> > > >  function(x) { scale * x }
> > > > }
> > > >
> > > > fcn <- foo(1:10e5)
> > > >
> > > > The problem with this approach is that the environment of 'fcn' does
> > > > not only hold 'scale' but also the memory consuming object 'huge',
> > > > i.e.
> > > >
> > > > env <- environment(fcn)
> > > > ll(envir=env)  # ll() from R.oo
> > > > #   member data.class dimension object.size
> > > > # 1   huge    numeric   1000000     4000028
> > > > # 2  scale    numeric         1          36
> > > >
> > > > save(env, file="temp.RData")
> > > > file.info("temp.RData")$size
> > > > # [1] 2007624
> > > >
> > > > I generate quite a few of these and my 'huge' objects are of order
> > > > 100Mb, and I want to keep memory usage as well as file sizes to a
> > > > minimum.  What I do now, is to remove variable from the local
> > > > environment of 'foo' before returning, i.e.
> > > >
> > > > foo2 <- function(huge) {
> > > >  scale <- mean(huge)
> > > >  rm(huge)
> > > >  function(x) { scale * x }
> > > > }
> > > >
> > > > fcn <- foo2(1:10e5)
> > > > env <- environment(fcn)
> > > > ll(envir=env)
> > > > #   member data.class dimension object.size
> > > > # 1  scale    numeric         1          36
> > > >
> > > > save(env, file="temp.RData")
> > > > file.info("temp.RData")$size
> > > > # [1] 156
> > > >
> > > > Since my "foo" functions are complicated and contains many local
> > > > variables, it becomes tedious to identify and remove all of them, so
> > > > instead I try:
> > > >
> > > > foo3 <- function(huge) {
> > > >  scale <- mean(huge);
> > > >  env <- new.env();
> > > >  assign("scale", scale, envir=env);
> > > >  bar <- function(x) { scale * x };
> > > >  environment(bar) <- env;
> > > >  bar;
> > > > }
> > > >
> > > > fcn <- foo3(1:10e5)
> > > >
> > > > But,
> > > >
> > > > env <- environment(fcn)
> > > > save(env, file="temp.RData");
> > > > file.info("temp.RData")$size
> > > > # [1] 2007720
> > > >
> > > > When I try to set the parent environment of 'env' to emptyenv(), it
> > > > does not work, e.g.
> > > >
> > > > fcn(2)
> > > > # Error in fcn(2) : attempt to apply non-function
> > > >
> > > > but with the new.env(parent=baseenv()) it works fine. The "base"
> > > > environment has the empty environment as a parent.  So, I try to do
> > > > the same myself, i.e. new.env(parent=new.env(parent=emptyenv())), but
> > > > once again I get
> > >
> > > I don't think you want to remove baseenv() from the environment. If you
> > > do, no functions from baseenv will be visible inside fcn. These include
> > > "{" and "*", which are necessary for your function. I think the error
> > > message comes from being unable to find "{".
> >
> > Thank you, this makes sense. Modifying Roger Peng's example
> > illustrates what you say:
> >
> > foo <- function(huge) {
> >        scale <- mean(huge)
> >        g <- function(x) x
> >        environment(g) <- emptyenv()
> >        g
> > }
> >
> > fcn <- foo(1:10e5)
> > fcn(2)
> > # [1] 2
> >
> > But as soon as you add "something" to the g(), it is missing;
> >
> > foo <- function(huge) {
> >        scale <- mean(huge)
> >        g <- function(x) { x }
> >        environment(g) <- emptyenv()
> >        g
> > }
> >
> > fcn <- foo(1:10e5)
> > fcn(2)
> > # Error in fcn(2) : attempt to apply non-function
> >
> > ...and I did not know that "{" and "(" are primitive functions.  Interesting.
> >
> > I conclude that 'env <- new.env(parent=baseenv())' is better than
> > ''env <- new.env()' in my case.
>
> Is there any reason to use
>
>    env <- new.env(parent=baseenv())
>
> instead of just
>
>    env <- baseenv() ?
>
> The extra environment being created seems to serve no purpose.

I need to do this, because I do not want to assign 'scale' to the base
environment:

foo <- function(huge) {
  scale <- mean(huge)
  env <- new.env(parent=baseenv())
  # cf. env <- baseenv()
  assign("scale", scale, envir=env)
  bar <- function(x) { scale * x }
  environment(bar) <- env
  bar
}

/Henrik

> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


--
Henrik Bengtsson
Mobile: +46 708 909208 (+2h UTC)


From rpeng at jhsph.edu  Tue Apr  4 17:42:33 2006
From: rpeng at jhsph.edu (Roger D. Peng)
Date: Tue, 04 Apr 2006 11:42:33 -0400
Subject: [Rd] request to add argv[0]
In-Reply-To: <50d1c22d0604040821n53cc6df5g24ae0e4b67e91688@mail.gmail.com>
References: <50d1c22d0604040821n53cc6df5g24ae0e4b67e91688@mail.gmail.com>
Message-ID: <443293E9.3020608@jhsph.edu>



ivo welch wrote:
> Dear R Developers:  This has come up repeatedly in the r-help mailing
> list, most recently in a thread started by myself.  The answers have
> been changing over the years.  Would it be possible and easy for R to
> offer a global read-only option that gives the name of the currently
> executing R script, i.e., the equivalent of argv[0] in C?

Isn't that just `commandArgs()[1]'?  I must be misunderstanding your question.

> 
>   (PS: An even better mechanism would be the ability to pick off multiple
>    arguments following the .R file, different from commandArgs(),
>    but this is not as important and probably more difficult as it would change
>    the invokation syntax of R.)
> 
> sincerely,
> 
> /ivo welch
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 

-- 
Roger D. Peng  |  http://www.biostat.jhsph.edu/~rpeng/


From ggrothendieck at gmail.com  Tue Apr  4 17:53:09 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Tue, 4 Apr 2006 11:53:09 -0400
Subject: [Rd] Return function from function with minimal environment
In-Reply-To: <59d7961d0604040838t681d4fbfs83f8ee472db6c170@mail.gmail.com>
References: <59d7961d0604040640i5b055b47mfb84d1c746e2ef27@mail.gmail.com>
	<Pine.LNX.4.64.0604040726410.26620@homer22.u.washington.edu>
	<59d7961d0604040802l7e16e741k5b9625eab21ed8f6@mail.gmail.com>
	<971536df0604040810g364055bay2c18f30ba11c48c7@mail.gmail.com>
	<59d7961d0604040838t681d4fbfs83f8ee472db6c170@mail.gmail.com>
Message-ID: <971536df0604040853q173f1559i2b88b57712c4bbff@mail.gmail.com>

On 4/4/06, Henrik Bengtsson <hb at maths.lth.se> wrote:
> On 4/4/06, Gabor Grothendieck <ggrothendieck at gmail.com> wrote:
> > On 4/4/06, Henrik Bengtsson <hb at maths.lth.se> wrote:
> > > On 4/4/06, Thomas Lumley <tlumley at u.washington.edu> wrote:
> > > > On Tue, 4 Apr 2006, Henrik Bengtsson wrote:
> > > >
> > > > > Hi,
> > > > >
> > > > > this relates to the question "How to set a former environment?" asked
> > > > > yesterday.  What is the best way to to return a function with a
> > > > > minimal environment from a function? Here is a dummy example:
> > > > >
> > > > > foo <- function(huge) {
> > > > >  scale <- mean(huge)
> > > > >  function(x) { scale * x }
> > > > > }
> > > > >
> > > > > fcn <- foo(1:10e5)
> > > > >
> > > > > The problem with this approach is that the environment of 'fcn' does
> > > > > not only hold 'scale' but also the memory consuming object 'huge',
> > > > > i.e.
> > > > >
> > > > > env <- environment(fcn)
> > > > > ll(envir=env)  # ll() from R.oo
> > > > > #   member data.class dimension object.size
> > > > > # 1   huge    numeric   1000000     4000028
> > > > > # 2  scale    numeric         1          36
> > > > >
> > > > > save(env, file="temp.RData")
> > > > > file.info("temp.RData")$size
> > > > > # [1] 2007624
> > > > >
> > > > > I generate quite a few of these and my 'huge' objects are of order
> > > > > 100Mb, and I want to keep memory usage as well as file sizes to a
> > > > > minimum.  What I do now, is to remove variable from the local
> > > > > environment of 'foo' before returning, i.e.
> > > > >
> > > > > foo2 <- function(huge) {
> > > > >  scale <- mean(huge)
> > > > >  rm(huge)
> > > > >  function(x) { scale * x }
> > > > > }
> > > > >
> > > > > fcn <- foo2(1:10e5)
> > > > > env <- environment(fcn)
> > > > > ll(envir=env)
> > > > > #   member data.class dimension object.size
> > > > > # 1  scale    numeric         1          36
> > > > >
> > > > > save(env, file="temp.RData")
> > > > > file.info("temp.RData")$size
> > > > > # [1] 156
> > > > >
> > > > > Since my "foo" functions are complicated and contains many local
> > > > > variables, it becomes tedious to identify and remove all of them, so
> > > > > instead I try:
> > > > >
> > > > > foo3 <- function(huge) {
> > > > >  scale <- mean(huge);
> > > > >  env <- new.env();
> > > > >  assign("scale", scale, envir=env);
> > > > >  bar <- function(x) { scale * x };
> > > > >  environment(bar) <- env;
> > > > >  bar;
> > > > > }
> > > > >
> > > > > fcn <- foo3(1:10e5)
> > > > >
> > > > > But,
> > > > >
> > > > > env <- environment(fcn)
> > > > > save(env, file="temp.RData");
> > > > > file.info("temp.RData")$size
> > > > > # [1] 2007720
> > > > >
> > > > > When I try to set the parent environment of 'env' to emptyenv(), it
> > > > > does not work, e.g.
> > > > >
> > > > > fcn(2)
> > > > > # Error in fcn(2) : attempt to apply non-function
> > > > >
> > > > > but with the new.env(parent=baseenv()) it works fine. The "base"
> > > > > environment has the empty environment as a parent.  So, I try to do
> > > > > the same myself, i.e. new.env(parent=new.env(parent=emptyenv())), but
> > > > > once again I get
> > > >
> > > > I don't think you want to remove baseenv() from the environment. If you
> > > > do, no functions from baseenv will be visible inside fcn. These include
> > > > "{" and "*", which are necessary for your function. I think the error
> > > > message comes from being unable to find "{".
> > >
> > > Thank you, this makes sense. Modifying Roger Peng's example
> > > illustrates what you say:
> > >
> > > foo <- function(huge) {
> > >        scale <- mean(huge)
> > >        g <- function(x) x
> > >        environment(g) <- emptyenv()
> > >        g
> > > }
> > >
> > > fcn <- foo(1:10e5)
> > > fcn(2)
> > > # [1] 2
> > >
> > > But as soon as you add "something" to the g(), it is missing;
> > >
> > > foo <- function(huge) {
> > >        scale <- mean(huge)
> > >        g <- function(x) { x }
> > >        environment(g) <- emptyenv()
> > >        g
> > > }
> > >
> > > fcn <- foo(1:10e5)
> > > fcn(2)
> > > # Error in fcn(2) : attempt to apply non-function
> > >
> > > ...and I did not know that "{" and "(" are primitive functions.  Interesting.
> > >
> > > I conclude that 'env <- new.env(parent=baseenv())' is better than
> > > ''env <- new.env()' in my case.
> >
> > Is there any reason to use
> >
> >    env <- new.env(parent=baseenv())
> >
> > instead of just
> >
> >    env <- baseenv() ?
> >
> > The extra environment being created seems to serve no purpose.
>
> I need to do this, because I do not want to assign 'scale' to the base
> environment:
>
> foo <- function(huge) {
>  scale <- mean(huge)
>  env <- new.env(parent=baseenv())
>  # cf. env <- baseenv()
>  assign("scale", scale, envir=env)
>  bar <- function(x) { scale * x }
>  environment(bar) <- env
>  bar
> }
>

OK. I think the example changed throughout the discussion and
scale was not part of the latter examples.

At any rate the version with scale could be reduced to one line using evalq:

foo <- function(huge)
   evalq(function(x) { scale * x }, list(scale = mean(huge)), baseenv())


From bill at insightful.com  Tue Apr  4 17:54:17 2006
From: bill at insightful.com (Bill Dunlap)
Date: Tue, 4 Apr 2006 08:54:17 -0700 (PDT)
Subject: [Rd] extending strsplit(): supply pattern to keep, not to split by
Message-ID: <Pine.GSO.4.56.0604040832290.21795@octopus>

strsplit() is a convenient way to get a
list of items from a string when you
have a regular expression for what is not
an item.  E.g.,

   > strsplit("1.2, 34, 1.7e-2", split="[ ,] *")
   [[1]]:
   [1] "1.2"    "34"     "1.7e-2"

However, sometimes is it more convenient to
give a pattern for the items you do want.
E.g., suppose you want to pull all the numbers
out of a string which contains a mix of numbers
and words.  Making a pattern for what a
number is simpler than making a pattern
for what may come between the number.
   > number.pattern <- "[-+]?(([0-9]+(\\.[0-9]*)?)|(\\.[0-9]+))([eE][+-]?[0-9]+)?"

I propose adding a keep=FALSE argument to
strsplit() to do this.  If keep is FALSE,
then the split argument matches the stuff to
omit from the output; if keep is TRUE then
split matches the stuff to put into the
output.  Then we could do the following to
get a list of all the numbers in a string
(done in a version of strsplit() I'm working on
for S-PLUS):

   > strsplit("1.2, 34, 1.7e-2", split=number.pattern,keep=TRUE)
   [[1]]:
   [1] "1.2"    "34"     "1.7e-2"

   > strsplit("Ibuprofin 200mg", split=number.pattern,keep=TRUE)
   [[1]]:
   [1] "200"

Is this a reasonable thing to want strsplit to do?
Is this a reasonable parameterization of it?

----------------------------------------------------------------------------
Bill Dunlap
Insightful Corporation
bill at insightful dot com
360-428-8146

 "All statements in this message represent the opinions of the author and do
 not necessarily reflect Insightful Corporation policy or position."


From ggrothendieck at gmail.com  Tue Apr  4 18:01:42 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Tue, 4 Apr 2006 12:01:42 -0400
Subject: [Rd] extending strsplit(): supply pattern to keep,
	not to split by
In-Reply-To: <Pine.GSO.4.56.0604040832290.21795@octopus>
References: <Pine.GSO.4.56.0604040832290.21795@octopus>
Message-ID: <971536df0604040901i47a96891t7f1d8d587caf384a@mail.gmail.com>

gsubfn in package gsubfn can do this.  See the examples
in ?gsubfn


On 4/4/06, Bill Dunlap <bill at insightful.com> wrote:
> strsplit() is a convenient way to get a
> list of items from a string when you
> have a regular expression for what is not
> an item.  E.g.,
>
>   > strsplit("1.2, 34, 1.7e-2", split="[ ,] *")
>   [[1]]:
>   [1] "1.2"    "34"     "1.7e-2"
>
> However, sometimes is it more convenient to
> give a pattern for the items you do want.
> E.g., suppose you want to pull all the numbers
> out of a string which contains a mix of numbers
> and words.  Making a pattern for what a
> number is simpler than making a pattern
> for what may come between the number.
>   > number.pattern <- "[-+]?(([0-9]+(\\.[0-9]*)?)|(\\.[0-9]+))([eE][+-]?[0-9]+)?"
>
> I propose adding a keep=FALSE argument to
> strsplit() to do this.  If keep is FALSE,
> then the split argument matches the stuff to
> omit from the output; if keep is TRUE then
> split matches the stuff to put into the
> output.  Then we could do the following to
> get a list of all the numbers in a string
> (done in a version of strsplit() I'm working on
> for S-PLUS):
>
>   > strsplit("1.2, 34, 1.7e-2", split=number.pattern,keep=TRUE)
>   [[1]]:
>   [1] "1.2"    "34"     "1.7e-2"
>
>   > strsplit("Ibuprofin 200mg", split=number.pattern,keep=TRUE)
>   [[1]]:
>   [1] "200"
>
> Is this a reasonable thing to want strsplit to do?
> Is this a reasonable parameterization of it?
>
> ----------------------------------------------------------------------------
> Bill Dunlap
> Insightful Corporation
> bill at insightful dot com
> 360-428-8146
>
>  "All statements in this message represent the opinions of the author and do
>  not necessarily reflect Insightful Corporation policy or position."
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From tlumley at u.washington.edu  Tue Apr  4 19:00:23 2006
From: tlumley at u.washington.edu (Thomas Lumley)
Date: Tue, 4 Apr 2006 10:00:23 -0700 (PDT)
Subject: [Rd] change function's formals default values
In-Reply-To: <1144161750.18246.7.camel@populus.fr.umn.edu>
References: <1144114759.15762.3.camel@populus.fr.umn.edu> 
	<Pine.LNX.4.64.0604040714090.26620@homer22.u.washington.edu>
	<1144161750.18246.7.camel@populus.fr.umn.edu>
Message-ID: <Pine.LNX.4.64.0604040941280.21419@homer23.u.washington.edu>

On Tue, 4 Apr 2006, Andrew Finley wrote:

> Hi Thomas,
>
> Thanks for the note. I'm not sure about a lot of things. Setting the
> formal defaults then calling the function seem straight forward.  I just
> assumed it would be like setting list values, or the C equivalent of
> calling formals(fn)<-list(a=1, b=3).
>
> Following your suggestion, I can get the names of the parameters used in
> this user defined function, but am not sure how to do what you are
> suggesting. For instance, how do I call the function after I use setVar.
> Could you point me to an example?
>

##In R
f<-function(a,b){
   function(x){ a+b*x}
}

f23<-f(a=2,b=3)

dyn.load("cfun.so")
.Call("cfun",fun=f23,rho=environment(f23),x=c(1,2,3,4),newa=1,newb=2)

## in cfun.c

#include "Rinternals.h"

SEXP cfun(SEXP fun, SEXP rho, SEXP x, SEXP newa, SEXP newb){
       SEXP ans, funcall;

       setVar(install("a"), newa, rho);
       setVar(install("b"), newb, rho);

       PROTECT(funcall=lang2(fun,x));
       ans=eval(funcall,rho);

       UNPROTECT(1);
       return ans;

}

##

This isn't necessarily any simpler, but it seems more natural to modify 
variables than default arguments, and also it is probably safer since you 
don't have to worry about the value of NAMED() and whether to copy the 
arguments.

This is based on the more complicated code in cox_Rcallback.c in the 
survival package, for penalized Cox regression
https://svn.r-project.org/R-packages/trunk/survival/src/cox_Rcallback.c

 	-thomas

Thomas Lumley			Assoc. Professor, Biostatistics
tlumley at u.washington.edu	University of Washington, Seattle


From afinley at stat.umn.edu  Tue Apr  4 19:05:10 2006
From: afinley at stat.umn.edu (Andrew Finley)
Date: Tue, 04 Apr 2006 12:05:10 -0500
Subject: [Rd] change function's formals default values
In-Reply-To: <Pine.LNX.4.64.0604040941280.21419@homer23.u.washington.edu>
References: <1144114759.15762.3.camel@populus.fr.umn.edu>
	<Pine.LNX.4.64.0604040714090.26620@homer22.u.washington.edu>
	<1144161750.18246.7.camel@populus.fr.umn.edu>
	<Pine.LNX.4.64.0604040941280.21419@homer23.u.washington.edu>
Message-ID: <1144170311.18556.10.camel@populus.fr.umn.edu>

Your example is perfectly clear. I'll take your suggestion.
Thanks a lot for your time-
Andrew

On Tue, 2006-04-04 at 10:00 -0700, Thomas Lumley wrote:
> On Tue, 4 Apr 2006, Andrew Finley wrote:
> 
> > Hi Thomas,
> >
> > Thanks for the note. I'm not sure about a lot of things. Setting the
> > formal defaults then calling the function seem straight forward.  I just
> > assumed it would be like setting list values, or the C equivalent of
> > calling formals(fn)<-list(a=1, b=3).
> >
> > Following your suggestion, I can get the names of the parameters used in
> > this user defined function, but am not sure how to do what you are
> > suggesting. For instance, how do I call the function after I use setVar.
> > Could you point me to an example?
> >
> 
> ##In R
> f<-function(a,b){
>    function(x){ a+b*x}
> }
> 
> f23<-f(a=2,b=3)
> 
> dyn.load("cfun.so")
> .Call("cfun",fun=f23,rho=environment(f23),x=c(1,2,3,4),newa=1,newb=2)
> 
> ## in cfun.c
> 
> #include "Rinternals.h"
> 
> SEXP cfun(SEXP fun, SEXP rho, SEXP x, SEXP newa, SEXP newb){
>        SEXP ans, funcall;
> 
>        setVar(install("a"), newa, rho);
>        setVar(install("b"), newb, rho);
> 
>        PROTECT(funcall=lang2(fun,x));
>        ans=eval(funcall,rho);
> 
>        UNPROTECT(1);
>        return ans;
> 
> }
> 
> ##
> 
> This isn't necessarily any simpler, but it seems more natural to modify 
> variables than default arguments, and also it is probably safer since you 
> don't have to worry about the value of NAMED() and whether to copy the 
> arguments.
> 
> This is based on the more complicated code in cox_Rcallback.c in the 
> survival package, for penalized Cox regression
> https://svn.r-project.org/R-packages/trunk/survival/src/cox_Rcallback.c
> 
>  	-thomas
> 
> Thomas Lumley			Assoc. Professor, Biostatistics
> tlumley at u.washington.edu	University of Washington, Seattle
-- 
Research Fellow
Department of Forest Resources
University of Minnesota
Office: 305 Green Hall
Phone: (612) 624-1714
Fax: (612) 625-5212
web: http://blue.fr.umn.edu


From bill at insightful.com  Tue Apr  4 19:10:16 2006
From: bill at insightful.com (Bill Dunlap)
Date: Tue, 4 Apr 2006 10:10:16 -0700 (PDT)
Subject: [Rd] extending strsplit(): supply pattern to keep,
 not to split by
In-Reply-To: <971536df0604040901i47a96891t7f1d8d587caf384a@mail.gmail.com>
References: <Pine.GSO.4.56.0604040832290.21795@octopus>
	<971536df0604040901i47a96891t7f1d8d587caf384a@mail.gmail.com>
Message-ID: <Pine.GSO.4.56.0604040941310.21795@octopus>

On Tue, 4 Apr 2006, Gabor Grothendieck wrote:

> gsubfn in package gsubfn can do this.  See the examples
> in ?gsubfn

Thanks.  gsubfn looks useful, but may be overkill
for this, and it isn't vectorized.  To do what
strsplit(keep=T) would do I think you need to do something like:

   > findMatches<-function(strings, pattern){
        lapply(strings, function(string){
               v <- character()
               gsubfn(number.pattern, function(x,...)v<<-c(v,x), string)
               v})
     }
   > number.pattern <- "[-+]?(([0-9]+(\\.[0-9]*)?)|(\\.[0-9]+))([eE][+-]?[0-9]+)?"
   > findMatches(c("12;34:56,89,,12", "1.2, .4, 1., 1e3"), number.pattern)
   [[1]]
   [1] "12" "34" "56" "89" "12"

   [[2]]
   [1] "1.2" ".4"  "1."  "1e3"

Is this worth encapsulating in a standard R function?
If so, is doing via an extra argument to strsplit()
a reasonable way to do it?

   > strsplit(c("12;34:56,89,,12", "1.2, .4, 1., 1e3"), number.pattern, keep=T)
   [[1]]:
   [1] "12" "34" "56" "89" "12"

   [[2]]:
   [1] "1.2" ".4"  "1."  "1e3"


> On 4/4/06, Bill Dunlap <bill at insightful.com> wrote:
> > strsplit() is a convenient way to get a
> > list of items from a string when you
> > have a regular expression for what is not
> > an item.  E.g.,
> >
> >   > strsplit("1.2, 34, 1.7e-2", split="[ ,] *")
> >   [[1]]:
> >   [1] "1.2"    "34"     "1.7e-2"
> >
> > However, sometimes is it more convenient to
> > give a pattern for the items you do want.
> > E.g., suppose you want to pull all the numbers
> > out of a string which contains a mix of numbers
> > and words.  Making a pattern for what a
> > number is simpler than making a pattern
> > for what may come between the number.
> >   > number.pattern <- "[-+]?(([0-9]+(\\.[0-9]*)?)|(\\.[0-9]+))([eE][+-]?[0-9]+)?"
> >
> > I propose adding a keep=FALSE argument to
> > strsplit() to do this.  If keep is FALSE,
> > then the split argument matches the stuff to
> > omit from the output; if keep is TRUE then
> > split matches the stuff to put into the
> > output.  Then we could do the following to
> > get a list of all the numbers in a string
> > (done in a version of strsplit() I'm working on
> > for S-PLUS):
> >
> >   > strsplit("1.2, 34, 1.7e-2", split=number.pattern,keep=TRUE)
> >   [[1]]:
> >   [1] "1.2"    "34"     "1.7e-2"
> >
> >   > strsplit("Ibuprofin 200mg", split=number.pattern,keep=TRUE)
> >   [[1]]:
> >   [1] "200"
> >
> > Is this a reasonable thing to want strsplit to do?
> > Is this a reasonable parameterization of it?

----------------------------------------------------------------------------
Bill Dunlap
Insightful Corporation
bill at insightful dot com
360-428-8146

 "All statements in this message represent the opinions of the author and do
 not necessarily reflect Insightful Corporation policy or position."


From ggrothendieck at gmail.com  Tue Apr  4 19:39:33 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Tue, 4 Apr 2006 13:39:33 -0400
Subject: [Rd] extending strsplit(): supply pattern to keep,
	not to split by
In-Reply-To: <Pine.GSO.4.56.0604040941310.21795@octopus>
References: <Pine.GSO.4.56.0604040832290.21795@octopus>
	<971536df0604040901i47a96891t7f1d8d587caf384a@mail.gmail.com>
	<Pine.GSO.4.56.0604040941310.21795@octopus>
Message-ID: <971536df0604041039u10a5d0c0s305e262b8d72d3bd@mail.gmail.com>

On 4/4/06, Bill Dunlap <bill at insightful.com> wrote:
> On Tue, 4 Apr 2006, Gabor Grothendieck wrote:
>
> > gsubfn in package gsubfn can do this.  See the examples
> > in ?gsubfn
>
> Thanks.  gsubfn looks useful, but may be overkill
> for this, and it isn't vectorized.  To do what

gsubfn is vectorized.  Its just that you are not using the output of
gsubfn in this case.

> strsplit(keep=T) would do I think you need to do something like:
>
>   > findMatches<-function(strings, pattern){
>        lapply(strings, function(string){
>               v <- character()
>               gsubfn(number.pattern, function(x,...)v<<-c(v,x), string)
>               v})
>     }
>   > number.pattern <- "[-+]?(([0-9]+(\\.[0-9]*)?)|(\\.[0-9]+))([eE][+-]?[0-9]+)?"
>   > findMatches(c("12;34:56,89,,12", "1.2, .4, 1., 1e3"), number.pattern)
>   [[1]]
>   [1] "12" "34" "56" "89" "12"
>
>   [[2]]
>   [1] "1.2" ".4"  "1."  "1e3"
>
> Is this worth encapsulating in a standard R function?

I will likely add a wrapper to the gsubfn package for this.

> If so, is doing via an extra argument to strsplit()
> a reasonable way to do it?

My current thought was to create a strapply function to do that.

>
>   > strsplit(c("12;34:56,89,,12", "1.2, .4, 1., 1e3"), number.pattern, keep=T)
>   [[1]]:
>   [1] "12" "34" "56" "89" "12"
>
>   [[2]]:
>   [1] "1.2" ".4"  "1."  "1e3"
>
>
> > On 4/4/06, Bill Dunlap <bill at insightful.com> wrote:
> > > strsplit() is a convenient way to get a
> > > list of items from a string when you
> > > have a regular expression for what is not
> > > an item.  E.g.,
> > >
> > >   > strsplit("1.2, 34, 1.7e-2", split="[ ,] *")
> > >   [[1]]:
> > >   [1] "1.2"    "34"     "1.7e-2"
> > >
> > > However, sometimes is it more convenient to
> > > give a pattern for the items you do want.
> > > E.g., suppose you want to pull all the numbers
> > > out of a string which contains a mix of numbers
> > > and words.  Making a pattern for what a
> > > number is simpler than making a pattern
> > > for what may come between the number.
> > >   > number.pattern <- "[-+]?(([0-9]+(\\.[0-9]*)?)|(\\.[0-9]+))([eE][+-]?[0-9]+)?"
> > >
> > > I propose adding a keep=FALSE argument to
> > > strsplit() to do this.  If keep is FALSE,
> > > then the split argument matches the stuff to
> > > omit from the output; if keep is TRUE then
> > > split matches the stuff to put into the
> > > output.  Then we could do the following to
> > > get a list of all the numbers in a string
> > > (done in a version of strsplit() I'm working on
> > > for S-PLUS):
> > >
> > >   > strsplit("1.2, 34, 1.7e-2", split=number.pattern,keep=TRUE)
> > >   [[1]]:
> > >   [1] "1.2"    "34"     "1.7e-2"
> > >
> > >   > strsplit("Ibuprofin 200mg", split=number.pattern,keep=TRUE)
> > >   [[1]]:
> > >   [1] "200"
> > >
> > > Is this a reasonable thing to want strsplit to do?
> > > Is this a reasonable parameterization of it?
>
> ----------------------------------------------------------------------------
> Bill Dunlap
> Insightful Corporation
> bill at insightful dot com
> 360-428-8146
>
>  "All statements in this message represent the opinions of the author and do
>  not necessarily reflect Insightful Corporation policy or position."
>


From edd at debian.org  Tue Apr  4 20:07:52 2006
From: edd at debian.org (Dirk Eddelbuettel)
Date: Tue, 4 Apr 2006 13:07:52 -0500
Subject: [Rd] Build failure with this morning's R-alpha
In-Reply-To: <17457.36766.643093.231884@basebud.nulle.part>
References: <17457.36766.643093.231884@basebud.nulle.part>
Message-ID: <17458.46584.731857.482767@basebud.nulle.part>


On 3 April 2006 at 16:11, Dirk Eddelbuettel wrote:
| Trying to build a Debian snapshot of R-alpha based on last night's tarball,
| it fails with what looks like a missing -lm linking directive:
| 
| [...]
| gcc     -I. -I../../src/include -I../../src/include  -DHAVE_CONFIG_H  -fpic  -O2  -c Rmain.c -o Rmain.o
| gcc -Wl,--export-dynamic  -o R.bin Rmain.o  -L../../lib -lR
| ../../lib/libR.so: undefined reference to `isfinite'

Entirely my fault -- I had been resetting CFLAGS and friends in debian/rules,
which lead to the all-important  -std=gnu99   being dropped from the compiler
flags.  And gcc up to version 3.4.* seems to forgive this, whereas 4.*
versions want it.  

Thanks, Dirk

-- 
Hell, there are no rules here - we're trying to accomplish something. 
                                                  -- Thomas A. Edison


From cfillekes at gmail.com  Tue Apr  4 21:38:35 2006
From: cfillekes at gmail.com (cfillekes at gmail.com)
Date: Tue,  4 Apr 2006 21:38:35 +0200 (CEST)
Subject: [Rd] is.numeric (NA + NA) is TRUE, should be FALSE (PR#8745)
Message-ID: <20060404193835.009E6AB7A@slim.kubism.ku.dk>

Full_Name: c fillekes
Version: Version 2.2.1  (2005-12-20 r36812)
OS: Gentoo Linux kernel 2.6.12
Submission from: (NULL) (129.116.71.233)




"Not Available" is of course not a numeric: 
R

> is.numeric (NA)
[1] FALSE

But for some reason, all arithmetic operations on NA's are
in fact numeric, even if it's with other NA's.  


> is.numeric (NA+NA)
[1] TRUE
> is.numeric (NA^2)
[1] TRUE
> is.numeric (NA-NA)
[1] TRUE
> is.numeric (NA*NA)
[1] TRUE
> is.numeric (NA/NA)
[1] TRUE
>

This is not the expected thing.


From murdoch at stats.uwo.ca  Tue Apr  4 21:52:06 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Tue, 04 Apr 2006 15:52:06 -0400
Subject: [Rd] is.numeric (NA + NA) is TRUE, should be FALSE (PR#8745)
In-Reply-To: <20060404193835.009E6AB7A@slim.kubism.ku.dk>
References: <20060404193835.009E6AB7A@slim.kubism.ku.dk>
Message-ID: <4432CE66.2020102@stats.uwo.ca>

On 4/4/2006 3:38 PM, cfillekes at gmail.com wrote:
> Full_Name: c fillekes
> Version: Version 2.2.1  (2005-12-20 r36812)
> OS: Gentoo Linux kernel 2.6.12
> Submission from: (NULL) (129.116.71.233)
> 
> 
> 
> 
> "Not Available" is of course not a numeric: 
> R
> 
>> is.numeric (NA)
> [1] FALSE
> 
> But for some reason, all arithmetic operations on NA's are
> in fact numeric, even if it's with other NA's.  
> 
> 
>> is.numeric (NA+NA)
> [1] TRUE
>> is.numeric (NA^2)
> [1] TRUE
>> is.numeric (NA-NA)
> [1] TRUE
>> is.numeric (NA*NA)
> [1] TRUE
>> is.numeric (NA/NA)
> [1] TRUE
>>
> 
> This is not the expected thing.

But it is the documented thing, so it is not a bug:

"'is.numeric' returns 'TRUE' if its argument is of mode '"numeric"'
      (type '"double"' or type '"integer"') and not a factor, and
      'FALSE' otherwise."

The value is irrelevant.  You probably want to use "is.numeric(x) && 
all(is.finite(x))" to get the result you're expecting.

Duncan Murdoch


From antonio.fabio at gmail.com  Tue Apr  4 21:52:37 2006
From: antonio.fabio at gmail.com (Antonio, Fabio Di Narzo)
Date: Tue, 4 Apr 2006 21:52:37 +0200
Subject: [Rd] is.numeric (NA + NA) is TRUE, should be FALSE (PR#8745)
In-Reply-To: <20060404193835.009E6AB7A@slim.kubism.ku.dk>
References: <20060404193835.009E6AB7A@slim.kubism.ku.dk>
Message-ID: <b0808fdc0604041252w5805cb49h19e4ecf40ff95427@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20060404/82555e55/attachment.pl 

From tlumley at u.washington.edu  Tue Apr  4 22:57:09 2006
From: tlumley at u.washington.edu (Thomas Lumley)
Date: Tue, 4 Apr 2006 13:57:09 -0700 (PDT)
Subject: [Rd] is.numeric (NA + NA) is TRUE, should be FALSE (PR#8745)
In-Reply-To: <b0808fdc0604041252w5805cb49h19e4ecf40ff95427@mail.gmail.com>
References: <20060404193835.009E6AB7A@slim.kubism.ku.dk>
	<b0808fdc0604041252w5805cb49h19e4ecf40ff95427@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0604041352540.21419@homer23.u.washington.edu>

On Tue, 4 Apr 2006, Antonio, Fabio Di Narzo wrote:

> So in
> NA+NA
> the logical is automatically coerced to a numerical value, and
> is.numericreturns TRUE, as expected.
>
> But for some reason, all arithmetic operations on NA's are
>> in fact numeric, even if it's with other NA's.
>>

All arithmetic operatiosn on *logicals* are coerced to numeric, so if you 
have two logical NAs and add them you get a numeric NA.

This isn't anything special about NAs, since you would get the same 
conversion for TRUE+TRUE, and you would not get the same conversion for 
two character NAs

 	-thomas

Thomas Lumley			Assoc. Professor, Biostatistics
tlumley at u.washington.edu	University of Washington, Seattle


From cfillekes at gmail.com  Wed Apr  5 00:38:51 2006
From: cfillekes at gmail.com (cheryl fillekes)
Date: Tue, 4 Apr 2006 17:38:51 -0500
Subject: [Rd] is.numeric (NA + NA) is TRUE, should be FALSE (PR#8745)
In-Reply-To: <b0808fdc0604041252w5805cb49h19e4ecf40ff95427@mail.gmail.com>
References: <20060404193835.009E6AB7A@slim.kubism.ku.dk>
	<b0808fdc0604041252w5805cb49h19e4ecf40ff95427@mail.gmail.com>
Message-ID: <7517deab0604041538x2b8af81bj16faaf2688653e07@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20060404/11717d2a/attachment.pl 

From murdoch at stats.uwo.ca  Wed Apr  5 00:53:47 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Tue, 04 Apr 2006 18:53:47 -0400
Subject: [Rd] is.numeric (NA + NA) is TRUE, should be FALSE (PR#8745)
In-Reply-To: <7517deab0604041538x2b8af81bj16faaf2688653e07@mail.gmail.com>
References: <20060404193835.009E6AB7A@slim.kubism.ku.dk>	<b0808fdc0604041252w5805cb49h19e4ecf40ff95427@mail.gmail.com>
	<7517deab0604041538x2b8af81bj16faaf2688653e07@mail.gmail.com>
Message-ID: <4432F8FB.6070501@stats.uwo.ca>

On 4/4/2006 6:38 PM, cheryl fillekes wrote:
> So this is perfectly consistent then:
> 
>>  A <- NA
>> B <- NA+NA
>> B
> [1] NA
>> A
> [1] NA

A and B both print as NA, but they are stored differently.  A is 
logical, B is numeric.  You'll also see this in the following tests:

 > identical(A, A)
[1] TRUE
 > identical(A, B)
[1] FALSE



>> is.numeric (A)
> [1] FALSE
>> is.numeric (B)
> [1] TRUE
> 
> And the test based on value rather than type would be:
> 
>> !is.na(A)
> [1] FALSE
>> !is.na(B)
> [1] FALSE

Yes, that works.

Duncan Murdoch

> 
> 
> 
> On 4/4/06, Antonio, Fabio Di Narzo <antonio.fabio at gmail.com> wrote:
>> 2006/4/4, cfillekes at gmail.com <cfillekes at gmail.com>:
>>
>>> Full_Name: c fillekes
>>> Version: Version 2.2.1  (2005-12-20 r36812)
>>> OS: Gentoo Linux kernel 2.6.12
>>> Submission from: (NULL) (129.116.71.233)
>>>
>>>
>>>
>>>
>>> "Not Available" is of course not a numeric:
>>> R
>>>
>>>> is.numeric (NA)
>>> [1] FALSE
>>
>> In the help you can read:
>> "
>>  'NA' is a logical constant of length 1 which contains a missing
>>      value indicator.  'NA' can be freely coerced to any other vector
>>      type except raw.
>> "
>> And in fact:
>>
>>> storage.mode(NA)
>> [1] "logical"
>>> storage.mode(NA+0)
>> [1] "double"
>>> storage.mode(as.numeric(NA))
>> [1] "double"
>>> storage.mode(as.character(NA))
>> [1] "character"
>>
>> So in
>> NA+NA
>> the logical is automatically coerced to a numerical value, and is.numericreturns TRUE, as expected.
>>
>>
>> But for some reason, all arithmetic operations on NA's are
>>> in fact numeric, even if it's with other NA's.
>>>
>>>
>>>> is.numeric (NA+NA)
>>> [1] TRUE
>>>> is.numeric (NA^2)
>>> [1] TRUE
>>>> is.numeric (NA-NA)
>>> [1] TRUE
>>>> is.numeric (NA*NA)
>>> [1] TRUE
>>>> is.numeric (NA/NA)
>>> [1] TRUE
>>> This is not the expected thing.
>>
>> I think this is the expected thing.
>>
>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>
>> Antonio, Fabio Di Narzo.
>>
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From Kurt.Hornik at wu-wien.ac.at  Wed Apr  5 10:55:04 2006
From: Kurt.Hornik at wu-wien.ac.at (Kurt Hornik)
Date: Wed, 5 Apr 2006 10:55:04 +0200
Subject: [Rd] CRAN packages with invalid maintainer address
Message-ID: <17459.34280.935548.329675@mithrandir.hornik.net>

Emails to

   Edgar Acuna <edgar at cs.uprm.edu>,
   Federico C. F. Calboli <f.calboli at ucl.ac.uk>,
   Hao Wu <hao at jax.org>,
   Lopaka Lee <rlee at fpcc.gov>,
   Maria Kocherginsky <mkocherg at uchicago.edu>,

as maintainers of CRAN packages with QC problems that need addressing
for the upcoming 2.3.0 release failed yesterday.

If you are one of these, or know how to reach these, pls let me know.

-k


From hb at maths.lth.se  Wed Apr  5 11:18:21 2006
From: hb at maths.lth.se (Henrik Bengtsson)
Date: Wed, 5 Apr 2006 11:18:21 +0200
Subject: [Rd] Return function from function and Recall()
Message-ID: <59d7961d0604050218u6c570234h56b9d65b7dcbc387@mail.gmail.com>

Hi,

yesterday I got very useful feedback on what is the best way to return
a function from a function.

Now, I run into a problem calling a returned function that down the
stream uses Recall().  Below is a self-contained example.  I took away
yesterday's code for returning a minimal environment for the function,
because that is not related to this problem.

getPredictor <- function(x, y) {
  sp <- smooth.spline(x=x, y=y, keep.data=FALSE)
  function(x, ...) predict(sp$fit, x, ...)$y
}

# Simulate data
x <- 1:10
y <- 1:10 + rnorm(length(x))

# Estimate predictor function
fcn <- getPredictor(x,y)

# No extrapolation => no Recall()
ypred <- fcn(x)
print(ypred)
# Gives:  # [1]  2.325181  2.756166  ...

# With extrapolation => Recall()
xextrap <- c(0,x)
ypred <- fcn(xextrap)
# Gives:  # Error in Recall(object, xrange) : couldn't find
# function "predict.smooth.spline.fit"

To see what's the function looks like, do

pfcn <- getAnywhere("predict.smooth.spline.fit")$obj[[2]]
page(pfcn)

A workaround is to set the predict.smooth.spline.fit() in .GlobalEnv, i.e.

 predict.smooth.spline.fit <- pfcn

Does Recall() have a problem because predict.smooth.spline.fit() is
not exported, or what is going on?  Are there alternatives to the
above workaround?  I can see how such a workaround can become very
complicated with complex functions where it is hard to predict what
functions are called when.

/Henrik

PS, may I suggest to modify page() so that
'page(getAnywhere("predict.smooth.spline.fit"))' works? DS.


From hb at maths.lth.se  Wed Apr  5 11:25:25 2006
From: hb at maths.lth.se (Henrik Bengtsson)
Date: Wed, 5 Apr 2006 11:25:25 +0200
Subject: [Rd] predict.smooth.spline.fit and Recall() (Was: Re: Return
	function from function and Recall())
Message-ID: <59d7961d0604050225g4b3235fby3aa13af460fa38f7@mail.gmail.com>

Hi,

forget about the below details.  It is not related to the fact that
the function is returned from a function.  Sorry about that.  I've
been troubleshooting soo much I've been shoting over the target.  Here
is a much smaller reproducible example:

x <- 1:10
y <- 1:10 + rnorm(length(x))
sp <- smooth.spline(x=x, y=y)
ypred <- predict(sp$fit, x)
# [1]  2.325181  2.756166  ...
ypred2 <- predict(sp$fit, c(0,x))
# Error in Recall(object, xrange) : couldn't find
# function "predict.smooth.spline.fit"

/Henrik


On 4/5/06, Henrik Bengtsson <hb at maths.lth.se> wrote:
> Hi,
>
> yesterday I got very useful feedback on what is the best way to return
> a function from a function.
>
> Now, I run into a problem calling a returned function that down the
> stream uses Recall().  Below is a self-contained example.  I took away
> yesterday's code for returning a minimal environment for the function,
> because that is not related to this problem.
>
> getPredictor <- function(x, y) {
>   sp <- smooth.spline(x=x, y=y, keep.data=FALSE)
>   function(x, ...) predict(sp$fit, x, ...)$y
> }
>
> # Simulate data
> x <- 1:10
> y <- 1:10 + rnorm(length(x))
>
> # Estimate predictor function
> fcn <- getPredictor(x,y)
>
> # No extrapolation => no Recall()
> ypred <- fcn(x)
> print(ypred)
> # Gives:  # [1]  2.325181  2.756166  ...
>
> # With extrapolation => Recall()
> xextrap <- c(0,x)
> ypred <- fcn(xextrap)
> # Gives:  # Error in Recall(object, xrange) : couldn't find
> # function "predict.smooth.spline.fit"
>
> To see what's the function looks like, do
>
> pfcn <- getAnywhere("predict.smooth.spline.fit")$obj[[2]]
> page(pfcn)
>
> A workaround is to set the predict.smooth.spline.fit() in .GlobalEnv, i.e.
>
>  predict.smooth.spline.fit <- pfcn
>
> Does Recall() have a problem because predict.smooth.spline.fit() is
> not exported, or what is going on?  Are there alternatives to the
> above workaround?  I can see how such a workaround can become very
> complicated with complex functions where it is hard to predict what
> functions are called when.
>
> /Henrik
>
> PS, may I suggest to modify page() so that
> 'page(getAnywhere("predict.smooth.spline.fit"))' works? DS.
>


--
Henrik Bengtsson
Mobile: +46 708 909208 (+2h UTC)


From hin-tak.leung at cimr.cam.ac.uk  Wed Apr  5 13:17:14 2006
From: hin-tak.leung at cimr.cam.ac.uk (Hin-Tak Leung)
Date: Wed, 05 Apr 2006 12:17:14 +0100
Subject: [Rd] Integration of C and Fortran
In-Reply-To: <Pine.LNX.4.64.0604041052090.3947@gannet.stats.ox.ac.uk>
References: <p06230905c05711d5d338@[192.168.0.110]>
	<Pine.LNX.4.64.0604041052090.3947@gannet.stats.ox.ac.uk>
Message-ID: <4433A73A.4070907@cimr.cam.ac.uk>

Prof Brian Ripley wrote:
> Is
> 
>>        the enter point Fortran "orderdata_" absent of the loading table.
> 
> a manual translation, and was the underscore there in the original (I 
> think it should be, but am just checking).

The extra underscore added is the default behavior of many fortran 
compilers, to avoid symbol name collision - I believe this is
actually mentioned very briefly in "writing R extensions" - here is
the details from the relevant section of the documentation of
gfortran (gcc 4.x's fortran front end):

=======================================
Options for Code Generation Conventions

`-fno-underscoring'
      Do not transform names of entities specified in the Fortran source
      file by appending underscores to them.

      With `-funderscoring' in effect, `gfortran' appends one underscore
      to external names with no underscores.  This is done to ensure
      compatibility with code produced by many UNIX Fortran compilers.

      ....

      Use of `-fno-underscoring' is not recommended unless you are
      experimenting with issues such as integration of (GNU) Fortran into
      existing system environments (vis-a-vis existing libraries, tools,
      and so on).

      ....

`-fsecond-underscore'
      By default, `gfortran' appends an underscore to external names.
      If this option is used `gfortran' appends two underscores to names
      with underscores and one underscore to external names with no
      underscores ...
===================================

> 
> What do nm -g mpackage.so tell you is actually exported from the shared 
> object (here called 'mypackage.so')?  I suspect that will reveal a 
> mismatch of names.
> 
> On Mon, 3 Apr 2006, Sebastien Durand wrote:
> 
>> Dear all,
>>
>> I am running R : Copyright 2005,
>> Version 2.2.1  (2005-12-20 r36812)
>> ISBN 3-900051-07-0
>> On a mac 10.4.5
>>
>> I am having trouble with my package.
>>
>> The trouble is the following:
>>
>> In my package I have integrated three files in my src folder.
>> 1- simplematch.C a .C file
>> 2- ordering.f a fortran file
>> 3- Makevars :  PKG_LIBS =  $(LAPACK_LIBS) $(BLAS_LIBS) $(FLIBS)
>> I am not sure if that last file is really useful!?
>>
>> When I use the R CMD SHLIB command on both these
>> source code files, the resulting compiled  .so
>> files when loads fine with the dyn.load function.
>> At last when I use either the
>> .C("simplematch",...) and
>> .Fortran("ordering",...) command everything
>> works...
>>
>> Now here comes trouble:
>>
>> When I do the R CMD INSTALL command, my package install.
>> The .C command works but when I run the .Fortran command I get:
>>
>> Error in .Fortran("orderdata", d = as.double(d),
>> as.integer(n), rowscore = as.double(rowscore)) :
>>     the enter point Fortran "orderdata_" absent of the loading table.
>>
>> What should I do to make sure that upon the installation of my package my
>> Fortran function will appear in the load table...
>>
>> Thanks a lot.
>>
>> S?bastien Durand
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
> 
> 
> ------------------------------------------------------------------------
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From ripley at stats.ox.ac.uk  Wed Apr  5 13:26:50 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 5 Apr 2006 12:26:50 +0100 (BST)
Subject: [Rd] predict.smooth.spline.fit and Recall() (Was: Re: Return
 function from function and Recall())
In-Reply-To: <59d7961d0604050225g4b3235fby3aa13af460fa38f7@mail.gmail.com>
References: <59d7961d0604050225g4b3235fby3aa13af460fa38f7@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0604051109100.12918@gannet.stats.ox.ac.uk>

On Wed, 5 Apr 2006, Henrik Bengtsson wrote:

> Hi,
>
> forget about the below details.  It is not related to the fact that
> the function is returned from a function.  Sorry about that.  I've
> been troubleshooting soo much I've been shoting over the target.  Here
> is a much smaller reproducible example:
>
> x <- 1:10
> y <- 1:10 + rnorm(length(x))
> sp <- smooth.spline(x=x, y=y)
> ypred <- predict(sp$fit, x)
> # [1]  2.325181  2.756166  ...
> ypred2 <- predict(sp$fit, c(0,x))
> # Error in Recall(object, xrange) : couldn't find
> # function "predict.smooth.spline.fit"

It seems Recall is not searching (via findFun) from the right environment, 
but at a quick glance it is not obvious to me why.
You can replace Recall by predict.smooth.spline.fit for now.

As for

>> PS, may I suggest to modify page() so that
>> 'page(getAnywhere("predict.smooth.spline.fit"))' works? DS.

it is rather tricky.  page() takes a name aka symbol as its argument (and 
is thereby S-compatible), and also works with a bare character string 
(undocumented).  What you have here is a call that does not even return a 
function.  It is more reasonable that stats:::predict.smooth.spline.fit 
should work, and it is also a call.  I have in the past thought about 
special-casing that, but it is a valid name (you would have to back-quote 
it, but it does work).  So one possible way out would be to use get() on a 
name and evaluate calls, e.g.

page <- function(x, method = c("dput", "print"), ...)
{
     subx <- substitute(x)
     have_object <- FALSE
     if(is.call(subx)) {
         object <- x
         have_object <- TRUE
         subx <- deparse(subx)
     } else {
         if(is.character(x)) subx <- x
         else if(is.name(subx)) subx <- deparse(subx)
         if (!is.character(subx) || length(subx) != 1)
             stop("'page' requires a name, call or character string")
         parent <- parent.frame()
         if(exists(subx, envir = parent, inherits=TRUE)) {
             object <- get(subx, envir = parent, inherits=TRUE)
             have_object <- TRUE
         }
     }
     if(have_object) {
         method <- match.arg(method)
         file <- tempfile("Rpage.")
         if(method == "dput")
             dput(object, file)
         else {
             sink(file)
             print(object)
             sink()
         }
 	file.show(file, title = subx, delete.file = TRUE, ...)
     } else
 	stop(gettextf("no object named '%s' to show", subx), domain = NA)
}

which also allows 1-element character vectors (and I am not entirely sure 
we want that).


>
> /Henrik
>
>
> On 4/5/06, Henrik Bengtsson <hb at maths.lth.se> wrote:
>> Hi,
>>
>> yesterday I got very useful feedback on what is the best way to return
>> a function from a function.
>>
>> Now, I run into a problem calling a returned function that down the
>> stream uses Recall().  Below is a self-contained example.  I took away
>> yesterday's code for returning a minimal environment for the function,
>> because that is not related to this problem.
>>
>> getPredictor <- function(x, y) {
>>   sp <- smooth.spline(x=x, y=y, keep.data=FALSE)
>>   function(x, ...) predict(sp$fit, x, ...)$y
>> }
>>
>> # Simulate data
>> x <- 1:10
>> y <- 1:10 + rnorm(length(x))
>>
>> # Estimate predictor function
>> fcn <- getPredictor(x,y)
>>
>> # No extrapolation => no Recall()
>> ypred <- fcn(x)
>> print(ypred)
>> # Gives:  # [1]  2.325181  2.756166  ...
>>
>> # With extrapolation => Recall()
>> xextrap <- c(0,x)
>> ypred <- fcn(xextrap)
>> # Gives:  # Error in Recall(object, xrange) : couldn't find
>> # function "predict.smooth.spline.fit"
>>
>> To see what's the function looks like, do
>>
>> pfcn <- getAnywhere("predict.smooth.spline.fit")$obj[[2]]
>> page(pfcn)
>>
>> A workaround is to set the predict.smooth.spline.fit() in .GlobalEnv, i.e.
>>
>>  predict.smooth.spline.fit <- pfcn
>>
>> Does Recall() have a problem because predict.smooth.spline.fit() is
>> not exported, or what is going on?  Are there alternatives to the
>> above workaround?  I can see how such a workaround can become very
>> complicated with complex functions where it is hard to predict what
>> functions are called when.
>>
>> /Henrik
>>
>> PS, may I suggest to modify page() so that
>> 'page(getAnywhere("predict.smooth.spline.fit"))' works? DS.
>>
>
>
> --
> Henrik Bengtsson
> Mobile: +46 708 909208 (+2h UTC)
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From Kurt.Hornik at wu-wien.ac.at  Wed Apr  5 13:36:41 2006
From: Kurt.Hornik at wu-wien.ac.at (Kurt Hornik)
Date: Wed, 5 Apr 2006 13:36:41 +0200
Subject: [Rd] predict.smooth.spline.fit and Recall() (Was: Re: Return
 function from function and Recall())
In-Reply-To: <Pine.LNX.4.64.0604051109100.12918@gannet.stats.ox.ac.uk>
References: <59d7961d0604050225g4b3235fby3aa13af460fa38f7@mail.gmail.com>
	<Pine.LNX.4.64.0604051109100.12918@gannet.stats.ox.ac.uk>
Message-ID: <17459.43977.316421.676226@mithrandir.hornik.net>

>>>>> Prof Brian Ripley writes:

> On Wed, 5 Apr 2006, Henrik Bengtsson wrote:
>> Hi,
>> 
>> forget about the below details.  It is not related to the fact that
>> the function is returned from a function.  Sorry about that.  I've
>> been troubleshooting soo much I've been shoting over the target.  Here
>> is a much smaller reproducible example:
>> 
>> x <- 1:10
>> y <- 1:10 + rnorm(length(x))
>> sp <- smooth.spline(x=x, y=y)
>> ypred <- predict(sp$fit, x)
>> # [1]  2.325181  2.756166  ...
>> ypred2 <- predict(sp$fit, c(0,x))
>> # Error in Recall(object, xrange) : couldn't find
>> # function "predict.smooth.spline.fit"

> It seems Recall is not searching (via findFun) from the right
> environment, but at a quick glance it is not obvious to me why.  You
> can replace Recall by predict.smooth.spline.fit for now.

> As for

>>> PS, may I suggest to modify page() so that
>>> 'page(getAnywhere("predict.smooth.spline.fit"))' works? DS.

> it is rather tricky.  page() takes a name aka symbol as its argument
> (and is thereby S-compatible), and also works with a bare character
> string (undocumented).  What you have here is a call that does not
> even return a function.  It is more reasonable that
> stats:::predict.smooth.spline.fit should work, and it is also a call.
> I have in the past thought about special-casing that, but it is a
> valid name (you would have to back-quote it, but it does work).  So
> one possible way out would be to use get() on a name and evaluate
> calls, e.g.

> page <- function(x, method = c("dput", "print"), ...)
> {
>      subx <- substitute(x)
>      have_object <- FALSE
>      if(is.call(subx)) {
>          object <- x
>          have_object <- TRUE
>          subx <- deparse(subx)
>      } else {
>          if(is.character(x)) subx <- x
>          else if(is.name(subx)) subx <- deparse(subx)
>          if (!is.character(subx) || length(subx) != 1)
>              stop("'page' requires a name, call or character string")
>          parent <- parent.frame()
>          if(exists(subx, envir = parent, inherits=TRUE)) {
>              object <- get(subx, envir = parent, inherits=TRUE)
>              have_object <- TRUE
>          }
>      }
>      if(have_object) {
>          method <- match.arg(method)
>          file <- tempfile("Rpage.")
>          if(method == "dput")
>              dput(object, file)
>          else {
>              sink(file)
>              print(object)
>              sink()
>          }
>  	file.show(file, title = subx, delete.file = TRUE, ...)
>      } else
>  	stop(gettextf("no object named '%s' to show", subx), domain = NA)
> }

> which also allows 1-element character vectors (and I am not entirely
> sure we want that).

There was a similar issue with prompt() (actually, its default method)
for which I ended up "temporarily" providing the following (argh):

        else {
            name <- substitute(object)
            if (is.name(name)) 
                as.character(name)
            else if (is.call(name) && (as.character(name[[1]]) %in% 
                c("::", ":::", "getAnywhere"))) {
                name <- as.character(name)
                name[length(name)]
            }
            else stop("cannot determine a usable name")
        }

Best
-k


From hb at maths.lth.se  Wed Apr  5 13:58:15 2006
From: hb at maths.lth.se (Henrik Bengtsson)
Date: Wed, 5 Apr 2006 13:58:15 +0200
Subject: [Rd] predict.smooth.spline.fit and Recall() (Was: Re: Return
	function from function and Recall())
In-Reply-To: <Pine.LNX.4.64.0604051109100.12918@gannet.stats.ox.ac.uk>
References: <59d7961d0604050225g4b3235fby3aa13af460fa38f7@mail.gmail.com>
	<Pine.LNX.4.64.0604051109100.12918@gannet.stats.ox.ac.uk>
Message-ID: <59d7961d0604050458uf6ff050r1d714eae5885bcea@mail.gmail.com>

On 4/5/06, Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
> On Wed, 5 Apr 2006, Henrik Bengtsson wrote:
>
> > Hi,
> >
> > forget about the below details.  It is not related to the fact that
> > the function is returned from a function.  Sorry about that.  I've
> > been troubleshooting soo much I've been shoting over the target.  Here
> > is a much smaller reproducible example:
> >
> > x <- 1:10
> > y <- 1:10 + rnorm(length(x))
> > sp <- smooth.spline(x=x, y=y)
> > ypred <- predict(sp$fit, x)
> > # [1]  2.325181  2.756166  ...
> > ypred2 <- predict(sp$fit, c(0,x))
> > # Error in Recall(object, xrange) : couldn't find
> > # function "predict.smooth.spline.fit"
>
> It seems Recall is not searching (via findFun) from the right environment,
> but at a quick glance it is not obvious to me why.
> You can replace Recall by predict.smooth.spline.fit for now.

More troubleshooting shows that by dispatching directly on 'sp' and
not 'sp$fit' works.  The reason that I do not want to do this is
related to my questions yesterday that I want to keep the memory usage
down and 'sp' hold quite some extra data even with keep.data=FALSE.

Example show how it works:

x <- 1:10
y <- 1:10 + rnorm(length(x))
sp <- smooth.spline(x=x, y=y)

The following two calls work:

ypred1 <- predict(sp, x)
ypred2 <- predict(sp, c(0,x))

They dispatch on predict.smooth.spline(), which in turn calls
predict(sp$fit, ...) which dispatch on predict.smooth,spline.fit();

> getAnywhere("predict.smooth.spline")
A single object matching 'predict.smooth.spline' was found
It was found in the following places
  registered S3 method for predict from namespace stats
  namespace:stats
with value

function (object, x, deriv = 0, ...)
{
    if (missing(x)) {
        if (deriv == 0)
            return(object[c("x", "y")])
        else x <- object$x
    }
    fit <- object$fit
    if (is.null(fit))
        stop("not a valid \"smooth.spline\" object")
    else predict(fit, x, deriv, ...)
}
<environment: namespace:stats>

Trying to do the same without the first step, that is, to call
predict(sp$fit, ...) to dispatch on predict.smooth,spline.fit()
directly, then the second will fail due to the Recall();

ypred3 <- predict(sp$fit, x)
ypred4 <- predict(sp$fit, c(0,x))  # Error!

Note that both predict.smooth.spline() and predict.smooth.spline.fit()
are under the "namespace hood", i.e. not exported. So, no apparent
difference there.

To avoid the overhead of some of the elements of 'sp' I create a
minimal 'smooth.spline' object like this:

fit <- structure(list(fit=sp$fit), class=class(sp))
ypred5 <- predict(fit, x)
ypred6 <- predict(fit, c(0,x))  # Error!

and it all works.  I don't really like to fake objects like this,
although allowed in S3.  But for now it's ok.  However, it would be
interesting to know/understands what is going on.

/Henrik

[snip]

> >
> > /Henrik
> >
> >
> > On 4/5/06, Henrik Bengtsson <hb at maths.lth.se> wrote:
> >> Hi,
> >>
> >> yesterday I got very useful feedback on what is the best way to return
> >> a function from a function.
> >>
> >> Now, I run into a problem calling a returned function that down the
> >> stream uses Recall().  Below is a self-contained example.  I took away
> >> yesterday's code for returning a minimal environment for the function,
> >> because that is not related to this problem.
> >>
> >> getPredictor <- function(x, y) {
> >>   sp <- smooth.spline(x=x, y=y, keep.data=FALSE)
> >>   function(x, ...) predict(sp$fit, x, ...)$y
> >> }
> >>
> >> # Simulate data
> >> x <- 1:10
> >> y <- 1:10 + rnorm(length(x))
> >>
> >> # Estimate predictor function
> >> fcn <- getPredictor(x,y)
> >>
> >> # No extrapolation => no Recall()
> >> ypred <- fcn(x)
> >> print(ypred)
> >> # Gives:  # [1]  2.325181  2.756166  ...
> >>
> >> # With extrapolation => Recall()
> >> xextrap <- c(0,x)
> >> ypred <- fcn(xextrap)
> >> # Gives:  # Error in Recall(object, xrange) : couldn't find
> >> # function "predict.smooth.spline.fit"
> >>
> >> To see what's the function looks like, do
> >>
> >> pfcn <- getAnywhere("predict.smooth.spline.fit")$obj[[2]]
> >> page(pfcn)
> >>
> >> A workaround is to set the predict.smooth.spline.fit() in .GlobalEnv, i.e.
> >>
> >>  predict.smooth.spline.fit <- pfcn
> >>
> >> Does Recall() have a problem because predict.smooth.spline.fit() is
> >> not exported, or what is going on?  Are there alternatives to the
> >> above workaround?  I can see how such a workaround can become very
> >> complicated with complex functions where it is hard to predict what
> >> functions are called when.
> >>
> >> /Henrik
> >>
> >> PS, may I suggest to modify page() so that
> >> 'page(getAnywhere("predict.smooth.spline.fit"))' works? DS.
> >>
> >
> >
> > --
> > Henrik Bengtsson
> > Mobile: +46 708 909208 (+2h UTC)
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >
> >
>
> --
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>
>


--
Henrik Bengtsson
Mobile: +46 708 909208 (+2h UTC)


From hb at maths.lth.se  Wed Apr  5 14:24:12 2006
From: hb at maths.lth.se (Henrik Bengtsson)
Date: Wed, 5 Apr 2006 14:24:12 +0200
Subject: [Rd] page() (Was: Re: predict.smooth.spline.fit and Recall() (Was:
	Re: Return function from function and Recall()))
Message-ID: <59d7961d0604050524v179d9130v61e8c2e99a4e7cbc@mail.gmail.com>

Here I think S3 dispatch is very natural.  Try the following:

page <- function(x, method = c("dput", "print"), ...) UseMethod("page")

page.getAnywhere <- function(x, ..., idx=NULL) {
  name <- x$name;
  objects <- x$obj;

  if (length(objects) == 0)
    stop("no object named '", name, "' was found");

  if (is.null(idx)) {
    # Include all non-duplicated objects found
    idx <- (1:length(objects))[!x$dups];
  }

  for (ii in idx) {
    title <- paste(name, " (", x$where[ii], ")", sep="");
    eval(substitute({
      object <- x$obj[[ii]];
      page(object, ...);
    }, list(object=as.name(title))));
  }
}

page.default <- utils::page;

page(getAnywhere("predict.smooth.spline.fit"))

You can have page.function(), page.character(), page.environment(),
etc. and make these call page.default() indirectly.  What I think
would be a very useful add on is to add an argument 'title' for which
you can set/override the title.  Then the "ugly" substitute() calls
could be limited to one specific case; where a "default" object is
passed and no title is set.

If you want to, I could play around with a bit.

/Henrik

On 4/5/06, Kurt Hornik <Kurt.Hornik at wu-wien.ac.at> wrote:
> >>>>> Prof Brian Ripley writes:
>
> > On Wed, 5 Apr 2006, Henrik Bengtsson wrote:
> >> Hi,

[snip]

> > As for
>
> >>> PS, may I suggest to modify page() so that
> >>> 'page(getAnywhere("predict.smooth.spline.fit"))' works? DS.
>
> > it is rather tricky.  page() takes a name aka symbol as its argument
> > (and is thereby S-compatible), and also works with a bare character
> > string (undocumented).  What you have here is a call that does not
> > even return a function.  It is more reasonable that
> > stats:::predict.smooth.spline.fit should work, and it is also a call.
> > I have in the past thought about special-casing that, but it is a
> > valid name (you would have to back-quote it, but it does work).  So
> > one possible way out would be to use get() on a name and evaluate
> > calls, e.g.
>
> > page <- function(x, method = c("dput", "print"), ...)
> > {
> >      subx <- substitute(x)
> >      have_object <- FALSE
> >      if(is.call(subx)) {
> >          object <- x
> >          have_object <- TRUE
> >          subx <- deparse(subx)
> >      } else {
> >          if(is.character(x)) subx <- x
> >          else if(is.name(subx)) subx <- deparse(subx)
> >          if (!is.character(subx) || length(subx) != 1)
> >              stop("'page' requires a name, call or character string")
> >          parent <- parent.frame()
> >          if(exists(subx, envir = parent, inherits=TRUE)) {
> >              object <- get(subx, envir = parent, inherits=TRUE)
> >              have_object <- TRUE
> >          }
> >      }
> >      if(have_object) {
> >          method <- match.arg(method)
> >          file <- tempfile("Rpage.")
> >          if(method == "dput")
> >              dput(object, file)
> >          else {
> >              sink(file)
> >              print(object)
> >              sink()
> >          }
> >       file.show(file, title = subx, delete.file = TRUE, ...)
> >      } else
> >       stop(gettextf("no object named '%s' to show", subx), domain = NA)
> > }
>
> > which also allows 1-element character vectors (and I am not entirely
> > sure we want that).
>
> There was a similar issue with prompt() (actually, its default method)
> for which I ended up "temporarily" providing the following (argh):
>
>         else {
>             name <- substitute(object)
>             if (is.name(name))
>                 as.character(name)
>             else if (is.call(name) && (as.character(name[[1]]) %in%
>                 c("::", ":::", "getAnywhere"))) {
>                 name <- as.character(name)
>                 name[length(name)]
>             }
>             else stop("cannot determine a usable name")
>         }
>
> Best
> -k
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From ripley at stats.ox.ac.uk  Wed Apr  5 14:29:24 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 5 Apr 2006 13:29:24 +0100 (BST)
Subject: [Rd] page() (Was: Re: predict.smooth.spline.fit and Recall()
 (Was: Re: Return function from function and Recall()))
In-Reply-To: <59d7961d0604050524v179d9130v61e8c2e99a4e7cbc@mail.gmail.com>
References: <59d7961d0604050524v179d9130v61e8c2e99a4e7cbc@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0604051327390.20233@gannet.stats.ox.ac.uk>

On Wed, 5 Apr 2006, Henrik Bengtsson wrote:

> Here I think S3 dispatch is very natural.  Try the following:

I don't: it is documented to work on a name not an object.

> page <- function(x, method = c("dput", "print"), ...) UseMethod("page")
>
> page.getAnywhere <- function(x, ..., idx=NULL) {
>  name <- x$name;
>  objects <- x$obj;
>
>  if (length(objects) == 0)
>    stop("no object named '", name, "' was found");
>
>  if (is.null(idx)) {
>    # Include all non-duplicated objects found
>    idx <- (1:length(objects))[!x$dups];
>  }
>
>  for (ii in idx) {
>    title <- paste(name, " (", x$where[ii], ")", sep="");
>    eval(substitute({
>      object <- x$obj[[ii]];
>      page(object, ...);
>    }, list(object=as.name(title))));
>  }
> }
>
> page.default <- utils::page;
>
> page(getAnywhere("predict.smooth.spline.fit"))
>
> You can have page.function(), page.character(), page.environment(),
> etc. and make these call page.default() indirectly.  What I think
> would be a very useful add on is to add an argument 'title' for which
> you can set/override the title.  Then the "ugly" substitute() calls
> could be limited to one specific case; where a "default" object is
> passed and no title is set.
>
> If you want to, I could play around with a bit.
>
> /Henrik
>
> On 4/5/06, Kurt Hornik <Kurt.Hornik at wu-wien.ac.at> wrote:
>>>>>>> Prof Brian Ripley writes:
>>
>>> On Wed, 5 Apr 2006, Henrik Bengtsson wrote:
>>>> Hi,
>
> [snip]
>
>>> As for
>>
>>>>> PS, may I suggest to modify page() so that
>>>>> 'page(getAnywhere("predict.smooth.spline.fit"))' works? DS.
>>
>>> it is rather tricky.  page() takes a name aka symbol as its argument
>>> (and is thereby S-compatible), and also works with a bare character
>>> string (undocumented).  What you have here is a call that does not
>>> even return a function.  It is more reasonable that
>>> stats:::predict.smooth.spline.fit should work, and it is also a call.
>>> I have in the past thought about special-casing that, but it is a
>>> valid name (you would have to back-quote it, but it does work).  So
>>> one possible way out would be to use get() on a name and evaluate
>>> calls, e.g.
>>
>>> page <- function(x, method = c("dput", "print"), ...)
>>> {
>>>      subx <- substitute(x)
>>>      have_object <- FALSE
>>>      if(is.call(subx)) {
>>>          object <- x
>>>          have_object <- TRUE
>>>          subx <- deparse(subx)
>>>      } else {
>>>          if(is.character(x)) subx <- x
>>>          else if(is.name(subx)) subx <- deparse(subx)
>>>          if (!is.character(subx) || length(subx) != 1)
>>>              stop("'page' requires a name, call or character string")
>>>          parent <- parent.frame()
>>>          if(exists(subx, envir = parent, inherits=TRUE)) {
>>>              object <- get(subx, envir = parent, inherits=TRUE)
>>>              have_object <- TRUE
>>>          }
>>>      }
>>>      if(have_object) {
>>>          method <- match.arg(method)
>>>          file <- tempfile("Rpage.")
>>>          if(method == "dput")
>>>              dput(object, file)
>>>          else {
>>>              sink(file)
>>>              print(object)
>>>              sink()
>>>          }
>>>       file.show(file, title = subx, delete.file = TRUE, ...)
>>>      } else
>>>       stop(gettextf("no object named '%s' to show", subx), domain = NA)
>>> }
>>
>>> which also allows 1-element character vectors (and I am not entirely
>>> sure we want that).
>>
>> There was a similar issue with prompt() (actually, its default method)
>> for which I ended up "temporarily" providing the following (argh):
>>
>>         else {
>>             name <- substitute(object)
>>             if (is.name(name))
>>                 as.character(name)
>>             else if (is.call(name) && (as.character(name[[1]]) %in%
>>                 c("::", ":::", "getAnywhere"))) {
>>                 name <- as.character(name)
>>                 name[length(name)]
>>             }
>>             else stop("cannot determine a usable name")
>>         }
>>
>> Best
>> -k
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Wed Apr  5 14:32:19 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 5 Apr 2006 13:32:19 +0100 (BST)
Subject: [Rd] predict.smooth.spline.fit and Recall() (Was: Re: Return
 function from function and Recall())
In-Reply-To: <59d7961d0604050458uf6ff050r1d714eae5885bcea@mail.gmail.com>
References: <59d7961d0604050225g4b3235fby3aa13af460fa38f7@mail.gmail.com> 
	<Pine.LNX.4.64.0604051109100.12918@gannet.stats.ox.ac.uk>
	<59d7961d0604050458uf6ff050r1d714eae5885bcea@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0604051313110.20233@gannet.stats.ox.ac.uk>

On Wed, 5 Apr 2006, Henrik Bengtsson wrote:

> On 4/5/06, Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
>> On Wed, 5 Apr 2006, Henrik Bengtsson wrote:
>>
>>> Hi,
>>>
>>> forget about the below details.  It is not related to the fact that
>>> the function is returned from a function.  Sorry about that.  I've
>>> been troubleshooting soo much I've been shoting over the target.  Here
>>> is a much smaller reproducible example:
>>>
>>> x <- 1:10
>>> y <- 1:10 + rnorm(length(x))
>>> sp <- smooth.spline(x=x, y=y)
>>> ypred <- predict(sp$fit, x)
>>> # [1]  2.325181  2.756166  ...
>>> ypred2 <- predict(sp$fit, c(0,x))
>>> # Error in Recall(object, xrange) : couldn't find
>>> # function "predict.smooth.spline.fit"
>>
>> It seems Recall is not searching (via findFun) from the right environment,
>> but at a quick glance it is not obvious to me why.
>> You can replace Recall by predict.smooth.spline.fit for now.
>
> More troubleshooting shows that by dispatching directly on 'sp' and
> not 'sp$fit' works.  The reason that I do not want to do this is
> related to my questions yesterday that I want to keep the memory usage
> down and 'sp' hold quite some extra data even with keep.data=FALSE.

Ahah!  So you are not using this as intended, and I had not spotted this. 
Now I understand: you are calling predict, which finds 
predict.smooth.spline.fit via method registration, and dispatches it in 
the environment used to call predict, .GlobalEnv, where of course it is 
not visible. Then Recall uses that environment, but attempts to call the 
method directly.

If you call this as intended, predict is called from the body of 
predict.smooth.spline where predict.smooth.spline.fit is visible.

I am afraid that you should not be expecting to be able to subvert things 
this way.

[...]

Now, I was a little surprised that Recall() needed to do a lookup, but R's 
context only contains the name of the called function and not (a pointer 
to) the function.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From hb at maths.lth.se  Wed Apr  5 16:17:37 2006
From: hb at maths.lth.se (Henrik Bengtsson)
Date: Wed, 5 Apr 2006 16:17:37 +0200
Subject: [Rd] predict.smooth.spline.fit and Recall() (Was: Re: Return
	function from function and Recall())
In-Reply-To: <Pine.LNX.4.64.0604051313110.20233@gannet.stats.ox.ac.uk>
References: <59d7961d0604050225g4b3235fby3aa13af460fa38f7@mail.gmail.com>
	<Pine.LNX.4.64.0604051109100.12918@gannet.stats.ox.ac.uk>
	<59d7961d0604050458uf6ff050r1d714eae5885bcea@mail.gmail.com>
	<Pine.LNX.4.64.0604051313110.20233@gannet.stats.ox.ac.uk>
Message-ID: <59d7961d0604050717u4522e20ha53dddaf7bb6df1@mail.gmail.com>

On 4/5/06, Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
> On Wed, 5 Apr 2006, Henrik Bengtsson wrote:
>
> > On 4/5/06, Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
> >> On Wed, 5 Apr 2006, Henrik Bengtsson wrote:
> >>
> >>> Hi,
> >>>
> >>> forget about the below details.  It is not related to the fact that
> >>> the function is returned from a function.  Sorry about that.  I've
> >>> been troubleshooting soo much I've been shoting over the target.  Here
> >>> is a much smaller reproducible example:
> >>>
> >>> x <- 1:10
> >>> y <- 1:10 + rnorm(length(x))
> >>> sp <- smooth.spline(x=x, y=y)
> >>> ypred <- predict(sp$fit, x)
> >>> # [1]  2.325181  2.756166  ...
> >>> ypred2 <- predict(sp$fit, c(0,x))
> >>> # Error in Recall(object, xrange) : couldn't find
> >>> # function "predict.smooth.spline.fit"
> >>
> >> It seems Recall is not searching (via findFun) from the right environment,
> >> but at a quick glance it is not obvious to me why.
> >> You can replace Recall by predict.smooth.spline.fit for now.
> >
> > More troubleshooting shows that by dispatching directly on 'sp' and
> > not 'sp$fit' works.  The reason that I do not want to do this is
> > related to my questions yesterday that I want to keep the memory usage
> > down and 'sp' hold quite some extra data even with keep.data=FALSE.
>
> Ahah!  So you are not using this as intended, and I had not spotted this.

Neither did I ;)

> Now I understand: you are calling predict, which finds
> predict.smooth.spline.fit via method registration, and dispatches it in
> the environment used to call predict, .GlobalEnv, where of course it is
> not visible. Then Recall uses that environment, but attempts to call the
> method directly.
>
> If you call this as intended, predict is called from the body of
> predict.smooth.spline where predict.smooth.spline.fit is visible.
>
> I am afraid that you should not be expecting to be able to subvert things
> this way.

One could argue that it should not be possible to dispatch to a
non-exported method the way I did.  If UseMethod() would use the same
search path as the calling expression in the parent frame (and not
from "within" the environment where the generic function lives), then
the predict() would fail right away.  However, I think it is a very
risky business to make such modifications to UseMethod(), because
there are probably unknown side effects to this.

/Henrik

> [...]
>
> Now, I was a little surprised that Recall() needed to do a lookup, but R's
> context only contains the name of the called function and not (a pointer
> to) the function.
>
> --
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>
>


--
Henrik Bengtsson
Mobile: +46 708 909208 (+2h UTC)


From hb at maths.lth.se  Wed Apr  5 16:24:53 2006
From: hb at maths.lth.se (Henrik Bengtsson)
Date: Wed, 5 Apr 2006 16:24:53 +0200
Subject: [Rd] page() (Was: Re: predict.smooth.spline.fit and Recall()
	(Was: Re: Return function from function and Recall()))
In-Reply-To: <Pine.LNX.4.64.0604051327390.20233@gannet.stats.ox.ac.uk>
References: <59d7961d0604050524v179d9130v61e8c2e99a4e7cbc@mail.gmail.com>
	<Pine.LNX.4.64.0604051327390.20233@gannet.stats.ox.ac.uk>
Message-ID: <59d7961d0604050724v4efce0c8t5d775f7fc399168c@mail.gmail.com>

On 4/5/06, Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
> On Wed, 5 Apr 2006, Henrik Bengtsson wrote:
>
> > Here I think S3 dispatch is very natural.  Try the following:
>
> I don't: it is documented to work on a name not an object.

What comes first, the documentation of a method or the method itself?  ;)

I noticed the last year or so, that the documentation is being
referred to as a requirement/design specification, in addition to
being help pages.  If this is in general true, that is a good
guideline.  Has this evolved recently, or is it just me that missed it
before?

/Henrik

>
> > page <- function(x, method = c("dput", "print"), ...) UseMethod("page")
> >
> > page.getAnywhere <- function(x, ..., idx=NULL) {
> >  name <- x$name;
> >  objects <- x$obj;
> >
> >  if (length(objects) == 0)
> >    stop("no object named '", name, "' was found");
> >
> >  if (is.null(idx)) {
> >    # Include all non-duplicated objects found
> >    idx <- (1:length(objects))[!x$dups];
> >  }
> >
> >  for (ii in idx) {
> >    title <- paste(name, " (", x$where[ii], ")", sep="");
> >    eval(substitute({
> >      object <- x$obj[[ii]];
> >      page(object, ...);
> >    }, list(object=as.name(title))));
> >  }
> > }
> >
> > page.default <- utils::page;
> >
> > page(getAnywhere("predict.smooth.spline.fit"))
> >
> > You can have page.function(), page.character(), page.environment(),
> > etc. and make these call page.default() indirectly.  What I think
> > would be a very useful add on is to add an argument 'title' for which
> > you can set/override the title.  Then the "ugly" substitute() calls
> > could be limited to one specific case; where a "default" object is
> > passed and no title is set.
> >
> > If you want to, I could play around with a bit.
> >
> > /Henrik
> >
> > On 4/5/06, Kurt Hornik <Kurt.Hornik at wu-wien.ac.at> wrote:
> >>>>>>> Prof Brian Ripley writes:
> >>
> >>> On Wed, 5 Apr 2006, Henrik Bengtsson wrote:
> >>>> Hi,
> >
> > [snip]
> >
> >>> As for
> >>
> >>>>> PS, may I suggest to modify page() so that
> >>>>> 'page(getAnywhere("predict.smooth.spline.fit"))' works? DS.
> >>
> >>> it is rather tricky.  page() takes a name aka symbol as its argument
> >>> (and is thereby S-compatible), and also works with a bare character
> >>> string (undocumented).  What you have here is a call that does not
> >>> even return a function.  It is more reasonable that
> >>> stats:::predict.smooth.spline.fit should work, and it is also a call.
> >>> I have in the past thought about special-casing that, but it is a
> >>> valid name (you would have to back-quote it, but it does work).  So
> >>> one possible way out would be to use get() on a name and evaluate
> >>> calls, e.g.
> >>
> >>> page <- function(x, method = c("dput", "print"), ...)
> >>> {
> >>>      subx <- substitute(x)
> >>>      have_object <- FALSE
> >>>      if(is.call(subx)) {
> >>>          object <- x
> >>>          have_object <- TRUE
> >>>          subx <- deparse(subx)
> >>>      } else {
> >>>          if(is.character(x)) subx <- x
> >>>          else if(is.name(subx)) subx <- deparse(subx)
> >>>          if (!is.character(subx) || length(subx) != 1)
> >>>              stop("'page' requires a name, call or character string")
> >>>          parent <- parent.frame()
> >>>          if(exists(subx, envir = parent, inherits=TRUE)) {
> >>>              object <- get(subx, envir = parent, inherits=TRUE)
> >>>              have_object <- TRUE
> >>>          }
> >>>      }
> >>>      if(have_object) {
> >>>          method <- match.arg(method)
> >>>          file <- tempfile("Rpage.")
> >>>          if(method == "dput")
> >>>              dput(object, file)
> >>>          else {
> >>>              sink(file)
> >>>              print(object)
> >>>              sink()
> >>>          }
> >>>       file.show(file, title = subx, delete.file = TRUE, ...)
> >>>      } else
> >>>       stop(gettextf("no object named '%s' to show", subx), domain = NA)
> >>> }
> >>
> >>> which also allows 1-element character vectors (and I am not entirely
> >>> sure we want that).
> >>
> >> There was a similar issue with prompt() (actually, its default method)
> >> for which I ended up "temporarily" providing the following (argh):
> >>
> >>         else {
> >>             name <- substitute(object)
> >>             if (is.name(name))
> >>                 as.character(name)
> >>             else if (is.call(name) && (as.character(name[[1]]) %in%
> >>                 c("::", ":::", "getAnywhere"))) {
> >>                 name <- as.character(name)
> >>                 name[length(name)]
> >>             }
> >>             else stop("cannot determine a usable name")
> >>         }
> >>
> >> Best
> >> -k
> >>
> >> ______________________________________________
> >> R-devel at r-project.org mailing list
> >> https://stat.ethz.ch/mailman/listinfo/r-devel
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >
> >
>
> --
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>
>


--
Henrik Bengtsson
Mobile: +46 708 909208 (+2h UTC)


From ehlers at math.ucalgary.ca  Wed Apr  5 17:28:32 2006
From: ehlers at math.ucalgary.ca (Peter Ehlers)
Date: Wed, 05 Apr 2006 09:28:32 -0600
Subject: [Rd] wishlist: 'formula' method for stripchart()
Message-ID: <4433E220.9050203@math.ucalgary.ca>

Folks,

I would find it useful to have a formula method for
stripchart() with 'data' and 'subset' arguments, similar
to boxplot.formula() whose code can probably be adapted
fairly easily.

Comments?

Peter Ehlers

(Win XP)


From luke at stat.uiowa.edu  Wed Apr  5 17:42:34 2006
From: luke at stat.uiowa.edu (Luke Tierney)
Date: Wed, 5 Apr 2006 10:42:34 -0500 (CDT)
Subject: [Rd] predict.smooth.spline.fit and Recall() (Was: Re: Return
 function from function and Recall())
In-Reply-To: <Pine.LNX.4.64.0604051313110.20233@gannet.stats.ox.ac.uk>
References: <59d7961d0604050225g4b3235fby3aa13af460fa38f7@mail.gmail.com> 
	<Pine.LNX.4.64.0604051109100.12918@gannet.stats.ox.ac.uk>
	<59d7961d0604050458uf6ff050r1d714eae5885bcea@mail.gmail.com>
	<Pine.LNX.4.64.0604051313110.20233@gannet.stats.ox.ac.uk>
Message-ID: <Pine.LNX.4.64.0604051035550.21553@nokomis.stat.uiowa.edu>

On Wed, 5 Apr 2006, Prof Brian Ripley wrote:

> On Wed, 5 Apr 2006, Henrik Bengtsson wrote:
>
>> On 4/5/06, Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
>>> On Wed, 5 Apr 2006, Henrik Bengtsson wrote:
>>>
>>>> Hi,
>>>>
>>>> forget about the below details.  It is not related to the fact that
>>>> the function is returned from a function.  Sorry about that.  I've
>>>> been troubleshooting soo much I've been shoting over the target.  Here
>>>> is a much smaller reproducible example:
>>>>
>>>> x <- 1:10
>>>> y <- 1:10 + rnorm(length(x))
>>>> sp <- smooth.spline(x=x, y=y)
>>>> ypred <- predict(sp$fit, x)
>>>> # [1]  2.325181  2.756166  ...
>>>> ypred2 <- predict(sp$fit, c(0,x))
>>>> # Error in Recall(object, xrange) : couldn't find
>>>> # function "predict.smooth.spline.fit"
>>>
>>> It seems Recall is not searching (via findFun) from the right environment,
>>> but at a quick glance it is not obvious to me why.
>>> You can replace Recall by predict.smooth.spline.fit for now.
>>
>> More troubleshooting shows that by dispatching directly on 'sp' and
>> not 'sp$fit' works.  The reason that I do not want to do this is
>> related to my questions yesterday that I want to keep the memory usage
>> down and 'sp' hold quite some extra data even with keep.data=FALSE.
>
> Ahah!  So you are not using this as intended, and I had not spotted this.
> Now I understand: you are calling predict, which finds
> predict.smooth.spline.fit via method registration, and dispatches it in
> the environment used to call predict, .GlobalEnv, where of course it is
> not visible. Then Recall uses that environment, but attempts to call the
> method directly.
>
> If you call this as intended, predict is called from the body of
> predict.smooth.spline where predict.smooth.spline.fit is visible.
>
> I am afraid that you should not be expecting to be able to subvert things
> this way.
>
> [...]
>
> Now, I was a little surprised that Recall() needed to do a lookup, but R's
> context only contains the name of the called function and not (a pointer
> to) the function.

I think the callfun field in the context is intended to contains this
and was added with the intent of making things like sys.function more
reliable but I'm not sure this was ever fully implemented.  Might be
worth checking into after 2.3 and modifying Recall to use it.

luke

-- 
Luke Tierney
Chair, Statistics and Actuarial Science
Ralph E. Wareham Professor of Mathematical Sciences
University of Iowa                  Phone:             319-335-3386
Department of Statistics and        Fax:               319-335-3017
    Actuarial Science
241 Schaeffer Hall                  email:      luke at stat.uiowa.edu
Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu


From ripley at stats.ox.ac.uk  Wed Apr  5 18:24:28 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 5 Apr 2006 17:24:28 +0100 (BST)
Subject: [Rd] predict.smooth.spline.fit and Recall() (Was: Re: Return
 function from function and Recall())
In-Reply-To: <Pine.LNX.4.64.0604051035550.21553@nokomis.stat.uiowa.edu>
References: <59d7961d0604050225g4b3235fby3aa13af460fa38f7@mail.gmail.com> 
	<Pine.LNX.4.64.0604051109100.12918@gannet.stats.ox.ac.uk>
	<59d7961d0604050458uf6ff050r1d714eae5885bcea@mail.gmail.com>
	<Pine.LNX.4.64.0604051313110.20233@gannet.stats.ox.ac.uk>
	<Pine.LNX.4.64.0604051035550.21553@nokomis.stat.uiowa.edu>
Message-ID: <Pine.LNX.4.64.0604051645240.26692@gannet.stats.ox.ac.uk>

On Wed, 5 Apr 2006, Luke Tierney wrote:

> On Wed, 5 Apr 2006, Prof Brian Ripley wrote:
>
>> [...]
>> 
>> Now, I was a little surprised that Recall() needed to do a lookup, but R's
>> context only contains the name of the called function and not (a pointer
>> to) the function.
>
> I think the callfun field in the context is intended to contains this
> and was added with the intent of making things like sys.function more
> reliable but I'm not sure this was ever fully implemented.  Might be
> worth checking into after 2.3 and modifying Recall to use it.

What 'callfun' field?  It is not documented at the top of context.c ...
silly me, believing the documentation!  (Actually, the comment is quite 
economical about what is there.)

It does seem applyClosure and R_execClosure set it, so this is worth 
doing.  What's in callfun in other contexts seems odd (and R_GlobalEnv 
seems definitely wrong).  tryDispatch has

   begincontext(&cntxt, CTXT_RETURN, call, rho, rho, pargs,
                R_NilValue);/**** FIXME: put in op */

and there are some in the byte-code section.  So it is probably safe to 
use callfun unless it is R_NilValue and otherwise search.

As is, we have rather inconsistent behaviour.  E.g.,

library(MASS)
denumerate(~(1+2+3)^3 + a/b)

works fine, as the denumerate methods are exported.  However, in a new
session do

> MASS:::denumerate(~(1+2+3)^3 + a/b)
Error in Recall(x[[2]]) : couldn't find function "denumerate.formula"

whereas MASS:::denumerate.formula(~(1+2+3)^3 + a/b) works.  (Why? The 
docs were wrong, and in that case the context contains the expression
needed to get the function, not the name.)

Thanks for the hint.  Recall is used rarely, and it has been going wrong 
in quite a few cases (apart from Henrik's and that above I managed to 
generate examples in cophenetic.dendrogram and window.default), so I do 
wonder if we should not be fixing this for 2.3.0.

Brian

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Wed Apr  5 18:27:38 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 5 Apr 2006 17:27:38 +0100 (BST)
Subject: [Rd] wishlist: 'formula' method for stripchart()
In-Reply-To: <4433E220.9050203@math.ucalgary.ca>
References: <4433E220.9050203@math.ucalgary.ca>
Message-ID: <Pine.LNX.4.64.0604051725460.26692@gannet.stats.ox.ac.uk>

On Wed, 5 Apr 2006, Peter Ehlers wrote:

> Folks,
>
> I would find it useful to have a formula method for
> stripchart() with 'data' and 'subset' arguments, similar
> to boxplot.formula() whose code can probably be adapted
> fairly easily.
>
> Comments?

Are you offering to provide one?

(Actually now is not a good time unless you have one in your back pocket 
as we are 5 days off feature freeze for 2.3.0.)

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Wed Apr  5 18:44:46 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 5 Apr 2006 17:44:46 +0100 (BST)
Subject: [Rd] predict.smooth.spline.fit and Recall() (Was: Re: Return
 function from function and Recall())
In-Reply-To: <59d7961d0604050717u4522e20ha53dddaf7bb6df1@mail.gmail.com>
References: <59d7961d0604050225g4b3235fby3aa13af460fa38f7@mail.gmail.com> 
	<Pine.LNX.4.64.0604051109100.12918@gannet.stats.ox.ac.uk> 
	<59d7961d0604050458uf6ff050r1d714eae5885bcea@mail.gmail.com> 
	<Pine.LNX.4.64.0604051313110.20233@gannet.stats.ox.ac.uk>
	<59d7961d0604050717u4522e20ha53dddaf7bb6df1@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0604051519430.22881@gannet.stats.ox.ac.uk>

On Wed, 5 Apr 2006, Henrik Bengtsson wrote:

> On 4/5/06, Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
>> On Wed, 5 Apr 2006, Henrik Bengtsson wrote:
>>
>>> On 4/5/06, Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
>>>> On Wed, 5 Apr 2006, Henrik Bengtsson wrote:
>>>>
>>>>> Hi,
>>>>>
>>>>> forget about the below details.  It is not related to the fact that
>>>>> the function is returned from a function.  Sorry about that.  I've
>>>>> been troubleshooting soo much I've been shoting over the target.  Here
>>>>> is a much smaller reproducible example:
>>>>>
>>>>> x <- 1:10
>>>>> y <- 1:10 + rnorm(length(x))
>>>>> sp <- smooth.spline(x=x, y=y)
>>>>> ypred <- predict(sp$fit, x)
>>>>> # [1]  2.325181  2.756166  ...
>>>>> ypred2 <- predict(sp$fit, c(0,x))
>>>>> # Error in Recall(object, xrange) : couldn't find
>>>>> # function "predict.smooth.spline.fit"
>>>>
>>>> It seems Recall is not searching (via findFun) from the right environment,
>>>> but at a quick glance it is not obvious to me why.
>>>> You can replace Recall by predict.smooth.spline.fit for now.
>>>
>>> More troubleshooting shows that by dispatching directly on 'sp' and
>>> not 'sp$fit' works.  The reason that I do not want to do this is
>>> related to my questions yesterday that I want to keep the memory usage
>>> down and 'sp' hold quite some extra data even with keep.data=FALSE.
>>
>> Ahah!  So you are not using this as intended, and I had not spotted this.
>
> Neither did I ;)
>
>> Now I understand: you are calling predict, which finds
>> predict.smooth.spline.fit via method registration, and dispatches it in
>> the environment used to call predict, .GlobalEnv, where of course it is
>> not visible. Then Recall uses that environment, but attempts to call the
>> method directly.
>>
>> If you call this as intended, predict is called from the body of
>> predict.smooth.spline where predict.smooth.spline.fit is visible.
>>
>> I am afraid that you should not be expecting to be able to subvert things
>> this way.
>
> One could argue that it should not be possible to dispatch to a
> non-exported method the way I did.  If UseMethod() would use the same
> search path as the calling expression in the parent frame (and not
> from "within" the environment where the generic function lives),

It *does* do the former: method dispatch is dynamically scoped.
NB: 'via method registration'.

> then the predict() would fail right away.  However, I think it is a very 
> risky business to make such modifications to UseMethod(), because there 
> are probably unknown side effects to this.

One could argue that the particular method should not have been 
registered, so it could only be found from within the namespace.

However, there are several other examples (such as cophenetic.dendrogram) 
which are intended to work and fall foul of the same trap.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From candrews at buffalo.edu  Wed Apr  5 20:33:10 2006
From: candrews at buffalo.edu (candrews at buffalo.edu)
Date: Wed,  5 Apr 2006 20:33:10 +0200 (CEST)
Subject: [Rd] uniroot warning (lack of) (PR#8750)
Message-ID: <20060405183310.3DC94103F7@slim.kubism.ku.dk>

Full_Name: Chris Andrews
Version: 2.2.1
OS: Windows
Submission from: (NULL) (128.205.94.95)


The function page for uniroot indicates
     If the algorithm does not converge in 'maxiter' steps, a warning
     is printed and the current approximation is returned.

I have not been able to get a warning message even when I think I should get one
(see code below).

Perhaps the bug is in the .Internal(zeroin)
or how the warning condition is detected (val[2] < 0)
Perhaps (val[3]>tol) would work?

Thanks,
Chris


# define a function with a root
ff <- function(x) (x-pi)^3

# fail on a warning
options(warn = 2)

# find it
uniroot(ff, c(-10,10))

# start to find it but maxiter is reached (with no warning)
uniroot(ff, c(-10,10), maxiter=2)
# OUTPUT:
#$root
#[1] -1.663169
#
#$f.root
#[1] -110.9215
#
#$iter
#[1] 2
#
#$estim.prec
#[1] 8.336831

> version
         _
platform i386-pc-mingw32
arch     i386           
os       mingw32        
system   i386, mingw32  
status                  
major    2              
minor    2.1            
year     2005           
month    12             
day      20             
svn rev  36812          
language R       

> sessionInfo()
R version 2.2.1, 2005-12-20, i386-pc-mingw32 

attached base packages:
[1] "methods"   "stats"     "graphics"  "grDevices" "utils"     "datasets" 
[7] "base"


From ehlers at math.ucalgary.ca  Wed Apr  5 22:46:46 2006
From: ehlers at math.ucalgary.ca (Peter Ehlers)
Date: Wed, 05 Apr 2006 14:46:46 -0600
Subject: [Rd] wishlist: 'formula' method for stripchart()
In-Reply-To: <Pine.LNX.4.64.0604051725460.26692@gannet.stats.ox.ac.uk>
References: <4433E220.9050203@math.ucalgary.ca>
	<Pine.LNX.4.64.0604051725460.26692@gannet.stats.ox.ac.uk>
Message-ID: <44342CB6.4030509@math.ucalgary.ca>

Sorry, I should have been clearer. This is definitely not
a high-priority item and I hadn't intended it to be
included for 2.3.0.

Sure, I'll provide the code and help page adjustment.

Peter Ehlers


Prof Brian Ripley wrote:
> On Wed, 5 Apr 2006, Peter Ehlers wrote:
> 
>> Folks,
>>
>> I would find it useful to have a formula method for
>> stripchart() with 'data' and 'subset' arguments, similar
>> to boxplot.formula() whose code can probably be adapted
>> fairly easily.
>>
>> Comments?
> 
> 
> Are you offering to provide one?
> 
> (Actually now is not a good time unless you have one in your back pocket 
> as we are 5 days off feature freeze for 2.3.0.)
>


From ggrothendieck at gmail.com  Thu Apr  6 15:11:57 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Thu, 6 Apr 2006 09:11:57 -0400
Subject: [Rd] extending strsplit(): supply pattern to keep,
	not to split by
In-Reply-To: <971536df0604041039u10a5d0c0s305e262b8d72d3bd@mail.gmail.com>
References: <Pine.GSO.4.56.0604040832290.21795@octopus>
	<971536df0604040901i47a96891t7f1d8d587caf384a@mail.gmail.com>
	<Pine.GSO.4.56.0604040941310.21795@octopus>
	<971536df0604041039u10a5d0c0s305e262b8d72d3bd@mail.gmail.com>
Message-ID: <971536df0604060611qc85a0aaq8dc60daa661a63d2@mail.gmail.com>

To follow up, strapply has been added to the
gsubfn package (gsubfn 0.1-1) which should make it
easier to address this problem.

Its basically just a sapply call around gsubfn which
returns the transformed matches rather than performing
substitution.  Its analogous to apply:

	apply(object, margin, function)
	strapply(object, pattern, function)

(The arguments shown above are not a complete list
nor are they they actual arg names but are simply
intended to show the close parallel between strapply
and apply.)

The default function in strapply returns its
first argument so for this problem we could omit
the function altogether and write:

  library(gsubfn)  # ver 0.1-1 needed
  x <- c("12;34:56,89,,12", "1.2, .4, 1., 1e3")
  strapply(x, number.pattern)

See ?strapply for more info.


On 4/4/06, Gabor Grothendieck <ggrothendieck at gmail.com> wrote:
> On 4/4/06, Bill Dunlap <bill at insightful.com> wrote:
> > On Tue, 4 Apr 2006, Gabor Grothendieck wrote:
> >
> > > gsubfn in package gsubfn can do this.  See the examples
> > > in ?gsubfn
> >
> > Thanks.  gsubfn looks useful, but may be overkill
> > for this, and it isn't vectorized.  To do what
>
> gsubfn is vectorized.  Its just that you are not using the output of
> gsubfn in this case.
>
> > strsplit(keep=T) would do I think you need to do something like:
> >
> >   > findMatches<-function(strings, pattern){
> >        lapply(strings, function(string){
> >               v <- character()
> >               gsubfn(number.pattern, function(x,...)v<<-c(v,x), string)
> >               v})
> >     }
> >   > number.pattern <- "[-+]?(([0-9]+(\\.[0-9]*)?)|(\\.[0-9]+))([eE][+-]?[0-9]+)?"
> >   > findMatches(c("12;34:56,89,,12", "1.2, .4, 1., 1e3"), number.pattern)
> >   [[1]]
> >   [1] "12" "34" "56" "89" "12"
> >
> >   [[2]]
> >   [1] "1.2" ".4"  "1."  "1e3"
> >
> > Is this worth encapsulating in a standard R function?
>
> I will likely add a wrapper to the gsubfn package for this.
>
> > If so, is doing via an extra argument to strsplit()
> > a reasonable way to do it?
>
> My current thought was to create a strapply function to do that.
>
> >
> >   > strsplit(c("12;34:56,89,,12", "1.2, .4, 1., 1e3"), number.pattern, keep=T)
> >   [[1]]:
> >   [1] "12" "34" "56" "89" "12"
> >
> >   [[2]]:
> >   [1] "1.2" ".4"  "1."  "1e3"
> >
> >
> > > On 4/4/06, Bill Dunlap <bill at insightful.com> wrote:
> > > > strsplit() is a convenient way to get a
> > > > list of items from a string when you
> > > > have a regular expression for what is not
> > > > an item.  E.g.,
> > > >
> > > >   > strsplit("1.2, 34, 1.7e-2", split="[ ,] *")
> > > >   [[1]]:
> > > >   [1] "1.2"    "34"     "1.7e-2"
> > > >
> > > > However, sometimes is it more convenient to
> > > > give a pattern for the items you do want.
> > > > E.g., suppose you want to pull all the numbers
> > > > out of a string which contains a mix of numbers
> > > > and words.  Making a pattern for what a
> > > > number is simpler than making a pattern
> > > > for what may come between the number.
> > > >   > number.pattern <- "[-+]?(([0-9]+(\\.[0-9]*)?)|(\\.[0-9]+))([eE][+-]?[0-9]+)?"
> > > >
> > > > I propose adding a keep=FALSE argument to
> > > > strsplit() to do this.  If keep is FALSE,
> > > > then the split argument matches the stuff to
> > > > omit from the output; if keep is TRUE then
> > > > split matches the stuff to put into the
> > > > output.  Then we could do the following to
> > > > get a list of all the numbers in a string
> > > > (done in a version of strsplit() I'm working on
> > > > for S-PLUS):
> > > >
> > > >   > strsplit("1.2, 34, 1.7e-2", split=number.pattern,keep=TRUE)
> > > >   [[1]]:
> > > >   [1] "1.2"    "34"     "1.7e-2"
> > > >
> > > >   > strsplit("Ibuprofin 200mg", split=number.pattern,keep=TRUE)
> > > >   [[1]]:
> > > >   [1] "200"
> > > >
> > > > Is this a reasonable thing to want strsplit to do?
> > > > Is this a reasonable parameterization of it?
> >
> > ----------------------------------------------------------------------------
> > Bill Dunlap
> > Insightful Corporation
> > bill at insightful dot com
> > 360-428-8146
> >
> >  "All statements in this message represent the opinions of the author and do
> >  not necessarily reflect Insightful Corporation policy or position."
> >
>


From timb at metrumrg.com  Thu Apr  6 21:46:44 2006
From: timb at metrumrg.com (Tim Bergsma)
Date: Thu, 06 Apr 2006 15:46:44 -0400
Subject: [Rd] prevent reassignment of function names
Message-ID: <44357024.6090804@metrumrg.com>

Hi.

I'm trying to find a systematic way to prevent assignment to names of 
existing functions.  I've tried reassigning to the assignment operator, 
with mixed results.  The function definition for "<-" below works as 
hoped for the demonstrated assignments to a and c.  However, for the 
assignment based on the test function, it appears that the formal 
argument is not visible.  Any suggestions?

Thanks,

Tim.

-------------------------------------------------------------
rm(list=ls())
"<-" <- function(x,value){
	try(assign("y",x), silent=TRUE)
	if (exists("y", mode="function"))
		stop("assignment to an existing function")
	else  eval(substitute(.Primitive("<-")(x, value)),sys.frame(sys.parent(2)))
}

MYLEN <- function(infile){
	LEN <- nchar(infile)
	return(LEN)	
}
a <- 3
c <- 3
#Error in c <- 3 : assignment to an existing function
d <- MYLEN("word")
#Error in nchar(infile) : object "infile" not found


From tlumley at u.washington.edu  Thu Apr  6 22:44:50 2006
From: tlumley at u.washington.edu (Thomas Lumley)
Date: Thu, 6 Apr 2006 13:44:50 -0700 (PDT)
Subject: [Rd] prevent reassignment of function names
In-Reply-To: <44357024.6090804@metrumrg.com>
References: <44357024.6090804@metrumrg.com>
Message-ID: <Pine.LNX.4.64.0604061331020.19619@homer24.u.washington.edu>

On Thu, 6 Apr 2006, Tim Bergsma wrote:

> Hi.
>
> I'm trying to find a systematic way to prevent assignment to names of
> existing functions.  I've tried reassigning to the assignment operator,
> with mixed results.  The function definition for "<-" below works as
> hoped for the demonstrated assignments to a and c.  However, for the
> assignment based on the test function, it appears that the formal
> argument is not visible.  Any suggestions?
>

Well, my first suggestion would be not to do it. I don't see any real 
benefit, and messing around with something as basic as assignment is 
likely to break something.  If nothing else, there is certainly code out 
there where people have, say, "df" or "c" as a variable name, and it isn't 
doing any harm.

As a programming exercise it seems that the following works

"<-" <- function(x,value){
         if(tryCatch(is.function(x),error=function(e) FALSE))
                 stop("assignment to an existing function")
         else  eval.parent(substitute(.Primitive("<-")(x,value)))
}


 	-thomas

Thomas Lumley			Assoc. Professor, Biostatistics
tlumley at u.washington.edu	University of Washington, Seattle


From sfalcon at fhcrc.org  Thu Apr  6 23:47:06 2006
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Thu, 06 Apr 2006 14:47:06 -0700
Subject: [Rd] prevent reassignment of function names
In-Reply-To: <44357024.6090804@metrumrg.com> (Tim Bergsma's message of "Thu,
	06 Apr 2006 15:46:44 -0400")
References: <44357024.6090804@metrumrg.com>
Message-ID: <m21wwa1in9.fsf@ziti.local>

Tim Bergsma <timb at metrumrg.com> writes:

> Hi.
>
> I'm trying to find a systematic way to prevent assignment to names of 
> existing functions.

An alternative would be to put your functions into an R package with a
namespace.  Then you won't be able to overwrite them (easily).

+ seth


From hb at maths.lth.se  Fri Apr  7 00:49:02 2006
From: hb at maths.lth.se (Henrik Bengtsson)
Date: Fri, 7 Apr 2006 00:49:02 +0200
Subject: [Rd] prevent reassignment of function names
In-Reply-To: <m21wwa1in9.fsf@ziti.local>
References: <44357024.6090804@metrumrg.com> <m21wwa1in9.fsf@ziti.local>
Message-ID: <59d7961d0604061549k4ee706bn7384430c55b83858@mail.gmail.com>

On 4/6/06, Seth Falcon <sfalcon at fhcrc.org> wrote:
> Tim Bergsma <timb at metrumrg.com> writes:
>
> > Hi.
> >
> > I'm trying to find a systematic way to prevent assignment to names of
> > existing functions.
>
> An alternative would be to put your functions into an R package with a
> namespace.  Then you won't be able to overwrite them (easily).

Can even be a package without a namespace - to overwrite anything in a
package you have to explicitly do assign() to the environment of the
package.

Another way is to add an environment to the search path (?search) and
add you functions to that.  Example:

# Add an empty environment to the search path
env <- attach(list(), name="myFunctions")

# Define functions
assign("foo", function(x) { cat("foo: x=", x, "\n", sep="") }, envir=env)
assign("bar", function(x) { cat("bar: x=", x, "\n", sep="") }, envir=env)

# Assign 'foo' in the global environment
foo <- 3

# Function foo() is still available in 'myFunctions'
foo(4)

If you have a myFunction.R file with function definitions, e.g.

foo <- function(x) {
  cat("foo: x=", x, "\n", sep="")
}

bar <- function(x) {
  cat("bar: x=", x, "\n", sep="")
}

then it's a bit tricky to make source() assign objects to the
environment.  Instead you can use sourceTo() in the R.utils package,
e.g.

sourceTo("myFunctions.R", envir=env)

/Henrik

> + seth
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From pinard at carouge.sram.qc.ca  Fri Apr  7 00:59:39 2006
From: pinard at carouge.sram.qc.ca (pinard at carouge.sram.qc.ca)
Date: Fri,  7 Apr 2006 00:59:39 +0200 (CEST)
Subject: [Rd] Documentation error in ?write (PR#8752)
Message-ID: <20060406225939.4903419B37@slim.kubism.ku.dk>

Hi, people.  ?write shows the following contents in Examples section:

     # create a 2 by 5 matrix
     x <- matrix(1:10,ncol=5)

     # the file data contains x, two rows, five cols
     # 1 3 5 6 9 will form the first row
     write(t(x))

On the next to last line, "6" should be replaced by "7".

--please do not edit the information below--

Version:
 platform = x86_64-unknown-linux-gnu
 arch = x86_64
 os = linux-gnu
 system = x86_64, linux-gnu
 status = 
 major = 2
 minor = 2.1
 year = 2005
 month = 12
 day = 20
 svn rev = 36812
 language = R

Locale:
LC_CTYPE=fr_CA.UTF-8;LC_NUMERIC=C;LC_TIME=fr_CA.UTF-8;LC_COLLATE=fr_CA.UTF-8;LC_MONETARY=fr_CA.UTF-8;LC_MESSAGES=fr_CA.UTF-8;LC_PAPER=C;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=C;LC_IDENTIFICATION=C

Search Path:
 .GlobalEnv, package:methods, package:stats, package:graphics, package:utils, package:datasets, fp.etc, package:grDevices, Autoloads, package:base


From sick_soul at yahoo.it  Fri Apr  7 04:47:47 2006
From: sick_soul at yahoo.it (Claudio Fontana)
Date: Thu, 6 Apr 2006 19:47:47 -0700 (PDT)
Subject: [Rd] R-Project build system: DESTDIR support
Message-ID: <20060407024747.87526.qmail@web26015.mail.ukl.yahoo.com>

Hello,

we had a quick exchange some time ago about putting
DESTDIR support in R-Project.

DESTDIR is not meant for run-time relocation, but for
staged installation.
An already configured package can be installed to a
temporary destination, with all information,
hard-coded paths, or even run-time relocation code
referring to the final destination.

In attachment you'll find a p1 (and p2, for that
matter) patch in unified format that adds DESTDIR
support to R-Project.
It's made against 2.2.1.

To apply it and study/test it, please try as a regular
(unprivileged) user:

$ cd R-2.2.1           # (top_srcdir)
$ patch -p1 < R-2.2.1-DESTDIR_support.p1.udiff
$ ./configure --prefix=${HOME}/usr
$ make
$ make install DESTDIR=${HOME}/install-destdir

what happens is that an installation finally intended
for /home/username/usr (we install in user mode to
prevent problems and encourage testing) is offset, at
installation time, to a temporary location, namely
${HOME}/install-destdir.

If you find ~/install-destdir, you'll see that that
directory contains in itself a whole snapshot of the
installation.

The temporary installation is non-functional.
Its hard-coded path information in _any form_ refers
to the final destination.

Now try (supposing you do not have an existing
${HOME}/usr):

$ mv ${HOME}/install-destdir/${HOME}/usr ${HOME}/usr

The preceeding command is enough to change a temporary
installation to a fully functional installation.

This is why DESTDIR cannot be placed in rhome itself,
in prefix, or any other variable.

Please consider it for inclusion, or ask me any other
question about it.

Note that the patch does not contain a ChangeLog
entry, since R-2.2.1 does not seem to have a
ChangeLog. If you need one, the info is something
like:

2006-04-07  Claudio Fontana  <claudio at gnu.org>
        * Makefile.in (install, uninstall): add
          DESTDIR variable to support staged
          installations.

        * po/Makefile.in.in,
          doc/html/Makefile.in,
          doc/html/search/Makefile.in,
          doc/Makefile.in,
          doc/manual/Makefile.in,
          etc/Makefile.in,
          src/main/Makefile.in,
          src/nmath/standalone/Makefile.in,
          src/scripts/Makefile.in,
          src/library/Makefile.in,
          src/modules/X11/Makefile.in,
          src/modules/Makefile.in,
          src/modules/lapack/Makefile.in,
          src/modules/vfonts/Makefile.in,
          src/modules/internet/Makefile.in,
          src/include/R_ext/Makefile.in,
          src/include/Makefile.in,
          share/Makefile.in: likewise.

References for DESTDIR:

GNU coding standards:
http://www.gnu.org/prep/standards/

GNU automake manual [in case you decide to move to am]
http://www.gnu.org/software/automake/manual/automake.html

I could not test --enable-R-framework because I do not
have access to a darwin machine.

Thanks,

Claudio



	

	
		
___________________________________ 

10MB 



	

	
		
___________________________________ 


From ripley at stats.ox.ac.uk  Fri Apr  7 09:39:03 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 7 Apr 2006 08:39:03 +0100 (BST)
Subject: [Rd] prevent reassignment of function names
In-Reply-To: <59d7961d0604061549k4ee706bn7384430c55b83858@mail.gmail.com>
References: <44357024.6090804@metrumrg.com> <m21wwa1in9.fsf@ziti.local>
	<59d7961d0604061549k4ee706bn7384430c55b83858@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0604070805500.13487@gannet.stats.ox.ac.uk>

On Fri, 7 Apr 2006, Henrik Bengtsson wrote:

> On 4/6/06, Seth Falcon <sfalcon at fhcrc.org> wrote:
>> Tim Bergsma <timb at metrumrg.com> writes:
>>
>>> Hi.
>>>
>>> I'm trying to find a systematic way to prevent assignment to names of
>>> existing functions.
>>
>> An alternative would be to put your functions into an R package with a
>> namespace.  Then you won't be able to overwrite them (easily).
>
> Can even be a package without a namespace - to overwrite anything in a
> package you have to explicitly do assign() to the environment of the
> package.

I don't think the concern was actually to 'overwrite' but rather to 
redefine, which you can do by masking.  To quote the original post

   'I'm trying to find a systematic way to prevent assignment to names of
    existing functions.'

Note, `to names'.  Namespaces obviate masking of names of functions in 
your package or in base, and from other namespaces you import.

>
> Another way is to add an environment to the search path (?search) and
> add you functions to that.  Example:
>
> # Add an empty environment to the search path
> env <- attach(list(), name="myFunctions")
>
> # Define functions
> assign("foo", function(x) { cat("foo: x=", x, "\n", sep="") }, envir=env)
> assign("bar", function(x) { cat("bar: x=", x, "\n", sep="") }, envir=env)
>
> # Assign 'foo' in the global environment
> foo <- 3
>
> # Function foo() is still available in 'myFunctions'
> foo(4)
>
> If you have a myFunction.R file with function definitions, e.g.
>
> foo <- function(x) {
>  cat("foo: x=", x, "\n", sep="")
> }
>
> bar <- function(x) {
>  cat("bar: x=", x, "\n", sep="")
> }
>
> then it's a bit tricky to make source() assign objects to the
> environment.  Instead you can use sourceTo() in the R.utils package,
> e.g.
>
> sourceTo("myFunctions.R", envir=env)
>
> /Henrik
>
>> + seth
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From Peter.Ruckdeschel at uni-bayreuth.de  Fri Apr  7 12:12:32 2006
From: Peter.Ruckdeschel at uni-bayreuth.de (Peter Ruckdeschel)
Date: Fri, 07 Apr 2006 12:12:32 +0200
Subject: [Rd] setIs and method dispatch in S4 classes
Message-ID: <44363B10.9060503@uni-bayreuth.de>

Dear all,

I have a question regarding setIs and method dispatch in S4 classes:
Consider the following example:
#####################################################
## A02 "contains" A01 by setIs:
setClass("A01", representation(a="numeric",b="numeric"))
setClass("A02", representation(a="numeric",d="numeric"))
setIs("A02","A01",coerce=function(obj){new("A01", a=obj at a, b=obj at d)},
       replace=function(obj,value){new("A01", a=value at a, b=value at b)})

#only a "+" method  for A01
setMethod("+", signature=c("A01","A01"), function(e1,e2){e1 at b+e2@b})

x1=new("A02", a=1, d=2)
x2=new("A02", a=1, d=3)

x1+x2 ## 5 as expected

## now: B00 mother class to B01 and B02, and again B02 "contains" B01 by
setIs:
setClass("B00", representation(a="numeric"))
setClass("B01", representation(a="numeric",b="numeric"), contains= "B00")
setClass("B02", representation(a="numeric",d="numeric"), contains= "B00")
setIs("B02","B01",coerce=function(obj){new("B01", a=obj at a, b=obj at d)},
       replace=function(obj,value){new("B01", a=value at a, b=value at b)})

# now two "+" methods  for B00 and B01
setMethod("+", signature=c("B00","B00"), function(e1,e2){e1 at a+e2@a})
setMethod("+", signature=c("B01","B01"), function(e1,e2){e1 at b+e2@b})

x1=new("B02", a=1, d=2)
x2=new("B02", a=1, d=3)

x1+x2 ## 2 --- why?
#####################################################
    (tested on  2.3.0 alpha (2006-04-05 r37653))

I would have guessed that this again would give 5, as B02 is deeper
in the class hierarchy than B00 and the calls to setIs specifies an
unconditional
is-relation.

What is the principle then behind this dispatching mechanism?

Is there a possibility to force usage of the B01 method /without/
explicitely coercing x1,x2 to B01, i.e. interfere in the dispatching 
precedence, telling R somehow  (by particular arguments for setIs ?)  
to always use the is-relation defined by setIs first before mounting 
the hierarchy tree?

Thank you for your attention
Peter


From murdoch at stats.uwo.ca  Fri Apr  7 13:54:18 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Fri, 07 Apr 2006 07:54:18 -0400
Subject: [Rd] [R] documenting s4 methods in package
In-Reply-To: <000001c65a35$69e68780$d881d38d@lsa.adsroot.itcs.umich.edu>
References: <000001c65a35$69e68780$d881d38d@lsa.adsroot.itcs.umich.edu>
Message-ID: <443652EA.6010707@stats.uwo.ca>

There are usually two directories involved in an install:  the source 
directory and the install directory in R_HOME/library.

The INSTALL procedure builds the package (usually in place in Windows, 
I'm not sure if that's the case in Unix) and installs it into the 
install directory by copying those files necessary to use it.  REMOVE 
removes the install directory, cleaning up R_HOME/library, but not 
touching your source.

"R CMD install --clean" cleans up the files from your source directory 
instead of doing the install.  (It won't delete your source, just the 
intermediate files.)

There are a few "usually"s up there, because it is also possible to 
install from a tarball or a zip file or in place, etc.  From a tarball 
the procedure is a lot like what is described above after extracting to 
a temporary source directory; a zip is a copy of the final install 
directory, so most of the work has already been done.

Duncan Murdoch

On 4/7/2006 7:21 AM, Steven Lacey wrote:
> Yes. I am reinstalling the package, and your explanations both hit on what
> is likely going on. However, before reinstalling the package with R CMD
> INSTALL --build I call R CMD REMOVE, which I thought meant starting from
> scratch. That is, there would be no memory in the help files as to what was
> there before. I need to figure out more precisely what REMOVE is doing and
> what the --clean option will do. 
> 
> I assume there is something wrong with how I am using the package
> development system. I am neophyte on these matters and am in no position to
> evaluate how it is done. I am trying to figure out how it works, and your
> help is greatly appreciated!
> 
> Steve
> 
> 
> -----Original Message-----
> From: Prof Brian Ripley [mailto:ripley at stats.ox.ac.uk] 
> Sent: Friday, April 07, 2006 6:59 AM
> To: Steven Lacey
> Cc: 'Duncan Murdoch'
> Subject: Re: [R] documenting s4 methods in package
> 
> 
> A possible scenario:
> 
> You are re-installing a package you have not changed otherwise changed and 
> without using --clean.
> 
> The R CMD INSTALL does not need to reprocess the older help files to chm, 
> since it already has them in the package source directory.  It does not 
> have the other types except in the installation directory, which was moved 
> away unless you used --unsafe.
> 
> But you have not mentioned re-installation.
> 
> 
> On Fri, 7 Apr 2006, Prof Brian Ripley wrote:
> 
>> On Fri, 7 Apr 2006, Steven Lacey wrote:
>>
>>> Why do some functions build chm help and others do not? Is there 
>>> something in the .Rd file that specifies this?
>> `functions' never build help of any type, and nothing in the .Rd file
>> controls the conversion type.
>>
>> Which types of help are built is controlled by options of R CMD 
>> INSTALL and by the settings in MkRules.
>>
>> You will need to give us a reproducible example, but please use the 
>> R-devel
>> list for code development questions (after doing the homework the posting 
>> guide asks for).
>>
>> SInce we supply a documented process that works smoothly for 
>> installing
>> several hundred packages, please give us the credit of supplying you with
> a 
>> mature system and looking first for the problems in your own usage of it.
>>
>>
>>> Thanks,
>>> Steve
>>>
>>> -----Original Message-----
>>> From: Duncan Murdoch [mailto:murdoch at stats.uwo.ca]
>>> Sent: Tuesday, April 04, 2006 2:22 PM
>>> To: Steven Lacey
>>> Cc: 'Thomas Lumley'; r-help at stat.math.ethz.ch
>>> Subject: Re: [R] documenting s4 methods in package
>>>
>>>
>>> On 4/4/2006 1:58 PM, Steven Lacey wrote:
>>>> Thomas,
>>>>
>>>> Correction! If I remove the \seealso line the missing ~~fun~~ 
>>>> disppears (thank you!), but now "chm" appears at the end of the line 
>>>> decribing the help page building. Most lines do not have that, only 
>>>> "text htm1 latex example". What does the chm signify and how does 
>>>> one get rid of it?
>>> "chm" indicates that you have built a compiled HTML version of your 
>>> man page.  It will be shown in Windows if you ask for help after 
>>> options(chmhelp=TRUE).
>>>
>>> You can edit the MkRules file to disable production of this kind of 
>>> help page.
>>>
>>> Duncan Murdoch
>>>> Thanks,
>>>> Steve
>>>>
>>>> -----Original Message-----
>>>> From: Steven Lacey [mailto:slacey at umich.edu]
>>>> Sent: Tuesday, April 04, 2006 1:54 PM
>>>> To: 'Thomas Lumley'
>>>> Cc: 'r-help at stat.math.ethz.ch'
>>>> Subject: RE: [R] documenting s4 methods in package
>>>>
>>>>
>>>> Thomas,
>>>>
>>>> If I delete the \seealso section, I still get the same strange 
>>>> behavior. Shouldn't removing that line fix the problem?
>>>>
>>>> Thanks,
>>>> Steve
>>>>
>>>> -----Original Message-----
>>>> From: Thomas Lumley [mailto:tlumley at u.washington.edu]
>>>> Sent: Tuesday, April 04, 2006 10:13 AM
>>>> To: Steven Lacey
>>>> Cc: r-help at stat.math.ethz.ch
>>>> Subject: Re: [R] documenting s4 methods in package
>>>>
>>>>
>>>> On Tue, 4 Apr 2006, Steven Lacey wrote:
>>>>
>>>>> Hi,
>>>>>
>>>>> I have written a package that contains many s4 generic functions 
>>>>> and associated methods. I am having a lot of trouble getting R to 
>>>>> build the help pages for these generic functions without reporting, 
>>>>> "missing
>>>>> link(s): ~~fun~~, which means that it cannot find the appropriate 
>>>>> function when code in the example section of the help is run. 
>>>>> Right?
>>>> No.  It means that you still have \link{~~fun~~} in the \seealso 
>>>> section.
>>>>
>>>>  	-thomas
>>>>
>>>>
>>>>> After some playing around I can get it to build the help without 
>>>>> missing a link, but often I am not sure what I have done to correct 
>>>>> the "problem" and it takes a lot of time.
>>>>>
>>>>> For instance, I had the package build the help without missing a 
>>>>> function link. I then added a argument to two different functions 
>>>>> and updated the corresponding .rd help files and now when R build 
>>>>> the help pages it reports "missing link(s):  ~~fun~~. What is going 
>>>>> on?
>>>>>
>>>>> Below is the code from the help file and the associated s4 method.
>>>>>
>>>>> Any help would be greatly appreciated.
>>>>>
>>>>> Steve
>>>>>
>>>>> GENERIC FUNCTION AND METHODS
>>>>>
>>>>> setGeneric("getRemovedDf.OAD",function(x,y,z,simplify=TRUE,descrip=
>>>>> FA
>>>>> L
>>>>> SE){st
>>>>> andardGeneric("getRemovedDf.OAD")})
>>>>>
>>>>> setMethod("getRemovedDf.OAD","status.or.rm.v1",
>>>>>    function(x,y,z,simplify,descrip){
>>>>>        if(length(0">x at removed) <mailto:x at removed)> >0){
>>>>>            pred <- unlist(lapply(x at removed,function(x)x[1]))
>>>>>            resp <- unlist(lapply(x at removed,function(x)x[2]))
>>>>>            out  <- data.frame(pred,resp)
>>>>>            names(out) <- c(y,z)
>>>>>            return(out)
>>>>>        } else {
>>>>>            return(data.frame())
>>>>>        }
>>>>>    }
>>>>> )
>>>>>
>>>>> setMethod("getRemovedDf.OAD","sa",
>>>>>    function(x,y,z,simplify,descrip){
>>>>>        i <-
>>> unlist(lapply(x at outlier.removal,function(x)length(x at removed)))
>>>>>        if(all(i==0)){
>>>>>            return(list())
>>>>>        } else {
>>>>>            if(simplify) x at outlier.removal[seq(along=i)[i==0]]
>>>>> <mailto:x at outlier.removal[seq(along=i)[i==0]]<-NULL> <-NULL
>>>>>            tmp <-
>>>>>
> lapply(x at outlier.removal,getRemovedDf.OAD,x at predictorName,x at responseName)
>>>>>            if(descrip){
>>>>>                f <-
>>> as.data.frame(descrip[!"history"%in%names(x at descrip)])
>>>>>                return(lapply(tmp,function(x)cbind(f,x)))
>>>>>            } else {
>>>>>                return(tmp)
>>>>>            }
>>>>>        }
>>>>>    }
>>>>> )
>>>>>
>>>>>
>>>>> MAN FILE
>>>>> \name{getRemovedDf.OAD}
>>>>> \alias{getRemovedDf.OAD}
>>>>> %- Also NEED an '\alias' for EACH other topic documented here. 
>>>>> \title{ ~~function to do ... ~~ } \description{  ~~ A concise (1-5
>>>>> lines) description of what the function does. ~~ }
>>>>> \usage{
>>>>> getRemovedDf.OAD(x, y, z, simplify = TRUE, descrip=FALSE) }
>>>>> %- maybe also 'usage' for other objects documented here.
>>>>> \arguments{
>>>>>  \item{x}{ ~~Describe \code{x} here~~ }
>>>>>  \item{y}{ ~~Describe \code{y} here~~ }
>>>>>  \item{z}{ ~~Describe \code{z} here~~ }
>>>>>  \item{simplify}{ ~~Describe \code{simplify} here~~ }
>>>>>  \item{descrip}{ ~~Describe \code{descrip} here~~ }
>>>>> }
>>>>> \details{
>>>>>  ~~ If necessary, more details than the __description__  above ~~
>>>>> }
>>>>> \value{
>>>>>  ~Describe the value returned
>>>>>  If it is a LIST, use
>>>>>  \item{comp1 }{Description of 'comp1'}
>>>>>  \item{comp2 }{Description of 'comp2'}
>>>>>  ...
>>>>> }
>>>>> \references{ ~put references to the literature/web site here ~ }
>>>>> \author{ ~~who you are~~ }
>>>>> \note{ ~~further notes~~ }
>>>>>
>>>>> ~Make other sections like Warning with \section{Warning }{....} ~
>>>>>
>>>>> \seealso{ ~~objects to See Also as \code{\link{~~fun~~}}, ~~~ } 
>>>>> \examples{
>>>>> ##---- Should be DIRECTLY executable !! ----
>>>>> ##-- ==>  Define data, use random,
>>>>> ##--    or do  help(data=index)  for the standard data sets.
>>>>>
>>>>> ## The function is currently defined as 
>>>>> function(x,y,z,simplify=TRUE,descrip=FALSE){standardGeneric("getRem
>>>>> ov
>>>>> e
>>>>> dDf.OA
>>>>> D")}
>>>>> }
>>>>> \keyword{ ~kwd1 }% at least one, from doc/KEYWORDS
>>>>> \keyword{ ~kwd2 }% __ONLY ONE__ keyword per line
>>>>>
>>>>>
>>>>> 	[[alternative HTML version deleted]]
>>>>>
>>>>> ______________________________________________
>>>>> R-help at stat.math.ethz.ch mailing list 
>>>>> https://stat.ethz.ch/mailman/listinfo/r-help
>>>>> PLEASE do read the posting guide! 
>>>>> http://www.R-project.org/posting-guide.html
>>>>>
>>>> Thomas Lumley			Assoc. Professor, Biostatistics
>>>> tlumley at u.washington.edu	University of Washington, Seattle
>>>>
>>>> ______________________________________________
>>>> R-help at stat.math.ethz.ch mailing list 
>>>> https://stat.ethz.ch/mailman/listinfo/r-help
>>>> PLEASE do read the posting guide! 
>>>> http://www.R-project.org/posting-guide.html
>>> ______________________________________________
>>> R-help at stat.math.ethz.ch mailing list 
>>> https://stat.ethz.ch/mailman/listinfo/r-help
>>> PLEASE do read the posting guide!
>>> http://www.R-project.org/posting-guide.html
>>>
>>
>


From stvjc at channing.harvard.edu  Fri Apr  7 14:14:07 2006
From: stvjc at channing.harvard.edu (Vincent Carey 525-2265)
Date: Fri, 7 Apr 2006 08:14:07 -0400 (EDT)
Subject: [Rd] setIs and method dispatch in S4 classes
Message-ID: <Pine.GSO.4.58.0604070810220.29241@capecod.bwh.harvard.edu>


as a fan of S4 i had a look at this; more definitive
replies are undoubtedly to come

> ## now: B00 mother class to B01 and B02, and again B02 "contains" B01 by setIs:
> setClass("B00", representation(a="numeric"))
> setClass("B01", representation(a="numeric",b="numeric"), contains= "B00")

the direct specification of containment in the next statement
is important for the dispatch process

> setClass("B02", representation(a="numeric",d="numeric"), contains= "B00")

if we omit the containment assertion your expectations are met

setClass("B02", representation(a="numeric",d="numeric"))
setIs("B02","B01",coerce=function(obj){new("B01", a=obj at a, b=obj at d)},
       replace=function(obj,value){new("B01", a=value at a, b=value at b)})

two diagnostic steps that are illuminating are

getClass("B02")  under both approaches (with and without contains="B00"
in definition of B02 class)

and

getMethods("+")  under both approaches


From sfalcon at fhcrc.org  Fri Apr  7 16:56:56 2006
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Fri, 07 Apr 2006 07:56:56 -0700
Subject: [Rd] setIs and method dispatch in S4 classes
In-Reply-To: <44363B10.9060503@uni-bayreuth.de> (Peter Ruckdeschel's message
	of "Fri, 07 Apr 2006 12:12:32 +0200")
References: <44363B10.9060503@uni-bayreuth.de>
Message-ID: <m24q15zb5z.fsf@ziti.local>

Hi Peter,

Peter Ruckdeschel <Peter.Ruckdeschel at uni-bayreuth.de> writes:
> ## now: B00 mother class to B01 and B02, and again B02 "contains" B01 by
> setIs:
> setClass("B00", representation(a="numeric"))
> setClass("B01", representation(a="numeric",b="numeric"), contains= "B00")
> setClass("B02", representation(a="numeric",d="numeric"), contains= "B00")
> setIs("B02","B01",coerce=function(obj){new("B01", a=obj at a, b=obj at d)},
>        replace=function(obj,value){new("B01", a=value at a, b=value at b)})
>
> # now two "+" methods  for B00 and B01
> setMethod("+", signature=c("B00","B00"), function(e1,e2){e1 at a+e2@a})
> setMethod("+", signature=c("B01","B01"), function(e1,e2){e1 at b+e2@b})
>
> x1=new("B02", a=1, d=2)
> x2=new("B02", a=1, d=3)
>
> x1+x2 ## 2 --- why?

My impression from reading over the man page for setIs, is that it
isn't intended to be used to override the existing inheritance
hierarchy.  It also mentions that the return value is the extension
info as a list, so that could also be useful in understanding what
setIs is doing.  Here's the output for your example:

    Slots:
                          
    Name:        a       d
    Class: numeric numeric
    
    Extends: 
    Class "B00", directly
    Class "B01", directly, with explicit coerce

Use the contains arg of setClass to define the superclasses.  With the
contains arg, the order determines the precedence for method lookup.
But I suspect you know that already.  

> Is there a possibility to force usage of the B01 method /without/
> explicitely coercing x1,x2 to B01, i.e. interfere in the dispatching 
> precedence, telling R somehow  (by particular arguments for setIs ?)  
> to always use the is-relation defined by setIs first before mounting 
> the hierarchy tree?

Perhaps explaining a bit more about what you are trying to accomplish
will allow someone to provide a more helpful suggestion than mine :-)

If you know the inheritance structure you want before run-time, then
I'm not seeing why you wouldn't just use the contains arg.

And if you want to force certain behavior at run-time, then I don't
see what's wrong with an explicit coercion using as(foo, "bar").

But perhaps I'm missing something.

Cheers,

+ seth


From Achim.Zeileis at wu-wien.ac.at  Fri Apr  7 19:48:51 2006
From: Achim.Zeileis at wu-wien.ac.at (Achim Zeileis)
Date: Fri, 7 Apr 2006 19:48:51 +0200
Subject: [Rd] rownames for as.matrix.zoo
In-Reply-To: <A77412E534FCD248A93A81F37CC75B7A033F8D19@waxbill.africa.nedcor.net>
References: <A77412E534FCD248A93A81F37CC75B7A033F8D19@waxbill.africa.nedcor.net>
Message-ID: <20060407194851.494711e1.Achim.Zeileis@wu-wien.ac.at>

On Fri, 7 Apr 2006 16:09:53 +0200  Brandt, T. (Tobias) wrote:

> Hi
>  
> Is there a reason why as.matrix.zoo doesn't set the rownames to the
> index like as.data.frame.zoo does?

Yes, oversight, I think ;-)

Added to the devel-version of zoo. I'll try to get it out to CRAN in
the next days.
Z

> Thanks
>  
> Tobias
>  
>  
> > library(zoo)
> > x.Date <- as.Date("2003-02-01") + c(1, 3, 7, 9, 14) - 1
> > x <- zoo(matrix(1:10, nc=2), x.Date)
> > colnames(x) <- c('A','B')
> > print(x)
>            A  B 
> 2003-02-01  1  6
> 2003-02-03  2  7
> 2003-02-07  3  8
> 2003-02-09  4  9
> 2003-02-14  5 10
> > as.data.frame(x)
>            A  B
> 2003-02-01 1  6
> 2003-02-03 2  7
> 2003-02-07 3  8
> 2003-02-09 4  9
> 2003-02-14 5 10
> > as.matrix(x)
>      A  B
> [1,] 1  6
> [2,] 2  7
> [3,] 3  8
> [4,] 4  9
> [5,] 5 10
> > R.version
>          _              
> platform i386-pc-mingw32
> arch     i386           
> os       mingw32        
> system   i386, mingw32  
> status                  
> major    2              
> minor    2.0            
> year     2005           
> month    10             
> day      06             
> svn rev  35749          
> language R              
> > library(help=zoo)
> > 
>                 Information on package 'zoo'
>  
> Description:
>  
> Package:       zoo
> Version:       1.0-2
> Date:          2005-09-07
> Title:         Z's ordered observations
> Author:        Achim Zeileis, Gabor Grothendieck
> Maintainer:    Achim Zeileis <Achim.Zeileis at R-project.org
> <mailto:Achim.Zeileis at R-project.org> >
> Description:   An S3 class with methods for totally ordered indexed
> observations. It is particularly
>                aimed at irregular time series of numeric
> vectors/matrices and factors. zoo's key
>                design goals are independence of a particular
> index/date/time class and consistency
>                with with ts and base R by providing methods to extend
> standard generics.
> Depends:       R (>= 2.1.0)
> Suggests:      chron, fCalendar, its, tseries, strucchange, DAAG
> License:       GPL
> Packaged:      Thu Sep 8 13:07:59 2005; zeileis
> Built:         R 2.1.1; ; 2005-09-09 12:21:08; windows
>  
>  
> 
> ********************
> Nedbank Limited Reg No 1951/000009/06. The following link displays
> the names of the Nedbank Board of Directors and Company Secretary.
> [ http://www.nedbank.co.za/terms/DirectorsNedbank.htm ] This email is
> confidential and is intended for the addressee only. The following
> link will take you to Nedbank's legal notice.
> [ http://www.nedbank.co.za/terms/EmailDisclaimer.htm ]
> ********************
>


From ggrothendieck at gmail.com  Fri Apr  7 19:50:31 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Fri, 7 Apr 2006 13:50:31 -0400
Subject: [Rd] rownames for as.matrix.zoo
In-Reply-To: <A77412E534FCD248A93A81F37CC75B7A033F8D19@waxbill.africa.nedcor.net>
References: <A77412E534FCD248A93A81F37CC75B7A033F8D19@waxbill.africa.nedcor.net>
Message-ID: <971536df0604071050v205a650ahfc4dd3a199d13bf@mail.gmail.com>

We'll have a look at it.  Use
   as.matrix(as.data.frame(x))
as a workaround in the meantime.

On 4/7/06, Brandt, T. (Tobias) <TobiasBr at taquanta.com> wrote:
>
> Hi
>
> Is there a reason why as.matrix.zoo doesn't set the rownames to the index
> like as.data.frame.zoo does?
>
> Thanks
>
> Tobias
>
>
> > library(zoo)
> > x.Date <- as.Date("2003-02-01") + c(1, 3, 7, 9, 14) - 1
> > x <- zoo(matrix(1:10, nc=2), x.Date)
> > colnames(x) <- c('A','B')
> > print(x)
>            A  B
> 2003-02-01  1  6
> 2003-02-03  2  7
> 2003-02-07  3  8
> 2003-02-09  4  9
> 2003-02-14  5 10
> > as.data.frame(x)
>            A  B
> 2003-02-01 1  6
> 2003-02-03 2  7
> 2003-02-07 3  8
> 2003-02-09 4  9
> 2003-02-14 5 10
> > as.matrix(x)
>      A  B
> [1,] 1  6
> [2,] 2  7
> [3,] 3  8
> [4,] 4  9
> [5,] 5 10
> > R.version
>          _
> platform i386-pc-mingw32
> arch     i386
> os       mingw32
> system   i386, mingw32
> status
> major    2
> minor    2.0
> year     2005
> month    10
> day      06
> svn rev  35749
> language R
> > library(help=zoo)
> >
>                 Information on package 'zoo'
>
> Description:
>
> Package:       zoo
> Version:       1.0-2
> Date:          2005-09-07
> Title:         Z's ordered observations
> Author:        Achim Zeileis, Gabor Grothendieck
> Maintainer:    Achim Zeileis <Achim.Zeileis at R-project.org>
> Description:   An S3 class with methods for totally ordered indexed
> observations. It is particularly
>                aimed at irregular time series of numeric vectors/matrices
> and factors. zoo's key
>                design goals are independence of a particular index/date/time
> class and consistency
>                with with ts and base R by providing methods to extend
> standard generics.
> Depends:       R (>= 2.1.0)
> Suggests:      chron, fCalendar, its, tseries, strucchange, DAAG
> License:       GPL
> Packaged:      Thu Sep 8 13:07:59 2005; zeileis
> Built:         R 2.1.1; ; 2005-09-09 12:21:08; windows
>
>
> ________________________________
>
> Nedbank Limited Reg No 1951/000009/06. The following link displays the names
> of the Nedbank Board of Directors and Company Secretary.
> This email is confidential and is intended for the addressee only. The
> following link will take you to Nedbank's legal notice.
> ________________________________
>
>


From ehlers at math.ucalgary.ca  Fri Apr  7 20:17:17 2006
From: ehlers at math.ucalgary.ca (Peter Ehlers)
Date: Fri, 07 Apr 2006 12:17:17 -0600
Subject: [Rd] R-2.3.0alpha-win32: Rgui and MDI/SDI
Message-ID: <4436ACAD.1080404@math.ucalgary.ca>

I find that Rgui defaults to SDI if I specify
   MDI = yes
   toolbar = no
in Rconsole. Hope I didn't miss something in NEWS/CHANGES.

R.version.string
[1] "Version 2.3.0 alpha (2006-04-05 r37653)"
Win XP

Peter Ehlers


From murdoch at stats.uwo.ca  Fri Apr  7 20:27:22 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Fri, 07 Apr 2006 14:27:22 -0400
Subject: [Rd] R-2.3.0alpha-win32: Rgui and MDI/SDI
In-Reply-To: <4436ACAD.1080404@math.ucalgary.ca>
References: <4436ACAD.1080404@math.ucalgary.ca>
Message-ID: <4436AF0A.5020003@stats.uwo.ca>

On 4/7/2006 2:17 PM, Peter Ehlers wrote:
> I find that Rgui defaults to SDI if I specify
>    MDI = yes
>    toolbar = no
> in Rconsole. Hope I didn't miss something in NEWS/CHANGES.
> 
> R.version.string
> [1] "Version 2.3.0 alpha (2006-04-05 r37653)"
> Win XP

No, that change is not intentional.  Thanks for the report.

Duncan Murdoch


From mgleahy at alumni.uwaterloo.ca  Fri Apr  7 21:45:38 2006
From: mgleahy at alumni.uwaterloo.ca (Mike Leahy)
Date: Fri, 07 Apr 2006 15:45:38 -0400
Subject: [Rd] Compiling PL/R against R.dll in Win32/MinGW
Message-ID: <4436C162.8080106@alumni.uwaterloo.ca>

Hello list,

I've been trying to get the PostgreSQL PL/R library to compile on
windows (http://www.joeconway.com/plr/).  The author of this library
says the problem is likely because the distributed R.dll isn't compiled
as a shared dll.  Is this the case?  If so, is there any way to compile
it such that it is shared?  If that's not the case, than maybe someone
on this list has a better understanding of the errors I'm getting (below).

Thanks in advance for any suggestions.

Mike

gcc -O2 -Wall -Wmissing-prototypes -Wpointer-arith -Winline
-Wdeclaration-after-statement -Wendif-labels -fno-strict-aliasing
  -I. -Ic:/Progra~1/R/R-2.3.0alpha/include
-Ic:/Progra~1/R/R-2.3.0alpha/include -I. -Ic:/MinGW/include/server
-Ic:/MinGW/incl
ude/internal -I./src/include/port/win32 -DEXEC_BACKEND
"-IC:/msys/pgsql/lib/pgxs/src/MAKEFI~1/../../src/include/port/win32"
-Ic:/MinGW/include/server/port/win32 -Ic:/msys/src/pgsql/src/include
-Ic:/msys/src/pgsql/src/include/port/win32 -DPKGLIBDIR=\
"c:/MinGW/lib\" -DDLSUFFIX=\".dll\"  -c -o pg_rsupport.o pg_rsupport.c
dlltool --export-all  --output-def plr.def plr.o pg_conversion.o
pg_backend_support.o pg_userfuncs.o pg_rsupport.o
dllwrap  -o libplr.dll --dllname libplr.dll  --def plr.def plr.o
pg_conversion.o pg_backend_support.o pg_userfuncs.o pg_rsupp
ort.o -Lc:/Progra~1/R/R-2.3.0alpha/bin -Lc:/Progra~1/R/R-2.3.0alpha/bin
-Lc:/MinGW/lib -Lc:/MinGW/lib -lR -lpostgres
Info: resolving _pkglib_path by linking to __imp__pkglib_path (auto-import)
Info: resolving _Dynamic_library_path by linking to
__imp__Dynamic_library_path (auto-import)
plr.o(.text+0xe3):plr.c: undefined reference to `Rf_initEmbeddedR'
pg_conversion.o(.text+0x12d3):pg_conversion.c: undefined reference to
`ARR_OVERHEAD'
fu000061.o(.idata$3+0xc): undefined reference to `libpostgres_a_iname'
fu000062.o(.idata$3+0xc): undefined reference to `libpostgres_a_iname'
fu000064.o(.idata$3+0xc): undefined reference to `libpostgres_a_iname'
nmth000060.o(.idata$4+0x0): undefined reference to `_nm__pkglib_path'
nmth000063.o(.idata$4+0x0): undefined reference to
`_nm__Dynamic_library_path'
collect2: ld returned 1 exit status
c:\MinGW\bin\dllwrap.exe: c:\MinGW\bin\gcc exited with status 1
make: *** [libplr.a] Error 1


From mail at joeconway.com  Fri Apr  7 22:16:56 2006
From: mail at joeconway.com (Joe Conway)
Date: Fri, 07 Apr 2006 13:16:56 -0700
Subject: [Rd] Compiling PL/R against R.dll in Win32/MinGW
In-Reply-To: <4436C162.8080106@alumni.uwaterloo.ca>
References: <4436C162.8080106@alumni.uwaterloo.ca>
Message-ID: <4436C8B8.6020402@joeconway.com>

Mike Leahy wrote:
> Hello list,
> 
> I've been trying to get the PostgreSQL PL/R library to compile on 
> windows (http://www.joeconway.com/plr/).  The author of this library 
> says the problem is likely because the distributed R.dll isn't
> compiled as a shared dll.  Is this the case?  If so, is there any way
> to compile it such that it is shared?  If that's not the case, than
> maybe someone on this list has a better understanding of the errors
> I'm getting (below).

Just to clarify, I based my comment on this thread:
	http://tolstoy.newcastle.edu.au/R/help/03a/1690.html

which may no longer be true. I have made no specific attempt to make 
PL/R compile under Windows because I did not think it was supported. If 
R.dll can be used under Windows in the same manner as libR.so on Linux, 
I'd bee happy to hear about it.

Joe


From h.wickham at gmail.com  Fri Apr  7 23:20:01 2006
From: h.wickham at gmail.com (hadley wickham)
Date: Fri, 7 Apr 2006 16:20:01 -0500
Subject: [Rd] Should demo files be run as part of R CMD check?
Message-ID: <f8e6ff050604071420g7f97d56cn6c4fe772002f8f5f@mail.gmail.com>

I was a bit suprised to note that demo files are not run as part of R
CMD check.  This seems out of keeping with the philosophy of running
all code contained in the package (in the source, in examples etc).

Should demo files be checked as part of R CMD check?

Hadley


From tlumley at u.washington.edu  Fri Apr  7 23:33:16 2006
From: tlumley at u.washington.edu (Thomas Lumley)
Date: Fri, 7 Apr 2006 14:33:16 -0700 (PDT)
Subject: [Rd] Should demo files be run as part of R CMD check?
In-Reply-To: <f8e6ff050604071420g7f97d56cn6c4fe772002f8f5f@mail.gmail.com>
References: <f8e6ff050604071420g7f97d56cn6c4fe772002f8f5f@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0604071432190.11916@homer23.u.washington.edu>

On Fri, 7 Apr 2006, hadley wickham wrote:

> I was a bit suprised to note that demo files are not run as part of R
> CMD check.  This seems out of keeping with the philosophy of running
> all code contained in the package (in the source, in examples etc).
>
> Should demo files be checked as part of R CMD check?
>


The rationale may be that a demo is entitled to assume it is being run 
interactively.  Checking demo(tkdensity), for example, would be 
unproductive.


 	-thomas


From mgleahy at alumni.uwaterloo.ca  Fri Apr  7 23:35:10 2006
From: mgleahy at alumni.uwaterloo.ca (Mike Leahy)
Date: Fri, 07 Apr 2006 17:35:10 -0400
Subject: [Rd] Compiling PL/R against R.dll in Win32/MinGW
In-Reply-To: <4436C8B8.6020402@joeconway.com>
References: <4436C162.8080106@alumni.uwaterloo.ca>
	<4436C8B8.6020402@joeconway.com>
Message-ID: <4436DB0E.5040406@alumni.uwaterloo.ca>

Ok...well I've been hacking around with the PL/R source a bit more, and
I found that that substituting 'Rf_initEmbeddedR' with 'InitDynload'
seemed to make code compile further - this was just a total guess based
on the functions that are listed in the R.dll with dependency-walker.
Now it appears that it's an issue compiling against postgres, rather
than R.dll (see below).  Should I pursue this any further, or should I
accept that it just won't happen and give up for now?

$ R_HOME=c:/Progra~1/R/R-2.3.0alpha make -f Makefile.pgxs
-Ic:/msys/src/pgsql/src/include

sed 's,MODULE_PATHNAME,$libdir/plr,g' plr.sql.in >plr.sql
gcc -O2 -Wall -Wmissing-prototypes -Wpointer-arith -Winline
-Wdeclaration-after-statement -Wendif-labels -fno-strict-aliasing
  -I. -Ic:/Progra~1/R/R-2.3.0alpha/include
-Ic:/Progra~1/R/R-2.3.0alpha/include -I. -Ic:/MinGW/include/server
-Ic:/MinGW/incl
ude/internal -I./src/include/port/win32 -DEXEC_BACKEND
"-Ic:/msys/pgsql/lib/pgxs/src/MAKEFI~1/../../src/include/port/win32"
-Ic:/MinGW/include/server/port/win32 -Ic:/msys/pgsql/include/server
-Ic:/msys/pgsql/include/server/port/win32 -Lc:/msys/pgsql
/lib -Lc:/msys/pgsql/bin -DPKGLIBDIR=\"c:/MinGW/lib\"
-DDLSUFFIX=\".dll\"  -c -o plr.o plr.c
plr.c: In function `plr_init':
plr.c:288: warning: implicit declaration of function `InitDynload'
plr.c: In function `fetchArgNames':
plr.c:1366: warning: passing arg 7 of `deconstruct_array' from
incompatible pointer type
plr.c:1366: warning: passing arg 8 of `deconstruct_array' makes pointer
from integer without a cast
gcc -O2 -Wall -Wmissing-prototypes -Wpointer-arith -Winline
-Wdeclaration-after-statement -Wendif-labels -fno-strict-aliasing
  -I. -Ic:/Progra~1/R/R-2.3.0alpha/include
-Ic:/Progra~1/R/R-2.3.0alpha/include -I. -Ic:/MinGW/include/server
-Ic:/MinGW/incl
ude/internal -I./src/include/port/win32 -DEXEC_BACKEND
"-Ic:/msys/pgsql/lib/pgxs/src/MAKEFI~1/../../src/include/port/win32"
-Ic:/MinGW/include/server/port/win32 -Ic:/msys/pgsql/include/server
-Ic:/msys/pgsql/include/server/port/win32 -Lc:/msys/pgsql
/lib -Lc:/msys/pgsql/bin -DPKGLIBDIR=\"c:/MinGW/lib\"
-DDLSUFFIX=\".dll\"  -c -o pg_conversion.o pg_conversion.c
gcc -O2 -Wall -Wmissing-prototypes -Wpointer-arith -Winline
-Wdeclaration-after-statement -Wendif-labels -fno-strict-aliasing
  -I. -Ic:/Progra~1/R/R-2.3.0alpha/include
-Ic:/Progra~1/R/R-2.3.0alpha/include -I. -Ic:/MinGW/include/server
-Ic:/MinGW/incl
ude/internal -I./src/include/port/win32 -DEXEC_BACKEND
"-Ic:/msys/pgsql/lib/pgxs/src/MAKEFI~1/../../src/include/port/win32"
-Ic:/MinGW/include/server/port/win32 -Ic:/msys/pgsql/include/server
-Ic:/msys/pgsql/include/server/port/win32 -Lc:/msys/pgsql
/lib -Lc:/msys/pgsql/bin -DPKGLIBDIR=\"c:/MinGW/lib\"
-DDLSUFFIX=\".dll\"  -c -o pg_backend_support.o pg_backend_support.c
gcc -O2 -Wall -Wmissing-prototypes -Wpointer-arith -Winline
-Wdeclaration-after-statement -Wendif-labels -fno-strict-aliasing
  -I. -Ic:/Progra~1/R/R-2.3.0alpha/include
-Ic:/Progra~1/R/R-2.3.0alpha/include -I. -Ic:/MinGW/include/server
-Ic:/MinGW/incl
ude/internal -I./src/include/port/win32 -DEXEC_BACKEND
"-Ic:/msys/pgsql/lib/pgxs/src/MAKEFI~1/../../src/include/port/win32"
-Ic:/MinGW/include/server/port/win32 -Ic:/msys/pgsql/include/server
-Ic:/msys/pgsql/include/server/port/win32 -Lc:/msys/pgsql
/lib -Lc:/msys/pgsql/bin -DPKGLIBDIR=\"c:/MinGW/lib\"
-DDLSUFFIX=\".dll\"  -c -o pg_userfuncs.o pg_userfuncs.c
pg_userfuncs.c: In function `plr_array_push':
pg_userfuncs.c:144: warning: passing arg 9 of `array_set' makes integer
from pointer without a cast
gcc -O2 -Wall -Wmissing-prototypes -Wpointer-arith -Winline
-Wdeclaration-after-statement -Wendif-labels -fno-strict-aliasing
  -I. -Ic:/Progra~1/R/R-2.3.0alpha/include
-Ic:/Progra~1/R/R-2.3.0alpha/include -I. -Ic:/MinGW/include/server
-Ic:/MinGW/incl
ude/internal -I./src/include/port/win32 -DEXEC_BACKEND
"-Ic:/msys/pgsql/lib/pgxs/src/MAKEFI~1/../../src/include/port/win32"
-Ic:/MinGW/include/server/port/win32 -Ic:/msys/pgsql/include/server
-Ic:/msys/pgsql/include/server/port/win32 -Lc:/msys/pgsql
/lib -Lc:/msys/pgsql/bin -DPKGLIBDIR=\"c:/MinGW/lib\"
-DDLSUFFIX=\".dll\"  -c -o pg_rsupport.o pg_rsupport.c
dlltool --export-all  --output-def plr.def plr.o pg_conversion.o
pg_backend_support.o pg_userfuncs.o pg_rsupport.o
dllwrap  -o libplr.dll --dllname libplr.dll  --def plr.def plr.o
pg_conversion.o pg_backend_support.o pg_userfuncs.o pg_rsupp
ort.o -Lc:/Progra~1/R/R-2.3.0alpha/bin -Lc:/Progra~1/R/R-2.3.0alpha/bin
-Lc:/MinGW/lib -Lc:/MinGW/lib -lR -lpostgres
Info: resolving _pkglib_path by linking to __imp__pkglib_path (auto-import)
Info: resolving _Dynamic_library_path by linking to
__imp__Dynamic_library_path (auto-import)
fu000062.o(.idata$3+0xc): undefined reference to `libpostgres_a_iname'
fu000063.o(.idata$3+0xc): undefined reference to `libpostgres_a_iname'
fu000065.o(.idata$3+0xc): undefined reference to `libpostgres_a_iname'
nmth000061.o(.idata$4+0x0): undefined reference to `_nm__pkglib_path'
nmth000064.o(.idata$4+0x0): undefined reference to
`_nm__Dynamic_library_path'
collect2: ld returned 1 exit status
c:\MinGW\bin\dllwrap.exe: c:\MinGW\bin\gcc exited with status 1
make: *** [libplr.a] Error 1

Joe Conway wrote:
> Mike Leahy wrote:
>> Hello list,
>>
>> I've been trying to get the PostgreSQL PL/R library to compile on
>> windows (http://www.joeconway.com/plr/).  The author of this library
>> says the problem is likely because the distributed R.dll isn't
>> compiled as a shared dll.  Is this the case?  If so, is there any way
>> to compile it such that it is shared?  If that's not the case, than
>> maybe someone on this list has a better understanding of the errors
>> I'm getting (below).
> 
> Just to clarify, I based my comment on this thread:
>     http://tolstoy.newcastle.edu.au/R/help/03a/1690.html
> 
> which may no longer be true. I have made no specific attempt to make
> PL/R compile under Windows because I did not think it was supported. If
> R.dll can be used under Windows in the same manner as libR.so on Linux,
> I'd bee happy to hear about it.
> 
> Joe
> 
> 
>


From mail at joeconway.com  Fri Apr  7 23:59:29 2006
From: mail at joeconway.com (Joe Conway)
Date: Fri, 07 Apr 2006 14:59:29 -0700
Subject: [Rd] Compiling PL/R against R.dll in Win32/MinGW
In-Reply-To: <4436DB0E.5040406@alumni.uwaterloo.ca>
References: <4436C162.8080106@alumni.uwaterloo.ca>	<4436C8B8.6020402@joeconway.com>
	<4436DB0E.5040406@alumni.uwaterloo.ca>
Message-ID: <4436E0C1.50005@joeconway.com>

Mike Leahy wrote:
> Ok...well I've been hacking around with the PL/R source a bit more, and
> I found that that substituting 'Rf_initEmbeddedR' with 'InitDynload'
> seemed to make code compile further - this was just a total guess based
> on the functions that are listed in the R.dll with dependency-walker.
> Now it appears that it's an issue compiling against postgres, rather
> than R.dll (see below).  Should I pursue this any further, or should I
> accept that it just won't happen and give up for now?

> 
> -DDLSUFFIX=\".dll\"  -c -o plr.o plr.c
> plr.c: In function `plr_init':
> plr.c:288: warning: implicit declaration of function `InitDynload'
> plr.c: In function `fetchArgNames':
> plr.c:1366: warning: passing arg 7 of `deconstruct_array' from

This looks like you're trying to compile with PostgreSQL cvs HEAD 
(8.2devel), correct? That won't work as I've not yet adjusted PL/R to 
handle NULL elements in arrays (which is brand new in HEAD). But this is 
is now off topic here...

Getting back on topic, unless someone can tell us that R.dll or some 
other mechanism exposes the same API as the libR shared object, I'd have 
to say it is probably hopeless.

Joe


From ggrothendieck at gmail.com  Sat Apr  8 00:04:03 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Fri, 7 Apr 2006 18:04:03 -0400
Subject: [Rd] Should demo files be run as part of R CMD check?
In-Reply-To: <f8e6ff050604071420g7f97d56cn6c4fe772002f8f5f@mail.gmail.com>
References: <f8e6ff050604071420g7f97d56cn6c4fe772002f8f5f@mail.gmail.com>
Message-ID: <971536df0604071504s404d9369ua407156355532c91@mail.gmail.com>

I didn't realize this either but it might be useful in situations
where the package depends on other software which might
not be on CRAN.

On 4/7/06, hadley wickham <h.wickham at gmail.com> wrote:
> I was a bit suprised to note that demo files are not run as part of R
> CMD check.  This seems out of keeping with the philosophy of running
> all code contained in the package (in the source, in examples etc).
>
> Should demo files be checked as part of R CMD check?
>
> Hadley
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From murdoch at stats.uwo.ca  Sat Apr  8 02:24:57 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Fri, 07 Apr 2006 20:24:57 -0400
Subject: [Rd] R-2.3.0alpha-win32: Rgui and MDI/SDI
In-Reply-To: <4436ACAD.1080404@math.ucalgary.ca>
References: <4436ACAD.1080404@math.ucalgary.ca>
Message-ID: <443702D9.9050905@stats.uwo.ca>

On 4/7/2006 2:17 PM, Peter Ehlers wrote:
> I find that Rgui defaults to SDI if I specify
>    MDI = yes
>    toolbar = no
> in Rconsole. Hope I didn't miss something in NEWS/CHANGES.
> 
> R.version.string
> [1] "Version 2.3.0 alpha (2006-04-05 r37653)"
> Win XP

This turned out to be a typo in my rewrite of the Rconsole load 
function.  It's now fixed.  Thanks!

Duncan Murdoch


From roger at ysidro.econ.uiuc.edu  Sat Apr  8 17:24:14 2006
From: roger at ysidro.econ.uiuc.edu (roger koenker)
Date: Sat, 8 Apr 2006 10:24:14 -0500
Subject: [Rd] Fwd: makeconf issue on R-devel 2006-03-12 r37524
In-Reply-To: <Pine.LNX.4.64.0603141922070.784@gannet.stats.ox.ac.uk>
References: <7A5734F6-9584-49D6-933A-2F8AF93AFFBD@uiuc.edu>
	<738521DF-2528-4826-BB1C-04D143AF4BFF@uiuc.edu>
	<Pine.LNX.4.64.0603141922070.784@gannet.stats.ox.ac.uk>
Message-ID: <60B3FA2F-4268-4C99-9C1F-147DBFB881E3@ysidro.econ.uiuc.edu>

For what it is worth, I've just installed R-alpha Version 2.3.0 alpha  
(2006-04-07 r37668)
on my G5 and encountered the same problem reported below.  The same  
treatment
got  things going again.  If this reflects some idiosyncrasy in my  
setup,  my apologies....


url:    www.econ.uiuc.edu/~roger                Roger Koenker
email   rkoenker at uiuc.edu                       Department of Economics
vox:    217-333-4558                            University of Illinois
fax:    217-244-6678                            Champaign, IL 61820


On Mar 14, 2006, at 1:31 PM, Prof Brian Ripley wrote:

> On Tue, 14 Mar 2006, roger koenker wrote:
>
>> I sent the message below to r-sig-mac yesterday, but having no reply
>> I decided to explore a bit myself and found that editing:
>>
>> /Library/Frameworks/R.framework/Versions/2.3/Resources/share/make/
>> shlib.mk
>>
>> yzzy: diff shlib.mk shlib.mk~
>> 3c3
>> < include $(R_HOME)/etc/Makeconf
>> ---
>> > include $(R_HOME)/etc${R_ARCH}/Makeconf
>>
>> restored the functionality of R CMD INSTALL.
>>
>> Is this a known issue?
>
> No, and the change will break things which currently work correctly.
>
> Looks like this is something specific to how Macs install under the  
> bin/exec directory.  It likely stems from the following line in  
> INSTALL.
>
>      archs=`(cd ${R_HOME}/bin/exec; ls)`
>
> which on other systems will only contain directories for sub- 
> architectures or the R or Rgnome executables, since it says
>
>>> ** arch - Frameworks
>
>
>>
>> url:    www.econ.uiuc.edu/~roger            Roger Koenker
>> email    rkoenker at uiuc.edu            Department of Economics
>> vox:     217-333-4558                University of Illinois
>> fax:       217-244-6678                Champaign, IL 61820
>>
>>
>> Begin forwarded message:
>>
>>> From: roger koenker <rkoenker at uiuc.edu>
>>> Date: March 13, 2006 4:46:30 PM CST
>>> To: r-sig-mac at stat.math.ethz.ch
>>> Subject: makeconf issue on R-devel 2006-03-12 r37524
>>>
>>> I've just installed R-devel   Version 2.3.0 Under development
>>> (unstable) (2006-03-12 r37524)
>>> on a G5 and things went smoothly despite my gfortran configuration,
>>> (that is ./configure, make,
>>> make install was fine), but now trying to install  a source package
>>> I get:
>>>
>>> yzzy: R CMD check kuantile
>>> * checking for working latex ... OK
>>> * using log directory '/Users/roger/Projects/kuantile/ 
>>> kuantile.Rcheck'
>>> * using Version 2.3.0 Under development (unstable) (2006-03-12  
>>> r37524)
>>> * checking for file 'kuantile/DESCRIPTION' ... OK
>>> * this is package 'kuantile' version '1.00'
>>> * checking package dependencies ... OK
>>> * checking if this is a source package ... WARNING
>>> Subdirectory 'kuantile/src' contains object files.
>>> * checking whether package 'kuantile' can be installed ... ERROR
>>> Installation failed.
>>> See '/Users/roger/Projects/kuantile/kuantile.Rcheck/00install.out'
>>> for details.
>>>
>>> yzzy: more /Users/roger/Projects/kuantile/kuantile.Rcheck/
>>> 00install.out
>>> * Installing *source* package 'kuantile' ...
>>> ** libs
>>> ** arch - Frameworks
>>> /Library/Frameworks/R.framework/Resources/share/make/shlib.mk:3: /
>>> Library/Frameworks/R.fra
>>> mework/Resources/etc/Frameworks/Makeconf: No such file or directory
>>> make: *** No rule to make target `/Library/Frameworks/R.framework/
>>> Resources/etc/Frameworks
>>> /Makeconf'.  Stop.
>>> chmod: /Users/roger/Projects/kuantile/kuantile.Rcheck/kuantile/libs/
>>> Frameworks/*: No such
>>> file or directory
>>> gfortran   -fPIC -fno-common  -g -O2 -c dsel05.f -o dsel05.o
>>> gfortran   -fPIC -fno-common  -g -O2 -c kuantile.f -o kuantile.o
>>> gcc -flat_namespace -bundle -undefined suppress -L/sw/lib -L/usr/
>>> local/lib -o kuantile.so
>>> dsel05.o kuantile.o  -L/usr/local/lib/gcc/powerpc-apple-
>>> darwin8/4.0.0 -L/usr/local/lib/gcc
>>> -lgfortran -lgcc_s -lSystemStubs -lmx -lSystem -F/Library/
>>> Frameworks/R.framework/.. -fram
>>> ework R
>>> ERROR: compilation failed for package 'kuantile'
>>> ** Removing '/Users/roger/Projects/kuantile/kuantile.Rcheck/ 
>>> kuantile'
>>>
>>> isn't there something fishy with the specification of the Makeconf
>>> file in ..../etc/Frameworks???
>>>
>>> Roger
>>>
>>>
>>> url:    www.econ.uiuc.edu/~roger            Roger Koenker
>>> email    rkoenker at uiuc.edu            Department of Economics
>>> vox:     217-333-4558                University of Illinois
>>> fax:       217-244-6678                Champaign, IL 61820
>>>
>>>
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
>
> -- 
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Sat Apr  8 20:27:12 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sat, 8 Apr 2006 19:27:12 +0100 (BST)
Subject: [Rd] Fwd: makeconf issue on R-devel 2006-03-12 r37524
In-Reply-To: <60B3FA2F-4268-4C99-9C1F-147DBFB881E3@ysidro.econ.uiuc.edu>
References: <7A5734F6-9584-49D6-933A-2F8AF93AFFBD@uiuc.edu>
	<738521DF-2528-4826-BB1C-04D143AF4BFF@uiuc.edu>
	<Pine.LNX.4.64.0603141922070.784@gannet.stats.ox.ac.uk>
	<60B3FA2F-4268-4C99-9C1F-147DBFB881E3@ysidro.econ.uiuc.edu>
Message-ID: <Pine.LNX.4.64.0604081911560.24503@gannet.stats.ox.ac.uk>

On Sat, 8 Apr 2006, roger koenker wrote:

> For what it is worth, I've just installed R-alpha Version 2.3.0 alpha
> (2006-04-07 r37668)
> on my G5 and encountered the same problem reported below.  The same
> treatment
> got  things going again.  If this reflects some idiosyncrasy in my
> setup,  my apologies....

Well, no one else is reporting it, and that includes the daily checks run 
by Simon on MacOS X so it is not that no one has tested R-devel for the 
last few weeks (and Simon was involved with the design of this change).

It looks as if 'make install-R-framework' puts a link in bin/exec, which 
is not supposed to be used for other than front-ends.  I think you need to 
take this up with the MacOS X maintainers, since the problem is in their 
code, not in general R, and no one else can address it.  If the link is 
really necessary, it is INSTALL.in that needs a patch.


> url:    www.econ.uiuc.edu/~roger                Roger Koenker
> email   rkoenker at uiuc.edu                       Department of Economics
> vox:    217-333-4558                            University of Illinois
> fax:    217-244-6678                            Champaign, IL 61820
>
>
> On Mar 14, 2006, at 1:31 PM, Prof Brian Ripley wrote:
>
>> On Tue, 14 Mar 2006, roger koenker wrote:
>>
>>> I sent the message below to r-sig-mac yesterday, but having no reply
>>> I decided to explore a bit myself and found that editing:
>>>
>>> /Library/Frameworks/R.framework/Versions/2.3/Resources/share/make/
>>> shlib.mk
>>>
>>> yzzy: diff shlib.mk shlib.mk~
>>> 3c3
>>> < include $(R_HOME)/etc/Makeconf
>>> ---
>>>> include $(R_HOME)/etc${R_ARCH}/Makeconf
>>>
>>> restored the functionality of R CMD INSTALL.
>>>
>>> Is this a known issue?
>>
>> No, and the change will break things which currently work correctly.
>>
>> Looks like this is something specific to how Macs install under the
>> bin/exec directory.  It likely stems from the following line in
>> INSTALL.
>>
>>      archs=`(cd ${R_HOME}/bin/exec; ls)`
>>
>> which on other systems will only contain directories for sub-
>> architectures or the R or Rgnome executables, since it says
>>
>>>> ** arch - Frameworks
>>
>>
>>>
>>> url:    www.econ.uiuc.edu/~roger            Roger Koenker
>>> email    rkoenker at uiuc.edu            Department of Economics
>>> vox:     217-333-4558                University of Illinois
>>> fax:       217-244-6678                Champaign, IL 61820
>>>
>>>
>>> Begin forwarded message:
>>>
>>>> From: roger koenker <rkoenker at uiuc.edu>
>>>> Date: March 13, 2006 4:46:30 PM CST
>>>> To: r-sig-mac at stat.math.ethz.ch
>>>> Subject: makeconf issue on R-devel 2006-03-12 r37524
>>>>
>>>> I've just installed R-devel   Version 2.3.0 Under development
>>>> (unstable) (2006-03-12 r37524)
>>>> on a G5 and things went smoothly despite my gfortran configuration,
>>>> (that is ./configure, make,
>>>> make install was fine), but now trying to install  a source package
>>>> I get:
>>>>
>>>> yzzy: R CMD check kuantile
>>>> * checking for working latex ... OK
>>>> * using log directory '/Users/roger/Projects/kuantile/
>>>> kuantile.Rcheck'
>>>> * using Version 2.3.0 Under development (unstable) (2006-03-12
>>>> r37524)
>>>> * checking for file 'kuantile/DESCRIPTION' ... OK
>>>> * this is package 'kuantile' version '1.00'
>>>> * checking package dependencies ... OK
>>>> * checking if this is a source package ... WARNING
>>>> Subdirectory 'kuantile/src' contains object files.
>>>> * checking whether package 'kuantile' can be installed ... ERROR
>>>> Installation failed.
>>>> See '/Users/roger/Projects/kuantile/kuantile.Rcheck/00install.out'
>>>> for details.
>>>>
>>>> yzzy: more /Users/roger/Projects/kuantile/kuantile.Rcheck/
>>>> 00install.out
>>>> * Installing *source* package 'kuantile' ...
>>>> ** libs
>>>> ** arch - Frameworks
>>>> /Library/Frameworks/R.framework/Resources/share/make/shlib.mk:3: /
>>>> Library/Frameworks/R.fra
>>>> mework/Resources/etc/Frameworks/Makeconf: No such file or directory
>>>> make: *** No rule to make target `/Library/Frameworks/R.framework/
>>>> Resources/etc/Frameworks
>>>> /Makeconf'.  Stop.
>>>> chmod: /Users/roger/Projects/kuantile/kuantile.Rcheck/kuantile/libs/
>>>> Frameworks/*: No such
>>>> file or directory
>>>> gfortran   -fPIC -fno-common  -g -O2 -c dsel05.f -o dsel05.o
>>>> gfortran   -fPIC -fno-common  -g -O2 -c kuantile.f -o kuantile.o
>>>> gcc -flat_namespace -bundle -undefined suppress -L/sw/lib -L/usr/
>>>> local/lib -o kuantile.so
>>>> dsel05.o kuantile.o  -L/usr/local/lib/gcc/powerpc-apple-
>>>> darwin8/4.0.0 -L/usr/local/lib/gcc
>>>> -lgfortran -lgcc_s -lSystemStubs -lmx -lSystem -F/Library/
>>>> Frameworks/R.framework/.. -fram
>>>> ework R
>>>> ERROR: compilation failed for package 'kuantile'
>>>> ** Removing '/Users/roger/Projects/kuantile/kuantile.Rcheck/
>>>> kuantile'
>>>>
>>>> isn't there something fishy with the specification of the Makeconf
>>>> file in ..../etc/Frameworks???
>>>>
>>>> Roger
>>>>
>>>>
>>>> url:    www.econ.uiuc.edu/~roger            Roger Koenker
>>>> email    rkoenker at uiuc.edu            Department of Economics
>>>> vox:     217-333-4558                University of Illinois
>>>> fax:       217-244-6678                Champaign, IL 61820
>>>>
>>>>
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>>
>>
>> --
>> Brian D. Ripley,                  ripley at stats.ox.ac.uk
>> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
>> University of Oxford,             Tel:  +44 1865 272861 (self)
>> 1 South Parks Road,                     +44 1865 272866 (PA)
>> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From mgleahy at alumni.uwaterloo.ca  Sat Apr  8 21:17:04 2006
From: mgleahy at alumni.uwaterloo.ca (Mike Leahy)
Date: Sat, 08 Apr 2006 15:17:04 -0400
Subject: [Rd] Compiling PL/R against R.dll in Win32/MinGW
In-Reply-To: <4436E0C1.50005@joeconway.com>
References: <4436C162.8080106@alumni.uwaterloo.ca>	<4436C8B8.6020402@joeconway.com>
	<4436DB0E.5040406@alumni.uwaterloo.ca>
	<4436E0C1.50005@joeconway.com>
Message-ID: <44380C30.5060004@alumni.uwaterloo.ca>

OK - I did try this with PostgreSQL 8.1.3 and got the same results.  To
use the CVS HEAD for PostgreSQL, I did have to make a couple changes to
get it to compile, but it ends with the same results.

Joe Conway wrote:
> Mike Leahy wrote:
>> Ok...well I've been hacking around with the PL/R source a bit more, and
>> I found that that substituting 'Rf_initEmbeddedR' with 'InitDynload'
>> seemed to make code compile further - this was just a total guess based
>> on the functions that are listed in the R.dll with dependency-walker.
>> Now it appears that it's an issue compiling against postgres, rather
>> than R.dll (see below).  Should I pursue this any further, or should I
>> accept that it just won't happen and give up for now?
> 
>>
>> -DDLSUFFIX=\".dll\"  -c -o plr.o plr.c
>> plr.c: In function `plr_init':
>> plr.c:288: warning: implicit declaration of function `InitDynload'
>> plr.c: In function `fetchArgNames':
>> plr.c:1366: warning: passing arg 7 of `deconstruct_array' from
> 
> This looks like you're trying to compile with PostgreSQL cvs HEAD
> (8.2devel), correct? That won't work as I've not yet adjusted PL/R to
> handle NULL elements in arrays (which is brand new in HEAD). But this is
> is now off topic here...
> 
> Getting back on topic, unless someone can tell us that R.dll or some
> other mechanism exposes the same API as the libR shared object, I'd have
> to say it is probably hopeless.
> 
> Joe
>


From l.rubusch at web.de  Sun Apr  9 04:07:48 2006
From: l.rubusch at web.de (Lothar Rubusch)
Date: Sun, 09 Apr 2006 04:07:48 +0200
Subject: [Rd] using R in a java application
Message-ID: <1699255173@web.de>

Dear All, 

I'd like to write a little application in java wich should pass some commands and data to R and displays the results (tables and charts) in a java frame. First I wanted to work with Omegahat's SJava but had lots of issues already at the installation. 

Then I heard some rumors that SJava generally is not a very active project and runs rather buggy (that's true?). So my question is, are there alternatives to use R in a Java application, like other libraries? What would you recommend me? I appreciate any usefull links on that topic: Java and R. 

Thank you in advance,
Lothar Rubusch

_______________________________________________________________
SMS schreiben mit WEB.DE FreeMail - einfach, schnell und


From bhs2 at mevik.net  Sun Apr  9 15:15:54 2006
From: bhs2 at mevik.net (=?iso-8859-1?q?Bj=F8rn-Helge_Mevik?=)
Date: Sun, 09 Apr 2006 15:15:54 +0200
Subject: [Rd] make check of R-alpha_2006-04-08_r37675 fails: qbeta
Message-ID: <m0wtdyanzp.fsf@bar.nemo-project.org>

make check of R-alpha_2006-04-08_r37675 fails on Debian GNU/Linux 3.1 running
on an Intel P4 computer.

> version
               _                                      
platform       i686-pc-linux-gnu                      
arch           i686                                   
os             linux-gnu                              
system         i686, linux-gnu                        
status         alpha                                  
major          2                                      
minor          3.0                                    
year           2006                                   
month          04                                     
day            08                                     
svn rev        37675                                  
language       R                                      
version.string Version 2.3.0 alpha (2006-04-08 r37675)

I'm using ATLAS with the SSE2 extensions, and get the same error with ATLAS
3.2.1 (packages atlas2-* 3.2.1ln-15 in Debian) and 3.6.0 (packages atlas3-*
3.6.0-19 in Debian).  I've also tried without external BLAS (--without-blas),
but the error still occurs.

43 (0) $ ./configure
[...]
R is now configured for i686-pc-linux-gnu

  Source directory:          .
  Installation directory:    /usr/local

  C compiler:                gcc  -g -O2 -std=gnu99
  Fortran 77 compiler:       g77  -g -O2

  C++ compiler:              g++  -g -O2
  Fortran 90/95 compiler:    g77 -g -O2

  Interfaces supported:      X11, tcltk
  External libraries:        readline, BLAS(ATLAS)
  Additional capabilities:   PNG, JPEG, iconv, MBCS, NLS
  Options enabled:           R profiling

  Recommended packages:      yes

44 (0) $ make
[...]

45 (0) $ make check
[...]
running code in 'd-p-q-r-tests.R' ... OK
comparing 'd-p-q-r-tests.Rout' to './d-p-q-r-tests.Rout.save' ...777,778d776
< Warning message:
< full precision was not achieved in 'qbeta' 
make[3]: *** [d-p-q-r-tests.Rout] Error 1
[...]

46 (0) $ diff tests/d-p-q-r-tests.Rout.{save,fail}
3c3
< Version 2.3.0 alpha (2006-04-03 r37628)
---
> Version 2.3.0 alpha (2006-04-08 r37675)
791a792,793
> Warning message:
> full precision was not achieved in 'qbeta' 
1073c1075
< Time elapsed:  2.53 0.03 2.55 0 0 
---
> Time elapsed:  4.939 0.024 4.967 0 0 

The (hopefully) interesting part of tests/d-p-q-r-tests.Rout.fail:

> ## Check q*(p* ( log ), log) = identity
> All.eq(Rbeta,   qbeta    (log(Pbeta), shape1 = .8, shape2 = 2, log=TRUE))
[1] TRUE
Warning message:
full precision was not achieved in 'qbeta' 

Please let me know if there is more I can provide to help trace this!

-- 
Bj?rn-Helge Mevik


From francoisromain at free.fr  Sun Apr  9 16:49:48 2006
From: francoisromain at free.fr (francoisromain at free.fr)
Date: Sun, 09 Apr 2006 16:49:48 +0200
Subject: [Rd] using R in a java application
In-Reply-To: <1699255173@web.de>
References: <1699255173@web.de>
Message-ID: <1144594188.44391f0cd0e26@imp1-g19.free.fr>

Selon Lothar Rubusch <l.rubusch at web.de>:

> Dear All,
>
> I'd like to write a little application in java wich should pass some commands
> and data to R and displays the results (tables and charts) in a java frame.
> First I wanted to work with Omegahat's SJava but had lots of issues already
> at the installation.
>
> Then I heard some rumors that SJava generally is not a very active project
> and runs rather buggy (that's true?). So my question is, are there
> alternatives to use R in a Java application, like other libraries? What would
> you recommend me? I appreciate any usefull links on that topic: Java and R.
>
> Thank you in advance,
> Lothar Rubusch

Hi,

Give Rserve a shot :
http://stats.math.uni-augsburg.de/Rserve/

Romain


From p.dalgaard at biostat.ku.dk  Sun Apr  9 17:40:54 2006
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: 09 Apr 2006 17:40:54 +0200
Subject: [Rd] make check of R-alpha_2006-04-08_r37675 fails: qbeta
In-Reply-To: <m0wtdyanzp.fsf@bar.nemo-project.org>
References: <m0wtdyanzp.fsf@bar.nemo-project.org>
Message-ID: <x2y7yevjsp.fsf@turmalin.kubism.ku.dk>

bhs2 at mevik.net (Bj?rn-Helge Mevik) writes:

> make check of R-alpha_2006-04-08_r37675 fails on Debian GNU/Linux 3.1 running
> on an Intel P4 computer.
> 
> > version
>                _                                      
> platform       i686-pc-linux-gnu                      
> arch           i686                                   
> os             linux-gnu                              
> system         i686, linux-gnu                        
> status         alpha                                  
> major          2                                      
> minor          3.0                                    
> year           2006                                   
> month          04                                     
> day            08                                     
> svn rev        37675                                  
> language       R                                      
> version.string Version 2.3.0 alpha (2006-04-08 r37675)
> 
> I'm using ATLAS with the SSE2 extensions, and get the same error with ATLAS
> 3.2.1 (packages atlas2-* 3.2.1ln-15 in Debian) and 3.6.0 (packages atlas3-*
> 3.6.0-19 in Debian).  I've also tried without external BLAS (--without-blas),
> but the error still occurs.
> 
> 43 (0) $ ./configure
> [...]
> R is now configured for i686-pc-linux-gnu
> 
>   Source directory:          .
>   Installation directory:    /usr/local
> 
>   C compiler:                gcc  -g -O2 -std=gnu99
>   Fortran 77 compiler:       g77  -g -O2
> 
>   C++ compiler:              g++  -g -O2
>   Fortran 90/95 compiler:    g77 -g -O2
> 
>   Interfaces supported:      X11, tcltk
>   External libraries:        readline, BLAS(ATLAS)
>   Additional capabilities:   PNG, JPEG, iconv, MBCS, NLS
>   Options enabled:           R profiling
> 
>   Recommended packages:      yes
> 
> 44 (0) $ make
> [...]
> 
> 45 (0) $ make check
> [...]
> running code in 'd-p-q-r-tests.R' ... OK
> comparing 'd-p-q-r-tests.Rout' to './d-p-q-r-tests.Rout.save' ...777,778d776
> < Warning message:
> < full precision was not achieved in 'qbeta' 
> make[3]: *** [d-p-q-r-tests.Rout] Error 1
> [...]
> 
> 46 (0) $ diff tests/d-p-q-r-tests.Rout.{save,fail}
> 3c3
> < Version 2.3.0 alpha (2006-04-03 r37628)
> ---
> > Version 2.3.0 alpha (2006-04-08 r37675)
> 791a792,793
> > Warning message:
> > full precision was not achieved in 'qbeta' 
> 1073c1075
> < Time elapsed:  2.53 0.03 2.55 0 0 
> ---
> > Time elapsed:  4.939 0.024 4.967 0 0 
> 
> The (hopefully) interesting part of tests/d-p-q-r-tests.Rout.fail:
> 
> > ## Check q*(p* ( log ), log) = identity
> > All.eq(Rbeta,   qbeta    (log(Pbeta), shape1 = .8, shape2 = 2, log=TRUE))
> [1] TRUE
> Warning message:
> full precision was not achieved in 'qbeta' 
> 
> Please let me know if there is more I can provide to help trace this!

I suspect that this is related to recent changes in the zero-finder,
and that it is relatively benign. (If it is the effect that I'm
thinking of, then the warning is spurious, and it is mainly a matter
of whether we want to try to get rid of the warning or update the
.Rout.save file.)


-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From edd at debian.org  Sun Apr  9 18:52:48 2006
From: edd at debian.org (Dirk Eddelbuettel)
Date: Sun, 9 Apr 2006 11:52:48 -0500
Subject: [Rd] using R in a java application
In-Reply-To: <1144594188.44391f0cd0e26@imp1-g19.free.fr>
References: <1699255173@web.de>
	<1144594188.44391f0cd0e26@imp1-g19.free.fr>
Message-ID: <17465.15328.312368.513997@basebud.nulle.part>


On 9 April 2006 at 16:49, francoisromain at free.fr wrote:
| Selon Lothar Rubusch <l.rubusch at web.de>:
| > I'd like to write a little application in java wich should pass some commands
| > and data to R and displays the results (tables and charts) in a java frame.
| > First I wanted to work with Omegahat's SJava but had lots of issues already
| > at the installation.
| >
| > Then I heard some rumors that SJava generally is not a very active project
| > and runs rather buggy (that's true?). So my question is, are there
| > alternatives to use R in a Java application, like other libraries? What would
| > you recommend me? I appreciate any usefull links on that topic: Java and R.
| >
| > Thank you in advance,
| > Lothar Rubusch
| 
| Hi,
| 
| Give Rserve a shot :
| http://stats.math.uni-augsburg.de/Rserve/

Or maybe even rJava, also by Simon, and now on CRAN too.

Dirk

-- 
Hell, there are no rules here - we're trying to accomplish something. 
                                                  -- Thomas A. Edison


From l.rubusch at web.de  Sun Apr  9 21:13:42 2006
From: l.rubusch at web.de (Lothar Rubusch)
Date: Sun, 09 Apr 2006 21:13:42 +0200
Subject: [Rd] using R in a java application
Message-ID: <1700086108@web.de>


> -----Urspr?ngliche Nachricht-----
> Von: Dirk Eddelbuettel <edd at debian.org>
> Gesendet: 09.04.06 18:52:57
> An: francoisromain at free.fr
> CC: r-devel at r-project.org
> Betreff: Re: [Rd] using R in a java application


> 
> On 9 April 2006 at 16:49, francoisromain at free.fr wrote:
> | Selon Lothar Rubusch <l.rubusch at web.de>:
> | > I'd like to write a little application in java wich should pass some commands
> | > and data to R and displays the results (tables and charts) in a java frame.
> | > First I wanted to work with Omegahat's SJava but had lots of issues already
> | > at the installation.
> | >
> | > Then I heard some rumors that SJava generally is not a very active project
> | > and runs rather buggy (that's true?). So my question is, are there
> | > alternatives to use R in a Java application, like other libraries? What would
> | > you recommend me? I appreciate any usefull links on that topic: Java and R.
> | >
> | > Thank you in advance,
> | > Lothar Rubusch
> | 
> | Hi,
> | 
> | Give Rserve a shot :
> | http://stats.math.uni-augsburg.de/Rserve/
> 
> Or maybe even rJava, also by Simon, and now on CRAN too.
> 
> Dirk
> 
> -- 
> Hell, there are no rules here - we're trying to accomplish something. 
>                                                   -- Thomas A. Edison

Thank you all for your answers!

I started with the link to Rserve and continued to read about the JRI interface. 
The JRI sounds to me slightly simplier than RServe, perhaps I'll give both 
a try or would you recommend me rather to one of them?

Concerning RJava - well, I read that it is an interface for R applications, 
connecting only from R to Java (?). Thus I haven't read more about it.

Lothar

_______________________________________________________________
SMS schreiben mit WEB.DE FreeMail - einfach, schnell und


From ripley at stats.ox.ac.uk  Sun Apr  9 22:30:46 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sun, 9 Apr 2006 21:30:46 +0100 (BST)
Subject: [Rd] make check of R-alpha_2006-04-08_r37675 fails: qbeta
In-Reply-To: <x2y7yevjsp.fsf@turmalin.kubism.ku.dk>
References: <m0wtdyanzp.fsf@bar.nemo-project.org>
	<x2y7yevjsp.fsf@turmalin.kubism.ku.dk>
Message-ID: <Pine.LNX.4.64.0604092050370.13534@gannet.stats.ox.ac.uk>

On Sun, 9 Apr 2006, Peter Dalgaard wrote:

> bhs2 at mevik.net (Bj?rn-Helge Mevik) writes:
>
>> make check of R-alpha_2006-04-08_r37675 fails on Debian GNU/Linux 3.1 running
>> on an Intel P4 computer.
>>
>>> version
>>                _
>> platform       i686-pc-linux-gnu
>> arch           i686
>> os             linux-gnu
>> system         i686, linux-gnu
>> status         alpha
>> major          2
>> minor          3.0
>> year           2006
>> month          04
>> day            08
>> svn rev        37675
>> language       R
>> version.string Version 2.3.0 alpha (2006-04-08 r37675)
>>
>> I'm using ATLAS with the SSE2 extensions, and get the same error with ATLAS
>> 3.2.1 (packages atlas2-* 3.2.1ln-15 in Debian) and 3.6.0 (packages atlas3-*
>> 3.6.0-19 in Debian).  I've also tried without external BLAS (--without-blas),
>> but the error still occurs.
>>
>> 43 (0) $ ./configure
>> [...]
>> R is now configured for i686-pc-linux-gnu
>>
>>   Source directory:          .
>>   Installation directory:    /usr/local
>>
>>   C compiler:                gcc  -g -O2 -std=gnu99
>>   Fortran 77 compiler:       g77  -g -O2
>>
>>   C++ compiler:              g++  -g -O2
>>   Fortran 90/95 compiler:    g77 -g -O2
>>
>>   Interfaces supported:      X11, tcltk
>>   External libraries:        readline, BLAS(ATLAS)
>>   Additional capabilities:   PNG, JPEG, iconv, MBCS, NLS
>>   Options enabled:           R profiling
>>
>>   Recommended packages:      yes
>>
>> 44 (0) $ make
>> [...]
>>
>> 45 (0) $ make check
>> [...]
>> running code in 'd-p-q-r-tests.R' ... OK
>> comparing 'd-p-q-r-tests.Rout' to './d-p-q-r-tests.Rout.save' ...777,778d776
>> < Warning message:
>> < full precision was not achieved in 'qbeta'
>> make[3]: *** [d-p-q-r-tests.Rout] Error 1
>> [...]
>>
>> 46 (0) $ diff tests/d-p-q-r-tests.Rout.{save,fail}
>> 3c3
>> < Version 2.3.0 alpha (2006-04-03 r37628)
>> ---
>>> Version 2.3.0 alpha (2006-04-08 r37675)
>> 791a792,793
>>> Warning message:
>>> full precision was not achieved in 'qbeta'
>> 1073c1075
>> < Time elapsed:  2.53 0.03 2.55 0 0
>> ---
>>> Time elapsed:  4.939 0.024 4.967 0 0
>>
>> The (hopefully) interesting part of tests/d-p-q-r-tests.Rout.fail:
>>
>>> ## Check q*(p* ( log ), log) = identity
>>> All.eq(Rbeta,   qbeta    (log(Pbeta), shape1 = .8, shape2 = 2, log=TRUE))
>> [1] TRUE
>> Warning message:
>> full precision was not achieved in 'qbeta'
>>
>> Please let me know if there is more I can provide to help trace this!
>
> I suspect that this is related to recent changes in the zero-finder,
> and that it is relatively benign. (If it is the effect that I'm
> thinking of, then the warning is spurious, and it is mainly a matter
> of whether we want to try to get rid of the warning or update the
> .Rout.save file.)

I am not seeing it on my platforms (FC3 x86_64 and i686 Linux with gcc 
3.4.5 and 4.1.0, i386 Windows and Solaris, with various compilers) and the 
zero-finder changes postdate r37675 (and qbeta does not use it). I think 
several other people are testing i686 Debian, including the daiuly CRAN 
package checks ....

I suspect it is a real (and long-standing) problem of loss of accuracy 
(2.2.1 did a check but did not report the results: it seems to be a 
convergence failure looking at qbeta.c).  What compiler version is this?

ATLAS is not involved.  You'll need to trace qbeta.c.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From p.dalgaard at biostat.ku.dk  Sun Apr  9 23:24:25 2006
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: 09 Apr 2006 23:24:25 +0200
Subject: [Rd] make check of R-alpha_2006-04-08_r37675 fails: qbeta
In-Reply-To: <Pine.LNX.4.64.0604092050370.13534@gannet.stats.ox.ac.uk>
References: <m0wtdyanzp.fsf@bar.nemo-project.org>
	<x2y7yevjsp.fsf@turmalin.kubism.ku.dk>
	<Pine.LNX.4.64.0604092050370.13534@gannet.stats.ox.ac.uk>
Message-ID: <x23bgmmohi.fsf@turmalin.kubism.ku.dk>

Prof Brian Ripley <ripley at stats.ox.ac.uk> writes:

> >>   Source directory:          .
> >>   Installation directory:    /usr/local
> >>
> >>   C compiler:                gcc  -g -O2 -std=gnu99
> >>   Fortran 77 compiler:       g77  -g -O2
> >>
> >>   C++ compiler:              g++  -g -O2
> >>   Fortran 90/95 compiler:    g77 -g -O2
> >>
> >>   Interfaces supported:      X11, tcltk
> >>   External libraries:        readline, BLAS(ATLAS)
> >>   Additional capabilities:   PNG, JPEG, iconv, MBCS, NLS
> >>   Options enabled:           R profiling
> >>
> >>   Recommended packages:      yes
> >>
> >> 44 (0) $ make
> >> [...]
> >>
> >> 45 (0) $ make check
> >> [...]
> >> running code in 'd-p-q-r-tests.R' ... OK
> >> comparing 'd-p-q-r-tests.Rout' to './d-p-q-r-tests.Rout.save' ...777,778d776
> >> < Warning message:
> >> < full precision was not achieved in 'qbeta'
> >> make[3]: *** [d-p-q-r-tests.Rout] Error 1
> >> [...]
> >>
> >> 46 (0) $ diff tests/d-p-q-r-tests.Rout.{save,fail}
> >> 3c3
> >> < Version 2.3.0 alpha (2006-04-03 r37628)
> >> ---
> >>> Version 2.3.0 alpha (2006-04-08 r37675)
> >> 791a792,793
> >>> Warning message:
> >>> full precision was not achieved in 'qbeta'
> >> 1073c1075
> >> < Time elapsed:  2.53 0.03 2.55 0 0
> >> ---
> >>> Time elapsed:  4.939 0.024 4.967 0 0
> >>
> >> The (hopefully) interesting part of tests/d-p-q-r-tests.Rout.fail:
> >>
> >>> ## Check q*(p* ( log ), log) = identity
> >>> All.eq(Rbeta,   qbeta    (log(Pbeta), shape1 = .8, shape2 = 2, log=TRUE))
> >> [1] TRUE
> >> Warning message:
> >> full precision was not achieved in 'qbeta'
> >>
> >> Please let me know if there is more I can provide to help trace this!
> >
> > I suspect that this is related to recent changes in the zero-finder,
> > and that it is relatively benign. (If it is the effect that I'm
> > thinking of, then the warning is spurious, and it is mainly a matter
> > of whether we want to try to get rid of the warning or update the
> > .Rout.save file.)
> 
> I am not seeing it on my platforms (FC3 x86_64 and i686 Linux with gcc
> 3.4.5 and 4.1.0, i386 Windows and Solaris, with various compilers) and
> the zero-finder changes postdate r37675 (and qbeta does not use it). I
> think several other people are testing i686 Debian, including the
> daiuly CRAN package checks ....
> 
> I suspect it is a real (and long-standing) problem of loss of accuracy
> (2.2.1 did a check but did not report the results: it seems to be a
> convergence failure looking at qbeta.c).  What compiler version is
> this?
> 
> ATLAS is not involved.  You'll need to trace qbeta.c.

I don't see it with a current version either. What happens if you
reduce the optimization level? (I've tried both "-g" and -g "-O3").
Is that -std=gnu99 bit necessary?



-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From bhs2 at mevik.net  Sun Apr  9 23:49:07 2006
From: bhs2 at mevik.net (=?iso-8859-1?q?Bj=F8rn-Helge_Mevik?=)
Date: Sun, 09 Apr 2006 23:49:07 +0200
Subject: [Rd] make check of R-alpha_2006-04-08_r37675 fails: qbeta
In-Reply-To: <Pine.LNX.4.64.0604092050370.13534@gannet.stats.ox.ac.uk> (Brian
	Ripley's message of "Sun, 9 Apr 2006 21:30:46 +0100 (BST)")
References: <m0wtdyanzp.fsf@bar.nemo-project.org>
	<x2y7yevjsp.fsf@turmalin.kubism.ku.dk>
	<Pine.LNX.4.64.0604092050370.13534@gannet.stats.ox.ac.uk>
Message-ID: <m0sloma08c.fsf@bar.nemo-project.org>

Prof Brian Ripley wrote:

> I am not seeing it on my platforms (FC3 x86_64 and i686 Linux with gcc
> 3.4.5 and 4.1.0, i386 Windows and Solaris, with various compilers) and
> the zero-finder changes postdate r37675 (and qbeta does not use it). I
> think several other people are testing i686 Debian, including the
> daiuly CRAN package checks ....
>
> I suspect it is a real (and long-standing) problem of loss of accuracy
> (2.2.1 did a check but did not report the results: it seems to be a
> convergence failure looking at qbeta.c).  What compiler version is
> this?

1 (0) $ gcc --version
gcc (GCC) 3.3.5 (Debian 1:3.3.5-13)
Copyright (C) 2003 Free Software Foundation, Inc.
This is free software; see the source for copying conditions.  There is NO
warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.

-- 
Bj?rn-Helge Mevik


From murdoch at stats.uwo.ca  Mon Apr 10 02:21:06 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Sun, 09 Apr 2006 20:21:06 -0400
Subject: [Rd] Run package code on R shutdown?
Message-ID: <4439A4F2.3040708@stats.uwo.ca>

I'm sure I've seen this discussed before, but haven't been able to find 
it.  I'd like some package code to be run when R is shut down 
(approximately when a user's .Last function would be run), to clean up 
properly.  What is the best way to do this?

Duncan Murdoch


From henric.nilsson at statisticon.se  Mon Apr 10 09:43:56 2006
From: henric.nilsson at statisticon.se (henric.nilsson at statisticon.se)
Date: Mon, 10 Apr 2006 09:43:56 +0200 (CEST)
Subject: [Rd] Spelling of "parameter" in summary.nls(...,
	correlation = TRUE) (PR#8759)
Message-ID: <20060410074356.5D0074421D@slim.kubism.ku.dk>

Full_Name: Henric Nilsson
Version: 2.3.0 alpha (2006-04-08 r37675)
OS: Windows XP SP2
Submission from: (NULL) (212.209.13.15)


The text preceeding the correlation matrix in summary.nls(..., correlation =
TRUE) has a spelling error: parameter is spelled paraneter.

> DNase1 <- subset(DNase, Run == 1)
> fm1DNase1 <- nls(density ~ SSlogis(log(conc), Asym, xmid, scal), DNase1)
> summary(fm1DNase1, cor = TRUE)

Formula: density ~ SSlogis(log(conc), Asym, xmid, scal)

Parameters:
     Estimate Std. Error t value Pr(>|t|)    
Asym  2.34518    0.07815   30.01 2.17e-13 ***
xmid  1.48309    0.08135   18.23 1.22e-10 ***
scal  1.04146    0.03227   32.27 8.51e-14 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 

Residual standard error: 0.01919 on 13 degrees of freedom

Correlation of Paraneter Estimates:
     Asym xmid
xmid 0.99     
scal 0.90 0.91


From bhs2 at mevik.net  Mon Apr 10 10:50:27 2006
From: bhs2 at mevik.net (=?iso-8859-1?q?Bj=F8rn-Helge_Mevik?=)
Date: Mon, 10 Apr 2006 10:50:27 +0200
Subject: [Rd] make check of R-alpha_2006-04-08_r37675 fails: qbeta
In-Reply-To: <x23bgmmohi.fsf@turmalin.kubism.ku.dk> (Peter Dalgaard's
	message of "09 Apr 2006 23:24:25 +0200")
References: <m0wtdyanzp.fsf@bar.nemo-project.org>
	<x2y7yevjsp.fsf@turmalin.kubism.ku.dk>
	<Pine.LNX.4.64.0604092050370.13534@gannet.stats.ox.ac.uk>
	<x23bgmmohi.fsf@turmalin.kubism.ku.dk>
Message-ID: <m0irphak6k.fsf@bar.nemo-project.org>

Peter Dalgaard wrote:

> I don't see it with a current version either. What happens if you
> reduce the optimization level? (I've tried both "-g" and -g "-O3").
> Is that -std=gnu99 bit necessary?

My gcc is gcc (GCC) 3.3.5 (Debian 1:3.3.5-13).

I've now tried with ./configure CFLAGS="-g [-O|-O2|-O3] [-std=gnu99]",
i.e. with every combination from "-g" to "-g -O3 -std=gnu99".  The
error occured if and only if -O2 or -O3 was used.

-- 
Bj?rn-Helge Mevik


From ripley at stats.ox.ac.uk  Mon Apr 10 11:06:08 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 10 Apr 2006 10:06:08 +0100 (BST)
Subject: [Rd] make check of R-alpha_2006-04-08_r37675 fails: qbeta
In-Reply-To: <m0irphak6k.fsf@bar.nemo-project.org>
References: <m0wtdyanzp.fsf@bar.nemo-project.org>
	<x2y7yevjsp.fsf@turmalin.kubism.ku.dk>
	<Pine.LNX.4.64.0604092050370.13534@gannet.stats.ox.ac.uk>
	<x23bgmmohi.fsf@turmalin.kubism.ku.dk>
	<m0irphak6k.fsf@bar.nemo-project.org>
Message-ID: <Pine.LNX.4.64.0604100958350.2901@gannet.stats.ox.ac.uk>

Since that compiler is not even the last in the 3.3.x series, and there 
are now three later (released) gcc series, I think we have to write that 
off to an optimization bug in gcc 3.3.x.

On Mon, 10 Apr 2006, Bj?rn-Helge Mevik wrote:

> Peter Dalgaard wrote:
>
>> I don't see it with a current version either. What happens if you
>> reduce the optimization level? (I've tried both "-g" and -g "-O3").
>> Is that -std=gnu99 bit necessary?

(No, but it helps get fast C99 functions from the OS rather than slow 
substitutes.)

> My gcc is gcc (GCC) 3.3.5 (Debian 1:3.3.5-13).
>
> I've now tried with ./configure CFLAGS="-g [-O|-O2|-O3] [-std=gnu99]",
> i.e. with every combination from "-g" to "-g -O3 -std=gnu99".  The
> error occured if and only if -O2 or -O3 was used.
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From ripley at stats.ox.ac.uk  Mon Apr 10 11:16:08 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 10 Apr 2006 10:16:08 +0100 (BST)
Subject: [Rd] Branch changes at feature freeze
Message-ID: <Pine.LNX.4.64.0604101007280.3177@gannet.stats.ox.ac.uk>

Peter Dalgaard is travelling today, so this is a 'heads up' on the effects 
of having gone today into feature freeze on 2.3.0.

R-devel (the SVN trunk and the tarballs made available from ETHZ) is now 
labelled '2.4.0 Under development' and will shortly include changes 
intended for 2.4.0 (and not for 2.3.0).

The pre-release code for 2.3.0 is on the SVN branch R-2-3-patches:
daily tarballs (now labelled R-beta) remain available from

http://cran.r-project.org/src/base-prerelease/

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Mon Apr 10 11:31:01 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 10 Apr 2006 10:31:01 +0100 (BST)
Subject: [Rd] Should demo files be run as part of R CMD check?
In-Reply-To: <Pine.LNX.4.64.0604071432190.11916@homer23.u.washington.edu>
References: <f8e6ff050604071420g7f97d56cn6c4fe772002f8f5f@mail.gmail.com>
	<Pine.LNX.4.64.0604071432190.11916@homer23.u.washington.edu>
Message-ID: <Pine.LNX.4.64.0604101028200.4997@gannet.stats.ox.ac.uk>

On Fri, 7 Apr 2006, Thomas Lumley wrote:

> On Fri, 7 Apr 2006, hadley wickham wrote:
>
>> I was a bit suprised to note that demo files are not run as part of R
>> CMD check.  This seems out of keeping with the philosophy of running
>> all code contained in the package (in the source, in examples etc).
>>
>> Should demo files be checked as part of R CMD check?
>>
>
>
> The rationale may be that a demo is entitled to assume it is being run
> interactively.  Checking demo(tkdensity), for example, would be
> unproductive.

Also, it is easy for a package author to arrange to check the demos by a 
test in the package's tests directory.

The non-interactive demos in the R tarball are checked via 'make 
check-devel'.  Had we been starting for now, we would use the 'tests' 
mechanism, but on Unix-alikes the standard packages are installed and 
checked in different ways from contributed ones.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Mon Apr 10 12:16:10 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 10 Apr 2006 11:16:10 +0100 (BST)
Subject: [Rd] Run package code on R shutdown?
In-Reply-To: <4439A4F2.3040708@stats.uwo.ca>
References: <4439A4F2.3040708@stats.uwo.ca>
Message-ID: <Pine.LNX.4.64.0604101107320.22272@gannet.stats.ox.ac.uk>

On Sun, 9 Apr 2006, Duncan Murdoch wrote:

> I'm sure I've seen this discussed before, but haven't been able to find
> it.  I'd like some package code to be run when R is shut down
> (approximately when a user's .Last function would be run), to clean up
> properly.  What is the best way to do this?

The only way I know to do this is to use a finalizer, as we don't run
.Last.lib on shutdown.  (That's how RODBC does it.)

Now, as I recall this cannot be done from reg.finalizer, only from the 
C-level R_RegisterCFinalizerEx, which has an optional argument to ensure 
that the finalizer is run 'onexit'.   (I have never understood why we have 
that restriction, nor why reg.finalizer is primitive and not .Internal.)

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From Peter.Ruckdeschel at uni-bayreuth.de  Mon Apr 10 11:07:27 2006
From: Peter.Ruckdeschel at uni-bayreuth.de (Peter Ruckdeschel)
Date: Mon, 10 Apr 2006 11:07:27 +0200
Subject: [Rd] setIs and method dispatch in S4 classes
Message-ID: <443A204F.4010701@uni-bayreuth.de>

Hi Seth ,

thank you for your reply.

Seth Falcon  <sfalcon at fhcrc.org> writes:

>Peter Ruckdeschel <Peter.Ruckdeschel at uni-bayreuth.de> writes:
>  
>
>> ## now: B00 mother class to B01 and B02, and again B02 "contains" B01 by
>> setIs:
>> setClass("B00", representation(a="numeric"))
>> setClass("B01", representation(a="numeric",b="numeric"), contains= "B00")
>> setClass("B02", representation(a="numeric",d="numeric"), contains= "B00")
>> setIs("B02","B01",coerce=function(obj){new("B01", a=obj at a, b=obj at d)},
>>        replace=function(obj,value){new("B01", a=value at a, b=value at b)})
>>
>> # now two "+" methods  for B00 and B01
>> setMethod("+", signature=c("B00","B00"), function(e1,e2){e1 at a+e2@a})
>> setMethod("+", signature=c("B01","B01"), function(e1,e2){e1 at b+e2@b})
>>
>> x1=new("B02", a=1, d=2)
>> x2=new("B02", a=1, d=3)
>>
>> x1+x2 ## 2 --- why?
>>    
>>
>
>My impression from reading over the man page for setIs, is that it
>isn't intended to be used to override the existing inheritance
>hierarchy.  It also mentions that the return value is the extension
>info as a list, so that could also be useful in understanding what
>setIs is doing.  Here's the output for your example:
>
>    Slots:
>                          
>    Name:        a       d
>    Class: numeric numeric
>    
>    Extends: 
>    Class "B00", directly
>    Class "B01", directly, with explicit coerce
>
>Use the contains arg of setClass to define the superclasses.  With the
>contains arg, the order determines the precedence for method lookup.
>But I suspect you know that already.  
>  
>
Yes, I have been aware of this, thank you.

>> Is there a possibility to force usage of the B01 method /without/
>> explicitely coercing x1,x2 to B01, i.e. interfere in the dispatching 
>> precedence, telling R somehow  (by particular arguments for setIs ?)  
>> to always use the is-relation defined by setIs first before mounting 
>> the hierarchy tree?
>>    
>>
> Perhaps explaining a bit more about what you are trying to accomplish
> will allow someone to provide a more helpful suggestion than mine :-)

In the "real" context, B00 stands for a class "AbscontDistribution",
which implements absolutely continuous (a.c.) distributions. B01 is
class "Gammad" which implements Gamma distributions, and B02 is
class "Exp" which implements exponential distributions. The method
still is "+", but interpreted as convolution.

For  a.c. distributions, the default method is an FFT-based numerical
convolution algorithm, while for Gamma distributions (with the same
 scale parameter), analytic, hence much more accurate convolution
formulas are used. For "Exp", I would tell R that it also 'is' a "Gammad"
distribution by a call to setIs and use the "Gammad"-method.

Of course, I could also declare explicitly "+" methods for signatures
c("Exp", "Exp"), c("Exp", "Gammad"), and c("Gammad", "Exp")  in
which I would then use as(.) to coerce "Exp" to "Gammad"
(and again the same procedure for further Gamma-methods). 

But, this would create an extra (3 or possibly much more) methods
to dispatch, and I doubt whether this really is the preferred
solution.

> If you know the inheritance structure you want before run-time, then
> I'm not seeing why you wouldn't just use the contains arg

I do not want to use the "+"  method for "B00" for accuracy reasons
(see above).

The reason why I do not want to implement "B01" ("Gammad")
as mother class of "B02" is that

(a) the slot structure is not identical --- in the real context Gamma
and Exp use different parametrizations ---
 + rate for "Exp" (cf ?rexp) and
 + shape for "Gammad" (cf rgamma)

(b) also class "Weibull" could be used as mother class to "Exp",
and I do not want to decide whether the Weibull or the
Gamma is the (more) "legitimate" mother to Exp ;-) 

I know: 'contains' could be a vector of classes ---
c("Gammad", "Weibull")  --- but then which would be
the  correct slot structure for "Exp" the one of "Gammad"
or the one of "Weibull" ?
My context is a bad example, "Gammad", "Weibull"
do have the same slots, but more generally this /is/ an issue...
 
--- So my guess was to rather implement two 'is'-relations
( "Exp" 'is' "Gammad"  and  "Exp" 'is' "Weibull")
declared by 'setIs' , and then on run time let the
dispatching mechanism decide whether to use
a Gamma or a Weibull method.

But maybe there is a better solution ?
Any suggestions are welcome.

> And if you want to force certain behavior at run-time, then I don't
> see what's wrong with an explicit coercion using as(foo, "bar").

If you have two objects E1, E2 of class "Exp" (with the same rate)
you (or the user for whom we provide these classes)  rather want to
call "+" by     E1 + E2      than
by      as(E1, "Gammad") + as(E2,"Gammad")
...

Anyway, thank you for your help

Peter


From murdoch at stats.uwo.ca  Mon Apr 10 13:12:02 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Mon, 10 Apr 2006 07:12:02 -0400
Subject: [Rd] Branch changes at feature freeze
In-Reply-To: <Pine.LNX.4.64.0604101007280.3177@gannet.stats.ox.ac.uk>
References: <Pine.LNX.4.64.0604101007280.3177@gannet.stats.ox.ac.uk>
Message-ID: <443A3D82.902@stats.uwo.ca>

On 4/10/2006 5:16 AM, Prof Brian Ripley wrote:
> Peter Dalgaard is travelling today, so this is a 'heads up' on the effects 
> of having gone today into feature freeze on 2.3.0.
> 
> R-devel (the SVN trunk and the tarballs made available from ETHZ) is now 
> labelled '2.4.0 Under development' and will shortly include changes 
> intended for 2.4.0 (and not for 2.3.0).
> 
> The pre-release code for 2.3.0 is on the SVN branch R-2-3-patches:
> daily tarballs (now labelled R-beta) remain available from
> 
> http://cran.r-project.org/src/base-prerelease/
> 

For anyone who downloads the Windows builds: the "r-patched" build will 
stay on the old 2-2-patches branch until the release, and the "r-devel" 
build will continue to be made from the daily tarballs, now on the 
R-2-3-patches branch.  From now until the release date there won't be 
any binary builds from the trunk.

Duncan Murdoch


From edd at debian.org  Mon Apr 10 13:15:12 2006
From: edd at debian.org (Dirk Eddelbuettel)
Date: Mon, 10 Apr 2006 06:15:12 -0500
Subject: [Rd] make check of R-alpha_2006-04-08_r37675 fails: qbeta
In-Reply-To: <Pine.LNX.4.64.0604100958350.2901@gannet.stats.ox.ac.uk>
References: <m0wtdyanzp.fsf@bar.nemo-project.org>
	<x2y7yevjsp.fsf@turmalin.kubism.ku.dk>
	<Pine.LNX.4.64.0604092050370.13534@gannet.stats.ox.ac.uk>
	<x23bgmmohi.fsf@turmalin.kubism.ku.dk>
	<m0irphak6k.fsf@bar.nemo-project.org>
	<Pine.LNX.4.64.0604100958350.2901@gannet.stats.ox.ac.uk>
Message-ID: <17466.15936.420928.889119@basebud.nulle.part>


On 10 April 2006 at 10:06, Prof Brian Ripley wrote:
| Since that compiler is not even the last in the 3.3.x series, and there 
| are now three later (released) gcc series, I think we have to write that 
| off to an optimization bug in gcc 3.3.x.

Fair point, especially as you have to insist on using gcc 3.3.* on Debian:
-- 3.3.6 is the current 3.3.* one whereas Bj?rn-Helge used 3.3.5
-- 3.4.5 is the latest 3.* one supplanting 3.3.(5,6)
-- 4.0.3 is the current default
-- 4.1.0 is available too

That appears to be the same on Debian testing and unstable.

Dirk

edd at basebud:~> dpkg -l | grep gcc | cut -c -78
ii  gcc                               4.0.2-2                        The GNU C
ii  gcc-2.95                          2.95.4-22                      The GNU C
ii  gcc-3.3                           3.3.6-13                       The GNU C
ii  gcc-3.3-base                      3.3.6-13                       The GNU C
ii  gcc-3.4                           3.4.5-2                        The GNU C
ii  gcc-3.4-base                      3.4.5-2                        The GNU C
ii  gcc-4.0                           4.0.3-1                        The GNU C
ii  gcc-4.0-base                      4.0.3-1                        The GNU C
ii  gcc-4.1-base                      4.1.0-1                        The GNU C
ii  libgcc1                           4.1.0-1                        GCC suppo
edd at basebud:~>

-- 
Hell, there are no rules here - we're trying to accomplish something. 
                                                  -- Thomas A. Edison


From bhs2 at mevik.net  Mon Apr 10 14:31:12 2006
From: bhs2 at mevik.net (=?iso-8859-1?q?Bj=F8rn-Helge_Mevik?=)
Date: Mon, 10 Apr 2006 14:31:12 +0200
Subject: [Rd] make check of R-alpha_2006-04-08_r37675 fails: qbeta
In-Reply-To: <17466.15936.420928.889119@basebud.nulle.part> (Dirk
	Eddelbuettel's message of "Mon, 10 Apr 2006 06:15:12 -0500")
References: <m0wtdyanzp.fsf@bar.nemo-project.org>
	<x2y7yevjsp.fsf@turmalin.kubism.ku.dk>
	<Pine.LNX.4.64.0604092050370.13534@gannet.stats.ox.ac.uk>
	<x23bgmmohi.fsf@turmalin.kubism.ku.dk>
	<m0irphak6k.fsf@bar.nemo-project.org>
	<Pine.LNX.4.64.0604100958350.2901@gannet.stats.ox.ac.uk>
	<17466.15936.420928.889119@basebud.nulle.part>
Message-ID: <m0ek05a9yn.fsf@bar.nemo-project.org>

Dirk Eddelbuettel wrote:

> Fair point, especially as you have to insist on using gcc 3.3.* on Debian:
> -- 3.3.6 is the current 3.3.* one whereas Bj?rn-Helge used 3.3.5
> -- 3.4.5 is the latest 3.* one supplanting 3.3.(5,6)
> -- 4.0.3 is the current default
> -- 4.1.0 is available too
>
> That appears to be the same on Debian testing and unstable.
>
> Dirk
>
> edd at basebud:~> dpkg -l | grep gcc | cut -c -78
> ii  gcc                               4.0.2-2                        The GNU C
> ii  gcc-2.95                          2.95.4-22                      The GNU C
> ii  gcc-3.3                           3.3.6-13                       The GNU C
> ii  gcc-3.3-base                      3.3.6-13                       The GNU C
> ii  gcc-3.4                           3.4.5-2                        The GNU C
> ii  gcc-3.4-base                      3.4.5-2                        The GNU C
> ii  gcc-4.0                           4.0.3-1                        The GNU C
> ii  gcc-4.0-base                      4.0.3-1                        The GNU C
> ii  gcc-4.1-base                      4.1.0-1                        The GNU C
> ii  libgcc1                           4.1.0-1                        GCC suppo
> edd at basebud:~>

Hmmm... I don't `see' all those versions.  After an `aptitude update':

9 (1) $ aptitude search gcc
[...]
i   gcc                             - The GNU C compiler                       
i   gcc-2.95                        - The GNU C compiler                       
p   gcc-2.95-doc                    - Documentation for the GNU compilers (gcc,
v   gcc-3.0                         -                                          
v   gcc-3.0-base                    -                                          
v   gcc-3.0-doc                     -                                          
v   gcc-3.2                         -                                          
v   gcc-3.2-base                    -                                          
v   gcc-3.2-doc                     -                                          
i A gcc-3.3                         - The GNU C compiler                       
i A gcc-3.3-base                    - The GNU Compiler Collection (base package
p   gcc-3.3-doc                     - Documentation for the GNU compilers (gcc,
i   gcc-3.4                         - The GNU C compiler                       
i A gcc-3.4-base                    - The GNU Compiler Collection (base package
p   gcc-3.4-doc                     - Documentation for the GNU compilers (gcc,
[...]
The 3.3 is 3.3.5-13, and the 3.4 is 3.4.3-13.

My /etc/apt/sources.list is:

deb http://ftp.no.debian.org/debian/ sarge main non-free contrib
deb-src http://ftp.no.debian.org/debian/ sarge main non-free contrib
deb http://ftp.no.debian.org/debian-non-US sarge/non-US main contrib non-free
deb-src http://ftp.no.debian.org/debian-non-US sarge/non-US main contrib non-free
deb http://security.debian.org/ sarge/updates main contrib non-free

Why am I seeing older versions than you?

I just installed gcc-3.4, but gcc --version still says 3.3.5.  What
have I done (probably without knowing it) to `insist on using gcc
3.3.*', and how can I reverse that? (I have no desire to use old
compiler versions. :-)

-- 
Bj?rn-Helge Mevik


From edd at debian.org  Mon Apr 10 14:58:43 2006
From: edd at debian.org (Dirk Eddelbuettel)
Date: Mon, 10 Apr 2006 07:58:43 -0500
Subject: [Rd] make check of R-alpha_2006-04-08_r37675 fails: qbeta
In-Reply-To: <m0ek05a9yn.fsf@bar.nemo-project.org>
References: <m0wtdyanzp.fsf@bar.nemo-project.org>
	<x2y7yevjsp.fsf@turmalin.kubism.ku.dk>
	<Pine.LNX.4.64.0604092050370.13534@gannet.stats.ox.ac.uk>
	<x23bgmmohi.fsf@turmalin.kubism.ku.dk>
	<m0irphak6k.fsf@bar.nemo-project.org>
	<Pine.LNX.4.64.0604100958350.2901@gannet.stats.ox.ac.uk>
	<17466.15936.420928.889119@basebud.nulle.part>
	<m0ek05a9yn.fsf@bar.nemo-project.org>
Message-ID: <17466.22147.982663.926905@basebud.nulle.part>


On 10 April 2006 at 14:31, Bj?rn-Helge Mevik wrote:
| Dirk Eddelbuettel wrote:
| 
| > Fair point, especially as you have to insist on using gcc 3.3.* on Debian:
| > -- 3.3.6 is the current 3.3.* one whereas Bj?rn-Helge used 3.3.5
| > -- 3.4.5 is the latest 3.* one supplanting 3.3.(5,6)
| > -- 4.0.3 is the current default
| > -- 4.1.0 is available too

[...]
| Hmmm... I don't `see' all those versions.  After an `aptitude update':

(That didn't show version numbers...)

| My /etc/apt/sources.list is:
| 
| deb http://ftp.no.debian.org/debian/ sarge main non-free contrib
| deb-src http://ftp.no.debian.org/debian/ sarge main non-free contrib
| deb http://ftp.no.debian.org/debian-non-US sarge/non-US main contrib non-free
| deb-src http://ftp.no.debian.org/debian-non-US sarge/non-US main contrib non-free
| deb http://security.debian.org/ sarge/updates main contrib non-free
| 
| Why am I seeing older versions than you?

Because you point to 'sarge' which was frozen and released a year ago.
If you want something newer than Debian stable, you have to point to it.

This is all off-topic here. Please consider (subscribing and) posting to
r-sig-debian for R/Debian related matters, or debian-help for generic Debian
questions. 

Hope this helps, Dirk

-- 
Hell, there are no rules here - we're trying to accomplish something. 
                                                  -- Thomas A. Edison


From gregor.gorjanc at bfro.uni-lj.si  Mon Apr 10 15:03:47 2006
From: gregor.gorjanc at bfro.uni-lj.si (Gregor Gorjanc)
Date: Mon, 10 Apr 2006 15:03:47 +0200
Subject: [Rd] Example in ?order
Message-ID: <443A57B3.5070405@bfro.uni-lj.si>

Hello!

On R Version 2.2.1  (2005-12-20 r36812) and in SVN

The following part of the example in ?order says

     ## For character vectors we can make use of rank:
     cy <- as.character(y)
     rbind(x,y,z)[, order(x, -rank(y), z)]

But "cy" is not used in there.

-- 
Lep pozdrav / With regards,
    Gregor Gorjanc

----------------------------------------------------------------------
University of Ljubljana     PhD student
Biotechnical Faculty
Zootechnical Department     URI: http://www.bfro.uni-lj.si/MR/ggorjan
Groblje 3                   mail: gregor.gorjanc <at> bfro.uni-lj.si

SI-1230 Domzale             tel: +386 (0)1 72 17 861
Slovenia, Europe            fax: +386 (0)1 72 17 888

----------------------------------------------------------------------
"One must learn by doing the thing; for though you think you know it,
 you have no certainty until you try." Sophocles ~ 450 B.C.


From hb at maths.lth.se  Mon Apr 10 15:08:00 2006
From: hb at maths.lth.se (Henrik Bengtsson)
Date: Mon, 10 Apr 2006 15:08:00 +0200
Subject: [Rd] Run package code on R shutdown?
In-Reply-To: <4439A4F2.3040708@stats.uwo.ca>
References: <4439A4F2.3040708@stats.uwo.ca>
Message-ID: <59d7961d0604100608g8f7325dt9173e0b472d934d@mail.gmail.com>

On 4/10/06, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
> I'm sure I've seen this discussed before, but haven't been able to find
> it.  I'd like some package code to be run when R is shut down
> (approximately when a user's .Last function would be run), to clean up
> properly.  What is the best way to do this?

I tried to do this some time ago.  My conclusion then is that it
cannot be done with a guarantee, because R can exit in different ways.
 I implemented what I had an came up with an onSessionExit() method
available in R.utils.  Check that out for a start.  It modifies
.Last(), but that can be circumvented by quit(callLast=FALSE).

/Henrik

> Duncan Murdoch
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


--
Henrik Bengtsson
Mobile: +46 708 909208 (+2h UTC)


From h.wickham at gmail.com  Mon Apr 10 15:38:22 2006
From: h.wickham at gmail.com (hadley wickham)
Date: Mon, 10 Apr 2006 08:38:22 -0500
Subject: [Rd] Should demo files be run as part of R CMD check?
In-Reply-To: <Pine.LNX.4.64.0604101028200.4997@gannet.stats.ox.ac.uk>
References: <f8e6ff050604071420g7f97d56cn6c4fe772002f8f5f@mail.gmail.com>
	<Pine.LNX.4.64.0604071432190.11916@homer23.u.washington.edu>
	<Pine.LNX.4.64.0604101028200.4997@gannet.stats.ox.ac.uk>
Message-ID: <f8e6ff050604100638m6688410fxa1765fa47e7eab18@mail.gmail.com>

> > The rationale may be that a demo is entitled to assume it is being run
> > interactively.  Checking demo(tkdensity), for example, would be
> > unproductive.
>
> Also, it is easy for a package author to arrange to check the demos by a
> test in the package's tests directory.

Thanks for your comments - I hadn't considered the case of interactive
demos, and as you say it is easy enough to add these checks by using a
test in the tests directory.    Would it be helpful to provide a short
note to this effect in writing R extensions?  I would be happy to
provide a diff against the latest source.

Hadley


From murdoch at stats.uwo.ca  Mon Apr 10 15:48:10 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Mon, 10 Apr 2006 09:48:10 -0400
Subject: [Rd] Run package code on R shutdown?
In-Reply-To: <Pine.LNX.4.64.0604101107320.22272@gannet.stats.ox.ac.uk>
References: <4439A4F2.3040708@stats.uwo.ca>
	<Pine.LNX.4.64.0604101107320.22272@gannet.stats.ox.ac.uk>
Message-ID: <443A621A.4070803@stats.uwo.ca>

On 4/10/2006 6:16 AM, Prof Brian Ripley wrote:
> On Sun, 9 Apr 2006, Duncan Murdoch wrote:
> 
>> I'm sure I've seen this discussed before, but haven't been able to find
>> it.  I'd like some package code to be run when R is shut down
>> (approximately when a user's .Last function would be run), to clean up
>> properly.  What is the best way to do this?
> 
> The only way I know to do this is to use a finalizer, as we don't run
> .Last.lib on shutdown.  (That's how RODBC does it.)
> 
> Now, as I recall this cannot be done from reg.finalizer, only from the 
> C-level R_RegisterCFinalizerEx, which has an optional argument to ensure 
> that the finalizer is run 'onexit'.   (I have never understood why we have 
> that restriction, nor why reg.finalizer is primitive and not .Internal.)

Thanks!

Duncan Murdoch


From hb at maths.lth.se  Mon Apr 10 15:54:56 2006
From: hb at maths.lth.se (Henrik Bengtsson)
Date: Mon, 10 Apr 2006 15:54:56 +0200
Subject: [Rd] get(name,
	envir=envir) : formal argument "envir" matched by multiple actual
	arguments
Message-ID: <59d7961d0604100654h4bacce62jab029bba3f843746@mail.gmail.com>

Hi,

very sporadic and non-reproducible, I get the following type of errors:

Error in get(name, envir = envir) : formal argument "envir" matched by
multiple actual arguments

Error in exists(cacheName, envir = envir, inherit = FALSE) : formal
argument "envir" matched by multiple actual arguments

Error in paste(..., sep = sep) : formal argument "sep" matched by
multiple actual arguments

I cannot see how these errors can occur. Note, in the third example
"..." does not contain a 'sep' (or an argument with the same prefix).

The thing is that it does not happen all the time and if I just re-run
my code it works fine again.  What I can remember, I've seen this
since about R v2.0.0 or so.  My current version is Rv 2.3.0 alpha
(2006-04-02 r37626) on WinXP.  It has been to rare to be able to
troubleshoot it and I cannot reproduce it more than running a script
for hours.  If I rename the variable to say,

envir2 <- envir
get(name, envir=envir2)

the problem seems to go away, i.e. it is not frequent enough to observe it.

Has anyone else seen this?

/Henrik


From jmc at r-project.org  Mon Apr 10 15:53:35 2006
From: jmc at r-project.org (John Chambers)
Date: Mon, 10 Apr 2006 09:53:35 -0400
Subject: [Rd] setIs and method dispatch in S4 classes
In-Reply-To: <443A204F.4010701@uni-bayreuth.de>
References: <443A204F.4010701@uni-bayreuth.de>
Message-ID: <443A635F.2040700@r-project.org>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20060410/caff195a/attachment.pl 

From sfalcon at fhcrc.org  Mon Apr 10 17:10:08 2006
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Mon, 10 Apr 2006 08:10:08 -0700
Subject: [Rd] setIs and method dispatch in S4 classes
In-Reply-To: <443A635F.2040700@r-project.org> (John Chambers's message of "Mon,
	10 Apr 2006 09:53:35 -0400")
References: <443A204F.4010701@uni-bayreuth.de> <443A635F.2040700@r-project.org>
Message-ID: <m2fyklqxf3.fsf@ziti.local>

Hi John,

I found your comments helpful, even though this isn't _my_ question.
But now I have one of my own :-)

John Chambers <jmc at r-project.org> writes:
>>Of course, I could also declare explicitly "+" methods for signatures
>>c("Exp", "Exp"), c("Exp", "Gammad"), and c("Gammad", "Exp")  in
>>which I would then use as(.) to coerce "Exp" to "Gammad"
>> (and again the same procedure for further Gamma-methods). 
>>
>>But, this would create an extra (3 or possibly much more) methods
>>to dispatch, and I doubt whether this really is the preferred
>>solution.
>>  
>>
> Why not?  And you can avoid some of the extra methods by defining a
> virtual class that is the union of the classes for which you want the
> new methods.
>
> Something like (untested code!)
>
> setClassUnion("analyticConvolution", c("Exp", "Gammad"))
> setMethod("+", c("analyticConvolution", "analyticConvolution"),
> ....)

Why class union here and not an abstract superclass?  

If you "own" the Exp and Gammad classes, would an abstract superclass
work as well?  I think so.

However, if you don't own the Exp and Gammad classes, I can see that
the class union approach allows you the flexibility of defining a
superclass post-hoc.

I guess I have the sense that class unions are fancy/tricky (a number
of popular languages don't have that concept, AFAIK).  That isn't a
reason not to use them in a langauge that does support them, of
course.  

It is an interesting design question.  On the one hand, one could
argue for abstract superclasses when possible because they are "less
tricky" (and you need them when you want to share slots).  On the
other hand, the class union approach provides a more loosely coupled
design since members of the union don't have to know about each other.

Hmm, I think I understand class unions a lot better already.  Thanks.
If I'm terribly off-track, please let me know.  

+ seth


From hb at maths.lth.se  Mon Apr 10 19:37:54 2006
From: hb at maths.lth.se (Henrik Bengtsson)
Date: Mon, 10 Apr 2006 19:37:54 +0200
Subject: [Rd] Suggestions to speed up median() and has.na()
Message-ID: <59d7961d0604101037x3b223ct15de31fc2cfdf790@mail.gmail.com>

Hi,

I've got two suggestions how to speed up median() about 50%.  For all
iterative methods calling median() in the loops this has a major
impact.  The second suggestion will apply to other methods too.

This is what the functions look like today:

> median
function (x, na.rm = FALSE)
{
    if (is.factor(x) || mode(x) != "numeric")
        stop("need numeric data")
    if (na.rm)
        x <- x[!is.na(x)]
    else if (any(is.na(x)))
        return(NA)
    n <- length(x)
    if (n == 0)
        return(NA)
    half <- (n + 1)/2
    if (n%%2 == 1) {
        sort(x, partial = half)[half]
    }
    else {
        sum(sort(x, partial = c(half, half + 1))[c(half, half +
            1)])/2
    }
}
<environment: namespace:stats>

Suggestion 1:
Replace the sort() calls with the .Internal(psort(x, partial)).   This
will avoid unnecessary overhead, especially an expensive second check
for NAs using any(is.na(x)).  Simple benchmarking with

x <- rnorm(10e6)
system.time(median(x))/system.time(median2(x))

where median2() is the function with the above replacements, gives
about 20-25% speed up.

Suggestion 2:
Create a has.na(x) function to replace any(is.na(x)) that returns TRUE
as soon as a NA value is detected.  In the best case it returns after
the first index with TRUE, in the worst case it returns after the last
index N with FALSE.  The cost for is.na(x) is always O(N), and any()
in the best case O(1) and in the worst case O(N) (if any() is
implemented as I hope).  An has.na() function would be very useful
elsewhere too.

An poor mans alternative to (2), is to have a third alternative to
'na.rm', say, NA, which indicates that we know that there are no NAs
in 'x'.

The original median() is approx 50% slower (naive benchmarking) than a
version with the above two improvements, if passing a large 'x' with
no NAs;

median2 <- function (x, na.rm = FALSE) {
    if (is.factor(x) || mode(x) != "numeric")
        stop("need numeric data")

    if (is.na(na.rm)) {
    } else if (na.rm)
        x <- x[!is.na(x)]
    else if (any(is.na(x)))
        return(NA)

    n <- length(x)
    if (n == 0)
        return(NA)
    half <- (n + 1)/2
    if (n%%2 == 1) {
        .Internal(psort(x, half))[half]
    }
    else {
        sum(.Internal(psort(x, c(half, half + 1)))[c(half, half + 1)])/2
    }
}

x <- rnorm(10e5)
K <- 10
t0 <- system.time({
  for (kk in 1:K)
    y <- median(x);
})
print(t0)  # [1] 1.82 0.14 1.98   NA   NA
t1 <- system.time({
  for (kk in 1:K)
    y <- median2(x, na.rm=NA);
})
print(t1)  # [1] 1.25 0.06 1.34   NA   NA
print(t0/t1)  # [1] 1.456000 2.333333 1.477612       NA       NA

BTW, without having checked the source code, it looks like is.na() is
unnecessarily slow; is.na(sum(x)) is much faster than any(is.na(x)) on
a vector without NAs.  On the other hand, is.na(sum(x)) becomes
awfully slow if 'x' contains NAs.

/Henrik


From thomas.friedrichsmeier at gmx.de  Mon Apr 10 21:14:43 2006
From: thomas.friedrichsmeier at gmx.de (thomas.friedrichsmeier at gmx.de)
Date: Mon, 10 Apr 2006 21:14:43 +0200 (CEST)
Subject: [Rd] install.packages on unix / su (PR#8760)
Message-ID: <20060410191443.6DD314421F@slim.kubism.ku.dk>

Full_Name: Thomas Friedrichsmeier
Version: R 2.2.1
OS: Debian / Linux
Submission from: (NULL) (84.60.123.243)


Wishlist item:

There is a small problem using intall.packages() (and update.packages()):
Typically I want to install packages for system-wide use, not in a user
directory. Obviously this does not work without superuser rights.
What I would like to be able to do is to specify a "become root" command to use
in install.packages (). Probably this would be done using an extra argument to
install.packages () and update.packages ():

install.packages ([...], install.wrapper=NULL)

The argument value I would typically want to supply on my system (running in a
KDE Session) would be: install.wrapper="kdesu --" . I.e. I would like to run the
R CMD INSTALL command through kdesu.

Technically it would basically function like this:

Instead of

cmd0 <- paste(file.path(R.home("bin"),"R"), "CMD INSTALL")

in install.packages (), it would read

cmd0 <- paste(install.wrapper, file.path(R.home("bin"),"R"), "CMD INSTALL")

This feature would save me a lot of small hazzles.


From jmc at r-project.org  Mon Apr 10 21:15:34 2006
From: jmc at r-project.org (John Chambers)
Date: Mon, 10 Apr 2006 15:15:34 -0400
Subject: [Rd] setIs and method dispatch in S4 classes
In-Reply-To: <m2fyklqxf3.fsf@ziti.local>
References: <443A204F.4010701@uni-bayreuth.de> <443A635F.2040700@r-project.org>
	<m2fyklqxf3.fsf@ziti.local>
Message-ID: <443AAED6.9010704@r-project.org>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20060410/c6e4b726/attachment.pl 

From Peter.Ruckdeschel at uni-bayreuth.de  Mon Apr 10 21:22:01 2006
From: Peter.Ruckdeschel at uni-bayreuth.de (Peter Ruckdeschel)
Date: Mon, 10 Apr 2006 21:22:01 +0200
Subject: [Rd] setIs and method dispatch in S4 classes
Message-ID: <443AB059.1050808@uni-bayreuth.de>

Hi Seth and John,

Thank you for your helpful responses,

>John Chambers <jmc at r-project.org> writes:
>>From your description of the application, it sounds like you would be
>>better off just forcing "+" to behave as you want.  Using inheritance is
>>a much more powerful mechanism & can introduce results you don't want,
>>as it seems to have in this case.
>>
>>An important point about using inheritance is that the subclass is a
>>asserted to be substitutable for the superclass for ALL purposes.  This
>>applies whether using "contains=" or  setIs().

I am not sure whether I got the meaning of "substitutable for the
superclass for ALL purposes" :

In the application I sketched, any  Exp(rate = lambda) distribution
really /is/ a Gammad(shape = 1, scale = 1/lambda) distribution; 
so my understanding is that "Exp" is substitutable for "Gammad"
for ALL purposes.

"Gammad" was not designed to be the motherclass to "Exp" right
from the beginning because the same 'is'-relation also applies to
"Weibull": any Exp(rate = lambda) distribution /is/ a
Weibull(shape = 1, scale = 1/lambda) distribution.

Does "substitutable for the superclass for ALL purposes"
mean 'without ambiguity' (as might enter through Weibull/Gammad)?

>>When the focus is on a particular function, it's usually better to
>>implement methods for that function, maybe along with setAs()
>>methods--not setIs().

You mean I should not leave the coercion decision up to the dispatching
mechanism?

>>It seems likely that such a solution would be cleaner in design, not to
>>mention that it would likely work.  (see also suggestion below)

Yes, your indication does work; thank you!
 
>>Peter Ruckdeschel <peter.ruckdeschel at uni-bayreuth.de> writes:
>>>Of course, I could also declare explicitly "+" methods for signatures
>>>c("Exp", "Exp"), c("Exp", "Gammad"), and c("Gammad", "Exp") in
>>>which I would then use as(.) to coerce "Exp" to "Gammad"
>>> (and again the same procedure for further Gamma-methods).
>>>
>>>But, this would create an extra (3 or possibly much more) methods
>>>to dispatch, and I doubt whether this really is the preferred
>>>solution.
>>>
>> Why not?

It simply did not seem to me elegant to have three calls to
setMethod() doing more or less the same thing.
I thought that, as elegant as R solutions from the R core are
most times, there should be some mechanism to avoid this
threefold code---and in fact you indicated how to---
thank you!

>> And you can avoid some of the extra methods by defining a
>> virtual class that is the union of the classes for which you
>> want the new methods.
>>
>> Something like (untested code!)
>>
>> setClassUnion("analyticConvolution", c("Exp", "Gammad"))
>> setMethod("+", c("analyticConvolution", "analyticConvolution"),
>> ....)

Seth Falcon <sfalcon at fhcrc.org> writes:
> Why class union here and not an abstract superclass?

Am I right: the class generated by setClassUnion() does not
enter the inheritance tree / mechanism?

setClassUnion()---at least in my case---solves the problem;
thank you again.

[snip]

Peter


From edd at debian.org  Mon Apr 10 21:35:19 2006
From: edd at debian.org (Dirk Eddelbuettel)
Date: Mon, 10 Apr 2006 14:35:19 -0500
Subject: [Rd] install.packages on unix / su (PR#8760)
In-Reply-To: <20060410191443.6DD314421F@slim.kubism.ku.dk>
References: <20060410191443.6DD314421F@slim.kubism.ku.dk>
Message-ID: <17466.45943.552655.989560@basebud.nulle.part>


On 10 April 2006 at 21:14, thomas.friedrichsmeier at gmx.de wrote:
| Full_Name: Thomas Friedrichsmeier
| Version: R 2.2.1
| OS: Debian / Linux
| Submission from: (NULL) (84.60.123.243)
| 
| 
| Wishlist item:
| 
| There is a small problem using intall.packages() (and update.packages()):
| Typically I want to install packages for system-wide use, not in a user
| directory. Obviously this does not work without superuser rights.

One can see this problem as a local system management issue for which another
possible answer is to add you (and/or the user users installing R packages)
to, say, group 'admin' and to make /usr/local/lib/R of group admin and
group-writeable.  Or create a custom group radmin. Or ...

Dirk

| What I would like to be able to do is to specify a "become root" command to use
| in install.packages (). Probably this would be done using an extra argument to
| install.packages () and update.packages ():
| 
| install.packages ([...], install.wrapper=NULL)
| 
| The argument value I would typically want to supply on my system (running in a
| KDE Session) would be: install.wrapper="kdesu --" . I.e. I would like to run the
| R CMD INSTALL command through kdesu.
| 
| Technically it would basically function like this:
| 
| Instead of
| 
| cmd0 <- paste(file.path(R.home("bin"),"R"), "CMD INSTALL")
| 
| in install.packages (), it would read
| 
| cmd0 <- paste(install.wrapper, file.path(R.home("bin"),"R"), "CMD INSTALL")
| 
| This feature would save me a lot of small hazzles.
| 
| ______________________________________________
| R-devel at r-project.org mailing list
| https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Hell, there are no rules here - we're trying to accomplish something. 
                                                  -- Thomas A. Edison


From thomas.friedrichsmeier at gmx.de  Mon Apr 10 22:30:23 2006
From: thomas.friedrichsmeier at gmx.de (Thomas Friedrichsmeier)
Date: Mon, 10 Apr 2006 22:30:23 +0200
Subject: [Rd] install.packages on unix / su (PR#8760)
In-Reply-To: <17466.45943.552655.989560@basebud.nulle.part>
References: <20060410191443.6DD314421F@slim.kubism.ku.dk>
	<17466.45943.552655.989560@basebud.nulle.part>
Message-ID: <200604102230.23476.thomas.friedrichsmeier@gmx.de>

> | Wishlist item:
> |
> | There is a small problem using intall.packages() (and update.packages()):
> | Typically I want to install packages for system-wide use, not in a user
> | directory. Obviously this does not work without superuser rights.
>
> One can see this problem as a local system management issue for which
> another possible answer is to add you (and/or the user users installing R
> packages) to, say, group 'admin' and to make /usr/local/lib/R of group
> admin and group-writeable.  Or create a custom group radmin. Or ...

It's about convenience, no more, no less, and so it's a wishlist item, no 
more, and no less.
I don't think the case of a non-root user working on a de-facto single user 
system is too uncommon on linux. It's why tools like kdesu exist in the first 
place. Unless there are strong reasons not to (and there may well be), I 
think adding some convenience option for this particular case may well be 
worth while.

Regards
Thomas


-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 191 bytes
Desc: not available
Url : https://stat.ethz.ch/pipermail/r-devel/attachments/20060410/43733244/attachment.bin 

From tlumley at u.washington.edu  Tue Apr 11 01:22:20 2006
From: tlumley at u.washington.edu (Thomas Lumley)
Date: Mon, 10 Apr 2006 16:22:20 -0700 (PDT)
Subject: [Rd] Suggestions to speed up median() and has.na()
In-Reply-To: <59d7961d0604101037x3b223ct15de31fc2cfdf790@mail.gmail.com>
References: <59d7961d0604101037x3b223ct15de31fc2cfdf790@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0604101551440.19159@homer24.u.washington.edu>

On Mon, 10 Apr 2006, Henrik Bengtsson wrote:

> Hi,
>
> I've got two suggestions how to speed up median() about 50%.  For all
> iterative methods calling median() in the loops this has a major
> impact.  The second suggestion will apply to other methods too.

I'm surprised this has a major impact -- in your example it takes much 
longer to generate the ten million numbers than to find the median.

> Suggestion 1:
> Replace the sort() calls with the .Internal(psort(x, partial)).   This
> will avoid unnecessary overhead, especially an expensive second check
> for NAs using any(is.na(x)).  Simple benchmarking with
>
> x <- rnorm(10e6)
> system.time(median(x))/system.time(median2(x))
>
> where median2() is the function with the above replacements, gives
> about 20-25% speed up.

There's something that seems a bit undesirable about having median() call 
the .Internal function for sort().

> Suggestion 2:
> Create a has.na(x) function to replace any(is.na(x)) that returns TRUE
> as soon as a NA value is detected.  In the best case it returns after
> the first index with TRUE, in the worst case it returns after the last
> index N with FALSE.  The cost for is.na(x) is always O(N), and any()
> in the best case O(1) and in the worst case O(N) (if any() is
> implemented as I hope).  An has.na() function would be very useful
> elsewhere too.

This sounds useful (though it has missed the deadline for 2.3.0).

It won't help if the typical case is no missing values, as you suggest, 
but it will be faster when there are missing values.

> BTW, without having checked the source code, it looks like is.na() is
> unnecessarily slow; is.na(sum(x)) is much faster than any(is.na(x)) on
> a vector without NAs.  On the other hand, is.na(sum(x)) becomes
> awfully slow if 'x' contains NAs.
>

I don't think  it is unnecessarily slow.  It has to dispatch methods and 
it has to make sure that matrix structure is preserved.  After that the 
code is just

     case REALSXP:
         for (i = 0; i < n; i++)
             LOGICAL(ans)[i] = ISNAN(REAL(x)[i]);
         break;

and it's hard to see how that can be improved. It does suggest that a 
faster anyNA() function would have to not be generic.


 	-thomas

Thomas Lumley			Assoc. Professor, Biostatistics
tlumley at u.washington.edu	University of Washington, Seattle


From bill at insightful.com  Tue Apr 11 01:42:55 2006
From: bill at insightful.com (Bill Dunlap)
Date: Mon, 10 Apr 2006 16:42:55 -0700 (PDT)
Subject: [Rd] Suggestions to speed up median() and has.na()
In-Reply-To: <Pine.LNX.4.64.0604101551440.19159@homer24.u.washington.edu>
References: <59d7961d0604101037x3b223ct15de31fc2cfdf790@mail.gmail.com>
	<Pine.LNX.4.64.0604101551440.19159@homer24.u.washington.edu>
Message-ID: <Pine.GSO.4.56.0604101633370.21795@octopus>

On Mon, 10 Apr 2006, Thomas Lumley wrote:

> On Mon, 10 Apr 2006, Henrik Bengtsson wrote:
>
> > Hi,
> >
> > I've got two suggestions how to speed up median() about 50%.  For all
> > iterative methods calling median() in the loops this has a major
> > impact.  The second suggestion will apply to other methods too.
>
> > Suggestion 2:
> > Create a has.na(x) function to replace any(is.na(x)) that returns TRUE
> > as soon as a NA value is detected.  In the best case it returns after
> > the first index with TRUE, in the worst case it returns after the last
> > index N with FALSE.  The cost for is.na(x) is always O(N), and any()
> > in the best case O(1) and in the worst case O(N) (if any() is
> > implemented as I hope).  An has.na() function would be very useful
> > elsewhere too.
>
> This sounds useful (though it has missed the deadline for 2.3.0).
>
> It won't help if the typical case is no missing values, as you suggest,
> but it will be faster when there are missing values.

Splus has such a function, but it is called anyMissing().  In the
interests of interoperability it would be nice if R used that name.
(I did not choose the name, but that is what it is.)

The following experiment using Splus seems to indicate the speedup has
less to do with stopping at the first NA than it does with not
making/filling/copying/whatever the big vector of logicals that is.na
returns.

   > # NA near start of list of 10 million integers
   > { z<-replace(1:1e7,2,NA); unix.time(anyMissing(z)) }
   [1] 0 0 0 0 0
   > { z<-replace(1:1e7,2,NA); unix.time(any(is.na(z)))}
   [1] 0.62 0.13 0.75 0.00 0.00

   > # NA at end of list
   > { z<-replace(1:1e7,1e7,NA); unix.time(anyMissing(z)) }
   [1] 0.07 0.00 0.07 0.00 0.00
   > { z<-replace(1:1e7,1e7,NA); unix.time(any(is.na(z)))}
   [1] 0.64 0.11 0.75 0.00 0.00

The Splus anyMissing is an s3 generic (i.e., it calls UseMethod()).
The Splus is.na is an s4 generic and its default method may invoke
an s3 generic.

> > BTW, without having checked the source code, it looks like is.na() is
> > unnecessarily slow; is.na(sum(x)) is much faster than any(is.na(x)) on
> > a vector without NAs.  On the other hand, is.na(sum(x)) becomes
> > awfully slow if 'x' contains NAs.
> >
>
> I don't think  it is unnecessarily slow.  It has to dispatch methods and
> it has to make sure that matrix structure is preserved.  After that the
> code is just
>
>      case REALSXP:
>          for (i = 0; i < n; i++)
>              LOGICAL(ans)[i] = ISNAN(REAL(x)[i]);
>          break;
>
> and it's hard to see how that can be improved. It does suggest that a
> faster anyNA() function would have to not be generic.

----------------------------------------------------------------------------
Bill Dunlap
Insightful Corporation
bill at insightful dot com
360-428-8146

 "All statements in this message represent the opinions of the author and do
 not necessarily reflect Insightful Corporation policy or position."


From murdoch at stats.uwo.ca  Tue Apr 11 01:48:12 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Mon, 10 Apr 2006 19:48:12 -0400
Subject: [Rd] Suggestions to speed up median() and has.na()
In-Reply-To: <Pine.LNX.4.64.0604101551440.19159@homer24.u.washington.edu>
References: <59d7961d0604101037x3b223ct15de31fc2cfdf790@mail.gmail.com>
	<Pine.LNX.4.64.0604101551440.19159@homer24.u.washington.edu>
Message-ID: <443AEEBC.8090901@stats.uwo.ca>

On 4/10/2006 7:22 PM, Thomas Lumley wrote:
> On Mon, 10 Apr 2006, Henrik Bengtsson wrote:
> 
>> Hi,
>>
>> I've got two suggestions how to speed up median() about 50%.  For all
>> iterative methods calling median() in the loops this has a major
>> impact.  The second suggestion will apply to other methods too.
> 
> I'm surprised this has a major impact -- in your example it takes much 
> longer to generate the ten million numbers than to find the median.
> 
>> Suggestion 1:
>> Replace the sort() calls with the .Internal(psort(x, partial)).   This
>> will avoid unnecessary overhead, especially an expensive second check
>> for NAs using any(is.na(x)).  Simple benchmarking with
>>
>> x <- rnorm(10e6)
>> system.time(median(x))/system.time(median2(x))
>>
>> where median2() is the function with the above replacements, gives
>> about 20-25% speed up.
> 
> There's something that seems a bit undesirable about having median() call 
> the .Internal function for sort().
> 
>> Suggestion 2:
>> Create a has.na(x) function to replace any(is.na(x)) that returns TRUE
>> as soon as a NA value is detected.  In the best case it returns after
>> the first index with TRUE, in the worst case it returns after the last
>> index N with FALSE.  The cost for is.na(x) is always O(N), and any()
>> in the best case O(1) and in the worst case O(N) (if any() is
>> implemented as I hope).  An has.na() function would be very useful
>> elsewhere too.
> 
> This sounds useful (though it has missed the deadline for 2.3.0).
> 
> It won't help if the typical case is no missing values, as you suggest, 
> but it will be faster when there are missing values.

I think it would help even in that case if the vector is large, because 
it avoids allocating and disposing of the logical vector of the same 
length as x.

>> BTW, without having checked the source code, it looks like is.na() is
>> unnecessarily slow; is.na(sum(x)) is much faster than any(is.na(x)) on
>> a vector without NAs.  On the other hand, is.na(sum(x)) becomes
>> awfully slow if 'x' contains NAs.
>>
> 
> I don't think  it is unnecessarily slow.  It has to dispatch methods and 
> it has to make sure that matrix structure is preserved.  After that the 
> code is just
> 
>      case REALSXP:
>          for (i = 0; i < n; i++)
>              LOGICAL(ans)[i] = ISNAN(REAL(x)[i]);
>          break;
> 
> and it's hard to see how that can be improved. It does suggest that a 
> faster anyNA() function would have to not be generic.

If it's necessary to make it not generic to achieve the speedup, I don't 
think it's worth doing.  If anyNA is written not to be generic I'd guess 
a very common error will be to apply it to a dataframe and get a 
misleading "FALSE" answer.  If we do that, I predict that the total 
amount of r-help time wasted on it will exceed the CPU time saved by 
orders of magnitude.

Duncan Murdoch


From tlumley at u.washington.edu  Tue Apr 11 02:08:02 2006
From: tlumley at u.washington.edu (Thomas Lumley)
Date: Mon, 10 Apr 2006 17:08:02 -0700 (PDT)
Subject: [Rd] Suggestions to speed up median() and has.na()
In-Reply-To: <443AEEBC.8090901@stats.uwo.ca>
References: <59d7961d0604101037x3b223ct15de31fc2cfdf790@mail.gmail.com>
	<Pine.LNX.4.64.0604101551440.19159@homer24.u.washington.edu>
	<443AEEBC.8090901@stats.uwo.ca>
Message-ID: <Pine.LNX.4.64.0604101651470.19159@homer24.u.washington.edu>

On Mon, 10 Apr 2006, Duncan Murdoch wrote:

> On 4/10/2006 7:22 PM, Thomas Lumley wrote:
>> On Mon, 10 Apr 2006, Henrik Bengtsson wrote:
>> 
>>> Suggestion 2:
>>> Create a has.na(x) function to replace any(is.na(x)) that returns TRUE
>>> as soon as a NA value is detected.  In the best case it returns after
>>> the first index with TRUE, in the worst case it returns after the last
>>> index N with FALSE.  The cost for is.na(x) is always O(N), and any()
>>> in the best case O(1) and in the worst case O(N) (if any() is
>>> implemented as I hope).  An has.na() function would be very useful
>>> elsewhere too.
>> 
>> This sounds useful (though it has missed the deadline for 2.3.0).
>> 
>> It won't help if the typical case is no missing values, as you suggest, but 
>> it will be faster when there are missing values.
>
> I think it would help even in that case if the vector is large, because it 
> avoids allocating and disposing of the logical vector of the same length as 
> x.

That makes sense. I have just tried, and for vectors of length ten 
million it does make a measurable difference.


>>> BTW, without having checked the source code, it looks like is.na() is
>>> unnecessarily slow; is.na(sum(x)) is much faster than any(is.na(x)) on
>>> a vector without NAs.  On the other hand, is.na(sum(x)) becomes
>>> awfully slow if 'x' contains NAs.
>>> 
>> 
>> I don't think  it is unnecessarily slow.  It has to dispatch methods and it 
>> has to make sure that matrix structure is preserved.  After that the code 
>> is just
>>
>>      case REALSXP:
>>          for (i = 0; i < n; i++)
>>              LOGICAL(ans)[i] = ISNAN(REAL(x)[i]);
>>          break;
>> 
>> and it's hard to see how that can be improved. It does suggest that a 
>> faster anyNA() function would have to not be generic.
>
> If it's necessary to make it not generic to achieve the speedup, I don't 
> think it's worth doing.  If anyNA is written not to be generic I'd guess a 
> very common error will be to apply it to a dataframe and get a misleading 
> "FALSE" answer.  If we do that, I predict that the total amount of r-help 
> time wasted on it will exceed the CPU time saved by orders of magnitude.
>

I wasn't proposing that it should be stupid, just not generic.  It could 
support data frames (sum(), does, for example). If it didn't support data 
frames it should certainly give an error rather than the wrong answer, but 
if we are seriously trying to avoid delays around 0.1 seconds then going 
through the generic function mechanism may be a problem.


 	-thomas


From murdoch at stats.uwo.ca  Tue Apr 11 02:54:39 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Mon, 10 Apr 2006 20:54:39 -0400
Subject: [Rd] Suggestions to speed up median() and has.na()
In-Reply-To: <Pine.LNX.4.64.0604101651470.19159@homer24.u.washington.edu>
References: <59d7961d0604101037x3b223ct15de31fc2cfdf790@mail.gmail.com>
	<Pine.LNX.4.64.0604101551440.19159@homer24.u.washington.edu>
	<443AEEBC.8090901@stats.uwo.ca>
	<Pine.LNX.4.64.0604101651470.19159@homer24.u.washington.edu>
Message-ID: <443AFE4F.6040707@stats.uwo.ca>

On 4/10/2006 8:08 PM, Thomas Lumley wrote:
> On Mon, 10 Apr 2006, Duncan Murdoch wrote:
> 
>> On 4/10/2006 7:22 PM, Thomas Lumley wrote:
>>> On Mon, 10 Apr 2006, Henrik Bengtsson wrote:
>>>
>>>> Suggestion 2:
>>>> Create a has.na(x) function to replace any(is.na(x)) that returns TRUE
>>>> as soon as a NA value is detected.  In the best case it returns after
>>>> the first index with TRUE, in the worst case it returns after the last
>>>> index N with FALSE.  The cost for is.na(x) is always O(N), and any()
>>>> in the best case O(1) and in the worst case O(N) (if any() is
>>>> implemented as I hope).  An has.na() function would be very useful
>>>> elsewhere too.
>>> This sounds useful (though it has missed the deadline for 2.3.0).
>>>
>>> It won't help if the typical case is no missing values, as you suggest, but 
>>> it will be faster when there are missing values.
>> I think it would help even in that case if the vector is large, because it 
>> avoids allocating and disposing of the logical vector of the same length as 
>> x.
> 
> That makes sense. I have just tried, and for vectors of length ten 
> million it does make a measurable difference.
> 
> 
>>>> BTW, without having checked the source code, it looks like is.na() is
>>>> unnecessarily slow; is.na(sum(x)) is much faster than any(is.na(x)) on
>>>> a vector without NAs.  On the other hand, is.na(sum(x)) becomes
>>>> awfully slow if 'x' contains NAs.
>>>>
>>> I don't think  it is unnecessarily slow.  It has to dispatch methods and it 
>>> has to make sure that matrix structure is preserved.  After that the code 
>>> is just
>>>
>>>      case REALSXP:
>>>          for (i = 0; i < n; i++)
>>>              LOGICAL(ans)[i] = ISNAN(REAL(x)[i]);
>>>          break;
>>>
>>> and it's hard to see how that can be improved. It does suggest that a 
>>> faster anyNA() function would have to not be generic.
>> If it's necessary to make it not generic to achieve the speedup, I don't 
>> think it's worth doing.  If anyNA is written not to be generic I'd guess a 
>> very common error will be to apply it to a dataframe and get a misleading 
>> "FALSE" answer.  If we do that, I predict that the total amount of r-help 
>> time wasted on it will exceed the CPU time saved by orders of magnitude.
>>
> 
> I wasn't proposing that it should be stupid, just not generic.  It could 
> support data frames (sum(), does, for example). If it didn't support data 
> frames it should certainly give an error rather than the wrong answer, but 
> if we are seriously trying to avoid delays around 0.1 seconds then going 
> through the generic function mechanism may be a problem.

If it's not dataframes, it will be something else.  I think it's highly 
desirable that any(is.na(x)) == anyNA(x) within base packages, and we 
should make it straightforward to maintain this identity in contributed 
packages.

By the way, I think Bill's suggestion of calling it anyMissing makes a 
lot of sense.

Duncan


From murdoch at stats.uwo.ca  Tue Apr 11 03:22:03 2006
From: murdoch at stats.uwo.ca (murdoch at stats.uwo.ca)
Date: Tue, 11 Apr 2006 03:22:03 +0200 (CEST)
Subject: [Rd] eapply() fails on baseenv() (PR#8761)
Message-ID: <20060411012203.4FE4F44227@slim.kubism.ku.dk>

eapply() works on most environments, but not on baseenv().  For example,

 > x <- 1
 > eapply(globalenv(), function(x) x)
$x
[1] 1

 > eapply(baseenv(), function(x) x)
list()

I'm probably not going to have time to work on this before 2.3.0, but I 
don't think it's really urgent; if no one else fixes it first I'll do it 
after the release.

Duncan Murdoch


From ripley at stats.ox.ac.uk  Tue Apr 11 08:19:42 2006
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Tue, 11 Apr 2006 08:19:42 +0200 (CEST)
Subject: [Rd] install.packages on unix / su (PR#8760)
Message-ID: <20060411061942.A403744237@slim.kubism.ku.dk>

On Mon, 10 Apr 2006, Thomas Friedrichsmeier wrote:

>> | Wishlist item:
>> |
>> | There is a small problem using intall.packages() (and update.packages()):
>> | Typically I want to install packages for system-wide use, not in a user
>> | directory. Obviously this does not work without superuser rights.

[From a reply I started last night.]

Not obvious at all, especially to those of us who do it all the time.
Many of us set up an account to `own' R, and either install under that
account or change the ownership of the library directory to that account.

I think what you suggest is quite dangerous, as different directories may
be visible to the user account producing the summary information and to
root.  Then update.packages() (run by you) and R CMD INSTALL (run by root) 
may do different things.  This could apply both within a library directory 
(root might have installed a later version of a package not readable by 
you) and over different library trees (my personal R library is not 
readable by root, and indeed the main R library tree is not readable by 
root on our student's machines).

Quoting someone else (without attribution, a breach of copyright)

>> One can see this problem as a local system management issue for which
>> another possible answer is to add you (and/or the user users installing R
>> packages) to, say, group 'admin' and to make /usr/local/lib/R of group
>> admin and group-writeable.  Or create a custom group radmin. Or ...
>
> It's about convenience, no more, no less, and so it's a wishlist item, no
> more, and no less.
> I don't think the case of a non-root user working on a de-facto single user
> system is too uncommon on linux. It's why tools like kdesu exist in the first
> place. Unless there are strong reasons not to (and there may well be), I
> think adding some convenience option for this particular case may well be
> worth while.

See the `strong reason' above.  Two of us have suggested better solutions.
If you want yours, you can of course patch your installation, the beauty 
of Open Source.  But unless you can find an R-core member who is prepared 
to maintain your solution, it will not be going into R.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From francoisromain at free.fr  Tue Apr 11 10:01:46 2006
From: francoisromain at free.fr (Romain Francois)
Date: Tue, 11 Apr 2006 10:01:46 +0200
Subject: [Rd] kcachegrind and R
Message-ID: <443B626A.3030601@free.fr>

Hi,

Is there a way to use kcachegrind on R code ?
I mean the R function written in R (not the C, etc ... functions). Has 
someone tried to generate "Callgrind profile format" from ouputs of Rprof ?

Romain

-- 
visit the R Graph Gallery : http://addictedtor.free.fr/graphiques
mixmod 1.7 is released : http://www-math.univ-fcomte.fr/mixmod/index.php
+---------------------------------------------------------------+
| Romain FRANCOIS - http://francoisromain.free.fr               |
| Doctorant INRIA Futurs / EDF                                  |
+---------------------------------------------------------------+


From francoisromain at free.fr  Tue Apr 11 11:00:12 2006
From: francoisromain at free.fr (Romain Francois)
Date: Tue, 11 Apr 2006 11:00:12 +0200
Subject: [Rd] pattern in history
Message-ID: <443B701C.20605@free.fr>

Hi,

Sometimes I need to consult the history of commands that are matching a 
regex, so I modified the utils::history function for that purpose. I 
found it useful.

I append the code ( I only added the two lines with #**)

Romain.


history2 <-
function (pattern="", max.show = 25, reverse = FALSE, unique = 
pattern!="", ...)
{
    file1 <- tempfile("Rrawhist")
    savehistory(file1)
    rawhist <- scan(file1, what = "", quiet = TRUE, sep = "\n")
    rawhist <- rawhist[grep(pattern, rawhist, ...)] #**
    if(unique) rawhist <- unique(rawhist) #**
    unlink(file1)
    nlines <- length(rawhist)
   
    inds <- max(1, nlines - max.show):nlines
    if (reverse)
        inds <- rev(inds)
    file2 <- tempfile("hist")
    write(rawhist[inds], file2)
    file.show(file2, title = "R History", delete.file = TRUE)
}


-- 
visit the R Graph Gallery : http://addictedtor.free.fr/graphiques
mixmod 1.7 is released : http://www-math.univ-fcomte.fr/mixmod/index.php
+---------------------------------------------------------------+
| Romain FRANCOIS - http://francoisromain.free.fr               |
| Doctorant INRIA Futurs / EDF                                  |
+---------------------------------------------------------------+


From blindglobe at gmail.com  Tue Apr 11 11:34:46 2006
From: blindglobe at gmail.com (A.J. Rossini)
Date: Tue, 11 Apr 2006 11:34:46 +0200
Subject: [Rd] Stack checking, core dumps, and embedding R
Message-ID: <1abe3fa90604110234v1b4958c0w1e51e2b49f7ff9c5@mail.gmail.com>

I will say this first -- I can't copy/paste the error message from the
screen, so it's being retyped.  Errors might occur.  SORRY.

I've been experiencing some interesting stack warnings recently when
moving from R 2.2.x to the R 2.3.0 series and the R 2.4.0 series.  In
particular, I'm getting warnings of "Error: C stack usage is too close
to the limit" before segfaulting, and this wasn't happening under the
2.2.x series.

Here's the question statement:  (ONLY) In the situation where one is
embedding R, is anyone else seeing this occur with recent (past 2
weeks) versions of R (both the 2.3.x and 2.4.x series)?

(it doesn't happen in the non-embedded case for me, at least not
recently -- there was an SVN version recently where I did get that
behavior in the non-embedded case, but it was "fixed" before I had a
chance to report).

I'm still debugging it; hopefully will have a bug report while I'm on
(working) vacation in the states next week.

best,
-tony

blindglobe at gmail.com
Muttenz, Switzerland.
"Commit early,commit often, and commit in a repository from which we can easily
roll-back your mistakes" (AJR, 4Jan05).


From ripley at stats.ox.ac.uk  Tue Apr 11 12:30:13 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 11 Apr 2006 11:30:13 +0100 (BST)
Subject: [Rd] Stack checking, core dumps, and embedding R
In-Reply-To: <1abe3fa90604110234v1b4958c0w1e51e2b49f7ff9c5@mail.gmail.com>
References: <1abe3fa90604110234v1b4958c0w1e51e2b49f7ff9c5@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0604111121440.30083@gannet.stats.ox.ac.uk>

On Tue, 11 Apr 2006, A.J. Rossini wrote:

> I will say this first -- I can't copy/paste the error message from the
> screen, so it's being retyped.  Errors might occur.  SORRY.
>
> I've been experiencing some interesting stack warnings recently when
> moving from R 2.2.x to the R 2.3.0 series and the R 2.4.0 series.  In
> particular, I'm getting warnings of "Error: C stack usage is too close
> to the limit" before segfaulting, and this wasn't happening under the
> 2.2.x series.
>
> Here's the question statement:  (ONLY) In the situation where one is
> embedding R, is anyone else seeing this occur with recent (past 2
> weeks) versions of R (both the 2.3.x and 2.4.x series)?

It is likely reporting a real problem that was not spotted in 2.2.1, 
and that in the embedded case the stack usage is higher that standalone.

I am guessing this is Linux.  If so, does the simple expedient of raising 
the stack limit (in the shell, before launching the application) help? 
(I have done so for a couple of uses of R, and had no more problem.)

For Windows, the relevant stack limit is in the calling application, and 
that is likely to be too low (1Mb or 2Mb: the R front-ends use 10Mb).

> (it doesn't happen in the non-embedded case for me, at least not
> recently -- there was an SVN version recently where I did get that
> behavior in the non-embedded case, but it was "fixed" before I had a
> chance to report).
>
> I'm still debugging it; hopefully will have a bug report while I'm on
> (working) vacation in the states next week.

Is this actually a bug, or at least one in R?  There are new tools like
Cstack_info() that can help to track down excessive stack usage.

>
> best,
> -tony
>
> blindglobe at gmail.com
> Muttenz, Switzerland.
> "Commit early,commit often, and commit in a repository from which we can easily
> roll-back your mistakes" (AJR, 4Jan05).

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From blindglobe at gmail.com  Tue Apr 11 13:30:03 2006
From: blindglobe at gmail.com (A.J. Rossini)
Date: Tue, 11 Apr 2006 13:30:03 +0200
Subject: [Rd] Stack checking, core dumps, and embedding R
In-Reply-To: <Pine.LNX.4.64.0604111121440.30083@gannet.stats.ox.ac.uk>
References: <1abe3fa90604110234v1b4958c0w1e51e2b49f7ff9c5@mail.gmail.com>
	<Pine.LNX.4.64.0604111121440.30083@gannet.stats.ox.ac.uk>
Message-ID: <1abe3fa90604110430g12e4aafag7e4e5dd2e7a38e1@mail.gmail.com>

On 4/11/06, Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
> On Tue, 11 Apr 2006, A.J. Rossini wrote:
>
> > I will say this first -- I can't copy/paste the error message from the
> > screen, so it's being retyped.  Errors might occur.  SORRY.
> >
> > I've been experiencing some interesting stack warnings recently when
> > moving from R 2.2.x to the R 2.3.0 series and the R 2.4.0 series.  In
> > particular, I'm getting warnings of "Error: C stack usage is too close
> > to the limit" before segfaulting, and this wasn't happening under the
> > 2.2.x series.
> >
> > Here's the question statement:  (ONLY) In the situation where one is
> > embedding R, is anyone else seeing this occur with recent (past 2
> > weeks) versions of R (both the 2.3.x and 2.4.x series)?
>
> It is likely reporting a real problem that was not spotted in 2.2.1,
> and that in the embedded case the stack usage is higher that standalone.
>
> I am guessing this is Linux.  If so, does the simple expedient of raising
> the stack limit (in the shell, before launching the application) help?
> (I have done so for a couple of uses of R, and had no more problem.)
>
> For Windows, the relevant stack limit is in the calling application, and
> that is likely to be too low (1Mb or 2Mb: the R front-ends use 10Mb).
>
> > (it doesn't happen in the non-embedded case for me, at least not
> > recently -- there was an SVN version recently where I did get that
> > behavior in the non-embedded case, but it was "fixed" before I had a
> > chance to report).
> >
> > I'm still debugging it; hopefully will have a bug report while I'm on
> > (working) vacation in the states next week.
>
> Is this actually a bug, or at least one in R?  There are new tools like
> Cstack_info() that can help to track down excessive stack usage.

I don't know yet if it's a bug in R; if I knew so, I would have
submitted an R bug report.  I noted the stack monitoring changes that
were made, and working through the logic in the code (I seem to recall
main.c, errors.c, and one other file), it "seemed" correct.

This is indeed under Linux.   I'm unable to get to "command submission
function"
as I was before, so I'll be "backtracking" tonight with an earlier
version of the code.   I will try the suggestions that Brian made, and
will report back later tonight.

If anyone else has success or problems with embedding with this series
of R (2.3.x, 2.4.x), I'd appreciate input.   Again, I'm not seeing
this with normal CLI operation of R at this point.

best,
-tony

blindglobe at gmail.com
Muttenz, Switzerland.
"Commit early,commit often, and commit in a repository from which we can easily
roll-back your mistakes" (AJR, 4Jan05).


From hb at maths.lth.se  Tue Apr 11 13:56:16 2006
From: hb at maths.lth.se (Henrik Bengtsson)
Date: Tue, 11 Apr 2006 13:56:16 +0200
Subject: [Rd] Suggestions to speed up median() and has.na()
In-Reply-To: <Pine.LNX.4.64.0604101651470.19159@homer24.u.washington.edu>
References: <59d7961d0604101037x3b223ct15de31fc2cfdf790@mail.gmail.com>
	<Pine.LNX.4.64.0604101551440.19159@homer24.u.washington.edu>
	<443AEEBC.8090901@stats.uwo.ca>
	<Pine.LNX.4.64.0604101651470.19159@homer24.u.washington.edu>
Message-ID: <59d7961d0604110456w6fcd3609uebd41fcb14582824@mail.gmail.com>

On 4/11/06, Thomas Lumley <tlumley at u.washington.edu> wrote:
> On Mon, 10 Apr 2006, Duncan Murdoch wrote:
>
> > On 4/10/2006 7:22 PM, Thomas Lumley wrote:
> >> On Mon, 10 Apr 2006, Henrik Bengtsson wrote:
> >>
> >>> Suggestion 2:
> >>> Create a has.na(x) function to replace any(is.na(x)) that returns TRUE
> >>> as soon as a NA value is detected.  In the best case it returns after
> >>> the first index with TRUE, in the worst case it returns after the last
> >>> index N with FALSE.  The cost for is.na(x) is always O(N), and any()
> >>> in the best case O(1) and in the worst case O(N) (if any() is
> >>> implemented as I hope).  An has.na() function would be very useful
> >>> elsewhere too.
> >>
> >> This sounds useful (though it has missed the deadline for 2.3.0).
> >>
> >> It won't help if the typical case is no missing values, as you suggest, but
> >> it will be faster when there are missing values.

I would still argue that is.na(x) does N comparisons and any() does at
least one and in the worst case N, in total [N+1,2N], but optimally
you can get away with [1,N].  In my case (see below) N is 2,000, then
with 100,000 such vectors and an iteration algorithm with maxIter=20,
I will save up to 4,000,000,000 comparisons!

> > I think it would help even in that case if the vector is large, because it
> > avoids allocating and disposing of the logical vector of the same length as
> > x.
>
> That makes sense. I have just tried, and for vectors of length ten
> million it does make a measurable difference.

Yes.  It makes a huge difference for long vectors or many short
vectors.  Take for instance rlm() is MASS.  With the default
arguments, it uses median(abs(x)) to estimate the scale in each
iteration.  In my case (Affymetrix SNP data), I know for sure that 'x'
never contains NAs, or even if it did, I could move that check outside
the iteration loop.  Even if the length of each 'x' is only 20*100,
with a dataset of >100,000 such vectors, in one step, I managed to cut
down the analysis from 14 hours to 7 hours!  This is probably, as you
say, due to allocation/copying/deallocation.

>
> >>> BTW, without having checked the source code, it looks like is.na() is
> >>> unnecessarily slow; is.na(sum(x)) is much faster than any(is.na(x)) on
> >>> a vector without NAs.  On the other hand, is.na(sum(x)) becomes
> >>> awfully slow if 'x' contains NAs.
> >>>
> >>
> >> I don't think  it is unnecessarily slow.  It has to dispatch methods and it
> >> has to make sure that matrix structure is preserved.  After that the code
> >> is just
> >>
> >>      case REALSXP:
> >>          for (i = 0; i < n; i++)
> >>              LOGICAL(ans)[i] = ISNAN(REAL(x)[i]);
> >>          break;
> >>
> >> and it's hard to see how that can be improved. It does suggest that a
> >> faster anyNA() function would have to not be generic.
> >
> > If it's necessary to make it not generic to achieve the speedup, I don't
> > think it's worth doing.  If anyNA is written not to be generic I'd guess a
> > very common error will be to apply it to a dataframe and get a misleading
> > "FALSE" answer.  If we do that, I predict that the total amount of r-help
> > time wasted on it will exceed the CPU time saved by orders of magnitude.
> >
>
> I wasn't proposing that it should be stupid, just not generic.  It could
> support data frames (sum(), does, for example). If it didn't support data
> frames it should certainly give an error rather than the wrong answer, but
> if we are seriously trying to avoid delays around 0.1 seconds then going
> through the generic function mechanism may be a problem.

Can we do both and let certain functions such as median() call the
default/internal method explicitly?  Or a low-level and a high-level
function?  Possibly introducing an 'hasNA' argument to many of our
functions, or let 'na.rm=NA' indicate that we no that there are no
NAs; when we know for sure that there is no NAs, even with an optimal
anyNA() function we will waste CPU time in iterative methods.

BTW, I did a quick scan in the R source code and I found 106
occurances of "any(is.na(" not looking at any CRAN or Bioinductor
packages.

Best,

Henrik

>
>         -thomas
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From ripley at stats.ox.ac.uk  Tue Apr 11 14:12:32 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 11 Apr 2006 13:12:32 +0100 (BST)
Subject: [Rd] pattern in history
In-Reply-To: <443B701C.20605@free.fr>
References: <443B701C.20605@free.fr>
Message-ID: <Pine.LNX.4.64.0604111302250.4588@gannet.stats.ox.ac.uk>

That's an interesting suggestion, but

1) it is not a good idea to change the order of arguments in a function.

2) is the 'unique' argument useful?  I cannot see it being used if
there is no pattern search, nor I do see the merit in showing repeated 
lines if I have subselected.

3) like ls(), testing if 'pattern' were missing or NULL would be a better 
idea.


On Tue, 11 Apr 2006, Romain Francois wrote:

> Hi,
>
> Sometimes I need to consult the history of commands that are matching a
> regex, so I modified the utils::history function for that purpose. I
> found it useful.
>
> I append the code ( I only added the two lines with #**)
>
> Romain.
>
>
> history2 <-
> function (pattern="", max.show = 25, reverse = FALSE, unique =
> pattern!="", ...)
> {
>    file1 <- tempfile("Rrawhist")
>    savehistory(file1)
>    rawhist <- scan(file1, what = "", quiet = TRUE, sep = "\n")
>    rawhist <- rawhist[grep(pattern, rawhist, ...)] #**
>    if(unique) rawhist <- unique(rawhist) #**
>    unlink(file1)
>    nlines <- length(rawhist)
>
>    inds <- max(1, nlines - max.show):nlines
>    if (reverse)
>        inds <- rev(inds)
>    file2 <- tempfile("hist")
>    write(rawhist[inds], file2)
>    file.show(file2, title = "R History", delete.file = TRUE)
> }
>
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From francoisromain at free.fr  Tue Apr 11 14:41:43 2006
From: francoisromain at free.fr (Romain Francois)
Date: Tue, 11 Apr 2006 14:41:43 +0200
Subject: [Rd] pattern in history
In-Reply-To: <Pine.LNX.4.64.0604111302250.4588@gannet.stats.ox.ac.uk>
References: <443B701C.20605@free.fr>
	<Pine.LNX.4.64.0604111302250.4588@gannet.stats.ox.ac.uk>
Message-ID: <443BA407.30803@free.fr>

Le 11.04.2006 14:12, Prof Brian Ripley a ?crit :
> That's an interesting suggestion, but
>
> 1) it is not a good idea to change the order of arguments in a function.
Yes, my mystake. It's because i like to call 'history(something)' 
directly and not 'history(pattern=something)'.
I hadn't in mind the possibility to break existing code.
> 2) is the 'unique' argument useful?  I cannot see it being used if
> there is no pattern search, nor I do see the merit in showing repeated 
> lines if I have subselected.
>
> 3) like ls(), testing if 'pattern' were missing or NULL would be a 
> better idea.
Right.
There is also a problem with the order of the calls.
If I do :

 > ls()
 > l <- mean(rnorm(50))
 > ls()
 > history(pattern="^l")
it prints :
ls()
l <- mean(rnorm(50))

when it should print :
l <- mean(rnorm(50))
ls()

We can use rev twice (like in history3 below), but is it worth it ?

history3 <-
function (max.show = 25, reverse = FALSE, pattern, ...)
{
   file1 <- tempfile("Rrawhist")
   savehistory(file1)
   rawhist <- scan(file1, what = "", quiet = TRUE, sep = "\n")
   if(!missing(pattern)) rawhist <- rev( unique( 
rev(rawhist[grep(pattern, rawhist, ...)] ) ) )
   unlink(file1)
   nlines <- length(rawhist)
     inds <- max(1, nlines - max.show):nlines
   if (reverse)
       inds <- rev(inds)
   file2 <- tempfile("hist")
   write(rawhist[inds], file2)
   file.show(file2, title = "R History", delete.file = TRUE)
}

-- 
visit the R Graph Gallery : http://addictedtor.free.fr/graphiques
mixmod 1.7 is released : http://www-math.univ-fcomte.fr/mixmod/index.php
+---------------------------------------------------------------+
| Romain FRANCOIS - http://francoisromain.free.fr               |
| Doctorant INRIA Futurs / EDF                                  |
+---------------------------------------------------------------+


From rkoenker at uiuc.edu  Tue Apr 11 14:51:39 2006
From: rkoenker at uiuc.edu (roger koenker)
Date: Tue, 11 Apr 2006 07:51:39 -0500
Subject: [Rd]  Suggestions to speed up median() and has.na()
Message-ID: <625D9846-00B6-4DA8-8440-A185FBC80B7E@uiuc.edu>

I've recently folded a new version of the Floyd-Rivest quantile  
algorithm
for quantiles into my quantreg package.  So it is easily available for
comparative testing.  On my G5 running last friday's  R-devel, I get:


              Median Only          5 Quantiles
  n          quantile kuantile quantile kuantile qsort
100         0.003    0.003     0.006    0.004 0.002
1000       0.002    0.002     0.002    0.002 0.002
10000     0.005    0.003     0.008    0.003 0.001
1e+05     0.022    0.010     0.035    0.012 0.017
1e+06     0.181    0.117     0.308    0.138 0.200
1e+07     1.853    0.762     3.180    1.003 2.287


# Small timing experiment to compare kuantile and quantile

require(quantreg)
set.seed(1446)

ns <- 10^(2:7)
R <- 10
T <- array(NA,c(R,length(ns),5))
eps <- 20 * .Machine$double.eps
for(j in 1:length(ns)){
     for(i in 1:R){
         y <- rnorm(ns[j])
         T[i,j,1] <- system.time(qy <- quantile(y,.5))[1]
         T[i,j,2] <- system.time(ky <- kuantile(y,.5))[1]
         stopifnot(abs(qy - ky) < eps)
         T[i,j,3] <- system.time(qy <- quantile(y))[1]
         T[i,j,4] <- system.time(ky <- kuantile(y))[1]
         stopifnot(abs(qy - ky) < eps)
         T[i,j,5] <- system.time(sort(y,method="quick"))[1]
         }
     }

Tab <- apply(T,2:3,mean)
dimnames(Tab) <- list(paste(ns),c(rep(c("quantile","kuantile"), 
2),"qsort"))

url:    www.econ.uiuc.edu/~roger            Roger Koenker
email    rkoenker at uiuc.edu            Department of Economics
vox:     217-333-4558                University of Illinois
fax:       217-244-6678                Champaign, IL 61820


From ripley at stats.ox.ac.uk  Tue Apr 11 14:52:59 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 11 Apr 2006 13:52:59 +0100 (BST)
Subject: [Rd] pattern in history
In-Reply-To: <443BA407.30803@free.fr>
References: <443B701C.20605@free.fr>
	<Pine.LNX.4.64.0604111302250.4588@gannet.stats.ox.ac.uk>
	<443BA407.30803@free.fr>
Message-ID: <Pine.LNX.4.64.0604111351460.5323@gannet.stats.ox.ac.uk>

On Tue, 11 Apr 2006, Romain Francois wrote:

> Le 11.04.2006 14:12, Prof Brian Ripley a ?crit :
>> That's an interesting suggestion, but
>> 
>> 1) it is not a good idea to change the order of arguments in a function.
> Yes, my mystake. It's because i like to call 'history(something)' directly 
> and not 'history(pattern=something)'.
> I hadn't in mind the possibility to break existing code.
>> 2) is the 'unique' argument useful?  I cannot see it being used if
>> there is no pattern search, nor I do see the merit in showing repeated 
>> lines if I have subselected.
>> 
>> 3) like ls(), testing if 'pattern' were missing or NULL would be a better 
>> idea.
> Right.
> There is also a problem with the order of the calls.
> If I do :
>
>> ls()
>> l <- mean(rnorm(50))
>> ls()
>> history(pattern="^l")
> it prints :
> ls()
> l <- mean(rnorm(50))
>
> when it should print :
> l <- mean(rnorm(50))
> ls()

Well, maybe sorting would be useful here.

BTW, your code also fails (prints NA) if there are not matches.


>
> We can use rev twice (like in history3 below), but is it worth it ?
>
> history3 <-
> function (max.show = 25, reverse = FALSE, pattern, ...)
> {
>  file1 <- tempfile("Rrawhist")
>  savehistory(file1)
>  rawhist <- scan(file1, what = "", quiet = TRUE, sep = "\n")
>  if(!missing(pattern)) rawhist <- rev( unique( rev(rawhist[grep(pattern, 
> rawhist, ...)] ) ) )
>  unlink(file1)
>  nlines <- length(rawhist)
>    inds <- max(1, nlines - max.show):nlines
>  if (reverse)
>      inds <- rev(inds)
>  file2 <- tempfile("hist")
>  write(rawhist[inds], file2)
>  file.show(file2, title = "R History", delete.file = TRUE)
> }
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From ripley at stats.ox.ac.uk  Tue Apr 11 15:04:31 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 11 Apr 2006 14:04:31 +0100 (BST)
Subject: [Rd] Suggestions to speed up median() and has.na()
In-Reply-To: <625D9846-00B6-4DA8-8440-A185FBC80B7E@uiuc.edu>
References: <625D9846-00B6-4DA8-8440-A185FBC80B7E@uiuc.edu>
Message-ID: <Pine.LNX.4.64.0604111400030.5402@gannet.stats.ox.ac.uk>

On Windows

> Tab
       quantile kuantile quantile kuantile qsort
100      0.003    0.003    0.000    0.001 0.000
1000     0.000    0.000    0.002    0.000 0.000
10000    0.002    0.004    0.001    0.004 0.000
1e+05    0.008    0.006    0.016    0.010 0.018
1e+06    0.092    0.113    0.137    0.140 0.186
1e+07    0.920    0.685    1.386    0.992 2.274

so the comparison is far less favourable to kuantile.

I remain unconvinced that such small differences are worth the time spend 
discussing them.


On Tue, 11 Apr 2006, roger koenker wrote:

> I've recently folded a new version of the Floyd-Rivest quantile
> algorithm
> for quantiles into my quantreg package.  So it is easily available for
> comparative testing.  On my G5 running last friday's  R-devel, I get:
>
>
>              Median Only          5 Quantiles
>  n          quantile kuantile quantile kuantile qsort
> 100         0.003    0.003     0.006    0.004 0.002
> 1000       0.002    0.002     0.002    0.002 0.002
> 10000     0.005    0.003     0.008    0.003 0.001
> 1e+05     0.022    0.010     0.035    0.012 0.017
> 1e+06     0.181    0.117     0.308    0.138 0.200
> 1e+07     1.853    0.762     3.180    1.003 2.287
>
>
> # Small timing experiment to compare kuantile and quantile
>
> require(quantreg)
> set.seed(1446)
>
> ns <- 10^(2:7)
> R <- 10
> T <- array(NA,c(R,length(ns),5))
> eps <- 20 * .Machine$double.eps
> for(j in 1:length(ns)){
>     for(i in 1:R){
>         y <- rnorm(ns[j])
>         T[i,j,1] <- system.time(qy <- quantile(y,.5))[1]
>         T[i,j,2] <- system.time(ky <- kuantile(y,.5))[1]
>         stopifnot(abs(qy - ky) < eps)
>         T[i,j,3] <- system.time(qy <- quantile(y))[1]
>         T[i,j,4] <- system.time(ky <- kuantile(y))[1]
>         stopifnot(abs(qy - ky) < eps)
>         T[i,j,5] <- system.time(sort(y,method="quick"))[1]
>         }
>     }
>
> Tab <- apply(T,2:3,mean)
> dimnames(Tab) <- list(paste(ns),c(rep(c("quantile","kuantile"),
> 2),"qsort"))
>
> url:    www.econ.uiuc.edu/~roger            Roger Koenker
> email    rkoenker at uiuc.edu            Department of Economics
> vox:     217-333-4558                University of Illinois
> fax:       217-244-6678                Champaign, IL 61820
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Tue Apr 11 15:06:57 2006
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Tue, 11 Apr 2006 15:06:57 +0200 (CEST)
Subject: [Rd] eapply() fails on baseenv() (PR#8761)
Message-ID: <20060411130657.F2D6144219@slim.kubism.ku.dk>

This is because baseenv() is special and has neither HASHTAB nor FRAME.
R_lsInternal shows how to treat it, and I will commit a fix shortly.

On Tue, 11 Apr 2006, murdoch at stats.uwo.ca wrote:

> eapply() works on most environments, but not on baseenv().  For example,
>
> > x <- 1
> > eapply(globalenv(), function(x) x)
> $x
> [1] 1
>
> > eapply(baseenv(), function(x) x)
> list()
>
> I'm probably not going to have time to work on this before 2.3.0, but I
> don't think it's really urgent; if no one else fixes it first I'll do it
> after the release.
>
> Duncan Murdoch
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From sw283 at maths.bath.ac.uk  Tue Apr 11 15:56:53 2006
From: sw283 at maths.bath.ac.uk (Simon Wood)
Date: Tue, 11 Apr 2006 14:56:53 +0100 (BST)
Subject: [Rd] gaussian family change suggestion
In-Reply-To: <mailman.9.1144749603.14828.r-devel@r-project.org>
References: <mailman.9.1144749603.14828.r-devel@r-project.org>
Message-ID: <Pine.LNX.4.56.0604111441331.29929@thoth.maths.bath.ac.uk>

Hi,

Currently the `gaussian' family's initialization code signals an error if
any response data are zero or negative and a log link is used. Given that
zero or negative response data are perfectly legitimate under the GLM
fitted using `gaussian("log")', this seems a bit unsatisfactory. Might
it be worth changing it?

The current offending code from `gaussian' is:

initialize = expression({
            n <- rep.int(1, nobs)
            if (is.null(etastart) && is.null(start) && is.null(mustart) &&
                ((family$link == "inverse" && any(y == 0)) ||
                  (family$link == "log" && any(y <= 0)))) stop(
              "cannot find valid starting values: please specify some")
            mustart <- y
        })

A possible replacement would be ...

initialize = expression({
            n <- rep.int(1, nobs)
            if (is.null(etastart) && is.null(start) && is.null(mustart) &&
                ((family$link == "inverse" && all(y == 0)) ||
                  (family$link == "log" && all(y <= 0)))) stop(
      "cannot find valid starting values: please specify some")
        mustart <- y
      if (family$link=="log") {
        iy <- y<=0
        if (sum(iy)) mustart[iy] <- min(y[!iy])*.5
      } else if (family$link=="inverse") {
        iy <- y==0
        if (sum(iy)) mustart[iy] <- min(abs(y[!iy]))*.5
      }
        })

best,
Simon


>- Simon Wood, Mathematical Sciences, University of Bath, Bath BA2 7AY
>-             +44 (0)1225 386603         www.maths.bath.ac.uk/~sw283/


From ripley at stats.ox.ac.uk  Tue Apr 11 16:34:45 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 11 Apr 2006 15:34:45 +0100 (BST)
Subject: [Rd] gaussian family change suggestion
In-Reply-To: <Pine.LNX.4.56.0604111441331.29929@thoth.maths.bath.ac.uk>
References: <mailman.9.1144749603.14828.r-devel@r-project.org>
	<Pine.LNX.4.56.0604111441331.29929@thoth.maths.bath.ac.uk>
Message-ID: <Pine.LNX.4.64.0604111518210.10306@gannet.stats.ox.ac.uk>

On Tue, 11 Apr 2006, Simon Wood wrote:

> Hi,
>
> Currently the `gaussian' family's initialization code signals an error if
> any response data are zero or negative and a log link is used. Given that
> zero or negative response data are perfectly legitimate under the GLM
> fitted using `gaussian("log")', this seems a bit unsatisfactory. Might
> it be worth changing it?

Well, that's not really true: it says it is unable to find starting 
values, and asks you to provide some.  I don't really see why your choices 
are satisfactory: what happens if all the data are negative for example? 
(You get +Inf in the log case, I believe.  The algorithm will probably get 
stuck from a finite starting point, but it will produce a mysterious error 
from an infinite one.)

We could try even harder, but code that is almost never used tends to get 
broken whilst no one is testing it.  So if you want to pursue it I think 
we need a comprehensive test suite.

> The current offending code from `gaussian' is:
>
> initialize = expression({
>            n <- rep.int(1, nobs)
>            if (is.null(etastart) && is.null(start) && is.null(mustart) &&
>                ((family$link == "inverse" && any(y == 0)) ||
>                  (family$link == "log" && any(y <= 0)))) stop(
>              "cannot find valid starting values: please specify some")
>            mustart <- y
>        })
>
> A possible replacement would be ...
>
> initialize = expression({
>            n <- rep.int(1, nobs)
>            if (is.null(etastart) && is.null(start) && is.null(mustart) &&
>                ((family$link == "inverse" && all(y == 0)) ||
>                  (family$link == "log" && all(y <= 0)))) stop(
>      "cannot find valid starting values: please specify some")
>        mustart <- y
>      if (family$link=="log") {
>        iy <- y<=0
>        if (sum(iy)) mustart[iy] <- min(y[!iy])*.5
>      } else if (family$link=="inverse") {
>        iy <- y==0
>        if (sum(iy)) mustart[iy] <- min(abs(y[!iy]))*.5
>      }
>        })
>
> best,
> Simon
>
>
>> - Simon Wood, Mathematical Sciences, University of Bath, Bath BA2 7AY
>> -             +44 (0)1225 386603         www.maths.bath.ac.uk/~sw283/
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From tlumley at u.washington.edu  Tue Apr 11 16:40:12 2006
From: tlumley at u.washington.edu (Thomas Lumley)
Date: Tue, 11 Apr 2006 07:40:12 -0700 (PDT)
Subject: [Rd] Suggestions to speed up median() and has.na()
In-Reply-To: <443AFE4F.6040707@stats.uwo.ca>
References: <59d7961d0604101037x3b223ct15de31fc2cfdf790@mail.gmail.com>
	<Pine.LNX.4.64.0604101551440.19159@homer24.u.washington.edu>
	<443AEEBC.8090901@stats.uwo.ca>
	<Pine.LNX.4.64.0604101651470.19159@homer24.u.washington.edu>
	<443AFE4F.6040707@stats.uwo.ca>
Message-ID: <Pine.LNX.4.64.0604110739200.2367@homer22.u.washington.edu>

On Mon, 10 Apr 2006, Duncan Murdoch wrote:
>
> If it's not dataframes, it will be something else.  I think it's highly
> desirable that any(is.na(x)) == anyNA(x) within base packages, and we
> should make it straightforward to maintain this identity in contributed
> packages.
>
> By the way, I think Bill's suggestion of calling it anyMissing makes a
> lot of sense.
>

Here we agree.

 	-thomas

Thomas Lumley			Assoc. Professor, Biostatistics
tlumley at u.washington.edu	University of Washington, Seattle


From sw283 at maths.bath.ac.uk  Tue Apr 11 16:55:17 2006
From: sw283 at maths.bath.ac.uk (Simon Wood)
Date: Tue, 11 Apr 2006 15:55:17 +0100 (BST)
Subject: [Rd] gaussian family change suggestion
In-Reply-To: <Pine.LNX.4.64.0604111518210.10306@gannet.stats.ox.ac.uk>
References: <mailman.9.1144749603.14828.r-devel@r-project.org>
	<Pine.LNX.4.56.0604111441331.29929@thoth.maths.bath.ac.uk>
	<Pine.LNX.4.64.0604111518210.10306@gannet.stats.ox.ac.uk>
Message-ID: <Pine.LNX.4.56.0604111542570.29929@thoth.maths.bath.ac.uk>

> > Currently the `gaussian' family's initialization code signals an error if
> > any response data are zero or negative and a log link is used. Given that
> > zero or negative response data are perfectly legitimate under the GLM
> > fitted using `gaussian("log")', this seems a bit unsatisfactory. Might
> > it be worth changing it?
>
> Well, that's not really true: it says it is unable to find starting
> values, and asks you to provide some.  I don't really see why your choices
> are satisfactory: what happens if all the data are negative for example?

- then the suggested code traps it.

>
> We could try even harder, but code that is almost never used tends to get
> broken whilst no one is testing it.  So if you want to pursue it I think
> we need a comprehensive test suite.

- well, I guess, but I wouldn't have thought that zeros in data modelled
using `gaussian("log")' is such a rare occurance is it? [Or did you mean
that `gaussian("log")' is almost never used, and should hence be kept
simple].

I suppose there are arguments both ways...

best,
Simon

>
> > The current offending code from `gaussian' is:
> >
> > initialize = expression({
> >            n <- rep.int(1, nobs)
> >            if (is.null(etastart) && is.null(start) && is.null(mustart) &&
> >                ((family$link == "inverse" && any(y == 0)) ||
> >                  (family$link == "log" && any(y <= 0)))) stop(
> >              "cannot find valid starting values: please specify some")
> >            mustart <- y
> >        })
> >
> > A possible replacement would be ...
> >
> > initialize = expression({
> >            n <- rep.int(1, nobs)
> >            if (is.null(etastart) && is.null(start) && is.null(mustart) &&
> >                ((family$link == "inverse" && all(y == 0)) ||
> >                  (family$link == "log" && all(y <= 0)))) stop(
> >      "cannot find valid starting values: please specify some")
> >        mustart <- y
> >      if (family$link=="log") {
> >        iy <- y<=0
> >        if (sum(iy)) mustart[iy] <- min(y[!iy])*.5
> >      } else if (family$link=="inverse") {
> >        iy <- y==0
> >        if (sum(iy)) mustart[iy] <- min(abs(y[!iy]))*.5
> >      }
> >        })
> >
> > best,
> > Simon
> >
> >
> >> - Simon Wood, Mathematical Sciences, University of Bath, Bath BA2 7AY
> >> -             +44 (0)1225 386603         www.maths.bath.ac.uk/~sw283/
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >
> >
>
> --
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>


From tlumley at u.washington.edu  Tue Apr 11 16:58:36 2006
From: tlumley at u.washington.edu (Thomas Lumley)
Date: Tue, 11 Apr 2006 07:58:36 -0700 (PDT)
Subject: [Rd] gaussian family change suggestion
In-Reply-To: <Pine.LNX.4.64.0604111518210.10306@gannet.stats.ox.ac.uk>
References: <mailman.9.1144749603.14828.r-devel@r-project.org>
	<Pine.LNX.4.56.0604111441331.29929@thoth.maths.bath.ac.uk>
	<Pine.LNX.4.64.0604111518210.10306@gannet.stats.ox.ac.uk>
Message-ID: <Pine.LNX.4.64.0604110753450.2367@homer22.u.washington.edu>

On Tue, 11 Apr 2006, Prof Brian Ripley wrote:

> On Tue, 11 Apr 2006, Simon Wood wrote:
>
>> Hi,
>>
>> Currently the `gaussian' family's initialization code signals an error if
>> any response data are zero or negative and a log link is used. Given that
>> zero or negative response data are perfectly legitimate under the GLM
>> fitted using `gaussian("log")', this seems a bit unsatisfactory. Might
>> it be worth changing it?
>
> Well, that's not really true: it says it is unable to find starting
> values, and asks you to provide some.  I don't really see why your choices
> are satisfactory: what happens if all the data are negative for example?
> (You get +Inf in the log case, I believe.  The algorithm will probably get
> stuck from a finite starting point, but it will produce a mysterious error
> from an infinite one.)
>
> We could try even harder, but code that is almost never used tends to get
> broken whilst no one is testing it.  So if you want to pursue it I think
> we need a comprehensive test suite.

I have actually been working with log-link glms quite a bit recently and 
was planning to change the defaults.

 	-thomas



>
>> The current offending code from `gaussian' is:
>>
>> initialize = expression({
>>            n <- rep.int(1, nobs)
>>            if (is.null(etastart) && is.null(start) && is.null(mustart) &&
>>                ((family$link == "inverse" && any(y == 0)) ||
>>                  (family$link == "log" && any(y <= 0)))) stop(
>>              "cannot find valid starting values: please specify some")
>>            mustart <- y
>>        })
>>
>> A possible replacement would be ...
>>
>> initialize = expression({
>>            n <- rep.int(1, nobs)
>>            if (is.null(etastart) && is.null(start) && is.null(mustart) &&
>>                ((family$link == "inverse" && all(y == 0)) ||
>>                  (family$link == "log" && all(y <= 0)))) stop(
>>      "cannot find valid starting values: please specify some")
>>        mustart <- y
>>      if (family$link=="log") {
>>        iy <- y<=0
>>        if (sum(iy)) mustart[iy] <- min(y[!iy])*.5
>>      } else if (family$link=="inverse") {
>>        iy <- y==0
>>        if (sum(iy)) mustart[iy] <- min(abs(y[!iy]))*.5
>>      }
>>        })
>>
>> best,
>> Simon
>>
>>
>>> - Simon Wood, Mathematical Sciences, University of Bath, Bath BA2 7AY
>>> -             +44 (0)1225 386603         www.maths.bath.ac.uk/~sw283/
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
>
> -- 
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

Thomas Lumley			Assoc. Professor, Biostatistics
tlumley at u.washington.edu	University of Washington, Seattle


From ripley at stats.ox.ac.uk  Tue Apr 11 16:59:53 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 11 Apr 2006 15:59:53 +0100 (BST)
Subject: [Rd] gaussian family change suggestion
In-Reply-To: <Pine.LNX.4.56.0604111542570.29929@thoth.maths.bath.ac.uk>
References: <mailman.9.1144749603.14828.r-devel@r-project.org>
	<Pine.LNX.4.56.0604111441331.29929@thoth.maths.bath.ac.uk>
	<Pine.LNX.4.64.0604111518210.10306@gannet.stats.ox.ac.uk>
	<Pine.LNX.4.56.0604111542570.29929@thoth.maths.bath.ac.uk>
Message-ID: <Pine.LNX.4.64.0604111557420.14262@gannet.stats.ox.ac.uk>

On Tue, 11 Apr 2006, Simon Wood wrote:

>>> Currently the `gaussian' family's initialization code signals an error if
>>> any response data are zero or negative and a log link is used. Given that
>>> zero or negative response data are perfectly legitimate under the GLM
>>> fitted using `gaussian("log")', this seems a bit unsatisfactory. Might
>>> it be worth changing it?
>>
>> Well, that's not really true: it says it is unable to find starting
>> values, and asks you to provide some.  I don't really see why your choices
>> are satisfactory: what happens if all the data are negative for example?
>
> - then the suggested code traps it.

Yes, but why (it can happen too)?

>> We could try even harder, but code that is almost never used tends to get
>> broken whilst no one is testing it.  So if you want to pursue it I think
>> we need a comprehensive test suite.
>
> - well, I guess, but I wouldn't have thought that zeros in data modelled
> using `gaussian("log")' is such a rare occurance is it? [Or did you mean
> that `gaussian("log")' is almost never used, and should hence be kept
> simple].

I meant initialization code for this case would rarely get used, as I 
suppose those people who do this are used to providing starting values
(or there are few or no such people).

>
> I suppose there are arguments both ways...
>
> best,
> Simon
>
>>
>>> The current offending code from `gaussian' is:
>>>
>>> initialize = expression({
>>>            n <- rep.int(1, nobs)
>>>            if (is.null(etastart) && is.null(start) && is.null(mustart) &&
>>>                ((family$link == "inverse" && any(y == 0)) ||
>>>                  (family$link == "log" && any(y <= 0)))) stop(
>>>              "cannot find valid starting values: please specify some")
>>>            mustart <- y
>>>        })
>>>
>>> A possible replacement would be ...
>>>
>>> initialize = expression({
>>>            n <- rep.int(1, nobs)
>>>            if (is.null(etastart) && is.null(start) && is.null(mustart) &&
>>>                ((family$link == "inverse" && all(y == 0)) ||
>>>                  (family$link == "log" && all(y <= 0)))) stop(
>>>      "cannot find valid starting values: please specify some")
>>>        mustart <- y
>>>      if (family$link=="log") {
>>>        iy <- y<=0
>>>        if (sum(iy)) mustart[iy] <- min(y[!iy])*.5
>>>      } else if (family$link=="inverse") {
>>>        iy <- y==0
>>>        if (sum(iy)) mustart[iy] <- min(abs(y[!iy]))*.5
>>>      }
>>>        })
>>>
>>> best,
>>> Simon
>>>
>>>
>>>> - Simon Wood, Mathematical Sciences, University of Bath, Bath BA2 7AY
>>>> -             +44 (0)1225 386603         www.maths.bath.ac.uk/~sw283/
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>>
>>
>> --
>> Brian D. Ripley,                  ripley at stats.ox.ac.uk
>> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
>> University of Oxford,             Tel:  +44 1865 272861 (self)
>> 1 South Parks Road,                     +44 1865 272866 (PA)
>> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>>
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From edd at debian.org  Tue Apr 11 17:24:30 2006
From: edd at debian.org (Dirk Eddelbuettel)
Date: Tue, 11 Apr 2006 10:24:30 -0500
Subject: [Rd] Bug#361968: Wrong name in manpage
In-Reply-To: <20060411140310.27058.92155.reportbug@kcm.kanru.info>
References: <20060411140310.27058.92155.reportbug@kcm.kanru.info>
Message-ID: <17467.51758.972000.624488@basebud.nulle.part>


Kanru,

Thanks for the bugreport.

On 11 April 2006 at 22:03, Kanru Chen wrote:
| Package: r-base-core
| Version: 2.2.1.svn37668-1
| Severity: minor
| 
| In manpage of /usr/bin/R, the first, fourth and last line shows `VERSION'
| instead of `R'.
|
| I believe it is a typo.

More likely something is wrong with how R.1 is autogenerated using help2man.

Incidentally, that `R --version' now starts its ouput with 'Version' rather
than R had bit us in the RPy builds where the version number was regexp'ed
out of the result, and was still expecting the line to start with R just like
help2man seems to expect the program name first. 

Regards, Dirk


| -- System Information:
| Debian Release: testing/unstable
|   APT prefers unstable
|   APT policy: (500, 'unstable'), (1, 'experimental')
| Architecture: i386 (i686)
| Shell:  /bin/sh linked to /bin/bash
| Kernel: Linux 2.6.16-rc5
| Locale: LANG=en_US.UTF-8, LC_CTYPE=en_US.UTF-8 (charmap=UTF-8) (ignored: LC_ALL set to en_US.UTF-8)
| 
| Versions of packages r-base-core depends on:
| ii  atlas3-base [libblas.so.3 3.6.0-20       Automatically Tuned Linear Algebra
| ii  libbz2-1.0                1.0.3-2        high-quality block-sorting file co
| ii  libc6                     2.3.6-5        GNU C Library: Shared libraries an
| ii  libgcc1                   1:4.1.0-1      GCC support library
| ii  libgfortran0              4.0.3-1        Runtime library for GNU Fortran ap
| ii  libice6                   6.9.0.dfsg.1-6 Inter-Client Exchange library
| ii  libjpeg62                 6b-12          The Independent JPEG Group's JPEG 
| ii  libpaper-utils            1.1.14-7       Library for handling paper charact
| ii  libpcre3                  6.4-1.1        Perl 5 Compatible Regular Expressi
| ii  libpng12-0                1.2.8rel-5.1   PNG library - runtime
| ii  libreadline5              5.1-7          GNU readline and history libraries
| ii  libsm6                    6.9.0.dfsg.1-6 X Window System Session Management
| ii  libx11-6                  6.9.0.dfsg.1-6 X Window System protocol client li
| ii  libxt6                    6.9.0.dfsg.1-6 X Toolkit Intrinsics
| ii  perl                      5.8.8-4        Larry Wall's Practical Extraction 
| ii  refblas3 [libblas.so.3]   1.2-8          Basic Linear Algebra Subroutines 3
| ii  tcl8.4                    8.4.12-1       Tcl (the Tool Command Language) v8
| ii  tk8.4                     8.4.12-1       Tk toolkit for Tcl and X11, v8.4 -
| ii  zlib-bin                  1:1.2.3-11     compression library - sample progr
| ii  zlib1g                    1:1.2.3-11     compression library - runtime
| 
| Versions of packages r-base-core recommends:
| pn  r-base-dev              <none>           (no description available)
| ii  r-recommended           2.2.1.svn37668-1 GNU R collection of recommended pa
| 
| -- no debconf information
| 

-- 
Hell, there are no rules here - we're trying to accomplish something. 
                                                  -- Thomas A. Edison


From sw283 at maths.bath.ac.uk  Tue Apr 11 17:26:03 2006
From: sw283 at maths.bath.ac.uk (Simon Wood)
Date: Tue, 11 Apr 2006 16:26:03 +0100 (BST)
Subject: [Rd] gaussian family change suggestion
In-Reply-To: <Pine.LNX.4.64.0604111557420.14262@gannet.stats.ox.ac.uk>
References: <mailman.9.1144749603.14828.r-devel@r-project.org>
	<Pine.LNX.4.56.0604111441331.29929@thoth.maths.bath.ac.uk>
	<Pine.LNX.4.64.0604111518210.10306@gannet.stats.ox.ac.uk>
	<Pine.LNX.4.56.0604111542570.29929@thoth.maths.bath.ac.uk>
	<Pine.LNX.4.64.0604111557420.14262@gannet.stats.ox.ac.uk>
Message-ID: <Pine.LNX.4.56.0604111617430.29929@thoth.maths.bath.ac.uk>

> >>> Currently the `gaussian' family's initialization code signals an error if
> >>> any response data are zero or negative and a log link is used. Given that
> >>> zero or negative response data are perfectly legitimate under the GLM
> >>> fitted using `gaussian("log")', this seems a bit unsatisfactory. Might
> >>> it be worth changing it?
> >>
> >> Well, that's not really true: it says it is unable to find starting
> >> values, and asks you to provide some.  I don't really see why your choices
> >> are satisfactory: what happens if all the data are negative for example?
> >
> > - then the suggested code traps it.
>
> Yes, but why (it can happen too)?

- isn't this (i.e. all response <=0 ) a case where the MLE's of the
linear predictor must tend to minus infinity? So there's probably  an
argument for handling it differently [although my proposed error message
is not the most informative, since modifying the starting values won't help].

best,
Simon

>
> >> We could try even harder, but code that is almost never used tends to get
> >> broken whilst no one is testing it.  So if you want to pursue it I think
> >> we need a comprehensive test suite.
> >
> > - well, I guess, but I wouldn't have thought that zeros in data modelled
> > using `gaussian("log")' is such a rare occurance is it? [Or did you mean
> > that `gaussian("log")' is almost never used, and should hence be kept
> > simple].
>
> I meant initialization code for this case would rarely get used, as I
> suppose those people who do this are used to providing starting values
> (or there are few or no such people).
>
> >
> > I suppose there are arguments both ways...
> >
> > best,
> > Simon
> >
> >>
> >>> The current offending code from `gaussian' is:
> >>>
> >>> initialize = expression({
> >>>            n <- rep.int(1, nobs)
> >>>            if (is.null(etastart) && is.null(start) && is.null(mustart) &&
> >>>                ((family$link == "inverse" && any(y == 0)) ||
> >>>                  (family$link == "log" && any(y <= 0)))) stop(
> >>>              "cannot find valid starting values: please specify some")
> >>>            mustart <- y
> >>>        })
> >>>
> >>> A possible replacement would be ...
> >>>
> >>> initialize = expression({
> >>>            n <- rep.int(1, nobs)
> >>>            if (is.null(etastart) && is.null(start) && is.null(mustart) &&
> >>>                ((family$link == "inverse" && all(y == 0)) ||
> >>>                  (family$link == "log" && all(y <= 0)))) stop(
> >>>      "cannot find valid starting values: please specify some")
> >>>        mustart <- y
> >>>      if (family$link=="log") {
> >>>        iy <- y<=0
> >>>        if (sum(iy)) mustart[iy] <- min(y[!iy])*.5
> >>>      } else if (family$link=="inverse") {
> >>>        iy <- y==0
> >>>        if (sum(iy)) mustart[iy] <- min(abs(y[!iy]))*.5
> >>>      }
> >>>        })
> >>>
> >>> best,
> >>> Simon
> >>>
> >>>
> >>>> - Simon Wood, Mathematical Sciences, University of Bath, Bath BA2 7AY
> >>>> -             +44 (0)1225 386603         www.maths.bath.ac.uk/~sw283/
> >>>
> >>> ______________________________________________
> >>> R-devel at r-project.org mailing list
> >>> https://stat.ethz.ch/mailman/listinfo/r-devel
> >>>
> >>>
> >>
> >> --
> >> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> >> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> >> University of Oxford,             Tel:  +44 1865 272861 (self)
> >> 1 South Parks Road,                     +44 1865 272866 (PA)
> >> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
> >>
> >
> >
>
> --
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>


From simon.urbanek at r-project.org  Tue Apr 11 17:26:09 2006
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Tue, 11 Apr 2006 11:26:09 -0400
Subject: [Rd] Fwd: makeconf issue on R-devel 2006-03-12 r37524
In-Reply-To: <Pine.LNX.4.64.0604081911560.24503@gannet.stats.ox.ac.uk>
References: <7A5734F6-9584-49D6-933A-2F8AF93AFFBD@uiuc.edu>
	<738521DF-2528-4826-BB1C-04D143AF4BFF@uiuc.edu>
	<Pine.LNX.4.64.0603141922070.784@gannet.stats.ox.ac.uk>
	<60B3FA2F-4268-4C99-9C1F-147DBFB881E3@ysidro.econ.uiuc.edu>
	<Pine.LNX.4.64.0604081911560.24503@gannet.stats.ox.ac.uk>
Message-ID: <14B59062-1BB3-4B87-81C8-9BF74FEECF1F@r-project.org>


On Apr 8, 2006, at 2:27 PM, Prof Brian Ripley wrote:

> On Sat, 8 Apr 2006, roger koenker wrote:
>
>> For what it is worth, I've just installed R-alpha Version 2.3.0 alpha
>> (2006-04-07 r37668)
>> on my G5 and encountered the same problem reported below.  The same
>> treatment
>> got  things going again.  If this reflects some idiosyncrasy in my
>> setup,  my apologies....
>
> Well, no one else is reporting it, and that includes the daily  
> checks run
> by Simon on MacOS X so it is not that no one has tested R-devel for  
> the
> last few weeks (and Simon was involved with the design of this  
> change).
>
> It looks as if 'make install-R-framework' puts a link in bin/exec,  
> which is not supposed to be used for other than front-ends.

This is a relic from the time when the Mac GUI was also started via  
exec/R and the Frameworks subdirectory relative to the binary is  
where dependent frameworks went. It is now obsolete, and can be  
removed. I'm cleaning up the framework install code and tonight's  
nightly build should be ok.

Thanks for spotting this. My package builds used R 2.2 so they didn't  
catch this and make install didn't either. I'll now switch both  
machines to 2.3 so hopefully we'll catch things like that now.

Cheers,
Simon


From duncan at wald.ucdavis.edu  Tue Apr 11 18:49:25 2006
From: duncan at wald.ucdavis.edu (Duncan Temple Lang)
Date: Tue, 11 Apr 2006 09:49:25 -0700
Subject: [Rd] Stack checking, core dumps, and embedding R
In-Reply-To: <1abe3fa90604110234v1b4958c0w1e51e2b49f7ff9c5@mail.gmail.com>
References: <1abe3fa90604110234v1b4958c0w1e51e2b49f7ff9c5@mail.gmail.com>
Message-ID: <443BDE15.208@wald.ucdavis.edu>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1



Hi Tony.
 Just to eliminate things, is the host application
in which R is being embedded doing anything with
the stack, e.g. some lisp system playing with threads
via manipulating the stack?

 D.


A.J. Rossini wrote:
> I will say this first -- I can't copy/paste the error message from the
> screen, so it's being retyped.  Errors might occur.  SORRY.
> 
> I've been experiencing some interesting stack warnings recently when
> moving from R 2.2.x to the R 2.3.0 series and the R 2.4.0 series.  In
> particular, I'm getting warnings of "Error: C stack usage is too close
> to the limit" before segfaulting, and this wasn't happening under the
> 2.2.x series.
> 
> Here's the question statement:  (ONLY) In the situation where one is
> embedding R, is anyone else seeing this occur with recent (past 2
> weeks) versions of R (both the 2.3.x and 2.4.x series)?
> 
> (it doesn't happen in the non-embedded case for me, at least not
> recently -- there was an SVN version recently where I did get that
> behavior in the non-embedded case, but it was "fixed" before I had a
> chance to report).
> 
> I'm still debugging it; hopefully will have a bug report while I'm on
> (working) vacation in the states next week.
> 
> best,
> -tony
> 
> blindglobe at gmail.com
> Muttenz, Switzerland.
> "Commit early,commit often, and commit in a repository from which we can easily
> roll-back your mistakes" (AJR, 4Jan05).
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

- --
Duncan Temple Lang                    duncan at wald.ucdavis.edu
Department of Statistics              work:  (530) 752-4782
4210 Mathematical Sciences Building   fax:   (530) 752-7099
One Shields Ave.
University of California at Davis
Davis,
CA 95616,
USA
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.3 (Darwin)

iD8DBQFEO94V9p/Jzwa2QP4RAnWGAJ91+pwjFx7glZB/AuwCCK+PqszxiQCdHhpf
fKWDQNLmtApXBANkZAZ+NaE=
=34Sm
-----END PGP SIGNATURE-----


From blindglobe at gmail.com  Tue Apr 11 18:53:10 2006
From: blindglobe at gmail.com (A.J. Rossini)
Date: Tue, 11 Apr 2006 18:53:10 +0200
Subject: [Rd] Stack checking, core dumps, and embedding R
In-Reply-To: <443BDE15.208@wald.ucdavis.edu>
References: <1abe3fa90604110234v1b4958c0w1e51e2b49f7ff9c5@mail.gmail.com>
	<443BDE15.208@wald.ucdavis.edu>
Message-ID: <1abe3fa90604110953o5707e9d8y921183611450dc84@mail.gmail.com>

Yep, bingo.  That's what I'm thinking, too.  Except that it's supposed
to be protected at my end.

"Supposed to".


On 4/11/06, Duncan Temple Lang <duncan at wald.ucdavis.edu> wrote:
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
>
>
> Hi Tony.
>  Just to eliminate things, is the host application
> in which R is being embedded doing anything with
> the stack, e.g. some lisp system playing with threads
> via manipulating the stack?
>
>  D.
>
>
> A.J. Rossini wrote:
> > I will say this first -- I can't copy/paste the error message from the
> > screen, so it's being retyped.  Errors might occur.  SORRY.
> >
> > I've been experiencing some interesting stack warnings recently when
> > moving from R 2.2.x to the R 2.3.0 series and the R 2.4.0 series.  In
> > particular, I'm getting warnings of "Error: C stack usage is too close
> > to the limit" before segfaulting, and this wasn't happening under the
> > 2.2.x series.
> >
> > Here's the question statement:  (ONLY) In the situation where one is
> > embedding R, is anyone else seeing this occur with recent (past 2
> > weeks) versions of R (both the 2.3.x and 2.4.x series)?
> >
> > (it doesn't happen in the non-embedded case for me, at least not
> > recently -- there was an SVN version recently where I did get that
> > behavior in the non-embedded case, but it was "fixed" before I had a
> > chance to report).
> >
> > I'm still debugging it; hopefully will have a bug report while I'm on
> > (working) vacation in the states next week.
> >
> > best,
> > -tony
> >
> > blindglobe at gmail.com
> > Muttenz, Switzerland.
> > "Commit early,commit often, and commit in a repository from which we can easily
> > roll-back your mistakes" (AJR, 4Jan05).
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
>
> - --
> Duncan Temple Lang                    duncan at wald.ucdavis.edu
> Department of Statistics              work:  (530) 752-4782
> 4210 Mathematical Sciences Building   fax:   (530) 752-7099
> One Shields Ave.
> University of California at Davis
> Davis,
> CA 95616,
> USA
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v1.4.3 (Darwin)
>
> iD8DBQFEO94V9p/Jzwa2QP4RAnWGAJ91+pwjFx7glZB/AuwCCK+PqszxiQCdHhpf
> fKWDQNLmtApXBANkZAZ+NaE=
> =34Sm
> -----END PGP SIGNATURE-----
>


--
best,
-tony

blindglobe at gmail.com
Muttenz, Switzerland.
"Commit early,commit often, and commit in a repository from which we can easily
roll-back your mistakes" (AJR, 4Jan05).


From jfox at mcmaster.ca  Tue Apr 11 22:02:22 2006
From: jfox at mcmaster.ca (John Fox)
Date: Tue, 11 Apr 2006 16:02:22 -0400
Subject: [Rd] Setting --sdi in R 2.3.0 beta for Windows
Message-ID: <20060411200221.HOBR20622.tomts10-srv.bellnexxia.net@JohnDesktop8300>

Dear r-devel list members,

I find that adding --sdi to the Target field in the short-cut for R is
ineffective in R 2.3.0 beta for Windows (version/platform details below).
Setting MDI = no in the Rconsole file works, however. 

It's probably a bit late to request this for version 2.3.0, but it would be
nice to be able to select either the SDI or MDI in the R Windows installer.

Regards,
 John

--------- snip ------------

Version:
 platform = i386-pc-mingw32
 arch = i386
 os = mingw32
 system = i386, mingw32
 status = beta
 major = 2
 minor = 3.0
 year = 2006
 month = 04
 day = 09
 svn rev = 37687
 language = R
 version.string = Version 2.3.0 beta (2006-04-09 r37687)

Windows XP Professional (build 2600) Service Pack 2.0

Locale:
LC_COLLATE=English_United States.1252;LC_CTYPE=English_United
States.1252;LC_MONETARY=English_United
States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252

Search Path:
 .GlobalEnv, package:methods, package:stats, package:graphics,
package:grDevices, package:utils, package:datasets, Autoloads, package:base

--------------------------------
John Fox
Department of Sociology
McMaster University
Hamilton, Ontario
Canada L8S 4M4
905-525-9140x23604
http://socserv.mcmaster.ca/jfox


From blindglobe at gmail.com  Tue Apr 11 22:12:03 2006
From: blindglobe at gmail.com (A.J. Rossini)
Date: Tue, 11 Apr 2006 22:12:03 +0200
Subject: [Rd] Stack checking, core dumps, and embedding R
In-Reply-To: <Pine.LNX.4.64.0604111121440.30083@gannet.stats.ox.ac.uk>
References: <1abe3fa90604110234v1b4958c0w1e51e2b49f7ff9c5@mail.gmail.com>
	<Pine.LNX.4.64.0604111121440.30083@gannet.stats.ox.ac.uk>
Message-ID: <1abe3fa90604111312x177f6e4ds4e66b813c9833a00@mail.gmail.com>

On 4/11/06, Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
> On Tue, 11 Apr 2006, A.J. Rossini wrote:
>
> > I will say this first -- I can't copy/paste the error message from the
> > screen, so it's being retyped.  Errors might occur.  SORRY.
> >
> > I've been experiencing some interesting stack warnings recently when
> > moving from R 2.2.x to the R 2.3.0 series and the R 2.4.0 series.  In
> > particular, I'm getting warnings of "Error: C stack usage is too close
> > to the limit" before segfaulting, and this wasn't happening under the
> > 2.2.x series.

Okay, using 2-2-patched, I'm fine.

Using 2-3-patched and R-devel, I'm not fine (stack warnings and segfaulting).

What is the precise incantation for setting the stack?   using
"--max-ppsize=N"    didn't seem to help my problem (for values of N of
5000, 25000, 50000 -- should I try others?)

(This is under SBCL, i.e. satisfying Duncan's conjectures -- as soon
as I fix a few things (i.e. undoing CommonLispStat/R's threading which
is a bit SBCL specific, I'll try under CLISP, ECL, and CMUCL to
verify/check).

best,
-tony

blindglobe at gmail.com
Muttenz, Switzerland.
"Commit early,commit often, and commit in a repository from which we can easily
roll-back your mistakes" (AJR, 4Jan05).


From jmc at r-project.org  Tue Apr 11 22:22:50 2006
From: jmc at r-project.org (John Chambers)
Date: Tue, 11 Apr 2006 16:22:50 -0400
Subject: [Rd] [R] type converters not being saved to workspace
In-Reply-To: <Pine.LNX.4.64.0604090958440.5192@gannet.stats.ox.ac.uk>
References: <200604090322.10067.joe@gnacademy.org>
	<Pine.LNX.4.64.0604090958440.5192@gannet.stats.ox.ac.uk>
Message-ID: <443C101A.4050507@r-project.org>

(diverted to r-devel)

The problem seems to be rather that loading of the saved image takes 
place _after_ the packages are attached.  So nothing that the methods 
package does in its initialization will see the relevant type converters 
or other methods objects.

More generally, loading into .GlobalEnv will never cause the equivalent 
of cacheMetaData(.GlobalEnv).

It would be possible to hack the C code in main/saveload.c to generate a 
call to cacheMetaData under the right circumstances, but is that the 
best solution? 

Intuitively, it's the objects containing the method/class definitions 
that should trigger actions when they are loaded (emulating what happens 
when the corresponding setMethod or setClass function call takes 
place).  I.e., a load method for these classes of objects.  Possible?

It might be better, now that we're past feature freeze, to leave this as 
a "design infelicity" for the upcoming release.


Prof Brian Ripley wrote:

> It is recommended that you use a package for this sort of thing.
>
> When a package is loaded, the S4 methods it contains are merged into 
> the metadata.  When the global environment is loaded, they are not.  
> Call 'cacheMetaData(1)' to do so.
>
> [This looks like a bug: cacheMetaData is called on .GlobalEnv in the 
> startup code for package methods, but seems not to work when called 
> from there.  I think this is because package methods is not at that 
> point on the search path (the call is from .onLoad) and hence the 
> coerce() generic is not visible to cacheMetaData.  If you have S4 code 
> in a package, it will ensure that package methods is attached before 
> your package is loaded.]
>
> On Sun, 9 Apr 2006, Joseph Wang wrote:
>
>> Any one can explain why this happens or any work arounds?
>>
>>> setClass('foo')
>>
>> [1] "foo"
>>
>>> setAs('foo', 'character', function(from) from)
>>> showMethods('coerce')
>>
>>
>> Function "coerce":
>> from = "ANY", to = "array"
>> from = "ANY", to = "call"
>> from = "ANY", to = "character"
>> from = "ANY", to = "complex"
>> from = "ANY", to = "environment"
>> from = "ANY", to = "expression"
>> from = "ANY", to = "function"
>> from = "ANY", to = "integer"
>> from = "ANY", to = "list"
>> from = "ANY", to = "logical"
>> from = "ANY", to = "matrix"
>> from = "ANY", to = "name"
>> from = "ANY", to = "numeric"
>> from = "ANY", to = "single"
>> from = "ANY", to = "ts"
>> from = "ANY", to = "vector"
>> from = "ANY", to = "NULL"
>> from = "foo", to = "character"
>>
>>> q()
>>
>> Save workspace image? [y/n/c]: y
>>
>>
>> (restart)
>>
>>> showMethods('coerce')
>>
>>
>> Function "coerce":
>> from = "ANY", to = "array"
>> from = "ANY", to = "call"
>> from = "ANY", to = "character"
>> from = "ANY", to = "complex"
>> from = "ANY", to = "environment"
>> from = "ANY", to = "expression"
>> from = "ANY", to = "function"
>> from = "ANY", to = "integer"
>> from = "ANY", to = "list"
>> from = "ANY", to = "logical"
>> from = "ANY", to = "matrix"
>> from = "ANY", to = "name"
>> from = "ANY", to = "numeric"
>> from = "ANY", to = "single"
>> from = "ANY", to = "ts"
>> from = "ANY", to = "vector"
>> from = "ANY", to = "NULL"
>> from = "NULL", to = "OptionalFunction"
>>
>>>
>>
>> ______________________________________________
>> R-help at stat.math.ethz.ch mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-help
>> PLEASE do read the posting guide! 
>> http://www.R-project.org/posting-guide.html
>>
>


From tlumley at u.washington.edu  Tue Apr 11 22:23:42 2006
From: tlumley at u.washington.edu (Thomas Lumley)
Date: Tue, 11 Apr 2006 13:23:42 -0700 (PDT)
Subject: [Rd] Stack checking, core dumps, and embedding R
In-Reply-To: <1abe3fa90604111312x177f6e4ds4e66b813c9833a00@mail.gmail.com>
References: <1abe3fa90604110234v1b4958c0w1e51e2b49f7ff9c5@mail.gmail.com>
	<Pine.LNX.4.64.0604111121440.30083@gannet.stats.ox.ac.uk>
	<1abe3fa90604111312x177f6e4ds4e66b813c9833a00@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0604111319060.10029@homer22.u.washington.edu>

On Tue, 11 Apr 2006, A.J. Rossini wrote:

> On 4/11/06, Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
>> On Tue, 11 Apr 2006, A.J. Rossini wrote:
>>
>>> I will say this first -- I can't copy/paste the error message from the
>>> screen, so it's being retyped.  Errors might occur.  SORRY.
>>>
>>> I've been experiencing some interesting stack warnings recently when
>>> moving from R 2.2.x to the R 2.3.0 series and the R 2.4.0 series.  In
>>> particular, I'm getting warnings of "Error: C stack usage is too close
>>> to the limit" before segfaulting, and this wasn't happening under the
>>> 2.2.x series.
>
> Okay, using 2-2-patched, I'm fine.
> Using 2-3-patched and R-devel, I'm not fine (stack warnings and segfaulting).

The 2.2.x series didn't have the stack checker -- it was added for 2.3.0 
-- so you would expect the stack warnings to be limited to 2.3.x (though 
not necessarily the segfaults)

>
> What is the precise incantation for setting the stack?   using
> "--max-ppsize=N"    didn't seem to help my problem (for values of N of
> 5000, 25000, 50000 -- should I try others?)

No, it's the C stack, not the R pointer protection stack.

With tcsh this is
   limits stacksize 50000 
or ulimit with bash


 	-thomas

Thomas Lumley			Assoc. Professor, Biostatistics
tlumley at u.washington.edu	University of Washington, Seattle


From murdoch at stats.uwo.ca  Tue Apr 11 22:34:56 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Tue, 11 Apr 2006 16:34:56 -0400
Subject: [Rd] Setting --sdi in R 2.3.0 beta for Windows
In-Reply-To: <20060411200221.HOBR20622.tomts10-srv.bellnexxia.net@JohnDesktop8300>
References: <20060411200221.HOBR20622.tomts10-srv.bellnexxia.net@JohnDesktop8300>
Message-ID: <443C12F0.3070007@stats.uwo.ca>

On 4/11/2006 4:02 PM, John Fox wrote:
> Dear r-devel list members,
> 
> I find that adding --sdi to the Target field in the short-cut for R is
> ineffective in R 2.3.0 beta for Windows (version/platform details below).
> Setting MDI = no in the Rconsole file works, however. 

Thanks, I'll fix that.

> It's probably a bit late to request this for version 2.3.0, but it would be
> nice to be able to select either the SDI or MDI in the R Windows installer.

It's hard to make changes to the installer because of the many 
translations of installer messages that are required.  I'd say it's now 
too late to ask the translators for a new translation for 2.3.0.

Duncan
> 
> Regards,
>  John
> 
> --------- snip ------------
> 
> Version:
>  platform = i386-pc-mingw32
>  arch = i386
>  os = mingw32
>  system = i386, mingw32
>  status = beta
>  major = 2
>  minor = 3.0
>  year = 2006
>  month = 04
>  day = 09
>  svn rev = 37687
>  language = R
>  version.string = Version 2.3.0 beta (2006-04-09 r37687)
> 
> Windows XP Professional (build 2600) Service Pack 2.0
> 
> Locale:
> LC_COLLATE=English_United States.1252;LC_CTYPE=English_United
> States.1252;LC_MONETARY=English_United
> States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252
> 
> Search Path:
>  .GlobalEnv, package:methods, package:stats, package:graphics,
> package:grDevices, package:utils, package:datasets, Autoloads, package:base
> 
> --------------------------------
> John Fox
> Department of Sociology
> McMaster University
> Hamilton, Ontario
> Canada L8S 4M4
> 905-525-9140x23604
> http://socserv.mcmaster.ca/jfox
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From jfox at mcmaster.ca  Tue Apr 11 23:19:33 2006
From: jfox at mcmaster.ca (John Fox)
Date: Tue, 11 Apr 2006 17:19:33 -0400
Subject: [Rd] Setting --sdi in R 2.3.0 beta for Windows
In-Reply-To: <443C12F0.3070007@stats.uwo.ca>
Message-ID: <20060411211932.OYUM1543.tomts43-srv.bellnexxia.net@JohnDesktop8300>

Dear Duncan,

> -----Original Message-----
> From: r-devel-bounces at r-project.org 
> [mailto:r-devel-bounces at r-project.org] On Behalf Of Duncan Murdoch
> Sent: Tuesday, April 11, 2006 3:35 PM
> To: John Fox
> Cc: r-devel at stat.math.ethz.ch
> Subject: Re: [Rd] Setting --sdi in R 2.3.0 beta for Windows
> 
> On 4/11/2006 4:02 PM, John Fox wrote:
> > Dear r-devel list members,
> > 
> > I find that adding --sdi to the Target field in the 
> short-cut for R is 
> > ineffective in R 2.3.0 beta for Windows (version/platform 
> details below).
> > Setting MDI = no in the Rconsole file works, however. 
> 
> Thanks, I'll fix that.
> 
> > It's probably a bit late to request this for version 2.3.0, but it 
> > would be nice to be able to select either the SDI or MDI in 
> the R Windows installer.
> 
> It's hard to make changes to the installer because of the 
> many translations of installer messages that are required.  
> I'd say it's now too late to ask the translators for a new 
> translation for 2.3.0.
> 

I'm not surprised. Perhaps this can be a feature request for the next
version.

I'm sorry that I didn't think of this earlier.

John

> Duncan
> > 
> > Regards,
> >  John
> > 
> > --------- snip ------------
> > 
> > Version:
> >  platform = i386-pc-mingw32
> >  arch = i386
> >  os = mingw32
> >  system = i386, mingw32
> >  status = beta
> >  major = 2
> >  minor = 3.0
> >  year = 2006
> >  month = 04
> >  day = 09
> >  svn rev = 37687
> >  language = R
> >  version.string = Version 2.3.0 beta (2006-04-09 r37687)
> > 
> > Windows XP Professional (build 2600) Service Pack 2.0
> > 
> > Locale:
> > LC_COLLATE=English_United States.1252;LC_CTYPE=English_United
> > States.1252;LC_MONETARY=English_United
> > States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252
> > 
> > Search Path:
> >  .GlobalEnv, package:methods, package:stats, package:graphics, 
> > package:grDevices, package:utils, package:datasets, Autoloads, 
> > package:base
> > 
> > --------------------------------
> > John Fox
> > Department of Sociology
> > McMaster University
> > Hamilton, Ontario
> > Canada L8S 4M4
> > 905-525-9140x23604
> > http://socserv.mcmaster.ca/jfox
> > 
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From edd at debian.org  Wed Apr 12 01:45:49 2006
From: edd at debian.org (Dirk Eddelbuettel)
Date: Tue, 11 Apr 2006 18:45:49 -0500
Subject: [Rd] Bug#361968: Wrong name in manpage
In-Reply-To: <17467.51758.972000.624488@basebud.nulle.part>
References: <20060411140310.27058.92155.reportbug@kcm.kanru.info>
	<17467.51758.972000.624488@basebud.nulle.part>
Message-ID: <17468.16301.844738.161949@basebud.nulle.part>


R-devel'ers, 

On 11 April 2006 at 10:24, Dirk Eddelbuettel wrote:
| 
| Kanru,
| 
| Thanks for the bugreport.
| 
| On 11 April 2006 at 22:03, Kanru Chen wrote:
| | Package: r-base-core
| | Version: 2.2.1.svn37668-1
| | Severity: minor
| | 
| | In manpage of /usr/bin/R, the first, fourth and last line shows `VERSION'
| | instead of `R'.

I haven't seen any follow-up yet -- here is what it looks like (cut and
pasted from Emacs man page viewer) and note the 'Version' in place of R:

VERSION(1)                            FSF                           VERSION(1)

NAME
       Version - a language for data analysis and graphics

SYNOPSIS
       R [options] [< infile] [> outfile]
       R CMD command [arguments]

DESCRIPTION
       Start  R,  a  system for statistical computation and graphics, with the
       specified options, or invoke an R tool via the 'R CMD' interface.
[...]


| | I believe it is a typo.
| 
| More likely something is wrong with how R.1 is autogenerated using help2man.
| 
| Incidentally, that `R --version' now starts its ouput with 'Version' rather
| than R had bit us in the RPy builds where the version number was regexp'ed
| out of the result, and was still expecting the line to start with R just like
| help2man seems to expect the program name first. 

It seems to stem from src/main/version.c:

void attribute_hidden PrintVersionString(char *s)
{
    if(strcmp(R_SVN_REVISION, "unknown")==0)
    {
        sprintf(s, "Version %s.%s %s (%s-%s-%s)",
                R_MAJOR, R_MINOR, R_STATUS, R_YEAR, R_MONTH, R_DAY);
    }
    else{
	if(strlen(R_STATUS)==0){
	    sprintf(s, "Version %s.%s (%s-%s-%s)",
		    R_MAJOR, R_MINOR, R_YEAR, R_MONTH, R_DAY);
	}
	else{
	    sprintf(s, "Version %s.%s %s (%s-%s-%s r%s)",
		    R_MAJOR, R_MINOR, R_STATUS, R_YEAR, R_MONTH, R_DAY,
		    R_SVN_REVISION);
	}
    }
}

Would replacing 'Version ...' with 'R (Version ...)' be an acceptable
alternative ?

Dirk


-- 
Hell, there are no rules here - we're trying to accomplish something. 
                                                  -- Thomas A. Edison


From simon.urbanek at r-project.org  Wed Apr 12 02:35:53 2006
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Tue, 11 Apr 2006 20:35:53 -0400
Subject: [Rd] Stack checking, core dumps, and embedding R
In-Reply-To: <1abe3fa90604110234v1b4958c0w1e51e2b49f7ff9c5@mail.gmail.com>
References: <1abe3fa90604110234v1b4958c0w1e51e2b49f7ff9c5@mail.gmail.com>
Message-ID: <E725DDAC-4044-4A6E-B9F6-007FAF7225DA@r-project.org>

On Apr 11, 2006, at 5:34 AM, A.J. Rossini wrote:

> I've been experiencing some interesting stack warnings recently  
> when moving from R 2.2.x to the R 2.3.0 series and the R 2.4.0  
> series.  In particular, I'm getting warnings of "Error: C stack  
> usage is too close to the limit" before segfaulting, and this  
> wasn't happening under the 2.2.x series.
>
> Here's the question statement:  (ONLY) In the situation where one  
> is embedding R, is anyone else seeing this occur with recent (past  
> 2 weeks) versions of R (both the 2.3.x and 2.4.x series)?
>

When embedding R, the stack base is set to -1 (which is almost  
certainly wrong) if R cannot find the stack base using some system  
method. I have just fixed the detection for OS X, so you shouldn't  
get that message there anymore. However, I was wondering why to not  
set it to something reasonable - even if we are not the main  
application, IMHO less harm is done setting it to something based on  
the current stack pointer than using -1. The status quo relies on the  
embedding application to set the stack base - I don't know if that's  
a good idea. Opinions?

Cheers,
Simon


From murdoch at stats.uwo.ca  Wed Apr 12 02:56:27 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Tue, 11 Apr 2006 20:56:27 -0400
Subject: [Rd] Bug#361968: Wrong name in manpage
In-Reply-To: <17468.16301.844738.161949@basebud.nulle.part>
References: <20060411140310.27058.92155.reportbug@kcm.kanru.info>	<17467.51758.972000.624488@basebud.nulle.part>
	<17468.16301.844738.161949@basebud.nulle.part>
Message-ID: <443C503B.1000706@stats.uwo.ca>

On 4/11/2006 7:45 PM, Dirk Eddelbuettel wrote:
> R-devel'ers, 
> 
> On 11 April 2006 at 10:24, Dirk Eddelbuettel wrote:
> | 
> | Kanru,
> | 
> | Thanks for the bugreport.
> | 
> | On 11 April 2006 at 22:03, Kanru Chen wrote:
> | | Package: r-base-core
> | | Version: 2.2.1.svn37668-1
> | | Severity: minor
> | | 
> | | In manpage of /usr/bin/R, the first, fourth and last line shows `VERSION'
> | | instead of `R'.
> 
> I haven't seen any follow-up yet -- here is what it looks like (cut and
> pasted from Emacs man page viewer) and note the 'Version' in place of R:
> 
> VERSION(1)                            FSF                           VERSION(1)
> 
> NAME
>        Version - a language for data analysis and graphics
> 
> SYNOPSIS
>        R [options] [< infile] [> outfile]
>        R CMD command [arguments]
> 
> DESCRIPTION
>        Start  R,  a  system for statistical computation and graphics, with the
>        specified options, or invoke an R tool via the 'R CMD' interface.
> [...]
> 
> 
> | | I believe it is a typo.
> | 
> | More likely something is wrong with how R.1 is autogenerated using help2man.
> | 
> | Incidentally, that `R --version' now starts its ouput with 'Version' rather
> | than R had bit us in the RPy builds where the version number was regexp'ed
> | out of the result, and was still expecting the line to start with R just like
> | help2man seems to expect the program name first. 
> 
> It seems to stem from src/main/version.c:
> 
> void attribute_hidden PrintVersionString(char *s)
> {
>     if(strcmp(R_SVN_REVISION, "unknown")==0)
>     {
>         sprintf(s, "Version %s.%s %s (%s-%s-%s)",
>                 R_MAJOR, R_MINOR, R_STATUS, R_YEAR, R_MONTH, R_DAY);
>     }
>     else{
> 	if(strlen(R_STATUS)==0){
> 	    sprintf(s, "Version %s.%s (%s-%s-%s)",
> 		    R_MAJOR, R_MINOR, R_YEAR, R_MONTH, R_DAY);
> 	}
> 	else{
> 	    sprintf(s, "Version %s.%s %s (%s-%s-%s r%s)",
> 		    R_MAJOR, R_MINOR, R_STATUS, R_YEAR, R_MONTH, R_DAY,
> 		    R_SVN_REVISION);
> 	}
>     }
> }
> 
> Would replacing 'Version ...' with 'R (Version ...)' be an acceptable
> alternative ?

I think the problem is that PrintVersion (a few lines up from there) 
used to put the R in front; PrintVersionString doesn't include the R. 
PrintVersionString is called from other places where the R would not be 
appropriate, but PrintVersion is only called when acting on `R 
--version' or synonyms.

Fritz, I think this was your change in r36923 a few months ago.  Do you 
have time to deal with it?

Duncan


From jeff.horner at vanderbilt.edu  Wed Apr 12 06:46:51 2006
From: jeff.horner at vanderbilt.edu (Jeffrey Horner)
Date: Tue, 11 Apr 2006 23:46:51 -0500
Subject: [Rd] Stack checking, core dumps, and embedding R
In-Reply-To: <E725DDAC-4044-4A6E-B9F6-007FAF7225DA@r-project.org>
References: <1abe3fa90604110234v1b4958c0w1e51e2b49f7ff9c5@mail.gmail.com>
	<E725DDAC-4044-4A6E-B9F6-007FAF7225DA@r-project.org>
Message-ID: <443C863B.8030700@vanderbilt.edu>

Simon Urbanek wrote:
> On Apr 11, 2006, at 5:34 AM, A.J. Rossini wrote:
> 
>> I've been experiencing some interesting stack warnings recently  
>> when moving from R 2.2.x to the R 2.3.0 series and the R 2.4.0  
>> series.  In particular, I'm getting warnings of "Error: C stack  
>> usage is too close to the limit" before segfaulting, and this  
>> wasn't happening under the 2.2.x series.
>>
>> Here's the question statement:  (ONLY) In the situation where one  
>> is embedding R, is anyone else seeing this occur with recent (past  
>> 2 weeks) versions of R (both the 2.3.x and 2.4.x series)?
>>
> 
> When embedding R, the stack base is set to -1 (which is almost  
> certainly wrong) if R cannot find the stack base using some system  
> method. I have just fixed the detection for OS X, so you shouldn't  

My question may be unrelated, but I stumbled across it while trying to 
understand the above problem. The following is from R-trunk r37731 
src/unix/system.c in Rf_initialize_R() and is run when the os is neither 
linux nor freebsd:

     if(R_running_as_main_program) {
     /* This is not the main program, but unless embedded it is
        near the top, 5540 bytes away when checked. */
     R_CStackStart = (uintptr_t) &i + 6000;
     }

This is run before we know which direction the stack grows:

     {
         int ii;
     /* 1 is downwards */
         R_CStackDir = ((uintptr_t)&i > (uintptr_t)&ii) ? 1 : -1;
     }

So, R_CStackStart is being set to the address of i (on the stack) plus 
6000 bytes, an approximation to somewhere near the beginning of the 
stack, but this presumes the stack grows down, right? What if it grows 
up? Then shouldn't we subtract 6000 bytes?

> get that message there anymore. However, I was wondering why to not  
> set it to something reasonable - even if we are not the main  
> application, IMHO less harm is done setting it to something based on  
> the current stack pointer than using -1. The status quo relies on the  
> embedding application to set the stack base - I don't know if that's  
> a good idea. Opinions?
> 
> Cheers,
> Simon
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Jeffrey Horner       Computer Systems Analyst         School of Medicine
615-322-8606         Department of Biostatistics   Vanderbilt University


From blindglobe at gmail.com  Wed Apr 12 06:47:37 2006
From: blindglobe at gmail.com (A.J. Rossini)
Date: Wed, 12 Apr 2006 06:47:37 +0200
Subject: [Rd] Stack checking, core dumps, and embedding R
In-Reply-To: <E725DDAC-4044-4A6E-B9F6-007FAF7225DA@r-project.org>
References: <1abe3fa90604110234v1b4958c0w1e51e2b49f7ff9c5@mail.gmail.com>
	<E725DDAC-4044-4A6E-B9F6-007FAF7225DA@r-project.org>
Message-ID: <1abe3fa90604112147k7fd60700n7ad30a7409364621@mail.gmail.com>

On 4/12/06, Simon Urbanek <simon.urbanek at r-project.org> wrote:
> On Apr 11, 2006, at 5:34 AM, A.J. Rossini wrote:
>
> > I've been experiencing some interesting stack warnings recently
> > when moving from R 2.2.x to the R 2.3.0 series and the R 2.4.0
> > series.  In particular, I'm getting warnings of "Error: C stack
> > usage is too close to the limit" before segfaulting, and this
> > wasn't happening under the 2.2.x series.
> >
> > Here's the question statement:  (ONLY) In the situation where one
> > is embedding R, is anyone else seeing this occur with recent (past
> > 2 weeks) versions of R (both the 2.3.x and 2.4.x series)?
> >
>
> When embedding R, the stack base is set to -1 (which is almost
> certainly wrong) if R cannot find the stack base using some system
> method. I have just fixed the detection for OS X, so you shouldn't
> get that message there anymore. However, I was wondering why to not
> set it to something reasonable - even if we are not the main
> application, IMHO less harm is done setting it to something based on
> the current stack pointer than using -1. The status quo relies on the
> embedding application to set the stack base - I don't know if that's
> a good idea. Opinions?

Ah...   I see what you mean, Simon, which would explain the stack #'s
I was popping out (I'd changed the warning which occurs when stack is
within 5% (?) of max, to show me what it was talking about -- also,
your point explains why this happens nearly immediately.

Thanks all, I'd forgotten about ulimits.
best,
-tony

blindglobe at gmail.com
Muttenz, Switzerland.
"Commit early,commit often, and commit in a repository from which we can easily
roll-back your mistakes" (AJR, 4Jan05).


From ripley at stats.ox.ac.uk  Wed Apr 12 07:43:22 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 12 Apr 2006 06:43:22 +0100 (BST)
Subject: [Rd] Stack checking, core dumps, and embedding R
In-Reply-To: <E725DDAC-4044-4A6E-B9F6-007FAF7225DA@r-project.org>
References: <1abe3fa90604110234v1b4958c0w1e51e2b49f7ff9c5@mail.gmail.com>
	<E725DDAC-4044-4A6E-B9F6-007FAF7225DA@r-project.org>
Message-ID: <Pine.LNX.4.64.0604120640540.31187@gannet.stats.ox.ac.uk>

On Tue, 11 Apr 2006, Simon Urbanek wrote:

> On Apr 11, 2006, at 5:34 AM, A.J. Rossini wrote:
>
>> I've been experiencing some interesting stack warnings recently
>> when moving from R 2.2.x to the R 2.3.0 series and the R 2.4.0
>> series.  In particular, I'm getting warnings of "Error: C stack
>> usage is too close to the limit" before segfaulting, and this
>> wasn't happening under the 2.2.x series.
>>
>> Here's the question statement:  (ONLY) In the situation where one
>> is embedding R, is anyone else seeing this occur with recent (past
>> 2 weeks) versions of R (both the 2.3.x and 2.4.x series)?
>>
>
> When embedding R, the stack base is set to -1 (which is almost
> certainly wrong) if R cannot find the stack base using some system
> method.

Setting it to -1 means stack checking is disabled, so _no_ harm is done.
The test is

     if(R_CStackLimit != -1 && usage > 0.95 * R_CStackLimit) {

in errors.c.

> I have just fixed the detection for OS X, so you shouldn't
> get that message there anymore. However, I was wondering why to not
> set it to something reasonable - even if we are not the main
> application, IMHO less harm is done setting it to something based on
> the current stack pointer than using -1. The status quo relies on the
> embedding application to set the stack base - I don't know if that's
> a good idea. Opinions?

Wrong premise, wrong conclusion.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Wed Apr 12 07:45:38 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 12 Apr 2006 06:45:38 +0100 (BST)
Subject: [Rd] Stack checking, core dumps, and embedding R
In-Reply-To: <443C863B.8030700@vanderbilt.edu>
References: <1abe3fa90604110234v1b4958c0w1e51e2b49f7ff9c5@mail.gmail.com>
	<E725DDAC-4044-4A6E-B9F6-007FAF7225DA@r-project.org>
	<443C863B.8030700@vanderbilt.edu>
Message-ID: <Pine.LNX.4.64.0604120643590.31187@gannet.stats.ox.ac.uk>

On Tue, 11 Apr 2006, Jeffrey Horner wrote:

> Simon Urbanek wrote:
>> On Apr 11, 2006, at 5:34 AM, A.J. Rossini wrote:
>>
>>> I've been experiencing some interesting stack warnings recently
>>> when moving from R 2.2.x to the R 2.3.0 series and the R 2.4.0
>>> series.  In particular, I'm getting warnings of "Error: C stack
>>> usage is too close to the limit" before segfaulting, and this
>>> wasn't happening under the 2.2.x series.
>>>
>>> Here's the question statement:  (ONLY) In the situation where one
>>> is embedding R, is anyone else seeing this occur with recent (past
>>> 2 weeks) versions of R (both the 2.3.x and 2.4.x series)?
>>>
>>
>> When embedding R, the stack base is set to -1 (which is almost
>> certainly wrong) if R cannot find the stack base using some system
>> method. I have just fixed the detection for OS X, so you shouldn't
>
> My question may be unrelated, but I stumbled across it while trying to
> understand the above problem. The following is from R-trunk r37731
> src/unix/system.c in Rf_initialize_R() and is run when the os is neither
> linux nor freebsd:
>
>     if(R_running_as_main_program) {
>     /* This is not the main program, but unless embedded it is
>        near the top, 5540 bytes away when checked. */
>     R_CStackStart = (uintptr_t) &i + 6000;
>     }
>
> This is run before we know which direction the stack grows:
>
>     {
>         int ii;
>     /* 1 is downwards */
>         R_CStackDir = ((uintptr_t)&i > (uintptr_t)&ii) ? 1 : -1;
>     }
>
> So, R_CStackStart is being set to the address of i (on the stack) plus
> 6000 bytes, an approximation to somewhere near the beginning of the
> stack, but this presumes the stack grows down, right? What if it grows
> up? Then shouldn't we subtract 6000 bytes?

Probably, but is 12000 bytes important (stack sizes are around 10Mb)?
Do you know of an R platform on which it grows up, BTW (I don't)?

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Wed Apr 12 07:57:03 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 12 Apr 2006 06:57:03 +0100 (BST)
Subject: [Rd] Stack checking, core dumps, and embedding R
In-Reply-To: <Pine.LNX.4.64.0604120640540.31187@gannet.stats.ox.ac.uk>
References: <1abe3fa90604110234v1b4958c0w1e51e2b49f7ff9c5@mail.gmail.com>
	<E725DDAC-4044-4A6E-B9F6-007FAF7225DA@r-project.org>
	<Pine.LNX.4.64.0604120640540.31187@gannet.stats.ox.ac.uk>
Message-ID: <Pine.LNX.4.64.0604120648590.31187@gannet.stats.ox.ac.uk>

On Wed, 12 Apr 2006, Prof Brian Ripley wrote:

> On Tue, 11 Apr 2006, Simon Urbanek wrote:
>
>> On Apr 11, 2006, at 5:34 AM, A.J. Rossini wrote:
>>
>>> I've been experiencing some interesting stack warnings recently
>>> when moving from R 2.2.x to the R 2.3.0 series and the R 2.4.0
>>> series.  In particular, I'm getting warnings of "Error: C stack
>>> usage is too close to the limit" before segfaulting, and this
>>> wasn't happening under the 2.2.x series.
>>>
>>> Here's the question statement:  (ONLY) In the situation where one
>>> is embedding R, is anyone else seeing this occur with recent (past
>>> 2 weeks) versions of R (both the 2.3.x and 2.4.x series)?
>>>
>>
>> When embedding R, the stack base is set to -1 (which is almost
>> certainly wrong) if R cannot find the stack base using some system
>> method.
>
> Setting it to -1 means stack checking is disabled, so _no_ harm is done.
> The test is
>
>     if(R_CStackLimit != -1 && usage > 0.95 * R_CStackLimit) {
>
> in errors.c.
>
>> I have just fixed the detection for OS X, so you shouldn't
>> get that message there anymore. However, I was wondering why to not
>> set it to something reasonable - even if we are not the main
>> application, IMHO less harm is done setting it to something based on
>> the current stack pointer than using -1. The status quo relies on the
>> embedding application to set the stack base - I don't know if that's
>> a good idea. Opinions?
>
> Wrong premise, wrong conclusion.

Sorry, I misunderstood this (we don't use 'base'): I guess you mean if 
R_CStackStart is unset, it defaults to -1.  In that case the intention was 
that R_CStackLimit be set to -1.  It seems that has dropped off, and I 
have reinstated it.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Wed Apr 12 08:28:35 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 12 Apr 2006 07:28:35 +0100 (BST)
Subject: [Rd] [R] type converters not being saved to workspace
In-Reply-To: <443C101A.4050507@r-project.org>
References: <200604090322.10067.joe@gnacademy.org>
	<Pine.LNX.4.64.0604090958440.5192@gannet.stats.ox.ac.uk>
	<443C101A.4050507@r-project.org>
Message-ID: <Pine.LNX.4.64.0604120657220.31187@gannet.stats.ox.ac.uk>

On Tue, 11 Apr 2006, John Chambers wrote:

> (diverted to r-devel)
>
> The problem seems to be rather that loading of the saved image takes place 
> _after_ the packages are attached.  So nothing that the methods package does 
> in its initialization will see the relevant type converters or other methods 
> objects.

I am sorry, but that is not the case: see ?Startup. The image is loaded 
_before_ the packages are attached (as documented).  You can check 
explicitly by

env R_DEFAULT_PACKAGES=NULL R --restore
# R starts and loads the workspace
> library(methods)

and it still does not work (as I had tried before answering).

> More generally, loading into .GlobalEnv will never cause the equivalent of 
> cacheMetaData(.GlobalEnv).
>
> It would be possible to hack the C code in main/saveload.c to generate a call 
> to cacheMetaData under the right circumstances, but is that the best 
> solution? 
> Intuitively, it's the objects containing the method/class definitions that 
> should trigger actions when they are loaded (emulating what happens when the 
> corresponding setMethod or setClass function call takes place).  I.e., a load 
> method for these classes of objects.  Possible?

Yes, but it will not help here as the objects are loaded without methods 
being loaded.

I hope one day when we have S4 objects marked in the object headers that 
loading such an object will load and attach the methods package.

> It might be better, now that we're past feature freeze, to leave this as a 
> "design infelicity" for the upcoming release.

Definitely.

I think that package methods needs to cache metadata in its .onAttach not 
.onLoad.  In principle it affects anything setting methods for generics in 
package:methods, but if this is done in a package, the dependency on 
methods will ensure that methods is loaded before the package, and then 
library() will run cacheMetaData on the package.


> Prof Brian Ripley wrote:
>
>> It is recommended that you use a package for this sort of thing.
>> 
>> When a package is loaded, the S4 methods it contains are merged into the 
>> metadata.  When the global environment is loaded, they are not.  Call 
>> 'cacheMetaData(1)' to do so.
>> 
>> [This looks like a bug: cacheMetaData is called on .GlobalEnv in the 
>> startup code for package methods, but seems not to work when called from 
>> there.  I think this is because package methods is not at that point on the 
>> search path (the call is from .onLoad) and hence the coerce() generic is 
>> not visible to cacheMetaData.  If you have S4 code in a package, it will 
>> ensure that package methods is attached before your package is loaded.]
>> 
>> On Sun, 9 Apr 2006, Joseph Wang wrote:
>> 
>>> Any one can explain why this happens or any work arounds?
>>> 
>>>> setClass('foo')
>>> 
>>> [1] "foo"
>>> 
>>>> setAs('foo', 'character', function(from) from)
>>>> showMethods('coerce')
>>> 
>>> 
>>> Function "coerce":
>>> from = "ANY", to = "array"
>>> from = "ANY", to = "call"
>>> from = "ANY", to = "character"
>>> from = "ANY", to = "complex"
>>> from = "ANY", to = "environment"
>>> from = "ANY", to = "expression"
>>> from = "ANY", to = "function"
>>> from = "ANY", to = "integer"
>>> from = "ANY", to = "list"
>>> from = "ANY", to = "logical"
>>> from = "ANY", to = "matrix"
>>> from = "ANY", to = "name"
>>> from = "ANY", to = "numeric"
>>> from = "ANY", to = "single"
>>> from = "ANY", to = "ts"
>>> from = "ANY", to = "vector"
>>> from = "ANY", to = "NULL"
>>> from = "foo", to = "character"
>>> 
>>>> q()
>>> 
>>> Save workspace image? [y/n/c]: y
>>> 
>>> 
>>> (restart)
>>> 
>>>> showMethods('coerce')
>>> 
>>> 
>>> Function "coerce":
>>> from = "ANY", to = "array"
>>> from = "ANY", to = "call"
>>> from = "ANY", to = "character"
>>> from = "ANY", to = "complex"
>>> from = "ANY", to = "environment"
>>> from = "ANY", to = "expression"
>>> from = "ANY", to = "function"
>>> from = "ANY", to = "integer"
>>> from = "ANY", to = "list"
>>> from = "ANY", to = "logical"
>>> from = "ANY", to = "matrix"
>>> from = "ANY", to = "name"
>>> from = "ANY", to = "numeric"
>>> from = "ANY", to = "single"
>>> from = "ANY", to = "ts"
>>> from = "ANY", to = "vector"
>>> from = "ANY", to = "NULL"
>>> from = "NULL", to = "OptionalFunction"
>>> 
>>>> 
>>> 
>>> ______________________________________________
>>> R-help at stat.math.ethz.ch mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-help
>>> PLEASE do read the posting guide! 
>>> http://www.R-project.org/posting-guide.html
>>> 
>> 
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From francoisromain at free.fr  Wed Apr 12 11:26:55 2006
From: francoisromain at free.fr (Romain Francois)
Date: Wed, 12 Apr 2006 11:26:55 +0200
Subject: [Rd] kcachegrind and R
In-Reply-To: <443B626A.3030601@free.fr>
References: <443B626A.3030601@free.fr>
Message-ID: <443CC7DF.2080501@free.fr>

Le 11.04.2006 10:01, Romain Francois a ?crit :
> Hi,
>
> Is there a way to use kcachegrind on R code ?
> I mean the R function written in R (not the C, etc ... functions). Has 
> someone tried to generate "Callgrind profile format" from ouputs of Rprof ?
>
> Romain
>   
Hi all,

I tried to answer my own question since yesterday.
I made a package http://addictedtor.free.fr/packages/grindR_0.0.tar.gz 
that start the translation accordind to the kcachegrind manual there  
http://kcachegrind.sourceforge.net/cgi-bin/show.cgi/KcacheGrindCalltreeFormat

The code is not entirely working (it is version 0.0), but at least it 
shows that it is possible to use kcachegrind on R code.
Is there somebody interrested in such a project  (to use it and/or help 
me improving it) ?

Best Regards,

Romain

-- 
visit the R Graph Gallery : http://addictedtor.free.fr/graphiques
mixmod 1.7 is released : http://www-math.univ-fcomte.fr/mixmod/index.php
+---------------------------------------------------------------+
| Romain FRANCOIS - http://francoisromain.free.fr               |
| Doctorant INRIA Futurs / EDF                                  |
+---------------------------------------------------------------+


From gchappi at gmail.com  Wed Apr 12 11:42:05 2006
From: gchappi at gmail.com (Hans-Peter)
Date: Wed, 12 Apr 2006 11:42:05 +0200
Subject: [Rd] headerfile translation to Delphi (Pascal) completed
Message-ID: <47fce0650604120242k6ca4434fn17f1f0ee29c0ea5c@mail.gmail.com>

Hi,

I am happy to announce that I finished the translation of almost all
LGPL'ed R headerfiles to Delphi. As a test I did several demos which
basically contain delphized versions of all the examples of chapter 5
in "Writing R Extensions".

Please have a look in the attachments for details
(DemosAndHeaders.txt), more information (Readme.txt) and an example of
how it looks (Convolve.pas).

The final version will be released some time later* as GPL.

By now I'd like to make available the sources to all interested R
regulars in order to try out and - maybe - to get some feedback. Just
drop me a mail and I'm happy to send you the sources**.

(Btw, I worked with Delphi 2006 (tested with D6 also). I don't
know/use the FreePascal compiler so it's windows only (at least for
the moment)).

Best regards,
Hans-Peter


*After R2.3; also I need to do larger tests and think about some kind
of testframework
**I already sent them to the few persons I know who might be interested


 - - -
| Hans-Peter Suter, Dipl. Natw. ETH / SW-Entwickler
| Treetron Umweltinformatik, Zuerich Tel +41(1)242 22 55
| mailto: <firstname>.<name>@treetronPUNKTch
| or: gchappi at gmail.com
-------------- next part --------------
DEMOS
========================================================
Available:
- Convolve | - RegisteredConvolve | - Initialize |
- GlobalVariables | - AcrossTheBoard

In each folder is a specific script _rscript and in the
Demo folder two global ones (_rscript/_rscriptMultiple)
--------------------------------------------------------

Convolve
--------
The first demo presents the convolve examples from the manual
"Writing R Extensions" in a "Delphi-translated" version. The 
three interface functions .C, .Call and .External are used and
the application of some macros in Rinternals.h and Rdefines.h
(which become rhRInternal.pas and rhRDefines.pas) is shown.

RegisteredConvolve
------------------
"RegisteredDemoEx.dll" shows how to register a Delphi function 
in the "R_init_<dll-name>" call.

[The RegisteredConvDemo was the first attempt but the freely 
called register method "RegisterConvolveRoutines" still crashes 
in some circumstances (see _rscriptMultiple.R) for unknown reason]

Initialize
----------
This important demo prints the sequence of the initialize and
finalize calls. Can be used as a template.

Global variables
----------------
Delphi cannot directly use global variables in DLL's. We have
to assign them manually. This demo was our test ground. The units 
rhR, rhRInternal and rhR have such variables. Search for the
overloaded function ToRVarsArr to find the relevant places.

Across the board
----------------
An extensive demo with basically all the remaining examples from
"Writing R Extensions". We failed with print attributes (bloody Lisp!)
and left out parsing R code, but the rest is here.




HEADER UNITS
========================================================
[Quality: 1: tested, 2: anecdotic tests, 3: compiles, 4: unfinished
Tested on R 2.2.1 and 2.3.alpha]
        
R Headerfile          becomes      Quality  Delphi unit
----------------------------------------------------------
Applic.h                --->         3      rhApplic.pas
Arith.h                 ~~~>         2      rhR.pas
BLAS.h                  --->         3      rhBlas.pas
Boolean.h               ~~~>         2      rhTypesAndConsts.pas
Callbacks.h             --->         3      rhCallbacks.pas
Complex.h               ~~~>         2      rhTypesAndConsts.pas
Constants.h             ~~~>         3      rhTypesAndConsts.pas
Error.h                 ~~~>         2      rhR.pas
eventloop.h             xxxx         4      (no entry points, probably unix-only)
GraphicsBase.h          (??)         4      (partly done, some types GPL only? FIXME)
GraphicsDevice.h        --->         3      rhGraphicsDevice.pas 
GraphicsEngine.h        --->         3      rhGraphicsEngine.pas
Lapack.h                xxxx         4      (MAYBE LATER - exported in Rlapack.dll)
libextern.h             (xx)         -      (contains defines - not relevant)
Linpack.h               xxxx         4      (MAYBE LATER)
Memory.h                ~~~>         3      rhR.pas
Print.h                 ~~~>         2      rhR.pas
PrtUtil.h               --->         3      rhPrtUtil.pas
R-ftp-http.h            --->         3      rhRftpHttp.pas
R.h                     ~~~>         3      rhTypesAndConsts.pas
Random.h                ~~~>         3      rhR.pas / rhTypesAndConsts.pas
RConverters.h           --->         3      rhRConverters.pas
Rdefines.h              --->         2      rhRDefines.pas
Rdynload.h              --->         2      rhRDynload.pas
Rdynpriv.h              ~~~>         2      rhRDynload.pas
Rgraphics.h             --->         3      rhRGraphics.pas
Riconv.h                --->         3      rhRIconv.pas
Rinlinedfuns.h          xxxx         -      (probably(?) only Gnu C compiler relevant)
Rinternals.h            --->         2      rhRInternals
" (use Internal stuff)  ~~~>         3      rhRUseInternals (NOT TO BE PUBLISHED) 
Rlapack.h               xxxx         4      (MAYBE LATER)
RS.h                    ~~~>         3      rhR.pas
RX55.h                  xxxx         -      (probably (?) unix-only)
S.h                     xxxx         4      (MAYBE LATER)
Utils.h                 --->         3      rhUtils.pas

-------------- next part --------------
- - - - - - - - - - - - -
- - -   D R A F T   - - -
- - - - - - - - - - - - -

Port of R header files to Delphi (Pascal)


--- CONTENT ---

. Introduction
. Getting started
. Translation conventions
. Use_RInternal (Rinternals.h)
. License


--- INTRODUCTION ---

This port of the R headers to Delphi offers a lowlevel interface between the
powerful R statistical computing system and Delphi, a pascal derived language
and arguably the most productive development environment around.

Most LGPL headers have been translated. As we took care to keep very close
to the original header files one can take over the examples from "Writing R
Extensions" almost one to one. Within the demos we explored how to load a
delphi based DLL from R and how to call the R API from it. We didn't do the
opposite, namely link the R.dll from a standalone Delphi application.

This project does - of course - in no way promote the widespread use of pascal
code within R, it's about special cases, particulary on the windows platform.
The port has been done with D2006 and has been tested on D6 also. It probably
won't run on <= D5 (e.g. varargs) and we didn't try with FreePascal either.

A final word about testing. The demos run fine (on R2.2.1 and 2.3.alpha),
but for the other (majority) part of the code, the only thing we know is, that
it compiles... More tests and applications are planned, but a thorough testing
(DUnit?) is probably out of question (just too much code).


--- GETTING STARTED ---

It's really easy.

Do check the document DemosAndHeaders.txt:
  - There's a list of the translated headers and their corresponding unit.
  - More important, there's also a list of all demos. The demo source code is
    the main point where you can hear about interfacing R and Delphi.

Other files that may be of interest are: BugsAndQuestions.txt and History.txt


--- TRANSLATION CONVENTIONS ---

Motto: As close as possible to the syntax/naming of the original headers

Changes:
  - most prefixes ("Rf_", "R_", "do_", ...) and suffixes ("_t") are gone.
    An exception is "S_" which is shortened to "S"
  - the underscores ("_") are gone too. CamelCaseStyleConvention is used.
  - different versions (Rf_asChar, asChar) become one (riAsChar)
  - the letter following R (or S) is written in capital (e.g. aSExp)
  - the following prefixes are used (to avoid name clashes):
  	- a small "r" (e.g.rNormRand), except for
  	- a small "ri" for things in Rinternals (e.g. riReal) and except
  	- a small "rd" for things in Rdefines   (e.g. rdNumericPointer)
	 [- low level functions contained in the unit rhRUseInternals.pas
	    have the prefix "rui". (This is too lowlevel and not delivered)]

Filenames: Pprefixed with "rh" (R header) or "rhu" (R header utils).

Delphi conventions:
  - types start with an "a", pointers with "p" (e.g. R_len_t becomes aRLen)
  - constants start with prefix "The" (global) or "the" (local)
  - variables start with capital (global) or small (local) letter
  - function start with capital prefixed by "r", "ri/rui" or "rd"
	- arguments start with an underscore followed by a small letter

Misc:
  - Pointer type arguments have been translated as pointers
    (E.g. "x *int" becomes "_x: pInteger" and NOT "var _x: integer")
  - Unfortunately there are two forms of length (LENGTH and length/Rf_length)
    in the header file Rinternals. The
    - vector access macro LENGTH becomes riLength and
    - the ??? length(x)/Rf_length become rLength.


--- USE_RINTERNAL (RINTERNALS.H) ---

The file "Rinternals.h" contains two sets of functions: one with "real"
functions who are exported in the R.dll and one with functions that use
the structs (records) directly to access the data. The second is intended
for use within R itself and is protected by the "USE_RINTERNALS" define.
While both "sets" have been translated, only rhRInternals.pas is distributed
for now. This may change upon need/request.


--- LICENSE ---

The Delphi port of the R header files will be published under a dual
license (GPL v2.1 / proprietary) later. (End of 2006 at the latest)*
                              ---
[Our port is exclusively based on R header files with are licensed under
the terms of the GNU Lesser General Public License (version 2.1 or above).
                               -
R is a computer language for statistical data analysis. It is
Copyright (C) 1995, 1996  Robert Gentleman and Ross Ihaka
Copyright (C) 1999-2006   The R Development Core Team
and published under the terms of the GNU General Public License.]
                              ---
The software is provided in the hope that it will be useful but without any
express or implied warranties, including, but not without limitation, the
implied warranties of merchantability and fitness for a particular purpose.
                              ---
Copyright (C) 2006 by Hans-Peter Suter, Treetron GmbH, Switzerland.
All rights reserved.



*
Until then the sources should be treated as closed source and only be available
to known R regulars. Reasons for this: 1) I'd like to incorporate feedback and
2) I really need to try out the code in some bigger application to be sure that
it works reliably. 3) 2.3 should be released first and 4) There must be some sort
of a testframework to make sure that new releases don't break basic things.

Have fun,
Hans-Peter
-------------- next part --------------
unit Convolve;

{ "Delphized" version of simple examples which convolve two finite sequences.
  See: Writing R Extensions. Version 2.3.0 (2006-02-19). ISBN 3-900051-11-9.
                              ---
  The software is provided in the hope that it will be useful but without any
  express or implied warranties, including, but not without limitation, the
  implied warranties of merchantability and fitness for a particular purpose.
                              ---
  11.3.2006 - Hans-Peter Suter, Treetron, Switzerland.
                              ---                                              }

{==============================================================================}
interface
uses
  rhRInternals, rhTypesAndConsts;

  { ConvC - call our convolve using .C }
  { We use pointer type arguments as they are closer to the original C code.
    See in implementation for an example with parameters passed by reference }
procedure ConvC( _a: pDoubleArr; _na: pInteger;
                 _b: pDoubleArr; _nb: pInteger;
                 _ab: pDoubleArr ); cdecl;

  { ConvCallRInternals - call our convolve using .Call and Rinternals }
function ConvCallRInternals( _a, _b: pSExp ): pSExp; cdecl;

  { ConvCallRDefines - call our convolve using .Call and Rdefines }
function ConvCallRDefines( _a, _b: pSExp ): pSExp; cdecl;

  { ConvExternalRInternals - call our convolve using .External and Rinternals }
function ConvExternalRInternals( _args: pSExp ): pSExp; cdecl;

  { call our convolve using .External and Rdefines }
{ nothing new to see, skipped }


{==============================================================================}
implementation
uses
  rhRDefines;

{ ConvC }

// Example for declaration/code with PARAMETERS PASSED BY REFERENCE
//procedure ConvC( var _a: aDoubleArr; var _na: integer;
//                 var _b: aDoubleArr; var _nb: integer;
//                 var _ab: aDoubleArr ); cdecl;
//  var
//    i, j, nab: integer;
//  begin
//    nab:= _na + _nb - 1;
//    for i:= 0 to nab - 1 do _ab[i]:= 0.0;
//    for i:= 0 to _na - 1 do begin
//      for j := 0 to _nb - 1 do begin
//        _ab[i + j]:= _ab[i + j] + _a[i]*_b[j]
//      end {for};
//    end {for};
//  end {ConvC};

procedure ConvC( _a: pDoubleArr; _na: pInteger;
                 _b: pDoubleArr; _nb: pInteger;
                 _ab: pDoubleArr ); cdecl;
  var
    i, j, nab: integer;
  begin
    nab:= _na^ + _nb^ - 1;
    for i:= 0 to nab - 1 do _ab[i]:= 0.0;
    for i:= 0 to _na^ - 1 do begin
      for j := 0 to _nb^ - 1 do begin
        _ab[i + j]:= _ab[i + j] + _a[i]*_b[j]
      end {for};
    end {for};
  end {ConvC};


{ ConvCallRInternals }

function ConvCallRInternals( _a, _b: pSExp ): pSExp; cdecl;
  var
    i, j, na, nb, nab: aRLen;
    pxa, pxb, pxab: pDoubleArr;
  begin
    _a:= riProtect( riCoerceVector( _a, setRealSxp ) );
    _b:= riProtect( riCoerceVector( _b, setRealSxp ) );
    na:= riLength( _a ); nb:= riLength( _b ); nab:= na + nb - 1;
    result:= riProtect( riAllocVector( setRealSxp, nab ) );

    pxa:= riReal( _a ); pxb:= riReal( _b );
    pxab:= riReal( result );

    for i := 0 to nab - 1 do pxab[i]:= 0.0;
    for i := 0 to na - 1 do begin
      for j := 0 to nb - 1 do begin
        pxab[i + j]:= pxab[i + j] + pxa[i]*pxb[j]
      end {for};
    end {for};

    riUnprotect( 3 );
  end {ConvCallRInternals};


{ ConvCallRDefines }

function ConvCallRDefines( _a, _b: pSExp ): pSExp; cdecl;
  var
    i, j, na, nb, nab: integer;
    pxa, pxb, pxab: pDoubleArr;
    ab: pSExp;
  begin
    _a:= riProtect( rdAsNumeric( _a ) );
    _b:= riProtect( rdAsNumeric( _b ) );
    na:= riLength( _a ); nb:= riLength( _b ); nab:= na + nb - 1;
    ab:= riProtect( rdNewNumeric( nab ) );

    pxa:= rdNumericPointer( _a ); pxb:= rdNumericPointer( _b );
    pxab:= rdNumericPointer( ab );

    for i := 0 to nab - 1 do pxab[i]:= 0.0;
    for i := 0 to na - 1 do begin
      for j := 0 to nb - 1 do begin
        pxab[i + j]:= pxab[i + j] + pxa[i]*pxb[j]
      end {for};
    end {for};

    riUnprotect( 3 );
    result:= ab;
  end {ConvCallRDefines};


{ ConvExternalRInternals }

function ConvExternalRInternals( _args: pSExp ): pSExp; cdecl;
  var
    i, j, na, nb, nab: aRLen;
    pxa, pxb, pxab: pDoubleArr;
    a, b, ab: pSExp;
  begin
    a:= riProtect( riCoerceVector( riCadr( _args ), setRealSxp ) );
    b:= riProtect( riCoerceVector( riCaddr( _args ), setRealSxp ) );
    na:= riLength( a ); nb:= riLength( b ); nab:= na + nb - 1;
    ab:= riProtect( riAllocVector( setRealSxp, nab ) );

    pxa:= riReal( a ); pxb:= riReal( b );
    pxab:= riReal( ab );

    for i := 0 to nab - 1 do pxab[i]:= 0.0;
    for i := 0 to na - 1 do begin
      for j := 0 to nb - 1 do begin
        pxab[i + j]:= pxab[i + j] + pxa[i]*pxb[j]
      end {for};
    end {for};

    riUnprotect( 3 );
    result:= ab;
  end {ConvExternalRInternals};


end {Convolve}.


From anthony.brooks at csc.mrc.ac.uk  Wed Apr 12 12:04:22 2006
From: anthony.brooks at csc.mrc.ac.uk (Brooks, Anthony B)
Date: Wed, 12 Apr 2006 11:04:22 +0100
Subject: [Rd] Label size in MAplots
Message-ID: <A9890059664CAD468E43D67208E576C76BDEE1@icex5.ic.ac.uk>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20060412/5a307b77/attachment.pl 

From friedrich.leisch at stat.uni-muenchen.de  Wed Apr 12 13:53:08 2006
From: friedrich.leisch at stat.uni-muenchen.de (friedrich.leisch at stat.uni-muenchen.de)
Date: Wed, 12 Apr 2006 13:53:08 +0200
Subject: [Rd] Bug#361968: Wrong name in manpage
In-Reply-To: <443C503B.1000706@stats.uwo.ca>
References: <20060411140310.27058.92155.reportbug@kcm.kanru.info>
	<17467.51758.972000.624488@basebud.nulle.part>
	<17468.16301.844738.161949@basebud.nulle.part>
	<443C503B.1000706@stats.uwo.ca>
Message-ID: <17468.59940.141318.300584@celebrian.ci.tuwien.ac.at>


>>>>> On Tue, 11 Apr 2006 20:56:27 -0400,
>>>>> Duncan Murdoch (DM) wrote:

  > On 4/11/2006 7:45 PM, Dirk Eddelbuettel wrote:
  >> R-devel'ers, 
  >> 
  >> On 11 April 2006 at 10:24, Dirk Eddelbuettel wrote:
  >> | 
  >> | Kanru,
  >> | 
  >> | Thanks for the bugreport.
  >> | 
  >> | On 11 April 2006 at 22:03, Kanru Chen wrote:
  >> | | Package: r-base-core
  >> | | Version: 2.2.1.svn37668-1
  >> | | Severity: minor
  >> | | 
  >> | | In manpage of /usr/bin/R, the first, fourth and last line shows `VERSION'
  >> | | instead of `R'.
  >> 
  >> I haven't seen any follow-up yet -- here is what it looks like (cut and
  >> pasted from Emacs man page viewer) and note the 'Version' in place of R:
  >> 
  >> VERSION(1)                            FSF                           VERSION(1)
  >> 
  >> NAME
  >> Version - a language for data analysis and graphics
  >> 
  >> SYNOPSIS
  >> R [options] [< infile] [> outfile]
  >> R CMD command [arguments]
  >> 
  >> DESCRIPTION
  >> Start  R,  a  system for statistical computation and graphics, with the
  >> specified options, or invoke an R tool via the 'R CMD' interface.
  >> [...]
  >> 
  >> 
  >> | | I believe it is a typo.
  >> | 
  >> | More likely something is wrong with how R.1 is autogenerated using help2man.
  >> | 
  >> | Incidentally, that `R --version' now starts its ouput with 'Version' rather
  >> | than R had bit us in the RPy builds where the version number was regexp'ed
  >> | out of the result, and was still expecting the line to start with R just like
  >> | help2man seems to expect the program name first. 
  >> 
  >> It seems to stem from src/main/version.c:
  >> 
  >> void attribute_hidden PrintVersionString(char *s)
  >> {
  >> if(strcmp(R_SVN_REVISION, "unknown")==0)
  >> {
  >> sprintf(s, "Version %s.%s %s (%s-%s-%s)",
  >> R_MAJOR, R_MINOR, R_STATUS, R_YEAR, R_MONTH, R_DAY);
  >> }
  >> else{
  >> if(strlen(R_STATUS)==0){
  >> sprintf(s, "Version %s.%s (%s-%s-%s)",
  >> R_MAJOR, R_MINOR, R_YEAR, R_MONTH, R_DAY);
  >> }
  >> else{
  >> sprintf(s, "Version %s.%s %s (%s-%s-%s r%s)",
  >> R_MAJOR, R_MINOR, R_STATUS, R_YEAR, R_MONTH, R_DAY,
  >> R_SVN_REVISION);
  >> }
  >> }
  >> }
  >> 
  >> Would replacing 'Version ...' with 'R (Version ...)' be an acceptable
  >> alternative ?

  > I think the problem is that PrintVersion (a few lines up from there) 
  > used to put the R in front; PrintVersionString doesn't include the R. 
  > PrintVersionString is called from other places where the R would not be 
  > appropriate, but PrintVersion is only called when acting on `R 
  > --version' or synonyms.

  > Fritz, I think this was your change in r36923 a few months ago.  Do you 
  > have time to deal with it?

Yes, will do later today.

Best,
Fritz


From jmc at r-project.org  Wed Apr 12 14:45:56 2006
From: jmc at r-project.org (John Chambers)
Date: Wed, 12 Apr 2006 08:45:56 -0400
Subject: [Rd] [R] type converters not being saved to workspace
In-Reply-To: <Pine.LNX.4.64.0604120657220.31187@gannet.stats.ox.ac.uk>
References: <200604090322.10067.joe@gnacademy.org>
	<Pine.LNX.4.64.0604090958440.5192@gannet.stats.ox.ac.uk>
	<443C101A.4050507@r-project.org>
	<Pine.LNX.4.64.0604120657220.31187@gannet.stats.ox.ac.uk>
Message-ID: <443CF684.4080501@r-project.org>

Well, you  may be right, but my experiments certainly suggested 
otherwise (below).

But my main point is that we should look for a better approach, and I 
think we agree there.

Prof Brian Ripley wrote:

> On Tue, 11 Apr 2006, John Chambers wrote:
>
>> (diverted to r-devel)
>>
>> The problem seems to be rather that loading of the saved image takes 
>> place _after_ the packages are attached.  So nothing that the methods 
>> package does in its initialization will see the relevant type 
>> converters or other methods objects.
>
>
> I am sorry, but that is not the case: see ?Startup. The image is 
> loaded _before_ the packages are attached (as documented).


Perhaps.  But then why is it that if I put some trace printing in the 
.First.lib of methods, that printing comes out before the message 
"Previously saved  ...."?

> You can check explicitly by
>
> env R_DEFAULT_PACKAGES=NULL R --restore
> # R starts and loads the workspace
>
>> library(methods)
>
>
> and it still does not work (as I had tried before answering).

I'm not disputing that: the methods initialization did not call 
cacheMetaData for the methods package itself--it was because the fix I 
implemented to explicitly cache the generics in methods did NOT work 
that I inferred the point about the ordering.  (Some printout is below, 
but of course I'm not asserting that the fix might not have a different 
problem in it.)

--------------------------
 enterprise:~/testR [160]> R

R : Copyright 2006, The R Foundation for Statistical Computing
Version 2.4.0 Under development (unstable) (2006-04-10 r37703)
ISBN 3-900051-07-0

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

cacheMetaData called for methods namespace
[Previously saved workspace restored]

R> names(getMethods("coerce")@methods)
[1] "ANY"      "function"
-----------------------------------
The methods from .GlobalEnv are not found until a second cacheMetaData 
is done.



>
>> More generally, loading into .GlobalEnv will never cause the 
>> equivalent of cacheMetaData(.GlobalEnv).
>>
>> It would be possible to hack the C code in main/saveload.c to 
>> generate a call to cacheMetaData under the right circumstances, but 
>> is that the best solution? Intuitively, it's the objects containing 
>> the method/class definitions that should trigger actions when they 
>> are loaded (emulating what happens when the corresponding setMethod 
>> or setClass function call takes place).  I.e., a load method for 
>> these classes of objects.  Possible?
>
>
> Yes, but it will not help here as the objects are loaded without 
> methods being loaded.
>
> I hope one day when we have S4 objects marked in the object headers 
> that loading such an object will load and attach the methods package.
>
>> It might be better, now that we're past feature freeze, to leave this 
>> as a "design infelicity" for the upcoming release.
>
>
> Definitely.
>
> I think that package methods needs to cache metadata in its .onAttach 
> not .onLoad.  In principle it affects anything setting methods for 
> generics in package:methods, but if this is done in a package, the 
> dependency on methods will ensure that methods is loaded before the 
> package, and then library() will run cacheMetaData on the package.
>
>
>> Prof Brian Ripley wrote:
>>
>>> It is recommended that you use a package for this sort of thing.
>>>
>>> When a package is loaded, the S4 methods it contains are merged into 
>>> the metadata.  When the global environment is loaded, they are not.  
>>> Call 'cacheMetaData(1)' to do so.
>>>
>>> [This looks like a bug: cacheMetaData is called on .GlobalEnv in the 
>>> startup code for package methods, but seems not to work when called 
>>> from there.  I think this is because package methods is not at that 
>>> point on the search path (the call is from .onLoad) and hence the 
>>> coerce() generic is not visible to cacheMetaData.  If you have S4 
>>> code in a package, it will ensure that package methods is attached 
>>> before your package is loaded.]
>>>
>>> On Sun, 9 Apr 2006, Joseph Wang wrote:
>>>
>>>> Any one can explain why this happens or any work arounds?
>>>>
>>>>> setClass('foo')
>>>>
>>>>
>>>> [1] "foo"
>>>>
>>>>> setAs('foo', 'character', function(from) from)
>>>>> showMethods('coerce')
>>>>
>>>>
>>>>
>>>> Function "coerce":
>>>> from = "ANY", to = "array"
>>>> from = "ANY", to = "call"
>>>> from = "ANY", to = "character"
>>>> from = "ANY", to = "complex"
>>>> from = "ANY", to = "environment"
>>>> from = "ANY", to = "expression"
>>>> from = "ANY", to = "function"
>>>> from = "ANY", to = "integer"
>>>> from = "ANY", to = "list"
>>>> from = "ANY", to = "logical"
>>>> from = "ANY", to = "matrix"
>>>> from = "ANY", to = "name"
>>>> from = "ANY", to = "numeric"
>>>> from = "ANY", to = "single"
>>>> from = "ANY", to = "ts"
>>>> from = "ANY", to = "vector"
>>>> from = "ANY", to = "NULL"
>>>> from = "foo", to = "character"
>>>>
>>>>> q()
>>>>
>>>>
>>>> Save workspace image? [y/n/c]: y
>>>>
>>>>
>>>> (restart)
>>>>
>>>>> showMethods('coerce')
>>>>
>>>>
>>>>
>>>> Function "coerce":
>>>> from = "ANY", to = "array"
>>>> from = "ANY", to = "call"
>>>> from = "ANY", to = "character"
>>>> from = "ANY", to = "complex"
>>>> from = "ANY", to = "environment"
>>>> from = "ANY", to = "expression"
>>>> from = "ANY", to = "function"
>>>> from = "ANY", to = "integer"
>>>> from = "ANY", to = "list"
>>>> from = "ANY", to = "logical"
>>>> from = "ANY", to = "matrix"
>>>> from = "ANY", to = "name"
>>>> from = "ANY", to = "numeric"
>>>> from = "ANY", to = "single"
>>>> from = "ANY", to = "ts"
>>>> from = "ANY", to = "vector"
>>>> from = "ANY", to = "NULL"
>>>> from = "NULL", to = "OptionalFunction"
>>>>
>>>>>
>>>>
>>>> ______________________________________________
>>>> R-help at stat.math.ethz.ch mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-help
>>>> PLEASE do read the posting guide! 
>>>> http://www.R-project.org/posting-guide.html
>>>>
>>>
>>
>>
>


From Peter.Ruckdeschel at uni-bayreuth.de  Wed Apr 12 13:27:52 2006
From: Peter.Ruckdeschel at uni-bayreuth.de (Peter Ruckdeschel)
Date: Wed, 12 Apr 2006 13:27:52 +0200
Subject: [Rd] yet another problem with S4 dispatch (with setClassUnion)
Message-ID: <443CE438.3030400@uni-bayreuth.de>

Dear John and Seth,  dear R-devels,

once again the question of method dispatch in S4 -- this time with
setClassUnion(); taking up your advice in

https://stat.ethz.ch/pipermail/r-devel/2006-April/037200.html
https://stat.ethz.ch/pipermail/r-devel/2006-April/037201.html

I have been too quick in stating that

>setClassUnion()---at least in my case---solves the problem;
>
The problem arises if I have a  direct superclass "competing"
with the new class generated by setClassUnion();

consider the following code:

##  C00 mother class to C01 and C02
setClass("C00", representation(a="numeric"), prototype =c(a=0))
setClass("C01", representation(a="numeric",b="numeric"), contains= "C00")
setClass("C02", representation(a="numeric",d="numeric"), contains= "C00")

#with setClassUnion:
setClassUnion("C01OrC02", c("C01","C02"))

#  "+" methods  for C00 and C01OrC02
#        that this is a function to be dispatched on two arguments is
#        not important for this example

setMethod("+", signature=c("C00","C00"), function(e1,e2){e1 at a+e2@a})
setMethod("+", signature=c("C01OrC02","C01OrC02"),
         function(e1,e2){if(is(e1,"C01")) e10 <- e1
                        #  else: explicit coercion from  C02 to C01
                        else e10 <- new("C01", a=e1 at a, b=e1 at d)
                         if(is(e2,"C01")) e20 <- e2
                         #  else: explicit coercion from  C02 to C01
                         else e20 <- new("C01", a=e2 at a, b=e2 at d)
                         e10 at b+e20@b})

x1=new("C02", a=1, d=2)
x2=new("C02", a=1, d=3)

x1+x2 ## 2, i.e. uses C00-method
# but I would like to force usage of C01OrC02-method

Here the two classes C00 and C01OrC02 are direct superclasses to
C02, which exactly reflects my application of distribution classes,
confer  https://stat.ethz.ch/pipermail/r-devel/2006-April/037190.html 

How does the dispatching mechanism decide between
these two and is there a way to change precedence?

Of course, I could implement a "+" method for C02 directly
in this case, but suppose I have much more methods for
C01 and I want to use /all/ of them for C02, and cannot
organize things so that we have the inheritance chain
C00 -> C01 -> C02.  What is the preferred way of doing
this?

Thank you already for your attention,
Peter


From jmc at r-project.org  Wed Apr 12 15:20:57 2006
From: jmc at r-project.org (John Chambers)
Date: Wed, 12 Apr 2006 09:20:57 -0400
Subject: [Rd] yet another problem with S4 dispatch (with setClassUnion)
In-Reply-To: <443CE438.3030400@uni-bayreuth.de>
References: <443CE438.3030400@uni-bayreuth.de>
Message-ID: <443CFEB9.5020007@r-project.org>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20060412/512e1f54/attachment.pl 

From mdowle at concordiafunds.com  Wed Apr 12 16:19:10 2006
From: mdowle at concordiafunds.com (Matthew Dowle)
Date: Wed, 12 Apr 2006 15:19:10 +0100
Subject: [Rd] New class: data.table
Message-ID: <78166BFC5165D811AA0400065BF0324BF07FB4@wisconsin.concordia>


Hi,

Following previous discussion on this list
(http://tolstoy.newcastle.edu.au/R/devel/05/12/3439.html) I have created a
package as suggested, and uploaded it to CRAN incoming : data.table.tar.gz.

** Your comments and feedback will be very much appreciated. **

>From help(data.table) :

This class really does very little. The only reason for its existence is
that the white book specifies that data.frame must have rownames.

Most of the code is copied from base functions with the code manipulating
row.names removed.

A data.table is identical to a data.frame other than:
	* it doesn't have rownames
	* [,drop] by default is FALSE, so selecting a single row will always
return a single row data.table not a vector
	* The comma is optional inside [], so DT[3] returns the 3rd row as a
1 row data.table
	* [] is like a call to subset()
	* [,...], is like a call to with().  (not yet implemented)

Motivation:
	* up to 10 times less memory
	* up to 10 times faster to create, and copy
	* simpler R code
	* the white book defines rownames, so data.frame can't be changed
... => new class

Examples:
nr = 1000000
D = rep(1:5,nr/5)
system.time(DF <<- data.frame(colA=D, colB=D))  # 2.08 
system.time(DT <<- data.table(colA=D, colB=D))  # 0.15  (over 10 times
faster to create)
identical(as.data.table(DF), DT)
identical(dim(DT),dim(DF))
object.size(DF)/object.size(DT)                 # 10 times less memory

tt = subset(DF,colA>3)
ss = DT[colA>3]
identical(as.data.table(tt), ss)

mean(subset(DF,colA+colB>5,"colB"))
mean(DT[colA+colB>5]$colB)

tt = with(subset(DF,colA>3),colA+colB)
ss = with(DT[colA>3],colA+colB)                 # but could be:
DT[colA>3,colA+colB]  (not yet implemented)
identical(tt, ss)

tt = DF[with(DF,tapply(1:nrow(DF),colB,last)),] # select last row grouping
by colB
ss = DT[tapply(1:nrow(DT),colB,last)]           # but could be:
DT[last,group=colB]  (not yet implemented)
identical(as.data.table(tt), ss)

Lkp=1:3
tt = DF[with(DF,colA %in% Lkp),]              
ss = DT[colA %in% Lkp]                        # expressions inside the []
can see objects in the calling frame
identical(as.data.table(tt), ss)

In each case above there is either a space, time, or code brevity advantage
with the data.table.

The motivation for the new class grew from the realization that performance
of data.frames can be improved by removing the rownames.  See here for the
previous discussion
http://tolstoy.newcastle.edu.au/R/devel/05/12/3439.html.

Regards,
Matthew


From tlumley at u.washington.edu  Wed Apr 12 17:14:59 2006
From: tlumley at u.washington.edu (Thomas Lumley)
Date: Wed, 12 Apr 2006 08:14:59 -0700 (PDT)
Subject: [Rd] Stack checking, core dumps, and embedding R
In-Reply-To: <1abe3fa90604111312x177f6e4ds4e66b813c9833a00@mail.gmail.com>
References: <1abe3fa90604110234v1b4958c0w1e51e2b49f7ff9c5@mail.gmail.com>
	<Pine.LNX.4.64.0604111121440.30083@gannet.stats.ox.ac.uk>
	<1abe3fa90604111312x177f6e4ds4e66b813c9833a00@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0604120813440.31004@homer21.u.washington.edu>

On Tue, 11 Apr 2006, A.J. Rossini wrote:
>
> (This is under SBCL, i.e. satisfying Duncan's conjectures -- as soon
> as I fix a few things (i.e. undoing CommonLispStat/R's threading which
> is a bit SBCL specific, I'll try under CLISP, ECL, and CMUCL to
> verify/check).
>

Also, according to
   http://www.cyrusharmon.org/cl/blog/display/49
SBCL uses SIGSEGV as an internal signalling mechanism, which might 
conflict with the new segfault catcher.

 	-thomas

Thomas Lumley			Assoc. Professor, Biostatistics
tlumley at u.washington.edu	University of Washington, Seattle


From blindglobe at gmail.com  Wed Apr 12 17:48:19 2006
From: blindglobe at gmail.com (A.J. Rossini)
Date: Wed, 12 Apr 2006 17:48:19 +0200
Subject: [Rd] Stack checking, core dumps, and embedding R
In-Reply-To: <Pine.LNX.4.64.0604120813440.31004@homer21.u.washington.edu>
References: <1abe3fa90604110234v1b4958c0w1e51e2b49f7ff9c5@mail.gmail.com>
	<Pine.LNX.4.64.0604111121440.30083@gannet.stats.ox.ac.uk>
	<1abe3fa90604111312x177f6e4ds4e66b813c9833a00@mail.gmail.com>
	<Pine.LNX.4.64.0604120813440.31004@homer21.u.washington.edu>
Message-ID: <1abe3fa90604120848t196c7409mae45851eb26eb561@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20060412/e73bc89e/attachment.pl 

From friedrich.leisch at stat.uni-muenchen.de  Wed Apr 12 18:49:19 2006
From: friedrich.leisch at stat.uni-muenchen.de (friedrich.leisch at stat.uni-muenchen.de)
Date: Wed, 12 Apr 2006 18:49:19 +0200
Subject: [Rd] Bug#361968: Wrong name in manpage
In-Reply-To: <17468.59940.141318.300584@celebrian.ci.tuwien.ac.at>
References: <20060411140310.27058.92155.reportbug@kcm.kanru.info>
	<17467.51758.972000.624488@basebud.nulle.part>
	<17468.16301.844738.161949@basebud.nulle.part>
	<443C503B.1000706@stats.uwo.ca>
	<17468.59940.141318.300584@celebrian.ci.tuwien.ac.at>
Message-ID: <17469.12175.41505.610645@celebrian.ci.tuwien.ac.at>


I've committed a fix for 2.3 affecting only "R --version" (don't want to
play with real R output during feature freeze), and a cleaner solution
for 2.4 which gets the startup message and --version even more in
sync.

Passes all checks for me, and the man page looks OK again. Thanks for
spotting the bug.

Best,
Fritz


>>>>> On Wed, 12 Apr 2006 13:53:08 +0200,
>>>>> friedrich leisch (fl) wrote:

>>>>> On Tue, 11 Apr 2006 20:56:27 -0400,
>>>>> Duncan Murdoch (DM) wrote:

  >> On 4/11/2006 7:45 PM, Dirk Eddelbuettel wrote:
  >>> R-devel'ers, 
  >>> 
  >>> On 11 April 2006 at 10:24, Dirk Eddelbuettel wrote:
  >>> | 
  >>> | Kanru,
  >>> | 
  >>> | Thanks for the bugreport.
  >>> | 
  >>> | On 11 April 2006 at 22:03, Kanru Chen wrote:
  >>> | | Package: r-base-core
  >>> | | Version: 2.2.1.svn37668-1
  >>> | | Severity: minor
  >>> | | 
  >>> | | In manpage of /usr/bin/R, the first, fourth and last line shows `VERSION'
  >>> | | instead of `R'.
  >>> 
  >>> I haven't seen any follow-up yet -- here is what it looks like (cut and
  >>> pasted from Emacs man page viewer) and note the 'Version' in place of R:
  >>> 
  >>> VERSION(1)                            FSF                           VERSION(1)
  >>> 
  >>> NAME
  >>> Version - a language for data analysis and graphics
  >>> 
  >>> SYNOPSIS
  >>> R [options] [< infile] [> outfile]
  >>> R CMD command [arguments]
  >>> 
  >>> DESCRIPTION
  >>> Start  R,  a  system for statistical computation and graphics, with the
  >>> specified options, or invoke an R tool via the 'R CMD' interface.
  >>> [...]
  >>> 
  >>> 
  >>> | | I believe it is a typo.
  >>> | 
  >>> | More likely something is wrong with how R.1 is autogenerated using help2man.
  >>> | 
  >>> | Incidentally, that `R --version' now starts its ouput with 'Version' rather
  >>> | than R had bit us in the RPy builds where the version number was regexp'ed
  >>> | out of the result, and was still expecting the line to start with R just like
  >>> | help2man seems to expect the program name first. 
  >>> 
  >>> It seems to stem from src/main/version.c:
  >>> 
  >>> void attribute_hidden PrintVersionString(char *s)
  >>> {
  >>> if(strcmp(R_SVN_REVISION, "unknown")==0)
  >>> {
  >>> sprintf(s, "Version %s.%s %s (%s-%s-%s)",
  >>> R_MAJOR, R_MINOR, R_STATUS, R_YEAR, R_MONTH, R_DAY);
  >>> }
  >>> else{
  >>> if(strlen(R_STATUS)==0){
  >>> sprintf(s, "Version %s.%s (%s-%s-%s)",
  >>> R_MAJOR, R_MINOR, R_YEAR, R_MONTH, R_DAY);
  >>> }
  >>> else{
  >>> sprintf(s, "Version %s.%s %s (%s-%s-%s r%s)",
  >>> R_MAJOR, R_MINOR, R_STATUS, R_YEAR, R_MONTH, R_DAY,
  >>> R_SVN_REVISION);
  >>> }
  >>> }
  >>> }
  >>> 
  >>> Would replacing 'Version ...' with 'R (Version ...)' be an acceptable
  >>> alternative ?

  >> I think the problem is that PrintVersion (a few lines up from there) 
  >> used to put the R in front; PrintVersionString doesn't include the R. 
  >> PrintVersionString is called from other places where the R would not be 
  >> appropriate, but PrintVersion is only called when acting on `R 
  >> --version' or synonyms.

  >> Fritz, I think this was your change in r36923 a few months ago.  Do you 
  >> have time to deal with it?

  > Yes, will do later today.

  > Best,
  > Fritz

  > ______________________________________________
  > R-devel at r-project.org mailing list
  > https://stat.ethz.ch/mailman/listinfo/r-devel


From maechler at stat.math.ethz.ch  Thu Apr 13 09:11:08 2006
From: maechler at stat.math.ethz.ch (maechler at stat.math.ethz.ch)
Date: Thu, 13 Apr 2006 09:11:08 +0200 (CEST)
Subject: [Rd] S4 class slot name 'names' is not allowed (PR#8767)
Message-ID: <20060413071108.F1F8D44233@slim.kubism.ku.dk>

>>>>> "SteveL" == Steven Lacey <slacey at umich.edu>
>>>>>     on Wed, 12 Apr 2006 19:06:52 -0400 writes:

    SteveL> Hi, Why doesn't this work?
 
    setClass("tests", representation(names = "character"))
    tmp <- new("tests"); tmp at names <- "a"
 
    SteveL> Error in "slot<-"(object, name, TRUE, value) :
    SteveL> 'names' attribute [1] must be the same length as the vector [0]
 
    SteveL> Why does this work (replace names with name)?
 
    setClass("test", representation(name="character"))
    tmp <- new("test"); tmp at name <- "a"
 
    SteveL> I looked at the help for setClass, representation,
    SteveL> and slot and found no restriction on the slot names
    SteveL> other than that they "be any non-empty string, but
    SteveL> if the name is not made up of letters, numbers, and
    SteveL> '"."', it needs to be quoted".
 

Hah, you got us!
This *is* a bug - at least in the documentation  ===> This goes
to R-bugs as well.

It's because of the current *implementation* of S4-classed
objects in R [as an empty list with a list of unusual attributes]
-- and because  'names'  (and also, e.g., 'dimnames')
are attributes in R with a very special treatment - in many places.

I haven't delved into the internal code, but I know that this
problem will go away ``as soon as'' the internal
representation of S4-classed objects is replaced -- something
that has been planned for a while and "just did not yet happen".

Martin Maechler, ETH Zurich


From Peter.Ruckdeschel at uni-bayreuth.de  Thu Apr 13 04:03:11 2006
From: Peter.Ruckdeschel at uni-bayreuth.de (Peter Ruckdeschel)
Date: Thu, 13 Apr 2006 04:03:11 +0200
Subject: [Rd] yet another problem with S4 dispatch (with setClassUnion)
In-Reply-To: <443CFEB9.5020007@r-project.org>
References: <443CE438.3030400@uni-bayreuth.de> <443CFEB9.5020007@r-project.org>
Message-ID: <443DB15F.9080403@uni-bayreuth.de>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Dear John,

sorry for having bothered you with these problems.

> As I think Seth told you before, if you want to control the order
> of inheritance at the same level, you need to use the intended order
> in the contains= argument to setClass.

Apologies, but I did not catch this from Seth's mail; in fact Seth wrote

>> With the contains arg, the order determines the precedence for method
lookup.

sorry for coming up again with the same question.

> In your example (retaining the class union, although it's not required,
the superclass
> could just be an ordinary virtual class),
>
> setClassUnion("C01OrC02")
> ## C00 mother class to C01 and C02
> setClass("C00", representation(a="numeric"), prototype =c(a=0))
> setClass("C01", representation(a="numeric",b="numeric"),
> contains= c("C01OrC02", "C00"))
> setClass("C02", representation(a="numeric",d="numeric"),
> contains= c("C01OrC02", "C00"))
>
> seems to give what you want

Yes, it does. Thank you very much. Problem solved!

... and I have learned something ....

Besides the importance of order in the 'contains'-arg,
beforehand,  I had also somehow misunderstood the
purpose of setClassUnion():
I had thought setClassUnion()  was to circumvene the
modification of classes (not "owned" by me);
thus it was not obvious to me to write a class defined
by setClassUnion() into the 'contains'-argument.

BTW:

Is there a way to solve my problem without
modifying the 'contains'-arguments ---
e.g. if I do not "own" classes C01, C00, C02?
(This is not the case for my application, but
might be of general interest) .

> To answer one of your other questions, the point about inheritance
asserting
> substitutability is that you now need to be sure that
> EVERY method for C01OrC02 is preferred to a method for C00 for
> the new subclasses.

Ok. This would be the case in my application.

> As a general design point, having these competing superclasses is likely to
> confuse the user, if not the implementer.
> If you could, it would make a clearer picture to have, e.g., C01orC02 be a
> subclass of C00.
> Then the inheritance is obvious--C01or... is a parent, while C00 is a
grandparent.
> The special contains= then doesn't need to be repeated for every
subclass Cx.

Good point; I fixed this in our package.
Probably it is also a good idea then not to export this artificial
(but no longer VIRTUAL) intermediate class in the NAMESPACE file.

Thank you once again, you helped us a lot.
Peter


-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.1 (MingW32)
Comment: GnuPT 2.6.2.1 by EQUIPMENTE.DE
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org
 
iD8DBQFEPbFex+/gN8KI3u0RAgE8AJ9/M6Q7F8ldGDLVjRCCXW6PdidJRwCfW2zd
rFlFbzuL4jbrav//lmrO2rE=
=iIbA
-----END PGP SIGNATURE-----


From francoisromain at free.fr  Thu Apr 13 11:02:35 2006
From: francoisromain at free.fr (Romain Francois)
Date: Thu, 13 Apr 2006 11:02:35 +0200
Subject: [Rd] bash-like history mechanism and prompt settings
Message-ID: <443E13AB.2060604@free.fr>

Hi,

I have a couple of questions:
* would it be possible to add more information on the history, for 
example the number of the command and a timestamp. With the number of 
command, one could do some stuff like in a terminal to recall a specific 
command :
$ !45
and with the timestamp, one could imagine to ask for commands that were 
typed in a given interval of time. For example :
R> history(before="Thu Apr 13 8:54:14 2006")

* My other question is about the prompt, is it possible to make it 
dynamic, ie to mimic the PS1 variable in bash. R would use a prompt that 
would tell (for example) the current time, and the number of the command 
to come
[445-10:58:54] R>

(I'm using R from gnome-terminal on fedora 5)

Regards,

Romain

-- 
visit the R Graph Gallery : http://addictedtor.free.fr/graphiques
mixmod 1.7 is released : http://www-math.univ-fcomte.fr/mixmod/index.php
+---------------------------------------------------------------+
| Romain FRANCOIS - http://francoisromain.free.fr               |
| Doctorant INRIA Futurs / EDF                                  |
+---------------------------------------------------------------+


From andy_liaw at merck.com  Thu Apr 13 12:22:19 2006
From: andy_liaw at merck.com (Liaw, Andy)
Date: Thu, 13 Apr 2006 06:22:19 -0400
Subject: [Rd] bash-like history mechanism and prompt settings
Message-ID: <39B6DDB9048D0F4DAD42CB26AAFF0AFAFEDA98@usctmx1106.merck.com>

From: Romain Francois
> 
> Hi,
> 
> I have a couple of questions:
> * would it be possible to add more information on the history, for 
> example the number of the command and a timestamp. With the number of 
> command, one could do some stuff like in a terminal to recall 
> a specific 
> command :
> $ !45
> and with the timestamp, one could imagine to ask for commands 
> that were 
> typed in a given interval of time. For example :
> R> history(before="Thu Apr 13 8:54:14 2006")
> 
> * My other question is about the prompt, is it possible to make it 
> dynamic, ie to mimic the PS1 variable in bash. R would use a 
> prompt that 
> would tell (for example) the current time, and the number of 
> the command 
> to come
> [445-10:58:54] R>

See http://finzi.psych.upenn.edu/R/Rhelp02a/archive/0335.html

Andy
 
> (I'm using R from gnome-terminal on fedora 5)
> 
> Regards,
> 
> Romain
> 
> -- 
> visit the R Graph Gallery : http://addictedtor.free.fr/graphiques
> mixmod 1.7 is released : 
> http://www-math.univ-fcomte.fr/mixmod/index.php
> +---------------------------------------------------------------+
> | Romain FRANCOIS - http://francoisromain.free.fr               |
> | Doctorant INRIA Futurs / EDF                                  |
> +---------------------------------------------------------------+
> 
> ______________________________________________
> R-devel at r-project.org mailing list 
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
>


From r.hankin at noc.soton.ac.uk  Thu Apr 13 12:48:37 2006
From: r.hankin at noc.soton.ac.uk (Robin Hankin)
Date: Thu, 13 Apr 2006 11:48:37 +0100
Subject: [Rd] R-latest.tar.gz make error
Message-ID: <A4EC7EB5-0401-48CF-AD11-96FE60E53935@soc.soton.ac.uk>

Hi.


(MacOSX 10.4.6) I downloaded R-latest.tar.gz  just now from src/base- 
prerelease
on CRAN.  "make" gave the following error after an apparently successful
./configure:


[snip]
util.c: In function 'Rf_type2char':
util.c:247: warning: return discards qualifiers from pointer target type
gcc -I../../src/extra/zlib -I../../src/extra/bzip2 -I../../src/extra/ 
pcre  -no-cpp-precomp -I. -I../../src/include -I../../src/include -I/ 
usr/local/include -DHAVE_CONFIG_H  -fPIC -fno-common  -g -O2 - 
std=gnu99 -c version.c -o version.o
gcc -I../../src/extra/zlib -I../../src/extra/bzip2 -I../../src/extra/ 
pcre  -no-cpp-precomp -I. -I../../src/include -I../../src/include -I/ 
usr/local/include -DHAVE_CONFIG_H  -fPIC -fno-common  -g -O2 - 
std=gnu99 -c vfonts.c -o vfonts.o
g77  -fPIC -fno-common  -g -O2 -c xxxpr.f -o xxxpr.o
gcc -dynamiclib -L/usr/local/lib -dynamiclib -install_name libR.dylib  
-compatibility_version 2.3.0  -current_version 2.3.0  - 
headerpad_max_install_names -o libR.dylib Rembedded.o CConverters.o  
CommandLineArgs.o Rdynload.o Renviron.o RNG.o apply.o arithmetic.o  
apse.o array.o attrib.o base.o bind.o builtin.o character.o coerce.o  
colors.o complex.o connections.o context.o cov.o cum.o dcf.o  
datetime.o debug.o deparse.o deriv.o dotcode.o dounzip.o dstruct.o  
duplicate.o engine.o envir.o errors.o eval.o format.o fourier.o  
gevents.o gram.o gram-ex.o graphics.o identical.o internet.o  
iosupport.o lapack.o list.o localecharset.o logic.o main.o mapply.o  
match.o memory.o model.o names.o objects.o optim.o optimize.o  
options.o par.o paste.o pcre.o platform.o plot.o plot3d.o plotmath.o  
print.o printarray.o printvector.o printutils.o qsort.o random.o  
regex.o registration.o relop.o rlocale.o saveload.o scan.o seq.o  
serialize.o size.o sort.o source.o split.o sprintf.o startup.o  
subassign.o subscript.o subset.o summary.o sysutils.o unique.o util.o  
version.o vfonts.o xxxpr.o   `ls ../appl/*.o ../nmath/*.o ../unix/ 
*.o  2>/dev/null` -framework vecLib -L/usr/local/lib/gcc/powerpc- 
apple-darwin7.9.0/3.4.4 -lg2c -lgcc_s -lSystem  ../extra/zlib/ 
libz.a ../extra/bzip2/libbz2.a ../extra/pcre/libpcre.a  ../extra/intl/ 
libintl.a  -Wl,-framework -Wl,CoreFoundation -lreadline  -lm -liconv
ld: warning multiple definitions of symbol _xerbla_
print.o definition of _xerbla_ in section (__TEXT,__text)
/System/Library/Frameworks/Accelerate.framework/Versions/A/Frameworks/ 
vecLib.framework/Versions/A/libBLAS.dylib(single module) definition  
of _xerbla_
ld: Undefined symbols:
restFP
saveFP
/usr/bin/libtool: internal link edit command failed
make[3]: *** [libR.dylib] Error 1
make[2]: *** [R] Error 2
make[1]: *** [R] Error 1
make: *** [R] Error 1
238-250:~/scratch/R-beta%




--
Robin Hankin
Uncertainty Analyst
National Oceanography Centre, Southampton
European Way, Southampton SO14 3ZH, UK
  tel  023-8059-7743


From tschoenhoff at gmail.com  Thu Apr 13 13:04:44 2006
From: tschoenhoff at gmail.com (druid@gmail.com)
Date: Thu, 13 Apr 2006 13:04:44 +0200
Subject: [Rd] R-latest.tar.gz make error
In-Reply-To: <A4EC7EB5-0401-48CF-AD11-96FE60E53935@soc.soton.ac.uk>
References: <A4EC7EB5-0401-48CF-AD11-96FE60E53935@soc.soton.ac.uk>
Message-ID: <5ad2dec0604130404t2bdd8a66pb81f44b339644ae4@mail.gmail.com>

Hello,


2006/4/13, Robin Hankin <r.hankin at noc.soton.ac.uk>:
> Hi.
>
>
> (MacOSX 10.4.6) I downloaded R-latest.tar.gz  just now from src/base-
> prerelease
> on CRAN.  "make" gave the following error after an apparently successful
> ./configure:
>
>
> [snip]
> util.c: In function 'Rf_type2char':
> util.c:247: warning: return discards qualifiers from pointer target type
> gcc -I../../src/extra/zlib -I../../src/extra/bzip2 -I../../src/extra/
> pcre  -no-cpp-precomp -I. -I../../src/include -I../../src/include -I/
> usr/local/include -DHAVE_CONFIG_H  -fPIC -fno-common  -g -O2 -
> std=gnu99 -c version.c -o version.o
> gcc -I../../src/extra/zlib -I../../src/extra/bzip2 -I../../src/extra/
> pcre  -no-cpp-precomp -I. -I../../src/include -I../../src/include -I/
> usr/local/include -DHAVE_CONFIG_H  -fPIC -fno-common  -g -O2 -
> std=gnu99 -c vfonts.c -o vfonts.o
> g77  -fPIC -fno-common  -g -O2 -c xxxpr.f -o xxxpr.o
> gcc -dynamiclib -L/usr/local/lib -dynamiclib -install_name libR.dylib
> -compatibility_version 2.3.0  -current_version 2.3.0  -
> headerpad_max_install_names -o libR.dylib Rembedded.o CConverters.o
> CommandLineArgs.o Rdynload.o Renviron.o RNG.o apply.o arithmetic.o
> apse.o array.o attrib.o base.o bind.o builtin.o character.o coerce.o
> colors.o complex.o connections.o context.o cov.o cum.o dcf.o
> datetime.o debug.o deparse.o deriv.o dotcode.o dounzip.o dstruct.o
> duplicate.o engine.o envir.o errors.o eval.o format.o fourier.o
> gevents.o gram.o gram-ex.o graphics.o identical.o internet.o
> iosupport.o lapack.o list.o localecharset.o logic.o main.o mapply.o
> match.o memory.o model.o names.o objects.o optim.o optimize.o
> options.o par.o paste.o pcre.o platform.o plot.o plot3d.o plotmath.o
> print.o printarray.o printvector.o printutils.o qsort.o random.o
> regex.o registration.o relop.o rlocale.o saveload.o scan.o seq.o
> serialize.o size.o sort.o source.o split.o sprintf.o startup.o
> subassign.o subscript.o subset.o summary.o sysutils.o unique.o util.o
> version.o vfonts.o xxxpr.o   `ls ../appl/*.o ../nmath/*.o ../unix/
> *.o  2>/dev/null` -framework vecLib -L/usr/local/lib/gcc/powerpc-
> apple-darwin7.9.0/3.4.4 -lg2c -lgcc_s -lSystem  ../extra/zlib/
> libz.a ../extra/bzip2/libbz2.a ../extra/pcre/libpcre.a  ../extra/intl/
> libintl.a  -Wl,-framework -Wl,CoreFoundation -lreadline  -lm -liconv
> ld: warning multiple definitions of symbol _xerbla_
> print.o definition of _xerbla_ in section (__TEXT,__text)
> /System/Library/Frameworks/Accelerate.framework/Versions/A/Frameworks/
> vecLib.framework/Versions/A/libBLAS.dylib(single module) definition
> of _xerbla_
> ld: Undefined symbols:
> restFP
> saveFP
> /usr/bin/libtool: internal link edit command failed
> make[3]: *** [libR.dylib] Error 1
> make[2]: *** [R] Error 2
> make[1]: *** [R] Error 1
> make: *** [R] Error 1
> 238-250:~/scratch/R-beta%


A similar error message can be found here:

http://www.mail-archive.com/r-sig-mac at stat.math.ethz.ch/msg00476.html

Does this help to solve your problem?

TS


From slacey at umich.edu  Thu Apr 13 13:34:39 2006
From: slacey at umich.edu (slacey at umich.edu)
Date: Thu, 13 Apr 2006 13:34:39 +0200 (CEST)
Subject: [Rd] S4 class slot name 'names' is not allowed (PR#8768)
Message-ID: <20060413113439.27AD3E93A@slim.kubism.ku.dk>

Martin,

Thanks! I'll use name for now.

Steve

-----Original Message-----
From: Martin Maechler [mailto:maechler at stat.math.ethz.ch] 
Sent: Thursday, April 13, 2006 3:11 AM
To: Steven Lacey
Cc: R-bugs at stat.math.ethz.ch; r-help at stat.math.ethz.ch
Subject: S4 class slot name 'names' is not allowed


>>>>> "SteveL" == Steven Lacey <slacey at umich.edu>
>>>>>     on Wed, 12 Apr 2006 19:06:52 -0400 writes:

    SteveL> Hi, Why doesn't this work?
 
    setClass("tests", representation(names = "character"))
    tmp <- new("tests"); tmp at names <- "a"
 
    SteveL> Error in "slot<-"(object, name, TRUE, value) :
    SteveL> 'names' attribute [1] must be the same length as the vector [0]
 
    SteveL> Why does this work (replace names with name)?
 
    setClass("test", representation(name="character"))
    tmp <- new("test"); tmp at name <- "a"
 
    SteveL> I looked at the help for setClass, representation,
    SteveL> and slot and found no restriction on the slot names
    SteveL> other than that they "be any non-empty string, but
    SteveL> if the name is not made up of letters, numbers, and
    SteveL> '"."', it needs to be quoted".
 

Hah, you got us!
This *is* a bug - at least in the documentation  ===> This goes to R-bugs as
well.

It's because of the current *implementation* of S4-classed objects in R [as
an empty list with a list of unusual attributes]
-- and because  'names'  (and also, e.g., 'dimnames')
are attributes in R with a very special treatment - in many places.

I haven't delved into the internal code, but I know that this problem will
go away ``as soon as'' the internal representation of S4-classed objects is
replaced -- something that has been planned for a while and "just did not
yet happen".

Martin Maechler, ETH Zurich


From Peter.Ruckdeschel at uni-bayreuth.de  Thu Apr 13 15:15:11 2006
From: Peter.Ruckdeschel at uni-bayreuth.de (Peter Ruckdeschel)
Date: Thu, 13 Apr 2006 15:15:11 +0200
Subject: [Rd] contribution offer: df() for non-centrality != 0
Message-ID: <443E4EDF.6060502@uni-bayreuth.de>

Hi R-devels,

I noticed that for the scheduled R 2.3.0,
there is still no function df() for
non-centrality != 0.

Easter is quickly approaching, so as my little
gift, I would like to offer you some code to fill
this gap:

After excluding some "unusual" cases,
it amounts to differentiating the corresponding
function pnf() --- which in turn leads to the
function dnbeta() already available in the
stats package for some time.

You may find this code in

http://www.uni-bayreuth.de/departments/math/org/mathe7/R-devel/dnf.tar.gz

This archive includes the C-File    dnf.c      
as well as some adapted versions     Fdist_new.Rd   
and     distn_new.R;
in the latter two files I indicated all modifications
w.r.t.  Fdist.Rd    and    distn.R     by
a corresponding %%-tag.

You may modify these files as you like in order to
conform your design principles

--- and hopefully we will soon have df() for ncp, too...

Best,
Peter


From Peter.Ruckdeschel at uni-bayreuth.de  Thu Apr 13 15:33:33 2006
From: Peter.Ruckdeschel at uni-bayreuth.de (Peter Ruckdeschel)
Date: Thu, 13 Apr 2006 15:33:33 +0200
Subject: [Rd] Wishlist: 'quietly' argument for .onAttach() / .First.lib()
Message-ID: <443E532D.80805@uni-bayreuth.de>

Hi R-devels,

in "Writing R extensions" as well as in the help
to .onAttach(), you mention that one could
use this function to issue a start-up message/banner
for the package.

My little wish for Easter:

a 'quietly'-type argument for .onAttach() / .First.lib()
which is passed through by functions
require() and library() respectively,
and by means of which one could optionally
suppress this start-up message/banner .

Is this hard to do?

Thank you already
Peter


From maechler at stat.math.ethz.ch  Thu Apr 13 15:44:33 2006
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Thu, 13 Apr 2006 15:44:33 +0200
Subject: [Rd] contribution offer: df() for non-centrality != 0
In-Reply-To: <443E4EDF.6060502@uni-bayreuth.de>
References: <443E4EDF.6060502@uni-bayreuth.de>
Message-ID: <17470.21953.413770.784968@stat.math.ethz.ch>

Thank you, Peter,

but note that this is clearly too late for 2.3.0 :
If you look at the release schedule at
   http://developer.R-project.org/ 
you see that  April 10 was "Feature Freeze".

If it looks good -- and it does after a quick glimpse --
it should be possible to be integrated for 2.3.1 though -- but
that is not at all scheduled yet. 

With regards, 
Martin


>>>>> "PetRd" == Peter Ruckdeschel <Peter.Ruckdeschel at uni-bayreuth.de>
>>>>>     on Thu, 13 Apr 2006 15:15:11 +0200 writes:

    PetRd> Hi R-devels, I noticed that for the scheduled R
    PetRd> 2.3.0, there is still no function df() for
    PetRd> non-centrality != 0.

    PetRd> Easter is quickly approaching, so as my little gift,
    PetRd> I would like to offer you some code to fill this gap:

    PetRd> After excluding some "unusual" cases, it amounts to
    PetRd> differentiating the corresponding function pnf() ---
    PetRd> which in turn leads to the function dnbeta() already
    PetRd> available in the stats package for some time.

    PetRd> You may find this code in

    PetRd> http://www.uni-bayreuth.de/departments/math/org/mathe7/R-devel/dnf.tar.gz

    PetRd> This archive includes the C-File dnf.c as well as
    PetRd> some adapted versions Fdist_new.Rd and distn_new.R;
    PetRd> in the latter two files I indicated all modifications
    PetRd> w.r.t.  Fdist.Rd and distn.R by a corresponding
    PetRd> %%-tag.

    PetRd> You may modify these files as you like in order to
    PetRd> conform your design principles

    PetRd> --- and hopefully we will soon have df() for ncp,
    PetRd> too...


From Peter.Ruckdeschel at uni-bayreuth.de  Thu Apr 13 16:01:52 2006
From: Peter.Ruckdeschel at uni-bayreuth.de (Peter Ruckdeschel)
Date: Thu, 13 Apr 2006 16:01:52 +0200
Subject: [Rd] contribution offer: df() for non-centrality != 0
Message-ID: <443E59D0.10705@uni-bayreuth.de>

Hi Martin,

Martin Maechler wrote:
> but note that this is clearly too late for 2.3.0 :
> If you look at the release schedule at
>    http://developer.R-project.org/ 
> you see that  April 10 was "Feature Freeze".
>   
Yes, don't worry, I have been aware of this;

I did not mean to submit the code for 2.3.0, but just used
this version as a reference  to be "up-to-date".
> If it looks good -- and it does after a quick glimpse --
> it should be possible to be integrated for 2.3.1 though 
This would be fine !
Thank you

Peter


From ripley at stats.ox.ac.uk  Thu Apr 13 16:47:42 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 13 Apr 2006 15:47:42 +0100 (BST)
Subject: [Rd] Wishlist: 'quietly' argument for .onAttach() / .First.lib()
In-Reply-To: <443E532D.80805@uni-bayreuth.de>
References: <443E532D.80805@uni-bayreuth.de>
Message-ID: <Pine.LNX.4.64.0604131538490.24775@gannet.stats.ox.ac.uk>

On Thu, 13 Apr 2006, Peter Ruckdeschel wrote:

> Hi R-devels,
>
> in "Writing R extensions" as well as in the help
> to .onAttach(), you mention that one could
> use this function to issue a start-up message/banner
> for the package.
>
> My little wish for Easter:
>
> a 'quietly'-type argument for .onAttach() / .First.lib()
> which is passed through by functions
> require() and library() respectively,
> and by means of which one could optionally
> suppress this start-up message/banner .
>
> Is this hard to do?

I believe so (and think we have been here before).  The documented call 
sequence is

      .onLoad(libname, pkgname)
      .onAttach(libname, pkgname)

the same as .First.lib.  There is no way to add an argument here, as many 
existing packages do not support it.  Beyond that, how would you pass the 
argument in?  Namespaces and packages are often loaded/attached implicitly 
as a result of loading other packages.

I did think you could make use of an option to decide whether to the print 
the message or not, but I have always assumed that those who did want a 
banner probably did not want it suppressed.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From andy_liaw at merck.com  Thu Apr 13 17:14:55 2006
From: andy_liaw at merck.com (Liaw, Andy)
Date: Thu, 13 Apr 2006 11:14:55 -0400
Subject: [Rd] Wishlist: 'quietly' argument for .onAttach() / .First.li
 b()
Message-ID: <39B6DDB9048D0F4DAD42CB26AAFF0AFAFEDAA0@usctmx1106.merck.com>

From: Prof Brian Ripley
> 
> On Thu, 13 Apr 2006, Peter Ruckdeschel wrote:
> 
> > Hi R-devels,
> >
> > in "Writing R extensions" as well as in the help
> > to .onAttach(), you mention that one could
> > use this function to issue a start-up message/banner
> > for the package.
> >
> > My little wish for Easter:
> >
> > a 'quietly'-type argument for .onAttach() / .First.lib() which is 
> > passed through by functions
> > require() and library() respectively,
> > and by means of which one could optionally
> > suppress this start-up message/banner .
> >
> > Is this hard to do?
> 
> I believe so (and think we have been here before).  The 
> documented call 
> sequence is
> 
>       .onLoad(libname, pkgname)
>       .onAttach(libname, pkgname)
> 
> the same as .First.lib.  There is no way to add an argument 
> here, as many 
> existing packages do not support it.  Beyond that, how would 
> you pass the 
> argument in?  Namespaces and packages are often 
> loaded/attached implicitly 
> as a result of loading other packages.
> 
> I did think you could make use of an option to decide whether 
> to the print 
> the message or not, but I have always assumed that those who 
> did want a 
> banner probably did not want it suppressed.

That certainly is the case with randomForest, speaking for myself
here.  The banner I put in contains the version number of the 
package and a reminder to see what's been changed/fixed.  I have 
not seen a compelling reason why suppressing such information is 
necessary (as opposed to "desirable").  I believe reporting 
version number upon startup is a Good Thing, as all too often 
people ask questions or report problems about packages without
mentioning the version of the packages they used.  I see this as
a way of reminding the users.

Andy


 
> -- 
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
> 
> ______________________________________________
> R-devel at r-project.org mailing list 
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
>


From franck.arnaud at gmail.com  Thu Apr 13 17:17:14 2006
From: franck.arnaud at gmail.com (Franck Arnaud)
Date: Thu, 13 Apr 2006 17:17:14 +0200
Subject: [Rd] Calloc : syntax error
Message-ID: <44dc13910604130817n5dbc524er1770087d9109804f@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20060413/56937419/attachment.pl 

From maechler at stat.math.ethz.ch  Thu Apr 13 17:35:38 2006
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Thu, 13 Apr 2006 17:35:38 +0200
Subject: [Rd] Calloc : syntax error
In-Reply-To: <44dc13910604130817n5dbc524er1770087d9109804f@mail.gmail.com>
References: <44dc13910604130817n5dbc524er1770087d9109804f@mail.gmail.com>
Message-ID: <17470.28618.279553.540878@stat.math.ethz.ch>

>>>>> "Franck" == Franck Arnaud <franck.arnaud at gmail.com>
>>>>>     on Thu, 13 Apr 2006 17:17:14 +0200 writes:

    Franck> Hi, I have issue with Calloc : at the compilation
    Franck> step, gcc tells "error : syntax error before ')'
    Franck> token".  When I use the classical C calloc... free,
    Franck> everything's fine.  Here's the part of code : a =
    Franck> (double*) Calloc(*n,sizeof(double));

    Franck> when i remove this line or replace it with the
    Franck> calloc, it's ok

    Franck> Hint : In the header file R.h, there's a line : /*
    Franck> for PROBLEM ... Calloc, Realloc, Free, Memcpy,
    Franck> F77_xxxx */ is it related ?

not at all.
    Franck> Does anyone know ?  

yes, everyone even who carefully looks at the corresponding
section in the  "Writing R Extensions" manual.

Calloc() is used in many places in R and contributed packages.

Hint: It's usage syntax is *different* and slightly simpler
      than the one you used above.
Hint2: A typical use is  ' Calloc(n, double); '

    Franck> 	[[alternative HTML version deleted]]

Hint3: Read the posting guide 
       http://www.r-project.org/posting-guide.html
       in order not to produce such as the above line 

Regards, and  Happy Easter (to all in the audience),
Martin Maechler, ETH Zurich


From ripley at stats.ox.ac.uk  Thu Apr 13 17:39:27 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 13 Apr 2006 16:39:27 +0100 (BST)
Subject: [Rd] Calloc : syntax error
In-Reply-To: <44dc13910604130817n5dbc524er1770087d9109804f@mail.gmail.com>
References: <44dc13910604130817n5dbc524er1770087d9109804f@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0604131626550.25857@gannet.stats.ox.ac.uk>

On Thu, 13 Apr 2006, Franck Arnaud wrote:

> Hi,
> I have issue with Calloc : at the compilation step, gcc tells "error :
> syntax error before ')' token".
> When I use the classical C calloc... free, everything's fine.
> Here's the part of code :
> a = (double*) Calloc(*n,sizeof(double));
>
> when i remove this line or replace it with the calloc, it's ok
>
> Hint : In the header file R.h, there's a line :
> /* for PROBLEM ... Calloc, Realloc, Free, Memcpy, F77_xxxx */
> is it related ?

Please see `Writing R Extensions'.  You want

a = Calloc(*n, double);

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From Peter.Ruckdeschel at uni-bayreuth.de  Thu Apr 13 18:13:50 2006
From: Peter.Ruckdeschel at uni-bayreuth.de (Peter Ruckdeschel)
Date: Thu, 13 Apr 2006 18:13:50 +0200
Subject: [Rd] Wishlist: 'quietly' argument for .onAttach() / .First.lib()
Message-ID: <443E78BE.2040706@uni-bayreuth.de>

Andy Liaw wrote:
> From: Prof Brian Ripley
> >/ 
> />/ On Thu, 13 Apr 2006, Peter Ruckdeschel wrote:
> />/ 
> />/ > Hi R-devels,
> />/ >
> />/ > in "Writing R extensions" as well as in the help
> />/ > to .onAttach(), you mention that one could
> />/ > use this function to issue a start-up message/banner
> />/ > for the package.
> />/ >
> />/ > My little wish for Easter:
> />/ >
> />/ > a 'quietly'-type argument for .onAttach() / .First.lib() which is 
> />/ > passed through by functions
> />/ > require() and library() respectively,
> />/ > and by means of which one could optionally
> />/ > suppress this start-up message/banner .
> />/ >
> />/ > Is this hard to do?
> />/ 
> />/ I believe so (and think we have been here before). /
sorry, but I did not find anything on it ---
probably I searched for the wrong keywords.
> /> The //documented call //sequence is
> />/ 
> />/       .onLoad(libname, pkgname)
> />/       .onAttach(libname, pkgname)
> />/ 
> />/ the same as .First.lib.  There is no way to add an argument 
> />/ here, as many //existing packages do not support it.  
> /
Couldn't a reasonable default value (probably FALSE ) catch this?
> /> Beyond that, how would / /you pass the 
> />/ argument in?  Namespaces and packages are often 
> />/ loaded/attached implicitly //as a result of loading other packages.
> /
oK this is an issue --- no idea for this.
> >/ I did think you could make use of an option to decide whether 
> />/ to the print //the message or not, 
> /
This is probably the cleanest solution.
> /> but I have always assumed that those who 
> />/ did want a //banner probably did not want it suppressed.
> /
> That certainly is the case with randomForest, speaking for myself
> here.  The banner I put in contains the version number of the 
> package and a reminder to see what's been changed/fixed.  I have 
> not seen a compelling reason why suppressing such information is 
> necessary (as opposed to "desirable").  I believe reporting 
> version number upon startup is a Good Thing, as all too often 
> people ask questions or report problems about packages without
> mentioning the version of the packages they used.  I see this as
> a way of reminding the users.
>   
I completely agree as to package version information
and pointers to NEWS / more information on the package.

My wish is motivated by something else ---  call it
 
           /"scalable start-up message"/

In a discussion with Martin Maechler, he proposed to alert/warn
the user in some prominent place about the interpretation of
arithmetics operating on distributions in our package "distr".

I have been thinking about this "prominent place" for some time
and found that an .onAttach() message might be the right place.

A user, however, who is already used to this interpretation, will soon
find this (extended) start-up message annoying and will want to
suppress it.

I could do this with a "hand-made" option but thought this might
be of more general interest.

Thank you for your attention,
Peter


From ripley at stats.ox.ac.uk  Thu Apr 13 18:25:55 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 13 Apr 2006 17:25:55 +0100 (BST)
Subject: [Rd] Wishlist: 'quietly' argument for .onAttach() / .First.lib()
In-Reply-To: <443E78BE.2040706@uni-bayreuth.de>
References: <443E78BE.2040706@uni-bayreuth.de>
Message-ID: <Pine.LNX.4.64.0604131721150.27535@gannet.stats.ox.ac.uk>

On Thu, 13 Apr 2006, Peter Ruckdeschel wrote:

> Andy Liaw wrote:
>> From: Prof Brian Ripley
>>> /
>> />/ On Thu, 13 Apr 2006, Peter Ruckdeschel wrote:
>> />/
>> />/ > Hi R-devels,
>> />/ >
>> />/ > in "Writing R extensions" as well as in the help
>> />/ > to .onAttach(), you mention that one could
>> />/ > use this function to issue a start-up message/banner
>> />/ > for the package.
>> />/ >
>> />/ > My little wish for Easter:
>> />/ >
>> />/ > a 'quietly'-type argument for .onAttach() / .First.lib() which is
>> />/ > passed through by functions
>> />/ > require() and library() respectively,
>> />/ > and by means of which one could optionally
>> />/ > suppress this start-up message/banner .
>> />/ >
>> />/ > Is this hard to do?
>> />/
>> />/ I believe so (and think we have been here before). /
> sorry, but I did not find anything on it ---
> probably I searched for the wrong keywords.
>> /> The //documented call //sequence is
>> />/
>> />/       .onLoad(libname, pkgname)
>> />/       .onAttach(libname, pkgname)
>> />/
>> />/ the same as .First.lib.  There is no way to add an argument
>> />/ here, as many //existing packages do not support it.
>> /
> Couldn't a reasonable default value (probably FALSE ) catch this?

No. The problem is the other way round: if we arrange to call 
.onLoad(libname, pkgname, quietly), MASS will throw an error about an 
unmatched argument in its .onLoad, and similarly for hundreds of packages.
It's an API change, one of a magnitude that we would only contemplate for
R 3.x.y.

>> /> Beyond that, how would / /you pass the
>> />/ argument in?  Namespaces and packages are often
>> />/ loaded/attached implicitly //as a result of loading other packages.
>> /
> oK this is an issue --- no idea for this.
>>> / I did think you could make use of an option to decide whether
>> />/ to the print //the message or not,
>> /
> This is probably the cleanest solution.
>> /> but I have always assumed that those who
>> />/ did want a //banner probably did not want it suppressed.
>> /
>> That certainly is the case with randomForest, speaking for myself
>> here.  The banner I put in contains the version number of the
>> package and a reminder to see what's been changed/fixed.  I have
>> not seen a compelling reason why suppressing such information is
>> necessary (as opposed to "desirable").  I believe reporting
>> version number upon startup is a Good Thing, as all too often
>> people ask questions or report problems about packages without
>> mentioning the version of the packages they used.  I see this as
>> a way of reminding the users.
>>
> I completely agree as to package version information
> and pointers to NEWS / more information on the package.
>
> My wish is motivated by something else ---  call it
>
>           /"scalable start-up message"/
>
> In a discussion with Martin Maechler, he proposed to alert/warn
> the user in some prominent place about the interpretation of
> arithmetics operating on distributions in our package "distr".
>
> I have been thinking about this "prominent place" for some time
> and found that an .onAttach() message might be the right place.
>
> A user, however, who is already used to this interpretation, will soon
> find this (extended) start-up message annoying and will want to
> suppress it.
>
> I could do this with a "hand-made" option but thought this might
> be of more general interest.
>
> Thank you for your attention,
> Peter
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From pgilbert at bank-banque-canada.ca  Thu Apr 13 18:31:28 2006
From: pgilbert at bank-banque-canada.ca (Paul Gilbert)
Date: Thu, 13 Apr 2006 12:31:28 -0400
Subject: [Rd] xmkmf?  problem
Message-ID: <443E7CE0.9020100@bank-banque-canada.ca>

I am having the  xmkmf  problem below with todays beta, but I also am 
trying to use an new (PGI 6.1),  so lots of other things in my setup may 
be wrong, and the warning may also be important. Any hints would be 
appreciated.

Paul
_____

Red Hat Enterprise Linux AS release 3 (Taroon Update 7)
....
checking whether C runtime needs -D__NO_MATH_INLINES... no
checking for xmkmf... /usr/X11R6/bin/xmkmf
Usage: which [options] [--] programname [...]
Options: --version, -[vV] Print version and exit successfully.
         --help,          Print this help and exit successfully.
         --skip-dot       Skip directories in PATH that start with a dot.
         --skip-tilde     Skip directories in PATH that start with a tilde.
         --show-dot       Don't expand a dot to current directory in output.
         --show-tilde     Output a tilde for HOME directory for non-root.
         --tty-only       Stop processing options on the right if not on 
tty.
         --all, -a        Print all matches in PATH, not just the first
         --read-alias, -i Read list of aliases from stdin.
         --skip-alias     Ignore option --read-alias; don't read stdin.
         --read-functions Read shell functions from stdin.
         --skip-functions Ignore option --read-functions; don't read stdin.
Usage: which [options] [--] programname [...]
Options: --version, -[vV] Print version and exit successfully.
         --help,          Print this help and exit successfully.
         --skip-dot       Skip directories in PATH that start with a dot.
         --skip-tilde     Skip directories in PATH that start with a tilde.
         --show-dot       Don't expand a dot to current directory in output.
         --show-tilde     Output a tilde for HOME directory for non-root.
         --tty-only       Stop processing options on the right if not on 
tty.
         --all, -a        Print all matches in PATH, not just the first
         --read-alias, -i Read list of aliases from stdin.
         --skip-alias     Ignore option --read-alias; don't read stdin.
         --read-functions Read shell functions from stdin.
         --skip-functions Ignore option --read-functions; don't read stdin.
configure: WARNING: I could not determine SHLIB_LDFLAGS.
configure: error: See the file doc/html/R-admin.html for more information.
~/toolchain/R/mfa04559/R-beta:
====================================================================================

La version fran?aise suit le texte anglais.

------------------------------------------------------------------------------------

This email may contain privileged and/or confidential inform...{{dropped}}


From ripley at stats.ox.ac.uk  Thu Apr 13 19:09:04 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 13 Apr 2006 18:09:04 +0100 (BST)
Subject: [Rd] xmkmf?  problem
In-Reply-To: <443E7CE0.9020100@bank-banque-canada.ca>
References: <443E7CE0.9020100@bank-banque-canada.ca>
Message-ID: <Pine.LNX.4.64.0604131801300.28609@gannet.stats.ox.ac.uk>

On Thu, 13 Apr 2006, Paul Gilbert wrote:

> I am having the  xmkmf  problem below with todays beta, but I also am
> trying to use an new (PGI 6.1),  so lots of other things in my setup may
> be wrong, and the warning may also be important. Any hints would be
> appreciated.

My guess is that this is from

   cc=`${srcdir}/tools/GETMAKEVAL CC`
   cc=`echo ${cc} | sed "s/ .*//"`
   if test "`which ${cc}`" = "`which ${CC}`"; then
     shlib_ldflags=`${srcdir}/tools/GETMAKEVAL SHLIBLDFLAGS`
     cpicflags=`${srcdir}/tools/GETMAKEVAL PICFLAGS`
   fi
   cxx=`${srcdir}/tools/GETMAKEVAL CXX`
   cxx=`echo ${cxx} | sed "s/ .*//"`
   if test "`which ${cxx}`" = "`which ${CXX}`"; then
     cxxpicflags=`${srcdir}/tools/GETMAKEVAL CXXPICFLAGS`
   fi

in configure and so either your compilers are not set correctly or your 
OS's X11 does not find the compilers used to compile it.

I'd start by inserting debugging code in configure at that point to find 
out what ${cc} and ${CC} are, with the expectation that one is empty.

>
> Paul
> _____
>
> Red Hat Enterprise Linux AS release 3 (Taroon Update 7)
> ....
> checking whether C runtime needs -D__NO_MATH_INLINES... no
> checking for xmkmf... /usr/X11R6/bin/xmkmf
> Usage: which [options] [--] programname [...]
> Options: --version, -[vV] Print version and exit successfully.
>         --help,          Print this help and exit successfully.
>         --skip-dot       Skip directories in PATH that start with a dot.
>         --skip-tilde     Skip directories in PATH that start with a tilde.
>         --show-dot       Don't expand a dot to current directory in output.
>         --show-tilde     Output a tilde for HOME directory for non-root.
>         --tty-only       Stop processing options on the right if not on
> tty.
>         --all, -a        Print all matches in PATH, not just the first
>         --read-alias, -i Read list of aliases from stdin.
>         --skip-alias     Ignore option --read-alias; don't read stdin.
>         --read-functions Read shell functions from stdin.
>         --skip-functions Ignore option --read-functions; don't read stdin.
> Usage: which [options] [--] programname [...]
> Options: --version, -[vV] Print version and exit successfully.
>         --help,          Print this help and exit successfully.
>         --skip-dot       Skip directories in PATH that start with a dot.
>         --skip-tilde     Skip directories in PATH that start with a tilde.
>         --show-dot       Don't expand a dot to current directory in output.
>         --show-tilde     Output a tilde for HOME directory for non-root.
>         --tty-only       Stop processing options on the right if not on
> tty.
>         --all, -a        Print all matches in PATH, not just the first
>         --read-alias, -i Read list of aliases from stdin.
>         --skip-alias     Ignore option --read-alias; don't read stdin.
>         --read-functions Read shell functions from stdin.
>         --skip-functions Ignore option --read-functions; don't read stdin.
> configure: WARNING: I could not determine SHLIB_LDFLAGS.
> configure: error: See the file doc/html/R-admin.html for more information.
> ~/toolchain/R/mfa04559/R-beta:
> ====================================================================================
>
> La version fran?aise suit le texte anglais.
>
> ------------------------------------------------------------------------------------
>
> This email may contain privileged and/or confidential inform...{{dropped}}
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From pgilbert at bank-banque-canada.ca  Thu Apr 13 20:57:43 2006
From: pgilbert at bank-banque-canada.ca (Paul Gilbert)
Date: Thu, 13 Apr 2006 14:57:43 -0400
Subject: [Rd] xmkmf?  problem
In-Reply-To: <Pine.LNX.4.64.0604131801300.28609@gannet.stats.ox.ac.uk>
References: <443E7CE0.9020100@bank-banque-canada.ca>
	<Pine.LNX.4.64.0604131801300.28609@gannet.stats.ox.ac.uk>
Message-ID: <443E9F27.30302@bank-banque-canada.ca>


Brian

Yes cc is empty. Perhaps I should have mentioned that I have set 
CC=pgcc, to find the new compiler. Should I be setting cc too? Is there 
a problem if the compiler used for X11 was different?

Thanks,
Paul

Prof Brian Ripley wrote:
> On Thu, 13 Apr 2006, Paul Gilbert wrote:
> 
>> I am having the  xmkmf  problem below with todays beta, but I also am
>> trying to use an new (PGI 6.1),  so lots of other things in my setup may
>> be wrong, and the warning may also be important. Any hints would be
>> appreciated.
> 
> My guess is that this is from
> 
>   cc=`${srcdir}/tools/GETMAKEVAL CC`
>   cc=`echo ${cc} | sed "s/ .*//"`
>   if test "`which ${cc}`" = "`which ${CC}`"; then
>     shlib_ldflags=`${srcdir}/tools/GETMAKEVAL SHLIBLDFLAGS`
>     cpicflags=`${srcdir}/tools/GETMAKEVAL PICFLAGS`
>   fi
>   cxx=`${srcdir}/tools/GETMAKEVAL CXX`
>   cxx=`echo ${cxx} | sed "s/ .*//"`
>   if test "`which ${cxx}`" = "`which ${CXX}`"; then
>     cxxpicflags=`${srcdir}/tools/GETMAKEVAL CXXPICFLAGS`
>   fi
> 
> in configure and so either your compilers are not set correctly or your 
> OS's X11 does not find the compilers used to compile it.
> 
> I'd start by inserting debugging code in configure at that point to find 
> out what ${cc} and ${CC} are, with the expectation that one is empty.
> 
>>
>> Paul
>> _____
>>
>> Red Hat Enterprise Linux AS release 3 (Taroon Update 7)
>> ....
>> checking whether C runtime needs -D__NO_MATH_INLINES... no
>> checking for xmkmf... /usr/X11R6/bin/xmkmf
>> Usage: which [options] [--] programname [...]
>> Options: --version, -[vV] Print version and exit successfully.
>>         --help,          Print this help and exit successfully.
>>         --skip-dot       Skip directories in PATH that start with a dot.
>>         --skip-tilde     Skip directories in PATH that start with a 
>> tilde.
>>         --show-dot       Don't expand a dot to current directory in 
>> output.
>>         --show-tilde     Output a tilde for HOME directory for non-root.
>>         --tty-only       Stop processing options on the right if not on
>> tty.
>>         --all, -a        Print all matches in PATH, not just the first
>>         --read-alias, -i Read list of aliases from stdin.
>>         --skip-alias     Ignore option --read-alias; don't read stdin.
>>         --read-functions Read shell functions from stdin.
>>         --skip-functions Ignore option --read-functions; don't read 
>> stdin.
>> Usage: which [options] [--] programname [...]
>> Options: --version, -[vV] Print version and exit successfully.
>>         --help,          Print this help and exit successfully.
>>         --skip-dot       Skip directories in PATH that start with a dot.
>>         --skip-tilde     Skip directories in PATH that start with a 
>> tilde.
>>         --show-dot       Don't expand a dot to current directory in 
>> output.
>>         --show-tilde     Output a tilde for HOME directory for non-root.
>>         --tty-only       Stop processing options on the right if not on
>> tty.
>>         --all, -a        Print all matches in PATH, not just the first
>>         --read-alias, -i Read list of aliases from stdin.
>>         --skip-alias     Ignore option --read-alias; don't read stdin.
>>         --read-functions Read shell functions from stdin.
>>         --skip-functions Ignore option --read-functions; don't read 
>> stdin.
>> configure: WARNING: I could not determine SHLIB_LDFLAGS.
>> configure: error: See the file doc/html/R-admin.html for more 
>> information.
>> ~/toolchain/R/mfa04559/R-beta:
>> ==================================================================================== 
>>
>>
>> La version fran?aise suit le texte anglais.
>>
>> ------------------------------------------------------------------------------------ 
>>
>>
>> This email may contain privileged and/or confidential 
>> inform...{{dropped}}
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
> 
====================================================================================

La version fran?aise suit le texte anglais.

------------------------------------------------------------------------------------

This email may contain privileged and/or confidential inform...{{dropped}}


From bill at insightful.com  Thu Apr 13 21:12:05 2006
From: bill at insightful.com (Bill Dunlap)
Date: Thu, 13 Apr 2006 12:12:05 -0700 (PDT)
Subject: [Rd] Wishlist: 'quietly' argument for .onAttach() / .First.lib()
In-Reply-To: <Pine.LNX.4.64.0604131538490.24775@gannet.stats.ox.ac.uk>
References: <443E532D.80805@uni-bayreuth.de>
	<Pine.LNX.4.64.0604131538490.24775@gannet.stats.ox.ac.uk>
Message-ID: <Pine.GSO.4.56.0604131204370.18997@durian.statsci.com>

On Thu, 13 Apr 2006, Prof Brian Ripley wrote:

> On Thu, 13 Apr 2006, Peter Ruckdeschel wrote:
>
> > Hi R-devels,
> >
> > in "Writing R extensions" as well as in the help
> > to .onAttach(), you mention that one could
> > use this function to issue a start-up message/banner
> > for the package.
> >
> > My little wish for Easter:
> >
> > a 'quietly'-type argument for .onAttach() / .First.lib()
> > which is passed through by functions
> > require() and library() respectively,
> > and by means of which one could optionally
> > suppress this start-up message/banner .
> >
> > Is this hard to do?
>
> I believe so (and think we have been here before).  The documented call
> sequence is
>
>       .onLoad(libname, pkgname)
>       .onAttach(libname, pkgname)
>
> the same as .First.lib.  There is no way to add an argument here, as many
> existing packages do not support it.  Beyond that, how would you pass the
> argument in?  Namespaces and packages are often loaded/attached implicitly
> as a result of loading other packages.
>
> I did think you could make use of an option to decide whether to the print
> the message or not, but I have always assumed that those who did want a
> banner probably did not want it suppressed.

If the .onAttach() used message() instead of cat()
to display the banner message then you could use
	suppressMessages(require("randomForest"))
to squelch the message.

----------------------------------------------------------------------------
Bill Dunlap
Insightful Corporation
bill at insightful dot com
360-428-8146

 "All statements in this message represent the opinions of the author and do
 not necessarily reflect Insightful Corporation policy or position."


From andy_liaw at merck.com  Thu Apr 13 21:41:27 2006
From: andy_liaw at merck.com (Liaw, Andy)
Date: Thu, 13 Apr 2006 15:41:27 -0400
Subject: [Rd] Wishlist: 'quietly' argument for .onAttach() / .First.li
 b()
Message-ID: <39B6DDB9048D0F4DAD42CB26AAFF0AFAFEDAA5@usctmx1106.merck.com>

From: Bill Dunlap
> 
> On Thu, 13 Apr 2006, Prof Brian Ripley wrote:
> 
> > On Thu, 13 Apr 2006, Peter Ruckdeschel wrote:
> >
> > > Hi R-devels,
> > >
> > > in "Writing R extensions" as well as in the help
> > > to .onAttach(), you mention that one could
> > > use this function to issue a start-up message/banner
> > > for the package.
> > >
> > > My little wish for Easter:
> > >
> > > a 'quietly'-type argument for .onAttach() / .First.lib() which is 
> > > passed through by functions
> > > require() and library() respectively,
> > > and by means of which one could optionally
> > > suppress this start-up message/banner .
> > >
> > > Is this hard to do?
> >
> > I believe so (and think we have been here before).  The documented 
> > call sequence is
> >
> >       .onLoad(libname, pkgname)
> >       .onAttach(libname, pkgname)
> >
> > the same as .First.lib.  There is no way to add an argument 
> here, as 
> > many existing packages do not support it.  Beyond that, how 
> would you 
> > pass the argument in?  Namespaces and packages are often 
> > loaded/attached implicitly as a result of loading other packages.
> >
> > I did think you could make use of an option to decide 
> whether to the 
> > print the message or not, but I have always assumed that 
> those who did 
> > want a banner probably did not want it suppressed.
> 
> If the .onAttach() used message() instead of cat()
> to display the banner message then you could use
> 	suppressMessages(require("randomForest"))
> to squelch the message.

Thanks!  This looks like a good alternative.  What do others think of this
approach?

Andy

 
> --------------------------------------------------------------
> --------------
> Bill Dunlap
> Insightful Corporation
> bill at insightful dot com
> 360-428-8146
> 
>  "All statements in this message represent the opinions of 
> the author and do  not necessarily reflect Insightful 
> Corporation policy or position."
> 
> ______________________________________________
> R-devel at r-project.org mailing list 
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
>


From maechler at stat.math.ethz.ch  Thu Apr 13 21:58:07 2006
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Thu, 13 Apr 2006 21:58:07 +0200
Subject: [Rd] Wishlist: 'quietly' argument for .onAttach() / .First.li
 b()
In-Reply-To: <39B6DDB9048D0F4DAD42CB26AAFF0AFAFEDAA5@usctmx1106.merck.com>
References: <39B6DDB9048D0F4DAD42CB26AAFF0AFAFEDAA5@usctmx1106.merck.com>
Message-ID: <17470.44367.550262.236934@stat.math.ethz.ch>

>>>>> "AndyL" == Liaw, Andy <andy_liaw at merck.com>
>>>>>     on Thu, 13 Apr 2006 15:41:27 -0400 writes:

    AndyL> From: Bill Dunlap
    >>  On Thu, 13 Apr 2006, Prof Brian Ripley wrote:
    >> 
    >> > On Thu, 13 Apr 2006, Peter Ruckdeschel wrote:
    >> >
    >> > > Hi R-devels,
    >> > >
    >> > > in "Writing R extensions" as well as in the help > >
    >> to .onAttach(), you mention that one could > > use this
    >> function to issue a start-up message/banner > > for the
    >> package.
    >> > >
    >> > > My little wish for Easter:
    >> > >
    >> > > a 'quietly'-type argument for .onAttach() /
    >> .First.lib() which is > > passed through by functions > >
    >> require() and library() respectively, > > and by means of
    >> which one could optionally > > suppress this start-up
    >> message/banner .
    >> > >
    >> > > Is this hard to do?
    >> >
    >> > I believe so (and think we have been here before).  The
    >> documented > call sequence is
    >> >
    >> > .onLoad(libname, pkgname) > .onAttach(libname, pkgname)
    >> >
    >> > the same as .First.lib.  There is no way to add an
    >> argument here, as > many existing packages do not support
    >> it.  Beyond that, how would you > pass the argument in?
    >> Namespaces and packages are often > loaded/attached
    >> implicitly as a result of loading other packages.
    >> >
    >> > I did think you could make use of an option to decide
    >> whether to the > print the message or not, but I have
    >> always assumed that those who did > want a banner
    >> probably did not want it suppressed.
    >> 
    >> If the .onAttach() used message() instead of cat() to
    >> display the banner message then you could use
    >> suppressMessages(require("randomForest")) to squelch the
    >> message.

Very nice thought and proposal!

    AndyL> Thanks!  This looks like a good alternative.  What do
    AndyL> others think of this approach?

I think we should recommend to use message(.) instead of cat(.)
inside in .onAttach() or .First.lib() functions.

Martin

    >> ---------------------------------------------------------------------
    >> Bill Dunlap Insightful Corporation bill at insightful dot
    >> com 360-428-8146
    >> 
    >> "All statements in this message represent the opinions of
    >> the author and do not necessarily reflect Insightful
    >> Corporation policy or position."


From roebuck at mdanderson.org  Thu Apr 13 22:06:44 2006
From: roebuck at mdanderson.org (Paul Roebuck)
Date: Thu, 13 Apr 2006 15:06:44 -0500 (CDT)
Subject: [Rd] Wishlist: 'quietly' argument for .onAttach() / .First.lib()
In-Reply-To: <39B6DDB9048D0F4DAD42CB26AAFF0AFAFEDAA5@usctmx1106.merck.com>
References: <39B6DDB9048D0F4DAD42CB26AAFF0AFAFEDAA5@usctmx1106.merck.com>
Message-ID: <Pine.OSF.4.58.0604131458490.336486@wotan.mdacc.tmc.edu>

On Thu, 13 Apr 2006, Liaw, Andy wrote:

> From: Bill Dunlap
> >
> > On Thu, 13 Apr 2006, Prof Brian Ripley wrote:
> >
> > > On Thu, 13 Apr 2006, Peter Ruckdeschel wrote:
> > >
> > > > in "Writing R extensions" as well as in the help
> > > > to .onAttach(), you mention that one could
> > > > use this function to issue a start-up message/banner
> > > > for the package.
> > > >
> > > > My little wish for Easter:
> > > >
> > > > a 'quietly'-type argument for .onAttach() / .First.lib() which is
> > > > passed through by functions
> > > > require() and library() respectively,
> > > > and by means of which one could optionally
> > > > suppress this start-up message/banner .
> > > >
> > > > Is this hard to do?
> > >
> > > I believe so (and think we have been here before).  The documented
> > > call sequence is
> > >
> > >       .onLoad(libname, pkgname)
> > >       .onAttach(libname, pkgname)
> > >
> > > the same as .First.lib.  There is no way to add an argument
> > here, as
> > > many existing packages do not support it.  Beyond that, how
> > would you
> > > pass the argument in?  Namespaces and packages are often
> > > loaded/attached implicitly as a result of loading other packages.
> > >
> > > I did think you could make use of an option to decide
> > whether to the
> > > print the message or not, but I have always assumed that
> > those who did
> > > want a banner probably did not want it suppressed.
> >
> > If the .onAttach() used message() instead of cat()
> > to display the banner message then you could use
> > 	suppressMessages(require("randomForest"))
> > to squelch the message.
>
> Thanks!  This looks like a good alternative.  What do others think of this
> approach?

I used an alternative approach myself. This allows the user
enable/disable the banner text quite easily.

.onAttach <- function(libname, pkgname) {
    if (verbose <- getOption("verbose")) {
        ...
        desc <- packageDescription(pkgname)
        cat(sprintf("%s, version %s", desc$Title, desc$Version), "\n")
        cat(sprintf("Type library(help=%s) to see package documentation",
                    libraryPkgName(pkgname)), "\n")
    }
}

----------------------------------------------------------
SIGSIG -- signature too long (core dumped)


From jmc at r-project.org  Thu Apr 13 23:22:01 2006
From: jmc at r-project.org (John Chambers)
Date: Thu, 13 Apr 2006 17:22:01 -0400
Subject: [Rd] [R] S4 method dispatch matrixOrArray (fwd)
In-Reply-To: <Pine.OSF.4.58.0604122227040.305100@wotan.mdacc.tmc.edu>
References: <Pine.OSF.4.58.0604122227040.305100@wotan.mdacc.tmc.edu>
Message-ID: <443EC0F9.2060206@r-project.org>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20060413/9d1283e1/attachment.pl 

From dfaden at gmail.com  Fri Apr 14 00:47:08 2006
From: dfaden at gmail.com (David Faden)
Date: Thu, 13 Apr 2006 17:47:08 -0500
Subject: [Rd] bus error on calling nmmin
Message-ID: <6730abff0604131547s1e774aadgf91fa93ea0ee8205@mail.gmail.com>

Hi,

I'm trying to get a toy program making use of nmmin to run
successfully. I've gotten to the point of compiling. However, when I
attempt to run my executable, I guess a bus error. I see that someone
else has asked about using nmmin before
<http://tolstoy.newcastle.edu.au/R/help/06/03/23944.html>, but I
haven't come across any replies.

Is there some documentation on how to call nmmin apart the optim help
page and the page in the R extensions manual giving the declaration?
What do I need to change in the below to get it to work? (I also get a
bus error with trace set to 0.)

The source code and an example session:

nmminDemo.c:
#include <R_ext/Applic.h>
#include <stdio.h>

double parabola(int n, double *par, void *ex) {
  double xm = par[0] - 1;
  return xm * xm + 13;
}

int main()
{
  double initial[1] = {1.5};
  double result[1];
  double value;
  int convergenceCode;
  const double abstol = 1e-16;
  const double reltol = 1e-8;
  const double alpha = 1.0; /* reflection factor */
  const double beta = 0.5; /* contraction factor */
  const double gamm = 2.0; /* expansion factor */
  const int trace = 4; /* tracing on */
  int fncount;
  const int maxit = 10000;
  nmmin(1, initial, result, &value,
	parabola, &convergenceCode,
	abstol, reltol,
	NULL,
	alpha, beta, gamm,
	trace, &fncount, maxit);
  printf("fncount: %d\n", fncount);
  printf("convergence code: %d\n", convergenceCode);
  printf("min of %f at x = %f\n", value, result[0]);
  return 0;
}

------

$ gcc nmminDemo.c -g
-I/Library/Frameworks/R.framework/Versions/2.1.1/Resources/include
-L/Library/Frameworks/R.framework/Versions/2.1.1/Resources/lib -lR
$ ./a.out Bus error
$ gdb a.out
GNU gdb 5.3-20030128 (Apple version gdb-330.1) (Fri Jul 16 21:42:28 GMT 2004)
...
(gdb) run
Starting program: /Users/dfaden/Desktop/R/a.out
Reading symbols for shared libraries +......... done

Program received signal EXC_BAD_ACCESS, Could not access memory.
0x00000000 in ?? ()
(gdb) bt
#0  0x00000000 in ?? ()
Cannot access memory at address 0x0
Cannot access memory at address 0x0
#1  0x0054dd5c in REvprintf (format=0x5f0dc8 "%s", arg=0xbfffb5fc "")
at ../../../../R-2.1.1/src/main/printutils.c:541
#2  0x0054dab0 in REprintf (format=0xbfff9570 "Error: invalid
connection\n") at ../../../../R-2.1.1/src/main/printutils.c:458
#3  0x004de8c4 in verrorcall_dflt (call=0x0, format=0x5f0dc8 "%s",
ap=0xbfffda30 "???P") at ../../../../R-2.1.1/src/main/errors.c:470
#4  0x004dea1c in Rf_errorcall (call=0x5f0dc8, format=0xbfffb5fc "")
at ../../../../R-2.1.1/src/main/errors.c:514
#5  0x004deb38 in Rf_error (format=0xbfff9570 "Error: invalid
connection\n") at ../../../../R-2.1.1/src/main/errors.c:538
#6  0x004acc18 in getConnection (n=-1073769104) at
../../../../R-2.1.1/src/main/connections.c:95
#7  0x0054dc04 in Rvprintf (format=0x5fe004 "  Nelder-Mead direct
search function minimizer\n", arg=0xbffffb7c "???P???X???`") at
../../../../R-2.1.1/src/main/printutils.c:494
#8  0x0054da70 in Rprintf (format=0xbfff9570 "Error: invalid
connection\n") at ../../../../R-2.1.1/src/main/printutils.c:445
#9  0x0051bcec in nmmin (n=6575856, Bvec=0x5f0dc8, X=0xbffffd58,
Fmin=0xbffffd60, fminfn=0x2b8c <parabola>, fail=0xbffffd68,
abstol=9.9999999999999998e-17, intol=1e-08, ex=0x0, alpha=1, bet=0.5,
gamm=2, trace=4, fncount=0xbffffd9c, maxit=1000) at
../../../../R-2.1.1/src/main/optim.c:667
#10 0x00002ce0 in main () at nmminDemo.c:30

-----

I'm working under Mac OS X 10.3.9 with gcc 3.3 and R
platform powerpc-apple-darwin7.9.0
arch     powerpc
os       darwin7.9.0
system   powerpc, darwin7.9.0
status
major    2
minor    1.1
year     2005
month    06
day      20
language R

Thank you.

David


From ggrothendieck at gmail.com  Fri Apr 14 02:51:54 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Thu, 13 Apr 2006 20:51:54 -0400
Subject: [Rd] [R] S4 method dispatch matrixOrArray (fwd)
In-Reply-To: <443EC0F9.2060206@r-project.org>
References: <Pine.OSF.4.58.0604122227040.305100@wotan.mdacc.tmc.edu>
	<443EC0F9.2060206@r-project.org>
Message-ID: <971536df0604131751y1fcc1cb6xdb44105370b21de4@mail.gmail.com>

I think a rule is needed that would require that a class not succeed any of
its parents on the method list.  That way "array" could never come
after "vector" and, in general, a parent would never be found prior
to any of its descendents.

Of course that still does not address the problem that the order
of the setMethod's rather than the relationships among the classes
can influence the search order but it would eliminate the situation
we saw here.

On 4/13/06, John Chambers <jmc at r-project.org> wrote:
> What a delicious example!  (I'm taking the liberty of sharing it with
> r-devel, since it raises some good issues.)
>
> You have two questions, presumably:
>
> 1 - how could the order of the setMethod calls make a difference in the
> results?
> 2 - what's causing the infinite loop & how could it be avoided, reliably?
>
> Second question first.  The danger sign is the "vector" method:
>
>
> setMethod("foo",
>            signature(A = "vector"),
>            function(A, ...) {
>                foo(matrix(A, nrow = 1), ...)
>            })
>
> This handles a vector by recalling the generic with a matrix.  But "vector"
> is a superclass of "matrix" (see getClass("matrix")) and you DON'T have an
> explicit method defined for "matrix".  So for sure if "vector" was the only
> method, you would be in immediate trouble.  Coercing down the inheritance
> tree is potentially bad news.
>
> Generally, if you're going to take over dispatch by coercing an argument &
> then recalling the generic, the result is simplest if you have an exact
> match for the new call, not relying on inheritance.  After all, if you're
> doing the work to coerce the argument, might as well pick one that works
> right away.   Not a universal rule, but other things being equal ...
>
> There's an additional issue with methods for  "matrix" and "array" because R
> never allows 2-way arrays to have class "array", which means using array()
> here with the same dimensions would not have helped.  Also, matrix and array
> objects are weird in that they are not basic vectors but also have no class
> attribute, and is.object() is FALSE for them.
>
> More interesting though--how can the order of the setMethod() calls matter?
> To see that we need to look at the methods list object.  (The discussion is
> simplified to the case that only one argument is involved, which doesn't
> affect the result.)
>
> The MethodsList object has a slot containing a named list of methods, with
> the names being those of the classes that appeared in the setMethod calls,
> in the order that the calls occurred(note!).  All classes are essentially
> equal from the view of the generic function, so there's no ordering favoring
> the "more relevant".
>
> When method dispatch occurs, the code first looks for an exact match to the
> class of the actual argument--that's a quick search in the names of the
> list.
>
> If the direct search fails, the code now looks for an inherited method.  The
> key point is that this second search is "greedy"--the first inherited method
> found is used.
>
> NOW it should be clear why the order of the setMethod() calls matters.  You
> have two potential inherited methods here for "matrix"; namely, "array" and
> "vector".  WE know that the "array" method is `closer', and the R dispatcher
> could decide this also, if it were willing to look through all possible
> inheritance paths and drop one possibility if a better one was found.
>
> It currently doesn't do any further search, and doing so would be a modest
> efficiency hit.  I'm inclined to think the cost would be worth it to
> eliminate unpleasant suprises like this one, but opinions may differ.  (Once
> found, the inherited method is stored directly in the list used for the
> first lookup,  so the hit is only the first time a particular signature
> turns up.)
>
> To make the difference clearer, I added to your example another generic
> "bar" with the same methods as "foo", but with the order of the setMethod
> calls reversed.
> By looking at the "methods" slot in the two cases, we can see why the bad
> ("vector") method is selected for bar() but not for foo():
>
> > names(getMethods("foo")@methods)
> [1] "array"  "vector"
> > names(getMethods("bar")@methods)
> [1] "vector" "array"
>
> After running foo(1:10) and trying to run bar(1:10):
>
> > showMethods("foo")
>
> Function "foo":
>  A = "array"
>  A = "vector"
>  A = "integer"
>     (inherited from A = "vector")
>  A = "matrix"
>     (inherited from A = "array")
> > showMethods("bar")
>
> Function "bar":
>  A = "vector"
>  A = "array"
>  A = "integer"
>     (inherited from A = "vector")
>  A = "matrix"
>     (inherited from A = "vector")
>
> But including setMethod("bar", "matrix", ...) in the source code makes bar()
> work fine.
>
>
>
> Paul Roebuck wrote:
> Sorry to bother but could you shed some light on this?
I don't understand
> why order of setMethod calls makes
any difference. Since it obviously does,
> it has shaken
the foundations of what I thought I understood about
S4
> methods. Even Gabor was surprised...


---------- Forwarded message
> ----------
Date: Wed, 12 Apr 2006 18:24:46 -0400
From: Gabor Grothendieck
> <ggrothendieck at gmail.com>
> To: Paul Roebuck <roebuck at mdanderson.org> Cc: R Help Mailing List
> <r-help at stat.math.ethz.ch> Subject: Re: [R] S4 method dispatch matrixOrArray
> On 4/12/06, Paul Roebuck <roebuck at mdanderson.org> wrote:
>
>
> On Wed, 12 Apr 2006, Gabor Grothendieck wrote:


> On 4/12/06, Paul Roebuck <roebuck at mdanderson.org> wrote:


> I have some code where the primary dispatching is on
other parameters so I'd
> like not to have to create a
set of functions for "matrix" and another
> duplicate
set for "array". But the class union technique isn't
working as
> implemented below and I don't have my Green
book with me. How do I fix my
> infinite recursion
> problem?


##--------------------------------------------------------
library(methods)

setGeneric("foo",
> function(A, ...) {
 cat("generic", match.call()[[1]], "\n")
> standardGeneric("foo")
 })

setMethod("foo",
 signature(A = "vector"),
> function(A, ...) {
 callGeneric(matrix(A, nrow = 1), ...)
> })

setClassUnion("matrixOrArray", c("matrix", "array"))

setMethod("foo",
> signature(A = "matrixOrArray"),
 function(A, ...) {
 cat("A =", A, "\n")
> })

## Test
foo(1:4)
foo(matrix(1:4, 1, 4))
foo(array(1:4, c(1, 4, 1)))

> I think its good enough to just define an array method, i.e. you
don't need
> the matrix method or the matrixOrArray class, and the
vector method can call
> foo(matrix(A,1), ...) so:

setGeneric("foo",
 function(A, ...) {
> cat("generic", match.call()[[1]], "\n")
 standardGeneric("foo")
> })

setMethod("foo",
 signature(A = "array"),
 function(A, ...) {
 cat("A
> =", A, "\n")
 })

setMethod("foo",
 signature(A = "vector"),
 function(A,
> ...) {
 foo(matrix(A, nrow = 1), ...)
 })

> Something didn't seem right here. That was pretty close
to what I had
> started with, before trying to go the
classUnion route. Matter of fact, the
> vector method can
retain use of callGeneric.

The solution has to do with
> the order in which calls to
setMethod are made. Adding foo-vector after
> foo-array
works fine; the other way around causes infinite recursion.

> This is surprising. I would have thought that the
parent/child relationships
> determine the order that
dispatched methods are invoked, not the order
> that
the setMethod commands are issued in.



>


From ripley at stats.ox.ac.uk  Fri Apr 14 08:19:32 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 14 Apr 2006 07:19:32 +0100 (BST)
Subject: [Rd] Wishlist: 'quietly' argument for .onAttach() / .First.lib()
In-Reply-To: <Pine.OSF.4.58.0604131458490.336486@wotan.mdacc.tmc.edu>
References: <39B6DDB9048D0F4DAD42CB26AAFF0AFAFEDAA5@usctmx1106.merck.com>
	<Pine.OSF.4.58.0604131458490.336486@wotan.mdacc.tmc.edu>
Message-ID: <Pine.LNX.4.64.0604140713340.19757@gannet.stats.ox.ac.uk>

I carefully did not suggest the use of option 'verbose', as that is used 
in many other places.  In particular, with your proposal, you cannot have 
the message without a lot of chatter from library() (and although that has 
a 'verbose' argument, it is often called implicitly, and rarely with 
that argument set).

Similarly for Bill Dunlap's proposal: suppressMessages would squelch all 
messages from the call, not just the one from your package's startup code.
Now, at present there may not be any, but that could well change as 
message() gets more widely used.

On Thu, 13 Apr 2006, Paul Roebuck wrote:

> On Thu, 13 Apr 2006, Liaw, Andy wrote:
>
>> From: Bill Dunlap
>>>
>>> On Thu, 13 Apr 2006, Prof Brian Ripley wrote:
>>>
>>>> On Thu, 13 Apr 2006, Peter Ruckdeschel wrote:
>>>>
>>>>> in "Writing R extensions" as well as in the help
>>>>> to .onAttach(), you mention that one could
>>>>> use this function to issue a start-up message/banner
>>>>> for the package.
>>>>>
>>>>> My little wish for Easter:
>>>>>
>>>>> a 'quietly'-type argument for .onAttach() / .First.lib() which is
>>>>> passed through by functions
>>>>> require() and library() respectively,
>>>>> and by means of which one could optionally
>>>>> suppress this start-up message/banner .
>>>>>
>>>>> Is this hard to do?
>>>>
>>>> I believe so (and think we have been here before).  The documented
>>>> call sequence is
>>>>
>>>>       .onLoad(libname, pkgname)
>>>>       .onAttach(libname, pkgname)
>>>>
>>>> the same as .First.lib.  There is no way to add an argument
>>> here, as
>>>> many existing packages do not support it.  Beyond that, how
>>> would you
>>>> pass the argument in?  Namespaces and packages are often
>>>> loaded/attached implicitly as a result of loading other packages.
>>>>
>>>> I did think you could make use of an option to decide
>>> whether to the
>>>> print the message or not, but I have always assumed that
>>> those who did
>>>> want a banner probably did not want it suppressed.
>>>
>>> If the .onAttach() used message() instead of cat()
>>> to display the banner message then you could use
>>> 	suppressMessages(require("randomForest"))
>>> to squelch the message.
>>
>> Thanks!  This looks like a good alternative.  What do others think of this
>> approach?
>
> I used an alternative approach myself. This allows the user
> enable/disable the banner text quite easily.
>
> .onAttach <- function(libname, pkgname) {
>    if (verbose <- getOption("verbose")) {
>        ...
>        desc <- packageDescription(pkgname)
>        cat(sprintf("%s, version %s", desc$Title, desc$Version), "\n")
>        cat(sprintf("Type library(help=%s) to see package documentation",
>                    libraryPkgName(pkgname)), "\n")
>    }
> }
>
> ----------------------------------------------------------
> SIGSIG -- signature too long (core dumped)
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Fri Apr 14 08:37:57 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 14 Apr 2006 07:37:57 +0100 (BST)
Subject: [Rd] bus error on calling nmmin
In-Reply-To: <6730abff0604131547s1e774aadgf91fa93ea0ee8205@mail.gmail.com>
References: <6730abff0604131547s1e774aadgf91fa93ea0ee8205@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0604140727520.20826@gannet.stats.ox.ac.uk>

You appear to be trying to call nmmin from a standalone program.
You linked against -lR, but failed to initialize R, hence the segfault.

nmmin is not a part of R that is made available except to a running R 
process: it is documented in `Writing R Extensions' for use in R packages.

On Thu, 13 Apr 2006, David Faden wrote:

> Hi,
>
> I'm trying to get a toy program making use of nmmin to run
> successfully. I've gotten to the point of compiling. However, when I
> attempt to run my executable, I guess a bus error. I see that someone
> else has asked about using nmmin before
> <http://tolstoy.newcastle.edu.au/R/help/06/03/23944.html>, but I
> haven't come across any replies.

In both his case and yours, the problem is that what you are trying to do 
is well-documented in Writing R Extensions, and people are reluctant both 
to write manuals out here.

> Is there some documentation on how to call nmmin apart the optim help
> page and the page in the R extensions manual giving the declaration?
> What do I need to change in the below to get it to work? (I also get a
> bus error with trace set to 0.)
>
> The source code and an example session:
>
> nmminDemo.c:
> #include <R_ext/Applic.h>
> #include <stdio.h>
>
> double parabola(int n, double *par, void *ex) {
>  double xm = par[0] - 1;
>  return xm * xm + 13;
> }
>
> int main()
> {
>  double initial[1] = {1.5};
>  double result[1];
>  double value;
>  int convergenceCode;
>  const double abstol = 1e-16;
>  const double reltol = 1e-8;
>  const double alpha = 1.0; /* reflection factor */
>  const double beta = 0.5; /* contraction factor */
>  const double gamm = 2.0; /* expansion factor */
>  const int trace = 4; /* tracing on */
>  int fncount;
>  const int maxit = 10000;
>  nmmin(1, initial, result, &value,
> 	parabola, &convergenceCode,
> 	abstol, reltol,
> 	NULL,
> 	alpha, beta, gamm,
> 	trace, &fncount, maxit);
>  printf("fncount: %d\n", fncount);
>  printf("convergence code: %d\n", convergenceCode);
>  printf("min of %f at x = %f\n", value, result[0]);
>  return 0;
> }
>
> ------
>
> $ gcc nmminDemo.c -g
> -I/Library/Frameworks/R.framework/Versions/2.1.1/Resources/include
> -L/Library/Frameworks/R.framework/Versions/2.1.1/Resources/lib -lR
> $ ./a.out Bus error
> $ gdb a.out
> GNU gdb 5.3-20030128 (Apple version gdb-330.1) (Fri Jul 16 21:42:28 GMT 2004)
> ...
> (gdb) run
> Starting program: /Users/dfaden/Desktop/R/a.out
> Reading symbols for shared libraries +......... done
>
> Program received signal EXC_BAD_ACCESS, Could not access memory.
> 0x00000000 in ?? ()
> (gdb) bt
> #0  0x00000000 in ?? ()
> Cannot access memory at address 0x0
> Cannot access memory at address 0x0
> #1  0x0054dd5c in REvprintf (format=0x5f0dc8 "%s", arg=0xbfffb5fc "")
> at ../../../../R-2.1.1/src/main/printutils.c:541
> #2  0x0054dab0 in REprintf (format=0xbfff9570 "Error: invalid
> connection\n") at ../../../../R-2.1.1/src/main/printutils.c:458
> #3  0x004de8c4 in verrorcall_dflt (call=0x0, format=0x5f0dc8 "%s",
> ap=0xbfffda30 "???P") at ../../../../R-2.1.1/src/main/errors.c:470
> #4  0x004dea1c in Rf_errorcall (call=0x5f0dc8, format=0xbfffb5fc "")
> at ../../../../R-2.1.1/src/main/errors.c:514
> #5  0x004deb38 in Rf_error (format=0xbfff9570 "Error: invalid
> connection\n") at ../../../../R-2.1.1/src/main/errors.c:538
> #6  0x004acc18 in getConnection (n=-1073769104) at
> ../../../../R-2.1.1/src/main/connections.c:95
> #7  0x0054dc04 in Rvprintf (format=0x5fe004 "  Nelder-Mead direct
> search function minimizer\n", arg=0xbffffb7c "???P???X???`") at
> ../../../../R-2.1.1/src/main/printutils.c:494
> #8  0x0054da70 in Rprintf (format=0xbfff9570 "Error: invalid
> connection\n") at ../../../../R-2.1.1/src/main/printutils.c:445
> #9  0x0051bcec in nmmin (n=6575856, Bvec=0x5f0dc8, X=0xbffffd58,
> Fmin=0xbffffd60, fminfn=0x2b8c <parabola>, fail=0xbffffd68,
> abstol=9.9999999999999998e-17, intol=1e-08, ex=0x0, alpha=1, bet=0.5,
> gamm=2, trace=4, fncount=0xbffffd9c, maxit=1000) at
> ../../../../R-2.1.1/src/main/optim.c:667
> #10 0x00002ce0 in main () at nmminDemo.c:30
>
> -----
>
> I'm working under Mac OS X 10.3.9 with gcc 3.3 and R
> platform powerpc-apple-darwin7.9.0
> arch     powerpc
> os       darwin7.9.0
> system   powerpc, darwin7.9.0
> status
> major    2
> minor    1.1
> year     2005
> month    06
> day      20
> language R
>
> Thank you.
>
> David
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Fri Apr 14 09:02:02 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 14 Apr 2006 08:02:02 +0100 (BST)
Subject: [Rd] xmkmf?  problem
In-Reply-To: <443E9F27.30302@bank-banque-canada.ca>
References: <443E7CE0.9020100@bank-banque-canada.ca>
	<Pine.LNX.4.64.0604131801300.28609@gannet.stats.ox.ac.uk>
	<443E9F27.30302@bank-banque-canada.ca>
Message-ID: <Pine.LNX.4.64.0604140741270.20826@gannet.stats.ox.ac.uk>

There are two problems here.  The more important one is with your OS, 
which seems not to have its X11 stuff correct, so cc is not being found
(and you cannot set it).  R's configure has no protection against that.

You can investigate that by

blackduck% touch Imakefile
blackduck% xmkmf
imake -DUseInstalled -I/usr/X11R6/lib/X11/config
blackduck% grep CC Makefile
...

which is what R does.  I presume that this will also fail if you compile R 
out-of-the-box with gcc?  If that works and pgcc does not then something 
else in your settings is amiss.

The second is that if you are using a different compiler from that used to 
make X11, you may need to set CPICFLAGS etc.  But we know about pgcc on 
Linux and so these will be set (but not necessarily SHLIB_LDFLAGS: see the 
R-admin manual).

On Thu, 13 Apr 2006, Paul Gilbert wrote:

>
> Brian
>
> Yes cc is empty. Perhaps I should have mentioned that I have set CC=pgcc, to 
> find the new compiler. Should I be setting cc too? Is there a problem if the 
> compiler used for X11 was different?
>
> Thanks,
> Paul
>
> Prof Brian Ripley wrote:
>> On Thu, 13 Apr 2006, Paul Gilbert wrote:
>> 
>>> I am having the  xmkmf  problem below with todays beta, but I also am
>>> trying to use an new (PGI 6.1),  so lots of other things in my setup may
>>> be wrong, and the warning may also be important. Any hints would be
>>> appreciated.
>> 
>> My guess is that this is from
>>
>>   cc=`${srcdir}/tools/GETMAKEVAL CC`
>>   cc=`echo ${cc} | sed "s/ .*//"`
>>   if test "`which ${cc}`" = "`which ${CC}`"; then
>>     shlib_ldflags=`${srcdir}/tools/GETMAKEVAL SHLIBLDFLAGS`
>>     cpicflags=`${srcdir}/tools/GETMAKEVAL PICFLAGS`
>>   fi
>>   cxx=`${srcdir}/tools/GETMAKEVAL CXX`
>>   cxx=`echo ${cxx} | sed "s/ .*//"`
>>   if test "`which ${cxx}`" = "`which ${CXX}`"; then
>>     cxxpicflags=`${srcdir}/tools/GETMAKEVAL CXXPICFLAGS`
>>   fi
>> 
>> in configure and so either your compilers are not set correctly or your 
>> OS's X11 does not find the compilers used to compile it.
>> 
>> I'd start by inserting debugging code in configure at that point to find 
>> out what ${cc} and ${CC} are, with the expectation that one is empty.
>> 
>>> 
>>> Paul
>>> _____
>>> 
>>> Red Hat Enterprise Linux AS release 3 (Taroon Update 7)
>>> ....
>>> checking whether C runtime needs -D__NO_MATH_INLINES... no
>>> checking for xmkmf... /usr/X11R6/bin/xmkmf
>>> Usage: which [options] [--] programname [...]
>>> Options: --version, -[vV] Print version and exit successfully.
>>>         --help,          Print this help and exit successfully.
>>>         --skip-dot       Skip directories in PATH that start with a dot.
>>>         --skip-tilde     Skip directories in PATH that start with a tilde.
>>>         --show-dot       Don't expand a dot to current directory in 
>>> output.
>>>         --show-tilde     Output a tilde for HOME directory for non-root.
>>>         --tty-only       Stop processing options on the right if not on
>>> tty.
>>>         --all, -a        Print all matches in PATH, not just the first
>>>         --read-alias, -i Read list of aliases from stdin.
>>>         --skip-alias     Ignore option --read-alias; don't read stdin.
>>>         --read-functions Read shell functions from stdin.
>>>         --skip-functions Ignore option --read-functions; don't read stdin.
>>> Usage: which [options] [--] programname [...]
>>> Options: --version, -[vV] Print version and exit successfully.
>>>         --help,          Print this help and exit successfully.
>>>         --skip-dot       Skip directories in PATH that start with a dot.
>>>         --skip-tilde     Skip directories in PATH that start with a tilde.
>>>         --show-dot       Don't expand a dot to current directory in 
>>> output.
>>>         --show-tilde     Output a tilde for HOME directory for non-root.
>>>         --tty-only       Stop processing options on the right if not on
>>> tty.
>>>         --all, -a        Print all matches in PATH, not just the first
>>>         --read-alias, -i Read list of aliases from stdin.
>>>         --skip-alias     Ignore option --read-alias; don't read stdin.
>>>         --read-functions Read shell functions from stdin.
>>>         --skip-functions Ignore option --read-functions; don't read stdin.
>>> configure: WARNING: I could not determine SHLIB_LDFLAGS.
>>> configure: error: See the file doc/html/R-admin.html for more information.
>>> ~/toolchain/R/mfa04559/R-beta:
>>> ==================================================================================== 
>>> 
>>> La version fran?aise suit le texte anglais.
>>>
>>> 
>>> ------------------------------------------------------------------------------------ 
>>> 
>>> This email may contain privileged and/or confidential inform...{{dropped}}
>>> 
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>> 
>>> 
>> 
> ====================================================================================
>
> La version fran?aise suit le texte anglais.
>
> ------------------------------------------------------------------------------------
>
> This email may contain privileged and/or confidential information, and the 
> Bank of
> Canada does not waive any related rights. Any distribution, use, or copying 
> of this
> email or the information it contains by other than the intended recipient is
> unauthorized. If you received this email in error please delete it 
> immediately from
> your system and notify the sender promptly by email that you have done so. 
> ------------------------------------------------------------------------------------
>
> Le pr?sent courriel peut contenir de l'information privil?gi?e ou 
> confidentielle.
> La Banque du Canada ne renonce pas aux droits qui s'y rapportent. Toute 
> diffusion,
> utilisation ou copie de ce courriel ou des renseignements qu'il contient par 
> une
> personne autre que le ou les destinataires d?sign?s est interdite. Si vous 
> recevez
> ce courriel par erreur, veuillez le supprimer imm?diatement et envoyer sans 
> d?lai ?
> l'exp?diteur un message ?lectronique pour l'aviser que vous avez ?limin? de 
> votre
> ordinateur toute copie du courriel re?u.
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From ripley at stats.ox.ac.uk  Fri Apr 14 11:14:14 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 14 Apr 2006 10:14:14 +0100 (BST)
Subject: [Rd] xmkmf?  problem
In-Reply-To: <Pine.LNX.4.64.0604140741270.20826@gannet.stats.ox.ac.uk>
References: <443E7CE0.9020100@bank-banque-canada.ca>
	<Pine.LNX.4.64.0604131801300.28609@gannet.stats.ox.ac.uk>
	<443E9F27.30302@bank-banque-canada.ca>
	<Pine.LNX.4.64.0604140741270.20826@gannet.stats.ox.ac.uk>
Message-ID: <Pine.LNX.4.64.0604141013390.21034@gannet.stats.ox.ac.uk>

I've added some protection to configure, so you might like to try again 
with tomorrow's beta or later.

On Fri, 14 Apr 2006, Prof Brian Ripley wrote:

> There are two problems here.  The more important one is with your OS, which 
> seems not to have its X11 stuff correct, so cc is not being found
> (and you cannot set it).  R's configure has no protection against that.
>
> You can investigate that by
>
> blackduck% touch Imakefile
> blackduck% xmkmf
> imake -DUseInstalled -I/usr/X11R6/lib/X11/config
> blackduck% grep CC Makefile
> ...
>
> which is what R does.  I presume that this will also fail if you compile R 
> out-of-the-box with gcc?  If that works and pgcc does not then something else 
> in your settings is amiss.
>
> The second is that if you are using a different compiler from that used to 
> make X11, you may need to set CPICFLAGS etc.  But we know about pgcc on Linux 
> and so these will be set (but not necessarily SHLIB_LDFLAGS: see the R-admin 
> manual).
>
> On Thu, 13 Apr 2006, Paul Gilbert wrote:
>
>> 
>> Brian
>> 
>> Yes cc is empty. Perhaps I should have mentioned that I have set CC=pgcc, 
>> to find the new compiler. Should I be setting cc too? Is there a problem if 
>> the compiler used for X11 was different?
>> 
>> Thanks,
>> Paul
>> 
>> Prof Brian Ripley wrote:
>>> On Thu, 13 Apr 2006, Paul Gilbert wrote:
>>> 
>>>> I am having the  xmkmf  problem below with todays beta, but I also am
>>>> trying to use an new (PGI 6.1),  so lots of other things in my setup may
>>>> be wrong, and the warning may also be important. Any hints would be
>>>> appreciated.
>>> 
>>> My guess is that this is from
>>>
>>>   cc=`${srcdir}/tools/GETMAKEVAL CC`
>>>   cc=`echo ${cc} | sed "s/ .*//"`
>>>   if test "`which ${cc}`" = "`which ${CC}`"; then
>>>     shlib_ldflags=`${srcdir}/tools/GETMAKEVAL SHLIBLDFLAGS`
>>>     cpicflags=`${srcdir}/tools/GETMAKEVAL PICFLAGS`
>>>   fi
>>>   cxx=`${srcdir}/tools/GETMAKEVAL CXX`
>>>   cxx=`echo ${cxx} | sed "s/ .*//"`
>>>   if test "`which ${cxx}`" = "`which ${CXX}`"; then
>>>     cxxpicflags=`${srcdir}/tools/GETMAKEVAL CXXPICFLAGS`
>>>   fi
>>> 
>>> in configure and so either your compilers are not set correctly or your 
>>> OS's X11 does not find the compilers used to compile it.
>>> 
>>> I'd start by inserting debugging code in configure at that point to find 
>>> out what ${cc} and ${CC} are, with the expectation that one is empty.
>>> 
>>>> 
>>>> Paul
>>>> _____
>>>> 
>>>> Red Hat Enterprise Linux AS release 3 (Taroon Update 7)
>>>> ....
>>>> checking whether C runtime needs -D__NO_MATH_INLINES... no
>>>> checking for xmkmf... /usr/X11R6/bin/xmkmf
>>>> Usage: which [options] [--] programname [...]
>>>> Options: --version, -[vV] Print version and exit successfully.
>>>>         --help,          Print this help and exit successfully.
>>>>         --skip-dot       Skip directories in PATH that start with a dot.
>>>>         --skip-tilde     Skip directories in PATH that start with a 
>>>> tilde.
>>>>         --show-dot       Don't expand a dot to current directory in 
>>>> output.
>>>>         --show-tilde     Output a tilde for HOME directory for non-root.
>>>>         --tty-only       Stop processing options on the right if not on
>>>> tty.
>>>>         --all, -a        Print all matches in PATH, not just the first
>>>>         --read-alias, -i Read list of aliases from stdin.
>>>>         --skip-alias     Ignore option --read-alias; don't read stdin.
>>>>         --read-functions Read shell functions from stdin.
>>>>         --skip-functions Ignore option --read-functions; don't read 
>>>> stdin.
>>>> Usage: which [options] [--] programname [...]
>>>> Options: --version, -[vV] Print version and exit successfully.
>>>>         --help,          Print this help and exit successfully.
>>>>         --skip-dot       Skip directories in PATH that start with a dot.
>>>>         --skip-tilde     Skip directories in PATH that start with a 
>>>> tilde.
>>>>         --show-dot       Don't expand a dot to current directory in 
>>>> output.
>>>>         --show-tilde     Output a tilde for HOME directory for non-root.
>>>>         --tty-only       Stop processing options on the right if not on
>>>> tty.
>>>>         --all, -a        Print all matches in PATH, not just the first
>>>>         --read-alias, -i Read list of aliases from stdin.
>>>>         --skip-alias     Ignore option --read-alias; don't read stdin.
>>>>         --read-functions Read shell functions from stdin.
>>>>         --skip-functions Ignore option --read-functions; don't read 
>>>> stdin.
>>>> configure: WARNING: I could not determine SHLIB_LDFLAGS.
>>>> configure: error: See the file doc/html/R-admin.html for more 
>>>> information.
>>>> ~/toolchain/R/mfa04559/R-beta:
>>>> ==================================================================================== 
>>>> La version fran?aise suit le texte anglais.
>>>> 
>>>>
>>>> 
>>>> ------------------------------------------------------------------------------------ 
>>>> This email may contain privileged and/or confidential 
>>>> inform...{{dropped}}
>>>> 
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>> 
>>>> 
>>> 
>> ====================================================================================
>> 
>> La version fran?aise suit le texte anglais.
>>
>> 
>> ------------------------------------------------------------------------------------
>> 
>> This email may contain privileged and/or confidential information, and the 
>> Bank of
>> Canada does not waive any related rights. Any distribution, use, or copying 
>> of this
>> email or the information it contains by other than the intended recipient 
>> is
>> unauthorized. If you received this email in error please delete it 
>> immediately from
>> your system and notify the sender promptly by email that you have done so. 
>> ------------------------------------------------------------------------------------
>> 
>> Le pr?sent courriel peut contenir de l'information privil?gi?e ou 
>> confidentielle.
>> La Banque du Canada ne renonce pas aux droits qui s'y rapportent. Toute 
>> diffusion,
>> utilisation ou copie de ce courriel ou des renseignements qu'il contient 
>> par une
>> personne autre que le ou les destinataires d?sign?s est interdite. Si vous 
>> recevez
>> ce courriel par erreur, veuillez le supprimer imm?diatement et envoyer sans 
>> d?lai ?
>> l'exp?diteur un message ?lectronique pour l'aviser que vous avez ?limin? de 
>> votre
>> ordinateur toute copie du courriel re?u.
>> 
>> 
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From bocharov_m at inbox.ru  Fri Apr 14 13:26:30 2006
From: bocharov_m at inbox.ru (bocharov_m at inbox.ru)
Date: Fri, 14 Apr 2006 13:26:30 +0200 (CEST)
Subject: [Rd] UTF8 letters are imaged incorrectly (PR#8770)
Message-ID: <20060414112630.F16F91953A@slim.kubism.ku.dk>

Full_Name: Mikhail Bocharov
Version: 2.2.1
OS: Linux
Submission from: (NULL) (62.148.130.28)


Cyrillic UTF8 letters are imaged incorrectly

Sorry, but English is not my native language

My operating system is Gentoo-linux. Now i want get the gparhics with russian
title
for example: plot(1:20, type='l',
main='&#1059;&#1090;&#1077;&#1095;&#1082;&#1072;')
instead of russian letters in title i have this - '5'd'V'i'\'Q , but must be
'&#1091;&#1090;&#1077;&#1095;&#1082;&#1072;'


my locale:

$locale
LANG=ru_RU.UTF-8
LC_CTYPE="ru_RU.UTF-8"
LC_NUMERIC="ru_RU.UTF-8"
LC_TIME="ru_RU.UTF-8"
LC_COLLATE="ru_RU.UTF-8"
LC_MONETARY="ru_RU.UTF-8"
LC_MESSAGES="ru_RU.UTF-8"
LC_PAPER="ru_RU.UTF-8"
LC_NAME="ru_RU.UTF-8"
LC_ADDRESS="ru_RU.UTF-8"
LC_TELEPHONE="ru_RU.UTF-8"
LC_MEASUREMENT="ru_RU.UTF-8"
LC_IDENTIFICATION="ru_RU.UTF-8"
LC_ALL=

PS '&#1091;&#1090;&#1077;&#1095;&#1082;&#1072;' in english 'leak&#1072;ge'


From ripley at stats.ox.ac.uk  Fri Apr 14 14:13:57 2006
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Fri, 14 Apr 2006 14:13:57 +0200 (CEST)
Subject: [Rd] UTF8 letters are imaged incorrectly (PR#8770)
Message-ID: <20060414121357.8C05919960@slim.kubism.ku.dk>

I am sorry, but why do you think this is a bug in R, when it is your X11 
display (I presume, you did not say this was the x11() device) that is not 
rendering the characters correctly?

We have seen this with UTF-8 locales such as Japanese, and it was an OS 
services problem, in that exactly the same code works correctly on some 
versions of the OS and not others. (Earlier this week I ran the compiled 
code for R 2.1.1 which I know worked correctly on FC3 on a fully updated 
machine, and it no longer renders Japanese chars correctly in UTF-8.  The 
R code is unchanged since it was first compiled, but the xorg RPMs have 
changed and hence the code it links to.)

We have traced the X11 calls, and they are being called with the correct 
UTF-8 character string.  Some UTF-8 locales work and some do not, and R 
does not know any difference between UTF-8 locales.

There's a comment at the top of src/modules/X11/rotated.c that you might 
like to uncomment and see if it helps.  That uses UTF-8-specific X11 calls 
that when this was written (for R 2.1.0) did not work correctly in the 
then XFree distribution.

There is nothing we can do to help unless you or someone else in a Russian 
UTF-8 locale can tell us a solution.  It's currently a mystery, but as no 
else has reported it, it seems that for most people in UTF-8 locales it 
does work.

We are well into the beta-test period for R 2.3.0, so please test that to 
see if the problem persists.  (I suspect it will, but no more work will be 
done on R 2.2.x.)


On Fri, 14 Apr 2006, bocharov_m at inbox.ru wrote:

> Full_Name: Mikhail Bocharov
> Version: 2.2.1
> OS: Linux
> Submission from: (NULL) (62.148.130.28)
>
>
> Cyrillic UTF8 letters are imaged incorrectly
>
> Sorry, but English is not my native language
>
> My operating system is Gentoo-linux. Now i want get the gparhics with russian
> title
> for example: plot(1:20, type='l',
> main='&#1059;&#1090;&#1077;&#1095;&#1082;&#1072;')
> instead of russian letters in title i have this - '5'd'V'i'\'Q , but must be
> '&#1091;&#1090;&#1077;&#1095;&#1082;&#1072;'
>
>
> my locale:
>
> $locale
> LANG=ru_RU.UTF-8
> LC_CTYPE="ru_RU.UTF-8"
> LC_NUMERIC="ru_RU.UTF-8"
> LC_TIME="ru_RU.UTF-8"
> LC_COLLATE="ru_RU.UTF-8"
> LC_MONETARY="ru_RU.UTF-8"
> LC_MESSAGES="ru_RU.UTF-8"
> LC_PAPER="ru_RU.UTF-8"
> LC_NAME="ru_RU.UTF-8"
> LC_ADDRESS="ru_RU.UTF-8"
> LC_TELEPHONE="ru_RU.UTF-8"
> LC_MEASUREMENT="ru_RU.UTF-8"
> LC_IDENTIFICATION="ru_RU.UTF-8"
> LC_ALL=
>
> PS '&#1091;&#1090;&#1077;&#1095;&#1082;&#1072;' in english 'leak&#1072;ge'
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From jmc at r-project.org  Fri Apr 14 15:51:48 2006
From: jmc at r-project.org (John Chambers)
Date: Fri, 14 Apr 2006 09:51:48 -0400
Subject: [Rd] [R] S4 method dispatch matrixOrArray (fwd)
In-Reply-To: <971536df0604131751y1fcc1cb6xdb44105370b21de4@mail.gmail.com>
References: <Pine.OSF.4.58.0604122227040.305100@wotan.mdacc.tmc.edu>
	<443EC0F9.2060206@r-project.org>
	<971536df0604131751y1fcc1cb6xdb44105370b21de4@mail.gmail.com>
Message-ID: <443FA8F4.50909@r-project.org>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20060414/0b404907/attachment.pl 

From nakama at ki.rim.or.jp  Fri Apr 14 15:58:20 2006
From: nakama at ki.rim.or.jp (Ei-ji Nakama)
Date: Fri, 14 Apr 2006 22:58:20 +0900
Subject: [Rd] UTF8 letters are imaged incorrectly (PR#8770)
In-Reply-To: <20060414112630.F16F91953A@slim.kubism.ku.dk>
References: <20060414112630.F16F91953A@slim.kubism.ku.dk>
Message-ID: <dc41e1260604140658s23163cb5p347eda75325285ad@mail.gmail.com>

try.
 $ xlsfonts -fn '*-koi8-r'
or
 $ xlsfonts -fn '*-iso8859-5'
Is there a font of iso8859-5 and koi8?
Please install it in search of a font if nothing comes out.

Next should use xfontsel to choose an appropriate font.

 $ xfontsel  -pattern "-*-*-*-*-*--24-*-*-*-*-*-iso8859-5"

1.Let's choose fmly from a bar
2.If the family is beautiful, does wgth include medium and boldface?
3.And please choose fndry.

UTF-8 environment of X11 is another name of most case en_US.UTF-8.
In UTF8 environment of X11, as for the appointment of rgstry-encdng, a
font of iso10646 will be given priority to at reference value degree.
# look in XLC_LOCALE

Please try to the following if you can choose a font.

> options(X11fonts=c("-cronyx-helvetica-%s-%s-*--%d-*-*-*-*-*-*-*",
+                              "-adobe-symbol-medium-r-*-*-%d-*-*-*-*-*-*-*"))
> plot(1:20,main="russian string.")

Kiril font is not included in adobe of a default.
xlsfonts -lll -fn -adobe-helvetica-bold-o-normal--10-100-75-75-p-60-iso10646-1
However, there is not glif of the letter.

2006/4/14, bocharov_m at inbox.ru <bocharov_m at inbox.ru>:
> Full_Name: Mikhail Bocharov
> Version: 2.2.1
> OS: Linux
> Submission from: (NULL) (62.148.130.28)
>
>
> Cyrillic UTF8 letters are imaged incorrectly
>
> Sorry, but English is not my native language
>
> My operating system is Gentoo-linux. Now i want get the gparhics with russian
> title
> for example: plot(1:20, type='l',
> main='&#1059;&#1090;&#1077;&#1095;&#1082;&#1072;')
> instead of russian letters in title i have this - '5'd'V'i'\'Q , but must be
> '&#1091;&#1090;&#1077;&#1095;&#1082;&#1072;'
>
>
> my locale:
>
> $locale
> LANG=ru_RU.UTF-8
> LC_CTYPE="ru_RU.UTF-8"
> LC_NUMERIC="ru_RU.UTF-8"
> LC_TIME="ru_RU.UTF-8"
> LC_COLLATE="ru_RU.UTF-8"
> LC_MONETARY="ru_RU.UTF-8"
> LC_MESSAGES="ru_RU.UTF-8"
> LC_PAPER="ru_RU.UTF-8"
> LC_NAME="ru_RU.UTF-8"
> LC_ADDRESS="ru_RU.UTF-8"
> LC_TELEPHONE="ru_RU.UTF-8"
> LC_MEASUREMENT="ru_RU.UTF-8"
> LC_IDENTIFICATION="ru_RU.UTF-8"
> LC_ALL=
>
> PS '&#1091;&#1090;&#1077;&#1095;&#1082;&#1072;' in english 'leak&#1072;ge'
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


--
EI-JI Nakama  <nakama at ki.rim.or.jp>
"\u4e2d\u9593\u6804\u6cbb"  <nakama at ki.rim.or.jp>


From ggrothendieck at gmail.com  Fri Apr 14 16:02:59 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Fri, 14 Apr 2006 10:02:59 -0400
Subject: [Rd] [R] S4 method dispatch matrixOrArray (fwd)
In-Reply-To: <443FA8F4.50909@r-project.org>
References: <Pine.OSF.4.58.0604122227040.305100@wotan.mdacc.tmc.edu>
	<443EC0F9.2060206@r-project.org>
	<971536df0604131751y1fcc1cb6xdb44105370b21de4@mail.gmail.com>
	<443FA8F4.50909@r-project.org>
Message-ID: <971536df0604140702u2fc1ed4n9c249062f59cc6aa@mail.gmail.com>

Right. That does not solve the whole problem (as I pointed out) but
was just a suggestion intended to be reasonably
consistent with how it works now.  The best would be if the search
order were a function only of the relationships among the classes
and not dependent on the setMethod order.

On 4/14/06, John Chambers <jmc at r-project.org> wrote:
> Gabor Grothendieck wrote:
> I think a rule is needed that would require that a class not succeed any
> of
its parents on the method list. That way "array" could never come
after
> "vector" and, in general, a parent would never be found prior
to any of its
> descendents.

>
> A good idea & it would help, we can certainly do something like this
> (probably for 2.4, not 2.3).  But so long as the inheritance search is
> greedy, a "wrong" method can still be chosen.
>
> Suppose, say, class A contains B and C, and C contains D.  Function foo has
> methods for B and D.  We would agree, I think, that foo(a) where a is from
> class A should get the B method (parent) rather than the D method
> (grandparent).  But classess B and D are unrelated so there's no obvious
> ordering.
>
> My preference would be for a full search.  The ordering you suggest would at
> least help avoid some branches of the search.  If we can manage at some
> point to re-implement important parts of the methods package,  in C and more
> built-in, that should save much more computing time than the full search
> would add.
>
> Of course that still does not address the problem that the order
of the
> setMethod's rather than the relationships among the classes
can influence
> the search order but it would eliminate the situation
we saw here.

On
> 4/13/06, John Chambers <jmc at r-project.org> wrote:

> What a delicious example! (I'm taking the liberty of sharing it
> with
r-devel, since it raises some good issues.)

You have two questions,
> presumably:

1 - how could the order of the setMethod calls make a
> difference in the
results?
2 - what's causing the infinite loop & how could
> it be avoided, reliably?

Second question first. The danger sign is the
> "vector" method:


setMethod("foo",
 signature(A = "vector"),
 function(A,
> ...) {
 foo(matrix(A, nrow = 1), ...)
 })

This handles a vector by
> recalling the generic with a matrix. But "vector"
is a superclass of
> "matrix" (see getClass("matrix")) and you DON'T have an
explicit method
> defined for "matrix". So for sure if "vector" was the only
method, you would
> be in immediate trouble. Coercing down the inheritance
tree is potentially
> bad news.

Generally, if you're going to take over dispatch by coercing an
> argument &
then recalling the generic, the result is simplest if you have an
> exact
match for the new call, not relying on inheritance. After all, if
> you're
doing the work to coerce the argument, might as well pick one that
> works
right away. Not a universal rule, but other things being equal
> ...

There's an additional issue with methods for "matrix" and "array"
> because R
never allows 2-way arrays to have class "array", which means using
> array()
here with the same dimensions would not have helped. Also, matrix
> and array
objects are weird in that they are not basic vectors but also have
> no class
attribute, and is.object() is FALSE for them.

More interesting
> though--how can the order of the setMethod() calls matter?
To see that we
> need to look at the methods list object. (The discussion is
simplified to
> the case that only one argument is involved, which doesn't
affect the
> result.)

The MethodsList object has a slot containing a named list of
> methods, with
the names being those of the classes that appeared in the
> setMethod calls,
in the order that the calls occurred(note!). All classes
> are essentially
equal from the view of the generic function, so there's no
> ordering favoring
the "more relevant".

When method dispatch occurs, the
> code first looks for an exact match to the
class of the actual
> argument--that's a quick search in the names of the
list.

If the direct
> search fails, the code now looks for an inherited method. The
key point is
> that this second search is "greedy"--the first inherited method
found is
> used.

NOW it should be clear why the order of the setMethod() calls
> matters. You
have two potential inherited methods here for "matrix"; namely,
> "array" and
"vector". WE know that the "array" method is `closer', and the R
> dispatcher
could decide this also, if it were willing to look through all
> possible
inheritance paths and drop one possibility if a better one was
> found.

It currently doesn't do any further search, and doing so would be a
> modest
efficiency hit. I'm inclined to think the cost would be worth it
> to
eliminate unpleasant suprises like this one, but opinions may differ.
> (Once
found, the inherited method is stored directly in the list used for
> the
first lookup, so the hit is only the first time a particular
> signature
turns up.)

To make the difference clearer, I added to your
> example another generic
"bar" with the same methods as "foo", but with the
> order of the setMethod
calls reversed.
By looking at the "methods" slot in
> the two cases, we can see why the bad
("vector") method is selected for
> bar() but not for foo():


> names(getMethods("foo")@methods)

> [1] "array" "vector"

> names(getMethods("bar")@methods)

> [1] "vector" "array"

After running foo(1:10) and trying to run bar(1:10):

> showMethods("foo")

> Function "foo":
 A = "array"
 A = "vector"
 A = "integer"
 (inherited from A
> = "vector")
 A = "matrix"
 (inherited from A = "array")

> showMethods("bar")

> Function "bar":
 A = "vector"
 A = "array"
 A = "integer"
 (inherited from A
> = "vector")
 A = "matrix"
 (inherited from A = "vector")

But including
> setMethod("bar", "matrix", ...) in the source code makes bar()
work
> fine.



Paul Roebuck wrote:
Sorry to bother but could you shed some light
> on this?

> I don't understand

> why order of setMethod calls makes

> any difference. Since it obviously does,

> it has shaken

> the foundations of what I thought I understood about
S4

> methods. Even Gabor was surprised...

>
---------- Forwarded message

> ----------

> Date: Wed, 12 Apr 2006 18:24:46 -0400
From: Gabor Grothendieck

> <ggrothendieck at gmail.com>
To: Paul Roebuck <roebuck at mdanderson.org> Cc: R
> Help Mailing List
<r-help at stat.math.ethz.ch> Subject: Re: [R] S4 method
> dispatch matrixOrArray
On 4/12/06, Paul Roebuck <roebuck at mdanderson.org>
> wrote:


On Wed, 12 Apr 2006, Gabor Grothendieck wrote:

>

> On 4/12/06, Paul Roebuck <roebuck at mdanderson.org> wrote:

>

> I have some code where the primary dispatching is on

> other parameters so I'd

> like not to have to create a

> set of functions for "matrix" and another

> duplicate

> set for "array". But the class union technique isn't
working as

> implemented below and I don't have my Green

> book with me. How do I fix my

> infinite recursion
problem?

>
##--------------------------------------------------------
library(methods)

setGeneric("foo",
> function(A, ...) {

>  cat("generic", match.call()[[1]], "\n")

> standardGeneric("foo")

>  })

setMethod("foo",
 signature(A = "vector"),

> function(A, ...) {

>  callGeneric(matrix(A, nrow = 1), ...)

> })

> setClassUnion("matrixOrArray", c("matrix", "array"))

setMethod("foo",

> signature(A = "matrixOrArray"),

>  function(A, ...) {
 cat("A =", A, "\n")

> })

> ## Test
foo(1:4)
foo(matrix(1:4, 1, 4))
foo(array(1:4, c(1, 4, 1)))


> I think its good enough to just define an array method, i.e. you

> don't need

> the matrix method or the matrixOrArray class, and the

> vector method can call

> foo(matrix(A,1), ...) so:

> setGeneric("foo",
 function(A, ...) {

> cat("generic", match.call()[[1]], "\n")

>  standardGeneric("foo")

> })

> setMethod("foo",
 signature(A = "array"),
 function(A, ...) {
 cat("A

> =", A, "\n")

>  })

setMethod("foo",
 signature(A = "vector"),
 function(A,

> ...) {

>  foo(matrix(A, nrow = 1), ...)
 })


> Something didn't seem right here. That was pretty close

> to what I had

> started with, before trying to go the

> classUnion route. Matter of fact, the

> vector method can

> retain use of callGeneric.

The solution has to do with

> the order in which calls to

> setMethod are made. Adding foo-vector after

> foo-array

> works fine; the other way around causes infinite recursion.


> This is surprising. I would have thought that the

> parent/child relationships

> determine the order that

> dispatched methods are invoked, not the order

> that

> the setMethod commands are issued in.




> ______________________________________________
R-devel at r-project.org
> mailing
> list
https://stat.ethz.ch/mailman/listinfo/r-devel


>


From ripley at stats.ox.ac.uk  Fri Apr 14 17:57:57 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 14 Apr 2006 16:57:57 +0100 (BST)
Subject: [Rd] make check of R-alpha_2006-04-08_r37675 fails: qbeta
In-Reply-To: <17466.22147.982663.926905@basebud.nulle.part>
References: <m0wtdyanzp.fsf@bar.nemo-project.org>
	<x2y7yevjsp.fsf@turmalin.kubism.ku.dk>
	<Pine.LNX.4.64.0604092050370.13534@gannet.stats.ox.ac.uk>
	<x23bgmmohi.fsf@turmalin.kubism.ku.dk>
	<m0irphak6k.fsf@bar.nemo-project.org>
	<Pine.LNX.4.64.0604100958350.2901@gannet.stats.ox.ac.uk>
	<17466.15936.420928.889119@basebud.nulle.part>
	<m0ek05a9yn.fsf@bar.nemo-project.org>
	<17466.22147.982663.926905@basebud.nulle.part>
Message-ID: <Pine.LNX.4.64.0604141654581.24174@gannet.stats.ox.ac.uk>

Uwe Ligges had the same problem with gcc 3.3.1 on SuSE 9.0.  So I 
installed gcc 3.3.5 from the sources on an i386 box, and was able to 
reproduce it.

It is an optimization bug.  The crucial code is

 	xtrunc = tx;	/* this prevents trouble with excess FPU */
 				/* precision on some machines. */
 	if (xtrunc == xinbta)
 	    goto L_converged;

and both xtrunc and xinbta are volatile.  Seems that is being ignored in 
3.3.5/1, and so the loop never terminates.

Using an explicit check is safer and faster. I'll put mine in once I have 
finished testing.


On Mon, 10 Apr 2006, Dirk Eddelbuettel wrote:

>
> On 10 April 2006 at 14:31, Bj?rn-Helge Mevik wrote:
> | Dirk Eddelbuettel wrote:
> |
> | > Fair point, especially as you have to insist on using gcc 3.3.* on Debian:
> | > -- 3.3.6 is the current 3.3.* one whereas Bj?rn-Helge used 3.3.5
> | > -- 3.4.5 is the latest 3.* one supplanting 3.3.(5,6)
> | > -- 4.0.3 is the current default
> | > -- 4.1.0 is available too
>
> [...]
> | Hmmm... I don't `see' all those versions.  After an `aptitude update':
>
> (That didn't show version numbers...)
>
> | My /etc/apt/sources.list is:
> |
> | deb http://ftp.no.debian.org/debian/ sarge main non-free contrib
> | deb-src http://ftp.no.debian.org/debian/ sarge main non-free contrib
> | deb http://ftp.no.debian.org/debian-non-US sarge/non-US main contrib non-free
> | deb-src http://ftp.no.debian.org/debian-non-US sarge/non-US main contrib non-free
> | deb http://security.debian.org/ sarge/updates main contrib non-free
> |
> | Why am I seeing older versions than you?
>
> Because you point to 'sarge' which was frozen and released a year ago.
> If you want something newer than Debian stable, you have to point to it.
>
> This is all off-topic here. Please consider (subscribing and) posting to
> r-sig-debian for R/Debian related matters, or debian-help for generic Debian
> questions.
>
> Hope this helps, Dirk
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From nakama at ki.rim.or.jp  Fri Apr 14 18:32:30 2006
From: nakama at ki.rim.or.jp (Ei-ji Nakama)
Date: Sat, 15 Apr 2006 01:32:30 +0900
Subject: [Rd] UTF8 letters are imaged incorrectly (PR#8770)
In-Reply-To: <200604142000.53660.bocharov_m@inbox.ru>
References: <20060414112630.F16F91953A@slim.kubism.ku.dk>
	<dc41e1260604140727k74c4cc83m2797b71f11e7bd3c@mail.gmail.com>
	<200604142000.53660.bocharov_m@inbox.ru>
Message-ID: <dc41e1260604140932o513c1a26g6c2f84bc5733b6ec@mail.gmail.com>

 If an error is not given by a locale command, I think that local
setting of glibc does not have any problem.
 I think that there is not problem if  add encoding of koi8-r to
XLC_LOCALE file.

I am not readable, but probably the following URL is useful.
http://ru.gentoo-wiki.com/HOWTO_ru_RU.utf8_Gentoo_way

2006/4/15, Mike Bocharov <bocharov_m at inbox.ru>:
> Thank you for you answer, but your example not work for me...
> > Please try to the following if you can choose a font.
> > > options(X11fonts=c("-cronyx-helvetica-%s-%s-*--%d-*-*-*-*-*-*-*",
> > +
> > "-adobe-symbol-medium-r-*-*-%d-*-*-*-*-*-*-*"))
> > > plot(1:20,main="russian string.")
>
> I not specialist in locales and fonts, maybe reason in my locale?
> In my linux locale is UTF-8:
> LANG=ru_RU.UTF-8
> LC_CTYPE="ru_RU.UTF-8"
> LC_NUMERIC="ru_RU.UTF-8"
> LC_TIME="ru_RU.UTF-8"
> LC_COLLATE="ru_RU.UTF-8"
> LC_MONETARY="ru_RU.UTF-8"
> LC_MESSAGES="ru_RU.UTF-8"
> LC_PAPER="ru_RU.UTF-8"
> LC_NAME="ru_RU.UTF-8"
> LC_ADDRESS="ru_RU.UTF-8"
> LC_TELEPHONE="ru_RU.UTF-8"
> LC_MEASUREMENT="ru_RU.UTF-8"
> LC_IDENTIFICATION="ru_RU.UTF-8"
> LC_ALL=
>
> ,but  fonts in xfontsel is koi8-r(in rgstry)
>


--
EI-JI Nakama  <nakama at ki.rim.or.jp>
"\u4e2d\u9593\u6804\u6cbb"  <nakama at ki.rim.or.jp>


From dfaden at gmail.com  Fri Apr 14 19:30:49 2006
From: dfaden at gmail.com (David Faden)
Date: Fri, 14 Apr 2006 12:30:49 -0500
Subject: [Rd] bus error on calling nmmin
In-Reply-To: <Pine.LNX.4.64.0604140727520.20826@gannet.stats.ox.ac.uk>
References: <6730abff0604131547s1e774aadgf91fa93ea0ee8205@mail.gmail.com>
	<Pine.LNX.4.64.0604140727520.20826@gannet.stats.ox.ac.uk>
Message-ID: <6730abff0604141030k70aba079j3e9b67cfd1c6608d@mail.gmail.com>

2006/4/14, Prof Brian Ripley <ripley at stats.ox.ac.uk>:
> You appear to be trying to call nmmin from a standalone program.
> You linked against -lR, but failed to initialize R, hence the segfault.
>
> nmmin is not a part of R that is made available except to a running R
> process: it is documented in `Writing R Extensions' for use in R packages.

Thanks. Initializing R does seem to have fixed the problem. In this, I
have followed the code in tests/Embedding, in particular
embeddedRCall.c. I was led to this code by Section 7.1 of "Writing R
Extensions."

Below is the corrected code and an example session:

#include <R_ext/Applic.h>
#include <stdio.h>

double parabola(int n, double *par, void *ex) {
  double xm = par[0] - 1;
  return xm * xm + 13;
}

/*
 * Copied from tests/Embedded/embeddedRCall.c:
 */
extern int Rf_initEmbeddedR(int argc, char *argv[]);

int main()
{
  char *argv[]= {"nmminDemo", "--gui=none", "--silent"};
  const int argc = 3;

  double initial[1] = {1.5};
  double result[1];
  double value;
  int convergenceCode;
  /*
   * The following values are based on the help
   * page for optim.
   */
  const double abstol = 1e-16;
  const double reltol = 1e-8;
  const double alpha = 1.0; /* reflection factor */
  const double beta = 0.5; /* contraction factor */
  const double gamm = 2.0; /* expansion factor */
  const int trace = 0; /* tracing on */
  int fncount;
  const int maxit = 10000;

  Rf_initEmbeddedR(argc, argv);

  nmmin(1, initial, result, &value, parabola,
	&convergenceCode, abstol, reltol,
	NULL, alpha, beta, gamm,
	trace, &fncount, maxit);
  printf("fncount: %d\n", fncount);
  printf("convergence code: %d\n", convergenceCode);
  printf("min of %f at x = %f\n", value, result[0]);
  return 0;
}

----

$ gcc nmminDemo.c -g
-I/Library/Frameworks/R.framework/Versions/2.1.1/Resources/include
-L/Library/Frameworks/R.framework/Versions/2.1.1/Resources/lib -lR
$ R CMD ./a.out
fncount: 24
convergence code: 0
min of 13.000000 at x = 1.000195

--
David Faden, dfaden at iastate.edu
AIM: pitulx


From p.dalgaard at biostat.ku.dk  Fri Apr 14 19:41:01 2006
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: 14 Apr 2006 19:41:01 +0200
Subject: [Rd] make check of R-alpha_2006-04-08_r37675 fails: qbeta
In-Reply-To: <Pine.LNX.4.64.0604141654581.24174@gannet.stats.ox.ac.uk>
References: <m0wtdyanzp.fsf@bar.nemo-project.org>
	<x2y7yevjsp.fsf@turmalin.kubism.ku.dk>
	<Pine.LNX.4.64.0604092050370.13534@gannet.stats.ox.ac.uk>
	<x23bgmmohi.fsf@turmalin.kubism.ku.dk>
	<m0irphak6k.fsf@bar.nemo-project.org>
	<Pine.LNX.4.64.0604100958350.2901@gannet.stats.ox.ac.uk>
	<17466.15936.420928.889119@basebud.nulle.part>
	<m0ek05a9yn.fsf@bar.nemo-project.org>
	<17466.22147.982663.926905@basebud.nulle.part>
	<Pine.LNX.4.64.0604141654581.24174@gannet.stats.ox.ac.uk>
Message-ID: <x23bgg3viq.fsf@turmalin.kubism.ku.dk>

Prof Brian Ripley <ripley at stats.ox.ac.uk> writes:

> Uwe Ligges had the same problem with gcc 3.3.1 on SuSE 9.0.  So I
> installed gcc 3.3.5 from the sources on an i386 box, and was able to
> reproduce it.
> 
> It is an optimization bug.  The crucial code is
> 
>  	xtrunc = tx;	/* this prevents trouble with excess FPU */
>  				/* precision on some machines. */
>  	if (xtrunc == xinbta)
>  	    goto L_converged;
> 
> and both xtrunc and xinbta are volatile.  Seems that is being ignored
> in 3.3.5/1, and so the loop never terminates.
> 
> Using an explicit check is safer and faster. I'll put mine in once I
> have finished testing.

However, if the compiler is disobeying "volatile", it is buggy and it
might be safer not to use that compiler at all. There's no telling
what else might break for the same reason.
 
> 
> On Mon, 10 Apr 2006, Dirk Eddelbuettel wrote:
> 
> >
> > On 10 April 2006 at 14:31, Bj?rn-Helge Mevik wrote:
> > | Dirk Eddelbuettel wrote:
> > |
> > | > Fair point, especially as you have to insist on using gcc 3.3.* on Debian:
> > | > -- 3.3.6 is the current 3.3.* one whereas Bj?rn-Helge used 3.3.5
> > | > -- 3.4.5 is the latest 3.* one supplanting 3.3.(5,6)
> > | > -- 4.0.3 is the current default
> > | > -- 4.1.0 is available too
> >
> > [...]
> > | Hmmm... I don't `see' all those versions.  After an `aptitude update':
> >
> > (That didn't show version numbers...)
> >
> > | My /etc/apt/sources.list is:
> > |
> > | deb http://ftp.no.debian.org/debian/ sarge main non-free contrib
> > | deb-src http://ftp.no.debian.org/debian/ sarge main non-free contrib
> > | deb http://ftp.no.debian.org/debian-non-US sarge/non-US main contrib non-free
> > | deb-src http://ftp.no.debian.org/debian-non-US sarge/non-US main contrib non-free
> > | deb http://security.debian.org/ sarge/updates main contrib non-free
> > |
> > | Why am I seeing older versions than you?
> >
> > Because you point to 'sarge' which was frozen and released a year ago.
> > If you want something newer than Debian stable, you have to point to it.
> >
> > This is all off-topic here. Please consider (subscribing and) posting to
> > r-sig-debian for R/Debian related matters, or debian-help for generic Debian
> > questions.
> >
> > Hope this helps, Dirk
> >
> >
> 
> -- 
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From ripley at stats.ox.ac.uk  Fri Apr 14 19:47:28 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 14 Apr 2006 18:47:28 +0100 (BST)
Subject: [Rd] make check of R-alpha_2006-04-08_r37675 fails: qbeta
In-Reply-To: <x23bgg3viq.fsf@turmalin.kubism.ku.dk>
References: <m0wtdyanzp.fsf@bar.nemo-project.org>
	<x2y7yevjsp.fsf@turmalin.kubism.ku.dk>
	<Pine.LNX.4.64.0604092050370.13534@gannet.stats.ox.ac.uk>
	<x23bgmmohi.fsf@turmalin.kubism.ku.dk>
	<m0irphak6k.fsf@bar.nemo-project.org>
	<Pine.LNX.4.64.0604100958350.2901@gannet.stats.ox.ac.uk>
	<17466.15936.420928.889119@basebud.nulle.part>
	<m0ek05a9yn.fsf@bar.nemo-project.org>
	<17466.22147.982663.926905@basebud.nulle.part>
	<Pine.LNX.4.64.0604141654581.24174@gannet.stats.ox.ac.uk>
	<x23bgg3viq.fsf@turmalin.kubism.ku.dk>
Message-ID: <Pine.LNX.4.64.0604141842090.873@gannet.stats.ox.ac.uk>

On Fri, 14 Apr 2006, Peter Dalgaard wrote:

> Prof Brian Ripley <ripley at stats.ox.ac.uk> writes:
>
>> Uwe Ligges had the same problem with gcc 3.3.1 on SuSE 9.0.  So I
>> installed gcc 3.3.5 from the sources on an i386 box, and was able to
>> reproduce it.
>>
>> It is an optimization bug.  The crucial code is
>>
>>  	xtrunc = tx;	/* this prevents trouble with excess FPU */
>>  				/* precision on some machines. */
>>  	if (xtrunc == xinbta)
>>  	    goto L_converged;
>>
>> and both xtrunc and xinbta are volatile.  Seems that is being ignored
>> in 3.3.5/1, and so the loop never terminates.
>>
>> Using an explicit check is safer and faster. I'll put mine in once I
>> have finished testing.
>
> However, if the compiler is disobeying "volatile", it is buggy and it
> might be safer not to use that compiler at all. There's no telling
> what else might break for the same reason.

I agree, and in my earlier reply suggested we write this off but given we 
now have two reports I can see many more after release.  It is a known bug 
in gcc 3.3.x, and so far nothing else has come to light.  (This only came 
to light because the warning had previously been suppressed.)

I would advise against systems as old as SuSE 9.0 or many grounds, but
some people may have no choice.

[...]

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Fri Apr 14 21:29:04 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 14 Apr 2006 20:29:04 +0100 (BST)
Subject: [Rd] row.names in data.frame
Message-ID: <Pine.LNX.4.64.0604141959160.3266@gannet.stats.ox.ac.uk>

We know from the White Book p.57 that the row names of a data frame `are 
never NULL and must be unique'.  R documents that row.names() returns a 
character vector, and in R (much more so than on S) a long character 
vector of short unique strings is expensive to store (I saw 72 bytes/row 
on a 64-bit machine for 1:1e6).  [Incidentally, in the White Book the 
index page nos are all off by one for this item, and commonly elsewhere. 
It seems to be LaTeX indexing the page on which a para finishes.]

Last time this came up Martin Maechler asked if we could not do it more 
efficiently, and reminded us recently.  It would be fairly easy if 
everyone used the row.names() and row.names<-() accessor functions, but 
some packages (notably Design and Hmisc) access the attribute "row.names" 
directly (and what that is seems to be undocumented).

I noticed that the White Book does not appear to say that the row names 
are character, and indeed says

   'If all else fails the row names are just the row numbers.'

and it seems the author of expand.grid() took that literally, for it used 
to assign integers to the row names.  However, the current S-PLUS help for 
both row.names and data.frame say row names are a character vector (and 
that row.names<-() coerces to character).

We can certainly differentiate between the internal representation and the 
the result of row.names().  Here is my idea:

1) The internal representation is either NULL, an integer vector or a 
character vector.

2) attr(x, "row.names") will always return either an integer vector or a 
character vector, using 1:nrow(x) if the internal representation is NULL.

3) row.names() will always return as.character(attr(x, "row.names)).

4) attr<- and row.names<- can set NULL, integer or character.

5) Row-indexing a data frame with NULL or integer representation will give 
an integer representation.

This would appear to be completely back-compatible for those who only work 
via the accessor functions, and probably work with almost all package code 
that manipulates attributes directly.  Since the changes can be done 
almost entirely in C code, the performance hit should be negliglible.

The benefits will probably only be appreciable with `tall and skinny'
data frames, as even 72 bytes per row is only going to buy you 9 numeric 
columns.  But that is it seems a common enough case to make this 
worthwhile.

This would be a change aimed at 2.4.0, since we would need plenty of time 
both for testing and to alter code to make use of the more efficient 
representations.

BTW, the maximum object length of 2^31 - 1 ensures that an integer 
representation of row numbers suffices.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ch-r-devel at bobobeach.com  Sat Apr 15 00:12:24 2006
From: ch-r-devel at bobobeach.com (Cyrus Harmon)
Date: Fri, 14 Apr 2006 15:12:24 -0700
Subject: [Rd] minor build problem
In-Reply-To: <Pine.LNX.4.61.0601071850460.2075@gannet.stats>
References: <B6EA82F9-98BE-4899-90AE-CE455AF3F391@bobobeach.com>
	<Pine.LNX.4.61.0601071850460.2075@gannet.stats>
Message-ID: <6F3B7A39-7381-4F06-8C7C-013D729E0555@bobobeach.com>

Perhaps I'm doing something wrong here, but I'm still seeing the:

help2man: can't get `--version' info from ../bin/R

error message here. and the make; make; make install workaround  
doesn't seem to be working for me. I don't know if this is due to  
incompatible versions of perl, but I've tried 5.8.6 and 5.8.8 to no  
avail.

This is on MacOS X 10.4.6/PPC from the latest SVN sources (37777),  
building in a separate directory.

Thanks,

Cyrus


On Jan 7, 2006, at 10:53 AM, Prof Brian Ripley wrote:

> We know: this is due to a change in where the version is stored  
> that someone did not check the consequences of. It will be fixed  
> shortly (I am testing a fix right now).  Meanwhile,
>
> make; make; make install
>
> works.
>
> On Sat, 7 Jan 2006, Cyrus Harmon wrote:
>
>> I'm trying to build from the latest SVN sources on Mac OS X 10.4.3
>> and I seem to be having a problem making the documentation.
>>
>> When I do make install, i get the following:
>>
>> (sly at gigondas):~/src/R/r-devel/build-f95$ make install
>> make[1]: Nothing to be done for `front-matter'.
>> SVN-REVISION is unchanged
>> make[1]: Nothing to be done for `install'.
>> make[1]: Nothing to be done for `install'.
>> installing doc ...
>> /sw/bin/install: cannot stat `R.1': No such file or directory
>> make[1]: *** [install-man] Error 1
>> make: *** [install] Error 1
>>
>> which is due to the fact that R.1 doesn't exist. When I try to  
>> make R.
>> 1 by going into docs and doing make svnonly, I get:
>>
>> (sly at gigondas):~/src/R/r-devel/build-f95/doc$ make svnonly
>> make[1]: `R.fe' is up to date.
>> help2man: can't get `--version' info from ../src/scripts/R.fe
>>
>>
>> When I try to run help2man manually I get:
>>
>> (sly at gigondas):~/src/R/r-devel/build-f95/doc$ perl  ../../R/tools/
>> help2man.pl --include=../../R/doc/R.aux --no-info --output=R.1 --
>> name="a language for data analysis and graphics" ../src/scripts/R.fe
>> help2man: can't get `--version' info from ../src/scripts/R.fe
>>
>>
>> If I try to get the version info from ../src/scripts/R.fe directly, I
>> get:
>>
>> (sly at gigondas):~/src/R/r-devel/build-f95/doc$ ../src/scripts/R.fe --
>> version
>> Version 2.3.0 Under development (unstable) (2006-01-07 r37011)
>> Copyright (C) 2006 R Development Core Team
>>
>> R is free software and comes with ABSOLUTELY NO WARRANTY.
>> You are welcome to redistribute it under the terms of the
>> GNU General Public License.  For more information about
>> these matters, see http://www.gnu.org/copyleft/gpl.html.
>>
>>
>> So that seems to work. There must be some problem parsing this
>> output. Does have an idea why help2man is failing here?
>>
>> Thanks,
>>
>> Cyrus
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
>
> -- 
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From nakama at ki.rim.or.jp  Sat Apr 15 01:10:32 2006
From: nakama at ki.rim.or.jp (Ei-ji Nakama)
Date: Sat, 15 Apr 2006 08:10:32 +0900
Subject: [Rd] UTF8 letters are imaged incorrectly (PR#8770)
In-Reply-To: <200604142207.37233.bocharov_m@inbox.ru>
References: <20060414112630.F16F91953A@slim.kubism.ku.dk>
	<200604142000.53660.bocharov_m@inbox.ru>
	<dc41e1260604140932o513c1a26g6c2f84bc5733b6ec@mail.gmail.com>
	<200604142207.37233.bocharov_m@inbox.ru>
Message-ID: <dc41e1260604141610w4a48b4bbn3621c5b9f3a9d43d@mail.gmail.com>

This was not a bug.

2006/4/15, Mike Bocharov <bocharov_m at inbox.ru>:
> It work, thanks for your help!
>
> >  If an error is not given by a locale command, I think that local
> > setting of glibc does not have any problem.
> >  I think that there is not problem if  add encoding of koi8-r to
> > XLC_LOCALE file.
> >
> > I am not readable, but probably the following URL is useful.
> > http://ru.gentoo-wiki.com/HOWTO_ru_RU.utf8_Gentoo_way
>


--
EI-JI Nakama  <nakama at ki.rim.or.jp>
"\u4e2d\u9593\u6804\u6cbb"  <nakama at ki.rim.or.jp>


From roebuck at mdanderson.org  Sat Apr 15 09:41:18 2006
From: roebuck at mdanderson.org (Paul Roebuck)
Date: Sat, 15 Apr 2006 02:41:18 -0500 (CDT)
Subject: [Rd] Wishlist: 'quietly' argument for .onAttach() / .First.lib()
In-Reply-To: <Pine.LNX.4.64.0604140713340.19757@gannet.stats.ox.ac.uk>
References: <39B6DDB9048D0F4DAD42CB26AAFF0AFAFEDAA5@usctmx1106.merck.com>
	<Pine.OSF.4.58.0604131458490.336486@wotan.mdacc.tmc.edu>
	<Pine.LNX.4.64.0604140713340.19757@gannet.stats.ox.ac.uk>
Message-ID: <Pine.OSF.4.58.0604150141320.402202@wotan.mdacc.tmc.edu>

On Fri, 14 Apr 2006, Prof Brian Ripley wrote:

> I carefully did not suggest the use of option 'verbose', as that is used
> in many other places.  In particular, with your proposal, you cannot have
> the message without a lot of chatter from library() (and although that has
> a 'verbose' argument, it is often called implicitly, and rarely with
> that argument set).

Fair enough. 'Course I preferred the implicit 'quietly' argument
so the 'verbose' option works perfectly in that case. Possibly a
minority view on the subject, but I don't care for packages being
"chatty" myself except when explicitly asked to be so by the user.

> Similarly for Bill Dunlap's proposal: suppressMessages would squelch all
> messages from the call, not just the one from your package's startup code.
> Now, at present there may not be any, but that could well change as
> message() gets more widely used.

I found Bill's suggestion a bit scary myself; suppressing messages
when dealing with loading packages seems a bit like disabling the
compiler's warning messages - a bad idea. But it was a novel approach.

Given what you said above, do you favor the suggestion to use
message() instead of cat() for the purpose of .onAttach() startup
messages? I've seen message() before in the manpages but never saw
any documentation on how or when it might be considered appropriate
to use. Why would one want to represent a simple non-error message
as a condition in the first place?


> On Thu, 13 Apr 2006, Paul Roebuck wrote:
>
> > On Thu, 13 Apr 2006, Liaw, Andy wrote:
> >
> >> From: Bill Dunlap
> >>>
> >>> On Thu, 13 Apr 2006, Prof Brian Ripley wrote:
> >>>
> >>>> On Thu, 13 Apr 2006, Peter Ruckdeschel wrote:
> >>>>
> >>>>> in "Writing R extensions" as well as in the help
> >>>>> to .onAttach(), you mention that one could
> >>>>> use this function to issue a start-up message/banner
> >>>>> for the package.
> >>>>>
> >>>>> My little wish for Easter:
> >>>>>
> >>>>> a 'quietly'-type argument for .onAttach() / .First.lib() which is
> >>>>> passed through by functions
> >>>>> require() and library() respectively,
> >>>>> and by means of which one could optionally
> >>>>> suppress this start-up message/banner .
> >>>>>
> >>>>> Is this hard to do?
> >>>>
> >>>> I believe so (and think we have been here before).  The documented
> >>>> call sequence is
> >>>>
> >>>>       .onLoad(libname, pkgname)
> >>>>       .onAttach(libname, pkgname)
> >>>>
> >>>> the same as .First.lib.  There is no way to add an argument
> >>> here, as
> >>>> many existing packages do not support it.  Beyond that, how
> >>> would you
> >>>> pass the argument in?  Namespaces and packages are often
> >>>> loaded/attached implicitly as a result of loading other packages.
> >>>>
> >>>> I did think you could make use of an option to decide
> >>> whether to the
> >>>> print the message or not, but I have always assumed that
> >>> those who did
> >>>> want a banner probably did not want it suppressed.
> >>>
> >>> If the .onAttach() used message() instead of cat()
> >>> to display the banner message then you could use
> >>> 	suppressMessages(require("randomForest"))
> >>> to squelch the message.
> >>
> >> Thanks!  This looks like a good alternative.  What do others think of this
> >> approach?
> >
> > I used an alternative approach myself. This allows the user
> > enable/disable the banner text quite easily.
> >
> > .onAttach <- function(libname, pkgname) {
> >    if (verbose <- getOption("verbose")) {
> >        ...
> >        desc <- packageDescription(pkgname)
> >        cat(sprintf("%s, version %s", desc$Title, desc$Version), "\n")
> >        cat(sprintf("Type library(help=%s) to see package documentation",
> >                    libraryPkgName(pkgname)), "\n")
> >    }
> > }
> >

----------------------------------------------------------
SIGSIG -- signature too long (core dumped)


From roebuck at mdanderson.org  Sat Apr 15 10:16:04 2006
From: roebuck at mdanderson.org (Paul Roebuck)
Date: Sat, 15 Apr 2006 03:16:04 -0500 (CDT)
Subject: [Rd] [R] S4 method dispatch matrixOrArray (fwd)
In-Reply-To: <443EC0F9.2060206@r-project.org>
References: <Pine.OSF.4.58.0604122227040.305100@wotan.mdacc.tmc.edu>
	<443EC0F9.2060206@r-project.org>
Message-ID: <Pine.OSF.4.58.0604150243570.402202@wotan.mdacc.tmc.edu>

Thanks for your in-depth explanation. I had noticed the difference
in order in showMethods() output but was unsure whether that was
indicative of the problem or if I was somehow taking advantage of
an undocumented implementation-specific detail.

If I could, I'd like to go back to the original question from
the R-help post here. The original method was doing its real
dispatching on the arguments of the example that were represented
by the dots. The meat of the method was to manipulate array
objects and as such I didn't want to repeat numerous array methods
as matrix methods (code duplication with the only difference being
the first argument). From another recent posting on a similar topic,
I wanted to do something along the lines of

    setClassUnion("matrixOrArray", c("matrix", "array"))

but that didn't work as originally presented (probably due to
your comment on matrix/array weirdness). So my other question
would be:

3 - Is there a way to use the class union such that I don't have
to duplicate the code unnecessarily yet avoid the setMethod
ordering issue and clarify the original intention?



On Thu, 13 Apr 2006, John Chambers wrote:

> You have two questions, presumably:
>
> 1 - how could the order of the setMethod calls make a difference in the
> results?
> 2 - what's causing the infinite loop & how could it be avoided, reliably?
>
> Second question first.  The danger sign is the "vector" method:
>
> setMethod("foo",
>            signature(A = "vector"),
>            function(A, ...) {
>                foo(matrix(A, nrow = 1), ...)
>            })
>
> This handles a vector by recalling the generic with a matrix.  But
> "vector" is a superclass of "matrix" (see getClass("matrix")) and you
> DON'T have an explicit method defined for "matrix".  So for sure if
> "vector" was the only method, you would be in immediate trouble.
> Coercing down the inheritance tree is potentially bad news.
>
> Generally, if you're going to take over dispatch by coercing an argument
> & then recalling the generic, the result is simplest if you have an
> exact match for the new call, not relying on inheritance.  After all, if
> you're doing the work to coerce the argument, might as well pick one
> that works right away.   Not a universal rule, but other things being
> equal ...
>
> There's an additional issue with methods for  "matrix" and "array"
> because R never allows 2-way arrays to have class "array", which means
> using array() here with the same dimensions would not have helped.
> Also, matrix and array objects are weird in that they are not basic
> vectors but also have no class attribute, and is.object() is FALSE for them.
>
> More interesting though--how can the order of the setMethod() calls
> matter?  To see that we need to look at the methods list object.  (The
> discussion is simplified to the case that only one argument is involved,
> which doesn't affect the result.)
>
> The MethodsList object has a slot containing a named list of methods,
> with the names being those of the classes that appeared in the setMethod
> calls, in the order that the calls occurred(note!).  All classes are
> essentially equal from the view of the generic function, so there's no
> ordering favoring the "more relevant".
>
> When method dispatch occurs, the code first looks for an exact match to
> the class of the actual argument--that's a quick search in the names of
> the list.
>
> If the direct search fails, the code now looks for an inherited method.
> The key point is that this second search is "greedy"--the first
> inherited method found is used.
>
> NOW it should be clear why the order of the setMethod() calls matters.
> You have two potential inherited methods here for "matrix"; namely,
> "array" and "vector".  WE know that the "array" method is `closer', and
> the R dispatcher could decide this also, if it were willing to look
> through all possible inheritance paths and drop one possibility if a
> better one was found.
>
> It currently doesn't do any further search, and doing so would be a
> modest efficiency hit.  I'm inclined to think the cost would be worth it
> to eliminate unpleasant suprises like this one, but opinions may
> differ.  (Once found, the inherited method is stored directly in the
> list used for the first lookup,  so the hit is only the first time a
> particular signature turns up.)
>
> To make the difference clearer, I added to your example another generic
> "bar" with the same methods as "foo", but with the order of the
> setMethod calls reversed.
> By looking at the "methods" slot in the two cases, we can see why the
> bad ("vector") method is selected for bar() but not for foo():
>
>  > names(getMethods("foo")@methods)
> [1] "array"  "vector"
>  > names(getMethods("bar")@methods)
> [1] "vector" "array"
>
> After running foo(1:10) and trying to run bar(1:10):
>
>  > showMethods("foo")
>
> Function "foo":
>  A = "array"
>  A = "vector"
>  A = "integer"
>     (inherited from A = "vector")
>  A = "matrix"
>     (inherited from A = "array")
>  > showMethods("bar")
>
> Function "bar":
>  A = "vector"
>  A = "array"
>  A = "integer"
>     (inherited from A = "vector")
>  A = "matrix"
>     (inherited from A = "vector")
>
> But including setMethod("bar", "matrix", ...) in the source code makes
> bar() work fine.
>
>
>
> Paul Roebuck wrote:
>
> >Sorry to bother but could you shed some light on this?
> >I don't understand why order of setMethod calls makes
> >any difference. Since it obviously does, it has shaken
> >the foundations of what I thought I understood about
> >S4 methods. Even Gabor was surprised...
> >
> >
> >---------- Forwarded message ----------
> >Date: Wed, 12 Apr 2006 18:24:46 -0400
> >From: Gabor Grothendieck <ggrothendieck at gmail.com>
> >To: Paul Roebuck <roebuck at mdanderson.org>
> >Cc: R Help Mailing List <r-help at stat.math.ethz.ch>
> >Subject: Re: [R] S4 method dispatch matrixOrArray
> >
> >On 4/12/06, Paul Roebuck <roebuck at mdanderson.org> wrote:
> >
> >
> >
> >>On Wed, 12 Apr 2006, Gabor Grothendieck wrote:
> >>
> >>
> >>
> >>>On 4/12/06, Paul Roebuck <roebuck at mdanderson.org> wrote:
> >>>
> >>>
> >>>
> >>>>I have some code where the primary dispatching is on
> >>>>other parameters so I'd like not to have to create a
> >>>>set of functions for "matrix" and another duplicate
> >>>>set for "array". But the class union technique isn't
> >>>>working as implemented below and I don't have my Green
> >>>>book with me. How do I fix my infinite recursion problem?
> >>>>
> >>>>
> >>>>##--------------------------------------------------------
> >>>>library(methods)
> >>>>
> >>>>setGeneric("foo",
> >>>>          function(A, ...) {
> >>>>              cat("generic", match.call()[[1]], "\n")
> >>>>              standardGeneric("foo")
> >>>>          })
> >>>>
> >>>>setMethod("foo",
> >>>>         signature(A = "vector"),
> >>>>         function(A, ...) {
> >>>>             callGeneric(matrix(A, nrow = 1), ...)
> >>>>         })
> >>>>
> >>>>setClassUnion("matrixOrArray", c("matrix", "array"))
> >>>>
> >>>>setMethod("foo",
> >>>>         signature(A = "matrixOrArray"),
> >>>>         function(A, ...) {
> >>>>             cat("A =", A, "\n")
> >>>>         })
> >>>>
> >>>>## Test
> >>>>foo(1:4)
> >>>>foo(matrix(1:4, 1, 4))
> >>>>foo(array(1:4, c(1, 4, 1)))
> >>>>
> >>>>
> >>>I think its good enough to just define an array method, i.e. you
> >>>don't need the matrix method or the matrixOrArray class, and the
> >>>vector method can call foo(matrix(A,1), ...) so:
> >>>
> >>>setGeneric("foo",
> >>>          function(A, ...) {
> >>>              cat("generic", match.call()[[1]], "\n")
> >>>              standardGeneric("foo")
> >>>          })
> >>>
> >>>setMethod("foo",
> >>>         signature(A = "array"),
> >>>         function(A, ...) {
> >>>             cat("A =", A, "\n")
> >>>         })
> >>>
> >>>setMethod("foo",
> >>>         signature(A = "vector"),
> >>>         function(A, ...) {
> >>>             foo(matrix(A, nrow = 1), ...)
> >>>         })
> >>>
> >>>
> >>Something didn't seem right here. That was pretty close
> >>to what I had started with, before trying to go the
> >>classUnion route. Matter of fact, the vector method can
> >>retain use of callGeneric.
> >>
> >>The solution has to do with the order in which calls to
> >>setMethod are made. Adding foo-vector after foo-array
> >>works fine; the other way around causes infinite recursion.
> >>
> >>
> >
> >This is surprising.  I would have thought that the
> >parent/child relationships determine the order that
> >dispatched methods are invoked, not the order that
> >the setMethod commands are issued in.
> >
> >
> >
> >
>

----------------------------------------------------------
SIGSIG -- signature too long (core dumped)


From ggrothendieck at gmail.com  Sat Apr 15 16:28:25 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sat, 15 Apr 2006 10:28:25 -0400
Subject: [Rd] [R] S4 method dispatch matrixOrArray (fwd)
In-Reply-To: <Pine.OSF.4.58.0604150243570.402202@wotan.mdacc.tmc.edu>
References: <Pine.OSF.4.58.0604122227040.305100@wotan.mdacc.tmc.edu>
	<443EC0F9.2060206@r-project.org>
	<Pine.OSF.4.58.0604150243570.402202@wotan.mdacc.tmc.edu>
Message-ID: <971536df0604150728s3ea62f54m1e1cba3f076344c0@mail.gmail.com>

You could just place the array/matrix code into the vector method
rather than using the inheritance mechanism.  Note
that if m is a matrix then is(m, "array") is TRUE.  This avoids
creating an ugly dummy class, fighting with the inheritance
mechanism, having fragile code, etc.  Also its shorter.

setGeneric("foo",
         function(A, ...) {
             cat("generic", match.call()[[1]], "\n")
             standardGeneric("foo")
         })

setMethod("foo",
        signature(A = "vector"),
        function(A, ...) {
             if (!is(A, "array")) A <- matrix(A, 1)
             cat("A =", A, "\n")
        })

## Test
foo(1:4)
foo(matrix(1:4, 1, 4))
foo(array(1:4, c(1, 4, 1)))

On 4/15/06, Paul Roebuck <roebuck at mdanderson.org> wrote:
> Thanks for your in-depth explanation. I had noticed the difference
> in order in showMethods() output but was unsure whether that was
> indicative of the problem or if I was somehow taking advantage of
> an undocumented implementation-specific detail.
>
> If I could, I'd like to go back to the original question from
> the R-help post here. The original method was doing its real
> dispatching on the arguments of the example that were represented
> by the dots. The meat of the method was to manipulate array
> objects and as such I didn't want to repeat numerous array methods
> as matrix methods (code duplication with the only difference being
> the first argument). From another recent posting on a similar topic,
> I wanted to do something along the lines of
>
>    setClassUnion("matrixOrArray", c("matrix", "array"))
>
> but that didn't work as originally presented (probably due to
> your comment on matrix/array weirdness). So my other question
> would be:
>
> 3 - Is there a way to use the class union such that I don't have
> to duplicate the code unnecessarily yet avoid the setMethod
> ordering issue and clarify the original intention?
>
>
>
> On Thu, 13 Apr 2006, John Chambers wrote:
>
> > You have two questions, presumably:
> >
> > 1 - how could the order of the setMethod calls make a difference in the
> > results?
> > 2 - what's causing the infinite loop & how could it be avoided, reliably?
> >
> > Second question first.  The danger sign is the "vector" method:
> >
> > setMethod("foo",
> >            signature(A = "vector"),
> >            function(A, ...) {
> >                foo(matrix(A, nrow = 1), ...)
> >            })
> >
> > This handles a vector by recalling the generic with a matrix.  But
> > "vector" is a superclass of "matrix" (see getClass("matrix")) and you
> > DON'T have an explicit method defined for "matrix".  So for sure if
> > "vector" was the only method, you would be in immediate trouble.
> > Coercing down the inheritance tree is potentially bad news.
> >
> > Generally, if you're going to take over dispatch by coercing an argument
> > & then recalling the generic, the result is simplest if you have an
> > exact match for the new call, not relying on inheritance.  After all, if
> > you're doing the work to coerce the argument, might as well pick one
> > that works right away.   Not a universal rule, but other things being
> > equal ...
> >
> > There's an additional issue with methods for  "matrix" and "array"
> > because R never allows 2-way arrays to have class "array", which means
> > using array() here with the same dimensions would not have helped.
> > Also, matrix and array objects are weird in that they are not basic
> > vectors but also have no class attribute, and is.object() is FALSE for them.
> >
> > More interesting though--how can the order of the setMethod() calls
> > matter?  To see that we need to look at the methods list object.  (The
> > discussion is simplified to the case that only one argument is involved,
> > which doesn't affect the result.)
> >
> > The MethodsList object has a slot containing a named list of methods,
> > with the names being those of the classes that appeared in the setMethod
> > calls, in the order that the calls occurred(note!).  All classes are
> > essentially equal from the view of the generic function, so there's no
> > ordering favoring the "more relevant".
> >
> > When method dispatch occurs, the code first looks for an exact match to
> > the class of the actual argument--that's a quick search in the names of
> > the list.
> >
> > If the direct search fails, the code now looks for an inherited method.
> > The key point is that this second search is "greedy"--the first
> > inherited method found is used.
> >
> > NOW it should be clear why the order of the setMethod() calls matters.
> > You have two potential inherited methods here for "matrix"; namely,
> > "array" and "vector".  WE know that the "array" method is `closer', and
> > the R dispatcher could decide this also, if it were willing to look
> > through all possible inheritance paths and drop one possibility if a
> > better one was found.
> >
> > It currently doesn't do any further search, and doing so would be a
> > modest efficiency hit.  I'm inclined to think the cost would be worth it
> > to eliminate unpleasant suprises like this one, but opinions may
> > differ.  (Once found, the inherited method is stored directly in the
> > list used for the first lookup,  so the hit is only the first time a
> > particular signature turns up.)
> >
> > To make the difference clearer, I added to your example another generic
> > "bar" with the same methods as "foo", but with the order of the
> > setMethod calls reversed.
> > By looking at the "methods" slot in the two cases, we can see why the
> > bad ("vector") method is selected for bar() but not for foo():
> >
> >  > names(getMethods("foo")@methods)
> > [1] "array"  "vector"
> >  > names(getMethods("bar")@methods)
> > [1] "vector" "array"
> >
> > After running foo(1:10) and trying to run bar(1:10):
> >
> >  > showMethods("foo")
> >
> > Function "foo":
> >  A = "array"
> >  A = "vector"
> >  A = "integer"
> >     (inherited from A = "vector")
> >  A = "matrix"
> >     (inherited from A = "array")
> >  > showMethods("bar")
> >
> > Function "bar":
> >  A = "vector"
> >  A = "array"
> >  A = "integer"
> >     (inherited from A = "vector")
> >  A = "matrix"
> >     (inherited from A = "vector")
> >
> > But including setMethod("bar", "matrix", ...) in the source code makes
> > bar() work fine.
> >
> >
> >
> > Paul Roebuck wrote:
> >
> > >Sorry to bother but could you shed some light on this?
> > >I don't understand why order of setMethod calls makes
> > >any difference. Since it obviously does, it has shaken
> > >the foundations of what I thought I understood about
> > >S4 methods. Even Gabor was surprised...
> > >
> > >
> > >---------- Forwarded message ----------
> > >Date: Wed, 12 Apr 2006 18:24:46 -0400
> > >From: Gabor Grothendieck <ggrothendieck at gmail.com>
> > >To: Paul Roebuck <roebuck at mdanderson.org>
> > >Cc: R Help Mailing List <r-help at stat.math.ethz.ch>
> > >Subject: Re: [R] S4 method dispatch matrixOrArray
> > >
> > >On 4/12/06, Paul Roebuck <roebuck at mdanderson.org> wrote:
> > >
> > >
> > >
> > >>On Wed, 12 Apr 2006, Gabor Grothendieck wrote:
> > >>
> > >>
> > >>
> > >>>On 4/12/06, Paul Roebuck <roebuck at mdanderson.org> wrote:
> > >>>
> > >>>
> > >>>
> > >>>>I have some code where the primary dispatching is on
> > >>>>other parameters so I'd like not to have to create a
> > >>>>set of functions for "matrix" and another duplicate
> > >>>>set for "array". But the class union technique isn't
> > >>>>working as implemented below and I don't have my Green
> > >>>>book with me. How do I fix my infinite recursion problem?
> > >>>>
> > >>>>
> > >>>>##--------------------------------------------------------
> > >>>>library(methods)
> > >>>>
> > >>>>setGeneric("foo",
> > >>>>          function(A, ...) {
> > >>>>              cat("generic", match.call()[[1]], "\n")
> > >>>>              standardGeneric("foo")
> > >>>>          })
> > >>>>
> > >>>>setMethod("foo",
> > >>>>         signature(A = "vector"),
> > >>>>         function(A, ...) {
> > >>>>             callGeneric(matrix(A, nrow = 1), ...)
> > >>>>         })
> > >>>>
> > >>>>setClassUnion("matrixOrArray", c("matrix", "array"))
> > >>>>
> > >>>>setMethod("foo",
> > >>>>         signature(A = "matrixOrArray"),
> > >>>>         function(A, ...) {
> > >>>>             cat("A =", A, "\n")
> > >>>>         })
> > >>>>
> > >>>>## Test
> > >>>>foo(1:4)
> > >>>>foo(matrix(1:4, 1, 4))
> > >>>>foo(array(1:4, c(1, 4, 1)))
> > >>>>
> > >>>>
> > >>>I think its good enough to just define an array method, i.e. you
> > >>>don't need the matrix method or the matrixOrArray class, and the
> > >>>vector method can call foo(matrix(A,1), ...) so:
> > >>>
> > >>>setGeneric("foo",
> > >>>          function(A, ...) {
> > >>>              cat("generic", match.call()[[1]], "\n")
> > >>>              standardGeneric("foo")
> > >>>          })
> > >>>
> > >>>setMethod("foo",
> > >>>         signature(A = "array"),
> > >>>         function(A, ...) {
> > >>>             cat("A =", A, "\n")
> > >>>         })
> > >>>
> > >>>setMethod("foo",
> > >>>         signature(A = "vector"),
> > >>>         function(A, ...) {
> > >>>             foo(matrix(A, nrow = 1), ...)
> > >>>         })
> > >>>
> > >>>
> > >>Something didn't seem right here. That was pretty close
> > >>to what I had started with, before trying to go the
> > >>classUnion route. Matter of fact, the vector method can
> > >>retain use of callGeneric.
> > >>
> > >>The solution has to do with the order in which calls to
> > >>setMethod are made. Adding foo-vector after foo-array
> > >>works fine; the other way around causes infinite recursion.
> > >>
> > >>
> > >
> > >This is surprising.  I would have thought that the
> > >parent/child relationships determine the order that
> > >dispatched methods are invoked, not the order that
> > >the setMethod commands are issued in.
> > >
> > >
> > >
> > >
> >
>
> ----------------------------------------------------------
> SIGSIG -- signature too long (core dumped)
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From ggrothendieck at gmail.com  Sat Apr 15 16:49:06 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sat, 15 Apr 2006 10:49:06 -0400
Subject: [Rd] [R] S4 method dispatch matrixOrArray (fwd)
In-Reply-To: <971536df0604150728s3ea62f54m1e1cba3f076344c0@mail.gmail.com>
References: <Pine.OSF.4.58.0604122227040.305100@wotan.mdacc.tmc.edu>
	<443EC0F9.2060206@r-project.org>
	<Pine.OSF.4.58.0604150243570.402202@wotan.mdacc.tmc.edu>
	<971536df0604150728s3ea62f54m1e1cba3f076344c0@mail.gmail.com>
Message-ID: <971536df0604150749h7e7ee22dsdc577bdcb5ca2c2b@mail.gmail.com>

In thinking about this a bit more I realize that even though the
approach I discussed works on the example, it coerces A to a
vector which may be undesirable in the real application.  However, one
could still circumvent the inheritance by performing the vector to
matrix conversion in the generic itself to avoid the need for
a vector method.  This is also short, avoid the ugly matrixOrArray
class and does not get one embroiled in delicate inheritance
issues:

setGeneric("foo",
         function(A, ...) {
             cat("generic", match.call()[[1]], "\n")
             if (!is(A, "array") && is(A, "vector")) A <- matrix(A, 1)
             standardGeneric("foo")
         })

setMethod("foo",
        signature(A = "array"),
        function(A, ...) {
             cat("A =", A, "\n")
        })

## Test
foo(1:4)
foo(matrix(1:4, 1, 4))
foo(array(1:4, c(1, 4, 1)))



On 4/15/06, Gabor Grothendieck <ggrothendieck at gmail.com> wrote:
> You could just place the array/matrix code into the vector method
> rather than using the inheritance mechanism.  Note
> that if m is a matrix then is(m, "array") is TRUE.  This avoids
> creating an ugly dummy class, fighting with the inheritance
> mechanism, having fragile code, etc.  Also its shorter.
>
> setGeneric("foo",
>         function(A, ...) {
>             cat("generic", match.call()[[1]], "\n")
>             standardGeneric("foo")
>         })
>
> setMethod("foo",
>        signature(A = "vector"),
>        function(A, ...) {
>             if (!is(A, "array")) A <- matrix(A, 1)
>             cat("A =", A, "\n")
>        })
>
> ## Test
> foo(1:4)
> foo(matrix(1:4, 1, 4))
> foo(array(1:4, c(1, 4, 1)))
>
> On 4/15/06, Paul Roebuck <roebuck at mdanderson.org> wrote:
> > Thanks for your in-depth explanation. I had noticed the difference
> > in order in showMethods() output but was unsure whether that was
> > indicative of the problem or if I was somehow taking advantage of
> > an undocumented implementation-specific detail.
> >
> > If I could, I'd like to go back to the original question from
> > the R-help post here. The original method was doing its real
> > dispatching on the arguments of the example that were represented
> > by the dots. The meat of the method was to manipulate array
> > objects and as such I didn't want to repeat numerous array methods
> > as matrix methods (code duplication with the only difference being
> > the first argument). From another recent posting on a similar topic,
> > I wanted to do something along the lines of
> >
> >    setClassUnion("matrixOrArray", c("matrix", "array"))
> >
> > but that didn't work as originally presented (probably due to
> > your comment on matrix/array weirdness). So my other question
> > would be:
> >
> > 3 - Is there a way to use the class union such that I don't have
> > to duplicate the code unnecessarily yet avoid the setMethod
> > ordering issue and clarify the original intention?
> >
> >
> >
> > On Thu, 13 Apr 2006, John Chambers wrote:
> >
> > > You have two questions, presumably:
> > >
> > > 1 - how could the order of the setMethod calls make a difference in the
> > > results?
> > > 2 - what's causing the infinite loop & how could it be avoided, reliably?
> > >
> > > Second question first.  The danger sign is the "vector" method:
> > >
> > > setMethod("foo",
> > >            signature(A = "vector"),
> > >            function(A, ...) {
> > >                foo(matrix(A, nrow = 1), ...)
> > >            })
> > >
> > > This handles a vector by recalling the generic with a matrix.  But
> > > "vector" is a superclass of "matrix" (see getClass("matrix")) and you
> > > DON'T have an explicit method defined for "matrix".  So for sure if
> > > "vector" was the only method, you would be in immediate trouble.
> > > Coercing down the inheritance tree is potentially bad news.
> > >
> > > Generally, if you're going to take over dispatch by coercing an argument
> > > & then recalling the generic, the result is simplest if you have an
> > > exact match for the new call, not relying on inheritance.  After all, if
> > > you're doing the work to coerce the argument, might as well pick one
> > > that works right away.   Not a universal rule, but other things being
> > > equal ...
> > >
> > > There's an additional issue with methods for  "matrix" and "array"
> > > because R never allows 2-way arrays to have class "array", which means
> > > using array() here with the same dimensions would not have helped.
> > > Also, matrix and array objects are weird in that they are not basic
> > > vectors but also have no class attribute, and is.object() is FALSE for them.
> > >
> > > More interesting though--how can the order of the setMethod() calls
> > > matter?  To see that we need to look at the methods list object.  (The
> > > discussion is simplified to the case that only one argument is involved,
> > > which doesn't affect the result.)
> > >
> > > The MethodsList object has a slot containing a named list of methods,
> > > with the names being those of the classes that appeared in the setMethod
> > > calls, in the order that the calls occurred(note!).  All classes are
> > > essentially equal from the view of the generic function, so there's no
> > > ordering favoring the "more relevant".
> > >
> > > When method dispatch occurs, the code first looks for an exact match to
> > > the class of the actual argument--that's a quick search in the names of
> > > the list.
> > >
> > > If the direct search fails, the code now looks for an inherited method.
> > > The key point is that this second search is "greedy"--the first
> > > inherited method found is used.
> > >
> > > NOW it should be clear why the order of the setMethod() calls matters.
> > > You have two potential inherited methods here for "matrix"; namely,
> > > "array" and "vector".  WE know that the "array" method is `closer', and
> > > the R dispatcher could decide this also, if it were willing to look
> > > through all possible inheritance paths and drop one possibility if a
> > > better one was found.
> > >
> > > It currently doesn't do any further search, and doing so would be a
> > > modest efficiency hit.  I'm inclined to think the cost would be worth it
> > > to eliminate unpleasant suprises like this one, but opinions may
> > > differ.  (Once found, the inherited method is stored directly in the
> > > list used for the first lookup,  so the hit is only the first time a
> > > particular signature turns up.)
> > >
> > > To make the difference clearer, I added to your example another generic
> > > "bar" with the same methods as "foo", but with the order of the
> > > setMethod calls reversed.
> > > By looking at the "methods" slot in the two cases, we can see why the
> > > bad ("vector") method is selected for bar() but not for foo():
> > >
> > >  > names(getMethods("foo")@methods)
> > > [1] "array"  "vector"
> > >  > names(getMethods("bar")@methods)
> > > [1] "vector" "array"
> > >
> > > After running foo(1:10) and trying to run bar(1:10):
> > >
> > >  > showMethods("foo")
> > >
> > > Function "foo":
> > >  A = "array"
> > >  A = "vector"
> > >  A = "integer"
> > >     (inherited from A = "vector")
> > >  A = "matrix"
> > >     (inherited from A = "array")
> > >  > showMethods("bar")
> > >
> > > Function "bar":
> > >  A = "vector"
> > >  A = "array"
> > >  A = "integer"
> > >     (inherited from A = "vector")
> > >  A = "matrix"
> > >     (inherited from A = "vector")
> > >
> > > But including setMethod("bar", "matrix", ...) in the source code makes
> > > bar() work fine.
> > >
> > >
> > >
> > > Paul Roebuck wrote:
> > >
> > > >Sorry to bother but could you shed some light on this?
> > > >I don't understand why order of setMethod calls makes
> > > >any difference. Since it obviously does, it has shaken
> > > >the foundations of what I thought I understood about
> > > >S4 methods. Even Gabor was surprised...
> > > >
> > > >
> > > >---------- Forwarded message ----------
> > > >Date: Wed, 12 Apr 2006 18:24:46 -0400
> > > >From: Gabor Grothendieck <ggrothendieck at gmail.com>
> > > >To: Paul Roebuck <roebuck at mdanderson.org>
> > > >Cc: R Help Mailing List <r-help at stat.math.ethz.ch>
> > > >Subject: Re: [R] S4 method dispatch matrixOrArray
> > > >
> > > >On 4/12/06, Paul Roebuck <roebuck at mdanderson.org> wrote:
> > > >
> > > >
> > > >
> > > >>On Wed, 12 Apr 2006, Gabor Grothendieck wrote:
> > > >>
> > > >>
> > > >>
> > > >>>On 4/12/06, Paul Roebuck <roebuck at mdanderson.org> wrote:
> > > >>>
> > > >>>
> > > >>>
> > > >>>>I have some code where the primary dispatching is on
> > > >>>>other parameters so I'd like not to have to create a
> > > >>>>set of functions for "matrix" and another duplicate
> > > >>>>set for "array". But the class union technique isn't
> > > >>>>working as implemented below and I don't have my Green
> > > >>>>book with me. How do I fix my infinite recursion problem?
> > > >>>>
> > > >>>>
> > > >>>>##--------------------------------------------------------
> > > >>>>library(methods)
> > > >>>>
> > > >>>>setGeneric("foo",
> > > >>>>          function(A, ...) {
> > > >>>>              cat("generic", match.call()[[1]], "\n")
> > > >>>>              standardGeneric("foo")
> > > >>>>          })
> > > >>>>
> > > >>>>setMethod("foo",
> > > >>>>         signature(A = "vector"),
> > > >>>>         function(A, ...) {
> > > >>>>             callGeneric(matrix(A, nrow = 1), ...)
> > > >>>>         })
> > > >>>>
> > > >>>>setClassUnion("matrixOrArray", c("matrix", "array"))
> > > >>>>
> > > >>>>setMethod("foo",
> > > >>>>         signature(A = "matrixOrArray"),
> > > >>>>         function(A, ...) {
> > > >>>>             cat("A =", A, "\n")
> > > >>>>         })
> > > >>>>
> > > >>>>## Test
> > > >>>>foo(1:4)
> > > >>>>foo(matrix(1:4, 1, 4))
> > > >>>>foo(array(1:4, c(1, 4, 1)))
> > > >>>>
> > > >>>>
> > > >>>I think its good enough to just define an array method, i.e. you
> > > >>>don't need the matrix method or the matrixOrArray class, and the
> > > >>>vector method can call foo(matrix(A,1), ...) so:
> > > >>>
> > > >>>setGeneric("foo",
> > > >>>          function(A, ...) {
> > > >>>              cat("generic", match.call()[[1]], "\n")
> > > >>>              standardGeneric("foo")
> > > >>>          })
> > > >>>
> > > >>>setMethod("foo",
> > > >>>         signature(A = "array"),
> > > >>>         function(A, ...) {
> > > >>>             cat("A =", A, "\n")
> > > >>>         })
> > > >>>
> > > >>>setMethod("foo",
> > > >>>         signature(A = "vector"),
> > > >>>         function(A, ...) {
> > > >>>             foo(matrix(A, nrow = 1), ...)
> > > >>>         })
> > > >>>
> > > >>>
> > > >>Something didn't seem right here. That was pretty close
> > > >>to what I had started with, before trying to go the
> > > >>classUnion route. Matter of fact, the vector method can
> > > >>retain use of callGeneric.
> > > >>
> > > >>The solution has to do with the order in which calls to
> > > >>setMethod are made. Adding foo-vector after foo-array
> > > >>works fine; the other way around causes infinite recursion.
> > > >>
> > > >>
> > > >
> > > >This is surprising.  I would have thought that the
> > > >parent/child relationships determine the order that
> > > >dispatched methods are invoked, not the order that
> > > >the setMethod commands are issued in.
> > > >
> > > >
> > > >
> > > >
> > >
> >
> > ----------------------------------------------------------
> > SIGSIG -- signature too long (core dumped)
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >
>


From hutch at moneyware.com  Sat Apr 15 19:32:13 2006
From: hutch at moneyware.com (hutch at moneyware.com)
Date: Sat, 15 Apr 2006 19:32:13 +0200 (CEST)
Subject: [Rd] strptime failure R 2.2.1 (PR#8773)
Message-ID: <20060415173213.142D0BFFC@slim.kubism.ku.dk>

Full_Name: Bill Hutchison
Version: 2.2.1
OS: Windows XP
Submission from: (NULL) (69.158.121.13)


example(strptime) produces the following error:

Error in strptime(x, "%d%b%Y") : 2 arguments passed to 'strptime' which requires
3

This error occurs wherever strptime is used. It does not occur in 2.2.0


From ggrothendieck at gmail.com  Sat Apr 15 19:39:09 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sat, 15 Apr 2006 13:39:09 -0400
Subject: [Rd] strptime failure R 2.2.1 (PR#8773)
In-Reply-To: <20060415173213.142D0BFFC@slim.kubism.ku.dk>
References: <20060415173213.142D0BFFC@slim.kubism.ku.dk>
Message-ID: <971536df0604151039s65649152l9bdf6a47477d9d42@mail.gmail.com>

It doesn't do that for me:

> example(strptime)

strptm> format(Sys.time(), "%a %b %d %X %Y %Z")
[1] "Sat Apr 15 1:37:39 PM 2006 Eastern Daylight Time"

strptm> x <- c("1jan1960", "2jan1960", "31mar1960", "30jul1960")

strptm> z <- strptime(x, "%d%b%Y")

strptm> z
[1] "1960-01-01" "1960-01-02" "1960-03-31" "1960-07-30"

strptm> dates <- c("02/27/92", "02/27/92", "01/14/92", "02/28/92",
    "02/01/92")

strptm> times <- c("23:03:20", "22:29:56", "01:03:30", "18:21:03",
    "16:56:26")

strptm> x <- paste(dates, times)

strptm> z <- strptime(x, "%m/%d/%y %H:%M:%S")

strptm> z
[1] "1992-02-27 23:03:20" "1992-02-27 22:29:56" "1992-01-14 01:03:30"
[4] "1992-02-28 18:21:03" "1992-02-01 16:56:26"
> R.version.string # windows XP
[1] "R version 2.2.1, 2005-12-20"
>


On 4/15/06, hutch at moneyware.com <hutch at moneyware.com> wrote:
> Full_Name: Bill Hutchison
> Version: 2.2.1
> OS: Windows XP
> Submission from: (NULL) (69.158.121.13)
>
>
> example(strptime) produces the following error:
>
> Error in strptime(x, "%d%b%Y") : 2 arguments passed to 'strptime' which requires
> 3
>
> This error occurs wherever strptime is used. It does not occur in 2.2.0
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From l.rubusch at web.de  Sat Apr 15 22:59:38 2006
From: l.rubusch at web.de (Lothar Rubusch)
Date: Sat, 15 Apr 2006 22:59:38 +0200
Subject: [Rd] cannot load rJava in R
Message-ID: <1709680043@web.de>

Hi all!

 I recently tried to install the rJava package on my notebook (Debian Etch / Kernel 2.6.15 / jdk 1.5.0-5 / R 2.2.1 / rJava ?? the repo one, have a look below). I compiled R myself with "--with-readline=no" and "--enable-R-shlib flags". Now, each time loading the library rJava I encouter the same error. I reinstalled several times (as root), always the same problem:
JNI_GetCreatedJavaVMs is undefined, isn't it?! I couldn't find anything to that problem so far..

What went wrong?
Do I have the recent repository for rJava?
How can I fix this?

Many thanks in advance!!
 Lothar



[code]
drops R-2.2.1 # R

R : Copyright 2005, The R Foundation for Statistical Computing
Version 2.2.1  (2005-12-20 r36812)
ISBN 3-900051-07-0

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> install.packages("rJava",contriburl="http://www.rosuda.org/R/")
trying URL 'http://www.rosuda.org/R//rJava_0.3-6.tar.gz'
Content type 'application/x-tar' length 60116 bytes
opened URL
==================================================
downloaded 58Kb

* Installing *source* package 'rJava' ...
checking for gcc... gcc
checking for C compiler default output file name... a.out
checking whether the C compiler works... yes
checking whether we are cross compiling... no
checking for suffix of executables...
checking for suffix of object files... o
checking whether we are using the GNU C compiler... yes
checking whether gcc accepts -g... yes
checking for gcc option to accept ANSI C... none needed
checking how to run the C preprocessor... gcc -E
checking for egrep... grep -E
checking for ANSI C header files... yes
checking for sys/wait.h that is POSIX.1 compatible... yes
checking for sys/types.h... yes
checking for sys/stat.h... yes
checking for stdlib.h... yes
checking for string.h... yes
checking for memory.h... yes
checking for strings.h... yes
checking for inttypes.h... yes
checking for stdint.h... yes
checking for unistd.h... yes
checking for string.h... (cached) yes
checking sys/time.h usability... yes
checking sys/time.h presence... yes
checking for sys/time.h... yes
checking for unistd.h... (cached) yes
checking for an ANSI C-conforming const... yes
checking whether time.h and sys/time.h may both be included... yes
checking for stdlib.h... (cached) yes
checking for GNU libc compatible malloc... yes
checking return type of signal handlers... void
checking for memset... yes
checking for mkdir... yes
checking for rmdir... yes
checking for select... yes
checking for socket... yes
checking endianess... intel-like
checking for java... /usr/bin/java
checking Java environment home... in /usr/local/java/current
checking for /usr/local/java/current/include/jni.h... yes
checking for /usr/local/java/current/include/./jni_md.h... no
checking for /usr/local/java/current/include/linux/jni_md.h... yes
checking whether JNI programs can be compiled... yes
checking JNI data types... ok
checking whether threads support is requested... no
configure: creating ./config.status
config.status: creating src/Makevars
config.status: creating R/zzz.R
config.status: creating src/config.h
** libs
gcc -I/usr/local/lib/R/include  -I/usr/local/include  -I/usr/local/java/current/include -I/usr/local/java/current/include/linux -fPIC  -g -O2 -c callJNI.c -o callJNI.o
gcc -I/usr/local/lib/R/include  -I/usr/local/include  -I/usr/local/java/current/include -I/usr/local/java/current/include/linux -fPIC  -g -O2 -c initJNI.c -o initJNI.o
gcc -I/usr/local/lib/R/include  -I/usr/local/include  -I/usr/local/java/current/include -I/usr/local/java/current/include/linux -fPIC  -g -O2 -c Rglue.c -o Rglue.o
gcc -I/usr/local/lib/R/include  -I/usr/local/include  -I/usr/local/java/current/include -I/usr/local/java/current/include/linux -fPIC  -g -O2 -c rJava.c -o rJava.o
gcc -shared -L/usr/local/lib -o rJava.so callJNI.o initJNI.o Rglue.o rJava.o -L -ljvm  -L/usr/local/lib/R/lib -lR
** R
** help
 >>> Building/Updating help pages for package 'rJava'
     Formats: text html latex example
  accessOp                          text    html    latex   example
  jarray                            text    html    latex   example
  jarrayRef-class                   text    html    latex
  jcall                             text    html    latex   example
  jcast                             text    html    latex   example
  jfloat-class                      text    html    latex
  jfloat                            text    html    latex
  jinit                             text    html    latex   example
  jnew                              text    html    latex   example
  jnull                             text    html    latex   example
  jobjRef-class                     text    html    latex
  jreflection                       text    html    latex   example
  print                             text    html    latex
** building package indices ...
* DONE (rJava)

The downloaded packages are in
        /tmp/RtmptQkoVL/downloaded_packages
> library(rJava)
Error in dyn.load(x, as.logical(local), as.logical(now)) :
        unable to load shared library '/usr/local/lib/R/library/rJava/libs/rJava.so':
  /usr/local/lib/R/library/rJava/libs/rJava.so: undefined symbol: JNI_GetCreatedJavaVMs
Error in library(rJava) : .First.lib failed for 'rJava'
> hum???
[/code]


From juan_sr at uol.com.br  Sun Apr 16 02:30:23 2006
From: juan_sr at uol.com.br (Juan Santiago Ramseyer)
Date: Sat, 15 Apr 2006 21:30:23 -0300
Subject: [Rd] Crash in de()
Message-ID: <1145147423.5861.11.camel@localhost.localdomain>

SYSTEM:
------
	CPU: AMD64
	MOTHERBOARD: ASUS 
	OS: FEDORA CORE 5 i64_86

R SESSION:
----------
> teste<-list(a=c(1,2,3,4),b=c(2,4,6,8))
> teste
$a
[1] 1 2 3 4

$b
[1] 2 4 6 8

> de(teste)
*** buffer overflow detected ***: /usr/lib64/R/bin/exec/R terminated
======= Backtrace: =========
/lib64/libc.so.6(__chk_fail+0x2f)[0x3bbbedee3f]
/lib64/libc.so.6[0x3bbbee03a7]
/usr/lib64/R/modules/R_X11.so[0x2aaaae59ce5d]
/usr/lib64/R/modules/R_X11.so[0x2aaaae59e518]
/usr/lib64/R/modules/R_X11.so[0x2aaaae59f564]
/usr/lib64/R/modules/R_X11.so(RX11_dataentry+0x721)[0x2aaaae5a0821]
/usr/lib64/R/lib/libR.so(do_internal+0x106)[0x3bbcbcc836]
/usr/lib64/R/lib/libR.so(Rf_eval+0x5ad)[0x3bbcb9ff2d]
/usr/lib64/R/lib/libR.so(do_begin+0x32)[0x3bbcba10b2]
/usr/lib64/R/lib/libR.so(Rf_eval+0x5ad)[0x3bbcb9ff2d]
/usr/lib64/R/lib/libR.so(Rf_applyClosure+0x286)[0x3bbcba2d56]
/usr/lib64/R/lib/libR.so(Rf_eval+0x4dd)[0x3bbcb9fe5d]
/usr/lib64/R/lib/libR.so(do_set+0x230)[0x3bbcba24d0]
/usr/lib64/R/lib/libR.so(Rf_eval+0x5ad)[0x3bbcb9ff2d]
/usr/lib64/R/lib/libR.so(do_begin+0x32)[0x3bbcba10b2]
/usr/lib64/R/lib/libR.so(Rf_eval+0x5ad)[0x3bbcb9ff2d]
/usr/lib64/R/lib/libR.so(Rf_applyClosure+0x286)[0x3bbcba2d56]
/usr/lib64/R/lib/libR.so(Rf_eval+0x4dd)[0x3bbcb9fe5d]
/usr/lib64/R/lib/libR.so(Rf_ReplIteration+0x145)[0x3bbcbc0ba5]
/usr/lib64/R/lib/libR.so[0x3bbcbc0d90]
/usr/lib64/R/lib/libR.so(run_Rmainloop+0x50)[0x3bbcbc1090]
/usr/lib64/R/bin/exec/R(main+0x10)[0x4007c0]
/lib64/libc.so.6(__libc_start_main+0xf4)[0x3bbbe1d084]
/usr/lib64/R/bin/exec/R[0x4006e9]
======= Memory map: ========
00400000-00401000 r-xp 00000000 fd:00
1081931                            /usr/lib64/R/bin/exec/R
00500000-00502000 rw-p 00000000 fd:00
1081931                            /usr/lib64/R/bin/exec/R
00502000-01ab1000 rw-p 00502000 00:00 0
[heap]
3bbbc00000-3bbbc19000 r-xp 00000000 fd:00
5607161                        /lib64/ld-2.4.so
3bbbd19000-3bbbd1a000 r--p 00019000 fd:00
5607161                        /lib64/ld-2.4.so
3bbbd1a000-3bbbd1b000 rw-p 0001a000 fd:00
5607161                        /lib64/ld-2.4.so
3bbbe00000-3bbbf3f000 r-xp 00000000 fd:00
5607162                        /lib64/libc-2.4.so
3bbbf3f000-3bbc03f000 ---p 0013f000 fd:00
5607162                        /lib64/libc-2.4.so
3bbc03f000-3bbc043000 r--p 0013f000 fd:00
5607162                        /lib64/libc-2.4.so
3bbc043000-3bbc044000 rw-p 00143000 fd:00
5607162                        /lib64/libc-2.4.so
3bbc044000-3bbc049000 rw-p 3bbc044000 00:00 0
3bbc100000-3bbc180000 r-xp 00000000 fd:00
5607163                        /lib64/libm-2.4.so
3bbc180000-3bbc280000 ---p 00080000 fd:00
5607163                        /lib64/libm-2.4.so
3bbc280000-3bbc281000 r--p 00080000 fd:00
5607163                        /lib64/libm-2.4.so
3bbc281000-3bbc282000 rw-p 00081000 fd:00
5607163                        /lib64/libm-2.4.so
3bbc300000-3bbc302000 r-xp 00000000 fd:00
5607164                        /lib64/libdl-2.4.so
3bbc302000-3bbc402000 ---p 00002000 fd:00
5607164                        /lib64/libdl-2.4.so
3bbc402000-3bbc403000 r--p 00002000 fd:00
5607164                        /lib64/libdl-2.4.so
3bbc403000-3bbc404000 rw-p 00003000 fd:00
5607164                        /lib64/libdl-2.4.so
3bbc500000-3bbc514000 r-xp 00000000 fd:00
4550574                        /usr/lib64/libz.so.1.2.3
3bbc514000-3bbc613000 ---p 00014000 fd:00
4550574                        /usr/lib64/libz.so.1.2.3
3bbc613000-3bbc614000 rw-p 00013000 fd:00
4550574                        /usr/lib64/libz.so.1.2.3
3bbc700000-3bbc732000 r-xp 00000000 fd:00
4532319                        /usr/lib64/libreadline.so.5.0
3bbc732000-3bbc831000 ---p 00032000 fd:00
4532319                        /usr/lib64/libreadline.so.5.0
3bbc831000-3bbc839000 rw-p 00031000 fd:00
4532319                        /usr/lib64/libreadline.so.5.0
3bbc839000-3bbc83a000 rw-p 3bbc839000 00:00 0
3bbc900000-3bbc986000 r-xp 00000000 fd:00
4550714                        /usr/lib64/libgfortran.so.1.0.0
3bbc986000-3bbca85000 ---p 00086000 fd:00
4550714                        /usr/lib64/libgfortran.so.1.0.0
3bbca85000-3bbca87000 rw-p 00085000 fd:00
4550714                        /usr/lib64/libgfortran.so.1.0.0
3bbcb00000-3bbcced000 r-xp 00000000 fd:00 5177879
Abortado


From sfalcon at fhcrc.org  Sun Apr 16 03:41:15 2006
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Sat, 15 Apr 2006 18:41:15 -0700
Subject: [Rd] Wishlist: 'quietly' argument for .onAttach() / .First.lib()
References: <39B6DDB9048D0F4DAD42CB26AAFF0AFAFEDAA5@usctmx1106.merck.com>
	<Pine.OSF.4.58.0604131458490.336486@wotan.mdacc.tmc.edu>
	<Pine.LNX.4.64.0604140713340.19757@gannet.stats.ox.ac.uk>
	<Pine.OSF.4.58.0604150141320.402202@wotan.mdacc.tmc.edu>
Message-ID: <m2k69qs3es.fsf@ziti.fhcrc.org>

Paul Roebuck <roebuck at mdanderson.org> writes:
>> Similarly for Bill Dunlap's proposal: suppressMessages would squelch all
>> messages from the call, not just the one from your package's startup code.
>> Now, at present there may not be any, but that could well change as
>> message() gets more widely used.
>
> I found Bill's suggestion a bit scary myself; suppressing messages
> when dealing with loading packages seems a bit like disabling the
> compiler's warning messages - a bad idea. But it was a novel
> approach.

What's the use case where this would be scary?  suppressMessages
doesn't supress warnings or errors, just messages.  If the info to be
communicated to the user is important enough that it would be "scary"
to not see it, then shouldn't it sent as a a warning or an error?

> Given what you said above, do you favor the suggestion to use
> message() instead of cat() for the purpose of .onAttach() startup
> messages? I've seen message() before in the manpages but never saw
> any documentation on how or when it might be considered appropriate
> to use. 

(I know the question wasn't directed at me, but...)

Yes.

> Why would one want to represent a simple non-error message as a
> condition in the first place?

Because it allows another developer to have control over those
messages.  That's the beauty of the condition system in R.  

Right now, developers can choose to allow or suppress messages sent
via message().  With a small change, developers could have a lot more
control.  The message code could define a restart that would allow a
developer-specified function to handle the message.  This could be
useful, for example, to log all messages to a file.

Here's an example of what I'm thinking about:

## Add a 'custom' restart to message().  Here, we'll add it by
## creating a wrapper, mymessage()
mymessage <- function(..., domain=NULL) {
    withRestarts(withCallingHandlers(message(..., domain=domain),
                                     message=function(m) signalCondition(m)),
                 custom=function(m, f) f(m))
    invisible(NULL)
}


## Here is a test function
doit <- function() {
    mymessage("Welcome to the 'doit' function!")
    return(123)
}


## Here is an example message handler.  Here, you could write messages
## to a file, send them as email to your friends or enemies, etc.
## For the example, we'll just prepend 'MSG:'
msgLogger <- function(m) cat(paste("MSG:", conditionMessage(m)), "\n")


## Finally, call the doit function and customize how messages are
## handled.
withCallingHandlers(doit(),
                    message=function(m) {
                        invokeRestart("custom", m, msgLogger)
                    })

MSG: Welcome to the 'doit' function! 
[1] 123


For anyone still with me:

* If there was much concern about squelching "important" messages by
  accident, then one could define a new subclass of simpleMessage, say
  startupMessage or blatherMessage, and then suppress just those.

* This use case of handling messages could also be addressed with a
  logging system like Python's logging module.  Basically, it would
  allow users to install log handlers, set priorities, etc.

Thanks for listening,

+ seth


From khansen at stat.Berkeley.EDU  Sun Apr 16 10:43:03 2006
From: khansen at stat.Berkeley.EDU (Kasper Daniel Hansen)
Date: Sun, 16 Apr 2006 01:43:03 -0700
Subject: [Rd] c++ code on amd64
Message-ID: <EA2A797B-2427-4777-BD91-2E7217FCD318@stat.berkeley.edu>

Hi

Brief synopsis:

I am having a rather peculiar problem regarding a C++ library. It  
seems that functions from this library behave differently when  
compiled using R as opposed to being compiled directly from the  
command line. The problem is only seen on the amd64 platform (using  
gcc 4.0.2) and not on either of Solaris (both 32 bit and 64 bit), Mac  
OS and Windows.

A bit more detail:

Basically the c++ library contains a class and methods for parsing  
text files in specific formats. These files contains integers as well  
floats.

If I write a stand-alone c++ program with a line like

   ....
   cout << "x: " cel.GetIndexToX(1) << " intensity: " <<  
cel.GetIntensity(1) << endl;
   ....

(here cel is pointing to a specific file while GetIndexToX returns an  
integer (in what is essentially the first row), while GetIntensity  
returns a float), it works fine: the two numbers are printed to stdout.

If I instead embed the code inside R like

extern "C" {
    ....
    Rprintf("x: %d intensity: %f", cel.GetIndexToX(1),  
cel.GetIntensity(1)):
   ...
}

and do a R CMD INSTALL, I am able to read the integer from the file,  
but not the float. The float always returns 0.00000. This is very  
strange considering that the code is basically identical in the two  
cases (except for the extern part and inclusion of the R header  
files), and that the integer number is being read perfectly!

I would say that the fact that the stand-alone program works is  
indicating that the C++ library actually works. Further indication  
that this is the case is the fact that our R package works fine on  
Mac G4, Solaris and Windows.

The only real difference I can see is that the amd64 platform is the  
only little-endian 64-bit platform.

My working hypothesis is that the float is being read and then  
truncated.

I am extremely baffled by this. Do anyone have an idea on where I  
should start looking?

System details:

uname -a
Linux shadowfax.berkeley.edu 2.6.12-1-amd64-k8-smp #1 SMP Wed Sep 28  
02:57:49 CEST 2005 x86_64 GNU/Linux

gcc --version
gcc (GCC) 4.0.2 20050808 (prerelease) (Ubuntu 4.0.1-4ubuntu9)

R is version 2.2.1 build using a standard ./configure, make step.


/Kasper


From p.dalgaard at biostat.ku.dk  Sun Apr 16 12:23:07 2006
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: 16 Apr 2006 12:23:07 +0200
Subject: [Rd] Crash in de()
In-Reply-To: <1145147423.5861.11.camel@localhost.localdomain>
References: <1145147423.5861.11.camel@localhost.localdomain>
Message-ID: <x2vet96cqc.fsf@turmalin.kubism.ku.dk>

Juan Santiago Ramseyer <juan_sr at uol.com.br> writes:

> SYSTEM:
> ------
> 	CPU: AMD64
> 	MOTHERBOARD: ASUS 
> 	OS: FEDORA CORE 5 i64_86
> 
> R SESSION:
> ----------
> > teste<-list(a=c(1,2,3,4),b=c(2,4,6,8))
> > teste
> $a
> [1] 1 2 3 4
> 
> $b
> [1] 2 4 6 8
> 
> > de(teste)
> *** buffer overflow detected ***: /usr/lib64/R/bin/exec/R terminated

Yes, I see this too with the Fedora Extras 5 RPM on i386. 

Things like data.entry(airquality) are equally broken. 

However: It's not happening for me with a current source-compiled
r-devel, nor with 2.3.0beta, so it seems like it might be a packaging
error.

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From ripley at stats.ox.ac.uk  Sun Apr 16 13:11:32 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sun, 16 Apr 2006 12:11:32 +0100 (BST)
Subject: [Rd] c++ code on amd64
In-Reply-To: <EA2A797B-2427-4777-BD91-2E7217FCD318@stat.berkeley.edu>
References: <EA2A797B-2427-4777-BD91-2E7217FCD318@stat.berkeley.edu>
Message-ID: <Pine.LNX.4.64.0604161151270.7975@gannet.stats.ox.ac.uk>

You mention 'float' repeatedly.  A %f argument in Rprintf (and printf) 
refers to a _double_.  Given how little you have shown us it has to be 
entirely guesswork, but is cel.GetIntensity(1) perhaps a float?  If so 
what happens is I believe undefined and compiler-specific.  (Normally 
headers force conversions, but not for variable-argument-list functions.)

On Sun, 16 Apr 2006, Kasper Daniel Hansen wrote:

> Hi
>
> Brief synopsis:
>
> I am having a rather peculiar problem regarding a C++ library. It
> seems that functions from this library behave differently when
> compiled using R as opposed to being compiled directly from the
> command line. The problem is only seen on the amd64 platform (using
> gcc 4.0.2) and not on either of Solaris (both 32 bit and 64 bit), Mac
> OS and Windows.
>
> A bit more detail:
>
> Basically the c++ library contains a class and methods for parsing
> text files in specific formats. These files contains integers as well
> floats.
>
> If I write a stand-alone c++ program with a line like
>
>   ....
>   cout << "x: " cel.GetIndexToX(1) << " intensity: " <<
> cel.GetIntensity(1) << endl;
>   ....
>
> (here cel is pointing to a specific file while GetIndexToX returns an
> integer (in what is essentially the first row), while GetIntensity
> returns a float), it works fine: the two numbers are printed to stdout.
>
> If I instead embed the code inside R like
>
> extern "C" {
>    ....
>    Rprintf("x: %d intensity: %f", cel.GetIndexToX(1),
> cel.GetIntensity(1)):
>   ...
> }
>
> and do a R CMD INSTALL, I am able to read the integer from the file,
> but not the float. The float always returns 0.00000. This is very
> strange considering that the code is basically identical in the two
> cases (except for the extern part and inclusion of the R header
> files), and that the integer number is being read perfectly!
>
> I would say that the fact that the stand-alone program works is
> indicating that the C++ library actually works. Further indication
> that this is the case is the fact that our R package works fine on
> Mac G4, Solaris and Windows.
>
> The only real difference I can see is that the amd64 platform is the
> only little-endian 64-bit platform.
>
> My working hypothesis is that the float is being read and then
> truncated.
>
> I am extremely baffled by this. Do anyone have an idea on where I
> should start looking?
>
> System details:
>
> uname -a
> Linux shadowfax.berkeley.edu 2.6.12-1-amd64-k8-smp #1 SMP Wed Sep 28
> 02:57:49 CEST 2005 x86_64 GNU/Linux
>
> gcc --version
> gcc (GCC) 4.0.2 20050808 (prerelease) (Ubuntu 4.0.1-4ubuntu9)
>
> R is version 2.2.1 build using a standard ./configure, make step.
>
>
> /Kasper
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From khansen at stat.Berkeley.EDU  Sun Apr 16 22:03:18 2006
From: khansen at stat.Berkeley.EDU (Kasper Daniel Hansen)
Date: Sun, 16 Apr 2006 13:03:18 -0700
Subject: [Rd] c++ code on amd64
In-Reply-To: <Pine.LNX.4.64.0604161151270.7975@gannet.stats.ox.ac.uk>
References: <EA2A797B-2427-4777-BD91-2E7217FCD318@stat.berkeley.edu>
	<Pine.LNX.4.64.0604161151270.7975@gannet.stats.ox.ac.uk>
Message-ID: <DB817703-6CF6-4E67-A3C9-AD1EE7D435F2@stat.Berkeley.EDU>

Prof Ripley (and others):

Thank you very much for the idea of the casting problems inside  
Rprintf. Unfortunately that did not work. I have now trimmed  
everything to a simple example, see below.

The cel methods are indeed defined as floats respectively integers like

class FusionCELData
{
   public:
   int IndexToX(int index);
   float GetIntensity(int index);
}

(the entire header is below).

Given that the idea of casting from float to double is undefined in  
Rprintf, I tried to do an explicit casting outside of the Rprintf  
statement, like
   double iTest = static_cast<double>(cel.GetIntensity(1))
and then printing
   Rprintf("Intensity: %f", iTest);
That did not work.

In the sake of completeness, below are the two source files I use and  
the header the FusionCELData class.

Any other ideas? I do have a Makevars file in my package (which  
basically contains the various cpp files from the library (the exists  
in a sub directory of src) as well as include paths for the headers.  
I also use a Makefile (named _Makefile to avoid problems with R) to  
compile the stand alone c++ application, but to my eyes, the makefile  
is very standard. So I do not think the problem is in either of the two.

Again, this is very bewildering given that it works on other  
platforms and the code (to my eyes) is very simple.

/Kasper


Stand-along C++ program, compiled from the command line

#include "FusionCELData.h"
#include <iostream>

using namespace std;
using namespace affymetrix_fusion_io;

int main(int argc, char **argv)
{
   const char* celFileName = argv[1];
   FusionCELData cel;
   cel.SetFileName(celFileName);
   if (cel.Read() == false)
     {
       cout << "Failed to read the file." << endl;
       return 0;
     }
   cout << "X: " << cel.IndexToX(1) << ", Intensity: " <<  
cel.GetIntensity(1)
        << endl;
   double iTest, xTest;
   iTest = static_cast<double>(cel.GetIntensity(1));
   xTest = static_cast<double>(cel.IndexToX(1));
   cout << "X as double: " << xTest << ", Intensity as double: " <<  
iTest
        << endl;
   return 0;
}

Output:

X: 1, Intensity: -17953
X as double: 1, Intensity as double: -17953

C++ code embedded in R:

#include "FusionCELData.h"
#include <iostream>
#include "R_affx_constants.h"

using namespace std;
using namespace affymetrix_fusion_io;

extern "C" {
   #include <R.h>
   #include <Rdefines.h>
   #include <wchar.h>
   #include <wctype.h>

   SEXP R_affx_test(SEXP fname)
   {
     FusionCELData cel;
     char* celFileName         = CHAR(STRING_ELT(fname,0));
     cel.SetFileName(celFileName);
     if (cel.Read(true) == false) {
       Rprintf("Unable to read file: %s\n", celFileName);
       return R_NilValue;
     }

     Rprintf("X: %d, Intensity: %f\n", cel.IndexToX(1),  
cel.GetIntensity(1));
     double iTest, xTest;
     iTest = static_cast<double>(cel.GetIntensity(1));
     xTest = static_cast<double>(cel.IndexToX(1));
     Rprintf("X as double: %f, Intensity as double: %f\n", xTest,  
iTest);
     return R_NilValue;
   }
} /* end extern "C" */

Output from R:

 > library(affxparser)
 > .Call("R_affx_test", "LatSq1.CEL")
X: 1, Intensity: 0.000000
X as double: 1.000000, Intensity as double: 0.000000

Header of FusionCELData:

class FusionCELData
{
public:
	/*! CEL file reading states */
	enum
	{
		CEL_ALL=1,
		CEL_DATA=2,
		CEL_OUTLIER=4,
		CEL_MASK=8
	};

public:
	/*! Constructor */
	FusionCELData();
	/*! Destructor */
	~FusionCELData();

public:
	/*! Set the file name.
	 *	@ value The file name.  Can have the full path or relative path
	 */
	void SetFileName(const char *value);

	/*! Get the file name.
	 *	@return File name
	 */
	std::string GetFileName() const;

	/*! Get the id of the file (only valid for Command Console "calvin"  
files)
	 * @return The unique file id.
	 */
	affymetrix_calvin_utilities::AffymetrixGuidType GetFileId() const;

	/*! Set the error string.
	 * @param value The error.
	 */
	void SetError(const wchar_t* value);

	/*! Retrieve error string
	 *  @return	Error string
	 */
	std::wstring GetError();

	/*! Accessors for header information. */
	std::wstring GetHeaderKey(const wchar_t* key);

	/*! Retrieve CEL file format version number.
	 *  @return CEL file format version number
	 */
	int GetVersion();

	/*!  Retrieve number of columns in array
	 *  @return Number of columns in array
	 */
	int GetCols();

	/*!	Retrieve number of rows in array
	 *	@return Number of rows in array
	 */
	int GetRows();

	/*! Retrieve number of cells in array
	 *	@return Number of cells in array
	 */
	int GetNumCells();

	/*!	Retrieve header in a single string
	 *	@return Header string
	 */
	std::wstring GetHeader();

	/*!	Retrieve algorithm name
	 *	@return Algorithm name
	 */
	std::wstring GetAlg();

	/*! Retrieve algorithm parameters
	 *  @return	Algorithm parameters
	 */
	std::wstring GetParams();

	/*!	Retrieve algorithm parameter of specified tag
	 *	@param tag Algorithm parameter tag
	 *	@return Algorithm parameter value
	 */
	std::wstring GetAlgorithmParameter(const wchar_t *tag);

	/*! Retrieves the algorithm parameter name (tag) for a given index  
position.
	 *	@param index The zero based index to the parameter array (0 to  
the number of alg parameters - 1).
	 *	@return The parameter name (tag).
	 */
	std::wstring GetAlgorithmParameterTag(int index);

	/*! Retrieves the number of algorithm parameters.
	 *	@return The number of algorithm parameters.
	 */
	int GetNumberAlgorithmParameters();

	/*! Retrieve algorithm parameters
	 *	@return Algorithm parameters
	 */
	std::wstring GetAlgorithmParameters();

	/*! Retreive the algorithm parameters in a list.
	 *	@return An STL list of algorithm parameters
	 */
	FusionTagValuePairTypeList &GetParameters();

	/*! Get the DatHeader string.
	 *	@return The DatHeader string.
	 */
	virtual std::wstring GetDatHeader();

	/*!	Retrieve chip type
	 *	@return	Chip type
	 */
	std::wstring GetChipType();

	/*!	Retrieve cell margin
	 *	@return Cell margin
	 */
	int GetCellMargin();

	/*!	Retrieve number of outliers
	 *	@return Number of outliers
	 */
	unsigned int GetNumOutliers();

	/*!	Retrieve number of masked cells
	 *	@return Number of masked cells
	 */
	unsigned int GetNumMasked();

	/*! Get the grid coordinates.
	 *  @return Returns the grid coordinates.
	 */
	FGridCoords GetGridCorners();

	// Index/position conversions
	/*!	Get x coordinates from index
	 *  @return X coordinates
	 */
	int IndexToX(int index);

	/*!	Get y coordinates from index
	 *	@return Y coordinates
	 */
	int IndexToY(int index);

	/*!	Convert x, y coordinates to index
	 *	@return Index
	 */
	int XYToIndex(int x, int y);

	/*! Maps X/Y coordinates to CEL file index.
	 * @param x The x coordinate.
	 * @param y The y coordinate.
	 * @param r The number of rows.
	 * @param c The number of columns.
	 * @return The index to the intensity arrays.
	 */
	static int XYToIndex(int x, int y, int r, int c)
	{
		return ((y*c) + x);
	}

	// Accessors for intensity information.

	/*! Retrieve a CEL file entry.
	 * @param index The index to the CEL file entries.
	 * @param entry The CEL file entry.
	 */
	void GetEntry(int index, FusionCELFileEntryType &entry);

	/*! Retrieve a CEL file entry.
	 * @param x The X coordinate.
	 * @param y The Y coordinate.
	 * @param entry The CEL file entry.
	 */
	void GetEntry(int x, int y, FusionCELFileEntryType &entry);

	/*! Retrieve a CEL file intensity.
	 * @param index The index to the CEL file entries.
	 * @return The CEL file intensity.
	 */
	float GetIntensity(int index);

	/*! Retrieve a CEL file intensity.
	 * @param x The X coordinate.
	 * @param y The Y coordinate.
	 * @return The CEL file intensity.
	 */
	float GetIntensity(int x, int y);

	/*! Retrieve a CEL file stdv value.
	 * @param index The index to the CEL file entries.
	 * @return The CEL file stdv value.
	 */
	float GetStdv(int index);

	/*! Retrieve a CEL file stdv value.
	 * @param x The X coordinate.
	 * @param y The Y coordinate.
	 * @return The CEL file stdv value.
	 */
	float GetStdv(int x, int y);

	/*! Retrieve a CEL file pixel count.
	 * @param index The index to the CEL file entries.
	 * @return The CEL file pixel count.
	 */
	short GetPixels(int index);

	/*! Retrieve a CEL file pixel count.
	 * @param x The X coordinate.
	 * @param y The Y coordinate.
	 * @return The CEL file pixel count.
	 */
	short GetPixels(int x, int y);

	// Accessors for the mask/outlier flags
	/*! Retrieve a CEL file mask flag.
	 * @param x The X coordinate.
	 * @param y The Y coordinate.
	 * @return True if the feature is masked.
	 */
	bool IsMasked(int x, int y);

	/*! Retrieve a CEL file mask flag.
	 * @param index The index to the CEL file entries.
	 * @return True if the feature is masked.
	 */
	bool IsMasked(int index);

	/*! Retrieve a CEL file outlier flag.
	 * @param x The X coordinate.
	 * @param y The Y coordinate.
	 * @return True if the feature is an outlier.
	 */
	bool IsOutlier(int x, int y);

	/*! Retrieve a CEL file outlier flag.
	 * @param index The index to the CEL file entries.
	 * @return True if the feature is an outlier.
	 */
	bool IsOutlier(int index);

	// For reading a file.
	/*! Closes the file */
	void Close();

	/*! Returns the file size.
	 * @return The file size.
	 */
	unsigned int GetFileSize();

	/*! Check if the file exists.
	 * @return True if the file exists.
	 */
	bool Exists();

	/*! Reads the header of the CEL file.
	 * @return True if successful.
	 */
	bool ReadHeader();

	/*! Reads the CEL file.
	 * @param bIncludeMaskAndOutliers Flag to indicate if the mask and  
outlier sections should also be read.
	 * @return True if successful.
	 */
	bool Read(bool bIncludeMaskAndOutliers=true);

	/*! Determine CEL file format and call appropriate function to read  
file using the specified file name.
	 * @param filename The name of the file.
	 * @param state Reading state
	 * @return bool	true if success, false if fail
	 *
	 * \a state can be one or combination of the following values:
	 *       CEL_ALL      Read all information in file (default)
	 *       CEL_DATA     Read header and intensities only
	 *		 CEL_OUTLIER  Read header, intensities and outliers
	 *		 CEL_MASK     Read header, intensities and masked cells
	 */
	bool ReadEx(const char *filename=0, int state=CEL_ALL);

	/*! Returns the reading state.
	 * @return The reading state.
	 */
	int GetReadState();

	// For writing a new CEL file

	/*! Clears the members. */
	void Clear();

	/*! Returns the GenericData object associated with a Calvin file,  
NULL for GCOS files. */
	affymetrix_calvin_io::GenericData *GetGenericData();

protected:
	/*! Factory method to create the appropriate adapter class.
	 *	@exception UnableToOpenFileException
	 */
	void CreateAdapter();

	/*! Delete the adapter member */
	void DeleteAdapter();

	/*! Check the adapter and throw exception if not set
	 *	@exception FileNotOpenException
	 */
	void CheckAdapter() const;

	/*!  */
	void FillParameterList();

private:
	/*! Pointer to the adapter */
	IFusionCELDataAdapter* adapter;
	/*! CEL file name including a relative path or the full path. */
	std::string filename;
	/*! A separate parallel parameter list that is sync'ed with the list  
in the adapter */
	FusionTagValuePairTypeList parameterList;
	/*! Indicates whether the parameter list has been read from the  
adapter */
	bool parameterListRead;
};

}




On Apr 16, 2006, at 4:11 AM, Prof Brian Ripley wrote:

> You mention 'float' repeatedly.  A %f argument in Rprintf (and  
> printf) refers to a _double_.  Given how little you have shown us  
> it has to be entirely guesswork, but is cel.GetIntensity(1) perhaps  
> a float?  If so what happens is I believe undefined and compiler- 
> specific.  (Normally headers force conversions, but not for  
> variable-argument-list functions.)
>
> On Sun, 16 Apr 2006, Kasper Daniel Hansen wrote:
>
>> Hi
>>
>> Brief synopsis:
>>
>> I am having a rather peculiar problem regarding a C++ library. It
>> seems that functions from this library behave differently when
>> compiled using R as opposed to being compiled directly from the
>> command line. The problem is only seen on the amd64 platform (using
>> gcc 4.0.2) and not on either of Solaris (both 32 bit and 64 bit), Mac
>> OS and Windows.
>>
>> A bit more detail:
>>
>> Basically the c++ library contains a class and methods for parsing
>> text files in specific formats. These files contains integers as well
>> floats.
>>
>> If I write a stand-alone c++ program with a line like
>>
>>   ....
>>   cout << "x: " cel.GetIndexToX(1) << " intensity: " <<
>> cel.GetIntensity(1) << endl;
>>   ....
>>
>> (here cel is pointing to a specific file while GetIndexToX returns an
>> integer (in what is essentially the first row), while GetIntensity
>> returns a float), it works fine: the two numbers are printed to  
>> stdout.
>>
>> If I instead embed the code inside R like
>>
>> extern "C" {
>>    ....
>>    Rprintf("x: %d intensity: %f", cel.GetIndexToX(1),
>> cel.GetIntensity(1)):
>>   ...
>> }
>>
>> and do a R CMD INSTALL, I am able to read the integer from the file,
>> but not the float. The float always returns 0.00000. This is very
>> strange considering that the code is basically identical in the two
>> cases (except for the extern part and inclusion of the R header
>> files), and that the integer number is being read perfectly!
>>
>> I would say that the fact that the stand-alone program works is
>> indicating that the C++ library actually works. Further indication
>> that this is the case is the fact that our R package works fine on
>> Mac G4, Solaris and Windows.
>>
>> The only real difference I can see is that the amd64 platform is the
>> only little-endian 64-bit platform.
>>
>> My working hypothesis is that the float is being read and then
>> truncated.
>>
>> I am extremely baffled by this. Do anyone have an idea on where I
>> should start looking?
>>
>> System details:
>>
>> uname -a
>> Linux shadowfax.berkeley.edu 2.6.12-1-amd64-k8-smp #1 SMP Wed Sep 28
>> 02:57:49 CEST 2005 x86_64 GNU/Linux
>>
>> gcc --version
>> gcc (GCC) 4.0.2 20050808 (prerelease) (Ubuntu 4.0.1-4ubuntu9)
>>
>> R is version 2.2.1 build using a standard ./configure, make step.
>>
>>
>> /Kasper
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
>
> -- 
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From thomas.friedrichsmeier at ruhr-uni-bochum.de  Mon Apr 17 03:34:09 2006
From: thomas.friedrichsmeier at ruhr-uni-bochum.de (Thomas Friedrichsmeier)
Date: Mon, 17 Apr 2006 03:34:09 +0200
Subject: [Rd]  Stack checking, core dumps, and embedding R
Message-ID: <200604170334.14003.thomas.friedrichsmeier@ruhr-uni-bochum.de>

Dear R developers,

it seems the stack checking issue with embedded applications is not fully 
resolved, yet. The problem arises, when multiple threads are involved. I.e. 
the case, where R is run in a separate thread of the main application. In 
this case, the call to (unix/system.c)

    R_CStackStart = (uintptr_t) __libc_stack_end;

will set the stack start to the start of the main threads stack, while the 
stack of the thread in which R is running may be entirely different. This 
leads to a bad value of R_CStackStart, and subsequently R_CheckStack () is 
likely to fail for no good reason.
I believe, a more robust solution would be to use

	pthread_attr_t stack_addr;

	pthread_attr_getstackaddr (pthread_self (), &stack_addr);
	R_CStackStart = (uintptr_t) stack_addr;

probably with some #ifdefs around it. Of course that's somewhat ugly as well, 
having to pull in the pthread-library for this purpose.
An easier solution might be to explicitely set

	if (R_running_as_main_program) {
		[...]
	} else {
		R_CStackStart = -1;
	}

and thereby disable stack checking for all embedded cases.
Yet another solution, which I do not understand, why it is not being used 
would be to always use the 
	R_CStackStart = (uintptr_t) &i + (6000 * R_CStackDir);
logic, not just when running as the main program, maybe with a slightly larger 
margin for safety.
Finally, if all these are not desirable, I propose a heuristic check somewhat 
like
	if (abs (R_CStackStart - &i) > 20000) {
		/* Very unlikely we're this far away from the stack start at this
			point in the code. Disable checking */
		R_CStackStart = -1;
	}

Regards
Thomas
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
Url : https://stat.ethz.ch/pipermail/r-devel/attachments/20060417/c54a4a5d/attachment.bin 

From p.dalgaard at biostat.ku.dk  Mon Apr 17 09:37:11 2006
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: 17 Apr 2006 09:37:11 +0200
Subject: [Rd] Crash in de()
In-Reply-To: <x2vet96cqc.fsf@turmalin.kubism.ku.dk>
References: <1145147423.5861.11.camel@localhost.localdomain>
	<x2vet96cqc.fsf@turmalin.kubism.ku.dk>
Message-ID: <x2ejzw3b6g.fsf@turmalin.kubism.ku.dk>

Peter Dalgaard <p.dalgaard at biostat.ku.dk> writes:

> Juan Santiago Ramseyer <juan_sr at uol.com.br> writes:
> 
> > SYSTEM:
> > ------
> > 	CPU: AMD64
> > 	MOTHERBOARD: ASUS 
> > 	OS: FEDORA CORE 5 i64_86
> > 
> > R SESSION:
> > ----------
> > > teste<-list(a=c(1,2,3,4),b=c(2,4,6,8))
> > > teste
> > $a
> > [1] 1 2 3 4
> > 
> > $b
> > [1] 2 4 6 8
> > 
> > > de(teste)
> > *** buffer overflow detected ***: /usr/lib64/R/bin/exec/R terminated
> 
> Yes, I see this too with the Fedora Extras 5 RPM on i386. 
> 
> Things like data.entry(airquality) are equally broken. 
> 
> However: It's not happening for me with a current source-compiled
> r-devel, nor with 2.3.0beta, so it seems like it might be a packaging
> error.

Correction: I *can* reproduce if I use the Fedora CFLAGS settings, i.e.

-O2 -g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions
 -fstack-protector --param=ssp-buffer-size=4 -m32 -march=i386
-mtune=generic -fasynchronous-unwind-tables

Presumably it is the -fstack-protector doing its job and we have a
real bug that just doesn't trigger without it. Will have a look.

(BTW, x<-0; de(x) is sufficient to cause the crash).

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From p.dalgaard at biostat.ku.dk  Mon Apr 17 11:42:12 2006
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: 17 Apr 2006 11:42:12 +0200
Subject: [Rd] Crash in de()
In-Reply-To: <x2ejzw3b6g.fsf@turmalin.kubism.ku.dk>
References: <1145147423.5861.11.camel@localhost.localdomain>
	<x2vet96cqc.fsf@turmalin.kubism.ku.dk>
	<x2ejzw3b6g.fsf@turmalin.kubism.ku.dk>
Message-ID: <x24q0s35e3.fsf@turmalin.kubism.ku.dk>

Peter Dalgaard <p.dalgaard at biostat.ku.dk> writes:

> Peter Dalgaard <p.dalgaard at biostat.ku.dk> writes:
> 
> > Juan Santiago Ramseyer <juan_sr at uol.com.br> writes:
> > 
> > > SYSTEM:
> > > ------
> > > 	CPU: AMD64
> > > 	MOTHERBOARD: ASUS 
> > > 	OS: FEDORA CORE 5 i64_86
> > > 
> > > R SESSION:
> > > ----------
> > > > teste<-list(a=c(1,2,3,4),b=c(2,4,6,8))
> > > > teste
> > > $a
> > > [1] 1 2 3 4
> > > 
> > > $b
> > > [1] 2 4 6 8
> > > 
> > > > de(teste)
> > > *** buffer overflow detected ***: /usr/lib64/R/bin/exec/R terminated
> > 
> > Yes, I see this too with the Fedora Extras 5 RPM on i386. 
> > 
> > Things like data.entry(airquality) are equally broken. 
> > 
> > However: It's not happening for me with a current source-compiled
> > r-devel, nor with 2.3.0beta, so it seems like it might be a packaging
> > error.
> 
> Correction: I *can* reproduce if I use the Fedora CFLAGS settings, i.e.
> 
> -O2 -g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions
>  -fstack-protector --param=ssp-buffer-size=4 -m32 -march=i386
> -mtune=generic -fasynchronous-unwind-tables
> 
> Presumably it is the -fstack-protector doing its job and we have a
> real bug that just doesn't trigger without it. Will have a look.
> 
> (BTW, x<-0; de(x) is sufficient to cause the crash).

OK, got it. The printstring() function in dataentry.c had three
instances like

cnt=wcsrtombs(s,(const wchar_t **)&w_p,sizeof(wcs),NULL);

s has length BOOSTED_BUF_SIZE==201 and sizeof(wcs)==804; the third
argument is documented to limit the number of bytes copied _to the
destination_, so that's clearly not right. Apparently, the check is
preemptive since the actual strings involved are nowhere near the
buffer limits. Replacing the 3rd argument with BOOSTED_BUF_SIZE-1
seems to do the trick.

Will fix for tomorrows 2.3.0 RC (we're in code freeze, but I think
this counts as a critical as well as trivial fix).

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From thomas.friedrichsmeier at ruhr-uni-bochum.de  Mon Apr 17 15:20:46 2006
From: thomas.friedrichsmeier at ruhr-uni-bochum.de (Thomas Friedrichsmeier)
Date: Mon, 17 Apr 2006 15:20:46 +0200
Subject: [Rd] Stack checking, core dumps, and embedding R
In-Reply-To: <200604170334.14003.thomas.friedrichsmeier@ruhr-uni-bochum.de>
References: <200604170334.14003.thomas.friedrichsmeier@ruhr-uni-bochum.de>
Message-ID: <200604171520.51565.thomas.friedrichsmeier@ruhr-uni-bochum.de>

Excuse me please, for being impatient, but I'm worried this issue may not be 
considered important enough to be fixed in R 2.3.0 at this late point of 
time. So let me re-state this:

In the current state, R will *not work at all* when run in a thread on linux.

I do not know how many embedding applications run R in a separate thread, and 
are affected by this. I know that at least rkward does, and it will not run.

Reconsidering the proposals I made yesterday, after some sleep, let me propose 
this corrected fix (insert into src/unix/system.c, at line 179, right 
above "if(R_CStackStart == -1) R_CStackLimit = -1; /* never set */"):

    if (abs (R_CStackStart - (uintptr_t) &i) > 20000) {
	/* Very unlikely we're this far away from the stack start at this
	point in the code. Disable checking */
	R_CStackStart = -1;
    }

For all I care, set the safety margin to 50000 or even more. This heuristic is 
only meant to catch cases where the detected value for R_CStackStart is 
*obviously wrong*, most importantly in case of threads.

In this case all it will do is to disable the check. I can see no other 
side-effect.

Once again, excuse me for being impatient, but *please* consider this for 
inclusion in R 2.3.0.

Regards
Thomas
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
Url : https://stat.ethz.ch/pipermail/r-devel/attachments/20060417/b45bd4b3/attachment.bin 

From pgilbert at bank-banque-canada.ca  Mon Apr 17 15:18:52 2006
From: pgilbert at bank-banque-canada.ca (Paul Gilbert)
Date: Mon, 17 Apr 2006 09:18:52 -0400
Subject: [Rd] slot named C
Message-ID: <444395BC.5020108@bank-banque-canada.ca>

"C" appears to be an illegal name for a slot in an S4 class (example 
below). If this is a known limitation, and not a bug, it would be nice 
if it were caught by setClass.

Paul Gilbert

 > setClass("testobj", representation ( C = "numeric"))
[1] "testobj"
 > new("testobj", C= 2)
Error in methodsPackageMetaName("C", name) :
        'The name of the object (e.g,. a class or generic function) to 
find in the meta-data' must be a single string (got an object of class 
"numeric")

 > setClass("testobj", representation ( C. = "numeric"))
[1] "testobj"
 > new("testobj", C.= 2)
An object of class "testobj"
Slot "C.":
[1] 2
====================================================================================

La version fran?aise suit le texte anglais.

------------------------------------------------------------------------------------

This email may contain privileged and/or confidential inform...{{dropped}}


From ripley at stats.ox.ac.uk  Mon Apr 17 15:56:59 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 17 Apr 2006 14:56:59 +0100 (BST)
Subject: [Rd] slot named C
In-Reply-To: <444395BC.5020108@bank-banque-canada.ca>
References: <444395BC.5020108@bank-banque-canada.ca>
Message-ID: <Pine.LNX.4.64.0604171446130.3487@gannet.stats.ox.ac.uk>

It's an error in your usage  The args of new() are

> args(new)
function (Class, ...)

and what does 'C' match?  You need to name your arguments here.

On Mon, 17 Apr 2006, Paul Gilbert wrote:

> "C" appears to be an illegal name for a slot in an S4 class (example
> below).

It is rather an example of something which does not work.

foo <- new("testobj")
foo at C <- 2

does, for example.

> If this is a known limitation, and not a bug, it would be nice
> if it were caught by setClass.
>
> Paul Gilbert
>
> > setClass("testobj", representation ( C = "numeric"))
> [1] "testobj"
> > new("testobj", C= 2)
> Error in methodsPackageMetaName("C", name) :
>        'The name of the object (e.g,. a class or generic function) to
> find in the meta-data' must be a single string (got an object of class
> "numeric")
>
> > setClass("testobj", representation ( C. = "numeric"))
> [1] "testobj"
> > new("testobj", C.= 2)
> An object of class "testobj"
> Slot "C.":
> [1] 2
> ====================================================================================
>
> La version fran?aise suit le texte anglais.
>
> ------------------------------------------------------------------------------------
>
> This email may contain privileged and/or confidential inform...{{dropped}}
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From charles.dupont at vanderbilt.edu  Mon Apr 17 16:00:25 2006
From: charles.dupont at vanderbilt.edu (charles.dupont at vanderbilt.edu)
Date: Mon, 17 Apr 2006 16:00:25 +0200 (CEST)
Subject: [Rd] strsplit does not return correct value when spliting ""
	(PR#8777)
Message-ID: <20060417140025.3773A19B32@slim.kubism.ku.dk>

Full_Name: Charles Dupont
Version: 2.2.0
OS: linux
Submission from: (NULL) (160.129.129.136)


when 

strsplit("", " ")

returns character(0)

where as 

strsplit("a", " ")

returns "a".

these return values are not constiant with each other.

Charles Dupont


From pgilbert at bank-banque-canada.ca  Mon Apr 17 16:29:42 2006
From: pgilbert at bank-banque-canada.ca (Paul Gilbert)
Date: Mon, 17 Apr 2006 10:29:42 -0400
Subject: [Rd] slot named C
In-Reply-To: <Pine.LNX.4.64.0604171446130.3487@gannet.stats.ox.ac.uk>
References: <444395BC.5020108@bank-banque-canada.ca>
	<Pine.LNX.4.64.0604171446130.3487@gannet.stats.ox.ac.uk>
Message-ID: <4443A656.4060306@bank-banque-canada.ca>

Ok, but I'm surprised. I thought partial matching only happened for 
named arguments. I guess I've been lucky.

Paul

Prof Brian Ripley wrote:
> It's an error in your usage  The args of new() are
> 
>> args(new)
> function (Class, ...)
> 
> and what does 'C' match?  You need to name your arguments here.
> 
> On Mon, 17 Apr 2006, Paul Gilbert wrote:
> 
>> "C" appears to be an illegal name for a slot in an S4 class (example
>> below).
> 
> It is rather an example of something which does not work.
> 
> foo <- new("testobj")
> foo at C <- 2
> 
> does, for example.
> 
>> If this is a known limitation, and not a bug, it would be nice
>> if it were caught by setClass.
>>
>> Paul Gilbert
>>
>> > setClass("testobj", representation ( C = "numeric"))
>> [1] "testobj"
>> > new("testobj", C= 2)
>> Error in methodsPackageMetaName("C", name) :
>>        'The name of the object (e.g,. a class or generic function) to
>> find in the meta-data' must be a single string (got an object of class
>> "numeric")
>>
>> > setClass("testobj", representation ( C. = "numeric"))
>> [1] "testobj"
>> > new("testobj", C.= 2)
>> An object of class "testobj"
>> Slot "C.":
>> [1] 2
>> ==================================================================================== 
>>
>>
>> La version fran?aise suit le texte anglais.
>>
>> ------------------------------------------------------------------------------------ 
>>
>>
>> This email may contain privileged and/or confidential 
>> inform...{{dropped}}
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
> 
====================================================================================

La version fran?aise suit le texte anglais.

------------------------------------------------------------------------------------

This email may contain privileged and/or confidential inform...{{dropped}}


From ripley at stats.ox.ac.uk  Mon Apr 17 16:39:42 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 17 Apr 2006 15:39:42 +0100 (BST)
Subject: [Rd] slot named C
In-Reply-To: <4443A656.4060306@bank-banque-canada.ca>
References: <444395BC.5020108@bank-banque-canada.ca>
	<Pine.LNX.4.64.0604171446130.3487@gannet.stats.ox.ac.uk>
	<4443A656.4060306@bank-banque-canada.ca>
Message-ID: <Pine.LNX.4.64.0604171536450.5712@gannet.stats.ox.ac.uk>

On Mon, 17 Apr 2006, Paul Gilbert wrote:

> Ok, but I'm surprised. I thought partial matching only happened for
> named arguments. I guess I've been lucky.

Here C is named, so what did you mean?

Partial matching happens for all arguments called by name, except for 
those following ... in the formals.

>
> Paul
>
> Prof Brian Ripley wrote:
>> It's an error in your usage  The args of new() are
>>
>>> args(new)
>> function (Class, ...)
>>
>> and what does 'C' match?  You need to name your arguments here.
>>
>> On Mon, 17 Apr 2006, Paul Gilbert wrote:
>>
>>> "C" appears to be an illegal name for a slot in an S4 class (example
>>> below).
>>
>> It is rather an example of something which does not work.
>>
>> foo <- new("testobj")
>> foo at C <- 2
>>
>> does, for example.
>>
>>> If this is a known limitation, and not a bug, it would be nice
>>> if it were caught by setClass.
>>>
>>> Paul Gilbert
>>>
>>>> setClass("testobj", representation ( C = "numeric"))
>>> [1] "testobj"
>>>> new("testobj", C= 2)
>>> Error in methodsPackageMetaName("C", name) :
>>>        'The name of the object (e.g,. a class or generic function) to
>>> find in the meta-data' must be a single string (got an object of class
>>> "numeric")
>>>
>>>> setClass("testobj", representation ( C. = "numeric"))
>>> [1] "testobj"
>>>> new("testobj", C.= 2)
>>> An object of class "testobj"
>>> Slot "C.":
>>> [1] 2
>>> ====================================================================================
>>>
>>>
>>> La version fran?aise suit le texte anglais.
>>>
>>> ------------------------------------------------------------------------------------
>>>
>>>
>>> This email may contain privileged and/or confidential
>>> inform...{{dropped}}
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>>
>>
> ====================================================================================
>
> La version fran?aise suit le texte anglais.
>
> ------------------------------------------------------------------------------------
>
> This email may contain privileged and/or confidential inform...{{dropped}}
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From ripley at stats.ox.ac.uk  Mon Apr 17 16:48:42 2006
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Mon, 17 Apr 2006 16:48:42 +0200 (CEST)
Subject: [Rd] (PR#8777) strsplit does [not] return correct value when
Message-ID: <20060417144842.5BE3219B38@slim.kubism.ku.dk>

Please use a current version of R: we are at 2.3.0RC (and we do ask you 
not to report on obselete versions).

What rule are you using, and where did you find it in the R documentation?

In fact

> strsplit("", " ")
[[1]]
character(0)

which is not as you stated.   This is a feature, as it distinct from

> strsplit(" ", " ")
[[1]]
[1] ""

Consider also

> strsplit("", "")
[[1]]
character(0)

> strsplit("a", "")
[[1]]
[1] "a"

> strsplit("ab", "")
[[1]]
[1] "a" "b"


On Mon, 17 Apr 2006, charles.dupont at vanderbilt.edu wrote:

> Full_Name: Charles Dupont
> Version: 2.2.0
> OS: linux
> Submission from: (NULL) (160.129.129.136)
>
>
> when
>
> strsplit("", " ")
>
> returns character(0)
>
> where as
>
> strsplit("a", " ")
>
> returns "a".
>
> these return values are not constiant with each other.
>
> Charles Dupont
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From pgilbert at bank-banque-canada.ca  Mon Apr 17 16:55:53 2006
From: pgilbert at bank-banque-canada.ca (Paul Gilbert)
Date: Mon, 17 Apr 2006 10:55:53 -0400
Subject: [Rd] slot named C
In-Reply-To: <Pine.LNX.4.64.0604171536450.5712@gannet.stats.ox.ac.uk>
References: <444395BC.5020108@bank-banque-canada.ca>
	<Pine.LNX.4.64.0604171446130.3487@gannet.stats.ox.ac.uk>
	<4443A656.4060306@bank-banque-canada.ca>
	<Pine.LNX.4.64.0604171536450.5712@gannet.stats.ox.ac.uk>
Message-ID: <4443AC79.9080801@bank-banque-canada.ca>



Prof Brian Ripley wrote:
> On Mon, 17 Apr 2006, Paul Gilbert wrote:
> 
>> Ok, but I'm surprised. I thought partial matching only happened for
>> named arguments. I guess I've been lucky.
> 
> Here C is named, so what did you mean?

Now I guess I've really been confused. I thought named arguments in a 
function were the optional ones you named when you define the function 
(with name=default, so Class is not a named argument in the call to 
new). Are you saying the named arguments are the ones you name when you 
call the function?

Paul
> 
> Partial matching happens for all arguments called by name, except for 
> those following ... in the formals.
> 
>>
>> Paul
>>
>> Prof Brian Ripley wrote:
>>> It's an error in your usage  The args of new() are
>>>
>>>> args(new)
>>> function (Class, ...)
>>>
>>> and what does 'C' match?  You need to name your arguments here.
>>>
>>> On Mon, 17 Apr 2006, Paul Gilbert wrote:
>>>
>>>> "C" appears to be an illegal name for a slot in an S4 class (example
>>>> below).
>>>
>>> It is rather an example of something which does not work.
>>>
>>> foo <- new("testobj")
>>> foo at C <- 2
>>>
>>> does, for example.
>>>
>>>> If this is a known limitation, and not a bug, it would be nice
>>>> if it were caught by setClass.
>>>>
>>>> Paul Gilbert
>>>>
>>>>> setClass("testobj", representation ( C = "numeric"))
>>>> [1] "testobj"
>>>>> new("testobj", C= 2)
>>>> Error in methodsPackageMetaName("C", name) :
>>>>        'The name of the object (e.g,. a class or generic function) to
>>>> find in the meta-data' must be a single string (got an object of class
>>>> "numeric")
>>>>
>>>>> setClass("testobj", representation ( C. = "numeric"))
>>>> [1] "testobj"
>>>>> new("testobj", C.= 2)
>>>> An object of class "testobj"
>>>> Slot "C.":
>>>> [1] 2
>>>> ==================================================================================== 
>>>>
>>>>
>>>>
>>>> La version fran?aise suit le texte anglais.
>>>>
>>>> ------------------------------------------------------------------------------------ 
>>>>
>>>>
>>>>
>>>> This email may contain privileged and/or confidential
>>>> inform...{{dropped}}
>>>>
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>
>>>>
>>>
>> ==================================================================================== 
>>
>>
>> La version fran?aise suit le texte anglais.
>>
>> ------------------------------------------------------------------------------------ 
>>
>>
>> This email may contain privileged and/or confidential 
>> inform...{{dropped}}
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
> 
====================================================================================

La version fran?aise suit le texte anglais.

------------------------------------------------------------------------------------

This email may contain privileged and/or confidential inform...{{dropped}}


From ripley at stats.ox.ac.uk  Mon Apr 17 17:09:42 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 17 Apr 2006 16:09:42 +0100 (BST)
Subject: [Rd] slot named C
In-Reply-To: <4443AC79.9080801@bank-banque-canada.ca>
References: <444395BC.5020108@bank-banque-canada.ca>
	<Pine.LNX.4.64.0604171446130.3487@gannet.stats.ox.ac.uk>
	<4443A656.4060306@bank-banque-canada.ca>
	<Pine.LNX.4.64.0604171536450.5712@gannet.stats.ox.ac.uk>
	<4443AC79.9080801@bank-banque-canada.ca>
Message-ID: <Pine.LNX.4.64.0604171605410.6595@gannet.stats.ox.ac.uk>

On Mon, 17 Apr 2006, Paul Gilbert wrote:

>
>
> Prof Brian Ripley wrote:
>> On Mon, 17 Apr 2006, Paul Gilbert wrote:
>>
>>> Ok, but I'm surprised. I thought partial matching only happened for
>>> named arguments. I guess I've been lucky.
>>
>> Here C is named, so what did you mean?
>
> Now I guess I've really been confused. I thought named arguments in a
> function were the optional ones you named when you define the function
> (with name=default, so Class is not a named argument in the call to

All formal arguments _are_ named.  Some have defaults.  So the allowed 
forms are

name
name=default

> new). Are you saying the named arguments are the ones you name when you
> call the function?

That's the standard usage.  See the Blue Book pp.37-8 (and I reckon that 
the posting guide asked you to look that up for yourself: so please 
re-read it).

>
> Paul
>>
>> Partial matching happens for all arguments called by name, except for
>> those following ... in the formals.
>>
>>>
>>> Paul
>>>
>>> Prof Brian Ripley wrote:
>>>> It's an error in your usage  The args of new() are
>>>>
>>>>> args(new)
>>>> function (Class, ...)
>>>>
>>>> and what does 'C' match?  You need to name your arguments here.
>>>>
>>>> On Mon, 17 Apr 2006, Paul Gilbert wrote:
>>>>
>>>>> "C" appears to be an illegal name for a slot in an S4 class (example
>>>>> below).
>>>>
>>>> It is rather an example of something which does not work.
>>>>
>>>> foo <- new("testobj")
>>>> foo at C <- 2
>>>>
>>>> does, for example.
>>>>
>>>>> If this is a known limitation, and not a bug, it would be nice
>>>>> if it were caught by setClass.
>>>>>
>>>>> Paul Gilbert
>>>>>
>>>>>> setClass("testobj", representation ( C = "numeric"))
>>>>> [1] "testobj"
>>>>>> new("testobj", C= 2)
>>>>> Error in methodsPackageMetaName("C", name) :
>>>>>        'The name of the object (e.g,. a class or generic function) to
>>>>> find in the meta-data' must be a single string (got an object of class
>>>>> "numeric")
>>>>>
>>>>>> setClass("testobj", representation ( C. = "numeric"))
>>>>> [1] "testobj"
>>>>>> new("testobj", C.= 2)
>>>>> An object of class "testobj"
>>>>> Slot "C.":
>>>>> [1] 2
>>>>> ====================================================================================
>>>>>
>>>>>
>>>>>
>>>>> La version fran?aise suit le texte anglais.
>>>>>
>>>>> ------------------------------------------------------------------------------------
>>>>>
>>>>>
>>>>>
>>>>> This email may contain privileged and/or confidential
>>>>> inform...{{dropped}}
>>>>>
>>>>> ______________________________________________
>>>>> R-devel at r-project.org mailing list
>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>>
>>>>>
>>>>
>>> ====================================================================================
>>>
>>>
>>> La version fran?aise suit le texte anglais.
>>>
>>> ------------------------------------------------------------------------------------
>>>
>>>
>>> This email may contain privileged and/or confidential
>>> inform...{{dropped}}
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>>
>>
> ====================================================================================
>
> La version fran?aise suit le texte anglais.
>
> ------------------------------------------------------------------------------------
>
> This email may contain privileged and/or confidential inform...{{dropped}}
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From macq at llnl.gov  Mon Apr 17 17:25:41 2006
From: macq at llnl.gov (Don MacQueen)
Date: Mon, 17 Apr 2006 08:25:41 -0700
Subject: [Rd] row.names in data.frame
In-Reply-To: <Pine.LNX.4.64.0604141959160.3266@gannet.stats.ox.ac.uk>
References: <Pine.LNX.4.64.0604141959160.3266@gannet.stats.ox.ac.uk>
Message-ID: <p06230901c0695e8b8d77@[192.168.2.7]>

This looks like a good proposal to me, from an end-user's point of view.

I have, from time to time, wished I could set row names to NULL. Not 
for performance reasons, but because some aspect of my data, in 
combination with how R handles row names, was requiring me to 
explicitly manage them in situations where I was otherwise making no 
use of them. Admittedly, some of these occasions were quite a few R 
versions ago, when row names were not as carefully managed by R 
itself as they are now.

Potential ramifications are not immediately obvious to me, but for 
example, will rbind() of two data frames, both of which have been 
assigned NULL row names, result in a data frame with NULL row names? 
(Would it matter?) What about one with NULL row names and one with 
non-NULL row names?

-Don

At 8:29 PM +0100 4/14/06, Prof Brian Ripley wrote:
>We know from the White Book p.57 that the row names of a data frame `are
>never NULL and must be unique'.  R documents that row.names() returns a
>character vector, and in R (much more so than on S) a long character
>vector of short unique strings is expensive to store (I saw 72 bytes/row
>on a 64-bit machine for 1:1e6).  [Incidentally, in the White Book the
>index page nos are all off by one for this item, and commonly elsewhere.
>It seems to be LaTeX indexing the page on which a para finishes.]
>
>Last time this came up Martin Maechler asked if we could not do it more
>efficiently, and reminded us recently.  It would be fairly easy if
>everyone used the row.names() and row.names<-() accessor functions, but
>some packages (notably Design and Hmisc) access the attribute "row.names"
>directly (and what that is seems to be undocumented).
>
>I noticed that the White Book does not appear to say that the row names
>are character, and indeed says
>
>    'If all else fails the row names are just the row numbers.'
>
>and it seems the author of expand.grid() took that literally, for it used
>to assign integers to the row names.  However, the current S-PLUS help for
>both row.names and data.frame say row names are a character vector (and
>that row.names<-() coerces to character).
>
>We can certainly differentiate between the internal representation and the
>the result of row.names().  Here is my idea:
>
>1) The internal representation is either NULL, an integer vector or a
>character vector.
>
>2) attr(x, "row.names") will always return either an integer vector or a
>character vector, using 1:nrow(x) if the internal representation is NULL.
>
>3) row.names() will always return as.character(attr(x, "row.names)).
>
>4) attr<- and row.names<- can set NULL, integer or character.
>
>5) Row-indexing a data frame with NULL or integer representation will give
>an integer representation.
>
>This would appear to be completely back-compatible for those who only work
>via the accessor functions, and probably work with almost all package code
>that manipulates attributes directly.  Since the changes can be done
>almost entirely in C code, the performance hit should be negliglible.
>
>The benefits will probably only be appreciable with `tall and skinny'
>data frames, as even 72 bytes per row is only going to buy you 9 numeric
>columns.  But that is it seems a common enough case to make this
>worthwhile.
>
>This would be a change aimed at 2.4.0, since we would need plenty of time
>both for testing and to alter code to make use of the more efficient
>representations.
>
>BTW, the maximum object length of 2^31 - 1 ensures that an integer
>representation of row numbers suffices.
>
>--
>Brian D. Ripley,                  ripley at stats.ox.ac.uk
>Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
>University of Oxford,             Tel:  +44 1865 272861 (self)
>1 South Parks Road,                     +44 1865 272866 (PA)
>Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>
>______________________________________________
>R-devel at r-project.org mailing list
>https://stat.ethz.ch/mailman/listinfo/r-devel


-- 
---------------------------------
Don MacQueen
Lawrence Livermore National Laboratory
Livermore, CA, USA


From ripley at stats.ox.ac.uk  Mon Apr 17 17:49:21 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 17 Apr 2006 16:49:21 +0100 (BST)
Subject: [Rd] row.names in data.frame
In-Reply-To: <p06230901c0695e8b8d77@[192.168.2.7]>
References: <Pine.LNX.4.64.0604141959160.3266@gannet.stats.ox.ac.uk>
	<p06230901c0695e8b8d77@[192.168.2.7]>
Message-ID: <Pine.LNX.4.64.0604171638560.11478@gannet.stats.ox.ac.uk>

On Mon, 17 Apr 2006, Don MacQueen wrote:

> This looks like a good proposal to me, from an end-user's point of view.
>
> I have, from time to time, wished I could set row names to NULL. Not for 
> performance reasons, but because some aspect of my data, in combination with 
> how R handles row names, was requiring me to explicitly manage them in 
> situations where I was otherwise making no use of them. Admittedly, some of 
> these occasions were quite a few R versions ago, when row names were not as 
> carefully managed by R itself as they are now.
>
> Potential ramifications are not immediately obvious to me, but for example, 
> will rbind() of two data frames, both of which have been assigned NULL row 
> names, result in a data frame with NULL row names? (Would it matter?) What 
> about one with NULL row names and one with non-NULL row names?

In the user's perspective, there are no NULL row.names, only integer or 
character ones.  (It did say *internal representation*.)  If you rbind one 
with integer and one with character, you get character in the result (just 
as you do with c()).  There's actually code there now that is supposed to 
work with 1:m and 1:n and give you 1:(n+m), and that does work with 
integer row.names.

There was a snag with the proposal: zero-column data frames do have a 
number of rows which is found from the row.names.  So rather than encode 
as NULL, 1:n is encoded as c(as.integer(NA), n), but the user will never 
see that.

row.names(a_df) <- NULL sets the row.names to 1:n.

As of a few hours' ago, a test version is in R-devel.  This passes their 
tests with all CRAN packages (somewhat to my surprise, but that may be in 
part be because all existing data frames do have character vector names).

>
> -Don
>
> At 8:29 PM +0100 4/14/06, Prof Brian Ripley wrote:
>> We know from the White Book p.57 that the row names of a data frame `are
>> never NULL and must be unique'.  R documents that row.names() returns a
>> character vector, and in R (much more so than on S) a long character
>> vector of short unique strings is expensive to store (I saw 72 bytes/row
>> on a 64-bit machine for 1:1e6).  [Incidentally, in the White Book the
>> index page nos are all off by one for this item, and commonly elsewhere.
>> It seems to be LaTeX indexing the page on which a para finishes.]
>> 
>> Last time this came up Martin Maechler asked if we could not do it more
>> efficiently, and reminded us recently.  It would be fairly easy if
>> everyone used the row.names() and row.names<-() accessor functions, but
>> some packages (notably Design and Hmisc) access the attribute "row.names"
>> directly (and what that is seems to be undocumented).
>> 
>> I noticed that the White Book does not appear to say that the row names
>> are character, and indeed says
>>
>>    'If all else fails the row names are just the row numbers.'
>> 
>> and it seems the author of expand.grid() took that literally, for it used
>> to assign integers to the row names.  However, the current S-PLUS help for
>> both row.names and data.frame say row names are a character vector (and
>> that row.names<-() coerces to character).
>> 
>> We can certainly differentiate between the internal representation and the
>> the result of row.names().  Here is my idea:
>> 
>> 1) The internal representation is either NULL, an integer vector or a
>> character vector.
>> 
>> 2) attr(x, "row.names") will always return either an integer vector or a
>> character vector, using 1:nrow(x) if the internal representation is NULL.
>> 
>> 3) row.names() will always return as.character(attr(x, "row.names)).
>> 
>> 4) attr<- and row.names<- can set NULL, integer or character.
>> 
>> 5) Row-indexing a data frame with NULL or integer representation will give
>> an integer representation.
>> 
>> This would appear to be completely back-compatible for those who only work
>> via the accessor functions, and probably work with almost all package code
>> that manipulates attributes directly.  Since the changes can be done
>> almost entirely in C code, the performance hit should be negliglible.
>> 
>> The benefits will probably only be appreciable with `tall and skinny'
>> data frames, as even 72 bytes per row is only going to buy you 9 numeric
>> columns.  But that is it seems a common enough case to make this
>> worthwhile.
>> 
>> This would be a change aimed at 2.4.0, since we would need plenty of time
>> both for testing and to alter code to make use of the more efficient
>> representations.
>> 
>> BTW, the maximum object length of 2^31 - 1 ensures that an integer
>> representation of row numbers suffices.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From tlumley at u.washington.edu  Mon Apr 17 17:54:22 2006
From: tlumley at u.washington.edu (Thomas Lumley)
Date: Mon, 17 Apr 2006 08:54:22 -0700 (PDT)
Subject: [Rd] c++ code on amd64
In-Reply-To: <Pine.LNX.4.64.0604161151270.7975@gannet.stats.ox.ac.uk>
References: <EA2A797B-2427-4777-BD91-2E7217FCD318@stat.berkeley.edu>
	<Pine.LNX.4.64.0604161151270.7975@gannet.stats.ox.ac.uk>
Message-ID: <Pine.LNX.4.64.0604170849490.30435@homer24.u.washington.edu>

On Sun, 16 Apr 2006, Prof Brian Ripley wrote:

> You mention 'float' repeatedly.  A %f argument in Rprintf (and printf)
> refers to a _double_.  Given how little you have shown us it has to be
> entirely guesswork, but is cel.GetIntensity(1) perhaps a float?  If so
> what happens is I believe undefined and compiler-specific.  (Normally
> headers force conversions, but not for variable-argument-list functions.)

I don't think so.   The N843 draft of the ISO C standard 
(http://std.dkuug.dk/JTC1/SC22/WG14/www/docs/n843.htm) says
in 6.5.2.2
        [#7]  If the expression that denotes the called function has |
        a type that does include  a  prototype,  the  arguments  are
        implicitly  converted,  as if by assignment, to the types of
        the  corresponding  parameters,  taking  the  type  of  each
        parameter  to  be  the  unqualified  version of its declared
        type.   The  ellipsis  notation  in  a  function   prototype
        declarator causes argument type conversion to stop after the
        last declared parameter.  The  default  argument  promotions
        are performed on trailing arguments.

The "default argument promotions" include promoting float to double. This 
is also what comp.lang.c FAQ 12.9 says: the answer begins

   "It's true that printf's %f specifier works with both float and double
    arguments.Due to the ``default argument promotions'' (which apply in
    variable-length argument lists such as printf's, whether or
    not prototypes are in scope), values of type float are promoted to
    double, and  printf therefore sees only doubles.

I assume this applies to Rprintf as well

 	-thomas


>
> On Sun, 16 Apr 2006, Kasper Daniel Hansen wrote:
>
>> Hi
>>
>> Brief synopsis:
>>
>> I am having a rather peculiar problem regarding a C++ library. It
>> seems that functions from this library behave differently when
>> compiled using R as opposed to being compiled directly from the
>> command line. The problem is only seen on the amd64 platform (using
>> gcc 4.0.2) and not on either of Solaris (both 32 bit and 64 bit), Mac
>> OS and Windows.
>>
>> A bit more detail:
>>
>> Basically the c++ library contains a class and methods for parsing
>> text files in specific formats. These files contains integers as well
>> floats.
>>
>> If I write a stand-alone c++ program with a line like
>>
>>   ....
>>   cout << "x: " cel.GetIndexToX(1) << " intensity: " <<
>> cel.GetIntensity(1) << endl;
>>   ....
>>
>> (here cel is pointing to a specific file while GetIndexToX returns an
>> integer (in what is essentially the first row), while GetIntensity
>> returns a float), it works fine: the two numbers are printed to stdout.
>>
>> If I instead embed the code inside R like
>>
>> extern "C" {
>>    ....
>>    Rprintf("x: %d intensity: %f", cel.GetIndexToX(1),
>> cel.GetIntensity(1)):
>>   ...
>> }
>>
>> and do a R CMD INSTALL, I am able to read the integer from the file,
>> but not the float. The float always returns 0.00000. This is very
>> strange considering that the code is basically identical in the two
>> cases (except for the extern part and inclusion of the R header
>> files), and that the integer number is being read perfectly!
>>
>> I would say that the fact that the stand-alone program works is
>> indicating that the C++ library actually works. Further indication
>> that this is the case is the fact that our R package works fine on
>> Mac G4, Solaris and Windows.
>>
>> The only real difference I can see is that the amd64 platform is the
>> only little-endian 64-bit platform.
>>
>> My working hypothesis is that the float is being read and then
>> truncated.
>>
>> I am extremely baffled by this. Do anyone have an idea on where I
>> should start looking?
>>
>> System details:
>>
>> uname -a
>> Linux shadowfax.berkeley.edu 2.6.12-1-amd64-k8-smp #1 SMP Wed Sep 28
>> 02:57:49 CEST 2005 x86_64 GNU/Linux
>>
>> gcc --version
>> gcc (GCC) 4.0.2 20050808 (prerelease) (Ubuntu 4.0.1-4ubuntu9)
>>
>> R is version 2.2.1 build using a standard ./configure, make step.
>>
>>
>> /Kasper
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
>
> -- 
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

Thomas Lumley			Assoc. Professor, Biostatistics
tlumley at u.washington.edu	University of Washington, Seattle


From maechler at stat.math.ethz.ch  Mon Apr 17 18:16:17 2006
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Mon, 17 Apr 2006 18:16:17 +0200
Subject: [Rd] row.names in data.frame
In-Reply-To: <Pine.LNX.4.64.0604171638560.11478@gannet.stats.ox.ac.uk>
References: <Pine.LNX.4.64.0604141959160.3266@gannet.stats.ox.ac.uk>
	<p06230901c0695e8b8d77@[192.168.2.7]>
	<Pine.LNX.4.64.0604171638560.11478@gannet.stats.ox.ac.uk>
Message-ID: <17475.48977.541275.475264@stat.math.ethz.ch>

Thanks a lot, Brian,
I've been very happy with your proposal, but haven't yet looked
at the details of the R-devel implementation.  
The NEWS entry only mentions *integer* rownames as new feature -
which is exact from the user's perspective as you emphasize
below.  It might be worth mentioning that the internal
representation has become even more efficient than integers for
the case of "1:n".

Martin

>>>>> "BDR" == Prof Brian Ripley <ripley at stats.ox.ac.uk>
>>>>>     on Mon, 17 Apr 2006 16:49:21 +0100 (BST) writes:

    BDR> On Mon, 17 Apr 2006, Don MacQueen wrote:
    >> This looks like a good proposal to me, from an end-user's
    >> point of view.
    >> 
    >> I have, from time to time, wished I could set row names
    >> to NULL. Not for performance reasons, but because some
    >> aspect of my data, in combination with how R handles row
    >> names, was requiring me to explicitly manage them in
    >> situations where I was otherwise making no use of
    >> them. Admittedly, some of these occasions were quite a
    >> few R versions ago, when row names were not as carefully
    >> managed by R itself as they are now.
    >> 
    >> Potential ramifications are not immediately obvious to
    >> me, but for example, will rbind() of two data frames,
    >> both of which have been assigned NULL row names, result
    >> in a data frame with NULL row names? (Would it matter?)
    >> What about one with NULL row names and one with non-NULL
    >> row names?

    BDR> In the user's perspective, there are no NULL row.names,
    BDR> only integer or character ones.  (It did say *internal
    BDR> representation*.)  If you rbind one with integer and
    BDR> one with character, you get character in the result
    BDR> (just as you do with c()).  There's actually code there
    BDR> now that is supposed to work with 1:m and 1:n and give
    BDR> you 1:(n+m), and that does work with integer row.names.

    BDR> There was a snag with the proposal: zero-column data
    BDR> frames do have a number of rows which is found from the
    BDR> row.names.  So rather than encode as NULL, 1:n is
    BDR> encoded as c(as.integer(NA), n), but the user will
    BDR> never see that.

    BDR> row.names(a_df) <- NULL sets the row.names to 1:n.

    BDR> As of a few hours' ago, a test version is in R-devel.
    BDR> This passes their tests with all CRAN packages
    BDR> (somewhat to my surprise, but that may be in part be
    BDR> because all existing data frames do have character
    BDR> vector names).

    >>  -Don
    >> 
    >> At 8:29 PM +0100 4/14/06, Prof Brian Ripley wrote:
    >>> We know from the White Book p.57 that the row names of a
    >>> data frame `are never NULL and must be unique'.  R
    >>> documents that row.names() returns a character vector,
    >>> and in R (much more so than on S) a long character
    >>> vector of short unique strings is expensive to store (I
    >>> saw 72 bytes/row on a 64-bit machine for 1:1e6).
    >>> [Incidentally, in the White Book the index page nos are
    >>> all off by one for this item, and commonly elsewhere.
    >>> It seems to be LaTeX indexing the page on which a para
    >>> finishes.]
    >>> 
    >>> Last time this came up Martin Maechler asked if we could
    >>> not do it more efficiently, and reminded us recently.
    >>> It would be fairly easy if everyone used the row.names()
    >>> and row.names<-() accessor functions, but some packages
    >>> (notably Design and Hmisc) access the attribute
    >>> "row.names" directly (and what that is seems to be
    >>> undocumented).
    >>> 
    >>> I noticed that the White Book does not appear to say
    >>> that the row names are character, and indeed says
    >>> 
    >>> 'If all else fails the row names are just the row
    >>> numbers.'
    >>> 
    >>> and it seems the author of expand.grid() took that
    >>> literally, for it used to assign integers to the row
    >>> names.  However, the current S-PLUS help for both
    >>> row.names and data.frame say row names are a character
    >>> vector (and that row.names<-() coerces to character).
    >>> 
    >>> We can certainly differentiate between the internal
    >>> representation and the the result of row.names().  Here
    >>> is my idea:
    >>> 
    >>> 1) The internal representation is either NULL, an
    >>> integer vector or a character vector.
    >>> 
    >>> 2) attr(x, "row.names") will always return either an
    >>> integer vector or a character vector, using 1:nrow(x) if
    >>> the internal representation is NULL.
    >>> 
    >>> 3) row.names() will always return as.character(attr(x,
    >>> "row.names)).
    >>> 
    >>> 4) attr<- and row.names<- can set NULL, integer or
    >>> character.
    >>> 
    >>> 5) Row-indexing a data frame with NULL or integer
    >>> representation will give an integer representation.
    >>> 
    >>> This would appear to be completely back-compatible for
    >>> those who only work via the accessor functions, and
    >>> probably work with almost all package code that
    >>> manipulates attributes directly.  Since the changes can
    >>> be done almost entirely in C code, the performance hit
    >>> should be negliglible.
    >>> 
    >>> The benefits will probably only be appreciable with
    >>> `tall and skinny' data frames, as even 72 bytes per row
    >>> is only going to buy you 9 numeric columns.  But that is
    >>> it seems a common enough case to make this worthwhile.
    >>> 
    >>> This would be a change aimed at 2.4.0, since we would
    >>> need plenty of time both for testing and to alter code
    >>> to make use of the more efficient representations.
    >>> 
    >>> BTW, the maximum object length of 2^31 - 1 ensures that
    >>> an integer representation of row numbers suffices.

    BDR> -- Brian D. Ripley, ripley at stats.ox.ac.uk Professor of
    BDR> Applied Statistics, http://www.stats.ox.ac.uk/~ripley/
    BDR> University of Oxford, Tel: +44 1865 272861 (self) 1
    BDR> South Parks Road, +44 1865 272866 (PA) Oxford OX1 3TG,
    BDR> UK Fax: +44 1865 272595

    BDR> ______________________________________________
    BDR> R-devel at r-project.org mailing list
    BDR> https://stat.ethz.ch/mailman/listinfo/r-devel


From ripley at stats.ox.ac.uk  Mon Apr 17 18:26:10 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 17 Apr 2006 17:26:10 +0100 (BST)
Subject: [Rd] row.names in data.frame
In-Reply-To: <17475.48977.541275.475264@stat.math.ethz.ch>
References: <Pine.LNX.4.64.0604141959160.3266@gannet.stats.ox.ac.uk>
	<p06230901c0695e8b8d77@[192.168.2.7]>
	<Pine.LNX.4.64.0604171638560.11478@gannet.stats.ox.ac.uk>
	<17475.48977.541275.475264@stat.math.ethz.ch>
Message-ID: <Pine.LNX.4.64.0604171717390.17606@gannet.stats.ox.ac.uk>

On Mon, 17 Apr 2006, Martin Maechler wrote:

> Thanks a lot, Brian,
> I've been very happy with your proposal, but haven't yet looked
> at the details of the R-devel implementation.
> The NEWS entry only mentions *integer* rownames as new feature -
> which is exact from the user's perspective as you emphasize
> below.  It might be worth mentioning that the internal
> representation has become even more efficient than integers for
> the case of "1:n".

NEWS says

         The internal storage of row.names = 1:n just records 'n' for
         efficiency with very long vectors.

This bit is rather recent (both the item and the corresponding code).

BTW, this does not obviate the need for Matthew Dowle's data.table 
package, as quite a bit of time is spent manipulating row.names which can 
be saved if you know you do not need them, at the expense of not being 
allowed to use a lot of standard modelling functions.

Brian


>
> Martin
>
>>>>>> "BDR" == Prof Brian Ripley <ripley at stats.ox.ac.uk>
>>>>>>     on Mon, 17 Apr 2006 16:49:21 +0100 (BST) writes:
>
>    BDR> On Mon, 17 Apr 2006, Don MacQueen wrote:
>    >> This looks like a good proposal to me, from an end-user's
>    >> point of view.
>    >>
>    >> I have, from time to time, wished I could set row names
>    >> to NULL. Not for performance reasons, but because some
>    >> aspect of my data, in combination with how R handles row
>    >> names, was requiring me to explicitly manage them in
>    >> situations where I was otherwise making no use of
>    >> them. Admittedly, some of these occasions were quite a
>    >> few R versions ago, when row names were not as carefully
>    >> managed by R itself as they are now.
>    >>
>    >> Potential ramifications are not immediately obvious to
>    >> me, but for example, will rbind() of two data frames,
>    >> both of which have been assigned NULL row names, result
>    >> in a data frame with NULL row names? (Would it matter?)
>    >> What about one with NULL row names and one with non-NULL
>    >> row names?
>
>    BDR> In the user's perspective, there are no NULL row.names,
>    BDR> only integer or character ones.  (It did say *internal
>    BDR> representation*.)  If you rbind one with integer and
>    BDR> one with character, you get character in the result
>    BDR> (just as you do with c()).  There's actually code there
>    BDR> now that is supposed to work with 1:m and 1:n and give
>    BDR> you 1:(n+m), and that does work with integer row.names.
>
>    BDR> There was a snag with the proposal: zero-column data
>    BDR> frames do have a number of rows which is found from the
>    BDR> row.names.  So rather than encode as NULL, 1:n is
>    BDR> encoded as c(as.integer(NA), n), but the user will
>    BDR> never see that.
>
>    BDR> row.names(a_df) <- NULL sets the row.names to 1:n.
>
>    BDR> As of a few hours' ago, a test version is in R-devel.
>    BDR> This passes their tests with all CRAN packages
>    BDR> (somewhat to my surprise, but that may be in part be
>    BDR> because all existing data frames do have character
>    BDR> vector names).
>
>    >>  -Don
>    >>
>    >> At 8:29 PM +0100 4/14/06, Prof Brian Ripley wrote:
>    >>> We know from the White Book p.57 that the row names of a
>    >>> data frame `are never NULL and must be unique'.  R
>    >>> documents that row.names() returns a character vector,
>    >>> and in R (much more so than on S) a long character
>    >>> vector of short unique strings is expensive to store (I
>    >>> saw 72 bytes/row on a 64-bit machine for 1:1e6).
>    >>> [Incidentally, in the White Book the index page nos are
>    >>> all off by one for this item, and commonly elsewhere.
>    >>> It seems to be LaTeX indexing the page on which a para
>    >>> finishes.]
>    >>>
>    >>> Last time this came up Martin Maechler asked if we could
>    >>> not do it more efficiently, and reminded us recently.
>    >>> It would be fairly easy if everyone used the row.names()
>    >>> and row.names<-() accessor functions, but some packages
>    >>> (notably Design and Hmisc) access the attribute
>    >>> "row.names" directly (and what that is seems to be
>    >>> undocumented).
>    >>>
>    >>> I noticed that the White Book does not appear to say
>    >>> that the row names are character, and indeed says
>    >>>
>    >>> 'If all else fails the row names are just the row
>    >>> numbers.'
>    >>>
>    >>> and it seems the author of expand.grid() took that
>    >>> literally, for it used to assign integers to the row
>    >>> names.  However, the current S-PLUS help for both
>    >>> row.names and data.frame say row names are a character
>    >>> vector (and that row.names<-() coerces to character).
>    >>>
>    >>> We can certainly differentiate between the internal
>    >>> representation and the the result of row.names().  Here
>    >>> is my idea:
>    >>>
>    >>> 1) The internal representation is either NULL, an
>    >>> integer vector or a character vector.
>    >>>
>    >>> 2) attr(x, "row.names") will always return either an
>    >>> integer vector or a character vector, using 1:nrow(x) if
>    >>> the internal representation is NULL.
>    >>>
>    >>> 3) row.names() will always return as.character(attr(x,
>    >>> "row.names)).
>    >>>
>    >>> 4) attr<- and row.names<- can set NULL, integer or
>    >>> character.
>    >>>
>    >>> 5) Row-indexing a data frame with NULL or integer
>    >>> representation will give an integer representation.
>    >>>
>    >>> This would appear to be completely back-compatible for
>    >>> those who only work via the accessor functions, and
>    >>> probably work with almost all package code that
>    >>> manipulates attributes directly.  Since the changes can
>    >>> be done almost entirely in C code, the performance hit
>    >>> should be negliglible.
>    >>>
>    >>> The benefits will probably only be appreciable with
>    >>> `tall and skinny' data frames, as even 72 bytes per row
>    >>> is only going to buy you 9 numeric columns.  But that is
>    >>> it seems a common enough case to make this worthwhile.
>    >>>
>    >>> This would be a change aimed at 2.4.0, since we would
>    >>> need plenty of time both for testing and to alter code
>    >>> to make use of the more efficient representations.
>    >>>
>    >>> BTW, the maximum object length of 2^31 - 1 ensures that
>    >>> an integer representation of row numbers suffices.
>
>    BDR> -- Brian D. Ripley, ripley at stats.ox.ac.uk Professor of
>    BDR> Applied Statistics, http://www.stats.ox.ac.uk/~ripley/
>    BDR> University of Oxford, Tel: +44 1865 272861 (self) 1
>    BDR> South Parks Road, +44 1865 272866 (PA) Oxford OX1 3TG,
>    BDR> UK Fax: +44 1865 272595
>
>    BDR> ______________________________________________
>    BDR> R-devel at r-project.org mailing list
>    BDR> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From simon.urbanek at r-project.org  Mon Apr 17 18:41:43 2006
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Mon, 17 Apr 2006 12:41:43 -0400
Subject: [Rd] cannot load rJava in R
In-Reply-To: <1709680043@web.de>
References: <1709680043@web.de>
Message-ID: <498DB574-05A4-4A40-9D80-5D8F64418A73@r-project.org>

Lothar,

as per posting guide, please discuss issues with contributed packages  
with the maintainer.

On Apr 15, 2006, at 4:59 PM, Lothar Rubusch wrote:

>  I recently tried to install the rJava package on my notebook  
> (Debian Etch / Kernel 2.6.15 / jdk 1.5.0-5 / R 2.2.1 / rJava ?? the  
> repo one, have a look below). I compiled R myself with "--with- 
> readline=no" and "--enable-R-shlib flags". Now, each time loading  
> the library rJava I encouter the same error. I reinstalled several  
> times (as root), always the same problem:
> JNI_GetCreatedJavaVMs is undefined, isn't it?! I couldn't find  
> anything to that problem so far..
>
> What went wrong?
> Do I have the recent repository for rJava?
> How can I fix this?
>

 From the configure output it seems as if you have a fake libjvm.so,  
because there are no library paths and yet it compiles. Please make  
sure that the correct java, javac etc. are on your PATH before you  
compile the package. Also make sure that your Java is properly  
installed (preferably from a Debian package). If that doesn't help,  
please send me your config.log.

Cheers,
Simon


From charles.dupont at vanderbilt.edu  Mon Apr 17 19:27:19 2006
From: charles.dupont at vanderbilt.edu (Charles Dupont)
Date: Mon, 17 Apr 2006 12:27:19 -0500
Subject: [Rd] (PR#8777) strsplit does [not] return correct value when
 spliting ""
In-Reply-To: <Pine.LNX.4.64.0604171534210.5712@gannet.stats.ox.ac.uk>
References: <20060417140025.3773A19B32@slim.kubism.ku.dk>
	<Pine.LNX.4.64.0604171534210.5712@gannet.stats.ox.ac.uk>
Message-ID: <4443CFF7.3040804@vanderbilt.edu>

Now using R 2.3.0.

I have a string that can be "".  I want to find the max screen width of 
the all the lines in the string. so I run the command

  > x <- c("hello", "bob is\ngreat", "foo", "", "bar")
  > substrings <- strsplit(x, "\n"), type="width")
  > sapply(substrings, FUN=function(x) max(nchar(x, type="width")))
which returns
[1]    5    6    3 -Inf    3

This happens because of the behavior of strsplit for a string that is not ""
  > strsplit("Hello\nBob", "\n")

it returns
[[1]]
[1] "Hello" "Bob"


for a string that is ""
  > strsplit("", "\n")

it returns
[[1]]
character(0)


I would expect
[[1]]
[1] ""

because "" is character vector of length 1 containing a string of length 
0, not a character vector of length 0.

For any other string if the split string is not matched in argument x 
then it returns the original string x.

The man page states in the value section that strsplit returns:
      A list of length 'length(x)' the 'i'-th element of which contains
      the vector of splits of 'x[i]'.

It mentions no change in behavior if the value of x[i] = "".

Prof Brian Ripley wrote:
> Please use a current version of R: we are at 2.3.0RC (and we do ask you 
> not to report on obselete versions).
> 
> What rule are you using, and where did you find it in the R documentation?
> 
> In fact
> 
>> strsplit("", " ")
> 
> [[1]]
> character(0)
> 
> which is not as you stated.   This is a feature, as it distinct from
> 
>> strsplit(" ", " ")
> 
> [[1]]
> [1] ""
> 
> Consider also
> 
>> strsplit("", "")
> 
> [[1]]
> character(0)
> 
>> strsplit("a", "")
> 
> [[1]]
> [1] "a"
> 
>> strsplit("ab", "")
> 
> [[1]]
> [1] "a" "b"
> 
> 
> On Mon, 17 Apr 2006, charles.dupont at vanderbilt.edu wrote:
> 
>> Full_Name: Charles Dupont
>> Version: 2.2.0
>> OS: linux
>> Submission from: (NULL) (160.129.129.136)
>>
>>
>> when
>>
>> strsplit("", " ")
>>
>> returns character(0)
>>
>> where as
>>
>> strsplit("a", " ")
>>
>> returns "a".
>>
>> these return values are not constiant with each other.
>>
>> Charles Dupont
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
> 


-- 
Charles Dupont	Computer System Analyst		School of Medicine
		Department of Biostatistics	Vanderbilt University


From ripley at stats.ox.ac.uk  Mon Apr 17 20:01:08 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 17 Apr 2006 19:01:08 +0100 (BST)
Subject: [Rd] (PR#8777) strsplit does [not] return correct value when
 spliting ""
In-Reply-To: <4443CFF7.3040804@vanderbilt.edu>
References: <20060417140025.3773A19B32@slim.kubism.ku.dk>
	<Pine.LNX.4.64.0604171534210.5712@gannet.stats.ox.ac.uk>
	<4443CFF7.3040804@vanderbilt.edu>
Message-ID: <Pine.LNX.4.64.0604171856190.24775@gannet.stats.ox.ac.uk>

On Mon, 17 Apr 2006, Charles Dupont wrote:

> Now using R 2.3.0.
>
> I have a string that can be "".  I want to find the max screen width of
> the all the lines in the string. so I run the command
>
>  > x <- c("hello", "bob is\ngreat", "foo", "", "bar")
>  > substrings <- strsplit(x, "\n"), type="width")
>  > sapply(substrings, FUN=function(x) max(nchar(x, type="width")))
> which returns
> [1]    5    6    3 -Inf    3

That's a problem with your use of max.  Try max(0, ...).

> This happens because of the behavior of strsplit for a string that is not ""
>  > strsplit("Hello\nBob", "\n")
>
> it returns
> [[1]]
> [1] "Hello" "Bob"
>
>
> for a string that is ""
>  > strsplit("", "\n")
>
> it returns
> [[1]]
> character(0)
>
>
> I would expect
> [[1]]
> [1] ""
>
> because "" is character vector of length 1 containing a string of length
> 0, not a character vector of length 0.
>
> For any other string if the split string is not matched in argument x
> then it returns the original string x.
>
> The man page states in the value section that strsplit returns:
>      A list of length 'length(x)' the 'i'-th element of which contains
>      the vector of splits of 'x[i]'.
>
> It mentions no change in behavior if the value of x[i] = "".

There is none, for there are no splits in that case.  I did ask you to 
point to the documentation of the rule you are assuming, and I can't find 
any.

>
> Prof Brian Ripley wrote:
>> Please use a current version of R: we are at 2.3.0RC (and we do ask you
>> not to report on obselete versions).
>>
>> What rule are you using, and where did you find it in the R documentation?
>>
>> In fact
>>
>>> strsplit("", " ")
>>
>> [[1]]
>> character(0)
>>
>> which is not as you stated.   This is a feature, as it distinct from
>>
>>> strsplit(" ", " ")
>>
>> [[1]]
>> [1] ""
>>
>> Consider also
>>
>>> strsplit("", "")
>>
>> [[1]]
>> character(0)
>>
>>> strsplit("a", "")
>>
>> [[1]]
>> [1] "a"
>>
>>> strsplit("ab", "")
>>
>> [[1]]
>> [1] "a" "b"
>>
>>
>> On Mon, 17 Apr 2006, charles.dupont at vanderbilt.edu wrote:
>>
>>> Full_Name: Charles Dupont
>>> Version: 2.2.0
>>> OS: linux
>>> Submission from: (NULL) (160.129.129.136)
>>>
>>>
>>> when
>>>
>>> strsplit("", " ")
>>>
>>> returns character(0)
>>>
>>> where as
>>>
>>> strsplit("a", " ")
>>>
>>> returns "a".
>>>
>>> these return values are not constiant with each other.
>>>
>>> Charles Dupont
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>>
>>
>
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From thomas.friedrichsmeier at ruhr-uni-bochum.de  Mon Apr 17 21:11:53 2006
From: thomas.friedrichsmeier at ruhr-uni-bochum.de (Thomas Friedrichsmeier)
Date: Mon, 17 Apr 2006 21:11:53 +0200
Subject: [Rd] Testcase (was: Stack checking, core dumps, and embedding R)
In-Reply-To: <200604171520.51565.thomas.friedrichsmeier@ruhr-uni-bochum.de>
References: <200604170334.14003.thomas.friedrichsmeier@ruhr-uni-bochum.de>
	<200604171520.51565.thomas.friedrichsmeier@ruhr-uni-bochum.de>
Message-ID: <200604172111.58597.thomas.friedrichsmeier@ruhr-uni-bochum.de>

Sorry about all the noise, but I'm slightly irritated by the absence of 
reactions of any kind, while the time to the release is ticking away.

Attached you will find a testcase for the problem. Likely the error will only 
show up on linux, due to the

	#if defined(linux)
	    R_CStackStart = (uintptr_t) __libc_stack_end;
	#elif ...

in unix/system.c . Also the error may not be 100% reproducible, depending on 
where exactly the stack for the worker thread is allocated, but at least for 
me it has triggered every single time I tried it (recent debian unstable on a 
Pentium M, for reference).

For your convenience, if you place the testcase in tests/Embedding of your R 
source tree, here are the lines needed to compile and run:

gcc -I. -I../../src/include -I../../src/include -I/usr/local/include -DHAVE_CONFIG_H   -g -O2 -std=gnu99 -c 
threadEmbed.c -o threadEmbed.o

../../bin/R CMD LINK gcc -o threadEmbed 
threadEmbed.o -L../../lib -lR -lpthread

(R_HOME=../..; export R_HOME; ./threadEmbed --silent)

Once again, I don't know how many embedding applications are affected by this, 
but it is absolutely fatal for rkward, at least. The proposed patch, cited 
again, below, fixes the problem.

Regards
Thomas

On Monday 17 April 2006 15:20, Thomas Friedrichsmeier wrote:
> Excuse me please, for being impatient, but I'm worried this issue may not
> be considered important enough to be fixed in R 2.3.0 at this late point of
> time. So let me re-state this:
>
> In the current state, R will *not work at all* when run in a thread on
> linux.
>
> I do not know how many embedding applications run R in a separate thread,
> and are affected by this. I know that at least rkward does, and it will not
> run.
>
> Reconsidering the proposals I made yesterday, after some sleep, let me
> propose this corrected fix (insert into src/unix/system.c, at line 179,
> right above "if(R_CStackStart == -1) R_CStackLimit = -1; /* never set */"):
>
>     if (abs (R_CStackStart - (uintptr_t) &i) > 20000) {
> 	/* Very unlikely we're this far away from the stack start at this
> 	point in the code. Disable checking */
> 	R_CStackStart = -1;
>     }
>
> For all I care, set the safety margin to 50000 or even more. This heuristic
> is only meant to catch cases where the detected value for R_CStackStart is
> *obviously wrong*, most importantly in case of threads.
>
> In this case all it will do is to disable the check. I can see no other
> side-effect.
>
> Once again, excuse me for being impatient, but *please* consider this for
> inclusion in R 2.3.0.
>
> Regards
> Thomas
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
Url : https://stat.ethz.ch/pipermail/r-devel/attachments/20060417/bcc0bf09/attachment.bin 

From thomas.friedrichsmeier at ruhr-uni-bochum.de  Mon Apr 17 21:17:30 2006
From: thomas.friedrichsmeier at ruhr-uni-bochum.de (Thomas Friedrichsmeier)
Date: Mon, 17 Apr 2006 21:17:30 +0200
Subject: [Rd] Testcase (was: Stack checking, core dumps, and embedding R)
In-Reply-To: <200604172111.58597.thomas.friedrichsmeier@ruhr-uni-bochum.de>
References: <200604170334.14003.thomas.friedrichsmeier@ruhr-uni-bochum.de>
	<200604171520.51565.thomas.friedrichsmeier@ruhr-uni-bochum.de>
	<200604172111.58597.thomas.friedrichsmeier@ruhr-uni-bochum.de>
Message-ID: <200604172117.30359.thomas.friedrichsmeier@ruhr-uni-bochum.de>

Sorry, I wasn't aware, .c files would be scrubbed. Testcase available for 
download here:
http://rkward.sourceforge.net/temp/threadEmbed.c

On Monday 17 April 2006 21:11, Thomas Friedrichsmeier wrote:
> Sorry about all the noise, but I'm slightly irritated by the absence of
> reactions of any kind, while the time to the release is ticking away.
>
> Attached you will find a testcase for the problem. Likely the error will
> only show up on linux, due to the
>
> 	#if defined(linux)
> 	    R_CStackStart = (uintptr_t) __libc_stack_end;
> 	#elif ...
>
> in unix/system.c . Also the error may not be 100% reproducible, depending
> on where exactly the stack for the worker thread is allocated, but at least
> for me it has triggered every single time I tried it (recent debian
> unstable on a Pentium M, for reference).
>
> For your convenience, if you place the testcase in tests/Embedding of your
> R source tree, here are the lines needed to compile and run:
>
> gcc -I. -I../../src/include -I../../src/include -I/usr/local/include
> -DHAVE_CONFIG_H   -g -O2 -std=gnu99 -c threadEmbed.c -o threadEmbed.o
>
> ../../bin/R CMD LINK gcc -o threadEmbed
> threadEmbed.o -L../../lib -lR -lpthread
>
> (R_HOME=../..; export R_HOME; ./threadEmbed --silent)
>
> Once again, I don't know how many embedding applications are affected by
> this, but it is absolutely fatal for rkward, at least. The proposed patch,
> cited again, below, fixes the problem.
>
> Regards
> Thomas
>
> On Monday 17 April 2006 15:20, Thomas Friedrichsmeier wrote:
> > Excuse me please, for being impatient, but I'm worried this issue may not
> > be considered important enough to be fixed in R 2.3.0 at this late point
> > of time. So let me re-state this:
> >
> > In the current state, R will *not work at all* when run in a thread on
> > linux.
> >
> > I do not know how many embedding applications run R in a separate thread,
> > and are affected by this. I know that at least rkward does, and it will
> > not run.
> >
> > Reconsidering the proposals I made yesterday, after some sleep, let me
> > propose this corrected fix (insert into src/unix/system.c, at line 179,
> > right above "if(R_CStackStart == -1) R_CStackLimit = -1; /* never set
> > */"):
> >
> >     if (abs (R_CStackStart - (uintptr_t) &i) > 20000) {
> > 	/* Very unlikely we're this far away from the stack start at this
> > 	point in the code. Disable checking */
> > 	R_CStackStart = -1;
> >     }
> >
> > For all I care, set the safety margin to 50000 or even more. This
> > heuristic is only meant to catch cases where the detected value for
> > R_CStackStart is *obviously wrong*, most importantly in case of threads.
> >
> > In this case all it will do is to disable the check. I can see no other
> > side-effect.
> >
> > Once again, excuse me for being impatient, but *please* consider this for
> > inclusion in R 2.3.0.
> >
> > Regards
> > Thomas
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
Url : https://stat.ethz.ch/pipermail/r-devel/attachments/20060417/eab7be0e/attachment.bin 

From allen at ms.uky.edu  Mon Apr 17 21:49:34 2006
From: allen at ms.uky.edu (David Allen)
Date: Mon, 17 Apr 2006 15:49:34 -0400
Subject: [Rd] bounding box in PostScript
Message-ID: <5.2.0.9.2.20060417154018.01232ec0@pop.ms.uky.edu>

When a graph is saved as PostScript, the bounding box is often too big.
A consequence is that when the graph is included in a LaTeX document,
the spacing does not look good.
Is this a recognized problem? Is someone working on it? Could I help?

David


From ripley at stats.ox.ac.uk  Mon Apr 17 23:01:34 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 17 Apr 2006 22:01:34 +0100 (BST)
Subject: [Rd] bounding box in PostScript
In-Reply-To: <5.2.0.9.2.20060417154018.01232ec0@pop.ms.uky.edu>
References: <5.2.0.9.2.20060417154018.01232ec0@pop.ms.uky.edu>
Message-ID: <Pine.LNX.4.64.0604172157540.29810@gannet.stats.ox.ac.uk>

On Mon, 17 Apr 2006, David Allen wrote:

> When a graph is saved as PostScript, the bounding box is often too big.
> A consequence is that when the graph is included in a LaTeX document,
> the spacing does not look good.
> Is this a recognized problem? Is someone working on it? Could I help?

It's not really true.  The bounding box is of the figure region, and it is 
a design feature.  If the figure `region' that is too big for your 
purposes you need to adjust the margins.

Alternatively, there are lots of ways to set a tight bounding box: I tend 
to use the bbox device in gs.  But that often ends up with figures which 
do not align, depending on whether text has descenders.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ehlers at math.ucalgary.ca  Mon Apr 17 23:02:43 2006
From: ehlers at math.ucalgary.ca (Peter Ehlers)
Date: Mon, 17 Apr 2006 15:02:43 -0600
Subject: [Rd] (PR#8777) strsplit does [not] return correct value when
 spliting ""
In-Reply-To: <4443CFF7.3040804@vanderbilt.edu>
References: <20060417140025.3773A19B32@slim.kubism.ku.dk>	<Pine.LNX.4.64.0604171534210.5712@gannet.stats.ox.ac.uk>
	<4443CFF7.3040804@vanderbilt.edu>
Message-ID: <44440273.7080904@math.ucalgary.ca>

Charles,

Can't you achieve your goal by unlist()ing 'substrings'?

  max(nchar(unlist(substrings)))

Peter Ehlers


Charles Dupont wrote:
> Now using R 2.3.0.
> 
> I have a string that can be "".  I want to find the max screen width of 
> the all the lines in the string. so I run the command
> 
>   > x <- c("hello", "bob is\ngreat", "foo", "", "bar")
>   > substrings <- strsplit(x, "\n"), type="width")
>   > sapply(substrings, FUN=function(x) max(nchar(x, type="width")))
> which returns
> [1]    5    6    3 -Inf    3
> 
> This happens because of the behavior of strsplit for a string that is not ""
>   > strsplit("Hello\nBob", "\n")
> 
> it returns
> [[1]]
> [1] "Hello" "Bob"
> 
> 
> for a string that is ""
>   > strsplit("", "\n")
> 
> it returns
> [[1]]
> character(0)
> 
> 
> I would expect
> [[1]]
> [1] ""
> 
> because "" is character vector of length 1 containing a string of length 
> 0, not a character vector of length 0.
> 
> For any other string if the split string is not matched in argument x 
> then it returns the original string x.
> 
> The man page states in the value section that strsplit returns:
>       A list of length 'length(x)' the 'i'-th element of which contains
>       the vector of splits of 'x[i]'.
> 
> It mentions no change in behavior if the value of x[i] = "".
> 
> Prof Brian Ripley wrote:
> 
>>Please use a current version of R: we are at 2.3.0RC (and we do ask you 
>>not to report on obselete versions).
>>
>>What rule are you using, and where did you find it in the R documentation?
>>
>>In fact
>>
>>
>>>strsplit("", " ")
>>
>>[[1]]
>>character(0)
>>
>>which is not as you stated.   This is a feature, as it distinct from
>>
>>
>>>strsplit(" ", " ")
>>
>>[[1]]
>>[1] ""
>>
>>Consider also
>>
>>
>>>strsplit("", "")
>>
>>[[1]]
>>character(0)
>>
>>
>>>strsplit("a", "")
>>
>>[[1]]
>>[1] "a"
>>
>>
>>>strsplit("ab", "")
>>
>>[[1]]
>>[1] "a" "b"
>>
>>
>>On Mon, 17 Apr 2006, charles.dupont at vanderbilt.edu wrote:
>>
>>
>>>Full_Name: Charles Dupont
>>>Version: 2.2.0
>>>OS: linux
>>>Submission from: (NULL) (160.129.129.136)
>>>
>>>
>>>when
>>>
>>>strsplit("", " ")
>>>
>>>returns character(0)
>>>
>>>where as
>>>
>>>strsplit("a", " ")
>>>
>>>returns "a".
>>>
>>>these return values are not constiant with each other.
>>>
>>>Charles Dupont
>>>
>>>______________________________________________
>>>R-devel at r-project.org mailing list
>>>https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>>
>>
> 
>


From thomas.friedrichsmeier at ruhr-uni-bochum.de  Mon Apr 17 23:50:38 2006
From: thomas.friedrichsmeier at ruhr-uni-bochum.de (Thomas Friedrichsmeier)
Date: Mon, 17 Apr 2006 23:50:38 +0200
Subject: [Rd] (PR#8777) strsplit does [not] return correct value when
	spliting ""
Message-ID: <200604172350.44795.thomas.friedrichsmeier@ruhr-uni-bochum.de>

Prof Brian Ripley wrote:
> On Mon, 17 Apr 2006, Charles Dupont wrote:
[...]
> > The man page states in the value section that strsplit returns:
> >      A list of length 'length(x)' the 'i'-th element of which contains
> >      the vector of splits of 'x[i]'.
> >
> > It mentions no change in behavior if the value of x[i] = "".
>
> There is none, for there are no splits in that case.  I did ask you to
> point to the documentation of the rule you are assuming, and I can't find
> any.

No, the documentation does not explicitely mention this, but shouldn't "there 
are not splits" mean: So the string is returned unchanged?
Consider these examples - I don't think that's the behavior you'd expect 
unless told otherwise:

a <- "a"
b <- ""
a == strsplit (a, ",")	# TRUE
b == strsplit (b, ",")	# FALSE

So, maybe there is a general rule that empty elements get purged?

strsplit ("a,,b", ",")
[[1]]
[1] "a" ""  "b"

strsplit ("a", "a")
[[1]]
[1] ""

Apparently not so. Then why does an empty string get "split" to a non-existent 
string?

Note: I don't really care much about what the behavior is, but if the 
described behavior is indeed intended, I think it should be documented. IMO 
it's pretty counter intuitive.

Regards
Thomas
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
Url : https://stat.ethz.ch/pipermail/r-devel/attachments/20060417/3f6180dc/attachment.bin 

From Ted.Harding at nessie.mcc.ac.uk  Tue Apr 18 00:05:31 2006
From: Ted.Harding at nessie.mcc.ac.uk ( (Ted Harding))
Date: Mon, 17 Apr 2006 23:05:31 +0100 (BST)
Subject: [Rd] bounding box in PostScript
In-Reply-To: <Pine.LNX.4.64.0604172157540.29810@gannet.stats.ox.ac.uk>
Message-ID: <XFMail.060417230531.Ted.Harding@nessie.mcc.ac.uk>

On 17-Apr-06 Prof Brian Ripley wrote:
> On Mon, 17 Apr 2006, David Allen wrote:
> 
>> When a graph is saved as PostScript, the bounding box is often too
>> big.
>> A consequence is that when the graph is included in a LaTeX document,
>> the spacing does not look good.
>> Is this a recognized problem? Is someone working on it? Could I help?
> 
> It's not really true.  The bounding box is of the figure region, and it
> is 
> a design feature.  If the figure `region' that is too big for your 
> purposes you need to adjust the margins.
> 
> Alternatively, there are lots of ways to set a tight bounding box: I
> tend to use the bbox device in gs.  But that often ends up with
> figures which do not align, depending on whether text has descenders.

Ghostscript's BBox resources tend to suffer from this problem,
since for some reason as Brian says it may not properly allow
for the true sizes of characters. I once tweaked ps2eps to
correct (more or less) for this.

But nowadays, to get it exactly right, I use gv (ghostview
front end) to open the EPS file, and set "watch" mode:

  gv -watch filename.eps

If it doesn't automatically give the "BoundingBox" view, you
can always select this from the top menu. This ensures that
the frame of the gv window is the same as the BoundingBox.

Then open the EPS file for editing, and look for the

  %%BoundingBox llx lly urx ury

line (it may be near the beginning, or at the end -- which
will be flagged by a line

  %%BoundingBox: atend

near the beinning).

Here, llx, lly, urx, ury are integers giving the coordinates
(in points relative to the page origin) of the lower left,
and upper right, corners of the bounding box.

Now you can change the values of these. Each time you change,
save the edited file. Because gv is in "watch" mode, it will
re-draw the page whenever the file changes. Thus you can adjust
the bounding box until it is just as you want it.

Best wishes,
Ted.

--------------------------------------------------------------------
E-Mail: (Ted Harding) <Ted.Harding at nessie.mcc.ac.uk>
Fax-to-email: +44 (0)870 094 0861
Date: 17-Apr-06                                       Time: 23:05:29
------------------------------ XFMail ------------------------------


From berwin at maths.uwa.edu.au  Tue Apr 18 03:04:25 2006
From: berwin at maths.uwa.edu.au (Berwin A Turlach)
Date: Tue, 18 Apr 2006 09:04:25 +0800
Subject: [Rd] bounding box in PostScript
In-Reply-To: <5.2.0.9.2.20060417154018.01232ec0@pop.ms.uky.edu>
References: <5.2.0.9.2.20060417154018.01232ec0@pop.ms.uky.edu>
Message-ID: <17476.15129.276232.549991@bossiaea.maths.uwa.edu.au>

G'day David,

>>>>> "DA" == David Allen <allen at ms.uky.edu> writes:

    DA> When a graph is saved as PostScript, the bounding box is often
    DA> too big.  A consequence is that when the graph is included in
    DA> a LaTeX document, the spacing does not look good.  Is this a
    DA> recognized problem? Is someone working on it? Could I help?
How exactly are you saving the graph as PostScript?

I guess the problem is due to the fact that you save the PostScript
picture on a paper according to your default paper size (which is "a4"
for me).  To create PostScript pictures with reasonalbe tight bounding
boxes that are suitable to be included in a LaTeX document you should
specify `paper=special' and then define your plotting area via the
'height' and 'width' argument.

Hope this helps.

Cheers,

        Berwin

========================== Full address ============================
Berwin A Turlach                      Tel.: +61 (8) 6488 3338 (secr)   
School of Mathematics and Statistics        +61 (8) 6488 3383 (self)      
The University of Western Australia   FAX : +61 (8) 6488 1028
35 Stirling Highway                   
Crawley WA 6009                e-mail: berwin at maths.uwa.edu.au
Australia                        http://www.maths.uwa.edu.au/~berwin


From l.rubusch at web.de  Tue Apr 18 04:58:51 2006
From: l.rubusch at web.de (Lothar Rubusch)
Date: Tue, 18 Apr 2006 04:58:51 +0200
Subject: [Rd] cannot load rJava in R
Message-ID: <1712243834@web.de>


> -----Urspr?ngliche Nachricht-----
> Von: Simon Urbanek <simon.urbanek at r-project.org>
> Gesendet: 17.04.06 18:41:52
> An: Lothar Rubusch <l.rubusch at web.de>
> CC: r-devel at r-project.org
> Betreff: Re: [Rd] cannot load rJava in R


> Lothar,
> 
> as per posting guide, please discuss issues with contributed packages  
> with the maintainer.
> 
> On Apr 15, 2006, at 4:59 PM, Lothar Rubusch wrote:
> 
> >  I recently tried to install the rJava package on my notebook  
> > (Debian Etch / Kernel 2.6.15 / jdk 1.5.0-5 / R 2.2.1 / rJava ?? the  
> > repo one, have a look below). I compiled R myself with "--with- 
> > readline=no" and "--enable-R-shlib flags". Now, each time loading  
> > the library rJava I encouter the same error. I reinstalled several  
> > times (as root), always the same problem:
> > JNI_GetCreatedJavaVMs is undefined, isn't it?! I couldn't find  
> > anything to that problem so far..
> >
> > What went wrong?
> > Do I have the recent repository for rJava?
> > How can I fix this?
> >
> 
>  From the configure output it seems as if you have a fake libjvm.so,  
> because there are no library paths and yet it compiles. Please make  
> sure that the correct java, javac etc. are on your PATH before you  
> compile the package. Also make sure that your Java is properly  
> installed (preferably from a Debian package). If that doesn't help,  
> please send me your config.log.
> 
> Cheers,
> Simon
> 



Hey all!


Thank you for giving me the hint and for your very friendly help, I appreciate!! - True, true reading 
error messages in some case might be helpful.. Here is what I found out:

In brief LD_LIBRARY_PATHS was not set up correctly. It has to be set to the path of the shared 
objects depending on where someone has installed the JDK. I installed it under /usr/local/java/current/ 
so for me that's:
/usr/local/java/current/jre/lib/i386/
/usr/local/java/current/jre/lib/i386/client/

But this was not sufficient, R asked for another rJava.so so I had to add the following path, too (that's where I found the shared object using locate):
/usr/local/lib/R/site-library/rJava/libs/

In conclusion this line did the job:
#export LD_LIBRARY_PATH=/usr/local/java/current/jre/lib/i386/:/usr/local/java/current/jre/lib/i386/client/:/usr/local/lib/R/site-library/rJava/libs/

Now it runs smoothly! Nice!

Best regards,
Lothar



PS:
Some words on the official debian java packages: I can't consider if this still is the state of the art, but I could not find anything that it already has changed. Generally there might be some policy problems with SUN's Java packages and Debian. So the Debian packages (e.g. java-common) afaik are using Blackdown's Java implementations, in Java Version 1.4.2. But with a dummy package it is possible to do a workaround:
http://www.debian.org/doc/manuals/debian-java-faq/ch11.html#s11.2
Thus afaik it is - at least - not always possible to resist only on the official .deb files for Java.


From ripley at stats.ox.ac.uk  Tue Apr 18 10:35:28 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 18 Apr 2006 09:35:28 +0100 (BST)
Subject: [Rd] bounding box in PostScript
In-Reply-To: <17476.15129.276232.549991@bossiaea.maths.uwa.edu.au>
References: <5.2.0.9.2.20060417154018.01232ec0@pop.ms.uky.edu>
	<17476.15129.276232.549991@bossiaea.maths.uwa.edu.au>
Message-ID: <Pine.LNX.4.64.0604180925300.19767@gannet.stats.ox.ac.uk>

On Tue, 18 Apr 2006, Berwin A Turlach wrote:

> G'day David,
>
>>>>>> "DA" == David Allen <allen at ms.uky.edu> writes:
>
>    DA> When a graph is saved as PostScript, the bounding box is often
>    DA> too big.  A consequence is that when the graph is included in
>    DA> a LaTeX document, the spacing does not look good.  Is this a
>    DA> recognized problem? Is someone working on it? Could I help?
> How exactly are you saving the graph as PostScript?
>
> I guess the problem is due to the fact that you save the PostScript
> picture on a paper according to your default paper size (which is "a4"
> for me).  To create PostScript pictures with reasonalbe tight bounding
> boxes that are suitable to be included in a LaTeX document you should
> specify `paper=special' and then define your plotting area via the
> 'height' and 'width' argument.

To clarify, the bounding box is always for the device region, not the 
paper, even when (as by default) the device region is centred on the paper 
with 0.25" margins.  The problems with just using postscript() are

1) The plot is rotated (the default for 'horizontal').
2) The text is too normally small for inclusion in other documents, since 
the size is chosen to be appropriate for a whole-page plot.
3) The header may cause the including application not to use the bounding 
box, but for example the DocumentMedia or some inbuilt assumption.

I am pretty sure the perceived problem is the margins on the figure 
region, and the appropriate way is to reduce those vai par(mar=).  (I do 
that for all my books.)

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From maechler at stat.math.ethz.ch  Tue Apr 18 11:27:34 2006
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Tue, 18 Apr 2006 11:27:34 +0200
Subject: [Rd] Attaching Files for the mailing lists
In-Reply-To: <200604172117.30359.thomas.friedrichsmeier@ruhr-uni-bochum.de>
References: <200604170334.14003.thomas.friedrichsmeier@ruhr-uni-bochum.de>
	<200604171520.51565.thomas.friedrichsmeier@ruhr-uni-bochum.de>
	<200604172111.58597.thomas.friedrichsmeier@ruhr-uni-bochum.de>
	<200604172117.30359.thomas.friedrichsmeier@ruhr-uni-bochum.de>
Message-ID: <17476.45318.457325.670798@stat.math.ethz.ch>


>> Sorry, I wasn't aware, .c files would be scrubbed. Testcase available for=20
>> download here:
>> http://rkward.sourceforge.net/temp/threadEmbed.c

It's not the file extension nor the real content that counts; 
rather it's the (MIME) 'content-type' which matters:
You can well have text attachments such as *.c files --- as long
as you (i.e. your e-mail client) use  "content-type: text/plain".

Martin Maechler, ETH Zurich
(Mailman manager for the R mailing lists)


From kat at dfu.min.dk  Tue Apr 18 14:10:00 2006
From: kat at dfu.min.dk (kat at dfu.min.dk)
Date: Tue, 18 Apr 2006 14:10:00 +0200 (CEST)
Subject: [Rd] xyplot (PR#8778)
Message-ID: <20060418121000.0F6EC19843@slim.kubism.ku.dk>

Full_Name: Katell Hamon
Version: 2.2.1
OS: windows
Submission from: (NULL) (130.226.135.149)


I have a problem in : 
                 xyplot(df[,v] ~ df$year ,
                        [....]
                       )
 the error is "Error in df[, v] : object is not subsettable" 
but this used to run well with versions of R before R 2.1.1
it seems to be a problem with the new way of handling xyplots

Hope you'll be able to help me

Regards

Katell


From ripley at stats.ox.ac.uk  Tue Apr 18 14:15:15 2006
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Tue, 18 Apr 2006 14:15:15 +0200 (CEST)
Subject: [Rd] xyplot (PR#8778)
Message-ID: <20060418121515.092F51983E@slim.kubism.ku.dk>

xyplot is in the contributed package lattice, so this the wrong place to 
report.

In any case, whoever needs to look at this (in this case, the package 
maintainer) needs a reproducible example.

On Tue, 18 Apr 2006, kat at dfu.min.dk wrote:

> Full_Name: Katell Hamon
> Version: 2.2.1
> OS: windows
> Submission from: (NULL) (130.226.135.149)
>
>
> I have a problem in :
>                 xyplot(df[,v] ~ df$year ,
>                        [....]
>                       )
> the error is "Error in df[, v] : object is not subsettable"
> but this used to run well with versions of R before R 2.1.1
> it seems to be a problem with the new way of handling xyplots
>
> Hope you'll be able to help me
>
> Regards
>
> Katell
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From p.dalgaard at biostat.ku.dk  Tue Apr 18 14:50:33 2006
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: 18 Apr 2006 14:50:33 +0200
Subject: [Rd] xyplot (PR#8778)
In-Reply-To: <20060418121515.092F51983E@slim.kubism.ku.dk>
References: <20060418121515.092F51983E@slim.kubism.ku.dk>
Message-ID: <x2fykbgi92.fsf@turmalin.kubism.ku.dk>

ripley at stats.ox.ac.uk writes:

> xyplot is in the contributed package lattice, so this the wrong place to 
> report.
> 
> In any case, whoever needs to look at this (in this case, the package 
> maintainer) needs a reproducible example.

Also, check whether the name "df" matters. It could be a search order
issue and that you're subsetting the df() function....
 
> On Tue, 18 Apr 2006, kat at dfu.min.dk wrote:
> 
> > Full_Name: Katell Hamon
> > Version: 2.2.1
> > OS: windows
> > Submission from: (NULL) (130.226.135.149)
> >
> >
> > I have a problem in :
> >                 xyplot(df[,v] ~ df$year ,
> >                        [....]
> >                       )
> > the error is "Error in df[, v] : object is not subsettable"
> > but this used to run well with versions of R before R 2.1.1
> > it seems to be a problem with the new way of handling xyplots
> >
> > Hope you'll be able to help me
> >
> > Regards
> >
> > Katell
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >
> >
> 
> -- 
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From Johannes.Prix at wu-wien.ac.at  Tue Apr 18 18:19:10 2006
From: Johannes.Prix at wu-wien.ac.at (Johannes.Prix at wu-wien.ac.at)
Date: Tue, 18 Apr 2006 18:19:10 +0200 (CEST)
Subject: [Rd] seq() function accuracy inacceptable (PR#8779)
Message-ID: <20060418161910.E35EA1983E@slim.kubism.ku.dk>

Full_Name: Johannes Prix
Version: 2.1.1
OS: WinXP, SuSE Linux
Submission from: (NULL) (137.208.41.195)



The seq-command produces unnescessary inaccurate results, which can be extremely
annoying.  I absolutely do not see the nescessity of numerical garbage to appear
in the following simple case.  E.g. try this:

> seq ( 61.55 , 62.00 , by=0.01 ) - round ( seq ( 61.55 , 62.00 , by=0.01 ) ,
digits=2 )

Output looks like:

 [1]  0.000000e+00 -7.105427e-15  0.000000e+00  0.000000e+00 -7.105427e-15
-7.105427e-15  0.000000e+00  0.000000e+00
 [9] -7.105427e-15  0.000000e+00  0.000000e+00  0.000000e+00 -7.105427e-15 
0.000000e+00  0.000000e+00 -7.105427e-15
[17] -7.105427e-15  0.000000e+00  0.000000e+00 -7.105427e-15  0.000000e+00 
0.000000e+00 -7.105427e-15 -7.105427e-15
[25]  0.000000e+00  0.000000e+00 -7.105427e-15  0.000000e+00  0.000000e+00
-7.105427e-15 -7.105427e-15  0.000000e+00
[33]  0.000000e+00 -7.105427e-15  0.000000e+00  0.000000e+00  0.000000e+00
-7.105427e-15  0.000000e+00  0.000000e+00
[41] -7.105427e-15 -7.105427e-15  0.000000e+00  0.000000e+00 -7.105427e-15 
0.000000e+00
> 

It is particularly dangerous to use such seq()-contructed lists (without
rounding) when e.g. trying to find the first time a given number appears in the
list and the number is given without numerical garbage.


From hb at stat.berkeley.edu  Tue Apr 18 18:35:11 2006
From: hb at stat.berkeley.edu (Henrik Bengtsson (max 7Mb))
Date: Tue, 18 Apr 2006 09:35:11 -0700
Subject: [Rd] seq() function accuracy inacceptable (PR#8779)
In-Reply-To: <20060418161910.E35EA1983E@slim.kubism.ku.dk>
References: <20060418161910.E35EA1983E@slim.kubism.ku.dk>
Message-ID: <59d7961d0604180935m4996feb4oeaf45faaa005b968@mail.gmail.com>

On 4/18/06, Johannes.Prix at wu-wien.ac.at <Johannes.Prix at wu-wien.ac.at> wrote:
> Full_Name: Johannes Prix
> Version: 2.1.1
> OS: WinXP, SuSE Linux
> Submission from: (NULL) (137.208.41.195)
>
>
>
> The seq-command produces unnescessary inaccurate results, which can be extremely
> annoying.  I absolutely do not see the nescessity of numerical garbage to appear
> in the following simple case.  E.g. try this:
>
> > seq ( 61.55 , 62.00 , by=0.01 ) - round ( seq ( 61.55 , 62.00 , by=0.01 ) ,
> digits=2 )
>
> Output looks like:
>
>  [1]  0.000000e+00 -7.105427e-15  0.000000e+00  0.000000e+00 -7.105427e-15
> -7.105427e-15  0.000000e+00  0.000000e+00
>  [9] -7.105427e-15  0.000000e+00  0.000000e+00  0.000000e+00 -7.105427e-15
> 0.000000e+00  0.000000e+00 -7.105427e-15
> [17] -7.105427e-15  0.000000e+00  0.000000e+00 -7.105427e-15  0.000000e+00
> 0.000000e+00 -7.105427e-15 -7.105427e-15
> [25]  0.000000e+00  0.000000e+00 -7.105427e-15  0.000000e+00  0.000000e+00
> -7.105427e-15 -7.105427e-15  0.000000e+00
> [33]  0.000000e+00 -7.105427e-15  0.000000e+00  0.000000e+00  0.000000e+00
> -7.105427e-15  0.000000e+00  0.000000e+00
> [41] -7.105427e-15 -7.105427e-15  0.000000e+00  0.000000e+00 -7.105427e-15
> 0.000000e+00
> >
>
> It is particularly dangerous to use such seq()-contructed lists (without
> rounding) when e.g. trying to find the first time a given number appears in the
> list and the number is given without numerical garbage.

Hmmm... I guess I'm the first on this one.  It is not garbage, it is
just the nearest number the computer can calculate given your
instructions. It has all to do about numerical precision, and
representation of numbers in a computer, e.g. 0.1 base 10 can not be
represented exactly in binary format.  For example, how do you write
1/3 (in base 10) on a piece of paper without using rational
representation?  In base 3 it is 0.1 sharp!  Look in the r-help
archive and you'll find tons of questions like yours and even more
answers.

For this reason, don't compare doubles using "==", that is very risky!
 Instead check if it is close enough, e.g. abs(x-y) < eps or
all.equal(x,y) or similar.

/Henrik


> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


--
Henrik Bengtsson
Mobile: +46 708 909208 (+2h UTC)


From allen at ms.uky.edu  Tue Apr 18 19:02:55 2006
From: allen at ms.uky.edu (David Allen)
Date: Tue, 18 Apr 2006 13:02:55 -0400
Subject: [Rd] bounding box in PostScript
In-Reply-To: <Pine.LNX.4.64.0604180925300.19767@gannet.stats.ox.ac.uk>
References: <17476.15129.276232.549991@bossiaea.maths.uwa.edu.au>
	<5.2.0.9.2.20060417154018.01232ec0@pop.ms.uky.edu>
	<17476.15129.276232.549991@bossiaea.maths.uwa.edu.au>
Message-ID: <5.2.0.9.2.20060418130042.01234130@pop.ms.uky.edu>

Thanks to all who replied. I will try par(mar=).

David


From tlumley at u.washington.edu  Tue Apr 18 20:04:18 2006
From: tlumley at u.washington.edu (Thomas Lumley)
Date: Tue, 18 Apr 2006 11:04:18 -0700 (PDT)
Subject: [Rd] seq() function accuracy inacceptable
Message-ID: <Pine.LNX.4.64.0604180958110.25300@homer22.u.washington.edu>

> The seq-command produces unnescessary inaccurate results, which can be extremely
> annoying.  I absolutely do not see the nescessity of numerical garbage 
> to appear in the following simple case.  E.g. try this:
> > seq ( 61.55 , 62.00 , by=0.01 ) - round ( seq ( 61.55 , 62.00 , by=0.01 ) ,
> digits=2 )

An even simpler case may help explain why this is not *unnecessary*
inaccuracy.

Consider the three expressions
   2+0.01+0.01
   2+0.01*2
   2.02

These need not give the same answer. As it happens, on my computer 2.02 
and 2+0.01*2 are the same, but they differ by the smallest representable 
amount from 2+0.01+0.01. All three could be different in other examples.

Since you think the correct output of seq() is easy to determine, which of 
these should be equal to the third element of seq(2, 3, by=0.01)?


By the way, seq() is an interesting example, because the code goes to some 
effort to do the sort of thing you want. It is designed to give less 
accurate answers so as to be consistent with naive expectations when 
'to'-'from' is close to a multiple of 'by'. This doesn't affect your 
example, but if you had used seq(61.56,62,by=0.01) you would have 
benefitted from the fact that, although (62-61.56)/0.01 is very slightly 
less than 44, seq() still includes the 44th step.  In general, though, R 
is better off using as much accuracy as possible for a given computation 
rather than trying to guess what a user will want to use it for.


 	-thomas

Thomas Lumley			Assoc. Professor, Biostatistics
tlumley at u.washington.edu	University of Washington, Seattle


From htang at hpl.hp.com  Tue Apr 18 23:43:15 2006
From: htang at hpl.hp.com (htang at hpl.hp.com)
Date: Tue, 18 Apr 2006 23:43:15 +0200 (CEST)
Subject: [Rd] typos in src/main/gram.y (PR#8780)
Message-ID: <20060418214315.D484315ABF@slim.kubism.ku.dk>

In src/main/gram.y, the documentation for R_ParseVector has a wrong
signature:

SEXP R_ParseVector(TextBuffer *text, int n, ParseStatus *status)

should be

SEXP R_ParseVector(SEXP text, int n, ParseStatus *status)

In addition, the two occurrences of "IOBuffer" in the documentation
should be replaced by "IoBuffer".

version.string = Version 2.3.0 beta (2006-04-14 r37779)

Best,
Hsiu-Khuern Tang
HP Labs


From Peter.Ruckdeschel at uni-bayreuth.de  Wed Apr 19 00:59:39 2006
From: Peter.Ruckdeschel at uni-bayreuth.de (Peter Ruckdeschel)
Date: Wed, 19 Apr 2006 00:59:39 +0200
Subject: [Rd] Wishlist: 'quietly' argument for .onAttach() / .First.lib()
Message-ID: <44456F5B.2030405@uni-bayreuth.de>

Summing up the discussions in this thread, I have built a package
'startupmsg' available (in a first version) for the moment at

http://www.uni-bayreuth.de/departments/math/org/mathe7/R-devel/startupmsg_0.1.tar.gz

(see documentation within)

In particular, I took up suggestions from Seth Falcon's mail as to the
condition system
in R as well as a  suggestion by Brian Ripley in some earlier reply in
this thread
to use options() to control start-up messages.

Any comments/suggestions are welcome.

If you find 'startupmsg' useful, you might decide to integrate (parts
of) it to the
'utils' package  (or some yet to be built package "packageutils" ) later
on ---
for the moment, I would simply submit it to CRAN in the next days.

Best,
Peter

Seth Falcon <sfalcon at fhcrc.org> writes:
>Paul Roebuck <roebuck at mdanderson.org> writes:
>>Prof Brian Ripley <ripley at stats.ox.ac.uk> writes:
>>> Similarly for Bill Dunlap's proposal: suppressMessages would squelch all
>>> messages from the call, not just the one from your package's startup
code.
>>> Now, at present there may not be any, but that could well change as
>>> message() gets more widely used.
>>
>> I found Bill's suggestion a bit scary myself; suppressing messages
>> when dealing with loading packages seems a bit like disabling the
>> compiler's warning messages - a bad idea. But it was a novel
>> approach.
>
>What's the use case where this would be scary?  suppressMessages
>doesn't supress warnings or errors, just messages.  If the info to be
>communicated to the user is important enough that it would be "scary"
>to not see it, then shouldn't it sent as a a warning or an error?
>
>> Given what you said above, do you favor the suggestion to use
>> message() instead of cat() for the purpose of .onAttach() startup
>> messages? I've seen message() before in the manpages but never saw
>> any documentation on how or when it might be considered appropriate
>> to use.

[...]

>>>>>> On Thu, 13 Apr 2006, Prof Brian Ripley wrote:
>>>>>>> I did think you could make use of an option to decide whether to
>>>>>>> the print the message or not, [snip]

[...]

>> Why would one want to represent a simple non-error message as a
>> condition in the first place?
>
>Because it allows another developer to have control over those
>messages.  That's the beauty of the condition system in R.  
>
>Right now, developers can choose to allow or suppress messages sent
>via message().  With a small change, developers could have a lot more
>control.  The message code could define a restart that would allow a
>developer-specified function to handle the message.  This could be
>useful, for example, to log all messages to a file.

[snip]

>For anyone still with me:
>
>* If there was much concern about squelching "important" messages by
>  accident, then one could define a new subclass of simpleMessage, say
>  startupMessage or blatherMessage, and then suppress just those.
>
>* This use case of handling messages could also be addressed with a
>  logging system like Python's logging module.  Basically, it would
>  allow users to install log handlers, set priorities, etc.


From Peter.Ruckdeschel at uni-bayreuth.de  Wed Apr 19 01:02:24 2006
From: Peter.Ruckdeschel at uni-bayreuth.de (Peter Ruckdeschel)
Date: Wed, 19 Apr 2006 01:02:24 +0200
Subject: [Rd] Wishlist for promptPackage / index
Message-ID: <44457000.4050406@uni-bayreuth.de>

Hi R-devels,

would it be possible to enhance either promptPackage()
or the default indexing mechanism for packages
so that -- if it exists -- (the contents of) file
<pkgname>-package.Rd is sorted first in
 
  * the .dvi / .pdf  documentation file
  * the .chm  documentation file
  * the package 00index.html  documentation file

?

So far I found the following "hand-made" solution for me:
(1) rename the <pkgname>-package.Rd file to, say,
 0<pkgname>-package.Rd
(2) change the \name -field to
       \name{(<pkgname>-package)}
(note the parentheses in order to sort this file before
 any operators like "+", "-" etc..)

This is probably not quite the way it should be, but
at least it works under my standard-settings.

A more refined strategy would probably also take
into account something like a Collate field in
the DESCRIPTION field.

What is the opinion of R-Core to this question?

Thank you already
Peter


From blindglobe at gmail.com  Wed Apr 19 01:11:13 2006
From: blindglobe at gmail.com (A.J. Rossini)
Date: Wed, 19 Apr 2006 01:11:13 +0200
Subject: [Rd] Embedding, core dumps, etc.
Message-ID: <1abe3fa90604181611q25a01916y5e06a679969f669@mail.gmail.com>

Well, nothing has changed in the issues that I brought up earlier,
except that I can confirm core dumps in non-threaded lisps as well
(CLISP), using svn version 37840 (this morning, Seattle time) for
R-2-3-patches.   I've not tried Thomas' suggested fixes, as I'm
hesistant to go down the road of fixing R in such a way that would
require constant patching.

(so for those counting, neither CLISP, CMUCL, nor SBCL can embed
R-2-3-patches using CFFI on (2 distros of) i386 Linux; all abort and
offer to dump core nearly instantly after initialization).   All work
with R-2-2-patches.

For me, this is a serious bug.   I suppose other people can define it
in other ways, using terms such as "feature" or "documented".  For
various reasons (see the last bug report I submitted for details), I'm
not going to submit to R-bugs, since by definition, it isn't an R-bug.

best,
-tony

blindglobe at gmail.com
Muttenz, Switzerland.
"Commit early,commit often, and commit in a repository from which we
can easily roll-back your mistakes" (AJR, 4Jan05).


From murdoch at stats.uwo.ca  Wed Apr 19 01:49:10 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Tue, 18 Apr 2006 19:49:10 -0400
Subject: [Rd] Wishlist for promptPackage / index
In-Reply-To: <44457000.4050406@uni-bayreuth.de>
References: <44457000.4050406@uni-bayreuth.de>
Message-ID: <44457AF6.9060000@stats.uwo.ca>

On 4/18/2006 7:02 PM, Peter Ruckdeschel wrote:
> Hi R-devels,
> 
> would it be possible to enhance either promptPackage()
> or the default indexing mechanism for packages
> so that -- if it exists -- (the contents of) file
> <pkgname>-package.Rd is sorted first in
>  
>   * the .dvi / .pdf  documentation file
>   * the .chm  documentation file
>   * the package 00index.html  documentation file

They already sort first in the last of those.  I don't think it is 
really possible in the index of a .chm file; they are alphabetical 
sorting only, as far as I know.  (The package topic does sort first in 
the main contents page, which is the same as the 00index.html file.)

It probably makes sense in a .dvi/.pdf, but as far as I recall, at the 
time I thought those were produced by the shell script for Rd2dvi, and 
it just seemed like too much trouble to change the collation order 
there.  In fact, now I look closer I see they are produced by the Perl 
script tools/pkg2tex.pl so it shouldn't be hard to port the changes I 
made to Rdlists.pm over.  I'll take a look.

Duncan Murdoch


> ?
> 
> So far I found the following "hand-made" solution for me:
> (1) rename the <pkgname>-package.Rd file to, say,
>  0<pkgname>-package.Rd
> (2) change the \name -field to
>        \name{(<pkgname>-package)}
> (note the parentheses in order to sort this file before
>  any operators like "+", "-" etc..)
> 
> This is probably not quite the way it should be, but
> at least it works under my standard-settings.
> 
> A more refined strategy would probably also take
> into account something like a Collate field in
> the DESCRIPTION field.
> 
> What is the opinion of R-Core to this question?
> 
> Thank you already
> Peter
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From macq at llnl.gov  Wed Apr 19 03:47:29 2006
From: macq at llnl.gov (Don MacQueen)
Date: Tue, 18 Apr 2006 18:47:29 -0700
Subject: [Rd] seq() function accuracy inacceptable
In-Reply-To: <20060418161910.E35EA1983E@slim.kubism.ku.dk>
References: <20060418161910.E35EA1983E@slim.kubism.ku.dk>
Message-ID: <p06230901c06b43a652d3@[192.168.2.7]>

Another thing to notice (rather than, it would seem, assume), is that 
using round() doesn't do any "better":

### without rounding
>  print(seq(61.55, 61.59, by=.01) , digits=22)
[1] 61.549999999999997 61.559999999999995 61.570000000000000 61.579999999999998
[5] 61.589999999999996

### with rounding
>  print(round(seq(61.55, 61.59, by=.01),2) , digits=22)
[1] 61.549999999999997 61.560000000000002 61.570000000000000 61.579999999999998
[5] 61.590000000000003

As Thomas and Henrik said, the sequence has to be calculated, and 
such calculations are not, and can not be, exact.

-Don

At 6:19 PM +0200 4/18/06, Johannes.Prix at wu-wien.ac.at wrote:
>Full_Name: Johannes Prix
>Version: 2.1.1
>OS: WinXP, SuSE Linux
>Submission from: (NULL) (137.208.41.195)
>
>
>
>The seq-command produces unnescessary inaccurate results, which can 
>be extremely
>annoying.  I absolutely do not see the nescessity of numerical 
>garbage to appear
>in the following simple case.  E.g. try this:
>
>>  seq ( 61.55 , 62.00 , by=0.01 ) - round ( seq ( 61.55 , 62.00 , by=0.01 ) ,
>digits=2 )
>
>Output looks like:
>
>  [1]  0.000000e+00 -7.105427e-15  0.000000e+00  0.000000e+00 -7.105427e-15
>-7.105427e-15  0.000000e+00  0.000000e+00
>  [9] -7.105427e-15  0.000000e+00  0.000000e+00  0.000000e+00 -7.105427e-15
>0.000000e+00  0.000000e+00 -7.105427e-15
>[17] -7.105427e-15  0.000000e+00  0.000000e+00 -7.105427e-15  0.000000e+00
>0.000000e+00 -7.105427e-15 -7.105427e-15
>[25]  0.000000e+00  0.000000e+00 -7.105427e-15  0.000000e+00  0.000000e+00
>-7.105427e-15 -7.105427e-15  0.000000e+00
>[33]  0.000000e+00 -7.105427e-15  0.000000e+00  0.000000e+00  0.000000e+00
>-7.105427e-15  0.000000e+00  0.000000e+00
>[41] -7.105427e-15 -7.105427e-15  0.000000e+00  0.000000e+00 -7.105427e-15
>0.000000e+00
>>
>
>It is particularly dangerous to use such seq()-contructed lists (without
>rounding) when e.g. trying to find the first time a given number 
>appears in the
>list and the number is given without numerical garbage.
>
>______________________________________________
>R-devel at r-project.org mailing list
>https://stat.ethz.ch/mailman/listinfo/r-devel


-- 
---------------------------------
Don MacQueen
Lawrence Livermore National Laboratory
Livermore, CA, USA


From ggrothendieck at gmail.com  Wed Apr 19 04:17:54 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Tue, 18 Apr 2006 22:17:54 -0400
Subject: [Rd] seq() function accuracy inacceptable (PR#8779)
In-Reply-To: <20060418161910.E35EA1983E@slim.kubism.ku.dk>
References: <20060418161910.E35EA1983E@slim.kubism.ku.dk>
Message-ID: <971536df0604181917w5c60d6f3v63c2439a3b72bc90@mail.gmail.com>

This is related to this FAQ:

http://stat.cmu.edu/R/CRAN/doc/FAQ/R-FAQ.html#Why-doesn_0027t-R-think-these-numbers-are-equal_003f

What you can do is create the sequence of integers from 6155 to 6200
rather than using floats and then divide by 100 in your subsequent
calculation.  Until the point you divide by 100, your numbers will be
exact.

> 6155:6200
 [1] 6155 6156 6157 6158 6159 6160 6161 6162 6163 6164 6165 6166 6167 6168 6169
[16] 6170 6171 6172 6173 6174 6175 6176 6177 6178 6179 6180 6181 6182 6183 6184
[31] 6185 6186 6187 6188 6189 6190 6191 6192 6193 6194 6195 6196 6197 6198 6199
[46] 6200
> class(6155:6200)
[1] "integer"


On 4/18/06, Johannes.Prix at wu-wien.ac.at <Johannes.Prix at wu-wien.ac.at> wrote:
> Full_Name: Johannes Prix
> Version: 2.1.1
> OS: WinXP, SuSE Linux
> Submission from: (NULL) (137.208.41.195)
>
>
>
> The seq-command produces unnescessary inaccurate results, which can be extremely
> annoying.  I absolutely do not see the nescessity of numerical garbage to appear
> in the following simple case.  E.g. try this:
>
> > seq ( 61.55 , 62.00 , by=0.01 ) - round ( seq ( 61.55 , 62.00 , by=0.01 ) ,
> digits=2 )
>
> Output looks like:
>
>  [1]  0.000000e+00 -7.105427e-15  0.000000e+00  0.000000e+00 -7.105427e-15
> -7.105427e-15  0.000000e+00  0.000000e+00
>  [9] -7.105427e-15  0.000000e+00  0.000000e+00  0.000000e+00 -7.105427e-15
> 0.000000e+00  0.000000e+00 -7.105427e-15
> [17] -7.105427e-15  0.000000e+00  0.000000e+00 -7.105427e-15  0.000000e+00
> 0.000000e+00 -7.105427e-15 -7.105427e-15
> [25]  0.000000e+00  0.000000e+00 -7.105427e-15  0.000000e+00  0.000000e+00
> -7.105427e-15 -7.105427e-15  0.000000e+00
> [33]  0.000000e+00 -7.105427e-15  0.000000e+00  0.000000e+00  0.000000e+00
> -7.105427e-15  0.000000e+00  0.000000e+00
> [41] -7.105427e-15 -7.105427e-15  0.000000e+00  0.000000e+00 -7.105427e-15
> 0.000000e+00
> >
>
> It is particularly dangerous to use such seq()-contructed lists (without
> rounding) when e.g. trying to find the first time a given number appears in the
> list and the number is given without numerical garbage.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From sfalcon at fhcrc.org  Wed Apr 19 05:58:07 2006
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Tue, 18 Apr 2006 20:58:07 -0700
Subject: [Rd] Wishlist: 'quietly' argument for .onAttach() / .First.lib()
In-Reply-To: <44456F5B.2030405@uni-bayreuth.de> (Peter Ruckdeschel's message
	of "Wed, 19 Apr 2006 00:59:39 +0200")
References: <44456F5B.2030405@uni-bayreuth.de>
Message-ID: <m27j5mmd2o.fsf@ziti.local>

Peter Ruckdeschel <Peter.Ruckdeschel at uni-bayreuth.de> writes:

> Summing up the discussions in this thread, I have built a package
> 'startupmsg' available (in a first version) for the moment at
>
> http://www.uni-bayreuth.de/departments/math/org/mathe7/R-devel/startupmsg_0.1.tar.gz
>
> (see documentation within)
>
> In particular, I took up suggestions from Seth Falcon's mail as to the
> condition system
> in R as well as a  suggestion by Brian Ripley in some earlier reply in
> this thread
> to use options() to control start-up messages.
>
> Any comments/suggestions are welcome.

It's nice to see code instead of discussion :-)

I had a quick look and for what it's worth, a few comments...

* Seems a bit more code than I would expect.  I think you have some
  use cases that I don't have ;-).  In terms of general use, I would
  suggest making a stab at a simplified version.  For example, what's
  the difference between startupMessage and startupVersionMessage; are
  both needed?  And linestarter?

* Consider adding a customizable restart.  As it stands, startupmsg
  doesn't give a user more control than message().  That is, you can
  either muffle the messages or not.  If I want to write them to a
  file or prefix them with funny characters, doing so by grabbing hold
  of the message before it is emitted via the restart seems like a
  nice approach (although one could argue for a more general system
  logging system that probably would not need the fancy condition
  system use).

Thanks for sharing your code.


Cheers,

+ seth


From ripley at stats.ox.ac.uk  Wed Apr 19 08:08:52 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 19 Apr 2006 07:08:52 +0100 (BST)
Subject: [Rd] Embedding, core dumps, etc.
In-Reply-To: <1abe3fa90604181611q25a01916y5e06a679969f669@mail.gmail.com>
References: <1abe3fa90604181611q25a01916y5e06a679969f669@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0604190705400.3286@gannet.stats.ox.ac.uk>

Tony,

It is possible to turn stack checking off by setting R_CStackLimit = -1 in 
the embedding application: it works for me, so can you please try it?

Brian

On Wed, 19 Apr 2006, A.J. Rossini wrote:

> Well, nothing has changed in the issues that I brought up earlier,
> except that I can confirm core dumps in non-threaded lisps as well
> (CLISP), using svn version 37840 (this morning, Seattle time) for
> R-2-3-patches.   I've not tried Thomas' suggested fixes, as I'm
> hesistant to go down the road of fixing R in such a way that would
> require constant patching.
>
> (so for those counting, neither CLISP, CMUCL, nor SBCL can embed
> R-2-3-patches using CFFI on (2 distros of) i386 Linux; all abort and
> offer to dump core nearly instantly after initialization).   All work
> with R-2-2-patches.
>
> For me, this is a serious bug.   I suppose other people can define it
> in other ways, using terms such as "feature" or "documented".  For
> various reasons (see the last bug report I submitted for details), I'm
> not going to submit to R-bugs, since by definition, it isn't an R-bug.
>
> best,
> -tony
>
> blindglobe at gmail.com
> Muttenz, Switzerland.
> "Commit early,commit often, and commit in a repository from which we
> can easily roll-back your mistakes" (AJR, 4Jan05).
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Wed Apr 19 08:19:18 2006
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Wed, 19 Apr 2006 08:19:18 +0200 (CEST)
Subject: [Rd] typos in src/main/gram.y (PR#8780)
Message-ID: <20060419061918.DC6E94423F@slim.kubism.ku.dk>

By `documentation' do you mean `comments in the file'?  If so, this is too 
minor to change whilst R 2.3.0 is in code freeze, but has been changed for 
R-devel.

If not, please can we have a more precise indication of where you are 
refering to?

On Tue, 18 Apr 2006, htang at hpl.hp.com wrote:

> In src/main/gram.y, the documentation for R_ParseVector has a wrong
> signature:
>
> SEXP R_ParseVector(TextBuffer *text, int n, ParseStatus *status)
>
> should be
>
> SEXP R_ParseVector(SEXP text, int n, ParseStatus *status)
>
> In addition, the two occurrences of "IOBuffer" in the documentation
> should be replaced by "IoBuffer".
>
> version.string = Version 2.3.0 beta (2006-04-14 r37779)
>
> Best,
> Hsiu-Khuern Tang
> HP Labs
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From blindglobe at gmail.com  Wed Apr 19 08:20:45 2006
From: blindglobe at gmail.com (A.J. Rossini)
Date: Wed, 19 Apr 2006 08:20:45 +0200
Subject: [Rd] Embedding, core dumps, etc.
In-Reply-To: <Pine.LNX.4.64.0604190705400.3286@gannet.stats.ox.ac.uk>
References: <1abe3fa90604181611q25a01916y5e06a679969f669@mail.gmail.com>
	<Pine.LNX.4.64.0604190705400.3286@gannet.stats.ox.ac.uk>
Message-ID: <1abe3fa90604182320q7481e44ci51fe23a69db60a8@mail.gmail.com>

It doesn't seem to help.  I suspect it is more related to signal
handling changes than the stack.  Note that I dropped that from the
subject line for my email which started this thread, but I agree, I
didn't mention signal handing.

On 4/19/06, Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
> Tony,
>
> It is possible to turn stack checking off by setting R_CStackLimit = -1 in
> the embedding application: it works for me, so can you please try it?
>
> Brian
>
> On Wed, 19 Apr 2006, A.J. Rossini wrote:
>
> > Well, nothing has changed in the issues that I brought up earlier,
> > except that I can confirm core dumps in non-threaded lisps as well
> > (CLISP), using svn version 37840 (this morning, Seattle time) for
> > R-2-3-patches.   I've not tried Thomas' suggested fixes, as I'm
> > hesistant to go down the road of fixing R in such a way that would
> > require constant patching.
> >
> > (so for those counting, neither CLISP, CMUCL, nor SBCL can embed
> > R-2-3-patches using CFFI on (2 distros of) i386 Linux; all abort and
> > offer to dump core nearly instantly after initialization).   All work
> > with R-2-2-patches.
> >
> > For me, this is a serious bug.   I suppose other people can define it
> > in other ways, using terms such as "feature" or "documented".  For
> > various reasons (see the last bug report I submitted for details), I'm
> > not going to submit to R-bugs, since by definition, it isn't an R-bug.
> >
> > best,
> > -tony
> >
> > blindglobe at gmail.com
> > Muttenz, Switzerland.
> > "Commit early,commit often, and commit in a repository from which we
> > can easily roll-back your mistakes" (AJR, 4Jan05).
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >
> >
>
> --
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>


--
best,
-tony

blindglobe at gmail.com
Muttenz, Switzerland.
"Commit early,commit often, and commit in a repository from which we can easily
roll-back your mistakes" (AJR, 4Jan05).


From blindglobe at gmail.com  Wed Apr 19 08:25:56 2006
From: blindglobe at gmail.com (A.J. Rossini)
Date: Wed, 19 Apr 2006 08:25:56 +0200
Subject: [Rd] Embedding, core dumps, etc.
In-Reply-To: <1abe3fa90604182320q7481e44ci51fe23a69db60a8@mail.gmail.com>
References: <1abe3fa90604181611q25a01916y5e06a679969f669@mail.gmail.com>
	<Pine.LNX.4.64.0604190705400.3286@gannet.stats.ox.ac.uk>
	<1abe3fa90604182320q7481e44ci51fe23a69db60a8@mail.gmail.com>
Message-ID: <1abe3fa90604182325n30e2305fr219d716b3481c7f0@mail.gmail.com>

I'm going to recode the sequence in C tommorow (I'm in Seattle right
now, not Basel, so it's late).

if it dumps core under C, it's Lisp, and if it doesn't, it's most likely R.

I'll report back when I get access to the internet tommorow (I'll be
in Iowa, but not sure when I'll get the laptop connected again).

On 4/19/06, A.J. Rossini <blindglobe at gmail.com> wrote:
> It doesn't seem to help.  I suspect it is more related to signal
> handling changes than the stack.  Note that I dropped that from the
> subject line for my email which started this thread, but I agree, I
> didn't mention signal handing.
>
> On 4/19/06, Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
> > Tony,
> >
> > It is possible to turn stack checking off by setting R_CStackLimit = -1 in
> > the embedding application: it works for me, so can you please try it?
> >
> > Brian
> >
> > On Wed, 19 Apr 2006, A.J. Rossini wrote:
> >
> > > Well, nothing has changed in the issues that I brought up earlier,
> > > except that I can confirm core dumps in non-threaded lisps as well
> > > (CLISP), using svn version 37840 (this morning, Seattle time) for
> > > R-2-3-patches.   I've not tried Thomas' suggested fixes, as I'm
> > > hesistant to go down the road of fixing R in such a way that would
> > > require constant patching.
> > >
> > > (so for those counting, neither CLISP, CMUCL, nor SBCL can embed
> > > R-2-3-patches using CFFI on (2 distros of) i386 Linux; all abort and
> > > offer to dump core nearly instantly after initialization).   All work
> > > with R-2-2-patches.
> > >
> > > For me, this is a serious bug.   I suppose other people can define it
> > > in other ways, using terms such as "feature" or "documented".  For
> > > various reasons (see the last bug report I submitted for details), I'm
> > > not going to submit to R-bugs, since by definition, it isn't an R-bug.
> > >
> > > best,
> > > -tony
> > >
> > > blindglobe at gmail.com
> > > Muttenz, Switzerland.
> > > "Commit early,commit often, and commit in a repository from which we
> > > can easily roll-back your mistakes" (AJR, 4Jan05).
> > >
> > > ______________________________________________
> > > R-devel at r-project.org mailing list
> > > https://stat.ethz.ch/mailman/listinfo/r-devel
> > >
> > >
> >
> > --
> > Brian D. Ripley,                  ripley at stats.ox.ac.uk
> > Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> > University of Oxford,             Tel:  +44 1865 272861 (self)
> > 1 South Parks Road,                     +44 1865 272866 (PA)
> > Oxford OX1 3TG, UK                Fax:  +44 1865 272595
> >
>
>
> --
> best,
> -tony
>
> blindglobe at gmail.com
> Muttenz, Switzerland.
> "Commit early,commit often, and commit in a repository from which we can easily
> roll-back your mistakes" (AJR, 4Jan05).
>


--
best,
-tony

blindglobe at gmail.com
Muttenz, Switzerland.
"Commit early,commit often, and commit in a repository from which we can easily
roll-back your mistakes" (AJR, 4Jan05).


From blindglobe at gmail.com  Wed Apr 19 08:28:48 2006
From: blindglobe at gmail.com (A.J. Rossini)
Date: Wed, 19 Apr 2006 08:28:48 +0200
Subject: [Rd] Embedding, core dumps, etc.
In-Reply-To: <1abe3fa90604182325n30e2305fr219d716b3481c7f0@mail.gmail.com>
References: <1abe3fa90604181611q25a01916y5e06a679969f669@mail.gmail.com>
	<Pine.LNX.4.64.0604190705400.3286@gannet.stats.ox.ac.uk>
	<1abe3fa90604182320q7481e44ci51fe23a69db60a8@mail.gmail.com>
	<1abe3fa90604182325n30e2305fr219d716b3481c7f0@mail.gmail.com>
Message-ID: <1abe3fa90604182328l1785e091le7a458a92f9294c0@mail.gmail.com>

I should also make it clear -- while I reported non-fatal stack errors
in the first thread, I'm not seeing them any more, just the core dump.

On 4/19/06, A.J. Rossini <blindglobe at gmail.com> wrote:
> I'm going to recode the sequence in C tommorow (I'm in Seattle right
> now, not Basel, so it's late).
>
> if it dumps core under C, it's Lisp, and if it doesn't, it's most likely R.
>
> I'll report back when I get access to the internet tommorow (I'll be
> in Iowa, but not sure when I'll get the laptop connected again).
>
> On 4/19/06, A.J. Rossini <blindglobe at gmail.com> wrote:
> > It doesn't seem to help.  I suspect it is more related to signal
> > handling changes than the stack.  Note that I dropped that from the
> > subject line for my email which started this thread, but I agree, I
> > didn't mention signal handing.
> >
> > On 4/19/06, Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
> > > Tony,
> > >
> > > It is possible to turn stack checking off by setting R_CStackLimit = -1 in
> > > the embedding application: it works for me, so can you please try it?
> > >
> > > Brian
> > >
> > > On Wed, 19 Apr 2006, A.J. Rossini wrote:
> > >
> > > > Well, nothing has changed in the issues that I brought up earlier,
> > > > except that I can confirm core dumps in non-threaded lisps as well
> > > > (CLISP), using svn version 37840 (this morning, Seattle time) for
> > > > R-2-3-patches.   I've not tried Thomas' suggested fixes, as I'm
> > > > hesistant to go down the road of fixing R in such a way that would
> > > > require constant patching.
> > > >
> > > > (so for those counting, neither CLISP, CMUCL, nor SBCL can embed
> > > > R-2-3-patches using CFFI on (2 distros of) i386 Linux; all abort and
> > > > offer to dump core nearly instantly after initialization).   All work
> > > > with R-2-2-patches.
> > > >
> > > > For me, this is a serious bug.   I suppose other people can define it
> > > > in other ways, using terms such as "feature" or "documented".  For
> > > > various reasons (see the last bug report I submitted for details), I'm
> > > > not going to submit to R-bugs, since by definition, it isn't an R-bug.
> > > >
> > > > best,
> > > > -tony
> > > >
> > > > blindglobe at gmail.com
> > > > Muttenz, Switzerland.
> > > > "Commit early,commit often, and commit in a repository from which we
> > > > can easily roll-back your mistakes" (AJR, 4Jan05).
> > > >
> > > > ______________________________________________
> > > > R-devel at r-project.org mailing list
> > > > https://stat.ethz.ch/mailman/listinfo/r-devel
> > > >
> > > >
> > >
> > > --
> > > Brian D. Ripley,                  ripley at stats.ox.ac.uk
> > > Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> > > University of Oxford,             Tel:  +44 1865 272861 (self)
> > > 1 South Parks Road,                     +44 1865 272866 (PA)
> > > Oxford OX1 3TG, UK                Fax:  +44 1865 272595
> > >
> >
> >
> > --
> > best,
> > -tony
> >
> > blindglobe at gmail.com
> > Muttenz, Switzerland.
> > "Commit early,commit often, and commit in a repository from which we can easily
> > roll-back your mistakes" (AJR, 4Jan05).
> >
>
>
> --
> best,
> -tony
>
> blindglobe at gmail.com
> Muttenz, Switzerland.
> "Commit early,commit often, and commit in a repository from which we can easily
> roll-back your mistakes" (AJR, 4Jan05).
>


--
best,
-tony

blindglobe at gmail.com
Muttenz, Switzerland.
"Commit early,commit often, and commit in a repository from which we can easily
roll-back your mistakes" (AJR, 4Jan05).


From htang at hpl.hp.com  Wed Apr 19 09:19:47 2006
From: htang at hpl.hp.com (htang at hpl.hp.com)
Date: Wed, 19 Apr 2006 09:19:47 +0200 (CEST)
Subject: [Rd] typos in src/main/gram.y (PR#8780)
Message-ID: <20060419071947.2F39F44245@slim.kubism.ku.dk>

* On Wed 07:19AM, 19 Apr 2006, Prof Brian Ripley (ripley at stats.ox.ac.uk) wrote:
> By `documentation' do you mean `comments in the file'?  If so, this is too 
> minor to change whilst R 2.3.0 is in code freeze, but has been changed for 
> R-devel.

Yes, I am referring to the comments in the file src/main/gram.y.  I
agree that these are very minor errors.  I have checked out R-devel and
I see that the changes have been made (as you said).  Thank you!

> [ snipped ]

Best,
Hsiu-Khuern Tang
HP Labs


From phgrosjean at sciviews.org  Wed Apr 19 19:04:15 2006
From: phgrosjean at sciviews.org (Philippe Grosjean)
Date: Wed, 19 Apr 2006 19:04:15 +0200
Subject: [Rd] commercial software selling a R module - question about GPL
 license rights
Message-ID: <44466D8F.5090002@sciviews.org>

Hello all,

Sorry for this email not directly related to R developement. I just come 
from a nice demonstration session from Scitegic about their Pipeline 
Pilot (PP) software, and especially their 'R collection' which brings R 
calculations into the software 
(http://www.scitegic.com/documents/RStats_Collection.pdf).

I looked carefully on the way they do it: they pass data from PP to R 
using text files, they call R.exe using a R script and input - output 
files, like:

R.exe --nosave --no-environ --no-resore-data < script.R > output.txt

And in the script, you have:

read.table(...)

which imports the data just exported from PP in an CVS file by the 
component. I don't want to discuss here the ugly and extremely 
inefficient solution they use to call R on their data, but anyway...

So far, so good, they respect the GPL license since R is not embedded 
into PP, and you have to download and install it separately.

But they also provide a series of "R component" ready to use like 'R 
ANOVA', 'R PCA', R Neural Net', etc... which are basically R scripts 
with replaceable variables (replacement is done by PP before feeding the 
script to the R engine). For instance, you will have:

parameter <- $(PPvariable)

in the R script. In the PP component, you have an option to specify the 
value of 'PPvariable', let's say: PPvariable = 10, and the replacement 
done in the R script is:

parameter <- 10

before to feed this script to R. So, everything appears transparent to 
the end-user who parameterizes the scripts from within the PP GUI. That 
is what they call "each component generates an R script on-the-fly"... 
(sic!)

However, I was suprised to learn that the Pipeline Pilot R Collection is 
not GPL and is not free (in term of money, i.e., you have to pay 
3500$/year to use it). I am not sure, but I think they break the GPL 
license here since they use a commercial license for, basically, a 
collection of R scripts embedded in their 'PP components'.

Anyone with better expertise than me could look at this, please?

Best,

Philippe Grosjean

-- 
..............................................<?}))><........
  ) ) ) ) )
( ( ( ( (    Prof. Philippe Grosjean
  ) ) ) ) )
( ( ( ( (    Numerical Ecology of Aquatic Systems
  ) ) ) ) )   Mons-Hainaut University, Belgium
( ( ( ( (
..............................................................


From Mehdi.Kheloufi-Trabaud at moodys.com  Wed Apr 19 19:36:38 2006
From: Mehdi.Kheloufi-Trabaud at moodys.com (Mehdi.Kheloufi-Trabaud at moodys.com)
Date: Wed, 19 Apr 2006 19:36:38 +0200 (CEST)
Subject: [Rd] Probable Numeric Bugs in svd function (PR#8781)
Message-ID: <20060419173638.1FC2D19843@slim.kubism.ku.dk>

Hello,=0D
=0D
I just noticed that the "svd" function does not work properly for some=0D
sparse matrices.=0D
When I replace the 0 by very small noises (let's say 10^-16), it then=0D
works.=0D
The test I've performed is to compared the singular values to the eigen=0D
values (as I work with squarred matrices).=0D
=0D
Here is the code (I may be wrong!):=0D
=0D
usHigh<-(Sp5>=3D300 & Region=3D=3D1)=0D
usLow<-(Sp5<300 & Region=3D=3D1)=0D
euHigh<-(Sp5>=3D200 & Region=3D=3D2)=0D
euLow<-(Sp5<200 & Region=3D=3D2)=0D
sigmas<-c(13.71,162.71,8.78,103.83,5.29,77.08,3.42,41.04)=0D
temp1<-sigmas[1]*usLow+sigmas[2]*usHigh+sigmas[5]*euLow+sigmas[6]*euHigh=0D
temp10<-sigmas[3]*usLow+sigmas[4]*usHigh+sigmas[7]*euLow+sigmas[8]*euHig=0D
h=0D
CorrEU<-0.89=0D
CorrUS<-0.82=0D
=0D
CorrR<-matrix(0,2*SN.nb,2*SN.nb)=0D
diag(CorrR)<-c(temp1^2,temp10^2)=0D
=0D
temp<-ifelse(Region=3D=3D1,CorrUS,CorrEU)=0D
tempMat<-matrix(0,SN.nb,SN.nb)=0D
diag(tempMat)<-temp*temp1*temp10=0D
CorrR[(SN.nb+1):(2*SN.nb),1:SN.nb]<-tempMat=0D
CorrR[1:SN.nb,(SN.nb+1):(2*SN.nb)]<-tempMat=0D
=0D
CorrR is positive definite but "svd" returns negative singular values!=0D
When replacing 0s by very week noises, the error disppears.=0D
=0D
Hope I'm not saying stupid things.=0D
=0D
Rgds,=0D
=0D
Mehdi=0D
=0D
=0D
=0D
=0D
=0D
=0D
-----------------------------------------=0D
The information contained in this e-mail message, and any=0D
attachment thereto, is confidential and may not be disclosed=0D
without our express permission. If you are not the intended=0D
recipient or an employee or agent responsible for delivering this=0D
message to the intended recipient, you are hereby notified that you=0D
have received this message in error and that any review,=0D
dissemination, distribution or copying of this message, or any=0D
attachment thereto, in whole or in part, is strictly prohibited. If=0D
you have received this message in error, please immediately notify=0D
us by telephone, fax or e-mail and delete the message and all of=0D
its attachments. Thank you. Every effort is made to keep our=0D
network free from viruses. You should, however, review this e-mail=0D
message, as well as any attachment thereto, for viruses. We take no=0D
responsibility and have no liability for any computer virus which=0D
may be transferred via this e-mail message.=0D

	[[alternative HTML version deleted]]


From andy_liaw at merck.com  Wed Apr 19 19:51:36 2006
From: andy_liaw at merck.com (Liaw, Andy)
Date: Wed, 19 Apr 2006 13:51:36 -0400
Subject: [Rd] commercial software selling a R module - question about
 GPL license rights
Message-ID: <39B6DDB9048D0F4DAD42CB26AAFF0AFAFEDADA@usctmx1106.merck.com>

I was under the impression that PP communicates with R via SOAP, but
what do I know...

If I didn't read your description wrong, the "R Collection" contains
PP code (PilotScript?) for generating R code to be run by R, but does
not include R itself.  If that's the case, I don't think it has any 
licensing problem.  If I write some R code that generates SAS code
(God forbid), I doubt that constitute violation of SAS license.

Just my $0.02...

Andy

From: Philippe Grosjean
> 
> Hello all,
> 
> Sorry for this email not directly related to R developement. 
> I just come 
> from a nice demonstration session from Scitegic about their Pipeline 
> Pilot (PP) software, and especially their 'R collection' 
> which brings R 
> calculations into the software 
> (http://www.scitegic.com/documents/RStats_Collection.pdf).
> 
> I looked carefully on the way they do it: they pass data from PP to R 
> using text files, they call R.exe using a R script and input - output 
> files, like:
> 
> R.exe --nosave --no-environ --no-resore-data < script.R > output.txt
> 
> And in the script, you have:
> 
> read.table(...)
> 
> which imports the data just exported from PP in an CVS file by the 
> component. I don't want to discuss here the ugly and extremely 
> inefficient solution they use to call R on their data, but anyway...
> 
> So far, so good, they respect the GPL license since R is not embedded 
> into PP, and you have to download and install it separately.
> 
> But they also provide a series of "R component" ready to use like 'R 
> ANOVA', 'R PCA', R Neural Net', etc... which are basically R scripts 
> with replaceable variables (replacement is done by PP before 
> feeding the 
> script to the R engine). For instance, you will have:
> 
> parameter <- $(PPvariable)
> 
> in the R script. In the PP component, you have an option to 
> specify the 
> value of 'PPvariable', let's say: PPvariable = 10, and the 
> replacement 
> done in the R script is:
> 
> parameter <- 10
> 
> before to feed this script to R. So, everything appears 
> transparent to 
> the end-user who parameterizes the scripts from within the PP 
> GUI. That 
> is what they call "each component generates an R script 
> on-the-fly"... 
> (sic!)
> 
> However, I was suprised to learn that the Pipeline Pilot R 
> Collection is 
> not GPL and is not free (in term of money, i.e., you have to pay 
> 3500$/year to use it). I am not sure, but I think they break the GPL 
> license here since they use a commercial license for, basically, a 
> collection of R scripts embedded in their 'PP components'.
> 
> Anyone with better expertise than me could look at this, please?
> 
> Best,
> 
> Philippe Grosjean
> 
> -- 
> ..............................................<?}))><........
>   ) ) ) ) )
> ( ( ( ( (    Prof. Philippe Grosjean
>   ) ) ) ) )
> ( ( ( ( (    Numerical Ecology of Aquatic Systems
>   ) ) ) ) )   Mons-Hainaut University, Belgium
> ( ( ( ( ( 
> ..............................................................
> 
> ______________________________________________
> R-devel at r-project.org mailing list 
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
>


From Peter.Ruckdeschel at uni-bayreuth.de  Wed Apr 19 20:11:13 2006
From: Peter.Ruckdeschel at uni-bayreuth.de (Peter Ruckdeschel)
Date: Wed, 19 Apr 2006 20:11:13 +0200
Subject: [Rd] Wishlist for promptPackage / index
Message-ID: <44467D41.4020401@uni-bayreuth.de>

On 4/19/2006 1:49 AM, Duncan Murdoch wrote:

>On 4/18/2006 7:02 PM, Peter Ruckdeschel wrote:
>> would it be possible to enhance either promptPackage()
>> or the default indexing mechanism for packages
>> so that -- if it exists -- (the contents of) file
>> <pkgname>-package.Rd is sorted first in
>>
>>   * the .dvi / .pdf  documentation file
>>   * the .chm  documentation file
>>   * the package 00index.html  documentation file

>They already sort first in the last of those.  I don't think it is
>really possible in the index of a .chm file; they are alphabetical
>sorting only, as far as I know.  (The package topic does sort first in
>the main contents page, which is the same as the 00index.html file.)

Yes, you are right: the first two cases are already settled
in a completely satisfying way [even with "+","-"-type methods!].

Sorry to have stirred you up --- I should have tried first.

>It probably makes sense in a .dvi/.pdf,

I tried out with an example now:
at least for this case my request still applies ...

>but as far as I recall, at the time I thought those were produced
>by the shell script for Rd2dvi, and it just seemed like too much trouble
>to change the collation order there.
>In fact, now I look closer I see they are produced by the Perl
>script tools/pkg2tex.pl so it shouldn't be hard to port the changes I
>made to Rdlists.pm over.  I'll take a look.

would be very nice; thank you very much
Peter


From p.dalgaard at biostat.ku.dk  Wed Apr 19 20:28:53 2006
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: 19 Apr 2006 20:28:53 +0200
Subject: [Rd] commercial software selling a R module - question about
	GPL license rights
In-Reply-To: <44466D8F.5090002@sciviews.org>
References: <44466D8F.5090002@sciviews.org>
Message-ID: <x2odyxs9lm.fsf@turmalin.kubism.ku.dk>

Philippe Grosjean <phgrosjean at sciviews.org> writes:

> Hello all,
> 
> Sorry for this email not directly related to R developement. I just come 
> from a nice demonstration session from Scitegic about their Pipeline 
> Pilot (PP) software, and especially their 'R collection' which brings R 
> calculations into the software 
> (http://www.scitegic.com/documents/RStats_Collection.pdf).
> 
> I looked carefully on the way they do it: they pass data from PP to R 
> using text files, they call R.exe using a R script and input - output 
> files, like:
> 
> R.exe --nosave --no-environ --no-resore-data < script.R > output.txt
> 
> And in the script, you have:
> 
> read.table(...)
> 
> which imports the data just exported from PP in an CVS file by the 
> component. I don't want to discuss here the ugly and extremely 
> inefficient solution they use to call R on their data, but anyway...
> 
> So far, so good, they respect the GPL license since R is not embedded 
> into PP, and you have to download and install it separately.
> 
> But they also provide a series of "R component" ready to use like 'R 
> ANOVA', 'R PCA', R Neural Net', etc... which are basically R scripts 
> with replaceable variables (replacement is done by PP before feeding the 
> script to the R engine). For instance, you will have:
> 
> parameter <- $(PPvariable)
> 
> in the R script. In the PP component, you have an option to specify the 
> value of 'PPvariable', let's say: PPvariable = 10, and the replacement 
> done in the R script is:
> 
> parameter <- 10
> 
> before to feed this script to R. So, everything appears transparent to 
> the end-user who parameterizes the scripts from within the PP GUI. That 
> is what they call "each component generates an R script on-the-fly"... 
> (sic!)
> 
> However, I was suprised to learn that the Pipeline Pilot R Collection is 
> not GPL and is not free (in term of money, i.e., you have to pay 
> 3500$/year to use it). I am not sure, but I think they break the GPL 
> license here since they use a commercial license for, basically, a 
> collection of R scripts embedded in their 'PP components'.
> 
> Anyone with better expertise than me could look at this, please?

Offhand, I don't think this is a problem.

We've discussed a few similar cases. Things are sometimes slightly
murky due to the FSF's unclear (or undecided) definition of the
relation between "linking" and "derived work". However, it was never
the intention that GPL code could not be _used_ by non-free software.
That point might get clearer if you substitute mySql or a similar
database instead of R.

There are some limitations though. In particular if the connection is
so tight that R has become an integrated part of the application, then
the rules for derived works may apply.

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From phgrosjean at sciviews.org  Wed Apr 19 20:34:52 2006
From: phgrosjean at sciviews.org (Philippe Grosjean)
Date: Wed, 19 Apr 2006 20:34:52 +0200
Subject: [Rd] commercial software selling a R module - question about
 GPL license rights
In-Reply-To: <39B6DDB9048D0F4DAD42CB26AAFF0AFAFEDADA@usctmx1106.merck.com>
References: <39B6DDB9048D0F4DAD42CB26AAFF0AFAFEDADA@usctmx1106.merck.com>
Message-ID: <444682CC.6010807@sciviews.org>

Oh, yes! There is also a RSoap interface. I did not mention it.

Best,

Philippe Grosjean

Liaw, Andy wrote:
> I was under the impression that PP communicates with R via SOAP, but
> what do I know...
> 
> If I didn't read your description wrong, the "R Collection" contains
> PP code (PilotScript?) for generating R code to be run by R, but does
> not include R itself.  If that's the case, I don't think it has any 
> licensing problem.  If I write some R code that generates SAS code
> (God forbid), I doubt that constitute violation of SAS license.
> 
> Just my $0.02...
> 
> Andy
> 
> From: Philippe Grosjean
> 
>>Hello all,
>>
>>Sorry for this email not directly related to R developement. 
>>I just come 
>>from a nice demonstration session from Scitegic about their Pipeline 
>>Pilot (PP) software, and especially their 'R collection' 
>>which brings R 
>>calculations into the software 
>>(http://www.scitegic.com/documents/RStats_Collection.pdf).
>>
>>I looked carefully on the way they do it: they pass data from PP to R 
>>using text files, they call R.exe using a R script and input - output 
>>files, like:
>>
>>R.exe --nosave --no-environ --no-resore-data < script.R > output.txt
>>
>>And in the script, you have:
>>
>>read.table(...)
>>
>>which imports the data just exported from PP in an CVS file by the 
>>component. I don't want to discuss here the ugly and extremely 
>>inefficient solution they use to call R on their data, but anyway...
>>
>>So far, so good, they respect the GPL license since R is not embedded 
>>into PP, and you have to download and install it separately.
>>
>>But they also provide a series of "R component" ready to use like 'R 
>>ANOVA', 'R PCA', R Neural Net', etc... which are basically R scripts 
>>with replaceable variables (replacement is done by PP before 
>>feeding the 
>>script to the R engine). For instance, you will have:
>>
>>parameter <- $(PPvariable)
>>
>>in the R script. In the PP component, you have an option to 
>>specify the 
>>value of 'PPvariable', let's say: PPvariable = 10, and the 
>>replacement 
>>done in the R script is:
>>
>>parameter <- 10
>>
>>before to feed this script to R. So, everything appears 
>>transparent to 
>>the end-user who parameterizes the scripts from within the PP 
>>GUI. That 
>>is what they call "each component generates an R script 
>>on-the-fly"... 
>>(sic!)
>>
>>However, I was suprised to learn that the Pipeline Pilot R 
>>Collection is 
>>not GPL and is not free (in term of money, i.e., you have to pay 
>>3500$/year to use it). I am not sure, but I think they break the GPL 
>>license here since they use a commercial license for, basically, a 
>>collection of R scripts embedded in their 'PP components'.
>>
>>Anyone with better expertise than me could look at this, please?
>>
>>Best,
>>
>>Philippe Grosjean
>>
>>-- 
>>..............................................<?}))><........
>>  ) ) ) ) )
>>( ( ( ( (    Prof. Philippe Grosjean
>>  ) ) ) ) )
>>( ( ( ( (    Numerical Ecology of Aquatic Systems
>>  ) ) ) ) )   Mons-Hainaut University, Belgium
>>( ( ( ( ( 
>>..............................................................
>>
>>______________________________________________
>>R-devel at r-project.org mailing list 
>>https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
> 
> 
> 
> ------------------------------------------------------------------------------
> Notice:  This e-mail message, together with any attachment...{{dropped}}


From pinard at iro.umontreal.ca  Wed Apr 19 20:43:27 2006
From: pinard at iro.umontreal.ca (=?iso-8859-1?Q?Fran=E7ois?= Pinard)
Date: Wed, 19 Apr 2006 14:43:27 -0400
Subject: [Rd] `as.vector' documentation
Message-ID: <20060419184327.GA13035@phenix.sram.qc.ca>

Hi, people.  This is R 2.2.1 under i686 Linux:


> attributes(as.vector(data.frame(a=1)))
$names
[1] "a"

$row.names
[1] "1"

$class
[1] "data.frame"


?attribute says:

     'as.vector', a generic, attempts to coerce its argument into a
     vector of mode 'mode' (the default is to coerce to whichever mode
     is most convenient).  The attributes of 'x' are removed.


The last sentence could be amended to say that the attributes of 'x' are 
removed "if the coercion succeeds".  As currently written, it may be 
interpreted as meaning that the attributes are removed unconditionally.


-- 
Fran?ois Pinard   http://pinard.progiciels-bpi.ca


From phgrosjean at sciviews.org  Wed Apr 19 20:45:42 2006
From: phgrosjean at sciviews.org (Philippe Grosjean)
Date: Wed, 19 Apr 2006 20:45:42 +0200
Subject: [Rd] commercial software selling a R module - question about
 GPL license rights
In-Reply-To: <x2odyxs9lm.fsf@turmalin.kubism.ku.dk>
References: <44466D8F.5090002@sciviews.org>
	<x2odyxs9lm.fsf@turmalin.kubism.ku.dk>
Message-ID: <44468556.9060909@sciviews.org>

I understand that it is difficult to make the distinction between 
"linking" and "derived work". Whatever the conclusion, I always feel a 
little bit abused when someone wants to "sell" me R somehow (here, you 
have to pay 3500$/year to use R inside of Pipeline Pilot). I would 
accept to pay this money if I was in front of R experts that sell me 
their expertise, indeed. But this is not the case: they don't know much 
about R, and they made a really ugly and inefficient interface between 
PP and R that is not worth those 3500$/year.

Best,

Philippe Grosjean

Peter Dalgaard wrote:
> Philippe Grosjean <phgrosjean at sciviews.org> writes:
> 
> 
>>Hello all,
>>
>>Sorry for this email not directly related to R developement. I just come 
>>from a nice demonstration session from Scitegic about their Pipeline 
>>Pilot (PP) software, and especially their 'R collection' which brings R 
>>calculations into the software 
>>(http://www.scitegic.com/documents/RStats_Collection.pdf).
>>
>>I looked carefully on the way they do it: they pass data from PP to R 
>>using text files, they call R.exe using a R script and input - output 
>>files, like:
>>
>>R.exe --nosave --no-environ --no-resore-data < script.R > output.txt
>>
>>And in the script, you have:
>>
>>read.table(...)
>>
>>which imports the data just exported from PP in an CVS file by the 
>>component. I don't want to discuss here the ugly and extremely 
>>inefficient solution they use to call R on their data, but anyway...
>>
>>So far, so good, they respect the GPL license since R is not embedded 
>>into PP, and you have to download and install it separately.
>>
>>But they also provide a series of "R component" ready to use like 'R 
>>ANOVA', 'R PCA', R Neural Net', etc... which are basically R scripts 
>>with replaceable variables (replacement is done by PP before feeding the 
>>script to the R engine). For instance, you will have:
>>
>>parameter <- $(PPvariable)
>>
>>in the R script. In the PP component, you have an option to specify the 
>>value of 'PPvariable', let's say: PPvariable = 10, and the replacement 
>>done in the R script is:
>>
>>parameter <- 10
>>
>>before to feed this script to R. So, everything appears transparent to 
>>the end-user who parameterizes the scripts from within the PP GUI. That 
>>is what they call "each component generates an R script on-the-fly"... 
>>(sic!)
>>
>>However, I was suprised to learn that the Pipeline Pilot R Collection is 
>>not GPL and is not free (in term of money, i.e., you have to pay 
>>3500$/year to use it). I am not sure, but I think they break the GPL 
>>license here since they use a commercial license for, basically, a 
>>collection of R scripts embedded in their 'PP components'.
>>
>>Anyone with better expertise than me could look at this, please?
> 
> 
> Offhand, I don't think this is a problem.
> 
> We've discussed a few similar cases. Things are sometimes slightly
> murky due to the FSF's unclear (or undecided) definition of the
> relation between "linking" and "derived work". However, it was never
> the intention that GPL code could not be _used_ by non-free software.
> That point might get clearer if you substitute mySql or a similar
> database instead of R.
> 
> There are some limitations though. In particular if the connection is
> so tight that R has become an integrated part of the application, then
> the rules for derived works may apply.
>


From Peter.Ruckdeschel at uni-bayreuth.de  Wed Apr 19 21:26:59 2006
From: Peter.Ruckdeschel at uni-bayreuth.de (Peter Ruckdeschel)
Date: Wed, 19 Apr 2006 21:26:59 +0200
Subject: [Rd] Wishlist: 'quietly' argument for .onAttach() / .First.lib()
Message-ID: <44468F03.4080902@uni-bayreuth.de>

Dear Seth,

thank you very much for your helpful comments:

>I had a quick look and for what it's worth, a few comments...
>
>* Seems a bit more code than I would expect.

Arguable, yes...

>  I think you have some use cases that I don't have ;-).

hopefully I'm not the only one to have these cases :-)

>  In terms of general use, I would suggest making a stab at a
>  simplified version.

I have tried to do something in that direction:

* files startUpMessage.R / StartupUtilities.Rd now gather the code
  addressing a more general audience; (?"startupmsg")

* files illustration.R / myStartupUtilities.Rd
  [ with mySMHandler, mystartupMessage, buildStartupMessage ]
   (?"mySMHandler") may be thought of an illustration of the concept
  (and hence should not enter general packages, I suppose)

the revised code is available again under

   http://www.uni-bayreuth.de/departments/math/org/mathe7/R-devel/startupmsg_0.2.tar.gz

>  For example, what's the difference between startupMessage and
>  startupVersionMessage; are both needed?

I guessed so: the idea is to have more than one type of
StartupMessage, and suppressing should be done according to the type;

I have rethought this now: instead of two (or more) subclasses
of StartupMessage, I now have endowed class StartupMessage with an
extra slot type, which currently is supposed to take one of the tree
values

  + "version":     version and title information from the DESCRIPTION file
  + "notabene":   "nota bene"s on the package to be given at
                   this prominent place
  + "information": (starting) pointers for more information on the
                   package:
                   -howto call the package help file,
                   -howto inspect the NEWS file,
                   -additional manuals/vignettes
                   -URLs

(but the code already supports arbitrarily many type values)

>  And linestarter?

I agree: this should better be dealt with in a more general/flexible way
by allowing  + the developper using 'startupMessages'
               to use his own SMHandler (for /S/tartup/M/essage/Handler/)
               as illustrated in 'mystartupMessages'
             + the user of a package with 'startupMessages'
               to specify a suitable custom restart
               (see examples in ?"startupmsg")
               --- is achieved using your code example

>* Consider adding a customizable restart.  As it stands, startupmsg
>  doesn't give a user more control than message().

Now it does; I admit, I should have integrated your proposed elegant
code right from the beginning.

> That is, you can either muffle the messages or not.  If I want to write
> them to a file or prefix them with funny characters, doing so by grabbing
> hold of the message before it is emitted via the restart seems like a
> nice approach (although one could argue for a more general system
> logging system that probably would not need the fancy condition
> system use).

Thank you again
Peter


From ch-r-devel at bobobeach.com  Wed Apr 19 21:55:46 2006
From: ch-r-devel at bobobeach.com (Cyrus Harmon)
Date: Wed, 19 Apr 2006 12:55:46 -0700
Subject: [Rd] commercial software selling a R module - question about
	GPL license rights
In-Reply-To: <44468556.9060909@sciviews.org>
References: <44466D8F.5090002@sciviews.org>
	<x2odyxs9lm.fsf@turmalin.kubism.ku.dk>
	<44468556.9060909@sciviews.org>
Message-ID: <4A2A9353-1787-4BDF-8DA6-AE832B6F2C13@bobobeach.com>


But its value to you and whether or not you would pay for it is a  
completely separate matter from whether or not they are violating the  
R license by selling their R collection. I imagine a discussion of  
the latter is on-topic for this list, less so for the former, I'd  
imagine.

Cyrus

On Apr 19, 2006, at 11:45 AM, Philippe Grosjean wrote:

> I understand that it is difficult to make the distinction between
> "linking" and "derived work". Whatever the conclusion, I always feel a
> little bit abused when someone wants to "sell" me R somehow (here, you
> have to pay 3500$/year to use R inside of Pipeline Pilot). I would
> accept to pay this money if I was in front of R experts that sell me
> their expertise, indeed. But this is not the case: they don't know  
> much
> about R, and they made a really ugly and inefficient interface between
> PP and R that is not worth those 3500$/year.
>
> Best,
>
> Philippe Grosjean
>
> Peter Dalgaard wrote:
>> Philippe Grosjean <phgrosjean at sciviews.org> writes:
>>
>>
>>> Hello all,
>>>
>>> Sorry for this email not directly related to R developement. I  
>>> just come
>>> from a nice demonstration session from Scitegic about their Pipeline
>>> Pilot (PP) software, and especially their 'R collection' which  
>>> brings R
>>> calculations into the software
>>> (http://www.scitegic.com/documents/RStats_Collection.pdf).
>>>
>>> I looked carefully on the way they do it: they pass data from PP  
>>> to R
>>> using text files, they call R.exe using a R script and input -  
>>> output
>>> files, like:
>>>
>>> R.exe --nosave --no-environ --no-resore-data < script.R > output.txt
>>>
>>> And in the script, you have:
>>>
>>> read.table(...)
>>>
>>> which imports the data just exported from PP in an CVS file by the
>>> component. I don't want to discuss here the ugly and extremely
>>> inefficient solution they use to call R on their data, but anyway...
>>>
>>> So far, so good, they respect the GPL license since R is not  
>>> embedded
>>> into PP, and you have to download and install it separately.
>>>
>>> But they also provide a series of "R component" ready to use like 'R
>>> ANOVA', 'R PCA', R Neural Net', etc... which are basically R scripts
>>> with replaceable variables (replacement is done by PP before  
>>> feeding the
>>> script to the R engine). For instance, you will have:
>>>
>>> parameter <- $(PPvariable)
>>>
>>> in the R script. In the PP component, you have an option to  
>>> specify the
>>> value of 'PPvariable', let's say: PPvariable = 10, and the  
>>> replacement
>>> done in the R script is:
>>>
>>> parameter <- 10
>>>
>>> before to feed this script to R. So, everything appears  
>>> transparent to
>>> the end-user who parameterizes the scripts from within the PP  
>>> GUI. That
>>> is what they call "each component generates an R script on-the- 
>>> fly"...
>>> (sic!)
>>>
>>> However, I was suprised to learn that the Pipeline Pilot R  
>>> Collection is
>>> not GPL and is not free (in term of money, i.e., you have to pay
>>> 3500$/year to use it). I am not sure, but I think they break the GPL
>>> license here since they use a commercial license for, basically, a
>>> collection of R scripts embedded in their 'PP components'.
>>>
>>> Anyone with better expertise than me could look at this, please?
>>
>>
>> Offhand, I don't think this is a problem.
>>
>> We've discussed a few similar cases. Things are sometimes slightly
>> murky due to the FSF's unclear (or undecided) definition of the
>> relation between "linking" and "derived work". However, it was never
>> the intention that GPL code could not be _used_ by non-free software.
>> That point might get clearer if you substitute mySql or a similar
>> database instead of R.
>>
>> There are some limitations though. In particular if the connection is
>> so tight that R has become an integrated part of the application,  
>> then
>> the rules for derived works may apply.
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From bsaville at bios.unc.edu  Wed Apr 19 22:25:46 2006
From: bsaville at bios.unc.edu (bsaville at bios.unc.edu)
Date: Wed, 19 Apr 2006 22:25:46 +0200 (CEST)
Subject: [Rd] gsummary function (nlme library) (PR#8782)
Message-ID: <20060419202546.73ABF4423F@slim.kubism.ku.dk>

Full_Name: Ben Saville
Version: 2.1
OS: Windows XP
Submission from: (NULL) (152.2.94.145)


I'm using the gsummary function to calculate a sum of V1 (column one) from my
data 'mytest' by group (V2,or column 2).  If V1 (the variable of interest) is
all the same value (in this case all 2's), I do not get back the correct
summation.  If there is at least one difference in V1 (all 2's except for one
1), it gives me correct values.  So either I am doing something wrong or there
is a bug in the gsummary function.  

   # Incorrect sums
mytest <- as.data.frame(matrix(c(2,rep(2,8),1,1,2,2,2,3,3,3,3),ncol=2))
mytest
gsummary(mytest,form=V1~1|V2, FUN=sum)[,1]

   # Correct sums
mytest <- as.data.frame(matrix(c(1,rep(2,8),1,1,2,2,2,3,3,3,3),ncol=2))
mytest
gsummary(mytest,form=V1~1|V2, FUN=sum)[,1]


From mbeason at harrahs.com  Wed Apr 19 23:44:32 2006
From: mbeason at harrahs.com (Matthew Beason)
Date: Wed, 19 Apr 2006 14:44:32 -0700
Subject: [Rd] AIX libjpeg still looms
Message-ID: <E153C65077E0034E97A981C6CE26F1BD04F96ADF@ENTWMAIL1A.harrahs.org>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20060419/00374ca2/attachment.pl 

From nakama at ki.rim.or.jp  Thu Apr 20 05:04:15 2006
From: nakama at ki.rim.or.jp (Ei-ji Nakama)
Date: Thu, 20 Apr 2006 12:04:15 +0900
Subject: [Rd] AIX libjpeg still looms
In-Reply-To: <E153C65077E0034E97A981C6CE26F1BD04F96ADF@ENTWMAIL1A.harrahs.org>
References: <E153C65077E0034E97A981C6CE26F1BD04F96ADF@ENTWMAIL1A.harrahs.org>
Message-ID: <dc41e1260604192004p1e091120ldcb7c5d92ae48336@mail.gmail.com>

Hi.

If I remove a java-related pass from PATH before configure and build
it, I am successful.

try

        # Cut Java Path . java library(libjpeg...etc.) probrem.
        export PATH=`echo $PATH|tr ':' '\n'|sed -e '/^.*java.*$/d'|tr '\n' ':'`
        ./configure options...
        make

For a point to confirm.
 dump -H modules/R_X11.so
JAVA-related PATH should not be included in here.

my environment `/opt/freeware/lib/libjpeg.a' used.

2006/4/20, Matthew Beason <mbeason at harrahs.com>:
> Simon,
>
>         Did you get a chance to review your AIX configuration? I'd be
> curious to know the differences with my own as while I have R installed,
> I still get the error related to libjpeg.a.
>
> Error in get(getOption("device"))() : X11 module cannot be loaded
> In addition: Warning message:
> unable to load shared library '/usr/local/R/lib/R/modules/R_X11.so':
>   Could not load module /usr/local/R/lib/R/modules/R_X11.so.
>         Dependent module /usr/java14/jre/bin/libjpeg.a(libjpeg.so.62)
> could not be loaded.
>         File /usr/java14/jre/bin/libjpeg.a is not an
>           archive or the file could not be read properly.
> System error: Exec format error
> System error: Exec format error
> Could not load module /usr/java14/jre/bin/libjpeg.a.
>         Dependent module /usr/java14/jre/bin/libjpeg.a could not be
> loaded.
>
>         Another user had suggested re-compiling the jpeg library based
> on the "Running Linux Applications on AIX" redbook. However, I haven't
> had any luck with that as of yet.
>
> Matthew Beason
> Analyst - Capacity Planning
> Harrah's Entertainment, Inc.
> One Harrah's Court, Las Vegas, NV 89119-4312
> Office: 702-494-4097
> Mobile: 702-622-6902
> mbeason at harrahs.com
> The information contained in this email may be legally privileged and
> confidential. It is intended to be read only by the person to whom it is
> addressed. If you have received this in error or are not the intended
> recipient, please immediately notify the sender and delete all copies of
> this message. Thank you.
>
>
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


--
EI-JI Nakama  <nakama at ki.rim.or.jp>
"\u4e2d\u9593\u6804\u6cbb"  <nakama at ki.rim.or.jp>


From ripley at stats.ox.ac.uk  Thu Apr 20 08:17:38 2006
From: ripley at stats.ox.ac.uk (ripley at stats.ox.ac.uk)
Date: Thu, 20 Apr 2006 08:17:38 +0200 (CEST)
Subject: [Rd] UTF8 letters are imaged incorrectly (PR#8770)
Message-ID: <20060420061738.4FA154422A@slim.kubism.ku.dk>

Thanks to Ei-ji Nakama's hints, I was able to confirm that on FC3 Linux:

1) in locale ru_RU.koi8r  Russian letters are rendered correctly if I use
"-cronyx-helvetica-%s-%s-*--%d-*-*-*-*-*-*-*" as the first element of
option "X11fonts".

2) This does not work in locale ru_RU.utf8, and the reason is that there 
is no XLC_LOCALE locale directory.  Adding a suitably configured directory 
made this work.

3) There _is_ an XLC_LOCALE locale directory ja_JA.utf8, and I was able to 
get Japanese text to display by using

"-*-mincho-%s-%s-*--%d-*-*-*-*-*-*-*"  as the first element of option 
"X11fonts".

Systems which have suitable .ttf fonts installed may work with the default 
setting.

I've added some notes on 1) and 3) to ?X11.

Thanks Ei-ji!

Brian Ripley

On Sat, 15 Apr 2006, Ei-ji Nakama wrote:

> This was not a bug.
>
> 2006/4/15, Mike Bocharov <bocharov_m at inbox.ru>:
>> It work, thanks for your help!
>>
>>>  If an error is not given by a locale command, I think that local
>>> setting of glibc does not have any problem.
>>>  I think that there is not problem if  add encoding of koi8-r to
>>> XLC_LOCALE file.
>>>
>>> I am not readable, but probably the following URL is useful.
>>> http://ru.gentoo-wiki.com/HOWTO_ru_RU.utf8_Gentoo_way
>>
>
>
> --
> EI-JI Nakama  <nakama at ki.rim.or.jp>
> "\u4e2d\u9593\u6804\u6cbb"  <nakama at ki.rim.or.jp>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Thu Apr 20 08:28:52 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 20 Apr 2006 07:28:52 +0100 (BST)
Subject: [Rd] Probable Numeric Bugs in svd function (PR#8781)
In-Reply-To: <20060419173638.1FC2D19843@slim.kubism.ku.dk>
References: <20060419173638.1FC2D19843@slim.kubism.ku.dk>
Message-ID: <Pine.LNX.4.64.0604200725310.8854@gannet.stats.ox.ac.uk>

This is unreadable, but getting as far as the first couple of lines it 
seems to be unreproducible (what are Sp5 and Region?).

You have also not told us the version of R, platform, and crucial details 
such as what BLAS was used.

Can you please use the web interface to R-bugs to add (use this PR in the 
subject line) a complete, readable and reproducible example?


On Wed, 19 Apr 2006, Mehdi.Kheloufi-Trabaud at moodys.com wrote:

> Hello,=0D
> =0D
> I just noticed that the "svd" function does not work properly for some=0D
> sparse matrices.=0D
> When I replace the 0 by very small noises (let's say 10^-16), it then=0D
> works.=0D
> The test I've performed is to compared the singular values to the eigen=0D
> values (as I work with squarred matrices).=0D
> =0D
> Here is the code (I may be wrong!):=0D
> =0D
> usHigh<-(Sp5>=3D300 & Region=3D=3D1)=0D
> usLow<-(Sp5<300 & Region=3D=3D1)=0D
> euHigh<-(Sp5>=3D200 & Region=3D=3D2)=0D
> euLow<-(Sp5<200 & Region=3D=3D2)=0D
> sigmas<-c(13.71,162.71,8.78,103.83,5.29,77.08,3.42,41.04)=0D
> temp1<-sigmas[1]*usLow+sigmas[2]*usHigh+sigmas[5]*euLow+sigmas[6]*euHigh=0D
> temp10<-sigmas[3]*usLow+sigmas[4]*usHigh+sigmas[7]*euLow+sigmas[8]*euHig=0D
> h=0D
> CorrEU<-0.89=0D
> CorrUS<-0.82=0D
> =0D
> CorrR<-matrix(0,2*SN.nb,2*SN.nb)=0D
> diag(CorrR)<-c(temp1^2,temp10^2)=0D
> =0D
> temp<-ifelse(Region=3D=3D1,CorrUS,CorrEU)=0D
> tempMat<-matrix(0,SN.nb,SN.nb)=0D
> diag(tempMat)<-temp*temp1*temp10=0D
> CorrR[(SN.nb+1):(2*SN.nb),1:SN.nb]<-tempMat=0D
> CorrR[1:SN.nb,(SN.nb+1):(2*SN.nb)]<-tempMat=0D
> =0D
> CorrR is positive definite but "svd" returns negative singular values!=0D
> When replacing 0s by very week noises, the error disppears.=0D
> =0D
> Hope I'm not saying stupid things.=0D
> =0D
> Rgds,=0D
> =0D
> Mehdi=0D
> =0D
> =0D
> =0D
> =0D
> =0D
> =0D
> -----------------------------------------=0D
> The information contained in this e-mail message, and any=0D
> attachment thereto, is confidential and may not be disclosed=0D
> without our express permission. If you are not the intended=0D
> recipient or an employee or agent responsible for delivering this=0D
> message to the intended recipient, you are hereby notified that you=0D
> have received this message in error and that any review,=0D
> dissemination, distribution or copying of this message, or any=0D
> attachment thereto, in whole or in part, is strictly prohibited. If=0D
> you have received this message in error, please immediately notify=0D
> us by telephone, fax or e-mail and delete the message and all of=0D
> its attachments. Thank you. Every effort is made to keep our=0D
> network free from viruses. You should, however, review this e-mail=0D
> message, as well as any attachment thereto, for viruses. We take no=0D
> responsibility and have no liability for any computer virus which=0D
> may be transferred via this e-mail message.=0D
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From bullard at berkeley.edu  Thu Apr 20 08:42:00 2006
From: bullard at berkeley.edu (James Bullard)
Date: Wed, 19 Apr 2006 23:42:00 -0700
Subject: [Rd] R CMD check: non source files in src on (2.3.0 RC (2006-04-19
	r37860))
Message-ID: <44472D38.80603@berkeley.edu>

Hello, I am having an issue with R CMD check with the nightly build of 
RC 2.3.0 (listed in the subject.)

The problem is this warning:

* checking if this is a source package ... WARNING
Subdirectory 'src' contains:
   README _Makefile
These are unlikely file names for src files.

In fact, they are not source files, but I do not see any reason why they 
cannot be there, or why I need to be warned of their presence. 
Potentially I could be informed of their presence, but that is another 
matter.

Now, I only get this warning when I do:

R CMD build affxparser
R CMD check -l ~/R-packages/ affxparser_1.3.3.tar.gz

If I do:

R CMD check -l ~/R-packages affxparser

I do not get the warning. Is this inconsistent, or is there rationale 
behind this? I think the warning is inappropriate, or at the least a
little restrictive. It seems as if I should be able to put whatever I 
want in there, especially the _Makefile as I like to build test programs
directly and I want to be able to build exactly what I check out from
my source code repository without having to copy files in and out.

The output from R CMD check is below. Any insight would be appreciated. 
As always thanks for your patience.

jim




****************************************************************
**************** Directly on directory *************************
****************************************************************

bullard at sam:~/projects/bioc$ R CMD check -l ~/R-packages affxparser
* checking for working latex ... OK
* using log directory '/home/bullard/projects/bioc/affxparser.Rcheck'
* using Version 2.3.0 RC (2006-04-19 r37860)
* checking for file 'affxparser/DESCRIPTION' ... OK
* this is package 'affxparser' version '1.3.3'
* checking package dependencies ... OK
* checking if this is a source package ... OK
* checking whether package 'affxparser' can be installed ... OK
* checking package directory ... OK
* checking for portable file names ... OK
* checking for sufficient/correct file permissions ... OK
* checking DESCRIPTION meta-information ... OK
* checking top-level files ... OK
* checking index information ... OK
* checking package subdirectories ... OK
* checking R files for syntax errors ... OK
* checking R files for library.dynam ... OK
* checking S3 generic/method consistency ... OK
* checking replacement functions ... OK
* checking foreign function calls ... OK
* checking Rd files ... OK
* checking for missing documentation entries ... OK
* checking for code/documentation mismatches ... OK
* checking Rd \usage sections ... OK
* checking for CRLF line endings in C/C++/Fortran sources/headers ... OK
* checking for portable compilation flags in Makevars ... OK
* creating affxparser-Ex.R ... OK
* checking examples ... OK
* creating affxparser-manual.tex ... OK
* checking affxparser-manual.tex ... OK

****************************************************************
*************** On the R CMD build version *********************
****************************************************************

bullard at sam:~/projects/bioc$ R CMD check -l ~/R-packages/ 
affxparser_1.3.3.tar.gz
* checking for working latex ... OK
* using log directory '/home/bullard/projects/bioc/affxparser.Rcheck'
* using Version 2.3.0 RC (2006-04-19 r37860)
* checking for file 'affxparser/DESCRIPTION' ... OK
* this is package 'affxparser' version '1.3.3'
* checking package dependencies ... OK
* checking if this is a source package ... WARNING
Subdirectory 'src' contains:
   README _Makefile
These are unlikely file names for src files.
* checking whether package 'affxparser' can be installed ... OK
* checking package directory ... OK
* checking for portable file names ... OK
* checking for sufficient/correct file permissions ... OK
* checking DESCRIPTION meta-information ... OK
* checking top-level files ... OK
* checking index information ... OK
* checking package subdirectories ... OK
* checking R files for syntax errors ... OK
* checking R files for library.dynam ... OK
* checking S3 generic/method consistency ... OK
* checking replacement functions ... OK
* checking foreign function calls ... OK
* checking Rd files ... OK
* checking for missing documentation entries ... OK
* checking for code/documentation mismatches ... OK
* checking Rd \usage sections ... OK
* checking for CRLF line endings in C/C++/Fortran sources/headers ... OK
* checking for portable compilation flags in Makevars ... OK
* creating affxparser-Ex.R ... OK
* checking examples ... OK
* creating affxparser-manual.tex ... OK
* checking affxparser-manual.tex ... OK

WARNING: There was 1 warning, see
   /home/bullard/projects/bioc/affxparser.Rcheck/00check.log
for details


From ripley at stats.ox.ac.uk  Thu Apr 20 08:58:03 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 20 Apr 2006 07:58:03 +0100 (BST)
Subject: [Rd] R CMD check: non source files in src on (2.3.0 RC
 (2006-04-19 r37860))
In-Reply-To: <44472D38.80603@berkeley.edu>
References: <44472D38.80603@berkeley.edu>
Message-ID: <Pine.LNX.4.64.0604200752001.14307@gannet.stats.ox.ac.uk>

On Wed, 19 Apr 2006, James Bullard wrote:

> Hello, I am having an issue with R CMD check with the nightly build of
> RC 2.3.0 (listed in the subject.)

This is all explained in TFM, `Writing R Extensions'.

> The problem is this warning:
>
> * checking if this is a source package ... WARNING
> Subdirectory 'src' contains:
>   README _Makefile
> These are unlikely file names for src files.
>
> In fact, they are not source files, but I do not see any reason why they
> cannot be there, or why I need to be warned of their presence.
> Potentially I could be informed of their presence, but that is another
> matter.

Having unnecessary files in other people's packages just waste space and 
download bandwidth for each one of the users.

> Now, I only get this warning when I do:
>
> R CMD build affxparser
> R CMD check -l ~/R-packages/ affxparser_1.3.3.tar.gz
>
> If I do:
>
> R CMD check -l ~/R-packages affxparser
>
> I do not get the warning. Is this inconsistent, or is there rationale
> behind this? I think the warning is inappropriate, or at the least a
> little restrictive. It seems as if I should be able to put whatever I
> want in there, especially the _Makefile as I like to build test programs
> directly and I want to be able to build exactly what I check out from
> my source code repository without having to copy files in and out.

All described in TFM, including how to set defaults for what is checked.

> The output from R CMD check is below. Any insight would be appreciated.
> As always thanks for your patience.

[...]


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Thu Apr 20 09:09:15 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 20 Apr 2006 08:09:15 +0100 (BST)
Subject: [Rd] R_PAPERSIZE and LC_PAPER
Message-ID: <Pine.LNX.4.64.0604200758440.14307@gannet.stats.ox.ac.uk>

R uses the environment variable R_PAPERSIZE to set its papersize, e.g. for 
postscript.

It seems the modern way is to via LC_PAPER, e.g.

http://mail.nl.linux.org/linux-utf8/2002-05/msg00010.html

and Googling will show that people expect this to work.

However, that is not set on my FC3 system, and it would affect people who 
use en_US as their locale in, say, Austria.

Should we be making use of LC_PAPER, or would it just cause further 
complications?  (On Windows, the locale name is used to set the default 
papersize, but there it is unlikely to be set inappropriately.)

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From N.Kalosha at math.ru.nl  Thu Apr 20 12:26:10 2006
From: N.Kalosha at math.ru.nl (N.Kalosha at math.ru.nl)
Date: Thu, 20 Apr 2006 12:26:10 +0200 (CEST)
Subject: [Rd] bug: code not working as expected (PR#8783)
Message-ID: <20060420102610.CE2414423F@slim.kubism.ku.dk>

This is a multi-part message in MIME format.
--------------020909040800030906040005
Content-Type: text/plain; charset=KOI8-R; format=flowed
Content-Transfer-Encoding: 7bit

Hi,

I've attached two files with the sources for a function to implement the 
finite difference method for solving a particular differential equation.

One of them works correctly, the other gives wrong results or returns an 
error, depending on the version of R.

The difference between them is that in the 'broken' version in line 42 I 
check if the items in the two-dimensional array are bigger than a 
certain value, and in the working one I do it in a separate loop.

A 2.1.1 build for Solaris returns the following error

Error in if ((X - (j - 1) * dS) > f[i, j]) f[i, j] = (X - (j - 1) * dS) 
: missing value where TRUE/FALSE needed

On Windows both the stable 2.2.1 and 2.3.0rc gui versions will silently 
produce incorrect data.

Nikolai.

--------------020909040800030906040005
Content-Type: text/plain;
 name="broken.txt"
Content-Transfer-Encoding: 7bit
Content-Disposition: inline;
 filename="broken.txt"

findiff<-function(T,S_0,X,sigma,r,N,M)
{
	f=array(,c(N+1,M+1))
	dT=T/N;
	dS=2*S_0/M;
	for (i in (1:(N+1))) 
	{
		f[i,1]=X;
		f[i,M+1]=0;
	}
	for (j in (1:(M+1))) 
	{
		f[N+1,j]=max(X-(j-1)*dS,0);
	}
	a=0;
	b=0;
	c=0;
	for (j in 1:M-1)
	{
		a[j+1]=.5*r*j*dT-.5*sigma^2*j^2*dT;
		b[j+1]=1+sigma^2*j^2*dT+r*dT;
		c[j+1]=-.5*r*j*dT-.5*sigma^2*j^2*dT;
	} 
	i=N;
	while (i>0)
	{
		d=0;
		e=0;
		d[1]=f[i+1,1];
		e[1]=0;
		d[2]=0;
		e[2]=1;
		for (j in 2:M)
		{
			d[j+1]=(f[i+1,j]-a[j]*d[j-1]-b[j]*d[j])/c[j];
			e[j+1]=(-a[j]*e[j-1]-b[j]*e[j])/c[j];
		}
		f[i,2]=(f[i,M+1]-d[M+1])/e[M+1];
		for (j in 2:M)
		{
			f[i,j]=d[j]+e[j]*f[i,2];
			if ((X-(j-1)*dS)>f[i,j]) f[i,j] = (X-(j-1)*dS);
		}
		i=i-1;
	}
	f;
}

findiff(1,10,10,.3,.1,2,4)

--------------020909040800030906040005
Content-Type: text/plain;
 name="working.txt"
Content-Transfer-Encoding: 7bit
Content-Disposition: inline;
 filename="working.txt"

findiff<-function(T,S_0,X,sigma,r,N,M)
{
	f=array(,c(N+1,M+1))
	dT=T/N;
	dS=2*S_0/M;
	for (i in (1:(N+1))) 
	{
		f[i,1]=X;
		f[i,M+1]=0;
	}
	for (j in (1:(M+1))) 
	{
		f[N+1,j]=max(X-(j-1)*dS,0);
	}
	a=0;
	b=0;
	c=0;
	for (j in 1:M-1)
	{
		a[j+1]=.5*r*j*dT-.5*sigma^2*j^2*dT;
		b[j+1]=1+sigma^2*j^2*dT+r*dT;
		c[j+1]=-.5*r*j*dT-.5*sigma^2*j^2*dT;
	} 
	i=N;
	while (i>0)
	{
		d=0;
		e=0;
		d[1]=f[i+1,1];
		e[1]=0;
		d[2]=0;
		e[2]=1;
		for (j in 2:M)
		{
			d[j+1]=(f[i+1,j]-a[j]*d[j-1]-b[j]*d[j])/c[j];
			e[j+1]=(-a[j]*e[j-1]-b[j]*e[j])/c[j];
		}
		f[i,2]=(f[i,M+1]-d[M+1])/e[M+1];
		for (j in 2:M)
		{
			f[i,j]=d[j]+e[j]*f[i,2];
		}
		for (j in 2:M)
		{
			if ((X-(j-1)*dS)>f[i,j]) f[i,j]=X-(j-1)*dS;
		}
		i=i-1;
	}
	f;
}

findiff(1,10,10,.3,.1,2,4)

--------------020909040800030906040005--


From p.dalgaard at biostat.ku.dk  Thu Apr 20 12:50:43 2006
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: 20 Apr 2006 12:50:43 +0200
Subject: [Rd] bug: code not working as expected (PR#8783)
In-Reply-To: <20060420102610.CE2414423F@slim.kubism.ku.dk>
References: <20060420102610.CE2414423F@slim.kubism.ku.dk>
Message-ID: <x23bg8frlo.fsf@turmalin.kubism.ku.dk>

N.Kalosha at math.ru.nl writes:

> This is a multi-part message in MIME format.
> --------------020909040800030906040005
> Content-Type: text/plain; charset=KOI8-R; format=flowed
> Content-Transfer-Encoding: 7bit
> 
> Hi,
> 
> I've attached two files with the sources for a function to implement the 
> finite difference method for solving a particular differential equation.
> 
> One of them works correctly, the other gives wrong results or returns an 
> error, depending on the version of R.
> 
> The difference between them is that in the 'broken' version in line 42 I 
> check if the items in the two-dimensional array are bigger than a 
> certain value, and in the working one I do it in a separate loop.
> 
> A 2.1.1 build for Solaris returns the following error
> 
> Error in if ((X - (j - 1) * dS) > f[i, j]) f[i, j] = (X - (j - 1) * dS) 
> : missing value where TRUE/FALSE needed
> 
> On Windows both the stable 2.2.1 and 2.3.0rc gui versions will silently 
> produce incorrect data.

Why do you file a bug report for a bug in your own code?

The two loops can not be expected to give the same result since the
term f[i,2] might differ when j is in 3:M.

The platform difference could easily be due to floating point issues,
e.g. the difference between divide by zero and divide by near-zero.
 
> Nikolai.
> 
> --------------020909040800030906040005
> Content-Type: text/plain;
>  name="broken.txt"
> Content-Transfer-Encoding: 7bit
> Content-Disposition: inline;
>  filename="broken.txt"
> 
> findiff<-function(T,S_0,X,sigma,r,N,M)
> {
> 	f=array(,c(N+1,M+1))
> 	dT=T/N;
> 	dS=2*S_0/M;
> 	for (i in (1:(N+1))) 
> 	{
> 		f[i,1]=X;
> 		f[i,M+1]=0;
> 	}
> 	for (j in (1:(M+1))) 
> 	{
> 		f[N+1,j]=max(X-(j-1)*dS,0);
> 	}
> 	a=0;
> 	b=0;
> 	c=0;
> 	for (j in 1:M-1)
> 	{
> 		a[j+1]=.5*r*j*dT-.5*sigma^2*j^2*dT;
> 		b[j+1]=1+sigma^2*j^2*dT+r*dT;
> 		c[j+1]=-.5*r*j*dT-.5*sigma^2*j^2*dT;
> 	} 
> 	i=N;
> 	while (i>0)
> 	{
> 		d=0;
> 		e=0;
> 		d[1]=f[i+1,1];
> 		e[1]=0;
> 		d[2]=0;
> 		e[2]=1;
> 		for (j in 2:M)
> 		{
> 			d[j+1]=(f[i+1,j]-a[j]*d[j-1]-b[j]*d[j])/c[j];
> 			e[j+1]=(-a[j]*e[j-1]-b[j]*e[j])/c[j];
> 		}
> 		f[i,2]=(f[i,M+1]-d[M+1])/e[M+1];
> 		for (j in 2:M)
> 		{
> 			f[i,j]=d[j]+e[j]*f[i,2];
> 			if ((X-(j-1)*dS)>f[i,j]) f[i,j] = (X-(j-1)*dS);
> 		}
> 		i=i-1;
> 	}
> 	f;
> }
> 
> findiff(1,10,10,.3,.1,2,4)
> 
> --------------020909040800030906040005
> Content-Type: text/plain;
>  name="working.txt"
> Content-Transfer-Encoding: 7bit
> Content-Disposition: inline;
>  filename="working.txt"
> 
> findiff<-function(T,S_0,X,sigma,r,N,M)
> {
> 	f=array(,c(N+1,M+1))
> 	dT=T/N;
> 	dS=2*S_0/M;
> 	for (i in (1:(N+1))) 
> 	{
> 		f[i,1]=X;
> 		f[i,M+1]=0;
> 	}
> 	for (j in (1:(M+1))) 
> 	{
> 		f[N+1,j]=max(X-(j-1)*dS,0);
> 	}
> 	a=0;
> 	b=0;
> 	c=0;
> 	for (j in 1:M-1)
> 	{
> 		a[j+1]=.5*r*j*dT-.5*sigma^2*j^2*dT;
> 		b[j+1]=1+sigma^2*j^2*dT+r*dT;
> 		c[j+1]=-.5*r*j*dT-.5*sigma^2*j^2*dT;
> 	} 
> 	i=N;
> 	while (i>0)
> 	{
> 		d=0;
> 		e=0;
> 		d[1]=f[i+1,1];
> 		e[1]=0;
> 		d[2]=0;
> 		e[2]=1;
> 		for (j in 2:M)
> 		{
> 			d[j+1]=(f[i+1,j]-a[j]*d[j-1]-b[j]*d[j])/c[j];
> 			e[j+1]=(-a[j]*e[j-1]-b[j]*e[j])/c[j];
> 		}
> 		f[i,2]=(f[i,M+1]-d[M+1])/e[M+1];
> 		for (j in 2:M)
> 		{
> 			f[i,j]=d[j]+e[j]*f[i,2];
> 		}
> 		for (j in 2:M)
> 		{
> 			if ((X-(j-1)*dS)>f[i,j]) f[i,j]=X-(j-1)*dS;
> 		}
> 		i=i-1;
> 	}
> 	f;
> }
> 
> findiff(1,10,10,.3,.1,2,4)
> 
> --------------020909040800030906040005--
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From tschoenhoff at gmail.com  Thu Apr 20 13:35:16 2006
From: tschoenhoff at gmail.com (druid@gmail.com)
Date: Thu, 20 Apr 2006 13:35:16 +0200
Subject: [Rd] bug: code not working as expected (PR#8783)
In-Reply-To: <20060420102610.CE2414423F@slim.kubism.ku.dk>
References: <20060420102610.CE2414423F@slim.kubism.ku.dk>
Message-ID: <5ad2dec0604200435y5cf47518rd06ea12504a231db@mail.gmail.com>

Hi Nicolai,


2006/4/20, N.Kalosha at math.ru.nl <N.Kalosha at math.ru.nl>:
> This is a multi-part message in MIME format.
> --------------020909040800030906040005
> Content-Type: text/plain; charset=KOI8-R; format=flowed
> Content-Transfer-Encoding: 7bit
>
> Hi,
>
> I've attached two files with the sources for a function to implement the
> finite difference method for solving a particular differential equation.
>
> One of them works correctly, the other gives wrong results or returns an
> error, depending on the version of R.
>
> The difference between them is that in the 'broken' version in line 42 I
> check if the items in the two-dimensional array are bigger than a
> certain value, and in the working one I do it in a separate loop.


diff working.r broken.r

also reveals that your expression is differently bracketed


broken.txt says in line 42:

 (...) = (X-(j-1)*dS);

working.txt:

(...) = X-(j-1)*dS;

Don't know what the rationale of this difference really is since I'm
no expert for finite difference methods.
But your examples apparently don't only differ in terms of checking
the size of your array-values.

Does this matter?

Thomas


From blindglobe at gmail.com  Thu Apr 20 13:53:40 2006
From: blindglobe at gmail.com (A.J. Rossini)
Date: Thu, 20 Apr 2006 13:53:40 +0200
Subject: [Rd] R and Commercial applications
Message-ID: <1abe3fa90604200453s54ebca28i7d23b0ab386fec67@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20060420/f80a0169/attachment.pl 

From murdoch at stats.uwo.ca  Thu Apr 20 14:22:57 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Thu, 20 Apr 2006 08:22:57 -0400
Subject: [Rd] Wishlist for promptPackage / index
In-Reply-To: <44467D41.4020401@uni-bayreuth.de>
References: <44467D41.4020401@uni-bayreuth.de>
Message-ID: <44477D21.3090804@stats.uwo.ca>

On 4/19/2006 2:11 PM, Peter Ruckdeschel wrote:
> On 4/19/2006 1:49 AM, Duncan Murdoch wrote:
> 
>> On 4/18/2006 7:02 PM, Peter Ruckdeschel wrote:
>>> would it be possible to enhance either promptPackage()
>>> or the default indexing mechanism for packages
>>> so that -- if it exists -- (the contents of) file
>>> <pkgname>-package.Rd is sorted first in
>>>
>>>   * the .dvi / .pdf  documentation file
>>>   * the .chm  documentation file
>>>   * the package 00index.html  documentation file
> 
>> They already sort first in the last of those.  I don't think it is
>> really possible in the index of a .chm file; they are alphabetical
>> sorting only, as far as I know.  (The package topic does sort first in
>> the main contents page, which is the same as the 00index.html file.)
> 
> Yes, you are right: the first two cases are already settled
> in a completely satisfying way [even with "+","-"-type methods!].
> 
> Sorry to have stirred you up --- I should have tried first.
> 
>> It probably makes sense in a .dvi/.pdf,
> 
> I tried out with an example now:
> at least for this case my request still applies ...
> 
>> but as far as I recall, at the time I thought those were produced
>> by the shell script for Rd2dvi, and it just seemed like too much trouble
>> to change the collation order there.
>> In fact, now I look closer I see they are produced by the Perl
>> script tools/pkg2tex.pl so it shouldn't be hard to port the changes I
>> made to Rdlists.pm over.  I'll take a look.
> 
> would be very nice; thank you very much

Done now in R-devel; after the 2.3.0 release I'll port it over to 
R-patched as well. (In the process of doing this I noticed that 
grDevices-package wasn't making it into the reference manual due to a 
bug; I fixed that too.)

Duncan Murdoch


From mschwartz at mn.rr.com  Thu Apr 20 17:52:15 2006
From: mschwartz at mn.rr.com (Marc Schwartz (via MN))
Date: Thu, 20 Apr 2006 10:52:15 -0500
Subject: [Rd] R_PAPERSIZE and LC_PAPER
In-Reply-To: <Pine.LNX.4.64.0604200758440.14307@gannet.stats.ox.ac.uk>
References: <Pine.LNX.4.64.0604200758440.14307@gannet.stats.ox.ac.uk>
Message-ID: <1145548335.4876.17.camel@localhost.localdomain>

On Thu, 2006-04-20 at 08:09 +0100, Prof Brian Ripley wrote:
> R uses the environment variable R_PAPERSIZE to set its papersize, e.g. for 
> postscript.
> 
> It seems the modern way is to via LC_PAPER, e.g.
> 
> http://mail.nl.linux.org/linux-utf8/2002-05/msg00010.html
> 
> and Googling will show that people expect this to work.
> 
> However, that is not set on my FC3 system, and it would affect people who 
> use en_US as their locale in, say, Austria.
> 
> Should we be making use of LC_PAPER, or would it just cause further 
> complications?  (On Windows, the locale name is used to set the default 
> papersize, but there it is unlikely to be set inappropriately.)


Here's my 0.0162 Euros (at current conversion rates):

For R 2.4.0, announce that LC_PAPER will become the default environment
variable used to set the default R papersize and then not set
R_PAPERSIZE by default (ie. in build scripts, etc.)

However, If someone sets R_PAPERSIZE in their site or local profile,
this will supercede the LC_PAPER setting. This would allow for a R
setting that may need to be different than the system default.

Doing this for 2.4.0 (as opposed to 2.3.x) would give folks notice and
time to consider the impact on their local installations and code, while
enabling future users to take advantage of the standard.

I think that in general, R should abide by published standards unless
there are very compelling reasons not to.

HTH,

Marc Schwartz


From hb at stat.berkeley.edu  Thu Apr 20 19:23:56 2006
From: hb at stat.berkeley.edu (Henrik Bengtsson (max 7Mb))
Date: Thu, 20 Apr 2006 10:23:56 -0700
Subject: [Rd] R CMD check: non source files in src on (2.3.0 RC
	(2006-04-19 r37860))
In-Reply-To: <Pine.LNX.4.64.0604200752001.14307@gannet.stats.ox.ac.uk>
References: <44472D38.80603@berkeley.edu>
	<Pine.LNX.4.64.0604200752001.14307@gannet.stats.ox.ac.uk>
Message-ID: <59d7961d0604201023h18c8cf68t51b6ca3f2cbe578b@mail.gmail.com>

On 4/19/06, Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
> On Wed, 19 Apr 2006, James Bullard wrote:
>
> > Hello, I am having an issue with R CMD check with the nightly build of
> > RC 2.3.0 (listed in the subject.)
>
> This is all explained in TFM, `Writing R Extensions'.
>
> > The problem is this warning:
> >
> > * checking if this is a source package ... WARNING
> > Subdirectory 'src' contains:
> >   README _Makefile
> > These are unlikely file names for src files.
> >
> > In fact, they are not source files, but I do not see any reason why they
> > cannot be there, or why I need to be warned of their presence.
> > Potentially I could be informed of their presence, but that is another
> > matter.
>
> Having unnecessary files in other people's packages just waste space and
> download bandwidth for each one of the users.

I hope the contents of a README file is more valuable than the what it
costs to download it though.

You gave a similar comment on a similar question I had in February
this year and also said "quoting you last reply "Can you not put your
master sources on your own web site."  Is it a general consensus on
R-devel that *.tar.gz distributions should only be treated as a
distribution for *building* packages and not for developing them? 
What do others think?  If so there are plenty of ways to make source
packages even smaller like having R CMD build removing source code
comments and empty lines etc.  This could possibly be an option to
"build".

Personally, I prefer paying for the extra bandwidth and treat *.tar.gz
as a very convenient base for development too.

Best,

/Henrik

> > Now, I only get this warning when I do:
> >
> > R CMD build affxparser
> > R CMD check -l ~/R-packages/ affxparser_1.3.3.tar.gz
> >
> > If I do:
> >
> > R CMD check -l ~/R-packages affxparser
> >
> > I do not get the warning. Is this inconsistent, or is there rationale
> > behind this? I think the warning is inappropriate, or at the least a
> > little restrictive. It seems as if I should be able to put whatever I
> > want in there, especially the _Makefile as I like to build test programs
> > directly and I want to be able to build exactly what I check out from
> > my source code repository without having to copy files in and out.
>
> All described in TFM, including how to set defaults for what is checked.
>
> > The output from R CMD check is below. Any insight would be appreciated.
> > As always thanks for your patience.
>
> [...]
>
>
> --
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


--
Henrik Bengtsson
Mobile: +46 708 909208 (+2h UTC)


From ripley at stats.ox.ac.uk  Thu Apr 20 19:48:34 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 20 Apr 2006 18:48:34 +0100 (BST)
Subject: [Rd] R_PAPERSIZE and LC_PAPER
In-Reply-To: <1145548335.4876.17.camel@localhost.localdomain>
References: <Pine.LNX.4.64.0604200758440.14307@gannet.stats.ox.ac.uk>
	<1145548335.4876.17.camel@localhost.localdomain>
Message-ID: <Pine.LNX.4.64.0604201811480.28018@gannet.stats.ox.ac.uk>

Marc,

Thanks for the comments.  The 2.3.x series is in feature freeze, and 
although a few features do break though for patch releases, they had 
better be `badly needed' see 
http://developer.r-project.org/devel-guidelines.txt).

So I was thinking of 2.4.0.

My suggestion was going to be along the lines of

local({
papersize <- as.vector(Sys.getenv("R_PAPERSIZE"))
if(!nchar(papersize)) {
     lcpaper <- Sys.getlocale("LC_PAPER")
     if(nchar(lcpaper))
         papersize <- if(length(grep(, lcpaper)) > 0) "letter" else "a4"
     else papersize <- as.vector(Sys.getenv("R_PAPERSIZE_DEFAULT"))
}
options(papersize = papersize)
})

This is unchanged if LC_PAPER is unset.  For those with LC_PAPER set,
its value takes precedence over the compile-time default.  That's almost 
exactly equivalent to what happens on Windows (which sets LC_MONETARY for 
this purpose, as LC_PAPER is not a locale category there).

Now, one could argue that if LC_PAPER is unset it should default to 
LC_ALL, but I think is less desirable.

Of course, at present Sys.getlocale("LC_PAPER") is not supported, so 
that's part of the TODO.

Brian


On Thu, 20 Apr 2006, Marc Schwartz (via MN) wrote:

> On Thu, 2006-04-20 at 08:09 +0100, Prof Brian Ripley wrote:
>> R uses the environment variable R_PAPERSIZE to set its papersize, e.g. for
>> postscript.
>>
>> It seems the modern way is to via LC_PAPER, e.g.
>>
>> http://mail.nl.linux.org/linux-utf8/2002-05/msg00010.html
>>
>> and Googling will show that people expect this to work.
>>
>> However, that is not set on my FC3 system, and it would affect people who
>> use en_US as their locale in, say, Austria.
>>
>> Should we be making use of LC_PAPER, or would it just cause further
>> complications?  (On Windows, the locale name is used to set the default
>> papersize, but there it is unlikely to be set inappropriately.)
>
>
> Here's my 0.0162 Euros (at current conversion rates):
>
> For R 2.4.0, announce that LC_PAPER will become the default environment
> variable used to set the default R papersize and then not set
> R_PAPERSIZE by default (ie. in build scripts, etc.)
>
> However, If someone sets R_PAPERSIZE in their site or local profile,
> this will supercede the LC_PAPER setting. This would allow for a R
> setting that may need to be different than the system default.
>
> Doing this for 2.4.0 (as opposed to 2.3.x) would give folks notice and
> time to consider the impact on their local installations and code, while
> enabling future users to take advantage of the standard.
>
> I think that in general, R should abide by published standards unless
> there are very compelling reasons not to.
>
> HTH,
>
> Marc Schwartz
>
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From bates at stat.wisc.edu  Thu Apr 20 20:16:16 2006
From: bates at stat.wisc.edu (Douglas Bates)
Date: Thu, 20 Apr 2006 13:16:16 -0500
Subject: [Rd] gsummary function (nlme library) (PR#8782)
In-Reply-To: <20060419202546.73ABF4423F@slim.kubism.ku.dk>
References: <20060419202546.73ABF4423F@slim.kubism.ku.dk>
Message-ID: <40e66e0b0604201116h6221fae6gcbcc5107516d427f@mail.gmail.com>

The documentation for gsummary describes the argument FUN as

     FUN: an optional summary function or a list of summary functions
          to be applied to each variable in the frame.  The function or
          functions are applied only to variables in 'object' that vary
          within the groups defined by 'groups'.  Invariant variables
          are always summarized by group using the unique value that
          they assume within that group.  If 'FUN' is a single function
          it will be applied to each non-invariant variable by group to
          produce the summary for that variable.  If 'FUN' is a list of
          functions, the names in the list should designate classes of
          variables in the frame such as 'ordered', 'factor', or
          'numeric'.  The indicated function will be applied to any
          non-invariant variables of that class.  The default functions
          to be used are 'mean' for numeric factors, and 'Mode' for
          both 'factor' and 'ordered'.  The 'Mode' function, defined
          internally in 'gsummary', returns the modal or most popular
          value of the variable.  It is different from the 'mode'
          function that returns the S-language mode of the variable.

so the behavior you noticed is documented.

The "summary" in "gsummary" is used in the sense of a representative
value, not in the more general sense of a numerical summary of any
sort.  If the values do not vary within a group then the common value
within the group is, according to our definition, the representative
value.


On 4/19/06, bsaville at bios.unc.edu <bsaville at bios.unc.edu> wrote:
> Full_Name: Ben Saville
> Version: 2.1
> OS: Windows XP
> Submission from: (NULL) (152.2.94.145)
>
>
> I'm using the gsummary function to calculate a sum of V1 (column one) from my
> data 'mytest' by group (V2,or column 2).  If V1 (the variable of interest) is
> all the same value (in this case all 2's), I do not get back the correct
> summation.  If there is at least one difference in V1 (all 2's except for one
> 1), it gives me correct values.  So either I am doing something wrong or there
> is a bug in the gsummary function.
>
>    # Incorrect sums
> mytest <- as.data.frame(matrix(c(2,rep(2,8),1,1,2,2,2,3,3,3,3),ncol=2))
> mytest
> gsummary(mytest,form=V1~1|V2, FUN=sum)[,1]
>
>    # Correct sums
> mytest <- as.data.frame(matrix(c(1,rep(2,8),1,1,2,2,2,3,3,3,3),ncol=2))
> mytest
> gsummary(mytest,form=V1~1|V2, FUN=sum)[,1]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From rgentlem at fhcrc.org  Thu Apr 20 20:21:51 2006
From: rgentlem at fhcrc.org (Robert Gentleman)
Date: Thu, 20 Apr 2006 11:21:51 -0700
Subject: [Rd] R CMD check: non source files in src on (2.3.0 RC
 (2006-04-19 r37860))
In-Reply-To: <Pine.LNX.4.64.0604200752001.14307@gannet.stats.ox.ac.uk>
References: <44472D38.80603@berkeley.edu>
	<Pine.LNX.4.64.0604200752001.14307@gannet.stats.ox.ac.uk>
Message-ID: <4447D13F.6020701@fhcrc.org>

I disagree, things like README files and other objects are important and 
should be included. I don't see the real advantage to such warnings, if 
someone wants them they could be turned on optionally.

If size is an issue then authors should be warned that their package is 
large (in the top 1% at CRAN would be useful to some). I also find it 
helpful to know whose packages take forever to build, which we don't do.

Just because someone put something in TFM doesn't mean it is either a 
good idea or sensible, in my experience.

best wishes
   Robert


Prof Brian Ripley wrote:
> On Wed, 19 Apr 2006, James Bullard wrote:
> 
> 
>>Hello, I am having an issue with R CMD check with the nightly build of
>>RC 2.3.0 (listed in the subject.)
> 
> 
> This is all explained in TFM, `Writing R Extensions'.
> 
> 
>>The problem is this warning:
>>
>>* checking if this is a source package ... WARNING
>>Subdirectory 'src' contains:
>>  README _Makefile
>>These are unlikely file names for src files.
>>
>>In fact, they are not source files, but I do not see any reason why they
>>cannot be there, or why I need to be warned of their presence.
>>Potentially I could be informed of their presence, but that is another
>>matter.
> 
> 
> Having unnecessary files in other people's packages just waste space and 
> download bandwidth for each one of the users.
> 
> 
>>Now, I only get this warning when I do:
>>
>>R CMD build affxparser
>>R CMD check -l ~/R-packages/ affxparser_1.3.3.tar.gz
>>
>>If I do:
>>
>>R CMD check -l ~/R-packages affxparser
>>
>>I do not get the warning. Is this inconsistent, or is there rationale
>>behind this? I think the warning is inappropriate, or at the least a
>>little restrictive. It seems as if I should be able to put whatever I
>>want in there, especially the _Makefile as I like to build test programs
>>directly and I want to be able to build exactly what I check out from
>>my source code repository without having to copy files in and out.
> 
> 
> All described in TFM, including how to set defaults for what is checked.
> 
> 
>>The output from R CMD check is below. Any insight would be appreciated.
>>As always thanks for your patience.
> 
> 
> [...]
> 
> 

-- 
Robert Gentleman, PhD
Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M2-B876
PO Box 19024
Seattle, Washington 98109-1024
206-667-7700
rgentlem at fhcrc.org


From mschwartz at mn.rr.com  Thu Apr 20 20:32:37 2006
From: mschwartz at mn.rr.com (Marc Schwartz (via MN))
Date: Thu, 20 Apr 2006 13:32:37 -0500
Subject: [Rd] R_PAPERSIZE and LC_PAPER
In-Reply-To: <Pine.LNX.4.64.0604201811480.28018@gannet.stats.ox.ac.uk>
References: <Pine.LNX.4.64.0604200758440.14307@gannet.stats.ox.ac.uk>
	<1145548335.4876.17.camel@localhost.localdomain>
	<Pine.LNX.4.64.0604201811480.28018@gannet.stats.ox.ac.uk>
Message-ID: <1145557958.4876.67.camel@localhost.localdomain>

Prof. Ripley,

Happy to help.

So, it sounds like we are thinking along the same lines then.

A couple of follow up questions:

1. Is R_PAPERSIZE_DEFAULT to be the proposed new compile time setting in
2.4.0? Unless I missed it, I did not see it documented anywhere (ie.
R-admin/NEWS for 2.2.1 patched or 2.3.0 devel) and it is not in the
configure related files that I have here.

2. For LC_ALL, it is not set (at least on my FC4 system, have not had
the time yet to go to FC5) in en_US.UTF-8. Is it set in other locales
such that it would be of value?


Thanks also for the pointer to the devel guidelines. I had read through
them at some point in the past, but it has been a while.

Regards,

Marc

On Thu, 2006-04-20 at 18:48 +0100, Prof Brian Ripley wrote:
> Marc,
> 
> Thanks for the comments.  The 2.3.x series is in feature freeze, and 
> although a few features do break though for patch releases, they had 
> better be `badly needed' see 
> http://developer.r-project.org/devel-guidelines.txt).
> 
> So I was thinking of 2.4.0.
> 
> My suggestion was going to be along the lines of
> 
> local({
> papersize <- as.vector(Sys.getenv("R_PAPERSIZE"))
> if(!nchar(papersize)) {
>      lcpaper <- Sys.getlocale("LC_PAPER")
>      if(nchar(lcpaper))
>          papersize <- if(length(grep(, lcpaper)) > 0) "letter" else "a4"
>      else papersize <- as.vector(Sys.getenv("R_PAPERSIZE_DEFAULT"))
> }
> options(papersize = papersize)
> })
> 
> This is unchanged if LC_PAPER is unset.  For those with LC_PAPER set,
> its value takes precedence over the compile-time default.  That's almost 
> exactly equivalent to what happens on Windows (which sets LC_MONETARY for 
> this purpose, as LC_PAPER is not a locale category there).
> 
> Now, one could argue that if LC_PAPER is unset it should default to 
> LC_ALL, but I think is less desirable.
> 
> Of course, at present Sys.getlocale("LC_PAPER") is not supported, so 
> that's part of the TODO.
> 
> Brian
> 
> 
> On Thu, 20 Apr 2006, Marc Schwartz (via MN) wrote:
> 
> > On Thu, 2006-04-20 at 08:09 +0100, Prof Brian Ripley wrote:
> >> R uses the environment variable R_PAPERSIZE to set its papersize, e.g. for
> >> postscript.
> >>
> >> It seems the modern way is to via LC_PAPER, e.g.
> >>
> >> http://mail.nl.linux.org/linux-utf8/2002-05/msg00010.html
> >>
> >> and Googling will show that people expect this to work.
> >>
> >> However, that is not set on my FC3 system, and it would affect people who
> >> use en_US as their locale in, say, Austria.
> >>
> >> Should we be making use of LC_PAPER, or would it just cause further
> >> complications?  (On Windows, the locale name is used to set the default
> >> papersize, but there it is unlikely to be set inappropriately.)
> >
> >
> > Here's my 0.0162 Euros (at current conversion rates):
> >
> > For R 2.4.0, announce that LC_PAPER will become the default environment
> > variable used to set the default R papersize and then not set
> > R_PAPERSIZE by default (ie. in build scripts, etc.)
> >
> > However, If someone sets R_PAPERSIZE in their site or local profile,
> > this will supercede the LC_PAPER setting. This would allow for a R
> > setting that may need to be different than the system default.
> >
> > Doing this for 2.4.0 (as opposed to 2.3.x) would give folks notice and
> > time to consider the impact on their local installations and code, while
> > enabling future users to take advantage of the standard.
> >
> > I think that in general, R should abide by published standards unless
> > there are very compelling reasons not to.
> >
> > HTH,
> >
> > Marc Schwartz
> >
> >
> >
>


From rpeng at jhsph.edu  Thu Apr 20 20:44:58 2006
From: rpeng at jhsph.edu (Roger D. Peng)
Date: Thu, 20 Apr 2006 14:44:58 -0400
Subject: [Rd] R_PAPERSIZE and LC_PAPER
In-Reply-To: <1145557958.4876.67.camel@localhost.localdomain>
References: <Pine.LNX.4.64.0604200758440.14307@gannet.stats.ox.ac.uk>	<1145548335.4876.17.camel@localhost.localdomain>	<Pine.LNX.4.64.0604201811480.28018@gannet.stats.ox.ac.uk>
	<1145557958.4876.67.camel@localhost.localdomain>
Message-ID: <4447D6AA.1090304@jhsph.edu>

Papersize can be set at compile time in the 'config.site' file (R_PAPERSIZE).

-roger

Marc Schwartz (via MN) wrote:
> Prof. Ripley,
> 
> Happy to help.
> 
> So, it sounds like we are thinking along the same lines then.
> 
> A couple of follow up questions:
> 
> 1. Is R_PAPERSIZE_DEFAULT to be the proposed new compile time setting in
> 2.4.0? Unless I missed it, I did not see it documented anywhere (ie.
> R-admin/NEWS for 2.2.1 patched or 2.3.0 devel) and it is not in the
> configure related files that I have here.
> 
> 2. For LC_ALL, it is not set (at least on my FC4 system, have not had
> the time yet to go to FC5) in en_US.UTF-8. Is it set in other locales
> such that it would be of value?
> 
> 
> Thanks also for the pointer to the devel guidelines. I had read through
> them at some point in the past, but it has been a while.
> 
> Regards,
> 
> Marc
> 
> On Thu, 2006-04-20 at 18:48 +0100, Prof Brian Ripley wrote:
>> Marc,
>>
>> Thanks for the comments.  The 2.3.x series is in feature freeze, and 
>> although a few features do break though for patch releases, they had 
>> better be `badly needed' see 
>> http://developer.r-project.org/devel-guidelines.txt).
>>
>> So I was thinking of 2.4.0.
>>
>> My suggestion was going to be along the lines of
>>
>> local({
>> papersize <- as.vector(Sys.getenv("R_PAPERSIZE"))
>> if(!nchar(papersize)) {
>>      lcpaper <- Sys.getlocale("LC_PAPER")
>>      if(nchar(lcpaper))
>>          papersize <- if(length(grep(, lcpaper)) > 0) "letter" else "a4"
>>      else papersize <- as.vector(Sys.getenv("R_PAPERSIZE_DEFAULT"))
>> }
>> options(papersize = papersize)
>> })
>>
>> This is unchanged if LC_PAPER is unset.  For those with LC_PAPER set,
>> its value takes precedence over the compile-time default.  That's almost 
>> exactly equivalent to what happens on Windows (which sets LC_MONETARY for 
>> this purpose, as LC_PAPER is not a locale category there).
>>
>> Now, one could argue that if LC_PAPER is unset it should default to 
>> LC_ALL, but I think is less desirable.
>>
>> Of course, at present Sys.getlocale("LC_PAPER") is not supported, so 
>> that's part of the TODO.
>>
>> Brian
>>
>>
>> On Thu, 20 Apr 2006, Marc Schwartz (via MN) wrote:
>>
>>> On Thu, 2006-04-20 at 08:09 +0100, Prof Brian Ripley wrote:
>>>> R uses the environment variable R_PAPERSIZE to set its papersize, e.g. for
>>>> postscript.
>>>>
>>>> It seems the modern way is to via LC_PAPER, e.g.
>>>>
>>>> http://mail.nl.linux.org/linux-utf8/2002-05/msg00010.html
>>>>
>>>> and Googling will show that people expect this to work.
>>>>
>>>> However, that is not set on my FC3 system, and it would affect people who
>>>> use en_US as their locale in, say, Austria.
>>>>
>>>> Should we be making use of LC_PAPER, or would it just cause further
>>>> complications?  (On Windows, the locale name is used to set the default
>>>> papersize, but there it is unlikely to be set inappropriately.)
>>>
>>> Here's my 0.0162 Euros (at current conversion rates):
>>>
>>> For R 2.4.0, announce that LC_PAPER will become the default environment
>>> variable used to set the default R papersize and then not set
>>> R_PAPERSIZE by default (ie. in build scripts, etc.)
>>>
>>> However, If someone sets R_PAPERSIZE in their site or local profile,
>>> this will supercede the LC_PAPER setting. This would allow for a R
>>> setting that may need to be different than the system default.
>>>
>>> Doing this for 2.4.0 (as opposed to 2.3.x) would give folks notice and
>>> time to consider the impact on their local installations and code, while
>>> enabling future users to take advantage of the standard.
>>>
>>> I think that in general, R should abide by published standards unless
>>> there are very compelling reasons not to.
>>>
>>> HTH,
>>>
>>> Marc Schwartz
>>>
>>>
>>>
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 

-- 
Roger D. Peng  |  http://www.biostat.jhsph.edu/~rpeng/


From mschwartz at mn.rr.com  Thu Apr 20 20:47:51 2006
From: mschwartz at mn.rr.com (Marc Schwartz (via MN))
Date: Thu, 20 Apr 2006 13:47:51 -0500
Subject: [Rd] Typo in R-devel assign.Rd
Message-ID: <1145558872.4876.76.camel@localhost.localdomain>

Hi all,

I had mentioned this as a PS in a recent prior post on r-help on the use
of assign(), but presumably it got buried in the noise.

There is a typo in the R-patched and R-devel versions of assign.Rd in
the first example comments.

It is presently:

#-- Create objects  'r1', 'r2', ... 'r6' --

Note the line where paste() is used in the example is:

  nam <- paste("r",i, sep=".")  # Note 'sep'


Hence, the comment should be:

  #-- Create objects  'r.1', 'r.2', ... 'r.6' --

I have attached a text file containing the patch against today's r-devel
tarball version of assign.Rd.

HTH,

Marc Schwartz

-------------- next part --------------
--- assign.Rd	2006-04-09 17:19:28.000000000 -0500
+++ assign.patched.Rd	2006-04-20 13:35:15.000000000 -0500
@@ -62,7 +62,7 @@
   \code{\link{environment}}.
 }
 \examples{
-for(i in 1:6) { #-- Create objects  'r1', 'r2', ... 'r6' --
+for(i in 1:6) { #-- Create objects  'r.1', 'r.2', ... 'r.6' --
  nam <- paste("r",i, sep=".")
  assign(nam, 1:i)
 }

From Roger.Bivand at nhh.no  Thu Apr 20 20:55:28 2006
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 20 Apr 2006 20:55:28 +0200 (CEST)
Subject: [Rd] R CMD check: non source files in src on (2.3.0 RC
 (2006-04-19 r37860))
In-Reply-To: <4447D13F.6020701@fhcrc.org>
Message-ID: <Pine.LNX.4.44.0604202050330.4886-100000@reclus.nhh.no>

On Thu, 20 Apr 2006, Robert Gentleman wrote:

> I disagree, things like README files and other objects are important and 
> should be included. I don't see the real advantage to such warnings, if 
> someone wants them they could be turned on optionally.

Isn't the point at least partly that all those files are lost on 
installation? If the README is to be accessible after installation, it can 
be placed under inst/, so that both users reading the source and installed 
versions can access it. So maybe the warning could be re-phrased to 
suggest use of the inst/ tree for files with important content?

Best wishes,

Roger

> 
> If size is an issue then authors should be warned that their package is 
> large (in the top 1% at CRAN would be useful to some). I also find it 
> helpful to know whose packages take forever to build, which we don't do.
> 
> Just because someone put something in TFM doesn't mean it is either a 
> good idea or sensible, in my experience.
> 
> best wishes
>    Robert
> 
> 
> Prof Brian Ripley wrote:
> > On Wed, 19 Apr 2006, James Bullard wrote:
> > 
> > 
> >>Hello, I am having an issue with R CMD check with the nightly build of
> >>RC 2.3.0 (listed in the subject.)
> > 
> > 
> > This is all explained in TFM, `Writing R Extensions'.
> > 
> > 
> >>The problem is this warning:
> >>
> >>* checking if this is a source package ... WARNING
> >>Subdirectory 'src' contains:
> >>  README _Makefile
> >>These are unlikely file names for src files.
> >>
> >>In fact, they are not source files, but I do not see any reason why they
> >>cannot be there, or why I need to be warned of their presence.
> >>Potentially I could be informed of their presence, but that is another
> >>matter.
> > 
> > 
> > Having unnecessary files in other people's packages just waste space and 
> > download bandwidth for each one of the users.
> > 
> > 
> >>Now, I only get this warning when I do:
> >>
> >>R CMD build affxparser
> >>R CMD check -l ~/R-packages/ affxparser_1.3.3.tar.gz
> >>
> >>If I do:
> >>
> >>R CMD check -l ~/R-packages affxparser
> >>
> >>I do not get the warning. Is this inconsistent, or is there rationale
> >>behind this? I think the warning is inappropriate, or at the least a
> >>little restrictive. It seems as if I should be able to put whatever I
> >>want in there, especially the _Makefile as I like to build test programs
> >>directly and I want to be able to build exactly what I check out from
> >>my source code repository without having to copy files in and out.
> > 
> > 
> > All described in TFM, including how to set defaults for what is checked.
> > 
> > 
> >>The output from R CMD check is below. Any insight would be appreciated.
> >>As always thanks for your patience.
> > 
> > 
> > [...]
> > 
> > 
> 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From mschwartz at mn.rr.com  Thu Apr 20 20:53:50 2006
From: mschwartz at mn.rr.com (Marc Schwartz (via MN))
Date: Thu, 20 Apr 2006 13:53:50 -0500
Subject: [Rd] R_PAPERSIZE and LC_PAPER
In-Reply-To: <4447D6AA.1090304@jhsph.edu>
References: <Pine.LNX.4.64.0604200758440.14307@gannet.stats.ox.ac.uk>
	<1145548335.4876.17.camel@localhost.localdomain>
	<Pine.LNX.4.64.0604201811480.28018@gannet.stats.ox.ac.uk>
	<1145557958.4876.67.camel@localhost.localdomain>
	<4447D6AA.1090304@jhsph.edu>
Message-ID: <1145559230.4876.83.camel@localhost.localdomain>

Roger,

Thanks.

Yes, this I know. In fact I have a line in my shell script for building
R[-patched]:

  ./configure R_PAPERSIZE=letter


R_PAPERSIZE is document in several places, however R_PAPERSIZE_DEFAULT
is not, unless I am going blind in my middle age...  :-)

Regards,

Marc

On Thu, 2006-04-20 at 14:44 -0400, Roger D. Peng wrote:
> Papersize can be set at compile time in the 'config.site' file (R_PAPERSIZE).
> 
> -roger
> 
> Marc Schwartz (via MN) wrote:
> > Prof. Ripley,
> > 
> > Happy to help.
> > 
> > So, it sounds like we are thinking along the same lines then.
> > 
> > A couple of follow up questions:
> > 
> > 1. Is R_PAPERSIZE_DEFAULT to be the proposed new compile time setting in
> > 2.4.0? Unless I missed it, I did not see it documented anywhere (ie.
> > R-admin/NEWS for 2.2.1 patched or 2.3.0 devel) and it is not in the
> > configure related files that I have here.
> > 
> > 2. For LC_ALL, it is not set (at least on my FC4 system, have not had
> > the time yet to go to FC5) in en_US.UTF-8. Is it set in other locales
> > such that it would be of value?
> > 
> > 
> > Thanks also for the pointer to the devel guidelines. I had read through
> > them at some point in the past, but it has been a while.
> > 
> > Regards,
> > 
> > Marc
> > 
> > On Thu, 2006-04-20 at 18:48 +0100, Prof Brian Ripley wrote:
> >> Marc,
> >>
> >> Thanks for the comments.  The 2.3.x series is in feature freeze, and 
> >> although a few features do break though for patch releases, they had 
> >> better be `badly needed' see 
> >> http://developer.r-project.org/devel-guidelines.txt).
> >>
> >> So I was thinking of 2.4.0.
> >>
> >> My suggestion was going to be along the lines of
> >>
> >> local({
> >> papersize <- as.vector(Sys.getenv("R_PAPERSIZE"))
> >> if(!nchar(papersize)) {
> >>      lcpaper <- Sys.getlocale("LC_PAPER")
> >>      if(nchar(lcpaper))
> >>          papersize <- if(length(grep(, lcpaper)) > 0) "letter" else "a4"
> >>      else papersize <- as.vector(Sys.getenv("R_PAPERSIZE_DEFAULT"))
> >> }
> >> options(papersize = papersize)
> >> })
> >>
> >> This is unchanged if LC_PAPER is unset.  For those with LC_PAPER set,
> >> its value takes precedence over the compile-time default.  That's almost 
> >> exactly equivalent to what happens on Windows (which sets LC_MONETARY for 
> >> this purpose, as LC_PAPER is not a locale category there).
> >>
> >> Now, one could argue that if LC_PAPER is unset it should default to 
> >> LC_ALL, but I think is less desirable.
> >>
> >> Of course, at present Sys.getlocale("LC_PAPER") is not supported, so 
> >> that's part of the TODO.
> >>
> >> Brian
> >>
> >>
> >> On Thu, 20 Apr 2006, Marc Schwartz (via MN) wrote:
> >>
> >>> On Thu, 2006-04-20 at 08:09 +0100, Prof Brian Ripley wrote:
> >>>> R uses the environment variable R_PAPERSIZE to set its papersize, e.g. for
> >>>> postscript.
> >>>>
> >>>> It seems the modern way is to via LC_PAPER, e.g.
> >>>>
> >>>> http://mail.nl.linux.org/linux-utf8/2002-05/msg00010.html
> >>>>
> >>>> and Googling will show that people expect this to work.
> >>>>
> >>>> However, that is not set on my FC3 system, and it would affect people who
> >>>> use en_US as their locale in, say, Austria.
> >>>>
> >>>> Should we be making use of LC_PAPER, or would it just cause further
> >>>> complications?  (On Windows, the locale name is used to set the default
> >>>> papersize, but there it is unlikely to be set inappropriately.)
> >>>
> >>> Here's my 0.0162 Euros (at current conversion rates):
> >>>
> >>> For R 2.4.0, announce that LC_PAPER will become the default environment
> >>> variable used to set the default R papersize and then not set
> >>> R_PAPERSIZE by default (ie. in build scripts, etc.)
> >>>
> >>> However, If someone sets R_PAPERSIZE in their site or local profile,
> >>> this will supercede the LC_PAPER setting. This would allow for a R
> >>> setting that may need to be different than the system default.
> >>>
> >>> Doing this for 2.4.0 (as opposed to 2.3.x) would give folks notice and
> >>> time to consider the impact on their local installations and code, while
> >>> enabling future users to take advantage of the standard.
> >>>
> >>> I think that in general, R should abide by published standards unless
> >>> there are very compelling reasons not to.
> >>>
> >>> HTH,
> >>>
> >>> Marc Schwartz
> >>>
> >>>
> >>>
> > 
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> > 
>


From murdoch at stats.uwo.ca  Thu Apr 20 21:08:02 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Thu, 20 Apr 2006 15:08:02 -0400
Subject: [Rd] Typo in R-devel assign.Rd
In-Reply-To: <1145558872.4876.76.camel@localhost.localdomain>
References: <1145558872.4876.76.camel@localhost.localdomain>
Message-ID: <4447DC12.2080400@stats.uwo.ca>

On 4/20/2006 2:47 PM, Marc Schwartz (via MN) wrote:
> Hi all,
> 
> I had mentioned this as a PS in a recent prior post on r-help on the use
> of assign(), but presumably it got buried in the noise.

Noise?  I didn't hear anything...

I'll fix this.

Duncan Murdoch

> 
> There is a typo in the R-patched and R-devel versions of assign.Rd in
> the first example comments.
> 
> It is presently:
> 
> #-- Create objects  'r1', 'r2', ... 'r6' --
> 
> Note the line where paste() is used in the example is:
> 
>   nam <- paste("r",i, sep=".")  # Note 'sep'
> 
> 
> Hence, the comment should be:
> 
>   #-- Create objects  'r.1', 'r.2', ... 'r.6' --
> 
> I have attached a text file containing the patch against today's r-devel
> tarball version of assign.Rd.
> 
> HTH,
> 
> Marc Schwartz
> 
> 
> 
> ------------------------------------------------------------------------
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From rgentlem at fhcrc.org  Thu Apr 20 21:17:21 2006
From: rgentlem at fhcrc.org (Robert Gentleman)
Date: Thu, 20 Apr 2006 12:17:21 -0700
Subject: [Rd] R CMD check: non source files in src on (2.3.0 RC
 (2006-04-19 r37860))
In-Reply-To: <Pine.LNX.4.44.0604202050330.4886-100000@reclus.nhh.no>
References: <Pine.LNX.4.44.0604202050330.4886-100000@reclus.nhh.no>
Message-ID: <4447DE41.9000402@fhcrc.org>

Hi,

  Well, I guess if someone thinks they know how I am going to configure 
and build the sources needed to construct appropriate dynamic libraries 
so well that they can feel free to exclude files at their whim at 
install time, perhaps they could feel just as free to exclude them at 
build time?

This makes no sense to me and certainly does not solve the size problem 
mentioned by Brian. If there is a single example of something that was 
better this way, I would be interested to hear it. I can think of 
several things that are worse.

best wishes
   Robert


Roger Bivand wrote:
> On Thu, 20 Apr 2006, Robert Gentleman wrote:
> 
> 
>>I disagree, things like README files and other objects are important and 
>>should be included. I don't see the real advantage to such warnings, if 
>>someone wants them they could be turned on optionally.
> 
> 
> Isn't the point at least partly that all those files are lost on 
> installation? If the README is to be accessible after installation, it can 
> be placed under inst/, so that both users reading the source and installed 
> versions can access it. So maybe the warning could be re-phrased to 
> suggest use of the inst/ tree for files with important content?
> 
> Best wishes,
> 
> Roger
> 
> 
>>If size is an issue then authors should be warned that their package is 
>>large (in the top 1% at CRAN would be useful to some). I also find it 
>>helpful to know whose packages take forever to build, which we don't do.
>>
>>Just because someone put something in TFM doesn't mean it is either a 
>>good idea or sensible, in my experience.
>>
>>best wishes
>>   Robert
>>
>>
>>Prof Brian Ripley wrote:
>>
>>>On Wed, 19 Apr 2006, James Bullard wrote:
>>>
>>>
>>>
>>>>Hello, I am having an issue with R CMD check with the nightly build of
>>>>RC 2.3.0 (listed in the subject.)
>>>
>>>
>>>This is all explained in TFM, `Writing R Extensions'.
>>>
>>>
>>>
>>>>The problem is this warning:
>>>>
>>>>* checking if this is a source package ... WARNING
>>>>Subdirectory 'src' contains:
>>>> README _Makefile
>>>>These are unlikely file names for src files.
>>>>
>>>>In fact, they are not source files, but I do not see any reason why they
>>>>cannot be there, or why I need to be warned of their presence.
>>>>Potentially I could be informed of their presence, but that is another
>>>>matter.
>>>
>>>
>>>Having unnecessary files in other people's packages just waste space and 
>>>download bandwidth for each one of the users.
>>>
>>>
>>>
>>>>Now, I only get this warning when I do:
>>>>
>>>>R CMD build affxparser
>>>>R CMD check -l ~/R-packages/ affxparser_1.3.3.tar.gz
>>>>
>>>>If I do:
>>>>
>>>>R CMD check -l ~/R-packages affxparser
>>>>
>>>>I do not get the warning. Is this inconsistent, or is there rationale
>>>>behind this? I think the warning is inappropriate, or at the least a
>>>>little restrictive. It seems as if I should be able to put whatever I
>>>>want in there, especially the _Makefile as I like to build test programs
>>>>directly and I want to be able to build exactly what I check out from
>>>>my source code repository without having to copy files in and out.
>>>
>>>
>>>All described in TFM, including how to set defaults for what is checked.
>>>
>>>
>>>
>>>>The output from R CMD check is below. Any insight would be appreciated.
>>>>As always thanks for your patience.
>>>
>>>
>>>[...]
>>>
>>>
>>
>>
> 

-- 
Robert Gentleman, PhD
Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M2-B876
PO Box 19024
Seattle, Washington 98109-1024
206-667-7700
rgentlem at fhcrc.org


From mschwartz at mn.rr.com  Thu Apr 20 21:17:03 2006
From: mschwartz at mn.rr.com (Marc Schwartz (via MN))
Date: Thu, 20 Apr 2006 14:17:03 -0500
Subject: [Rd] Typo in R-devel assign.Rd
In-Reply-To: <4447DC12.2080400@stats.uwo.ca>
References: <1145558872.4876.76.camel@localhost.localdomain>
	<4447DC12.2080400@stats.uwo.ca>
Message-ID: <1145560623.4876.93.camel@localhost.localdomain>

On Thu, 2006-04-20 at 15:08 -0400, Duncan Murdoch wrote:
> On 4/20/2006 2:47 PM, Marc Schwartz (via MN) wrote:
> > Hi all,
> > 
> > I had mentioned this as a PS in a recent prior post on r-help on the use
> > of assign(), but presumably it got buried in the noise.
> 
> Noise?  I didn't hear anything...
> 
> I'll fix this.
> 
> Duncan Murdoch

Thanks Duncan.

Well, the S/N ratio on the list is generally pretty high...  ;-)

Regards,

Marc

> > 
> > There is a typo in the R-patched and R-devel versions of assign.Rd in
> > the first example comments.
> > 
> > It is presently:
> > 
> > #-- Create objects  'r1', 'r2', ... 'r6' --
> > 
> > Note the line where paste() is used in the example is:
> > 
> >   nam <- paste("r",i, sep=".")  # Note 'sep'
> > 
> > 
> > Hence, the comment should be:
> > 
> >   #-- Create objects  'r.1', 'r.2', ... 'r.6' --
> > 
> > I have attached a text file containing the patch against today's r-devel
> > tarball version of assign.Rd.
> > 
> > HTH,
> > 
> > Marc Schwartz
> >


From ripley at stats.ox.ac.uk  Thu Apr 20 21:40:48 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 20 Apr 2006 20:40:48 +0100 (BST)
Subject: [Rd] R CMD check: non source files in src on (2.3.0 RC
 (2006-04-19 r37860))
In-Reply-To: <4447DE41.9000402@fhcrc.org>
References: <Pine.LNX.4.44.0604202050330.4886-100000@reclus.nhh.no>
	<4447DE41.9000402@fhcrc.org>
Message-ID: <Pine.LNX.4.64.0604202023190.487@gannet.stats.ox.ac.uk>

On Thu, 20 Apr 2006, Robert Gentleman wrote:

> Hi,
>
> Well, I guess if someone thinks they know how I am going to configure and 
> build the sources needed to construct appropriate dynamic libraries so well 
> that they can feel free to exclude files at their whim at install time, 
> perhaps they could feel just as free to exclude them at build time?

The checks are different if there is a configure file:

   Further, the check on the @file{src} directory is only run if the
   package/bundle does not contain a @file{configure} script (which
   corresponds to the value @samp{yes-maybe}) and there is no
   @file{src/Makefile} or @file{src/Makefile.in}.

> This makes no sense to me and certainly does not solve the size problem 
> mentioned by Brian. If there is a single example of something that was better 
> this way, I would be interested to hear it. I can think of several things 
> that are worse.

We found several examples with large and unnecessary files in the src 
directory via this check, as well as files in directories other than the 
ones the package author had intended.

It `makes no sense to me' to discuss situations that are not as 
implemented.  This was discussed some months ago, ideas trialled and those 
that were found worthwhile retained.  And now we are in code freeze.

>
> best wishes
>  Robert
>
>
> Roger Bivand wrote:
>> On Thu, 20 Apr 2006, Robert Gentleman wrote:
>> 
>> 
>>> I disagree, things like README files and other objects are important and 
>>> should be included. I don't see the real advantage to such warnings, if 
>>> someone wants them they could be turned on optionally.

Well, they are turned on optionally, but as the CRAN maintainers 
want them, submitters to CRAN ought to be aware that they will be run.


>> Isn't the point at least partly that all those files are lost on 
>> installation? If the README is to be accessible after installation, it can 
>> be placed under inst/, so that both users reading the source and installed 
>> versions can access it. So maybe the warning could be re-phrased to suggest 
>> use of the inst/ tree for files with important content?
>> 
>> Best wishes,
>> 
>> Roger
>> 
>> 
>>> If size is an issue then authors should be warned that their package is 
>>> large (in the top 1% at CRAN would be useful to some). I also find it 
>>> helpful to know whose packages take forever to build, which we don't do.
>>> 
>>> Just because someone put something in TFM doesn't mean it is either a good 
>>> idea or sensible, in my experience.
>>> 
>>> best wishes
>>>   Robert
>>> 
>>> 
>>> Prof Brian Ripley wrote:
>>> 
>>>> On Wed, 19 Apr 2006, James Bullard wrote:
>>>> 
>>>> 
>>>> 
>>>>> Hello, I am having an issue with R CMD check with the nightly build of
>>>>> RC 2.3.0 (listed in the subject.)
>>>> 
>>>> 
>>>> This is all explained in TFM, `Writing R Extensions'.
>>>> 
>>>> 
>>>> 
>>>>> The problem is this warning:
>>>>> 
>>>>> * checking if this is a source package ... WARNING
>>>>> Subdirectory 'src' contains:
>>>>> README _Makefile
>>>>> These are unlikely file names for src files.
>>>>> 
>>>>> In fact, they are not source files, but I do not see any reason why they
>>>>> cannot be there, or why I need to be warned of their presence.
>>>>> Potentially I could be informed of their presence, but that is another
>>>>> matter.
>>>> 
>>>> 
>>>> Having unnecessary files in other people's packages just waste space and 
>>>> download bandwidth for each one of the users.
>>>> 
>>>> 
>>>> 
>>>>> Now, I only get this warning when I do:
>>>>> 
>>>>> R CMD build affxparser
>>>>> R CMD check -l ~/R-packages/ affxparser_1.3.3.tar.gz
>>>>> 
>>>>> If I do:
>>>>> 
>>>>> R CMD check -l ~/R-packages affxparser
>>>>> 
>>>>> I do not get the warning. Is this inconsistent, or is there rationale
>>>>> behind this? I think the warning is inappropriate, or at the least a
>>>>> little restrictive. It seems as if I should be able to put whatever I
>>>>> want in there, especially the _Makefile as I like to build test programs
>>>>> directly and I want to be able to build exactly what I check out from
>>>>> my source code repository without having to copy files in and out.
>>>> 
>>>> 
>>>> All described in TFM, including how to set defaults for what is checked.
>>>> 
>>>> 
>>>> 
>>>>> The output from R CMD check is below. Any insight would be appreciated.
>>>>> As always thanks for your patience.
>>>> 
>>>> 
>>>> [...]
>>>> 
>>>> 
>>> 
>>> 
>> 
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Thu Apr 20 21:56:15 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 20 Apr 2006 20:56:15 +0100 (BST)
Subject: [Rd] R_PAPERSIZE and LC_PAPER
In-Reply-To: <1145559230.4876.83.camel@localhost.localdomain>
References: <Pine.LNX.4.64.0604200758440.14307@gannet.stats.ox.ac.uk> 
	<1145548335.4876.17.camel@localhost.localdomain> 
	<Pine.LNX.4.64.0604201811480.28018@gannet.stats.ox.ac.uk> 
	<1145557958.4876.67.camel@localhost.localdomain>
	<4447D6AA.1090304@jhsph.edu>
	<1145559230.4876.83.camel@localhost.localdomain>
Message-ID: <Pine.LNX.4.64.0604202006001.32057@gannet.stats.ox.ac.uk>

On Thu, 20 Apr 2006, Marc Schwartz (via MN) wrote:

> Roger,
>
> Thanks.
>
> Yes, this I know. In fact I have a line in my shell script for building
> R[-patched]:
>
>  ./configure R_PAPERSIZE=letter
>
>
> R_PAPERSIZE is document in several places, however R_PAPERSIZE_DEFAULT
> is not, unless I am going blind in my middle age...  :-)

It does not exist in any system at present (not even mine): just an idea 
in my head to represent the default found at configure time.

In some sense LC_PAPER is set on FC3:

gannet% locale -ck LC_PAPER
LC_PAPER
height=297
width=210
paper-codeset="ISO-8859-1"

and it is unsupported on Solaris 8.  And

> Sys.getlocale("LC_PAPER")
[1] "en_GB"

in the system I am prototyping just now.

Brian


>
> Regards,
>
> Marc
>
> On Thu, 2006-04-20 at 14:44 -0400, Roger D. Peng wrote:
>> Papersize can be set at compile time in the 'config.site' file (R_PAPERSIZE).
>>
>> -roger
>>
>> Marc Schwartz (via MN) wrote:
>>> Prof. Ripley,
>>>
>>> Happy to help.
>>>
>>> So, it sounds like we are thinking along the same lines then.
>>>
>>> A couple of follow up questions:
>>>
>>> 1. Is R_PAPERSIZE_DEFAULT to be the proposed new compile time setting in
>>> 2.4.0? Unless I missed it, I did not see it documented anywhere (ie.
>>> R-admin/NEWS for 2.2.1 patched or 2.3.0 devel) and it is not in the
>>> configure related files that I have here.
>>>
>>> 2. For LC_ALL, it is not set (at least on my FC4 system, have not had
>>> the time yet to go to FC5) in en_US.UTF-8. Is it set in other locales
>>> such that it would be of value?
>>>
>>>
>>> Thanks also for the pointer to the devel guidelines. I had read through
>>> them at some point in the past, but it has been a while.
>>>
>>> Regards,
>>>
>>> Marc
>>>
>>> On Thu, 2006-04-20 at 18:48 +0100, Prof Brian Ripley wrote:
>>>> Marc,
>>>>
>>>> Thanks for the comments.  The 2.3.x series is in feature freeze, and
>>>> although a few features do break though for patch releases, they had
>>>> better be `badly needed' see
>>>> http://developer.r-project.org/devel-guidelines.txt).
>>>>
>>>> So I was thinking of 2.4.0.
>>>>
>>>> My suggestion was going to be along the lines of
>>>>
>>>> local({
>>>> papersize <- as.vector(Sys.getenv("R_PAPERSIZE"))
>>>> if(!nchar(papersize)) {
>>>>      lcpaper <- Sys.getlocale("LC_PAPER")
>>>>      if(nchar(lcpaper))
>>>>          papersize <- if(length(grep(, lcpaper)) > 0) "letter" else "a4"
>>>>      else papersize <- as.vector(Sys.getenv("R_PAPERSIZE_DEFAULT"))
>>>> }
>>>> options(papersize = papersize)
>>>> })
>>>>
>>>> This is unchanged if LC_PAPER is unset.  For those with LC_PAPER set,
>>>> its value takes precedence over the compile-time default.  That's almost
>>>> exactly equivalent to what happens on Windows (which sets LC_MONETARY for
>>>> this purpose, as LC_PAPER is not a locale category there).
>>>>
>>>> Now, one could argue that if LC_PAPER is unset it should default to
>>>> LC_ALL, but I think is less desirable.
>>>>
>>>> Of course, at present Sys.getlocale("LC_PAPER") is not supported, so
>>>> that's part of the TODO.
>>>>
>>>> Brian
>>>>
>>>>
>>>> On Thu, 20 Apr 2006, Marc Schwartz (via MN) wrote:
>>>>
>>>>> On Thu, 2006-04-20 at 08:09 +0100, Prof Brian Ripley wrote:
>>>>>> R uses the environment variable R_PAPERSIZE to set its papersize, e.g. for
>>>>>> postscript.
>>>>>>
>>>>>> It seems the modern way is to via LC_PAPER, e.g.
>>>>>>
>>>>>> http://mail.nl.linux.org/linux-utf8/2002-05/msg00010.html
>>>>>>
>>>>>> and Googling will show that people expect this to work.
>>>>>>
>>>>>> However, that is not set on my FC3 system, and it would affect people who
>>>>>> use en_US as their locale in, say, Austria.
>>>>>>
>>>>>> Should we be making use of LC_PAPER, or would it just cause further
>>>>>> complications?  (On Windows, the locale name is used to set the default
>>>>>> papersize, but there it is unlikely to be set inappropriately.)
>>>>>
>>>>> Here's my 0.0162 Euros (at current conversion rates):
>>>>>
>>>>> For R 2.4.0, announce that LC_PAPER will become the default environment
>>>>> variable used to set the default R papersize and then not set
>>>>> R_PAPERSIZE by default (ie. in build scripts, etc.)
>>>>>
>>>>> However, If someone sets R_PAPERSIZE in their site or local profile,
>>>>> this will supercede the LC_PAPER setting. This would allow for a R
>>>>> setting that may need to be different than the system default.
>>>>>
>>>>> Doing this for 2.4.0 (as opposed to 2.3.x) would give folks notice and
>>>>> time to consider the impact on their local installations and code, while
>>>>> enabling future users to take advantage of the standard.
>>>>>
>>>>> I think that in general, R should abide by published standards unless
>>>>> there are very compelling reasons not to.
>>>>>
>>>>> HTH,
>>>>>
>>>>> Marc Schwartz
>>>>>
>>>>>
>>>>>
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From khansen at stat.Berkeley.EDU  Thu Apr 20 22:06:00 2006
From: khansen at stat.Berkeley.EDU (Kasper Daniel Hansen)
Date: Thu, 20 Apr 2006 13:06:00 -0700
Subject: [Rd] R CMD check: non source files in src on (2.3.0 RC
	(2006-04-19 r37860))
In-Reply-To: <Pine.LNX.4.64.0604202023190.487@gannet.stats.ox.ac.uk>
References: <Pine.LNX.4.44.0604202050330.4886-100000@reclus.nhh.no>
	<4447DE41.9000402@fhcrc.org>
	<Pine.LNX.4.64.0604202023190.487@gannet.stats.ox.ac.uk>
Message-ID: <3DD79D88-B705-4598-A3B7-4C592F0C6218@stat.berkeley.edu>

One thing which I personally disagree with is that the procedure for  
the check is different when run on a directory than on a tarball (I  
am talking about the defaults here, I now know I can change it  
locally). I could understand the difference if the check resulted in  
an _error_ such that I would be unable to install the package if I  
have eg. object files in the src directory.

I did the original checking for the package Jim (the OP) referred to,  
and I did expect that since it passed R CMD check (on my svn checkout  
directory), everything would be fine (this was with R-beta from  
Sunday). It was a bit of a surprise for me to learn that there was  
differences.

This is a case where I fail to see the advantage of the default  
settings, and I do see some disadvantages. But probably not important  
enough for R-2.3.0.

/Kasper

On Apr 20, 2006, at 12:40 PM, Prof Brian Ripley wrote:

> On Thu, 20 Apr 2006, Robert Gentleman wrote:
>
>> Hi,
>>
>> Well, I guess if someone thinks they know how I am going to  
>> configure and
>> build the sources needed to construct appropriate dynamic  
>> libraries so well
>> that they can feel free to exclude files at their whim at install  
>> time,
>> perhaps they could feel just as free to exclude them at build time?
>
> The checks are different if there is a configure file:
>
>    Further, the check on the @file{src} directory is only run if the
>    package/bundle does not contain a @file{configure} script (which
>    corresponds to the value @samp{yes-maybe}) and there is no
>    @file{src/Makefile} or @file{src/Makefile.in}.

>> This makes no sense to me and certainly does not solve the size  
>> problem
>> mentioned by Brian. If there is a single example of something that  
>> was better
>> this way, I would be interested to hear it. I can think of several  
>> things
>> that are worse.
>
> We found several examples with large and unnecessary files in the src
> directory via this check, as well as files in directories other  
> than the
> ones the package author had intended.
>
> It `makes no sense to me' to discuss situations that are not as
> implemented.  This was discussed some months ago, ideas trialled  
> and those
> that were found worthwhile retained.  And now we are in code freeze.
>
>>
>> best wishes
>>  Robert
>>
>>
>> Roger Bivand wrote:
>>> On Thu, 20 Apr 2006, Robert Gentleman wrote:
>>>
>>>
>>>> I disagree, things like README files and other objects are  
>>>> important and
>>>> should be included. I don't see the real advantage to such  
>>>> warnings, if
>>>> someone wants them they could be turned on optionally.
>
> Well, they are turned on optionally, but as the CRAN maintainers
> want them, submitters to CRAN ought to be aware that they will be run.
>
>
>>> Isn't the point at least partly that all those files are lost on
>>> installation? If the README is to be accessible after  
>>> installation, it can
>>> be placed under inst/, so that both users reading the source and  
>>> installed
>>> versions can access it. So maybe the warning could be re-phrased  
>>> to suggest
>>> use of the inst/ tree for files with important content?
>>>
>>> Best wishes,
>>>
>>> Roger
>>>
>>>
>>>> If size is an issue then authors should be warned that their  
>>>> package is
>>>> large (in the top 1% at CRAN would be useful to some). I also  
>>>> find it
>>>> helpful to know whose packages take forever to build, which we  
>>>> don't do.
>>>>
>>>> Just because someone put something in TFM doesn't mean it is  
>>>> either a good
>>>> idea or sensible, in my experience.
>>>>
>>>> best wishes
>>>>   Robert
>>>>
>>>>
>>>> Prof Brian Ripley wrote:
>>>>
>>>>> On Wed, 19 Apr 2006, James Bullard wrote:
>>>>>
>>>>>
>>>>>
>>>>>> Hello, I am having an issue with R CMD check with the nightly  
>>>>>> build of
>>>>>> RC 2.3.0 (listed in the subject.)
>>>>>
>>>>>
>>>>> This is all explained in TFM, `Writing R Extensions'.
>>>>>
>>>>>
>>>>>
>>>>>> The problem is this warning:
>>>>>>
>>>>>> * checking if this is a source package ... WARNING
>>>>>> Subdirectory 'src' contains:
>>>>>> README _Makefile
>>>>>> These are unlikely file names for src files.
>>>>>>
>>>>>> In fact, they are not source files, but I do not see any  
>>>>>> reason why they
>>>>>> cannot be there, or why I need to be warned of their presence.
>>>>>> Potentially I could be informed of their presence, but that is  
>>>>>> another
>>>>>> matter.
>>>>>
>>>>>
>>>>> Having unnecessary files in other people's packages just waste  
>>>>> space and
>>>>> download bandwidth for each one of the users.
>>>>>
>>>>>
>>>>>
>>>>>> Now, I only get this warning when I do:
>>>>>>
>>>>>> R CMD build affxparser
>>>>>> R CMD check -l ~/R-packages/ affxparser_1.3.3.tar.gz
>>>>>>
>>>>>> If I do:
>>>>>>
>>>>>> R CMD check -l ~/R-packages affxparser
>>>>>>
>>>>>> I do not get the warning. Is this inconsistent, or is there  
>>>>>> rationale
>>>>>> behind this? I think the warning is inappropriate, or at the  
>>>>>> least a
>>>>>> little restrictive. It seems as if I should be able to put  
>>>>>> whatever I
>>>>>> want in there, especially the _Makefile as I like to build  
>>>>>> test programs
>>>>>> directly and I want to be able to build exactly what I check  
>>>>>> out from
>>>>>> my source code repository without having to copy files in and  
>>>>>> out.
>>>>>
>>>>>
>>>>> All described in TFM, including how to set defaults for what is  
>>>>> checked.
>>>>>
>>>>>
>>>>>
>>>>>> The output from R CMD check is below. Any insight would be  
>>>>>> appreciated.
>>>>>> As always thanks for your patience.
>>>>>
>>>>>
>>>>> [...]
>>>>>
>>>>>
>>>>
>>>>
>>>
>>
>>
>
> -- 
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From simon.urbanek at r-project.org  Thu Apr 20 23:12:42 2006
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Thu, 20 Apr 2006 17:12:42 -0400
Subject: [Rd] R CMD check: non source files in src on (2.3.0 RC
	(2006-04-19 r37860))
In-Reply-To: <59d7961d0604201023h18c8cf68t51b6ca3f2cbe578b@mail.gmail.com>
References: <44472D38.80603@berkeley.edu>
	<Pine.LNX.4.64.0604200752001.14307@gannet.stats.ox.ac.uk>
	<59d7961d0604201023h18c8cf68t51b6ca3f2cbe578b@mail.gmail.com>
Message-ID: <787C4179-E8D8-449F-B83B-A04F9A669BD2@r-project.org>

On Apr 20, 2006, at 1:23 PM, Henrik Bengtsson (max 7Mb) wrote:

>  Is it a general consensus on R-devel that *.tar.gz distributions  
> should only be treated as a distribution for *building* packages  
> and not for developing them?

I don't know whether this is a general consensus, but it definitely  
an important distinction. Some authors put their own Makefiles in src  
although they are not needed and in fact harmful, preventing the  
package to build on other systems - only because they are too lazy to  
use R building mechanism for development and don't make the above  
distinction.

I'm not saying anything about make check here - my point is that tar- 
balls and development sources are definitely two separate concepts.  
For simple packages it may be possible to just tar-up the development  
sources, but that's rather a special case.

Cheers,
Simon


From MSchwartz at mn.rr.com  Fri Apr 21 06:05:39 2006
From: MSchwartz at mn.rr.com (Marc Schwartz)
Date: Thu, 20 Apr 2006 23:05:39 -0500
Subject: [Rd] R_PAPERSIZE and LC_PAPER
In-Reply-To: <Pine.LNX.4.64.0604202006001.32057@gannet.stats.ox.ac.uk>
References: <Pine.LNX.4.64.0604200758440.14307@gannet.stats.ox.ac.uk>
	<1145548335.4876.17.camel@localhost.localdomain>
	<Pine.LNX.4.64.0604201811480.28018@gannet.stats.ox.ac.uk>
	<1145557958.4876.67.camel@localhost.localdomain>
	<4447D6AA.1090304@jhsph.edu>
	<1145559230.4876.83.camel@localhost.localdomain>
	<Pine.LNX.4.64.0604202006001.32057@gannet.stats.ox.ac.uk>
Message-ID: <1145592339.4639.23.camel@localhost.localdomain>

On Thu, 2006-04-20 at 20:56 +0100, Prof Brian Ripley wrote:
> On Thu, 20 Apr 2006, Marc Schwartz (via MN) wrote:
> 
> > Roger,
> >
> > Thanks.
> >
> > Yes, this I know. In fact I have a line in my shell script for building
> > R[-patched]:
> >
> >  ./configure R_PAPERSIZE=letter
> >
> >
> > R_PAPERSIZE is document in several places, however R_PAPERSIZE_DEFAULT
> > is not, unless I am going blind in my middle age...  :-)
> 
> It does not exist in any system at present (not even mine): just an idea 
> in my head to represent the default found at configure time.
> 
> In some sense LC_PAPER is set on FC3:
> 
> gannet% locale -ck LC_PAPER
> LC_PAPER
> height=297
> width=210
> paper-codeset="ISO-8859-1"
> 
> and it is unsupported on Solaris 8.  And
> 
> > Sys.getlocale("LC_PAPER")
> [1] "en_GB"
> 
> in the system I am prototyping just now.
> 
> Brian


OK...so as I surmised below, R_PAPERSIZE_DEFAULT is part of the proposed
change. Makes sense.

BTW, on my FC4 system:

$ locale -ck LC_PAPER
LC_PAPER
height=279
width=216
paper-codeset="UTF-8"


However, as I note below LC_ALL is unset:

$ locale -ck LC_ALL
$


Googling seems to be somewhat inconclusive as to the default use of
LC_ALL, but it is clearly used/set in some locales and by some
applications.

However, the official POSIX definition is:

LC_ALL
        This variable shall determine the values for all locale
        categories. The value of the LC_ALL environment variable has
        precedence over any of the other environment variables starting
        with LC_ ( LC_COLLATE , LC_CTYPE , LC_MESSAGES , LC_MONETARY ,
        LC_NUMERIC , LC_TIME ) and the LANG environment variable.
        
Consistent with some comments that I found, it seems to suggest that
LC_ALL can serve as something of an override relative to the other LC_*
variables.

This position would support an argument that if set, it would override
the logic below as a system default, perhaps and unless R_PAPERSIZE is
set in the site or user profile.

Thus, a possible hierarchy of precedence from high to low might be:

R_PAPERSIZE
LC_ALL
LC_PAPER
R_PAPERSIZE_DEFAULT


Thoughts?

Regards,

Marc

> > On Thu, 2006-04-20 at 14:44 -0400, Roger D. Peng wrote:
> >> Papersize can be set at compile time in the 'config.site' file (R_PAPERSIZE).
> >>
> >> -roger
> >>
> >> Marc Schwartz (via MN) wrote:
> >>> Prof. Ripley,
> >>>
> >>> Happy to help.
> >>>
> >>> So, it sounds like we are thinking along the same lines then.
> >>>
> >>> A couple of follow up questions:
> >>>
> >>> 1. Is R_PAPERSIZE_DEFAULT to be the proposed new compile time setting in
> >>> 2.4.0? Unless I missed it, I did not see it documented anywhere (ie.
> >>> R-admin/NEWS for 2.2.1 patched or 2.3.0 devel) and it is not in the
> >>> configure related files that I have here.
> >>>
> >>> 2. For LC_ALL, it is not set (at least on my FC4 system, have not had
> >>> the time yet to go to FC5) in en_US.UTF-8. Is it set in other locales
> >>> such that it would be of value?
> >>>
> >>>
> >>> Thanks also for the pointer to the devel guidelines. I had read through
> >>> them at some point in the past, but it has been a while.
> >>>
> >>> Regards,
> >>>
> >>> Marc
> >>>
> >>> On Thu, 2006-04-20 at 18:48 +0100, Prof Brian Ripley wrote:
> >>>> Marc,
> >>>>
> >>>> Thanks for the comments.  The 2.3.x series is in feature freeze, and
> >>>> although a few features do break though for patch releases, they had
> >>>> better be `badly needed' see
> >>>> http://developer.r-project.org/devel-guidelines.txt).
> >>>>
> >>>> So I was thinking of 2.4.0.
> >>>>
> >>>> My suggestion was going to be along the lines of
> >>>>
> >>>> local({
> >>>> papersize <- as.vector(Sys.getenv("R_PAPERSIZE"))
> >>>> if(!nchar(papersize)) {
> >>>>      lcpaper <- Sys.getlocale("LC_PAPER")
> >>>>      if(nchar(lcpaper))
> >>>>          papersize <- if(length(grep(, lcpaper)) > 0) "letter" else "a4"
> >>>>      else papersize <- as.vector(Sys.getenv("R_PAPERSIZE_DEFAULT"))
> >>>> }
> >>>> options(papersize = papersize)
> >>>> })
> >>>>
> >>>> This is unchanged if LC_PAPER is unset.  For those with LC_PAPER set,
> >>>> its value takes precedence over the compile-time default.  That's almost
> >>>> exactly equivalent to what happens on Windows (which sets LC_MONETARY for
> >>>> this purpose, as LC_PAPER is not a locale category there).
> >>>>
> >>>> Now, one could argue that if LC_PAPER is unset it should default to
> >>>> LC_ALL, but I think is less desirable.
> >>>>
> >>>> Of course, at present Sys.getlocale("LC_PAPER") is not supported, so
> >>>> that's part of the TODO.
> >>>>
> >>>> Brian

<SNIP>


From Kurt.Hornik at wu-wien.ac.at  Fri Apr 21 10:20:32 2006
From: Kurt.Hornik at wu-wien.ac.at (Kurt Hornik)
Date: Fri, 21 Apr 2006 10:20:32 +0200
Subject: [Rd] R CMD check: non source files in src on (2.3.0
	RC	(2006-04-19 r37860))
In-Reply-To: <787C4179-E8D8-449F-B83B-A04F9A669BD2@r-project.org>
References: <44472D38.80603@berkeley.edu>
	<Pine.LNX.4.64.0604200752001.14307@gannet.stats.ox.ac.uk>
	<59d7961d0604201023h18c8cf68t51b6ca3f2cbe578b@mail.gmail.com>
	<787C4179-E8D8-449F-B83B-A04F9A669BD2@r-project.org>
Message-ID: <17480.38352.565554.514650@mithrandir.hornik.net>

>>>>> Simon Urbanek writes:

> On Apr 20, 2006, at 1:23 PM, Henrik Bengtsson (max 7Mb) wrote:
>> Is it a general consensus on R-devel that *.tar.gz distributions  
>> should only be treated as a distribution for *building* packages  
>> and not for developing them?

[Actually, distributing so that they can be installed and used.]

> I don't know whether this is a general consensus, but it definitely  
> an important distinction. Some authors put their own Makefiles in src  
> although they are not needed and in fact harmful, preventing the  
> package to build on other systems - only because they are too lazy to  
> use R building mechanism for development and don't make the above  
> distinction.

Right :-)

Henrik, as I think I mentioned the last time you asked about this: of
course you can basically do everything you want.  But it comes at a
price.  For external sources, you need to write a Makefile of your own,
so as to make it clear that you provide a mechanism which is different
from the standard one.  And, as Simon said, the gain in flexibility
comes at a price.

Personally and as one of the CRAN maintainers, I'd be very unhappy if
package maintainers would start flooding their source .tar.gz packages
with full development environment material.  (I am also rather unhappy
about shipping large data sets which are only used for instructional
purposes [rather than providing the data set "on its own"].)  It is
simply not true that bandwidth does not matter.

If there is need, we could start having developer-package repositories.
However, I'd prefer a different approach.  We're currently in the
process of updating the CRAN server infrastructure, and should be able
to start deploying an R-forge project hosting service "eventually"
(hopefully, we can set things up during the summer).  This should
provide us with an ideal infrastructure for sharing developer resources,
in particular as we could add QC testing et al to the standard community
services.

Best
-k


From prechelt at inf.fu-berlin.de  Fri Apr 21 11:40:13 2006
From: prechelt at inf.fu-berlin.de (prechelt at inf.fu-berlin.de)
Date: Fri, 21 Apr 2006 11:40:13 +0200 (CEST)
Subject: [Rd] plot.default 'ylim' error message is wrong (PR#8784)
Message-ID: <20060421094013.B0FCB19B9F@slim.kubism.ku.dk>

Full_Name: Lutz Prechelt
Version: 2.2.1
OS: WinXP SP2
Submission from: (NULL) (130.133.8.114)


This command

  plot(0, 0, xlim=c(3, 5), ylim=c(0, 10, 17))

should complain about 'ylim' (because it has three elements).
However, it does in fact (in my german error message at least)
complain about 'xlim' instead:

  Fehler in plot.window(xlim, ylim, log, asp, ...) : 
	ung?ltiger 'xlim' Wert

I spent about fifteen minutes debugging my trivial xlim
argument before I found this. Shows my general trust in R,
I guess. It is a great system.
Version 2.2.1  (2005-12-20 r36812)

  Lutz Prechelt


From ripley at stats.ox.ac.uk  Fri Apr 21 12:01:00 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 21 Apr 2006 11:01:00 +0100 (BST)
Subject: [Rd] plot.default 'ylim' error message is wrong (PR#8784)
In-Reply-To: <20060421094013.B0FCB19B9F@slim.kubism.ku.dk>
References: <20060421094013.B0FCB19B9F@slim.kubism.ku.dk>
Message-ID: <Pine.LNX.4.64.0604211057230.10522@gannet.stats.ox.ac.uk>

On Fri, 21 Apr 2006, prechelt at inf.fu-berlin.de wrote:

> Full_Name: Lutz Prechelt
> Version: 2.2.1
> OS: WinXP SP2
> Submission from: (NULL) (130.133.8.114)
>
>
> This command
>
>  plot(0, 0, xlim=c(3, 5), ylim=c(0, 10, 17))
>
> should complain about 'ylim' (because it has three elements).
> However, it does in fact (in my german error message at least)
> complain about 'xlim' instead:

On 2.3.0RC it does

> plot(0, 0, xlim=c(3, 5), ylim=c(0, 10, 17))
Fehler in plot.window(xlim, ylim, log, asp, ...) :
         ung?ltiger 'ylim' Wert

so it seems it was already solved.


>  Fehler in plot.window(xlim, ylim, log, asp, ...) :
> 	ung?ltiger 'xlim' Wert
>
> I spent about fifteen minutes debugging my trivial xlim
> argument before I found this. Shows my general trust in R,
> I guess. It is a great system.
> Version 2.2.1  (2005-12-20 r36812)
>
>  Lutz Prechelt


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From hin-tak.leung at cimr.cam.ac.uk  Fri Apr 21 14:52:24 2006
From: hin-tak.leung at cimr.cam.ac.uk (Hin-Tak Leung)
Date: Fri, 21 Apr 2006 13:52:24 +0100
Subject: [Rd] R_PAPERSIZE and LC_PAPER
In-Reply-To: <Pine.LNX.4.64.0604202006001.32057@gannet.stats.ox.ac.uk>
References: <Pine.LNX.4.64.0604200758440.14307@gannet.stats.ox.ac.uk>
	<1145548335.4876.17.camel@localhost.localdomain>
	<Pine.LNX.4.64.0604201811480.28018@gannet.stats.ox.ac.uk>
	<1145557958.4876.67.camel@localhost.localdomain>	<4447D6AA.1090304@jhsph.edu>	<1145559230.4876.83.camel@localhost.localdomain>
	<Pine.LNX.4.64.0604202006001.32057@gannet.stats.ox.ac.uk>
Message-ID: <4448D588.2090207@cimr.cam.ac.uk>

Prof Brian Ripley wrote:
<snipped>
> It does not exist in any system at present (not even mine): just an idea 
> in my head to represent the default found at configure time.
> 
> In some sense LC_PAPER is set on FC3:
> 
> gannet% locale -ck LC_PAPER
> LC_PAPER
> height=297
> width=210
> paper-codeset="ISO-8859-1"
> 
> and it is unsupported on Solaris 8.  And
> 
>> Sys.getlocale("LC_PAPER")
> [1] "en_GB"
> 
> in the system I am prototyping just now.

Just to chip in on the discussion - on FC5,

$ locale -ck LC_PAPER
LC_PAPER
height=279
width=216
paper-codeset="UTF-8"

$ echo $LANG
en_US.UTF-8

(hmm, I must have made a mistake somewhere - would prefer "en_GB").

R 2.2.1 currently on my system (built on FC4 before I ungraded to FC5).
 > Sys.getlocale("LC_PAPER")
Error in Sys.getlocale("LC_PAPER") : invalid 'category' argument

HT


From ripley at stats.ox.ac.uk  Fri Apr 21 14:41:56 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 21 Apr 2006 13:41:56 +0100 (BST)
Subject: [Rd] R_PAPERSIZE and LC_PAPER
In-Reply-To: <4448D588.2090207@cimr.cam.ac.uk>
References: <Pine.LNX.4.64.0604200758440.14307@gannet.stats.ox.ac.uk> 
	<1145548335.4876.17.camel@localhost.localdomain> 
	<Pine.LNX.4.64.0604201811480.28018@gannet.stats.ox.ac.uk> 
	<1145557958.4876.67.camel@localhost.localdomain>
	<4447D6AA.1090304@jhsph.edu>
	<1145559230.4876.83.camel@localhost.localdomain>
	<Pine.LNX.4.64.0604202006001.32057@gannet.stats.ox.ac.uk>
	<4448D588.2090207@cimr.cam.ac.uk>
Message-ID: <Pine.LNX.4.64.0604211341180.22661@gannet.stats.ox.ac.uk>

On Fri, 21 Apr 2006, Hin-Tak Leung wrote:

> Prof Brian Ripley wrote:
> <snipped>
>> It does not exist in any system at present (not even mine): just an idea in 
>> my head to represent the default found at configure time.
>> 
>> In some sense LC_PAPER is set on FC3:
>> 
>> gannet% locale -ck LC_PAPER
>> LC_PAPER
>> height=297
>> width=210
>> paper-codeset="ISO-8859-1"
>> 
>> and it is unsupported on Solaris 8.  And
>> 
>>> Sys.getlocale("LC_PAPER")
>> [1] "en_GB"
>> 
>> in the system I am prototyping just now.
>
> Just to chip in on the discussion - on FC5,
>
> $ locale -ck LC_PAPER
> LC_PAPER
> height=279
> width=216
> paper-codeset="UTF-8"
>
> $ echo $LANG
> en_US.UTF-8
>
> (hmm, I must have made a mistake somewhere - would prefer "en_GB").
>
> R 2.2.1 currently on my system (built on FC4 before I ungraded to FC5).
>> Sys.getlocale("LC_PAPER")
> Error in Sys.getlocale("LC_PAPER") : invalid 'category' argument

Yes, that only works in R-devel (2.4.0 to be).

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From hin-tak.leung at cimr.cam.ac.uk  Fri Apr 21 14:57:14 2006
From: hin-tak.leung at cimr.cam.ac.uk (Hin-Tak Leung)
Date: Fri, 21 Apr 2006 13:57:14 +0100
Subject: [Rd] R_PAPERSIZE and LC_PAPER
In-Reply-To: <1145592339.4639.23.camel@localhost.localdomain>
References: <Pine.LNX.4.64.0604200758440.14307@gannet.stats.ox.ac.uk>	<1145548335.4876.17.camel@localhost.localdomain>	<Pine.LNX.4.64.0604201811480.28018@gannet.stats.ox.ac.uk>	<1145557958.4876.67.camel@localhost.localdomain>	<4447D6AA.1090304@jhsph.edu>	<1145559230.4876.83.camel@localhost.localdomain>	<Pine.LNX.4.64.0604202006001.32057@gannet.stats.ox.ac.uk>
	<1145592339.4639.23.camel@localhost.localdomain>
Message-ID: <4448D6AA.4030801@cimr.cam.ac.uk>

Marc Schwartz wrote:
> On Thu, 2006-04-20 at 20:56 +0100, Prof Brian Ripley wrote:
<snipped>
>> gannet% locale -ck LC_PAPER
>> LC_PAPER
>> height=297
>> width=210
>> paper-codeset="ISO-8859-1"

> BTW, on my FC4 system:
> 
> $ locale -ck LC_PAPER
> LC_PAPER
> height=279
> width=216
> paper-codeset="UTF-8"

297/210 is A4 and 279/216 is letter (in mm's). Europe/US difference.
(where I am, I should have en_GB instead of en_US on FC5, so I better
go and fix my box..).

HT


From tlumley at u.washington.edu  Fri Apr 21 16:31:55 2006
From: tlumley at u.washington.edu (Thomas Lumley)
Date: Fri, 21 Apr 2006 07:31:55 -0700 (PDT)
Subject: [Rd] R CMD check: non source files in src on (2.3.0 RC
 (2006-04-19 r37860))
In-Reply-To: <17480.38352.565554.514650@mithrandir.hornik.net>
References: <44472D38.80603@berkeley.edu>
	<Pine.LNX.4.64.0604200752001.14307@gannet.stats.ox.ac.uk>
	<59d7961d0604201023h18c8cf68t51b6ca3f2cbe578b@mail.gmail.com>
	<787C4179-E8D8-449F-B83B-A04F9A669BD2@r-project.org>
	<17480.38352.565554.514650@mithrandir.hornik.net>
Message-ID: <Pine.LNX.4.64.0604210730040.20727@homer22.u.washington.edu>

On Fri, 21 Apr 2006, Kurt Hornik wrote:

>>>>>> Simon Urbanek writes:
>
>> On Apr 20, 2006, at 1:23 PM, Henrik Bengtsson (max 7Mb) wrote:
>>> Is it a general consensus on R-devel that *.tar.gz distributions
>>> should only be treated as a distribution for *building* packages
>>> and not for developing them?
>
> [Actually, distributing so that they can be installed and used.]
>
>> I don't know whether this is a general consensus, but it definitely
>> an important distinction. Some authors put their own Makefiles in src
>> although they are not needed and in fact harmful, preventing the
>> package to build on other systems - only because they are too lazy to
>> use R building mechanism for development and don't make the above
>> distinction.
>
> Right :-)
>
> Henrik, as I think I mentioned the last time you asked about this: of
> course you can basically do everything you want.  But it comes at a
> price.  For external sources, you need to write a Makefile of your own,
> so as to make it clear that you provide a mechanism which is different
> from the standard one.  And, as Simon said, the gain in flexibility
> comes at a price.
>
> Personally and as one of the CRAN maintainers, I'd be very unhappy if
> package maintainers would start flooding their source .tar.gz packages
> with full development environment material.  (I am also rather unhappy
> about shipping large data sets which are only used for instructional
> purposes [rather than providing the data set "on its own"].)  It is
> simply not true that bandwidth does not matter.

The GPL, for GPL-licensed packages, requires that the source be made
available and defines the source as "the preferred form of the work for
making modifications to it."  If the .tar.gz packages are not the source, 
then, under the GPL, CRAN is required to provide the source as well, which 
doesn't seem to be an improvement.


 	-thomas

Thomas Lumley			Assoc. Professor, Biostatistics
tlumley at u.washington.edu	University of Washington, Seattle


From rgentlem at fhcrc.org  Fri Apr 21 16:44:16 2006
From: rgentlem at fhcrc.org (Robert Gentleman)
Date: Fri, 21 Apr 2006 07:44:16 -0700
Subject: [Rd] R CMD check: non source files in src on
 (2.3.0	RC	(2006-04-19 r37860))
In-Reply-To: <17480.38352.565554.514650@mithrandir.hornik.net>
References: <44472D38.80603@berkeley.edu>	<Pine.LNX.4.64.0604200752001.14307@gannet.stats.ox.ac.uk>	<59d7961d0604201023h18c8cf68t51b6ca3f2cbe578b@mail.gmail.com>	<787C4179-E8D8-449F-B83B-A04F9A669BD2@r-project.org>
	<17480.38352.565554.514650@mithrandir.hornik.net>
Message-ID: <4448EFC0.5050107@fhcrc.org>



Kurt Hornik wrote:
>>>>>>Simon Urbanek writes:
> 
> 
>>On Apr 20, 2006, at 1:23 PM, Henrik Bengtsson (max 7Mb) wrote:
>>
>>>Is it a general consensus on R-devel that *.tar.gz distributions  
>>>should only be treated as a distribution for *building* packages  
>>>and not for developing them?
> 
> 
> [Actually, distributing so that they can be installed and used.]
> 
> 
>>I don't know whether this is a general consensus, but it definitely  
>>an important distinction. Some authors put their own Makefiles in src  
>>although they are not needed and in fact harmful, preventing the  
>>package to build on other systems - only because they are too lazy to  
>>use R building mechanism for development and don't make the above  
>>distinction.
> 
> 
> Right :-)
> 
> Henrik, as I think I mentioned the last time you asked about this: of
> course you can basically do everything you want.  But it comes at a
> price.  For external sources, you need to write a Makefile of your own,
> so as to make it clear that you provide a mechanism which is different
> from the standard one.  And, as Simon said, the gain in flexibility
> comes at a price.
> 
> Personally and as one of the CRAN maintainers, I'd be very unhappy if
> package maintainers would start flooding their source .tar.gz packages
> with full development environment material.  (I am also rather unhappy
> about shipping large data sets which are only used for instructional
> purposes [rather than providing the data set "on its own"].)  It is
> simply not true that bandwidth does not matter.


   I can see the problem with large packages, but the current system 
does nothing about that AFAIC. And as Simon indicated, his biggest 
problem is the one set of files that we are allowed - so the argument is 
that the current approach is neither necessary nor sufficient and it 
imposes a structure on people that seems to be unneccearily restrictive. 
I don't see how excluding README (or any thing else that a package 
maintainer has put there) makes life better, but maybe I am missing 
something here. These are precisely the sorts of things that have helped 
me to figure out what was intended when it didn't work. So this approach 
is regressive, IMHO.

  If the size is not large, who cares what is in a package, and things 
releated to source should be in src. I see that a similar approach is 
being taken with the R directory (and probably other directories).  This 
is, in my opinion, unfortunate, imposing restrictions that don't solve 
the problem mentioned in some general way are not useful.

  For BioC, we manually check the size etc and ask people to reduce and 
remove. You could easily do the same at CRAN (and even automate it). 
BioC packages can be enormous relative to those on CRAN and I don't 
think we have ever had a serious complaint about it. But then the data 
sets tend to be large, so maybe people are just more forgiving.

  As for the difference between source packages and built packages, yes 
it would be nice at some time to enter into a discussion on that topic. 
There are lots of things that can be done at build time (that are not 
currently being done) that would speed up package installation etc. But 
they come at the price that Henrik has mentioned. The built package is 
no longer suitable for development. And hence we may usefully consider 
another format (something between source and binary, .Rgz?)

  best wishes
    Robert


> 
> If there is need, we could start having developer-package repositories.
> However, I'd prefer a different approach.  We're currently in the
> process of updating the CRAN server infrastructure, and should be able
> to start deploying an R-forge project hosting service "eventually"
> (hopefully, we can set things up during the summer).  This should
> provide us with an ideal infrastructure for sharing developer resources,
> in particular as we could add QC testing et al to the standard community
> services.
> 
> Best
> -k
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 

-- 
Robert Gentleman, PhD
Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M2-B876
PO Box 19024
Seattle, Washington 98109-1024
206-667-7700
rgentlem at fhcrc.org


From duncan at wald.ucdavis.edu  Fri Apr 21 18:04:27 2006
From: duncan at wald.ucdavis.edu (Duncan Temple Lang)
Date: Fri, 21 Apr 2006 09:04:27 -0700
Subject: [Rd] R CMD check: non source files in src on
 (2.3.0	RC	(2006-04-19 r37860))
In-Reply-To: <4448EFC0.5050107@fhcrc.org>
References: <44472D38.80603@berkeley.edu>	<Pine.LNX.4.64.0604200752001.14307@gannet.stats.ox.ac.uk>	<59d7961d0604201023h18c8cf68t51b6ca3f2cbe578b@mail.gmail.com>	<787C4179-E8D8-449F-B83B-A04F9A669BD2@r-project.org>	<17480.38352.565554.514650@mithrandir.hornik.net>
	<4448EFC0.5050107@fhcrc.org>
Message-ID: <4449028B.9070301@wald.ucdavis.edu>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1



Robert Gentleman wrote:
> 
> ...........
>   As for the difference between source packages and built packages, yes 
> it would be nice at some time to enter into a discussion on that topic. 
> There are lots of things that can be done at build time (that are not 
> currently being done) that would speed up package installation etc. But 
> they come at the price that Henrik has mentioned. The built package is 
> no longer suitable for development. And hence we may usefully consider 
> another format (something between source and binary, .Rgz?)
> 

I didn't get any time before the feature freeze to work on a new package
mechanism, but I think that is what is needed rather than tweaking and
complicating the existing collection of perl and shell scripts.
I believe it is time that we now move the package system to R code
and use real OOP to allow for all these differences.
Now that I am not teaching 5 days a week, I will have time to work on
this and so get the frameworks (packages that provide compiled/native
routines for other packages to use) as a first example.  Hopefully
sometime in (northern hemispher) summer.


>   best wishes
>     Robert
> 
> 
> 
>>If there is need, we could start having developer-package repositories.
>>However, I'd prefer a different approach.  We're currently in the
>>process of updating the CRAN server infrastructure, and should be able
>>to start deploying an R-forge project hosting service "eventually"
>>(hopefully, we can set things up during the summer).  This should
>>provide us with an ideal infrastructure for sharing developer resources,
>>in particular as we could add QC testing et al to the standard community
>>services.
>>
>>Best
>>-k
>>
>>______________________________________________
>>R-devel at r-project.org mailing list
>>https://stat.ethz.ch/mailman/listinfo/r-devel
>>
> 
> 

- --
Duncan Temple Lang                    duncan at wald.ucdavis.edu
Department of Statistics              work:  (530) 752-4782
4210 Mathematical Sciences Building   fax:   (530) 752-7099
One Shields Ave.
University of California at Davis
Davis,
CA 95616,
USA
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.3 (Darwin)

iD8DBQFESQKK9p/Jzwa2QP4RAiaYAJwM16032JOLp6Qst7E0xNsAfuoHTgCfW+dq
fUnLrPaIzZJiCoAg9+Glmwc=
=8ZKC
-----END PGP SIGNATURE-----


From sfalcon at fhcrc.org  Fri Apr 21 20:20:10 2006
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Fri, 21 Apr 2006 11:20:10 -0700
Subject: [Rd] Questions on version arg to setClass and serialized instances
Message-ID: <m21wvqbxk5.fsf@ziti.local>

I have a few questions and thoughts regarding class versioning and
serialized S4 class instances.

How is the version argument to setClass is intended to work?  It
appears to want an externalptr, but that seems odd to me.

    setClass("FOO", representation(x="numeric"), version="1.2.3")

    Error in validObject(.Object) : invalid class
    "classRepresentation" object: invalid object for slot "versionKey"
    in class "classRepresentation": got class "character", should be
    or extend class "externalptr"

The use case I'm interested in is: 

  A user has a serialized instance foo of class FOO in old.rda.  The
  class definition lives in FooPkg.  

  Suppose the class definition of FOO in FooPkg changes.  When the
  user loads the new version of FooPkg and then loads their old.rda
  file, how can the user identify the instance as one belonging to an
  old class def version?


Some thoughts:

* A related issue is how to load the appropriate class definition when
  loading a serialized S4 instance.  It makes sense to me that a
  side-effect of load("foo.rda") is that FooPkg gets loaded so that
  the instance "makes sense".  More generally, it would be cool to
  have hooks into serialization and deserialization.  That could allow
  much more robust handling of serialized instances of old definitions
  (even if it would have to happen on a class-by-class basis).

* A class definition version id might have to be an instance slot.
  One possible simple-minded implementation is to force a slot with
  some mangled name like '.class_def_version_string'.  But perhaps
  there is a more elegant approach.

One more question:

Is there a convenient way to introspect an _instance_?  The
slotNames() method seems to get data from the class definition and
doesn't report the right info for an instance that is out of date
w.r.t. to the current class defn (i.e., was deserialized after a class
defn update).

Thanks for listening.

+ seth


From westfeld at inf.tu-dresden.de  Fri Apr 21 20:32:22 2006
From: westfeld at inf.tu-dresden.de (westfeld at inf.tu-dresden.de)
Date: Fri, 21 Apr 2006 20:32:22 +0200 (CEST)
Subject: [Rd] optim "CG" bug w/patch proposal (PR#8786)
Message-ID: <20060421183222.6D37319B9D@slim.kubism.ku.dk>

Dear R team,

when using optim with method "CG" I got the wrong $value for the
reported $par.

Example:
f<-function(p) {
        if (!all(p>-.7)) return(2)
        if (!all(p<.7)) return(2)
        sin((p[1])^2)*sin(p[2])
}
optim(c(0.1,-0.1),f,method="CG",control=list(trace=0,type=1))
$par 19280.68 -10622.32
$value -0.2346207 # should be 2!

optim(c(0.1,-0.1),f,method="CG",control=list(trace=0,type=2))
$par 3834.021 -2718.958
$value -0.0009983175 # should be 2!

Fix:
--- optim.c     (Revision 37878)
+++ optim.c     (Arbeitskopie)
@@ -970,7 +970,8 @@
                            if (!accpoint) {
                                steplength *= stepredn;
                                if (trace) Rprintf("*");
-                           }
+                           } else
+                               *Fmin = f;
                        }
                    } while (!(count == n || accpoint));
                    if (count < n) {

After fix:
optim(c(0.1,-0.1),f,method="CG",control=list(trace=0,type=1))
$par 0.6993467 -0.4900145
$value -0.2211150
optim(c(0.1,-0.1),f,method="CG",control=list(trace=0,type=2))
$par 3834.021 -2718.958
$value 2

Wishlist:

1. Please make type=3 the default in optim (it is more robust).

2. The $par reported for type=2 is still not satisfactory. I found out
that this can be improved by limiting G3 to a maximum of about 2000
(maybe even smaller). However, I'm not a "CG" expert and can live with a
suboptimal result.

--- optim.c     (Revision 37878)
+++ optim.c     (Arbeitskopie)
@@ -946,6 +946,8 @@
                        G3 = G1 / G2;
                    else
                        G3 = 1.0;
+                   if (G3 > 2e3)
+                       G3 = 2e3;
                    gradproj = 0.0;
                    for (i = 0; i < n; i++) {
                        t[i] = t[i] * G3 - g[i];

Andreas

-- 
Andreas Westfeld, 0432 01CC F511 9E2B 0B57 5993 0B22 98F8 4AD8 EEEA
<westfeld at inf.tu-dresden.de> http://www.inf.tu-dresden.de/~aw4
TU Dresden Fakult?t Informatik, Institut f?r Systemarchitektur
Datenschutz und Datensicherheit, Tel. +49-351-463-37918


From sfalcon at fhcrc.org  Mon Apr 24 02:26:44 2006
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Sun, 23 Apr 2006 17:26:44 -0700
Subject: [Rd] R CMD build says, 'Can't call method "print"'
Message-ID: <m2lktvbyyj.fsf@ziti.local>

Hi,

While running R CMD build on one of the Bioc packages, I'm getting the
following error message

* creating vignettes ... OK
* cleaning src
* removing junk files
* checking for LF line-endings in source files
Can't call method "print" on an undefined value at /home/sfalcon/arch/x86_64/R-2.3/bin/build line 646.

The pacakge has CRLF line endings in source files.


> R.version
               _                                   
platform       x86_64-unknown-linux-gnu            
arch           x86_64                              
os             linux-gnu                           
system         x86_64, linux-gnu                   
status         RC                                  
major          2                                   
minor          3.0                                 
year           2006                                
month          04                                  
day            22                                  
svn rev        37906                               
language       R                                   
version.string Version 2.3.0 RC (2006-04-22 r37906)    


+ seth


From ripley at stats.ox.ac.uk  Mon Apr 24 08:03:58 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 24 Apr 2006 07:03:58 +0100 (BST)
Subject: [Rd] R CMD build says, 'Can't call method "print"'
In-Reply-To: <m2lktvbyyj.fsf@ziti.local>
References: <m2lktvbyyj.fsf@ziti.local>
Message-ID: <Pine.LNX.4.64.0604240658340.15505@gannet.stats.ox.ac.uk>

This is a Perl scope problem on $log.  For a quick fix, remove 'my' where 
it is defined (the real fix is to pass $log down, and I'll do that in 
the sources).

On Sun, 23 Apr 2006, Seth Falcon wrote:

> Hi,
>
> While running R CMD build on one of the Bioc packages, I'm getting the
> following error message
>
> * creating vignettes ... OK
> * cleaning src
> * removing junk files
> * checking for LF line-endings in source files
> Can't call method "print" on an undefined value at /home/sfalcon/arch/x86_64/R-2.3/bin/build line 646.
>
> The pacakge has CRLF line endings in source files.
>
>
>> R.version
>               _
> platform       x86_64-unknown-linux-gnu
> arch           x86_64
> os             linux-gnu
> system         x86_64, linux-gnu
> status         RC
> major          2
> minor          3.0
> year           2006
> month          04
> day            22
> svn rev        37906
> language       R
> version.string Version 2.3.0 RC (2006-04-22 r37906)
>
>
> + seth
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From mgleahy at alumni.uwaterloo.ca  Mon Apr 24 08:56:31 2006
From: mgleahy at alumni.uwaterloo.ca (Mike Leahy)
Date: Mon, 24 Apr 2006 02:56:31 -0400
Subject: [Rd] undefined type 'struct tms' when compiling for MinGW
Message-ID: <444C769F.80208@alumni.uwaterloo.ca>

Hello list,

Out of interest, I've been trying to compile R on WinXP with MinGW/MSYS.
 I've been following the instructions for compiling R on windows as
closely as possible.  Below is my configure statement, which seems to
work okay except that no browser or pdf viewer is found, and html docs
will not be compiled...  I've tried enabling/disabling many different
options, and I also add to hack some files to include psignal.h and
run.h using absolute path references.  At any rate, I will invariably
get the errors below with R-2.2.1 and R-rc (from R-latest.tar.gz
downloaded a few hours ago).  It seems that it is looking for times.h
which doesn't exist in the MinGW setup - but should it even be building
anything from the src/unix folder?  I figure I must be missing some key
configuration or step in the windows build instructions...

If anyone has any suggestions, I'd be happy to hear them...

Mike.


TCLTK_LIBS=/c/mingw/lib BLAS_LIBS=/c/mingw/lib LAPACK_LIBS=/c/mingw/lib
./configure --prefix=c:/mingw --with-lapack=yes --with-zlib=yes
--with-system-pcre=yes --with-x=no --disable-nls --disable-rpath
--enable-R-shlib

...

make[3]: Entering directory `/src/R-2.2.1/src/unix'
gcc -I. -I../../src/include -I../../src/include  -I/usr/local/include
-DHAVE_CONFIG_H -D__NO_MATH_INLINES   -g -O2 -c dynload.c -o dynload.lo
gcc -I. -I../../src/include -I../../src/include  -I/usr/local/include
-DHAVE_CONFIG_H -D__NO_MATH_INLINES   -g -O2 -c edit.c -o edit.lo
gcc -I. -I../../src/include -I../../src/include  -I/usr/local/include
-DHAVE_CONFIG_H -D__NO_MATH_INLINES   -g -O2 -c stubs.c -o stubs.lo
gcc -I. -I../../src/include -I../../src/include  -I/usr/local/include
-DHAVE_CONFIG_H -D__NO_MATH_INLINES   -g -O2 -c system.c -o system.lo
gcc -I. -I../../src/include -I../../src/include  -I/usr/local/include
-DHAVE_CONFIG_H -D__NO_MATH_INLINES   -g -O2 -c sys-unix.c -o sys-unix.lo
sys-unix.c: In function `R_getProcTime':sys-unix.c:176: error: invalid
use of undefined type `struct tms'
sys-unix.c:177: error: invalid use of undefined type `struct tms'
sys-unix.c:179: error: invalid use of undefined type `struct tms'
sys-unix.c:180: error: invalid use of undefined type `struct tms'
sys-unix.c: In function `Rf_InitTempDir':
sys-unix.c:285: error: too many arguments to function `mkdir'
sys-unix.c:294: error: too many arguments to function `mkdir'
sys-unix.c: At top level:
sys-unix.c:165: error: storage size of `timeinfo' isn't known
make[3]: *** [sys-unix.lo] Error 1
make[3]: Leaving directory `/src/R-2.2.1/src/unix'
make[2]: *** [R] Error 2
make[2]: Leaving directory `/src/R-2.2.1/src/unix'
make[1]: *** [R] Error 1
make[1]: Leaving directory `/src/R-2.2.1/src'
make: *** [R] Error 1


From ripley at stats.ox.ac.uk  Mon Apr 24 09:24:24 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 24 Apr 2006 08:24:24 +0100 (BST)
Subject: [Rd] undefined type 'struct tms' when compiling for MinGW
In-Reply-To: <444C769F.80208@alumni.uwaterloo.ca>
References: <444C769F.80208@alumni.uwaterloo.ca>
Message-ID: <Pine.LNX.4.64.0604240822510.16823@gannet.stats.ox.ac.uk>

On Mon, 24 Apr 2006, Mike Leahy wrote:

> Hello list,
>
> Out of interest, I've been trying to compile R on WinXP with MinGW/MSYS.
> I've been following the instructions for compiling R on windows as
> closely as possible.  Below is my configure statement, which seems to
> work okay except that no browser or pdf viewer is found, and html docs

But those instructions do not tell you to run configure!

> will not be compiled...  I've tried enabling/disabling many different
> options, and I also add to hack some files to include psignal.h and
> run.h using absolute path references.  At any rate, I will invariably
> get the errors below with R-2.2.1 and R-rc (from R-latest.tar.gz
> downloaded a few hours ago).  It seems that it is looking for times.h
> which doesn't exist in the MinGW setup - but should it even be building
> anything from the src/unix folder?  I figure I must be missing some key
> configuration or step in the windows build instructions...

I think you are missing the instructions, period.  There is a separate 
chapter in the R-admin manual about building for Windows.

> If anyone has any suggestions, I'd be happy to hear them...
>
> Mike.
>
>
> TCLTK_LIBS=/c/mingw/lib BLAS_LIBS=/c/mingw/lib LAPACK_LIBS=/c/mingw/lib
> ./configure --prefix=c:/mingw --with-lapack=yes --with-zlib=yes
> --with-system-pcre=yes --with-x=no --disable-nls --disable-rpath
> --enable-R-shlib
>
> ...
>
> make[3]: Entering directory `/src/R-2.2.1/src/unix'
> gcc -I. -I../../src/include -I../../src/include  -I/usr/local/include
> -DHAVE_CONFIG_H -D__NO_MATH_INLINES   -g -O2 -c dynload.c -o dynload.lo
> gcc -I. -I../../src/include -I../../src/include  -I/usr/local/include
> -DHAVE_CONFIG_H -D__NO_MATH_INLINES   -g -O2 -c edit.c -o edit.lo
> gcc -I. -I../../src/include -I../../src/include  -I/usr/local/include
> -DHAVE_CONFIG_H -D__NO_MATH_INLINES   -g -O2 -c stubs.c -o stubs.lo
> gcc -I. -I../../src/include -I../../src/include  -I/usr/local/include
> -DHAVE_CONFIG_H -D__NO_MATH_INLINES   -g -O2 -c system.c -o system.lo
> gcc -I. -I../../src/include -I../../src/include  -I/usr/local/include
> -DHAVE_CONFIG_H -D__NO_MATH_INLINES   -g -O2 -c sys-unix.c -o sys-unix.lo
> sys-unix.c: In function `R_getProcTime':sys-unix.c:176: error: invalid
> use of undefined type `struct tms'
> sys-unix.c:177: error: invalid use of undefined type `struct tms'
> sys-unix.c:179: error: invalid use of undefined type `struct tms'
> sys-unix.c:180: error: invalid use of undefined type `struct tms'
> sys-unix.c: In function `Rf_InitTempDir':
> sys-unix.c:285: error: too many arguments to function `mkdir'
> sys-unix.c:294: error: too many arguments to function `mkdir'
> sys-unix.c: At top level:
> sys-unix.c:165: error: storage size of `timeinfo' isn't known
> make[3]: *** [sys-unix.lo] Error 1
> make[3]: Leaving directory `/src/R-2.2.1/src/unix'
> make[2]: *** [R] Error 2
> make[2]: Leaving directory `/src/R-2.2.1/src/unix'
> make[1]: *** [R] Error 1
> make[1]: Leaving directory `/src/R-2.2.1/src'
> make: *** [R] Error 1
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ernesto at ipimar.pt  Mon Apr 24 10:52:28 2006
From: ernesto at ipimar.pt (ernesto)
Date: Mon, 24 Apr 2006 09:52:28 +0100
Subject: [Rd] transform argument on 2.3 rc 2006-04-20
Message-ID: <444C91CC.6060308@ipimar.pt>

Hi,

I'm adjusting package FLCore to the new R version and I got an error due
to the change of the transform function argument "x" to "_data". Was
this intentional ?

Regards

EJ


From Kurt.Hornik at wu-wien.ac.at  Mon Apr 24 10:59:04 2006
From: Kurt.Hornik at wu-wien.ac.at (Kurt Hornik)
Date: Mon, 24 Apr 2006 10:59:04 +0200
Subject: [Rd] transform argument on 2.3 rc 2006-04-20
In-Reply-To: <444C91CC.6060308@ipimar.pt>
References: <444C91CC.6060308@ipimar.pt>
Message-ID: <17484.37720.861628.609299@mithrandir.hornik.net>

>>>>> ernesto  writes:

> Hi,

> I'm adjusting package FLCore to the new R version and I got an error
> due to the change of the transform function argument "x" to
> "_data". Was this intentional ?

You mean that you get the error? :-)

See NEWS:

    o   The data frame argument to transform() is no longer called 'x',
        but '_data'.  Since this is an invalid name, it is less likely
        to clash with names given to transformed variables. (People
        were getting into trouble with transform(data, x=y+z).)

See the code in base for how to use _data in code and docs.

-k


From ernesto at ipimar.pt  Mon Apr 24 11:17:35 2006
From: ernesto at ipimar.pt (ernesto)
Date: Mon, 24 Apr 2006 10:17:35 +0100
Subject: [Rd] transform argument on 2.3 rc 2006-04-20
In-Reply-To: <17484.37720.861628.609299@mithrandir.hornik.net>
References: <444C91CC.6060308@ipimar.pt>
	<17484.37720.861628.609299@mithrandir.hornik.net>
Message-ID: <444C97AF.6060505@ipimar.pt>

Kurt Hornik wrote:

>>>>>>ernesto  writes:
>>>>>>            
>>>>>>
>
>  
>
>>Hi,
>>    
>>
>
>  
>
>>I'm adjusting package FLCore to the new R version and I got an error
>>due to the change of the transform function argument "x" to
>>"_data". Was this intentional ?
>>    
>>
>
>You mean that you get the error? :-)
>
>See NEWS:
>
>    o   The data frame argument to transform() is no longer called 'x',
>        but '_data'.  Since this is an invalid name, it is less likely
>        to clash with names given to transformed variables. (People
>        were getting into trouble with transform(data, x=y+z).)
>
>See the code in base for how to use _data in code and docs.
>
>-k
>  
>
Ok,

Thanks for your answer. I'll check the coding and docs.

Regards

EJ


From mgleahy at alumni.uwaterloo.ca  Mon Apr 24 11:25:32 2006
From: mgleahy at alumni.uwaterloo.ca (Mike Leahy)
Date: Mon, 24 Apr 2006 05:25:32 -0400
Subject: [Rd] undefined type 'struct tms' when compiling for MinGW
In-Reply-To: <Pine.LNX.4.64.0604240822510.16823@gannet.stats.ox.ac.uk>
References: <444C769F.80208@alumni.uwaterloo.ca>
	<Pine.LNX.4.64.0604240822510.16823@gannet.stats.ox.ac.uk>
Message-ID: <444C998C.6000709@alumni.uwaterloo.ca>


Prof Brian Ripley wrote:
> On Mon, 24 Apr 2006, Mike Leahy wrote:
> 
>> Hello list,
>>
>> Out of interest, I've been trying to compile R on WinXP with MinGW/MSYS.
>> I've been following the instructions for compiling R on windows as
>> closely as possible.  Below is my configure statement, which seems to
>> work okay except that no browser or pdf viewer is found, and html docs
> 
> But those instructions do not tell you to run configure!
> 

This is an important detail that I overlooked...

>> will not be compiled...  I've tried enabling/disabling many different
>> options, and I also add to hack some files to include psignal.h and
>> run.h using absolute path references.  At any rate, I will invariably
>> get the errors below with R-2.2.1 and R-rc (from R-latest.tar.gz
>> downloaded a few hours ago).  It seems that it is looking for times.h
>> which doesn't exist in the MinGW setup - but should it even be building
>> anything from the src/unix folder?  I figure I must be missing some key
>> configuration or step in the windows build instructions...
> 
> I think you are missing the instructions, period.  There is a separate
> chapter in the R-admin manual about building for Windows.
> 

This is essentially true...I had been reading those instructions, in
addition to those by Prof. Ripley / Duncan Murdoch.  However, after you
pointed out my first mistake above, I reread the instructions and found
I had skipped over a big chunk.  It seems to be compiling the core
itself now - thanks for the pointer.

Unfortunately, I have run into a new snag...if I set 'HELP = YES' in
MkRules, I get the following output from the build:

writing help indices for package: baseCan't locate R/Rdconv.pm in @INC
(@INC contains: C /msys/src/R-2.2.1/share/perl /usr/li
b/perl5/5.6.1/msys /usr/lib/perl5/5.6.1
/usr/lib/perl5/site_perl/5.6.1/msys /usr/lib/perl5/site_perl/5.6.1
/usr/lib/perl5/sit
e_perl .) at ../../../share/perl/build-help-windows.pl line 23.
BEGIN failed--compilation aborted at
../../../share/perl/build-help-windows.pl line 23.
make[2]: *** [index-base] Error 2
make[1]: *** [rpackageindices] Error 1
make: *** [all] Error 2

I have the latest ActiveState windows port of perl installed in c:\perl,
which is v5.8.8, and I have no idea why this '@INC' parameter is
pointing to a version of perl (5.6.1) that doesn't even exist in my msys
installation.  I looked for any obvious settings in MkRules and didn't
have any luck.  My PATH points to the ActiveState installation of
perl...I'm not sure what else can be changed here.  Any ideas for this?

Thanks again for any help,
Mike


From r.hankin at noc.soton.ac.uk  Mon Apr 24 11:29:35 2006
From: r.hankin at noc.soton.ac.uk (Robin Hankin)
Date: Mon, 24 Apr 2006 10:29:35 +0100
Subject: [Rd] unsigned long long integers
Message-ID: <A0595678-8AB7-4881-8D22-5E37BC26E9CE@soc.soton.ac.uk>

Hi.

R-exts, section 1.7, discusses the passing of long long integers  
between R and C.
I want to use unsigned long long integers, but
I only need them inside a C function.

I have a  function that maps the nonnegative integers to the positive  
integers.
The function is defined by a delicate recursive algorithm that is exact
for integer arithmetic, but wildly incorrect for doubles.

The function increases rapidly with its argument, and ordinary integers
are not enough to illustrate my point (in a paper I am writing).


The C function is as follows:



void numbparts_longint(int *n, double *p){/* p(1)...p(n) calculated */
         int i,s,f,r;
         unsigned long long int *ip;
         unsigned long long int pp[*n];

/* COMPLICATED RECURSIVE ALGORITHM IN WHICH PP IS FILLED SNIPPED */

         for(i=0 ; i < *n ; i++){
                 p[i] = (double) pp[i];
         }
}



This compiles fine with "gcc -Wall" (and illustrates my point!)
but R CMD check reports


   partitions.c:180: warning: ISO C90 does not support 'long long'
   partitions.c:181: warning: ISO C90 does not support 'long long'


I really want long long integers here.  What are my options?
[the same happens with signed long long integers]





--
Robin Hankin
Uncertainty Analyst
National Oceanography Centre, Southampton
European Way, Southampton SO14 3ZH, UK
  tel  023-8059-7743


From ripley at stats.ox.ac.uk  Mon Apr 24 11:43:05 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 24 Apr 2006 10:43:05 +0100 (BST)
Subject: [Rd] unsigned long long integers
In-Reply-To: <A0595678-8AB7-4881-8D22-5E37BC26E9CE@soc.soton.ac.uk>
References: <A0595678-8AB7-4881-8D22-5E37BC26E9CE@soc.soton.ac.uk>
Message-ID: <Pine.LNX.4.64.0604241040490.20578@gannet.stats.ox.ac.uk>

R-admin recommends -std=gnu99, which will solve this.

Given that long and long long mean different things on different 
platforms, I would endorse the recommendation to use a C99 explicit type.

On Mon, 24 Apr 2006, Robin Hankin wrote:

> Hi.
>
> R-exts, section 1.7, discusses the passing of long long integers
> between R and C.
> I want to use unsigned long long integers, but
> I only need them inside a C function.
>
> I have a  function that maps the nonnegative integers to the positive
> integers.
> The function is defined by a delicate recursive algorithm that is exact
> for integer arithmetic, but wildly incorrect for doubles.
>
> The function increases rapidly with its argument, and ordinary integers
> are not enough to illustrate my point (in a paper I am writing).
>
>
> The C function is as follows:
>
>
>
> void numbparts_longint(int *n, double *p){/* p(1)...p(n) calculated */
>         int i,s,f,r;
>         unsigned long long int *ip;
>         unsigned long long int pp[*n];
>
> /* COMPLICATED RECURSIVE ALGORITHM IN WHICH PP IS FILLED SNIPPED */
>
>         for(i=0 ; i < *n ; i++){
>                 p[i] = (double) pp[i];
>         }
> }
>
>
>
> This compiles fine with "gcc -Wall" (and illustrates my point!)
> but R CMD check reports
>
>
>   partitions.c:180: warning: ISO C90 does not support 'long long'
>   partitions.c:181: warning: ISO C90 does not support 'long long'
>
>
> I really want long long integers here.  What are my options?
> [the same happens with signed long long integers]
>
>
>
>
>
> --
> Robin Hankin
> Uncertainty Analyst
> National Oceanography Centre, Southampton
> European Way, Southampton SO14 3ZH, UK
>  tel  023-8059-7743
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Mon Apr 24 11:51:10 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 24 Apr 2006 10:51:10 +0100 (BST)
Subject: [Rd] undefined type 'struct tms' when compiling for MinGW
In-Reply-To: <444C998C.6000709@alumni.uwaterloo.ca>
References: <444C769F.80208@alumni.uwaterloo.ca>
	<Pine.LNX.4.64.0604240822510.16823@gannet.stats.ox.ac.uk>
	<444C998C.6000709@alumni.uwaterloo.ca>
Message-ID: <Pine.LNX.4.64.0604241047540.20578@gannet.stats.ox.ac.uk>

I think you are somehow running in MSYS (also not part of the 
instructions) and so have a different Perl earlier in your path.

There's a comment in those instructions about

 	This section contains a lot of prescriptive comments.  They are
 	here as a result of bitter experience.

and you are finding that out the hard way.

On Mon, 24 Apr 2006, Mike Leahy wrote:

>
> Prof Brian Ripley wrote:
>> On Mon, 24 Apr 2006, Mike Leahy wrote:
>>
>>> Hello list,
>>>
>>> Out of interest, I've been trying to compile R on WinXP with MinGW/MSYS.
>>> I've been following the instructions for compiling R on windows as
>>> closely as possible.  Below is my configure statement, which seems to
>>> work okay except that no browser or pdf viewer is found, and html docs
>>
>> But those instructions do not tell you to run configure!
>>
>
> This is an important detail that I overlooked...
>
>>> will not be compiled...  I've tried enabling/disabling many different
>>> options, and I also add to hack some files to include psignal.h and
>>> run.h using absolute path references.  At any rate, I will invariably
>>> get the errors below with R-2.2.1 and R-rc (from R-latest.tar.gz
>>> downloaded a few hours ago).  It seems that it is looking for times.h
>>> which doesn't exist in the MinGW setup - but should it even be building
>>> anything from the src/unix folder?  I figure I must be missing some key
>>> configuration or step in the windows build instructions...
>>
>> I think you are missing the instructions, period.  There is a separate
>> chapter in the R-admin manual about building for Windows.
>>
>
> This is essentially true...I had been reading those instructions, in
> addition to those by Prof. Ripley / Duncan Murdoch.  However, after you
> pointed out my first mistake above, I reread the instructions and found
> I had skipped over a big chunk.  It seems to be compiling the core
> itself now - thanks for the pointer.
>
> Unfortunately, I have run into a new snag...if I set 'HELP = YES' in
> MkRules, I get the following output from the build:
>
> writing help indices for package: baseCan't locate R/Rdconv.pm in @INC
> (@INC contains: C /msys/src/R-2.2.1/share/perl /usr/li
> b/perl5/5.6.1/msys /usr/lib/perl5/5.6.1
> /usr/lib/perl5/site_perl/5.6.1/msys /usr/lib/perl5/site_perl/5.6.1
> /usr/lib/perl5/sit
> e_perl .) at ../../../share/perl/build-help-windows.pl line 23.
> BEGIN failed--compilation aborted at
> ../../../share/perl/build-help-windows.pl line 23.
> make[2]: *** [index-base] Error 2
> make[1]: *** [rpackageindices] Error 1
> make: *** [all] Error 2
>
> I have the latest ActiveState windows port of perl installed in c:\perl,
> which is v5.8.8, and I have no idea why this '@INC' parameter is
> pointing to a version of perl (5.6.1) that doesn't even exist in my msys
> installation.  I looked for any obvious settings in MkRules and didn't
> have any luck.  My PATH points to the ActiveState installation of
> perl...I'm not sure what else can be changed here.  Any ideas for this?
>
> Thanks again for any help,
> Mike
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From Kurt.Hornik at wu-wien.ac.at  Mon Apr 24 11:52:12 2006
From: Kurt.Hornik at wu-wien.ac.at (Kurt Hornik)
Date: Mon, 24 Apr 2006 11:52:12 +0200
Subject: [Rd] Looking for Jeff Banfield
Message-ID: <17484.40908.941946.792378@mithrandir.hornik.net>

Email to Jeff Banfield, the creator of RWeb, seem to bounce with

   ----- The following addresses had permanent fatal errors -----
<jeff at math.montana.edu>
    (reason: 550 5.1.1 <jeff at math.montana.edu>... User unknown)

Does anyone know how to reach Jeff?

Thanks
-k


From mgleahy at alumni.uwaterloo.ca  Mon Apr 24 15:23:52 2006
From: mgleahy at alumni.uwaterloo.ca (Mike Leahy)
Date: Mon, 24 Apr 2006 09:23:52 -0400
Subject: [Rd] undefined type 'struct tms' when compiling for MinGW
In-Reply-To: <Pine.LNX.4.64.0604241047540.20578@gannet.stats.ox.ac.uk>
References: <444C769F.80208@alumni.uwaterloo.ca>
	<Pine.LNX.4.64.0604240822510.16823@gannet.stats.ox.ac.uk>
	<444C998C.6000709@alumni.uwaterloo.ca>
	<Pine.LNX.4.64.0604241047540.20578@gannet.stats.ox.ac.uk>
Message-ID: <444CD168.2010304@alumni.uwaterloo.ca>

Ok, that was it.  After taking Msys out of the equation, and removing
some extra folders at the start of my PATH that weren't supposed to be
there, the whole thing compiled perfectly.  Thanks again for your help.

Mike

Prof Brian Ripley wrote:
> I think you are somehow running in MSYS (also not part of the
> instructions) and so have a different Perl earlier in your path.
> 
> There's a comment in those instructions about
> 
>     This section contains a lot of prescriptive comments.  They are
>     here as a result of bitter experience.
> 
> and you are finding that out the hard way.
> 
> On Mon, 24 Apr 2006, Mike Leahy wrote:
> 
>>
>> Prof Brian Ripley wrote:
>>> On Mon, 24 Apr 2006, Mike Leahy wrote:
>>>
>>>> Hello list,
>>>>
>>>> Out of interest, I've been trying to compile R on WinXP with
>>>> MinGW/MSYS.
>>>> I've been following the instructions for compiling R on windows as
>>>> closely as possible.  Below is my configure statement, which seems to
>>>> work okay except that no browser or pdf viewer is found, and html docs
>>>
>>> But those instructions do not tell you to run configure!
>>>
>>
>> This is an important detail that I overlooked...
>>
>>>> will not be compiled...  I've tried enabling/disabling many different
>>>> options, and I also add to hack some files to include psignal.h and
>>>> run.h using absolute path references.  At any rate, I will invariably
>>>> get the errors below with R-2.2.1 and R-rc (from R-latest.tar.gz
>>>> downloaded a few hours ago).  It seems that it is looking for times.h
>>>> which doesn't exist in the MinGW setup - but should it even be building
>>>> anything from the src/unix folder?  I figure I must be missing some key
>>>> configuration or step in the windows build instructions...
>>>
>>> I think you are missing the instructions, period.  There is a separate
>>> chapter in the R-admin manual about building for Windows.
>>>
>>
>> This is essentially true...I had been reading those instructions, in
>> addition to those by Prof. Ripley / Duncan Murdoch.  However, after you
>> pointed out my first mistake above, I reread the instructions and found
>> I had skipped over a big chunk.  It seems to be compiling the core
>> itself now - thanks for the pointer.
>>
>> Unfortunately, I have run into a new snag...if I set 'HELP = YES' in
>> MkRules, I get the following output from the build:
>>
>> writing help indices for package: baseCan't locate R/Rdconv.pm in @INC
>> (@INC contains: C /msys/src/R-2.2.1/share/perl /usr/li
>> b/perl5/5.6.1/msys /usr/lib/perl5/5.6.1
>> /usr/lib/perl5/site_perl/5.6.1/msys /usr/lib/perl5/site_perl/5.6.1
>> /usr/lib/perl5/sit
>> e_perl .) at ../../../share/perl/build-help-windows.pl line 23.
>> BEGIN failed--compilation aborted at
>> ../../../share/perl/build-help-windows.pl line 23.
>> make[2]: *** [index-base] Error 2
>> make[1]: *** [rpackageindices] Error 1
>> make: *** [all] Error 2
>>
>> I have the latest ActiveState windows port of perl installed in c:\perl,
>> which is v5.8.8, and I have no idea why this '@INC' parameter is
>> pointing to a version of perl (5.6.1) that doesn't even exist in my msys
>> installation.  I looked for any obvious settings in MkRules and didn't
>> have any luck.  My PATH points to the ActiveState installation of
>> perl...I'm not sure what else can be changed here.  Any ideas for this?
>>
>> Thanks again for any help,
>> Mike
>>
>>
>


From Torsten.Hothorn at rzmail.uni-erlangen.de  Mon Apr 24 16:23:20 2006
From: Torsten.Hothorn at rzmail.uni-erlangen.de (Torsten Hothorn)
Date: Mon, 24 Apr 2006 16:23:20 +0200 (CEST)
Subject: [Rd] gsub + backslashes
Message-ID: <Pine.LNX.4.64.0604241620370.12055@imbe153.imbe.med.uni-erlangen.de>


Dear developeRs,

I thought that backslashes can be escaped in the usual way (and I think I 
did this before) but I can't see why

R> gsub("\\", "x", "\alpha")
Error in gsub(pattern, replacement, x, ignore.case, extended, fixed, 
useBytes) :
         invalid regular expression '\'

gives an error. Or am I just blind?

Best,

Torsten

R> version
                _
platform       i686-pc-linux-gnu
arch           i686
os             linux-gnu
system         i686, linux-gnu
status         Under development (unstable)
major          2
minor          4.0
year           2006
month          04
day            18
svn rev        37840
language       R
version.string R version 2.4.0 Under development (unstable) (2006-04-18 
r37840)


From simon.urbanek at r-project.org  Mon Apr 24 16:29:43 2006
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Mon, 24 Apr 2006 10:29:43 -0400
Subject: [Rd] gsub + backslashes
In-Reply-To: <Pine.LNX.4.64.0604241620370.12055@imbe153.imbe.med.uni-erlangen.de>
References: <Pine.LNX.4.64.0604241620370.12055@imbe153.imbe.med.uni-erlangen.de>
Message-ID: <22AE17D0-2FCC-466A-8377-84ABE617C500@r-project.org>


On Apr 24, 2006, at 10:23 AM, Torsten Hothorn wrote:

>
> Dear developeRs,
>
> I thought that backslashes can be escaped in the usual way (and I  
> think I
> did this before) but I can't see why
>
> R> gsub("\\", "x", "\alpha")
> Error in gsub(pattern, replacement, x, ignore.case, extended, fixed,
> useBytes) :
>          invalid regular expression '\'
>
> gives an error. Or am I just blind?
>

In REs you need to escape backslashes, so you need double-escaping:  
one for the R string representation and one for the RE:

 > gsub("\\\\", "x", "\\alpha")
[1] "xalpha"

For illustration purposes:

 > cat("\\\\")
\\
 > cat("\alpha")
lpha
 > cat("\\alpha")
\alpha

Cheers,
Simon


From ggrothendieck at gmail.com  Mon Apr 24 16:30:32 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Mon, 24 Apr 2006 10:30:32 -0400
Subject: [Rd] gsub + backslashes
In-Reply-To: <Pine.LNX.4.64.0604241620370.12055@imbe153.imbe.med.uni-erlangen.de>
References: <Pine.LNX.4.64.0604241620370.12055@imbe153.imbe.med.uni-erlangen.de>
Message-ID: <971536df0604240730j718550e6ra534b7da435fd947@mail.gmail.com>

\ is a special character in regular expressions so you need to
escape it as \\ but putting \\ between quotes give you only \
so you need \\\\ to get \\.  Any of these would work:

gsub("\\\\", "x", "\\alpha")
gsub("[\\]", "x", "\\alpha")
sub(".", "x", "\\alpha") # assumes \ is first character
gsub("\\", "x", "\\alpha", fixed = TRUE)
chartr("\\", "x", "\\alpha")


On 4/24/06, Torsten Hothorn <Torsten.Hothorn at rzmail.uni-erlangen.de> wrote:
>
> Dear developeRs,
>
> I thought that backslashes can be escaped in the usual way (and I think I
> did this before) but I can't see why
>
> R> gsub("\\", "x", "\alpha")
> Error in gsub(pattern, replacement, x, ignore.case, extended, fixed,
> useBytes) :
>         invalid regular expression '\'
>
> gives an error. Or am I just blind?
>
> Best,
>
> Torsten
>
> R> version
>                _
> platform       i686-pc-linux-gnu
> arch           i686
> os             linux-gnu
> system         i686, linux-gnu
> status         Under development (unstable)
> major          2
> minor          4.0
> year           2006
> month          04
> day            18
> svn rev        37840
> language       R
> version.string R version 2.4.0 Under development (unstable) (2006-04-18
> r37840)
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From ripley at stats.ox.ac.uk  Mon Apr 24 17:18:14 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 24 Apr 2006 16:18:14 +0100 (BST)
Subject: [Rd] gsub + backslashes
In-Reply-To: <Pine.LNX.4.64.0604241620370.12055@imbe153.imbe.med.uni-erlangen.de>
References: <Pine.LNX.4.64.0604241620370.12055@imbe153.imbe.med.uni-erlangen.de>
Message-ID: <Pine.LNX.4.64.0604241617220.31423@gannet.stats.ox.ac.uk>

On Mon, 24 Apr 2006, Torsten Hothorn wrote:

>
> Dear developeRs,
>
> I thought that backslashes can be escaped in the usual way (and I think I
> did this before) but I can't see why
>
> R> gsub("\\", "x", "\alpha")
> Error in gsub(pattern, replacement, x, ignore.case, extended, fixed,
> useBytes) :
>         invalid regular expression '\'
>
> gives an error. Or am I just blind?

Escape for R and escape for regexp:

> gsub("\\\\", "x", "\\alpha")
[1] "xalpha"

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From bill at insightful.com  Mon Apr 24 17:32:48 2006
From: bill at insightful.com (Bill Dunlap)
Date: Mon, 24 Apr 2006 08:32:48 -0700 (PDT)
Subject: [Rd] gsub + backslashes
In-Reply-To: <Pine.LNX.4.64.0604241617220.31423@gannet.stats.ox.ac.uk>
References: <Pine.LNX.4.64.0604241620370.12055@imbe153.imbe.med.uni-erlangen.de>
	<Pine.LNX.4.64.0604241617220.31423@gannet.stats.ox.ac.uk>
Message-ID: <Pine.GSO.4.56.0604240827010.25964@octopus>

On Mon, 24 Apr 2006, Prof Brian Ripley wrote:

> On Mon, 24 Apr 2006, Torsten Hothorn wrote:
>
> >
> > Dear developeRs,
> >
> > I thought that backslashes can be escaped in the usual way (and I think I
> > did this before) but I can't see why
> >
> > R> gsub("\\", "x", "\alpha")
> > Error in gsub(pattern, replacement, x, ignore.case, extended, fixed,
> > useBytes) :
> >         invalid regular expression '\'
> >
> > gives an error. Or am I just blind?
>
> Escape for R and escape for regexp:
>
> > gsub("\\\\", "x", "\\alpha")
> [1] "xalpha"

Also, unless fixed==TRUE, you need to double the backslash
in the replacement string (because \\<digit|U|L> has a special
meaning when fixed!=TRUE):

   > cat(gsub("/", "\\\\", "C:/Program Files/R"),"\n")
   C:\Program Files\R
   > cat(gsub("/", "\\", "C:/Program Files/R", fixed=T), "\n")
   C:\Program Files\R

----------------------------------------------------------------------------
Bill Dunlap
Insightful Corporation
bill at insightful dot com
360-428-8146

 "All statements in this message represent the opinions of the author and do
 not necessarily reflect Insightful Corporation policy or position."


From ostrouchovg at ornl.gov  Mon Apr 24 20:20:39 2006
From: ostrouchovg at ornl.gov (George Ostrouchov)
Date: Mon, 24 Apr 2006 14:20:39 -0400
Subject: [Rd] VTK
Message-ID: <444D16F7.5020503@ornl.gov>

Has anyone developed an R interface to VTK? We are looking into marrying 
some R graphics with a scientific visualization package VisIt that is 
based on VTK. I found some references to VTK on this list back in 2001 
and 2002 suggesting an R-VTK interface would be easy. I will be grateful 
for any new advice.

Thanks!
George

-- 
George Ostrouchov
Statistics and Data Sciences Group
Computer Science and Mathematics Division
Oak Ridge National Laboratory
http://www.csm.ornl.gov/~ost

See you at the JRC 2006?
http://2006jointresearch.bus.utk.edu/
Early registration deadline is April 30, 2006


From Bernhard_Pfaff at fra.invesco.com  Tue Apr 25 16:34:29 2006
From: Bernhard_Pfaff at fra.invesco.com (Pfaff, Bernhard Dr.)
Date: Tue, 25 Apr 2006 15:34:29 +0100
Subject: [Rd] R 2.3.0: Use of NULL as an environment is deprecated
Message-ID: <E4A9111DA23BA048B9A46686BF727CF4039087@DEFRAXMB01.corp.amvescap.net>

Dear R-Devel subscriber,

first, let me express my thank to the R-Core team for the new release! I
appreciate their efforts and time spent to enhance R.
In accordance with the 'NEWS' file (see excerpt of it below), 

[...
o	Changed the environment tree to be rooted in an empty
	environment, available as emptyenv().  baseenv() has been
	modified to return an environment with emptyenv() as parent,
	rather than NULL.

...

o	Use of NULL as an environment is deprecated and gives a warning.
...]

I detected the warning message as announced for a couple of contributed
packages, e.g.

library(ape)
library(car)
library(chron)
library(urca)

Now, I am wondering what would be a suitable/elegant way to fix the
packages' code such that the warning does not appear any longer. I am
adressing this question to R-devel, because this might also be of
interest for other package mainatiners.

Many thanks in advance for any hints and pointers.

Regards,
Bernhard




Dr. Bernhard Pfaff
Global Structured Products Group
(Europe)

Invesco Asset Management Deutschland GmbH
Bleichstrasse 60-62
D-60313 Frankfurt am Main

Tel: +49(0)69 298 07230
Fax: +49(0)69 298 07178
Email: bernhard_pfaff at fra.invesco.com 
*****************************************************************
Confidentiality Note: The information contained in this mess...{{dropped}}


From ligges at statistik.uni-dortmund.de  Tue Apr 25 17:33:51 2006
From: ligges at statistik.uni-dortmund.de (Uwe Ligges)
Date: Tue, 25 Apr 2006 17:33:51 +0200
Subject: [Rd] R 2.3.0: Use of NULL as an environment is deprecated
In-Reply-To: <E4A9111DA23BA048B9A46686BF727CF4039087@DEFRAXMB01.corp.amvescap.net>
References: <E4A9111DA23BA048B9A46686BF727CF4039087@DEFRAXMB01.corp.amvescap.net>
Message-ID: <444E415F.5050506@statistik.uni-dortmund.de>

Pfaff, Bernhard Dr. wrote:

> Dear R-Devel subscriber,
> 
> first, let me express my thank to the R-Core team for the new release! I
> appreciate their efforts and time spent to enhance R.
> In accordance with the 'NEWS' file (see excerpt of it below), 
> 
> [...
> o	Changed the environment tree to be rooted in an empty
> 	environment, available as emptyenv().  baseenv() has been
> 	modified to return an environment with emptyenv() as parent,
> 	rather than NULL.
> 
> ...
> 
> o	Use of NULL as an environment is deprecated and gives a warning.
> ...]
> 
> I detected the warning message as announced for a couple of contributed
> packages, e.g.
> 
> library(ape)
> library(car)
> library(chron)
> library(urca)


Not so for me. Are you sure you have reinstalled those packages under 
R-2.3.0?

Uwe Ligges


> Now, I am wondering what would be a suitable/elegant way to fix the
> packages' code such that the warning does not appear any longer. I am
> adressing this question to R-devel, because this might also be of
> interest for other package mainatiners.
> 
> Many thanks in advance for any hints and pointers.
> 
> Regards,
> Bernhard
> 
> 
> 
> 
> Dr. Bernhard Pfaff
> Global Structured Products Group
> (Europe)
> 
> Invesco Asset Management Deutschland GmbH
> Bleichstrasse 60-62
> D-60313 Frankfurt am Main
> 
> Tel: +49(0)69 298 07230
> Fax: +49(0)69 298 07178
> Email: bernhard_pfaff at fra.invesco.com 
> *****************************************************************
> Confidentiality Note: The information contained in this mess...{{dropped}}
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From Bernhard_Pfaff at fra.invesco.com  Tue Apr 25 17:47:59 2006
From: Bernhard_Pfaff at fra.invesco.com (Pfaff, Bernhard Dr.)
Date: Tue, 25 Apr 2006 16:47:59 +0100
Subject: [Rd] R 2.3.0: Use of NULL as an environment is deprecated
Message-ID: <E4A9111DA23BA048B9A46686BF727CF4039088@DEFRAXMB01.corp.amvescap.net>

Pfaff, Bernhard Dr. wrote:

> Dear R-Devel subscriber,
> 
> first, let me express my thank to the R-Core team for the new release!
I
> appreciate their efforts and time spent to enhance R.
> In accordance with the 'NEWS' file (see excerpt of it below), 
> 
> [...
> o	Changed the environment tree to be rooted in an empty
> 	environment, available as emptyenv().  baseenv() has been
> 	modified to return an environment with emptyenv() as parent,
> 	rather than NULL.
> 
> ...
> 
> o	Use of NULL as an environment is deprecated and gives a warning.
> ...]
> 
> I detected the warning message as announced for a couple of
contributed
> packages, e.g.
> 
> library(ape)
> library(car)
> library(chron)
> library(urca)


Not so for me. Are you sure you have reinstalled those packages under 
R-2.3.0?

Uwe Ligges


Dear Uwe,

thank you for your hint. That fixes the warnings for packages 'ape',
'car' and 'chron' issued formerly. However, even after a fresh install
the warnings still show up for the packages 'VLMC' and 'urca', as an
example.
Any further clues are most welcome. 

Best,
Bernhard

> Now, I am wondering what would be a suitable/elegant way to fix the
> packages' code such that the warning does not appear any longer. I am
> adressing this question to R-devel, because this might also be of
> interest for other package mainatiners.
> 
> Many thanks in advance for any hints and pointers.
> 
> Regards,
> Bernhard
> 
> 
> 
> 
> Dr. Bernhard Pfaff
> Global Structured Products Group
> (Europe)
> 
> Invesco Asset Management Deutschland GmbH
> Bleichstrasse 60-62
> D-60313 Frankfurt am Main
> 
> Tel: +49(0)69 298 07230
> Fax: +49(0)69 298 07178
> Email: bernhard_pfaff at fra.invesco.com 
> *****************************************************************
> Confidentiality Note: The information contained in this
mess...{{dropped}}
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From ligges at statistik.uni-dortmund.de  Tue Apr 25 18:00:48 2006
From: ligges at statistik.uni-dortmund.de (Uwe Ligges)
Date: Tue, 25 Apr 2006 18:00:48 +0200
Subject: [Rd] R 2.3.0: Use of NULL as an environment is deprecated
In-Reply-To: <E4A9111DA23BA048B9A46686BF727CF4039088@DEFRAXMB01.corp.amvescap.net>
References: <E4A9111DA23BA048B9A46686BF727CF4039088@DEFRAXMB01.corp.amvescap.net>
Message-ID: <444E47B0.6070101@statistik.uni-dortmund.de>

Pfaff, Bernhard Dr. wrote:

> Pfaff, Bernhard Dr. wrote:
> 
> 
>>Dear R-Devel subscriber,
>>
>>first, let me express my thank to the R-Core team for the new release!
> 
> I
> 
>>appreciate their efforts and time spent to enhance R.
>>In accordance with the 'NEWS' file (see excerpt of it below), 
>>
>>[...
>>o	Changed the environment tree to be rooted in an empty
>>	environment, available as emptyenv().  baseenv() has been
>>	modified to return an environment with emptyenv() as parent,
>>	rather than NULL.
>>
>>...
>>
>>o	Use of NULL as an environment is deprecated and gives a warning.
>>...]
>>
>>I detected the warning message as announced for a couple of
> 
> contributed
> 
>>packages, e.g.
>>
>>library(ape)
>>library(car)
>>library(chron)
>>library(urca)
> 
> 
> 
> Not so for me. Are you sure you have reinstalled those packages under 
> R-2.3.0?
> 
> Uwe Ligges
> 
> 
> Dear Uwe,
> 
> thank you for your hint. That fixes the warnings for packages 'ape',
> 'car' and 'chron' issued formerly. However, even after a fresh install
> the warnings still show up for the packages 'VLMC' and 'urca', as an
> example.
> Any further clues are most welcome. 


OS? R release?

and please report the result of

   packageDescription("urca")
   packageDescription("VLMC")

Uwe Ligges


> Best,
> Bernhard
> 
> 
>>Now, I am wondering what would be a suitable/elegant way to fix the
>>packages' code such that the warning does not appear any longer. I am
>>adressing this question to R-devel, because this might also be of
>>interest for other package mainatiners.
>>
>>Many thanks in advance for any hints and pointers.
>>
>>Regards,
>>Bernhard
>>
>>
>>
>>
>>Dr. Bernhard Pfaff
>>Global Structured Products Group
>>(Europe)
>>
>>Invesco Asset Management Deutschland GmbH
>>Bleichstrasse 60-62
>>D-60313 Frankfurt am Main
>>
>>Tel: +49(0)69 298 07230
>>Fax: +49(0)69 298 07178
>>Email: bernhard_pfaff at fra.invesco.com 
>>*****************************************************************
>>Confidentiality Note: The information contained in this
> 
> mess...{{dropped}}
> 
>>______________________________________________
>>R-devel at r-project.org mailing list
>>https://stat.ethz.ch/mailman/listinfo/r-devel
> 
>


From maechler at stat.math.ethz.ch  Tue Apr 25 18:04:35 2006
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Tue, 25 Apr 2006 18:04:35 +0200
Subject: [Rd] R 2.3.0: Use of NULL as an environment is deprecated
In-Reply-To: <E4A9111DA23BA048B9A46686BF727CF4039088@DEFRAXMB01.corp.amvescap.net>
References: <E4A9111DA23BA048B9A46686BF727CF4039088@DEFRAXMB01.corp.amvescap.net>
Message-ID: <17486.18579.501884.326145@stat.math.ethz.ch>

>>>>> "BernPf" == Pfaff, Bernhard Dr <Bernhard_Pfaff at fra.invesco.com>
>>>>>     on Tue, 25 Apr 2006 16:47:59 +0100 writes:

    BernPf> Pfaff, Bernhard Dr. wrote:
    >> Dear R-Devel subscriber,
    >> 
    >> first, let me express my thank to the R-Core team for the
    >> new release!
    BernPf> I
    >> appreciate their efforts and time spent to enhance R.  In
    >> accordance with the 'NEWS' file (see excerpt of it
    >> below),
    >> 
    >> [...  o Changed the environment tree to be rooted in an
    >> empty environment, available as emptyenv().  baseenv()
    >> has been modified to return an environment with
    >> emptyenv() as parent, rather than NULL.
    >> 
    >> ...
    >> 
    >> o Use of NULL as an environment is deprecated and gives a
    >> warning.  ...]
    >> 
    >> I detected the warning message as announced for a couple
    >> of
    BernPf> contributed
    >> packages, e.g.
    >> 
    >> library(ape) library(car) library(chron) library(urca)


    BernPf> Not so for me. Are you sure you have reinstalled
    BernPf> those packages under R-2.3.0?

    BernPf> Uwe Ligges


    BernPf> Dear Uwe,

    BernPf> thank you for your hint. That fixes the warnings for
    BernPf> packages 'ape', 'car' and 'chron' issued
    BernPf> formerly. However, even after a fresh install the
    BernPf> warnings still show up for the packages 'VLMC' and
    BernPf> 'urca', as an example.  Any further clues are most
    BernPf> welcome.

not for 'VLMC' for me (maintainer of VLMC).
Martin

    BernPf> Best, Bernhard

    >> Now, I am wondering what would be a suitable/elegant way
    >> to fix the packages' code such that the warning does not
    >> appear any longer. I am adressing this question to
    >> R-devel, because this might also be of interest for other
    >> package mainatiners.
    >> 
    >> Many thanks in advance for any hints and pointers.
    >> 
    >> Regards, Bernhard
    >>


From gchappi at gmail.com  Tue Apr 25 18:08:14 2006
From: gchappi at gmail.com (Hans-Peter)
Date: Tue, 25 Apr 2006 18:08:14 +0200
Subject: [Rd] protection needed?
Message-ID: <47fce0650604250908g2957a123h9d9c80d0a73973c5@mail.gmail.com>

Dear list,

I am unsure if I really need to protect a coerced object if I
immediately access its value and don't access the object anymore. I
tried to find out by looking into the R sources but didn't find
something similar.

It's about the variable _skipLines in the call "function ReadXls(
_file, _sheet, _type, _header, _colHeader, _skipLines: pSExp ): pSExp;
cdecl;".

I did:
    skipLines:= riInteger( riCoerceVector( _skipLines, setIntSxp ) )[0];

but am unsure if I would have to something along:
    skipInt:= riProtect( riCoerceVector( _skipLines, setIntSxp ) );
    skipLines:= riInteger( skipInt )[0];
    riUnprotect( 1 );

According to the manual the second is probably more appropriate but as
I found some places in the R sources where no protection was made, I
decided to ask. Thanks a lot !

--
Regards,
Hans-Peter


From Bernhard_Pfaff at fra.invesco.com  Tue Apr 25 18:08:16 2006
From: Bernhard_Pfaff at fra.invesco.com (Pfaff, Bernhard Dr.)
Date: Tue, 25 Apr 2006 17:08:16 +0100
Subject: [Rd] R 2.3.0: Use of NULL as an environment is deprecated
Message-ID: <E4A9111DA23BA048B9A46686BF727CF4039089@DEFRAXMB01.corp.amvescap.net>

Pfaff, Bernhard Dr. wrote:

> Pfaff, Bernhard Dr. wrote:
> 
> 
>>Dear R-Devel subscriber,
>>
>>first, let me express my thank to the R-Core team for the new release!
> 
> I
> 
>>appreciate their efforts and time spent to enhance R.
>>In accordance with the 'NEWS' file (see excerpt of it below), 
>>
>>[...
>>o	Changed the environment tree to be rooted in an empty
>>	environment, available as emptyenv().  baseenv() has been
>>	modified to return an environment with emptyenv() as parent,
>>	rather than NULL.
>>
>>...
>>
>>o	Use of NULL as an environment is deprecated and gives a warning.
>>...]
>>
>>I detected the warning message as announced for a couple of
> 
> contributed
> 
>>packages, e.g.
>>
>>library(ape)
>>library(car)
>>library(chron)
>>library(urca)
> 
> 
> 
> Not so for me. Are you sure you have reinstalled those packages under 
> R-2.3.0?
> 
> Uwe Ligges
> 
> 
> Dear Uwe,
> 
> thank you for your hint. That fixes the warnings for packages 'ape',
> 'car' and 'chron' issued formerly. However, even after a fresh install
> the warnings still show up for the packages 'VLMC' and 'urca', as an
> example.
> Any further clues are most welcome. 


OS? R release?

and please report the result of

   packageDescription("urca")
   packageDescription("VLMC")

Uwe Ligges


Hello Uwe,

here is the detailed information:


> R.version
               _                         
platform       i386-pc-mingw32           
arch           i386                      
os             mingw32                   
system         i386, mingw32             
status                                   
major          2                         
minor          3.0                       
year           2006                      
month          04                        
day            24                        
svn rev        37909                     
language       R                         
version.string Version 2.3.0 (2006-04-24)


Package: urca
Version: 0.9-2
Date: 2006-02-25
Title: Unit root and cointegration tests for time series data
Author: Bernhard Pfaff <bernhard.pfaff at pfaffikus.de>
Maintainer: Bernhard Pfaff <bernhard at pfaffikus.de>
Depends: R (>= 2.0.0)
Imports: nlme, methods, graphics, stats
LazyLoad: yes
Description: Unit root and cointegration tests encountered in applied
        econometric analysis are implemented.
License: GPL version 2 or newer
URL: http://www.r-project.org
Packaged: Sat Feb 25 19:34:29 2006; bp
Built: R 2.3.0; ; 2006-03-03 21:12:31; windows

-- File: C:/R/package/urca/DESCRIPTION 



> packageDescription("VLMC")
Package: VLMC
Version: 1.3-9
Note: ===== vlmc.version in R/vlmc.R
Date: 2005-10-06
Author: Martin Maechler <maechler at stat.math.ethz.ch>
Maintainer: Martin Maechler <maechler at stat.math.ethz.ch>
Title: VLMC -- Variable Length Markov Chains
Description: Functions, Classes & Methods for estimation, prediction,
        and simulation (bootstrap) of VLMC -- Variable Length Markov
        Chain -- Models
Depends: stats, MASS
License: GPL version 2 or later
Packaged: Thu Oct 6 15:00:09 2005; maechler
Built: R 2.3.0; i386-pc-mingw32; 2006-03-03 19:04:48; windows

-- File: C:/R/package/VLMC/DESCRIPTION 

Both packages have Depends/Imports directives in their DESCRIPTION
files. Now, I do get the following for VLMC if I do a 'library(MASS)'
first:

> library(MASS)
Warning message:
Verwendung der NULL Umgebung ist veraltet 
> library(VLMC)
> 

and likewise for urca:

> library(nlme)
Warning message:
Verwendung der NULL Umgebung ist veraltet 
> library(urca)
> 




> Best,
> Bernhard
> 
> 
>>Now, I am wondering what would be a suitable/elegant way to fix the
>>packages' code such that the warning does not appear any longer. I am
>>adressing this question to R-devel, because this might also be of
>>interest for other package mainatiners.
>>
>>Many thanks in advance for any hints and pointers.
>>
>>Regards,
>>Bernhard
>>
>>
>>
>>
>>Dr. Bernhard Pfaff
>>Global Structured Products Group
>>(Europe)
>>
>>Invesco Asset Management Deutschland GmbH
>>Bleichstrasse 60-62
>>D-60313 Frankfurt am Main
>>
>>Tel: +49(0)69 298 07230
>>Fax: +49(0)69 298 07178
>>Email: bernhard_pfaff at fra.invesco.com 
>>*****************************************************************
>>Confidentiality Note: The information contained in this
> 
> mess...{{dropped}}
> 
>>______________________________________________
>>R-devel at r-project.org mailing list
>>https://stat.ethz.ch/mailman/listinfo/r-devel
> 
>


From tlumley at u.washington.edu  Tue Apr 25 18:49:59 2006
From: tlumley at u.washington.edu (Thomas Lumley)
Date: Tue, 25 Apr 2006 09:49:59 -0700 (PDT)
Subject: [Rd] protection needed?
In-Reply-To: <47fce0650604250908g2957a123h9d9c80d0a73973c5@mail.gmail.com>
References: <47fce0650604250908g2957a123h9d9c80d0a73973c5@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0604250938550.14616@homer22.u.washington.edu>

On Tue, 25 Apr 2006, Hans-Peter wrote:

> Dear list,
>
> I am unsure if I really need to protect a coerced object if I
> immediately access its value and don't access the object anymore. I
> tried to find out by looking into the R sources but didn't find
> something similar.
>
> It's about the variable _skipLines in the call "function ReadXls(
> _file, _sheet, _type, _header, _colHeader, _skipLines: pSExp ): pSExp;
> cdecl;".
>
> I did:
>    skipLines:= riInteger( riCoerceVector( _skipLines, setIntSxp ) )[0];
>
> but am unsure if I would have to something along:
>    skipInt:= riProtect( riCoerceVector( _skipLines, setIntSxp ) );
>    skipLines:= riInteger( skipInt )[0];
>    riUnprotect( 1 );
>

Well, assuming that I am guessing correctly about the code (?Pascal), 
either is ok.

You don't do anything to the output of riCoerceVector() that could cause 
garbage collection before you stop using it, so it doesn't need 
protection.

Now, this assumes that you know riInteger() doesn't garbage collect (and 
won't in the future). The former is definitely true and the latter is a 
reasonably safe bet.

There is a paragraph in Writing R Extensions section 5.7.1 that advises 
extreme caution when making this kind of assumption. That's because 
it's easy to overlook problems, things might change, and it can be really 
painful to track down pointer protection bugs.  It is usually prudent to 
code as if the garbage collector is out to get you, unless you are doing 
deep recursion or other types of coding where running out of pointer 
protection stack is a real concern.


 	-thomas

Thomas Lumley			Assoc. Professor, Biostatistics
tlumley at u.washington.edu	University of Washington, Seattle


From ligges at statistik.uni-dortmund.de  Tue Apr 25 18:51:20 2006
From: ligges at statistik.uni-dortmund.de (Uwe Ligges)
Date: Tue, 25 Apr 2006 18:51:20 +0200
Subject: [Rd] R 2.3.0: Use of NULL as an environment is deprecated
In-Reply-To: <E4A9111DA23BA048B9A46686BF727CF4039089@DEFRAXMB01.corp.amvescap.net>
References: <E4A9111DA23BA048B9A46686BF727CF4039089@DEFRAXMB01.corp.amvescap.net>
Message-ID: <444E5388.6030800@statistik.uni-dortmund.de>

Pfaff, Bernhard Dr. wrote:

> Pfaff, Bernhard Dr. wrote:
> 
> 
>>Pfaff, Bernhard Dr. wrote:
>>
>>
>>
>>>Dear R-Devel subscriber,
>>>
>>>first, let me express my thank to the R-Core team for the new release!
>>
>>I
>>
>>
>>>appreciate their efforts and time spent to enhance R.
>>>In accordance with the 'NEWS' file (see excerpt of it below), 
>>>
>>>[...
>>>o	Changed the environment tree to be rooted in an empty
>>>	environment, available as emptyenv().  baseenv() has been
>>>	modified to return an environment with emptyenv() as parent,
>>>	rather than NULL.
>>>
>>>...
>>>
>>>o	Use of NULL as an environment is deprecated and gives a warning.
>>>...]
>>>
>>>I detected the warning message as announced for a couple of
>>
>>contributed
>>
>>
>>>packages, e.g.
>>>
>>>library(ape)
>>>library(car)
>>>library(chron)
>>>library(urca)
>>
>>
>>
>>Not so for me. Are you sure you have reinstalled those packages under 
>>R-2.3.0?
>>
>>Uwe Ligges
>>
>>
>>Dear Uwe,
>>
>>thank you for your hint. That fixes the warnings for packages 'ape',
>>'car' and 'chron' issued formerly. However, even after a fresh install
>>the warnings still show up for the packages 'VLMC' and 'urca', as an
>>example.
>>Any further clues are most welcome. 
> 
> 
> 
> OS? R release?
> 
> and please report the result of
> 
>    packageDescription("urca")
>    packageDescription("VLMC")
> 
> Uwe Ligges
> 
> 
> Hello Uwe,
> 
> here is the detailed information:
> 
> 
> 
>>R.version
> 
>                _                         
> platform       i386-pc-mingw32           
> arch           i386                      
> os             mingw32                   
> system         i386, mingw32             
> status                                   
> major          2                         
> minor          3.0                       
> year           2006                      
> month          04                        
> day            24                        
> svn rev        37909                     
> language       R                         
> version.string Version 2.3.0 (2006-04-24)
> 
> 
> Package: urca
> Version: 0.9-2
              ^^^
> Date: 2006-02-25
> Title: Unit root and cointegration tests for time series data
> Author: Bernhard Pfaff <bernhard.pfaff at pfaffikus.de>
> Maintainer: Bernhard Pfaff <bernhard at pfaffikus.de>
> Depends: R (>= 2.0.0)
> Imports: nlme, methods, graphics, stats
> LazyLoad: yes
> Description: Unit root and cointegration tests encountered in applied
>         econometric analysis are implemented.
> License: GPL version 2 or newer
> URL: http://www.r-project.org
> Packaged: Sat Feb 25 19:34:29 2006; bp
> Built: R 2.3.0; ; 2006-03-03 21:12:31; windows
                          ^^^^^

Well, 0.9-3 is on CRAN, so you have *not* upgraded your *own* package!!!

Please upgrade ALL your packages and re-install also ALL those that are 
from prior R releases.

Uwe Ligges






> -- File: C:/R/package/urca/DESCRIPTION 
> 
> 
> 
> 
>>packageDescription("VLMC")
> 
> Package: VLMC
> Version: 1.3-9
> Note: ===== vlmc.version in R/vlmc.R
> Date: 2005-10-06
> Author: Martin Maechler <maechler at stat.math.ethz.ch>
> Maintainer: Martin Maechler <maechler at stat.math.ethz.ch>
> Title: VLMC -- Variable Length Markov Chains
> Description: Functions, Classes & Methods for estimation, prediction,
>         and simulation (bootstrap) of VLMC -- Variable Length Markov
>         Chain -- Models
> Depends: stats, MASS
> License: GPL version 2 or later
> Packaged: Thu Oct 6 15:00:09 2005; maechler
> Built: R 2.3.0; i386-pc-mingw32; 2006-03-03 19:04:48; windows
> 
> -- File: C:/R/package/VLMC/DESCRIPTION 
> 
> Both packages have Depends/Imports directives in their DESCRIPTION
> files. Now, I do get the following for VLMC if I do a 'library(MASS)'
> first:
> 
> 
>>library(MASS)
> 
> Warning message:
> Verwendung der NULL Umgebung ist veraltet 
> 
>>library(VLMC)
>>
> 
> 
> and likewise for urca:
> 
> 
>>library(nlme)
> 
> Warning message:
> Verwendung der NULL Umgebung ist veraltet 
> 
>>library(urca)
>>
> 
> 
> 
> 
> 
>>Best,
>>Bernhard
>>
>>
>>
>>>Now, I am wondering what would be a suitable/elegant way to fix the
>>>packages' code such that the warning does not appear any longer. I am
>>>adressing this question to R-devel, because this might also be of
>>>interest for other package mainatiners.
>>>
>>>Many thanks in advance for any hints and pointers.
>>>
>>>Regards,
>>>Bernhard
>>>
>>>
>>>
>>>
>>>Dr. Bernhard Pfaff
>>>Global Structured Products Group
>>>(Europe)
>>>
>>>Invesco Asset Management Deutschland GmbH
>>>Bleichstrasse 60-62
>>>D-60313 Frankfurt am Main
>>>
>>>Tel: +49(0)69 298 07230
>>>Fax: +49(0)69 298 07178
>>>Email: bernhard_pfaff at fra.invesco.com 
>>>*****************************************************************
>>>Confidentiality Note: The information contained in this
>>
>>mess...{{dropped}}
>>
>>
>>>______________________________________________
>>>R-devel at r-project.org mailing list
>>>https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From andy_liaw at merck.com  Tue Apr 25 19:49:45 2006
From: andy_liaw at merck.com (Liaw, Andy)
Date: Tue, 25 Apr 2006 13:49:45 -0400
Subject: [Rd] R 2.3.0: Use of NULL as an environment is deprecated
Message-ID: <39B6DDB9048D0F4DAD42CB26AAFF0AFAFEDB27@usctmx1106.merck.com>

From: Uwe Ligges
> 
> Pfaff, Bernhard Dr. wrote:
> 
> > Pfaff, Bernhard Dr. wrote:
> > 
> > 
> >>Pfaff, Bernhard Dr. wrote:
> >>
> >>
> >>
> >>>Dear R-Devel subscriber,
> >>>
> >>>first, let me express my thank to the R-Core team for the new 
> >>>release!
> >>
> >>I
> >>
> >>
> >>>appreciate their efforts and time spent to enhance R.
> >>>In accordance with the 'NEWS' file (see excerpt of it below),
> >>>
> >>>[...
> >>>o	Changed the environment tree to be rooted in an empty
> >>>	environment, available as emptyenv().  baseenv() has been
> >>>	modified to return an environment with emptyenv() as parent,
> >>>	rather than NULL.
> >>>
> >>>...
> >>>
> >>>o	Use of NULL as an environment is deprecated and gives a warning.
> >>>...]
> >>>
> >>>I detected the warning message as announced for a couple of
> >>
> >>contributed
> >>
> >>
> >>>packages, e.g.
> >>>
> >>>library(ape)
> >>>library(car)
> >>>library(chron)
> >>>library(urca)
> >>
> >>
> >>
> >>Not so for me. Are you sure you have reinstalled those 
> packages under
> >>R-2.3.0?
> >>
> >>Uwe Ligges
> >>
> >>
> >>Dear Uwe,
> >>
> >>thank you for your hint. That fixes the warnings for 
> packages 'ape', 
> >>'car' and 'chron' issued formerly. However, even after a 
> fresh install 
> >>the warnings still show up for the packages 'VLMC' and 
> 'urca', as an 
> >>example. Any further clues are most welcome.
> > 
> > 
> > 
> > OS? R release?
> > 
> > and please report the result of
> > 
> >    packageDescription("urca")
> >    packageDescription("VLMC")
> > 
> > Uwe Ligges
> > 
> > 
> > Hello Uwe,
> > 
> > here is the detailed information:
> > 
> > 
> > 
> >>R.version
> > 
> >                _                         
> > platform       i386-pc-mingw32           
> > arch           i386                      
> > os             mingw32                   
> > system         i386, mingw32             
> > status                                   
> > major          2                         
> > minor          3.0                       
> > year           2006                      
> > month          04                        
> > day            24                        
> > svn rev        37909                     
> > language       R                         
> > version.string Version 2.3.0 (2006-04-24)
> > 
> > 
> > Package: urca
> > Version: 0.9-2
>               ^^^
> > Date: 2006-02-25
> > Title: Unit root and cointegration tests for time series data
> > Author: Bernhard Pfaff <bernhard.pfaff at pfaffikus.de>
> > Maintainer: Bernhard Pfaff <bernhard at pfaffikus.de>
> > Depends: R (>= 2.0.0)
> > Imports: nlme, methods, graphics, stats
> > LazyLoad: yes
> > Description: Unit root and cointegration tests encountered 
> in applied
> >         econometric analysis are implemented.
> > License: GPL version 2 or newer
> > URL: http://www.r-project.org
> > Packaged: Sat Feb 25 19:34:29 2006; bp
> > Built: R 2.3.0; ; 2006-03-03 21:12:31; windows
>                           ^^^^^
> 
> Well, 0.9-3 is on CRAN, so you have *not* upgraded your *own* 
> package!!!
> 
> Please upgrade ALL your packages and re-install also ALL 
> those that are 
> from prior R releases.

The problem could be the mirror site:  Some sites are not as up-to-date as
others.

Andy


 
> Uwe Ligges
> 
> 
> 
> 
> 
> 
> > -- File: C:/R/package/urca/DESCRIPTION
> > 
> > 
> > 
> > 
> >>packageDescription("VLMC")
> > 
> > Package: VLMC
> > Version: 1.3-9
> > Note: ===== vlmc.version in R/vlmc.R
> > Date: 2005-10-06
> > Author: Martin Maechler <maechler at stat.math.ethz.ch>
> > Maintainer: Martin Maechler <maechler at stat.math.ethz.ch>
> > Title: VLMC -- Variable Length Markov Chains
> > Description: Functions, Classes & Methods for estimation, 
> prediction,
> >         and simulation (bootstrap) of VLMC -- Variable Length Markov
> >         Chain -- Models
> > Depends: stats, MASS
> > License: GPL version 2 or later
> > Packaged: Thu Oct 6 15:00:09 2005; maechler
> > Built: R 2.3.0; i386-pc-mingw32; 2006-03-03 19:04:48; windows
> > 
> > -- File: C:/R/package/VLMC/DESCRIPTION
> > 
> > Both packages have Depends/Imports directives in their DESCRIPTION 
> > files. Now, I do get the following for VLMC if I do a 
> 'library(MASS)'
> > first:
> > 
> > 
> >>library(MASS)
> > 
> > Warning message:
> > Verwendung der NULL Umgebung ist veraltet
> > 
> >>library(VLMC)
> >>
> > 
> > 
> > and likewise for urca:
> > 
> > 
> >>library(nlme)
> > 
> > Warning message:
> > Verwendung der NULL Umgebung ist veraltet
> > 
> >>library(urca)
> >>
> > 
> > 
> > 
> > 
> > 
> >>Best,
> >>Bernhard
> >>
> >>
> >>
> >>>Now, I am wondering what would be a suitable/elegant way 
> to fix the 
> >>>packages' code such that the warning does not appear any 
> longer. I am 
> >>>adressing this question to R-devel, because this might also be of 
> >>>interest for other package mainatiners.
> >>>
> >>>Many thanks in advance for any hints and pointers.
> >>>
> >>>Regards,
> >>>Bernhard
> >>>
> >>>
> >>>
> >>>
> >>>Dr. Bernhard Pfaff
> >>>Global Structured Products Group
> >>>(Europe)
> >>>
> >>>Invesco Asset Management Deutschland GmbH
> >>>Bleichstrasse 60-62
> >>>D-60313 Frankfurt am Main
> >>>
> >>>Tel: +49(0)69 298 07230
> >>>Fax: +49(0)69 298 07178
> >>>Email: bernhard_pfaff at fra.invesco.com
> >>>*****************************************************************
> >>>Confidentiality Note: The information contained in this
> >>
> >>mess...{{dropped}}
> >>
> >>
> >>>______________________________________________
> >>>R-devel at r-project.org mailing list 
> >>>https://stat.ethz.ch/mailman/listinfo/r-devel
> >>
> >>
> > 
> > ______________________________________________
> > R-devel at r-project.org mailing list 
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> ______________________________________________
> R-devel at r-project.org mailing list 
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
>


From p.c.j.kleiweg at rug.nl  Tue Apr 25 20:16:59 2006
From: p.c.j.kleiweg at rug.nl (p.c.j.kleiweg at rug.nl)
Date: Tue, 25 Apr 2006 20:16:59 +0200 (CEST)
Subject: [Rd] make: sockconn.c; make check: eval-etc.R;
	make install: $(EXPORTFILES) (PR#8809)
Message-ID: <20060425181659.9081946765@slim.kubism.ku.dk>


    I got several errors while installing R version 2.3.0

    ========

    One error while running 'make':

make[4]: Binnengaan van map `/home/peter/tmp/R-2.3.0/src/modules/internet'
gcc -I. -I../../../src/include -I../../../src/include -I/usr/local/include -DHAVE_CONFIG_H  -fpic  -g -O2  -c Rsock.c -o Rsock.o
gcc -I. -I../../../src/include -I../../../src/include -I/usr/local/include -DHAVE_CONFIG_H  -fpic  -g -O2  -c internet.c -o internet.o
gcc -I. -I../../../src/include -I../../../src/include -I/usr/local/include -DHAVE_CONFIG_H  -fpic  -g -O2  -c nanoftp.c -o nanoftp.o
gcc -I. -I../../../src/include -I../../../src/include -I/usr/local/include -DHAVE_CONFIG_H  -fpic  -g -O2  -c nanohttp.c -o nanohttp.o
gcc -I. -I../../../src/include -I../../../src/include -I/usr/local/include -DHAVE_CONFIG_H  -fpic  -g -O2  -c sock.c -o sock.o
gcc -I. -I../../../src/include -I../../../src/include -I/usr/local/include -DHAVE_CONFIG_H  -fpic  -g -O2  -c sockconn.c -o sockconn.o
In file included from sockconn.c:34:
sock.h:38: parse error before `Sock_read'
sock.h:38: warning: data definition has no type or storage class
sock.h:39: parse error before `Sock_write'
sock.h:39: warning: data definition has no type or storage class
make[4]: *** [sockconn.o] Fout 1
make[4]: Weggaan uit map `/home/peter/tmp/R-2.3.0/src/modules/internet'
make[3]: *** [R] Fout 2
make[3]: Weggaan uit map `/home/peter/tmp/R-2.3.0/src/modules/internet'
make[2]: *** [R] Fout 1
make[2]: Weggaan uit map `/home/peter/tmp/R-2.3.0/src/modules'
make[1]: *** [R] Fout 1
make[1]: Weggaan uit map `/home/peter/tmp/R-2.3.0/src'
make: *** [R] Fout 1


    I fixed this error by applying this patch:

--- sockconn.c  Mon Apr 10 00:19:54 2006
+++ sockconn.c.new      Tue Apr 25 18:26:02 2006
@@ -31,6 +31,7 @@
 #include <Defn.h>
 #include <Rconnections.h>
 #include <R_ext/R-ftp-http.h>
+#include <sys/types.h>
 #include "sock.h"
 
 static void listencleanup(void *data)

    ========

    An error while running 'make check'. I didn't try to fix this.

make[2]: Binnengaan van map `/home/peter/tmp/R-2.3.0/tests'
updating test dependencies
make[3]: Binnengaan van map `/home/peter/tmp/R-2.3.0/tests'
make[3]: Weggaan uit map `/home/peter/tmp/R-2.3.0/tests'
running strict specific tests
make[3]: Binnengaan van map `/home/peter/tmp/R-2.3.0/tests'
running code in 'eval-etc.R' ... OK
comparing 'eval-etc.Rout' to './eval-etc.Rout.save' ...WARNING: ignoring environment value of R_HOME
1d0
< WARNING: ignoring environment value of R_HOME
make[3]: *** [eval-etc.Rout] Fout 1
make[3]: Weggaan uit map `/home/peter/tmp/R-2.3.0/tests'
make[2]: *** [test-Specific] Fout 2
make[2]: Weggaan uit map `/home/peter/tmp/R-2.3.0/tests'
make[1]: *** [test-all-basics] Fout 1
make[1]: Weggaan uit map `/home/peter/tmp/R-2.3.0/tests'
make: *** [check] Fout 2

    ========

    An error while running 'make install', fixed by removing the
    three line command from etc/Makefile that try to install
    $(EXPORTFILES) :

make[1]: Binnengaan van map `/home/peter/tmp/R-2.3.0/etc'
mkdir -p -- /home/peter/lib/R/etc
installing etc ...
/bin/sh: -c: line 1: syntax error near unexpected token `;'
/bin/sh: -c: line 1: `for f in ; do  /usr/bin/install -c -m 644 ${f} "/home/peter/lib/R/etc";  done'
make[1]: *** [install] Fout 2
make[1]: Weggaan uit map `/home/peter/tmp/R-2.3.0/etc'
make: *** [install] Fout 1




--please do not edit the information below--

Version:
 platform = i686-pc-linux-gnu
 arch = i686
 os = linux-gnu
 system = i686, linux-gnu
 status = 
 major = 2
 minor = 3.0
 year = 2006
 month = 04
 day = 24
 svn rev = 37909
 language = R
 version.string = Version 2.3.0 (2006-04-24)

Locale:
LC_CTYPE=nl_NL at euro;LC_NUMERIC=C;LC_TIME=nl_NL at euro;LC_COLLATE=C;LC_MONETARY=nl_NL at euro;LC_MESSAGES=nl_NL at euro;LC_PAPER=C;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=C;LC_IDENTIFICATION=C

Search Path:
 .GlobalEnv, package:methods, package:stats, package:utils, package:datasets, package:graphics, package:grDevices, Autoloads, package:base


From hb at stat.berkeley.edu  Tue Apr 25 23:38:12 2006
From: hb at stat.berkeley.edu (Henrik Bengtsson (max 7Mb))
Date: Tue, 25 Apr 2006 14:38:12 -0700
Subject: [Rd] RSetReg.exe
Message-ID: <59d7961d0604251438l3fa4deb4ud6c26a1e0eeb2319@mail.gmail.com>

R v2.3.0 patched from today: Was just checking out the RSetReg.exe
application after reading about it in "R for Windows FAQ":

"After installation you can add the Registry entries in
HKEY_LOCAL_MACHINE by running RSetReg.exe in the bin folder, and
remove them by running this with argument /U. Note that this requires
administrative privileges and neither sets up nor removes the file
associations."

I tried RSetReg /? and erased(!) my R settings:

>RSetReg /?
unregistering R ... succeeded

>RSetReg /G
unregistering R ... succeeded

>RSetReg /foobar
unregistering R ... succeeded

>RSetReg anyargument
unregistering R ... succeeded

It is easy enough to get the default settings back, by

>RSetReg

but a simple check for '/U' would be better.

/Henrik


From ggrothendieck at gmail.com  Tue Apr 25 23:53:31 2006
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Tue, 25 Apr 2006 17:53:31 -0400
Subject: [Rd] RSetReg.exe
In-Reply-To: <59d7961d0604251438l3fa4deb4ud6c26a1e0eeb2319@mail.gmail.com>
References: <59d7961d0604251438l3fa4deb4ud6c26a1e0eeb2319@mail.gmail.com>
Message-ID: <971536df0604251453m66e1f159q4a87d369cdf7671a@mail.gmail.com>

Note that there also exists a front end to RSetReg that is
may be useful if you have multiple versions of R installed
at the same time, found in:

   http://cran.r-project.org/contrib/extra/batchfiles/

with the most recent version being: batchfiles-0.2-7.zip

There is a command line version, Rversions.bat, and a GUI version,
Rversions.hta .  Run them without args to see what versions of R you
have.   Both can also set the version as well. See the README for
instructions.


On 4/25/06, Henrik Bengtsson (max 7Mb) <hb at stat.berkeley.edu> wrote:
> R v2.3.0 patched from today: Was just checking out the RSetReg.exe
> application after reading about it in "R for Windows FAQ":
>
> "After installation you can add the Registry entries in
> HKEY_LOCAL_MACHINE by running RSetReg.exe in the bin folder, and
> remove them by running this with argument /U. Note that this requires
> administrative privileges and neither sets up nor removes the file
> associations."
>
> I tried RSetReg /? and erased(!) my R settings:
>
> >RSetReg /?
> unregistering R ... succeeded
>
> >RSetReg /G
> unregistering R ... succeeded
>
> >RSetReg /foobar
> unregistering R ... succeeded
>
> >RSetReg anyargument
> unregistering R ... succeeded
>
> It is easy enough to get the default settings back, by
>
> >RSetReg
>
> but a simple check for '/U' would be better.
>
> /Henrik
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From apjaworski at mmm.com  Wed Apr 26 00:07:02 2006
From: apjaworski at mmm.com (apjaworski at mmm.com)
Date: Tue, 25 Apr 2006 17:07:02 -0500
Subject: [Rd] libtrio
Message-ID: <OFBDA5C27F.9EF14B2D-ON8625715B.007015E9-8625715B.00797EC8@mmm.com>

Hi,

I usually compile R-devel tarball every few days (just to check if I can do
it and check for any compile errors).  As of two days ago, I am receiving
the following error:

...
gcc  -O3 -I. -DWIN32 -D_X86_  -c xdr_mem.c -o xdr_mem.o
ar crs libxdr.a xdr.o xdr_float.o xdr_stdio.o xdr_mem.o
make: *** ../extra/trio: No such file or directory.  Stop.
make[3]: *** [rlibs] Error 1
make[2]: *** [../../bin/R.dll] Error 2
make[1]: *** [rbuild] Error 2
make[1]: Leaving directory `/home/andyj/R-devel/src/gnuwin32'
make: *** [distribution] Error 2

Looking at the Makefile in R-devel/src/gnuwin32 reveals that it wants to
compile a library libtrio.a, but sources for it are missing from the
R-devel/src/extra directory.

I am on the Win2000 machine with all the necessary tools installed and up
to date (I just compiled 2.3.0-patched dated 4-24).  I checked the
"Building R for Windows" site and there is no mention there of anything
called trio.  The latest version of 2.4.0 I tried is r37919 dated 4-24.

This of course is of no great urgency for me as I do not use the R-devel
version for "real work".  I am just curious what libtrio is good for.

Andy

__________________________________
Andy Jaworski
518-1-01
Process Laboratory
3M Corporate Research Laboratory
-----
E-mail: apjaworski at mmm.com
Tel:  (651) 733-6092
Fax:  (651) 736-3122


From jeff at kanecap.com  Wed Apr 26 00:13:50 2006
From: jeff at kanecap.com (Jeff Enos)
Date: Tue, 25 Apr 2006 18:13:50 -0400
Subject: [Rd] Daily package check and --install=no
Message-ID: <17486.40734.877197.802580@gargle.gargle.HOWL>

R-devel,

There has been some confusion on the MatchIt package mailing list on
the meaning of [--install=no] in the comment column of CRAN's
automated package check.

It's my understanding that, at the very least, a package marked like
this will not have its test cases run each night.  Are there other
checks that are omitted?

How, if at all, are such install flags related to the parameters one
can pass R CMD check, such as --no-install, --no-test, etc.?

Thanks,

Jeff

-- 
Jeff Enos
Kane Capital Management
jeff at kanecap.com


From ripley at stats.ox.ac.uk  Wed Apr 26 00:39:31 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 25 Apr 2006 23:39:31 +0100 (BST)
Subject: [Rd] libtrio
In-Reply-To: <OFBDA5C27F.9EF14B2D-ON8625715B.007015E9-8625715B.00797EC8@mmm.com>
References: <OFBDA5C27F.9EF14B2D-ON8625715B.007015E9-8625715B.00797EC8@mmm.com>
Message-ID: <Pine.LNX.4.64.0604252338010.10958@gannet.stats.ox.ac.uk>

On Tue, 25 Apr 2006, apjaworski at mmm.com wrote:

> Hi,
>
> I usually compile R-devel tarball every few days (just to check if I can do
> it and check for any compile errors).  As of two days ago, I am receiving
> the following error:
>
> ...
> gcc  -O3 -I. -DWIN32 -D_X86_  -c xdr_mem.c -o xdr_mem.o
> ar crs libxdr.a xdr.o xdr_float.o xdr_stdio.o xdr_mem.o
> make: *** ../extra/trio: No such file or directory.  Stop.
> make[3]: *** [rlibs] Error 1
> make[2]: *** [../../bin/R.dll] Error 2
> make[1]: *** [rbuild] Error 2
> make[1]: Leaving directory `/home/andyj/R-devel/src/gnuwin32'
> make: *** [distribution] Error 2
>
> Looking at the Makefile in R-devel/src/gnuwin32 reveals that it wants to
> compile a library libtrio.a, but sources for it are missing from the
> R-devel/src/extra directory.
>
> I am on the Win2000 machine with all the necessary tools installed and up
> to date (I just compiled 2.3.0-patched dated 4-24).  I checked the
> "Building R for Windows" site and there is no mention there of anything
> called trio.  The latest version of 2.4.0 I tried is r37919 dated 4-24.
>
> This of course is of no great urgency for me as I do not use the R-devel
> version for "real work".  I am just curious what libtrio is good for.

See the src/gnuwin32/CHANGES, and get the R-devel sources from SVN if you 
want to test this: it is still experimental and not yet in the tarballs.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From mtmorgan at fhcrc.org  Wed Apr 26 01:49:06 2006
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Tue, 25 Apr 2006 16:49:06 -0700
Subject: [Rd] Windows MinGW compiler clarification, consequences
Message-ID: <6phzmi9kyh9.fsf@gopher3.fhcrc.org>

The information at

http://cran.r-project.org/doc/manuals/R-admin.html#The-MinGW-compilers

and

http://www.murdoch-sutherland.com/Rtools/

is slightly inconsistent about the compiler used to build Windows
binary packages available through cran.

The 'candidate' package of the recommended MinGW-5.0.0.exe installs
g++/g77 3.4.4 (as does the updated installer MinGW-5.0.2.exe). "An
alternative..." described on the cran page lists g++/g77 3.4.5. The
murdoch-sutherland site says "The release version of gcc-3.4.2
included in MinGW-3.2.0-rc-3 is used by the core developers" and
mentions that patches to g77 and to ld are used.

My questions are:

1) which compiler is actually used for creating windows binary
   packages available on cran?

2) Are the patches to g77 and ld still relevant?

3) what issues are we likely to encounter -- code incompatibility, ???
   -- changing from 3.4.2 to the current compiler tools?

As a more specific example, a particular Bioconductor package depends
on the cran package odesolve; odesolve has Fortan source
files. Example R code in the Bioconductor package evaluates without
issues when the .zip file from cran is used, but generates warnings
(originating from the Fortran code of odesolve) when compiled locally:

Warning: intdy--  t (=r1) illegal 
Warning: t not in interval tcur - hu (= r1) to tcur (=r2)
Warning: intdy--  t (=r1) illegal 
Warning: t not in interval tcur - hu (= r1) to tcur (=r2)
Warning: lsoda--  trouble from intdy. itask = i1, tout = r1
Error in lsoda(y = y0, times = times, fderiv, parms = c(mod = mod), rtol = 1e-04,  : 
	Illegal input to lsoda


R version: 2.3.0 (2006-04-24)

>gcc --version
gcc (GCC) 3.4.2 (mingw-special)
Copyright (C) 2004 Free Software Foundation, Inc.
This is free software; see the source for copying conditions.  There is NO
warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.


Thanks for any guidance,

Martin Morgan
Bioconductor


From ripley at stats.ox.ac.uk  Wed Apr 26 02:07:49 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 26 Apr 2006 01:07:49 +0100 (BST)
Subject: [Rd] Windows MinGW compiler clarification, consequences
In-Reply-To: <6phzmi9kyh9.fsf@gopher3.fhcrc.org>
References: <6phzmi9kyh9.fsf@gopher3.fhcrc.org>
Message-ID: <Pine.LNX.4.64.0604260055270.18367@gannet.stats.ox.ac.uk>

On Tue, 25 Apr 2006, Martin Morgan wrote:

> The information at
>
> http://cran.r-project.org/doc/manuals/R-admin.html#The-MinGW-compilers

The R 2.3.0 manual is current.

> and
>
> http://www.murdoch-sutherland.com/Rtools/
>
> is slightly inconsistent about the compiler used to build Windows
> binary packages available through cran.
>
> The 'candidate' package of the recommended MinGW-5.0.0.exe installs
> g++/g77 3.4.4 (as does the updated installer MinGW-5.0.2.exe). "An
> alternative..." described on the cran page lists g++/g77 3.4.5.

Please just use 3.4.5: MinGW keep on making errors in their beta 
installers ... so it is hard to keep up (I believe 5.0.1 installed 3.4.5).
3.4.4 does not even appear on the download lists.

> The murdoch-sutherland site says "The release version of gcc-3.4.2 
> included in MinGW-3.2.0-rc-3 is used by the core developers" and 
> mentions that patches to g77 and to ld are used.

There is a change entry above that that says 3.4.4 was used for 2.2.1.

> My questions are:
>
> 1) which compiler is actually used for creating windows binary
>   packages available on cran?

3.4.5, I believe, and that's what I use.

> 2) Are the patches to g77 and ld still relevant?

To g77 only for 3.4.2, to ld yes.

> 3) what issues are we likely to encounter -- code incompatibility, ???
>   -- changing from 3.4.2 to the current compiler tools?

You should not use unpatched 3.4.2 for Fortran.  And without the ld patch, 
the internal DLL name is likely to lose its extension and so not work when 
linked to on some versions of Windows.

> As a more specific example, a particular Bioconductor package depends
> on the cran package odesolve; odesolve has Fortan source
> files. Example R code in the Bioconductor package evaluates without
> issues when the .zip file from cran is used, but generates warnings
> (originating from the Fortran code of odesolve) when compiled locally:
>
> Warning: intdy--  t (=r1) illegal
> Warning: t not in interval tcur - hu (= r1) to tcur (=r2)
> Warning: intdy--  t (=r1) illegal
> Warning: t not in interval tcur - hu (= r1) to tcur (=r2)
> Warning: lsoda--  trouble from intdy. itask = i1, tout = r1
> Error in lsoda(y = y0, times = times, fderiv, parms = c(mod = mod), rtol = 1e-04,  :
> 	Illegal input to lsoda

This looks like the 3.4.2 Fortran bug.

> R version: 2.3.0 (2006-04-24)
>
>> gcc --version
> gcc (GCC) 3.4.2 (mingw-special)
> Copyright (C) 2004 Free Software Foundation, Inc.
> This is free software; see the source for copying conditions.  There is NO
> warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
>
>
> Thanks for any guidance,

I generally find that using the latest MinGW candidates is the best 
policy, but it is frustrating that they never seem to release anything 
these days.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From Bernhard_Pfaff at fra.invesco.com  Wed Apr 26 09:28:34 2006
From: Bernhard_Pfaff at fra.invesco.com (Pfaff, Bernhard Dr.)
Date: Wed, 26 Apr 2006 08:28:34 +0100
Subject: [Rd] R 2.3.0: Use of NULL as an environment is deprecated
Message-ID: <E4A9111DA23BA048B9A46686BF727CF403908B@DEFRAXMB01.corp.amvescap.net>

Dear Andy, Uwe and remaining list subscribers,

now, coming closer to the evil's root. Yesterday, I source compiled on a
Linux box at home and the result is the same behaviour as pointed out
below. This is regardless of the package version of 'urca'. Aside of
'urca', other packages that have Imports/Depends entries in the
DESCRIPTION to packages that are shipped within the standard library of
R show the warning too, e.g. fMultivar, VLMC, to name but a few.
I do have set on both OS, i.e. Windows and Linux, a second library tree
in Renviron.site with R-LIBS. If I comment this out and do a reinstall
of the packages, i.e. the packages are now installed in the standard
library, the warning does not show up any longer. Has something changed
with regard to additional libraries that slipped my notice by upgrading
to version 2.3.0?

Is it possible that during startup the environment is handeld/passed
differently for standard and additional libraries? Would this odd
behaviour qualify as a bug?



Best,
Bernhard


From: Uwe Ligges
> 
> Pfaff, Bernhard Dr. wrote:
> 
> > Pfaff, Bernhard Dr. wrote:
> > 
> > 
> >>Pfaff, Bernhard Dr. wrote:
> >>
> >>
> >>
> >>>Dear R-Devel subscriber,
> >>>
> >>>first, let me express my thank to the R-Core team for the new 
> >>>release!
> >>
> >>I
> >>
> >>
> >>>appreciate their efforts and time spent to enhance R.
> >>>In accordance with the 'NEWS' file (see excerpt of it below),
> >>>
> >>>[...
> >>>o	Changed the environment tree to be rooted in an empty
> >>>	environment, available as emptyenv().  baseenv() has been
> >>>	modified to return an environment with emptyenv() as parent,
> >>>	rather than NULL.
> >>>
> >>>...
> >>>
> >>>o	Use of NULL as an environment is deprecated and gives a warning.
> >>>...]
> >>>
> >>>I detected the warning message as announced for a couple of
> >>
> >>contributed
> >>
> >>
> >>>packages, e.g.
> >>>
> >>>library(ape)
> >>>library(car)
> >>>library(chron)
> >>>library(urca)
> >>
> >>
> >>
> >>Not so for me. Are you sure you have reinstalled those 
> packages under
> >>R-2.3.0?
> >>
> >>Uwe Ligges
> >>
> >>
> >>Dear Uwe,
> >>
> >>thank you for your hint. That fixes the warnings for 
> packages 'ape', 
> >>'car' and 'chron' issued formerly. However, even after a 
> fresh install 
> >>the warnings still show up for the packages 'VLMC' and 
> 'urca', as an 
> >>example. Any further clues are most welcome.
> > 
> > 
> > 
> > OS? R release?
> > 
> > and please report the result of
> > 
> >    packageDescription("urca")
> >    packageDescription("VLMC")
> > 
> > Uwe Ligges
> > 
> > 
> > Hello Uwe,
> > 
> > here is the detailed information:
> > 
> > 
> > 
> >>R.version
> > 
> >                _                         
> > platform       i386-pc-mingw32           
> > arch           i386                      
> > os             mingw32                   
> > system         i386, mingw32             
> > status                                   
> > major          2                         
> > minor          3.0                       
> > year           2006                      
> > month          04                        
> > day            24                        
> > svn rev        37909                     
> > language       R                         
> > version.string Version 2.3.0 (2006-04-24)
> > 
> > 
> > Package: urca
> > Version: 0.9-2
>               ^^^
> > Date: 2006-02-25
> > Title: Unit root and cointegration tests for time series data
> > Author: Bernhard Pfaff <bernhard.pfaff at pfaffikus.de>
> > Maintainer: Bernhard Pfaff <bernhard at pfaffikus.de>
> > Depends: R (>= 2.0.0)
> > Imports: nlme, methods, graphics, stats
> > LazyLoad: yes
> > Description: Unit root and cointegration tests encountered 
> in applied
> >         econometric analysis are implemented.
> > License: GPL version 2 or newer
> > URL: http://www.r-project.org
> > Packaged: Sat Feb 25 19:34:29 2006; bp
> > Built: R 2.3.0; ; 2006-03-03 21:12:31; windows
>                           ^^^^^
> 
> Well, 0.9-3 is on CRAN, so you have *not* upgraded your *own* 
> package!!!
> 
> Please upgrade ALL your packages and re-install also ALL 
> those that are 
> from prior R releases.

The problem could be the mirror site:  Some sites are not as up-to-date
as
others.

Andy


 
> Uwe Ligges
> 
> 
> 
> 
> 
> 
> > -- File: C:/R/package/urca/DESCRIPTION
> > 
> > 
> > 
> > 
> >>packageDescription("VLMC")
> > 
> > Package: VLMC
> > Version: 1.3-9
> > Note: ===== vlmc.version in R/vlmc.R
> > Date: 2005-10-06
> > Author: Martin Maechler <maechler at stat.math.ethz.ch>
> > Maintainer: Martin Maechler <maechler at stat.math.ethz.ch>
> > Title: VLMC -- Variable Length Markov Chains
> > Description: Functions, Classes & Methods for estimation, 
> prediction,
> >         and simulation (bootstrap) of VLMC -- Variable Length Markov
> >         Chain -- Models
> > Depends: stats, MASS
> > License: GPL version 2 or later
> > Packaged: Thu Oct 6 15:00:09 2005; maechler
> > Built: R 2.3.0; i386-pc-mingw32; 2006-03-03 19:04:48; windows
> > 
> > -- File: C:/R/package/VLMC/DESCRIPTION
> > 
> > Both packages have Depends/Imports directives in their DESCRIPTION 
> > files. Now, I do get the following for VLMC if I do a 
> 'library(MASS)'
> > first:
> > 
> > 
> >>library(MASS)
> > 
> > Warning message:
> > Verwendung der NULL Umgebung ist veraltet
> > 
> >>library(VLMC)
> >>
> > 
> > 
> > and likewise for urca:
> > 
> > 
> >>library(nlme)
> > 
> > Warning message:
> > Verwendung der NULL Umgebung ist veraltet
> > 
> >>library(urca)
> >>
> > 
> > 
> > 
> > 
> > 
> >>Best,
> >>Bernhard
> >>
> >>
> >>
> >>>Now, I am wondering what would be a suitable/elegant way 
> to fix the 
> >>>packages' code such that the warning does not appear any 
> longer. I am 
> >>>adressing this question to R-devel, because this might also be of 
> >>>interest for other package mainatiners.
> >>>
> >>>Many thanks in advance for any hints and pointers.
> >>>
> >>>Regards,
> >>>Bernhard
> >>>
> >>>
> >>>
> >>>
> >>>Dr. Bernhard Pfaff
> >>>Global Structured Products Group
> >>>(Europe)
> >>>
> >>>Invesco Asset Management Deutschland GmbH
> >>>Bleichstrasse 60-62
> >>>D-60313 Frankfurt am Main
> >>>
> >>>Tel: +49(0)69 298 07230
> >>>Fax: +49(0)69 298 07178
> >>>Email: bernhard_pfaff at fra.invesco.com
> >>>*****************************************************************
> >>>Confidentiality Note: The information contained in this
> >>
> >>mess...{{dropped}}
> >>
> >>
> >>>______________________________________________
> >>>R-devel at r-project.org mailing list 
> >>>https://stat.ethz.ch/mailman/listinfo/r-devel
> >>
> >>
> > 
> > ______________________________________________
> > R-devel at r-project.org mailing list 
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> ______________________________________________
> R-devel at r-project.org mailing list 
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 


------------------------------------------------------------------------
------
Notice:  This e-mail message, together with any attachments,...{{dropped}}


From maechler at stat.math.ethz.ch  Wed Apr 26 10:46:20 2006
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Wed, 26 Apr 2006 10:46:20 +0200
Subject: [Rd] R 2.3.0: Use of NULL as an environment is deprecated
In-Reply-To: <E4A9111DA23BA048B9A46686BF727CF403908B@DEFRAXMB01.corp.amvescap.net>
References: <E4A9111DA23BA048B9A46686BF727CF403908B@DEFRAXMB01.corp.amvescap.net>
Message-ID: <17487.13148.840981.953215@stat.math.ethz.ch>

>>>>> "BernPf" == Pfaff, Bernhard Dr <Bernhard_Pfaff at fra.invesco.com>
>>>>>     on Wed, 26 Apr 2006 08:28:34 +0100 writes:

    BernPf> Dear Andy, Uwe and remaining list subscribers,
    BernPf> now, coming closer to the evil's root. Yesterday, I source compiled on a
    BernPf> Linux box at home and the result is the same behaviour as pointed out
    BernPf> below. This is regardless of the package version of 'urca'. Aside of
    BernPf> 'urca', other packages that have Imports/Depends entries in the
    BernPf> DESCRIPTION to packages that are shipped within the standard library of
    BernPf> R show the warning too, e.g. fMultivar, VLMC, to name but a few.
    BernPf> I do have set on both OS, i.e. Windows and Linux, a second library tree
    BernPf> in Renviron.site with R-LIBS. If I comment this out and do a reinstall
    BernPf> of the packages, i.e. the packages are now installed in the standard
    BernPf> library, the warning does not show up any longer. Has something changed
    BernPf> with regard to additional libraries that slipped my notice by upgrading
    BernPf> to version 2.3.0?

I don't think so.
I ***NEVER*** install a package into the standard library.
We have all CRAN packages in a different library, 
(and Bioconductor too) and I typically use about 6 library (paths),
and I don't have your problem.

I only get your warning if I get a version of a package that was
installed previous to 2.3.0 (or it's alpha / beta / rc ) versions.

    BernPf> Is it possible that during startup the environment is handeld/passed
    BernPf> differently for standard and additional libraries? Would this odd
    BernPf> behaviour qualify as a bug?

If it was general, yes, but I think it's not.


From Bernhard_Pfaff at fra.invesco.com  Wed Apr 26 11:28:09 2006
From: Bernhard_Pfaff at fra.invesco.com (Pfaff, Bernhard Dr.)
Date: Wed, 26 Apr 2006 10:28:09 +0100
Subject: [Rd] R 2.3.0: Use of NULL as an environment is deprecated
Message-ID: <E4A9111DA23BA048B9A46686BF727CF403908C@DEFRAXMB01.corp.amvescap.net>

>>>>> "BernPf" == Pfaff, Bernhard Dr <Bernhard_Pfaff at fra.invesco.com>
>>>>>     on Wed, 26 Apr 2006 08:28:34 +0100 writes:

    BernPf> Dear Andy, Uwe and remaining list subscribers,
    BernPf> now, coming closer to the evil's root. Yesterday, I source
compiled on a
    BernPf> Linux box at home and the result is the same behaviour as
pointed out
    BernPf> below. This is regardless of the package version of 'urca'.
Aside of
    BernPf> 'urca', other packages that have Imports/Depends entries in
the
    BernPf> DESCRIPTION to packages that are shipped within the standard
library of
    BernPf> R show the warning too, e.g. fMultivar, VLMC, to name but a
few.
    BernPf> I do have set on both OS, i.e. Windows and Linux, a second
library tree
    BernPf> in Renviron.site with R-LIBS. If I comment this out and do a
reinstall
    BernPf> of the packages, i.e. the packages are now installed in the
standard
    BernPf> library, the warning does not show up any longer. Has
something changed
    BernPf> with regard to additional libraries that slipped my notice
by upgrading
    BernPf> to version 2.3.0?

I don't think so.
I ***NEVER*** install a package into the standard library.
We have all CRAN packages in a different library, 
(and Bioconductor too) and I typically use about 6 library (paths),
and I don't have your problem.

I only get your warning if I get a version of a package that was
installed previous to 2.3.0 (or it's alpha / beta / rc ) versions.

    BernPf> Is it possible that during startup the environment is
handeld/passed
    BernPf> differently for standard and additional libraries? Would
this odd
    BernPf> behaviour qualify as a bug?

If it was general, yes, but I think it's not.


Hello Martin and all others involved in this thread,

thank you very much for your time and patience. After having updated the
packages in the standard library, too, the warning message does indeed
not show up any longer by issuing the command library(urca) and similar
with other packages. Just out of curiosity, I wonder what has changed in
these packages (i.e. nlme, foreign, cluster and VR got updated) from
downloading the '.exe' or the tarball in the official 2.3.0 release up
to now?

Best,
Bernhard
*****************************************************************
Confidentiality Note: The information contained in this mess...{{dropped}}


From Kurt.Hornik at wu-wien.ac.at  Wed Apr 26 12:28:51 2006
From: Kurt.Hornik at wu-wien.ac.at (Kurt Hornik)
Date: Wed, 26 Apr 2006 12:28:51 +0200
Subject: [Rd] Daily package check and --install=no
In-Reply-To: <17486.40734.877197.802580@gargle.gargle.HOWL>
References: <17486.40734.877197.802580@gargle.gargle.HOWL>
Message-ID: <17487.19299.110532.97984@mithrandir.hornik.net>

>>>>> Jeff Enos writes:

> R-devel,
> There has been some confusion on the MatchIt package mailing list on
> the meaning of [--install=no] in the comment column of CRAN's
> automated package check.

> It's my understanding that, at the very least, a package marked like
> this will not have its test cases run each night.  Are there other
> checks that are omitted?

> How, if at all, are such install flags related to the parameters one
> can pass R CMD check, such as --no-install, --no-test, etc.?

'--install=no' indicates that the checks are run with this flag, which
is the same as '--no-install':

  $ R CMD check --help 2>&1 | grep no-install
      --no-install      skip installation and associated tests

[This is necessary because MatchIt depends on Zelig which suggests VGAM
which is not in any of the standard repositories ...]

-k


From ligges at statistik.uni-dortmund.de  Wed Apr 26 12:42:32 2006
From: ligges at statistik.uni-dortmund.de (Uwe Ligges)
Date: Wed, 26 Apr 2006 12:42:32 +0200
Subject: [Rd] R 2.3.0: Use of NULL as an environment is deprecated
In-Reply-To: <E4A9111DA23BA048B9A46686BF727CF403908C@DEFRAXMB01.corp.amvescap.net>
References: <E4A9111DA23BA048B9A46686BF727CF403908C@DEFRAXMB01.corp.amvescap.net>
Message-ID: <444F4E98.8080000@statistik.uni-dortmund.de>

Pfaff, Bernhard Dr. wrote:
>>>>>>"BernPf" == Pfaff, Bernhard Dr <Bernhard_Pfaff at fra.invesco.com>
>>>>>>    on Wed, 26 Apr 2006 08:28:34 +0100 writes:
> 
> 
>     BernPf> Dear Andy, Uwe and remaining list subscribers,
>     BernPf> now, coming closer to the evil's root. Yesterday, I source
> compiled on a
>     BernPf> Linux box at home and the result is the same behaviour as
> pointed out
>     BernPf> below. This is regardless of the package version of 'urca'.
> Aside of
>     BernPf> 'urca', other packages that have Imports/Depends entries in
> the
>     BernPf> DESCRIPTION to packages that are shipped within the standard
> library of
>     BernPf> R show the warning too, e.g. fMultivar, VLMC, to name but a
> few.
>     BernPf> I do have set on both OS, i.e. Windows and Linux, a second
> library tree
>     BernPf> in Renviron.site with R-LIBS. If I comment this out and do a
> reinstall
>     BernPf> of the packages, i.e. the packages are now installed in the
> standard
>     BernPf> library, the warning does not show up any longer. Has
> something changed
>     BernPf> with regard to additional libraries that slipped my notice
> by upgrading
>     BernPf> to version 2.3.0?
> 
> I don't think so.
> I ***NEVER*** install a package into the standard library.
> We have all CRAN packages in a different library, 
> (and Bioconductor too) and I typically use about 6 library (paths),
> and I don't have your problem.
> 
> I only get your warning if I get a version of a package that was
> installed previous to 2.3.0 (or it's alpha / beta / rc ) versions.
> 
>     BernPf> Is it possible that during startup the environment is
> handeld/passed
>     BernPf> differently for standard and additional libraries? Would
> this odd
>     BernPf> behaviour qualify as a bug?
> 
> If it was general, yes, but I think it's not.
> 
> 
> Hello Martin and all others involved in this thread,
> 
> thank you very much for your time and patience. After having updated the
> packages in the standard library, too, the warning message does indeed
> not show up any longer by issuing the command library(urca) and similar
> with other packages. Just out of curiosity, I wonder what has changed in
> these packages (i.e. nlme, foreign, cluster and VR got updated) from
> downloading the '.exe' or the tarball in the official 2.3.0 release up
> to now?


For sure you got (or still had in front of your R_LIBS path) packages 
that were compiled for R < 2.3.0! That's it. Very simple.

Uwe Ligges


> Best,
> Bernhard
> *****************************************************************
> Confidentiality Note: The information contained in this message,
> and any attachments, may contain confidential and/or privileged
> material. It is intended solely for the person(s) or entity to
> which it is addressed. Any review, retransmission, dissemination,
> or taking of any action in reliance upon this information by
> persons or entities other than the intended recipient(s) is
> prohibited. If you received this in error, please contact the
> sender and delete the material from any computer.
> *****************************************************************


From murdoch at stats.uwo.ca  Wed Apr 26 16:09:26 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Wed, 26 Apr 2006 10:09:26 -0400
Subject: [Rd] R 2.3.0: Use of NULL as an environment is deprecated
In-Reply-To: <E4A9111DA23BA048B9A46686BF727CF4039087@DEFRAXMB01.corp.amvescap.net>
References: <E4A9111DA23BA048B9A46686BF727CF4039087@DEFRAXMB01.corp.amvescap.net>
Message-ID: <444F7F16.8090107@stats.uwo.ca>

Pfaff, Bernhard Dr. wrote:
> Dear R-Devel subscriber,
> 
> first, let me express my thank to the R-Core team for the new release! I
> appreciate their efforts and time spent to enhance R.
> In accordance with the 'NEWS' file (see excerpt of it below), 
> 
> [...
> o	Changed the environment tree to be rooted in an empty
> 	environment, available as emptyenv().  baseenv() has been
> 	modified to return an environment with emptyenv() as parent,
> 	rather than NULL.
> 
> ...
> 
> o	Use of NULL as an environment is deprecated and gives a warning.
> ...]
> 
> I detected the warning message as announced for a couple of contributed
> packages, e.g.
> 
> library(ape)
> library(car)
> library(chron)
> library(urca)
> 
> Now, I am wondering what would be a suitable/elegant way to fix the
> packages' code such that the warning does not appear any longer. I am
> adressing this question to R-devel, because this might also be of
> interest for other package mainatiners.

If you are a maintainer of a package getting this warning, then you 
should replace all uses of NULL as an environment by baseenv() (to get 
the previous behaviour), or emptyenv() (if you thought env=NULL gave you 
an empty environment).

There's really not much a non-maintainer can do about this warning.

Duncan Murdoch

> 
> Many thanks in advance for any hints and pointers.
> 
> Regards,
> Bernhard
> 
> 
> 
> 
> Dr. Bernhard Pfaff
> Global Structured Products Group
> (Europe)
> 
> Invesco Asset Management Deutschland GmbH
> Bleichstrasse 60-62
> D-60313 Frankfurt am Main
> 
> Tel: +49(0)69 298 07230
> Fax: +49(0)69 298 07178
> Email: bernhard_pfaff at fra.invesco.com 
> *****************************************************************
> Confidentiality Note: The information contained in this mess...{{dropped}}
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From hb at stat.berkeley.edu  Wed Apr 26 19:35:44 2006
From: hb at stat.berkeley.edu (Henrik Bengtsson (max 7Mb))
Date: Wed, 26 Apr 2006 10:35:44 -0700
Subject: [Rd] Large number of linked environments makes save() crash R
Message-ID: <59d7961d0604261035k1291b6fcv524edd34f520ceae@mail.gmail.com>

Hi,

first, this not a problem originating from me, but it was observed
trying to do similar things with my R.oo package, so I troubleshooted
it and found the following.

On R v2.3.0 (patched), the following will crash R on WinXP sooner or later:

troubleLimit <- 20435;

linkedList <- list(head=new.env());

currEnv <- linkedList$head;
for (kk in 1:(2*troubleLimit)) {
  if (kk %% 100 == 0)
    print(kk);
  nextEnv <- new.env();
  assign("nxt", nextEnv, envir=currEnv);
  currEnv <- nextEnv;
  if (kk > troubleLimit) {
    cat("Saving linked list of length ", kk, "...", sep="");
    save(linkedList, file="linkedList.RData");
    cat("ok\n");
  }
}

This gives:
...
[1] 20300
[1] 20400
Saving linked list of length 20436...ok
Saving linked list of length 20437...ok
Saving linked list of length 20438...

and then R crashes/terminates.  On my WinXP machine it always happens
at the same number of environments.

I tried the same on R v2.2.0 (sic!) on Unix and there it gave a
segfault a bit after 10000 environments.  ...and, the purpose of the
example is not to implement linked lists, it to show that you can
torture R to crash.

Cheers

Henrik


From jh910 at juno.com  Wed Apr 26 21:02:08 2006
From: jh910 at juno.com (J. Hosking)
Date: Wed, 26 Apr 2006 15:02:08 -0400
Subject: [Rd] Problems after lm(..., qr=FALSE)
Message-ID: <e2og3h$aqh$1@sea.gmane.org>

The documentation for lm() indicates that the 'qr' component of an
lm object is optional.  But some functions do not behave well when
this component is absent: summary() gives an error and predict()
returns all zeroes.

Example:

   > x <- 1:10;  y <- x^2
   > mm <- lm(y~x, qr=FALSE)
   > summary(mm)
   Error in summary.lm(mm) : invalid 'lm' object:  no 'terms' nor 'qr' 
component
   > predict(mm, newdata=data.frame(x=11:15))
   1 2 3 4 5
   0 0 0 0 0
   > predict(mm, newdata=data.frame(x=11:15), se=TRUE)
   Error in qr.R(object$qr) : argument is not a QR decomposition

   > R.version
                  _
   platform       i386-pc-mingw32
   arch           i386
   os             mingw32
   system         i386, mingw32
   status
   major          2
   minor          3.0
   year           2006
   month          04
   day            24
   svn rev        37909
   language       R
   version.string Version 2.3.0 (2006-04-24)



J. R. M. Hosking


From ripley at stats.ox.ac.uk  Wed Apr 26 21:09:58 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 26 Apr 2006 20:09:58 +0100 (BST)
Subject: [Rd] Large number of linked environments makes save() crash R
In-Reply-To: <59d7961d0604261035k1291b6fcv524edd34f520ceae@mail.gmail.com>
References: <59d7961d0604261035k1291b6fcv524edd34f520ceae@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0604262005490.1068@gannet.stats.ox.ac.uk>

I think this is a C stack overflow problem.  Probably needs a test added 
internally to save().

I could not reproduce this on Linux: I got a C stack overflow that was 
caught.


On Wed, 26 Apr 2006, Henrik Bengtsson (max 7Mb) wrote:

> Hi,
>
> first, this not a problem originating from me, but it was observed
> trying to do similar things with my R.oo package, so I troubleshooted
> it and found the following.
>
> On R v2.3.0 (patched), the following will crash R on WinXP sooner or later:
>
> troubleLimit <- 20435;
>
> linkedList <- list(head=new.env());
>
> currEnv <- linkedList$head;
> for (kk in 1:(2*troubleLimit)) {
>  if (kk %% 100 == 0)
>    print(kk);
>  nextEnv <- new.env();
>  assign("nxt", nextEnv, envir=currEnv);
>  currEnv <- nextEnv;
>  if (kk > troubleLimit) {
>    cat("Saving linked list of length ", kk, "...", sep="");
>    save(linkedList, file="linkedList.RData");
>    cat("ok\n");
>  }
> }
>
> This gives:
> ...
> [1] 20300
> [1] 20400
> Saving linked list of length 20436...ok
> Saving linked list of length 20437...ok
> Saving linked list of length 20438...
>
> and then R crashes/terminates.  On my WinXP machine it always happens
> at the same number of environments.
>
> I tried the same on R v2.2.0 (sic!) on Unix and there it gave a
> segfault a bit after 10000 environments.  ...and, the purpose of the
> example is not to implement linked lists, it to show that you can
> torture R to crash.
>
> Cheers
>
> Henrik
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From Jani.Erola at tukkk.fi  Wed Apr 26 21:31:11 2006
From: Jani.Erola at tukkk.fi (Jani.Erola at tukkk.fi)
Date: Wed, 26 Apr 2006 21:31:11 +0200 (CEST)
Subject: [Rd] R, Rcmdr crash on WinXP PRO laptop (PR#8583)
Message-ID: <20060426193111.DB3C6473ED@slim.kubism.ku.dk>

Having the same behaviour with 2.2.1 and 2.2.1 patched, even if R Cmdr
is not loaded. It does not appear to be strictly a data import problem.
For me the issue appears when trying to open any scripts, although not
always. For example, last week it occurred only a couple of times (had R
running more or less 24/7), yesterday at least 10 times. The computer is
Dell D610, graphics card Ati Mobility Radeon x300, win xp pro sp2. It
appears that Rgui is still running, but its not just visible. I suspect
it is not the the antivirus or firewall (I am having symantec) because I
have not experienced the same with my HP laptop with the same
antivirus/firewall installed.

Jani Erola 

	[[alternative HTML version deleted]]


From Jani.Erola at tukkk.fi  Wed Apr 26 21:34:38 2006
From: Jani.Erola at tukkk.fi (Jani.Erola at tukkk.fi)
Date: Wed, 26 Apr 2006 21:34:38 +0200 (CEST)
Subject: [Rd] R, Rcmdr crash on WinXP PRO laptop (PR#8583)
Message-ID: <20060426193438.0E6CC473ED@slim.kubism.ku.dk>

.and the same issue occurs in version 2.3.0

JE


From dsamperi at DecisionSynergy.com  Thu Apr 27 06:01:19 2006
From: dsamperi at DecisionSynergy.com (Dominick Samperi)
Date: Thu, 27 Apr 2006 00:01:19 -0400
Subject: [Rd] Minor issue building 2.3.0 under Red Hat Linux 9
Message-ID: <4450420F.7060803@DecisionSynergy.com>

Building R 2.3.0 fails under Red Hat 9.0 because
ssize_t is not defined in src/modules/internet/sock.h.
Inserting #include <sys/types.h> at the top of this
file fixes the problem.


From ripley at stats.ox.ac.uk  Thu Apr 27 11:53:31 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 27 Apr 2006 10:53:31 +0100 (BST)
Subject: [Rd] Minor issue building 2.3.0 under Red Hat Linux 9
In-Reply-To: <4450420F.7060803@DecisionSynergy.com>
References: <4450420F.7060803@DecisionSynergy.com>
Message-ID: <Pine.LNX.4.64.0604271033420.24905@gannet.stats.ox.ac.uk>

On Thu, 27 Apr 2006, Dominick Samperi wrote:

> Building R 2.3.0 fails under Red Hat 9.0 because
> ssize_t is not defined in src/modules/internet/sock.h.
> Inserting #include <sys/types.h> at the top of this
> file fixes the problem.

That's interesting: POSIX says it must be defined in unistd.h, and that is 
included before sock.h in all the C files AFAICS (and this is why all the 
Unix-alike platforms tested before release do compile that module).

It's a bug in RH9 (there seems to be no 9.0), and that is maintained by 
Fedora Legacy -- do they have an update?

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From antonio.fabio at gmail.com  Thu Apr 27 12:31:44 2006
From: antonio.fabio at gmail.com (Antonio, Fabio Di Narzo)
Date: Thu, 27 Apr 2006 12:31:44 +0200
Subject: [Rd] as.factor: changed behaviour for Date class
Message-ID: <b0808fdc0604270331r400ee269q5323f117da3610e4@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
Url: https://stat.ethz.ch/pipermail/r-devel/attachments/20060427/83b5db07/attachment.pl 

From p.c.j.kleiweg at rug.nl  Thu Apr 27 14:09:14 2006
From: p.c.j.kleiweg at rug.nl (Peter Kleiweg)
Date: Thu, 27 Apr 2006 14:09:14 +0200 (CEST)
Subject: [Rd] Minor issue building 2.3.0 under Red Hat Linux 9
In-Reply-To: <Pine.LNX.4.64.0604271033420.24905@gannet.stats.ox.ac.uk>
References: <4450420F.7060803@DecisionSynergy.com>
	<Pine.LNX.4.64.0604271033420.24905@gannet.stats.ox.ac.uk>
Message-ID: <Pine.LNX.4.63.0604271401550.1267@kleigh.nl>

Prof Brian Ripley schreef op de 27e dag van de grasmaand van het jaar 2006:

> On Thu, 27 Apr 2006, Dominick Samperi wrote:
> 
> > Building R 2.3.0 fails under Red Hat 9.0 because
> > ssize_t is not defined in src/modules/internet/sock.h.
> > Inserting #include <sys/types.h> at the top of this
> > file fixes the problem.
> 
> That's interesting: POSIX says it must be defined in unistd.h, and that is 
> included before sock.h in all the C files AFAICS (and this is why all the 
> Unix-alike platforms tested before release do compile that module).
> 
> It's a bug in RH9 (there seems to be no 9.0), and that is maintained by 
> Fedora Legacy -- do they have an update?

Also SuSE 8.0, see bug PR#8809. And I have ssize_t defined in 
unistd.h, so I guess unistd.h does not get included into 
sockconn.c.


-- 
Peter Kleiweg
http://www.let.rug.nl/~kleiweg/


From MSchwartz at mn.rr.com  Thu Apr 27 14:54:13 2006
From: MSchwartz at mn.rr.com (Marc Schwartz)
Date: Thu, 27 Apr 2006 07:54:13 -0500
Subject: [Rd] Minor issue building 2.3.0 under Red Hat Linux 9
In-Reply-To: <Pine.LNX.4.64.0604271033420.24905@gannet.stats.ox.ac.uk>
References: <4450420F.7060803@DecisionSynergy.com>
	<Pine.LNX.4.64.0604271033420.24905@gannet.stats.ox.ac.uk>
Message-ID: <1146142453.4606.26.camel@localhost.localdomain>

On Thu, 2006-04-27 at 10:53 +0100, Prof Brian Ripley wrote:
> On Thu, 27 Apr 2006, Dominick Samperi wrote:
> 
> > Building R 2.3.0 fails under Red Hat 9.0 because
> > ssize_t is not defined in src/modules/internet/sock.h.
> > Inserting #include <sys/types.h> at the top of this
> > file fixes the problem.
> 
> That's interesting: POSIX says it must be defined in unistd.h, and that is 
> included before sock.h in all the C files AFAICS (and this is why all the 
> Unix-alike platforms tested before release do compile that module).
> 
> It's a bug in RH9 (there seems to be no 9.0), and that is maintained by 
> Fedora Legacy -- do they have an update?

Prior to RH 9 (ie. RH 8.0), there were fractional releases with updates.
However, with 9, while updates were provided, the numbering scheme
changed to integer releases only and this is still the case with FC.

Fedora Legacy's raison d'etre is to provide security updates but not
necessarily functional updates and/or general bug fixes. This seems to
be the case for RH 9 if one reviews the list of updates that they have
provided to date:

  http://www.fedoralegacy.org/updates/RH9/

There is no guarantee from the FL folks as to how long they will support
older releases beyond the roughly 1.5 years post EOL for a prior version
of RH/FC. This is articulated in their "1-2-3 and out" policy and we are
well beyond the 1.5 years for RH 9.

Seeing Peter's response on SuSE 8.0, one of the things that might be in
common here is the use of the 2.4 series kernels. Was there a change of
some sort with the 2.6 kernels that would impact this situation?

HTH,

Marc Schwartz


From rpeng at jhsph.edu  Thu Apr 27 14:58:12 2006
From: rpeng at jhsph.edu (Roger D. Peng)
Date: Thu, 27 Apr 2006 08:58:12 -0400
Subject: [Rd] difference in rbind() [print?] behavior between 2.2.1 and 2.3.0
Message-ID: <4450BFE4.60203@jhsph.edu>

I'm a little confused by a change in behavior from 2.2.1 to 2.3.0.  In 2.2.1 I 
could do

 > ## Create a list of data frames in 2.2.1
 > b <- list(x = data.frame(a = 1, b = 2), y = data.frame(a = 1, b = 2))
 > do.call("rbind", b)
   a b
x 1 2
y 1 2

But in 2.3.0 I get

 > do.call("rbind", b)
Error in data.frame(a = c("1", "1"), b = c("2", "2"), check.names = FALSE,  :
         row names contain missing values

Traceback indicates that the error is actually in the print method.

 > d <- do.call("rbind", b)
 > d
Error in data.frame(a = c("1", "1"), b = c("2", "2"), check.names = FALSE,  :
         row names contain missing values

But:

 > d[1:2, ]
     a b
NA  1 2
NA1 1 2
 >

I'm not sure those are the intended row names but I'm not sure.  The following 
does seem to work as I would have expected:

 > b <- list(x = data.frame(a = 1:2, b = 2:3), y = data.frame(a = 1:2, b = 2:3)) 
 > do.call("rbind", b)
     a b
x.1 1 2
x.2 2 3
y.1 1 2
y.2 2 3
 >


-roger
-- 
Roger D. Peng  |  http://www.biostat.jhsph.edu/~rpeng/


From rgentlem at fhcrc.org  Thu Apr 27 17:17:22 2006
From: rgentlem at fhcrc.org (Robert Gentleman)
Date: Thu, 27 Apr 2006 08:17:22 -0700
Subject: [Rd] proposed modifications to deprecated
Message-ID: <4450E082.5010206@fhcrc.org>

Hi,
   Over the past six months we have had a few problems with deprecation 
and Seth Falcon and I want to propose a few additions to the mechanism 
that will help deal with cases other than the deprecation of functions.

  In the last release one of the arguments to La.svd was deprecated, but 
the warning message was very unclear and suggested that in fact La.svd 
was deprecated.
   Adding a third argument to .Deprecated, msg say (to be consistent 
with the internal naming mechanism) that contains the message string 
would allow for handling the La.svd issue in a more informative way. It 
is a strict addition so no existing code is likely to be broken.

   We also need to deprecate data from time to time. Since the field of 
genomics is moving fast as good example from five years ago is often no 
longer a good example today. This one is a bit harder, but we can modify
   tools:::.make_file_exts("data")

   to first look for a ".DEP" extension (this does not seem to be a 
widely used extension), and if such a file exists, ie NameofData.DEP
  one of two things happens: if it contains a character string we use 
that for the message (we could source it for the message?), if not print 
a standard message (just as .Deprecated does) and then continue with the 
search using the other file extensions.

   Defunct could be handled similarly.

  Comments, alternative suggestions?

  thanks
    Robert

-- 
Robert Gentleman, PhD
Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M2-B876
PO Box 19024
Seattle, Washington 98109-1024
206-667-7700
rgentlem at fhcrc.org


From doddl at mail.nih.gov  Thu Apr 27 17:35:53 2006
From: doddl at mail.nih.gov (doddl at mail.nih.gov)
Date: Thu, 27 Apr 2006 17:35:53 +0200 (CEST)
Subject: [Rd] ? bug in 'sample' (PR#8813)
Message-ID: <20060427153553.2742347718@slim.kubism.ku.dk>

I have found that specifying different "sizes" in the sample command has
a funny effect on the random sampling.  The code below is a condensed
version of a function I wrote to simulate a bootstrap method.  For
simplicity, I eliminated the internal bootstrap loop, but kept a
statement to draw one bootstrap sample, because this is where the
problem occurs.  The output (mean(y)^2) should be the same for the two
runs of the function below, since it is based on the original rnorm
draw.  For the first iteration of this function, it is, but thereafter
the results aren't the same.  If I run this code in Splus, the results
are the same.  Also, if I set the size argument to be the same (or
eliminate this line altogether), I get reproducible results.=20=20

=20

I'm using R 2.2.0

=20

Thanks,

-Lori

=20

test.fun<-function(nsamp, mu,q, seed, nsim=3D2){

set.seed(seed)=20=20=20=20

mnsq<-rep(NA,nsim)

for (i in 1:nsim){

y<-rnorm(nsamp,mean=3Dmu)

yboot<-sample(y, size=3Dq, replace=3DT)

mnsq[i]<-(mean(y)^2)

}

return(mnsq)

}

=20

test.fun(50,0,30,12345)

test.fun(50,0,10,12345)

=20

Lori E. Dodd, Ph.D.

National Cancer Institute

Biometric Research Branch

6130 Executive Blvd, MSC 7434

Rockville, MD 20892=20

(For overnight deliveries use 20852)

=20

Phone: 301-402-0383

FAX:    301-402-0560

Email: doddl at mail.nih.gov

=20


	[[alternative HTML version deleted]]


From p.dalgaard at biostat.ku.dk  Thu Apr 27 17:55:48 2006
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: 27 Apr 2006 17:55:48 +0200
Subject: [Rd] ? bug in 'sample' (PR#8813)
In-Reply-To: <20060427153553.2742347718@slim.kubism.ku.dk>
References: <20060427153553.2742347718@slim.kubism.ku.dk>
Message-ID: <x2fyjzhv23.fsf@viggo.kubism.ku.dk>

doddl at mail.nih.gov writes:

> I have found that specifying different "sizes" in the sample command has
> a funny effect on the random sampling.  The code below is a condensed
> version of a function I wrote to simulate a bootstrap method.  For
> simplicity, I eliminated the internal bootstrap loop, but kept a
> statement to draw one bootstrap sample, because this is where the
> problem occurs.  The output (mean(y)^2) should be the same for the two
> runs of the function below, since it is based on the original rnorm
> draw.  For the first iteration of this function, it is, but thereafter
> the results aren't the same.  If I run this code in Splus, the results
> are the same.  Also, if I set the size argument to be the same (or
> eliminate this line altogether), I get reproducible results.  


What is the issue? To generate samples of different sizes, you may
need a different number of random draws, so the RNG is not going to be
in the same state the 2nd time you hit rnorm().

A current Splus (7.0.0) doesn't give you the same result either:


 > test.fun(50,0,30,12345)
[1] 2.712664e-05 9.971680e-03
> test.fun(50,0,10,12345)
[1] 2.712664e-05 2.225859e-03

>  
> 
> I'm using R 2.2.0
> 
>  
> 
> Thanks,
> 
> -Lori
> 
>  
> 
> test.fun<-function(nsamp, mu,q, seed, nsim=2){
> 
> set.seed(seed)    
> 
> mnsq<-rep(NA,nsim)
> 
> for (i in 1:nsim){
> 
> y<-rnorm(nsamp,mean=mu)
> 
> yboot<-sample(y, size=q, replace=T)
> 
> mnsq[i]<-(mean(y)^2)
> 
> }
> 
> return(mnsq)
> 
> }
> 
>  
> 
> test.fun(50,0,30,12345)
> 
> test.fun(50,0,10,12345)
> 
>  
> 
> Lori E. Dodd, Ph.D.
> 
> National Cancer Institute
> 
> Biometric Research Branch
> 
> 6130 Executive Blvd, MSC 7434
> 
> Rockville, MD 20892 
> 
> (For overnight deliveries use 20852)
> 
>  
> 
> Phone: 301-402-0383
> 
> FAX:    301-402-0560
> 
> Email: doddl at mail.nih.gov
> 
>  
> 
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From sudiptob at biostat.umn.edu  Thu Apr 27 18:10:41 2006
From: sudiptob at biostat.umn.edu (sudiptob at biostat.umn.edu)
Date: Thu, 27 Apr 2006 18:10:41 +0200 (CEST)
Subject: [Rd] Installation oddity on Fedora Core 5 (PR#8814)
Message-ID: <20060427161041.DB141473F9@slim.kubism.ku.dk>


Hello guys:

I recently installed FC 5 linux and installed R from source. It installed
fine, but there was an oddity that I want to report. Although I used

./configure --prefix=/usr/local/R-2.3.0

make

it did not seem to recognize the prefix and went ahead and installed it in
the source directory -- I usually ``tar xzf'' it to my home directory
and run the installation scripts from there (as root) to install to
/usr/local/R-2.3.0


This procedure worked fine on earlier versions of Fedora as well as on
debian and other distros. Wonder if this is a gcc-4.1 or GNU make issue.

Any feedback will be much appreciated.

Tx.

Sudipto.

*****************************************************************
Sudipto Banerjee, PhD,
Assistant Professor,
Div. of Biostatistics,
University of Minnesota,
A460 Mayo Building, MMC 303,
420 Delaware Street, SE,
Minneapolis, MN 55455.


From sfalcon at fhcrc.org  Thu Apr 27 18:18:44 2006
From: sfalcon at fhcrc.org (Seth Falcon)
Date: Thu, 27 Apr 2006 09:18:44 -0700
Subject: [Rd] Installation oddity on Fedora Core 5 (PR#8814)
In-Reply-To: <20060427161041.DB141473F9@slim.kubism.ku.dk>
	(sudiptob@biostat.umn.edu's message of "Thu,
	27 Apr 2006 18:10:41 +0200 (CEST)")
References: <20060427161041.DB141473F9@slim.kubism.ku.dk>
Message-ID: <m28xprng9n.fsf@ziti.local>

sudiptob at biostat.umn.edu writes:

> Hello guys:
>
> I recently installed FC 5 linux and installed R from source. It installed
> fine, but there was an oddity that I want to report. Although I used
>
> ./configure --prefix=/usr/local/R-2.3.0
>
> make

You need to do 'make install' I think.


From mschwartz at mn.rr.com  Thu Apr 27 18:22:57 2006
From: mschwartz at mn.rr.com (mschwartz at mn.rr.com)
Date: Thu, 27 Apr 2006 18:22:57 +0200 (CEST)
Subject: [Rd] Installation oddity on Fedora Core 5 (PR#8814)
Message-ID: <20060427162257.1269747F3F@slim.kubism.ku.dk>

On Thu, 2006-04-27 at 18:10 +0200, sudiptob at biostat.umn.edu wrote:
> Hello guys:
> 
> I recently installed FC 5 linux and installed R from source. It installed
> fine, but there was an oddity that I want to report. Although I used
> 
> ./configure --prefix=/usr/local/R-2.3.0
> 
> make
> 
> it did not seem to recognize the prefix and went ahead and installed it in
> the source directory -- I usually ``tar xzf'' it to my home directory
> and run the installation scripts from there (as root) to install to
> /usr/local/R-2.3.0
> 
> 
> This procedure worked fine on earlier versions of Fedora as well as on
> debian and other distros. Wonder if this is a gcc-4.1 or GNU make issue.
> 
> Any feedback will be much appreciated.
> 
> Tx.
> 
> Sudipto.

This question may be akin to "Is the computer plugged in?", but did you
also run:

  make install

?

HTH,

Marc Schwartz


From sudiptob at biostat.umn.edu  Thu Apr 27 18:26:01 2006
From: sudiptob at biostat.umn.edu (sudiptob at biostat.umn.edu)
Date: Thu, 27 Apr 2006 18:26:01 +0200 (CEST)
Subject: [Rd] Installation oddity on Fedora Core 5 (PR#8814)
Message-ID: <20060427162601.09D554776C@slim.kubism.ku.dk>


Hi Marc:

Thanks for your reply. Yeah, I did do

make install

and also tried it with simply make (which is, I presume, enough to
produce the executable scripts for R).

Please keep me posted.

Best,

S.

*****************************************************************
Sudipto Banerjee, PhD,
Div. of Biostatistics,
University of Minnesota,
A460 Mayo Building, MMC 303,
420 Delaware Street, SE,
Minneapolis, MN 55455.



On Thu, 27 Apr 2006, Marc Schwartz (via MN) wrote:

> On Thu, 2006-04-27 at 18:10 +0200, sudiptob at biostat.umn.edu wrote:
> > Hello guys:
> >
> > I recently installed FC 5 linux and installed R from source. It installed
> > fine, but there was an oddity that I want to report. Although I used
> >
> > ./configure --prefix=/usr/local/R-2.3.0
> >
> > make
> >
> > it did not seem to recognize the prefix and went ahead and installed it in
> > the source directory -- I usually ``tar xzf'' it to my home directory
> > and run the installation scripts from there (as root) to install to
> > /usr/local/R-2.3.0
> >
> >
> > This procedure worked fine on earlier versions of Fedora as well as on
> > debian and other distros. Wonder if this is a gcc-4.1 or GNU make issue.
> >
> > Any feedback will be much appreciated.
> >
> > Tx.
> >
> > Sudipto.
>
> This question may be akin to "Is the computer plugged in?", but did you
> also run:
>
>   make install
>
> ?
>
> HTH,
>
> Marc Schwartz
>
>
>


From sudiptob at biostat.umn.edu  Thu Apr 27 18:36:37 2006
From: sudiptob at biostat.umn.edu (sudiptob at biostat.umn.edu)
Date: Thu, 27 Apr 2006 18:36:37 +0200 (CEST)
Subject: [Rd] Installation oddity on Fedora Core 5 (PR#8814)
Message-ID: <20060427163637.426574772C@slim.kubism.ku.dk>


Guys: Let's hold off on this one for a while. I just tried installing
mplayer and got the same oddity! It might be an FC5 installation issue - I
will get back to you on this one.

Thanks for your help folks.

*****************************************************************
Sudipto Banerjee, PhD,
Assistant Professor,
Div. of Biostatistics,
University of Minnesota,
A460 Mayo Building, MMC 303,
420 Delaware Street, SE,
Minneapolis, MN 55455.



On Thu, 27 Apr 2006, Marc Schwartz (via MN) wrote:

> On Thu, 2006-04-27 at 18:10 +0200, sudiptob at biostat.umn.edu wrote:
> > Hello guys:
> >
> > I recently installed FC 5 linux and installed R from source. It installed
> > fine, but there was an oddity that I want to report. Although I used
> >
> > ./configure --prefix=/usr/local/R-2.3.0
> >
> > make
> >
> > it did not seem to recognize the prefix and went ahead and installed it in
> > the source directory -- I usually ``tar xzf'' it to my home directory
> > and run the installation scripts from there (as root) to install to
> > /usr/local/R-2.3.0
> >
> >
> > This procedure worked fine on earlier versions of Fedora as well as on
> > debian and other distros. Wonder if this is a gcc-4.1 or GNU make issue.
> >
> > Any feedback will be much appreciated.
> >
> > Tx.
> >
> > Sudipto.
>
> This question may be akin to "Is the computer plugged in?", but did you
> also run:
>
>   make install
>
> ?
>
> HTH,
>
> Marc Schwartz
>
>
>


From mschwartz at mn.rr.com  Thu Apr 27 18:44:00 2006
From: mschwartz at mn.rr.com (mschwartz at mn.rr.com)
Date: Thu, 27 Apr 2006 18:44:00 +0200 (CEST)
Subject: [Rd] Installation oddity on Fedora Core 5 (PR#8814)
Message-ID: <20060427164400.BA3464772C@slim.kubism.ku.dk>

Hi Sudipto,

OK. Just for clarification:

'make' will simply do the compilation 'in place' in the source directory
tree. No installation is performed here.

'make install' will actually do the installation into the target folder.

You can do 'make install' without 'make' first, but I suspect a lot of
folks, myself included, will run 'make' first and then run 'make
check-all' before installing, to be sure that the compilation is intact
and passes all checks. 

In fact, I keep the output of 'make check-all' as part of my
installation validation documentation.

That being said, were there any error messages output during 'make
install' that might suggest a problem such as access permission issues
to the target directory or the like?

You might also want to run (I think this is correct):

 dmesg

in a console to look for any 'avc' error messages in the error log. This
would be related to FC5's use of SELinux and there have been very
significant SELinux related policy changes in FC5 that could feasibly be
involved here also.

HTH,

Marc


On Thu, 2006-04-27 at 11:25 -0500, Sudipto Banerjee wrote:
> Hi Marc:
> 
> Thanks for your reply. Yeah, I did do
> 
> make install
> 
> and also tried it with simply make (which is, I presume, enough to
> produce the executable scripts for R).
> 
> Please keep me posted.
> 
> Best,
> 
> S.

> 
> On Thu, 27 Apr 2006, Marc Schwartz (via MN) wrote:
> 
> > On Thu, 2006-04-27 at 18:10 +0200, sudiptob at biostat.umn.edu wrote:
> > > Hello guys:
> > >
> > > I recently installed FC 5 linux and installed R from source. It installed
> > > fine, but there was an oddity that I want to report. Although I used
> > >
> > > ./configure --prefix=/usr/local/R-2.3.0
> > >
> > > make
> > >
> > > it did not seem to recognize the prefix and went ahead and installed it in
> > > the source directory -- I usually ``tar xzf'' it to my home directory
> > > and run the installation scripts from there (as root) to install to
> > > /usr/local/R-2.3.0
> > >
> > >
> > > This procedure worked fine on earlier versions of Fedora as well as on
> > > debian and other distros. Wonder if this is a gcc-4.1 or GNU make issue.
> > >
> > > Any feedback will be much appreciated.
> > >
> > > Tx.
> > >
> > > Sudipto.
> >
> > This question may be akin to "Is the computer plugged in?", but did you
> > also run:
> >
> >   make install
> >
> > ?
> >
> > HTH,
> >
> > Marc Schwartz
> >


From sudiptob at biostat.umn.edu  Thu Apr 27 18:48:16 2006
From: sudiptob at biostat.umn.edu (sudiptob at biostat.umn.edu)
Date: Thu, 27 Apr 2006 18:48:16 +0200 (CEST)
Subject: [Rd] Installation oddity on Fedora Core 5 (PR#8814)
Message-ID: <20060427164816.5F9674772C@slim.kubism.ku.dk>


Hi Marc:

Thanks so much for the input. You are right that I do not do the make
check-all (bad habit!) and usually just go:

./configure --prefix=
make
make install

route. Yes, I realized I had forgotten to mention make install in my
original mail, but I did try with that. I am simply reinstalling FC5
*disabling* the SElinux and see what happens. I will keep you posted.

Best,

S.

*****************************************************************
Sudipto Banerjee, PhD,
Div. of Biostatistics,
University of Minnesota,
A460 Mayo Building, MMC 303,
420 Delaware Street, SE,
Minneapolis, MN 55455.



On Thu, 27 Apr 2006, Marc Schwartz (via MN) wrote:

> Hi Sudipto,
>
> OK. Just for clarification:
>
> 'make' will simply do the compilation 'in place' in the source directory
> tree. No installation is performed here.
>
> 'make install' will actually do the installation into the target folder.
>
> You can do 'make install' without 'make' first, but I suspect a lot of
> folks, myself included, will run 'make' first and then run 'make
> check-all' before installing, to be sure that the compilation is intact
> and passes all checks.
>
> In fact, I keep the output of 'make check-all' as part of my
> installation validation documentation.
>
> That being said, were there any error messages output during 'make
> install' that might suggest a problem such as access permission issues
> to the target directory or the like?
>
> You might also want to run (I think this is correct):
>
>  dmesg
>
> in a console to look for any 'avc' error messages in the error log. This
> would be related to FC5's use of SELinux and there have been very
> significant SELinux related policy changes in FC5 that could feasibly be
> involved here also.
>
> HTH,
>
> Marc
>
>
> On Thu, 2006-04-27 at 11:25 -0500, Sudipto Banerjee wrote:
> > Hi Marc:
> >
> > Thanks for your reply. Yeah, I did do
> >
> > make install
> >
> > and also tried it with simply make (which is, I presume, enough to
> > produce the executable scripts for R).
> >
> > Please keep me posted.
> >
> > Best,
> >
> > S.
>
> >
> > On Thu, 27 Apr 2006, Marc Schwartz (via MN) wrote:
> >
> > > On Thu, 2006-04-27 at 18:10 +0200, sudiptob at biostat.umn.edu wrote:
> > > > Hello guys:
> > > >
> > > > I recently installed FC 5 linux and installed R from source. It installed
> > > > fine, but there was an oddity that I want to report. Although I used
> > > >
> > > > ./configure --prefix=/usr/local/R-2.3.0
> > > >
> > > > make
> > > >
> > > > it did not seem to recognize the prefix and went ahead and installed it in
> > > > the source directory -- I usually ``tar xzf'' it to my home directory
> > > > and run the installation scripts from there (as root) to install to
> > > > /usr/local/R-2.3.0
> > > >
> > > >
> > > > This procedure worked fine on earlier versions of Fedora as well as on
> > > > debian and other distros. Wonder if this is a gcc-4.1 or GNU make issue.
> > > >
> > > > Any feedback will be much appreciated.
> > > >
> > > > Tx.
> > > >
> > > > Sudipto.
> > >
> > > This question may be akin to "Is the computer plugged in?", but did you
> > > also run:
> > >
> > >   make install
> > >
> > > ?
> > >
> > > HTH,
> > >
> > > Marc Schwartz
> > >
>
>


From rigr-devel at stat.math.ethz.ch  Thu Apr 27 19:47:51 2006
From: rigr-devel at stat.math.ethz.ch (Lena Sellers)
Date: Thu, 27 Apr 2006 12:47:51 -0500
Subject: [Rd] Not making enough money to pay the bills?
Message-ID: <53303530706515.10861.qmail@129.132.145.15>

im wanting to show you this r-devel at lists.r-project.org

A Genuine University Deg'ree in 4-6 weeks!

Have you ever thought that the only thing stopping you from a great job an=
d
better pay was a few letters behind you name?
Well now you can get them!

BA      BSc      MA      MSc      MBA      PhD

Within 4-6 weeks!
No Study Required!
100 percent Verifiable!

These are real, genuine degrees that include B;achelors, Ma,sters, MBA and=

Doctorat*e D*egree. They are fully verifiable and certified transcripts ar=
e
also available.

Just call the number below.
You'll thank me later!

206-309-0673

24 hours a day, 7 days a week including Sundays and Holidays

Good Day


From p.dalgaard at biostat.ku.dk  Thu Apr 27 19:06:25 2006
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: 27 Apr 2006 19:06:25 +0200
Subject: [Rd] Installation oddity on Fedora Core 5 (PR#8814)
In-Reply-To: <20060427164816.5F9674772C@slim.kubism.ku.dk>
References: <20060427164816.5F9674772C@slim.kubism.ku.dk>
Message-ID: <x2ejzjosmm.fsf@turmalin.kubism.ku.dk>

sudiptob at biostat.umn.edu writes:

> Hi Marc:
> 
> Thanks so much for the input. You are right that I do not do the make
> check-all (bad habit!) and usually just go:
> 
> ./configure --prefix=
> make
> make install
> 
> route. Yes, I realized I had forgotten to mention make install in my
> original mail, but I did try with that. I am simply reinstalling FC5
> *disabling* the SElinux and see what happens. I will keep you posted.

Of course, 

  yum install R R-devel

gets you to your target much faster...

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907


From sudiptob at biostat.umn.edu  Thu Apr 27 19:39:10 2006
From: sudiptob at biostat.umn.edu (Sudipto Banerjee)
Date: Thu, 27 Apr 2006 12:39:10 -0500 (CDT)
Subject: [Rd] Installation oddity on Fedora Core 5 (PR#8814)
In-Reply-To: <x2ejzjosmm.fsf@turmalin.kubism.ku.dk>
Message-ID: <Pine.GSO.4.44.0604271234350.16427-100000@smelt.biostat.umn.edu>


Thanks to all who so promptly replied:

The good news is that diabling the SE-Linux resulted in the expected
behaviour. The --prefix was identified and everything was installed as I
had expected.

I am not knowledgable enough on SE Linux, so I cannot confirm whether this
was an SE-Linux issue or whether it was some mistake on my part during
installation.

Thanks again -- and have a good day!

Sudipto.

*****************************************************************
Sudipto Banerjee, PhD,
Assistant Professor,
Div. of Biostatistics,
University of Minnesota,
A460 Mayo Building, MMC 303,
420 Delaware Street, SE,
Minneapolis, MN 55455.



On 27 Apr 2006, Peter Dalgaard wrote:

> sudiptob at biostat.umn.edu writes:
>
> > Hi Marc:
> >
> > Thanks so much for the input. You are right that I do not do the make
> > check-all (bad habit!) and usually just go:
> >
> > ./configure --prefix=
> > make
> > make install
> >
> > route. Yes, I realized I had forgotten to mention make install in my
> > original mail, but I did try with that. I am simply reinstalling FC5
> > *disabling* the SElinux and see what happens. I will keep you posted.
>
> Of course,
>
>   yum install R R-devel
>
> gets you to your target much faster...
>
> --
>    O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
>   c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
>  (*) \(*) -- University of Copenhagen   Denmark          Ph:  (+45) 35327918
> ~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)                  FAX: (+45) 35327907
>


From thomas.friedrichsmeier at ruhr-uni-bochum.de  Thu Apr 27 21:06:18 2006
From: thomas.friedrichsmeier at ruhr-uni-bochum.de (Thomas Friedrichsmeier)
Date: Thu, 27 Apr 2006 21:06:18 +0200
Subject: [Rd] Strange parse behavior
Message-ID: <200604272106.22699.thomas.friedrichsmeier@ruhr-uni-bochum.de>

Hi,

I discovered the following strange behavior in parse () on syntactically 
incorrect statements. This is on R 2.3.0 (linux). It may or may not have been 
present earlier than 2.3.0, but I only discovered it recently. I can see no 
mention of it in the NEWS file from trunk.

Consider these statements (the output I get is shown commented below each 
statement):

bad.syntax <- ")\nprint (\"hello\")\nprint (\"world\")"

try (parse (text=bad.syntax, n=-1))	# OK
# Error in parse(file, n, text, prompt) : syntax error in ")"
try (parse (text=bad.syntax, n=1))	# OK
# Error in parse(file, n, text, prompt) : syntax error in ")"
try (parse (text=bad.syntax, n=2))	# No error!
# NULL
try (parse (text=bad.syntax, n=3))	# No error!
# NULL
try (parse (text=bad.syntax, n=4))	# Misleading message
# Error in parse(file, n, text, prompt) : syntax error in:
# "print ("hello")
# print ("world")"

Probably there are not too many use cases of parse (n=x) with x not either -1 
or 1, so it should not be a grave problem, but it just doesn't look right.

Regards
Thomas
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
Url : https://stat.ethz.ch/pipermail/r-devel/attachments/20060427/c6066d72/attachment.bin 

From murdoch at stats.uwo.ca  Thu Apr 27 21:42:37 2006
From: murdoch at stats.uwo.ca (murdoch at stats.uwo.ca)
Date: Thu, 27 Apr 2006 21:42:37 +0200 (CEST)
Subject: [Rd] Strange parse behavior (PR#8815)
Message-ID: <20060427194237.80EDAC76A@slim.kubism.ku.dk>

On 4/27/2006 3:06 PM, Thomas Friedrichsmeier wrote:
> Hi,
> 
> I discovered the following strange behavior in parse () on syntactically 
> incorrect statements. This is on R 2.3.0 (linux). It may or may not have been 
> present earlier than 2.3.0, but I only discovered it recently. I can see no 
> mention of it in the NEWS file from trunk.
> 
> Consider these statements (the output I get is shown commented below each 
> statement):
> 
> bad.syntax <- ")\nprint (\"hello\")\nprint (\"world\")"
> 
> try (parse (text=bad.syntax, n=-1))	# OK
> # Error in parse(file, n, text, prompt) : syntax error in ")"
> try (parse (text=bad.syntax, n=1))	# OK
> # Error in parse(file, n, text, prompt) : syntax error in ")"
> try (parse (text=bad.syntax, n=2))	# No error!
> # NULL
> try (parse (text=bad.syntax, n=3))	# No error!
> # NULL
> try (parse (text=bad.syntax, n=4))	# Misleading message
> # Error in parse(file, n, text, prompt) : syntax error in:
> # "print ("hello")
> # print ("world")"
> 
> Probably there are not too many use cases of parse (n=x) with x not either -1 
> or 1, so it should not be a grave problem, but it just doesn't look right.

I see the same results as you, in versions back to 1.9.1.  I agree that 
it looks like a bug, but not a new one.  I've sent this reply to the 
bugs list so it gets recorded.  I won't have time to look into it soon.

Duncan Murdoch


From gordon at optopia.net  Thu Apr 27 22:10:11 2006
From: gordon at optopia.net (gordon smith)
Date: Thu, 27 Apr 2006 14:10:11 -0600
Subject: [Rd]  Minor Windows clipboard issue
Message-ID: <44512523.4090007@optopia.net>

Hello

I have a small problem in Windows RGui using Remote Desktop when the 
clipboard paste menu item becomes unexpectedly disabled.

I'm using Remote Desktop to connect from a Windows 2000 workstation 
client to RGui running on Windows Server 2003. After text is pasted to 
RGui from the client a couple of times, the "Edit : Paste" menu item 
becomes disabled when data should be available from the clipboard. 
Pasting of clipboard contents is disabled at that time for a local 
Notepad also. The paste menu item is re-enabled when the following happens:

   1. Cut/copy from a local application (remote paste remains disabled 
when attempted again).
   2. Disconnect and reconnect the remote desktop connection (remote 
paste becomes enabled).

A simple workaround is to paste into Notepad on the remote host, then 
cut/copy from the local Notepad into RGui.

I haven't located any useful material, but VNC and/or eclipse may also 
have (had) this problem.
_https://bugs.eclipse.org/bugs/show_bug.cgi?id=70077_

I can't locate the VNC item.

 > version

platform i386-pc-mingw32
arch     i386          
os       mingw32       
system   i386, mingw32 
status                 
major    2             
minor    2.1           
year     2005          
month    12            
day      20            
svn rev  36812         
language R


From ripley at stats.ox.ac.uk  Thu Apr 27 22:34:53 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 27 Apr 2006 21:34:53 +0100 (BST)
Subject: [Rd] Minor issue building 2.3.0 under Red Hat Linux 9
In-Reply-To: <1146142453.4606.26.camel@localhost.localdomain>
References: <4450420F.7060803@DecisionSynergy.com>
	<Pine.LNX.4.64.0604271033420.24905@gannet.stats.ox.ac.uk>
	<1146142453.4606.26.camel@localhost.localdomain>
Message-ID: <Pine.LNX.4.64.0604272132460.21698@gannet.stats.ox.ac.uk>

On Thu, 27 Apr 2006, Marc Schwartz wrote:

> On Thu, 2006-04-27 at 10:53 +0100, Prof Brian Ripley wrote:
>> On Thu, 27 Apr 2006, Dominick Samperi wrote:
>>
>>> Building R 2.3.0 fails under Red Hat 9.0 because
>>> ssize_t is not defined in src/modules/internet/sock.h.
>>> Inserting #include <sys/types.h> at the top of this
>>> file fixes the problem.
>>
>> That's interesting: POSIX says it must be defined in unistd.h, and that is
>> included before sock.h in all the C files AFAICS (and this is why all the
>> Unix-alike platforms tested before release do compile that module).
>>
>> It's a bug in RH9 (there seems to be no 9.0), and that is maintained by
>> Fedora Legacy -- do they have an update?
>
> Prior to RH 9 (ie. RH 8.0), there were fractional releases with updates.
> However, with 9, while updates were provided, the numbering scheme
> changed to integer releases only and this is still the case with FC.
>
> Fedora Legacy's raison d'etre is to provide security updates but not
> necessarily functional updates and/or general bug fixes. This seems to
> be the case for RH 9 if one reviews the list of updates that they have
> provided to date:
>
>  http://www.fedoralegacy.org/updates/RH9/
>
> There is no guarantee from the FL folks as to how long they will support
> older releases beyond the roughly 1.5 years post EOL for a prior version
> of RH/FC. This is articulated in their "1-2-3 and out" policy and we are
> well beyond the 1.5 years for RH 9.
>
> Seeing Peter's response on SuSE 8.0, one of the things that might be in
> common here is the use of the 2.4 series kernels. Was there a change of
> some sort with the 2.6 kernels that would impact this situation?

I have no idea, but have modified the sock.h to have a belt-and-braces 
approach.

I'll say once again how unfortunate it is that people do not report things 
like this prior to release.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From murdoch at stats.uwo.ca  Thu Apr 27 23:02:03 2006
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Thu, 27 Apr 2006 17:02:03 -0400
Subject: [Rd] Minor Windows clipboard issue
In-Reply-To: <44512523.4090007@optopia.net>
References: <44512523.4090007@optopia.net>
Message-ID: <4451314B.3000904@stats.uwo.ca>

On 4/27/2006 4:10 PM, gordon smith wrote:
> Hello
> 
> I have a small problem in Windows RGui using Remote Desktop when the 
> clipboard paste menu item becomes unexpectedly disabled.
> 
> I'm using Remote Desktop to connect from a Windows 2000 workstation 
> client to RGui running on Windows Server 2003. After text is pasted to 
> RGui from the client a couple of times, the "Edit : Paste" menu item 
> becomes disabled when data should be available from the clipboard. 
> Pasting of clipboard contents is disabled at that time for a local 
> Notepad also. The paste menu item is re-enabled when the following happens:

If it happens for both R and Notepad, it's presumably a Windows bug, 
isn't it?

> 
>    1. Cut/copy from a local application (remote paste remains disabled 
> when attempted again).
>    2. Disconnect and reconnect the remote desktop connection (remote 
> paste becomes enabled).
> 
> A simple workaround is to paste into Notepad on the remote host, then 
> cut/copy from the local Notepad into RGui.

I don't follow this:  didn't you say above that pasting is disabled for 
Notepad, too?

> I haven't located any useful material, but VNC and/or eclipse may also 
> have (had) this problem.
> _https://bugs.eclipse.org/bugs/show_bug.cgi?id=70077_
> 
> I can't locate the VNC item.
> 
>  > version
> 
> platform i386-pc-mingw32
> arch     i386          
> os       mingw32       
> system   i386, mingw32 
> status                 
> major    2             
> minor    2.1           
> year     2005          
> month    12            
> day      20            
> svn rev  36812         
> language R

That's not the current release....

Duncan Murdoch
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From ripley at stats.ox.ac.uk  Fri Apr 28 10:22:01 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 28 Apr 2006 09:22:01 +0100 (BST)
Subject: [Rd] difference in rbind() [print?] behavior between 2.2.1 and
 2.3.0
In-Reply-To: <4450BFE4.60203@jhsph.edu>
References: <4450BFE4.60203@jhsph.edu>
Message-ID: <Pine.LNX.4.64.0604280157020.1997@gannet.stats.ox.ac.uk>

On Thu, 27 Apr 2006, Roger D. Peng wrote:

> I'm a little confused by a change in behavior from 2.2.1 to 2.3.0.  In 2.2.1 I
> could do

So was I, as R-devel works in the same way as 2.2.1.  A simpler version is

rbind(x = data.frame(a = 1, b = 2), y = data.frame(a = 1, b = 2))

The problem is in the fix supplied for PR#8506, which happens to work in 
some cases and not others.  I've re-fixed it in 2.3.0 patched.

>
> > ## Create a list of data frames in 2.2.1
> > b <- list(x = data.frame(a = 1, b = 2), y = data.frame(a = 1, b = 2))
> > do.call("rbind", b)
>   a b
> x 1 2
> y 1 2
>
> But in 2.3.0 I get
>
> > do.call("rbind", b)
> Error in data.frame(a = c("1", "1"), b = c("2", "2"), check.names = FALSE,  :
>         row names contain missing values
>
> Traceback indicates that the error is actually in the print method.
>
> > d <- do.call("rbind", b)
> > d
> Error in data.frame(a = c("1", "1"), b = c("2", "2"), check.names = FALSE,  :
>         row names contain missing values
>
> But:
>
> > d[1:2, ]
>     a b
> NA  1 2
> NA1 1 2
> >
>
> I'm not sure those are the intended row names but I'm not sure.  The following
> does seem to work as I would have expected:
>
> > b <- list(x = data.frame(a = 1:2, b = 2:3), y = data.frame(a = 1:2, b = 2:3))
> > do.call("rbind", b)
>     a b
> x.1 1 2
> x.2 2 3
> y.1 1 2
> y.2 2 3
> >
>
>
> -roger
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Fri Apr 28 10:39:06 2006
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 28 Apr 2006 09:39:06 +0100 (BST)
Subject: [Rd] Large number of linked environments makes save() crash R
In-Reply-To: <Pine.LNX.4.64.0604262005490.1068@gannet.stats.ox.ac.uk>
References: <59d7961d0604261035k1291b6fcv524edd34f520ceae@mail.gmail.com>
	<Pine.LNX.4.64.0604262005490.1068@gannet.stats.ox.ac.uk>
Message-ID: <Pine.LNX.4.64.0604280937170.15711@gannet.stats.ox.ac.uk>

On Wed, 26 Apr 2006, Prof Brian Ripley wrote:

> I think this is a C stack overflow problem.  Probably needs a test added 
> internally to save().

I've added such a test and it is now caught.  (You still cannot actually
save such an object.)

> I could not reproduce this on Linux: I got a C stack overflow that was 
> caught.

Since Linux signals stack overflows and Windows does not.

>
>
> On Wed, 26 Apr 2006, Henrik Bengtsson (max 7Mb) wrote:
>
>> Hi,
>> 
>> first, this not a problem originating from me, but it was observed
>> trying to do similar things with my R.oo package, so I troubleshooted
>> it and found the following.
>> 
>> On R v2.3.0 (patched), the following will crash R on WinXP sooner or later:
>> 
>> troubleLimit <- 20435;
>> 
>> linkedList <- list(head=new.env());
>> 
>> currEnv <- linkedList$head;
>> for (kk in 1:(2*troubleLimit)) {
>>  if (kk %% 100 == 0)
>>    print(kk);
>>  nextEnv <- new.env();
>>  assign("nxt", nextEnv, envir=currEnv);
>>  currEnv <- nextEnv;
>>  if (kk > troubleLimit) {
>>    cat("Saving linked list of length ", kk, "...", sep="");
>>    save(linkedList, file="linkedList.RData");
>>    cat("ok\n");
>>  }
>> }
>> 
>> This gives:
>> ...
>> [1] 20300
>> [1] 20400
>> Saving linked list of length 20436...ok
>> Saving linked list of length 20437...ok
>> Saving linked list of length 20438...
>> 
>> and then R crashes/terminates.  On my WinXP machine it always happens
>> at the same number of environments.
>> 
>> I tried the same on R v2.2.0 (sic!) on Unix and there it gave a
>> segfault a bit after 10000 environments.  ...and, the purpose of the
>> example is not to implement linked lists, it to show that you can
>> torture R to crash.
>> 
>> Cheers
>> 
>> Henrik
>> 
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>> 
>> 
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From roebuck at mdanderson.org  Fri Apr 28 10:46:08 2006
From: roebuck at mdanderson.org (Paul Roebuck)
Date: Fri, 28 Apr 2006 03:46:08 -0500 (CDT)
Subject: [Rd] Minor issue building 2.3.0 under Red Hat Linux 9
In-Reply-To: <Pine.LNX.4.64.0604272132460.21698@gannet.stats.ox.ac.uk>
References: <4450420F.7060803@DecisionSynergy.com>
	<Pine.LNX.4.64.0604271033420.24905@gannet.stats.ox.ac.uk>
	<1146142453.4606.26.camel@localhost.localdomain>
	<Pine.LNX.4.64.0604272132460.21698@gannet.stats.ox.ac.uk>
Message-ID: <Pine.OSF.4.58.0604280230420.445346@wotan.mdacc.tmc.edu>

On Thu, 27 Apr 2006, Prof Brian Ripley wrote:

> On Thu, 27 Apr 2006, Marc Schwartz wrote:
>
> > On Thu, 2006-04-27 at 10:53 +0100, Prof Brian Ripley wrote:
> >
> >> On Thu, 27 Apr 2006, Dominick Samperi wrote:
> >>
> >>> Building R 2.3.0 fails under Red Hat 9.0 because
> >>> ssize_t is not defined in src/modules/internet/sock.h.
> >>> Inserting #include <sys/types.h> at the top of this
> >>> file fixes the problem.
> >>
> >> That's interesting: POSIX says it must be defined in unistd.h, and that is
> >> included before sock.h in all the C files AFAICS (and this is why all the
> >> Unix-alike platforms tested before release do compile that module).
> >>
> >> It's a bug in RH9 (there seems to be no 9.0), and that is maintained by
> >> Fedora Legacy -- do they have an update?
> >
> > [SNIP]
>
> I have no idea, but have modified the sock.h to have a belt-and-braces
> approach.

POSIX Programmer's Guide shows ssize_t was added to
<sys/types.h> in IEEE Std 1003.1-1990 as a result of
changing the function declarations for read() and write().

The change to "sock.h" would seem appropriate, not careful,
as the header file assumed ssize_t was previously defined.

----------------------------------------------------------
SIGSIG -- signature too long (core dumped)


From roebuck at mdanderson.org  Fri Apr 28 10:54:35 2006
From: roebuck at mdanderson.org (Paul Roebuck)
Date: Fri, 28 Apr 2006 03:54:35 -0500 (CDT)
Subject: [Rd] R-FAQ.pdf TOC missing
Message-ID: <Pine.OSF.4.58.0604280349000.445346@wotan.mdacc.tmc.edu>

I downloaded 2.3 version of R-FAQ.pdf from CRAN and noticed
the table of contents does not appear in the PDF version
as it does in the HTML version.

----------------------------------------------------------
SIGSIG -- signature too long (core dumped)


From Kurt.Hornik at wu-wien.ac.at  Fri Apr 28 13:49:26 2006
From: Kurt.Hornik at wu-wien.ac.at (Kurt Hornik)
Date: Fri, 28 Apr 2006 13:49:26 +0200
Subject: [Rd] R-FAQ.pdf TOC missing
In-Reply-To: <Pine.OSF.4.58.0604280349000.445346@wotan.mdacc.tmc.edu>
References: <Pine.OSF.4.58.0604280349000.445346@wotan.mdacc.tmc.edu>
Message-ID: <17490.326.912687.863631@mithrandir.hornik.net>

>>>>> Paul Roebuck writes:

> I downloaded 2.3 version of R-FAQ.pdf from CRAN and noticed
> the table of contents does not appear in the PDF version
> as it does in the HTML version.

Where did you get this from?  The version I just got from

  http://cran.r-project.org/doc/FAQ/R-FAQ.pdf

has both bookmarks and toc.

Best
-k


From pinard at iro.umontreal.ca  Fri Apr 28 14:12:00 2006
From: pinard at iro.umontreal.ca (pinard at iro.umontreal.ca)
Date: Fri, 28 Apr 2006 14:12:00 +0200 (CEST)
Subject: [Rd] Tiny documentation error in ?merge (PR#8818)
Message-ID: <20060428121200.A921019A00@slim.kubism.ku.dk>

Hi, people.  In the "Details" section of ?merge, we read:

      If the 'by.*' vectors are of length 0, the result, 'r', is the
     "Cartesian product" of 'x' and 'y', i.e., 'dim(r) =
     c(nrow(x)*nrow, ncol(x) + ncol(y))'.

On the last line, '(y)' seems to be missing just before the comma.

--please do not edit the information below--

Version:
 platform = i686-pc-linux-gnu
 arch = i686
 os = linux-gnu
 system = i686, linux-gnu
 status = 
 major = 2
 minor = 3.0
 year = 2006
 month = 04
 day = 24
 svn rev = 37909
 language = R
 version.string = Version 2.3.0 (2006-04-24)

Locale:
LC_CTYPE=fr_CA.UTF-8;LC_NUMERIC=C;LC_TIME=fr_CA.UTF-8;LC_COLLATE=fr_CA.UTF-8;LC_MONETARY=fr_CA.UTF-8;LC_MESSAGES=fr_CA.UTF-8;LC_PAPER=C;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=C;LC_IDENTIFICATION=C

Search Path:
 .GlobalEnv, package:methods, package:stats, package:graphics, package:utils, package:datasets, fp.etc, package:grDevices, Autoloads, package:base

-- 
Fran??ois Pinard   http://pinard.progiciels-bpi.ca


From hin-tak.leung at cimr.cam.ac.uk  Fri Apr 28 14:57:54 2006
From: hin-tak.leung at cimr.cam.ac.uk (Hin-Tak Leung)
Date: Fri, 28 Apr 2006 13:57:54 +0100
Subject: [Rd] R-FAQ.pdf TOC missing
In-Reply-To: <17490.326.912687.863631@mithrandir.hornik.net>
References: <Pine.OSF.4.58.0604280349000.445346@wotan.mdacc.tmc.edu>
	<17490.326.912687.863631@mithrandir.hornik.net>
Message-ID: <44521152.7010605@cimr.cam.ac.uk>

Kurt Hornik wrote:
>>>>>> Paul Roebuck writes:
> 
>> I downloaded 2.3 version of R-FAQ.pdf from CRAN and noticed
>> the table of contents does not appear in the PDF version
>> as it does in the HTML version.
> 
> Where did you get this from?  The version I just got from
> 
>   http://cran.r-project.org/doc/FAQ/R-FAQ.pdf
> 
> has both bookmarks and toc.

Argh, interesting enough, I know the one on CRAN has bookmarks and
tocs, but the R-FAQ in my hard disc ($R_HOME/doc/manual/) doesn't.
Some of the other manuals do have them. I am wondering at this point if
somewhere a double pdflatex is missing. (it requires running pdflatex 
twice - the first pass to generate the toc support files, the
2nd pass to include the supports files generated in the first pass).

The one in my hard disc was generated by putting the older R.spec file
together with the new tar ball and run rpmbuild (on FC5), so I wasn't 
really watching.

HTL


From Kurt.Hornik at wu-wien.ac.at  Fri Apr 28 19:16:00 2006
From: Kurt.Hornik at wu-wien.ac.at (Kurt Hornik)
Date: Fri, 28 Apr 2006 19:16:00 +0200
Subject: [Rd] R-FAQ.pdf TOC missing
In-Reply-To: <44521152.7010605@cimr.cam.ac.uk>
References: <Pine.OSF.4.58.0604280349000.445346@wotan.mdacc.tmc.edu>
	<17490.326.912687.863631@mithrandir.hornik.net>
	<44521152.7010605@cimr.cam.ac.uk>
Message-ID: <17490.19920.432871.438503@mithrandir.hornik.net>

>>>>> Hin-Tak Leung writes:

> Kurt Hornik wrote:
>>>>>>> Paul Roebuck writes:
>> 
>>> I downloaded 2.3 version of R-FAQ.pdf from CRAN and noticed
>>> the table of contents does not appear in the PDF version
>>> as it does in the HTML version.
>> 
>> Where did you get this from?  The version I just got from
>> 
>> http://cran.r-project.org/doc/FAQ/R-FAQ.pdf
>> 
>> has both bookmarks and toc.

> Argh, interesting enough, I know the one on CRAN has bookmarks and
> tocs, but the R-FAQ in my hard disc ($R_HOME/doc/manual/) doesn't.
> Some of the other manuals do have them. I am wondering at this point if
> somewhere a double pdflatex is missing. (it requires running pdflatex 
> twice - the first pass to generate the toc support files, the
> 2nd pass to include the supports files generated in the first pass).

> The one in my hard disc was generated by putting the older R.spec file
> together with the new tar ball and run rpmbuild (on FC5), so I wasn't 
> really watching.

Confirmed.  For some reason, the texi2dvi shipped with R and taken from
Texinfo 4.7 fails to rerun pdftex.  If I replace this by the version
from Texinfo 4.8, things seem fine.  Will fix in r-devel and r-patched,
and also fix the manual on CRAN.

Best
-k


From afinley at stat.umn.edu  Sat Apr 29 00:32:07 2006
From: afinley at stat.umn.edu (Andrew Finley)
Date: Fri, 28 Apr 2006 17:32:07 CDT
Subject: [Rd] random NaN in dpotri result
Message-ID: <200604282232.k3SMW7NW020759@saturn.software.umn.edu>

Hello all, 
In a piece of c++ code (part of a future R package), I'm inverting a
relatively large covariance matrix many times using:

F77_CALL(dpotrf)(&upper, &xnrow, R, &xnrow, &info);
F77_CALL(dpotri)(&upper, &xnrow, R, &xnrow, &info);

I am sure that the input matrix is PD and inverts just fine.  However, I
have found that dpotri gives one or more NaNs from time-to-time in the
upper (or lower depending on the specification) triangle.   When I say,
from time-to-time, I mean without warning in perhaps 1 in ~25 runs (but is
highly variable).  Also, when the NaNs occur, dpotri does not return an
error in info.  I have spent many many hours trying to get this error to
reproduce predictably, but cannot.  Even with the same input matrix,
sometimes I get a NaN but most of the time I do not, and their occurrence
seems to be random and random in the matrix.  When dpotri, does not produce
the NaN, the solution is correct.

To assure myself that I was not totally nuts, I tried both Linpack's dpodi
and a chol2inv routine from Numerical Recipes in place of dpotri.  Both of
these routines never produce the nan and provide the correct result.

I hesitate to post this problem, as I cannot get it to reproduce on a
regular basis.  Valgrind didn't report any memory access problems on my
code.

Has anybody seen this before, or might point out some stupid mistakes I
could be making?

Thanks for your time,

Andrew

R Version 2.3.0 (2006-04-24)
Debian Linux  2.6.15-1-686

 
Research Fellow
Department of Forest Resources
University of Minnesota
Office: 305 Green Hall
Phone: (612) 624-1714
Fax: (612) 625-5212
web: http://blue.fr.umn.edu


From gordon at optopia.net  Sat Apr 29 18:40:13 2006
From: gordon at optopia.net (gordon smith)
Date: Sat, 29 Apr 2006 10:40:13 -0600
Subject: [Rd] Minor Windows clipboard issue
In-Reply-To: <4451314B.3000904@stats.uwo.ca>
References: <44512523.4090007@optopia.net> <4451314B.3000904@stats.uwo.ca>
Message-ID: <445396ED.4050506@optopia.net>

Duncan Murdoch wrote:
> On 4/27/2006 4:10 PM, gordon smith wrote:
>   
>> Hello
>>
>> I have a small problem in Windows RGui using Remote Desktop when the 
>> clipboard paste menu item becomes unexpectedly disabled.
>>
>> I'm using Remote Desktop to connect from a Windows 2000 workstation 
>> client to RGui running on Windows Server 2003. After text is pasted to 
>> RGui from the client a couple of times, the "Edit : Paste" menu item 
>> becomes disabled when data should be available from the clipboard. 
>> Pasting of clipboard contents is disabled at that time for a local 
>> Notepad also. The paste menu item is re-enabled when the following happens:
>>     
>
> If it happens for both R and Notepad, it's presumably a Windows bug, 
> isn't it?
>
>   
Sorry that wasn't clear. The disablement occurs only when pasting into 
RGui, and does not occur when pasting into Notepad, hence the workaround 
using Notepad as intermediary. Once the clipboard is unavailable in 
RGui, it is also unavailable in Notepad and presumably all other 
applications.
>>    1. Cut/copy from a local application (remote paste remains disabled 
>> when attempted again).
>>    2. Disconnect and reconnect the remote desktop connection (remote 
>> paste becomes enabled).
>>
>> A simple workaround is to paste into Notepad on the remote host, then 
>> cut/copy from the local Notepad into RGui.
>>     
>
> I don't follow this:  didn't you say above that pasting is disabled for 
> Notepad, too?
>
>   
>> I haven't located any useful material, but VNC and/or eclipse may also 
>> have (had) this problem.
>> _https://bugs.eclipse.org/bugs/show_bug.cgi?id=70077_
>>
>> I can't locate the VNC item.
>>
>>  > version
>>
>> platform i386-pc-mingw32
>> arch     i386          
>> os       mingw32       
>> system   i386, mingw32 
>> status                 
>> major    2             
>> minor    2.1           
>> year     2005          
>> month    12            
>> day      20            
>> svn rev  36812         
>> language R
>>     
>
> That's not the current release....
>
> Duncan Murdoch
>   
I did bang on this for a week and missed the new version. I can give it 
a try.
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>     
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From dan.kelley at dal.ca  Sun Apr 30 14:35:35 2006
From: dan.kelley at dal.ca (dan.kelley at dal.ca)
Date: Sun, 30 Apr 2006 14:35:35 +0200 (CEST)
Subject: [Rd] Package-check failure (i386) (PR#8822)
Message-ID: <20060430123535.5B155CD16@slim.kubism.ku.dk>

Full_Name: Dan Kelley
Version: 2.3.0
OS: OSX Macintosh
Submission from: (NULL) (142.68.207.218)


R2.3.0 has a problem checking one of my self-authored Oce package
(http://myweb.dal.ca/kelley/pub/sof/oce/index.php).  The package builds fine on
another machine running a R2.2.1.  Both machines are macintoshes running the
latest version of OSX.

I am reporting this here not to get help - I realize the package is too big to
provide a test case - but rather as an alert.

Running "R CMD check oce" produces an error, and when I checked the relevant
failure file (ctd.Rout.fail), I see the following contents.  This suggests that
maybe the system is trying to run an i386 binary, even though the machine has a
powerpc CPU.  (Now you can see why I'm reporting this -- it seems to be a
problem with the OSX universal binary.)

/Library/Frameworks/R.framework/Resources/bin/R: line 192:
/Library/Frameworks/R.framework/Resources/bin/exec/i386/R: cannot execute binary
file
/Library/Frameworks/R.framework/Resources/bin/R: line 192:
/Library/Frameworks/R.framework/Resources/bin/exec/i386/R: Unknown error: 0


From gregor.gorjanc at bfro.uni-lj.si  Sun Apr 30 16:04:39 2006
From: gregor.gorjanc at bfro.uni-lj.si (gregor.gorjanc at bfro.uni-lj.si)
Date: Sun, 30 Apr 2006 16:04:39 +0200 (CEST)
Subject: [Rd] Wish: Add fill argument to warning and stop (PR#8823)
Message-ID: <20060430140439.85A33CCDB@slim.kubism.ku.dk>

Full_Name: Gregor Gorjanc
Version: R 2.2.1
OS: Linux
Submission from: (NULL) (82.192.44.229)


Hello!

It would be nice if warning() and stop() would have fill argument as it is in
cat().

Thanks!
         _
platform i486-pc-linux-gnu
arch     i486
os       linux-gnu
system   i486, linux-gnu
status
major    2
minor    2.1
year     2005
month    12
day      20
svn rev  36812
language R


