From @pencer@gr@ve@ @end|ng |rom prod@y@e@com  Sun May  1 21:41:39 2022
From: @pencer@gr@ve@ @end|ng |rom prod@y@e@com (Spencer Graves)
Date: Sun, 1 May 2022 14:41:39 -0500
Subject: [Rd] "with" doesn't work with names with blanks
Message-ID: <a70b7e3c-8975-dd83-705b-488945bb1af0@prodsyse.com>

Hello, All:


	  Column names in a data.frame are not supposed to have trailing 
blanks.  However, a CRAN package created one, which threw an error with 
"with".  Consider the following example:


 > (tst <- data.frame(1))
   X1
1  1
 > names(tst) <- 'x '
 > tst$x
[1] 1
 > with(txt, x)
Error in with(txt, x) : object 'txt' not found


	  I think it's interesting that "tst$x" works, but "with(txt, x)".


	  Comments?


	  It's not a major problem, though it took me a while to diagnose.  (I 
reported it to the maintainer of the package that returned a data.frame 
with names with trailing blanks.)


	  Thanks, for all your work in maintaining and upgrading R -- and in 
responding to emails from this list.


	  Spencer Graves


 > sessionInfo()
R version 4.2.0 (2022-04-22)
Platform: x86_64-apple-darwin17.0 (64-bit)
Running under: macOS Big Sur 11.6.5

Matrix products: default
LAPACK: 
/Library/Frameworks/R.framework/Versions/4.2/Resources/lib/libRlapack.dylib

locale:
[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

loaded via a namespace (and not attached):
[1] compiler_4.2.0 tools_4.2.0
 >


From murdoch@dunc@n @end|ng |rom gm@||@com  Sun May  1 21:51:20 2022
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Sun, 1 May 2022 15:51:20 -0400
Subject: [Rd] "with" doesn't work with names with blanks
In-Reply-To: <a70b7e3c-8975-dd83-705b-488945bb1af0@prodsyse.com>
References: <a70b7e3c-8975-dd83-705b-488945bb1af0@prodsyse.com>
Message-ID: <44e04e08-a17f-5b34-092d-5fb172dcffb1@gmail.com>

On 01/05/2022 3:41 p.m., Spencer Graves wrote:
> Hello, All:
> 
> 
> 	  Column names in a data.frame are not supposed to have trailing
> blanks.  However, a CRAN package created one, which threw an error with
> "with".  Consider the following example:
> 
> 
>   > (tst <- data.frame(1))
>     X1
> 1  1
>   > names(tst) <- 'x '
>   > tst$x
> [1] 1
>   > with(txt, x)
> Error in with(txt, x) : object 'txt' not found
> 
> 
> 	  I think it's interesting that "tst$x" works, but "with(txt, x)".
> 
> 
> 	  Comments?

tst$x works because of partial name matching.  (That leniency is one of 
the reasons for advice to avoid using $ in programs.)  It would be chaos 
if with() used partial name matching.

You can use

with(txt, `x `)

to include the space in the name.

Duncan Murdoch

> 
> 
> 	  It's not a major problem, though it took me a while to diagnose.  (I
> reported it to the maintainer of the package that returned a data.frame
> with names with trailing blanks.)
> 
> 
> 	  Thanks, for all your work in maintaining and upgrading R -- and in
> responding to emails from this list.
> 
> 
> 	  Spencer Graves
> 
> 
>   > sessionInfo()
> R version 4.2.0 (2022-04-22)
> Platform: x86_64-apple-darwin17.0 (64-bit)
> Running under: macOS Big Sur 11.6.5
> 
> Matrix products: default
> LAPACK:
> /Library/Frameworks/R.framework/Versions/4.2/Resources/lib/libRlapack.dylib
> 
> locale:
> [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
> 
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
> 
> loaded via a namespace (and not attached):
> [1] compiler_4.2.0 tools_4.2.0
>   >
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From @pencer@gr@ve@ @end|ng |rom prod@y@e@com  Sun May  1 23:19:32 2022
From: @pencer@gr@ve@ @end|ng |rom prod@y@e@com (Spencer Graves)
Date: Sun, 1 May 2022 16:19:32 -0500
Subject: [Rd] "with" doesn't work with names with blanks
In-Reply-To: <44e04e08-a17f-5b34-092d-5fb172dcffb1@gmail.com>
References: <a70b7e3c-8975-dd83-705b-488945bb1af0@prodsyse.com>
 <44e04e08-a17f-5b34-092d-5fb172dcffb1@gmail.com>
Message-ID: <0022828d-30c7-43eb-859d-dc77fba32b6e@prodsyse.com>



On 5/1/22 2:51 PM, Duncan Murdoch wrote:
> On 01/05/2022 3:41 p.m., Spencer Graves wrote:
>> Hello, All:
>>
>>
>> ????? Column names in a data.frame are not supposed to have trailing
>> blanks.? However, a CRAN package created one, which threw an error with
>> "with".? Consider the following example:
>>
>>
>> ? > (tst <- data.frame(1))
>> ??? X1
>> 1? 1
>> ? > names(tst) <- 'x '
>> ? > tst$x
>> [1] 1
>> ? > with(tst, x)
>> Error in eval(substitute(expr), data, enclos = parent.frame()) : 
   object 'x' not found>>
>>
>> ????? I think it's interesting that "tst$x" works, but "with(txt, x)".
>>
>>
>> ????? Comments?
> 
> tst$x works because of partial name matching.? (That leniency is one of 
> the reasons for advice to avoid using $ in programs.)? It would be chaos 
> if with() used partial name matching.
> 
> You can use
> 
> with(txt, `x `)
> 
> to include the space in the name.


but to use that, I have to KNOW that the name is `x `, not `x`.  It took 
me a while to identify that as the source of the problem:  What I saw 
was that "with(tst


	  And thanks for the reminder that you recommend avoiding use of "$".


	  sg


p.s.  After I found the problem, I fixed it using
names(x) <- tis::stripBlanks(names(x))

> 
> Duncan Murdoch
> 
>>
>>
>> ????? It's not a major problem, though it took me a while to 
>> diagnose.? (I
>> reported it to the maintainer of the package that returned a data.frame
>> with names with trailing blanks.)
>>
>>
>> ????? Thanks, for all your work in maintaining and upgrading R -- and in
>> responding to emails from this list.
>>
>>
>> ????? Spencer Graves
>>
>>
>> ? > sessionInfo()
>> R version 4.2.0 (2022-04-22)
>> Platform: x86_64-apple-darwin17.0 (64-bit)
>> Running under: macOS Big Sur 11.6.5
>>
>> Matrix products: default
>> LAPACK:
>> /Library/Frameworks/R.framework/Versions/4.2/Resources/lib/libRlapack.dylib 
>>
>>
>> locale:
>> [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
>>
>> attached base packages:
>> [1] stats???? graphics? grDevices utils???? datasets? methods?? base
>>
>> loaded via a namespace (and not attached):
>> [1] compiler_4.2.0 tools_4.2.0
>> ? >
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From bbo|ker @end|ng |rom gm@||@com  Sun May  1 23:35:25 2022
From: bbo|ker @end|ng |rom gm@||@com (Ben Bolker)
Date: Sun, 1 May 2022 17:35:25 -0400
Subject: [Rd] "with" doesn't work with names with blanks
In-Reply-To: <0022828d-30c7-43eb-859d-dc77fba32b6e@prodsyse.com>
References: <a70b7e3c-8975-dd83-705b-488945bb1af0@prodsyse.com>
 <44e04e08-a17f-5b34-092d-5fb172dcffb1@gmail.com>
 <0022828d-30c7-43eb-859d-dc77fba32b6e@prodsyse.com>
Message-ID: <CABghstTL+L0XkkMtDk-gS47hWaKpnLCR94W3VH1p73zB+WSziA@mail.gmail.com>

Think trimws() from base R would work too?

On Sun, May 1, 2022, 5:20 PM Spencer Graves <spencer.graves at prodsyse.com>
wrote:

>
>
> On 5/1/22 2:51 PM, Duncan Murdoch wrote:
> > On 01/05/2022 3:41 p.m., Spencer Graves wrote:
> >> Hello, All:
> >>
> >>
> >>       Column names in a data.frame are not supposed to have trailing
> >> blanks.  However, a CRAN package created one, which threw an error with
> >> "with".  Consider the following example:
> >>
> >>
> >>   > (tst <- data.frame(1))
> >>     X1
> >> 1  1
> >>   > names(tst) <- 'x '
> >>   > tst$x
> >> [1] 1
> >>   > with(tst, x)
> >> Error in eval(substitute(expr), data, enclos = parent.frame()) :
>    object 'x' not found>>
> >>
> >>       I think it's interesting that "tst$x" works, but "with(txt, x)".
> >>
> >>
> >>       Comments?
> >
> > tst$x works because of partial name matching.  (That leniency is one of
> > the reasons for advice to avoid using $ in programs.)  It would be chaos
> > if with() used partial name matching.
> >
> > You can use
> >
> > with(txt, `x `)
> >
> > to include the space in the name.
>
>
> but to use that, I have to KNOW that the name is `x `, not `x`.  It took
> me a while to identify that as the source of the problem:  What I saw
> was that "with(tst
>
>
>           And thanks for the reminder that you recommend avoiding use of
> "$".
>
>
>           sg
>
>
> p.s.  After I found the problem, I fixed it using
> names(x) <- tis::stripBlanks(names(x))
>
> >
> > Duncan Murdoch
> >
> >>
> >>
> >>       It's not a major problem, though it took me a while to
> >> diagnose.  (I
> >> reported it to the maintainer of the package that returned a data.frame
> >> with names with trailing blanks.)
> >>
> >>
> >>       Thanks, for all your work in maintaining and upgrading R -- and in
> >> responding to emails from this list.
> >>
> >>
> >>       Spencer Graves
> >>
> >>
> >>   > sessionInfo()
> >> R version 4.2.0 (2022-04-22)
> >> Platform: x86_64-apple-darwin17.0 (64-bit)
> >> Running under: macOS Big Sur 11.6.5
> >>
> >> Matrix products: default
> >> LAPACK:
> >>
> /Library/Frameworks/R.framework/Versions/4.2/Resources/lib/libRlapack.dylib
> >>
> >>
> >> locale:
> >> [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
> >>
> >> attached base packages:
> >> [1] stats     graphics  grDevices utils     datasets  methods   base
> >>
> >> loaded via a namespace (and not attached):
> >> [1] compiler_4.2.0 tools_4.2.0
> >>   >
> >>
> >> ______________________________________________
> >> R-devel at r-project.org mailing list
> >> https://stat.ethz.ch/mailman/listinfo/r-devel
> >
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

	[[alternative HTML version deleted]]


From @pencer@gr@ve@ @end|ng |rom prod@y@e@com  Sun May  1 23:48:05 2022
From: @pencer@gr@ve@ @end|ng |rom prod@y@e@com (Spencer Graves)
Date: Sun, 1 May 2022 16:48:05 -0500
Subject: [Rd] "with" doesn't work with names with blanks
In-Reply-To: <CABghstTL+L0XkkMtDk-gS47hWaKpnLCR94W3VH1p73zB+WSziA@mail.gmail.com>
References: <a70b7e3c-8975-dd83-705b-488945bb1af0@prodsyse.com>
 <44e04e08-a17f-5b34-092d-5fb172dcffb1@gmail.com>
 <0022828d-30c7-43eb-859d-dc77fba32b6e@prodsyse.com>
 <CABghstTL+L0XkkMtDk-gS47hWaKpnLCR94W3VH1p73zB+WSziA@mail.gmail.com>
Message-ID: <1150bbc0-93dc-0837-ebc7-1731ebee3a65@prodsyse.com>



On 5/1/22 4:35 PM, Ben Bolker wrote:
> Think trimws() from base R would work too?


Yes.  Thanks.  sg

> 
> On Sun, May 1, 2022, 5:20 PM Spencer Graves <spencer.graves at prodsyse.com 
> <mailto:spencer.graves at prodsyse.com>> wrote:
> 
> 
> 
>     On 5/1/22 2:51 PM, Duncan Murdoch wrote:
>      > On 01/05/2022 3:41 p.m., Spencer Graves wrote:
>      >> Hello, All:
>      >>
>      >>
>      >> ????? Column names in a data.frame are not supposed to have trailing
>      >> blanks.? However, a CRAN package created one, which threw an
>     error with
>      >> "with".? Consider the following example:
>      >>
>      >>
>      >> ? > (tst <- data.frame(1))
>      >> ??? X1
>      >> 1? 1
>      >> ? > names(tst) <- 'x '
>      >> ? > tst$x
>      >> [1] 1
>      >> ? > with(tst, x)
>      >> Error in eval(substitute(expr), data, enclos = parent.frame()) :
>      ? ?object 'x' not found>>
>      >>
>      >> ????? I think it's interesting that "tst$x" works, but
>     "with(txt, x)".
>      >>
>      >>
>      >> ????? Comments?
>      >
>      > tst$x works because of partial name matching.? (That leniency is
>     one of
>      > the reasons for advice to avoid using $ in programs.)? It would
>     be chaos
>      > if with() used partial name matching.
>      >
>      > You can use
>      >
>      > with(txt, `x `)
>      >
>      > to include the space in the name.
> 
> 
>     but to use that, I have to KNOW that the name is `x `, not `x`.? It
>     took
>     me a while to identify that as the source of the problem:? What I saw
>     was that "with(tst
> 
> 
>      ? ? ? ? ? And thanks for the reminder that you recommend avoiding
>     use of "$".
> 
> 
>      ? ? ? ? ? sg
> 
> 
>     p.s.? After I found the problem, I fixed it using
>     names(x) <- tis::stripBlanks(names(x))
> 
>      >
>      > Duncan Murdoch
>      >
>      >>
>      >>
>      >> ????? It's not a major problem, though it took me a while to
>      >> diagnose.? (I
>      >> reported it to the maintainer of the package that returned a
>     data.frame
>      >> with names with trailing blanks.)
>      >>
>      >>
>      >> ????? Thanks, for all your work in maintaining and upgrading R
>     -- and in
>      >> responding to emails from this list.
>      >>
>      >>
>      >> ????? Spencer Graves
>      >>
>      >>
>      >> ? > sessionInfo()
>      >> R version 4.2.0 (2022-04-22)
>      >> Platform: x86_64-apple-darwin17.0 (64-bit)
>      >> Running under: macOS Big Sur 11.6.5
>      >>
>      >> Matrix products: default
>      >> LAPACK:
>      >>
>     /Library/Frameworks/R.framework/Versions/4.2/Resources/lib/libRlapack.dylib
> 
>      >>
>      >>
>      >> locale:
>      >> [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
>      >>
>      >> attached base packages:
>      >> [1] stats???? graphics? grDevices utils???? datasets? methods?? base
>      >>
>      >> loaded via a namespace (and not attached):
>      >> [1] compiler_4.2.0 tools_4.2.0
>      >> ? >
>      >>
>      >> ______________________________________________
>      >> R-devel at r-project.org <mailto:R-devel at r-project.org> mailing list
>      >> https://stat.ethz.ch/mailman/listinfo/r-devel
>     <https://stat.ethz.ch/mailman/listinfo/r-devel>
>      >
> 
>     ______________________________________________
>     R-devel at r-project.org <mailto:R-devel at r-project.org> mailing list
>     https://stat.ethz.ch/mailman/listinfo/r-devel
>     <https://stat.ethz.ch/mailman/listinfo/r-devel>
>


From murdoch@dunc@n @end|ng |rom gm@||@com  Mon May  2 01:01:43 2022
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Sun, 1 May 2022 19:01:43 -0400
Subject: [Rd] "with" doesn't work with names with blanks
In-Reply-To: <0022828d-30c7-43eb-859d-dc77fba32b6e@prodsyse.com>
References: <a70b7e3c-8975-dd83-705b-488945bb1af0@prodsyse.com>
 <44e04e08-a17f-5b34-092d-5fb172dcffb1@gmail.com>
 <0022828d-30c7-43eb-859d-dc77fba32b6e@prodsyse.com>
Message-ID: <f96ece4e-3307-b785-e953-cd5db6252790@gmail.com>

On 01/05/2022 5:19 p.m., Spencer Graves wrote:
> 
> 
> On 5/1/22 2:51 PM, Duncan Murdoch wrote:
>> On 01/05/2022 3:41 p.m., Spencer Graves wrote:
>>> Hello, All:
>>>
>>>
>>>  ????? Column names in a data.frame are not supposed to have trailing
>>> blanks.? However, a CRAN package created one, which threw an error with
>>> "with".? Consider the following example:
>>>
>>>
>>>  ? > (tst <- data.frame(1))
>>>  ??? X1
>>> 1? 1
>>>  ? > names(tst) <- 'x '
>>>  ? > tst$x
>>> [1] 1
>>>  ? > with(tst, x)
>>> Error in eval(substitute(expr), data, enclos = parent.frame()) :
>     object 'x' not found>>
>>>
>>>  ????? I think it's interesting that "tst$x" works, but "with(txt, x)".
>>>
>>>
>>>  ????? Comments?
>>
>> tst$x works because of partial name matching.? (That leniency is one of
>> the reasons for advice to avoid using $ in programs.)? It would be chaos
>> if with() used partial name matching.
>>
>> You can use
>>
>> with(txt, `x `)
>>
>> to include the space in the name.
> 
> 
> but to use that, I have to KNOW that the name is `x `, not `x`.  It took
> me a while to identify that as the source of the problem:  What I saw
> was that "with(tst

Printing names(tst) would make it somewhat clear.  Running str(tst) 
(which is what I'd do) would hide it:

 > tst$y <- 2
 > tst$x <- 3
 > str(tst)
'data.frame':	1 obs. of  3 variables:
  $ x : num 1
  $ y : num 2
  $ x : num 3

Duncan Murdoch

> 
> 
> 	  And thanks for the reminder that you recommend avoiding use of "$".
> 
> 
> 	  sg
> 
> 
> p.s.  After I found the problem, I fixed it using
> names(x) <- tis::stripBlanks(names(x))
> 
>>
>> Duncan Murdoch
>>
>>>
>>>
>>>  ????? It's not a major problem, though it took me a while to
>>> diagnose.? (I
>>> reported it to the maintainer of the package that returned a data.frame
>>> with names with trailing blanks.)
>>>
>>>
>>>  ????? Thanks, for all your work in maintaining and upgrading R -- and in
>>> responding to emails from this list.
>>>
>>>
>>>  ????? Spencer Graves
>>>
>>>
>>>  ? > sessionInfo()
>>> R version 4.2.0 (2022-04-22)
>>> Platform: x86_64-apple-darwin17.0 (64-bit)
>>> Running under: macOS Big Sur 11.6.5
>>>
>>> Matrix products: default
>>> LAPACK:
>>> /Library/Frameworks/R.framework/Versions/4.2/Resources/lib/libRlapack.dylib
>>>
>>>
>>> locale:
>>> [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
>>>
>>> attached base packages:
>>> [1] stats???? graphics? grDevices utils???? datasets? methods?? base
>>>
>>> loaded via a namespace (and not attached):
>>> [1] compiler_4.2.0 tools_4.2.0
>>>  ? >
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>


From m@rc@we|be| @end|ng |rom en|@o-p@rtner@@com  Mon May  2 10:12:01 2022
From: m@rc@we|be| @end|ng |rom en|@o-p@rtner@@com (Marc Weibel)
Date: Mon, 2 May 2022 10:12:01 +0200
Subject: [Rd] New R version - Issue with as.vector coercion on data.frame
Message-ID: <8CF8374A-8E45-47FD-BD8A-418102EA6729@eniso-partners.com>

Hi 

I recently upgraded to the latest r version and got an issue with the command as.vector() on a data.frame object. With the previous R version the returned object was a vector but now it is formatted as a list (see below)


> futures_quotes
  SMI Future SMIM Future Euro Stoxx 50 Future S&P 500 Mini Future FTSE 100 Future Nikkei 225 Future
1      11999        2871                 3692                4150            7419             26853
> class(futures_quotes)
[1] "data.frame"

> as.vector(futures_quotes[1,1:3])
$`SMI Future`
[1] 11999

$`SMIM Future`
[1] 2871

$`Euro Stoxx 50 Future`
[1] 3692

> class(as.vector(futures_quotes[1,1:3]))
[1] "list"


Can you help me on this ? (I solved the issue temporarily with as.vector(t(futures_quotes[1,1:3])) 

Kind regards
Marc Weibel



 <http://www.enisopartners.com/>	
Dr. Marc Weibel
CIO & Partner
Tel: +41 44 286 17 02
Mob: +41 78 892 96 55
E-Mail: marc.weibel at enisopartners.com <mailto: marc.weibel at enisopartners.com>
 
Eniso Partners AG
Claridenstrasse 34 | Postfach | 8022 Z?rich
 
 <https://www.linkedin.com/in/marc-weibel-29a396/>  
Based on previous e-mail correspondence with you and/or an agreement reached with you, Eniso Partners considers itself authorized to contact you via unsecured e-mail. Warning: E-mails can involve SUBSTANTIAL RISKS, e.g. lack of confidentiality, potential manipulation of contents and/or sender's address, incorrect recipient (misdirection), viruses etc. Eniso Partners assumes no responsibility for any loss or damage resulting from the use of e-mails. Eniso Partners recommends in particular that you do NOT SEND ANY SENSITIVE INFORMATION, that you do not include details of the previous message in any reply, and that you enter e-mail address(es) manually every time you write an e-mail. Please notify Eniso Partners immediately if you received this e-mail by mistake or if you do not wish to receive any further e-mail correspondence. If you have received this e-mail by mistake, please completely delete it (and any attachments) and do not forward it or inform any other person of its contents.


	[[alternative HTML version deleted]]


From hugh@p@r@on@ge @end|ng |rom gm@||@com  Mon May  2 11:24:42 2022
From: hugh@p@r@on@ge @end|ng |rom gm@||@com (Hugh Parsonage)
Date: Mon, 2 May 2022 19:24:42 +1000
Subject: [Rd] 
 New R version - Issue with as.vector coercion on data.frame
In-Reply-To: <8CF8374A-8E45-47FD-BD8A-418102EA6729@eniso-partners.com>
References: <8CF8374A-8E45-47FD-BD8A-418102EA6729@eniso-partners.com>
Message-ID: <CAJmOi+M7RREJx9SJatd2bnwk6X15n0w_mKD7m5-5=7FtmFdvww@mail.gmail.com>

This is intended. From NEWS, a simple text search for "as.vector" reveals

> as.vector() gains a data.frame method which returns a simple named list, also clearing a long standing ?FIXME? to enable as.vector(<data.frame>, mode="list"). This breaks code relying on as.vector(<data.frame>) to return the unchanged data frame.

On Mon, 2 May 2022 at 19:19, Marc Weibel <marc.weibel at eniso-partners.com> wrote:
>
> Hi
>
> I recently upgraded to the latest r version and got an issue with the command as.vector() on a data.frame object. With the previous R version the returned object was a vector but now it is formatted as a list (see below)
>
>
> > futures_quotes
>   SMI Future SMIM Future Euro Stoxx 50 Future S&P 500 Mini Future FTSE 100 Future Nikkei 225 Future
> 1      11999        2871                 3692                4150            7419             26853
> > class(futures_quotes)
> [1] "data.frame"
>
> > as.vector(futures_quotes[1,1:3])
> $`SMI Future`
> [1] 11999
>
> $`SMIM Future`
> [1] 2871
>
> $`Euro Stoxx 50 Future`
> [1] 3692
>
> > class(as.vector(futures_quotes[1,1:3]))
> [1] "list"
>
>
> Can you help me on this ? (I solved the issue temporarily with as.vector(t(futures_quotes[1,1:3]))
>
> Kind regards
> Marc Weibel
>
>
>
>  <http://www.enisopartners.com/>
> Dr. Marc Weibel
> CIO & Partner
> Tel: +41 44 286 17 02
> Mob: +41 78 892 96 55
> E-Mail: marc.weibel at enisopartners.com <mailto: marc.weibel at enisopartners.com>
>
> Eniso Partners AG
> Claridenstrasse 34 | Postfach | 8022 Z?rich
>
>  <https://www.linkedin.com/in/marc-weibel-29a396/>
> Based on previous e-mail correspondence with you and/or an agreement reached with you, Eniso Partners considers itself authorized to contact you via unsecured e-mail. Warning: E-mails can involve SUBSTANTIAL RISKS, e.g. lack of confidentiality, potential manipulation of contents and/or sender's address, incorrect recipient (misdirection), viruses etc. Eniso Partners assumes no responsibility for any loss or damage resulting from the use of e-mails. Eniso Partners recommends in particular that you do NOT SEND ANY SENSITIVE INFORMATION, that you do not include details of the previous message in any reply, and that you enter e-mail address(es) manually every time you write an e-mail. Please notify Eniso Partners immediately if you received this e-mail by mistake or if you do not wish to receive any further e-mail correspondence. If you have received this e-mail by mistake, please completely delete it (and any attachments) and do not forward it or inform any other person of its contents.
>
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From w||||@mwdun|@p @end|ng |rom gm@||@com  Mon May  2 17:07:41 2022
From: w||||@mwdun|@p @end|ng |rom gm@||@com (Bill Dunlap)
Date: Mon, 2 May 2022 08:07:41 -0700
Subject: [Rd] 
 New R version - Issue with as.vector coercion on data.frame
In-Reply-To: <8CF8374A-8E45-47FD-BD8A-418102EA6729@eniso-partners.com>
References: <8CF8374A-8E45-47FD-BD8A-418102EA6729@eniso-partners.com>
Message-ID: <CAHqSRuRC=Kptkcp6us6MsgYy2La+b=189fat=g4Y55apaB8mSA@mail.gmail.com>

In R-4.1.2 (and before) as.vector(aDataFrame) returned aDataFrame,
unchanged.  E.g.,
  4.1.2> aDataFrame <- data.frame(X=101:103, Y=201:203, Z=301:303)
  4.1.2> attr(aDataFrame, "anAttr") <- "an attribute"
  4.1.2> identical(as.vector(aDataFrame), aDataFrame)
  [1] TRUE
  4.1.2> dput(aDataFrame)
  structure(list(X = 101:103, Y = 201:203, Z = 301:303), class =
"data.frame", row.names = c(NA, -3L), anAttr = "an attribute")

In R-4.2.0 it removes the class, names, and row.names attributes, but
leaves other stray attributes alone.  E.g.,
  4.2.0> aDataFrame <- data.frame(X=101:103, Y=201:203, Z=301:303)
  4.2.0> attr(aDataFrame, "anAttr") <- "an attribute"
  4.2.0> identical(as.vector(aDataFrame), aDataFrame)
  [1] FALSE
  4.2.0> dput(aDataFrame)
  structure(list(X = 101:103, Y = 201:203, Z = 301:303), class =
"data.frame", row.names = c(NA, -3L), anAttr = "an attribute")
  4.2.0> dput(as.vector(aDataFrame))
  structure(list(X = 101:103, Y = 201:203, Z = 301:303), anAttr = "an
attribute")

In both versions as.list(aDataFrame) returns the same thing that R-4.1.2's
as.vector(aDataFrame) did.

I think that as.vector() is a function that few people should use.   It has
almost nothing to do with with the notion of a vector in math or physics.

-Bill

On Mon, May 2, 2022 at 2:19 AM Marc Weibel <marc.weibel at eniso-partners.com>
wrote:

> Hi
>
> I recently upgraded to the latest r version and got an issue with the
> command as.vector() on a data.frame object. With the previous R version the
> returned object was a vector but now it is formatted as a list (see below)
>
>
> > futures_quotes
>   SMI Future SMIM Future Euro Stoxx 50 Future S&P 500 Mini Future FTSE 100
> Future Nikkei 225 Future
> 1      11999        2871                 3692                4150
>   7419             26853
> > class(futures_quotes)
> [1] "data.frame"
>
> > as.vector(futures_quotes[1,1:3])
> $`SMI Future`
> [1] 11999
>
> $`SMIM Future`
> [1] 2871
>
> $`Euro Stoxx 50 Future`
> [1] 3692
>
> > class(as.vector(futures_quotes[1,1:3]))
> [1] "list"
>
>
> Can you help me on this ? (I solved the issue temporarily with
> as.vector(t(futures_quotes[1,1:3]))
>
> Kind regards
> Marc Weibel
>
>
>
>  <http://www.enisopartners.com/>
> Dr. Marc Weibel
> CIO & Partner
> Tel: +41 44 286 17 02
> Mob: +41 78 892 96 55
> E-Mail: marc.weibel at enisopartners.com <mailto:
> marc.weibel at enisopartners.com>
>
> Eniso Partners AG
> Claridenstrasse 34 | Postfach | 8022 Z?rich
>
>  <https://www.linkedin.com/in/marc-weibel-29a396/>
> Based on previous e-mail correspondence with you and/or an agreement
> reached with you, Eniso Partners considers itself authorized to contact you
> via unsecured e-mail. Warning: E-mails can involve SUBSTANTIAL RISKS, e.g.
> lack of confidentiality, potential manipulation of contents and/or sender's
> address, incorrect recipient (misdirection), viruses etc. Eniso Partners
> assumes no responsibility for any loss or damage resulting from the use of
> e-mails. Eniso Partners recommends in particular that you do NOT SEND ANY
> SENSITIVE INFORMATION, that you do not include details of the previous
> message in any reply, and that you enter e-mail address(es) manually every
> time you write an e-mail. Please notify Eniso Partners immediately if you
> received this e-mail by mistake or if you do not wish to receive any
> further e-mail correspondence. If you have received this e-mail by mistake,
> please completely delete it (and any attachments) and do not forward it or
> inform any other person of its contents.
>
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

	[[alternative HTML version deleted]]


From w||||@mwdun|@p @end|ng |rom gm@||@com  Mon May  2 17:33:58 2022
From: w||||@mwdun|@p @end|ng |rom gm@||@com (Bill Dunlap)
Date: Mon, 2 May 2022 08:33:58 -0700
Subject: [Rd] 
 New R version - Issue with as.vector coercion on data.frame
In-Reply-To: <CAHqSRuRC=Kptkcp6us6MsgYy2La+b=189fat=g4Y55apaB8mSA@mail.gmail.com>
References: <8CF8374A-8E45-47FD-BD8A-418102EA6729@eniso-partners.com>
 <CAHqSRuRC=Kptkcp6us6MsgYy2La+b=189fat=g4Y55apaB8mSA@mail.gmail.com>
Message-ID: <CAHqSRuRiWWfFxY-rOa6LM7brHRaH5dEkToVnOy=L-wM_0xk=Wg@mail.gmail.com>

> In both versions as.list(aDataFrame) returns the same thing that
R-4.1.2's as.vector(aDataFrame) did.

I sent this too quickly.  I meant to say that as.list(aDataFrame) did the
same in both versions.  Since as.vector(aDataFrame) in 4.1.2 did nothing,
you can just drop that line from your code.

-Bill

On Mon, May 2, 2022 at 8:07 AM Bill Dunlap <williamwdunlap at gmail.com> wrote:

> In R-4.1.2 (and before) as.vector(aDataFrame) returned aDataFrame,
> unchanged.  E.g.,
>   4.1.2> aDataFrame <- data.frame(X=101:103, Y=201:203, Z=301:303)
>   4.1.2> attr(aDataFrame, "anAttr") <- "an attribute"
>   4.1.2> identical(as.vector(aDataFrame), aDataFrame)
>   [1] TRUE
>   4.1.2> dput(aDataFrame)
>   structure(list(X = 101:103, Y = 201:203, Z = 301:303), class =
> "data.frame", row.names = c(NA, -3L), anAttr = "an attribute")
>
> In R-4.2.0 it removes the class, names, and row.names attributes, but
> leaves other stray attributes alone.  E.g.,
>   4.2.0> aDataFrame <- data.frame(X=101:103, Y=201:203, Z=301:303)
>   4.2.0> attr(aDataFrame, "anAttr") <- "an attribute"
>   4.2.0> identical(as.vector(aDataFrame), aDataFrame)
>   [1] FALSE
>   4.2.0> dput(aDataFrame)
>   structure(list(X = 101:103, Y = 201:203, Z = 301:303), class =
> "data.frame", row.names = c(NA, -3L), anAttr = "an attribute")
>   4.2.0> dput(as.vector(aDataFrame))
>   structure(list(X = 101:103, Y = 201:203, Z = 301:303), anAttr = "an
> attribute")
>
> In both versions as.list(aDataFrame) returns the same thing that R-4.1.2's
> as.vector(aDataFrame) did.
>
> I think that as.vector() is a function that few people should use.   It
> has almost nothing to do with with the notion of a vector in math or
> physics.
>
> -Bill
>
> On Mon, May 2, 2022 at 2:19 AM Marc Weibel <marc.weibel at eniso-partners.com>
> wrote:
>
>> Hi
>>
>> I recently upgraded to the latest r version and got an issue with the
>> command as.vector() on a data.frame object. With the previous R version the
>> returned object was a vector but now it is formatted as a list (see below)
>>
>>
>> > futures_quotes
>>   SMI Future SMIM Future Euro Stoxx 50 Future S&P 500 Mini Future FTSE
>> 100 Future Nikkei 225 Future
>> 1      11999        2871                 3692                4150
>>     7419             26853
>> > class(futures_quotes)
>> [1] "data.frame"
>>
>> > as.vector(futures_quotes[1,1:3])
>> $`SMI Future`
>> [1] 11999
>>
>> $`SMIM Future`
>> [1] 2871
>>
>> $`Euro Stoxx 50 Future`
>> [1] 3692
>>
>> > class(as.vector(futures_quotes[1,1:3]))
>> [1] "list"
>>
>>
>> Can you help me on this ? (I solved the issue temporarily with
>> as.vector(t(futures_quotes[1,1:3]))
>>
>> Kind regards
>> Marc Weibel
>>
>>
>>
>>  <http://www.enisopartners.com/>
>> Dr. Marc Weibel
>> CIO & Partner
>> Tel: +41 44 286 17 02
>> Mob: +41 78 892 96 55
>> E-Mail: marc.weibel at enisopartners.com <mailto:
>> marc.weibel at enisopartners.com>
>>
>> Eniso Partners AG
>> Claridenstrasse 34 | Postfach | 8022 Z?rich
>>
>>  <https://www.linkedin.com/in/marc-weibel-29a396/>
>> Based on previous e-mail correspondence with you and/or an agreement
>> reached with you, Eniso Partners considers itself authorized to contact you
>> via unsecured e-mail. Warning: E-mails can involve SUBSTANTIAL RISKS, e.g.
>> lack of confidentiality, potential manipulation of contents and/or sender's
>> address, incorrect recipient (misdirection), viruses etc. Eniso Partners
>> assumes no responsibility for any loss or damage resulting from the use of
>> e-mails. Eniso Partners recommends in particular that you do NOT SEND ANY
>> SENSITIVE INFORMATION, that you do not include details of the previous
>> message in any reply, and that you enter e-mail address(es) manually every
>> time you write an e-mail. Please notify Eniso Partners immediately if you
>> received this e-mail by mistake or if you do not wish to receive any
>> further e-mail correspondence. If you have received this e-mail by mistake,
>> please completely delete it (and any attachments) and do not forward it or
>> inform any other person of its contents.
>>
>>
>>         [[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>

	[[alternative HTML version deleted]]


From edd @end|ng |rom deb|@n@org  Tue May  3 13:54:06 2022
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Tue, 3 May 2022 06:54:06 -0500
Subject: [Rd] R-devel tarball at ETH is zero
Message-ID: <25201.6110.67859.3480@rob.eddelbuettel.com>


Dear Martin as our trusted ETH point person,

I have some automated builders fall over as the tarball of R-devel is
currently empty:


edd at rob:/tmp$ wget https://stat.ethz.ch/R/daily/R-devel.tar.bz2
--2022-05-03 06:52:20--  https://stat.ethz.ch/R/daily/R-devel.tar.bz2
Resolving stat.ethz.ch (stat.ethz.ch)... 129.132.119.195
Connecting to stat.ethz.ch (stat.ethz.ch)|129.132.119.195|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 0 [application/x-bzip2]
Saving to: ?R-devel.tar.bz2?

R-devel.tar.bz2         [ <=>                ]       0  --.-KB/s    in 0s      

2022-05-03 06:52:21 (0.00 B/s) - ?R-devel.tar.bz2? saved [0/0]

edd at rob:/tmp$ ls -l R-devel.tar.bz2 
-rw-rw-r-- 1 edd edd 0 May  2 19:07 R-devel.tar.bz2
edd at rob:/tmp$ 


Can you please take a look / contact the right person, or let us know if we
should switch to svn (or git mirror) checkouts.

Many thanks,  Dirk


-- 
dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From pd@|gd @end|ng |rom gm@||@com  Tue May  3 14:11:14 2022
From: pd@|gd @end|ng |rom gm@||@com (peter dalgaard)
Date: Tue, 3 May 2022 14:11:14 +0200
Subject: [Rd] R-devel tarball at ETH is zero
In-Reply-To: <25201.6110.67859.3480@rob.eddelbuettel.com>
References: <25201.6110.67859.3480@rob.eddelbuettel.com>
Message-ID: <2F83E333-147C-44A9-BF96-2AE2667A8EF6@gmail.com>

FWIW, the tarballs in 

https://cran.r-project.org/src/base-prerelease/

seem ok at this point.

(We usually prefer that you use one of the two tarball sources over svn/git because "make dist" issues otherwise can go unnoticed.)

-pd 

> On 3 May 2022, at 13:54 , Dirk Eddelbuettel <edd at debian.org> wrote:
> 
> 
> Dear Martin as our trusted ETH point person,
> 
> I have some automated builders fall over as the tarball of R-devel is
> currently empty:
> 
> 
> edd at rob:/tmp$ wget https://stat.ethz.ch/R/daily/R-devel.tar.bz2
> --2022-05-03 06:52:20--  https://stat.ethz.ch/R/daily/R-devel.tar.bz2
> Resolving stat.ethz.ch (stat.ethz.ch)... 129.132.119.195
> Connecting to stat.ethz.ch (stat.ethz.ch)|129.132.119.195|:443... connected.
> HTTP request sent, awaiting response... 200 OK
> Length: 0 [application/x-bzip2]
> Saving to: ?R-devel.tar.bz2?
> 
> R-devel.tar.bz2         [ <=>                ]       0  --.-KB/s    in 0s      
> 
> 2022-05-03 06:52:21 (0.00 B/s) - ?R-devel.tar.bz2? saved [0/0]
> 
> edd at rob:/tmp$ ls -l R-devel.tar.bz2 
> -rw-rw-r-- 1 edd edd 0 May  2 19:07 R-devel.tar.bz2
> edd at rob:/tmp$ 
> 
> 
> Can you please take a look / contact the right person, or let us know if we
> should switch to svn (or git mirror) checkouts.
> 
> Many thanks,  Dirk
> 
> 
> -- 
> dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Peter Dalgaard, Professor,
Center for Statistics, Copenhagen Business School
Solbjerg Plads 3, 2000 Frederiksberg, Denmark
Phone: (+45)38153501
Office: A 4.23
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From m@ech|er @end|ng |rom @t@t@m@th@ethz@ch  Wed May  4 11:32:24 2022
From: m@ech|er @end|ng |rom @t@t@m@th@ethz@ch (Martin Maechler)
Date: Wed, 4 May 2022 11:32:24 +0200
Subject: [Rd] R-devel tarball at ETH is zero
In-Reply-To: <2F83E333-147C-44A9-BF96-2AE2667A8EF6@gmail.com>
References: <25201.6110.67859.3480@rob.eddelbuettel.com>
 <2F83E333-147C-44A9-BF96-2AE2667A8EF6@gmail.com>
Message-ID: <25202.18472.82724.713807@stat.math.ethz.ch>

>>>>> peter dalgaard 
>>>>>     on Tue, 3 May 2022 14:11:14 +0200 writes:

    > FWIW, the tarballs in 
    > https://cran.r-project.org/src/base-prerelease/

    > seem ok at this point.

    > (We usually prefer that you use one of the two tarball sources over svn/git because "make dist" issues otherwise can go unnoticed.)

    > -pd 

    >> On 3 May 2022, at 13:54 , Dirk Eddelbuettel <edd at debian.org> wrote:
    >> 
    >> 
    >> Dear Martin as our trusted ETH point person,
    >> 
    >> I have some automated builders fall over as the tarball of R-devel is
    >> currently empty:
    >> 
    >> 
    >> edd at rob:/tmp$ wget https://stat.ethz.ch/R/daily/R-devel.tar.bz2
    >> --2022-05-03 06:52:20--  https://stat.ethz.ch/R/daily/R-devel.tar.bz2
    >> Resolving stat.ethz.ch (stat.ethz.ch)... 129.132.119.195
    >> Connecting to stat.ethz.ch (stat.ethz.ch)|129.132.119.195|:443... connected.
    >> HTTP request sent, awaiting response... 200 OK
    >> Length: 0 [application/x-bzip2]
    >> Saving to: ?R-devel.tar.bz2?
    >> 
    >> R-devel.tar.bz2         [ <=>                ]       0  --.-KB/s    in 0s      
    >> 
    >> 2022-05-03 06:52:21 (0.00 B/s) - ?R-devel.tar.bz2? saved [0/0]
    >> 
    >> edd at rob:/tmp$ ls -l R-devel.tar.bz2 
    >> -rw-rw-r-- 1 edd edd 0 May  2 19:07 R-devel.tar.bz2

I'm really sorry for this experience.

We are also a CRAN mirror, and this came after release of R
4.2.0 with its new 'binary' (sub)directories for Windows and 2
versions of macOS:  The necessary disk space  increased again
*AND*  for some reason the "supervisor" process which alerts
about "disk quota soon to be reached"  had stopped working  ---
for reasons yet unknown which our IT staff is investigating,
hence disk quota had been badly violated .. and even moving away
less important stuff (me, last evening, spending an hour in vain)
would not help to get below the limit..

When the disk quota was finally raised early this morning, I subsequently
manually started the process creating the tar balls etc (which
otherwise runs in 2 different versions 3x/day via cron
daemon)... and so tar balls should be back to normal for ca. 3
hours now.

Best regards,
Martin


From edd @end|ng |rom deb|@n@org  Wed May  4 13:54:14 2022
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Wed, 4 May 2022 06:54:14 -0500
Subject: [Rd] R-devel tarball at ETH is zero
In-Reply-To: <25202.18472.82724.713807@stat.math.ethz.ch>
References: <25201.6110.67859.3480@rob.eddelbuettel.com>
 <2F83E333-147C-44A9-BF96-2AE2667A8EF6@gmail.com>
 <25202.18472.82724.713807@stat.math.ethz.ch>
Message-ID: <25202.26982.610527.832341@rob.eddelbuettel.com>


On 4 May 2022 at 11:32, Martin Maechler wrote:
| I'm really sorry for this experience.

Stuff happens -- thanks for fixing it.

The weekly build for the rocker/drd container of r-devel (and r-patched)
worked fine now that you restored the mirror, so big thanks!

Dirk

-- 
dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From m@ech|er @end|ng |rom @t@t@m@th@ethz@ch  Thu May  5 16:08:33 2022
From: m@ech|er @end|ng |rom @t@t@m@th@ethz@ch (Martin Maechler)
Date: Thu, 5 May 2022 16:08:33 +0200
Subject: [Rd] 
 New R version - Issue with as.vector coercion on data.frame
In-Reply-To: <CAHqSRuRC=Kptkcp6us6MsgYy2La+b=189fat=g4Y55apaB8mSA@mail.gmail.com>
References: <8CF8374A-8E45-47FD-BD8A-418102EA6729@eniso-partners.com>
 <CAHqSRuRC=Kptkcp6us6MsgYy2La+b=189fat=g4Y55apaB8mSA@mail.gmail.com>
Message-ID: <25203.55905.107203.132628@stat.math.ethz.ch>

>>>>> Bill Dunlap 
>>>>>     on Mon, 2 May 2022 08:07:41 -0700 writes:

    > In R-4.1.2 (and before) as.vector(aDataFrame) returned aDataFrame,
    > unchanged.  E.g.,
    4.1.2> aDataFrame <- data.frame(X=101:103, Y=201:203, Z=301:303)
    4.1.2> attr(aDataFrame, "anAttr") <- "an attribute"
    4.1.2> identical(as.vector(aDataFrame), aDataFrame)
    > [1] TRUE
    4.1.2> dput(aDataFrame)
    > structure(list(X = 101:103, Y = 201:203, Z = 301:303), class =
    > "data.frame", row.names = c(NA, -3L), anAttr = "an attribute")

    > In R-4.2.0 it

is based on the already existing  as.list.data.frame() which

    > removes the class, names, and row.names attributes, but
    > leaves other stray attributes alone.  E.g.,
    4.2.0> aDataFrame <- data.frame(X=101:103, Y=201:203, Z=301:303)
    4.2.0> attr(aDataFrame, "anAttr") <- "an attribute"
    4.2.0> identical(as.vector(aDataFrame), aDataFrame)
    > [1] FALSE
    4.2.0> dput(aDataFrame)
    > structure(list(X = 101:103, Y = 201:203, Z = 301:303), class =
    > "data.frame", row.names = c(NA, -3L), anAttr = "an attribute")
    4.2.0> dput(as.vector(aDataFrame))
    > structure(list(X = 101:103, Y = 201:203, Z = 301:303), anAttr = "an
    > attribute")

Yes, this was a somewhat "hard" change in an effort to slightly
improve the still unsatisfactory behavior of  as.vector() and is.vector().
and it solved a very long standing FIXME / TODO which wanted
that

   as.vector(df, mode = "list")    should be the same as
   as.list  (df)


   [....]

    > I think that as.vector() is a function that few people should use.   It has
    > almost nothing to do with with the notion of a vector in math or physics.

I tend to agree on that.

The confusion comes from the fact that in R (and S before it, no?)
a list() or an expression() are also a 'vector'  {a generalized one},

but that math/physics/... term of a "vector" is what is an
"atomic vector" in R.

Note that we also ventured into a relatively time confusing effort
to do more about the  as.vector()  <-->  is.vector()  decrepancies.

One step towards that I'd like to take up again --- and was in
the mean time helped by some package maintainers who adapted
their code --- is to make  is.atomic(.)  truly a test for the
above "atomic vector"s.
It currently is *not*, as   is.atomic(NULL)   is TRUE,
but NULL is really not an atomic vector.

So our plan has been that is.atomic(NULL) should become FALSE, so
programmeRs could use is.atomic() checks before using
as.vector(),  which would bring them back to the traditional
realm of 1st semester math where your vector spaces are
typically R^n (or C^n ..)

Martin


    > -Bill

    > On Mon, May 2, 2022 at 2:19 AM Marc Weibel <marc.weibel at eniso-partners.com>
    > wrote:

    >> Hi
    >> 
    >> I recently upgraded to the latest r version and got an issue with the
    >> command as.vector() on a data.frame object. With the previous R version the
    >> returned object was a vector but now it is formatted as a list (see below)
    >> 
    >> 
    >> > futures_quotes
    >> SMI Future SMIM Future Euro Stoxx 50 Future S&P 500 Mini Future FTSE 100
    >> Future Nikkei 225 Future
    >> 1      11999        2871                 3692                4150
    >> 7419             26853
    >> > class(futures_quotes)
    >> [1] "data.frame"
    >> 
    >> > as.vector(futures_quotes[1,1:3])
    >> $`SMI Future`
    >> [1] 11999
    >> 
    >> $`SMIM Future`
    >> [1] 2871
    >> 
    >> $`Euro Stoxx 50 Future`
    >> [1] 3692
    >> 
    >> > class(as.vector(futures_quotes[1,1:3]))
    >> [1] "list"
    >> 
    >> 
    >> Can you help me on this ? (I solved the issue temporarily with
    >> as.vector(t(futures_quotes[1,1:3]))
    >> 
    >> Kind regards
    >> Marc Weibel
    >> 
    >> 
    >> <http://www.enisopartners.com/>
    >> Dr. Marc Weibel
    >> CIO & Partner
    >> Tel: +41 44 286 17 02
    >> Mob: +41 78 892 96 55
    >> E-Mail: marc.weibel at enisopartners.com <mailto:
    >> marc.weibel at enisopartners.com>
    >> 
    >> Eniso Partners AG
    >> Claridenstrasse 34 | Postfach | 8022 Z?rich
    >> 
    >> <https://www.linkedin.com/in/marc-weibel-29a396/>


From jo@ec|@ud|o@|@r|@ @end|ng |rom gm@||@com  Thu May  5 17:17:13 2022
From: jo@ec|@ud|o@|@r|@ @end|ng |rom gm@||@com (jcfaria)
Date: Thu, 05 May 2022 15:17:13 +0000
Subject: [Rd] Rgui.exe 4.2.0 does not receive characters via the Windows
 API's PostMessage function
Message-ID: <em26d64aef-2f66-415f-be9d-ae71a91c1d56@dell>

Hello,

Rgui.exe 4.2.0 does not receive characters via the Windows API's 
PostMessage function.

The Tinn-R project sends messages to Rgui.exe (SDI mode) via the Windows 
API's PostMessage function.
A simplification of the code (in object Pascal) can be seen below.

procedure TfMain.btnPasteClick(Sender: TObject);
var
   i: integer;
   sTmp: WideString;
   hBN: HWND;

begin
   hBN:= FindWindowA(nil,
                     'R Console (64-bit)');

   sTmp:= 'sd';

   for i:= 1 to Length(sTmp) do begin
     PostMessage(hBN,
                 WM_CHAR,
                 Ord(sTmp[i]),
                 0);
   end;

   PostMessage(hBN,
               WM_KEYDOWN,
               VK_RETURN, 0);
end;

This code has always worked fine for all versions of Rgui.exe with the 
exception of the last one released, ie 4.2.0.

We've been trying to get around the problem on the Object Pascal side, 
but without success so far.

Does anyone connected to the compilation of Rqui.exe know what the 
problem is?

Best,
///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\
Jose Claudio Faria
UESC/DCET/Brasil
joseclaudio.faria at gmail.com
Telefones:
55(73)3680.5545 - UESC
55(73)99966.9100 - VIVO
///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\
If you have software to deal with statistics, you have arms,
if you have good software, you have arms and legs,
if you have software like R, you have arms, legs and wings...
the height of your flight depends only on you.

	[[alternative HTML version deleted]]


From murdoch@dunc@n @end|ng |rom gm@||@com  Thu May  5 18:17:53 2022
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Thu, 5 May 2022 12:17:53 -0400
Subject: [Rd] Rgui.exe 4.2.0 does not receive characters via the Windows
 API's PostMessage function
In-Reply-To: <em26d64aef-2f66-415f-be9d-ae71a91c1d56@dell>
References: <em26d64aef-2f66-415f-be9d-ae71a91c1d56@dell>
Message-ID: <8e41c7bc-466c-ca00-6141-66520f8818b8@gmail.com>

On 05/05/2022 11:17 a.m., jcfaria wrote:
> Hello,
> 
> Rgui.exe 4.2.0 does not receive characters via the Windows API's
> PostMessage function.
> 
> The Tinn-R project sends messages to Rgui.exe (SDI mode) via the Windows
> API's PostMessage function.
> A simplification of the code (in object Pascal) can be seen below.
> 
> procedure TfMain.btnPasteClick(Sender: TObject);
> var
>     i: integer;
>     sTmp: WideString;
>     hBN: HWND;
> 
> begin
>     hBN:= FindWindowA(nil,
>                       'R Console (64-bit)');
> 
>     sTmp:= 'sd';
> 
>     for i:= 1 to Length(sTmp) do begin
>       PostMessage(hBN,
>                   WM_CHAR,
>                   Ord(sTmp[i]),
>                   0);
>     end;
> 
>     PostMessage(hBN,
>                 WM_KEYDOWN,
>                 VK_RETURN, 0);
> end;
> 
> This code has always worked fine for all versions of Rgui.exe with the
> exception of the last one released, ie 4.2.0.
> 
> We've been trying to get around the problem on the Object Pascal side,
> but without success so far.
> 
> Does anyone connected to the compilation of Rqui.exe know what the
> problem is?

It could be that the new build enforces Windows security more 
stringently.  More details are described in the answer to this question: 
  https://stackoverflow.com/a/40139498/2554330, but at a minimum you 
should be checking the return value from PostMessage.

Duncan Murdoch

> 
> Best,
> ///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\
> Jose Claudio Faria
> UESC/DCET/Brasil
> joseclaudio.faria at gmail.com
> Telefones:
> 55(73)3680.5545 - UESC
> 55(73)99966.9100 - VIVO
> ///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\
> If you have software to deal with statistics, you have arms,
> if you have good software, you have arms and legs,
> if you have software like R, you have arms, legs and wings...
> the height of your flight depends only on you.
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From jo@ec|@ud|o@|@r|@ @end|ng |rom gm@||@com  Fri May  6 07:03:31 2022
From: jo@ec|@ud|o@|@r|@ @end|ng |rom gm@||@com (jcfaria)
Date: Fri, 06 May 2022 05:03:31 +0000
Subject: [Rd] Rgui.exe 4.2.0 does not receive characters via the Windows
 API's PostMessage function
In-Reply-To: <8e41c7bc-466c-ca00-6141-66520f8818b8@gmail.com>
References: <em26d64aef-2f66-415f-be9d-ae71a91c1d56@dell>
 <8e41c7bc-466c-ca00-6141-66520f8818b8@gmail.com>
Message-ID: <em8cb2eaf6-27fe-4d26-84b2-3eef11fa9530@dell>

Dear Duncan,
I believe the problem is of a different nature.
I get TRUE 3 times running the code below:

procedure TfMain.btnPasteClick(Sender: TObject);
var
   i: integer;
   sTmp: string;
   hBN: HWND;
   j: bool;

begin
   hBN:= FindWindowA(nil,
                     'R Console (64-bit)');

   sTmp:= 'sd';

   for i:= 1 to Length(sTmp) do begin
     j:= PostMessage(hBN,
                     WM_CHAR,
                     Ord(sTmp[i]),
                     0);

     ShowMessage(BoolToStr(j,
                           True));
   end;

   j:= PostMessage(hBN,
               WM_KEYDOWN,
               VK_RETURN, 0);

   ShowMessage(BoolToStr(j,
                         True));
end;

That is, Rgui is receiving the message of the characters (via 
PostMessage), but it is blocking because it does not show them in the 
console.
The only thing Rgui blames is Carriage Return, as it adds an additional 
prompt with each run.

 >
 >

Best,
///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\
Jose Claudio Faria
UESC/DCET/Brasil
joseclaudio.faria at gmail.com
Telefones:
55(73)3680.5545 - UESC
55(73)99966.9100 - VIVO
///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\
If you have software to deal with statistics, you have arms,
if you have good software, you have arms and legs,
if you have software like R, you have arms, legs and wings...
the height of your flight depends only on you.

------ Mensagem original ------
De: "Duncan Murdoch" <murdoch.duncan at gmail.com>
Para: "jcfaria" <joseclaudio.faria at gmail.com>; r-devel at r-project.org
Enviado(s): 05/05/2022 13:17:53
Assunto: Re: [Rd] Rgui.exe 4.2.0 does not receive characters via the 
Windows API's PostMessage function

>On 05/05/2022 11:17 a.m., jcfaria wrote:
>>Hello,
>>
>>Rgui.exe 4.2.0 does not receive characters via the Windows API's
>>PostMessage function.
>>
>>The Tinn-R project sends messages to Rgui.exe (SDI mode) via the Windows
>>API's PostMessage function.
>>A simplification of the code (in object Pascal) can be seen below.
>>
>>procedure TfMain.btnPasteClick(Sender: TObject);
>>var
>>     i: integer;
>>     sTmp: WideString;
>>     hBN: HWND;
>>
>>begin
>>     hBN:= FindWindowA(nil,
>>                       'R Console (64-bit)');
>>
>>     sTmp:= 'sd';
>>
>>     for i:= 1 to Length(sTmp) do begin
>>       PostMessage(hBN,
>>                   WM_CHAR,
>>                   Ord(sTmp[i]),
>>                   0);
>>     end;
>>
>>     PostMessage(hBN,
>>                 WM_KEYDOWN,
>>                 VK_RETURN, 0);
>>end;
>>
>>This code has always worked fine for all versions of Rgui.exe with the
>>exception of the last one released, ie 4.2.0.
>>
>>We've been trying to get around the problem on the Object Pascal side,
>>but without success so far.
>>
>>Does anyone connected to the compilation of Rqui.exe know what the
>>problem is?
>
>It could be that the new build enforces Windows security more stringently.  More details are described in the answer to this question:  https://stackoverflow.com/a/40139498/2554330, but at a minimum you should be checking the return value from PostMessage.
>
>Duncan Murdoch
>
>>
>>Best,
>>///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\
>>Jose Claudio Faria
>>UESC/DCET/Brasil
>>joseclaudio.faria at gmail.com
>>Telefones:
>>55(73)3680.5545 - UESC
>>55(73)99966.9100 - VIVO
>>///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\
>>If you have software to deal with statistics, you have arms,
>>if you have good software, you have arms and legs,
>>if you have software like R, you have arms, legs and wings...
>>the height of your flight depends only on you.
>>
>>	[[alternative HTML version deleted]]
>>
>>______________________________________________
>>R-devel at r-project.org mailing list
>>https://stat.ethz.ch/mailman/listinfo/r-devel
>


From tom@@@k@||ber@ @end|ng |rom gm@||@com  Fri May  6 09:24:44 2022
From: tom@@@k@||ber@ @end|ng |rom gm@||@com (Tomas Kalibera)
Date: Fri, 6 May 2022 09:24:44 +0200
Subject: [Rd] Rgui.exe 4.2.0 does not receive characters via the Windows
 API's PostMessage function
In-Reply-To: <em8cb2eaf6-27fe-4d26-84b2-3eef11fa9530@dell>
References: <em26d64aef-2f66-415f-be9d-ae71a91c1d56@dell>
 <8e41c7bc-466c-ca00-6141-66520f8818b8@gmail.com>
 <em8cb2eaf6-27fe-4d26-84b2-3eef11fa9530@dell>
Message-ID: <5e580ff4-ac60-6b79-e0d7-f9a84ee200d7@gmail.com>


On 5/6/22 07:03, jcfaria wrote:
> Dear Duncan,
> I believe the problem is of a different nature.
> I get TRUE 3 times running the code below:
>
> procedure TfMain.btnPasteClick(Sender: TObject);
> var
> ? i: integer;
> ? sTmp: string;
> ? hBN: HWND;
> ? j: bool;
>
> begin
> ? hBN:= FindWindowA(nil,
> ??????????????????? 'R Console (64-bit)');
>
> ? sTmp:= 'sd';
>
> ? for i:= 1 to Length(sTmp) do begin
> ??? j:= PostMessage(hBN,
> ??????????????????? WM_CHAR,
> ??????????????????? Ord(sTmp[i]),
> ??????????????????? 0);
>
> ??? ShowMessage(BoolToStr(j,
> ????????????????????????? True));
> ? end;
>
> ? j:= PostMessage(hBN,
> ????????????? WM_KEYDOWN,
> ????????????? VK_RETURN, 0);
>
> ? ShowMessage(BoolToStr(j,
> ??????????????????????? True));
> end;
>
> That is, Rgui is receiving the message of the characters (via 
> PostMessage), but it is blocking because it does not show them in the 
> console.
> The only thing Rgui blames is Carriage Return, as it adds an 
> additional prompt with each run.

I can't provide a good guess what impacted your use, but if you could 
give me a full example, ideally in C, which can be compiled with 
Rtools42 (so gcc, MinGW) and I can edit/recompile, and works with R 4.1, 
I am happy to help debugging on 4.2.

Rgui now uses GraphApp Unicode windows on systems where it didn't 
before, because it uses UTF-8 also on systems it didn't before (on 
systems that would use a single-byte locale in R 4.1). These Unicode 
windows are a different code path and there may be bugs not reported 
previously, including processing inputs (recently I fixed handling of 
accents, for example). Otherwise indeed R now uses UTF-8 as native 
encoding and UCRT as the C runtime.

Best
Tomas


>
> >
> >
>
> Best,
> ///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\
> Jose Claudio Faria
> UESC/DCET/Brasil
> joseclaudio.faria at gmail.com
> Telefones:
> 55(73)3680.5545 - UESC
> 55(73)99966.9100 - VIVO
> ///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\
> If you have software to deal with statistics, you have arms,
> if you have good software, you have arms and legs,
> if you have software like R, you have arms, legs and wings...
> the height of your flight depends only on you.
>
> ------ Mensagem original ------
> De: "Duncan Murdoch" <murdoch.duncan at gmail.com>
> Para: "jcfaria" <joseclaudio.faria at gmail.com>; r-devel at r-project.org
> Enviado(s): 05/05/2022 13:17:53
> Assunto: Re: [Rd] Rgui.exe 4.2.0 does not receive characters via the 
> Windows API's PostMessage function
>
>> On 05/05/2022 11:17 a.m., jcfaria wrote:
>>> Hello,
>>>
>>> Rgui.exe 4.2.0 does not receive characters via the Windows API's
>>> PostMessage function.
>>>
>>> The Tinn-R project sends messages to Rgui.exe (SDI mode) via the 
>>> Windows
>>> API's PostMessage function.
>>> A simplification of the code (in object Pascal) can be seen below.
>>>
>>> procedure TfMain.btnPasteClick(Sender: TObject);
>>> var
>>> ??? i: integer;
>>> ??? sTmp: WideString;
>>> ??? hBN: HWND;
>>>
>>> begin
>>> ??? hBN:= FindWindowA(nil,
>>> ????????????????????? 'R Console (64-bit)');
>>>
>>> ??? sTmp:= 'sd';
>>>
>>> ??? for i:= 1 to Length(sTmp) do begin
>>> ????? PostMessage(hBN,
>>> ????????????????? WM_CHAR,
>>> ????????????????? Ord(sTmp[i]),
>>> ????????????????? 0);
>>> ??? end;
>>>
>>> ??? PostMessage(hBN,
>>> ??????????????? WM_KEYDOWN,
>>> ??????????????? VK_RETURN, 0);
>>> end;
>>>
>>> This code has always worked fine for all versions of Rgui.exe with the
>>> exception of the last one released, ie 4.2.0.
>>>
>>> We've been trying to get around the problem on the Object Pascal side,
>>> but without success so far.
>>>
>>> Does anyone connected to the compilation of Rqui.exe know what the
>>> problem is?
>>
>> It could be that the new build enforces Windows security more 
>> stringently.? More details are described in the answer to this 
>> question:? https://stackoverflow.com/a/40139498/2554330, but at a 
>> minimum you should be checking the return value from PostMessage.
>>
>> Duncan Murdoch
>>
>>>
>>> Best,
>>> ///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\
>>> Jose Claudio Faria
>>> UESC/DCET/Brasil
>>> joseclaudio.faria at gmail.com
>>> Telefones:
>>> 55(73)3680.5545 - UESC
>>> 55(73)99966.9100 - VIVO
>>> ///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\
>>> If you have software to deal with statistics, you have arms,
>>> if you have good software, you have arms and legs,
>>> if you have software like R, you have arms, legs and wings...
>>> the height of your flight depends only on you.
>>>
>>> ????[[alternative HTML version deleted]]
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From cvoeten @end|ng |rom gm@||@com  Sat May  7 15:14:08 2022
From: cvoeten @end|ng |rom gm@||@com (Cesko Voeten)
Date: Sat, 7 May 2022 15:14:08 +0200
Subject: [Rd] Regression in 4.2.0: unable to type special characters in
 Windows RGui
Message-ID: <027b1c8f-c479-e269-4824-2c1ff0507e4a@gmail.com>

Hi,

Since upgrading to 4.2.0, I can't type special characters in RGui anymore. Specifically affected are at least "'~^ which, on my US-International keyboard layout, all rely on dead keys. This was not a problem in R <= 4.1.3, although I can't say whether the reason is any change in R itself, or the fact that 4.2.0 is the first version built against ucrt. OS is an up-to-date Windows 10, language is Dutch. I tried toggling the 'experimental' Unicode support in Windows's Country & Region settings, but it makes no difference. Is this a known regression?

Cesko Voeten


From m|ch@|2992 @end|ng |rom gm@||@com  Sun May  8 19:12:46 2022
From: m|ch@|2992 @end|ng |rom gm@||@com (=?UTF-8?Q?Micha=C5=82_Bojanowski?=)
Date: Sun, 8 May 2022 19:12:46 +0200
Subject: [Rd] Typo in Renviron.site in R 4.2.0 on Ubuntu?
Message-ID: <CAByPayEf3L4N0JaNYTs6JUQ42vmhTNKCKWWf6+-3bd1CKx5jMA@mail.gmail.com>

Hi,

I installed R 4.2.0 on Ubuntu (from CRAN apt repository) and some
startup errors lead me to Renviron.site and it's last line:

R_LIBS_SITE="/usr/local/lib/R/site-library/:${R_LIBS_SITE}:/usr/lib/R/library'"

Note the unmatched single quote just before the closing double quote.
That's a typo, is it not?

~Michal


From edd @end|ng |rom deb|@n@org  Sun May  8 19:34:55 2022
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Sun, 8 May 2022 12:34:55 -0500
Subject: [Rd] Typo in Renviron.site in R 4.2.0 on Ubuntu?
In-Reply-To: <CAByPayEf3L4N0JaNYTs6JUQ42vmhTNKCKWWf6+-3bd1CKx5jMA@mail.gmail.com>
References: <CAByPayEf3L4N0JaNYTs6JUQ42vmhTNKCKWWf6+-3bd1CKx5jMA@mail.gmail.com>
Message-ID: <25207.65343.393792.303403@rob.eddelbuettel.com>


On 8 May 2022 at 19:12, Micha? Bojanowski wrote:
| I installed R 4.2.0 on Ubuntu (from CRAN apt repository) and some
| startup errors lead me to Renviron.site and it's last line:
| 
| R_LIBS_SITE="/usr/local/lib/R/site-library/:${R_LIBS_SITE}:/usr/lib/R/library'"
| 
| Note the unmatched single quote just before the closing double quote.
| That's a typo, is it not?

Good catch, thank you, and fixed!

I altered that file / carried the setting over from Renviron at the beginning
of the test cycle in the first or second alpha release. The extra apostrophe
does not seem to have created an issue during all those tests, or since,
under either Debian or Ubuntu. So three cheers to R for robustly parsing
configs I may have messed up ;-)

(And if I may: a more focussed venue for a bug report may have been the
r-sig-debian list for R on Debian/Ubuntu, or a bug report at bugs.debian.org,
or an email to me. My name is at the top of the file.  No point in sending it
to every mailbox of r-devel subscribers.)

Thanks again,  Dirk

-- 
dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From henr|k@bengt@@on @end|ng |rom gm@||@com  Sun May  8 19:43:26 2022
From: henr|k@bengt@@on @end|ng |rom gm@||@com (Henrik Bengtsson)
Date: Sun, 8 May 2022 10:43:26 -0700
Subject: [Rd] Typo in Renviron.site in R 4.2.0 on Ubuntu?
In-Reply-To: <25207.65343.393792.303403@rob.eddelbuettel.com>
References: <CAByPayEf3L4N0JaNYTs6JUQ42vmhTNKCKWWf6+-3bd1CKx5jMA@mail.gmail.com>
 <25207.65343.393792.303403@rob.eddelbuettel.com>
Message-ID: <CAFDcVCRUeC40GYYuQmMYrZn9aXWGD1B5B+KW436xZsOKHYjBog@mail.gmail.com>

> ... The extra apostrophe does not seem to have created an issue during all those tests, or since, under either Debian or Ubuntu.

I think that is because the system library '/usr/lib/R/library' is
always appended at the end of the library path, so that non-existing
to folder (the one with the extra single quote appended) makes no
difference; it's silently ignored by R if used.

This begs the question, why is the system library added to the site
library path in the first place?  I would argue that:

R_LIBS_SITE="/usr/local/lib/R/site-library/:${R_LIBS_SITE}"

is the correct way here.

/Henrik

On Sun, May 8, 2022 at 10:35 AM Dirk Eddelbuettel <edd at debian.org> wrote:
>
>
> On 8 May 2022 at 19:12, Micha? Bojanowski wrote:
> | I installed R 4.2.0 on Ubuntu (from CRAN apt repository) and some
> | startup errors lead me to Renviron.site and it's last line:
> |
> | R_LIBS_SITE="/usr/local/lib/R/site-library/:${R_LIBS_SITE}:/usr/lib/R/library'"
> |
> | Note the unmatched single quote just before the closing double quote.
> | That's a typo, is it not?
>
> Good catch, thank you, and fixed!
>
> I altered that file / carried the setting over from Renviron at the beginning
> of the test cycle in the first or second alpha release. The extra apostrophe
> does not seem to have created an issue during all those tests, or since,
> under either Debian or Ubuntu. So three cheers to R for robustly parsing
> configs I may have messed up ;-)
>
> (And if I may: a more focussed venue for a bug report may have been the
> r-sig-debian list for R on Debian/Ubuntu, or a bug report at bugs.debian.org,
> or an email to me. My name is at the top of the file.  No point in sending it
> to every mailbox of r-devel subscribers.)
>
> Thanks again,  Dirk
>
> --
> dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From m|ch@|2992 @end|ng |rom gm@||@com  Mon May  9 00:43:00 2022
From: m|ch@|2992 @end|ng |rom gm@||@com (=?UTF-8?Q?Micha=C5=82_Bojanowski?=)
Date: Mon, 9 May 2022 00:43:00 +0200
Subject: [Rd] Typo in Renviron.site in R 4.2.0 on Ubuntu?
In-Reply-To: <25207.65343.393792.303403@rob.eddelbuettel.com>
References: <CAByPayEf3L4N0JaNYTs6JUQ42vmhTNKCKWWf6+-3bd1CKx5jMA@mail.gmail.com>
 <25207.65343.393792.303403@rob.eddelbuettel.com>
Message-ID: <CAByPayGMTYkXezLEEUjQd7B8gSw5YY8CGiFbY4c1zUPwV72Rjg@mail.gmail.com>

> (And if I may: a more focussed venue for a bug report may have been the
> r-sig-debian list for R on Debian/Ubuntu, or a bug report at bugs.debian.org,
> or an email to me. My name is at the top of the file.  No point in sending it
> to every mailbox of r-devel subscribers.)


Indeed. Sorry. I thought about it, but wasn't sure if the typo is on
the R-source level or rather Debian packaging...

Best, Michal


From edd @end|ng |rom deb|@n@org  Mon May  9 00:55:34 2022
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Sun, 8 May 2022 17:55:34 -0500
Subject: [Rd] Typo in Renviron.site in R 4.2.0 on Ubuntu?
In-Reply-To: <CAByPayGMTYkXezLEEUjQd7B8gSw5YY8CGiFbY4c1zUPwV72Rjg@mail.gmail.com>
References: <CAByPayEf3L4N0JaNYTs6JUQ42vmhTNKCKWWf6+-3bd1CKx5jMA@mail.gmail.com>
 <25207.65343.393792.303403@rob.eddelbuettel.com>
 <CAByPayGMTYkXezLEEUjQd7B8gSw5YY8CGiFbY4c1zUPwV72Rjg@mail.gmail.com>
Message-ID: <25208.19046.219637.520352@rob.eddelbuettel.com>


On 9 May 2022 at 00:43, Micha? Bojanowski wrote:
| > (And if I may: a more focussed venue for a bug report may have been the
| > r-sig-debian list for R on Debian/Ubuntu, or a bug report at bugs.debian.org,
| > or an email to me. My name is at the top of the file.  No point in sending it
| > to every mailbox of r-devel subscribers.)
| 
| Indeed. Sorry. I thought about it, but wasn't sure if the typo is on
| the R-source level or rather Debian packaging...

No worries! I am glad you brought it forward but, again, since I tried to
leave my name in the file I at least thought that made origin more obvious.

See you over at r-sig-debian which is a really useful and no-nonsense list.

Cheers, Dirk

-- 
dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From tom@@@k@||ber@ @end|ng |rom gm@||@com  Mon May  9 10:23:43 2022
From: tom@@@k@||ber@ @end|ng |rom gm@||@com (Tomas Kalibera)
Date: Mon, 9 May 2022 10:23:43 +0200
Subject: [Rd] Regression in 4.2.0: unable to type special characters in
 Windows RGui
In-Reply-To: <027b1c8f-c479-e269-4824-2c1ff0507e4a@gmail.com>
References: <027b1c8f-c479-e269-4824-2c1ff0507e4a@gmail.com>
Message-ID: <a44a69d2-987e-b2a9-2559-acc810ebc17e@gmail.com>


On 5/7/22 15:14, Cesko Voeten wrote:
> Hi,
>
> Since upgrading to 4.2.0, I can't type special characters in RGui 
> anymore. Specifically affected are at least "'~^ which, on my 
> US-International keyboard layout, all rely on dead keys. This was not 
> a problem in R <= 4.1.3, although I can't say whether the reason is 
> any change in R itself, or the fact that 4.2.0 is the first version 
> built against ucrt. OS is an up-to-date Windows 10, language is Dutch. 
> I tried toggling the 'experimental' Unicode support in Windows's 
> Country & Region settings, but it makes no difference. Is this a known 
> regression?

Thanks, could you please try the latest R-patched snapshot build and 
test it there? If there is still any problem, please report.

I've fixed handling of the dead keys in Rgui/GraphApp last week. It was 
a long standing bug (lack of support) in GraphApp Unicode windows, which 
are used when R is running in a multi-byte locale. As R 4.2 switched to 
UTF-8, this code path started to be used on systems where it wasn't 
before, but sadly this hasn't been discovered by testing before the release.

Technically, there were two bugs: one that dead keys could not be 
printed in non-combining form in principle, and another that some 
accents were not recognized. The former should be fixed fully. For the 
latter, I've added support for a number of accent keys and I can add 
more if needed (and if there is anyone who can test that).

Please test, in principle, there may be also other issues in the Unicode 
windows not reported before, and it would be nice to get these things 
fixed at least for R 4.1.

Thanks
Tomas





>
> Cesko Voeten
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From cvoeten @end|ng |rom gm@||@com  Mon May  9 19:44:08 2022
From: cvoeten @end|ng |rom gm@||@com (Cesko Voeten)
Date: Mon, 9 May 2022 19:44:08 +0200
Subject: [Rd] Regression in 4.2.0: unable to type special characters in
 Windows RGui
In-Reply-To: <a44a69d2-987e-b2a9-2559-acc810ebc17e@gmail.com>
References: <027b1c8f-c479-e269-4824-2c1ff0507e4a@gmail.com>
 <a44a69d2-987e-b2a9-2559-acc810ebc17e@gmail.com>
Message-ID: <5d91c1ac-b6e2-e446-5e23-8430514ddfb8@gmail.com>

Hi Tomas,

On 09-05-2022 at 10:23, Tomas Kalibera wrote:
> 
> On 5/7/22 15:14, Cesko Voeten wrote:
>> Hi,
>>
>> Since upgrading to 4.2.0, I can't type special characters in RGui anymore. Specifically affected are at least "'~^ which, on my US-International keyboard layout, all rely on dead keys. This was not a problem in R <= 4.1.3, although I can't say whether the reason is any change in R itself, or the fact that 4.2.0 is the first version built against ucrt. OS is an up-to-date Windows 10, language is Dutch. I tried toggling the 'experimental' Unicode support in Windows's Country & Region settings, but it makes no difference. Is this a known regression?
> 
> Thanks, could you please try the latest R-patched snapshot build and test it there? If there is still any problem, please report.

No problem, happy to test! First of all, I'm happy to say it works and I can type deadkey characters again, but there are some issues and discrepancies compared to other Windows apps:

  - Some accents don't work. For instance, pressing 'a produces ?, but pressing 'a produces 'a rather than ?. From my testing, `^~ seem to work as expected, but '" don't.
  - Nonexistent deadkey combinations are handled differently from native Windows. For example, typing ~^ should output ~^, but produces nothing. Typing ~^a should output ~^a, but actually yields ~?. So it seems that the first ~ is correctly translated to the tilde symbol, but simultaneously the second ^ is being treated as a new deadkey press, which other Windows programs don't do in this case.
  - Related to the above two issues, '& should produce '&, while it only gives &. This again affects only '" --- something like ^& correctly produces ^&.

Also, I'm noticing only now that selecting typed text in RGui and pressing Ctrl deletes that text, so trying to Ctrl+C text that I typed is kind of awkward. But this might simply be a feature that I wasn't aware of before.

Thanks for your efforts! I hope these observations help.

Cesko

> 
> I've fixed handling of the dead keys in Rgui/GraphApp last week. It was a long standing bug (lack of support) in GraphApp Unicode windows, which are used when R is running in a multi-byte locale. As R 4.2 switched to UTF-8, this code path started to be used on systems where it wasn't before, but sadly this hasn't been discovered by testing before the release.
> 
> Technically, there were two bugs: one that dead keys could not be printed in non-combining form in principle, and another that some accents were not recognized. The former should be fixed fully. For the latter, I've added support for a number of accent keys and I can add more if needed (and if there is anyone who can test that).
> 
> Please test, in principle, there may be also other issues in the Unicode windows not reported before, and it would be nice to get these things fixed at least for R 4.1.
> 
> Thanks
> Tomas
> 
> 
> 
> 
> 
>>
>> Cesko Voeten
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel


From w@|ter@djur|c @end|ng |rom gm@||@com  Mon May  9 18:36:50 2022
From: w@|ter@djur|c @end|ng |rom gm@||@com (Gmail)
Date: Mon, 9 May 2022 18:36:50 +0200
Subject: [Rd] Building R-4.1.3  from source - creating .msi fails
Message-ID: <07e901d863c2$fbe20ad0$f3a62070$@gmail.com>

Dear all, 
lately I was building R-4.1.3 from source and 
as the final step I decided to also try and build the .msi file. 

I was following along the R Admin manual and using Jeroens ?r-windows/r-base? GitHub repo as a basis. 
The build, the tests all the way to the Inno-Setup Windows .exe installer completed successfully - but not the "R-4.1.3.msi" file. 
Since I am not really knowledgeable when it comes to debugging WiX failures I was hoping someone here has some helpful comments. 

Below are the logs/output/errors/file excerpts: 
=========================

R-4.1.3.log: 
----------------
Windows Installer XML Toolset Compiler version 3.11.2.4516
Copyright (c) .NET Foundation and contributors. All rights reserved.

*** asterisk lines separate content of different files **********************************

*****************************************************************************
R.wxs [file]
D:\r-base\src\R-source\src\gnuwin32\installer\R.wxs(50036) : error CNDL0104 : Not a valid source file; 
detail: The 'DirectoryRef' start tag on line 50033 position 14 does not match the end tag of 'Component'. Line 50036, position 19.


*****************************************************************************
R.wxs [file] (lines 50032 ? 50037, etc.) 
I understand the error is the result of line 50034 having the first of many (after that line there are hundreds) 
?unprovoked? NA?s : 
...
...
            </DirectoryRef>
            <DirectoryRef Id="dirDFBCD23F607D1BCC15748A367C06C465">
    NA
                    <File Id="fil49DED439D60E725AA5D6402B8A36B915" KeyPath="yes" Source="R-4.1.3\library\base\help\print.DLLInfoList.html" />
                </Component>
            </DirectoryRef>
            <DirectoryRef Id="dir4A5E34FDE4B660BFC361AB8682CC00A3">
....
....
Additionally here follows  line 82158 where, because there are no more file-ids after line 82160 below the NAs also disappear: 
            <DirectoryRef Id="dir1FF2414B716F9EC0C950A7D0C5600532">
    NA
                    <File Id="fil7FBA10F4604BA92660D4FA85CA81B1BC" KeyPath="yes" Source="R-4.1.3\library\Matrix\help\coerce+2ClsTMatrix+2CdsTMatrix-method.html" />
                </Component>
            </DirectoryRef>
            <DirectoryRef Id="dirD31021A615C26B5D3F93CF12408AE4B5">
                <Directory Id="dir0016419565268E77B190EFC6ECFE56AD" Name="LC_MESSAGES" />
            </DirectoryRef>

*****************************************************************************
files.wxs [file] here is the corresponding files Fragment of the above (first)  "corrupted" tag 
ie of file-id: fil49DED439D60E725AA5D6402B8A36B915
...
...
<Fragment>
        <DirectoryRef Id="dirDFBCD23F607D1BCC15748A367C06C465">
            <Component Id="cmp9D50FF8D0F55461A69B18CCAC6292CA3" Guid="PUT-GUID-HERE">
                <File Id="fil49DED439D60E725AA5D6402B8A36B915" KeyPath="yes" Source="SourceDir\library\base\help\print.DLLInfoList.html" />
            </Component>
        </DirectoryRef>
    </Fragment>
    <Fragment>
...
...

*****************************************************************************
The ?WiXins.R? file I am using is the unmodified /src/gnuwin32/installer/WiXins.R of the .tar.gz downloaded from: https://cran.r-project.org/src/base/R-4/R-4.1.3.tar.gz  

=========================
Greetings, 
Walter 


From tom@@@k@||ber@ @end|ng |rom gm@||@com  Tue May 10 14:02:19 2022
From: tom@@@k@||ber@ @end|ng |rom gm@||@com (Tomas Kalibera)
Date: Tue, 10 May 2022 14:02:19 +0200
Subject: [Rd] Regression in 4.2.0: unable to type special characters in
 Windows RGui
In-Reply-To: <5d91c1ac-b6e2-e446-5e23-8430514ddfb8@gmail.com>
References: <027b1c8f-c479-e269-4824-2c1ff0507e4a@gmail.com>
 <a44a69d2-987e-b2a9-2559-acc810ebc17e@gmail.com>
 <5d91c1ac-b6e2-e446-5e23-8430514ddfb8@gmail.com>
Message-ID: <f16306c8-4c08-c0a9-b2f6-f91eb2983c25@gmail.com>


On 5/9/22 19:44, Cesko Voeten wrote:
> Hi Tomas,
>
> On 09-05-2022 at 10:23, Tomas Kalibera wrote:
>>
>> On 5/7/22 15:14, Cesko Voeten wrote:
>>> Hi,
>>>
>>> Since upgrading to 4.2.0, I can't type special characters in RGui 
>>> anymore. Specifically affected are at least "'~^ which, on my 
>>> US-International keyboard layout, all rely on dead keys. This was 
>>> not a problem in R <= 4.1.3, although I can't say whether the reason 
>>> is any change in R itself, or the fact that 4.2.0 is the first 
>>> version built against ucrt. OS is an up-to-date Windows 10, language 
>>> is Dutch. I tried toggling the 'experimental' Unicode support in 
>>> Windows's Country & Region settings, but it makes no difference. Is 
>>> this a known regression?
>>
>> Thanks, could you please try the latest R-patched snapshot build and 
>> test it there? If there is still any problem, please report.

Hi Cesko,

thanks a lot for the testing.

>
> No problem, happy to test! First of all, I'm happy to say it works and 
> I can type deadkey characters again, but there are some issues and 
> discrepancies compared to other Windows apps:
>
> ?- Some accents don't work. For instance, pressing 'a produces ?, but 
> pressing 'a produces 'a rather than ?. From my testing, `^~ seem to 
> work as expected, but '" don't.

I could reproduce this on the US International keyboard and it is fixed 
now. There may be missing support for more accents, so if you or anyone 
else find about them, please let me know.

> ?- Nonexistent deadkey combinations are handled differently from 
> native Windows. For example, typing ~^ should output ~^, but produces 
> nothing. Typing ~^a should output ~^a, but actually yields ~?. So it 
> seems that the first ~ is correctly translated to the tilde symbol, 
> but simultaneously the second ^ is being treated as a new deadkey 
> press, which other Windows programs don't do in this case.
Thanks, fixed now. It was another bug in the old code, plus a "feature" 
I added that by pressing e.g. the dead-key apostrophe twice you get it 
printed only once (this is what Linux does and I find it more natural). 
But I made it now to work as usual on Windows.
> ?- Related to the above two issues, '& should produce '&, while it 
> only gives &. This again affects only '" --- something like ^& 
> correctly produces ^&.

It should be fixed by now as well.

The fixes are in 82332 (R-patched) and 82331 (R-devel). If you could 
test again after the snapshot build gets there, that would be great. It 
is easy to miss something.

When testing now, I've been using http://kbdlayout.info/ as a reference 
for several keyboard layouts on Windows, to find how to type different 
dead-keys. That can give you also names of the deadkeys, which can be 
easily communicated without having to copy-paste from the Rgui window. 
On some layouts, additional deadkeys are available with right Alt (AltGr).

>
> Also, I'm noticing only now that selecting typed text in RGui and 
> pressing Ctrl deletes that text, so trying to Ctrl+C text that I typed 
> is kind of awkward. But this might simply be a feature that I wasn't 
> aware of before.

Interesting. It isn't happening on my system, but I can't tell whether 
it is a "feature" under some circumstances. Maybe you can try to find 
out more about this: whether it is repeatable, whether it depends on 
some setting, whether it was happening also in R 4.1, etc.

> Thanks for your efforts! I hope these observations help.
They did, thanks!

Tomas

>
> Cesko
>
>>
>> I've fixed handling of the dead keys in Rgui/GraphApp last week. It 
>> was a long standing bug (lack of support) in GraphApp Unicode 
>> windows, which are used when R is running in a multi-byte locale. As 
>> R 4.2 switched to UTF-8, this code path started to be used on systems 
>> where it wasn't before, but sadly this hasn't been discovered by 
>> testing before the release.
>>
>> Technically, there were two bugs: one that dead keys could not be 
>> printed in non-combining form in principle, and another that some 
>> accents were not recognized. The former should be fixed fully. For 
>> the latter, I've added support for a number of accent keys and I can 
>> add more if needed (and if there is anyone who can test that).
>>
>> Please test, in principle, there may be also other issues in the 
>> Unicode windows not reported before, and it would be nice to get 
>> these things fixed at least for R 4.1.
>>
>> Thanks
>> Tomas
>>
>>
>>
>>
>>
>>>
>>> Cesko Voeten
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel


From tom@@@k@||ber@ @end|ng |rom gm@||@com  Tue May 10 15:07:15 2022
From: tom@@@k@||ber@ @end|ng |rom gm@||@com (Tomas Kalibera)
Date: Tue, 10 May 2022 15:07:15 +0200
Subject: [Rd] Building R-4.1.3 from source - creating .msi fails
In-Reply-To: <07e901d863c2$fbe20ad0$f3a62070$@gmail.com>
References: <07e901d863c2$fbe20ad0$f3a62070$@gmail.com>
Message-ID: <7eb5c514-8cb8-035c-9ee3-38d3f2ded174@gmail.com>


On 5/9/22 18:36, Gmail wrote:
> Dear all,
> lately I was building R-4.1.3 from source and
> as the final step I decided to also try and build the .msi file.
>
> I was following along the R Admin manual and using Jeroens ?r-windows/r-base? GitHub repo as a basis.
> The build, the tests all the way to the Inno-Setup Windows .exe installer completed successfully - but not the "R-4.1.3.msi" file.

The MSI installer is not supported. I can't see it mentioned in R-Admin, 
but if you found it there or in some documentation, please report, so 
that it can be removed.

Best
Tomas

> Since I am not really knowledgeable when it comes to debugging WiX failures I was hoping someone here has some helpful comments.
>
> Below are the logs/output/errors/file excerpts:
> =========================
>
> R-4.1.3.log:
> ----------------
> Windows Installer XML Toolset Compiler version 3.11.2.4516
> Copyright (c) .NET Foundation and contributors. All rights reserved.
>
> *** asterisk lines separate content of different files **********************************
>
> *****************************************************************************
> R.wxs [file]
> D:\r-base\src\R-source\src\gnuwin32\installer\R.wxs(50036) : error CNDL0104 : Not a valid source file;
> detail: The 'DirectoryRef' start tag on line 50033 position 14 does not match the end tag of 'Component'. Line 50036, position 19.
>
>
> *****************************************************************************
> R.wxs [file] (lines 50032 ? 50037, etc.)
> I understand the error is the result of line 50034 having the first of many (after that line there are hundreds)
> ?unprovoked? NA?s :
> ...
> ...
>              </DirectoryRef>
>              <DirectoryRef Id="dirDFBCD23F607D1BCC15748A367C06C465">
>      NA
>                      <File Id="fil49DED439D60E725AA5D6402B8A36B915" KeyPath="yes" Source="R-4.1.3\library\base\help\print.DLLInfoList.html" />
>                  </Component>
>              </DirectoryRef>
>              <DirectoryRef Id="dir4A5E34FDE4B660BFC361AB8682CC00A3">
> ....
> ....
> Additionally here follows  line 82158 where, because there are no more file-ids after line 82160 below the NAs also disappear:
>              <DirectoryRef Id="dir1FF2414B716F9EC0C950A7D0C5600532">
>      NA
>                      <File Id="fil7FBA10F4604BA92660D4FA85CA81B1BC" KeyPath="yes" Source="R-4.1.3\library\Matrix\help\coerce+2ClsTMatrix+2CdsTMatrix-method.html" />
>                  </Component>
>              </DirectoryRef>
>              <DirectoryRef Id="dirD31021A615C26B5D3F93CF12408AE4B5">
>                  <Directory Id="dir0016419565268E77B190EFC6ECFE56AD" Name="LC_MESSAGES" />
>              </DirectoryRef>
>
> *****************************************************************************
> files.wxs [file] here is the corresponding files Fragment of the above (first)  "corrupted" tag
> ie of file-id: fil49DED439D60E725AA5D6402B8A36B915
> ...
> ...
> <Fragment>
>          <DirectoryRef Id="dirDFBCD23F607D1BCC15748A367C06C465">
>              <Component Id="cmp9D50FF8D0F55461A69B18CCAC6292CA3" Guid="PUT-GUID-HERE">
>                  <File Id="fil49DED439D60E725AA5D6402B8A36B915" KeyPath="yes" Source="SourceDir\library\base\help\print.DLLInfoList.html" />
>              </Component>
>          </DirectoryRef>
>      </Fragment>
>      <Fragment>
> ...
> ...
>
> *****************************************************************************
> The ?WiXins.R? file I am using is the unmodified /src/gnuwin32/installer/WiXins.R of the .tar.gz downloaded from: https://cran.r-project.org/src/base/R-4/R-4.1.3.tar.gz
>
> =========================
> Greetings,
> Walter
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From w@|ter@djur|c @end|ng |rom gm@||@com  Tue May 10 21:01:27 2022
From: w@|ter@djur|c @end|ng |rom gm@||@com (Gmail)
Date: Tue, 10 May 2022 21:01:27 +0200
Subject: [Rd] Building R-4.1.3 from source - creating .msi fails
In-Reply-To: <7eb5c514-8cb8-035c-9ee3-38d3f2ded174@gmail.com>
References: <07e901d863c2$fbe20ad0$f3a62070$@gmail.com>
 <7eb5c514-8cb8-035c-9ee3-38d3f2ded174@gmail.com>
Message-ID: <008101d864a0$5aa8b360$0ffa1a20$@gmail.com>

Thanks for the swift reply. 

Maybe some clarifications from my side - I am not referring to the R-4.2.0 version (manual). 
But the earlier up to R-4.1.3 version manuals, where there always was a section about "Building the MSI installer" [right after Building the Inno Setup Installer] included (ending with thanks to David del Campo).  
And as far as I can tell the Inno Setup section is also gone from the 4.2.0 manual now? On purpose?
Then why is it that there is still an /installer folder in R-4.2.0 with all the Inno Setup files eg header.iss and JRins.R as well as WiXins.R in it, and the installer/Makefile also still includes all these sections.  

So in the spirit of things I guess that all lines in the .../installer/Makefile (line 49 and lines 180 ff.) as well as the whole ?WiXins.R? file in the /installer folder should be removed from R-4.1.3.tar.gz (which is available in that form for download from r-project)? And judging from the manual the .iss related parts as well? 

At the same time R-4.0.5 msi build works fine so probably should not be altered/removed in R-4.0.5.tar.gz? 

G, W


-----Original Message-----
From: Tomas Kalibera <tomas.kalibera at gmail.com> 
Sent: Tuesday, May 10, 2022 3:07 PM
To: Gmail <walter.djuric at gmail.com>; r-devel at R-project.org
Subject: Re: [Rd] Building R-4.1.3 from source - creating .msi fails


On 5/9/22 18:36, Gmail wrote:
> Dear all,
> lately I was building R-4.1.3 from source and as the final step I 
> decided to also try and build the .msi file.
>
> I was following along the R Admin manual and using Jeroens ?r-windows/r-base? GitHub repo as a basis.
> The build, the tests all the way to the Inno-Setup Windows .exe installer completed successfully - but not the "R-4.1.3.msi" file.

The MSI installer is not supported. I can't see it mentioned in R-Admin, but if you found it there or in some documentation, please report, so that it can be removed.

Best
Tomas

> Since I am not really knowledgeable when it comes to debugging WiX failures I was hoping someone here has some helpful comments.
>
> Below are the logs/output/errors/file excerpts:
> =========================
>
> R-4.1.3.log:
> ----------------
> Windows Installer XML Toolset Compiler version 3.11.2.4516 Copyright 
> (c) .NET Foundation and contributors. All rights reserved.
>
> *** asterisk lines separate content of different files 
> **********************************
>
> **********************************************************************
> *******
> R.wxs [file]
> D:\r-base\src\R-source\src\gnuwin32\installer\R.wxs(50036) : error 
> CNDL0104 : Not a valid source file;
> detail: The 'DirectoryRef' start tag on line 50033 position 14 does not match the end tag of 'Component'. Line 50036, position 19.
>
>
> **********************************************************************
> ******* R.wxs [file] (lines 50032 ? 50037, etc.) I understand the 
> error is the result of line 50034 having the first of many (after that 
> line there are hundreds) ?unprovoked? NA?s :
> ...
> ...
>              </DirectoryRef>
>              <DirectoryRef Id="dirDFBCD23F607D1BCC15748A367C06C465">
>      NA
>                      <File Id="fil49DED439D60E725AA5D6402B8A36B915" KeyPath="yes" Source="R-4.1.3\library\base\help\print.DLLInfoList.html" />
>                  </Component>
>              </DirectoryRef>
>              <DirectoryRef Id="dir4A5E34FDE4B660BFC361AB8682CC00A3">
> ....
> ....
> Additionally here follows  line 82158 where, because there are no more file-ids after line 82160 below the NAs also disappear:
>              <DirectoryRef Id="dir1FF2414B716F9EC0C950A7D0C5600532">
>      NA
>                      <File Id="fil7FBA10F4604BA92660D4FA85CA81B1BC" KeyPath="yes" Source="R-4.1.3\library\Matrix\help\coerce+2ClsTMatrix+2CdsTMatrix-method.html" />
>                  </Component>
>              </DirectoryRef>
>              <DirectoryRef Id="dirD31021A615C26B5D3F93CF12408AE4B5">
>                  <Directory Id="dir0016419565268E77B190EFC6ECFE56AD" Name="LC_MESSAGES" />
>              </DirectoryRef>
>
> **********************************************************************
> ******* files.wxs [file] here is the corresponding files Fragment of 
> the above (first)  "corrupted" tag ie of file-id: 
> fil49DED439D60E725AA5D6402B8A36B915
> ...
> ...
> <Fragment>
>          <DirectoryRef Id="dirDFBCD23F607D1BCC15748A367C06C465">
>              <Component Id="cmp9D50FF8D0F55461A69B18CCAC6292CA3" Guid="PUT-GUID-HERE">
>                  <File Id="fil49DED439D60E725AA5D6402B8A36B915" KeyPath="yes" Source="SourceDir\library\base\help\print.DLLInfoList.html" />
>              </Component>
>          </DirectoryRef>
>      </Fragment>
>      <Fragment>
> ...
> ...
>
> **********************************************************************
> ******* The ?WiXins.R? file I am using is the unmodified 
> /src/gnuwin32/installer/WiXins.R of the .tar.gz downloaded from: 
> https://cran.r-project.org/src/base/R-4/R-4.1.3.tar.gz
>
> =========================
> Greetings,
> Walter
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From murdoch@dunc@n @end|ng |rom gm@||@com  Tue May 10 22:15:27 2022
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Tue, 10 May 2022 16:15:27 -0400
Subject: [Rd] Building R-4.1.3 from source - creating .msi fails
In-Reply-To: <008101d864a0$5aa8b360$0ffa1a20$@gmail.com>
References: <07e901d863c2$fbe20ad0$f3a62070$@gmail.com>
 <7eb5c514-8cb8-035c-9ee3-38d3f2ded174@gmail.com>
 <008101d864a0$5aa8b360$0ffa1a20$@gmail.com>
Message-ID: <a03f378c-0cce-7d6e-0577-cfdeb67bbe54@gmail.com>

On 10/05/2022 3:01 p.m., Gmail wrote:
> Thanks for the swift reply.
> 
> Maybe some clarifications from my side - I am not referring to the R-4.2.0 version (manual).
> But the earlier up to R-4.1.3 version manuals, where there always was a section about "Building the MSI installer" [right after Building the Inno Setup Installer] included (ending with thanks to David del Campo).

Some more clarification, please:  which manual are you talking about?  I 
don't see those sections in the R Admin manual.  Maybe they were 
conditional on the Windows build?

> And as far as I can tell the Inno Setup section is also gone from the 4.2.0 manual now? On purpose?

You could look at the svn history of the source file to see what the log 
message says.  So could I, if I only knew which manual you are looking at.

> Then why is it that there is still an /installer folder in R-4.2.0 with all the Inno Setup files eg header.iss and JRins.R as well as WiXins.R in it, and the installer/Makefile also still includes all these sections.
> 
> So in the spirit of things I guess that all lines in the .../installer/Makefile (line 49 and lines 180 ff.) as well as the whole ?WiXins.R? file in the /installer folder should be removed from R-4.1.3.tar.gz (which is available in that form for download from r-project)? And judging from the manual the .iss related parts as well?

The 4.1.3 tarfile has been released, and can't be modified.  The only 
way a modification would be possible would be to release a new 4.1.x 
patch version, but that's really, really unlikely.

> At the same time R-4.0.5 msi build works fine so probably should not be altered/removed in R-4.0.5.tar.gz?

Changes there are even less likely, so don't worry about them.

Duncan Murdoch

> 
> G, W
> 
> 
> -----Original Message-----
> From: Tomas Kalibera <tomas.kalibera at gmail.com>
> Sent: Tuesday, May 10, 2022 3:07 PM
> To: Gmail <walter.djuric at gmail.com>; r-devel at R-project.org
> Subject: Re: [Rd] Building R-4.1.3 from source - creating .msi fails
> 
> 
> On 5/9/22 18:36, Gmail wrote:
>> Dear all,
>> lately I was building R-4.1.3 from source and as the final step I
>> decided to also try and build the .msi file.
>>
>> I was following along the R Admin manual and using Jeroens ?r-windows/r-base? GitHub repo as a basis.
>> The build, the tests all the way to the Inno-Setup Windows .exe installer completed successfully - but not the "R-4.1.3.msi" file.
> 
> The MSI installer is not supported. I can't see it mentioned in R-Admin, but if you found it there or in some documentation, please report, so that it can be removed.
> 
> Best
> Tomas
> 
>> Since I am not really knowledgeable when it comes to debugging WiX failures I was hoping someone here has some helpful comments.
>>
>> Below are the logs/output/errors/file excerpts:
>> =========================
>>
>> R-4.1.3.log:
>> ----------------
>> Windows Installer XML Toolset Compiler version 3.11.2.4516 Copyright
>> (c) .NET Foundation and contributors. All rights reserved.
>>
>> *** asterisk lines separate content of different files
>> **********************************
>>
>> **********************************************************************
>> *******
>> R.wxs [file]
>> D:\r-base\src\R-source\src\gnuwin32\installer\R.wxs(50036) : error
>> CNDL0104 : Not a valid source file;
>> detail: The 'DirectoryRef' start tag on line 50033 position 14 does not match the end tag of 'Component'. Line 50036, position 19.
>>
>>
>> **********************************************************************
>> ******* R.wxs [file] (lines 50032 ? 50037, etc.) I understand the
>> error is the result of line 50034 having the first of many (after that
>> line there are hundreds) ?unprovoked? NA?s :
>> ...
>> ...
>>               </DirectoryRef>
>>               <DirectoryRef Id="dirDFBCD23F607D1BCC15748A367C06C465">
>>       NA
>>                       <File Id="fil49DED439D60E725AA5D6402B8A36B915" KeyPath="yes" Source="R-4.1.3\library\base\help\print.DLLInfoList.html" />
>>                   </Component>
>>               </DirectoryRef>
>>               <DirectoryRef Id="dir4A5E34FDE4B660BFC361AB8682CC00A3">
>> ....
>> ....
>> Additionally here follows  line 82158 where, because there are no more file-ids after line 82160 below the NAs also disappear:
>>               <DirectoryRef Id="dir1FF2414B716F9EC0C950A7D0C5600532">
>>       NA
>>                       <File Id="fil7FBA10F4604BA92660D4FA85CA81B1BC" KeyPath="yes" Source="R-4.1.3\library\Matrix\help\coerce+2ClsTMatrix+2CdsTMatrix-method.html" />
>>                   </Component>
>>               </DirectoryRef>
>>               <DirectoryRef Id="dirD31021A615C26B5D3F93CF12408AE4B5">
>>                   <Directory Id="dir0016419565268E77B190EFC6ECFE56AD" Name="LC_MESSAGES" />
>>               </DirectoryRef>
>>
>> **********************************************************************
>> ******* files.wxs [file] here is the corresponding files Fragment of
>> the above (first)  "corrupted" tag ie of file-id:
>> fil49DED439D60E725AA5D6402B8A36B915
>> ...
>> ...
>> <Fragment>
>>           <DirectoryRef Id="dirDFBCD23F607D1BCC15748A367C06C465">
>>               <Component Id="cmp9D50FF8D0F55461A69B18CCAC6292CA3" Guid="PUT-GUID-HERE">
>>                   <File Id="fil49DED439D60E725AA5D6402B8A36B915" KeyPath="yes" Source="SourceDir\library\base\help\print.DLLInfoList.html" />
>>               </Component>
>>           </DirectoryRef>
>>       </Fragment>
>>       <Fragment>
>> ...
>> ...
>>
>> **********************************************************************
>> ******* The ?WiXins.R? file I am using is the unmodified
>> /src/gnuwin32/installer/WiXins.R of the .tar.gz downloaded from:
>> https://cran.r-project.org/src/base/R-4/R-4.1.3.tar.gz
>>
>> =========================
>> Greetings,
>> Walter
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From jo@ec|@ud|o@|@r|@ @end|ng |rom gm@||@com  Wed May 11 03:02:51 2022
From: jo@ec|@ud|o@|@r|@ @end|ng |rom gm@||@com (jcfaria)
Date: Wed, 11 May 2022 01:02:51 +0000
Subject: [Rd] Rgui.exe 4.2.0 does not receive characters via the Windows
 API's PostMessage function
In-Reply-To: <5e580ff4-ac60-6b79-e0d7-f9a84ee200d7@gmail.com>
References: <em26d64aef-2f66-415f-be9d-ae71a91c1d56@dell>
 <8e41c7bc-466c-ca00-6141-66520f8818b8@gmail.com>
 <em8cb2eaf6-27fe-4d26-84b2-3eef11fa9530@dell>
 <5e580ff4-ac60-6b79-e0d7-f9a84ee200d7@gmail.com>
Message-ID: <em46f02f23-aa3d-4db3-9f88-1b338b047298@dell>

Dear Tomas,
I've tried, but I don't have the necessary C/C++ programming skills to 
fulfill your request.

Maybe someone can help us by transcribing the little code in object 
Pascal that I sent to C/C++.

If a small executable, made in Object Pascal, can help in your debug, I 
can provide.

Grateful for the attention,,
///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\
Jose Claudio Faria
UESC/DCET/Brasil
joseclaudio.faria at gmail.com
Telefones:
55(73)3680.5545 - UESC
55(73)99966.9100 - VIVO
///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\
If you have software to deal with statistics, you have arms,
if you have good software, you have arms and legs,
if you have software like R, you have arms, legs and wings...
the height of your flight depends only on you.

------ Mensagem original ------
De: "Tomas Kalibera" <tomas.kalibera at gmail.com>
Para: "jcfaria" <joseclaudio.faria at gmail.com>; "Duncan Murdoch" 
<murdoch.duncan at gmail.com>; r-devel at r-project.org
Enviado(s): 06/05/2022 04:24:44
Assunto: Re: [Rd] Rgui.exe 4.2.0 does not receive characters via the 
Windows API's PostMessage function

>
>On 5/6/22 07:03, jcfaria wrote:
>>Dear Duncan,
>>I believe the problem is of a different nature.
>>I get TRUE 3 times running the code below:
>>
>>procedure TfMain.btnPasteClick(Sender: TObject);
>>var
>>   i: integer;
>>   sTmp: string;
>>   hBN: HWND;
>>   j: bool;
>>
>>begin
>>   hBN:= FindWindowA(nil,
>>                     'R Console (64-bit)');
>>
>>   sTmp:= 'sd';
>>
>>   for i:= 1 to Length(sTmp) do begin
>>     j:= PostMessage(hBN,
>>                     WM_CHAR,
>>                     Ord(sTmp[i]),
>>                     0);
>>
>>     ShowMessage(BoolToStr(j,
>>                           True));
>>   end;
>>
>>   j:= PostMessage(hBN,
>>               WM_KEYDOWN,
>>               VK_RETURN, 0);
>>
>>   ShowMessage(BoolToStr(j,
>>                         True));
>>end;
>>
>>That is, Rgui is receiving the message of the characters (via PostMessage), but it is blocking because it does not show them in the console.
>>The only thing Rgui blames is Carriage Return, as it adds an additional prompt with each run.
>
>I can't provide a good guess what impacted your use, but if you could give me a full example, ideally in C, which can be compiled with Rtools42 (so gcc, MinGW) and I can edit/recompile, and works with R 4.1, I am happy to help debugging on 4.2.
>
>Rgui now uses GraphApp Unicode windows on systems where it didn't before, because it uses UTF-8 also on systems it didn't before (on systems that would use a single-byte locale in R 4.1). These Unicode windows are a different code path and there may be bugs not reported previously, including processing inputs (recently I fixed handling of accents, for example). Otherwise indeed R now uses UTF-8 as native encoding and UCRT as the C runtime.
>
>Best
>Tomas
>
>
>>
>> >
>> >
>>
>>Best,
>>///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\
>>Jose Claudio Faria
>>UESC/DCET/Brasil
>>joseclaudio.faria at gmail.com
>>Telefones:
>>55(73)3680.5545 - UESC
>>55(73)99966.9100 - VIVO
>>///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\
>>If you have software to deal with statistics, you have arms,
>>if you have good software, you have arms and legs,
>>if you have software like R, you have arms, legs and wings...
>>the height of your flight depends only on you.
>>
>>------ Mensagem original ------
>>De: "Duncan Murdoch" <murdoch.duncan at gmail.com>
>>Para: "jcfaria" <joseclaudio.faria at gmail.com>; r-devel at r-project.org
>>Enviado(s): 05/05/2022 13:17:53
>>Assunto: Re: [Rd] Rgui.exe 4.2.0 does not receive characters via the Windows API's PostMessage function
>>
>>>On 05/05/2022 11:17 a.m., jcfaria wrote:
>>>>Hello,
>>>>
>>>>Rgui.exe 4.2.0 does not receive characters via the Windows API's
>>>>PostMessage function.
>>>>
>>>>The Tinn-R project sends messages to Rgui.exe (SDI mode) via the Windows
>>>>API's PostMessage function.
>>>>A simplification of the code (in object Pascal) can be seen below.
>>>>
>>>>procedure TfMain.btnPasteClick(Sender: TObject);
>>>>var
>>>>     i: integer;
>>>>     sTmp: WideString;
>>>>     hBN: HWND;
>>>>
>>>>begin
>>>>     hBN:= FindWindowA(nil,
>>>>                       'R Console (64-bit)');
>>>>
>>>>     sTmp:= 'sd';
>>>>
>>>>     for i:= 1 to Length(sTmp) do begin
>>>>       PostMessage(hBN,
>>>>                   WM_CHAR,
>>>>                   Ord(sTmp[i]),
>>>>                   0);
>>>>     end;
>>>>
>>>>     PostMessage(hBN,
>>>>                 WM_KEYDOWN,
>>>>                 VK_RETURN, 0);
>>>>end;
>>>>
>>>>This code has always worked fine for all versions of Rgui.exe with the
>>>>exception of the last one released, ie 4.2.0.
>>>>
>>>>We've been trying to get around the problem on the Object Pascal side,
>>>>but without success so far.
>>>>
>>>>Does anyone connected to the compilation of Rqui.exe know what the
>>>>problem is?
>>>
>>>It could be that the new build enforces Windows security more stringently.  More details are described in the answer to this question:  https://stackoverflow.com/a/40139498/2554330, but at a minimum you should be checking the return value from PostMessage.
>>>
>>>Duncan Murdoch
>>>
>>>>
>>>>Best,
>>>>///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\
>>>>Jose Claudio Faria
>>>>UESC/DCET/Brasil
>>>>joseclaudio.faria at gmail.com
>>>>Telefones:
>>>>55(73)3680.5545 - UESC
>>>>55(73)99966.9100 - VIVO
>>>>///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\
>>>>If you have software to deal with statistics, you have arms,
>>>>if you have good software, you have arms and legs,
>>>>if you have software like R, you have arms, legs and wings...
>>>>the height of your flight depends only on you.
>>>>
>>>>     [[alternative HTML version deleted]]
>>>>
>>>>______________________________________________
>>>>R-devel at r-project.org mailing list
>>>>https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>
>>______________________________________________
>>R-devel at r-project.org mailing list
>>https://stat.ethz.ch/mailman/listinfo/r-devel


From tom@@@k@||ber@ @end|ng |rom gm@||@com  Wed May 11 08:15:13 2022
From: tom@@@k@||ber@ @end|ng |rom gm@||@com (Tomas Kalibera)
Date: Wed, 11 May 2022 08:15:13 +0200
Subject: [Rd] Rgui.exe 4.2.0 does not receive characters via the Windows
 API's PostMessage function
In-Reply-To: <em46f02f23-aa3d-4db3-9f88-1b338b047298@dell>
References: <em26d64aef-2f66-415f-be9d-ae71a91c1d56@dell>
 <8e41c7bc-466c-ca00-6141-66520f8818b8@gmail.com>
 <em8cb2eaf6-27fe-4d26-84b2-3eef11fa9530@dell>
 <5e580ff4-ac60-6b79-e0d7-f9a84ee200d7@gmail.com>
 <em46f02f23-aa3d-4db3-9f88-1b338b047298@dell>
Message-ID: <7bbdbe00-51e2-e9cf-ae16-5e969fb756b7@gmail.com>


On 5/11/22 03:02, jcfaria wrote:
> Dear Tomas,
> I've tried, but I don't have the necessary C/C++ programming skills to 
> fulfill your request.
>
> Maybe someone can help us by transcribing the little code in object 
> Pascal that I sent to C/C++.
>
> If a small executable, made in Object Pascal, can help in your debug, 
> I can provide.

Dear Jose,

no problem, I can try out with the Pascal code.
Is there a free compiler I can use to build and run it?

Thanks
Tomas

>
> Grateful for the attention,,
> ///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\
> Jose Claudio Faria
> UESC/DCET/Brasil
> joseclaudio.faria at gmail.com
> Telefones:
> 55(73)3680.5545 - UESC
> 55(73)99966.9100 - VIVO
> ///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\
> If you have software to deal with statistics, you have arms,
> if you have good software, you have arms and legs,
> if you have software like R, you have arms, legs and wings...
> the height of your flight depends only on you.
>
> ------ Mensagem original ------
> De: "Tomas Kalibera" <tomas.kalibera at gmail.com>
> Para: "jcfaria" <joseclaudio.faria at gmail.com>; "Duncan Murdoch" 
> <murdoch.duncan at gmail.com>; r-devel at r-project.org
> Enviado(s): 06/05/2022 04:24:44
> Assunto: Re: [Rd] Rgui.exe 4.2.0 does not receive characters via the 
> Windows API's PostMessage function
>
>>
>> On 5/6/22 07:03, jcfaria wrote:
>>> Dear Duncan,
>>> I believe the problem is of a different nature.
>>> I get TRUE 3 times running the code below:
>>>
>>> procedure TfMain.btnPasteClick(Sender: TObject);
>>> var
>>> ? i: integer;
>>> ? sTmp: string;
>>> ? hBN: HWND;
>>> ? j: bool;
>>>
>>> begin
>>> ? hBN:= FindWindowA(nil,
>>> ??????????????????? 'R Console (64-bit)');
>>>
>>> ? sTmp:= 'sd';
>>>
>>> ? for i:= 1 to Length(sTmp) do begin
>>> ??? j:= PostMessage(hBN,
>>> ??????????????????? WM_CHAR,
>>> ??????????????????? Ord(sTmp[i]),
>>> ??????????????????? 0);
>>>
>>> ??? ShowMessage(BoolToStr(j,
>>> ????????????????????????? True));
>>> ? end;
>>>
>>> ? j:= PostMessage(hBN,
>>> ????????????? WM_KEYDOWN,
>>> ????????????? VK_RETURN, 0);
>>>
>>> ? ShowMessage(BoolToStr(j,
>>> ??????????????????????? True));
>>> end;
>>>
>>> That is, Rgui is receiving the message of the characters (via 
>>> PostMessage), but it is blocking because it does not show them in 
>>> the console.
>>> The only thing Rgui blames is Carriage Return, as it adds an 
>>> additional prompt with each run.
>>
>> I can't provide a good guess what impacted your use, but if you could 
>> give me a full example, ideally in C, which can be compiled with 
>> Rtools42 (so gcc, MinGW) and I can edit/recompile, and works with R 
>> 4.1, I am happy to help debugging on 4.2.
>>
>> Rgui now uses GraphApp Unicode windows on systems where it didn't 
>> before, because it uses UTF-8 also on systems it didn't before (on 
>> systems that would use a single-byte locale in R 4.1). These Unicode 
>> windows are a different code path and there may be bugs not reported 
>> previously, including processing inputs (recently I fixed handling of 
>> accents, for example). Otherwise indeed R now uses UTF-8 as native 
>> encoding and UCRT as the C runtime.
>>
>> Best
>> Tomas
>>
>>
>>>
>>> >
>>> >
>>>
>>> Best,
>>> ///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\
>>> Jose Claudio Faria
>>> UESC/DCET/Brasil
>>> joseclaudio.faria at gmail.com
>>> Telefones:
>>> 55(73)3680.5545 - UESC
>>> 55(73)99966.9100 - VIVO
>>> ///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\
>>> If you have software to deal with statistics, you have arms,
>>> if you have good software, you have arms and legs,
>>> if you have software like R, you have arms, legs and wings...
>>> the height of your flight depends only on you.
>>>
>>> ------ Mensagem original ------
>>> De: "Duncan Murdoch" <murdoch.duncan at gmail.com>
>>> Para: "jcfaria" <joseclaudio.faria at gmail.com>; r-devel at r-project.org
>>> Enviado(s): 05/05/2022 13:17:53
>>> Assunto: Re: [Rd] Rgui.exe 4.2.0 does not receive characters via the 
>>> Windows API's PostMessage function
>>>
>>>> On 05/05/2022 11:17 a.m., jcfaria wrote:
>>>>> Hello,
>>>>>
>>>>> Rgui.exe 4.2.0 does not receive characters via the Windows API's
>>>>> PostMessage function.
>>>>>
>>>>> The Tinn-R project sends messages to Rgui.exe (SDI mode) via the 
>>>>> Windows
>>>>> API's PostMessage function.
>>>>> A simplification of the code (in object Pascal) can be seen below.
>>>>>
>>>>> procedure TfMain.btnPasteClick(Sender: TObject);
>>>>> var
>>>>> ??? i: integer;
>>>>> ??? sTmp: WideString;
>>>>> ??? hBN: HWND;
>>>>>
>>>>> begin
>>>>> ??? hBN:= FindWindowA(nil,
>>>>> ????????????????????? 'R Console (64-bit)');
>>>>>
>>>>> ??? sTmp:= 'sd';
>>>>>
>>>>> ??? for i:= 1 to Length(sTmp) do begin
>>>>> ????? PostMessage(hBN,
>>>>> ????????????????? WM_CHAR,
>>>>> ????????????????? Ord(sTmp[i]),
>>>>> ????????????????? 0);
>>>>> ??? end;
>>>>>
>>>>> ??? PostMessage(hBN,
>>>>> ??????????????? WM_KEYDOWN,
>>>>> ??????????????? VK_RETURN, 0);
>>>>> end;
>>>>>
>>>>> This code has always worked fine for all versions of Rgui.exe with 
>>>>> the
>>>>> exception of the last one released, ie 4.2.0.
>>>>>
>>>>> We've been trying to get around the problem on the Object Pascal 
>>>>> side,
>>>>> but without success so far.
>>>>>
>>>>> Does anyone connected to the compilation of Rqui.exe know what the
>>>>> problem is?
>>>>
>>>> It could be that the new build enforces Windows security more 
>>>> stringently.? More details are described in the answer to this 
>>>> question: https://stackoverflow.com/a/40139498/2554330, but at a 
>>>> minimum you should be checking the return value from PostMessage.
>>>>
>>>> Duncan Murdoch
>>>>
>>>>>
>>>>> Best,
>>>>> ///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\
>>>>> Jose Claudio Faria
>>>>> UESC/DCET/Brasil
>>>>> joseclaudio.faria at gmail.com
>>>>> Telefones:
>>>>> 55(73)3680.5545 - UESC
>>>>> 55(73)99966.9100 - VIVO
>>>>> ///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\
>>>>> If you have software to deal with statistics, you have arms,
>>>>> if you have good software, you have arms and legs,
>>>>> if you have software like R, you have arms, legs and wings...
>>>>> the height of your flight depends only on you.
>>>>>
>>>>> ??? [[alternative HTML version deleted]]
>>>>>
>>>>> ______________________________________________
>>>>> R-devel at r-project.org mailing list
>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From tom@@@k@||ber@ @end|ng |rom gm@||@com  Wed May 11 15:39:53 2022
From: tom@@@k@||ber@ @end|ng |rom gm@||@com (Tomas Kalibera)
Date: Wed, 11 May 2022 15:39:53 +0200
Subject: [Rd] Rgui.exe 4.2.0 does not receive characters via the Windows
 API's PostMessage function
In-Reply-To: <7bbdbe00-51e2-e9cf-ae16-5e969fb756b7@gmail.com>
References: <em26d64aef-2f66-415f-be9d-ae71a91c1d56@dell>
 <8e41c7bc-466c-ca00-6141-66520f8818b8@gmail.com>
 <em8cb2eaf6-27fe-4d26-84b2-3eef11fa9530@dell>
 <5e580ff4-ac60-6b79-e0d7-f9a84ee200d7@gmail.com>
 <em46f02f23-aa3d-4db3-9f88-1b338b047298@dell>
 <7bbdbe00-51e2-e9cf-ae16-5e969fb756b7@gmail.com>
Message-ID: <82957f65-28f0-cc11-b07b-1e6076d23d9c@gmail.com>


On 5/11/22 08:15, Tomas Kalibera wrote:
>
> On 5/11/22 03:02, jcfaria wrote:
>> Dear Tomas,
>> I've tried, but I don't have the necessary C/C++ programming skills 
>> to fulfill your request.
>>
>> Maybe someone can help us by transcribing the little code in object 
>> Pascal that I sent to C/C++.
>>
>> If a small executable, made in Object Pascal, can help in your debug, 
>> I can provide.
>
> Dear Jose,
>
> no problem, I can try out with the Pascal code.
> Is there a free compiler I can use to build and run it?

Actually I can reproduce it in a C program doing the same thing.

The primary cause is that Rgui is using GraphApp Unicode windows on 
systems running in a multi-byte locale, which affects most systems since 
R 4.2 because of the switch to UTF-8. While Unicode windows have been 
used even in older versions of R, it was only on systems then running in 
a multi-byte locale, and apparently this hasn't been reported.

When I modify R-devel to use non-Unicode GraphApp windows, the message 
sending works again. I will have a closer look, thanks for the report.

For reference, to reproduce I ran

Rgui --sdi

and used this C example:

#include <windows.h>
#include <stdio.h>
#include <string.h>

int main(int argc, char **argv) {
 ? HWND hw;
 ? int i, res;

 ? printf("Getting Rgui window...\n");
 ? hw = FindWindow(NULL, "R Console (64-bit)");

 ? printf("Got window: %x\n", hw);
 ? if (hw == NULL) {
 ??? printf("Could not get Rgui window: %x\n", GetLastError());
 ??? return 2;
 ? }

 ? char *sd = "sd";
 ? for(i = 0; i < strlen(sd); i++) {
 ??? res = PostMessage(hw, WM_CHAR, (unsigned int) sd[i], 0);
 ??? printf("Sending char %c: %d.\n", sd[i], res);
 ? }

 ? res = PostMessage(hw, WM_KEYDOWN, VK_RETURN, 0);
 ? printf("Sending return: %d\n.", res);
 ? return 0;
}

Best
Tomas


>
> Thanks
> Tomas
>
>>
>> Grateful for the attention,,
>> ///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\
>> Jose Claudio Faria
>> UESC/DCET/Brasil
>> joseclaudio.faria at gmail.com
>> Telefones:
>> 55(73)3680.5545 - UESC
>> 55(73)99966.9100 - VIVO
>> ///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\
>> If you have software to deal with statistics, you have arms,
>> if you have good software, you have arms and legs,
>> if you have software like R, you have arms, legs and wings...
>> the height of your flight depends only on you.
>>
>> ------ Mensagem original ------
>> De: "Tomas Kalibera" <tomas.kalibera at gmail.com>
>> Para: "jcfaria" <joseclaudio.faria at gmail.com>; "Duncan Murdoch" 
>> <murdoch.duncan at gmail.com>; r-devel at r-project.org
>> Enviado(s): 06/05/2022 04:24:44
>> Assunto: Re: [Rd] Rgui.exe 4.2.0 does not receive characters via the 
>> Windows API's PostMessage function
>>
>>>
>>> On 5/6/22 07:03, jcfaria wrote:
>>>> Dear Duncan,
>>>> I believe the problem is of a different nature.
>>>> I get TRUE 3 times running the code below:
>>>>
>>>> procedure TfMain.btnPasteClick(Sender: TObject);
>>>> var
>>>> ? i: integer;
>>>> ? sTmp: string;
>>>> ? hBN: HWND;
>>>> ? j: bool;
>>>>
>>>> begin
>>>> ? hBN:= FindWindowA(nil,
>>>> ??????????????????? 'R Console (64-bit)');
>>>>
>>>> ? sTmp:= 'sd';
>>>>
>>>> ? for i:= 1 to Length(sTmp) do begin
>>>> ??? j:= PostMessage(hBN,
>>>> ??????????????????? WM_CHAR,
>>>> ??????????????????? Ord(sTmp[i]),
>>>> ??????????????????? 0);
>>>>
>>>> ??? ShowMessage(BoolToStr(j,
>>>> ????????????????????????? True));
>>>> ? end;
>>>>
>>>> ? j:= PostMessage(hBN,
>>>> ????????????? WM_KEYDOWN,
>>>> ????????????? VK_RETURN, 0);
>>>>
>>>> ? ShowMessage(BoolToStr(j,
>>>> ??????????????????????? True));
>>>> end;
>>>>
>>>> That is, Rgui is receiving the message of the characters (via 
>>>> PostMessage), but it is blocking because it does not show them in 
>>>> the console.
>>>> The only thing Rgui blames is Carriage Return, as it adds an 
>>>> additional prompt with each run.
>>>
>>> I can't provide a good guess what impacted your use, but if you 
>>> could give me a full example, ideally in C, which can be compiled 
>>> with Rtools42 (so gcc, MinGW) and I can edit/recompile, and works 
>>> with R 4.1, I am happy to help debugging on 4.2.
>>>
>>> Rgui now uses GraphApp Unicode windows on systems where it didn't 
>>> before, because it uses UTF-8 also on systems it didn't before (on 
>>> systems that would use a single-byte locale in R 4.1). These Unicode 
>>> windows are a different code path and there may be bugs not reported 
>>> previously, including processing inputs (recently I fixed handling 
>>> of accents, for example). Otherwise indeed R now uses UTF-8 as 
>>> native encoding and UCRT as the C runtime.
>>>
>>> Best
>>> Tomas
>>>
>>>
>>>>
>>>> >
>>>> >
>>>>
>>>> Best,
>>>> ///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\
>>>> Jose Claudio Faria
>>>> UESC/DCET/Brasil
>>>> joseclaudio.faria at gmail.com
>>>> Telefones:
>>>> 55(73)3680.5545 - UESC
>>>> 55(73)99966.9100 - VIVO
>>>> ///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\
>>>> If you have software to deal with statistics, you have arms,
>>>> if you have good software, you have arms and legs,
>>>> if you have software like R, you have arms, legs and wings...
>>>> the height of your flight depends only on you.
>>>>
>>>> ------ Mensagem original ------
>>>> De: "Duncan Murdoch" <murdoch.duncan at gmail.com>
>>>> Para: "jcfaria" <joseclaudio.faria at gmail.com>; r-devel at r-project.org
>>>> Enviado(s): 05/05/2022 13:17:53
>>>> Assunto: Re: [Rd] Rgui.exe 4.2.0 does not receive characters via 
>>>> the Windows API's PostMessage function
>>>>
>>>>> On 05/05/2022 11:17 a.m., jcfaria wrote:
>>>>>> Hello,
>>>>>>
>>>>>> Rgui.exe 4.2.0 does not receive characters via the Windows API's
>>>>>> PostMessage function.
>>>>>>
>>>>>> The Tinn-R project sends messages to Rgui.exe (SDI mode) via the 
>>>>>> Windows
>>>>>> API's PostMessage function.
>>>>>> A simplification of the code (in object Pascal) can be seen below.
>>>>>>
>>>>>> procedure TfMain.btnPasteClick(Sender: TObject);
>>>>>> var
>>>>>> ??? i: integer;
>>>>>> ??? sTmp: WideString;
>>>>>> ??? hBN: HWND;
>>>>>>
>>>>>> begin
>>>>>> ??? hBN:= FindWindowA(nil,
>>>>>> ????????????????????? 'R Console (64-bit)');
>>>>>>
>>>>>> ??? sTmp:= 'sd';
>>>>>>
>>>>>> ??? for i:= 1 to Length(sTmp) do begin
>>>>>> ????? PostMessage(hBN,
>>>>>> ????????????????? WM_CHAR,
>>>>>> ????????????????? Ord(sTmp[i]),
>>>>>> ????????????????? 0);
>>>>>> ??? end;
>>>>>>
>>>>>> ??? PostMessage(hBN,
>>>>>> ??????????????? WM_KEYDOWN,
>>>>>> ??????????????? VK_RETURN, 0);
>>>>>> end;
>>>>>>
>>>>>> This code has always worked fine for all versions of Rgui.exe 
>>>>>> with the
>>>>>> exception of the last one released, ie 4.2.0.
>>>>>>
>>>>>> We've been trying to get around the problem on the Object Pascal 
>>>>>> side,
>>>>>> but without success so far.
>>>>>>
>>>>>> Does anyone connected to the compilation of Rqui.exe know what the
>>>>>> problem is?
>>>>>
>>>>> It could be that the new build enforces Windows security more 
>>>>> stringently.? More details are described in the answer to this 
>>>>> question: https://stackoverflow.com/a/40139498/2554330, but at a 
>>>>> minimum you should be checking the return value from PostMessage.
>>>>>
>>>>> Duncan Murdoch
>>>>>
>>>>>>
>>>>>> Best,
>>>>>> ///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\
>>>>>> Jose Claudio Faria
>>>>>> UESC/DCET/Brasil
>>>>>> joseclaudio.faria at gmail.com
>>>>>> Telefones:
>>>>>> 55(73)3680.5545 - UESC
>>>>>> 55(73)99966.9100 - VIVO
>>>>>> ///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\
>>>>>> If you have software to deal with statistics, you have arms,
>>>>>> if you have good software, you have arms and legs,
>>>>>> if you have software like R, you have arms, legs and wings...
>>>>>> the height of your flight depends only on you.
>>>>>>
>>>>>> ??? [[alternative HTML version deleted]]
>>>>>>
>>>>>> ______________________________________________
>>>>>> R-devel at r-project.org mailing list
>>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>>
>>>>
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>


From tom@@@k@||ber@ @end|ng |rom gm@||@com  Wed May 11 18:32:23 2022
From: tom@@@k@||ber@ @end|ng |rom gm@||@com (Tomas Kalibera)
Date: Wed, 11 May 2022 18:32:23 +0200
Subject: [Rd] Rgui.exe 4.2.0 does not receive characters via the Windows
 API's PostMessage function
In-Reply-To: <82957f65-28f0-cc11-b07b-1e6076d23d9c@gmail.com>
References: <em26d64aef-2f66-415f-be9d-ae71a91c1d56@dell>
 <8e41c7bc-466c-ca00-6141-66520f8818b8@gmail.com>
 <em8cb2eaf6-27fe-4d26-84b2-3eef11fa9530@dell>
 <5e580ff4-ac60-6b79-e0d7-f9a84ee200d7@gmail.com>
 <em46f02f23-aa3d-4db3-9f88-1b338b047298@dell>
 <7bbdbe00-51e2-e9cf-ae16-5e969fb756b7@gmail.com>
 <82957f65-28f0-cc11-b07b-1e6076d23d9c@gmail.com>
Message-ID: <a8733d02-ff78-a41b-446c-7347268bb27f@gmail.com>


On 5/11/22 15:39, Tomas Kalibera wrote:
>
> On 5/11/22 08:15, Tomas Kalibera wrote:
>>
>> On 5/11/22 03:02, jcfaria wrote:
>>> Dear Tomas,
>>> I've tried, but I don't have the necessary C/C++ programming skills 
>>> to fulfill your request.
>>>
>>> Maybe someone can help us by transcribing the little code in object 
>>> Pascal that I sent to C/C++.
>>>
>>> If a small executable, made in Object Pascal, can help in your 
>>> debug, I can provide.
>>
>> Dear Jose,
>>
>> no problem, I can try out with the Pascal code.
>> Is there a free compiler I can use to build and run it?
>
> Actually I can reproduce it in a C program doing the same thing.
>
> The primary cause is that Rgui is using GraphApp Unicode windows on 
> systems running in a multi-byte locale, which affects most systems 
> since R 4.2 because of the switch to UTF-8. While Unicode windows have 
> been used even in older versions of R, it was only on systems then 
> running in a multi-byte locale, and apparently this hasn't been reported.
>
> When I modify R-devel to use non-Unicode GraphApp windows, the message 
> sending works again. I will have a closer look, thanks for the report.

I had a closer look and this doesn't really seem to be a bug in R to me. 
For Unicode Windows, GraphApp uses WM_IME_COMPOSITION messages to read 
the keys instead of WM_CHAR, which it uses for non-Unicode windows. This 
is internal functionality of Rgui and a legitimate choice. Rgui cannot 
simply handle both messages in Unicode windows, because the characters 
would be doubled (if you see an easy, elegant change to Rgui that would 
mimic the previous behavior, let me know). This is certainly not a 
documented interface for Rgui, so I am afraid you would have to change 
something in your application.

I read that using PostMessage to simulate keyboard input is considered 
wrong, see [1], and then one should instead use SendInput (which then 
requires bringing the window to the foreground), if at all simulating 
keyboard input. Maybe one could create a better working solution that 
way, or using some automation library.

As a quick hack, I found that [2] happens to be working on my system, 
but again relying on the current implementation of Rgui (simply you send 
WM_KEYDOWN also for the characters other than the newline/return). It 
seems to be working also with R 4.1 for me.

The usual way for GUIs/front-ends is to "embed" R, to link it as a DLL. 
Rgui itself does it and also external applications such as RStudio. 
Typically you would want to have a thin layer application embedding R 
and make your GUI communicate with that, but switching to that from 
sending the messages would require some work.

Best
Tomas

[1] https://devblogs.microsoft.com/oldnewthing/20050530-11/?p=35513

[2]
#include <windows.h>
#include <stdio.h>
#include <string.h>

int main(int argc, char **argv) {
 ? HWND hw;
 ? int i, res;

 ? printf("Getting Rgui window...\n");
 ? hw = FindWindow(NULL, "R Console (64-bit)");

 ? printf("Got window: %x\n", hw);
 ? if (hw == NULL) {
 ??? printf("Could not get Rgui window: %x\n", GetLastError());
 ??? return 2;
 ? }

 ? char *sd = "sd";
 ? for(i = 0; i < strlen(sd); i++) {
 ??? res = PostMessage(hw, WM_KEYDOWN, VkKeyScan(sd[i]), 0);
 ??? printf("Sending char %c: %d.\n", sd[i], res);
 ? }

 ? res = PostMessage(hw, WM_KEYDOWN, VK_RETURN, 0);
 ? printf("Sending return: %d\n.", res);
 ? return 0;
}


>
> For reference, to reproduce I ran
>
> Rgui --sdi
>
> and used this C example:
>
> #include <windows.h>
> #include <stdio.h>
> #include <string.h>
>
> int main(int argc, char **argv) {
> ? HWND hw;
> ? int i, res;
>
> ? printf("Getting Rgui window...\n");
> ? hw = FindWindow(NULL, "R Console (64-bit)");
>
> ? printf("Got window: %x\n", hw);
> ? if (hw == NULL) {
> ??? printf("Could not get Rgui window: %x\n", GetLastError());
> ??? return 2;
> ? }
>
> ? char *sd = "sd";
> ? for(i = 0; i < strlen(sd); i++) {
> ??? res = PostMessage(hw, WM_CHAR, (unsigned int) sd[i], 0);
> ??? printf("Sending char %c: %d.\n", sd[i], res);
> ? }
>
> ? res = PostMessage(hw, WM_KEYDOWN, VK_RETURN, 0);
> ? printf("Sending return: %d\n.", res);
> ? return 0;
> }
>
> Best
> Tomas
>
>
>>
>> Thanks
>> Tomas
>>
>>>
>>> Grateful for the attention,,
>>> ///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\
>>> Jose Claudio Faria
>>> UESC/DCET/Brasil
>>> joseclaudio.faria at gmail.com
>>> Telefones:
>>> 55(73)3680.5545 - UESC
>>> 55(73)99966.9100 - VIVO
>>> ///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\
>>> If you have software to deal with statistics, you have arms,
>>> if you have good software, you have arms and legs,
>>> if you have software like R, you have arms, legs and wings...
>>> the height of your flight depends only on you.
>>>
>>> ------ Mensagem original ------
>>> De: "Tomas Kalibera" <tomas.kalibera at gmail.com>
>>> Para: "jcfaria" <joseclaudio.faria at gmail.com>; "Duncan Murdoch" 
>>> <murdoch.duncan at gmail.com>; r-devel at r-project.org
>>> Enviado(s): 06/05/2022 04:24:44
>>> Assunto: Re: [Rd] Rgui.exe 4.2.0 does not receive characters via the 
>>> Windows API's PostMessage function
>>>
>>>>
>>>> On 5/6/22 07:03, jcfaria wrote:
>>>>> Dear Duncan,
>>>>> I believe the problem is of a different nature.
>>>>> I get TRUE 3 times running the code below:
>>>>>
>>>>> procedure TfMain.btnPasteClick(Sender: TObject);
>>>>> var
>>>>> ? i: integer;
>>>>> ? sTmp: string;
>>>>> ? hBN: HWND;
>>>>> ? j: bool;
>>>>>
>>>>> begin
>>>>> ? hBN:= FindWindowA(nil,
>>>>> ??????????????????? 'R Console (64-bit)');
>>>>>
>>>>> ? sTmp:= 'sd';
>>>>>
>>>>> ? for i:= 1 to Length(sTmp) do begin
>>>>> ??? j:= PostMessage(hBN,
>>>>> ??????????????????? WM_CHAR,
>>>>> ??????????????????? Ord(sTmp[i]),
>>>>> ??????????????????? 0);
>>>>>
>>>>> ??? ShowMessage(BoolToStr(j,
>>>>> ????????????????????????? True));
>>>>> ? end;
>>>>>
>>>>> ? j:= PostMessage(hBN,
>>>>> ????????????? WM_KEYDOWN,
>>>>> ????????????? VK_RETURN, 0);
>>>>>
>>>>> ? ShowMessage(BoolToStr(j,
>>>>> ??????????????????????? True));
>>>>> end;
>>>>>
>>>>> That is, Rgui is receiving the message of the characters (via 
>>>>> PostMessage), but it is blocking because it does not show them in 
>>>>> the console.
>>>>> The only thing Rgui blames is Carriage Return, as it adds an 
>>>>> additional prompt with each run.
>>>>
>>>> I can't provide a good guess what impacted your use, but if you 
>>>> could give me a full example, ideally in C, which can be compiled 
>>>> with Rtools42 (so gcc, MinGW) and I can edit/recompile, and works 
>>>> with R 4.1, I am happy to help debugging on 4.2.
>>>>
>>>> Rgui now uses GraphApp Unicode windows on systems where it didn't 
>>>> before, because it uses UTF-8 also on systems it didn't before (on 
>>>> systems that would use a single-byte locale in R 4.1). These 
>>>> Unicode windows are a different code path and there may be bugs not 
>>>> reported previously, including processing inputs (recently I fixed 
>>>> handling of accents, for example). Otherwise indeed R now uses 
>>>> UTF-8 as native encoding and UCRT as the C runtime.
>>>>
>>>> Best
>>>> Tomas
>>>>
>>>>
>>>>>
>>>>> >
>>>>> >
>>>>>
>>>>> Best,
>>>>> ///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\
>>>>> Jose Claudio Faria
>>>>> UESC/DCET/Brasil
>>>>> joseclaudio.faria at gmail.com
>>>>> Telefones:
>>>>> 55(73)3680.5545 - UESC
>>>>> 55(73)99966.9100 - VIVO
>>>>> ///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\
>>>>> If you have software to deal with statistics, you have arms,
>>>>> if you have good software, you have arms and legs,
>>>>> if you have software like R, you have arms, legs and wings...
>>>>> the height of your flight depends only on you.
>>>>>
>>>>> ------ Mensagem original ------
>>>>> De: "Duncan Murdoch" <murdoch.duncan at gmail.com>
>>>>> Para: "jcfaria" <joseclaudio.faria at gmail.com>; r-devel at r-project.org
>>>>> Enviado(s): 05/05/2022 13:17:53
>>>>> Assunto: Re: [Rd] Rgui.exe 4.2.0 does not receive characters via 
>>>>> the Windows API's PostMessage function
>>>>>
>>>>>> On 05/05/2022 11:17 a.m., jcfaria wrote:
>>>>>>> Hello,
>>>>>>>
>>>>>>> Rgui.exe 4.2.0 does not receive characters via the Windows API's
>>>>>>> PostMessage function.
>>>>>>>
>>>>>>> The Tinn-R project sends messages to Rgui.exe (SDI mode) via the 
>>>>>>> Windows
>>>>>>> API's PostMessage function.
>>>>>>> A simplification of the code (in object Pascal) can be seen below.
>>>>>>>
>>>>>>> procedure TfMain.btnPasteClick(Sender: TObject);
>>>>>>> var
>>>>>>> ??? i: integer;
>>>>>>> ??? sTmp: WideString;
>>>>>>> ??? hBN: HWND;
>>>>>>>
>>>>>>> begin
>>>>>>> ??? hBN:= FindWindowA(nil,
>>>>>>> ????????????????????? 'R Console (64-bit)');
>>>>>>>
>>>>>>> ??? sTmp:= 'sd';
>>>>>>>
>>>>>>> ??? for i:= 1 to Length(sTmp) do begin
>>>>>>> ????? PostMessage(hBN,
>>>>>>> ????????????????? WM_CHAR,
>>>>>>> ????????????????? Ord(sTmp[i]),
>>>>>>> ????????????????? 0);
>>>>>>> ??? end;
>>>>>>>
>>>>>>> ??? PostMessage(hBN,
>>>>>>> ??????????????? WM_KEYDOWN,
>>>>>>> ??????????????? VK_RETURN, 0);
>>>>>>> end;
>>>>>>>
>>>>>>> This code has always worked fine for all versions of Rgui.exe 
>>>>>>> with the
>>>>>>> exception of the last one released, ie 4.2.0.
>>>>>>>
>>>>>>> We've been trying to get around the problem on the Object Pascal 
>>>>>>> side,
>>>>>>> but without success so far.
>>>>>>>
>>>>>>> Does anyone connected to the compilation of Rqui.exe know what the
>>>>>>> problem is?
>>>>>>
>>>>>> It could be that the new build enforces Windows security more 
>>>>>> stringently.? More details are described in the answer to this 
>>>>>> question: https://stackoverflow.com/a/40139498/2554330, but at a 
>>>>>> minimum you should be checking the return value from PostMessage.
>>>>>>
>>>>>> Duncan Murdoch
>>>>>>
>>>>>>>
>>>>>>> Best,
>>>>>>> ///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\
>>>>>>> Jose Claudio Faria
>>>>>>> UESC/DCET/Brasil
>>>>>>> joseclaudio.faria at gmail.com
>>>>>>> Telefones:
>>>>>>> 55(73)3680.5545 - UESC
>>>>>>> 55(73)99966.9100 - VIVO
>>>>>>> ///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\///\\\
>>>>>>> If you have software to deal with statistics, you have arms,
>>>>>>> if you have good software, you have arms and legs,
>>>>>>> if you have software like R, you have arms, legs and wings...
>>>>>>> the height of your flight depends only on you.
>>>>>>>
>>>>>>> ??? [[alternative HTML version deleted]]
>>>>>>>
>>>>>>> ______________________________________________
>>>>>>> R-devel at r-project.org mailing list
>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>>>
>>>>>
>>>>> ______________________________________________
>>>>> R-devel at r-project.org mailing list
>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>


From cvoeten @end|ng |rom gm@||@com  Wed May 11 21:16:25 2022
From: cvoeten @end|ng |rom gm@||@com (Cesko Voeten)
Date: Wed, 11 May 2022 21:16:25 +0200
Subject: [Rd] Regression in 4.2.0: unable to type special characters in
 Windows RGui
In-Reply-To: <f16306c8-4c08-c0a9-b2f6-f91eb2983c25@gmail.com>
References: <027b1c8f-c479-e269-4824-2c1ff0507e4a@gmail.com>
 <a44a69d2-987e-b2a9-2559-acc810ebc17e@gmail.com>
 <5d91c1ac-b6e2-e446-5e23-8430514ddfb8@gmail.com>
 <f16306c8-4c08-c0a9-b2f6-f91eb2983c25@gmail.com>
Message-ID: <f84b6cbc-3273-0db0-ebd2-6c14893ba304@gmail.com>

Hi Tomas,

>> ?- Some accents don't work. For instance, pressing 'a produces ?, but pressing 'a produces 'a rather than ?. From my testing, `^~ seem to work as expected, but '" don't.
> 
> I could reproduce this on the US International keyboard and it is fixed now. There may be missing support for more accents, so if you or anyone else find about them, please let me know.
> 
>> ?- Nonexistent deadkey combinations are handled differently from native Windows. For example, typing ~^ should output ~^, but produces nothing. Typing ~^a should output ~^a, but actually yields ~?. So it seems that the first ~ is correctly translated to the tilde symbol, but simultaneously the second ^ is being treated as a new deadkey press, which other Windows programs don't do in this case.
> Thanks, fixed now. It was another bug in the old code, plus a "feature" I added that by pressing e.g. the dead-key apostrophe twice you get it printed only once (this is what Linux does and I find it more natural). But I made it now to work as usual on Windows.
>> ?- Related to the above two issues, '& should produce '&, while it only gives &. This again affects only '" --- something like ^& correctly produces ^&.
> 
> It should be fixed by now as well.
> 
> The fixes are in 82332 (R-patched) and 82331 (R-devel). If you could test again after the snapshot build gets there, that would be great. It is easy to miss something.
> 
> When testing now, I've been using http://kbdlayout.info/ as a reference for several keyboard layouts on Windows, to find how to type different dead-keys. That can give you also names of the deadkeys, which can be easily communicated without having to copy-paste from the Rgui window. On some layouts, additional deadkeys are available with right Alt (AltGr).

Everything indeed seems fixed on today's R-devel build. I haven't noticed any other behavior that is different from what I was normally expecting on Windows.

>> Also, I'm noticing only now that selecting typed text in RGui and pressing Ctrl deletes that text, so trying to Ctrl+C text that I typed is kind of awkward. But this might simply be a feature that I wasn't aware of before.
> 
> Interesting. It isn't happening on my system, but I can't tell whether it is a "feature" under some circumstances. Maybe you can try to find out more about this: whether it is repeatable, whether it depends on some setting, whether it was happening also in R 4.1, etc.

I haven't been able to reproduce this, so this was probably a glitch on my end (PEBKAC?) or a transient issue in R-devel that has been resolved since.

Thank you for your hard work! Now I'm really looking forward to R 4.2.1 :)

Cesko


From tom@@@k@||ber@ @end|ng |rom gm@||@com  Thu May 12 11:50:42 2022
From: tom@@@k@||ber@ @end|ng |rom gm@||@com (Tomas Kalibera)
Date: Thu, 12 May 2022 11:50:42 +0200
Subject: [Rd] Regression in 4.2.0: unable to type special characters in
 Windows RGui
In-Reply-To: <f84b6cbc-3273-0db0-ebd2-6c14893ba304@gmail.com>
References: <027b1c8f-c479-e269-4824-2c1ff0507e4a@gmail.com>
 <a44a69d2-987e-b2a9-2559-acc810ebc17e@gmail.com>
 <5d91c1ac-b6e2-e446-5e23-8430514ddfb8@gmail.com>
 <f16306c8-4c08-c0a9-b2f6-f91eb2983c25@gmail.com>
 <f84b6cbc-3273-0db0-ebd2-6c14893ba304@gmail.com>
Message-ID: <db4774d4-4743-27b3-6498-f3792eb2ba1b@gmail.com>


On 5/11/22 21:16, Cesko Voeten wrote:
> Hi Tomas,
>
>>> ?- Some accents don't work. For instance, pressing 'a produces ?, 
>>> but pressing 'a produces 'a rather than ?. From my testing, `^~ seem 
>>> to work as expected, but '" don't.
>>
>> I could reproduce this on the US International keyboard and it is 
>> fixed now. There may be missing support for more accents, so if you 
>> or anyone else find about them, please let me know.
>>
>>> ?- Nonexistent deadkey combinations are handled differently from 
>>> native Windows. For example, typing ~^ should output ~^, but 
>>> produces nothing. Typing ~^a should output ~^a, but actually yields 
>>> ~?. So it seems that the first ~ is correctly translated to the 
>>> tilde symbol, but simultaneously the second ^ is being treated as a 
>>> new deadkey press, which other Windows programs don't do in this case.
>> Thanks, fixed now. It was another bug in the old code, plus a 
>> "feature" I added that by pressing e.g. the dead-key apostrophe twice 
>> you get it printed only once (this is what Linux does and I find it 
>> more natural). But I made it now to work as usual on Windows.
>>> ?- Related to the above two issues, '& should produce '&, while it 
>>> only gives &. This again affects only '" --- something like ^& 
>>> correctly produces ^&.
>>
>> It should be fixed by now as well.
>>
>> The fixes are in 82332 (R-patched) and 82331 (R-devel). If you could 
>> test again after the snapshot build gets there, that would be great. 
>> It is easy to miss something.
>>
>> When testing now, I've been using http://kbdlayout.info/ as a 
>> reference for several keyboard layouts on Windows, to find how to 
>> type different dead-keys. That can give you also names of the 
>> deadkeys, which can be easily communicated without having to 
>> copy-paste from the Rgui window. On some layouts, additional deadkeys 
>> are available with right Alt (AltGr).
>
> Everything indeed seems fixed on today's R-devel build. I haven't 
> noticed any other behavior that is different from what I was normally 
> expecting on Windows.

Hi Cesko,

>>> Also, I'm noticing only now that selecting typed text in RGui and 
>>> pressing Ctrl deletes that text, so trying to Ctrl+C text that I 
>>> typed is kind of awkward. But this might simply be a feature that I 
>>> wasn't aware of before.
>>
>> Interesting. It isn't happening on my system, but I can't tell 
>> whether it is a "feature" under some circumstances. Maybe you can try 
>> to find out more about this: whether it is repeatable, whether it 
>> depends on some setting, whether it was happening also in R 4.1, etc.
>
> I haven't been able to reproduce this, so this was probably a glitch 
> on my end (PEBKAC?) or a transient issue in R-devel that has been 
> resolved since.
Thanks, so hopefully it is ok.
>
> Thank you for your hard work! Now I'm really looking forward to R 
> 4.2.1 :)

thanks a lot for the testing and the report.

Tomas

>
> Cesko


From peter@|@ng|e|der @end|ng |rom gm@||@com  Fri May 13 04:08:34 2022
From: peter@|@ng|e|der @end|ng |rom gm@||@com (Peter Langfelder)
Date: Thu, 12 May 2022 19:08:34 -0700
Subject: [Rd] hist.default for long vectors
Message-ID: <CA+hbrhUBqcP9m6P9jm7i74VU2feH=+PLavVZ9qoVOb6DSZthtQ@mail.gmail.com>

Hi all,

this may have been noticed/discussed before but my search came up
empty, so here it is: hist.default throws a (somewhat cryptic) error
when trying to call it on a long vector. The error is

invalid length(x)

and is thrown because lines 4 and 5 or so are

n <- length(x <- x[is.finite(x)])
n <- as.integer(n)

Would adapting hist.default for long vectors be as simple as removing
the as.integer line, or is there other code that depends on n being
representable as a 4-byte integer? I see a 'call' to C_BinCount which
I briefly skimmed and it seems to be ready for long vectors (uses
R_xlen_t for indexing variables). Anything else I am missing?

While we're at it, anyone aware of a hist alternative that can handle
long vectors?

Thanks,

Peter


From ||v|u @end|ng |rom p@tchmypc@com  Fri May 13 15:39:53 2022
From: ||v|u @end|ng |rom p@tchmypc@com (Liviu Barbat)
Date: Fri, 13 May 2022 13:39:53 +0000
Subject: [Rd] R-4.2.0-win.exe
Message-ID: <IA1PR12MB6556163AD90640BD75D078B2B3CA9@IA1PR12MB6556.namprd12.prod.outlook.com>

Hey Team,

The 4.2.0 installer is not digitally signed, is that on purpose? The previous releases have been digitally signed.
Is it just a one-off or is this going to be the new default?

Thanks,

Liviu Barbat ? Customer Success Engineer
Rate Your Experience: Great<https://patchmypc.com/customer-feedback-Liviu> | Good<https://patchmypc.com/customer-feedback-Liviu> | Poor<https://patchmypc.com/customer-feedback-Liviu>
Learn More: Live Demo<https://patchmypc.com/schedule-live-demo> | Setup Call<https://patchmypc.com/schedule-setup-call> | Review Call<https://patchmypc.com/environment-review-call> | Trial<https://patchmypc.com/free-trial> | Quote<https://patchmypc.com/request-quote>
Follow Us: Twitter<https://patchmypc.com/twitter> | LinkedIn<https://patchmypc.com/linkedin>
Sales and Support: + 1-866-343-3083
[Sent from Front]

	[[alternative HTML version deleted]]


From pb @end|ng |rom |n|o||nk@com@br  Fri May 13 21:44:09 2022
From: pb @end|ng |rom |n|o||nk@com@br (Paulo Barata)
Date: Fri, 13 May 2022 16:44:09 -0300
Subject: [Rd] Writing in R // R 4.2.0 on Windows doesn't work with Dasher
Message-ID: <787fa700-0ea6-9639-f123-5fd585d0e056@infolink.com.br>

To the R developers,

I would like to point out an issue that occurs with the new R 4.2.0 
running on Windows; this is possibly related to the recent wide changes 
made to the Windows port of R. The issue has to do with writing of the R 
window.

My computer runs on Windows 10 Professional 64-bit with all the latest 
updates, and has a 4-core 8-thread Intel Xeon processor with 32 Gb of RAM.

I have some slight impairment in my hands, so for typing I avoid using 
the computer keyboard as much as possible. For most of my typing, I use 
the software Dasher, a kind of assistive technology software. Dasher was 
created by the Inference Group led by Professor David MacKay (died in 
2016) at Cambridge University in England. Later, Dasher was further 
developed by Ada Majorek (a Google engineer, recently deceased).

General information on Dasher and about the Dasher Project can be found 
on the Inference Group page:

http://www.inference.org.uk/dasher/

An example of Dasher in action can be seen on this 2-minute YouTube video:

https://www.youtube.com/watch?v=nr3s4613DX8

An one-hour YouTube video of a 2007 Google Talk by Professor MacKay 
himself explaining the Dasher concept can be found here:

https://www.youtube.com/watch?v=wpOxbesRNBc

In the 2-minute video (the first YouTube address above), the sentence 
written through Dasher, for actual use, needs to be copied and then 
pasted into another software, say a text editor. But Dasher also has a 
"Direct Entry" mode, where words typed are entered directly on the 
screen of the text editor or other software -- this is how I use Dasher 
to write on the R window.

Using Dasher`s "Direct Entry" mode, for all effects, to write a word 
through Dasher works exactly like writing the word through the normal 
computer keyboard. Somehow (I do not know about system programming), in 
"Direct Entry" mode, the output of Dasher is understood by the computer 
as an input of the same nature as a keyboard input.

But this is the issue: until R 4.1.3, R accepted normally the 
word-typing through Dasher. But R 4.2.0 (and R 4.2.0-patched build 
r82348, 12 May 2022) does not accept Dasher anymore.

So, for now, if I wish to use R during some extended interactive section 
(say, for a first look at a complex data set), and if I wish to use 
Dasher for this interactive session, then I have to use R 4.1.3. For 
using R through programming, I can use the new R 4.2.0, by writing the 
program with Dasher in my text editor, and then pasting that program into R.

The latest Windows version of Dasher, version 5.0.0 beta, works 
perfectly well with text editors (I use EditPad Pro), with 
Microsoft-like Office packages (I use SoftMaker Office), for writing 
e-mails (I use Mozilla Thunderbird), for writing on a web page (I use 
mostly Mozilla Firefox). It worked perfectly well with R up to version 
4.1.3, but it does not work with R 4.2.0

The latest Dasher 5.0.0 beta Windows installer and the source code can 
be found on this page below (please click on "Windows installer" and on 
"source code", just below the head "Dasher 5.0 beta release"):

https://github.com/dasher-project/dasher/releases

To set Dasher 5.0.0 beta to the "Direct Entry" mode, after installing 
Dasher one should go to Preferences > Application > Application Style.

Currently, after the passing of Ada Majorek, the Dasher Project is being 
put forward by a group of people in England, but, it seems, at a very 
slow pace. They have announced the existence of a version 6 beta, but 
this is only an online instance of Dasher, there is no Windows 
installer, as far as I know. Their web page:

https://dasher.acecentre.net/

For me, and possibly for other users, the Dasher version 5.0.0 beta for 
Windows that is available works perfectly well, and allows me to use the 
computer with a proficiency that would be hardly possible otherwise.

Here I request that the R developers take a look at this word-typing 
issue that happens with the new R 4.2.0 on Windows.

As an R user (I work in ecological research), I can only thank the R 
team for this really wonderful piece of statistical software that you 
make freely available to us all.

Regards,

Paulo Barata

(Rio de Janeiro - Brazil)


