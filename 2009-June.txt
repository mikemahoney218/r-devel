From bokov at uthscsa.edu  Mon Jun  1 07:24:58 2009
From: bokov at uthscsa.edu (Alex Bokov)
Date: Mon, 01 Jun 2009 00:24:58 -0500
Subject: [Rd] Recommendations for a quick UI.
Message-ID: <4A23662A.5030609@uthscsa.edu>

Hi. This is my first post to this list, I seem to be graduating to from 
the r-help list. :-)

I'm trying to wrap my R package in a GUI such that when the user 
launches the app, they see my GUI window and never interact with the R 
console at all. I don't have any fancy requirements for the GUI itself-- 
all it needs to do is collect input from the user and pass the input as 
arguments to an R function, which writes the results to a file.

I read the R Extensions Manual section about GUIs, and it seems like 
overkill to write the thing in a compiled language and link against R as 
a library when there are dozens of different interpreted cross-platform 
GUI toolkits out there. Does anybody know of any functioning examples of 
packages (or other add-ons) with GUIs that run R silently in the 
background which I can study? Do they use the "R CMD BATCH" mechanism, 
or something else?

Thanks.


From gaidys at uol.com.br  Mon Jun  1 03:35:12 2009
From: gaidys at uol.com.br (gaidys at uol.com.br)
Date: Mon,  1 Jun 2009 03:35:12 +0200 (CEST)
Subject: [Rd] LM/GLM can't find weights vector from within a function
	(PR#13735)
Message-ID: <20090601013512.88D6A2830314@mail.pubhealth.ku.dk>

Full_Name: Alberto Gaidys
Version: 2.9.0
OS: Mac OS X 10.5.7
Submission from: (NULL) (201.81.185.155)


When calling LM or GLM from within a function, R gives a message error that it
can't find the specified weights object "Erro em eval(expr, envir, enclos) :
objeto 'W' n?o encontrado" (Error in eval(expr, envir, enclos) : object 'W' not
found). 

The call from within the user-defined function where the error happens is:

   rReg<-lm(formula=rFormula,data=rData,subset=1:i,weights=W,x=TRUE,y=TRUE)

where rFormula is a text string, rData is a 1422 x 17 timeSeries data matrix,
both passed from the console, i is a counter, W is a 1422 x 1 numeric vector of
weights declared locally within the function.

The function definition is as follows:

   redls<-function(rFormula, rData, nStart, rBeta=1., nDelayed=3)

I already tried to define W externally to the function and parse it as a
parameter, change its name, declare it as an array, declare it as a timeSeries
object, with always the same error. Invoking glm instead of lm gives also the
same error. The ls.str listing of W immediately before calling lm, showing it
does exist, is:

   W :  num [1:1422(1d)] 0.00628 0.0064 0.00654 0.00667 0.00681 ...

The exactly same lm call, with the objects created exactly the same way from the
console produces no error though.


From ripley at stats.ox.ac.uk  Mon Jun  1 10:12:09 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 1 Jun 2009 09:12:09 +0100 (BST)
Subject: [Rd] (PR#13735) LM/GLM can't find weights vector from within a
 function
In-Reply-To: <20090601013512.88D6A2830314@mail.pubhealth.ku.dk>
References: <20090601013512.88D6A2830314@mail.pubhealth.ku.dk>
Message-ID: <alpine.LFD.2.00.0906010907290.19524@gannet.stats.ox.ac.uk>

This seems to be as documented.  From ?lm

      All of 'weights', 'subset' and 'offset' are evaluated in the same
      way as variables in 'formula', that is first in 'data' and then in
      the environment of 'formula'.

We don't have a reproducible example and so do not know where rFormula 
was defined -- but it seems likely that W is not defined in its 
environment.  If you believe otherwise, we need a complete example.

Incidentally, str() reports that W is a 1D array, not a vector.

On Mon, 1 Jun 2009, gaidys at uol.com.br wrote:

> Full_Name: Alberto Gaidys
> Version: 2.9.0
> OS: Mac OS X 10.5.7
> Submission from: (NULL) (201.81.185.155)
>
>
> When calling LM or GLM from within a function, R gives a message error that it
> can't find the specified weights object "Erro em eval(expr, envir, enclos) :
> objeto 'W' n?o encontrado" (Error in eval(expr, envir, enclos) : object 'W' not
> found).
>
> The call from within the user-defined function where the error happens is:
>
>   rReg<-lm(formula=rFormula,data=rData,subset=1:i,weights=W,x=TRUE,y=TRUE)
>
> where rFormula is a text string, rData is a 1422 x 17 timeSeries data matrix,
> both passed from the console, i is a counter, W is a 1422 x 1 numeric vector of
> weights declared locally within the function.
>
> The function definition is as follows:
>
>   redls<-function(rFormula, rData, nStart, rBeta=1., nDelayed=3)
>
> I already tried to define W externally to the function and parse it as a
> parameter, change its name, declare it as an array, declare it as a timeSeries
> object, with always the same error. Invoking glm instead of lm gives also the
> same error. The ls.str listing of W immediately before calling lm, showing it
> does exist, is:
>
>   W :  num [1:1422(1d)] 0.00628 0.0064 0.00654 0.00667 0.00681 ...
>
> The exactly same lm call, with the objects created exactly the same way from the
> console produces no error though.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From christian_m10 at hotmail.com  Mon Jun  1 13:33:19 2009
From: christian_m10 at hotmail.com (Christian Morgenstern)
Date: Mon, 1 Jun 2009 11:33:19 +0000
Subject: [Rd] Reshaping Data
Message-ID: <SNT102-W21216E4F6BF4FE8A64C5CB8D4C0@phx.gbl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090601/ed2cd624/attachment.pl>

From zemlys at gmail.com  Mon Jun  1 12:55:08 2009
From: zemlys at gmail.com (zemlys at gmail.com)
Date: Mon,  1 Jun 2009 12:55:08 +0200 (CEST)
Subject: [Rd] Mistake in CP1257.enc file of grDevices package (PR#13736)
Message-ID: <20090601105508.9DBF42830314@mail.pubhealth.ku.dk>

Full_Name: Vaidotas Zemlys
Version: 2.9.0
OS: Ubuntu 8.10
Submission from: (NULL) (213.197.173.50)


Hi,

This is the same bug as bug #9845. Encodings CP1257 and ISOLatin7 are used for
Lithuanian and Latvian languages. They differ only by certain symbols such as
quotation marks. Instead of umacron and Umacron there are symbols ucircmuflex
and Ucircumflex in file CP1257.enc, which belongs to package grDevices. 

To see the problem compare the outputs 

> postscript(encoding="CP1257.enc")
> plot(rnorm(100),main="\u016B\u016A")
> dev.off()

and

plot(rnorm(100),main="\u016B\u016A").

This bug appears only in Windows environment with Lithuanian locale, since only
then CP1257 is used as default encoding.

Changing [uU]circumflex to [uU]macron in file CP1257.enc fixes the problem.


Vaidotas Zemlys


From maechler at stat.math.ethz.ch  Mon Jun  1 15:17:30 2009
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Mon, 1 Jun 2009 15:17:30 +0200
Subject: [Rd] Reshaping Data -- do use R-help !
In-Reply-To: <SNT102-W21216E4F6BF4FE8A64C5CB8D4C0@phx.gbl>
References: <SNT102-W21216E4F6BF4FE8A64C5CB8D4C0@phx.gbl>
Message-ID: <18979.54506.41189.877471@cmath-5.math.ethz.ch>

Dear Christian,

your question does not at all belong to R-devel.
Please use R-help instead, 
but you should probably first read the posting guide,
(and from that see that you should *not* send HTML-ified
postings).

Regards, Martin Maechler

>>>>> "CM" == Christian Morgenstern <christian_m10 at hotmail.com>
>>>>>     on Mon, 1 Jun 2009 11:33:19 +0000 writes:

    CM> Hi,

    CM> i did a mistake with my first post.

    CM> I have to reshape data from this matrix:

[..................]


    CM> 	[[alternative HTML version deleted]]


From maechler at stat.math.ethz.ch  Mon Jun  1 15:21:10 2009
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Mon, 1 Jun 2009 15:21:10 +0200
Subject: [Rd] Recommendations for a quick UI.
In-Reply-To: <4A23662A.5030609@uthscsa.edu>
References: <4A23662A.5030609@uthscsa.edu>
Message-ID: <18979.54726.247587.937870@cmath-5.math.ethz.ch>

>>>>> "AB" == Alex Bokov <bokov at uthscsa.edu>
>>>>>     on Mon, 01 Jun 2009 00:24:58 -0500 writes:

    AB> Hi. This is my first post to this list, I seem to be
    AB> graduating to from the r-help list. :-)

well....

    AB> I'm trying to wrap my R package in a GUI such that when
    AB> the user launches the app, they see my GUI window and
    AB> never interact with the R console at all. I don't have
    AB> any fancy requirements for the GUI itself-- all it needs
    AB> to do is collect input from the user and pass the input
    AB> as arguments to an R function, which writes the results
    AB> to a file.

    AB> I read the R Extensions Manual section about GUIs, and
    AB> it seems like overkill to write the thing in a compiled
    AB> language and link against R as a library when there are
    AB> dozens of different interpreted cross-platform GUI
    AB> toolkits out there. Does anybody know of any functioning
    AB> examples of packages (or other add-ons) with GUIs that
    AB> run R silently in the background which I can study? Do
    AB> they use the "R CMD BATCH" mechanism, or something else?

There's a dedicated "Special Interest Group" mailing list for
answering / discussing such questions :

	  R-SIG-GUI

Please subscribe and ask there
 --> https://stat.ethz.ch/mailman/listinfo/r-sig-gui

Regards,
Martin Maechler, ETH Zurich


From krcoombes at mdacc.tmc.edu  Mon Jun  1 15:21:33 2009
From: krcoombes at mdacc.tmc.edu (Kevin R. Coombes)
Date: Mon, 01 Jun 2009 08:21:33 -0500
Subject: [Rd] Recommendations for a quick UI.
In-Reply-To: <4A23662A.5030609@uthscsa.edu>
References: <4A23662A.5030609@uthscsa.edu>
Message-ID: <4A23D5DD.8060807@mdacc.tmc.edu>

Hi,

The following idea only partially answers your question....

I have successfully written a GUI using the tcl/tk package that ships 
with standard R. It is then possible (in Windows) to create a shortcut 
icon that runs the following command:
    C:\R\R-2.8.1\bin\R.exe --vanilla -e library(SuperCurveGUI);sc();
Note two features:
[1] the first part of the -e switch loads the library containing the GUI
[2] the second part (after the semicolon) launches the GUI

If you make a "normal" shortcut this way, a batch window will open 
showing the ongoing R session, which is not quite what you want. 
However, if you adjust the shortcut to "Run: Minimized", then (most) 
users will never see the batch window, and will only see the GUI.

The reasons that this only partially answers your question are
[1] It is Windows-specific
[2] I do not know how to set up the shortcut automatically upon 
installation.

    Kevin

Alex Bokov wrote:
> Hi. This is my first post to this list, I seem to be graduating to 
> from the r-help list. :-)
>
> I'm trying to wrap my R package in a GUI such that when the user 
> launches the app, they see my GUI window and never interact with the R 
> console at all. I don't have any fancy requirements for the GUI 
> itself-- all it needs to do is collect input from the user and pass 
> the input as arguments to an R function, which writes the results to a 
> file.
>
> I read the R Extensions Manual section about GUIs, and it seems like 
> overkill to write the thing in a compiled language and link against R 
> as a library when there are dozens of different interpreted 
> cross-platform GUI toolkits out there. Does anybody know of any 
> functioning examples of packages (or other add-ons) with GUIs that run 
> R silently in the background which I can study? Do they use the "R CMD 
> BATCH" mechanism, or something else?
>
> Thanks.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From maechler at stat.math.ethz.ch  Mon Jun  1 15:31:31 2009
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Mon, 1 Jun 2009 15:31:31 +0200
Subject: [Rd] as.numeric(levels(factor(x))) may be a decreasing sequence
In-Reply-To: <20090531082941.GA12517@cs.cas.cz>
References: <20090523074454.GA17112@cs.cas.cz>
	<18973.42970.826686.173830@cmath-5.math.ethz.ch>
	<4A1DC057.80401@idi.ntnu.no>
	<18975.59582.885300.549159@lynne.math.ethz.ch>
	<4A203D67.8000007@idi.ntnu.no>
	<3f1d2410905291448y271fa484te82b8dbaa547017f@mail.gmail.com>
	<4A20F97B.1090406@idi.ntnu.no>
	<18977.28100.532043.734122@cmath-4.math.ethz.ch>
	<20090531082941.GA12517@cs.cas.cz>
Message-ID: <18979.55347.718851.606502@cmath-5.math.ethz.ch>

>>>>> "PS" == Petr Savicky <savicky at cs.cas.cz>
>>>>>     on Sun, 31 May 2009 10:29:41 +0200 writes:

[............]

    PS> I appreciate the current version, which contains static
    PS> const char* dropTrailing0(char *s, char cdec) ...
    PS> mkChar(dropTrailing0((char *)EncodeReal(x, w, d, e,
    PS> OutDec), ...

    PS> Here, is better visible that the cast (char *) is used
    PS> than if it was hidden inside dropTrailing0(). Also, it
    PS> makes dropTrailing0() more consistent.

    PS> I would like to recall the already discussed
    PS> modification if (replace != p) while((*(replace++) =
    PS> *(p++))) ; which saves a few instructions in the more
    PS> frequent case that there are no trailing zeros.

Yes,  thank you.  This already was in my working version,
and I had managed to lose it again.
Will put i back

.... still hoping this topic would be closed now ...
Martin


From Waclaw.Marcin.Kusnierczyk at idi.ntnu.no  Mon Jun  1 16:30:01 2009
From: Waclaw.Marcin.Kusnierczyk at idi.ntnu.no (Wacek Kusnierczyk)
Date: Mon, 01 Jun 2009 16:30:01 +0200
Subject: [Rd] as.numeric(levels(factor(x))) may be a decreasing sequence
In-Reply-To: <18979.55347.718851.606502@cmath-5.math.ethz.ch>
References: <20090523074454.GA17112@cs.cas.cz>	<18973.42970.826686.173830@cmath-5.math.ethz.ch>	<4A1DC057.80401@idi.ntnu.no>	<18975.59582.885300.549159@lynne.math.ethz.ch>	<4A203D67.8000007@idi.ntnu.no>	<3f1d2410905291448y271fa484te82b8dbaa547017f@mail.gmail.com>	<4A20F97B.1090406@idi.ntnu.no>	<18977.28100.532043.734122@cmath-4.math.ethz.ch>	<20090531082941.GA12517@cs.cas.cz>
	<18979.55347.718851.606502@cmath-5.math.ethz.ch>
Message-ID: <4A23E5E9.5090209@idi.ntnu.no>

Martin Maechler wrote:
>>>>>> "PS" == Petr Savicky <savicky at cs.cas.cz>
>>>>>>     on Sun, 31 May 2009 10:29:41 +0200 writes:
>>>>>>             
>
> [............]
>
>     PS> I appreciate the current version, which contains static
>     PS> const char* dropTrailing0(char *s, char cdec) ...
>     PS> mkChar(dropTrailing0((char *)EncodeReal(x, w, d, e,
>     PS> OutDec), ...
>
>     PS> Here, is better visible that the cast (char *) is used
>     PS> than if it was hidden inside dropTrailing0(). Also, it
>     PS> makes dropTrailing0() more consistent.
>
>     PS> I would like to recall the already discussed
>     PS> modification if (replace != p) while((*(replace++) =
>     PS> *(p++))) ; which saves a few instructions in the more
>     PS> frequent case that there are no trailing zeros.
>
> Yes,  thank you.  This already was in my working version,
> and I had managed to lose it again.
> Will put i back
>
> .... still hoping this topic would be closed now ...
>   

i would rather hope for the EncodeReal flaw to be repaired...


vQ


From ligges at statistik.tu-dortmund.de  Mon Jun  1 18:53:42 2009
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Mon, 01 Jun 2009 18:53:42 +0200
Subject: [Rd] install.packages hangs RGui with frozen rpwd process at
 bottom	of process tree (PR#13734)
In-Reply-To: <4A24076C.9010204@statistik.tu-dortmund.de>
References: <20090531044509.BA68C2830319@mail.pubhealth.ku.dk>
	<4A24076C.9010204@statistik.tu-dortmund.de>
Message-ID: <4A240796.6080500@statistik.tu-dortmund.de>



Uwe Ligges wrote:
> 
> 
> astokes at esica.com wrote:
>> Full_Name: Allan Stokes
>> Version: 2.8.1
>> OS: XP
>> Submission from: (NULL) (24.108.0.245)
>>
>>
>> I've just spent a hellish six hours trying to create my own R package 
>> with a
>> bare bones "hello world" R function inside.  I was able to create a
>> package.tar.gz file eventually with much perseverance. 
>> My remaining problem is that when I try to install my simple package 
>> under RGui,
>> it hangs. 
>> install.packages("c:/testR/scupper_1.0.tar.gz", repos=NULL, 
>> type="source",
>> lib="c:/allanR")
> 
> 
> Please try to install from Windows command shell using "R CMD INSTALL" 
> and tell us what you see there.
> Note also that the install scripts have been largely rewritten for 
> R-2.9.0 which is current.


By the way, this is not a bug in R. Hence please do not file such 
messages a bug reports.

Uwe Ligges



> Best,
> Uwe Ligges
> 
> 
> 
>> The hung process tree as shown by SysInternals Process Explorer. 
>> 1. Rgui.exe
>> cmd="C:\Program Files\R\R-2.8.1\bin\Rgui.exe" cd=Z:\ 2. R.exe
>> cmd=C:\PROGRA~1\R\R-28~1.1\bin\R.exe CMD INSTALL -l "c:/allanR" 
>> "c:/allanR/scupper_1.0.tar.gz"
>> cd=Z:\
>> 3. cmd.exe
>> cmd=C:\WINDOWS\system32\cmd.exe /c perl 
>> C:\PROGRA~1\R\R-28~1.1/bin/INSTALL -l
>> c:/allanR c:/allanR/scupper_1.0.tar.gz
>> cd=Z:\
>> 4. perl.exe
>> cmd=perl C:\PROGRA~1\R\R-28~1.1/bin/INSTALL -l c:/allanR
>> c:/allanR/scupper_1.0.tar.gz
>> Z:\
>> 5. make.exe
>> cmd=make --no-print-directory -C C:/PROGRA~1/R/R-28~1.1/src/gnuwin32
>> PKGDIR=Z:/R.INSTALL.5532 PKGNAME=scupper RLIB=c:/allanR 
>> DPKG=c:/allanR/scupper
>> scupper-LAZY=true HELP=YES WINHELP=CHM pkg-scupper
>> dir=C:\Program Files\R\R-2.8.1\src\gnuwin32\
>> 6. make.exe
>> cmd=c:\Rtools\bin\make.exe
>> dir=C:\WINDOWS\system32\
>> 7. Rpwd.exe cmd=c:\PROGRA~1\R\R-28~1.1\src\gnuwin32\Rpwd.exe ../..
>> dir=C:\Program Files\R\R-2.8.1\src\gnuwin32\
>>
>> First, one stupid thing is that one time I ran the make cmd under the 
>> CMD prompt
>> and it successfully generated a CHM file, as shown by this fragment of 
>> the
>> output I captured:
>>  >>> Building/Updating help pages for package 'scupper'
>>      Formats: text html latex example chm
>> Microsoft HTML Help Compiler 4.74.8702
>>
>> Compiling z:\R.INSTALL.6416\scupper\chm\scupper.chm
>>
>> Compile time: 0 minutes, 0 seconds
>> 1       Topic
>> 0       Local links
>> 0       Internet links
>> 1       Graphic
>>
>> Created z:\R.INSTALL.6416\scupper\chm\scupper.chm, 14,448 bytes
>> Compression increased file by 9,624 bytes.
>>
>> That didn't work when I tried it again, but the R temp directories 
>> sometimes
>> vanish in the meantime. 
>> Using System Internals File Monitor, I can see the last access to the 
>> file
>> system by rpwd.exe
>> 9:25:26 PM    Rpwd.exe:6328    QUERY INFORMATION
>> C:\PROGRA~1\R\R-28~1.1\src\gnuwin32\Rpwd.exe    SUCCESS    
>> FileNameInformation   
>> 9:25:26 PM    Rpwd.exe:6328    OPEN    
>> C:\WINDOWS\Prefetch\RPWD.EXE-1615C3C8.pf    SUCCESS
>> Options: Open  Access: Read   
>> 9:25:26 PM    Rpwd.exe:6328    QUERY INFORMATION
>> C:\WINDOWS\Prefetch\RPWD.EXE-1615C3C8.pf    SUCCESS    Length: 3882   
>> 9:25:26 PM    Rpwd.exe:6328    READ     
>> C:\WINDOWS\Prefetch\RPWD.EXE-1615C3C8.pf    SUCCESS
>> Offset: 0 Length: 3882   
>> 9:25:26 PM    Rpwd.exe:6328    OPEN    C:    SUCCESS    Options: Open  
>> Access: 00100180   
>> 9:25:26 PM    Rpwd.exe:6328    QUERY INFORMATION    C:    SUCCESS    
>> FileFsVolumeInformation   
>> 9:25:26 PM    Rpwd.exe:6328    OPEN    C:\    SUCCESS    Options: Open 
>> Directory  Access:
>> 00100001   
>> 9:25:26 PM    Rpwd.exe:6328    DIRECTORY    C:\    SUCCESS    
>> FileNamesInformation   
>> 9:25:26 PM    Rpwd.exe:6328    DIRECTORY    C:\    NO MORE FILES    
>> FileNamesInformation   
>> 9:25:26 PM    Rpwd.exe:6328    OPEN    C:\PROGRA~1\    SUCCESS    
>> Options: Open Directory Access: 00100001   
>> 9:25:26 PM    Rpwd.exe:6328    DIRECTORY    C:\PROGRA~1\    SUCCESS    
>> FileNamesInformation   
>> 9:25:26 PM    Rpwd.exe:6328    DIRECTORY    C:\PROGRA~1\    NO MORE FILES
>> FileNamesInformation   
>> 9:25:26 PM    Rpwd.exe:6328    OPEN    C:\PROGRA~1\R\    SUCCESS    
>> Options: Open Directory Access: 00100001   
>> 9:25:26 PM    Rpwd.exe:6328    DIRECTORY    C:\PROGRA~1\R\    
>> SUCCESS    FileNamesInformation   
>> 9:25:26 PM    Rpwd.exe:6328    DIRECTORY    C:\PROGRA~1\R\    NO MORE 
>> FILES
>> FileNamesInformation   
>> 9:25:26 PM    Rpwd.exe:6328    OPEN    C:\PROGRA~1\R\R-28~1.1\    
>> SUCCESS    Options: Open
>> Directory  Access: 00100001   
>> 9:25:26 PM    Rpwd.exe:6328    DIRECTORY    C:\PROGRA~1\R\R-28~1.1\    
>> SUCCESS
>> FileNamesInformation   
>> 9:25:26 PM    Rpwd.exe:6328    DIRECTORY    C:\PROGRA~1\R\R-28~1.1\    
>> NO MORE FILES
>> FileNamesInformation   
>> 9:25:26 PM    Rpwd.exe:6328    OPEN    C:\PROGRA~1\R\R-28~1.1\SRC\    
>> SUCCESS    Options: Open
>> Directory  Access: 00100001   
>> 9:25:26 PM    Rpwd.exe:6328    DIRECTORY    
>> C:\PROGRA~1\R\R-28~1.1\SRC\    SUCCESS
>> FileNamesInformation   
>> 9:25:26 PM    Rpwd.exe:6328    DIRECTORY    
>> C:\PROGRA~1\R\R-28~1.1\SRC\    NO MORE FILES
>> FileNamesInformation   
>> 9:25:26 PM    Rpwd.exe:6328    OPEN    
>> C:\PROGRA~1\R\R-28~1.1\SRC\GNUWIN32\    SUCCESS
>> Options: Open Directory  Access: 00100001   
>> 9:25:26 PM    Rpwd.exe:6328    DIRECTORY    
>> C:\PROGRA~1\R\R-28~1.1\SRC\GNUWIN32\    SUCCESS
>> FileNamesInformation   
>> 9:25:26 PM    Rpwd.exe:6328    DIRECTORY    
>> C:\PROGRA~1\R\R-28~1.1\SRC\GNUWIN32\    NO MORE
>> FILES    FileNamesInformation   
>> 9:25:26 PM    Rpwd.exe:6328    OPEN    C:\WINDOWS\    SUCCESS    
>> Options: Open Directory Access: 00100001   
>> 9:25:26 PM    Rpwd.exe:6328    DIRECTORY    C:\WINDOWS\    SUCCESS    
>> FileNamesInformation   
>> 9:25:26 PM    Rpwd.exe:6328    DIRECTORY    C:\WINDOWS\    SUCCESS    
>> FileNamesInformation   
>> 9:25:26 PM    Rpwd.exe:6328    DIRECTORY    C:\WINDOWS\    NO MORE FILES
>> FileNamesInformation   
>> 9:25:26 PM    Rpwd.exe:6328    OPEN    C:\WINDOWS\SYSTEM32\    
>> SUCCESS    Options: Open
>> Directory  Access: 00100001   
>> 9:25:26 PM    Rpwd.exe:6328    DIRECTORY    C:\WINDOWS\SYSTEM32\    
>> SUCCESS
>> FileNamesInformation   
>> 9:25:26 PM    Rpwd.exe:6328    DIRECTORY    C:\WINDOWS\SYSTEM32\    
>> SUCCESS
>> FileNamesInformation   
>> 9:25:26 PM    Rpwd.exe:6328    DIRECTORY    C:\WINDOWS\SYSTEM32\    
>> SUCCESS
>> FileNamesInformation   
>> 9:25:26 PM    Rpwd.exe:6328    DIRECTORY    C:\WINDOWS\SYSTEM32\    
>> SUCCESS
>> FileNamesInformation   
>> 9:25:26 PM    Rpwd.exe:6328    DIRECTORY    C:\WINDOWS\SYSTEM32\    
>> SUCCESS
>> FileNamesInformation   
>> 9:25:26 PM    Rpwd.exe:6328    DIRECTORY    C:\WINDOWS\SYSTEM32\    
>> SUCCESS
>> FileNamesInformation   
>> 9:25:26 PM    Rpwd.exe:6328    DIRECTORY    C:\WINDOWS\SYSTEM32\    NO 
>> MORE FILES
>> FileNamesInformation   
>> 9:25:26 PM    Rpwd.exe:6328    OPEN    
>> C:\WINDOWS\SYSTEM32\NTDLL.DLL    SUCCESS    Options:
>> Open  Access: 00000081   
>> 9:25:26 PM    Rpwd.exe:6328    QUERY INFORMATION    
>> C:\WINDOWS\SYSTEM32\NTDLL.DLL    SUCCESS
>> Length: 714752   
>> 9:25:26 PM    Rpwd.exe:6328    OPEN    
>> C:\WINDOWS\SYSTEM32\KERNEL32.DLL    SUCCESS    Options:
>> Open  Access: 00000081   
>> 9:25:26 PM    Rpwd.exe:6328    QUERY INFORMATION    
>> C:\WINDOWS\SYSTEM32\KERNEL32.DLL
>> SUCCESS    Length: 989696   
>> 9:25:26 PM    Rpwd.exe:6328    OPEN    
>> C:\WINDOWS\SYSTEM32\UNICODE.NLS    SUCCESS    Options:
>> Open  Access: 00000081   
>> 9:25:26 PM    Rpwd.exe:6328    QUERY INFORMATION    
>> C:\WINDOWS\SYSTEM32\UNICODE.NLS
>> SUCCESS    Length: 89588   
>> 9:25:26 PM    Rpwd.exe:6328    OPEN    
>> C:\WINDOWS\SYSTEM32\LOCALE.NLS    SUCCESS    Options:
>> Open  Access: 00000081   
>> 9:25:26 PM    Rpwd.exe:6328    QUERY INFORMATION    
>> C:\WINDOWS\SYSTEM32\LOCALE.NLS
>> SUCCESS    Length: 265948   
>> 9:25:26 PM    Rpwd.exe:6328    OPEN    
>> C:\WINDOWS\SYSTEM32\SORTTBLS.NLS    SUCCESS    Options:
>> Open  Access: 00000081   
>> 9:25:26 PM    Rpwd.exe:6328    QUERY INFORMATION    
>> C:\WINDOWS\SYSTEM32\SORTTBLS.NLS
>> SUCCESS    Length: 23044   
>> 9:25:26 PM    Rpwd.exe:6328    OPEN    
>> C:\PROGRA~1\R\R-28~1.1\SRC\GNUWIN32\RPWD.EXE
>> SUCCESS    Options: Open  Access: 00000081   
>> 9:25:26 PM    Rpwd.exe:6328    QUERY INFORMATION
>> C:\PROGRA~1\R\R-28~1.1\SRC\GNUWIN32\RPWD.EXE    SUCCESS    Length: 
>> 9216   
>> 9:25:26 PM    Rpwd.exe:6328    OPEN    
>> C:\WINDOWS\SYSTEM32\MSVCRT.DLL    SUCCESS    Options:
>> Open  Access: 00000081   
>> 9:25:26 PM    Rpwd.exe:6328    QUERY INFORMATION    
>> C:\WINDOWS\SYSTEM32\MSVCRT.DLL
>> SUCCESS    Length: 343040   
>> 9:25:26 PM    Rpwd.exe:6328    OPEN    
>> C:\WINDOWS\SYSTEM32\NTDLL.DLL    SUCCESS    Options:
>> Open  Access: Execute   
>> 9:25:26 PM    Rpwd.exe:6328    OPEN    
>> C:\WINDOWS\SYSTEM32\KERNEL32.DLL    SUCCESS    Options:
>> Open  Access: Execute   
>> 9:25:26 PM    Rpwd.exe:6328    OPEN    
>> C:\PROGRA~1\R\R-28~1.1\SRC\GNUWIN32\RPWD.EXE
>> SUCCESS    Options: Open  Access: Execute   
>> 9:25:26 PM    Rpwd.exe:6328    OPEN    
>> C:\WINDOWS\SYSTEM32\MSVCRT.DLL    SUCCESS    Options:
>> Open  Access: Execute   
>>
>> I've tried this under Rtools 2.9 and then 2.8.  I also updated my 
>> Cygwin config
>> (which was pretty current). 
>> No dice. 
>> My little package contains an R function as such:
>> `ahoy` <-
>> function () { cat ("Shiver me timbers!\n")}
>>
>> And a DESCRIPTION file like this:
>> Package: scupper
>> Type: Package
>> Title: Ship ahoy
>> Version: 1.0
>> Date: 2009-05-30
>> Author: Allan Stokes
>> Maintainer: <astokes at esica.com>
>> Description: Responds to ahoy() greeting.  License: internal use only
>> LazyLoad: yes
>>
>> There are empty data, man, and test directories. 
>> I would reboot my system and try again, but I'd have to shut down 30 
>> programs on
>> nine desktops, and I haven't got that many lives.  I have been sure to 
>> restart
>> RGui with the correct PATH env. for each test run.
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From ligges at statistik.tu-dortmund.de  Mon Jun  1 19:00:22 2009
From: ligges at statistik.tu-dortmund.de (ligges at statistik.tu-dortmund.de)
Date: Mon,  1 Jun 2009 19:00:22 +0200 (CEST)
Subject: [Rd] install.packages hangs RGui with frozen rpwd process at
	(PR#13739)
Message-ID: <20090601170023.0997D2830314@mail.pubhealth.ku.dk>



Uwe Ligges wrote:
> 
> 
> astokes at esica.com wrote:
>> Full_Name: Allan Stokes
>> Version: 2.8.1
>> OS: XP
>> Submission from: (NULL) (24.108.0.245)
>>
>>
>> I've just spent a hellish six hours trying to create my own R package 
>> with a
>> bare bones "hello world" R function inside.  I was able to create a
>> package.tar.gz file eventually with much perseverance. 
>> My remaining problem is that when I try to install my simple package 
>> under RGui,
>> it hangs. 
>> install.packages("c:/testR/scupper_1.0.tar.gz", repos=NULL, 
>> type="source",
>> lib="c:/allanR")
> 
> 
> Please try to install from Windows command shell using "R CMD INSTALL" 
> and tell us what you see there.
> Note also that the install scripts have been largely rewritten for 
> R-2.9.0 which is current.


By the way, this is not a bug in R. Hence please do not file such 
messages a bug reports.

Uwe Ligges



> Best,
> Uwe Ligges
> 
> 
> 
>> The hung process tree as shown by SysInternals Process Explorer. 
>> 1. Rgui.exe
>> cmd="C:\Program Files\R\R-2.8.1\bin\Rgui.exe" cd=Z:\ 2. R.exe
>> cmd=C:\PROGRA~1\R\R-28~1.1\bin\R.exe CMD INSTALL -l "c:/allanR" 
>> "c:/allanR/scupper_1.0.tar.gz"
>> cd=Z:\
>> 3. cmd.exe
>> cmd=C:\WINDOWS\system32\cmd.exe /c perl 
>> C:\PROGRA~1\R\R-28~1.1/bin/INSTALL -l
>> c:/allanR c:/allanR/scupper_1.0.tar.gz
>> cd=Z:\
>> 4. perl.exe
>> cmd=perl C:\PROGRA~1\R\R-28~1.1/bin/INSTALL -l c:/allanR
>> c:/allanR/scupper_1.0.tar.gz
>> Z:\
>> 5. make.exe
>> cmd=make --no-print-directory -C C:/PROGRA~1/R/R-28~1.1/src/gnuwin32
>> PKGDIR=Z:/R.INSTALL.5532 PKGNAME=scupper RLIB=c:/allanR 
>> DPKG=c:/allanR/scupper
>> scupper-LAZY=true HELP=YES WINHELP=CHM pkg-scupper
>> dir=C:\Program Files\R\R-2.8.1\src\gnuwin32\
>> 6. make.exe
>> cmd=c:\Rtools\bin\make.exe
>> dir=C:\WINDOWS\system32\
>> 7. Rpwd.exe cmd=c:\PROGRA~1\R\R-28~1.1\src\gnuwin32\Rpwd.exe ../..
>> dir=C:\Program Files\R\R-2.8.1\src\gnuwin32\
>>
>> First, one stupid thing is that one time I ran the make cmd under the 
>> CMD prompt
>> and it successfully generated a CHM file, as shown by this fragment of 
>> the
>> output I captured:
>>  >>> Building/Updating help pages for package 'scupper'
>>      Formats: text html latex example chm
>> Microsoft HTML Help Compiler 4.74.8702
>>
>> Compiling z:\R.INSTALL.6416\scupper\chm\scupper.chm
>>
>> Compile time: 0 minutes, 0 seconds
>> 1       Topic
>> 0       Local links
>> 0       Internet links
>> 1       Graphic
>>
>> Created z:\R.INSTALL.6416\scupper\chm\scupper.chm, 14,448 bytes
>> Compression increased file by 9,624 bytes.
>>
>> That didn't work when I tried it again, but the R temp directories 
>> sometimes
>> vanish in the meantime. 
>> Using System Internals File Monitor, I can see the last access to the 
>> file
>> system by rpwd.exe
>> 9:25:26 PM    Rpwd.exe:6328    QUERY INFORMATION
>> C:\PROGRA~1\R\R-28~1.1\src\gnuwin32\Rpwd.exe    SUCCESS    
>> FileNameInformation   
>> 9:25:26 PM    Rpwd.exe:6328    OPEN    
>> C:\WINDOWS\Prefetch\RPWD.EXE-1615C3C8.pf    SUCCESS
>> Options: Open  Access: Read   
>> 9:25:26 PM    Rpwd.exe:6328    QUERY INFORMATION
>> C:\WINDOWS\Prefetch\RPWD.EXE-1615C3C8.pf    SUCCESS    Length: 3882   
>> 9:25:26 PM    Rpwd.exe:6328    READ     
>> C:\WINDOWS\Prefetch\RPWD.EXE-1615C3C8.pf    SUCCESS
>> Offset: 0 Length: 3882   
>> 9:25:26 PM    Rpwd.exe:6328    OPEN    C:    SUCCESS    Options: Open  
>> Access: 00100180   
>> 9:25:26 PM    Rpwd.exe:6328    QUERY INFORMATION    C:    SUCCESS    
>> FileFsVolumeInformation   
>> 9:25:26 PM    Rpwd.exe:6328    OPEN    C:\    SUCCESS    Options: Open 
>> Directory  Access:
>> 00100001   
>> 9:25:26 PM    Rpwd.exe:6328    DIRECTORY    C:\    SUCCESS    
>> FileNamesInformation   
>> 9:25:26 PM    Rpwd.exe:6328    DIRECTORY    C:\    NO MORE FILES    
>> FileNamesInformation   
>> 9:25:26 PM    Rpwd.exe:6328    OPEN    C:\PROGRA~1\    SUCCESS    
>> Options: Open Directory Access: 00100001   
>> 9:25:26 PM    Rpwd.exe:6328    DIRECTORY    C:\PROGRA~1\    SUCCESS    
>> FileNamesInformation   
>> 9:25:26 PM    Rpwd.exe:6328    DIRECTORY    C:\PROGRA~1\    NO MORE FILES
>> FileNamesInformation   
>> 9:25:26 PM    Rpwd.exe:6328    OPEN    C:\PROGRA~1\R\    SUCCESS    
>> Options: Open Directory Access: 00100001   
>> 9:25:26 PM    Rpwd.exe:6328    DIRECTORY    C:\PROGRA~1\R\    
>> SUCCESS    FileNamesInformation   
>> 9:25:26 PM    Rpwd.exe:6328    DIRECTORY    C:\PROGRA~1\R\    NO MORE 
>> FILES
>> FileNamesInformation   
>> 9:25:26 PM    Rpwd.exe:6328    OPEN    C:\PROGRA~1\R\R-28~1.1\    
>> SUCCESS    Options: Open
>> Directory  Access: 00100001   
>> 9:25:26 PM    Rpwd.exe:6328    DIRECTORY    C:\PROGRA~1\R\R-28~1.1\    
>> SUCCESS
>> FileNamesInformation   
>> 9:25:26 PM    Rpwd.exe:6328    DIRECTORY    C:\PROGRA~1\R\R-28~1.1\    
>> NO MORE FILES
>> FileNamesInformation   
>> 9:25:26 PM    Rpwd.exe:6328    OPEN    C:\PROGRA~1\R\R-28~1.1\SRC\    
>> SUCCESS    Options: Open
>> Directory  Access: 00100001   
>> 9:25:26 PM    Rpwd.exe:6328    DIRECTORY    
>> C:\PROGRA~1\R\R-28~1.1\SRC\    SUCCESS
>> FileNamesInformation   
>> 9:25:26 PM    Rpwd.exe:6328    DIRECTORY    
>> C:\PROGRA~1\R\R-28~1.1\SRC\    NO MORE FILES
>> FileNamesInformation   
>> 9:25:26 PM    Rpwd.exe:6328    OPEN    
>> C:\PROGRA~1\R\R-28~1.1\SRC\GNUWIN32\    SUCCESS
>> Options: Open Directory  Access: 00100001   
>> 9:25:26 PM    Rpwd.exe:6328    DIRECTORY    
>> C:\PROGRA~1\R\R-28~1.1\SRC\GNUWIN32\    SUCCESS
>> FileNamesInformation   
>> 9:25:26 PM    Rpwd.exe:6328    DIRECTORY    
>> C:\PROGRA~1\R\R-28~1.1\SRC\GNUWIN32\    NO MORE
>> FILES    FileNamesInformation   
>> 9:25:26 PM    Rpwd.exe:6328    OPEN    C:\WINDOWS\    SUCCESS    
>> Options: Open Directory Access: 00100001   
>> 9:25:26 PM    Rpwd.exe:6328    DIRECTORY    C:\WINDOWS\    SUCCESS    
>> FileNamesInformation   
>> 9:25:26 PM    Rpwd.exe:6328    DIRECTORY    C:\WINDOWS\    SUCCESS    
>> FileNamesInformation   
>> 9:25:26 PM    Rpwd.exe:6328    DIRECTORY    C:\WINDOWS\    NO MORE FILES
>> FileNamesInformation   
>> 9:25:26 PM    Rpwd.exe:6328    OPEN    C:\WINDOWS\SYSTEM32\    
>> SUCCESS    Options: Open
>> Directory  Access: 00100001   
>> 9:25:26 PM    Rpwd.exe:6328    DIRECTORY    C:\WINDOWS\SYSTEM32\    
>> SUCCESS
>> FileNamesInformation   
>> 9:25:26 PM    Rpwd.exe:6328    DIRECTORY    C:\WINDOWS\SYSTEM32\    
>> SUCCESS
>> FileNamesInformation   
>> 9:25:26 PM    Rpwd.exe:6328    DIRECTORY    C:\WINDOWS\SYSTEM32\    
>> SUCCESS
>> FileNamesInformation   
>> 9:25:26 PM    Rpwd.exe:6328    DIRECTORY    C:\WINDOWS\SYSTEM32\    
>> SUCCESS
>> FileNamesInformation   
>> 9:25:26 PM    Rpwd.exe:6328    DIRECTORY    C:\WINDOWS\SYSTEM32\    
>> SUCCESS
>> FileNamesInformation   
>> 9:25:26 PM    Rpwd.exe:6328    DIRECTORY    C:\WINDOWS\SYSTEM32\    
>> SUCCESS
>> FileNamesInformation   
>> 9:25:26 PM    Rpwd.exe:6328    DIRECTORY    C:\WINDOWS\SYSTEM32\    NO 
>> MORE FILES
>> FileNamesInformation   
>> 9:25:26 PM    Rpwd.exe:6328    OPEN    
>> C:\WINDOWS\SYSTEM32\NTDLL.DLL    SUCCESS    Options:
>> Open  Access: 00000081   
>> 9:25:26 PM    Rpwd.exe:6328    QUERY INFORMATION    
>> C:\WINDOWS\SYSTEM32\NTDLL.DLL    SUCCESS
>> Length: 714752   
>> 9:25:26 PM    Rpwd.exe:6328    OPEN    
>> C:\WINDOWS\SYSTEM32\KERNEL32.DLL    SUCCESS    Options:
>> Open  Access: 00000081   
>> 9:25:26 PM    Rpwd.exe:6328    QUERY INFORMATION    
>> C:\WINDOWS\SYSTEM32\KERNEL32.DLL
>> SUCCESS    Length: 989696   
>> 9:25:26 PM    Rpwd.exe:6328    OPEN    
>> C:\WINDOWS\SYSTEM32\UNICODE.NLS    SUCCESS    Options:
>> Open  Access: 00000081   
>> 9:25:26 PM    Rpwd.exe:6328    QUERY INFORMATION    
>> C:\WINDOWS\SYSTEM32\UNICODE.NLS
>> SUCCESS    Length: 89588   
>> 9:25:26 PM    Rpwd.exe:6328    OPEN    
>> C:\WINDOWS\SYSTEM32\LOCALE.NLS    SUCCESS    Options:
>> Open  Access: 00000081   
>> 9:25:26 PM    Rpwd.exe:6328    QUERY INFORMATION    
>> C:\WINDOWS\SYSTEM32\LOCALE.NLS
>> SUCCESS    Length: 265948   
>> 9:25:26 PM    Rpwd.exe:6328    OPEN    
>> C:\WINDOWS\SYSTEM32\SORTTBLS.NLS    SUCCESS    Options:
>> Open  Access: 00000081   
>> 9:25:26 PM    Rpwd.exe:6328    QUERY INFORMATION    
>> C:\WINDOWS\SYSTEM32\SORTTBLS.NLS
>> SUCCESS    Length: 23044   
>> 9:25:26 PM    Rpwd.exe:6328    OPEN    
>> C:\PROGRA~1\R\R-28~1.1\SRC\GNUWIN32\RPWD.EXE
>> SUCCESS    Options: Open  Access: 00000081   
>> 9:25:26 PM    Rpwd.exe:6328    QUERY INFORMATION
>> C:\PROGRA~1\R\R-28~1.1\SRC\GNUWIN32\RPWD.EXE    SUCCESS    Length: 
>> 9216   
>> 9:25:26 PM    Rpwd.exe:6328    OPEN    
>> C:\WINDOWS\SYSTEM32\MSVCRT.DLL    SUCCESS    Options:
>> Open  Access: 00000081   
>> 9:25:26 PM    Rpwd.exe:6328    QUERY INFORMATION    
>> C:\WINDOWS\SYSTEM32\MSVCRT.DLL
>> SUCCESS    Length: 343040   
>> 9:25:26 PM    Rpwd.exe:6328    OPEN    
>> C:\WINDOWS\SYSTEM32\NTDLL.DLL    SUCCESS    Options:
>> Open  Access: Execute   
>> 9:25:26 PM    Rpwd.exe:6328    OPEN    
>> C:\WINDOWS\SYSTEM32\KERNEL32.DLL    SUCCESS    Options:
>> Open  Access: Execute   
>> 9:25:26 PM    Rpwd.exe:6328    OPEN    
>> C:\PROGRA~1\R\R-28~1.1\SRC\GNUWIN32\RPWD.EXE
>> SUCCESS    Options: Open  Access: Execute   
>> 9:25:26 PM    Rpwd.exe:6328    OPEN    
>> C:\WINDOWS\SYSTEM32\MSVCRT.DLL    SUCCESS    Options:
>> Open  Access: Execute   
>>
>> I've tried this under Rtools 2.9 and then 2.8.  I also updated my 
>> Cygwin config
>> (which was pretty current). 
>> No dice. 
>> My little package contains an R function as such:
>> `ahoy` <-
>> function () { cat ("Shiver me timbers!\n")}
>>
>> And a DESCRIPTION file like this:
>> Package: scupper
>> Type: Package
>> Title: Ship ahoy
>> Version: 1.0
>> Date: 2009-05-30
>> Author: Allan Stokes
>> Maintainer: <astokes at esica.com>
>> Description: Responds to ahoy() greeting.  License: internal use only
>> LazyLoad: yes
>>
>> There are empty data, man, and test directories. 
>> I would reboot my system and try again, but I'd have to shut down 30 
>> programs on
>> nine desktops, and I haven't got that many lives.  I have been sure to 
>> restart
>> RGui with the correct PATH env. for each test run.
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From hpages at fhcrc.org  Tue Jun  2 03:42:52 2009
From: hpages at fhcrc.org (=?ISO-8859-1?Q?Herv=E9_Pag=E8s?=)
Date: Mon, 01 Jun 2009 18:42:52 -0700
Subject: [Rd] formal argument "envir" matched by multiple actual arguments
Message-ID: <4A24839C.50403@fhcrc.org>

Hi list,

This looks similar to the problem reported here
   https://stat.ethz.ch/pipermail/r-devel/2006-April/037199.html
by Henrik Bengtsson a long time ago. It is very sporadic and
non-reproducible.
Henrik, do you remember if your code was using reg.finalizer()?
I tend to suspect it but I'm not sure.

I've been hunting this bug for months but today, and we the help of other
Bioconductor users, I was able to isolate it and to write some code that
seems to "almost" reproduce it (i.e. not systematically but most of the
times).

(Just to put some context to the code below: it's a simplified version
of some more complex code that we use in Bioconductor to manage memory
caching of some big objects stored on disk. The idea is that objects of
class A can be named. All A objects with the same name form a group.
The code below implements a simple mechanism to trigger some action when
a group is completely removed from memory i.e. when the last object in
a group is garbage collected.)


   setClassUnion("environmentORNULL", c("environment", "NULL"))

   setClass("A",
     representation(
       aa="integer",
       groupname="character",
       groupanchor="environmentORNULL"
     )
   )

   .A.group.sizes <- new.env(hash=TRUE, parent=emptyenv())

   .inc.A.group.size <- function(groupname)
   {
     group.size <- 1L
     if (exists(groupname, envir=.A.group.sizes, inherits=FALSE))
         group.size <- group.size +
                       get(groupname, envir=.A.group.sizes, inherits=FALSE)
     assign(groupname, group.size, envir=.A.group.sizes, inherits=FALSE)
   }

   .dec.A.group.size <- function(groupname)
   {
     group.size <- get(groupname, envir=.A.group.sizes, inherits=FALSE) - 1L
     assign(groupname, group.size, envir=.A.group.sizes, inherits=FALSE)
     return(group.size)
   }

   newA <- function(groupname="")
   {
     a <- new("A", groupname=groupname)
     if (!identical(groupname, "")) {
         .inc.A.group.size(groupname)
         groupanchor <- new.env(parent=emptyenv())
         reg.finalizer(groupanchor,
                       function(e)
                       {
                           group.size <- .dec.A.group.size(groupname)
                           if (group.size == 0L) {
                               cat("no more object of group",
                                   groupname, "in memory\n")
                               # take some action
                           }
                       }
         )
         a at groupanchor <- groupanchor
     }
     return(a)
   }


The following commands seem to trigger the problem:

   > for (i in 1:2000) {a1 <- newA("group1")}
   > as.list(.A.group.sizes)
   > gc()
   > as.list(.A.group.sizes)
   > for (i in 1:2000) {a2 <- newA("group2")}
   Error in assign(".Method", method, envir = envir) :
     formal argument "envir" matched by multiple actual arguments

If it doesn't, then adding more rounds should finally do it:

   gc()
   for (i in 1:2000) {a3 <- newA("group3")}
   gc()
   for (i in 1:2000) {a4 <- newA("group4")}

   etc...

Thanks in advance for any help with this!

H.

 > sessionInfo()
R version 2.9.0 (2009-04-17)
x86_64-unknown-linux-gnu

locale:
LC_CTYPE=en_CA.UTF-8;LC_NUMERIC=C;LC_TIME=en_CA.UTF-8;LC_COLLATE=en_CA.UTF-8;LC_MONETARY=C;LC_MESSAGES=en_CA.UTF-8;LC_PAPER=en_CA.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_CA.UTF-8;LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base


-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M2-B876
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fhcrc.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From wdunlap at tibco.com  Tue Jun  2 03:45:33 2009
From: wdunlap at tibco.com (William Dunlap)
Date: Mon, 1 Jun 2009 18:45:33 -0700
Subject: [Rd] reference counting bug: overwriting for loop 'seq' variable
Message-ID: <77EB52C6DD32BA4D87471DCD70C8D7000147B6C7@NA-PA-VBE03.na.tibco.com>

It looks like the 'seq' variable to 'for' can be altered from
within the loop, leading to incorrect answers.  E.g., in
the following I'd expect 'sum' to be 1+2=3, but R 2.10.0
(svn 48686) gives 44.5.

   > x = c(1,2);  sum = 0; for (i in x) { x[i+1] = i + 42.5; sum = sum +
i }; sum
   [1] 44.5
or, with a debugging cat()s,
   > x = c(1,2);  sum = 0; for (i in x) { cat("before, i=", i, "\n");
x[i+1] = i + 42.5; cat("after, i=", i,"\n"); sum = sum + i }; sum
   before, i= 1
   after, i= 1
   before, i= 43.5
   after, i= 43.5
   [1] 44.5
 
If I force the for's 'seq' to be a copy of x by adding 0 to it, then I
do get the expected answer.

   > x = c(1,2);  sum = 0; for (i in x+0) { x[i+1] = i + 42.5; sum = sum
+ i }; sum
   bbbbb[1] 3

It looks like an error in reference counting. 

Bill Dunlap
TIBCO Software Inc - Spotfire Division
wdunlap tibco.com 


From macrakis at alum.mit.edu  Tue Jun  2 04:00:19 2009
From: macrakis at alum.mit.edu (Stavros Macrakis)
Date: Mon, 1 Jun 2009 22:00:19 -0400
Subject: [Rd] BUG: `lag` returns object of incorrect class
Message-ID: <8b356f880906011900k4e96c5a1r865f7f68d4d59859@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090601/cfa7370d/attachment.pl>

From Troy.Robertson at aad.gov.au  Tue Jun  2 03:28:44 2009
From: Troy.Robertson at aad.gov.au (Troy Robertson)
Date: Tue, 2 Jun 2009 11:28:44 +1000
Subject: [Rd] S4 Objects [Sec=Unclassified]
Message-ID: <42C7503E0B99F248B06BC65E7D2B4E0201225C193870@EX2K7-CCR.AAD.GOV.AU>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090602/064c3163/attachment.pl>

From Waclaw.Marcin.Kusnierczyk at idi.ntnu.no  Tue Jun  2 10:04:54 2009
From: Waclaw.Marcin.Kusnierczyk at idi.ntnu.no (Wacek Kusnierczyk)
Date: Tue, 02 Jun 2009 10:04:54 +0200
Subject: [Rd] reference counting bug: overwriting for loop 'seq' variable
In-Reply-To: <77EB52C6DD32BA4D87471DCD70C8D7000147B6C7@NA-PA-VBE03.na.tibco.com>
References: <77EB52C6DD32BA4D87471DCD70C8D7000147B6C7@NA-PA-VBE03.na.tibco.com>
Message-ID: <4A24DD26.2070904@idi.ntnu.no>

William Dunlap wrote:
> It looks like the 'seq' variable to 'for' can be altered from
> within the loop, leading to incorrect answers.  E.g., in
> the following I'd expect 'sum' to be 1+2=3, but R 2.10.0
> (svn 48686) gives 44.5.
>
>    > x = c(1,2);  sum = 0; for (i in x) { x[i+1] = i + 42.5; sum = sum +
> i }; sum
>    [1] 44.5
> or, with a debugging cat()s,
>    > x = c(1,2);  sum = 0; for (i in x) { cat("before, i=", i, "\n");
> x[i+1] = i + 42.5; cat("after, i=", i,"\n"); sum = sum + i }; sum
>    before, i= 1
>    after, i= 1
>    before, i= 43.5
>    after, i= 43.5
>    [1] 44.5
>  
> If I force the for's 'seq' to be a copy of x by adding 0 to it, then I
> do get the expected answer.
>
>    > x = c(1,2);  sum = 0; for (i in x+0) { x[i+1] = i + 42.5; sum = sum
> + i }; sum
>    bbbbb[1] 3
>
> It looks like an error in reference counting. 
>   

indeed;  seems like you've hit the issue of when r triggers data
duplication and when it doesn't, discussed some time ago in the context
of names() etc.  consider:

    x = 1:2
    for (i in x)
       x[i+1] = i-1
    x
    # 1 0 1

    y = c(1, 2)
    for (i in y)
       y[i+1] = i-1
    y
    # -1 0


vQ


From hpages at fhcrc.org  Tue Jun  2 10:05:40 2009
From: hpages at fhcrc.org (hpages at fhcrc.org)
Date: Tue, 02 Jun 2009 01:05:40 -0700
Subject: [Rd] formal argument "envir" matched by multiple
	actual	arguments
In-Reply-To: <4A24839C.50403@fhcrc.org>
References: <4A24839C.50403@fhcrc.org>
Message-ID: <20090602010540.k6d93dfdycc884wg@webmail.fhcrc.org>

In fact reg.finalizer() looks like a dangerous feature.

If the finalizer itself triggers (implicitely or
explicitely) garbage collection, then bad things happen.
In the following example, garbage collection is triggered
explicitely (using R-2.9.0):

    setClass("B", representation(bb="environment"))

    newB <- function()
    {
      ans <- new("B", bb=new.env())
      reg.finalizer(ans at bb,
                    function(e)
                    {
                        gc()
                        cat("cleaning", class(ans), "object...\n")
                    }
      )
      return(ans)
    }

    > for (i in 1:500) {cat(i, "\n"); b1 <- newB()}
    1
    2
    3
    4
    5
    6
    ...
    13
    cleaning B object...
    cleaning B object...
    cleaning B object...
    cleaning B object...
    cleaning B object...
    cleaning B object...
    cleaning B object...
    cleaning B object...
    cleaning B object...
    cleaning B object...
    cleaning B object...
    14
    ...
    169
    170
    171
    Error: not a weak reference
    Error: not a weak reference
    [repeat the above line thousands of times]
    ...
    Error: not a weak reference
    Error: not a weak reference
    cleaning B object...
    Error: SET_VECTOR_ELT() can only be applied to a 'list', not a 'integer'
    Error: SET_VECTOR_ELT() can only be applied to a 'list', not a 'integer'
    [repeat the above line thousands of times]
    ...
    Error: SET_VECTOR_ELT() can only be applied to a 'list', not a 'integer'
    Error: SET_VECTOR_ELT() can only be applied to a 'list', not a 'integer'
    172
    ...
    246
    247
    cleaning B object...
    cleaning B object...
    cleaning B object...
    cleaning B object...
    cleaning B object...
    cleaning B object...
    cleaning B object...
    cleaning B object...
    cleaning B object...
    cleaning B object...
    cleaning B object...
    cleaning B object...
    cleaning B object...
    cleaning B object...
    cleaning B object...
    cleaning B object...
    cleaning B object...
    cleaning B object...
    cleaning B object...

     *** caught segfault ***
    address 0x41, cause 'memory not mapped'

    Traceback:
     1: gc()
     2: function (e) {    gc()    cat("cleaning", class(ans),  
"object...\n")}(<environment>)

    Possible actions:
    1: abort (with core dump, if enabled)
    2: normal R exit
    3: exit R without saving workspace
    4: exit R saving workspace
    Selection: 2
    Save workspace image? [y/n/c]: n
    Segmentation fault

So apparently, if the finalizer triggers garbage collection,
then we can end up with a corrupted session. Then anything can
happen, from the strange 'formal argument "envir" matched by
multiple actual arguments' error I reported in the previous post,
to a segfault. In the worse case, nothing apparently happens but
the output produced by the code is wrong.

Maybe garbage collection requests should be ignored during the
execution of the finalizer? (and more generally during garbbage
collection itself)

Cheers,
H.


From ronggui.huang at gmail.com  Tue Jun  2 10:12:55 2009
From: ronggui.huang at gmail.com (Ronggui Huang)
Date: Tue, 2 Jun 2009 16:12:55 +0800
Subject: [Rd] The default position of plot title
Message-ID: <38b9f0350906020112uffb43d7k1748b745d5c4d542@mail.gmail.com>

Dear R-developers,

It seems to me that the position of title is usually at the bottom of
a plot in sociological and political science books and articles. I
wonder if the same convention applies in other disciplines. If yes, is
it reasonable to change the default position of main title of plot
function?

-- 
HUANG Ronggui, Wincent
PhD Candidate
Dept of Public and Social Administration
City University of Hong Kong
Home page: http://asrr.r-forge.r-project.org/rghuang.html


From hb at stat.berkeley.edu  Tue Jun  2 10:13:12 2009
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Tue, 2 Jun 2009 01:13:12 -0700
Subject: [Rd] formal argument "envir" matched by multiple actual
	arguments
In-Reply-To: <4A24839C.50403@fhcrc.org>
References: <4A24839C.50403@fhcrc.org>
Message-ID: <59d7961d0906020113m62213531vca14f3d06c0c1bce@mail.gmail.com>

Hi.

2009/6/1 Herv? Pag?s <hpages at fhcrc.org>:
> Hi list,
>
> This looks similar to the problem reported here
> ?https://stat.ethz.ch/pipermail/r-devel/2006-April/037199.html
> by Henrik Bengtsson a long time ago. It is very sporadic and
> non-reproducible.
> Henrik, do you remember if your code was using reg.finalizer()?
> I tend to suspect it but I'm not sure.

Yes.  This was/is observed with object extending the Object class of
R.oo, and the constructor of Object use reg.finalizer() [which then
calls finalize() that can be "overloaded"].  The fact that the garbage
collector is involved could explain why this bug(?) is hard to
reproduce.

It's been a while since I saw this problem (and we do instantiate way
more Object:s these days).  Looking at my source code comments and the
post you refers to, I suspect that I manage to circumvent the issue by
the following trick (looking at my code, I have several of those
statements):

envir2 <- envir
get(name, envir=envir2)

Also, on March 6, 2008 I reported to R-devel on a related problem with '%in%':

  http://tolstoy.newcastle.edu.au/R/e4/devel/08/03/0708.html

That one I circumvent by now only using is.element(a,b) instead of a %in% b.

Maybe this gives you further clues.

/Henrik

BTW. You need to be careful when you register a finalizer and that
uses code in a package, which may have been detached.  This may cause
an error in the finalizer which can give further side effects.  See
here:

  http://tolstoy.newcastle.edu.au/R/e2/devel/07/08/4251.html


>
> I've been hunting this bug for months but today, and we the help of other
> Bioconductor users, I was able to isolate it and to write some code that
> seems to "almost" reproduce it (i.e. not systematically but most of the
> times).
>
> (Just to put some context to the code below: it's a simplified version
> of some more complex code that we use in Bioconductor to manage memory
> caching of some big objects stored on disk. The idea is that objects of
> class A can be named. All A objects with the same name form a group.
> The code below implements a simple mechanism to trigger some action when
> a group is completely removed from memory i.e. when the last object in
> a group is garbage collected.)
>
>
> ?setClassUnion("environmentORNULL", c("environment", "NULL"))
>
> ?setClass("A",
> ? ?representation(
> ? ? ?aa="integer",
> ? ? ?groupname="character",
> ? ? ?groupanchor="environmentORNULL"
> ? ?)
> ?)
>
> ?.A.group.sizes <- new.env(hash=TRUE, parent=emptyenv())
>
> ?.inc.A.group.size <- function(groupname)
> ?{
> ? ?group.size <- 1L
> ? ?if (exists(groupname, envir=.A.group.sizes, inherits=FALSE))
> ? ? ? ?group.size <- group.size +
> ? ? ? ? ? ? ? ? ? ? ?get(groupname, envir=.A.group.sizes, inherits=FALSE)
> ? ?assign(groupname, group.size, envir=.A.group.sizes, inherits=FALSE)
> ?}
>
> ?.dec.A.group.size <- function(groupname)
> ?{
> ? ?group.size <- get(groupname, envir=.A.group.sizes, inherits=FALSE) - 1L
> ? ?assign(groupname, group.size, envir=.A.group.sizes, inherits=FALSE)
> ? ?return(group.size)
> ?}
>
> ?newA <- function(groupname="")
> ?{
> ? ?a <- new("A", groupname=groupname)
> ? ?if (!identical(groupname, "")) {
> ? ? ? ?.inc.A.group.size(groupname)
> ? ? ? ?groupanchor <- new.env(parent=emptyenv())
> ? ? ? ?reg.finalizer(groupanchor,
> ? ? ? ? ? ? ? ? ? ? ?function(e)
> ? ? ? ? ? ? ? ? ? ? ?{
> ? ? ? ? ? ? ? ? ? ? ? ? ?group.size <- .dec.A.group.size(groupname)
> ? ? ? ? ? ? ? ? ? ? ? ? ?if (group.size == 0L) {
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?cat("no more object of group",
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?groupname, "in memory\n")
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?# take some action
> ? ? ? ? ? ? ? ? ? ? ? ? ?}
> ? ? ? ? ? ? ? ? ? ? ?}
> ? ? ? ?)
> ? ? ? ?a at groupanchor <- groupanchor
> ? ?}
> ? ?return(a)
> ?}
>
>
> The following commands seem to trigger the problem:
>
> ?> for (i in 1:2000) {a1 <- newA("group1")}
> ?> as.list(.A.group.sizes)
> ?> gc()
> ?> as.list(.A.group.sizes)
> ?> for (i in 1:2000) {a2 <- newA("group2")}
> ?Error in assign(".Method", method, envir = envir) :
> ? ?formal argument "envir" matched by multiple actual arguments
>
> If it doesn't, then adding more rounds should finally do it:
>
> ?gc()
> ?for (i in 1:2000) {a3 <- newA("group3")}
> ?gc()
> ?for (i in 1:2000) {a4 <- newA("group4")}
>
> ?etc...
>
> Thanks in advance for any help with this!
>
> H.
>
>> sessionInfo()
> R version 2.9.0 (2009-04-17)
> x86_64-unknown-linux-gnu
>
> locale:
> LC_CTYPE=en_CA.UTF-8;LC_NUMERIC=C;LC_TIME=en_CA.UTF-8;LC_COLLATE=en_CA.UTF-8;LC_MONETARY=C;LC_MESSAGES=en_CA.UTF-8;LC_PAPER=en_CA.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_CA.UTF-8;LC_IDENTIFICATION=C
>
> attached base packages:
> [1] stats ? ? graphics ?grDevices utils ? ? datasets ?methods ? base
>
>
> --
> Herv? Pag?s
>
> Program in Computational Biology
> Division of Public Health Sciences
> Fred Hutchinson Cancer Research Center
> 1100 Fairview Ave. N, M2-B876
> P.O. Box 19024
> Seattle, WA 98109-1024
>
> E-mail: hpages at fhcrc.org
> Phone: ?(206) 667-5791
> Fax: ? ?(206) 667-1319
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From waku at idi.ntnu.no  Tue Jun  2 11:30:14 2009
From: waku at idi.ntnu.no (waku at idi.ntnu.no)
Date: Tue,  2 Jun 2009 11:30:14 +0200 (CEST)
Subject: [Rd] Bug in so_strsplit (PR#13742)
Message-ID: <20090602093014.9B499282C765@mail.pubhealth.ku.dk>

Full_Name: Wacek Kusnierczyk
Version: 2.10.0 r48689
OS: Ubuntu 8.04 Linux 32b
Submission from: (NULL) (129.241.199.78)


src/main/character.c:435-438 (do_strsplit) contains the following code:

    for (i = 0; i < tlen; i++)
        if (getCharCE(STRING_ELT(tok, 0)) == CE_UTF8) use_UTF8 = TRUE;
    for (i = 0; i < len; i++)
        if (getCharCE(STRING_ELT(x, 0)) == CE_UTF8) use_UTF8 = TRUE;

both loops iterate over loop-invariant expressions and statements.
either the loops are redundant, or the fixed index '0' is copied over from some
other place and should be replaced with 'i'.

the bug can be fixed with 

    for (i = 0; i < tlen; i++)
        if (getCharCE(STRING_ELT(tok, i)) == CE_UTF8) {
            use_UTF8 = TRUE;
            break; }
    for (i = 0; i < len; i++)
        if (getCharCE(STRING_ELT(x, i)) == CE_UTF8) {
            use_UTF8 = TRUE;
            break; }
            
or with

   #define CHECK_CE(CHARACTER, LENGTH, USEUTF8) \
      for (i = 0; i < (LENGTH); i++) \
         if (getCharCE(STRING_ELT((CHARACTER), i)) == CE_UTF8) { \
            (USEUTF8) = TRUE; \
            break; }
   CHECK_CE(tok, tlen, use_UTF8)
   CHECK_CE(x, len, use_UTF8)


From hb at maths.lth.se  Tue Jun  2 10:25:13 2009
From: hb at maths.lth.se (Henrik Bengtsson)
Date: Tue, 2 Jun 2009 01:25:13 -0700
Subject: [Rd] formal argument "envir" matched by multiple actual
	arguments
In-Reply-To: <20090602010540.k6d93dfdycc884wg@webmail.fhcrc.org>
References: <4A24839C.50403@fhcrc.org>
	<20090602010540.k6d93dfdycc884wg@webmail.fhcrc.org>
Message-ID: <59d7961d0906020125w5b399755j594a018ca608318c@mail.gmail.com>

Nice case - I think you're onto something. /Henrik

2009/6/2  <hpages at fhcrc.org>:
> In fact reg.finalizer() looks like a dangerous feature.
>
> If the finalizer itself triggers (implicitely or
> explicitely) garbage collection, then bad things happen.
> In the following example, garbage collection is triggered
> explicitely (using R-2.9.0):
>
> ? setClass("B", representation(bb="environment"))
>
> ? newB <- function()
> ? {
> ? ? ans <- new("B", bb=new.env())
> ? ? reg.finalizer(ans at bb,
> ? ? ? ? ? ? ? ? ? function(e)
> ? ? ? ? ? ? ? ? ? {
> ? ? ? ? ? ? ? ? ? ? ? gc()
> ? ? ? ? ? ? ? ? ? ? ? cat("cleaning", class(ans), "object...\n")
> ? ? ? ? ? ? ? ? ? }
> ? ? )
> ? ? return(ans)
> ? }
>
> ? > for (i in 1:500) {cat(i, "\n"); b1 <- newB()}
> ? 1
> ? 2
> ? 3
> ? 4
> ? 5
> ? 6
> ? ...
> ? 13
> ? cleaning B object...
> ? cleaning B object...
> ? cleaning B object...
> ? cleaning B object...
> ? cleaning B object...
> ? cleaning B object...
> ? cleaning B object...
> ? cleaning B object...
> ? cleaning B object...
> ? cleaning B object...
> ? cleaning B object...
> ? 14
> ? ...
> ? 169
> ? 170
> ? 171
> ? Error: not a weak reference
> ? Error: not a weak reference
> ? [repeat the above line thousands of times]
> ? ...
> ? Error: not a weak reference
> ? Error: not a weak reference
> ? cleaning B object...
> ? Error: SET_VECTOR_ELT() can only be applied to a 'list', not a 'integer'
> ? Error: SET_VECTOR_ELT() can only be applied to a 'list', not a 'integer'
> ? [repeat the above line thousands of times]
> ? ...
> ? Error: SET_VECTOR_ELT() can only be applied to a 'list', not a 'integer'
> ? Error: SET_VECTOR_ELT() can only be applied to a 'list', not a 'integer'
> ? 172
> ? ...
> ? 246
> ? 247
> ? cleaning B object...
> ? cleaning B object...
> ? cleaning B object...
> ? cleaning B object...
> ? cleaning B object...
> ? cleaning B object...
> ? cleaning B object...
> ? cleaning B object...
> ? cleaning B object...
> ? cleaning B object...
> ? cleaning B object...
> ? cleaning B object...
> ? cleaning B object...
> ? cleaning B object...
> ? cleaning B object...
> ? cleaning B object...
> ? cleaning B object...
> ? cleaning B object...
> ? cleaning B object...
>
> ? ?*** caught segfault ***
> ? address 0x41, cause 'memory not mapped'
>
> ? Traceback:
> ? ?1: gc()
> ? ?2: function (e) { ? ?gc() ? ?cat("cleaning", class(ans),
> "object...\n")}(<environment>)
>
> ? Possible actions:
> ? 1: abort (with core dump, if enabled)
> ? 2: normal R exit
> ? 3: exit R without saving workspace
> ? 4: exit R saving workspace
> ? Selection: 2
> ? Save workspace image? [y/n/c]: n
> ? Segmentation fault
>
> So apparently, if the finalizer triggers garbage collection,
> then we can end up with a corrupted session. Then anything can
> happen, from the strange 'formal argument "envir" matched by
> multiple actual arguments' error I reported in the previous post,
> to a segfault. In the worse case, nothing apparently happens but
> the output produced by the code is wrong.
>
> Maybe garbage collection requests should be ignored during the
> execution of the finalizer? (and more generally during garbbage
> collection itself)
>
> Cheers,
> H.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From marco.scutari at gmail.com  Tue Jun  2 13:12:32 2009
From: marco.scutari at gmail.com (Marco Scutari)
Date: Tue, 2 Jun 2009 13:12:32 +0200
Subject: [Rd] cryptic error message from R CMD check
Message-ID: <b7d7c3160906020412t28e4efe5rf7e871703d8d6421@mail.gmail.com>

Dear R developers,

I've run into a very cryptic error message from R CMD check
while working on a new package. This is the relevant output:

[fizban@~/Rmap]:R CMD check Rmap
* checking for working pdflatex ... OK
* using log directory '/home/fizban/Rmap/Rmap.Rcheck'
* using R version 2.9.0 (2009-04-17)
* using session charset: UTF-8
* checking for file 'Rmap/DESCRIPTION' ... OK
* checking extension type ... Package
* this is package 'Rmap' version '0.1'
* checking package dependencies ... OK
* checking if this is a source package ... OK
* checking for .dll and .exe files ... OK
* checking whether package 'Rmap' can be installed ... ERROR
Installation failed.
See '/home/fizban/Rmap/Rmap.Rcheck/00install.out' for details.
[fizban@~/Rmap]:cat /home/fizban/Rmap/Rmap.Rcheck/00install.out
* Installing *source* package ?Rmap? ...
** R
** preparing package for lazy loading
** help
*** installing help indices
Error in `[.data.frame`(M, , 4) : undefined columns selected
* Removing ?/home/fizban/Rmap/Rmap.Rcheck/Rmap?

R CMD build + INSTALL fails in the same way:

[fizban@~/Rmap]:R CMD build Rmap
* checking for file 'Rmap/DESCRIPTION' ... OK
* preparing 'Rmap':
* checking DESCRIPTION meta-information ... OK
* removing junk files
* checking for LF line-endings in source and make files
* checking for empty or unneeded directories
WARNING: directory 'Rmap/man' is empty
* building 'Rmap_0.1.tar.gz'
[fizban@~/Rmap]:sudo R CMD INSTALL Rmap_0.1.tar.gz
* Installing to library ?/usr/local/lib/R/site-library?
* Installing *source* package ?Rmap? ...
** R
** preparing package for lazy loading
** help
*** installing help indices
Error in `[.data.frame`(M, , 4) : undefined columns selected
* Removing ?/usr/local/lib/R/site-library/Rmap?

The error is easily reproducible, as it's caused by the lack
of Rd documentation in the "man" directory; adding even one
Rd file solves the problem. It's clearly a corner case (yes. I'm
lazy and should have written the documentation a long time
ago), but if you think it's worth the time it would be better to
have a clearer error message from R CMD check.

P.S.: this is on an updated Debian Sid:

[fizban@~/Rmap]:dpkg -l | grep "ii  r-" | grep -v cran
ii  r-base                               2.9.0-4
GNU R statistical computation and graphics system
ii  r-base-core                          2.9.0-4
GNU R core of statistical computation and graphics system
ii  r-recommended                        2.9.0-4
GNU R collection of recommended packages [metapackage]

Thanks for your time,
  Marco Scutari

-- 
Marco Scutari, Ph.D. Student
Department of Statistical Sciences
University of Padova, Italy
"Facts don't care if you feel good about them." Slashdot, 25/10/07


From bolker at ufl.edu  Tue Jun  2 13:51:59 2009
From: bolker at ufl.edu (Ben Bolker)
Date: Tue, 2 Jun 2009 04:51:59 -0700 (PDT)
Subject: [Rd] install.packages hangs RGui with frozen rpwd process at
 bottom of process tree (PR#13734)
In-Reply-To: <20090531044509.BA68C2830319@mail.pubhealth.ku.dk>
References: <20090531044509.BA68C2830319@mail.pubhealth.ku.dk>
Message-ID: <23831109.post@talk.nabble.com>




astokes wrote:
> 
> Full_Name: Allan Stokes
> Version: 2.8.1
> OS: XP
> Submission from: (NULL) (24.108.0.245)
> 
> 
> I've just spent a hellish six hours trying to create my own R package with
> a
> bare bones "hello world" R function inside.  I was able to create a
> package.tar.gz file eventually with much perseverance.  
> 
> My remaining problem is that when I try to install my simple package under
> RGui,
> it hangs.  
> 
> install.packages("c:/testR/scupper_1.0.tar.gz", repos=NULL, type="source",
> lib="c:/allanR")
> 
> The hung process tree as shown by SysInternals Process Explorer.  
> [snip]
> 
> I've tried this under Rtools 2.9 and then 2.8.  I also updated my Cygwin
> config
> (which was pretty current).  
> 
> No dice.  
> 
> My little package contains an R function as such: 
> 
> `ahoy` <-
> function () { cat ("Shiver me timbers!\n")}
> 
> And a DESCRIPTION file like this: 
> 
> Package: scupper
> Type: Package
> Title: Ship ahoy
> Version: 1.0
> Date: 2009-05-30
> Author: Allan Stokes
> Maintainer: <astokes at esica.com>
> Description: Responds to ahoy() greeting.  
> License: internal use only
> LazyLoad: yes
> 
> There are empty data, man, and test directories.  
> 
> I would reboot my system and try again, but I'd have to shut down 30
> programs on
> nine desktops, and I haven't got that many lives.  I have been sure to
> restart
> RGui with the correct PATH env. for each test run.
> 
> 

  I admit that I haven't tried to build packages under Windows, but what
was "hellish"?  Is there a chance that you managed to build a malformed
package?
Can you post your source package somewhere for others to check?
-- 
View this message in context: http://www.nabble.com/install.packages-hangs-RGui-with-frozen-rpwd-process-at-bottom-of-process-tree-%28PR-13734%29-tp23811129p23831109.html
Sent from the R devel mailing list archive at Nabble.com.


From mtmorgan at fhcrc.org  Tue Jun  2 14:38:57 2009
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Tue, 02 Jun 2009 05:38:57 -0700
Subject: [Rd] S4 Objects [Sec=Unclassified]
In-Reply-To: <42C7503E0B99F248B06BC65E7D2B4E0201225C193870@EX2K7-CCR.AAD.GOV.AU>
References: <42C7503E0B99F248B06BC65E7D2B4E0201225C193870@EX2K7-CCR.AAD.GOV.AU>
Message-ID: <4A251D61.7010209@fhcrc.org>

Hi Troy --

Troy Robertson wrote:
> I am new to R programming but have dived into a medium sized modelling software development project.
> 
> Having come from a Java OO background I have a couple of questions about S4 objects.
> 
> 
> 
> Is there a way to make S4 slots (and methods) private and hence force the use of accessor methods?


No, except by convention (e.g., 'don't directly access slots
name-mangled in this way'; non-package code must never directly access
slots')

> 
> 
> 
> Is there a straight-forward way to implement pass-by-reference for method parameters?
> 
> I am currently returning and overwritting updated objects which is clunky and costly and would like a more efficient way of doing this.

no, copy-on-change is the most common semantic in R; using an
'environment' provides some flexibility, but use with S4 introduces
twists. See this concurrent thread

  https://stat.ethz.ch/pipermail/r-help/2009-June/200038.html

(my 2 cents:) embracing rather than avoiding the paradigm might lead to
different designs, e.g., 'column-oriented' (an S4 instance representing
an entire table) rather than row-oriented (an S4 instance for each row)
data structures.


> 
> 
> Can anyone point me to some useful texts on S4 programming apart from the following:
> 
> Chambers - Software for Data Analysis: Programming with R
> 
> Venables - S Programming
> 

Gentleman, R Programming for Bioinformatics.

Hope that helps.

Martin
> 
> 
> Thanks heaps
> 
> 
> 
> Troy
> 
> 
> 
> 
> 
> 
> ___________________________________________________________________________
> 
>     Australian Antarctic Division - Commonwealth of Australia
> IMPORTANT: This transmission is intended for the addressee only. If you are not the
> intended recipient, you are notified that use or dissemination of this communication is
> strictly prohibited by Commonwealth law. If you have received this transmission in error,
> please notify the sender immediately by e-mail or by telephoning +61 3 6232 3209 and
> DELETE the message.
>         Visit our web site at http://www.antarctica.gov.au/
> ___________________________________________________________________________
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From dwright at fiu.edu  Tue Jun  2 14:35:34 2009
From: dwright at fiu.edu (Daniel Wright)
Date: Tue, 2 Jun 2009 08:35:34 -0400
Subject: [Rd] warning: some HTML links ...
Message-ID: <F7E843E0F21217498B263FD3D9B8165C0FBFF4@FIUMB06CCR.ad.fiu.edu>

Hi Everyone,

I am getting a warning when I build and package from windows. The warning is "some HTML links may not be found". Through some searching I found this probably has to do with the Microsoft HTML Help Workshop, but I have installed it (a few times) from the different locations in the manual and have the path as listed. When I install the package in my R session all the help files (which I assumes is what the error is about) work fine as do the functions.

Has anybody else had this problem and have found a solution? 

Dan


Daniel B. Wright
Psychology 
Florida International University
11200 S.W. 8th Street 
Miami, FL 33199, USA 

http://www.fiu.edu/~dwright/                                                   
dwright at fiu.edu

From bolker at ufl.edu  Tue Jun  2 14:44:03 2009
From: bolker at ufl.edu (Ben Bolker)
Date: Tue, 2 Jun 2009 05:44:03 -0700 (PDT)
Subject: [Rd] The default position of plot title
In-Reply-To: <38b9f0350906020112uffb43d7k1748b745d5c4d542@mail.gmail.com>
References: <38b9f0350906020112uffb43d7k1748b745d5c4d542@mail.gmail.com>
Message-ID: <23831792.post@talk.nabble.com>




ronggui-2 wrote:
> 
> Dear R-developers,
> 
> It seems to me that the position of title is usually at the bottom of
> a plot in sociological and political science books and articles. I
> wonder if the same convention applies in other disciplines. If yes, is
> it reasonable to change the default position of main title of plot
> function?
> 
> 

  I'm not an R developer, but:

 * in my field (biology/ecology), it's at the top.
 * it doesn't seem that hard to put the titles where you want with mtext()
 * changing this would have major backward-compatibility/surprise issues
for all the other users who expect the title to be at the top ...

  Ben Bolker

-- 
View this message in context: http://www.nabble.com/The-default-position-of-plot-title-tp23828342p23831792.html
Sent from the R devel mailing list archive at Nabble.com.


From thomas.baier at logicals.com  Tue Jun  2 14:46:08 2009
From: thomas.baier at logicals.com (Thomas Baier)
Date: Tue, 2 Jun 2009 14:46:08 +0200 
Subject: [Rd] Recommendations for a quick UI.
Message-ID: <405593F1A35DDD11B2B4000C29F5CF530349F2@exchange-server.ow.ks>

Alex,

Kevin R. Coombes wrote:
> The following idea only partially answers your question....
> 
> I have successfully written a GUI using the tcl/tk package
> that ships with standard R. It is then possible (in Windows)
> to create a shortcut icon that runs the following command:
>     C:\R\R-2.8.1\bin\R.exe --vanilla -e
> library(SuperCurveGUI);sc(); Note two features:
> [1] the first part of the -e switch loads the library
> containing the GUI [2] the second part (after the semicolon) launches
> the GUI 
> 
> If you make a "normal" shortcut this way, a batch window will
> open showing the ongoing R session, which is not quite what you want.
> However, if you adjust the shortcut to "Run: Minimized", then
> (most) users will never see the batch window, and will only
> see the GUI.
> 
> The reasons that this only partially answers your question
> are [1] It is Windows-specific [2] I do not know how to set
> up the shortcut automatically upon installation.

depending on how deep you want to dig into programming (aside from R), you
could use any COM client (on Windows), e.g., Visual Basic, C# using
statconnDCOM (just download and install the package rcom) or using Java
(RServe)

Thomas


From Jerry.Lewis at biogenidec.com  Tue Jun  2 13:10:09 2009
From: Jerry.Lewis at biogenidec.com (Jerry.Lewis at biogenidec.com)
Date: Tue,  2 Jun 2009 13:10:09 +0200 (CEST)
Subject: [Rd] qpois documentation (PR#13743)
Message-ID: <20090602111009.7C598282BE89@mail.pubhealth.ku.dk>

Full_Name: Jerry W. Lewis
Version: 2.9.0
OS: Windows XP Professional
Submission from: (NULL) (166.186.168.103)


Quantiles for discrete distributions are consitently implemented, but
inconsitently documented.  Help for qpois incorrectly states in the Details
section that
  "The quantile is left continuous: qgeom(q, prob) is the largest integer x such
that P(X <= x) < q."
which disagrees with the implementation; it should read
  "The quantile is defined as the smallest value x such that F(x) >= p, where F
is the distribution function."
Also, this definition should be added to Help for qhyper.


From macrakis at alum.mit.edu  Tue Jun  2 17:13:48 2009
From: macrakis at alum.mit.edu (Stavros Macrakis)
Date: Tue, 2 Jun 2009 11:13:48 -0400
Subject: [Rd] setdiff bizarre (was: odd behavior out of setdiff)
In-Reply-To: <8b356f880905300859i5ba5800q5594bfce659373fe@mail.gmail.com>
References: <a695148b0905292135g1c1bee38xb70687a43ccaa934@mail.gmail.com>
	<8b356f880905300550y39c76b02h2d908b1c6b0ef0e4@mail.gmail.com>
	<a695148b0905300721x6e291e0bg66fefcf0931f2ce2@mail.gmail.com>
	<8b356f880905300859i5ba5800q5594bfce659373fe@mail.gmail.com>
Message-ID: <8b356f880906020813w6b7075b6g411fc177b508709e@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090602/9a8d85ef/attachment.pl>

From luke at stat.uiowa.edu  Tue Jun  2 17:28:20 2009
From: luke at stat.uiowa.edu (luke at stat.uiowa.edu)
Date: Tue, 2 Jun 2009 10:28:20 -0500 (CDT)
Subject: [Rd] reference counting bug: overwriting for loop 'seq' variable
In-Reply-To: <77EB52C6DD32BA4D87471DCD70C8D7000147B6C7@NA-PA-VBE03.na.tibco.com>
References: <77EB52C6DD32BA4D87471DCD70C8D7000147B6C7@NA-PA-VBE03.na.tibco.com>
Message-ID: <alpine.LFD.2.00.0906021027470.7161@nokomis.stat.uiowa.edu>

Thanks for the report.  Should be fixed in teh devel and 2.9 branches.

luke

On Mon, 1 Jun 2009, William Dunlap wrote:

> It looks like the 'seq' variable to 'for' can be altered from
> within the loop, leading to incorrect answers.  E.g., in
> the following I'd expect 'sum' to be 1+2=3, but R 2.10.0
> (svn 48686) gives 44.5.
>
>   > x = c(1,2);  sum = 0; for (i in x) { x[i+1] = i + 42.5; sum = sum +
> i }; sum
>   [1] 44.5
> or, with a debugging cat()s,
>   > x = c(1,2);  sum = 0; for (i in x) { cat("before, i=", i, "\n");
> x[i+1] = i + 42.5; cat("after, i=", i,"\n"); sum = sum + i }; sum
>   before, i= 1
>   after, i= 1
>   before, i= 43.5
>   after, i= 43.5
>   [1] 44.5
>
> If I force the for's 'seq' to be a copy of x by adding 0 to it, then I
> do get the expected answer.
>
>   > x = c(1,2);  sum = 0; for (i in x+0) { x[i+1] = i + 42.5; sum = sum
> + i }; sum
>   bbbbb[1] 3
>
> It looks like an error in reference counting.
>
> Bill Dunlap
> TIBCO Software Inc - Spotfire Division
> wdunlap tibco.com
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Luke Tierney
Chair, Statistics and Actuarial Science
Ralph E. Wareham Professor of Mathematical Sciences
University of Iowa                  Phone:             319-335-3386
Department of Statistics and        Fax:               319-335-3017
    Actuarial Science
241 Schaeffer Hall                  email:      luke at stat.uiowa.edu
Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu


From macrakis at alum.mit.edu  Tue Jun  2 17:29:23 2009
From: macrakis at alum.mit.edu (Stavros Macrakis)
Date: Tue, 2 Jun 2009 11:29:23 -0400
Subject: [Rd] Recommendations for a quick UI.
In-Reply-To: <18979.54726.247587.937870@cmath-5.math.ethz.ch>
References: <4A23662A.5030609@uthscsa.edu>
	<18979.54726.247587.937870@cmath-5.math.ethz.ch>
Message-ID: <8b356f880906020829x572d8409gdffef60ca31b64bc@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090602/31cb8a6b/attachment.pl>

From luke at stat.uiowa.edu  Tue Jun  2 17:34:47 2009
From: luke at stat.uiowa.edu (luke at stat.uiowa.edu)
Date: Tue, 2 Jun 2009 10:34:47 -0500 (CDT)
Subject: [Rd] formal argument "envir" matched by multiple actual
 arguments
In-Reply-To: <59d7961d0906020125w5b399755j594a018ca608318c@mail.gmail.com>
References: <4A24839C.50403@fhcrc.org>
	<20090602010540.k6d93dfdycc884wg@webmail.fhcrc.org>
	<59d7961d0906020125w5b399755j594a018ca608318c@mail.gmail.com>
Message-ID: <alpine.LFD.2.00.0906021031000.7161@nokomis.stat.uiowa.edu>

On Tue, 2 Jun 2009, Henrik Bengtsson wrote:

> Nice case - I think you're onto something. /Henrik
>
> 2009/6/2  <hpages at fhcrc.org>:
>> In fact reg.finalizer() looks like a dangerous feature.
>>
>> If the finalizer itself triggers (implicitely or
>> explicitely) garbage collection, then bad things happen.
>> In the following example, garbage collection is triggered
>> explicitely (using R-2.9.0):
>>
>> ? setClass("B", representation(bb="environment"))
>>
>> ? newB <- function()
>> ? {
>> ? ? ans <- new("B", bb=new.env())
>> ? ? reg.finalizer(ans at bb,
>> ? ? ? ? ? ? ? ? ? function(e)
>> ? ? ? ? ? ? ? ? ? {
>> ? ? ? ? ? ? ? ? ? ? ? gc()
>> ? ? ? ? ? ? ? ? ? ? ? cat("cleaning", class(ans), "object...\n")
>> ? ? ? ? ? ? ? ? ? }
>> ? ? )
>> ? ? return(ans)
>> ? }
>>
>> ? > for (i in 1:500) {cat(i, "\n"); b1 <- newB()}
>> ? 1
>> ? 2
>> ? 3
>> ? 4
>> ? 5
>> ? 6
>> ? ...
>> ? 13
>> ? cleaning B object...
>> ? cleaning B object...
>> ? cleaning B object...
>> ? cleaning B object...
>> ? cleaning B object...
>> ? cleaning B object...
>> ? cleaning B object...
>> ? cleaning B object...
>> ? cleaning B object...
>> ? cleaning B object...
>> ? cleaning B object...
>> ? 14
>> ? ...
>> ? 169
>> ? 170
>> ? 171
>> ? Error: not a weak reference
>> ? Error: not a weak reference
>> ? [repeat the above line thousands of times]
>> ? ...
>> ? Error: not a weak reference
>> ? Error: not a weak reference
>> ? cleaning B object...
>> ? Error: SET_VECTOR_ELT() can only be applied to a 'list', not a 'integer'
>> ? Error: SET_VECTOR_ELT() can only be applied to a 'list', not a 'integer'
>> ? [repeat the above line thousands of times]
>> ? ...
>> ? Error: SET_VECTOR_ELT() can only be applied to a 'list', not a 'integer'
>> ? Error: SET_VECTOR_ELT() can only be applied to a 'list', not a 'integer'
>> ? 172
>> ? ...
>> ? 246
>> ? 247
>> ? cleaning B object...
>> ? cleaning B object...
>> ? cleaning B object...
>> ? cleaning B object...
>> ? cleaning B object...
>> ? cleaning B object...
>> ? cleaning B object...
>> ? cleaning B object...
>> ? cleaning B object...
>> ? cleaning B object...
>> ? cleaning B object...
>> ? cleaning B object...
>> ? cleaning B object...
>> ? cleaning B object...
>> ? cleaning B object...
>> ? cleaning B object...
>> ? cleaning B object...
>> ? cleaning B object...
>> ? cleaning B object...
>>
>> ? ?*** caught segfault ***
>> ? address 0x41, cause 'memory not mapped'
>>
>> ? Traceback:
>> ? ?1: gc()
>> ? ?2: function (e) { ? ?gc() ? ?cat("cleaning", class(ans),
>> "object...\n")}(<environment>)
>>
>> ? Possible actions:
>> ? 1: abort (with core dump, if enabled)
>> ? 2: normal R exit
>> ? 3: exit R without saving workspace
>> ? 4: exit R saving workspace
>> ? Selection: 2
>> ? Save workspace image? [y/n/c]: n
>> ? Segmentation fault
>>
>> So apparently, if the finalizer triggers garbage collection,
>> then we can end up with a corrupted session. Then anything can
>> happen, from the strange 'formal argument "envir" matched by
>> multiple actual arguments' error I reported in the previous post,
>> to a segfault. In the worse case, nothing apparently happens but
>> the output produced by the code is wrong.
>>
>> Maybe garbage collection requests should be ignored during the
>> execution of the finalizer? (and more generally during garbbage
>> collection itself)

Thanks for the report.  The gc proper does not (or should not) do
anything that could cause allocation or trigger another gc.  The gc
proper only identifies objects ready for finalization; running the
finalizers happens outside the gc proper where allocation and gc calls
should be safe.  This looks like either a missing PROTECT call in the
code for running finalizers or possibly a more subltle bug in managing
the lists of objects in different states of finalization. I will look
more carefully when I get a chance.

luke


>>
>> Cheers,
>> H.
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Luke Tierney
Chair, Statistics and Actuarial Science
Ralph E. Wareham Professor of Mathematical Sciences
University of Iowa                  Phone:             319-335-3386
Department of Statistics and        Fax:               319-335-3017
    Actuarial Science
241 Schaeffer Hall                  email:      luke at stat.uiowa.edu
Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu

From Waclaw.Marcin.Kusnierczyk at idi.ntnu.no  Tue Jun  2 18:10:57 2009
From: Waclaw.Marcin.Kusnierczyk at idi.ntnu.no (Wacek Kusnierczyk)
Date: Tue, 02 Jun 2009 18:10:57 +0200
Subject: [Rd] setdiff bizarre
In-Reply-To: <8b356f880906020813w6b7075b6g411fc177b508709e@mail.gmail.com>
References: <a695148b0905292135g1c1bee38xb70687a43ccaa934@mail.gmail.com>	<8b356f880905300550y39c76b02h2d908b1c6b0ef0e4@mail.gmail.com>	<a695148b0905300721x6e291e0bg66fefcf0931f2ce2@mail.gmail.com>	<8b356f880905300859i5ba5800q5594bfce659373fe@mail.gmail.com>
	<8b356f880906020813w6b7075b6g411fc177b508709e@mail.gmail.com>
Message-ID: <4A254F11.3060207@idi.ntnu.no>

Stavros Macrakis wrote:
>
>      '1:3' %in% data.frame(a=2:4,b=1:3)  # TRUE
>   

utterly weird.  so what would x have to be so that

    x %in% data.frame('a')
    # TRUE

hint: 

    '1' %in% data.frame(1)
    # TRUE

vQ


From wdunlap at tibco.com  Tue Jun  2 19:18:23 2009
From: wdunlap at tibco.com (William Dunlap)
Date: Tue, 2 Jun 2009 10:18:23 -0700
Subject: [Rd] setdiff bizarre
In-Reply-To: <4A254F11.3060207@idi.ntnu.no>
References: <a695148b0905292135g1c1bee38xb70687a43ccaa934@mail.gmail.com>	<8b356f880905300550y39c76b02h2d908b1c6b0ef0e4@mail.gmail.com>	<a695148b0905300721x6e291e0bg66fefcf0931f2ce2@mail.gmail.com>	<8b356f880905300859i5ba5800q5594bfce659373fe@mail.gmail.com><8b356f880906020813w6b7075b6g411fc177b508709e@mail.gmail.com>
	<4A254F11.3060207@idi.ntnu.no>
Message-ID: <77EB52C6DD32BA4D87471DCD70C8D7000147B788@NA-PA-VBE03.na.tibco.com>

%in% is a thin wrapper on a call to match().  match() is
not a generic function (and is not documented to be one),
so it treats data.frames as lists, as their underlying
representation is a list of columns.  match is documented
to convert lists to character and to then run the character
version of match on that character data.  match does not
bail out if the types of the x and table arguments don't match
(that would be undesirable in the integer/numeric mismatch case).
Hence
   '1' %in% data.frame(1) # -> TRUE
is acting consistently with
   match(as.character(pi), c(1, pi, exp(1))) # -> 2
and
   1L %in% c(1.0, 2.0, 3.0) # -> TRUE

The related functions, duplicated() and unique(), do have
row-wise data.frame methods.  E.g.,
   > duplicated(data.frame(x=c(1,2,2,3,3),y=letters[c(1,1,2,2,2)]))
   [1] FALSE FALSE FALSE FALSE  TRUE
Perhaps match() ought to have one also.  S+'s match is generic
and has a data.frame method (which is row-oriented) so there we get:
   >  match(data.frame(x=c(1,3,5), y=letters[c(1,3,5)]),
data.frame(x=1:10,y=letters[1:10]))
   [1] 1 3 5
   > is.element(data.frame(x=1:10,y=letters[1:10]),
data.frame(x=c(1,3,5), y=letters[c(1,3,5)]))
    [1]  TRUE FALSE  TRUE FALSE  TRUE FALSE FALSE FALSE FALSE FALSE

I think that %in% and is.element() ought to remain calls to match()
and that if you want them to work row-wise on data.frames then
match should get a data.frame method.


Bill Dunlap
TIBCO Software Inc - Spotfire Division
wdunlap tibco.com  

> -----Original Message-----
> From: r-devel-bounces at r-project.org 
> [mailto:r-devel-bounces at r-project.org] On Behalf Of Wacek Kusnierczyk
> Sent: Tuesday, June 02, 2009 9:11 AM
> To: Stavros Macrakis
> Cc: r-devel at r-project.org; dwinsemius at comcast.net
> Subject: Re: [Rd] setdiff bizarre
> 
> Stavros Macrakis wrote:
> >
> >      '1:3' %in% data.frame(a=2:4,b=1:3)  # TRUE
> >   
> 
> utterly weird.  so what would x have to be so that
> 
>     x %in% data.frame('a')
>     # TRUE
> 
> hint: 
> 
>     '1' %in% data.frame(1)
>     # TRUE
> 
> vQ
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 


From b.rowlingson at lancaster.ac.uk  Tue Jun  2 19:23:00 2009
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Tue, 2 Jun 2009 18:23:00 +0100
Subject: [Rd] setdiff bizarre (was: odd behavior out of setdiff)
In-Reply-To: <8b356f880906020813w6b7075b6g411fc177b508709e@mail.gmail.com>
References: <a695148b0905292135g1c1bee38xb70687a43ccaa934@mail.gmail.com>
	<8b356f880905300550y39c76b02h2d908b1c6b0ef0e4@mail.gmail.com>
	<a695148b0905300721x6e291e0bg66fefcf0931f2ce2@mail.gmail.com>
	<8b356f880905300859i5ba5800q5594bfce659373fe@mail.gmail.com>
	<8b356f880906020813w6b7075b6g411fc177b508709e@mail.gmail.com>
Message-ID: <d8ad40b50906021023u406a77bfke070c8b925385723@mail.gmail.com>

On Tue, Jun 2, 2009 at 4:13 PM, Stavros Macrakis <macrakis at alum.mit.edu> wrote:

> but simply treats the data frame as a *character* list:
>
> ? ? 1 %in% data.frame(a=2,b=1) ?# TRUE
> ? ? '1' %in% data.frame(a=2,b=1) ?# TRUE
> ? ? 1 %in% data.frame(a=2:3,b=1:2) # FALSE
> ? ? 1:3 %in% data.frame(a=2:4,b=1:3) ?# FALSE FALSE FALSE
> ? ? '1:3' %in% data.frame(a=2:4,b=1:3) ?# TRUE

It applies as.character to the dataframe:

 > z=data.frame(a=2:4,b=1:3)
 > as.character(z)
 [1] "2:4" "1:3"

  The as.character method for data frames seems to spot integer
sequences (but only for int types and not num types) and show the a:b
notation:

 > x=data.frame(z=as.integer(c(1,2,3,4,5)))
 > str(x)
 'data.frame':	5 obs. of  1 variable:
  $ z: int  1 2 3 4 5
 > as.character(x)
 [1] "1:5"

 Obviously it doesn't do this for vectors:

 > as.character(x$z)
 [1] "1" "2" "3" "4" "5"

 I suspect it's using 'deparse()' to get the character representation.
This function is mentioned in ?as.character, but as.character.default
disappears into the infernal .Internal and I don't have time to chase
source code - it's sunny outside!

Barry


From Waclaw.Marcin.Kusnierczyk at idi.ntnu.no  Tue Jun  2 20:03:36 2009
From: Waclaw.Marcin.Kusnierczyk at idi.ntnu.no (Wacek Kusnierczyk)
Date: Tue, 02 Jun 2009 20:03:36 +0200
Subject: [Rd] setdiff bizarre
In-Reply-To: <77EB52C6DD32BA4D87471DCD70C8D7000147B788@NA-PA-VBE03.na.tibco.com>
References: <a695148b0905292135g1c1bee38xb70687a43ccaa934@mail.gmail.com>	<8b356f880905300550y39c76b02h2d908b1c6b0ef0e4@mail.gmail.com>	<a695148b0905300721x6e291e0bg66fefcf0931f2ce2@mail.gmail.com>	<8b356f880905300859i5ba5800q5594bfce659373fe@mail.gmail.com><8b356f880906020813w6b7075b6g411fc177b508709e@mail.gmail.com>
	<4A254F11.3060207@idi.ntnu.no>
	<77EB52C6DD32BA4D87471DCD70C8D7000147B788@NA-PA-VBE03.na.tibco.com>
Message-ID: <4A256978.3020703@idi.ntnu.no>

William Dunlap wrote:
> %in% is a thin wrapper on a call to match().  match() is
> not a generic function (and is not documented to be one),
> so it treats data.frames as lists, as their underlying
> representation is a list of columns.  match is documented
> to convert lists to character and to then run the character
> version of match on that character data.  match does not
> bail out if the types of the x and table arguments don't match
> (that would be undesirable in the integer/numeric mismatch case).
>   

yes, i understand that this is documented behaviour, and that it's not a
bug.  nevertheless, the example is odd, and hints that there's a design
flaw.  i also do not understand why the following should be useful and
desirable:

    as.character(list('a'))
    # "a"

    as.character(data.frame('a'))
    # "1"

and hence

    'a' %in% list('a')
    # TRUE

while

    'a' %in% data.frame('a')
    # FALSE
    '1' %in% data.frame('a')
    # TRUE

there is a mechanistic explanation for how this works, but is there one
for why this works this way?


> Hence
>    '1' %in% data.frame(1) # -> TRUE
> is acting consistently with
>    match(as.character(pi), c(1, pi, exp(1))) # -> 2
> and
>    1L %in% c(1.0, 2.0, 3.0) # -> TRUE
>
> The related functions, duplicated() and unique(), do have
> row-wise data.frame methods.  E.g.,
>    > duplicated(data.frame(x=c(1,2,2,3,3),y=letters[c(1,1,2,2,2)]))
>    [1] FALSE FALSE FALSE FALSE  TRUE
> Perhaps match() ought to have one also.  S+'s match is generic
> and has a data.frame method (which is row-oriented) so there we get:
>    >  match(data.frame(x=c(1,3,5), y=letters[c(1,3,5)]),
> data.frame(x=1:10,y=letters[1:10]))
>    [1] 1 3 5
>    > is.element(data.frame(x=1:10,y=letters[1:10]),
> data.frame(x=c(1,3,5), y=letters[c(1,3,5)]))
>     [1]  TRUE FALSE  TRUE FALSE  TRUE FALSE FALSE FALSE FALSE FALSE
>
> I think that %in% and is.element() ought to remain calls to match()
> and that if you want them to work row-wise on data.frames then
> match should get a data.frame method.
>   

sounds good to me.  how is

    'a' %in% data.frame('a')

in S+?

thanks for the response.

regards,
vQ


From Greg.Snow at imail.org  Tue Jun  2 20:26:46 2009
From: Greg.Snow at imail.org (Greg Snow)
Date: Tue, 2 Jun 2009 12:26:46 -0600
Subject: [Rd] Recommendations for a quick UI.
In-Reply-To: <4A23662A.5030609@uthscsa.edu>
References: <4A23662A.5030609@uthscsa.edu>
Message-ID: <B37C0A15B8FB3C468B5BC7EBC7DA14CC61D20ACE31@LP-EXMBVS10.CO.IHC.COM>

Some possibilities:

The Rcmdr package is a very good example of a GUI built using Tk (it does not hide the R program, but lets you do analyses using menus and dialogs).  Rcmdr also has a plug-in mechanism to write extensions to it, depending on what you want to do, writing a simple extension to Rcmdr may be enough and a lot less work than creating your own from scratch.

There are tools (Rpad, Rserve, and others) that allow web interfaces to R, that may work for you.

There is the Rcom project uses R as a background tool for other programs, the most developed tool uses MSExcel as the GUI with R doing the heavy work behind the scenes.  There are various examples of tools using the excel interface available.


There is a lot of info at: http://www.sciviews.org/_rgui/

Hope this helps,

-- 
Gregory (Greg) L. Snow Ph.D.
Statistical Data Center
Intermountain Healthcare
greg.snow at imail.org
801.408.8111


> -----Original Message-----
> From: r-devel-bounces at r-project.org [mailto:r-devel-bounces at r-
> project.org] On Behalf Of Alex Bokov
> Sent: Sunday, May 31, 2009 11:25 PM
> To: r-devel at r-project.org
> Subject: [Rd] Recommendations for a quick UI.
> 
> Hi. This is my first post to this list, I seem to be graduating to from
> the r-help list. :-)
> 
> I'm trying to wrap my R package in a GUI such that when the user
> launches the app, they see my GUI window and never interact with the R
> console at all. I don't have any fancy requirements for the GUI itself-
> -
> all it needs to do is collect input from the user and pass the input as
> arguments to an R function, which writes the results to a file.
> 
> I read the R Extensions Manual section about GUIs, and it seems like
> overkill to write the thing in a compiled language and link against R
> as
> a library when there are dozens of different interpreted cross-platform
> GUI toolkits out there. Does anybody know of any functioning examples
> of
> packages (or other add-ons) with GUIs that run R silently in the
> background which I can study? Do they use the "R CMD BATCH" mechanism,
> or something else?
> 
> Thanks.
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From wdunlap at tibco.com  Tue Jun  2 20:29:03 2009
From: wdunlap at tibco.com (William Dunlap)
Date: Tue, 2 Jun 2009 11:29:03 -0700
Subject: [Rd] setdiff bizarre
In-Reply-To: <4A256978.3020703@idi.ntnu.no>
References: <a695148b0905292135g1c1bee38xb70687a43ccaa934@mail.gmail.com>	<8b356f880905300550y39c76b02h2d908b1c6b0ef0e4@mail.gmail.com>	<a695148b0905300721x6e291e0bg66fefcf0931f2ce2@mail.gmail.com>	<8b356f880905300859i5ba5800q5594bfce659373fe@mail.gmail.com><8b356f880906020813w6b7075b6g411fc177b508709e@mail.gmail.com>
	<4A254F11.3060207@idi.ntnu.no>
	<77EB52C6DD32BA4D87471DCD70C8D7000147B788@NA-PA-VBE03.na.tibco.com>
	<4A256978.3020703@idi.ntnu.no>
Message-ID: <77EB52C6DD32BA4D87471DCD70C8D7000147B7EF@NA-PA-VBE03.na.tibco.com>


> > ...
> > The related functions, duplicated() and unique(), do have
> > row-wise data.frame methods.  E.g.,
> >    > duplicated(data.frame(x=c(1,2,2,3,3),y=letters[c(1,1,2,2,2)]))
> >    [1] FALSE FALSE FALSE FALSE  TRUE
> > Perhaps match() ought to have one also.  S+'s match is generic
> > and has a data.frame method (which is row-oriented) so there we get:
> >    >  match(data.frame(x=c(1,3,5), y=letters[c(1,3,5)]),
> > data.frame(x=1:10,y=letters[1:10]))
> >    [1] 1 3 5
> >    > is.element(data.frame(x=1:10,y=letters[1:10]),
> > data.frame(x=c(1,3,5), y=letters[c(1,3,5)]))
> >     [1]  TRUE FALSE  TRUE FALSE  TRUE FALSE FALSE FALSE FALSE FALSE
> >
> > I think that %in% and is.element() ought to remain calls to match()
> > and that if you want them to work row-wise on data.frames then
> > match should get a data.frame method.
> >   
> 
> sounds good to me.  how is
> 
>     'a' %in% data.frame('a')
> 
> in S+?
> 
> thanks for the response.

S+ gives:
   >  'a' %in% data.frame(letters)
   [1] TRUE
   > 'a' %in% data.frame(letters[2:26])
   [1] FALSE
but that special case, x a scalar and table a data.frame with
one column, gets by more or less by accident.
   > 'a' %in% data.frame(letters, num=1:26)
   Problem in match.data.frame(x, table, nomatch, incom..: table must be
a list the same length as x
   > c('a', 'b') %in% data.frame(letters)
   Problem in match.data.frame(x, table, nomatch, incom..: table must be
a list the same length as x
The intent is that the x and table arguments to match be
compatible data.frames.

S+'s match works differently on lists than R's does.  It is set
up to work on data.frame-like things: x and table must be
lists of the the same length and within each list, each element
must have the same length.  It acts like
  match(do.call("paste",x), do.call("paste",table))
but doesn't actually do the conversion to character implied in
that (it hashes all the entries in each 'row' into one hash table
entry, using the usual type-specific hash number computation
on each entry and combining them to make the row hash number).
E.g.,
   > match(list(c(3,2), c(1,7), c(4,1)),
list(c(1,4,2,3),c(0,6,7,1),c(0,5,1,4)))
   [1] 4 3

(Its match.data.frame() doesn't actually call this, for
historical/inertial
reasons.  It goes the paste() route.)
 
Bill Dunlap
TIBCO Software Inc - Spotfire Division
wdunlap tibco.com 


From Waclaw.Marcin.Kusnierczyk at idi.ntnu.no  Tue Jun  2 20:47:20 2009
From: Waclaw.Marcin.Kusnierczyk at idi.ntnu.no (Wacek Kusnierczyk)
Date: Tue, 02 Jun 2009 20:47:20 +0200
Subject: [Rd] setdiff bizarre
In-Reply-To: <d8ad40b50906021023u406a77bfke070c8b925385723@mail.gmail.com>
References: <a695148b0905292135g1c1bee38xb70687a43ccaa934@mail.gmail.com>	<8b356f880905300550y39c76b02h2d908b1c6b0ef0e4@mail.gmail.com>	<a695148b0905300721x6e291e0bg66fefcf0931f2ce2@mail.gmail.com>	<8b356f880905300859i5ba5800q5594bfce659373fe@mail.gmail.com>	<8b356f880906020813w6b7075b6g411fc177b508709e@mail.gmail.com>
	<d8ad40b50906021023u406a77bfke070c8b925385723@mail.gmail.com>
Message-ID: <4A2573B8.8010606@idi.ntnu.no>

Barry Rowlingson wrote:

[...]

> I suspect it's using 'deparse()' to get the character representation.
> This function is mentioned in ?as.character, but as.character.default
> disappears into the infernal .Internal and I don't have time to chase
> source code - it's sunny outside!
>   

on the side, as.character triggers do_ascharacter, which in turn calls
DispatchOrEval, a function with the following beautiful comment:

"To call this an ugly hack would be to insult all existing ugly hacks at
large in the world."

a fortune?

vQ


From macrakis at alum.mit.edu  Tue Jun  2 21:11:02 2009
From: macrakis at alum.mit.edu (Stavros Macrakis)
Date: Tue, 2 Jun 2009 15:11:02 -0400
Subject: [Rd] setdiff bizarre
In-Reply-To: <77EB52C6DD32BA4D87471DCD70C8D7000147B788@NA-PA-VBE03.na.tibco.com>
References: <a695148b0905292135g1c1bee38xb70687a43ccaa934@mail.gmail.com>
	<8b356f880905300550y39c76b02h2d908b1c6b0ef0e4@mail.gmail.com>
	<a695148b0905300721x6e291e0bg66fefcf0931f2ce2@mail.gmail.com>
	<8b356f880905300859i5ba5800q5594bfce659373fe@mail.gmail.com>
	<8b356f880906020813w6b7075b6g411fc177b508709e@mail.gmail.com>
	<4A254F11.3060207@idi.ntnu.no>
	<77EB52C6DD32BA4D87471DCD70C8D7000147B788@NA-PA-VBE03.na.tibco.com>
Message-ID: <8b356f880906021211u7ed8adetc2d1a557990877b3@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090602/0bc11c84/attachment.pl>

From dutangc at gmail.com  Tue Jun  2 23:53:21 2009
From: dutangc at gmail.com (Christophe Dutang)
Date: Tue, 2 Jun 2009 23:53:21 +0200
Subject: [Rd] statutes of R Foundation
Message-ID: <D2712366-19FF-4745-91D9-E4426BDF893D@gmail.com>

Good evening all,

I realised yesterday that the R Foundation statutes doc was only  
available in English and in German.

I tried to translate into French: a first version is available here http://dutangc.free.fr/pub/statut%20R.pdf 
  .

Could you please tell me what do you think of my translation?

Thanks in advance



Christophe

PS : Tex sources are here http://dutangc.free.fr/pub/statut%20R.tex

--
Christophe Dutang
Ph. D. student at ISFA, Lyon, France
website: http://dutangc.free.fr


From kynnjo at gmail.com  Wed Jun  3 00:44:25 2009
From: kynnjo at gmail.com (Kynn Jones)
Date: Tue, 2 Jun 2009 18:44:25 -0400
Subject: [Rd] How to generate R objects in C?
Message-ID: <c2350ba40906021544r51bfefb9k6b64e4734e66c90b@mail.gmail.com>

I'm in the process of coding a parser (in C) to generate R entities
(vectors, lists, etc.) from a text description (different from R).
The basic parser works, and now I need to tell it how to create R
entities.  I need to be able to create character vectors (for unicode
strings), integers, floats, unnamed lists, named lists, boolean
values, and NA.  With the exception of the two types of lists and the
character vectors, all the other objects I need to generate are
"scalars", so I suppose they will correspond to 1-element vectors in
R.  I also need to be able to add R entities to both kinds of lists.

I've been staring at various official documents (ch 5 of Writing R
Extensions, R Internals, Rinternals.h) for this kind of work for some
time, but I can't find the constructors for such objects (here I'm
using the term "constructor" loosely).  I'm even further from finding
the C equivalent of "my.list[[ length(my.list) + 1 ]] <- new.thing".

Can someone point me in the right direction?

Thanks!

Kynn


From macrakis at alum.mit.edu  Wed Jun  3 05:07:10 2009
From: macrakis at alum.mit.edu (Stavros Macrakis)
Date: Tue, 2 Jun 2009 23:07:10 -0400
Subject: [Rd] Vectorize fails for function with ... arglist
Message-ID: <8b356f880906022007k712c26a7g7497f24e03ac4e39@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090602/4f579cf0/attachment.pl>

From wdunlap at tibco.com  Wed Jun  3 05:17:49 2009
From: wdunlap at tibco.com (William Dunlap)
Date: Tue, 2 Jun 2009 20:17:49 -0700
Subject: [Rd] reference counting bug related to break and next in loops
Message-ID: <77EB52C6DD32BA4D87471DCD70C8D7000147B96C@NA-PA-VBE03.na.tibco.com>

One of our R users here just showed me the following problem while
investigating the return value of a while loop.  I added some
information
on a similar bug in for loops.  I think he was using 2.9.0
but I see the same problem on today's development version of 2.10.0
(svn 48703).

Should the semantics of while and for loops be changed slightly to avoid
the memory
buildup that fixing this to reflect the current docs would entail?  S+'s
loops return nothing useful - that change was made long ago to avoid
memory buildup resulting from semantics akin the R's present semantics.

Bill Dunlap
TIBCO Software Inc - Spotfire Division
wdunlap tibco.com 

--------------------Forwarded (and edited) message
below-------------------------------------------------------------------
----------

 I think I have found another reference counting bug.

If you type in the following in R you get what I think is the wrong
result.

> i = 1; y = 1:10; q = while(T) { y[i] = 42; if (i == 8) { break }; i =
i + 1; y}; q
 [1] 42 42 42 42 42 42 42 42  9 10

I had expected  [1] 42 42 42 42 42 42 42  8  9 10 which is what you get
if you add 0 to y in the last statement in the while loop:

> i = 1; y = 1:10; q = while(T) { y[i] = 42; if (i == 8) { break }; i =
i + 1; y + 0}; q
 [1] 42 42 42 42 42 42 42  8  9 10  

Also, 

> i = 1; y = 1:10; q = while(T) { y[i] = 42; if (i == 8) { break };
i<-i+1 ; if (i<=8&&i>3)next ; cat("Completing iteration", i, "\n"); y};
q
Completing iteration 2
Completing iteration 3
 [1] 42 42 42 42 42 42 42 42  9 10

but if the last statement in the while loop is y+0 instead of y I get
the
expected result:

> i = 1; y = 1:10; q = while(T) { y[i] = 42; if (i == 8) { break };
i<-i+1 ; if (i<=8&&i>3)next ; cat("Completing iteration", i, "\n");
y+0L}; q
Completing iteration 2
Completing iteration 3
 [1] 42 42  3  4  5  6  7  8  9 10

A background to the problem is that in R a while-loop returns the value
of the last iteration. However there is an exception if an iteration is
terminated by a break or a next. Then the value is the value of the
previously completed iteration that did not execute a break or next.
Thus in an extreme case the value of the while may be the value of the
very first iteration even though it executed a million iterations. 

Thus to implement that correctly one needs to keep a reference to the
value of the last non-terminated iteration. It seems as if the current R
implementation does that but does not increase the reference counter
which explains the odd behavior.

The for loop example is

> z<-{ tmp<-rep(pi,10);for(i in 1:10){ tmp[i]<-i^2;if(i==9)break ; if
(i<9&&i>3)next ; tmp } }
> z
 [1]  1.000000  4.000000  9.000000 16.000000 25.000000 36.000000
49.000000
 [8] 64.000000 81.000000  3.141593
> z<-{ tmp<-rep(pi,10);for(i in 1:10){ tmp[i]<-i^2;if(i==9)break ; if
(i<9&&i>3)next ; tmp+0 } }
> z
 [1] 1.000000 4.000000 9.000000 3.141593 3.141593 3.141593 3.141593
3.141593
 [9] 3.141593 3.141593

I can think of a couple of ways to solve this.

1.       Increment the reference counter. This solves the bug but may
have serious performance implications. In the while example above it
needs to copy y in every iteration.

2.       Change the semantics of while loops by getting rid of the
exception described above. When a loop is terminated with a break the
value of the loop would be NULL. Thus there is no need to keep a
reference to the value of the last non-terminated iteration.

Any opinions?


From macrakis at alum.mit.edu  Wed Jun  3 07:19:50 2009
From: macrakis at alum.mit.edu (Stavros Macrakis)
Date: Wed, 3 Jun 2009 01:19:50 -0400
Subject: [Rd] Print bug for matrix(list(NA_complex_, ...))
Message-ID: <8b356f880906022219n77891154k583fecf59e96ecaf@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090603/74a49956/attachment.pl>

From yanlinlin82 at gmail.com  Wed Jun  3 09:13:53 2009
From: yanlinlin82 at gmail.com (Linlin Yan)
Date: Wed, 3 Jun 2009 15:13:53 +0800
Subject: [Rd] [R] FW: R.dll Reg.,
In-Reply-To: <BLU139-W12A033D1B24564AA0EB0CDCB4A0@phx.gbl>
References: <BLU139-W12A033D1B24564AA0EB0CDCB4A0@phx.gbl>
Message-ID: <8d4c23b10906030013y311a1ac8hdeb0367ba73c3d74@mail.gmail.com>

What's wrong with the copyright? And how could that trouble your linking?

On Wed, Jun 3, 2009 at 2:53 PM, RamaR Guru <techzone2020 at hotmail.com> wrote:
>
> From: techzone2020 at hotmail.com
> To: r-help at stat.math.ethz.ch; r-help-request at stat.math.ethz.ch
> Subject: R.dll Reg.,
> Date: Wed, 3 Jun 2009 11:57:52 +0530
>
> Sir,
>
> ? I am working in R language currently.I want to link R.dll with VISUAL BASIC in order to create GUI FRONT END.But i couldnt link because of that file is copyrighted by "R Development Core Team 1995-2008".
>
> ? Please give R.dll file to complete my project.
>
> With Wishes,
> RamaR.K,
> PROJECT ASSISTANT,
> CENTRAL ELECTRONICS ENGINEERING RESEARCH INSTITUTE,
> CSIR MADRAS COMPLEX,
> TARAMANI,
> CHENNAI-600113,TAMIL NADU
> INDIA


From mathieu.ribatet at epfl.ch  Wed Jun  3 10:00:02 2009
From: mathieu.ribatet at epfl.ch (Mathieu Ribatet)
Date: Wed, 03 Jun 2009 10:00:02 +0200
Subject: [Rd] How to generate R objects in C?
In-Reply-To: <c2350ba40906021544r51bfefb9k6b64e4734e66c90b@mail.gmail.com>
References: <c2350ba40906021544r51bfefb9k6b64e4734e66c90b@mail.gmail.com>
Message-ID: <1244016002.3932.1.camel@ubuntu>

This is indeed details in Writing R Extensions. You should have a closer
look at sections 5.9.3 and 5.9.4. Look at the pieces of C code, they
will help you a lot.

cheers,
Mathieu


Le mercredi 03 juin 2009 ? 00:44 +0200, Kynn Jones a ?crit :
> I'm in the process of coding a parser (in C) to generate R entities
> (vectors, lists, etc.) from a text description (different from R).
> The basic parser works, and now I need to tell it how to create R
> entities.  I need to be able to create character vectors (for unicode
> strings), integers, floats, unnamed lists, named lists, boolean
> values, and NA.  With the exception of the two types of lists and the
> character vectors, all the other objects I need to generate are
> "scalars", so I suppose they will correspond to 1-element vectors in
> R.  I also need to be able to add R entities to both kinds of lists.
> 
> I've been staring at various official documents (ch 5 of Writing R
> Extensions, R Internals, Rinternals.h) for this kind of work for some
> time, but I can't find the constructors for such objects (here I'm
> using the term "constructor" loosely).  I'm even further from finding
> the C equivalent of "my.list[[ length(my.list) + 1 ]] <- new.thing".
> 
> Can someone point me in the right direction?
> 
> Thanks!
> 
> Kynn
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
-- 
Institute of Mathematics
Ecole Polytechnique F?d?rale de Lausanne
STAT-IMA-FSB-EPFL, Station 8
CH-1015 Lausanne   Switzerland
http://stat.epfl.ch/
Tel: + 41 (0)21 693 7907


From maechler at stat.math.ethz.ch  Wed Jun  3 10:11:27 2009
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Wed, 3 Jun 2009 10:11:27 +0200
Subject: [Rd] do *not* crosspost! {.... R.dll Reg.,}
In-Reply-To: <8d4c23b10906030013y311a1ac8hdeb0367ba73c3d74@mail.gmail.com>
References: <BLU139-W12A033D1B24564AA0EB0CDCB4A0@phx.gbl>
	<8d4c23b10906030013y311a1ac8hdeb0367ba73c3d74@mail.gmail.com>
Message-ID: <18982.12335.892905.229689@lynne.math.ethz.ch>

>>>>> "LY" == Linlin Yan <yanlinlin82 at gmail.com>
>>>>>     on Wed, 3 Jun 2009 15:13:53 +0800 writes:

    LY> What's wrong with the copyright? And how could that trouble your linking?

PLEASE, do not spill this thread to R-devel
it's been a cross-post R-help + R-devel (something we strongly dislike),
and I've *NOT* approved it for R-devel on purpose.

Martin Maechler, ETH Zurich
(R-devel list maintainer:  moderating for non-subscribers)


From Waclaw.Marcin.Kusnierczyk at idi.ntnu.no  Wed Jun  3 10:43:25 2009
From: Waclaw.Marcin.Kusnierczyk at idi.ntnu.no (Wacek Kusnierczyk)
Date: Wed, 03 Jun 2009 10:43:25 +0200
Subject: [Rd] Print bug for matrix(list(NA_complex_, ...))
In-Reply-To: <8b356f880906022219n77891154k583fecf59e96ecaf@mail.gmail.com>
References: <8b356f880906022219n77891154k583fecf59e96ecaf@mail.gmail.com>
Message-ID: <4A2637AD.4050801@idi.ntnu.no>

Stavros Macrakis wrote:
> In R 2.8.0 on Windows (tested both under ESS and under R Console in case
> there was an I/O issue)
>
> There is a bug in printing val <- matrix(list(NA_complex_,NA_complex_),1).
>
>   
>> dput(val)
>>     
> structure(list(NA_complex_, NA_complex_), .Dim = 1:2)
>
>   
>> print(val)
>>     
>
> [,1]
>
> [1,]
>
>
> [,2]
>
> [1,]
>
>
> Note that a large number of spaces are printed instead of NA.  

on ubuntu 8.04 with r 2.10.0 r48703 there is almost no problem (still
some unnecessary spaces):

     [,1]      [,2]    
[1,]        NA        NA



> Compare the
> unproblematic real case:
>
> print(structure(list(NA_real_, NA_real_), .Dim = 1:2))
>      [,1] [,2]
> [1,] NA   NA
>
> Also, when printed in the read-eval-print loop, printing takes a very very
> long time:
>
>   
>> proc.time(); matrix(list(NA_complex_,NA_complex_),1); proc.time()
>>     
>    user  system elapsed
>   74.35    0.09  329.45
>
> [,1]
>
> [1,]
>
>
> [,2]
>
> [1,]
>
>    user  system elapsed
>   92.63    0.15  347.86
>
> 18 seconds runtime!
>   

   user  system elapsed
  0.648   0.056 155.843
     [,1] [,2]
[1,]  NA   NA
   user  system elapsed
  0.648   0.056 155.843

vQ


From Waclaw.Marcin.Kusnierczyk at idi.ntnu.no  Wed Jun  3 10:47:57 2009
From: Waclaw.Marcin.Kusnierczyk at idi.ntnu.no (Wacek Kusnierczyk)
Date: Wed, 03 Jun 2009 10:47:57 +0200
Subject: [Rd] reference counting bug related to break and next in loops
In-Reply-To: <77EB52C6DD32BA4D87471DCD70C8D7000147B96C@NA-PA-VBE03.na.tibco.com>
References: <77EB52C6DD32BA4D87471DCD70C8D7000147B96C@NA-PA-VBE03.na.tibco.com>
Message-ID: <4A2638BD.6090503@idi.ntnu.no>

William Dunlap wrote:
> One of our R users here just showed me the following problem while
> investigating the return value of a while loop.  I added some
> information
> on a similar bug in for loops.  I think he was using 2.9.0
> but I see the same problem on today's development version of 2.10.0
> (svn 48703).
>
> Should the semantics of while and for loops be changed slightly to avoid
> the memory
> buildup that fixing this to reflect the current docs would entail?  S+'s
> loops return nothing useful - that change was made long ago to avoid
> memory buildup resulting from semantics akin the R's present semantics.
>
> Bill Dunlap
> TIBCO Software Inc - Spotfire Division
> wdunlap tibco.com 
>
> --------------------Forwarded (and edited) message
> below-------------------------------------------------------------------
> ----------
>
>  I think I have found another reference counting bug.
>
> If you type in the following in R you get what I think is the wrong
> result.
>
>   
>> i = 1; y = 1:10; q = while(T) { y[i] = 42; if (i == 8) { break }; i =
>>     
> i + 1; y}; q
>  [1] 42 42 42 42 42 42 42 42  9 10
>
> I had expected  [1] 42 42 42 42 42 42 42  8  9 10 which is what you get
> if you add 0 to y in the last statement in the while loop:
>   

a simplified example may help to get a clear picture:

    i = 1; y = 1:3;
    (while(TRUE) {
       y[i] = 0
       if (i == 2) break
       i = i + 1
       y })
    # 0 0 3

    i = 1; y = 1:3;
    (while(TRUE) {
       y[i] = 0
       if (i == 2) break
       i = i + 1
       y + 0 })
    # 0 2 3

the test on i is done after the assignment to y[i].  when the loop
breaks, y is 0 0 3, and one might expect this to be the final result. 
it looks like the result is the value of y from the previous iteration,
and it does not seem particularly intuitive to me.  (using common sense,
i mean;  an informed expert on the copy-when-scared semantics may have a
different opinion, but why should a casual user ever suspect such magic.) 

anyway, i'd rather expect NULL to be returned.  for the oracle,
?'while', says:

"'for', 'while' and 'repeat' return the value of the last expression
evaluated (or 'NULL' if none was), invisibly. [...]  'if' returns the
value of the expression evaluated, or 'NULL' if none was. [...]  'break'
and 'next' have value 'NULL', although it would be strange to look for a
return value."

when i is 2, i == 2 is TRUE.  hence, if (i == 2) break evaluates to
break.  break evaluates to NULL, breaks the loop, and the return value
should be NULL.  while it is, following the docs, strange to have q =
while(...) ... in the code, the result above is not compliant with the
docs at all -- seems like a plain bug.  there is no reason for while to
return the value of y, be it 0 0 3 or 0 2 3.

one might naively suspect that it is the syntactically last expression
in the body of while that provides the return value, but the docs
explicitly say "the last expression evaluated".  and indeed,

    (while (TRUE) { break; 'foo' })
    # NULL

however,

    i = FALSE
    (while (TRUE) { if (i) break; i = !i; i })
    # TRUE

which again reveals the bug. 

one could suspect that "the last expression evaluated" is actually the
whole body of the while loop;  so in the above, the value of { if (i)
break; i = !i; i } should be returned, even if the loop breaks in the
middle.  hence, the result "should" be TRUE (or maybe FALSE?).  however,

    (while (TRUE) { break; while(TRUE) { 'foo' } })
    # NULL

has no problem with returning NULL -- obviously, so to speak.

it seems to me that the bug is not in reference counting, but in that
the while loop incorrectly returns the value of the *previous* iteration
while executing a break, instead of the break's NULL.

likewise,

    (for (i in 1:2) {
       if (i == 2) break
       i })
    # 1

instead of the specification-promised NULL.


>> 	i = 1; y = 1:10; q = while(T) { y[i] = 42; if (i == 8) { break }; i =
>>     
> i + 1; y + 0}; q
>  [1] 42 42 42 42 42 42 42  8  9 10  
>   



> Also, 
>
>   
>> i = 1; y = 1:10; q = while(T) { y[i] = 42; if (i == 8) { break };
>>     
> i<-i+1 ; if (i<=8&&i>3)next ; cat("Completing iteration", i, "\n"); y};
> q
> Completing iteration 2
> Completing iteration 3
>  [1] 42 42 42 42 42 42 42 42  9 10
>
> but if the last statement in the while loop is y+0 instead of y I get
> the
> expected result:
>
>   
>> i = 1; y = 1:10; q = while(T) { y[i] = 42; if (i == 8) { break };
>>     
> i<-i+1 ; if (i<=8&&i>3)next ; cat("Completing iteration", i, "\n");
> y+0L}; q
> Completing iteration 2
> Completing iteration 3
>  [1] 42 42  3  4  5  6  7  8  9 10
>   

> A background to the problem is that in R a while-loop returns the value
> of the last iteration. 

not according to the docs;  the "last expression evaluated". 
specifically, not the value of the last non-break-broken iteration.

vQ


From Waclaw.Marcin.Kusnierczyk at idi.ntnu.no  Wed Jun  3 11:06:02 2009
From: Waclaw.Marcin.Kusnierczyk at idi.ntnu.no (Wacek Kusnierczyk)
Date: Wed, 03 Jun 2009 11:06:02 +0200
Subject: [Rd] reference counting bug related to break and next in loops
In-Reply-To: <4A2638BD.6090503@idi.ntnu.no>
References: <77EB52C6DD32BA4D87471DCD70C8D7000147B96C@NA-PA-VBE03.na.tibco.com>
	<4A2638BD.6090503@idi.ntnu.no>
Message-ID: <4A263CFA.70403@idi.ntnu.no>

Wacek Kusnierczyk wrote:
>
> a simplified example may help to get a clear picture:
>
>     i = 1; y = 1:3;
>     (while(TRUE) {
>        y[i] = 0
>        if (i == 2) break
>        i = i + 1
>        y })
>     # 0 0 3
>
>     i = 1; y = 1:3;
>     (while(TRUE) {
>        y[i] = 0
>        if (i == 2) break
>        i = i + 1
>        y + 0 })
>     # 0 2 3
>
> the test on i is done after the assignment to y[i].  when the loop
> breaks, y is 0 0 3, and one might expect this to be the final result. 
> it looks like the result is the value of y from the previous iteration,
> and it does not seem particularly intuitive to me.  (using common sense,
> i mean;  an informed expert on the copy-when-scared semantics may have a
> different opinion, but why should a casual user ever suspect such magic.) 
>
> anyway, i'd rather expect NULL to be returned.  for the oracle,
> ?'while', says:
>
> "'for', 'while' and 'repeat' return the value of the last expression
> evaluated (or 'NULL' if none was), invisibly. [...]  'if' returns the
> value of the expression evaluated, or 'NULL' if none was. [...]  'break'
> and 'next' have value 'NULL', although it would be strange to look for a
> return value."
>
> when i is 2, i == 2 is TRUE.  hence, if (i == 2) break evaluates to
> break.  break evaluates to NULL, breaks the loop, and the return value
> should be NULL.  while it is, following the docs, strange to have q =
> while(...) ... in the code, the result above is not compliant with the
> docs at all -- seems like a plain bug.  there is no reason for while to
> return the value of y, be it 0 0 3 or 0 2 3.
>   

somewhat surprising to learn,

    i = 1
    y = 1:3
    (while (TRUE) {
       y[i] = 0
       if (i == 2) { 2*y; break }
       i = i + 1
       y })
    # 0 0 3

where clearly the last expression evaluated (before the break, that is)
is 2*y -- or?


vQ


From tsr at stat.washington.edu  Wed Jun  3 10:45:13 2009
From: tsr at stat.washington.edu (tsr at stat.washington.edu)
Date: Wed,  3 Jun 2009 10:45:13 +0200 (CEST)
Subject: [Rd] Problems with plot and Quartz device (PR#13744)
Message-ID: <20090603084513.662BD283200F@mail.pubhealth.ku.dk>

Full_Name: Thomas Richardson
Version: R 2.9.0 GUI 1.28 Tiger build 32-bit (5395)
OS: 10.4.11
Submission from: (NULL) (216.254.15.72)



I have encountered a problem with points in scatterplots disappearing in a
quartz window when it is re-sized (to make it larger).

I am constructing an 8x12 matrix of scatterplots each containing approx 600
points.
In order to get them in the window I remove the axes etc.,

quartz()
par(mfrow=c(8,12), mar=c(0,0,0,0), oma=c(0,0,0,0))
for(i in 1:8){ # Row counter
for(j in 1:12){ # Col counter		
plot(rna$red[(rna$row==levels(rna$row[i])&(rna$col==j)],
     rna$tof[(rna$row==levels(rna$row[i])&(rna$col==j)],
     xlab="tof",ylab="green",xaxt="n",yaxt="n",
     ann=FALSE,xlim=c(0,100),ylim=c(0,300),pch=".")
}
}

Here is the problem:  how many data points actually appear in the quartz window
on my screen is highly sensitive to the width and height specified. If I specify
a different width and height for the quartz window e.g.
quartz(width=8,height=8), OR if I resize the window with the cursor then points
disappear in certain (x-axis) ranges across all the plots in some columns. These
bands in which points disappear are the same for all plots in a given column,
and can be very wide - making a lot of points disappear. 

(The visual effect is to make it look as if there are clearly defined vertical
white lines going across the scatterplots - though the black lines enclosing
each plot are not broken).

The problem seems to disappear with other plotting symbols e.g. pch="+" (but
then I end up with crowded plots). So I guess it might be related to the
"special treatment" of "." described on help(points) ??
---
Value pch="." (equivalently pch = 46) is handled specially. It is a rectangle of
side 0.01 inch (scaled by cex).
---

I find this behaviour unnerving: the (resized) plots made it look as if there
was a lot of structure in the data, but on closer inspection it turned out to be
entirely a consequence of the quartz device and plot function!

I can't imagine that this behaviour is intended - even if it were intended to
suppress points (like some axis labels) - it seems strange that enlarging the
window makes points disappear. (I also tried setting dpi=72 in quartz(), but
this did not fix the problem).

Thanks in advance.

Thomas

------------------------------------------------------
 sessionInfo()
R version 2.9.0 (2009-04-17) 
i386-apple-darwin8.11.1 

locale:
en_US.UTF-8/en_US.UTF-8/C/C/en_US.UTF-8/en_US.UTF-8

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base


From maechler at stat.math.ethz.ch  Wed Jun  3 11:36:52 2009
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Wed, 3 Jun 2009 11:36:52 +0200
Subject: [Rd] Print bug for matrix(list(NA_complex_, ...))
In-Reply-To: <4A2637AD.4050801@idi.ntnu.no>
References: <8b356f880906022219n77891154k583fecf59e96ecaf@mail.gmail.com>
	<4A2637AD.4050801@idi.ntnu.no>
Message-ID: <18982.17460.628994.128590@lynne.math.ethz.ch>

>>>>> "vQ" == Wacek Kusnierczyk <Waclaw.Marcin.Kusnierczyk at idi.ntnu.no>
>>>>>     on Wed, 03 Jun 2009 10:43:25 +0200 writes:

    vQ> Stavros Macrakis wrote:
    >> In R 2.8.0 on Windows (tested both under ESS and under R Console in case
    >> there was an I/O issue)
    >> 
    >> There is a bug in printing val <- matrix(list(NA_complex_,NA_complex_),1).
    >> 
    >> 
    >>> dput(val)
    >>> 
    >> structure(list(NA_complex_, NA_complex_), .Dim = 1:2)
    >> 
    >> 
    >>> print(val)
    >>> 
    >> 
    >> [,1]
    >> 
    >> [1,]
    >> 
    >> 
    >> [,2]
    >> 
    >> [1,]
    >> 
    >> 
    >> Note that a large number of spaces are printed instead of NA.  

    vQ> on ubuntu 8.04 with r 2.10.0 r48703 there is almost no problem (still
    vQ> some unnecessary spaces):

    vQ> [,1]      [,2]    
    vQ> [1,]        NA        NA

thank you, Waclav.

I don't see any unnecessary space (or other CPU problems),
using another Linux variant (RHEL 5)
in the three R version
       	  2.9.0 ,  
	  2.9.0-patched (r48700)
	  2.10.0-devel  (r48700)

Can other Windows (or ...) users confirm problems in R 2.9.0 (or newer) ?

Regards,
Martin Maechler

    >> Compare the
    >> unproblematic real case:
    >> 
    >> print(structure(list(NA_real_, NA_real_), .Dim = 1:2))
    >> [,1] [,2]
    >> [1,] NA   NA
    >> 
    >> Also, when printed in the read-eval-print loop, printing takes a very very
    >> long time:
    >> 
    >> 
    >>> proc.time(); matrix(list(NA_complex_,NA_complex_),1); proc.time()
    >>> 
    >> user  system elapsed
    >> 74.35    0.09  329.45
    >> 
    >> [,1]
    >> 
    >> [1,]
    >> 
    >> 
    >> [,2]
    >> 
    >> [1,]
    >> 
    >> user  system elapsed
    >> 92.63    0.15  347.86
    >> 
    >> 18 seconds runtime!
    >> 

    vQ> user  system elapsed
    vQ> 0.648   0.056 155.843
    vQ> [,1] [,2]
    vQ> [1,]  NA   NA
    vQ> user  system elapsed
    vQ> 0.648   0.056 155.843

    vQ> vQ

    vQ> ______________________________________________
    vQ> R-devel at r-project.org mailing list
    vQ> https://stat.ethz.ch/mailman/listinfo/r-devel


From maechler at stat.math.ethz.ch  Wed Jun  3 11:45:45 2009
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Wed, 3 Jun 2009 11:45:45 +0200
Subject: [Rd] R-devel:codocClasses() now finds more --> R CMD check warnings
Message-ID: <18982.17993.645171.944045@lynne.math.ethz.ch>

Yesterday, I have commited
	   r48701 | maechler | 2009-06-02 17:11:50
a changed version of  tools::codocClasses()
which checks S4 class slot documentations in many more cases
than previously.
This finds slot documentation inconsistencies in many more cases
than previously, and you (as package author) will probably see
the effect in new warnings in

    R CMD check <mypackage>

if your package defines (and exports, hence documents) S4
classes.  The NEWS entry is

    o	codocClasses() which checks consistency of S4 class slots'
	documentation, now does this in considerably more cases.  The
	documentation of inherited slots (from superclasses) is now
	optional.  This affects 'R CMD check <pkg>' when the package
	defines S4 classes.


I have checked the new behavior in quite a few cases, and the
new code did indeed correctly find slight documentation
inconsistencies in quite a few cases (including our own
recommended package 'Matrix'), so *is* helpful .....
even though you at first may experience the new warnings as
annoying ;-)

Feedback is welcome,
and patches to improve  promptClass() to automatically mark
slots from superclasses as only *optional* to document 
are even more welcome !

Martin Maechler, ETH Zurich


From P.Dalgaard at biostat.ku.dk  Wed Jun  3 12:24:27 2009
From: P.Dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Wed, 03 Jun 2009 12:24:27 +0200
Subject: [Rd] Vectorize fails for function with ... arglist
In-Reply-To: <8b356f880906022007k712c26a7g7497f24e03ac4e39@mail.gmail.com>
References: <8b356f880906022007k712c26a7g7497f24e03ac4e39@mail.gmail.com>
Message-ID: <4A264F5B.4030704@biostat.ku.dk>

Stavros Macrakis wrote:
> Vectorize is defined to return a function that acts as if 'mapply' was
> called.
> 
> So we have:
> 
>> mapply(dput,1:2)            # mapply form
> 1L                                      # calls dput on each element of 1:2
> 2L
> [1] 1 2
>> Vectorize(dput)(1:2)        # Vectorize form
> 1L                                        # same behavior
> 2L
> [1] 1 2
> 
> Same thing with a named argument:
> 
>> mapply(function(a)dput(a),1:2)
> 1L
> 2L
> [1] 1 2
>> Vectorize(function(a)dput(a))(1:2)
> 1L
> 2L
> [1] 1 2
> 
> But though mapply has no problem with function(...):
> 
>> mapply(function(...)dput(list(...)),1:2)
> list(1L)
> list(2L)
> [[1]]
> [1] 1
> 
> [[2]]
> [1] 2
> 
>> mapply(function(...)dput(list(...)),1:2,11:12)
> list(1L, 11L)
> list(2L, 12L)
>      [,1] [,2]
> [1,] 1    2
> [2,] 11   12
> 
> Vectorize fails silently in this case:
> 
>> Vectorize(function(...)dput(list(...))(1:2)
> list(1:2)                    # calls dput with entire vector
>                                 # invisible result inherited from dput
> 
>> Vectorize(function(...)dput(list(...)))(1:2,11:12)
> list(1:2, 11:12)
> 
> and sure enough:
> 
>> Vectorize(function(...)list(...))
> function(...)list(...)                            # returns arg unmodified!
> 
> I looked at the code, and ... args are *explicitly* rejected. I see no
> logical reason for this inconsistency, and the documentation doesn't require
> it.

I think it's a feature. There's no way of telling which "..." arguments
to vectorize over, and there are arguments that cannot be vectorized, so
vectorizing over all of them by default looks like a bad idea.  The
generic case is that the extra arguments could be things like
na.action=na.omit, which you just want to pass through to the scalar
function.


If you need the full feature set of mapply, use mapply. The
documentation looks like it could be improved, though.

	-p

> 
>               -s
> 
> PS This is not an artificial example concocted to demonstrate
> inconsistencies.  I had written the following function which wraps another
> function in a tryCatch:
> 
>        catcher <- function(f) function(...)
> tryCatch(do.call(f,list(...)),error=function(e) NA)
> 
> (The '...' argument list allows this to work with a function of any number
> of arguments.)
> 
> but instead of catching individual errors in
> Vectorize(catcher(fun))(1:10,1:10), it caught them all as one big error,
> which was not at all the goal.
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907


From simon.urbanek at r-project.org  Wed Jun  3 13:42:01 2009
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Wed, 3 Jun 2009 07:42:01 -0400
Subject: [Rd] Problems with plot and Quartz device (PR#13744)
In-Reply-To: <20090603084513.662BD283200F@mail.pubhealth.ku.dk>
References: <20090603084513.662BD283200F@mail.pubhealth.ku.dk>
Message-ID: <F2B79447-C9CE-42AD-B763-2AC4CD22E41D@r-project.org>

Thomas,

rna is not defined in R, can you, please, supply a reproducible  
example? From your description I think I know roughly what's going on  
(Quartz attempts to snap rectangles on pixel boundaries to prevent  
malignant anti-aliasing effects in image plots and this may somehow  
interact with pch='.' since Quartz has no way of knowing that those  
rectangles are supposed to be glyphs), but I cannot reproduce it.

Thanks,
Simon


On Jun 3, 2009, at 4:45 , tsr at stat.washington.edu wrote:

> Full_Name: Thomas Richardson
> Version: R 2.9.0 GUI 1.28 Tiger build 32-bit (5395)
> OS: 10.4.11
> Submission from: (NULL) (216.254.15.72)
>
>
>
> I have encountered a problem with points in scatterplots  
> disappearing in a
> quartz window when it is re-sized (to make it larger).
>
> I am constructing an 8x12 matrix of scatterplots each containing  
> approx 600
> points.
> In order to get them in the window I remove the axes etc.,
>
> quartz()
> par(mfrow=c(8,12), mar=c(0,0,0,0), oma=c(0,0,0,0))
> for(i in 1:8){ # Row counter
> for(j in 1:12){ # Col counter		
> plot(rna$red[(rna$row==levels(rna$row[i])&(rna$col==j)],
>     rna$tof[(rna$row==levels(rna$row[i])&(rna$col==j)],
>     xlab="tof",ylab="green",xaxt="n",yaxt="n",
>     ann=FALSE,xlim=c(0,100),ylim=c(0,300),pch=".")
> }
> }
>
> Here is the problem:  how many data points actually appear in the  
> quartz window
> on my screen is highly sensitive to the width and height specified.  
> If I specify
> a different width and height for the quartz window e.g.
> quartz(width=8,height=8), OR if I resize the window with the cursor  
> then points
> disappear in certain (x-axis) ranges across all the plots in some  
> columns. These
> bands in which points disappear are the same for all plots in a  
> given column,
> and can be very wide - making a lot of points disappear.
>
> (The visual effect is to make it look as if there are clearly  
> defined vertical
> white lines going across the scatterplots - though the black lines  
> enclosing
> each plot are not broken).
>
> The problem seems to disappear with other plotting symbols e.g.  
> pch="+" (but
> then I end up with crowded plots). So I guess it might be related to  
> the
> "special treatment" of "." described on help(points) ??
> ---
> Value pch="." (equivalently pch = 46) is handled specially. It is a  
> rectangle of
> side 0.01 inch (scaled by cex).
> ---
>
> I find this behaviour unnerving: the (resized) plots made it look as  
> if there
> was a lot of structure in the data, but on closer inspection it  
> turned out to be
> entirely a consequence of the quartz device and plot function!
>
> I can't imagine that this behaviour is intended - even if it were  
> intended to
> suppress points (like some axis labels) - it seems strange that  
> enlarging the
> window makes points disappear. (I also tried setting dpi=72 in  
> quartz(), but
> this did not fix the problem).
>
> Thanks in advance.
>
> Thomas
>
> ------------------------------------------------------
> sessionInfo()
> R version 2.9.0 (2009-04-17)
> i386-apple-darwin8.11.1
>
> locale:
> en_US.UTF-8/en_US.UTF-8/C/C/en_US.UTF-8/en_US.UTF-8
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From simon.urbanek at r-project.org  Wed Jun  3 13:45:40 2009
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Wed, 3 Jun 2009 07:45:40 -0400
Subject: [Rd] Problems with plot and Quartz device
In-Reply-To: <20090603084513.662BD283200F@mail.pubhealth.ku.dk>
References: <20090603084513.662BD283200F@mail.pubhealth.ku.dk>
Message-ID: <29342260-D4C4-481A-86D9-E64CAF127F4F@r-project.org>


On Jun 3, 2009, at 4:45 , tsr at stat.washington.edu wrote:

> Full_Name: Thomas Richardson
> Version: R 2.9.0 GUI 1.28 Tiger build 32-bit (5395)
> OS: 10.4.11
> Submission from: (NULL) (216.254.15.72)
>
>
>
> I have encountered a problem with points in scatterplots  
> disappearing in a
> quartz window when it is re-sized (to make it larger).
>
> I am constructing an 8x12 matrix of scatterplots each containing  
> approx 600
> points.
> In order to get them in the window I remove the axes etc.,
>
> quartz()
> par(mfrow=c(8,12), mar=c(0,0,0,0), oma=c(0,0,0,0))
> for(i in 1:8){ # Row counter
> for(j in 1:12){ # Col counter		
> plot(rna$red[(rna$row==levels(rna$row[i])&(rna$col==j)],
>     rna$tof[(rna$row==levels(rna$row[i])&(rna$col==j)],
>     xlab="tof",ylab="green",xaxt="n",yaxt="n",
>     ann=FALSE,xlim=c(0,100),ylim=c(0,300),pch=".")
> }
> }
>
> Here is the problem:  how many data points actually appear in the  
> quartz window
> on my screen is highly sensitive to the width and height specified.  
> If I specify
> a different width and height for the quartz window e.g.
> quartz(width=8,height=8), OR if I resize the window with the cursor  
> then points
> disappear in certain (x-axis) ranges across all the plots in some  
> columns. These
> bands in which points disappear are the same for all plots in a  
> given column,
> and can be very wide - making a lot of points disappear.
>
> (The visual effect is to make it look as if there are clearly  
> defined vertical
> white lines going across the scatterplots - though the black lines  
> enclosing
> each plot are not broken).
>
> The problem seems to disappear with other plotting symbols e.g.  
> pch="+" (but
> then I end up with crowded plots).


BTW: you may want to use something like pch=19, cex=0.1 (and maybe add  
some alpha to get a quick density estimation).

Cheers,
S


> So I guess it might be related to the
> "special treatment" of "." described on help(points) ??
> ---
> Value pch="." (equivalently pch = 46) is handled specially. It is a  
> rectangle of
> side 0.01 inch (scaled by cex).
> ---
>
> I find this behaviour unnerving: the (resized) plots made it look as  
> if there
> was a lot of structure in the data, but on closer inspection it  
> turned out to be
> entirely a consequence of the quartz device and plot function!
>
> I can't imagine that this behaviour is intended - even if it were  
> intended to
> suppress points (like some axis labels) - it seems strange that  
> enlarging the
> window makes points disappear. (I also tried setting dpi=72 in  
> quartz(), but
> this did not fix the problem).
>
> Thanks in advance.
>
> Thomas
>
> ------------------------------------------------------
> sessionInfo()
> R version 2.9.0 (2009-04-17)
> i386-apple-darwin8.11.1
>
> locale:
> en_US.UTF-8/en_US.UTF-8/C/C/en_US.UTF-8/en_US.UTF-8
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From wdunlap at tibco.com  Wed Jun  3 17:58:15 2009
From: wdunlap at tibco.com (William Dunlap)
Date: Wed, 3 Jun 2009 08:58:15 -0700
Subject: [Rd] Print bug for matrix(list(NA_complex_, ...))
In-Reply-To: <18982.17460.628994.128590@lynne.math.ethz.ch>
References: <8b356f880906022219n77891154k583fecf59e96ecaf@mail.gmail.com><4A2637AD.4050801@idi.ntnu.no>
	<18982.17460.628994.128590@lynne.math.ethz.ch>
Message-ID: <77EB52C6DD32BA4D87471DCD70C8D7000147B9EB@NA-PA-VBE03.na.tibco.com>

> -----Original Message-----
> From: r-devel-bounces at r-project.org 
> [mailto:r-devel-bounces at r-project.org] On Behalf Of Martin Maechler
> Sent: Wednesday, June 03, 2009 2:37 AM
> To: Wacek Kusnierczyk
> Cc: r-devel at r-project.org
> Subject: Re: [Rd] Print bug for matrix(list(NA_complex_, ...))
> 
> >>>>> "vQ" == Wacek Kusnierczyk 
> <Waclaw.Marcin.Kusnierczyk at idi.ntnu.no>
> >>>>>     on Wed, 03 Jun 2009 10:43:25 +0200 writes:
> 
>     vQ> Stavros Macrakis wrote:
>     >> In R 2.8.0 on Windows (tested both under ESS and under 
> R Console in case
>     >> there was an I/O issue)
>     >> 
>     >> There is a bug in printing val <- 
> matrix(list(NA_complex_,NA_complex_),1).
>     >> 
>     >> 
>     >>> dput(val)
>     >>> 
>     >> structure(list(NA_complex_, NA_complex_), .Dim = 1:2)
>     >> 
>     >> 
>     >>> print(val)
>     >>> 
>     >> 
>     >> [,1]
>     >> 
>     >> [1,]
>     >> 
>     >> 
>     >> [,2]
>     >> 
>     >> [1,]
>     >> 
>     >> 
>     >> Note that a large number of spaces are printed instead of NA.  
> 
>     vQ> on ubuntu 8.04 with r 2.10.0 r48703 there is almost 
> no problem (still
>     vQ> some unnecessary spaces):
> 
>     vQ> [,1]      [,2]    
>     vQ> [1,]        NA        NA
> 
> thank you, Waclav.
> 
> I don't see any unnecessary space (or other CPU problems),
> using another Linux variant (RHEL 5)
> in the three R version
>        	  2.9.0 ,  
> 	  2.9.0-patched (r48700)
> 	  2.10.0-devel  (r48700)
> 
> Can other Windows (or ...) users confirm problems in R 2.9.0 
> (or newer) ?

I just tried it on 2.9.0 on the Windows GUI (RGui.exe)
and saw similar problems.  When printing to the
command window, with either print(val) or show(val) it took
a very long time and put $'s at the ends of the lines
(indicating that there was text beyond the edge of the window).
I used sink() to put the output into a file and then print() and
show() acted quickly.  The resulting file had 119 character
lines, consisting mainly of trailing blanks:

> readLines("c:/temp/val.txt") # output of print(val);show(val);str(val)
 [1] "     [,1]
"
 [2] "[1,]
"
 [3] "     [,2]
"
 [4] "[1,]
"
 [5] "     [,1]
"
 [6] "[1,]
"
 [7] "     [,2]
"
 [8] "[1,]
"
 [9] "List of 2"

[10] " $ : cplx NA"

[11] " $ : cplx NA"

[12] " - attr(*, \"dim\")= int [1:2] 1 2"

> nchar(readLines("c:/temp/val.txt"))
 [1] 119 119 119 119 119 119 119 119   9  12  12  32

On Linux, using yesterday's 2.9.0, valgrind shows lots
of 'depends on uninitialized value' problems that could
explain the Linux-Windows difference in behavior:

> val<-matrix(list(NA_complex_,NA_complex_),1)
> val
==24859== Conditional jump or move depends on uninitialised value(s)
==24859==    at 0x6F7E2F: vfprintf (in /lib/tls/libc-2.3.4.so)
==24859==    by 0x7177A5: vsnprintf (in /lib/tls/libc-2.3.4.so)
==24859==    by 0x6FF4E1: snprintf (in /lib/tls/libc-2.3.4.so)
==24859==    by 0x809DDC1: Rf_EncodeReal (printutils.c:179)
==24859==    by 0x8099AA9: Rf_PrintValueRec (print.c:359)
==24859==    by 0x809A124: Rf_PrintValueEnv (print.c:956)
==24859==    by 0x80584CA: Rf_ReplIteration (main.c:261)
==24859==    by 0x8058572: R_ReplConsole (main.c:306)
==24859==    by 0x8058BB8: run_Rmainloop (main.c:967)
==24859==    by 0x8056A70: main (Rmain.c:33)
==24859==
==24859== Conditional jump or move depends on uninitialised value(s)
==24859==    at 0x6F7E44: vfprintf (in /lib/tls/libc-2.3.4.so)
==24859==    by 0x7177A5: vsnprintf (in /lib/tls/libc-2.3.4.so)
==24859==    by 0x6FF4E1: snprintf (in /lib/tls/libc-2.3.4.so)
==24859==    by 0x809DDC1: Rf_EncodeReal (printutils.c:179)
==24859==    by 0x8099AA9: Rf_PrintValueRec (print.c:359)
==24859==    by 0x809A124: Rf_PrintValueEnv (print.c:956)
==24859==    by 0x80584CA: Rf_ReplIteration (main.c:261)
==24859==    by 0x8058572: R_ReplConsole (main.c:306)
==24859==    by 0x8058BB8: run_Rmainloop (main.c:967)
==24859==    by 0x8056A70: main (Rmain.c:33)
==24859==
==24859== Conditional jump or move depends on uninitialised value(s)
==24859==    at 0x6F7E4C: vfprintf (in /lib/tls/libc-2.3.4.so)
==24859==    by 0x7177A5: vsnprintf (in /lib/tls/libc-2.3.4.so)
==24859==    by 0x6FF4E1: snprintf (in /lib/tls/libc-2.3.4.so)
==24859==    by 0x809DDC1: Rf_EncodeReal (printutils.c:179)
==24859==    by 0x8099AA9: Rf_PrintValueRec (print.c:359)
==24859==    by 0x809A124: Rf_PrintValueEnv (print.c:956)
==24859==    by 0x80584CA: Rf_ReplIteration (main.c:261)
==24859==    by 0x8058572: R_ReplConsole (main.c:306)
==24859==    by 0x8058BB8: run_Rmainloop (main.c:967)
==24859==    by 0x8056A70: main (Rmain.c:33)
==24859==
==24859== Conditional jump or move depends on uninitialised value(s)
==24859==    at 0x6FA87A: vfprintf (in /lib/tls/libc-2.3.4.so)
==24859==    by 0x7177A5: vsnprintf (in /lib/tls/libc-2.3.4.so)
==24859==    by 0x6FF4E1: snprintf (in /lib/tls/libc-2.3.4.so)
==24859==    by 0x809DDC1: Rf_EncodeReal (printutils.c:179)
==24859==    by 0x8099AA9: Rf_PrintValueRec (print.c:359)
==24859==    by 0x809A124: Rf_PrintValueEnv (print.c:956)
==24859==    by 0x80584CA: Rf_ReplIteration (main.c:261)
==24859==    by 0x8058572: R_ReplConsole (main.c:306)
==24859==    by 0x8058BB8: run_Rmainloop (main.c:967)
==24859==    by 0x8056A70: main (Rmain.c:33)
==24859==
==24859== Conditional jump or move depends on uninitialised value(s)
==24859==    at 0x6F86E8: vfprintf (in /lib/tls/libc-2.3.4.so)
==24859==    by 0x7177A5: vsnprintf (in /lib/tls/libc-2.3.4.so)
==24859==    by 0x6FF4E1: snprintf (in /lib/tls/libc-2.3.4.so)
==24859==    by 0x809DDC1: Rf_EncodeReal (printutils.c:179)
==24859==    by 0x8099AA9: Rf_PrintValueRec (print.c:359)
==24859==    by 0x809A124: Rf_PrintValueEnv (print.c:956)
==24859==    by 0x80584CA: Rf_ReplIteration (main.c:261)
==24859==    by 0x8058572: R_ReplConsole (main.c:306)
==24859==    by 0x8058BB8: run_Rmainloop (main.c:967)
==24859==    by 0x8056A70: main (Rmain.c:33)
==24859==
==24859== Conditional jump or move depends on uninitialised value(s)
==24859==    at 0x6F86FA: vfprintf (in /lib/tls/libc-2.3.4.so)
==24859==    by 0x7177A5: vsnprintf (in /lib/tls/libc-2.3.4.so)
==24859==    by 0x6FF4E1: snprintf (in /lib/tls/libc-2.3.4.so)
==24859==    by 0x809DDC1: Rf_EncodeReal (printutils.c:179)
==24859==    by 0x8099AA9: Rf_PrintValueRec (print.c:359)
==24859==    by 0x809A124: Rf_PrintValueEnv (print.c:956)
==24859==    by 0x80584CA: Rf_ReplIteration (main.c:261)
==24859==    by 0x8058572: R_ReplConsole (main.c:306)
==24859==    by 0x8058BB8: run_Rmainloop (main.c:967)
==24859==    by 0x8056A70: main (Rmain.c:33)
==24859==
==24859== Conditional jump or move depends on uninitialised value(s)
==24859==    at 0x711183: _IO_padn (in /lib/tls/libc-2.3.4.so)
==24859==    by 0x6F8713: vfprintf (in /lib/tls/libc-2.3.4.so)
==24859==    by 0x7177A5: vsnprintf (in /lib/tls/libc-2.3.4.so)
==24859==    by 0x6FF4E1: snprintf (in /lib/tls/libc-2.3.4.so)
==24859==    by 0x809DDC1: Rf_EncodeReal (printutils.c:179)
==24859==    by 0x8099AA9: Rf_PrintValueRec (print.c:359)
==24859==    by 0x809A124: Rf_PrintValueEnv (print.c:956)
==24859==    by 0x80584CA: Rf_ReplIteration (main.c:261)
==24859==    by 0x8058572: R_ReplConsole (main.c:306)
==24859==    by 0x8058BB8: run_Rmainloop (main.c:967)
==24859==    by 0x8056A70: main (Rmain.c:33)
==24859==
==24859== Conditional jump or move depends on uninitialised value(s)
==24859==    at 0x7111BF: _IO_padn (in /lib/tls/libc-2.3.4.so)
==24859==    by 0x6F8713: vfprintf (in /lib/tls/libc-2.3.4.so)
==24859==    by 0x7177A5: vsnprintf (in /lib/tls/libc-2.3.4.so)
==24859==    by 0x6FF4E1: snprintf (in /lib/tls/libc-2.3.4.so)
==24859==    by 0x809DDC1: Rf_EncodeReal (printutils.c:179)
==24859==    by 0x8099AA9: Rf_PrintValueRec (print.c:359)
==24859==    by 0x809A124: Rf_PrintValueEnv (print.c:956)
==24859==    by 0x80584CA: Rf_ReplIteration (main.c:261)
==24859==    by 0x8058572: R_ReplConsole (main.c:306)
==24859==    by 0x8058BB8: run_Rmainloop (main.c:967)
==24859==    by 0x8056A70: main (Rmain.c:33)
Bill Dunlap
TIBCO Software Inc - Spotfire Division
wdunlap tibco.com 

> 
> Regards,
> Martin Maechler
> 
>     >> Compare the
>     >> unproblematic real case:
>     >> 
>     >> print(structure(list(NA_real_, NA_real_), .Dim = 1:2))
>     >> [,1] [,2]
>     >> [1,] NA   NA
>     >> 
>     >> Also, when printed in the read-eval-print loop, 
> printing takes a very very
>     >> long time:
>     >> 
>     >> 
>     >>> proc.time(); matrix(list(NA_complex_,NA_complex_),1); 
> proc.time()
>     >>> 
>     >> user  system elapsed
>     >> 74.35    0.09  329.45
>     >> 
>     >> [,1]
>     >> 
>     >> [1,]
>     >> 
>     >> 
>     >> [,2]
>     >> 
>     >> [1,]
>     >> 
>     >> user  system elapsed
>     >> 92.63    0.15  347.86
>     >> 
>     >> 18 seconds runtime!
>     >> 
> 
>     vQ> user  system elapsed
>     vQ> 0.648   0.056 155.843
>     vQ> [,1] [,2]
>     vQ> [1,]  NA   NA
>     vQ> user  system elapsed
>     vQ> 0.648   0.056 155.843
> 
>     vQ> vQ
> 
>     vQ> ______________________________________________
>     vQ> R-devel at r-project.org mailing list
>     vQ> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 


From wdunlap at tibco.com  Wed Jun  3 18:20:48 2009
From: wdunlap at tibco.com (William Dunlap)
Date: Wed, 3 Jun 2009 09:20:48 -0700
Subject: [Rd] Print bug for matrix(list(NA_complex_, ...))
References: <8b356f880906022219n77891154k583fecf59e96ecaf@mail.gmail.com><4A2637AD.4050801@idi.ntnu.no>
	<18982.17460.628994.128590@lynne.math.ethz.ch> 
Message-ID: <77EB52C6DD32BA4D87471DCD70C8D7000147BA06@NA-PA-VBE03.na.tibco.com>


> From: William Dunlap 
> Sent: Wednesday, June 03, 2009 8:58 AM
> To: 'Martin Maechler'; Wacek Kusnierczyk
> Cc: r-devel at r-project.org
> Subject: RE: [Rd] Print bug for matrix(list(NA_complex_, ...))
...
> >     >> There is a bug in printing val <- 
> > matrix(list(NA_complex_,NA_complex_),1).
...
> >     >> Note that a large number of spaces are printed 
> instead of NA.  
> > 
> >     vQ> on ubuntu 8.04 with r 2.10.0 r48703 there is almost 
> > no problem (still
> >     vQ> some unnecessary spaces):
> > 
> >     vQ> [,1]      [,2]    
> >     vQ> [1,]        NA        NA
> > 
> > thank you, Waclav.
> > 
> > I don't see any unnecessary space (or other CPU problems),
> > using another Linux variant (RHEL 5)
> > in the three R version
> >        	  2.9.0 ,  
> > 	  2.9.0-patched (r48700)
> > 	  2.10.0-devel  (r48700)
> > 
> > Can other Windows (or ...) users confirm problems in R 2.9.0 
> > (or newer) ?
> 
> I just tried it on 2.9.0 on the Windows GUI (RGui.exe)
> and saw similar problems.  When printing to the
> command window, with either print(val) or show(val) it took
> a very long time and put $'s at the ends of the lines
> (indicating that there was text beyond the edge of the window).
> I used sink() to put the output into a file and then print() and
> show() acted quickly.  The resulting file had 119 character
> lines, consisting mainly of trailing blanks:
> 
> > readLines("c:/temp/val.txt") # output of 
> print(val);show(val);str(val)
>  [1] "     [,1]                                               
>                                                                "
>  [2] "[1,]                                                    
>                                                                "
>  [3] "     [,2]                                               
>                                                                "
>  [4] "[1,]                                                    
>                                                                "
>  [5] "     [,1]                                               
>                                                                "
>  [6] "[1,]                                                    
>                                                                "
>  [7] "     [,2]                                               
>                                                                "
>  [8] "[1,]                                                    
>                                                                "
>  [9] "List of 2"                                              
>                                                                 
> [10] " $ : cplx NA"                                           
>                                                                 
> [11] " $ : cplx NA"                                           
>                                                                 
> [12] " - attr(*, \"dim\")= int [1:2] 1 2"                     
>                                                                 
> > nchar(readLines("c:/temp/val.txt"))
>  [1] 119 119 119 119 119 119 119 119   9  12  12  32
> 
> On Linux, using yesterday's 2.9.0, valgrind shows lots
> of 'depends on uninitialized value' problems that could
> explain the Linux-Windows difference in behavior:
> 
> > val<-matrix(list(NA_complex_,NA_complex_),1)
> > val
> ==24859== Conditional jump or move depends on uninitialised value(s)
> ==24859==    at 0x6F7E2F: vfprintf (in /lib/tls/libc-2.3.4.so)
> ==24859==    by 0x7177A5: vsnprintf (in /lib/tls/libc-2.3.4.so)
> ==24859==    by 0x6FF4E1: snprintf (in /lib/tls/libc-2.3.4.so)
> ==24859==    by 0x809DDC1: Rf_EncodeReal (printutils.c:179)
> ==24859==    by 0x8099AA9: Rf_PrintValueRec (print.c:359)
> ==24859==    by 0x809A124: Rf_PrintValueEnv (print.c:956)
> ==24859==    by 0x80584CA: Rf_ReplIteration (main.c:261)
> ==24859==    by 0x8058572: R_ReplConsole (main.c:306)
> ==24859==    by 0x8058BB8: run_Rmainloop (main.c:967)
> ==24859==    by 0x8056A70: main (Rmain.c:33)

Here is the traceback when it enters Rf_EncodeReal:
(gdb) where
#0  Rf_EncodeReal (x=nan(0x0000007a2), w=168381312, d=0, e=0, cdec=46
'.')
    at printutils.c:160
#1  0x08099aaa in Rf_PrintValueRec (s=0x9f4a4a8, env=0x9e4cc90) at
print.c:359
#2  0x0809a125 in Rf_PrintValueEnv (s=0x9f4a4a8, env=0x9e4cc90) at
print.c:956
#3  0x080584cb in Rf_ReplIteration (rho=0x9e4cc90, savestack=0,
browselevel=0,
    state=0xbffc7820) at main.c:261
#4  0x08058573 in R_ReplConsole (rho=0x9e4cc90, savestack=0,
browselevel=0)
    at main.c:306
#5  0x08058bb9 in run_Rmainloop () at main.c:967

It looks like w has a bogus value and was probably never initialized.
It is called from print.c:

    354             case CPLXSXP:
    355                 if (LENGTH(tmp) == 1) {
    356                     Rcomplex *x = COMPLEX(tmp);
    357                     formatComplex(x, 1, &wr, &dr, &er, &wi, &di,
&ei, 0);
    358                     if (ISNA(x[0].r) || ISNA(x[0].i))
    359                         snprintf(pbuf, 115, "%s",
    360                                  EncodeReal(NA_REAL, w, 0, 0,
OutDec));
    361                     else
    362                         snprintf(pbuf, 115, "%s",
EncodeComplex(x[0],
    363                         wr, dr, er, wi, di, ei, OutDec));

and I think the 'w' needs to be replaced by something reasonable for
printing "NA"
(or "NA_complex_?, I don't know all of what this code is used for).
Usually complex printing uses wr and wi, not w, so w is not initialized.

> ==24859==
> ==24859== Conditional jump or move depends on uninitialised value(s)
> ==24859==    at 0x6F7E44: vfprintf (in /lib/tls/libc-2.3.4.so)
> ==24859==    by 0x7177A5: vsnprintf (in /lib/tls/libc-2.3.4.so)
> ==24859==    by 0x6FF4E1: snprintf (in /lib/tls/libc-2.3.4.so)
> ==24859==    by 0x809DDC1: Rf_EncodeReal (printutils.c:179)
> ==24859==    by 0x8099AA9: Rf_PrintValueRec (print.c:359)
> ==24859==    by 0x809A124: Rf_PrintValueEnv (print.c:956)
> ==24859==    by 0x80584CA: Rf_ReplIteration (main.c:261)
> ==24859==    by 0x8058572: R_ReplConsole (main.c:306)
> ==24859==    by 0x8058BB8: run_Rmainloop (main.c:967)
> ==24859==    by 0x8056A70: main (Rmain.c:33)
> ==24859==
> ==24859== Conditional jump or move depends on uninitialised value(s)
> ==24859==    at 0x6F7E4C: vfprintf (in /lib/tls/libc-2.3.4.so)
> ==24859==    by 0x7177A5: vsnprintf (in /lib/tls/libc-2.3.4.so)
> ==24859==    by 0x6FF4E1: snprintf (in /lib/tls/libc-2.3.4.so)
> ==24859==    by 0x809DDC1: Rf_EncodeReal (printutils.c:179)
> ==24859==    by 0x8099AA9: Rf_PrintValueRec (print.c:359)
> ==24859==    by 0x809A124: Rf_PrintValueEnv (print.c:956)
> ==24859==    by 0x80584CA: Rf_ReplIteration (main.c:261)
> ==24859==    by 0x8058572: R_ReplConsole (main.c:306)
> ==24859==    by 0x8058BB8: run_Rmainloop (main.c:967)
> ==24859==    by 0x8056A70: main (Rmain.c:33)
> ==24859==
> ==24859== Conditional jump or move depends on uninitialised value(s)
> ==24859==    at 0x6FA87A: vfprintf (in /lib/tls/libc-2.3.4.so)
> ==24859==    by 0x7177A5: vsnprintf (in /lib/tls/libc-2.3.4.so)
> ==24859==    by 0x6FF4E1: snprintf (in /lib/tls/libc-2.3.4.so)
> ==24859==    by 0x809DDC1: Rf_EncodeReal (printutils.c:179)
> ==24859==    by 0x8099AA9: Rf_PrintValueRec (print.c:359)
> ==24859==    by 0x809A124: Rf_PrintValueEnv (print.c:956)
> ==24859==    by 0x80584CA: Rf_ReplIteration (main.c:261)
> ==24859==    by 0x8058572: R_ReplConsole (main.c:306)
> ==24859==    by 0x8058BB8: run_Rmainloop (main.c:967)
> ==24859==    by 0x8056A70: main (Rmain.c:33)
> ==24859==
> ==24859== Conditional jump or move depends on uninitialised value(s)
> ==24859==    at 0x6F86E8: vfprintf (in /lib/tls/libc-2.3.4.so)
> ==24859==    by 0x7177A5: vsnprintf (in /lib/tls/libc-2.3.4.so)
> ==24859==    by 0x6FF4E1: snprintf (in /lib/tls/libc-2.3.4.so)
> ==24859==    by 0x809DDC1: Rf_EncodeReal (printutils.c:179)
> ==24859==    by 0x8099AA9: Rf_PrintValueRec (print.c:359)
> ==24859==    by 0x809A124: Rf_PrintValueEnv (print.c:956)
> ==24859==    by 0x80584CA: Rf_ReplIteration (main.c:261)
> ==24859==    by 0x8058572: R_ReplConsole (main.c:306)
> ==24859==    by 0x8058BB8: run_Rmainloop (main.c:967)
> ==24859==    by 0x8056A70: main (Rmain.c:33)
> ==24859==
> ==24859== Conditional jump or move depends on uninitialised value(s)
> ==24859==    at 0x6F86FA: vfprintf (in /lib/tls/libc-2.3.4.so)
> ==24859==    by 0x7177A5: vsnprintf (in /lib/tls/libc-2.3.4.so)
> ==24859==    by 0x6FF4E1: snprintf (in /lib/tls/libc-2.3.4.so)
> ==24859==    by 0x809DDC1: Rf_EncodeReal (printutils.c:179)
> ==24859==    by 0x8099AA9: Rf_PrintValueRec (print.c:359)
> ==24859==    by 0x809A124: Rf_PrintValueEnv (print.c:956)
> ==24859==    by 0x80584CA: Rf_ReplIteration (main.c:261)
> ==24859==    by 0x8058572: R_ReplConsole (main.c:306)
> ==24859==    by 0x8058BB8: run_Rmainloop (main.c:967)
> ==24859==    by 0x8056A70: main (Rmain.c:33)
> ==24859==
> ==24859== Conditional jump or move depends on uninitialised value(s)
> ==24859==    at 0x711183: _IO_padn (in /lib/tls/libc-2.3.4.so)
> ==24859==    by 0x6F8713: vfprintf (in /lib/tls/libc-2.3.4.so)
> ==24859==    by 0x7177A5: vsnprintf (in /lib/tls/libc-2.3.4.so)
> ==24859==    by 0x6FF4E1: snprintf (in /lib/tls/libc-2.3.4.so)
> ==24859==    by 0x809DDC1: Rf_EncodeReal (printutils.c:179)
> ==24859==    by 0x8099AA9: Rf_PrintValueRec (print.c:359)
> ==24859==    by 0x809A124: Rf_PrintValueEnv (print.c:956)
> ==24859==    by 0x80584CA: Rf_ReplIteration (main.c:261)
> ==24859==    by 0x8058572: R_ReplConsole (main.c:306)
> ==24859==    by 0x8058BB8: run_Rmainloop (main.c:967)
> ==24859==    by 0x8056A70: main (Rmain.c:33)
> ==24859==
> ==24859== Conditional jump or move depends on uninitialised value(s)
> ==24859==    at 0x7111BF: _IO_padn (in /lib/tls/libc-2.3.4.so)
> ==24859==    by 0x6F8713: vfprintf (in /lib/tls/libc-2.3.4.so)
> ==24859==    by 0x7177A5: vsnprintf (in /lib/tls/libc-2.3.4.so)
> ==24859==    by 0x6FF4E1: snprintf (in /lib/tls/libc-2.3.4.so)
> ==24859==    by 0x809DDC1: Rf_EncodeReal (printutils.c:179)
> ==24859==    by 0x8099AA9: Rf_PrintValueRec (print.c:359)
> ==24859==    by 0x809A124: Rf_PrintValueEnv (print.c:956)
> ==24859==    by 0x80584CA: Rf_ReplIteration (main.c:261)
> ==24859==    by 0x8058572: R_ReplConsole (main.c:306)
> ==24859==    by 0x8058BB8: run_Rmainloop (main.c:967)
> ==24859==    by 0x8056A70: main (Rmain.c:33)
> Bill Dunlap
> TIBCO Software Inc - Spotfire Division
> wdunlap tibco.com 
> 
> > 
> > Regards,
> > Martin Maechler
> > 
> >     >> Compare the
> >     >> unproblematic real case:
> >     >> 
> >     >> print(structure(list(NA_real_, NA_real_), .Dim = 1:2))
> >     >> [,1] [,2]
> >     >> [1,] NA   NA
> >     >> 
> >     >> Also, when printed in the read-eval-print loop, 
> > printing takes a very very
> >     >> long time:
> >     >> 
> >     >> 
> >     >>> proc.time(); matrix(list(NA_complex_,NA_complex_),1); 
> > proc.time()
> >     >>> 
> >     >> user  system elapsed
> >     >> 74.35    0.09  329.45
> >     >> 
> >     >> [,1]
> >     >> 
> >     >> [1,]
> >     >> 
> >     >> 
> >     >> [,2]
> >     >> 
> >     >> [1,]
> >     >> 
> >     >> user  system elapsed
> >     >> 92.63    0.15  347.86
> >     >> 
> >     >> 18 seconds runtime!
> >     >> 
> > 
> >     vQ> user  system elapsed
> >     vQ> 0.648   0.056 155.843
> >     vQ> [,1] [,2]
> >     vQ> [1,]  NA   NA
> >     vQ> user  system elapsed
> >     vQ> 0.648   0.056 155.843
> > 
> >     vQ> vQ
> > 
> >     vQ> ______________________________________________
> >     vQ> R-devel at r-project.org mailing list
> >     vQ> https://stat.ethz.ch/mailman/listinfo/r-devel
> > 
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> > 


From pauljohn32 at gmail.com  Wed Jun  3 20:42:52 2009
From: pauljohn32 at gmail.com (Paul Johnson)
Date: Wed, 3 Jun 2009 13:42:52 -0500
Subject: [Rd] Would like to add this to example for plotmath. Can you help?
Message-ID: <13e802630906031142p2947d5b0q9d4fffebe39f5f39@mail.gmail.com>

Greetings:

I would like comments on this example and after fixing it up, I need
help from someone who has access to insert this in R's help page for
plotmath.

I uploaded a drawing
http://pj.freefaculty.org/R/Normal-2009.pdf

that is created by the following code

http://pj.freefaculty.org/R/Normal1_2009_plotmathExample.R

This will be a good addition to the plotmath help page/example.

Here's why:

plotmath can be somewhat challenging.   A few more concrete examples
of ways in which users can combine values from R programs with
plotmath expressions will be helpful to new users.  In particular,
combining several values from a program into a single expression is a
difficult task that is not currently exemplified.  I believe this is
an instructive example because it combines the use of lines, arrows,
text, and polygons.

Here's the code:

###Set mu and sigma at your pleasure:
mu <- 10.03
sigma <- 12.5786786

myx <- seq( mu - 3.5*sigma,  mu+ 3.5*sigma, length.out=500)

myDensity <- dnorm(myx,mean=mu,sd=sigma)


# It is challenging to combine plotmath with values of mu and sigma in
one expression.
# Either bquote or substitute can be used.  First use bquote:

myTitle1 <- bquote (paste("x ~ Normal(", mu== .(round(mu,2)), ',',
sigma== .(round(sigma,2)),")") )

### Using substitute:
### myTitle1 <-  substitute( "x ~ Normal" ~~ group( "(", list(mu==mu1,
sigma^2==sigma2)#, ")") ,  list(mu1=round(mu,2),
sigma2=round(sigma^2,2)))

### Or combine the two:
### t1 <- substitute ( mu == a ,  list (a = mu))
### t2 <- substitute ( sigma == a, list(a = round(sigma,2)))
### myTitle1 <- bquote(paste("x ~ Normal(", .(t1),",", .(t2),")" ) )


## To save the plot in a file, change FALSE to TRUE
saveplot <- FALSE

if (saveplot == TRUE){
  pdf(file="Normal-2009.pdf", height=6.5, width=6.5, onefile=F,
paper="special", pointsize=10)

}else {
  dev.new(height=6.5, width=6.5,pointsize=9)
}
### xpd needed to allow writing outside strict box of graph
par(xpd=TRUE, ps=10)

plot(myx, myDensity, type="l", xlab="x", ylab="Probability Density ",
main=myTitle1, axes=FALSE)
axis(2, pos= mu - 3.6*sigma)
axis(1, pos=0)
lines(c(myx[1],myx[length(myx)]),c(0,0)) ### closes off axes

# bquote creates an expression that text plotters can use
t1 <-  bquote( mu== .(mu))

# Find a value of myx that is "very close to" mu
centerX <- max(which (myx <= mu))
# plot light vertical line under peak of density
lines( c(mu, mu), c(0, myDensity[centerX]), lty= 14, lwd=.2)

# label the mean in the bottom margin
mtext(bquote( mu == .(mu)), 1, at=mu, line=-1)

### find position 20% "up" vertically, to use for arrow coordinate
ss = 0.2 * max(myDensity)
# Insert interval to represent width of one sigma
arrows( x0=mu, y0= ss, x1=mu+sigma, y1=ss, code=3, angle=90, length=0.1)

### Write the value of sigma above that interval
t2 <-  bquote( sigma== .(round(sigma,2)))
text( mu+0.5*sigma, 1.15*ss, t2)

### Create a formula for the Normal
normalFormula <- expression (f(x) == frac (1, sigma* sqrt(2*pi)) *
e^{~~ - ~~ frac(1,2)~~ bgroup("(", frac(x-mu,sigma),")")^2})
# Draw the Normal formula
text ( mu + 0.5*sigma, max(myDensity)- 0.10 * max(myDensity),
normalFormula, pos=4)

### Theory says we should have 2.5% of the area to the left of: -1.96 * sigma.
### Find the X coordinate of that "critical value"
criticalValue <- mu -1.96 * sigma
### Then grab all myx values that are "to the left" of that critical value.
specialX <-  myx[myx <= criticalValue]

### mark the critical value in the graph
text ( criticalValue, 0 , label= paste(round(criticalValue,2)), pos=1)
### Take sequence parallel to values of myx inside critical region
specialY <- myDensity[myx < criticalValue]
#  Polygon makes a nice shaded illustration
polygon(c(specialX[1], specialX, specialX[length(specialX )]), c(0,
specialY, 0), density=c(-110),col="lightgray" )

shadedArea <- round(pnorm(mu - 1.96 * sigma, mean=mu, sd=sigma),4)


### I want to insert annotation about area on left side.

al1 <- bquote(Prob(x <= .(round(criticalValue,2))))
al2 <- bquote(phantom(0) == F( .(round(criticalValue,2)) ))
al3 <- bquote(phantom(0) == .(round(shadedArea,3)))

### Hard to position this text "just right"
### Have tried many ideas, this may be least bad.
### Get center position in shaded area
medX <- median(specialX)
### density at that center point:
denAtMedX <- myDensity[indexMed <- max(which(specialX < medX))]

text(medX, denAtMedX+0.0055, labels=al1)
text(medX, denAtMedX+0.004, labels=al2)
text(medX, denAtMedX+0.0025, labels=al3)

### point from text toward shaded area
arrows( x0=medX, y0=myDensity[indexMed]+0.002 ,x1= mu-2.5 *sigma, y1=
0.40*myDensity[length(specialX)] ,   length=0.1)



ss <- 0.1 * max(myDensity)
### Mark interval from mu to mu-1.96*sigma
arrows( x0=mu, y0= ss, x1=mu-1.96*sigma, y1=ss, code=3, angle=90, length=0.1)
### Put text above interval
text( mu - 2.0*sigma,1.15*ss,
bquote(paste(.(round(criticalValue,2)),phantom(1)==mu-1.96 *
sigma,sep="")),pos=4 )




criticalValue <- mu +1.96 * sigma
### Then grab all myx values that are "to the left" of that critical value.
specialX <-  myx[myx >= criticalValue]

### mark the critical value in the graph
text ( criticalValue, 0 , label= paste(round(criticalValue,2)), pos=1)
### Take sequence parallel to values of myx inside critical region
specialY <- myDensity[myx > criticalValue]
#  Polygon makes a nice shaded illustration
polygon(c(specialX[1], specialX, specialX[length(specialX )]), c(0,
specialY, 0), density=c(-110),col="lightgray" )

shadedArea <- round(pnorm(mu + 1.96 * sigma, mean=mu, sd=sigma, lower.tail=F),4)


### Insert simpler comment on right side.

al2 <- bquote(phantom(0) == 1 - F( .(round(criticalValue,2)) ))
al3 <- bquote(phantom(0) == .(round(shadedArea,3)))

### Hard to position this text "just right"
### Have tried many ideas, this may be least bad.
### Get center position in shaded area
medX <- median(specialX)
### density at that center point:
denAtMedX <- myDensity[indexMed <- max(which(specialX < medX))]


text(medX, denAtMedX+0.004, labels=al2)
text(medX, denAtMedX+0.0025, labels=al3)

### point from text toward shaded area
arrows( x0=medX, y0=myDensity[indexMed]+0.002 ,x1= mu+2.5 *sigma, y1=
0.40*myDensity[length(specialX)] ,   length=0.1)



ss <- 0.05 * max(myDensity)
### Mark interval from mu to mu+1.96*sigma
arrows( x0=mu, y0= ss, x1=mu+1.96*sigma, y1=ss, code=3, angle=90, length=0.1)
### Put text above interval
text( mu + 1.96*sigma,1.15*ss,
bquote(paste(.(round(criticalValue,2)),phantom(1)==mu+1.96 *
sigma,sep="")),pos=2 )


if (saveplot == TRUE)  dev.off()


-- 
Paul E. Johnson
Professor, Political Science
1541 Lilac Lane, Room 504
University of Kansas


From wdunlap at tibco.com  Wed Jun  3 20:49:00 2009
From: wdunlap at tibco.com (William Dunlap)
Date: Wed, 3 Jun 2009 11:49:00 -0700
Subject: [Rd] Print bug for matrix(list(NA_complex_, ...))
In-Reply-To: <77EB52C6DD32BA4D87471DCD70C8D7000147BA06@NA-PA-VBE03.na.tibco.com>
References: <8b356f880906022219n77891154k583fecf59e96ecaf@mail.gmail.com><4A2637AD.4050801@idi.ntnu.no><18982.17460.628994.128590@lynne.math.ethz.ch>
	<77EB52C6DD32BA4D87471DCD70C8D7000147BA06@NA-PA-VBE03.na.tibco.com>
Message-ID: <77EB52C6DD32BA4D87471DCD70C8D7000147BAC4@NA-PA-VBE03.na.tibco.com>

Changing the uninitialized 'w' to 'R_print.na_width' for the complex NA
code fixes up the valgrind complaints on Linux and the bad behavior
on Windows:

===================================================================
--- print.c     (revision 48703)
+++ print.c     (working copy)
@@ -357,7 +357,7 @@
                    formatComplex(x, 1, &wr, &dr, &er, &wi, &di, &ei,
0);
                    if (ISNA(x[0].r) || ISNA(x[0].i))
                        snprintf(pbuf, 115, "%s",
-                                EncodeReal(NA_REAL, w, 0, 0, OutDec));
+                                EncodeReal(NA_REAL, R_print.na_width,
0, 0, OutDec)); /* formatReal would set w=R_print.na_width,d=0,e=0 for
NA */
                    else
                        snprintf(pbuf, 115, "%s", EncodeComplex(x[0],
                        wr, dr, er, wi, di, ei, OutDec));

E.g., the following prints go very quickly and don't have lots of
trailing
blanks.

> val <- matrix(list(NA_complex_, 3, "A string", NA_complex_), 2,2)
> print(val)
     [,1] [,2]      
[1,] NA   "A string"
[2,] 3    NA        
> print(val, na.print="<my personal missing value indicator>")
     [,1]                                 
[1,] <my personal missing value indicator>
[2,] 3                                    
     [,2]                                 
[1,] "A string"                           
[2,] <my personal missing value indicator>

Bill Dunlap
TIBCO Software Inc - Spotfire Division
wdunlap tibco.com  

> -----Original Message-----
> From: r-devel-bounces at r-project.org 
> [mailto:r-devel-bounces at r-project.org] On Behalf Of William Dunlap
> Sent: Wednesday, June 03, 2009 9:21 AM
> To: Martin Maechler; Wacek Kusnierczyk
> Cc: r-devel at r-project.org
> Subject: Re: [Rd] Print bug for matrix(list(NA_complex_, ...))
> 
> 
> > From: William Dunlap 
> > Sent: Wednesday, June 03, 2009 8:58 AM
> > To: 'Martin Maechler'; Wacek Kusnierczyk
> > Cc: r-devel at r-project.org
> > Subject: RE: [Rd] Print bug for matrix(list(NA_complex_, ...))
> ...
> > >     >> There is a bug in printing val <- 
> > > matrix(list(NA_complex_,NA_complex_),1).
> ...
> > >     >> Note that a large number of spaces are printed 
> > instead of NA.  
> > > 
> > >     vQ> on ubuntu 8.04 with r 2.10.0 r48703 there is almost 
> > > no problem (still
> > >     vQ> some unnecessary spaces):
> > > 
> > >     vQ> [,1]      [,2]    
> > >     vQ> [1,]        NA        NA
> > > 
> > > thank you, Waclav.
> > > 
> > > I don't see any unnecessary space (or other CPU problems),
> > > using another Linux variant (RHEL 5)
> > > in the three R version
> > >        	  2.9.0 ,  
> > > 	  2.9.0-patched (r48700)
> > > 	  2.10.0-devel  (r48700)
> > > 
> > > Can other Windows (or ...) users confirm problems in R 2.9.0 
> > > (or newer) ?
> > 
> > I just tried it on 2.9.0 on the Windows GUI (RGui.exe)
> > and saw similar problems.  When printing to the
> > command window, with either print(val) or show(val) it took
> > a very long time and put $'s at the ends of the lines
> > (indicating that there was text beyond the edge of the window).
> > I used sink() to put the output into a file and then print() and
> > show() acted quickly.  The resulting file had 119 character
> > lines, consisting mainly of trailing blanks:
> > 
> > > readLines("c:/temp/val.txt") # output of 
> > print(val);show(val);str(val)
> >  [1] "     [,1]                                               
> >                                                                "
> >  [2] "[1,]                                                    
> >                                                                "
> >  [3] "     [,2]                                               
> >                                                                "
> >  [4] "[1,]                                                    
> >                                                                "
> >  [5] "     [,1]                                               
> >                                                                "
> >  [6] "[1,]                                                    
> >                                                                "
> >  [7] "     [,2]                                               
> >                                                                "
> >  [8] "[1,]                                                    
> >                                                                "
> >  [9] "List of 2"                                              
> >                                                                 
> > [10] " $ : cplx NA"                                           
> >                                                                 
> > [11] " $ : cplx NA"                                           
> >                                                                 
> > [12] " - attr(*, \"dim\")= int [1:2] 1 2"                     
> >                                                                 
> > > nchar(readLines("c:/temp/val.txt"))
> >  [1] 119 119 119 119 119 119 119 119   9  12  12  32
> > 
> > On Linux, using yesterday's 2.9.0, valgrind shows lots
> > of 'depends on uninitialized value' problems that could
> > explain the Linux-Windows difference in behavior:
> > 
> > > val<-matrix(list(NA_complex_,NA_complex_),1)
> > > val
> > ==24859== Conditional jump or move depends on uninitialised value(s)
> > ==24859==    at 0x6F7E2F: vfprintf (in /lib/tls/libc-2.3.4.so)
> > ==24859==    by 0x7177A5: vsnprintf (in /lib/tls/libc-2.3.4.so)
> > ==24859==    by 0x6FF4E1: snprintf (in /lib/tls/libc-2.3.4.so)
> > ==24859==    by 0x809DDC1: Rf_EncodeReal (printutils.c:179)
> > ==24859==    by 0x8099AA9: Rf_PrintValueRec (print.c:359)
> > ==24859==    by 0x809A124: Rf_PrintValueEnv (print.c:956)
> > ==24859==    by 0x80584CA: Rf_ReplIteration (main.c:261)
> > ==24859==    by 0x8058572: R_ReplConsole (main.c:306)
> > ==24859==    by 0x8058BB8: run_Rmainloop (main.c:967)
> > ==24859==    by 0x8056A70: main (Rmain.c:33)
> 
> Here is the traceback when it enters Rf_EncodeReal:
> (gdb) where
> #0  Rf_EncodeReal (x=nan(0x0000007a2), w=168381312, d=0, e=0, cdec=46
> '.')
>     at printutils.c:160
> #1  0x08099aaa in Rf_PrintValueRec (s=0x9f4a4a8, env=0x9e4cc90) at
> print.c:359
> #2  0x0809a125 in Rf_PrintValueEnv (s=0x9f4a4a8, env=0x9e4cc90) at
> print.c:956
> #3  0x080584cb in Rf_ReplIteration (rho=0x9e4cc90, savestack=0,
> browselevel=0,
>     state=0xbffc7820) at main.c:261
> #4  0x08058573 in R_ReplConsole (rho=0x9e4cc90, savestack=0,
> browselevel=0)
>     at main.c:306
> #5  0x08058bb9 in run_Rmainloop () at main.c:967
> 
> It looks like w has a bogus value and was probably never initialized.
> It is called from print.c:
> 
>     354             case CPLXSXP:
>     355                 if (LENGTH(tmp) == 1) {
>     356                     Rcomplex *x = COMPLEX(tmp);
>     357                     formatComplex(x, 1, &wr, &dr, 
> &er, &wi, &di,
> &ei, 0);
>     358                     if (ISNA(x[0].r) || ISNA(x[0].i))
>     359                         snprintf(pbuf, 115, "%s",
>     360                                  EncodeReal(NA_REAL, w, 0, 0,
> OutDec));
>     361                     else
>     362                         snprintf(pbuf, 115, "%s",
> EncodeComplex(x[0],
>     363                         wr, dr, er, wi, di, ei, OutDec));
> 
> and I think the 'w' needs to be replaced by something reasonable for
> printing "NA"
> (or "NA_complex_?, I don't know all of what this code is used for).
> Usually complex printing uses wr and wi, not w, so w is not 
> initialized.
> 
> > ==24859==
> > ==24859== Conditional jump or move depends on uninitialised value(s)
> > ==24859==    at 0x6F7E44: vfprintf (in /lib/tls/libc-2.3.4.so)
> > ==24859==    by 0x7177A5: vsnprintf (in /lib/tls/libc-2.3.4.so)
> > ==24859==    by 0x6FF4E1: snprintf (in /lib/tls/libc-2.3.4.so)
> > ==24859==    by 0x809DDC1: Rf_EncodeReal (printutils.c:179)
> > ==24859==    by 0x8099AA9: Rf_PrintValueRec (print.c:359)
> > ==24859==    by 0x809A124: Rf_PrintValueEnv (print.c:956)
> > ==24859==    by 0x80584CA: Rf_ReplIteration (main.c:261)
> > ==24859==    by 0x8058572: R_ReplConsole (main.c:306)
> > ==24859==    by 0x8058BB8: run_Rmainloop (main.c:967)
> > ==24859==    by 0x8056A70: main (Rmain.c:33)
> > ==24859==
> > ==24859== Conditional jump or move depends on uninitialised value(s)
> > ==24859==    at 0x6F7E4C: vfprintf (in /lib/tls/libc-2.3.4.so)
> > ==24859==    by 0x7177A5: vsnprintf (in /lib/tls/libc-2.3.4.so)
> > ==24859==    by 0x6FF4E1: snprintf (in /lib/tls/libc-2.3.4.so)
> > ==24859==    by 0x809DDC1: Rf_EncodeReal (printutils.c:179)
> > ==24859==    by 0x8099AA9: Rf_PrintValueRec (print.c:359)
> > ==24859==    by 0x809A124: Rf_PrintValueEnv (print.c:956)
> > ==24859==    by 0x80584CA: Rf_ReplIteration (main.c:261)
> > ==24859==    by 0x8058572: R_ReplConsole (main.c:306)
> > ==24859==    by 0x8058BB8: run_Rmainloop (main.c:967)
> > ==24859==    by 0x8056A70: main (Rmain.c:33)
> > ==24859==
> > ==24859== Conditional jump or move depends on uninitialised value(s)
> > ==24859==    at 0x6FA87A: vfprintf (in /lib/tls/libc-2.3.4.so)
> > ==24859==    by 0x7177A5: vsnprintf (in /lib/tls/libc-2.3.4.so)
> > ==24859==    by 0x6FF4E1: snprintf (in /lib/tls/libc-2.3.4.so)
> > ==24859==    by 0x809DDC1: Rf_EncodeReal (printutils.c:179)
> > ==24859==    by 0x8099AA9: Rf_PrintValueRec (print.c:359)
> > ==24859==    by 0x809A124: Rf_PrintValueEnv (print.c:956)
> > ==24859==    by 0x80584CA: Rf_ReplIteration (main.c:261)
> > ==24859==    by 0x8058572: R_ReplConsole (main.c:306)
> > ==24859==    by 0x8058BB8: run_Rmainloop (main.c:967)
> > ==24859==    by 0x8056A70: main (Rmain.c:33)
> > ==24859==
> > ==24859== Conditional jump or move depends on uninitialised value(s)
> > ==24859==    at 0x6F86E8: vfprintf (in /lib/tls/libc-2.3.4.so)
> > ==24859==    by 0x7177A5: vsnprintf (in /lib/tls/libc-2.3.4.so)
> > ==24859==    by 0x6FF4E1: snprintf (in /lib/tls/libc-2.3.4.so)
> > ==24859==    by 0x809DDC1: Rf_EncodeReal (printutils.c:179)
> > ==24859==    by 0x8099AA9: Rf_PrintValueRec (print.c:359)
> > ==24859==    by 0x809A124: Rf_PrintValueEnv (print.c:956)
> > ==24859==    by 0x80584CA: Rf_ReplIteration (main.c:261)
> > ==24859==    by 0x8058572: R_ReplConsole (main.c:306)
> > ==24859==    by 0x8058BB8: run_Rmainloop (main.c:967)
> > ==24859==    by 0x8056A70: main (Rmain.c:33)
> > ==24859==
> > ==24859== Conditional jump or move depends on uninitialised value(s)
> > ==24859==    at 0x6F86FA: vfprintf (in /lib/tls/libc-2.3.4.so)
> > ==24859==    by 0x7177A5: vsnprintf (in /lib/tls/libc-2.3.4.so)
> > ==24859==    by 0x6FF4E1: snprintf (in /lib/tls/libc-2.3.4.so)
> > ==24859==    by 0x809DDC1: Rf_EncodeReal (printutils.c:179)
> > ==24859==    by 0x8099AA9: Rf_PrintValueRec (print.c:359)
> > ==24859==    by 0x809A124: Rf_PrintValueEnv (print.c:956)
> > ==24859==    by 0x80584CA: Rf_ReplIteration (main.c:261)
> > ==24859==    by 0x8058572: R_ReplConsole (main.c:306)
> > ==24859==    by 0x8058BB8: run_Rmainloop (main.c:967)
> > ==24859==    by 0x8056A70: main (Rmain.c:33)
> > ==24859==
> > ==24859== Conditional jump or move depends on uninitialised value(s)
> > ==24859==    at 0x711183: _IO_padn (in /lib/tls/libc-2.3.4.so)
> > ==24859==    by 0x6F8713: vfprintf (in /lib/tls/libc-2.3.4.so)
> > ==24859==    by 0x7177A5: vsnprintf (in /lib/tls/libc-2.3.4.so)
> > ==24859==    by 0x6FF4E1: snprintf (in /lib/tls/libc-2.3.4.so)
> > ==24859==    by 0x809DDC1: Rf_EncodeReal (printutils.c:179)
> > ==24859==    by 0x8099AA9: Rf_PrintValueRec (print.c:359)
> > ==24859==    by 0x809A124: Rf_PrintValueEnv (print.c:956)
> > ==24859==    by 0x80584CA: Rf_ReplIteration (main.c:261)
> > ==24859==    by 0x8058572: R_ReplConsole (main.c:306)
> > ==24859==    by 0x8058BB8: run_Rmainloop (main.c:967)
> > ==24859==    by 0x8056A70: main (Rmain.c:33)
> > ==24859==
> > ==24859== Conditional jump or move depends on uninitialised value(s)
> > ==24859==    at 0x7111BF: _IO_padn (in /lib/tls/libc-2.3.4.so)
> > ==24859==    by 0x6F8713: vfprintf (in /lib/tls/libc-2.3.4.so)
> > ==24859==    by 0x7177A5: vsnprintf (in /lib/tls/libc-2.3.4.so)
> > ==24859==    by 0x6FF4E1: snprintf (in /lib/tls/libc-2.3.4.so)
> > ==24859==    by 0x809DDC1: Rf_EncodeReal (printutils.c:179)
> > ==24859==    by 0x8099AA9: Rf_PrintValueRec (print.c:359)
> > ==24859==    by 0x809A124: Rf_PrintValueEnv (print.c:956)
> > ==24859==    by 0x80584CA: Rf_ReplIteration (main.c:261)
> > ==24859==    by 0x8058572: R_ReplConsole (main.c:306)
> > ==24859==    by 0x8058BB8: run_Rmainloop (main.c:967)
> > ==24859==    by 0x8056A70: main (Rmain.c:33)
> > Bill Dunlap
> > TIBCO Software Inc - Spotfire Division
> > wdunlap tibco.com 
> > 
> > > 
> > > Regards,
> > > Martin Maechler
> > > 
> > >     >> Compare the
> > >     >> unproblematic real case:
> > >     >> 
> > >     >> print(structure(list(NA_real_, NA_real_), .Dim = 1:2))
> > >     >> [,1] [,2]
> > >     >> [1,] NA   NA
> > >     >> 
> > >     >> Also, when printed in the read-eval-print loop, 
> > > printing takes a very very
> > >     >> long time:
> > >     >> 
> > >     >> 
> > >     >>> proc.time(); matrix(list(NA_complex_,NA_complex_),1); 
> > > proc.time()
> > >     >>> 
> > >     >> user  system elapsed
> > >     >> 74.35    0.09  329.45
> > >     >> 
> > >     >> [,1]
> > >     >> 
> > >     >> [1,]
> > >     >> 
> > >     >> 
> > >     >> [,2]
> > >     >> 
> > >     >> [1,]
> > >     >> 
> > >     >> user  system elapsed
> > >     >> 92.63    0.15  347.86
> > >     >> 
> > >     >> 18 seconds runtime!
> > >     >> 
> > > 
> > >     vQ> user  system elapsed
> > >     vQ> 0.648   0.056 155.843
> > >     vQ> [,1] [,2]
> > >     vQ> [1,]  NA   NA
> > >     vQ> user  system elapsed
> > >     vQ> 0.648   0.056 155.843
> > > 
> > >     vQ> vQ
> > > 
> > >     vQ> ______________________________________________
> > >     vQ> R-devel at r-project.org mailing list
> > >     vQ> https://stat.ethz.ch/mailman/listinfo/r-devel
> > > 
> > > ______________________________________________
> > > R-devel at r-project.org mailing list
> > > https://stat.ethz.ch/mailman/listinfo/r-devel
> > > 
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 

From macrakis at alum.mit.edu  Wed Jun  3 21:04:06 2009
From: macrakis at alum.mit.edu (Stavros Macrakis)
Date: Wed, 3 Jun 2009 15:04:06 -0400
Subject: [Rd] Print bug for matrix(list(NA_complex_, ...))
In-Reply-To: <77EB52C6DD32BA4D87471DCD70C8D7000147BAC4@NA-PA-VBE03.na.tibco.com>
References: <8b356f880906022219n77891154k583fecf59e96ecaf@mail.gmail.com>
	<4A2637AD.4050801@idi.ntnu.no>
	<18982.17460.628994.128590@lynne.math.ethz.ch>
	<77EB52C6DD32BA4D87471DCD70C8D7000147BA06@NA-PA-VBE03.na.tibco.com>
	<77EB52C6DD32BA4D87471DCD70C8D7000147BAC4@NA-PA-VBE03.na.tibco.com>
Message-ID: <8b356f880906031204s600502a4h8df62cba09e09066@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090603/5f497634/attachment.pl>

From simon.urbanek at r-project.org  Wed Jun  3 21:45:51 2009
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Wed, 3 Jun 2009 15:45:51 -0400
Subject: [Rd] Problems with plot and Quartz device / What is alpha?
In-Reply-To: <alpine.LRH.2.01.0906031154190.25094@homer23.u.washington.edu>
References: <20090603084513.662BD283200F@mail.pubhealth.ku.dk>
	<29342260-D4C4-481A-86D9-E64CAF127F4F@r-project.org>
	<alpine.LRH.2.01.0906031154190.25094@homer23.u.washington.edu>
Message-ID: <B809106D-57F8-4E68-8478-70DA6D88BCF1@r-project.org>


On Jun 3, 2009, at 15:00 , Thomas Richardson wrote:

> PS Please forgive my ignorance, but when you say:
>
>
>> BTW: you may want to use something like pch=19, cex=0.1 (and maybe  
>> add some alpha to get a quick density estimation).
>
> I don't know what alpha refers to here.
>

alpha = alpha component of the color (100% = opaque, 0% =  
transparent). Using alpha < 100% with pch=19 is a good way to get a  
rough density estimation in cases where points overlap since the  
overall opacity will increase with the number of overlapping points.

E.g., compare
plot(rnorm(1e5), rnorm(1e5), pch=19, cex=0.2)
to
plot(rnorm(1e5), rnorm(1e5), pch=19, col="#00000010", cex=0.2)

Varying the alpha will allow you to shift the focus from outliers to  
global patterns.

Cheers,
Simon


>
>>
>> Cheers,
>> S
>>
>>
>>> So I guess it might be related to the
>>> "special treatment" of "." described on help(points) ??
>>> ---
>>> Value pch="." (equivalently pch = 46) is handled specially. It is  
>>> a rectangle of
>>> side 0.01 inch (scaled by cex).
>>> ---
>>> I find this behaviour unnerving: the (resized) plots made it look  
>>> as if there
>>> was a lot of structure in the data, but on closer inspection it  
>>> turned out to be
>>> entirely a consequence of the quartz device and plot function!
>>> I can't imagine that this behaviour is intended - even if it were  
>>> intended to
>>> suppress points (like some axis labels) - it seems strange that  
>>> enlarging the
>>> window makes points disappear. (I also tried setting dpi=72 in  
>>> quartz(), but
>>> this did not fix the problem).
>>> Thanks in advance.
>>> Thomas
>>> ------------------------------------------------------
>>> sessionInfo()
>>> R version 2.9.0 (2009-04-17)
>>> i386-apple-darwin8.11.1
>>> locale:
>>> en_US.UTF-8/en_US.UTF-8/C/C/en_US.UTF-8/en_US.UTF-8
>>> attached base packages:
>>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
>


From thomasr at u.washington.edu  Wed Jun  3 20:54:09 2009
From: thomasr at u.washington.edu (Thomas Richardson)
Date: Wed, 3 Jun 2009 11:54:09 -0700 (PDT)
Subject: [Rd] Problems with plot and Quartz device (PR#13744)
In-Reply-To: <F2B79447-C9CE-42AD-B763-2AC4CD22E41D@r-project.org>
References: <20090603084513.662BD283200F@mail.pubhealth.ku.dk>
	<F2B79447-C9CE-42AD-B763-2AC4CD22E41D@r-project.org>
Message-ID: <alpine.LRH.2.01.0906031136210.25094@homer23.u.washington.edu>

Dear Simon,

Thank you very much for the very rapid response!

> rna is not defined in R, can you, please, supply a reproducible example?

Apologies for including code that could not be run directly.
(I had assumed simulating "similar" data would give the same behaviour, 
but having done more experiments, I see that it is not so simple to get 
this - which makes me very curious about what is really going on!)

I have put the data that I used on the web. I enclose R code below. At 
least on my machine a simple visual comparison of the first column of 
plots in these two quartz windows shows that half of the points in these 
plots, those on the left side of each panel, have disappeared in the 
larger quartz window!

Thanks again.

Best wishes,

Thomas

-----------------------------------------------

# (Hopefully) reproducible code for disappearing pch="." points phenomenon

mydata <- read.table("http://www.stat.washington.edu/tsr/streaking.dat")

quartz()
par(mfrow=c(8,12), mar=c(0,0,0,0), oma=c(0,0,0,0))
for(i in 1:8){ # Row counter
for(j in 1:12){ # Col counter
 	xtmp <- mydata[,1]
 	x <- xtmp[(mydata[,3]==i)&(mydata[,4]==j)]
 	ytmp <- mydata[,2]
 	y <- ytmp[(mydata[,3]==i)&(mydata[,4]==j)]
plot(x,y,xaxt="n",yaxt="n",ann=FALSE,xlim=c(0,100),ylim=c(0,300),pch=".")
}
}

quartz(width=12,height=8)
par(mfrow=c(8,12), mar=c(0,0,0,0), oma=c(0,0,0,0))
for(i in 1:8){ # Row counter
for(j in 1:12){ # Col counter
 	xtmp <- mydata[,1]
 	x <- xtmp[(mydata[,3]==i)&(mydata[,4]==j)]
 	ytmp <- mydata[,2]
 	y <- ytmp[(mydata[,3]==i)&(mydata[,4]==j)]
plot(x,y,xaxt="n",yaxt="n",ann=FALSE,xlim=c(0,100),ylim=c(0,300),pch=".")
}
}


-----------------------------------------------
On Wed, 3 Jun 2009, Simon Urbanek wrote:

> Thomas,
>

>From 
> your description I think I know roughly what's going on (Quartz attempts to 
> snap rectangles on pixel boundaries to prevent malignant anti-aliasing 
> effects in image plots and this may somehow interact with pch='.' since 
> Quartz has no way of knowing that those rectangles are supposed to be 
> glyphs), but I cannot reproduce it.
>
> Thanks,
> Simon
>
>
> On Jun 3, 2009, at 4:45 , tsr at stat.washington.edu wrote:
>
>> Full_Name: Thomas Richardson
>> Version: R 2.9.0 GUI 1.28 Tiger build 32-bit (5395)
>> OS: 10.4.11
>> Submission from: (NULL) (216.254.15.72)
>> 
>> 
>> 
>> I have encountered a problem with points in scatterplots disappearing in a
>> quartz window when it is re-sized (to make it larger).
>> 
>> I am constructing an 8x12 matrix of scatterplots each containing approx 600
>> points.
>> In order to get them in the window I remove the axes etc.,
>> 
>> quartz()
>> par(mfrow=c(8,12), mar=c(0,0,0,0), oma=c(0,0,0,0))
>> for(i in 1:8){ # Row counter
>> for(j in 1:12){ # Col counter 
>> plot(rna$red[(rna$row==levels(rna$row[i])&(rna$col==j)],
>>    rna$tof[(rna$row==levels(rna$row[i])&(rna$col==j)],
>>    xlab="tof",ylab="green",xaxt="n",yaxt="n",
>>    ann=FALSE,xlim=c(0,100),ylim=c(0,300),pch=".")
>> }
>> }
>> 
>> Here is the problem:  how many data points actually appear in the quartz 
>> window
>> on my screen is highly sensitive to the width and height specified. If I 
>> specify
>> a different width and height for the quartz window e.g.
>> quartz(width=8,height=8), OR if I resize the window with the cursor then 
>> points
>> disappear in certain (x-axis) ranges across all the plots in some columns. 
>> These
>> bands in which points disappear are the same for all plots in a given 
>> column,
>> and can be very wide - making a lot of points disappear.
>> 
>> (The visual effect is to make it look as if there are clearly defined 
>> vertical
>> white lines going across the scatterplots - though the black lines 
>> enclosing
>> each plot are not broken).
>> 
>> The problem seems to disappear with other plotting symbols e.g. pch="+" 
>> (but
>> then I end up with crowded plots). So I guess it might be related to the
>> "special treatment" of "." described on help(points) ??
>> ---
>> Value pch="." (equivalently pch = 46) is handled specially. It is a 
>> rectangle of
>> side 0.01 inch (scaled by cex).
>> ---
>> 
>> I find this behaviour unnerving: the (resized) plots made it look as if 
>> there
>> was a lot of structure in the data, but on closer inspection it turned out 
>> to be
>> entirely a consequence of the quartz device and plot function!
>> 
>> I can't imagine that this behaviour is intended - even if it were intended 
>> to
>> suppress points (like some axis labels) - it seems strange that enlarging 
>> the
>> window makes points disappear. (I also tried setting dpi=72 in quartz(), 
>> but
>> this did not fix the problem).
>> 
>> Thanks in advance.
>> 
>> Thomas
>> 
>> ------------------------------------------------------
>> sessionInfo()
>> R version 2.9.0 (2009-04-17)
>> i386-apple-darwin8.11.1
>> 
>> locale:
>> en_US.UTF-8/en_US.UTF-8/C/C/en_US.UTF-8/en_US.UTF-8
>> 
>> attached base packages:
>> [1] stats     graphics  grDevices utils     datasets  methods   base
>> 
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>> 
>> 
>


From thomasr at u.washington.edu  Wed Jun  3 21:00:35 2009
From: thomasr at u.washington.edu (Thomas Richardson)
Date: Wed, 3 Jun 2009 12:00:35 -0700 (PDT)
Subject: [Rd] Problems with plot and Quartz device / What is alpha?
In-Reply-To: <29342260-D4C4-481A-86D9-E64CAF127F4F@r-project.org>
References: <20090603084513.662BD283200F@mail.pubhealth.ku.dk>
	<29342260-D4C4-481A-86D9-E64CAF127F4F@r-project.org>
Message-ID: <alpine.LRH.2.01.0906031154190.25094@homer23.u.washington.edu>

PS Please forgive my ignorance, but when you say:


> BTW: you may want to use something like pch=19, cex=0.1 (and maybe add some 
> alpha to get a quick density estimation).

I don't know what alpha refers to here.

Thanks again.

Best wishes,

Thomas

>
> Cheers,
> S
>
>
>> So I guess it might be related to the
>> "special treatment" of "." described on help(points) ??
>> ---
>> Value pch="." (equivalently pch = 46) is handled specially. It is a 
>> rectangle of
>> side 0.01 inch (scaled by cex).
>> ---
>> 
>> I find this behaviour unnerving: the (resized) plots made it look as if 
>> there
>> was a lot of structure in the data, but on closer inspection it turned out 
>> to be
>> entirely a consequence of the quartz device and plot function!
>> 
>> I can't imagine that this behaviour is intended - even if it were intended 
>> to
>> suppress points (like some axis labels) - it seems strange that enlarging 
>> the
>> window makes points disappear. (I also tried setting dpi=72 in quartz(), 
>> but
>> this did not fix the problem).
>> 
>> Thanks in advance.
>> 
>> Thomas
>> 
>> ------------------------------------------------------
>> sessionInfo()
>> R version 2.9.0 (2009-04-17)
>> i386-apple-darwin8.11.1
>> 
>> locale:
>> en_US.UTF-8/en_US.UTF-8/C/C/en_US.UTF-8/en_US.UTF-8
>> 
>> attached base packages:
>> [1] stats     graphics  grDevices utils     datasets  methods   base
>> 
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>> 
>> 
>


From simon.urbanek at r-project.org  Wed Jun  3 22:25:51 2009
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Wed, 3 Jun 2009 16:25:51 -0400
Subject: [Rd] Problems with plot and Quartz device (PR#13744)
In-Reply-To: <alpine.LRH.2.01.0906031136210.25094@homer23.u.washington.edu>
References: <20090603084513.662BD283200F@mail.pubhealth.ku.dk>
	<F2B79447-C9CE-42AD-B763-2AC4CD22E41D@r-project.org>
	<alpine.LRH.2.01.0906031136210.25094@homer23.u.washington.edu>
Message-ID: <3086DC44-B734-4DF1-9ACD-2E96E4D08F38@r-project.org>

Thanks, Thomas.

It is indeed a very interesting phenomenon. Apparently the discrete  
structure in the data interacts with the way the data are plotted on a  
very small scale. I have committed a work-around - it forces  
rectangles to retain at least their original width/height when  
snapping to pixels causes it to shrink to 0 (i.e. the width or height  
is < 0.5 pixels).

Thanks,
Simon


On Jun 3, 2009, at 14:54 , Thomas Richardson wrote:

> Dear Simon,
>
> Thank you very much for the very rapid response!
>
>> rna is not defined in R, can you, please, supply a reproducible  
>> example?
>
> Apologies for including code that could not be run directly.
> (I had assumed simulating "similar" data would give the same  
> behaviour, but having done more experiments, I see that it is not so  
> simple to get this - which makes me very curious about what is  
> really going on!)
>
> I have put the data that I used on the web. I enclose R code below.  
> At least on my machine a simple visual comparison of the first  
> column of plots in these two quartz windows shows that half of the  
> points in these plots, those on the left side of each panel, have  
> disappeared in the larger quartz window!
>
> Thanks again.
>
> Best wishes,
>
> Thomas
>
> -----------------------------------------------
>
> # (Hopefully) reproducible code for disappearing pch="." points  
> phenomenon
>
> mydata <- read.table("http://www.stat.washington.edu/tsr/ 
> streaking.dat")
>
> quartz()
> par(mfrow=c(8,12), mar=c(0,0,0,0), oma=c(0,0,0,0))
> for(i in 1:8){ # Row counter
> for(j in 1:12){ # Col counter
> 	xtmp <- mydata[,1]
> 	x <- xtmp[(mydata[,3]==i)&(mydata[,4]==j)]
> 	ytmp <- mydata[,2]
> 	y <- ytmp[(mydata[,3]==i)&(mydata[,4]==j)]
> plot 
> (x,y,xaxt="n",yaxt="n",ann=FALSE,xlim=c(0,100),ylim=c(0,300),pch=".")
> }
> }
>
> quartz(width=12,height=8)
> par(mfrow=c(8,12), mar=c(0,0,0,0), oma=c(0,0,0,0))
> for(i in 1:8){ # Row counter
> for(j in 1:12){ # Col counter
> 	xtmp <- mydata[,1]
> 	x <- xtmp[(mydata[,3]==i)&(mydata[,4]==j)]
> 	ytmp <- mydata[,2]
> 	y <- ytmp[(mydata[,3]==i)&(mydata[,4]==j)]
> plot 
> (x,y,xaxt="n",yaxt="n",ann=FALSE,xlim=c(0,100),ylim=c(0,300),pch=".")
> }
> }
>
>
> -----------------------------------------------
> On Wed, 3 Jun 2009, Simon Urbanek wrote:
>
>> Thomas,
>>
>
>> From your description I think I know roughly what's going on  
>> (Quartz attempts to snap rectangles on pixel boundaries to prevent  
>> malignant anti-aliasing effects in image plots and this may somehow  
>> interact with pch='.' since Quartz has no way of knowing that those  
>> rectangles are supposed to be glyphs), but I cannot reproduce it.
>>
>> Thanks,
>> Simon
>>
>>
>> On Jun 3, 2009, at 4:45 , tsr at stat.washington.edu wrote:
>>
>>> Full_Name: Thomas Richardson
>>> Version: R 2.9.0 GUI 1.28 Tiger build 32-bit (5395)
>>> OS: 10.4.11
>>> Submission from: (NULL) (216.254.15.72)
>>> I have encountered a problem with points in scatterplots  
>>> disappearing in a
>>> quartz window when it is re-sized (to make it larger).
>>> I am constructing an 8x12 matrix of scatterplots each containing  
>>> approx 600
>>> points.
>>> In order to get them in the window I remove the axes etc.,
>>> quartz()
>>> par(mfrow=c(8,12), mar=c(0,0,0,0), oma=c(0,0,0,0))
>>> for(i in 1:8){ # Row counter
>>> for(j in 1:12){ # Col counter plot(rna$red[(rna$row==levels(rna 
>>> $row[i])&(rna$col==j)],
>>>   rna$tof[(rna$row==levels(rna$row[i])&(rna$col==j)],
>>>   xlab="tof",ylab="green",xaxt="n",yaxt="n",
>>>   ann=FALSE,xlim=c(0,100),ylim=c(0,300),pch=".")
>>> }
>>> }
>>> Here is the problem:  how many data points actually appear in the  
>>> quartz window
>>> on my screen is highly sensitive to the width and height  
>>> specified. If I specify
>>> a different width and height for the quartz window e.g.
>>> quartz(width=8,height=8), OR if I resize the window with the  
>>> cursor then points
>>> disappear in certain (x-axis) ranges across all the plots in some  
>>> columns. These
>>> bands in which points disappear are the same for all plots in a  
>>> given column,
>>> and can be very wide - making a lot of points disappear.
>>> (The visual effect is to make it look as if there are clearly  
>>> defined vertical
>>> white lines going across the scatterplots - though the black lines  
>>> enclosing
>>> each plot are not broken).
>>> The problem seems to disappear with other plotting symbols e.g.  
>>> pch="+" (but
>>> then I end up with crowded plots). So I guess it might be related  
>>> to the
>>> "special treatment" of "." described on help(points) ??
>>> ---
>>> Value pch="." (equivalently pch = 46) is handled specially. It is  
>>> a rectangle of
>>> side 0.01 inch (scaled by cex).
>>> ---
>>> I find this behaviour unnerving: the (resized) plots made it look  
>>> as if there
>>> was a lot of structure in the data, but on closer inspection it  
>>> turned out to be
>>> entirely a consequence of the quartz device and plot function!
>>> I can't imagine that this behaviour is intended - even if it were  
>>> intended to
>>> suppress points (like some axis labels) - it seems strange that  
>>> enlarging the
>>> window makes points disappear. (I also tried setting dpi=72 in  
>>> quartz(), but
>>> this did not fix the problem).
>>> Thanks in advance.
>>> Thomas
>>> ------------------------------------------------------
>>> sessionInfo()
>>> R version 2.9.0 (2009-04-17)
>>> i386-apple-darwin8.11.1
>>> locale:
>>> en_US.UTF-8/en_US.UTF-8/C/C/en_US.UTF-8/en_US.UTF-8
>>> attached base packages:
>>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
>


From wdunlap at tibco.com  Wed Jun  3 22:39:01 2009
From: wdunlap at tibco.com (William Dunlap)
Date: Wed, 3 Jun 2009 13:39:01 -0700
Subject: [Rd] reference counting bug related to break and next in loops
In-Reply-To: <4A263CFA.70403@idi.ntnu.no>
References: <77EB52C6DD32BA4D87471DCD70C8D7000147B96C@NA-PA-VBE03.na.tibco.com><4A2638BD.6090503@idi.ntnu.no>
	<4A263CFA.70403@idi.ntnu.no>
Message-ID: <77EB52C6DD32BA4D87471DCD70C8D7000147BB83@NA-PA-VBE03.na.tibco.com>

help('while') says:
  Usage:
     for(var in seq) expr
     while(cond) expr
     repeat expr
     break
     next
  Value:
     'for', 'while' and 'repeat' return the value of the last
     expression evaluated (or 'NULL' if none was), invisibly. 'for'
     sets 'var' to the last used element of 'seq', or to 'NULL' if it
     was of length zero.

     'break' and 'next' have value 'NULL', although it would be strange
     to look for a return value.

Does the 'the last expression evaluated' mean (a) the value from
evaluating 'expr' the last time it was completely evaluated or
does it mean (b) the value of the last element of a {} expr that was
evaluated?  R currently follow interpretation (a), modulo reference
counting bugs.   My suggestion is to move to interpretation (b),
so that the fact that break and next return NULL would mean that
a broken-out-of loop would have value NULL.  (Personally, I'm happy
with S+'s return value for all loops being NULL in all cases, but
that might break existing R code.)

Of course, if the reference counting bug can be fixed without degrading
performance in ordinary situations (does anyone look at the return
value of a loop, particularly one that is broken out of?), then I'm
happy
retaining the current semantics.


Bill Dunlap
TIBCO Software Inc - Spotfire Division
wdunlap tibco.com  

> -----Original Message-----
> From: r-devel-bounces at r-project.org 
> [mailto:r-devel-bounces at r-project.org] On Behalf Of Wacek Kusnierczyk
> Sent: Wednesday, June 03, 2009 2:06 AM
> To: r-devel at r-project.org
> Subject: Re: [Rd] reference counting bug related to break and 
> next in loops
> 
> Wacek Kusnierczyk wrote:
> >
> > a simplified example may help to get a clear picture:
> >
> >     i = 1; y = 1:3;
> >     (while(TRUE) {
> >        y[i] = 0
> >        if (i == 2) break
> >        i = i + 1
> >        y })
> >     # 0 0 3
> >
> >     i = 1; y = 1:3;
> >     (while(TRUE) {
> >        y[i] = 0
> >        if (i == 2) break
> >        i = i + 1
> >        y + 0 })
> >     # 0 2 3
> >
> > the test on i is done after the assignment to y[i].  when the loop
> > breaks, y is 0 0 3, and one might expect this to be the 
> final result. 
> > it looks like the result is the value of y from the 
> previous iteration,
> > and it does not seem particularly intuitive to me.  (using 
> common sense,
> > i mean;  an informed expert on the copy-when-scared 
> semantics may have a
> > different opinion, but why should a casual user ever 
> suspect such magic.) 
> >
> > anyway, i'd rather expect NULL to be returned.  for the oracle,
> > ?'while', says:
> >
> > "'for', 'while' and 'repeat' return the value of the last expression
> > evaluated (or 'NULL' if none was), invisibly. [...]  'if' 
> returns the
> > value of the expression evaluated, or 'NULL' if none was. 
> [...]  'break'
> > and 'next' have value 'NULL', although it would be strange 
> to look for a
> > return value."
> >
> > when i is 2, i == 2 is TRUE.  hence, if (i == 2) break evaluates to
> > break.  break evaluates to NULL, breaks the loop, and the 
> return value
> > should be NULL.  while it is, following the docs, strange 
> to have q =
> > while(...) ... in the code, the result above is not 
> compliant with the
> > docs at all -- seems like a plain bug.  there is no reason 
> for while to
> > return the value of y, be it 0 0 3 or 0 2 3.
> >   
> 
> somewhat surprising to learn,
> 
>     i = 1
>     y = 1:3
>     (while (TRUE) {
>        y[i] = 0
>        if (i == 2) { 2*y; break }
>        i = i + 1
>        y })
>     # 0 0 3
> 
> where clearly the last expression evaluated (before the 
> break, that is)
> is 2*y -- or?
> 
> 
> vQ
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 


From maechler at stat.math.ethz.ch  Wed Jun  3 22:54:26 2009
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Wed, 3 Jun 2009 22:54:26 +0200
Subject: [Rd] Print bug for matrix(list(NA_complex_, ...))
In-Reply-To: <77EB52C6DD32BA4D87471DCD70C8D7000147BAC4@NA-PA-VBE03.na.tibco.com>
References: <8b356f880906022219n77891154k583fecf59e96ecaf@mail.gmail.com>
	<4A2637AD.4050801@idi.ntnu.no>
	<18982.17460.628994.128590@lynne.math.ethz.ch>
	<77EB52C6DD32BA4D87471DCD70C8D7000147BA06@NA-PA-VBE03.na.tibco.com>
	<77EB52C6DD32BA4D87471DCD70C8D7000147BAC4@NA-PA-VBE03.na.tibco.com>
Message-ID: <18982.58114.237538.355489@cmath-5.math.ethz.ch>

>>>>> William Dunlap <wdunlap at tibco.com>
>>>>>     on Wed, 3 Jun 2009 11:49:00 -0700 writes:

    > Changing the uninitialized 'w' to 'R_print.na_width' for
    > the complex NA code fixes up the valgrind complaints on
    > Linux and the bad behavior on Windows:

[.........]

Thanks a lot, Bill, both for the diagnosis and the fix!

I'll commit (a slight variation of) it to R-devel and R-patched.
Martin


From spencer.graves at prodsyse.com  Wed Jun  3 23:37:33 2009
From: spencer.graves at prodsyse.com (spencerg)
Date: Wed, 03 Jun 2009 14:37:33 -0700
Subject: [Rd] proposed changes to RSiteSearch
In-Reply-To: <39B6DDB9048D0F4DAD42CB26AAFF0AFA073C4844@usctmx1106.merck.com>
References: <39B6DDB9048D0F4DAD42CB26AAFF0AFA07381973@usctmx1106.merck.com>
	<20090507141812.GB25422@psych.upenn.edu>
	<4A031A22.7080702@stats.uwo.ca>
	<39B6DDB9048D0F4DAD42CB26AAFF0AFA073C46FD@usctmx1106.merck.com>
	<20090507180930.GA1619@psych.upenn.edu>
	<39B6DDB9048D0F4DAD42CB26AAFF0AFA073C4758@usctmx1106.merck.com>
	<4A032E6F.8010001@dbmail.com>
	<20090507192632.GA4723@psych.upenn.edu>
	<39B6DDB9048D0F4DAD42CB26AAFF0AFA073C4844@usctmx1106.merck.com>
Message-ID: <4A26ED1D.1020407@prodsyse.com>

Hello All: 


      What do you think of adding a function "RSiteSeach" to the package 
of that name, masking the "RSiteSearch" function in "utils", trapping 
any call RSiteSearch('searchstring', 'function') to the current 
RSiteSearch.function and passing all others to "utils:::RSiteSearch"?  
This was suggested by a referee to a manuscript on this new capability 
submitted to "R Journal".  The current version of this manuscript is 
available via "system.file('doc', 'RSiteSearch.pdf', 
package='RSiteSearch')" if you have the "RSiteSearch" package installed. 


      Thanks,
      Best Wishes,
      Spencer


Liaw, Andy wrote:
>  I agree!  Recall, though, I had added the RSiteSearch() functionality
> to the Rgui under Windows (Help / search.r-project.org...), so if
> RSiteSearch() is taken out, this need to go, too.
>
> Best,
> Andy
>
> From: Jonathan Baron
>   
>> There is something to be said for taking all of these functions,
>> including the original RSiteSearch, out of utils and putting them in
>> the new RSiteSearch package.  These are the sorts of things that will
>> get revised frequently, and this way (I think) we won't have to bother
>> whoever takes care of utils, which is part of the regular R
>> distribution.
>>
>> I'm adding Spencer Graves to the cc list.  Maybe he is interested in
>> doing this.
>>
>> Jon
>>
>> On 05/07/09 20:54, Romain Francois wrote:
>>     
>>> We could have a few functions similar to RSiteSearch or 
>>>       
>> gmaneSearch I 
>>     
>>> just posted and then cook a summary html page with R ...
>>>
>>> Here is a function that grabs relevant groups from gmane:
>>>
>>> gmaneGroups <- function( prefix = "gmane.comp.lang.r." ){
>>>     url <- URLencode( sprintf( 
>>> "http://dir.gmane.org/index.php?prefix=%s", prefix) )
>>>     txt <- grep( '^<tr.*<td align=right.*<a', readLines( 
>>>       
>> url ), value = 
>>     
>>> TRUE )
>>>    
>>>     rx <- '^.*?<a href="(.*?)">(.*?)</a>.*<td>(.*?)</td>.*$'
>>>     out <- data.frame(
>>>         url = gsub( rx, "\\1", txt ),
>>>         group = gsub( rx, "\\2", txt ),
>>>         description = gsub( rx, "\\3", txt ),
>>>         stringsAsFactors = FALSE
>>>         )
>>>     out$group <- sub( "...", ".*", out$group, fixed = TRUE )
>>>     out
>>> }
>>>
>>> I'll clean this up and write a man page if there is 
>>>       
>> interest in adding 
>>     
>>> this to R, but this might be more appropriate in a package, 
>>>       
>> for example: 
>>     
>>> http://r-forge.r-project.org/projects/rsitesearch/
>>>
>>> Romain
>>>
>>> Liaw, Andy wrote:
>>>       
>>>> From: Jonathan Baron
>>>>   
>>>>         
>>>>> On 05/07/09 13:48, Liaw, Andy wrote:
>>>>>     
>>>>>           
>>>>>> From: Duncan Murdoch 
>>>>>>       
>>>>>>             
>>>>>>> I'll incorporate the changes if you like
>>>>>>>         
>>>>>>>               
>>>>> Yes.  Please do.  I understand that it won't take effect 
>>>>>           
>> for a while.
>>     
>>>>> When it does, I'll change my site.
>>>>>
>>>>>   What do you think 
>>>>>     
>>>>>           
>>>>>>> of the idea 
>>>>>>> of adding a gmane (or other archive) search to your results 
>>>>>>> page?  Then 
>>>>>>> if someone doesn't like what the man pages show, you can 
>>>>>>>         
>>>>>>>               
>>>>> send them 
>>>>>     
>>>>>           
>>>>>>> somewhere else, rather than leaving them to find out the 
>>>>>>> other resources 
>>>>>>> themselves.
>>>>>>>
>>>>>>> gmane has sample code for this on their search page 
>>>>>>> search.gmane.org, so 
>>>>>>> it looks reasonably easy.  I'd suggest following their 
>>>>>>>         
>>>>>>>               
>>>>> last example, 
>>>>>     
>>>>>           
>>>>>>> with a drop-down box to select mailing lists, with 
>>>>>>> comp.lang.r.* as an 
>>>>>>> option for "all lists".
>>>>>>>
>>>>>>> Duncan Murdoch
>>>>>>>         
>>>>>>>               
>>>>> Good idea.  I will do this.  But there are also two 
>>>>>           
>> other good search
>>     
>>>>> engines.  Maybe I'll add all three search alternatives.  
>>>>>           
>> But then,
>>     
>>>>> according to Sheena Iyengar, people won't choose any!  Hmm.
>>>>>
>>>>>     
>>>>>           
>>>>>> Actually, I was thinking about a possible RHelpSearch() in 
>>>>>>       
>>>>>>             
>>>>> addition, if
>>>>>     
>>>>>           
>>>>>> Jon is no longer going to include the R-help archive in the 
>>>>>>       
>>>>>>             
>>>>> search.  I
>>>>>     
>>>>>           
>>>>>> used the current RSiteSearch() a lot more for searching 
>>>>>>       
>>>>>>             
>>>>> R-help archive
>>>>>     
>>>>>           
>>>>>> than functions in packages.  Ideas?  comments?
>>>>>>       
>>>>>>             
>>>>> This is OK with me, but I don't want to do it.  I guess it would
>>>>> search gmane.  MarkMail is also pretty good, as is
>>>>> http://tolstoy.newcastle.edu.au/R/ All these are much better than
>>>>> Namazu for searching the R-help list.
>>>>>     
>>>>>           
>>>> Sorry I didn't make it clear:  I meant something like the 
>>>>         
>> gmaneSearcg()
>>     
>>>> that Romain posted, not hitting your site.
>>>>
>>>> Best,
>>>> Andy
>>>>  
>>>>   
>>>>         
>>>>> Jon
>>>>>     
>>>>>           
>>> -- 
>>> Romain Francois
>>> Independent R Consultant
>>> +33(0) 6 28 91 30 30
>>> http://romainfrancois.blog.free.fr
>>>
>>>       
>> -- 
>> Jonathan Baron, Professor of Psychology, University of Pennsylvania
>> Home page: http://www.sas.upenn.edu/~baron
>> Editor: Judgment and Decision Making (http://journal.sjdm.org)
>>
>>     
> Notice:  This e-mail message, together with any attach...{{dropped:15}}


From ggrothendieck at gmail.com  Wed Jun  3 23:48:23 2009
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Wed, 3 Jun 2009 17:48:23 -0400
Subject: [Rd] proposed changes to RSiteSearch
In-Reply-To: <4A26ED1D.1020407@prodsyse.com>
References: <39B6DDB9048D0F4DAD42CB26AAFF0AFA07381973@usctmx1106.merck.com> 
	<20090507141812.GB25422@psych.upenn.edu>
	<4A031A22.7080702@stats.uwo.ca> 
	<39B6DDB9048D0F4DAD42CB26AAFF0AFA073C46FD@usctmx1106.merck.com> 
	<20090507180930.GA1619@psych.upenn.edu>
	<39B6DDB9048D0F4DAD42CB26AAFF0AFA073C4758@usctmx1106.merck.com>
	<4A032E6F.8010001@dbmail.com> <20090507192632.GA4723@psych.upenn.edu> 
	<39B6DDB9048D0F4DAD42CB26AAFF0AFA073C4844@usctmx1106.merck.com> 
	<4A26ED1D.1020407@prodsyse.com>
Message-ID: <971536df0906031448g6679d461w438b2c7c67244eec@mail.gmail.com>

Having RSiteSearch.function be a strict superset of RSiteSearch might
make sense but giving them the same name seems too heavy
handed unless done via OO which seems not applicable here since
R's version is not generic and the two use the same class, "character",
anyways.

On Wed, Jun 3, 2009 at 5:37 PM, spencerg <spencer.graves at prodsyse.com> wrote:
> Hello All:
>
> ? ? What do you think of adding a function "RSiteSeach" to the package of
> that name, masking the "RSiteSearch" function in "utils", trapping any call
> RSiteSearch('searchstring', 'function') to the current RSiteSearch.function
> and passing all others to "utils:::RSiteSearch"? ?This was suggested by a
> referee to a manuscript on this new capability submitted to "R Journal".
> ?The current version of this manuscript is available via "system.file('doc',
> 'RSiteSearch.pdf', package='RSiteSearch')" if you have the "RSiteSearch"
> package installed.
>
> ? ? Thanks,
> ? ? Best Wishes,
> ? ? Spencer
>
>
> Liaw, Andy wrote:
>>
>> ?I agree! ?Recall, though, I had added the RSiteSearch() functionality
>> to the Rgui under Windows (Help / search.r-project.org...), so if
>> RSiteSearch() is taken out, this need to go, too.
>>
>> Best,
>> Andy
>>
>> From: Jonathan Baron
>>
>>>
>>> There is something to be said for taking all of these functions,
>>> including the original RSiteSearch, out of utils and putting them in
>>> the new RSiteSearch package. ?These are the sorts of things that will
>>> get revised frequently, and this way (I think) we won't have to bother
>>> whoever takes care of utils, which is part of the regular R
>>> distribution.
>>>
>>> I'm adding Spencer Graves to the cc list. ?Maybe he is interested in
>>> doing this.
>>>
>>> Jon
>>>
>>> On 05/07/09 20:54, Romain Francois wrote:
>>>
>>>>
>>>> We could have a few functions similar to RSiteSearch or
>>>
>>> gmaneSearch I
>>>>
>>>> just posted and then cook a summary html page with R ...
>>>>
>>>> Here is a function that grabs relevant groups from gmane:
>>>>
>>>> gmaneGroups <- function( prefix = "gmane.comp.lang.r." ){
>>>> ? ?url <- URLencode( sprintf(
>>>> "http://dir.gmane.org/index.php?prefix=%s", prefix) )
>>>> ? ?txt <- grep( '^<tr.*<td align=right.*<a', readLines(
>>>
>>> url ), value =
>>>>
>>>> TRUE )
>>>> ? ? ?rx <- '^.*?<a href="(.*?)">(.*?)</a>.*<td>(.*?)</td>.*$'
>>>> ? ?out <- data.frame(
>>>> ? ? ? ?url = gsub( rx, "\\1", txt ),
>>>> ? ? ? ?group = gsub( rx, "\\2", txt ),
>>>> ? ? ? ?description = gsub( rx, "\\3", txt ),
>>>> ? ? ? ?stringsAsFactors = FALSE
>>>> ? ? ? ?)
>>>> ? ?out$group <- sub( "...", ".*", out$group, fixed = TRUE )
>>>> ? ?out
>>>> }
>>>>
>>>> I'll clean this up and write a man page if there is
>>>
>>> interest in adding
>>>>
>>>> this to R, but this might be more appropriate in a package,
>>>
>>> for example:
>>>>
>>>> http://r-forge.r-project.org/projects/rsitesearch/
>>>>
>>>> Romain
>>>>
>>>> Liaw, Andy wrote:
>>>>
>>>>>
>>>>> From: Jonathan Baron
>>>>>
>>>>>>
>>>>>> On 05/07/09 13:48, Liaw, Andy wrote:
>>>>>>
>>>>>>>
>>>>>>> From: Duncan Murdoch
>>>>>>>>
>>>>>>>> I'll incorporate the changes if you like
>>>>>>>>
>>>>>>
>>>>>> Yes. ?Please do. ?I understand that it won't take effect
>>>
>>> for a while.
>>>
>>>>>>
>>>>>> When it does, I'll change my site.
>>>>>>
>>>>>> ?What do you think
>>>>>>>>
>>>>>>>> of the idea of adding a gmane (or other archive) search to your
>>>>>>>> results page? ?Then if someone doesn't like what the man pages show, you can
>>>>>>>>
>>>>>>
>>>>>> send them
>>>>>>>>
>>>>>>>> somewhere else, rather than leaving them to find out the other
>>>>>>>> resources themselves.
>>>>>>>>
>>>>>>>> gmane has sample code for this on their search page
>>>>>>>> search.gmane.org, so it looks reasonably easy. ?I'd suggest following their
>>>>>>>>
>>>>>>
>>>>>> last example,
>>>>>>>>
>>>>>>>> with a drop-down box to select mailing lists, with comp.lang.r.* as
>>>>>>>> an option for "all lists".
>>>>>>>>
>>>>>>>> Duncan Murdoch
>>>>>>>>
>>>>>>
>>>>>> Good idea. ?I will do this. ?But there are also two
>>>
>>> other good search
>>>
>>>>>>
>>>>>> engines. ?Maybe I'll add all three search alternatives.
>>>
>>> But then,
>>>
>>>>>>
>>>>>> according to Sheena Iyengar, people won't choose any! ?Hmm.
>>>>>>
>>>>>>
>>>>>>>
>>>>>>> Actually, I was thinking about a possible RHelpSearch() in
>>>>>>>
>>>>>>
>>>>>> addition, if
>>>>>>
>>>>>>>
>>>>>>> Jon is no longer going to include the R-help archive in the
>>>>>>>
>>>>>>
>>>>>> search. ?I
>>>>>>
>>>>>>>
>>>>>>> used the current RSiteSearch() a lot more for searching
>>>>>>>
>>>>>>
>>>>>> R-help archive
>>>>>>
>>>>>>>
>>>>>>> than functions in packages. ?Ideas? ?comments?
>>>>>>>
>>>>>>
>>>>>> This is OK with me, but I don't want to do it. ?I guess it would
>>>>>> search gmane. ?MarkMail is also pretty good, as is
>>>>>> http://tolstoy.newcastle.edu.au/R/ All these are much better than
>>>>>> Namazu for searching the R-help list.
>>>>>>
>>>>>
>>>>> Sorry I didn't make it clear: ?I meant something like the
>>>
>>> gmaneSearcg()
>>>
>>>>>
>>>>> that Romain posted, not hitting your site.
>>>>>
>>>>> Best,
>>>>> Andy
>>>>>
>>>>>>
>>>>>> Jon
>>>>>>
>>>>
>>>> --
>>>> Romain Francois
>>>> Independent R Consultant
>>>> +33(0) 6 28 91 30 30
>>>> http://romainfrancois.blog.free.fr
>>>>
>>>>
>>>
>>> --
>>> Jonathan Baron, Professor of Psychology, University of Pennsylvania
>>> Home page: http://www.sas.upenn.edu/~baron
>>> Editor: Judgment and Decision Making (http://journal.sjdm.org)
>>>
>>>
>>
>> Notice: ?This e-mail message, together with any attach...{{dropped:15}}
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From pauljohn32 at gmail.com  Wed Jun  3 23:52:07 2009
From: pauljohn32 at gmail.com (Paul Johnson)
Date: Wed, 3 Jun 2009 16:52:07 -0500
Subject: [Rd] Would like to add this to example for plotmath. Can you
	help?
In-Reply-To: <4A26CFB1.90605@free.fr>
References: <13e802630906031142p2947d5b0q9d4fffebe39f5f39@mail.gmail.com>
	<4A26CFB1.90605@free.fr>
Message-ID: <13e802630906031452p178cc65o2c8b26dbd1bee4c0@mail.gmail.com>

2009/6/3 Romain Fran?ois <francoisromain at free.fr>:
> Hi,
>
> Would you like this to go to the graph gallery ?
> http://addictedtor.free.fr/graphiques/
>

I would be honored to have a graph in your fine display.  Do you want
me to submit it formally by emailing you as described here:
http://wiki.r-project.org/rwiki/doku.php?id=graph_gallery:graph_gallery

I'm still campaigning to add this to ?plotmath because it is a tricky
problem to combine several variable values and plotmath into a single
expression.

Consider the graph gallery 2d normal model

http://addictedtor.free.fr/graphiques/RGraphGallery.php?graph=42

When I saw the subtitle, I thought "Oh, they found a good fix".  But no!

The values are "hardcoded".

mtext(expression(list(mu[1]==0,mu[2]==0,sigma[11]==10,sigma[22]==10,sigma[12]==15,rho==0.5)),
side=3)

There should be substitute or bquote there to get the values of the
mu's and sigma's that are defined above.

I think I will register on your wiki and post a fix on that one, while
I'm at it.

> Romain
>
> Paul Johnson wrote:
>>
>> Greetings:
>>
>> I would like comments on this example and after fixing it up, I need
>> help from someone who has access to insert this in R's help page for
>> plotmath.
>>
>> I uploaded a drawing
>> http://pj.freefaculty.org/R/Normal-2009.pdf
>>
>> that is created by the following code
>>
>> http://pj.freefaculty.org/R/Normal1_2009_plotmathExample.R
>>
>> This will be a good addition to the plotmath help page/example.
>>
>> Here's why:
>>
>> plotmath can be somewhat challenging. ? A few more concrete examples
>> of ways in which users can combine values from R programs with
>> plotmath expressions will be helpful to new users. ?In particular,
>> combining several values from a program into a single expression is a
>> difficult task that is not currently exemplified. ?I believe this is
>> an instructive example because it combines the use of lines, arrows,
>> text, and polygons.
>>
>> Here's the code:
>>
>> ###Set mu and sigma at your pleasure:
>> mu <- 10.03
>> sigma <- 12.5786786
>>
>> myx <- seq( mu - 3.5*sigma, ?mu+ 3.5*sigma, length.out=500)
>>
>> myDensity <- dnorm(myx,mean=mu,sd=sigma)
>>
>>
>> # It is challenging to combine plotmath with values of mu and sigma in
>> one expression.
>> # Either bquote or substitute can be used. ?First use bquote:
>>
>> myTitle1 <- bquote (paste("x ~ Normal(", mu== .(round(mu,2)), ',',
>> sigma== .(round(sigma,2)),")") )
>>
>> ### Using substitute:
>> ### myTitle1 <- ?substitute( "x ~ Normal" ~~ group( "(", list(mu==mu1,
>> sigma^2==sigma2)#, ")") , ?list(mu1=round(mu,2),
>> sigma2=round(sigma^2,2)))
>>
>> ### Or combine the two:
>> ### t1 <- substitute ( mu == a , ?list (a = mu))
>> ### t2 <- substitute ( sigma == a, list(a = round(sigma,2)))
>> ### myTitle1 <- bquote(paste("x ~ Normal(", .(t1),",", .(t2),")" ) )
>>
>>
>> ## To save the plot in a file, change FALSE to TRUE
>> saveplot <- FALSE
>>
>> if (saveplot == TRUE){
>> ?pdf(file="Normal-2009.pdf", height=6.5, width=6.5, onefile=F,
>> paper="special", pointsize=10)
>>
>> }else {
>> ?dev.new(height=6.5, width=6.5,pointsize=9)
>> }
>> ### xpd needed to allow writing outside strict box of graph
>> par(xpd=TRUE, ps=10)
>>
>> plot(myx, myDensity, type="l", xlab="x", ylab="Probability Density ",
>> main=myTitle1, axes=FALSE)
>> axis(2, pos= mu - 3.6*sigma)
>> axis(1, pos=0)
>> lines(c(myx[1],myx[length(myx)]),c(0,0)) ### closes off axes
>>
>> # bquote creates an expression that text plotters can use
>> t1 <- ?bquote( mu== .(mu))
>>
>> # Find a value of myx that is "very close to" mu
>> centerX <- max(which (myx <= mu))
>> # plot light vertical line under peak of density
>> lines( c(mu, mu), c(0, myDensity[centerX]), lty= 14, lwd=.2)
>>
>> # label the mean in the bottom margin
>> mtext(bquote( mu == .(mu)), 1, at=mu, line=-1)
>>
>> ### find position 20% "up" vertically, to use for arrow coordinate
>> ss = 0.2 * max(myDensity)
>> # Insert interval to represent width of one sigma
>> arrows( x0=mu, y0= ss, x1=mu+sigma, y1=ss, code=3, angle=90, length=0.1)
>>
>> ### Write the value of sigma above that interval
>> t2 <- ?bquote( sigma== .(round(sigma,2)))
>> text( mu+0.5*sigma, 1.15*ss, t2)
>>
>> ### Create a formula for the Normal
>> normalFormula <- expression (f(x) == frac (1, sigma* sqrt(2*pi)) *
>> e^{~~ - ~~ frac(1,2)~~ bgroup("(", frac(x-mu,sigma),")")^2})
>> # Draw the Normal formula
>> text ( mu + 0.5*sigma, max(myDensity)- 0.10 * max(myDensity),
>> normalFormula, pos=4)
>>
>> ### Theory says we should have 2.5% of the area to the left of: -1.96 *
>> sigma.
>> ### Find the X coordinate of that "critical value"
>> criticalValue <- mu -1.96 * sigma
>> ### Then grab all myx values that are "to the left" of that critical
>> value.
>> specialX <- ?myx[myx <= criticalValue]
>>
>> ### mark the critical value in the graph
>> text ( criticalValue, 0 , label= paste(round(criticalValue,2)), pos=1)
>> ### Take sequence parallel to values of myx inside critical region
>> specialY <- myDensity[myx < criticalValue]
>> # ?Polygon makes a nice shaded illustration
>> polygon(c(specialX[1], specialX, specialX[length(specialX )]), c(0,
>> specialY, 0), density=c(-110),col="lightgray" )
>>
>> shadedArea <- round(pnorm(mu - 1.96 * sigma, mean=mu, sd=sigma),4)
>>
>>
>> ### I want to insert annotation about area on left side.
>>
>> al1 <- bquote(Prob(x <= .(round(criticalValue,2))))
>> al2 <- bquote(phantom(0) == F( .(round(criticalValue,2)) ))
>> al3 <- bquote(phantom(0) == .(round(shadedArea,3)))
>>
>> ### Hard to position this text "just right"
>> ### Have tried many ideas, this may be least bad.
>> ### Get center position in shaded area
>> medX <- median(specialX)
>> ### density at that center point:
>> denAtMedX <- myDensity[indexMed <- max(which(specialX < medX))]
>>
>> text(medX, denAtMedX+0.0055, labels=al1)
>> text(medX, denAtMedX+0.004, labels=al2)
>> text(medX, denAtMedX+0.0025, labels=al3)
>>
>> ### point from text toward shaded area
>> arrows( x0=medX, y0=myDensity[indexMed]+0.002 ,x1= mu-2.5 *sigma, y1=
>> 0.40*myDensity[length(specialX)] , ? length=0.1)
>>
>>
>>
>> ss <- 0.1 * max(myDensity)
>> ### Mark interval from mu to mu-1.96*sigma
>> arrows( x0=mu, y0= ss, x1=mu-1.96*sigma, y1=ss, code=3, angle=90,
>> length=0.1)
>> ### Put text above interval
>> text( mu - 2.0*sigma,1.15*ss,
>> bquote(paste(.(round(criticalValue,2)),phantom(1)==mu-1.96 *
>> sigma,sep="")),pos=4 )
>>
>>
>>
>>
>> criticalValue <- mu +1.96 * sigma
>> ### Then grab all myx values that are "to the left" of that critical
>> value.
>> specialX <- ?myx[myx >= criticalValue]
>>
>> ### mark the critical value in the graph
>> text ( criticalValue, 0 , label= paste(round(criticalValue,2)), pos=1)
>> ### Take sequence parallel to values of myx inside critical region
>> specialY <- myDensity[myx > criticalValue]
>> # ?Polygon makes a nice shaded illustration
>> polygon(c(specialX[1], specialX, specialX[length(specialX )]), c(0,
>> specialY, 0), density=c(-110),col="lightgray" )
>>
>> shadedArea <- round(pnorm(mu + 1.96 * sigma, mean=mu, sd=sigma,
>> lower.tail=F),4)
>>
>>
>> ### Insert simpler comment on right side.
>>
>> al2 <- bquote(phantom(0) == 1 - F( .(round(criticalValue,2)) ))
>> al3 <- bquote(phantom(0) == .(round(shadedArea,3)))
>>
>> ### Hard to position this text "just right"
>> ### Have tried many ideas, this may be least bad.
>> ### Get center position in shaded area
>> medX <- median(specialX)
>> ### density at that center point:
>> denAtMedX <- myDensity[indexMed <- max(which(specialX < medX))]
>>
>>
>> text(medX, denAtMedX+0.004, labels=al2)
>> text(medX, denAtMedX+0.0025, labels=al3)
>>
>> ### point from text toward shaded area
>> arrows( x0=medX, y0=myDensity[indexMed]+0.002 ,x1= mu+2.5 *sigma, y1=
>> 0.40*myDensity[length(specialX)] , ? length=0.1)
>>
>>
>>
>> ss <- 0.05 * max(myDensity)
>> ### Mark interval from mu to mu+1.96*sigma
>> arrows( x0=mu, y0= ss, x1=mu+1.96*sigma, y1=ss, code=3, angle=90,
>> length=0.1)
>> ### Put text above interval
>> text( mu + 1.96*sigma,1.15*ss,
>> bquote(paste(.(round(criticalValue,2)),phantom(1)==mu+1.96 *
>> sigma,sep="")),pos=2 )
>>
>>
>> if (saveplot == TRUE) ?dev.off()
>>
>
> --
> Romain Francois
> Independent R Consultant
> +33(0) 6 28 91 30 30
> http://romainfrancois.blog.free.fr
>
>
>
>



-- 
Paul E. Johnson
Professor, Political Science
1541 Lilac Lane, Room 504
University of Kansas


From Waclaw.Marcin.Kusnierczyk at idi.ntnu.no  Thu Jun  4 00:01:36 2009
From: Waclaw.Marcin.Kusnierczyk at idi.ntnu.no (Wacek Kusnierczyk)
Date: Thu, 04 Jun 2009 00:01:36 +0200
Subject: [Rd] reference counting bug related to break and next in loops
In-Reply-To: <77EB52C6DD32BA4D87471DCD70C8D7000147BB83@NA-PA-VBE03.na.tibco.com>
References: <77EB52C6DD32BA4D87471DCD70C8D7000147B96C@NA-PA-VBE03.na.tibco.com><4A2638BD.6090503@idi.ntnu.no>
	<4A263CFA.70403@idi.ntnu.no>
	<77EB52C6DD32BA4D87471DCD70C8D7000147BB83@NA-PA-VBE03.na.tibco.com>
Message-ID: <4A26F2C0.5030107@idi.ntnu.no>

William Dunlap wrote:
> help('while') says:
>   Usage:
>      for(var in seq) expr
>      while(cond) expr
>      repeat expr
>      break
>      next
>   Value:
>      'for', 'while' and 'repeat' return the value of the last
>      expression evaluated (or 'NULL' if none was), invisibly. 'for'
>      sets 'var' to the last used element of 'seq', or to 'NULL' if it
>      was of length zero.
>
>      'break' and 'next' have value 'NULL', although it would be strange
>      to look for a return value.
>
> Does the 'the last expression evaluated' mean (a) the value from
> evaluating 'expr' the last time it was completely evaluated or
> does it mean (b) the value of the last element of a {} expr that was
> evaluated?  

it's interesting (if not "obvious") that

    i = 1;  y = 1:3
    (while (TRUE) {
       y[i] = 0
       if (i==2) break
       i = i +1
       y + 0 })
    # 0 2 3

does not reflect in the final value the modification made to y in the
second, incomplete iteration, and that

    i = 1;  y = 1:3
    (while (TRUE) {
       y[i] = 0
       if (i==2) break
       i = i +1
       y })
    # 0 0 3

does reflect this modification, yet

    i = 1;  y = 1:3
    (while (TRUE) {
       y[i] = 0
       if (i==2) { y = 1:3; break }
       i = i +1
       y })
    # 0 0 3

makes a copy of y on y = 1:3 and returns the previous value.  again,
this surely has a "straightforward" explanation in the copy-when-scared
mechanics, yet, intuitively, the returned value seems completely out of
place.



> R currently follow interpretation (a), modulo reference
> counting bugs.   My suggestion is to move to interpretation (b),
> so that the fact that break and next return NULL would mean that
> a broken-out-of loop would have value NULL.  (Personally, I'm happy
> with S+'s return value for all loops being NULL in all cases, but
> that might break existing R code.)
>   

i'm truly impressed by s+'s superiority over r.

> Of course, if the reference counting bug can be fixed without degrading
> performance in ordinary situations (does anyone look at the return
> value of a loop, particularly one that is broken out of?), then I'm
> happy
> retaining the current semantics.
>
>   

... with the current lousy documentation improved to match the actual
semantics.

vQ


From hb at stat.berkeley.edu  Thu Jun  4 02:07:02 2009
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Wed, 3 Jun 2009 17:07:02 -0700
Subject: [Rd] function(x,
	dim=dim(x)) { str(dim) } => recursive default argument 	reference
Message-ID: <59d7961d0906031707v22dbf065t8d96d927fd7c1d31@mail.gmail.com>

Is the following a bug?

Rterm -vanilla

> foo <- function(x, dim=dim(x)) { str(dim) }
> foo(1:2)
Error in str(dim) :
  promise already under evaluation: recursive default argument
reference or earlier problems?
> foo(x=1:2)
Error in str(dim) :
  promise already under evaluation: recursive default argument
reference or earlier problems?

But, this works:

> foo <- function(x, dim2=dim(x)) { str(dim2) }
> foo(1:2)
 NULL

> foo <- function(x, dim=base::dim(x)) { str(dim) }
> foo(1:2)
 NULL


> sessionInfo()
R version 2.9.0 Patched (2009-05-28 r48680)
i386-pc-mingw32

locale:
LC_COLLATE=English_United States.1252;LC_CTYPE=English_United States.1252;LC_MON
ETARY=English_United States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

/Henrik


From hb at stat.berkeley.edu  Thu Jun  4 03:35:42 2009
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Wed, 3 Jun 2009 18:35:42 -0700
Subject: [Rd] function(x,
	dim=dim(x)) { str(dim) } => recursive default 	argument reference
In-Reply-To: <59d7961d0906031707v22dbf065t8d96d927fd7c1d31@mail.gmail.com>
References: <59d7961d0906031707v22dbf065t8d96d927fd7c1d31@mail.gmail.com>
Message-ID: <59d7961d0906031835t78375743nd184f5e81447e233@mail.gmail.com>

My bad:

http://tolstoy.newcastle.edu.au/R/e2/help/07/09/25387.html

/Henrik

On Wed, Jun 3, 2009 at 5:07 PM, Henrik Bengtsson <hb at stat.berkeley.edu> wrote:
> Is the following a bug?
>
> Rterm -vanilla
>
>> foo <- function(x, dim=dim(x)) { str(dim) }
>> foo(1:2)
> Error in str(dim) :
> ?promise already under evaluation: recursive default argument
> reference or earlier problems?
>> foo(x=1:2)
> Error in str(dim) :
> ?promise already under evaluation: recursive default argument
> reference or earlier problems?
>
> But, this works:
>
>> foo <- function(x, dim2=dim(x)) { str(dim2) }
>> foo(1:2)
> ?NULL
>
>> foo <- function(x, dim=base::dim(x)) { str(dim) }
>> foo(1:2)
> ?NULL
>
>
>> sessionInfo()
> R version 2.9.0 Patched (2009-05-28 r48680)
> i386-pc-mingw32
>
> locale:
> LC_COLLATE=English_United States.1252;LC_CTYPE=English_United States.1252;LC_MON
> ETARY=English_United States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252
>
> attached base packages:
> [1] stats ? ? graphics ?grDevices utils ? ? datasets ?methods ? base
>
> /Henrik
>


From ggrothendieck at gmail.com  Thu Jun  4 07:37:38 2009
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Thu, 4 Jun 2009 01:37:38 -0400
Subject: [Rd] proposed changes to RSiteSearch
In-Reply-To: <4A2752F8.1000502@free.fr>
References: <39B6DDB9048D0F4DAD42CB26AAFF0AFA07381973@usctmx1106.merck.com> 
	<39B6DDB9048D0F4DAD42CB26AAFF0AFA073C46FD@usctmx1106.merck.com> 
	<20090507180930.GA1619@psych.upenn.edu>
	<39B6DDB9048D0F4DAD42CB26AAFF0AFA073C4758@usctmx1106.merck.com>
	<4A032E6F.8010001@dbmail.com> <20090507192632.GA4723@psych.upenn.edu> 
	<39B6DDB9048D0F4DAD42CB26AAFF0AFA073C4844@usctmx1106.merck.com> 
	<4A26ED1D.1020407@prodsyse.com>
	<971536df0906031448g6679d461w438b2c7c67244eec@mail.gmail.com> 
	<4A2752F8.1000502@free.fr>
Message-ID: <971536df0906032237v349469a3p289002f432a8c6b5@mail.gmail.com>

If it were an entry on the Rgui menu on Windows then at
least Windows users could get to it quickly regardless of
the name.

2009/6/4 Romain Fran?ois <francoisromain at free.fr>:
> One other comment was that the function name is a pain to type, which I
> believe is also true for "RSiteSearch". Considering we (I) might add other
> engines, would it make sense to have a more generic name, ... something like
> "web.search", "doc.search", ...
>
>
> Gabor Grothendieck wrote:
>>
>> Having RSiteSearch.function be a strict superset of RSiteSearch might
>> make sense but giving them the same name seems too heavy
>> handed unless done via OO which seems not applicable here since
>> R's version is not generic and the two use the same class, "character",
>> anyways.
>>
>> On Wed, Jun 3, 2009 at 5:37 PM, spencerg <spencer.graves at prodsyse.com>
>> wrote:
>>
>>>
>>> Hello All:
>>>
>>> ? ?What do you think of adding a function "RSiteSeach" to the package of
>>> that name, masking the "RSiteSearch" function in "utils", trapping any
>>> call
>>> RSiteSearch('searchstring', 'function') to the current
>>> RSiteSearch.function
>>> and passing all others to "utils:::RSiteSearch"? ?This was suggested by a
>>> referee to a manuscript on this new capability submitted to "R Journal".
>>> ?The current version of this manuscript is available via
>>> "system.file('doc',
>>> 'RSiteSearch.pdf', package='RSiteSearch')" if you have the "RSiteSearch"
>>> package installed.
>>>
>>> ? ?Thanks,
>>> ? ?Best Wishes,
>>> ? ?Spencer
>>>
>>>
>>> Liaw, Andy wrote:
>>>
>>>>
>>>> ?I agree! ?Recall, though, I had added the RSiteSearch() functionality
>>>> to the Rgui under Windows (Help / search.r-project.org...), so if
>>>> RSiteSearch() is taken out, this need to go, too.
>>>>
>>>> Best,
>>>> Andy
>>>>
>>>> From: Jonathan Baron
>>>>
>>>>
>>>>>
>>>>> There is something to be said for taking all of these functions,
>>>>> including the original RSiteSearch, out of utils and putting them in
>>>>> the new RSiteSearch package. ?These are the sorts of things that will
>>>>> get revised frequently, and this way (I think) we won't have to bother
>>>>> whoever takes care of utils, which is part of the regular R
>>>>> distribution.
>>>>>
>>>>> I'm adding Spencer Graves to the cc list. ?Maybe he is interested in
>>>>> doing this.
>>>>>
>>>>> Jon
>>>>>
>>>>> On 05/07/09 20:54, Romain Francois wrote:
>>>>>
>>>>>
>>>>>>
>>>>>> We could have a few functions similar to RSiteSearch or
>>>>>>
>>>>>
>>>>> gmaneSearch I
>>>>>
>>>>>>
>>>>>> just posted and then cook a summary html page with R ...
>>>>>>
>>>>>> Here is a function that grabs relevant groups from gmane:
>>>>>>
>>>>>> gmaneGroups <- function( prefix = "gmane.comp.lang.r." ){
>>>>>> ? url <- URLencode( sprintf(
>>>>>> "http://dir.gmane.org/index.php?prefix=%s", prefix) )
>>>>>> ? txt <- grep( '^<tr.*<td align=right.*<a', readLines(
>>>>>>
>>>>>
>>>>> url ), value =
>>>>>
>>>>>>
>>>>>> TRUE )
>>>>>> ? ? rx <- '^.*?<a href="(.*?)">(.*?)</a>.*<td>(.*?)</td>.*$'
>>>>>> ? out <- data.frame(
>>>>>> ? ? ? url = gsub( rx, "\\1", txt ),
>>>>>> ? ? ? group = gsub( rx, "\\2", txt ),
>>>>>> ? ? ? description = gsub( rx, "\\3", txt ),
>>>>>> ? ? ? stringsAsFactors = FALSE
>>>>>> ? ? ? )
>>>>>> ? out$group <- sub( "...", ".*", out$group, fixed = TRUE )
>>>>>> ? out
>>>>>> }
>>>>>>
>>>>>> I'll clean this up and write a man page if there is
>>>>>>
>>>>>
>>>>> interest in adding
>>>>>
>>>>>>
>>>>>> this to R, but this might be more appropriate in a package,
>>>>>>
>>>>>
>>>>> for example:
>>>>>
>>>>>>
>>>>>> http://r-forge.r-project.org/projects/rsitesearch/
>>>>>>
>>>>>> Romain
>>>>>>
>>>>>> Liaw, Andy wrote:
>>>>>>
>>>>>>
>>>>>>>
>>>>>>> From: Jonathan Baron
>>>>>>>
>>>>>>>
>>>>>>>>
>>>>>>>> On 05/07/09 13:48, Liaw, Andy wrote:
>>>>>>>>
>>>>>>>>
>>>>>>>>>
>>>>>>>>> From: Duncan Murdoch
>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>> I'll incorporate the changes if you like
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>
>>>>>>>> Yes. ?Please do. ?I understand that it won't take effect
>>>>>>>>
>>>>>
>>>>> for a while.
>>>>>
>>>>>
>>>>>>>>
>>>>>>>> When it does, I'll change my site.
>>>>>>>>
>>>>>>>> ?What do you think
>>>>>>>>
>>>>>>>>>>
>>>>>>>>>> of the idea of adding a gmane (or other archive) search to your
>>>>>>>>>> results page? ?Then if someone doesn't like what the man pages
>>>>>>>>>> show, you can
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>
>>>>>>>> send them
>>>>>>>>
>>>>>>>>>>
>>>>>>>>>> somewhere else, rather than leaving them to find out the other
>>>>>>>>>> resources themselves.
>>>>>>>>>>
>>>>>>>>>> gmane has sample code for this on their search page
>>>>>>>>>> search.gmane.org, so it looks reasonably easy. ?I'd suggest
>>>>>>>>>> following their
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>
>>>>>>>> last example,
>>>>>>>>
>>>>>>>>>>
>>>>>>>>>> with a drop-down box to select mailing lists, with comp.lang.r.*
>>>>>>>>>> as
>>>>>>>>>> an option for "all lists".
>>>>>>>>>>
>>>>>>>>>> Duncan Murdoch
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>
>>>>>>>> Good idea. ?I will do this. ?But there are also two
>>>>>>>>
>>>>>
>>>>> other good search
>>>>>
>>>>>
>>>>>>>>
>>>>>>>> engines. ?Maybe I'll add all three search alternatives.
>>>>>>>>
>>>>>
>>>>> But then,
>>>>>
>>>>>
>>>>>>>>
>>>>>>>> according to Sheena Iyengar, people won't choose any! ?Hmm.
>>>>>>>>
>>>>>>>>
>>>>>>>>
>>>>>>>>>
>>>>>>>>> Actually, I was thinking about a possible RHelpSearch() in
>>>>>>>>>
>>>>>>>>>
>>>>>>>>
>>>>>>>> addition, if
>>>>>>>>
>>>>>>>>
>>>>>>>>>
>>>>>>>>> Jon is no longer going to include the R-help archive in the
>>>>>>>>>
>>>>>>>>>
>>>>>>>>
>>>>>>>> search. ?I
>>>>>>>>
>>>>>>>>
>>>>>>>>>
>>>>>>>>> used the current RSiteSearch() a lot more for searching
>>>>>>>>>
>>>>>>>>>
>>>>>>>>
>>>>>>>> R-help archive
>>>>>>>>
>>>>>>>>
>>>>>>>>>
>>>>>>>>> than functions in packages. ?Ideas? ?comments?
>>>>>>>>>
>>>>>>>>>
>>>>>>>>
>>>>>>>> This is OK with me, but I don't want to do it. ?I guess it would
>>>>>>>> search gmane. ?MarkMail is also pretty good, as is
>>>>>>>> http://tolstoy.newcastle.edu.au/R/ All these are much better than
>>>>>>>> Namazu for searching the R-help list.
>>>>>>>>
>>>>>>>>
>>>>>>>
>>>>>>> Sorry I didn't make it clear: ?I meant something like the
>>>>>>>
>>>>>
>>>>> gmaneSearcg()
>>>>>
>>>>>
>>>>>>>
>>>>>>> that Romain posted, not hitting your site.
>>>>>>>
>>>>>>> Best,
>>>>>>> Andy
>>>>>>>
>>>>>>>
>>>>>>>>
>>>>>>>> Jon
>>>>>>>>
>>>>>>>>
>>>>>>
>>>>>> --
>>>>>> Romain Francois
>>>>>> Independent R Consultant
>>>>>> +33(0) 6 28 91 30 30
>>>>>> http://romainfrancois.blog.free.fr
>>>>>>
>>>>>>
>>>>>>
>>>>>
>>>>> --
>>>>> Jonathan Baron, Professor of Psychology, University of Pennsylvania
>>>>> Home page: http://www.sas.upenn.edu/~baron
>>>>> Editor: Judgment and Decision Making (http://journal.sjdm.org)
>>>>>
>>>>>
>>>>>
>>>>
>>>> Notice: ?This e-mail message, together with any attach...{{dropped:15}}
>>>>
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>>
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
>>
>
>
> --
> Romain Francois
> Independent R Consultant
> +33(0) 6 28 91 30 30
> http://romainfrancois.blog.free.fr
>
>
>
>


From murdoch at stats.uwo.ca  Thu Jun  4 07:58:16 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Wed, 03 Jun 2009 22:58:16 -0700
Subject: [Rd] proposed changes to RSiteSearch
In-Reply-To: <4A26ED1D.1020407@prodsyse.com>
References: <39B6DDB9048D0F4DAD42CB26AAFF0AFA07381973@usctmx1106.merck.com>	<20090507141812.GB25422@psych.upenn.edu>	<4A031A22.7080702@stats.uwo.ca>	<39B6DDB9048D0F4DAD42CB26AAFF0AFA073C46FD@usctmx1106.merck.com>	<20090507180930.GA1619@psych.upenn.edu>	<39B6DDB9048D0F4DAD42CB26AAFF0AFA073C4758@usctmx1106.merck.com>	<4A032E6F.8010001@dbmail.com>	<20090507192632.GA4723@psych.upenn.edu>	<39B6DDB9048D0F4DAD42CB26AAFF0AFA073C4844@usctmx1106.merck.com>
	<4A26ED1D.1020407@prodsyse.com>
Message-ID: <4A276278.3050404@stats.uwo.ca>

spencerg wrote:
> Hello All: 
>
>
>       What do you think of adding a function "RSiteSeach" to the package 
> of that name, masking the "RSiteSearch" function in "utils", trapping 
> any call RSiteSearch('searchstring', 'function') to the current 
> RSiteSearch.function and passing all others to "utils:::RSiteSearch"?  
> This was suggested by a referee to a manuscript on this new capability 
> submitted to "R Journal".  The current version of this manuscript is 
> available via "system.file('doc', 'RSiteSearch.pdf', 
> package='RSiteSearch')" if you have the "RSiteSearch" package installed. 
>   
I suppose this depends on your long term plans for the function and 
package.  If you think it should eventually replace the utils function, 
then it makes sense to use the same name:  users won't get used to a new 
name in the meantime.  But if you think it will diverge from that 
function, then you might as well pick a separate name now.

I disagree with Gabor about this being heavy handed, at least while it 
is the only significant export in the package.  If people don't want it, 
don't attach the package.

Duncan Murdoch
>
>       Thanks,
>       Best Wishes,
>       Spencer
>
>
> Liaw, Andy wrote:
>   
>>  I agree!  Recall, though, I had added the RSiteSearch() functionality
>> to the Rgui under Windows (Help / search.r-project.org...), so if
>> RSiteSearch() is taken out, this need to go, too.
>>
>> Best,
>> Andy
>>
>> From: Jonathan Baron
>>   
>>     
>>> There is something to be said for taking all of these functions,
>>> including the original RSiteSearch, out of utils and putting them in
>>> the new RSiteSearch package.  These are the sorts of things that will
>>> get revised frequently, and this way (I think) we won't have to bother
>>> whoever takes care of utils, which is part of the regular R
>>> distribution.
>>>
>>> I'm adding Spencer Graves to the cc list.  Maybe he is interested in
>>> doing this.
>>>
>>> Jon
>>>
>>> On 05/07/09 20:54, Romain Francois wrote:
>>>     
>>>       
>>>> We could have a few functions similar to RSiteSearch or 
>>>>       
>>>>         
>>> gmaneSearch I 
>>>     
>>>       
>>>> just posted and then cook a summary html page with R ...
>>>>
>>>> Here is a function that grabs relevant groups from gmane:
>>>>
>>>> gmaneGroups <- function( prefix = "gmane.comp.lang.r." ){
>>>>     url <- URLencode( sprintf( 
>>>> "http://dir.gmane.org/index.php?prefix=%s", prefix) )
>>>>     txt <- grep( '^<tr.*<td align=right.*<a', readLines( 
>>>>       
>>>>         
>>> url ), value = 
>>>     
>>>       
>>>> TRUE )
>>>>    
>>>>     rx <- '^.*?<a href="(.*?)">(.*?)</a>.*<td>(.*?)</td>.*$'
>>>>     out <- data.frame(
>>>>         url = gsub( rx, "\\1", txt ),
>>>>         group = gsub( rx, "\\2", txt ),
>>>>         description = gsub( rx, "\\3", txt ),
>>>>         stringsAsFactors = FALSE
>>>>         )
>>>>     out$group <- sub( "...", ".*", out$group, fixed = TRUE )
>>>>     out
>>>> }
>>>>
>>>> I'll clean this up and write a man page if there is 
>>>>       
>>>>         
>>> interest in adding 
>>>     
>>>       
>>>> this to R, but this might be more appropriate in a package, 
>>>>       
>>>>         
>>> for example: 
>>>     
>>>       
>>>> http://r-forge.r-project.org/projects/rsitesearch/
>>>>
>>>> Romain
>>>>
>>>> Liaw, Andy wrote:
>>>>       
>>>>         
>>>>> From: Jonathan Baron
>>>>>   
>>>>>         
>>>>>           
>>>>>> On 05/07/09 13:48, Liaw, Andy wrote:
>>>>>>     
>>>>>>           
>>>>>>             
>>>>>>> From: Duncan Murdoch 
>>>>>>>       
>>>>>>>             
>>>>>>>               
>>>>>>>> I'll incorporate the changes if you like
>>>>>>>>         
>>>>>>>>               
>>>>>>>>                 
>>>>>> Yes.  Please do.  I understand that it won't take effect 
>>>>>>           
>>>>>>             
>>> for a while.
>>>     
>>>       
>>>>>> When it does, I'll change my site.
>>>>>>
>>>>>>   What do you think 
>>>>>>     
>>>>>>           
>>>>>>             
>>>>>>>> of the idea 
>>>>>>>> of adding a gmane (or other archive) search to your results 
>>>>>>>> page?  Then 
>>>>>>>> if someone doesn't like what the man pages show, you can 
>>>>>>>>         
>>>>>>>>               
>>>>>>>>                 
>>>>>> send them 
>>>>>>     
>>>>>>           
>>>>>>             
>>>>>>>> somewhere else, rather than leaving them to find out the 
>>>>>>>> other resources 
>>>>>>>> themselves.
>>>>>>>>
>>>>>>>> gmane has sample code for this on their search page 
>>>>>>>> search.gmane.org, so 
>>>>>>>> it looks reasonably easy.  I'd suggest following their 
>>>>>>>>         
>>>>>>>>               
>>>>>>>>                 
>>>>>> last example, 
>>>>>>     
>>>>>>           
>>>>>>             
>>>>>>>> with a drop-down box to select mailing lists, with 
>>>>>>>> comp.lang.r.* as an 
>>>>>>>> option for "all lists".
>>>>>>>>
>>>>>>>> Duncan Murdoch
>>>>>>>>         
>>>>>>>>               
>>>>>>>>                 
>>>>>> Good idea.  I will do this.  But there are also two 
>>>>>>           
>>>>>>             
>>> other good search
>>>     
>>>       
>>>>>> engines.  Maybe I'll add all three search alternatives.  
>>>>>>           
>>>>>>             
>>> But then,
>>>     
>>>       
>>>>>> according to Sheena Iyengar, people won't choose any!  Hmm.
>>>>>>
>>>>>>     
>>>>>>           
>>>>>>             
>>>>>>> Actually, I was thinking about a possible RHelpSearch() in 
>>>>>>>       
>>>>>>>             
>>>>>>>               
>>>>>> addition, if
>>>>>>     
>>>>>>           
>>>>>>             
>>>>>>> Jon is no longer going to include the R-help archive in the 
>>>>>>>       
>>>>>>>             
>>>>>>>               
>>>>>> search.  I
>>>>>>     
>>>>>>           
>>>>>>             
>>>>>>> used the current RSiteSearch() a lot more for searching 
>>>>>>>       
>>>>>>>             
>>>>>>>               
>>>>>> R-help archive
>>>>>>     
>>>>>>           
>>>>>>             
>>>>>>> than functions in packages.  Ideas?  comments?
>>>>>>>       
>>>>>>>             
>>>>>>>               
>>>>>> This is OK with me, but I don't want to do it.  I guess it would
>>>>>> search gmane.  MarkMail is also pretty good, as is
>>>>>> http://tolstoy.newcastle.edu.au/R/ All these are much better than
>>>>>> Namazu for searching the R-help list.
>>>>>>     
>>>>>>           
>>>>>>             
>>>>> Sorry I didn't make it clear:  I meant something like the 
>>>>>         
>>>>>           
>>> gmaneSearcg()
>>>     
>>>       
>>>>> that Romain posted, not hitting your site.
>>>>>
>>>>> Best,
>>>>> Andy
>>>>>  
>>>>>   
>>>>>         
>>>>>           
>>>>>> Jon
>>>>>>     
>>>>>>           
>>>>>>             
>>>> -- 
>>>> Romain Francois
>>>> Independent R Consultant
>>>> +33(0) 6 28 91 30 30
>>>> http://romainfrancois.blog.free.fr
>>>>
>>>>       
>>>>         
>>> -- 
>>> Jonathan Baron, Professor of Psychology, University of Pennsylvania
>>> Home page: http://www.sas.upenn.edu/~baron
>>> Editor: Judgment and Decision Making (http://journal.sjdm.org)
>>>
>>>     
>>>       
>> Notice:  This e-mail message, together with any attach...{{dropped:15}}
>>     
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From ggrothendieck at gmail.com  Thu Jun  4 13:30:11 2009
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Thu, 4 Jun 2009 07:30:11 -0400
Subject: [Rd] proposed changes to RSiteSearch
In-Reply-To: <4A276278.3050404@stats.uwo.ca>
References: <39B6DDB9048D0F4DAD42CB26AAFF0AFA07381973@usctmx1106.merck.com> 
	<4A031A22.7080702@stats.uwo.ca>
	<39B6DDB9048D0F4DAD42CB26AAFF0AFA073C46FD@usctmx1106.merck.com>
	<20090507180930.GA1619@psych.upenn.edu>
	<39B6DDB9048D0F4DAD42CB26AAFF0AFA073C4758@usctmx1106.merck.com>
	<4A032E6F.8010001@dbmail.com> <20090507192632.GA4723@psych.upenn.edu> 
	<39B6DDB9048D0F4DAD42CB26AAFF0AFA073C4844@usctmx1106.merck.com> 
	<4A26ED1D.1020407@prodsyse.com> <4A276278.3050404@stats.uwo.ca>
Message-ID: <971536df0906040430s14c3f78fy2b1f639dfd3ce209@mail.gmail.com>

On Thu, Jun 4, 2009 at 1:58 AM, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
> spencerg wrote:
>>
>> Hello All:
>>
>> ? ? ?What do you think of adding a function "RSiteSeach" to the package of
>> that name, masking the "RSiteSearch" function in "utils", trapping any call
>> RSiteSearch('searchstring', 'function') to the current RSiteSearch.function
>> and passing all others to "utils:::RSiteSearch"? ?This was suggested by a
>> referee to a manuscript on this new capability submitted to "R Journal".
>> ?The current version of this manuscript is available via "system.file('doc',
>> 'RSiteSearch.pdf', package='RSiteSearch')" if you have the "RSiteSearch"
>> package installed.
>
> I suppose this depends on your long term plans for the function and package.
> ?If you think it should eventually replace the utils function, then it makes
> sense to use the same name: ?users won't get used to a new name in the
> meantime. ?But if you think it will diverge from that function, then you
> might as well pick a separate name now.
>
> I disagree with Gabor about this being heavy handed, at least while it is
> the only significant export in the package. ?If people don't want it, don't
> attach the package.
>

The last sentence only gives you a choice of clobbering the existing
function or not using it and that is not very nice.   What is wanted is
both to be able to use it and allow it to coexist in a nice way.

How about R changing its RSiteSearch to be an S3 generic with the
main functionality being placed into RSiteSearch.default?   Then
RSiteSearch.function can become RsiteSearch.character and

- RSiteSearch will give the new functionality when the package is
loaded and the old functionality if not.
- RSiteSearch.character can be used in place of RSiteSearch.function
to force only the new functionality (or an error if not present)
- RSiteSearch.default will give the old functionality whether or not the
package is loaded

(If there is a NAMESPACE then Its assumed here that both methods are
exported.)


From Waclaw.Marcin.Kusnierczyk at idi.ntnu.no  Thu Jun  4 14:30:54 2009
From: Waclaw.Marcin.Kusnierczyk at idi.ntnu.no (Wacek Kusnierczyk)
Date: Thu, 04 Jun 2009 14:30:54 +0200
Subject: [Rd] bug tracker
Message-ID: <4A27BE7E.5050807@idi.ntnu.no>

the post 13613 has been classified as features&faq and annotated with
"As documented in the Warning section!".  however, the bug has actually
been fixed. 

may i kindly suggest that the annotation be changed to a more
appropriate note?

regards,
vQ


From murdoch at stats.uwo.ca  Thu Jun  4 18:13:25 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Thu, 04 Jun 2009 09:13:25 -0700
Subject: [Rd] proposed changes to RSiteSearch
In-Reply-To: <971536df0906040430s14c3f78fy2b1f639dfd3ce209@mail.gmail.com>
References: <39B6DDB9048D0F4DAD42CB26AAFF0AFA07381973@usctmx1106.merck.com>
	<4A031A22.7080702@stats.uwo.ca>	<39B6DDB9048D0F4DAD42CB26AAFF0AFA073C46FD@usctmx1106.merck.com>	<20090507180930.GA1619@psych.upenn.edu>	<39B6DDB9048D0F4DAD42CB26AAFF0AFA073C4758@usctmx1106.merck.com>	<4A032E6F.8010001@dbmail.com>
	<20090507192632.GA4723@psych.upenn.edu>
	<39B6DDB9048D0F4DAD42CB26AAFF0AFA073C4844@usctmx1106.merck.com>
	<4A26ED1D.1020407@prodsyse.com> <4A276278.3050404@stats.uwo.ca>
	<971536df0906040430s14c3f78fy2b1f639dfd3ce209@mail.gmail.com>
Message-ID: <4A27F2A5.70705@stats.uwo.ca>

Gabor Grothendieck wrote:
> On Thu, Jun 4, 2009 at 1:58 AM, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
>   
>> spencerg wrote:
>>     
>>> Hello All:
>>>
>>>      What do you think of adding a function "RSiteSeach" to the package of
>>> that name, masking the "RSiteSearch" function in "utils", trapping any call
>>> RSiteSearch('searchstring', 'function') to the current RSiteSearch.function
>>> and passing all others to "utils:::RSiteSearch"?  This was suggested by a
>>> referee to a manuscript on this new capability submitted to "R Journal".
>>>  The current version of this manuscript is available via "system.file('doc',
>>> 'RSiteSearch.pdf', package='RSiteSearch')" if you have the "RSiteSearch"
>>> package installed.
>>>       
>> I suppose this depends on your long term plans for the function and package.
>>  If you think it should eventually replace the utils function, then it makes
>> sense to use the same name:  users won't get used to a new name in the
>> meantime.  But if you think it will diverge from that function, then you
>> might as well pick a separate name now.
>>
>> I disagree with Gabor about this being heavy handed, at least while it is
>> the only significant export in the package.  If people don't want it, don't
>> attach the package.
>>
>>     
>
> The last sentence only gives you a choice of clobbering the existing
> function or not using it and that is not very nice.   What is wanted is
> both to be able to use it and allow it to coexist in a nice way.
>   

It is essentially a rename of the existing one to utils::RSiteSearch.  I 
would only suggest this if RSiteSearch::RSiteSearch expanded on its 
capabilities (which I think was Spencer's proposal), rather than 
replacing them with something different.

> How about R changing its RSiteSearch to be an S3 generic with the
> main functionality being placed into RSiteSearch.default?   Then
> RSiteSearch.function can become RsiteSearch.character and
>   
> - RSiteSearch will give the new functionality when the package is
> loaded and the old functionality if not.
> - RSiteSearch.character can be used in place of RSiteSearch.function
> to force only the new functionality (or an error if not present)
> - RSiteSearch.default will give the old functionality whether or not the
> package is loaded
>
> (If there is a NAMESPACE then Its assumed here that both methods are
> exported.)
>   

How is that an improvement?  Just replace your (RSiteSearch, 
RSiteSearch.character, RSiteSearch.default) with (RSiteSearch, 
RSiteSearch::RSiteSearch, utils::RSiteSearch) in my proposal and you get 
the same behaviour.  The point isn't that Spencer has invented a way for 
RSiteSearch to handle character vectors, it already knows that.  The 
point is that he has enhanced it.  Or maybe he has written something 
similar but different, in which case he should pick a new name. 

Duncan Murdoch


From ggrothendieck at gmail.com  Thu Jun  4 18:23:54 2009
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Thu, 4 Jun 2009 12:23:54 -0400
Subject: [Rd] proposed changes to RSiteSearch
In-Reply-To: <4A27F2A5.70705@stats.uwo.ca>
References: <39B6DDB9048D0F4DAD42CB26AAFF0AFA07381973@usctmx1106.merck.com> 
	<20090507180930.GA1619@psych.upenn.edu>
	<39B6DDB9048D0F4DAD42CB26AAFF0AFA073C4758@usctmx1106.merck.com>
	<4A032E6F.8010001@dbmail.com> <20090507192632.GA4723@psych.upenn.edu> 
	<39B6DDB9048D0F4DAD42CB26AAFF0AFA073C4844@usctmx1106.merck.com> 
	<4A26ED1D.1020407@prodsyse.com> <4A276278.3050404@stats.uwo.ca> 
	<971536df0906040430s14c3f78fy2b1f639dfd3ce209@mail.gmail.com> 
	<4A27F2A5.70705@stats.uwo.ca>
Message-ID: <971536df0906040923s7e791559vc217183e59742902@mail.gmail.com>

On Thu, Jun 4, 2009 at 12:13 PM, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
> Gabor Grothendieck wrote:
>>
>> On Thu, Jun 4, 2009 at 1:58 AM, Duncan Murdoch <murdoch at stats.uwo.ca>
>> wrote:
>>
>>>
>>> spencerg wrote:
>>>
>>>>
>>>> Hello All:
>>>>
>>>> ? ? What do you think of adding a function "RSiteSeach" to the package
>>>> of
>>>> that name, masking the "RSiteSearch" function in "utils", trapping any
>>>> call
>>>> RSiteSearch('searchstring', 'function') to the current
>>>> RSiteSearch.function
>>>> and passing all others to "utils:::RSiteSearch"? ?This was suggested by
>>>> a
>>>> referee to a manuscript on this new capability submitted to "R Journal".
>>>> ?The current version of this manuscript is available via
>>>> "system.file('doc',
>>>> 'RSiteSearch.pdf', package='RSiteSearch')" if you have the "RSiteSearch"
>>>> package installed.
>>>>
>>>
>>> I suppose this depends on your long term plans for the function and
>>> package.
>>> ?If you think it should eventually replace the utils function, then it
>>> makes
>>> sense to use the same name: ?users won't get used to a new name in the
>>> meantime. ?But if you think it will diverge from that function, then you
>>> might as well pick a separate name now.
>>>
>>> I disagree with Gabor about this being heavy handed, at least while it is
>>> the only significant export in the package. ?If people don't want it,
>>> don't
>>> attach the package.
>>>
>>>
>>
>> The last sentence only gives you a choice of clobbering the existing
>> function or not using it and that is not very nice. ? What is wanted is
>> both to be able to use it and allow it to coexist in a nice way.
>>
>
> It is essentially a rename of the existing one to utils::RSiteSearch. ?I
> would only suggest this if RSiteSearch::RSiteSearch expanded on its
> capabilities (which I think was Spencer's proposal), rather than replacing
> them with something different.
>
>> How about R changing its RSiteSearch to be an S3 generic with the
>> main functionality being placed into RSiteSearch.default? ? Then
>> RSiteSearch.function can become RsiteSearch.character and
>> ?- RSiteSearch will give the new functionality when the package is
>> loaded and the old functionality if not.
>> - RSiteSearch.character can be used in place of RSiteSearch.function
>> to force only the new functionality (or an error if not present)
>> - RSiteSearch.default will give the old functionality whether or not the
>> package is loaded
>>
>> (If there is a NAMESPACE then Its assumed here that both methods are
>> exported.)
>>
>
> How is that an improvement? ?Just replace your (RSiteSearch,
> RSiteSearch.character, RSiteSearch.default) with (RSiteSearch,
> RSiteSearch::RSiteSearch, utils::RSiteSearch) in my proposal and you get the
> same behaviour. ?The point isn't that Spencer has invented a way for
> RSiteSearch to handle character vectors, it already knows that. ?The point
> is that he has enhanced it. ?Or maybe he has written something similar but
> different, in which case he should pick a new name.
> Duncan Murdoch
>

He simply renames it RSiteSearch.character (and possibly some other
changes depending on arguments). Then if the core cooperates
by making RSiteSearch a generic with a default method then everything
works as one would expect based on an understanding of S3.

No conflicts in names are involved.


From spencer.graves at prodsyse.com  Thu Jun  4 19:38:37 2009
From: spencer.graves at prodsyse.com (spencerg)
Date: Thu, 04 Jun 2009 10:38:37 -0700
Subject: [Rd] proposed changes to RSiteSearch
In-Reply-To: <971536df0906040923s7e791559vc217183e59742902@mail.gmail.com>
References: <39B6DDB9048D0F4DAD42CB26AAFF0AFA07381973@usctmx1106.merck.com>
	<20090507180930.GA1619@psych.upenn.edu>	<39B6DDB9048D0F4DAD42CB26AAFF0AFA073C4758@usctmx1106.merck.com>	<4A032E6F.8010001@dbmail.com>
	<20090507192632.GA4723@psych.upenn.edu>
	<39B6DDB9048D0F4DAD42CB26AAFF0AFA073C4844@usctmx1106.merck.com>
	<4A26ED1D.1020407@prodsyse.com> <4A276278.3050404@stats.uwo.ca>
	<971536df0906040430s14c3f78fy2b1f639dfd3ce209@mail.gmail.com>
	<4A27F2A5.70705@stats.uwo.ca>
	<971536df0906040923s7e791559vc217183e59742902@mail.gmail.com>
Message-ID: <4A28069D.6030802@prodsyse.com>

Gabor Grothendieck wrote:
> On Thu, Jun 4, 2009 at 12:13 PM, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
>   
>> Gabor Grothendieck wrote:
>>     
>>> On Thu, Jun 4, 2009 at 1:58 AM, Duncan Murdoch <murdoch at stats.uwo.ca>
>>> wrote:
>>>
>>>       
>>>> spencerg wrote:
>>>>
>>>>         
>>>>> Hello All:
>>>>>
>>>>>     What do you think of adding a function "RSiteSeach" to the package
>>>>> of
>>>>> that name, masking the "RSiteSearch" function in "utils", trapping any
>>>>> call
>>>>> RSiteSearch('searchstring', 'function') to the current
>>>>> RSiteSearch.function
>>>>> and passing all others to "utils:::RSiteSearch"?  This was suggested by
>>>>> a
>>>>> referee to a manuscript on this new capability submitted to "R Journal".
>>>>>  The current version of this manuscript is available via
>>>>> "system.file('doc',
>>>>> 'RSiteSearch.pdf', package='RSiteSearch')" if you have the "RSiteSearch"
>>>>> package installed.
>>>>>
>>>>>           
>>>> I suppose this depends on your long term plans for the function and
>>>> package.
>>>>  If you think it should eventually replace the utils function, then it
>>>> makes
>>>> sense to use the same name:  users won't get used to a new name in the
>>>> meantime.  But if you think it will diverge from that function, then you
>>>> might as well pick a separate name now.
>>>>
>>>> I disagree with Gabor about this being heavy handed, at least while it is
>>>> the only significant export in the package.  If people don't want it,
>>>> don't
>>>> attach the package.
>>>>
>>>>
>>>>         
>>> The last sentence only gives you a choice of clobbering the existing
>>> function or not using it and that is not very nice.   What is wanted is
>>> both to be able to use it and allow it to coexist in a nice way.
>>>
>>>       
>> It is essentially a rename of the existing one to utils::RSiteSearch.  I
>> would only suggest this if RSiteSearch::RSiteSearch expanded on its
>> capabilities (which I think was Spencer's proposal), rather than replacing
>> them with something different.
>>
>>     
>>> How about R changing its RSiteSearch to be an S3 generic with the
>>> main functionality being placed into RSiteSearch.default?   Then
>>> RSiteSearch.function can become RsiteSearch.character and
>>>  - RSiteSearch will give the new functionality when the package is
>>> loaded and the old functionality if not.
>>> - RSiteSearch.character can be used in place of RSiteSearch.function
>>> to force only the new functionality (or an error if not present)
>>> - RSiteSearch.default will give the old functionality whether or not the
>>> package is loaded
>>>
>>> (If there is a NAMESPACE then Its assumed here that both methods are
>>> exported.)
>>>
>>>       
>> How is that an improvement?  Just replace your (RSiteSearch,
>> RSiteSearch.character, RSiteSearch.default) with (RSiteSearch,
>> RSiteSearch::RSiteSearch, utils::RSiteSearch) in my proposal and you get the
>> same behaviour.  The point isn't that Spencer has invented a way for
>> RSiteSearch to handle character vectors, it already knows that.  The point
>> is that he has enhanced it.  Or maybe he has written something similar but
>> different, in which case he should pick a new name.
>> Duncan Murdoch
>>
>>     
>
> He simply renames it RSiteSearch.character (and possibly some other
> changes depending on arguments). Then if the core cooperates
> by making RSiteSearch a generic with a default method then everything
> works as one would expect based on an understanding of S3.
>
> No conflicts in names are involved.
>
>   
To clarify:  RSiteSearch.function{RSiteSearch} accesses Johathan Baron's 
RSiteSearch data base for functions only, returning the result as a 
data.frame, sorts it to put the most frequently cited package first and 
then help page within package. 

      Spencer
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From ggrothendieck at gmail.com  Thu Jun  4 19:48:28 2009
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Thu, 4 Jun 2009 13:48:28 -0400
Subject: [Rd] proposed changes to RSiteSearch
In-Reply-To: <4A28069D.6030802@prodsyse.com>
References: <39B6DDB9048D0F4DAD42CB26AAFF0AFA07381973@usctmx1106.merck.com> 
	<4A032E6F.8010001@dbmail.com> <20090507192632.GA4723@psych.upenn.edu> 
	<39B6DDB9048D0F4DAD42CB26AAFF0AFA073C4844@usctmx1106.merck.com> 
	<4A26ED1D.1020407@prodsyse.com> <4A276278.3050404@stats.uwo.ca> 
	<971536df0906040430s14c3f78fy2b1f639dfd3ce209@mail.gmail.com> 
	<4A27F2A5.70705@stats.uwo.ca>
	<971536df0906040923s7e791559vc217183e59742902@mail.gmail.com> 
	<4A28069D.6030802@prodsyse.com>
Message-ID: <971536df0906041048o3d61ce0bn5414cee5b84583e9@mail.gmail.com>

On Thu, Jun 4, 2009 at 1:38 PM, spencerg <spencer.graves at prodsyse.com> wrote:
> Gabor Grothendieck wrote:
>>
>> On Thu, Jun 4, 2009 at 12:13 PM, Duncan Murdoch <murdoch at stats.uwo.ca>
>> wrote:
>>
>>>
>>> Gabor Grothendieck wrote:
>>>
>>>>
>>>> On Thu, Jun 4, 2009 at 1:58 AM, Duncan Murdoch <murdoch at stats.uwo.ca>
>>>> wrote:
>>>>
>>>>
>>>>>
>>>>> spencerg wrote:
>>>>>
>>>>>
>>>>>>
>>>>>> Hello All:
>>>>>>
>>>>>> ? ?What do you think of adding a function "RSiteSeach" to the package
>>>>>> of
>>>>>> that name, masking the "RSiteSearch" function in "utils", trapping any
>>>>>> call
>>>>>> RSiteSearch('searchstring', 'function') to the current
>>>>>> RSiteSearch.function
>>>>>> and passing all others to "utils:::RSiteSearch"? ?This was suggested
>>>>>> by
>>>>>> a
>>>>>> referee to a manuscript on this new capability submitted to "R
>>>>>> Journal".
>>>>>> ?The current version of this manuscript is available via
>>>>>> "system.file('doc',
>>>>>> 'RSiteSearch.pdf', package='RSiteSearch')" if you have the
>>>>>> "RSiteSearch"
>>>>>> package installed.
>>>>>>
>>>>>>
>>>>>
>>>>> I suppose this depends on your long term plans for the function and
>>>>> package.
>>>>> ?If you think it should eventually replace the utils function, then it
>>>>> makes
>>>>> sense to use the same name: ?users won't get used to a new name in the
>>>>> meantime. ?But if you think it will diverge from that function, then
>>>>> you
>>>>> might as well pick a separate name now.
>>>>>
>>>>> I disagree with Gabor about this being heavy handed, at least while it
>>>>> is
>>>>> the only significant export in the package. ?If people don't want it,
>>>>> don't
>>>>> attach the package.
>>>>>
>>>>>
>>>>>
>>>>
>>>> The last sentence only gives you a choice of clobbering the existing
>>>> function or not using it and that is not very nice. ? What is wanted is
>>>> both to be able to use it and allow it to coexist in a nice way.
>>>>
>>>>
>>>
>>> It is essentially a rename of the existing one to utils::RSiteSearch. ?I
>>> would only suggest this if RSiteSearch::RSiteSearch expanded on its
>>> capabilities (which I think was Spencer's proposal), rather than
>>> replacing
>>> them with something different.
>>>
>>>
>>>>
>>>> How about R changing its RSiteSearch to be an S3 generic with the
>>>> main functionality being placed into RSiteSearch.default? ? Then
>>>> RSiteSearch.function can become RsiteSearch.character and
>>>> ?- RSiteSearch will give the new functionality when the package is
>>>> loaded and the old functionality if not.
>>>> - RSiteSearch.character can be used in place of RSiteSearch.function
>>>> to force only the new functionality (or an error if not present)
>>>> - RSiteSearch.default will give the old functionality whether or not the
>>>> package is loaded
>>>>
>>>> (If there is a NAMESPACE then Its assumed here that both methods are
>>>> exported.)
>>>>
>>>>
>>>
>>> How is that an improvement? ?Just replace your (RSiteSearch,
>>> RSiteSearch.character, RSiteSearch.default) with (RSiteSearch,
>>> RSiteSearch::RSiteSearch, utils::RSiteSearch) in my proposal and you get
>>> the
>>> same behaviour. ?The point isn't that Spencer has invented a way for
>>> RSiteSearch to handle character vectors, it already knows that. ?The
>>> point
>>> is that he has enhanced it. ?Or maybe he has written something similar
>>> but
>>> different, in which case he should pick a new name.
>>> Duncan Murdoch
>>>
>>>
>>
>> He simply renames it RSiteSearch.character (and possibly some other
>> changes depending on arguments). Then if the core cooperates
>> by making RSiteSearch a generic with a default method then everything
>> works as one would expect based on an understanding of S3.
>>
>> No conflicts in names are involved.
>>
>>
>
> To clarify: ?RSiteSearch.function{RSiteSearch} accesses Johathan Baron's
> RSiteSearch data base for functions only, returning the result as a
> data.frame, sorts it to put the most frequently cited package first and then
> help page within package.
> ? ? Spencer

Consider this:

> f <- function(x) UseMethod("f")
> f.character <- function(x) { if (nchar(x) > 1) NextMethod() else x }
> f.default <- function(x) nchar(x)
> f("xx")
[1] 2
> f("x")
[1] "x"

In this case f takes a single character string argument and passes it
to f.character.

f.character can handle a single character (it just returns
it) but if x consists of a string of multiple characters it hands
it off to f.default (which returns the number of characters).


From murdoch at stats.uwo.ca  Thu Jun  4 22:58:23 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Thu, 04 Jun 2009 13:58:23 -0700
Subject: [Rd] [R] custom sort?
In-Reply-To: <8b356f880905291109g6362077do1247d2a4fde24c94@mail.gmail.com>
References: <23770565.post@talk.nabble.com> <4A1F06BC.3040802@stats.uwo.ca>	
	<8b356f880905281717o34922d10m58e5da1d4ea04538@mail.gmail.com>	
	<4A1FE305.4030008@stats.uwo.ca> <4A201538.4090503@stats.uwo.ca>
	<8b356f880905291109g6362077do1247d2a4fde24c94@mail.gmail.com>
Message-ID: <4A28356F.9080703@stats.uwo.ca>

Stavros Macrakis wrote:
> Thanks for the quick fix!
>   

It was quick in R-devel, not so quick in R-patched.  I forgot to commit 
the change, but someone accidentally ported my NEWS item about it over, 
so I thought I really had done it when I looked from another computer 
the next day.  Then I headed out on the road...

Will commit it to R-patched (from the Vancouver airport) in a few minutes.

Duncan Murdoch
>             -s
>
> On Fri, May 29, 2009 at 1:02 PM, Duncan Murdoch <murdoch at stats.uwo.ca>wrote:
>
>   
>> On 5/29/2009 9:28 AM, Duncan Murdoch wrote:
>>
>>     
>>> I've moved this to R-devel...
>>>
>>> On 5/28/2009 8:17 PM, Stavros Macrakis wrote:
>>>
>>>       
>>>> I couldn't get your suggested method to work:
>>>>
>>>>  `==.foo` <- function(a,b) unclass(a)==unclass(b)
>>>>  `>.foo` <- function(a,b) unclass(a) < unclass(b)     # invert comparison
>>>>  is.na.foo <- function(a)is.na(unclass(a))
>>>>
>>>>  sort(structure(sample(5),class="foo"))  #-> 1:5  -- not reversed
>>>>
>>>> What am I missing?
>>>>
>>>>         
>>> There are two problems.  First, I didn't mention that you need a method
>>> for indexing as well.  The code needs to evaluate things like x[i] > x[j],
>>> and by default x[i] will not be of class "foo", so the custom comparison
>>> methods won't be called.
>>>
>>> Second, I think there's a bug in the internal code, specifically in
>>> do_rank or orderVector1 in sort.c:  orderVector1 ignores the class of x.
>>>  do_rank pays attention when breaking ties, so I think this is an oversight.
>>>
>>> So I'd say two things should be done:
>>>
>>>  1.  the bug should be fixed.  Even if this isn't the most obvious
>>> approach, it should work.
>>>
>>>       
>> I've now fixed the bug, and clarified the documentation to say
>>
>>  The default method will make use of == and > methods
>>  for the class of x[i] (for integers i), and the
>>  is.na method for the class of x, but might be rather
>>  slow when doing so.
>>
>> You don't actually need a custom indexing method, you just need to be aware
>> that it's the class of x[i] that is important for comparisons.
>>
>> This will make it into R-patched and R-devel.
>>
>> Duncan Murdoch
>>
>>
>>
>>     
>>>  2.  we should look for ways to make all of this simpler, e.g. allowing a
>>> comparison function to be used.
>>>
>>> I'll take on 1, but not 2.  It's hard to work out the right place for the
>>> comparison function to appear, and it would require a lot of work to
>>> implement, because all of this stuff (sort, rank, order, xtfrm, sort.int,
>>> etc.) is closely interrelated, some but not all of the functions are S3
>>> generics, some implemented internally, etc.  In the end, I'd guess the
>>> results won't be very satisfactory from a performance point of view:  all
>>> those calls out to R to do the comparisons are going to be really slow.
>>>
>>> I think your advice to use order() with multiple keys is likely to be much
>>> faster in most instances.  It's just a better approach in R.
>>>
>>> Duncan Murdoch
>>>
>>>
>>>       
>>>>           -s
>>>>
>>>> On Thu, May 28, 2009 at 5:48 PM, Duncan Murdoch <murdoch at stats.uwo.ca
>>>>         
>>>>> wrote:
>>>>>           
>>>>  On 28/05/2009 5:34 PM, Steve Jaffe wrote:
>>>>         
>>>>>  Sounds simple but haven't been able to find it in docs: is it possible
>>>>>           
>>>>>> to
>>>>>> sort a vector using a user-defined comparison function? Seems it must
>>>>>> be,
>>>>>> but "sort" doesn't seem to provide that option, nor does "order" sfaics
>>>>>>
>>>>>>
>>>>>>             
>>>>> You put a class on the vector (e.g. using class(x) <- "myvector"), then
>>>>> define a conversion to numeric (e.g. xtfrm.myvector) or actual
>>>>> comparison
>>>>> methods (you'll need ==.myvector, >.myvector, and is.na.myvector).
>>>>>
>>>>> Duncan Murdoch
>>>>>
>>>>>
>>>>> ______________________________________________
>>>>> R-help at r-project.org mailing list
>>>>> https://stat.ethz.ch/mailman/listinfo/r-help
>>>>> PLEASE do read the posting guide
>>>>> http://www.R-project.org/posting-guide.html
>>>>> and provide commented, minimal, self-contained, reproducible code.
>>>>>
>>>>>
>>>>>           
>>>>        [[alternative HTML version deleted]]
>>>>
>>>> ______________________________________________
>>>> R-help at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-help
>>>> PLEASE do read the posting guide
>>>> http://www.R-project.org/posting-guide.html
>>>> and provide commented, minimal, self-contained, reproducible code.
>>>>
>>>>         
>>>
>>>       
>
>


From spencer.graves at prodsyse.com  Fri Jun  5 07:04:47 2009
From: spencer.graves at prodsyse.com (spencerg)
Date: Thu, 04 Jun 2009 22:04:47 -0700
Subject: [Rd] proposed changes to RSiteSearch
In-Reply-To: <971536df0906040923s7e791559vc217183e59742902@mail.gmail.com>
References: <39B6DDB9048D0F4DAD42CB26AAFF0AFA07381973@usctmx1106.merck.com>
	<20090507180930.GA1619@psych.upenn.edu>	<39B6DDB9048D0F4DAD42CB26AAFF0AFA073C4758@usctmx1106.merck.com>	<4A032E6F.8010001@dbmail.com>
	<20090507192632.GA4723@psych.upenn.edu>
	<39B6DDB9048D0F4DAD42CB26AAFF0AFA073C4844@usctmx1106.merck.com>
	<4A26ED1D.1020407@prodsyse.com> <4A276278.3050404@stats.uwo.ca>
	<971536df0906040430s14c3f78fy2b1f639dfd3ce209@mail.gmail.com>
	<4A27F2A5.70705@stats.uwo.ca>
	<971536df0906040923s7e791559vc217183e59742902@mail.gmail.com>
Message-ID: <4A28A76F.2080600@prodsyse.com>

      Thank you all for your suggestions.  My goal with this is to make 
it as easy as possible for R users to find what they want in contributed 
packages.  A referee for our "R Journal" manuscript complained that 
"RSiteSearch.function" was too much to type, suggesting we consider 
masking "RSiteSearch".  From the discussion, I do not see a strong 
consensus for doing that.  I like Romain's suggestion to shorten the 
name further to, e.g., "web.search" or "doc.search".  Another colleague 
suggested "RSearch". 


      What do you think about renaming the current 
"RSiteSearch.function{RSiteSearch}" to "RSearch{RSearch}"? 


      I'm happy to support the consensus of this group on a name (and 
even enhancements) that seems likely to maximize its utility to R 
users.  I ask, because a rose by any other name would smell as sweet, 
but one named "prettysweetsmellingthingamabob" might not sell as well. 


      Thanks,
      Spencer     


Gabor Grothendieck wrote:
> On Thu, Jun 4, 2009 at 12:13 PM, Duncan Murdoch <murdoch at stats.uwo.ca> wrote:
>   
>> Gabor Grothendieck wrote:
>>     
>>> On Thu, Jun 4, 2009 at 1:58 AM, Duncan Murdoch <murdoch at stats.uwo.ca>
>>> wrote:
>>>
>>>       
>>>> spencerg wrote:
>>>>
>>>>         
>>>>> Hello All:
>>>>>
>>>>>     What do you think of adding a function "RSiteSeach" to the package
>>>>> of
>>>>> that name, masking the "RSiteSearch" function in "utils", trapping any
>>>>> call
>>>>> RSiteSearch('searchstring', 'function') to the current
>>>>> RSiteSearch.function
>>>>> and passing all others to "utils:::RSiteSearch"?  This was suggested by
>>>>> a
>>>>> referee to a manuscript on this new capability submitted to "R Journal".
>>>>>  The current version of this manuscript is available via
>>>>> "system.file('doc',
>>>>> 'RSiteSearch.pdf', package='RSiteSearch')" if you have the "RSiteSearch"
>>>>> package installed.
>>>>>
>>>>>           
>>>> I suppose this depends on your long term plans for the function and
>>>> package.
>>>>  If you think it should eventually replace the utils function, then it
>>>> makes
>>>> sense to use the same name:  users won't get used to a new name in the
>>>> meantime.  But if you think it will diverge from that function, then you
>>>> might as well pick a separate name now.
>>>>
>>>> I disagree with Gabor about this being heavy handed, at least while it is
>>>> the only significant export in the package.  If people don't want it,
>>>> don't
>>>> attach the package.
>>>>
>>>>
>>>>         
>>> The last sentence only gives you a choice of clobbering the existing
>>> function or not using it and that is not very nice.   What is wanted is
>>> both to be able to use it and allow it to coexist in a nice way.
>>>
>>>       
>> It is essentially a rename of the existing one to utils::RSiteSearch.  I
>> would only suggest this if RSiteSearch::RSiteSearch expanded on its
>> capabilities (which I think was Spencer's proposal), rather than replacing
>> them with something different.
>>
>>     
>>> How about R changing its RSiteSearch to be an S3 generic with the
>>> main functionality being placed into RSiteSearch.default?   Then
>>> RSiteSearch.function can become RsiteSearch.character and
>>>  - RSiteSearch will give the new functionality when the package is
>>> loaded and the old functionality if not.
>>> - RSiteSearch.character can be used in place of RSiteSearch.function
>>> to force only the new functionality (or an error if not present)
>>> - RSiteSearch.default will give the old functionality whether or not the
>>> package is loaded
>>>
>>> (If there is a NAMESPACE then Its assumed here that both methods are
>>> exported.)
>>>
>>>       
>> How is that an improvement?  Just replace your (RSiteSearch,
>> RSiteSearch.character, RSiteSearch.default) with (RSiteSearch,
>> RSiteSearch::RSiteSearch, utils::RSiteSearch) in my proposal and you get the
>> same behaviour.  The point isn't that Spencer has invented a way for
>> RSiteSearch to handle character vectors, it already knows that.  The point
>> is that he has enhanced it.  Or maybe he has written something similar but
>> different, in which case he should pick a new name.
>> Duncan Murdoch
>>
>>     
>
> He simply renames it RSiteSearch.character (and possibly some other
> changes depending on arguments). Then if the core cooperates
> by making RSiteSearch a generic with a default method then everything
> works as one would expect based on an understanding of S3.
>
> No conflicts in names are involved.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From andy_liaw at merck.com  Fri Jun  5 13:52:46 2009
From: andy_liaw at merck.com (Liaw, Andy)
Date: Fri, 5 Jun 2009 07:52:46 -0400
Subject: [Rd] proposed changes to RSiteSearch
In-Reply-To: <4A28A76F.2080600@prodsyse.com>
References: <39B6DDB9048D0F4DAD42CB26AAFF0AFA07381973@usctmx1106.merck.com>
	<20090507180930.GA1619@psych.upenn.edu>	<39B6DDB9048D0F4DAD42CB26AAFF0AFA073C4758@usctmx1106.merck.com>	<4A032E6F.8010001@dbmail.com>
	<20090507192632.GA4723@psych.upenn.edu>
	<39B6DDB9048D0F4DAD42CB26AAFF0AFA073C4844@usctmx1106.merck.com>
	<4A26ED1D.1020407@prodsyse.com> <4A276278.3050404@stats.uwo.ca>
	<971536df0906040430s14c3f78fy2b1f639dfd3ce209@mail.gmail.com>
	<4A27F2A5.70705@stats.uwo.ca>
	<971536df0906040923s7e791559vc217183e59742902@mail.gmail.com>
	<4A28A76F.2080600@prodsyse.com>
Message-ID: <39B6DDB9048D0F4DAD42CB26AAFF0AFA075A960C@usctmx1106.merck.com>

From: spencerg
> 
>       Thank you all for your suggestions.  My goal with this 
> is to make 
> it as easy as possible for R users to find what they want in 
> contributed 
> packages.  A referee for our "R Journal" manuscript complained that 
> "RSiteSearch.function" was too much to type, suggesting we consider 
> masking "RSiteSearch".  From the discussion, I do not see a strong 
> consensus for doing that.  I like Romain's suggestion to shorten the 
> name further to, e.g., "web.search" or "doc.search".  Another 
> colleague 
> suggested "RSearch". 
> 
> 
>       What do you think about renaming the current 
> "RSiteSearch.function{RSiteSearch}" to "RSearch{RSearch}"? 
> 
> 
>       I'm happy to support the consensus of this group on a name (and 
> even enhancements) that seems likely to maximize its utility to R 
> users.  I ask, because a rose by any other name would smell as sweet, 
> but one named "prettysweetsmellingthingamabob" might not sell 
> as well. 
> 
> 
>       Thanks,
>       Spencer     

[I've removed those on cc since I believe everyone will get this through
R-devel anyway...]

I'd suggest something like findFunction() or some such, if the main goal
is to look for functions (not manuals, vignettes, mailing lists, etc.).
RSiteSearch() was named what it was because it was meant as an interface
to Jon's search site that has lots of things related to R.  

It seems to me that the recent discussion has been about including other
alternative search engines, etc.  Recall that when we were discussing
including RSiteSearch() into base R, Jon basically had to commit to
maintaining the site, as well as documenting how to replicate the site
if and when he could no longer maintain it, before R Core accepted the
function.  I think it would be wonderful to have a search facility
that's all encompassing ("Roogle"?), but for inclusion into base R we
really need to have the sites being searched being basically permenant.

Perhaps a bit OT, but what would really be nice is if a search facility
can not only find functions that's related to some search phrase, but
also indicate whether the packages the functions belong to have already
been installed on the user's system.  Sort of like "yum info" or "yum
search" for those on RedHat-based Linux...

Best,
Andy


 
> 
> Gabor Grothendieck wrote:
> > On Thu, Jun 4, 2009 at 12:13 PM, Duncan Murdoch 
> <murdoch at stats.uwo.ca> wrote:
> >   
> >> Gabor Grothendieck wrote:
> >>     
> >>> On Thu, Jun 4, 2009 at 1:58 AM, Duncan Murdoch 
> <murdoch at stats.uwo.ca>
> >>> wrote:
> >>>
> >>>       
> >>>> spencerg wrote:
> >>>>
> >>>>         
> >>>>> Hello All:
> >>>>>
> >>>>>     What do you think of adding a function "RSiteSeach" 
> to the package
> >>>>> of
> >>>>> that name, masking the "RSiteSearch" function in 
> "utils", trapping any
> >>>>> call
> >>>>> RSiteSearch('searchstring', 'function') to the current
> >>>>> RSiteSearch.function
> >>>>> and passing all others to "utils:::RSiteSearch"?  This 
> was suggested by
> >>>>> a
> >>>>> referee to a manuscript on this new capability 
> submitted to "R Journal".
> >>>>>  The current version of this manuscript is available via
> >>>>> "system.file('doc',
> >>>>> 'RSiteSearch.pdf', package='RSiteSearch')" if you have 
> the "RSiteSearch"
> >>>>> package installed.
> >>>>>
> >>>>>           
> >>>> I suppose this depends on your long term plans for the 
> function and
> >>>> package.
> >>>>  If you think it should eventually replace the utils 
> function, then it
> >>>> makes
> >>>> sense to use the same name:  users won't get used to a 
> new name in the
> >>>> meantime.  But if you think it will diverge from that 
> function, then you
> >>>> might as well pick a separate name now.
> >>>>
> >>>> I disagree with Gabor about this being heavy handed, at 
> least while it is
> >>>> the only significant export in the package.  If people 
> don't want it,
> >>>> don't
> >>>> attach the package.
> >>>>
> >>>>
> >>>>         
> >>> The last sentence only gives you a choice of clobbering 
> the existing
> >>> function or not using it and that is not very nice.   
> What is wanted is
> >>> both to be able to use it and allow it to coexist in a nice way.
> >>>
> >>>       
> >> It is essentially a rename of the existing one to 
> utils::RSiteSearch.  I
> >> would only suggest this if RSiteSearch::RSiteSearch expanded on its
> >> capabilities (which I think was Spencer's proposal), 
> rather than replacing
> >> them with something different.
> >>
> >>     
> >>> How about R changing its RSiteSearch to be an S3 generic with the
> >>> main functionality being placed into RSiteSearch.default?   Then
> >>> RSiteSearch.function can become RsiteSearch.character and
> >>>  - RSiteSearch will give the new functionality when the package is
> >>> loaded and the old functionality if not.
> >>> - RSiteSearch.character can be used in place of 
> RSiteSearch.function
> >>> to force only the new functionality (or an error if not present)
> >>> - RSiteSearch.default will give the old functionality 
> whether or not the
> >>> package is loaded
> >>>
> >>> (If there is a NAMESPACE then Its assumed here that both 
> methods are
> >>> exported.)
> >>>
> >>>       
> >> How is that an improvement?  Just replace your (RSiteSearch,
> >> RSiteSearch.character, RSiteSearch.default) with (RSiteSearch,
> >> RSiteSearch::RSiteSearch, utils::RSiteSearch) in my 
> proposal and you get the
> >> same behaviour.  The point isn't that Spencer has invented 
> a way for
> >> RSiteSearch to handle character vectors, it already knows 
> that.  The point
> >> is that he has enhanced it.  Or maybe he has written 
> something similar but
> >> different, in which case he should pick a new name.
> >> Duncan Murdoch
> >>
> >>     
> >
> > He simply renames it RSiteSearch.character (and possibly some other
> > changes depending on arguments). Then if the core cooperates
> > by making RSiteSearch a generic with a default method then 
> everything
> > works as one would expect based on an understanding of S3.
> >
> > No conflicts in names are involved.
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >
> >   
> 
> 
Notice:  This e-mail message, together with any attachme...{{dropped:12}}


From b.rowlingson at lancaster.ac.uk  Fri Jun  5 13:53:56 2009
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Fri, 5 Jun 2009 12:53:56 +0100
Subject: [Rd] Show location of workspace image on quit?
Message-ID: <d8ad40b50906050453q5ae944e2v18cf12093e397ed1@mail.gmail.com>

When I quit R, it says:

 > q()
 Save workspace image? [y/n/c]:

 and since I've probably got 3 R sessions running in however many
different directories and I might have jumped around with setwd() , I
forget exactly where R wants to save its workspace image. So could q()
be changed to say what file it is going to save to before it does?

 Currently I have to hit 'c', then do getcwd(), then quit again.
Would something like

 > q()
 Save workspace image (/home/me/workspace/.RData)? [y/n/c]:

 be useful to anyone else? Just thought I'd ask before I dive into
internals or wrap the q function for myself.

Barry


From Waclaw.Marcin.Kusnierczyk at idi.ntnu.no  Fri Jun  5 14:03:20 2009
From: Waclaw.Marcin.Kusnierczyk at idi.ntnu.no (Wacek Kusnierczyk)
Date: Fri, 05 Jun 2009 14:03:20 +0200
Subject: [Rd] Show location of workspace image on quit?
In-Reply-To: <d8ad40b50906050453q5ae944e2v18cf12093e397ed1@mail.gmail.com>
References: <d8ad40b50906050453q5ae944e2v18cf12093e397ed1@mail.gmail.com>
Message-ID: <4A290988.4060105@idi.ntnu.no>

Barry Rowlingson wrote:
> Would something like
>
>  > q()
>  Save workspace image (/home/me/workspace/.RData)? [y/n/c]:
>
>  be useful to anyone else? Just thought I'd ask before I dive into
> internals or wrap the q function for myself.
>   


yes, it would be very useful to me.

vQ


From murdoch at stats.uwo.ca  Fri Jun  5 14:14:14 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Fri, 05 Jun 2009 08:14:14 -0400
Subject: [Rd] Show location of workspace image on quit?
In-Reply-To: <d8ad40b50906050453q5ae944e2v18cf12093e397ed1@mail.gmail.com>
References: <d8ad40b50906050453q5ae944e2v18cf12093e397ed1@mail.gmail.com>
Message-ID: <4A290C16.40102@stats.uwo.ca>

On 05/06/2009 7:53 AM, Barry Rowlingson wrote:
> When I quit R, it says:
> 
>  > q()
>  Save workspace image? [y/n/c]:
> 
>  and since I've probably got 3 R sessions running in however many
> different directories and I might have jumped around with setwd() , I
> forget exactly where R wants to save its workspace image. So could q()
> be changed to say what file it is going to save to before it does?
> 
>  Currently I have to hit 'c', then do getcwd(), then quit again.
> Would something like
> 
>  > q()
>  Save workspace image (/home/me/workspace/.RData)? [y/n/c]:
> 
>  be useful to anyone else? Just thought I'd ask before I dive into
> internals or wrap the q function for myself.

That sounds like a great suggestion.  I might word it as

Save workspace to "/home/me/workspace/.RData"? [y/n/c]

If people are working deep in a directory tree, the path might end up 
too long; you might want to think about limiting it (e.g. by leaving off 
the root).

Duncan Murdoch


From Waclaw.Marcin.Kusnierczyk at idi.ntnu.no  Fri Jun  5 14:36:43 2009
From: Waclaw.Marcin.Kusnierczyk at idi.ntnu.no (Wacek Kusnierczyk)
Date: Fri, 05 Jun 2009 14:36:43 +0200
Subject: [Rd] Show location of workspace image on quit?
In-Reply-To: <4A290C16.40102@stats.uwo.ca>
References: <d8ad40b50906050453q5ae944e2v18cf12093e397ed1@mail.gmail.com>
	<4A290C16.40102@stats.uwo.ca>
Message-ID: <4A29115B.8060405@idi.ntnu.no>

Duncan Murdoch wrote:
> On 05/06/2009 7:53 AM, Barry Rowlingson wrote:
>> When I quit R, it says:
>>
>>  > q()
>>  Save workspace image? [y/n/c]:
>>
>>  and since I've probably got 3 R sessions running in however many
>> different directories and I might have jumped around with setwd() , I
>> forget exactly where R wants to save its workspace image. So could q()
>> be changed to say what file it is going to save to before it does?
>>
>>  Currently I have to hit 'c', then do getcwd(), then quit again.
>> Would something like
>>
>>  > q()
>>  Save workspace image (/home/me/workspace/.RData)? [y/n/c]:
>>
>>  be useful to anyone else? Just thought I'd ask before I dive into
>> internals or wrap the q function for myself.
>
> That sounds like a great suggestion.  I might word it as
>
> Save workspace to "/home/me/workspace/.RData"? [y/n/c]

but then what would happen if you choose 'n'?  i'd expect a prompt for
another path --  and i'd suspect this is what others would expect, too. 
with the message as barry suggests, exiting without saving is the most
natural thing, which is what happens in the current implementation. 

if you insist on your version, it would be better, i think, to change
the behaviour, too.


vQ


From ronggui.huang at gmail.com  Fri Jun  5 14:37:23 2009
From: ronggui.huang at gmail.com (Ronggui Huang)
Date: Fri, 5 Jun 2009 20:37:23 +0800
Subject: [Rd] Show location of workspace image on quit?
In-Reply-To: <4A290C16.40102@stats.uwo.ca>
References: <d8ad40b50906050453q5ae944e2v18cf12093e397ed1@mail.gmail.com> 
	<4A290C16.40102@stats.uwo.ca>
Message-ID: <38b9f0350906050537l3bb6ee77x89ca854ffd9ffb96@mail.gmail.com>

2009/6/5 Duncan Murdoch <murdoch at stats.uwo.ca>:
> On 05/06/2009 7:53 AM, Barry Rowlingson wrote:
>>
>> When I quit R, it says:
>>
>> ?> q()
>> ?Save workspace image? [y/n/c]:
>>
>> ?and since I've probably got 3 R sessions running in however many
>> different directories and I might have jumped around with setwd() , I
>> forget exactly where R wants to save its workspace image. So could q()
>> be changed to say what file it is going to save to before it does?
>>
>> ?Currently I have to hit 'c', then do getcwd(), then quit again.
>> Would something like
>>
>> ?> q()
>> ?Save workspace image (/home/me/workspace/.RData)? [y/n/c]:
>>
>> ?be useful to anyone else? Just thought I'd ask before I dive into
>> internals or wrap the q function for myself.
>
> That sounds like a great suggestion. ?I might word it as
>
> Save workspace to "/home/me/workspace/.RData"? [y/n/c]
>
> If people are working deep in a directory tree, the path might end up too
> long; you might want to think about limiting it (e.g. by leaving off the
> root).

Or print it in mutiple lines? e.g.

Save workspace to "/home/me/
workspace/.RData"? [y/n/c]

> Duncan Murdoch
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>



-- 
HUANG Ronggui, Wincent
PhD Candidate
Dept of Public and Social Administration
City University of Hong Kong
Home page: http://asrr.r-forge.r-project.org/rghuang.html


From mathieu.ribatet at epfl.ch  Fri Jun  5 14:46:03 2009
From: mathieu.ribatet at epfl.ch (Mathieu Ribatet)
Date: Fri, 05 Jun 2009 14:46:03 +0200
Subject: [Rd] Show location of workspace image on quit?
In-Reply-To: <4A29115B.8060405@idi.ntnu.no>
References: <d8ad40b50906050453q5ae944e2v18cf12093e397ed1@mail.gmail.com>
	<4A290C16.40102@stats.uwo.ca>  <4A29115B.8060405@idi.ntnu.no>
Message-ID: <1244205963.3903.4.camel@ubuntu>

I guess that having something like this
> q()
> Save workspace image (/home/me/workspace/.RData)? [y/n/c/e]:

where "e" means Editing the path should be clear enought, isn't it?

Best,
Mathieu

Le vendredi 05 juin 2009 ? 14:36 +0200, Wacek Kusnierczyk a ?crit :
> Duncan Murdoch wrote:
> > On 05/06/2009 7:53 AM, Barry Rowlingson wrote:
> >> When I quit R, it says:
> >>
> >>  > q()
> >>  Save workspace image? [y/n/c]:
> >>
> >>  and since I've probably got 3 R sessions running in however many
> >> different directories and I might have jumped around with setwd() , I
> >> forget exactly where R wants to save its workspace image. So could q()
> >> be changed to say what file it is going to save to before it does?
> >>
> >>  Currently I have to hit 'c', then do getcwd(), then quit again.
> >> Would something like
> >>
> >>  > q()
> >>  Save workspace image (/home/me/workspace/.RData)? [y/n/c]:
> >>
> >>  be useful to anyone else? Just thought I'd ask before I dive into
> >> internals or wrap the q function for myself.
> >
> > That sounds like a great suggestion.  I might word it as
> >
> > Save workspace to "/home/me/workspace/.RData"? [y/n/c]
> 
> but then what would happen if you choose 'n'?  i'd expect a prompt for
> another path --  and i'd suspect this is what others would expect, too. 
> with the message as barry suggests, exiting without saving is the most
> natural thing, which is what happens in the current implementation. 
> 
> if you insist on your version, it would be better, i think, to change
> the behaviour, too.
> 
> 
> vQ
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
-- 
Institute of Mathematics
Ecole Polytechnique F?d?rale de Lausanne
STAT-IMA-FSB-EPFL, Station 8
CH-1015 Lausanne   Switzerland
http://stat.epfl.ch/
Tel: + 41 (0)21 693 7907


From spencer.graves at prodsyse.com  Fri Jun  5 15:41:39 2009
From: spencer.graves at prodsyse.com (spencerg)
Date: Fri, 05 Jun 2009 06:41:39 -0700
Subject: [Rd] proposed changes to RSiteSearch
In-Reply-To: <39B6DDB9048D0F4DAD42CB26AAFF0AFA075A960C@usctmx1106.merck.com>
References: <39B6DDB9048D0F4DAD42CB26AAFF0AFA07381973@usctmx1106.merck.com>
	<20090507180930.GA1619@psych.upenn.edu>	<39B6DDB9048D0F4DAD42CB26AAFF0AFA073C4758@usctmx1106.merck.com>	<4A032E6F.8010001@dbmail.com>
	<20090507192632.GA4723@psych.upenn.edu>
	<39B6DDB9048D0F4DAD42CB26AAFF0AFA073C4844@usctmx1106.merck.com>
	<4A26ED1D.1020407@prodsyse.com> <4A276278.3050404@stats.uwo.ca>
	<971536df0906040430s14c3f78fy2b1f639dfd3ce209@mail.gmail.com>
	<4A27F2A5.70705@stats.uwo.ca>
	<971536df0906040923s7e791559vc217183e59742902@mail.gmail.com>
	<4A28A76F.2080600@prodsyse.com>
	<39B6DDB9048D0F4DAD42CB26AAFF0AFA075A960C@usctmx1106.merck.com>
Message-ID: <4A292093.2030400@prodsyse.com>

Liaw, Andy wrote:
> From: spencerg
>   
>>       Thank you all for your suggestions.  My goal with this 
>> is to make 
>> it as easy as possible for R users to find what they want in 
>> contributed 
>> packages.  A referee for our "R Journal" manuscript complained that 
>> "RSiteSearch.function" was too much to type, suggesting we consider 
>> masking "RSiteSearch".  From the discussion, I do not see a strong 
>> consensus for doing that.  I like Romain's suggestion to shorten the 
>> name further to, e.g., "web.search" or "doc.search".  Another 
>> colleague 
>> suggested "RSearch". 
>>
>>
>>       What do you think about renaming the current 
>> "RSiteSearch.function{RSiteSearch}" to "RSearch{RSearch}"? 
>>
>>
>>       I'm happy to support the consensus of this group on a name (and 
>> even enhancements) that seems likely to maximize its utility to R 
>> users.  I ask, because a rose by any other name would smell as sweet, 
>> but one named "prettysweetsmellingthingamabob" might not sell 
>> as well. 
>>
>>
>>       Thanks,
>>       Spencer     
>>     
>
> [I've removed those on cc since I believe everyone will get this through
> R-devel anyway...]
>
> I'd suggest something like findFunction() or some such, if the main goal
> is to look for functions (not manuals, vignettes, mailing lists, etc.).
>   
      "findFunction" sounds to me like the best name I've heard so far. 

> RSiteSearch() was named what it was because it was meant as an interface
> to Jon's search site that has lots of things related to R.  
>
> It seems to me that the recent discussion has been about including other
> alternative search engines, etc.  Recall that when we were discussing
> including RSiteSearch() into base R, Jon basically had to commit to
> maintaining the site, as well as documenting how to replicate the site
> if and when he could no longer maintain it, before R Core accepted the
> function.  I think it would be wonderful to have a search facility
> that's all encompassing ("Roogle"?), but for inclusion into base R we
> really need to have the sites being searched being basically permenant.
>
> Perhaps a bit OT, but what would really be nice is if a search facility
> can not only find functions that's related to some search phrase, but
> also indicate whether the packages the functions belong to have already
> been installed on the user's system.  Sort of like "yum info" or "yum
> search" for those on RedHat-based Linux...
>   
      The current RSiteSeach package includes that adds other 
information from packageDescription to the package summary, adding 
(current default) "Title", "Version", "Author", "Maintainer", and (date) 
"Packaged".  If the package is not installed, these fields are left 
blank.  I've used this to prioritize which packages (and then which 
functions) I should consider first. 


      Best Wishes,
      Spencer

> Best,
> Andy
>
>
>  
>   
>> Gabor Grothendieck wrote:
>>     
>>> On Thu, Jun 4, 2009 at 12:13 PM, Duncan Murdoch 
>>>       
>> <murdoch at stats.uwo.ca> wrote:
>>     
>>>   
>>>       
>>>> Gabor Grothendieck wrote:
>>>>     
>>>>         
>>>>> On Thu, Jun 4, 2009 at 1:58 AM, Duncan Murdoch 
>>>>>           
>> <murdoch at stats.uwo.ca>
>>     
>>>>> wrote:
>>>>>
>>>>>       
>>>>>           
>>>>>> spencerg wrote:
>>>>>>
>>>>>>         
>>>>>>             
>>>>>>> Hello All:
>>>>>>>
>>>>>>>     What do you think of adding a function "RSiteSeach" 
>>>>>>>               
>> to the package
>>     
>>>>>>> of
>>>>>>> that name, masking the "RSiteSearch" function in 
>>>>>>>               
>> "utils", trapping any
>>     
>>>>>>> call
>>>>>>> RSiteSearch('searchstring', 'function') to the current
>>>>>>> RSiteSearch.function
>>>>>>> and passing all others to "utils:::RSiteSearch"?  This 
>>>>>>>               
>> was suggested by
>>     
>>>>>>> a
>>>>>>> referee to a manuscript on this new capability 
>>>>>>>               
>> submitted to "R Journal".
>>     
>>>>>>>  The current version of this manuscript is available via
>>>>>>> "system.file('doc',
>>>>>>> 'RSiteSearch.pdf', package='RSiteSearch')" if you have 
>>>>>>>               
>> the "RSiteSearch"
>>     
>>>>>>> package installed.
>>>>>>>
>>>>>>>           
>>>>>>>               
>>>>>> I suppose this depends on your long term plans for the 
>>>>>>             
>> function and
>>     
>>>>>> package.
>>>>>>  If you think it should eventually replace the utils 
>>>>>>             
>> function, then it
>>     
>>>>>> makes
>>>>>> sense to use the same name:  users won't get used to a 
>>>>>>             
>> new name in the
>>     
>>>>>> meantime.  But if you think it will diverge from that 
>>>>>>             
>> function, then you
>>     
>>>>>> might as well pick a separate name now.
>>>>>>
>>>>>> I disagree with Gabor about this being heavy handed, at 
>>>>>>             
>> least while it is
>>     
>>>>>> the only significant export in the package.  If people 
>>>>>>             
>> don't want it,
>>     
>>>>>> don't
>>>>>> attach the package.
>>>>>>
>>>>>>
>>>>>>         
>>>>>>             
>>>>> The last sentence only gives you a choice of clobbering 
>>>>>           
>> the existing
>>     
>>>>> function or not using it and that is not very nice.   
>>>>>           
>> What is wanted is
>>     
>>>>> both to be able to use it and allow it to coexist in a nice way.
>>>>>
>>>>>       
>>>>>           
>>>> It is essentially a rename of the existing one to 
>>>>         
>> utils::RSiteSearch.  I
>>     
>>>> would only suggest this if RSiteSearch::RSiteSearch expanded on its
>>>> capabilities (which I think was Spencer's proposal), 
>>>>         
>> rather than replacing
>>     
>>>> them with something different.
>>>>
>>>>     
>>>>         
>>>>> How about R changing its RSiteSearch to be an S3 generic with the
>>>>> main functionality being placed into RSiteSearch.default?   Then
>>>>> RSiteSearch.function can become RsiteSearch.character and
>>>>>  - RSiteSearch will give the new functionality when the package is
>>>>> loaded and the old functionality if not.
>>>>> - RSiteSearch.character can be used in place of 
>>>>>           
>> RSiteSearch.function
>>     
>>>>> to force only the new functionality (or an error if not present)
>>>>> - RSiteSearch.default will give the old functionality 
>>>>>           
>> whether or not the
>>     
>>>>> package is loaded
>>>>>
>>>>> (If there is a NAMESPACE then Its assumed here that both 
>>>>>           
>> methods are
>>     
>>>>> exported.)
>>>>>
>>>>>       
>>>>>           
>>>> How is that an improvement?  Just replace your (RSiteSearch,
>>>> RSiteSearch.character, RSiteSearch.default) with (RSiteSearch,
>>>> RSiteSearch::RSiteSearch, utils::RSiteSearch) in my 
>>>>         
>> proposal and you get the
>>     
>>>> same behaviour.  The point isn't that Spencer has invented 
>>>>         
>> a way for
>>     
>>>> RSiteSearch to handle character vectors, it already knows 
>>>>         
>> that.  The point
>>     
>>>> is that he has enhanced it.  Or maybe he has written 
>>>>         
>> something similar but
>>     
>>>> different, in which case he should pick a new name.
>>>> Duncan Murdoch
>>>>
>>>>     
>>>>         
>>> He simply renames it RSiteSearch.character (and possibly some other
>>> changes depending on arguments). Then if the core cooperates
>>> by making RSiteSearch a generic with a default method then 
>>>       
>> everything
>>     
>>> works as one would expect based on an understanding of S3.
>>>
>>> No conflicts in names are involved.
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>>   
>>>       
>>     
> Notice:  This e-mail message, together with any attach...{{dropped:15}}


From Waclaw.Marcin.Kusnierczyk at idi.ntnu.no  Fri Jun  5 15:43:36 2009
From: Waclaw.Marcin.Kusnierczyk at idi.ntnu.no (Wacek Kusnierczyk)
Date: Fri, 05 Jun 2009 15:43:36 +0200
Subject: [Rd] Show location of workspace image on quit?
In-Reply-To: <1244205963.3903.4.camel@ubuntu>
References: <d8ad40b50906050453q5ae944e2v18cf12093e397ed1@mail.gmail.com>	<4A290C16.40102@stats.uwo.ca>
	<4A29115B.8060405@idi.ntnu.no> <1244205963.3903.4.camel@ubuntu>
Message-ID: <4A292108.1020705@idi.ntnu.no>

Mathieu Ribatet wrote:
> I guess that having something like this
>   
>> q()
>> Save workspace image (/home/me/workspace/.RData)? [y/n/c/e]:
>>     
>
> where "e" means Editing the path should be clear enought, isn't it?
>   

good idea;  maybe 'o' for 'other path';  or 'a' for 'alternative path'; 
or 'd' for 'different path'; or 'm' for 'modify path';  or 'p' for
'path';  or... ?


vQ


From b.rowlingson at lancaster.ac.uk  Fri Jun  5 15:46:42 2009
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Fri, 5 Jun 2009 14:46:42 +0100
Subject: [Rd] Show location of workspace image on quit?
In-Reply-To: <1244205963.3903.4.camel@ubuntu>
References: <d8ad40b50906050453q5ae944e2v18cf12093e397ed1@mail.gmail.com>
	<4A290C16.40102@stats.uwo.ca> <4A29115B.8060405@idi.ntnu.no>
	<1244205963.3903.4.camel@ubuntu>
Message-ID: <d8ad40b50906050646re07576ao5dc96695840eec9e@mail.gmail.com>

On Fri, Jun 5, 2009 at 1:46 PM, Mathieu Ribatet<mathieu.ribatet at epfl.ch> wrote:
> I guess that having something like this
>> q()
>> Save workspace image (/home/me/workspace/.RData)? [y/n/c/e]:
>
> where "e" means Editing the path should be clear enought, isn't it?

 'e' might be thought to mean 'exit' in English, which makes me think
we also need to make sure this can all be translated. Maybe 'p' for
path? Or 'e' for 'elsewhere'? This is getting tricky :)

 I think I'd rather leave off the 'e' option for simplicity - if the
user wants to save elsewhere they can hit 'c' and do save() or
setcwd()  themselves, I'm not sure we need to put extra functionality
into the q function.

Barry


From murdoch at stats.uwo.ca  Fri Jun  5 15:55:05 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Fri, 05 Jun 2009 09:55:05 -0400
Subject: [Rd] Show location of workspace image on quit?
In-Reply-To: <d8ad40b50906050646re07576ao5dc96695840eec9e@mail.gmail.com>
References: <d8ad40b50906050453q5ae944e2v18cf12093e397ed1@mail.gmail.com>	
	<4A290C16.40102@stats.uwo.ca> <4A29115B.8060405@idi.ntnu.no>	
	<1244205963.3903.4.camel@ubuntu>
	<d8ad40b50906050646re07576ao5dc96695840eec9e@mail.gmail.com>
Message-ID: <4A2923B9.8040200@stats.uwo.ca>

On 6/5/2009 9:46 AM, Barry Rowlingson wrote:
> On Fri, Jun 5, 2009 at 1:46 PM, Mathieu Ribatet<mathieu.ribatet at epfl.ch> wrote:
>> I guess that having something like this
>>> q()
>>> Save workspace image (/home/me/workspace/.RData)? [y/n/c/e]:
>>
>> where "e" means Editing the path should be clear enought, isn't it?
> 
>  'e' might be thought to mean 'exit' in English, which makes me think
> we also need to make sure this can all be translated. Maybe 'p' for
> path? Or 'e' for 'elsewhere'? This is getting tricky :)
> 
>  I think I'd rather leave off the 'e' option for simplicity - if the
> user wants to save elsewhere they can hit 'c' and do save() or
> setcwd()  themselves, I'm not sure we need to put extra functionality
> into the q function.

An alternative to think about is to report where the file was saved, 
rather than tease the user by suggesting s/he has a choice.  This is a 
bit harder in the GUIs, but would be very easy in a console, just print 
the path after quitting:

Save workspace image? [y/n/c]: y
Image saved to /home/me/workspace/.RData

In the Windows GUI you could pop up a dialog box to say this, with a 
checkbox saying "don't show me this next time".

Duncan Murdoch


From ronggui.huang at gmail.com  Fri Jun  5 15:55:58 2009
From: ronggui.huang at gmail.com (Ronggui Huang)
Date: Fri, 5 Jun 2009 21:55:58 +0800
Subject: [Rd] Show location of workspace image on quit?
In-Reply-To: <4A292108.1020705@idi.ntnu.no>
References: <d8ad40b50906050453q5ae944e2v18cf12093e397ed1@mail.gmail.com> 
	<4A290C16.40102@stats.uwo.ca> <4A29115B.8060405@idi.ntnu.no> 
	<1244205963.3903.4.camel@ubuntu> <4A292108.1020705@idi.ntnu.no>
Message-ID: <38b9f0350906050655v2c9c912dxaa87004e5be27486@mail.gmail.com>

I think e is better than others.

Ronggui

2009/6/5 Wacek Kusnierczyk <Waclaw.Marcin.Kusnierczyk at idi.ntnu.no>:
> Mathieu Ribatet wrote:
>> I guess that having something like this
>>
>>> q()
>>> Save workspace image (/home/me/workspace/.RData)? [y/n/c/e]:
>>>
>>
>> where "e" means Editing the path should be clear enought, isn't it?
>>
>
> good idea; ?maybe 'o' for 'other path'; ?or 'a' for 'alternative path';
> or 'd' for 'different path'; or 'm' for 'modify path'; ?or 'p' for
> 'path'; ?or... ?
>
>
> vQ
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>



-- 
HUANG Ronggui, Wincent
PhD Candidate
Dept of Public and Social Administration
City University of Hong Kong
Home page: http://asrr.r-forge.r-project.org/rghuang.html


From ggrothendieck at gmail.com  Fri Jun  5 16:01:07 2009
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Fri, 5 Jun 2009 10:01:07 -0400
Subject: [Rd] Show location of workspace image on quit?
In-Reply-To: <4A292108.1020705@idi.ntnu.no>
References: <d8ad40b50906050453q5ae944e2v18cf12093e397ed1@mail.gmail.com> 
	<4A290C16.40102@stats.uwo.ca> <4A29115B.8060405@idi.ntnu.no> 
	<1244205963.3903.4.camel@ubuntu> <4A292108.1020705@idi.ntnu.no>
Message-ID: <971536df0906050701x3cb8bc81vb3930d27f9c96ff1@mail.gmail.com>

On Fri, Jun 5, 2009 at 9:43 AM, Wacek
Kusnierczyk<Waclaw.Marcin.Kusnierczyk at idi.ntnu.no> wrote:
> Mathieu Ribatet wrote:
>> I guess that having something like this
>>
>>> q()
>>> Save workspace image (/home/me/workspace/.RData)? [y/n/c/e]:
>>>
>>
>> where "e" means Editing the path should be clear enought, isn't it?
>>
>
> good idea; ?maybe 'o' for 'other path'; ?or 'a' for 'alternative path';
> or 'd' for 'different path'; or 'm' for 'modify path'; ?or 'p' for
> 'path'; ?or... ?

or perhaps clearer:

Save workspace to /home/me/workspace/.RData? [ y(es) / (n(o) /
c(ancel) / o(ther) ]:


From murdoch at stats.uwo.ca  Fri Jun  5 16:10:28 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Fri, 05 Jun 2009 10:10:28 -0400
Subject: [Rd] proposed changes to RSiteSearch
In-Reply-To: <4A292093.2030400@prodsyse.com>
References: <39B6DDB9048D0F4DAD42CB26AAFF0AFA07381973@usctmx1106.merck.com>	<20090507180930.GA1619@psych.upenn.edu>	<39B6DDB9048D0F4DAD42CB26AAFF0AFA073C4758@usctmx1106.merck.com>	<4A032E6F.8010001@dbmail.com>	<20090507192632.GA4723@psych.upenn.edu>	<39B6DDB9048D0F4DAD42CB26AAFF0AFA073C4844@usctmx1106.merck.com>	<4A26ED1D.1020407@prodsyse.com>
	<4A276278.3050404@stats.uwo.ca>	<971536df0906040430s14c3f78fy2b1f639dfd3ce209@mail.gmail.com>	<4A27F2A5.70705@stats.uwo.ca>	<971536df0906040923s7e791559vc217183e59742902@mail.gmail.com>	<4A28A76F.2080600@prodsyse.com>	<39B6DDB9048D0F4DAD42CB26AAFF0AFA075A960C@usctmx1106.merck.com>
	<4A292093.2030400@prodsyse.com>
Message-ID: <4A292754.90302@stats.uwo.ca>

On 6/5/2009 9:41 AM, spencerg wrote:
> Liaw, Andy wrote:
>> From: spencerg
>>   
>>>       Thank you all for your suggestions.  My goal with this 
>>> is to make 
>>> it as easy as possible for R users to find what they want in 
>>> contributed 
>>> packages.  A referee for our "R Journal" manuscript complained that 
>>> "RSiteSearch.function" was too much to type, suggesting we consider 
>>> masking "RSiteSearch".  From the discussion, I do not see a strong 
>>> consensus for doing that.  I like Romain's suggestion to shorten the 
>>> name further to, e.g., "web.search" or "doc.search".  Another 
>>> colleague 
>>> suggested "RSearch". 
>>>
>>>
>>>       What do you think about renaming the current 
>>> "RSiteSearch.function{RSiteSearch}" to "RSearch{RSearch}"? 
>>>
>>>
>>>       I'm happy to support the consensus of this group on a name (and 
>>> even enhancements) that seems likely to maximize its utility to R 
>>> users.  I ask, because a rose by any other name would smell as sweet, 
>>> but one named "prettysweetsmellingthingamabob" might not sell 
>>> as well. 
>>>
>>>
>>>       Thanks,
>>>       Spencer     
>>>     
>>
>> [I've removed those on cc since I believe everyone will get this through
>> R-devel anyway...]
>>
>> I'd suggest something like findFunction() or some such, if the main goal
>> is to look for functions (not manuals, vignettes, mailing lists, etc.).
>>   
>       "findFunction" sounds to me like the best name I've heard so far. 

But it isn't looking for functions, it's looking for help pages about 
functions.  Another possibility is ???, e.g.

???topic

This is done by masking the utils function `?`, and you'd have to be 
careful to pass along requests with one or two (or more than three?) 
question marks to the original; it also feels a bit strange to type

hits <- ???topic

though I think it's syntactic and well-defined.  I'm not sure how you'd 
include your optional arguments, it would be really weird (but again 
well defined) to say

z <- ???spline(maxPages = 2)

(Your first example in ?RSiteSearch.function, translated).

Duncan Murdoch

> 
>> RSiteSearch() was named what it was because it was meant as an interface
>> to Jon's search site that has lots of things related to R.  
>>
>> It seems to me that the recent discussion has been about including other
>> alternative search engines, etc.  Recall that when we were discussing
>> including RSiteSearch() into base R, Jon basically had to commit to
>> maintaining the site, as well as documenting how to replicate the site
>> if and when he could no longer maintain it, before R Core accepted the
>> function.  I think it would be wonderful to have a search facility
>> that's all encompassing ("Roogle"?), but for inclusion into base R we
>> really need to have the sites being searched being basically permenant.
>>
>> Perhaps a bit OT, but what would really be nice is if a search facility
>> can not only find functions that's related to some search phrase, but
>> also indicate whether the packages the functions belong to have already
>> been installed on the user's system.  Sort of like "yum info" or "yum
>> search" for those on RedHat-based Linux...
>>   
>       The current RSiteSeach package includes that adds other 
> information from packageDescription to the package summary, adding 
> (current default) "Title", "Version", "Author", "Maintainer", and (date) 
> "Packaged".  If the package is not installed, these fields are left 
> blank.  I've used this to prioritize which packages (and then which 
> functions) I should consider first. 
> 
> 
>       Best Wishes,
>       Spencer
> 
>> Best,
>> Andy
>>
>>
>>  
>>   
>>> Gabor Grothendieck wrote:
>>>     
>>>> On Thu, Jun 4, 2009 at 12:13 PM, Duncan Murdoch 
>>>>       
>>> <murdoch at stats.uwo.ca> wrote:
>>>     
>>>>   
>>>>       
>>>>> Gabor Grothendieck wrote:
>>>>>     
>>>>>         
>>>>>> On Thu, Jun 4, 2009 at 1:58 AM, Duncan Murdoch 
>>>>>>           
>>> <murdoch at stats.uwo.ca>
>>>     
>>>>>> wrote:
>>>>>>
>>>>>>       
>>>>>>           
>>>>>>> spencerg wrote:
>>>>>>>
>>>>>>>         
>>>>>>>             
>>>>>>>> Hello All:
>>>>>>>>
>>>>>>>>     What do you think of adding a function "RSiteSeach" 
>>>>>>>>               
>>> to the package
>>>     
>>>>>>>> of
>>>>>>>> that name, masking the "RSiteSearch" function in 
>>>>>>>>               
>>> "utils", trapping any
>>>     
>>>>>>>> call
>>>>>>>> RSiteSearch('searchstring', 'function') to the current
>>>>>>>> RSiteSearch.function
>>>>>>>> and passing all others to "utils:::RSiteSearch"?  This 
>>>>>>>>               
>>> was suggested by
>>>     
>>>>>>>> a
>>>>>>>> referee to a manuscript on this new capability 
>>>>>>>>               
>>> submitted to "R Journal".
>>>     
>>>>>>>>  The current version of this manuscript is available via
>>>>>>>> "system.file('doc',
>>>>>>>> 'RSiteSearch.pdf', package='RSiteSearch')" if you have 
>>>>>>>>               
>>> the "RSiteSearch"
>>>     
>>>>>>>> package installed.
>>>>>>>>
>>>>>>>>           
>>>>>>>>               
>>>>>>> I suppose this depends on your long term plans for the 
>>>>>>>             
>>> function and
>>>     
>>>>>>> package.
>>>>>>>  If you think it should eventually replace the utils 
>>>>>>>             
>>> function, then it
>>>     
>>>>>>> makes
>>>>>>> sense to use the same name:  users won't get used to a 
>>>>>>>             
>>> new name in the
>>>     
>>>>>>> meantime.  But if you think it will diverge from that 
>>>>>>>             
>>> function, then you
>>>     
>>>>>>> might as well pick a separate name now.
>>>>>>>
>>>>>>> I disagree with Gabor about this being heavy handed, at 
>>>>>>>             
>>> least while it is
>>>     
>>>>>>> the only significant export in the package.  If people 
>>>>>>>             
>>> don't want it,
>>>     
>>>>>>> don't
>>>>>>> attach the package.
>>>>>>>
>>>>>>>
>>>>>>>         
>>>>>>>             
>>>>>> The last sentence only gives you a choice of clobbering 
>>>>>>           
>>> the existing
>>>     
>>>>>> function or not using it and that is not very nice.   
>>>>>>           
>>> What is wanted is
>>>     
>>>>>> both to be able to use it and allow it to coexist in a nice way.
>>>>>>
>>>>>>       
>>>>>>           
>>>>> It is essentially a rename of the existing one to 
>>>>>         
>>> utils::RSiteSearch.  I
>>>     
>>>>> would only suggest this if RSiteSearch::RSiteSearch expanded on its
>>>>> capabilities (which I think was Spencer's proposal), 
>>>>>         
>>> rather than replacing
>>>     
>>>>> them with something different.
>>>>>
>>>>>     
>>>>>         
>>>>>> How about R changing its RSiteSearch to be an S3 generic with the
>>>>>> main functionality being placed into RSiteSearch.default?   Then
>>>>>> RSiteSearch.function can become RsiteSearch.character and
>>>>>>  - RSiteSearch will give the new functionality when the package is
>>>>>> loaded and the old functionality if not.
>>>>>> - RSiteSearch.character can be used in place of 
>>>>>>           
>>> RSiteSearch.function
>>>     
>>>>>> to force only the new functionality (or an error if not present)
>>>>>> - RSiteSearch.default will give the old functionality 
>>>>>>           
>>> whether or not the
>>>     
>>>>>> package is loaded
>>>>>>
>>>>>> (If there is a NAMESPACE then Its assumed here that both 
>>>>>>           
>>> methods are
>>>     
>>>>>> exported.)
>>>>>>
>>>>>>       
>>>>>>           
>>>>> How is that an improvement?  Just replace your (RSiteSearch,
>>>>> RSiteSearch.character, RSiteSearch.default) with (RSiteSearch,
>>>>> RSiteSearch::RSiteSearch, utils::RSiteSearch) in my 
>>>>>         
>>> proposal and you get the
>>>     
>>>>> same behaviour.  The point isn't that Spencer has invented 
>>>>>         
>>> a way for
>>>     
>>>>> RSiteSearch to handle character vectors, it already knows 
>>>>>         
>>> that.  The point
>>>     
>>>>> is that he has enhanced it.  Or maybe he has written 
>>>>>         
>>> something similar but
>>>     
>>>>> different, in which case he should pick a new name.
>>>>> Duncan Murdoch
>>>>>
>>>>>     
>>>>>         
>>>> He simply renames it RSiteSearch.character (and possibly some other
>>>> changes depending on arguments). Then if the core cooperates
>>>> by making RSiteSearch a generic with a default method then 
>>>>       
>>> everything
>>>     
>>>> works as one would expect based on an understanding of S3.
>>>>
>>>> No conflicts in names are involved.
>>>>
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>
>>>>   
>>>>       
>>>     
>> Notice:  This e-mail message, together with any attach...{{dropped:15}}
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From gavin.simpson at ucl.ac.uk  Fri Jun  5 16:13:07 2009
From: gavin.simpson at ucl.ac.uk (Gavin Simpson)
Date: Fri, 05 Jun 2009 15:13:07 +0100
Subject: [Rd] Bug in print.Arima and patch
Message-ID: <1244211187.2592.81.camel@desktop.localhost>

Dear List,

A posting to R-Help exposed this problem with the print method for
objects of class Arima:

> set.seed(1)
> x <- arima.sim(n = 100, list(ar = 0.8897, ma = -0.2279))
> mod <- arima(x, order = c(1,0,1))
> coefs <- coef(mod)
> mod2 <- arima(x, order = c(1,0,1), fixed = coefs)
> mod2

Call:
arima(x = x, order = c(1, 0, 1), fixed = coefs)

Coefficients:
Error in se && nrow(x$var.coef) : invalid 'y' type in 'x && y'
> print(mod2, se = FALSE)

Call:
arima(x = x, order = c(1, 0, 1), fixed = coefs)

Coefficients:
      ar1        ma1  intercept  
   0.9323    -0.2940    -0.0353  

sigma^2 estimated as 0.8339:  log likelihood = -133.55,  aic = 269.11

The print methods raises an error in this case, where all coefficients
are fixed, because x$var.coef is of length(0), which in turn results in
NULL being used in the && comparison, resulting in the error.

A potential fix is to just include a check for length(x$var.coef) > 0 in
the if statement. This fix, when applied to:

R version 2.10.0 Under development (unstable) (2009-06-05 r48712)

fixes this particular problem and passes make check-devel. A patch
against r48712 is attached, and included here in-line:

[gavin at desktop build]$ svn diff ../src/library/stats/R/arima.R
Index: ../src/library/stats/R/arima.R
===================================================================
--- ../src/library/stats/R/arima.R	(revision 48712)
+++ ../src/library/stats/R/arima.R	(working copy)
@@ -355,7 +355,7 @@
     if (length(x$coef)) {
         cat("Coefficients:\n")
         coef <- round(x$coef, digits = digits)
-        if (se && nrow(x$var.coef)) {
+        if (se && length(x$var.coef) > 0 && nrow(x$var.coef)) {
             ses <- rep(0, length(coef))
             ses[x$mask] <- round(sqrt(diag(x$var.coef)), digits = digits)
             coef <- matrix(coef, 1L, dimnames = list(NULL, names(coef)))

HTH

G
-- 
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
 Dr. Gavin Simpson             [t] +44 (0)20 7679 0522
 ECRC, UCL Geography,          [f] +44 (0)20 7679 0565
 Pearson Building,             [e] gavin.simpsonATNOSPAMucl.ac.uk
 Gower Street, London          [w] http://www.ucl.ac.uk/~ucfagls/
 UK. WC1E 6BT.                 [w] http://www.freshwaters.org.uk
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%

-------------- next part --------------
A non-text attachment was scrubbed...
Name: print.Arima.patch
Type: text/x-patch
Size: 642 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090605/5f85727f/attachment.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 197 bytes
Desc: This is a digitally signed message part
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090605/5f85727f/attachment-0001.bin>

From ripley at stats.ox.ac.uk  Fri Jun  5 16:39:57 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 5 Jun 2009 15:39:57 +0100 (BST)
Subject: [Rd] Show location of workspace image on quit?
In-Reply-To: <4A2923B9.8040200@stats.uwo.ca>
References: <d8ad40b50906050453q5ae944e2v18cf12093e397ed1@mail.gmail.com>
	<4A290C16.40102@stats.uwo.ca> <4A29115B.8060405@idi.ntnu.no>
	<1244205963.3903.4.camel@ubuntu>
	<d8ad40b50906050646re07576ao5dc96695840eec9e@mail.gmail.com>
	<4A2923B9.8040200@stats.uwo.ca>
Message-ID: <alpine.LFD.2.00.0906051528380.13402@gannet.stats.ox.ac.uk>

Any change here is not so simple to implement as to propose: this is 
not something in the R engine, but part of the clean-up action in the 
front end.  That means that there are at least 3 versions to handle in 
the standard front ends (and that for R.app is not in the main source 
tarball).  And at least two of them is offered for translation so 
there are many copies.  Then there are other front-ends such as JGR 
and RKward ....

I hope people proposing this will offer complete patches.

On Fri, 5 Jun 2009, Duncan Murdoch wrote:

> On 6/5/2009 9:46 AM, Barry Rowlingson wrote:
>> On Fri, Jun 5, 2009 at 1:46 PM, Mathieu Ribatet<mathieu.ribatet at epfl.ch> 
>> wrote:
>>> I guess that having something like this
>>>> q()
>>>> Save workspace image (/home/me/workspace/.RData)? [y/n/c/e]:
>>> 
>>> where "e" means Editing the path should be clear enought, isn't it?
>>
>>  'e' might be thought to mean 'exit' in English, which makes me think
>> we also need to make sure this can all be translated. Maybe 'p' for
>> path? Or 'e' for 'elsewhere'? This is getting tricky :)
>>
>>  I think I'd rather leave off the 'e' option for simplicity - if the
>> user wants to save elsewhere they can hit 'c' and do save() or
>> setcwd()  themselves, I'm not sure we need to put extra functionality
>> into the q function.
>
> An alternative to think about is to report where the file was saved, rather 
> than tease the user by suggesting s/he has a choice.  This is a bit harder in 
> the GUIs, but would be very easy in a console, just print the path after 
> quitting:
>
> Save workspace image? [y/n/c]: y
> Image saved to /home/me/workspace/.RData
>
> In the Windows GUI you could pop up a dialog box to say this, with a checkbox 
> saying "don't show me this next time".
>
> Duncan Murdoch
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Fri Jun  5 16:42:02 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 5 Jun 2009 15:42:02 +0100 (BST)
Subject: [Rd] Bug in print.Arima and patch
In-Reply-To: <1244211187.2592.81.camel@desktop.localhost>
References: <1244211187.2592.81.camel@desktop.localhost>
Message-ID: <alpine.LFD.2.00.0906051541210.13402@gannet.stats.ox.ac.uk>

Why not use NROW?

On Fri, 5 Jun 2009, Gavin Simpson wrote:

> Dear List,
>
> A posting to R-Help exposed this problem with the print method for
> objects of class Arima:
>
>> set.seed(1)
>> x <- arima.sim(n = 100, list(ar = 0.8897, ma = -0.2279))
>> mod <- arima(x, order = c(1,0,1))
>> coefs <- coef(mod)
>> mod2 <- arima(x, order = c(1,0,1), fixed = coefs)
>> mod2
>
> Call:
> arima(x = x, order = c(1, 0, 1), fixed = coefs)
>
> Coefficients:
> Error in se && nrow(x$var.coef) : invalid 'y' type in 'x && y'
>> print(mod2, se = FALSE)
>
> Call:
> arima(x = x, order = c(1, 0, 1), fixed = coefs)
>
> Coefficients:
>      ar1        ma1  intercept
>   0.9323    -0.2940    -0.0353
>
> sigma^2 estimated as 0.8339:  log likelihood = -133.55,  aic = 269.11
>
> The print methods raises an error in this case, where all coefficients
> are fixed, because x$var.coef is of length(0), which in turn results in
> NULL being used in the && comparison, resulting in the error.
>
> A potential fix is to just include a check for length(x$var.coef) > 0 in
> the if statement. This fix, when applied to:
>
> R version 2.10.0 Under development (unstable) (2009-06-05 r48712)
>
> fixes this particular problem and passes make check-devel. A patch
> against r48712 is attached, and included here in-line:
>
> [gavin at desktop build]$ svn diff ../src/library/stats/R/arima.R
> Index: ../src/library/stats/R/arima.R
> ===================================================================
> --- ../src/library/stats/R/arima.R	(revision 48712)
> +++ ../src/library/stats/R/arima.R	(working copy)
> @@ -355,7 +355,7 @@
>     if (length(x$coef)) {
>         cat("Coefficients:\n")
>         coef <- round(x$coef, digits = digits)
> -        if (se && nrow(x$var.coef)) {
> +        if (se && length(x$var.coef) > 0 && nrow(x$var.coef)) {
>             ses <- rep(0, length(coef))
>             ses[x$mask] <- round(sqrt(diag(x$var.coef)), digits = digits)
>             coef <- matrix(coef, 1L, dimnames = list(NULL, names(coef)))
>
> HTH
>
> G
> -- 
> %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
> Dr. Gavin Simpson             [t] +44 (0)20 7679 0522
> ECRC, UCL Geography,          [f] +44 (0)20 7679 0565
> Pearson Building,             [e] gavin.simpsonATNOSPAMucl.ac.uk
> Gower Street, London          [w] http://www.ucl.ac.uk/~ucfagls/
> UK. WC1E 6BT.                 [w] http://www.freshwaters.org.uk
> %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From gavin.simpson at ucl.ac.uk  Fri Jun  5 17:01:04 2009
From: gavin.simpson at ucl.ac.uk (Gavin Simpson)
Date: Fri, 05 Jun 2009 16:01:04 +0100
Subject: [Rd] Bug in print.Arima and patch
In-Reply-To: <alpine.LFD.2.00.0906051541210.13402@gannet.stats.ox.ac.uk>
References: <1244211187.2592.81.camel@desktop.localhost>
	<alpine.LFD.2.00.0906051541210.13402@gannet.stats.ox.ac.uk>
Message-ID: <1244214064.2592.88.camel@desktop.localhost>

On Fri, 2009-06-05 at 15:42 +0100, Prof Brian Ripley wrote:
> Why not use NROW?

No reason - had forgotten this existed.

So here is another patch:

[gavin at desktop ~]$ svn diff ~/R/devel/src/
Index: /home/gavin/R/devel/src/library/stats/R/arima.R
===================================================================
--- /home/gavin/R/devel/src/library/stats/R/arima.R	(revision 48712)
+++ /home/gavin/R/devel/src/library/stats/R/arima.R	(working copy)
@@ -355,7 +355,7 @@
     if (length(x$coef)) {
         cat("Coefficients:\n")
         coef <- round(x$coef, digits = digits)
-        if (se && nrow(x$var.coef)) {
+        if (se && NROW(x$var.coef)) {
             ses <- rep(0, length(coef))
             ses[x$mask] <- round(sqrt(diag(x$var.coef)), digits =
digits)
             coef <- matrix(coef, 1L, dimnames = list(NULL,
names(coef)))

And the same is attached, that implements your suggested change rather
than the one I sent earlier.

Cheers,

G

> 
> On Fri, 5 Jun 2009, Gavin Simpson wrote:
> 
> > Dear List,
> >
> > A posting to R-Help exposed this problem with the print method for
> > objects of class Arima:
> >
> >> set.seed(1)
> >> x <- arima.sim(n = 100, list(ar = 0.8897, ma = -0.2279))
> >> mod <- arima(x, order = c(1,0,1))
> >> coefs <- coef(mod)
> >> mod2 <- arima(x, order = c(1,0,1), fixed = coefs)
> >> mod2
> >
> > Call:
> > arima(x = x, order = c(1, 0, 1), fixed = coefs)
> >
> > Coefficients:
> > Error in se && nrow(x$var.coef) : invalid 'y' type in 'x && y'
> >> print(mod2, se = FALSE)
> >
> > Call:
> > arima(x = x, order = c(1, 0, 1), fixed = coefs)
> >
> > Coefficients:
> >      ar1        ma1  intercept
> >   0.9323    -0.2940    -0.0353
> >
> > sigma^2 estimated as 0.8339:  log likelihood = -133.55,  aic = 269.11
> >
> > The print methods raises an error in this case, where all coefficients
> > are fixed, because x$var.coef is of length(0), which in turn results in
> > NULL being used in the && comparison, resulting in the error.
> >
> > A potential fix is to just include a check for length(x$var.coef) > 0 in
> > the if statement. This fix, when applied to:
> >
> > R version 2.10.0 Under development (unstable) (2009-06-05 r48712)
> >
> > fixes this particular problem and passes make check-devel. A patch
> > against r48712 is attached, and included here in-line:
> >
> > [gavin at desktop build]$ svn diff ../src/library/stats/R/arima.R
> > Index: ../src/library/stats/R/arima.R
> > ===================================================================
> > --- ../src/library/stats/R/arima.R	(revision 48712)
> > +++ ../src/library/stats/R/arima.R	(working copy)
> > @@ -355,7 +355,7 @@
> >     if (length(x$coef)) {
> >         cat("Coefficients:\n")
> >         coef <- round(x$coef, digits = digits)
> > -        if (se && nrow(x$var.coef)) {
> > +        if (se && length(x$var.coef) > 0 && nrow(x$var.coef)) {
> >             ses <- rep(0, length(coef))
> >             ses[x$mask] <- round(sqrt(diag(x$var.coef)), digits = digits)
> >             coef <- matrix(coef, 1L, dimnames = list(NULL, names(coef)))
> >
> > HTH
> >
> > G
> > -- 
> > %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
> > Dr. Gavin Simpson             [t] +44 (0)20 7679 0522
> > ECRC, UCL Geography,          [f] +44 (0)20 7679 0565
> > Pearson Building,             [e] gavin.simpsonATNOSPAMucl.ac.uk
> > Gower Street, London          [w] http://www.ucl.ac.uk/~ucfagls/
> > UK. WC1E 6BT.                 [w] http://www.freshwaters.org.uk
> > %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
> >
> >
> 
-- 
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
 Dr. Gavin Simpson             [t] +44 (0)20 7679 0522
 ECRC, UCL Geography,          [f] +44 (0)20 7679 0565
 Pearson Building,             [e] gavin.simpsonATNOSPAMucl.ac.uk
 Gower Street, London          [w] http://www.ucl.ac.uk/~ucfagls/
 UK. WC1E 6BT.                 [w] http://www.freshwaters.org.uk
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%

-------------- next part --------------
A non-text attachment was scrubbed...
Name: print.Arima.patch
Type: text/x-patch
Size: 667 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090605/dff5180f/attachment.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 197 bytes
Desc: This is a digitally signed message part
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090605/dff5180f/attachment-0001.bin>

From b.rowlingson at lancaster.ac.uk  Fri Jun  5 17:52:02 2009
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Fri, 5 Jun 2009 16:52:02 +0100
Subject: [Rd] Show location of workspace image on quit?
In-Reply-To: <971536df0906050701x3cb8bc81vb3930d27f9c96ff1@mail.gmail.com>
References: <d8ad40b50906050453q5ae944e2v18cf12093e397ed1@mail.gmail.com>
	<4A290C16.40102@stats.uwo.ca> <4A29115B.8060405@idi.ntnu.no>
	<1244205963.3903.4.camel@ubuntu> <4A292108.1020705@idi.ntnu.no>
	<971536df0906050701x3cb8bc81vb3930d27f9c96ff1@mail.gmail.com>
Message-ID: <d8ad40b50906050852y310639eblbe1fe12424735cc9@mail.gmail.com>

On Fri, Jun 5, 2009 at 3:01 PM, Gabor
Grothendieck<ggrothendieck at gmail.com> wrote:


>
> Save workspace to /home/me/workspace/.RData? [ y(es) / (n(o) /
> c(ancel) / o(ther) ]:

 Quitting emacs produces this:

Save file /foo/bar/baz.qux? (y, n, !, ., q, C-r, d or C-h)

 I'm not sure what any other than the first two do. I don't think I've
ever used them. Plus there's no mention of the option I usually do
when I hit save accidentally, which is C-g (the emacs generic 'panic'
button). I don't think I'd want R's quit function to be so verbose.

Barry


From ripley at stats.ox.ac.uk  Fri Jun  5 17:52:51 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 5 Jun 2009 16:52:51 +0100 (BST)
Subject: [Rd] Bug in print.Arima and patch
In-Reply-To: <1244214064.2592.88.camel@desktop.localhost>
References: <1244211187.2592.81.camel@desktop.localhost>
	<alpine.LFD.2.00.0906051541210.13402@gannet.stats.ox.ac.uk>
	<1244214064.2592.88.camel@desktop.localhost>
Message-ID: <alpine.LFD.2.00.0906051651340.14582@gannet.stats.ox.ac.uk>

On Fri, 5 Jun 2009, Gavin Simpson wrote:

> On Fri, 2009-06-05 at 15:42 +0100, Prof Brian Ripley wrote:
>> Why not use NROW?
>
> No reason - had forgotten this existed.

I was testing NROW after having seen the R-help message, so will go 
ahead with that solution.  But as I was doing so, something urgent 
came up locally ....

Thank you for looking into the issue.

>
> So here is another patch:
>
> [gavin at desktop ~]$ svn diff ~/R/devel/src/
> Index: /home/gavin/R/devel/src/library/stats/R/arima.R
> ===================================================================
> --- /home/gavin/R/devel/src/library/stats/R/arima.R	(revision 48712)
> +++ /home/gavin/R/devel/src/library/stats/R/arima.R	(working copy)
> @@ -355,7 +355,7 @@
>     if (length(x$coef)) {
>         cat("Coefficients:\n")
>         coef <- round(x$coef, digits = digits)
> -        if (se && nrow(x$var.coef)) {
> +        if (se && NROW(x$var.coef)) {
>             ses <- rep(0, length(coef))
>             ses[x$mask] <- round(sqrt(diag(x$var.coef)), digits =
> digits)
>             coef <- matrix(coef, 1L, dimnames = list(NULL,
> names(coef)))
>
> And the same is attached, that implements your suggested change rather
> than the one I sent earlier.
>
> Cheers,
>
> G
>
>>
>> On Fri, 5 Jun 2009, Gavin Simpson wrote:
>>
>>> Dear List,
>>>
>>> A posting to R-Help exposed this problem with the print method for
>>> objects of class Arima:
>>>
>>>> set.seed(1)
>>>> x <- arima.sim(n = 100, list(ar = 0.8897, ma = -0.2279))
>>>> mod <- arima(x, order = c(1,0,1))
>>>> coefs <- coef(mod)
>>>> mod2 <- arima(x, order = c(1,0,1), fixed = coefs)
>>>> mod2
>>>
>>> Call:
>>> arima(x = x, order = c(1, 0, 1), fixed = coefs)
>>>
>>> Coefficients:
>>> Error in se && nrow(x$var.coef) : invalid 'y' type in 'x && y'
>>>> print(mod2, se = FALSE)
>>>
>>> Call:
>>> arima(x = x, order = c(1, 0, 1), fixed = coefs)
>>>
>>> Coefficients:
>>>      ar1        ma1  intercept
>>>   0.9323    -0.2940    -0.0353
>>>
>>> sigma^2 estimated as 0.8339:  log likelihood = -133.55,  aic = 269.11
>>>
>>> The print methods raises an error in this case, where all coefficients
>>> are fixed, because x$var.coef is of length(0), which in turn results in
>>> NULL being used in the && comparison, resulting in the error.
>>>
>>> A potential fix is to just include a check for length(x$var.coef) > 0 in
>>> the if statement. This fix, when applied to:
>>>
>>> R version 2.10.0 Under development (unstable) (2009-06-05 r48712)
>>>
>>> fixes this particular problem and passes make check-devel. A patch
>>> against r48712 is attached, and included here in-line:
>>>
>>> [gavin at desktop build]$ svn diff ../src/library/stats/R/arima.R
>>> Index: ../src/library/stats/R/arima.R
>>> ===================================================================
>>> --- ../src/library/stats/R/arima.R	(revision 48712)
>>> +++ ../src/library/stats/R/arima.R	(working copy)
>>> @@ -355,7 +355,7 @@
>>>     if (length(x$coef)) {
>>>         cat("Coefficients:\n")
>>>         coef <- round(x$coef, digits = digits)
>>> -        if (se && nrow(x$var.coef)) {
>>> +        if (se && length(x$var.coef) > 0 && nrow(x$var.coef)) {
>>>             ses <- rep(0, length(coef))
>>>             ses[x$mask] <- round(sqrt(diag(x$var.coef)), digits = digits)
>>>             coef <- matrix(coef, 1L, dimnames = list(NULL, names(coef)))
>>>
>>> HTH
>>>
>>> G
>>> --
>>> %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
>>> Dr. Gavin Simpson             [t] +44 (0)20 7679 0522
>>> ECRC, UCL Geography,          [f] +44 (0)20 7679 0565
>>> Pearson Building,             [e] gavin.simpsonATNOSPAMucl.ac.uk
>>> Gower Street, London          [w] http://www.ucl.ac.uk/~ucfagls/
>>> UK. WC1E 6BT.                 [w] http://www.freshwaters.org.uk
>>> %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
>>>
>>>
>>
> -- 
> %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
> Dr. Gavin Simpson             [t] +44 (0)20 7679 0522
> ECRC, UCL Geography,          [f] +44 (0)20 7679 0565
> Pearson Building,             [e] gavin.simpsonATNOSPAMucl.ac.uk
> Gower Street, London          [w] http://www.ucl.ac.uk/~ucfagls/
> UK. WC1E 6BT.                 [w] http://www.freshwaters.org.uk
> %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ggrothendieck at gmail.com  Fri Jun  5 18:02:22 2009
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Fri, 5 Jun 2009 12:02:22 -0400
Subject: [Rd] Show location of workspace image on quit?
In-Reply-To: <d8ad40b50906050852y310639eblbe1fe12424735cc9@mail.gmail.com>
References: <d8ad40b50906050453q5ae944e2v18cf12093e397ed1@mail.gmail.com> 
	<4A290C16.40102@stats.uwo.ca> <4A29115B.8060405@idi.ntnu.no> 
	<1244205963.3903.4.camel@ubuntu> <4A292108.1020705@idi.ntnu.no> 
	<971536df0906050701x3cb8bc81vb3930d27f9c96ff1@mail.gmail.com> 
	<d8ad40b50906050852y310639eblbe1fe12424735cc9@mail.gmail.com>
Message-ID: <971536df0906050902g5ace0a74pe45c7d290447e05e@mail.gmail.com>

On Fri, Jun 5, 2009 at 11:52 AM, Barry
Rowlingson<b.rowlingson at lancaster.ac.uk> wrote:
> On Fri, Jun 5, 2009 at 3:01 PM, Gabor
> Grothendieck<ggrothendieck at gmail.com> wrote:
>
>
>>
>> Save workspace to /home/me/workspace/.RData? [ y(es) / (n(o) /
>> c(ancel) / o(ther) ]:
>
> ?Quitting emacs produces this:
>
> Save file /foo/bar/baz.qux? (y, n, !, ., q, C-r, d or C-h)
>
> ?I'm not sure what any other than the first two do. I don't think I've
> ever used them. Plus there's no mention of the option I usually do
> when I hit save accidentally, which is C-g (the emacs generic 'panic'
> button). I don't think I'd want R's quit function to be so verbose.
>

The problem isn't really verbosity --- the problem is that one has no
idea what the options all mean.


From nachikethas at cox.net  Fri Jun  5 16:30:10 2009
From: nachikethas at cox.net (nachikethas at cox.net)
Date: Fri,  5 Jun 2009 16:30:10 +0200 (CEST)
Subject: [Rd] Bug in the package RODBC (PR#13745)
Message-ID: <20090605143010.75B212831FEC@mail.pubhealth.ku.dk>

Full_Name: N. Srinivasan
Version: 2.8.1
OS: Linux
Submission from: (NULL) (68.110.225.2)


* Installing *source* package 'RODBC' ...
checking for gcc... gcc -std=gnu99
checking for C compiler default output file name... a.out
checking whether the C compiler works... yes
checking whether we are cross compiling... no
checking for suffix of executables... 
checking for suffix of object files... o
checking whether we are using the GNU C compiler... yes
checking whether gcc -std=gnu99 accepts -g... yes
checking for gcc -std=gnu99 option to accept ANSI C... none needed
checking how to run the C preprocessor... gcc -std=gnu99 -E
checking for egrep... grep -E
checking for ANSI C header files... yes
checking for sys/types.h... yes
checking for sys/stat.h... yes
checking for stdlib.h... yes
checking for string.h... yes
checking for memory.h... yes
checking for strings.h... yes
checking for inttypes.h... yes
checking for stdint.h... yes
checking for unistd.h... yes
checking sql.h usability... no
checking sql.h presence... no
checking for sql.h... no
checking sqlext.h usability... no
checking sqlext.h presence... no
checking for sqlext.h... no
configure: error: "ODBC headers sql.h and sqlext.h not found"
ERROR: configuration failed for package 'RODBC'
** Removing '/home/user1/R-2.8.1/library/RODBC'

The downloaded packages are in
	/tmp/RtmpmB0FH5/downloaded_packages
Updating HTML index of packages in '.Library'
Warning message:
In install.packages("RODBC") :
  installation of package 'RODBC' had non-zero exit status
>


From marc_schwartz at me.com  Fri Jun  5 19:20:27 2009
From: marc_schwartz at me.com (marc_schwartz at me.com)
Date: Fri,  5 Jun 2009 19:20:27 +0200 (CEST)
Subject: [Rd] Bug in the package RODBC (PR#13745)
Message-ID: <20090605172028.2C80228320AF@mail.pubhealth.ku.dk>

On Jun 5, 2009, at 9:30 AM, nachikethas at cox.net wrote:

> Full_Name: N. Srinivasan
> Version: 2.8.1
> OS: Linux
> Submission from: (NULL) (68.110.225.2)
>
>
> * Installing *source* package 'RODBC' ...
> checking for gcc... gcc -std=gnu99
> checking for C compiler default output file name... a.out
> checking whether the C compiler works... yes
> checking whether we are cross compiling... no
> checking for suffix of executables...
> checking for suffix of object files... o
> checking whether we are using the GNU C compiler... yes
> checking whether gcc -std=gnu99 accepts -g... yes
> checking for gcc -std=gnu99 option to accept ANSI C... none needed
> checking how to run the C preprocessor... gcc -std=gnu99 -E
> checking for egrep... grep -E
> checking for ANSI C header files... yes
> checking for sys/types.h... yes
> checking for sys/stat.h... yes
> checking for stdlib.h... yes
> checking for string.h... yes
> checking for memory.h... yes
> checking for strings.h... yes
> checking for inttypes.h... yes
> checking for stdint.h... yes
> checking for unistd.h... yes
> checking sql.h usability... no
> checking sql.h presence... no
> checking for sql.h... no
> checking sqlext.h usability... no
> checking sqlext.h presence... no
> checking for sqlext.h... no
> configure: error: "ODBC headers sql.h and sqlext.h not found"
> ERROR: configuration failed for package 'RODBC'
> ** Removing '/home/user1/R-2.8.1/library/RODBC'
>
> The downloaded packages are in
> 	/tmp/RtmpmB0FH5/downloaded_packages
> Updating HTML index of packages in '.Library'
> Warning message:
> In install.packages("RODBC") :
>  installation of package 'RODBC' had non-zero exit status


That's not a bug.

You are missing the required header files as noted in the error message.

You need to have unixODBC AND the unixODBC development package  
installed as well. The latter has the header files.

You do not indicate what Linux distribution you are using, so we are  
going to be limited in providing additional details for resolution.

A search of the R-Help archives would have told you the above as it  
has come up frequently before. It would have saved you time and would  
have saved a member of R Core from having to manually process a bug  
report that was filed in error. Next time, please search the archives  
or post a message to R-Help if you are unsure.

HTH,

Marc Schwartz


From b.rowlingson at lancaster.ac.uk  Fri Jun  5 22:52:13 2009
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Fri, 5 Jun 2009 21:52:13 +0100
Subject: [Rd] Show location of workspace image on quit?
In-Reply-To: <971536df0906050902g5ace0a74pe45c7d290447e05e@mail.gmail.com>
References: <d8ad40b50906050453q5ae944e2v18cf12093e397ed1@mail.gmail.com>
	<4A290C16.40102@stats.uwo.ca> <4A29115B.8060405@idi.ntnu.no>
	<1244205963.3903.4.camel@ubuntu> <4A292108.1020705@idi.ntnu.no>
	<971536df0906050701x3cb8bc81vb3930d27f9c96ff1@mail.gmail.com>
	<d8ad40b50906050852y310639eblbe1fe12424735cc9@mail.gmail.com>
	<971536df0906050902g5ace0a74pe45c7d290447e05e@mail.gmail.com>
Message-ID: <d8ad40b50906051352r392b0ce9s460464d182a042f6@mail.gmail.com>

Here's a replacement 'q' function that spits out the path of the
workspace image:

q = function (save = "default", status = 0, runLast = TRUE)
{
cat(paste("Workspace image is
",file.path(getwd(),formals(save.image)$file),'\n'))
flush.console()
.Internal(quit(save, status, runLast))
}

Note the trickiness for getting the file name - without diving into
internals I can't see how q() gets the filename so I'm just robbing
the default value from save.image. The flush.console makes sure the
path is printed before Windows shows the confirmation dialog. Yes it
would be nicer if the path was included on the dialog, but that's
about 100 times as much work as adding two lines to the existing q
definition.

Anyway, that does the job for me.

Barry


From macrakis at alum.mit.edu  Fri Jun  5 23:22:55 2009
From: macrakis at alum.mit.edu (Stavros Macrakis)
Date: Fri, 5 Jun 2009 17:22:55 -0400
Subject: [Rd] sort/partial NA handling
Message-ID: <8b356f880906051422i77deeb78vec06f00b0237969a@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090605/350c00c9/attachment.pl>

From kynnjo at gmail.com  Sat Jun  6 00:22:58 2009
From: kynnjo at gmail.com (Kynn Jones)
Date: Fri, 5 Jun 2009 18:22:58 -0400
Subject: [Rd] need help with libtool/aclocal error
Message-ID: <c2350ba40906051522v72b04e0dodbf3c2ec18f0c8d1@mail.gmail.com>

I'm trying to build an executable for a program I wrote.  The
compilation steps go well, but the linking step fails with a libtool
"version mismatch" error.  My linking command has this prefix:

/path/to/R/bin/R CMD LINK gcc -g -std=gnu99 ... etc.

The error looks like this:

libtool: Version mismatch error.  This is libtool 2.2, but the
libtool: definition of this LT_INIT comes from libtool 2.2.6.
libtool: You should recreate aclocal.m4 with macros from libtool 2.2
libtool: and run autoconf again.


I have no idea what this error message is referring to.  The version
of libtool installed on the system is none of the ones mentioned in
this error:

% libtool --version
ltmain.sh (GNU libtool) 1.5.22 Debian 1.5.22-4 (1.1220.2.365
2005/12/18 22:14:06)

<FSF disclaimer>



The libtool in the R directory has version 2.2:

% /path/to/R/bin/libtool --version

ltmain.sh (GNU libtool) 2.2
Written by Gordon Matzigkeit <gord at gnu.ai.mit.edu>, 1996

<FSF disclaimer>


Strangely enough, this same libtool script has the following lines in
its source code:

# Which release of libtool.m4 was used?
macro_version=2.2.6
macro_revision=1.3012



I don't know what to make of this.

Be that as it may, does anyone know how I could get past this sticking point?

TIA!

G.

P.S. I should point out that the R I'm using is one that I just
compiled so that I could run R under valgrind.  Here's the ./configure
command I used before running make:

% ./configure --prefix=/path/to/R --enable-R-shlib --enable-BLAS-shlib
--with-valgrind-instrumentation=2


From spencer.graves at prodsyse.com  Sat Jun  6 02:32:11 2009
From: spencer.graves at prodsyse.com (spencerg)
Date: Fri, 05 Jun 2009 17:32:11 -0700
Subject: [Rd] proposed changes to RSiteSearch
In-Reply-To: <4A292754.90302@stats.uwo.ca>
References: <39B6DDB9048D0F4DAD42CB26AAFF0AFA07381973@usctmx1106.merck.com>	<20090507180930.GA1619@psych.upenn.edu>	<39B6DDB9048D0F4DAD42CB26AAFF0AFA073C4758@usctmx1106.merck.com>	<4A032E6F.8010001@dbmail.com>	<20090507192632.GA4723@psych.upenn.edu>	<39B6DDB9048D0F4DAD42CB26AAFF0AFA073C4844@usctmx1106.merck.com>	<4A26ED1D.1020407@prodsyse.com>
	<4A276278.3050404@stats.uwo.ca>	<971536df0906040430s14c3f78fy2b1f639dfd3ce209@mail.gmail.com>	<4A27F2A5.70705@stats.uwo.ca>	<971536df0906040923s7e791559vc217183e59742902@mail.gmail.com>	<4A28A76F.2080600@prodsyse.com>	<39B6DDB9048D0F4DAD42CB26AAFF0AFA075A960C@usctmx1106.merck.com>
	<4A292093.2030400@prodsyse.com> <4A292754.90302@stats.uwo.ca>
Message-ID: <4A29B90B.2090202@prodsyse.com>

Dear Andy, Duncan, et al. 


      Based on comments from Andy and Duncan, I'd like to revise my 
proposal as follows: 


           1.  Rename the current "RSiteSearch.function" to 
"findFunction" and the package name from "RSiteSearch.function" to 
"findFunction", with "findFun" being an alias for "findFunction". 


           2.  Try to write code so '???"differential equation"(999)' 
works the same as 'RSiteSearch.function("differential equation", 999)' 
does now. 


      What do you think?  I've made this as two steps, because I can do 
"1" myself, but I may need help to develop "2". 


      Thanks again for all your suggestions.
      Best Wishes,
      Spencer


Duncan Murdoch wrote:
> On 6/5/2009 9:41 AM, spencerg wrote:
>> Liaw, Andy wrote:
>>> From: spencerg
>>>  
>>>>       Thank you all for your suggestions.  My goal with this is to 
>>>> make it as easy as possible for R users to find what they want in 
>>>> contributed packages.  A referee for our "R Journal" manuscript 
>>>> complained that "RSiteSearch.function" was too much to type, 
>>>> suggesting we consider masking "RSiteSearch".  From the discussion, 
>>>> I do not see a strong consensus for doing that.  I like Romain's 
>>>> suggestion to shorten the name further to, e.g., "web.search" or 
>>>> "doc.search".  Another colleague suggested "RSearch".
>>>>
>>>>       What do you think about renaming the current 
>>>> "RSiteSearch.function{RSiteSearch}" to "RSearch{RSearch}"?
>>>>
>>>>       I'm happy to support the consensus of this group on a name 
>>>> (and even enhancements) that seems likely to maximize its utility 
>>>> to R users.  I ask, because a rose by any other name would smell as 
>>>> sweet, but one named "prettysweetsmellingthingamabob" might not 
>>>> sell as well.
>>>>
>>>>       Thanks,
>>>>       Spencer         
>>>
>>> [I've removed those on cc since I believe everyone will get this 
>>> through
>>> R-devel anyway...]
>>>
>>> I'd suggest something like findFunction() or some such, if the main 
>>> goal
>>> is to look for functions (not manuals, vignettes, mailing lists, etc.).
>>>   
>>       "findFunction" sounds to me like the best name I've heard so far. 
>
> But it isn't looking for functions, it's looking for help pages about 
> functions.  Another possibility is ???, e.g.
>
> ???topic
>
> This is done by masking the utils function `?`, and you'd have to be 
> careful to pass along requests with one or two (or more than three?) 
> question marks to the original; it also feels a bit strange to type
>
> hits <- ???topic
>
> though I think it's syntactic and well-defined.  I'm not sure how 
> you'd include your optional arguments, it would be really weird (but 
> again well defined) to say
>
> z <- ???spline(maxPages = 2)
>
> (Your first example in ?RSiteSearch.function, translated).
>
> Duncan Murdoch
>
>>
>>> RSiteSearch() was named what it was because it was meant as an 
>>> interface
>>> to Jon's search site that has lots of things related to R. 
>>> It seems to me that the recent discussion has been about including 
>>> other
>>> alternative search engines, etc.  Recall that when we were discussing
>>> including RSiteSearch() into base R, Jon basically had to commit to
>>> maintaining the site, as well as documenting how to replicate the site
>>> if and when he could no longer maintain it, before R Core accepted the
>>> function.  I think it would be wonderful to have a search facility
>>> that's all encompassing ("Roogle"?), but for inclusion into base R we
>>> really need to have the sites being searched being basically permenant.
>>>
>>> Perhaps a bit OT, but what would really be nice is if a search facility
>>> can not only find functions that's related to some search phrase, but
>>> also indicate whether the packages the functions belong to have already
>>> been installed on the user's system.  Sort of like "yum info" or "yum
>>> search" for those on RedHat-based Linux...
>>>   
>>       The current RSiteSeach package includes that adds other 
>> information from packageDescription to the package summary, adding 
>> (current default) "Title", "Version", "Author", "Maintainer", and 
>> (date) "Packaged".  If the package is not installed, these fields are 
>> left blank.  I've used this to prioritize which packages (and then 
>> which functions) I should consider first.
>>
>>       Best Wishes,
>>       Spencer
>>
>>> Best,
>>> Andy
>>>
>>>
>>>  
>>>  
>>>> Gabor Grothendieck wrote:
>>>>    
>>>>> On Thu, Jun 4, 2009 at 12:13 PM, Duncan Murdoch       
>>>> <murdoch at stats.uwo.ca> wrote:
>>>>    
>>>>>        
>>>>>> Gabor Grothendieck wrote:
>>>>>>            
>>>>>>> On Thu, Jun 4, 2009 at 1:58 AM, Duncan Murdoch           
>>>> <murdoch at stats.uwo.ca>
>>>>    
>>>>>>> wrote:
>>>>>>>
>>>>>>>                
>>>>>>>> spencerg wrote:
>>>>>>>>
>>>>>>>>                    
>>>>>>>>> Hello All:
>>>>>>>>>
>>>>>>>>>     What do you think of adding a function "RSiteSeach" 
>>>>>>>>>               
>>>> to the package
>>>>    
>>>>>>>>> of
>>>>>>>>> that name, masking the "RSiteSearch" function in               
>>>> "utils", trapping any
>>>>    
>>>>>>>>> call
>>>>>>>>> RSiteSearch('searchstring', 'function') to the current
>>>>>>>>> RSiteSearch.function
>>>>>>>>> and passing all others to "utils:::RSiteSearch"?  This 
>>>>>>>>>               
>>>> was suggested by
>>>>    
>>>>>>>>> a
>>>>>>>>> referee to a manuscript on this new capability               
>>>> submitted to "R Journal".
>>>>    
>>>>>>>>>  The current version of this manuscript is available via
>>>>>>>>> "system.file('doc',
>>>>>>>>> 'RSiteSearch.pdf', package='RSiteSearch')" if you have 
>>>>>>>>>               
>>>> the "RSiteSearch"
>>>>    
>>>>>>>>> package installed.
>>>>>>>>>
>>>>>>>>>                         
>>>>>>>> I suppose this depends on your long term plans for the             
>>>> function and
>>>>    
>>>>>>>> package.
>>>>>>>>  If you think it should eventually replace the utils             
>>>> function, then it
>>>>    
>>>>>>>> makes
>>>>>>>> sense to use the same name:  users won't get used to a             
>>>> new name in the
>>>>    
>>>>>>>> meantime.  But if you think it will diverge from that             
>>>> function, then you
>>>>    
>>>>>>>> might as well pick a separate name now.
>>>>>>>>
>>>>>>>> I disagree with Gabor about this being heavy handed, at 
>>>>>>>>             
>>>> least while it is
>>>>    
>>>>>>>> the only significant export in the package.  If people             
>>>> don't want it,
>>>>    
>>>>>>>> don't
>>>>>>>> attach the package.
>>>>>>>>
>>>>>>>>
>>>>>>>>                     
>>>>>>> The last sentence only gives you a choice of clobbering           
>>>> the existing
>>>>    
>>>>>>> function or not using it and that is not very nice.             
>>>> What is wanted is
>>>>    
>>>>>>> both to be able to use it and allow it to coexist in a nice way.
>>>>>>>
>>>>>>>                 
>>>>>> It is essentially a rename of the existing one to         
>>>> utils::RSiteSearch.  I
>>>>    
>>>>>> would only suggest this if RSiteSearch::RSiteSearch expanded on its
>>>>>> capabilities (which I think was Spencer's proposal),         
>>>> rather than replacing
>>>>    
>>>>>> them with something different.
>>>>>>
>>>>>>            
>>>>>>> How about R changing its RSiteSearch to be an S3 generic with the
>>>>>>> main functionality being placed into RSiteSearch.default?   Then
>>>>>>> RSiteSearch.function can become RsiteSearch.character and
>>>>>>>  - RSiteSearch will give the new functionality when the package is
>>>>>>> loaded and the old functionality if not.
>>>>>>> - RSiteSearch.character can be used in place of           
>>>> RSiteSearch.function
>>>>    
>>>>>>> to force only the new functionality (or an error if not present)
>>>>>>> - RSiteSearch.default will give the old functionality           
>>>> whether or not the
>>>>    
>>>>>>> package is loaded
>>>>>>>
>>>>>>> (If there is a NAMESPACE then Its assumed here that both           
>>>> methods are
>>>>    
>>>>>>> exported.)
>>>>>>>
>>>>>>>                 
>>>>>> How is that an improvement?  Just replace your (RSiteSearch,
>>>>>> RSiteSearch.character, RSiteSearch.default) with (RSiteSearch,
>>>>>> RSiteSearch::RSiteSearch, utils::RSiteSearch) in my         
>>>> proposal and you get the
>>>>    
>>>>>> same behaviour.  The point isn't that Spencer has invented         
>>>> a way for
>>>>    
>>>>>> RSiteSearch to handle character vectors, it already knows         
>>>> that.  The point
>>>>    
>>>>>> is that he has enhanced it.  Or maybe he has written         
>>>> something similar but
>>>>    
>>>>>> different, in which case he should pick a new name.
>>>>>> Duncan Murdoch
>>>>>>
>>>>>>             
>>>>> He simply renames it RSiteSearch.character (and possibly some other
>>>>> changes depending on arguments). Then if the core cooperates
>>>>> by making RSiteSearch a generic with a default method then       
>>>> everything
>>>>    
>>>>> works as one would expect based on an understanding of S3.
>>>>>
>>>>> No conflicts in names are involved.
>>>>>
>>>>> ______________________________________________
>>>>> R-devel at r-project.org mailing list
>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>>
>>>>>         
>>>>     
>>> Notice:  This e-mail message, together with any attach...{{dropped:15}}
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From ripley at stats.ox.ac.uk  Sat Jun  6 11:58:49 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sat, 6 Jun 2009 10:58:49 +0100 (BST)
Subject: [Rd] need help with libtool/aclocal error
In-Reply-To: <c2350ba40906051522v72b04e0dodbf3c2ec18f0c8d1@mail.gmail.com>
References: <c2350ba40906051522v72b04e0dodbf3c2ec18f0c8d1@mail.gmail.com>
Message-ID: <alpine.LFD.2.00.0906061046210.12736@gannet.stats.ox.ac.uk>

Looks like libtool is objecting to a patch-level mismatch in hte R 
sources (and I'm surprised that such minor mismatches are not 
allowed).  You should be able to solve this by using a current 
R-patched (>=r48719), or just updating tools/ltmain.sh from 
https://svn.r-project.org/R/branches/R-2-9-branch/tools/ltmain.sh and 
re-configuring and re-making R.

Looks like this has been mismatching for a while, so perhaps no one 
uses R CMD LINK.

On Fri, 5 Jun 2009, Kynn Jones wrote:

> I'm trying to build an executable for a program I wrote.  The
> compilation steps go well, but the linking step fails with a libtool
> "version mismatch" error.  My linking command has this prefix:
>
> /path/to/R/bin/R CMD LINK gcc -g -std=gnu99 ... etc.
>
> The error looks like this:
>
> libtool: Version mismatch error.  This is libtool 2.2, but the
> libtool: definition of this LT_INIT comes from libtool 2.2.6.
> libtool: You should recreate aclocal.m4 with macros from libtool 2.2
> libtool: and run autoconf again.
>
>
> I have no idea what this error message is referring to.  The version
> of libtool installed on the system is none of the ones mentioned in
> this error:
>
> % libtool --version
> ltmain.sh (GNU libtool) 1.5.22 Debian 1.5.22-4 (1.1220.2.365
> 2005/12/18 22:14:06)
>
> <FSF disclaimer>
>
>
>
> The libtool in the R directory has version 2.2:
>
> % /path/to/R/bin/libtool --version
>
> ltmain.sh (GNU libtool) 2.2
> Written by Gordon Matzigkeit <gord at gnu.ai.mit.edu>, 1996
>
> <FSF disclaimer>
>
>
> Strangely enough, this same libtool script has the following lines in
> its source code:
>
> # Which release of libtool.m4 was used?
> macro_version=2.2.6
> macro_revision=1.3012
>
>
>
> I don't know what to make of this.
>
> Be that as it may, does anyone know how I could get past this sticking point?
>
> TIA!
>
> G.
>
> P.S. I should point out that the R I'm using is one that I just
> compiled so that I could run R under valgrind.  Here's the ./configure
> command I used before running make:
>
> % ./configure --prefix=/path/to/R --enable-R-shlib --enable-BLAS-shlib
> --with-valgrind-instrumentation=2
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From kynnjo at gmail.com  Sat Jun  6 20:06:00 2009
From: kynnjo at gmail.com (Kynn Jones)
Date: Sat, 6 Jun 2009 14:06:00 -0400
Subject: [Rd] need help with libtool/aclocal error
In-Reply-To: <alpine.LFD.2.00.0906061046210.12736@gannet.stats.ox.ac.uk>
References: <c2350ba40906051522v72b04e0dodbf3c2ec18f0c8d1@mail.gmail.com>
	<alpine.LFD.2.00.0906061046210.12736@gannet.stats.ox.ac.uk>
Message-ID: <c2350ba40906061106n1571bc84s23cffc8e5164dd37@mail.gmail.com>

On Sat, Jun 6, 2009 at 5:58 AM, Prof Brian Ripley <ripley at stats.ox.ac.uk> wrote:
> ...or just
> updating tools/ltmain.sh from
> https://svn.r-project.org/R/branches/R-2-9-branch/tools/ltmain.sh and
> re-configuring and re-making R.

Thanks, that worked like a charm.


From kynnjo at gmail.com  Sat Jun  6 23:03:07 2009
From: kynnjo at gmail.com (Kynn Jones)
Date: Sat, 6 Jun 2009 17:03:07 -0400
Subject: [Rd] Qs on calling R from C
Message-ID: <c2350ba40906061403u211bc1adje2a60d2f3bcec295@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090606/c199d384/attachment.pl>

From edd at debian.org  Sat Jun  6 23:31:15 2009
From: edd at debian.org (Dirk Eddelbuettel)
Date: Sat, 6 Jun 2009 16:31:15 -0500
Subject: [Rd] Qs on calling R from C
In-Reply-To: <c2350ba40906061403u211bc1adje2a60d2f3bcec295@mail.gmail.com>
References: <c2350ba40906061403u211bc1adje2a60d2f3bcec295@mail.gmail.com>
Message-ID: <18986.57379.967508.398046@ron.nulle.part>


On 6 June 2009 at 17:03, Kynn Jones wrote:
| Consider the following simple C program:
| 
| /*** hello_r.c ***/
| #include <Rinternals.h>
| 
| SEXP hello() {
|  return mkString("Hello, world!\n");
| }
| 
| int main(void) {
|  SEXP x = hello();
|  return x == NULL;             /* i.e. 0 on success */
| }
| 
| This program segfaults:
| 
| % myR/bin/R CMD LINK gcc -I./R-2.9.0/src/include -L./myR/lib64/R/lib -lR
| hello_r.c -o hello_r > /dev/null
| % hello_r
| zsh: segmentation fault  hello_r

The error is in your assumption that because the code below works, the code
above should as well.  That is wrong -- there is more to embedding R than you
do here.

| But if instead of compiling the program as a standalone I make it as a
| shared library, like this:
| 
| % myR/bin/R CMD SHLIB --preclean hello_r.c > /dev/null
| 
| ... then the hello() function works fine, when run from within an R session:
| 
| > dyn.load(paste("hello_r", .Platform$dynlib.ext, sep = ""))
| > .Call("hello")
| [1] "Hello, world!\n"
| 
| 
| The fact that the same function succeeds when run from within an R session
| but segfaults when run from the standalone executable tells me that, in the
| standalone case, the main() function needs to do some initialization stuff
| on R before one can invoke functions like mkString(), but I have not been
| able to find what this initialization should be.
| If someone could point me in the right direction I'd appreciate it.

Try reading 'R Extensions' section 8.1 entitled 'Embedding R under
Unix-alikes'.  

Or you use something like my 'RInside' classes (on r-forge and my website) to
more easily embed R into C++ programs.

| Also, where is the documentation for the call_R function?  It is mentioned
| several times in the Writing R Extensions document, but I have not been able
| to find the documentation for it.

I think that's a C level function in the R sources, so you may have to look
there:

edd at ron:~> grep -rin call_R src/debian/R/R-2.9.0/src/
src/debian/R/R-2.9.0/src/library/base/man/Foreign.Rd:150:  \R functions can be invoked using \code{call_S} or \code{call_R} and
src/debian/R/R-2.9.0/src/library/base/man/Foreign.Rd:170:  \code{call_S}/\code{call_R}.  New code using \R objects should be
src/debian/R/R-2.9.0/src/main/dotcode.c:2409:void call_R(char *func, long nargs, void **arguments, char **modes,
src/debian/R/R-2.9.0/src/main/dotcode.c:2417:   error(_("invalid function in call_R"));
src/debian/R/R-2.9.0/src/main/dotcode.c:2419:   error(_("invalid argument count in call_R"));
src/debian/R/R-2.9.0/src/main/dotcode.c:2421:   error(_("invalid return value count in call_R"));
src/debian/R/R-2.9.0/src/main/dotcode.c:2464:       error(_("mode '%s' is not supported in call_R"), modes[i]);
src/debian/R/R-2.9.0/src/main/dotcode.c:2506:    call_R(func, nargs, arguments, modes, lengths, names, nres, results);
src/debian/R/R-2.9.0/src/main/coerce.c:1317:    errorcall_return(call, R_MSG_mode);
src/debian/R/R-2.9.0/src/main/coerce.c:1363:    errorcall_return(call, R_MSG_mode);
src/debian/R/R-2.9.0/src/main/coerce.c:1769:    errorcall_return(call, R_MSG_mode);
src/debian/R/R-2.9.0/src/main/coerce.c:1812:    errorcall_return(call, "is.na " R_MSG_list_vec);
src/debian/R/R-2.9.0/src/main/coerce.c:1924:    errorcall_return(call, "is.nan " R_MSG_list_vec);
src/debian/R/R-2.9.0/src/main/coerce.c:2019:    errorcall_return(call, "is.finite " R_MSG_list_vec);
src/debian/R/R-2.9.0/src/main/coerce.c:2071:    errorcall_return(call, "is.infinite " R_MSG_list_vec);
src/debian/R/R-2.9.0/src/main/coerce.c:2128:    errorcall_return(call, R_MSG_A1_char);
src/debian/R/R-2.9.0/src/main/complex.c:917:    errorcall_return(call, _("unimplemented complex function"));
src/debian/R/R-2.9.0/src/main/builtin.c:142:    errorcall_return(call, _("invalid number of arguments"));
src/debian/R/R-2.9.0/src/include/Rinternals.h:652:#define errorcall_return(cl,msg){ Rf_errorcall(cl, msg);   return R_NilValue; }
src/debian/R/R-2.9.0/src/include/S.h:73:/* void call_R(char*, long, void**, char**, long*, char**, long, char**);*/
src/debian/R/R-2.9.0/src/include/S.h:74:#define call_S call_R
src/debian/R/R-2.9.0/src/include/R_ext/RS.h:86:void     call_R(char*, long, void**, char**, long*, char**, long, char**);

Hth, Dirk

-- 
Three out of two people have difficulties with fractions.


From kynnjo at gmail.com  Sun Jun  7 00:23:03 2009
From: kynnjo at gmail.com (Kynn Jones)
Date: Sat, 6 Jun 2009 18:23:03 -0400
Subject: [Rd] Qs on calling R from C
In-Reply-To: <18986.57379.967508.398046@ron.nulle.part>
References: <c2350ba40906061403u211bc1adje2a60d2f3bcec295@mail.gmail.com>
	<18986.57379.967508.398046@ron.nulle.part>
Message-ID: <c2350ba40906061523s448fa9b6kfbf093dcadd41e62@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090606/7868b06a/attachment.pl>

From bolker at ufl.edu  Sun Jun  7 00:45:33 2009
From: bolker at ufl.edu (Ben Bolker)
Date: Sat, 06 Jun 2009 18:45:33 -0400
Subject: [Rd] Reduce: extra args wishlist?
Message-ID: <4A2AF18D.8030805@ufl.edu>


  Is there a reason that Reduce() doesn't take a "..." argument that
would allow arbitrary extra arguments to be passed through to the function?

  Here is a little example of how this would be convenient:

z <- list(
          data.frame(state=c("California"),
                     cases=0),
          data.frame(state=c("California","Massachusetts"),
                     cases=c(1,2)),
          data.frame(state=c("California","Massachusetts","Arizona"),
                     cases=c(1,2,17)))

## read in revised version of Reduce()
Reduce(merge,z,by="state",all=TRUE)

  The change is simple -- just add "..." to every call to the function
in Reduce() --  patch is included below my signature ...

  It's not a big deal -- I could also do
Reduce(function(x,y) { merge(x,y,by="state",all=TRUE) }, z)
but there doesn't seem to be a good reason not to allow it ...

  cheers
    Ben Bolker


-- 
Ben Bolker
Associate professor, Biology Dep't, Univ. of Florida
bolker at ufl.edu / www.zoology.ufl.edu/bolker
GPG key: www.zoology.ufl.edu/bolker/benbolker-publickey.asc


*** /home/ben/funprog.R.new	2009-06-06 18:30:56.000000000 -0400
--- src/library/base/R/funprog.R	2009-02-12 10:39:32.000000000 -0500
***************
*** 15,21 ****
  #  http://www.r-project.org/Licenses/

  Reduce <-
! function(f, x, init, right = FALSE, accumulate = FALSE, ...)
  {
      mis <- missing(init)
      len <- length(x)
--- 15,21 ----
  #  http://www.r-project.org/Licenses/

  Reduce <-
! function(f, x, init, right = FALSE, accumulate = FALSE)
  {
      mis <- missing(init)
      len <- length(x)
***************
*** 47,57 ****
      if(!accumulate) {
          if(right) {
              for(i in rev(ind))
!                 init <- f(x[[i]], init, ...)
          }
          else {
              for(i in ind)
!                 init <- f(init, x[[i]], ...)
          }
          init
      }
--- 47,57 ----
      if(!accumulate) {
          if(right) {
              for(i in rev(ind))
!                 init <- f(x[[i]], init)
          }
          else {
              for(i in ind)
!                 init <- f(init, x[[i]])
          }
          init
      }
***************
*** 64,76 ****
              if(right) {
                  out[[len]] <- init
                  for(i in rev(ind)) {
!                     init <- f(x[[i]], init, ...)
                      out[[i]] <- init
                  }
              } else {
                  out[[1L]] <- init
                  for(i in ind) {
!                     init <- f(init, x[[i]], ...)
                      out[[i]] <- init
                  }
              }
--- 64,76 ----
              if(right) {
                  out[[len]] <- init
                  for(i in rev(ind)) {
!                     init <- f(x[[i]], init)
                      out[[i]] <- init
                  }
              } else {
                  out[[1L]] <- init
                  for(i in ind) {
!                     init <- f(init, x[[i]])
                      out[[i]] <- init
                  }
              }
***************
*** 78,91 ****
              if(right) {
                  out[[len]] <- init
                  for(i in rev(ind)) {
!                     init <- f(x[[i]], init, ...)
                      out[[i]] <- init
                  }
              }
              else {
                  for(i in ind) {
                      out[[i]] <- init
!                     init <- f(init, x[[i]], ...)
                  }
                  out[[len]] <- init
              }
--- 78,91 ----
              if(right) {
                  out[[len]] <- init
                  for(i in rev(ind)) {
!                     init <- f(x[[i]], init)
                      out[[i]] <- init
                  }
              }
              else {
                  for(i in ind) {
                      out[[i]] <- init
!                     init <- f(init, x[[i]])
                  }
                  out[[len]] <- init
              }


-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 260 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090606/7daebbbd/attachment.bin>

From hb at stat.berkeley.edu  Sun Jun  7 22:51:39 2009
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Sun, 7 Jun 2009 13:51:39 -0700
Subject: [Rd] CRAN build/checks: Dependencies on non-CRAN packages?
Message-ID: <59d7961d0906071351l3ac15583l1a780c92c11df7a3@mail.gmail.com>

Hi,

how is the CRAN build/check system dealing with dependencies on
non-CRAN packages?  Are there external repositories that are dealt
with in special ways, e.g. Bioconductor and Omegahat?  Is this
documented somewhere?

The most recent note on this that I could locate is "[Rd] CRAN,
Bioconductor and ctv package dependency questions", Kurt Hornik, Sept
8, 2005; https://stat.ethz.ch/pipermail/r-devel/2005-September/034547.html.
 Does the comments in that thread still reflect how CRAN works?

Thanks

Henrik


From hb at stat.berkeley.edu  Sun Jun  7 23:42:08 2009
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Sun, 7 Jun 2009 14:42:08 -0700
Subject: [Rd] Suggestion: Dimension-sensitive attributes
Message-ID: <59d7961d0906071442j9d406c8j5079d469f3043d0@mail.gmail.com>

Hi,

maybe this has been suggested before, but would it be possible,
without not breaking too much existing code, to add other "dimension
vector attributes" in addition to 'dimnames'?  These attributes would
then be subsetted just like dimnames.

Something like this:

> x <- array(1:30, dim=c(2,3,5))
> dimnames(x) <- list(c("a", "b"), c("a1", "a2", "a3"), NULL);
> dimattr(x, "misc") <- list(1:2, list(x=1:5, y=letters[1:8], z=NA), letters[1:5]);

> y <- x[,1:2,2:3]
> str(dimnames(y))
List of 3
 $ : chr [1:2] "a" "b"
 $ : chr [1:2] "a1" "a2"
 $ : NULL
> str(dimattr(x, "misc"))
List of 3
 $ : int [1:2] 1 2
 $ :List of 2
  ..$ x: int [1:5] 1 2 3 4 5
  ..$ y: chr [1:8] "a" "b" "c" "d" ...
 $ : chr [1:2] "b" "c"

 I can imagine this needs to be added in several places and functions
such as is.vector() needs to be updated etc.  It is not a quick
migration, but is it something worth considering for the future?

/Henrik


From Kurt.Hornik at wu.ac.at  Mon Jun  8 08:49:21 2009
From: Kurt.Hornik at wu.ac.at (Kurt Hornik)
Date: Mon, 8 Jun 2009 08:49:21 +0200
Subject: [Rd] CRAN build/checks: Dependencies on non-CRAN packages?
In-Reply-To: <59d7961d0906071351l3ac15583l1a780c92c11df7a3@mail.gmail.com>
References: <59d7961d0906071351l3ac15583l1a780c92c11df7a3@mail.gmail.com>
Message-ID: <18988.46193.914032.842613@fangorn.hornik.net>

>>>>> Henrik Bengtsson writes:

> Hi,
> how is the CRAN build/check system dealing with dependencies on
> non-CRAN packages?  Are there external repositories that are dealt
> with in special ways, e.g. Bioconductor and Omegahat?  Is this
> documented somewhere?

> The most recent note on this that I could locate is "[Rd] CRAN,
> Bioconductor and ctv package dependency questions", Kurt Hornik, Sept
> 8, 2005;
> https://stat.ethz.ch/pipermail/r-devel/2005-September/034547.html.
> Does the comments in that thread still reflect how CRAN works?

Not quite.  No more special casing of BioC or Ohat dependencies: they
simply "work", and packages with such dependencies can fully be checked.

-k

> Thanks

> Henrik

> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From hb at stat.berkeley.edu  Mon Jun  8 09:23:48 2009
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Mon, 8 Jun 2009 00:23:48 -0700
Subject: [Rd] CRAN build/checks: Dependencies on non-CRAN packages?
In-Reply-To: <18988.46193.914032.842613@fangorn.hornik.net>
References: <59d7961d0906071351l3ac15583l1a780c92c11df7a3@mail.gmail.com> 
	<18988.46193.914032.842613@fangorn.hornik.net>
Message-ID: <59d7961d0906080023h443e2e23i88aa5932bfda2d05@mail.gmail.com>

On Sun, Jun 7, 2009 at 11:49 PM, Kurt Hornik<Kurt.Hornik at wu.ac.at> wrote:
>>>>>> Henrik Bengtsson writes:
>
>> Hi,
>> how is the CRAN build/check system dealing with dependencies on
>> non-CRAN packages? ?Are there external repositories that are dealt
>> with in special ways, e.g. Bioconductor and Omegahat? ?Is this
>> documented somewhere?
>
>> The most recent note on this that I could locate is "[Rd] CRAN,
>> Bioconductor and ctv package dependency questions", Kurt Hornik, Sept
>> 8, 2005;
>> https://stat.ethz.ch/pipermail/r-devel/2005-September/034547.html.
>> Does the comments in that thread still reflect how CRAN works?
>
> Not quite. ?No more special casing of BioC or Ohat dependencies: they
> simply "work", and packages with such dependencies can fully be checked.

Hmm... so you're saying R CMD check pass ("work") although a package
is missing?  If so, what about example/test code where that external
package is loaded?  ...or even harder, where a function of that
external package is called, e.g.

require("externalPkg") || stop(...);
res <- externalPkg::specialFcn(...);
stopifnot(identical(res,42));
...

This is not a constructed example; I do have some example():s].

Thxs

Henik

>
> -k
>
>> Thanks
>
>> Henrik
>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From Kurt.Hornik at wu.ac.at  Mon Jun  8 09:29:16 2009
From: Kurt.Hornik at wu.ac.at (Kurt Hornik)
Date: Mon, 8 Jun 2009 09:29:16 +0200
Subject: [Rd] CRAN build/checks: Dependencies on non-CRAN packages?
In-Reply-To: <59d7961d0906080023h443e2e23i88aa5932bfda2d05@mail.gmail.com>
References: <59d7961d0906071351l3ac15583l1a780c92c11df7a3@mail.gmail.com>
	<18988.46193.914032.842613@fangorn.hornik.net>
	<59d7961d0906080023h443e2e23i88aa5932bfda2d05@mail.gmail.com>
Message-ID: <18988.48588.186348.111974@fangorn.hornik.net>

>>>>> Henrik Bengtsson writes:

> On Sun, Jun 7, 2009 at 11:49 PM, Kurt Hornik<Kurt.Hornik at wu.ac.at> wrote:
>>>>>>> Henrik Bengtsson writes:
>> 
>>> Hi,
>>> how is the CRAN build/check system dealing with dependencies on
>>> non-CRAN packages? ?Are there external repositories that are dealt
>>> with in special ways, e.g. Bioconductor and Omegahat? ?Is this
>>> documented somewhere?
>> 
>>> The most recent note on this that I could locate is "[Rd] CRAN,
>>> Bioconductor and ctv package dependency questions", Kurt Hornik, Sept
>>> 8, 2005;
>>> https://stat.ethz.ch/pipermail/r-devel/2005-September/034547.html.
>>> Does the comments in that thread still reflect how CRAN works?
>> 
>> Not quite. ?No more special casing of BioC or Ohat dependencies: they
>> simply "work", and packages with such dependencies can fully be checked.

> Hmm... so you're saying R CMD check pass ("work") although a package
> is missing?

Are you asking what happens if a CRAN package depends on a BioC package
which is missing from BioC?

You can safely assume the availability of BioC and Ohat packages
(provided we can install these).  We do not accept packages with
unconditional (depends/imports) dependencies on package not in the
standard repositories, but do not force the availability of suggested
packages: so you can suggest an external package (but R CMD check should
still pass if the package is not available).

Best
-k

> If so, what about example/test code where that external package is
> loaded?  ...or even harder, where a function of that external package
> is called, e.g.

> require("externalPkg") || stop(...);
> res <- externalPkg::specialFcn(...);
> stopifnot(identical(res,42));
> ...

> This is not a constructed example; I do have some example():s].

> Thxs

> Henik

>> 
>> -k
>> 
>>> Thanks
>> 
>>> Henrik
>> 
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>> 
>> 

From hb at stat.berkeley.edu  Mon Jun  8 10:02:36 2009
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Mon, 8 Jun 2009 01:02:36 -0700
Subject: [Rd] CRAN build/checks: Dependencies on non-CRAN packages?
In-Reply-To: <18988.48588.186348.111974@fangorn.hornik.net>
References: <59d7961d0906071351l3ac15583l1a780c92c11df7a3@mail.gmail.com> 
	<18988.46193.914032.842613@fangorn.hornik.net>
	<59d7961d0906080023h443e2e23i88aa5932bfda2d05@mail.gmail.com> 
	<18988.48588.186348.111974@fangorn.hornik.net>
Message-ID: <59d7961d0906080102m4458c3c1we33d891d37b434f7@mail.gmail.com>

On Mon, Jun 8, 2009 at 12:29 AM, Kurt Hornik<Kurt.Hornik at wu.ac.at> wrote:
>>>>>> Henrik Bengtsson writes:
>
>> On Sun, Jun 7, 2009 at 11:49 PM, Kurt Hornik<Kurt.Hornik at wu.ac.at> wrote:
>>>>>>>> Henrik Bengtsson writes:
>>>
>>>> Hi,
>>>> how is the CRAN build/check system dealing with dependencies on
>>>> non-CRAN packages? ?Are there external repositories that are dealt
>>>> with in special ways, e.g. Bioconductor and Omegahat? ?Is this
>>>> documented somewhere?
>>>
>>>> The most recent note on this that I could locate is "[Rd] CRAN,
>>>> Bioconductor and ctv package dependency questions", Kurt Hornik, Sept
>>>> 8, 2005;
>>>> https://stat.ethz.ch/pipermail/r-devel/2005-September/034547.html.
>>>> Does the comments in that thread still reflect how CRAN works?
>>>
>>> Not quite. ?No more special casing of BioC or Ohat dependencies: they
>>> simply "work", and packages with such dependencies can fully be checked.
>
>> Hmm... so you're saying R CMD check pass ("work") although a package
>> is missing?
>
> Are you asking what happens if a CRAN package depends on a BioC package
> which is missing from BioC?

No, my question was what happens if your CRAN package depends on
non-CRAN packages.  In the above Sept 2005 thread, I read "The only
catch is that in the current setup of daily CRAN package
checking, packages with non-CRAN dependencies are checked ***using
fake or no installs***."  I though your term "work" meant the same as
"using fake or no installs".

>
> You can safely assume the availability of BioC and Ohat packages
> (provided we can install these). ?We do not accept packages with
> unconditional (depends/imports) dependencies on package not in the
> standard repositories, but do not force the availability of suggested
> packages: so you can suggest an external package (but R CMD check should
> still pass if the package is not available).

Ok, this clarifies a few things. So:

1) One can assume that packages on CRAN, Bioconductor (release and/or
devel?), and Omegahat are available on the CRAN servers.
2) One cannot assume that packages from other repositories, including
r-forge.r-project.org, are available.
3) When R CMD check is ran on the CRAN servers it will not give an
error for non-available packages that are listed under "Suggests:" in
the DESCRIPTION file (as R CMD check would do by default).

However, in my example example() code below, I would expect R CMD
check to still fail if you list 'externalPkg' under "Suggests"; it
will pass the package/code validation, but when running the examples,
it will fail, either because of the require(...) || stop(...)
statement or because there is no way 'res' would have value 42 unless
the package really exists.

Yet another feature request (just a suggestion): It could be useful
provide a file with the packages installed on each "check" server,
e.g.:

data <- installed.packages();
data <- paste(data[,"Package"], data[,"Version"], sep=" ");
cat(data, sep="\n");

Cheers

Henrik

>
> Best
> -k
>
>> If so, what about example/test code where that external package is
>> loaded? ?...or even harder, where a function of that external package
>> is called, e.g.
>
>> require("externalPkg") || stop(...);
>> res <- externalPkg::specialFcn(...);
>> stopifnot(identical(res,42));
>> ...
>
>> This is not a constructed example; I do have some example():s].
>
>> Thxs
>
>> Henik
>
>>>
>>> -k
>>>
>>>> Thanks
>>>
>>>> Henrik
>>>
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>>
>
>


From ripley at stats.ox.ac.uk  Mon Jun  8 11:17:37 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 8 Jun 2009 10:17:37 +0100 (BST)
Subject: [Rd] CRAN build/checks: Dependencies on non-CRAN packages?
In-Reply-To: <18988.46193.914032.842613@fangorn.hornik.net>
References: <59d7961d0906071351l3ac15583l1a780c92c11df7a3@mail.gmail.com>
	<18988.46193.914032.842613@fangorn.hornik.net>
Message-ID: <alpine.LFD.2.00.0906080948550.1377@gannet.stats.ox.ac.uk>

On Mon, 8 Jun 2009, Kurt Hornik wrote:

>>>>>> Henrik Bengtsson writes:
>
>> Hi,
>> how is the CRAN build/check system dealing with dependencies on
>> non-CRAN packages?  Are there external repositories that are dealt
>> with in special ways, e.g. Bioconductor and Omegahat?  Is this
>> documented somewhere?
>
>> The most recent note on this that I could locate is "[Rd] CRAN,
>> Bioconductor and ctv package dependency questions", Kurt Hornik, Sept
>> 8, 2005;
>> https://stat.ethz.ch/pipermail/r-devel/2005-September/034547.html.
>> Does the comments in that thread still reflect how CRAN works?
>
> Not quite.  No more special casing of BioC or Ohat dependencies: they
> simply "work", and packages with such dependencies can fully be checked.

With some caveats.  The CRAN check summaries are from four sets of 
systems (CRAN's, the Windows and Mac autobuilders and my server using 
the Sun Studio compiler) and hence four supervisors.

Most of us install the BioC and Omegahat packages that are needed as 
dependencies in so far as we can (this looks to be less so for the Mac 
autobuilder).  But 'in so far as we can' has limits, not least the 
time needed to fiddle around with some of them.

In principle if a package depended on an off-CRAN/BioC/Omegahat 
package and it was clear where to get it we would try to install it -- 
however, in all past instances I have failed in that installation.

It may be worth adding that as the number of packages grows the total 
time available to work on those that fail does not increase (and all 
of us involved have less time for this than we once had), so the 
effort available per problematic package has decreased considerably. 
Also, Omegahat no longer provides Windows binaries and the 
alternatives (CRAN extras, BioC extras) only cover a few.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From osiander.meixner at hp.com  Mon Jun  8 10:10:13 2009
From: osiander.meixner at hp.com (osiander.meixner at hp.com)
Date: Mon,  8 Jun 2009 10:10:13 +0200 (CEST)
Subject: [Rd] iconv.dll needed in addition to Riconv.dll for package XML to
	load (PR#13747)
Message-ID: <20090608081013.970CB283031F@mail.pubhealth.ku.dk>

Full_Name: Osiander Meixner
Version: 2.9.0 (2009-04-17)
OS: Windows Vista Enterprise, 32bit, SP1
Submission from: (NULL) (15.195.185.82)


package XML_2.5-1
>library(XML) throws an error window saying:
"
RGui: RGui.exe - Unable to Locate Component
This application has failed to start becuase iconv.dll was not found.
Re-installing the application may fix this problem.
"

RGui then reports this:

 Error in inDL(x, as.logical(local), as.logical(now), ...) :
   unable to load shared library 'c:/R/R-2.9.0/library/XML/libs/XML.dll':
   LoadLibrary failure:  The specified module could not be found.
  
 Error : .onLoad failed in 'loadNamespace' for 'XML'
 Error: package/namespace load failed for 'XML'



Indeed the error messages triggered by library(XML) seems to be a side effect of
a dll naming issue. This issue can be solve by _adding_ a copy of 
Riconv.dll  renamed as    iconv.dll
and restarting RGui


From ligges at statistik.tu-dortmund.de  Mon Jun  8 15:36:17 2009
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Mon, 08 Jun 2009 15:36:17 +0200
Subject: [Rd] iconv.dll needed in addition to Riconv.dll for package XML
 to	load (PR#13747)
In-Reply-To: <20090608081013.970CB283031F@mail.pubhealth.ku.dk>
References: <20090608081013.970CB283031F@mail.pubhealth.ku.dk>
Message-ID: <4A2D13D1.6090305@statistik.tu-dortmund.de>

Please install from the "CRAN extras" repository (where you will find a 
working copy) and do NOT report a bug in R that is not a bug in R but in 
a contributed package / the package repository.

Best,
Uwe Ligges

osiander.meixner at hp.com wrote:
> Full_Name: Osiander Meixner
> Version: 2.9.0 (2009-04-17)
> OS: Windows Vista Enterprise, 32bit, SP1
> Submission from: (NULL) (15.195.185.82)
> 
> 
> package XML_2.5-1
>> library(XML) throws an error window saying:
> "
> RGui: RGui.exe - Unable to Locate Component
> This application has failed to start becuase iconv.dll was not found.
> Re-installing the application may fix this problem.
> "
> 
> RGui then reports this:
> 
>  Error in inDL(x, as.logical(local), as.logical(now), ...) :
>    unable to load shared library 'c:/R/R-2.9.0/library/XML/libs/XML.dll':
>    LoadLibrary failure:  The specified module could not be found.
>   
>  Error : .onLoad failed in 'loadNamespace' for 'XML'
>  Error: package/namespace load failed for 'XML'
> 
> 
> 
> Indeed the error messages triggered by library(XML) seems to be a side effect of
> a dll naming issue. This issue can be solve by _adding_ a copy of 
> Riconv.dll  renamed as    iconv.dll
> and restarting RGui
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From ligges at statistik.tu-dortmund.de  Mon Jun  8 15:40:12 2009
From: ligges at statistik.tu-dortmund.de (ligges at statistik.tu-dortmund.de)
Date: Mon,  8 Jun 2009 15:40:12 +0200 (CEST)
Subject: [Rd] iconv.dll needed in addition to Riconv.dll for package XML
	(PR#13748)
Message-ID: <20090608134013.00D58282C765@mail.pubhealth.ku.dk>

Please install from the "CRAN extras" repository (where you will find a 
working copy) and do NOT report a bug in R that is not a bug in R but in 
a contributed package / the package repository.

Best,
Uwe Ligges

osiander.meixner at hp.com wrote:
> Full_Name: Osiander Meixner
> Version: 2.9.0 (2009-04-17)
> OS: Windows Vista Enterprise, 32bit, SP1
> Submission from: (NULL) (15.195.185.82)
> 
> 
> package XML_2.5-1
>> library(XML) throws an error window saying:
> "
> RGui: RGui.exe - Unable to Locate Component
> This application has failed to start becuase iconv.dll was not found.
> Re-installing the application may fix this problem.
> "
> 
> RGui then reports this:
> 
>  Error in inDL(x, as.logical(local), as.logical(now), ...) :
>    unable to load shared library 'c:/R/R-2.9.0/library/XML/libs/XML.dll':
>    LoadLibrary failure:  The specified module could not be found.
>   
>  Error : .onLoad failed in 'loadNamespace' for 'XML'
>  Error: package/namespace load failed for 'XML'
> 
> 
> 
> Indeed the error messages triggered by library(XML) seems to be a side effect of
> a dll naming issue. This issue can be solve by _adding_ a copy of 
> Riconv.dll  renamed as    iconv.dll
> and restarting RGui
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From hamstersquats at web.de  Mon Jun  8 17:18:02 2009
From: hamstersquats at web.de (Thomas Roth (geb. Kaliwe))
Date: Mon, 08 Jun 2009 17:18:02 +0200
Subject: [Rd] Defining a S4 method for existing function interaction.plot
Message-ID: <4A2D2BAA.4030800@web.de>

Dear Members,

i have defined a S4-class and a function for that class wich is to be 
called interaction.plot. Problem: interaction.plot already exists so

setMethod(f = "interaction.plot", signature = "myClass", definition = 
function(x){ return(TRUE) })

   Fehler in conformMethod(signature, mnames, fnames, f, fdef, 
definition) :
   In method for function "interaction.plot": formale Argumente, die in 
der Methodendefinition ausgelassen wurden, k?nnen nicht in der Signatur 
(x.factor = "myClass") sein

won't work because it is already defined.

Is there a solution that keeps the original interaction.plot and lets me 
define a interaction.plot for objects of my S4-Class?

Thank you for your time

Thomas Roth


From hb at stat.berkeley.edu  Mon Jun  8 20:42:41 2009
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Mon, 8 Jun 2009 11:42:41 -0700
Subject: [Rd] CRAN build/checks: Dependencies on non-CRAN packages?
In-Reply-To: <alpine.LFD.2.00.0906080948550.1377@gannet.stats.ox.ac.uk>
References: <59d7961d0906071351l3ac15583l1a780c92c11df7a3@mail.gmail.com> 
	<18988.46193.914032.842613@fangorn.hornik.net>
	<alpine.LFD.2.00.0906080948550.1377@gannet.stats.ox.ac.uk>
Message-ID: <59d7961d0906081142i4ed386d3vd0ba13d1c332e18b@mail.gmail.com>

Thank you all for these clarifications and for all your great
contributions to this project (can't be said too many times)!  /Henrik

On Mon, Jun 8, 2009 at 2:17 AM, Prof Brian Ripley<ripley at stats.ox.ac.uk> wrote:
> On Mon, 8 Jun 2009, Kurt Hornik wrote:
>
>>>>>>> Henrik Bengtsson writes:
>>
>>> Hi,
>>> how is the CRAN build/check system dealing with dependencies on
>>> non-CRAN packages? ?Are there external repositories that are dealt
>>> with in special ways, e.g. Bioconductor and Omegahat? ?Is this
>>> documented somewhere?
>>
>>> The most recent note on this that I could locate is "[Rd] CRAN,
>>> Bioconductor and ctv package dependency questions", Kurt Hornik, Sept
>>> 8, 2005;
>>> https://stat.ethz.ch/pipermail/r-devel/2005-September/034547.html.
>>> Does the comments in that thread still reflect how CRAN works?
>>
>> Not quite. ?No more special casing of BioC or Ohat dependencies: they
>> simply "work", and packages with such dependencies can fully be checked.
>
> With some caveats. ?The CRAN check summaries are from four sets of systems
> (CRAN's, the Windows and Mac autobuilders and my server using the Sun Studio
> compiler) and hence four supervisors.
>
> Most of us install the BioC and Omegahat packages that are needed as
> dependencies in so far as we can (this looks to be less so for the Mac
> autobuilder). ?But 'in so far as we can' has limits, not least the time
> needed to fiddle around with some of them.
>
> In principle if a package depended on an off-CRAN/BioC/Omegahat package and
> it was clear where to get it we would try to install it -- however, in all
> past instances I have failed in that installation.
>
> It may be worth adding that as the number of packages grows the total time
> available to work on those that fail does not increase (and all of us
> involved have less time for this than we once had), so the effort available
> per problematic package has decreased considerably. Also, Omegahat no longer
> provides Windows binaries and the alternatives (CRAN extras, BioC extras)
> only cover a few.
>
> --
> Brian D. Ripley, ? ? ? ? ? ? ? ? ?ripley at stats.ox.ac.uk
> Professor of Applied Statistics, ?http://www.stats.ox.ac.uk/~ripley/
> University of Oxford, ? ? ? ? ? ? Tel: ?+44 1865 272861 (self)
> 1 South Parks Road, ? ? ? ? ? ? ? ? ? ? +44 1865 272866 (PA)
> Oxford OX1 3TG, UK ? ? ? ? ? ? ? ?Fax: ?+44 1865 272595
>


From kynnjo at gmail.com  Mon Jun  8 20:48:54 2009
From: kynnjo at gmail.com (Kynn Jones)
Date: Mon, 8 Jun 2009 14:48:54 -0400
Subject: [Rd] How to explore R internals through gdb?
Message-ID: <c2350ba40906081148hfd61e15g64353bb5a799cbd1@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090608/19a5d48a/attachment.pl>

From cgenolin at u-paris10.fr  Tue Jun  9 17:10:43 2009
From: cgenolin at u-paris10.fr (Christophe Genolini)
Date: Tue, 09 Jun 2009 17:10:43 +0200
Subject: [Rd] "R CMD check" does not find a mistake
Message-ID: <4A2E7B73.2040900@u-paris10.fr>

Hi the list,

I build a package. They was a mistake in it, but R CMD check did not 
find it. Is that normal ?

Here is what Kurt gets (which is right, I did this mistake):

--- 8< ----------------
* checking for code/documentation mismatches ... WARNING
S4 class codoc mismatches from documentation object 'LongData-class':
Slots for class 'LongData'
 Code: id other time traj varName
 Docs: id time traj varName
--- 8< ----------------

But here is what I get on my computer:

--- 8< ----------------
C:\Documents and Settings\Christophe\Mes 
documents\Recherche\Trajectoires\kmeal>
R CMD check longitudinalData
* checking for working pdflatex ... OK
* using log directory 'C:/Documents and Settings/Christophe/Mes 
documents/Recher
che/Trajectoires/kmeal/longitudinalData.Rcheck'
* using R version 2.9.0 Patched (2009-06-07 r48733)
* using session charset: ISO8859-1
* checking for file 'longitudinalData/DESCRIPTION' ... OK
* checking extension type ... Package
* this is package 'longitudinalData' version '0.5'
* package encoding: latin1
* checking package dependencies ... OK
* checking if this is a source package ... OK
* checking for .dll and .exe files ... OK
* checking whether package 'longitudinalData' can be installed ... OK
* checking package directory ... OK
* checking for portable file names ... OK
* checking DESCRIPTION meta-information ... OK
* checking top-level files ... OK
* checking index information ... OK
* checking package subdirectories ... OK
* checking R files for non-ASCII characters ... OK
* checking R files for syntax errors ... OK
* checking whether the package can be loaded ... OK
* checking whether the package can be loaded with stated dependencies ... OK
* checking for unstated dependencies in R code ... OK
* checking S3 generic/method consistency ... OK
* checking replacement functions ... OK
* checking foreign function calls ... OK
* checking R code for possible problems ... OK
* checking Rd files ... OK
* checking Rd files against version 2 parser ... OK
* checking Rd cross-references ... OK
* checking for missing documentation entries ... OK
* checking for code/documentation mismatches ... OK
* checking Rd \usage sections ... OK
* checking examples ... OK
* checking PDF version of manual ... OK


C:\Documents and Settings\Christophe\Mes 
documents\Recherche\Trajectoires\kmeal>
R CMD build longitudinalData
* checking for file 'longitudinalData/DESCRIPTION' ... OK
* preparing 'longitudinalData':
* checking DESCRIPTION meta-information ... OK
* removing junk files
* checking for LF line-endings in source and make files
* checking for empty or unneeded directories
* building 'longitudinalData_0.5.tar.gz'
--- 8< ----------------

Christophe


From cgenolin at u-paris10.fr  Tue Jun  9 22:11:51 2009
From: cgenolin at u-paris10.fr (Christophe Genolini)
Date: Tue, 09 Jun 2009 22:11:51 +0200
Subject: [Rd] Inheritance before ANY...
Message-ID: <4A2EC207.5070007@u-paris10.fr>

Hi all,
I am programming using S4. I define two classes, "B" is inheriting from 
"A". Apparently (at least since version 2.9.0 ?), when the correct 
signature is not find,
R prefers to chose a signature in the ancestor BEFORE a signature in the 
class. This is very strange to me...

If I define plot for ("A",missing) and ("B",ANY), calling 
plot("B",missing), I would expect R to chose plot("B",ANY) before 
plot("A",missing)

Sincerely
Christophe


------------------ (translate from french) --------
Note : method with signature "A#missing" chose for function "plot",
signature cible "B#missing".
"B#ANY" could also be compatible


From maechler at stat.math.ethz.ch  Wed Jun 10 10:35:30 2009
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Wed, 10 Jun 2009 10:35:30 +0200
Subject: [Rd] Inheritance before ANY...
In-Reply-To: <4A2EC207.5070007@u-paris10.fr>
References: <4A2EC207.5070007@u-paris10.fr>
Message-ID: <18991.28754.536164.538648@lynne.math.ethz.ch>

>>>>> "CG" == Christophe Genolini <cgenolin at u-paris10.fr>
>>>>>     on Tue, 09 Jun 2009 22:11:51 +0200 writes:

    CG> Hi all,
    CG> I am programming using S4. I define two classes, "B" is inheriting from 
    CG> "A". Apparently (at least since version 2.9.0 ?), when the correct 
    CG> signature is not find,
    CG> R prefers to chose a signature in the ancestor BEFORE a signature in the 
    CG> class. This is very strange to me...

    CG> If I define plot for ("A",missing) and ("B",ANY), calling 
    CG> plot("B",missing), I would expect R to chose plot("B",ANY) before 
    CG> plot("A",missing)

    CG> ------------------ (translate from french) --------
    CG> Note : method with signature "A#missing" chose for function "plot",
    CG> signature cible "B#missing".
    CG> "B#ANY" could also be compatible

Yes, method dispatch had indirectly been greatly improved
in 2.9.0, as the elimination of duplicate superclasses and a
consistent (superclass) ordering was introduced.

Look at
   ?Methods
and skip to its references (simply "sr" in ESS),
finding

     Chambers, John M.(2009) _Developments in Class Inheritance and
     Method Selection_ <URL:
     http://stat.stanford.edu/~jmc4/classInheritance.pdf>.

which is very recommended, and, BTW, as I just notice, has been
updated in the very last few days,
judging from my earlier reading; the updates include new
features of class definition / method dispatch in the situation
where S3 and S4 are intermingled.

Regards,
Martin Maechler, ETH Zurich


From jari.oksanen at oulu.fi  Wed Jun 10 14:27:27 2009
From: jari.oksanen at oulu.fi (Jari Oksanen)
Date: Wed, 10 Jun 2009 15:27:27 +0300
Subject: [Rd] cmdscale & non-Euclidean dissimilarities
Message-ID: <1244636847.4065.28.camel@biol102145.oulu.fi>

Dear R gurus,

I think that cmdscale() function has problems with non-Euclidean
distances which have negative eigenvalues. The problems are two-fold: 

(1) Wrong eigenvalue is removed: there will be at least one zero
eigenvalue in cmdscale, and the function assumes it is the last one.
With non-Euclidean dissimilarities you will have negative eigenvalues,
and the zero eigenvalue will be the last positive one before negative
eigenvalues. Now the function returns the zero eigenvalue and
corresponding zero-eigenvector, but drops the last negative eigenvalue
(which has larger absolute value than any other negative eigenvalue). 

(2) Gower (1985) says that with non-Euclidean matrices and negative
eigenvalues you will have imaginary axes, and the distances on imaginary
axes (negative eigenvalues) should be subtracted from the distances on
real axes (positive eigenvalues). The formulation in the article is like
this (Gower 1985, p. 93):

"""
f_{ii} + f_{jj} - 2 f_{ij} = d_{ij}^2 =
\sum_{p=1}^r (l_{pi} - l_{pj})^2 - \sum_{p=r+1}^{r+s} (l_{pi} - l_{pj})^ 2

This is the usual "Pythagorean" representation of squared distances in
terms of coordinates $l_{pi} (p = 1, 2 \ldots r+s)$, except that for
$p>r$ the coordinates become purely imaginary.
"""

This also suggests that for GOF (goodness of fit) measure of cmdscale()
the negative eigenvalues should be subtracted from the sum of positive
eigenvalues. Currently, the function uses two ways: the sum of abs
values of eigenvalues (and it should be sum of eigenvalues with their
signs), and the sum of above-zero eigenvalues for the total. The latter
makes some sense, but the first looks non-Gowerian. 

Reference

Gower, J. C. (1985) Properties of Euclidean and non-Euclidean distance
matrices. Linear Algebra and its Applications 67, 81--97. 

The following change seems to avoid both problems. The change removes
only the eigenvalue that is closest to the zero. There may be more than
one zero eigenvalue (or of magnitude 1e-17), but this leaves the rest
there. It also changes the way the first alternative of GOF is
calculated. This changes the code as little as possible, and it still
leaves behind some cruft of the old code that assumed that last
eigenvalue is the zero eigenvalue. 

--- R/src/library/stats/R/cmdscale.R	(revision 48741)
+++ R/src/library/stats/R/cmdscale.R	(working copy)
@@ -56,6 +56,9 @@
         x[non.diag] <- (d[non.diag] + add.c)^2
     }
     e <- eigen(-x/2, symmetric = TRUE)
+    zeroeig <- which.min(abs(e$values))
+    e$values <- e$values[-zeroeig]
+    e$vectors <- e$vectors[ , -zeroeig, drop = FALSE]
     ev <- e$values[1L:k]
     if(any(ev < 0))
         warning(gettextf("some of the first %d eigenvalues are < 0", k),
@@ -63,9 +66,9 @@
     points <- e$vectors[, 1L:k, drop = FALSE] %*% diag(sqrt(ev), k)
     dimnames(points) <- list(rn, NULL)
     if (eig || x.ret || add) {
-        evalus <- e$values[-n]
+        evalus <- e$values
         list(points = points, eig = if(eig) ev, x = if(x.ret) x,
              ac = if(add) add.c else 0,
-             GOF = sum(ev)/c(sum(abs(evalus)), sum(evalus[evalus > 0])))
+             GOF = sum(ev)/c(sum(evalus), sum(evalus[evalus > 0])))
     } else points
 }

Best wishes, Jari Oksanen
-- 
Jari Oksanen -- Dept Biology, Univ Oulu, FI-90014 Oulu, Finland
email jari.oksanen at oulu.fi, homepage http://cc.oulu.fi/~jarioksa/


From ripley at stats.ox.ac.uk  Wed Jun 10 16:01:26 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 10 Jun 2009 15:01:26 +0100 (BST)
Subject: [Rd] Reduce: extra args wishlist?
In-Reply-To: <4A2AF18D.8030805@ufl.edu>
References: <4A2AF18D.8030805@ufl.edu>
Message-ID: <alpine.LFD.2.00.0906101454580.22065@gannet.stats.ox.ac.uk>

On Sat, 6 Jun 2009, Ben Bolker wrote:

>
>  Is there a reason that Reduce() doesn't take a "..." argument that
> would allow arbitrary extra arguments to be passed through to the function?
>
>  Here is a little example of how this would be convenient:
>
> z <- list(
>          data.frame(state=c("California"),
>                     cases=0),
>          data.frame(state=c("California","Massachusetts"),
>                     cases=c(1,2)),
>          data.frame(state=c("California","Massachusetts","Arizona"),
>                     cases=c(1,2,17)))
>
> ## read in revised version of Reduce()
> Reduce(merge,z,by="state",all=TRUE)
>
>  The change is simple -- just add "..." to every call to the function
> in Reduce() --  patch is included below my signature ...
>
>  It's not a big deal -- I could also do
> Reduce(function(x,y) { merge(x,y,by="state",all=TRUE) }, z)
> but there doesn't seem to be a good reason not to allow it ...

I think the idiom of the languages from which this comes would indeed 
to be use an anonymous function, and in R to use ... and no braces, as 
in

Reduce(function(...) merge(..., by="state", all=TRUE), z)

But that's not the (ony) R idiom, so I am happy to add a ... argument 
to Reduce.  Unfortunately the patch below is backwards (you have diffs 
from old to new in 'patch' format), and we do need to patch the 
documentation (which gets a bit ugly as ... has a different meaning 
for another function on the Reduce help page).  I think I have sorted 
these out, and will commit to R-devel shortly.

>
>  cheers
>    Ben Bolker
>
>
> -- 
> Ben Bolker
> Associate professor, Biology Dep't, Univ. of Florida
> bolker at ufl.edu / www.zoology.ufl.edu/bolker
> GPG key: www.zoology.ufl.edu/bolker/benbolker-publickey.asc
>
>
> *** /home/ben/funprog.R.new	2009-06-06 18:30:56.000000000 -0400
> --- src/library/base/R/funprog.R	2009-02-12 10:39:32.000000000 -0500
> ***************
> *** 15,21 ****
>  #  http://www.r-project.org/Licenses/
>
>  Reduce <-
> ! function(f, x, init, right = FALSE, accumulate = FALSE, ...)
>  {
>      mis <- missing(init)
>      len <- length(x)
> --- 15,21 ----
>  #  http://www.r-project.org/Licenses/
>
>  Reduce <-
> ! function(f, x, init, right = FALSE, accumulate = FALSE)
>  {
>      mis <- missing(init)
>      len <- length(x)
> ***************
> *** 47,57 ****
>      if(!accumulate) {
>          if(right) {
>              for(i in rev(ind))
> !                 init <- f(x[[i]], init, ...)
>          }
>          else {
>              for(i in ind)
> !                 init <- f(init, x[[i]], ...)
>          }
>          init
>      }
> --- 47,57 ----
>      if(!accumulate) {
>          if(right) {
>              for(i in rev(ind))
> !                 init <- f(x[[i]], init)
>          }
>          else {
>              for(i in ind)
> !                 init <- f(init, x[[i]])
>          }
>          init
>      }
> ***************
> *** 64,76 ****
>              if(right) {
>                  out[[len]] <- init
>                  for(i in rev(ind)) {
> !                     init <- f(x[[i]], init, ...)
>                      out[[i]] <- init
>                  }
>              } else {
>                  out[[1L]] <- init
>                  for(i in ind) {
> !                     init <- f(init, x[[i]], ...)
>                      out[[i]] <- init
>                  }
>              }
> --- 64,76 ----
>              if(right) {
>                  out[[len]] <- init
>                  for(i in rev(ind)) {
> !                     init <- f(x[[i]], init)
>                      out[[i]] <- init
>                  }
>              } else {
>                  out[[1L]] <- init
>                  for(i in ind) {
> !                     init <- f(init, x[[i]])
>                      out[[i]] <- init
>                  }
>              }
> ***************
> *** 78,91 ****
>              if(right) {
>                  out[[len]] <- init
>                  for(i in rev(ind)) {
> !                     init <- f(x[[i]], init, ...)
>                      out[[i]] <- init
>                  }
>              }
>              else {
>                  for(i in ind) {
>                      out[[i]] <- init
> !                     init <- f(init, x[[i]], ...)
>                  }
>                  out[[len]] <- init
>              }
> --- 78,91 ----
>              if(right) {
>                  out[[len]] <- init
>                  for(i in rev(ind)) {
> !                     init <- f(x[[i]], init)
>                      out[[i]] <- init
>                  }
>              }
>              else {
>                  for(i in ind) {
>                      out[[i]] <- init
> !                     init <- f(init, x[[i]])
>                  }
>                  out[[len]] <- init
>              }
>
>
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From bolker at ufl.edu  Wed Jun 10 16:06:07 2009
From: bolker at ufl.edu (Ben Bolker)
Date: Wed, 10 Jun 2009 10:06:07 -0400
Subject: [Rd] Reduce: extra args wishlist?
In-Reply-To: <alpine.LFD.2.00.0906101454580.22065@gannet.stats.ox.ac.uk>
References: <4A2AF18D.8030805@ufl.edu>
	<alpine.LFD.2.00.0906101454580.22065@gannet.stats.ox.ac.uk>
Message-ID: <4A2FBDCF.4050003@ufl.edu>

Prof Brian Ripley wrote:
> I think the idiom of the languages from which this comes would indeed 
> to be use an anonymous function, and in R to use ... and no braces, as 
> in
> 
> Reduce(function(...) merge(..., by="state", all=TRUE), z)
> 
> But that's not the (ony) R idiom, so I am happy to add a ... argument 
> to Reduce.  Unfortunately the patch below is backwards (you have diffs 
> from old to new in 'patch' format), and we do need to patch the 
> documentation (which gets a bit ugly as ... has a different meaning 
> for another function on the Reduce help page).  I think I have sorted 
> these out, and will commit to R-devel shortly.

  Hmm.  Thanks.  Sorry about the patch glitch.  (On my Ubuntu system,
patch has a -R flag that would seem to take care of that ...)

  I accepted Kurt's explanation.  I'm curious what the protocol is when
R-core members differ?  (I would have guessed that conservatism would
rule, or the opinion of the original author of the functions (I don't
know who contributed Reduce et al.), but perhaps Kurt doesn't have
strong feelings about this ...

  cheers
    Ben



-- 
Ben Bolker
Associate professor, Biology Dep't, Univ. of Florida
bolker at ufl.edu / www.zoology.ufl.edu/bolker
GPG key: www.zoology.ufl.edu/bolker/benbolker-publickey.asc

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 260 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090610/5d27ecfb/attachment.bin>

From ggrothendieck at gmail.com  Wed Jun 10 16:23:44 2009
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Wed, 10 Jun 2009 10:23:44 -0400
Subject: [Rd] Reduce: extra args wishlist?
In-Reply-To: <4A2FBDCF.4050003@ufl.edu>
References: <4A2AF18D.8030805@ufl.edu>
	<alpine.LFD.2.00.0906101454580.22065@gannet.stats.ox.ac.uk> 
	<4A2FBDCF.4050003@ufl.edu>
Message-ID: <971536df0906100723r239a7f84p34a923302baba6bd@mail.gmail.com>

If ... is not available you can get a minor reduction using fn$ in gsubfn.
Any function call prefaced by fn$ allows the use of formulas as functions
(and perl-like interpolation of strings) in the call args (subject to certain
rules that determine which args are interpreted and which not).  The LHS
of the formula specifies the args but if omitted then it uses the free
variables from the RHS in the order encountered:

> library(gsubfn)
> fn$Reduce(~ merge(x, y, by = "state", all = TRUE), z)
          state cases.x cases.y cases
1    California       0       1     1
2 Massachusetts      NA       2     2
3       Arizona      NA      NA    17

See http://gsubfn.googlecode.com for more.

On Wed, Jun 10, 2009 at 10:06 AM, Ben Bolker<bolker at ufl.edu> wrote:
> Prof Brian Ripley wrote:
>> I think the idiom of the languages from which this comes would indeed
>> to be use an anonymous function, and in R to use ... and no braces, as
>> in
>>
>> Reduce(function(...) merge(..., by="state", all=TRUE), z)
>>
>> But that's not the (ony) R idiom, so I am happy to add a ... argument
>> to Reduce. ?Unfortunately the patch below is backwards (you have diffs
>> from old to new in 'patch' format), and we do need to patch the
>> documentation (which gets a bit ugly as ... has a different meaning
>> for another function on the Reduce help page). ?I think I have sorted
>> these out, and will commit to R-devel shortly.
>
> ?Hmm. ?Thanks. ?Sorry about the patch glitch. ?(On my Ubuntu system,
> patch has a -R flag that would seem to take care of that ...)
>
> ?I accepted Kurt's explanation. ?I'm curious what the protocol is when
> R-core members differ? ?(I would have guessed that conservatism would
> rule, or the opinion of the original author of the functions (I don't
> know who contributed Reduce et al.), but perhaps Kurt doesn't have
> strong feelings about this ...
>
> ?cheers
> ? ?Ben
>
>
>
> --
> Ben Bolker
> Associate professor, Biology Dep't, Univ. of Florida
> bolker at ufl.edu / www.zoology.ufl.edu/bolker
> GPG key: www.zoology.ufl.edu/bolker/benbolker-publickey.asc
>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From Nicolas.Thierry-Mieg at imag.fr  Wed Jun 10 16:35:09 2009
From: Nicolas.Thierry-Mieg at imag.fr (Nicolas.Thierry-Mieg at imag.fr)
Date: Wed, 10 Jun 2009 16:35:09 +0200 (CEST)
Subject: [Rd] .Rhistory created with wrong permissions (PR#13752)
Message-ID: <20090610143509.5027C282BE87@mail.pubhealth.ku.dk>

Hi,


This is with a centos 5.3 x86_64 system, using R 2.8.1 (details below).

In a directory where R is invoked, at the end of a session R offers to 
"Save workspace image". Replying yes creates/updates at least two files 
in the current directory: .Rhistory and .RData.
.Rhistory is created with permissions 0600, therefore it effectively 
ignores umask. In particular, .Rhistory cannot be group-readable, which 
can be problematic in some environments.
This is not the case for .RData (created 0666, modified by umask as 
usual), so I doubt that the .Rhistory permissions are restrictive by design?
If not, it would be better to create .Rhistory 0666 and let the user 
control the actual permissions through umask.

Regards,
Nicolas Thierry-Mieg

*****************************
Steps to reproduce:

[nthierry at tryo ~]$ mkdir ttt
[nthierry at tryo ~]$ cd ttt
[nthierry at tryo ttt]$ R
<snip copyright and greeting message>
 > y<-3
 > q()
Save workspace image? [y/n/c]: y
[nthierry at tryo ttt]$ ls -la
total 20
drwxr-xr-x  2 nthierry timb 4096 Jun 10 16:21 .
drwxr-x--- 80 nthierry timb 4096 Jun 10 15:18 ..
-rw-r--r--  1 nthierry timb   61 Jun 10 16:21 .RData
-rw-------  1 nthierry timb    9 Jun 10 16:21 .Rhistory
[nthierry at tryo ttt]$



Using strace on the R process shows the following, which seems to 
confirm that the problem comes from R itself:

open(".RDataTmp", O_WRONLY|O_CREAT|O_TRUNC, 0666)
<snip>
rename(".RDataTmp", ".RData")
open(".Rhistory", O_WRONLY|O_CREAT|O_TRUNC, 0600)



*****************************
 > version
platform       x86_64-redhat-linux-gnu
arch           x86_64
os             linux-gnu
system         x86_64, linux-gnu
status
major          2
minor          8.1
year           2008
month          12
day            22
svn rev        47281
language       R
version.string R version 2.8.1 (2008-12-22)


From luke at stat.uiowa.edu  Wed Jun 10 22:05:19 2009
From: luke at stat.uiowa.edu (luke at stat.uiowa.edu)
Date: Wed, 10 Jun 2009 15:05:19 -0500 (CDT)
Subject: [Rd] reference counting bug related to break and next in loops
In-Reply-To: <77EB52C6DD32BA4D87471DCD70C8D7000147B96C@NA-PA-VBE03.na.tibco.com>
References: <77EB52C6DD32BA4D87471DCD70C8D7000147B96C@NA-PA-VBE03.na.tibco.com>
Message-ID: <alpine.LFD.2.00.0906101448250.4226@itasca2.wildberry.org>

Thanks for the report.

It turns out that a similar issue arises in while() loops without
break/next being involved because the test expression is evaluated
after the final body evaluation.  After some discussion we decided it
was simplest both for implementation and documentation to have the
value of a loop expression always be NULL.  This is now implemented in
R-devel.

luke

On Tue, 2 Jun 2009, William Dunlap wrote:

> One of our R users here just showed me the following problem while
> investigating the return value of a while loop.  I added some
> information
> on a similar bug in for loops.  I think he was using 2.9.0
> but I see the same problem on today's development version of 2.10.0
> (svn 48703).
>
> Should the semantics of while and for loops be changed slightly to avoid
> the memory
> buildup that fixing this to reflect the current docs would entail?  S+'s
> loops return nothing useful - that change was made long ago to avoid
> memory buildup resulting from semantics akin the R's present semantics.
>
> Bill Dunlap
> TIBCO Software Inc - Spotfire Division
> wdunlap tibco.com
>
> --------------------Forwarded (and edited) message
> below-------------------------------------------------------------------
> ----------
>
> I think I have found another reference counting bug.
>
> If you type in the following in R you get what I think is the wrong
> result.
>
>> i = 1; y = 1:10; q = while(T) { y[i] = 42; if (i == 8) { break }; i =
> i + 1; y}; q
> [1] 42 42 42 42 42 42 42 42  9 10
>
> I had expected  [1] 42 42 42 42 42 42 42  8  9 10 which is what you get
> if you add 0 to y in the last statement in the while loop:
>
>> i = 1; y = 1:10; q = while(T) { y[i] = 42; if (i == 8) { break }; i =
> i + 1; y + 0}; q
> [1] 42 42 42 42 42 42 42  8  9 10
>
> Also,
>
>> i = 1; y = 1:10; q = while(T) { y[i] = 42; if (i == 8) { break };
> i<-i+1 ; if (i<=8&&i>3)next ; cat("Completing iteration", i, "\n"); y};
> q
> Completing iteration 2
> Completing iteration 3
> [1] 42 42 42 42 42 42 42 42  9 10
>
> but if the last statement in the while loop is y+0 instead of y I get
> the
> expected result:
>
>> i = 1; y = 1:10; q = while(T) { y[i] = 42; if (i == 8) { break };
> i<-i+1 ; if (i<=8&&i>3)next ; cat("Completing iteration", i, "\n");
> y+0L}; q
> Completing iteration 2
> Completing iteration 3
> [1] 42 42  3  4  5  6  7  8  9 10
>
> A background to the problem is that in R a while-loop returns the value
> of the last iteration. However there is an exception if an iteration is
> terminated by a break or a next. Then the value is the value of the
> previously completed iteration that did not execute a break or next.
> Thus in an extreme case the value of the while may be the value of the
> very first iteration even though it executed a million iterations.
>
> Thus to implement that correctly one needs to keep a reference to the
> value of the last non-terminated iteration. It seems as if the current R
> implementation does that but does not increase the reference counter
> which explains the odd behavior.
>
> The for loop example is
>
>> z<-{ tmp<-rep(pi,10);for(i in 1:10){ tmp[i]<-i^2;if(i==9)break ; if
> (i<9&&i>3)next ; tmp } }
>> z
> [1]  1.000000  4.000000  9.000000 16.000000 25.000000 36.000000
> 49.000000
> [8] 64.000000 81.000000  3.141593
>> z<-{ tmp<-rep(pi,10);for(i in 1:10){ tmp[i]<-i^2;if(i==9)break ; if
> (i<9&&i>3)next ; tmp+0 } }
>> z
> [1] 1.000000 4.000000 9.000000 3.141593 3.141593 3.141593 3.141593
> 3.141593
> [9] 3.141593 3.141593
>
> I can think of a couple of ways to solve this.
>
> 1.       Increment the reference counter. This solves the bug but may
> have serious performance implications. In the while example above it
> needs to copy y in every iteration.
>
> 2.       Change the semantics of while loops by getting rid of the
> exception described above. When a loop is terminated with a break the
> value of the loop would be NULL. Thus there is no need to keep a
> reference to the value of the last non-terminated iteration.
>
> Any opinions?
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Luke Tierney
Chair, Statistics and Actuarial Science
Ralph E. Wareham Professor of Mathematical Sciences
University of Iowa                  Phone:             319-335-3386
Department of Statistics and        Fax:               319-335-3017
    Actuarial Science
241 Schaeffer Hall                  email:      luke at stat.uiowa.edu
Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu


From pgilbert at bank-banque-canada.ca  Wed Jun 10 22:47:29 2009
From: pgilbert at bank-banque-canada.ca (Paul Gilbert)
Date: Wed, 10 Jun 2009 16:47:29 -0400
Subject: [Rd] .Rhistory created with wrong permissions (PR#13752)
In-Reply-To: <20090610143509.5027C282BE87@mail.pubhealth.ku.dk>
References: <20090610143509.5027C282BE87@mail.pubhealth.ku.dk>
Message-ID: <4A301BE1.50305@bank-banque-canada.ca>

Nicolas.Thierry-Mieg at imag.fr wrote:
> Hi,
>
>
> This is with a centos 5.3 x86_64 system, using R 2.8.1 (details below).
>
> In a directory where R is invoked, at the end of a session R offers to 
> "Save workspace image". Replying yes creates/updates at least two files 
> in the current directory: .Rhistory and .RData.
> .Rhistory is created with permissions 0600, therefore it effectively 
> ignores umask. In particular, .Rhistory cannot be group-readable, which 
> can be problematic in some environments.
> This is not the case for .RData (created 0666, modified by umask as 
> usual), so I doubt that the .Rhistory permissions are restrictive by design?
>   
I`m not sure, but it may be by design.  For example, users sometimes use 
passwords to connections, which one might not want accidentally recorded 
in a readable file.

Paul
> If not, it would be better to create .Rhistory 0666 and let the user 
> control the actual permissions through umask.
>
> Regards,
> Nicolas Thierry-Mieg
>
> *****************************
> Steps to reproduce:
>
> [nthierry at tryo ~]$ mkdir ttt
> [nthierry at tryo ~]$ cd ttt
> [nthierry at tryo ttt]$ R
> <snip copyright and greeting message>
>  > y<-3
>  > q()
> Save workspace image? [y/n/c]: y
> [nthierry at tryo ttt]$ ls -la
> total 20
> drwxr-xr-x  2 nthierry timb 4096 Jun 10 16:21 .
> drwxr-x--- 80 nthierry timb 4096 Jun 10 15:18 ..
> -rw-r--r--  1 nthierry timb   61 Jun 10 16:21 .RData
> -rw-------  1 nthierry timb    9 Jun 10 16:21 .Rhistory
> [nthierry at tryo ttt]$
>
>
>
> Using strace on the R process shows the following, which seems to 
> confirm that the problem comes from R itself:
>
> open(".RDataTmp", O_WRONLY|O_CREAT|O_TRUNC, 0666)
> <snip>
> rename(".RDataTmp", ".RData")
> open(".Rhistory", O_WRONLY|O_CREAT|O_TRUNC, 0600)
>
>
>
> *****************************
>  > version
> platform       x86_64-redhat-linux-gnu
> arch           x86_64
> os             linux-gnu
> system         x86_64, linux-gnu
> status
> major          2
> minor          8.1
> year           2008
> month          12
> day            22
> svn rev        47281
> language       R
> version.string R version 2.8.1 (2008-12-22)
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>   
====================================================================================

La version fran?aise suit le texte anglais.

------------------------------------------------------------------------------------

This email may contain privileged and/or confidential in...{{dropped:26}}


From wdunlap at tibco.com  Wed Jun 10 23:35:23 2009
From: wdunlap at tibco.com (William Dunlap)
Date: Wed, 10 Jun 2009 14:35:23 -0700
Subject: [Rd] reference counting bug related to break and next in loops
In-Reply-To: <alpine.LFD.2.00.0906101448250.4226@itasca2.wildberry.org>
References: <77EB52C6DD32BA4D87471DCD70C8D7000147B96C@NA-PA-VBE03.na.tibco.com>
	<alpine.LFD.2.00.0906101448250.4226@itasca2.wildberry.org>
Message-ID: <77EB52C6DD32BA4D87471DCD70C8D7000152F21C@NA-PA-VBE03.na.tibco.com>

Thanks Luke.

I used codetools::walkCode to look for functions that returned the
value of a loop and found a surprising number in base R.
However, it looks like non of these functions were written to return
anything useful (the side effects were important), so the change
to loop-returns-NULL should let such functions use less
memory (and time) and make them correspond better to their
documentation.

E.g., fixup.libraries.URLs is not documented to return anything
and it returns the value of for loop:

$`src/library/utils/R/windows/linkhtml.R`[[2]]
function(lib.loc = .libPaths())
{
    for (lib in lib.loc) {
        if(lib == .Library) next
        pg <- sort(.packages(all.available = TRUE, lib.loc = lib))
        for(pkg in pg)
            try(fixup.package.URLs(file.path(lib,pkg)), silent = TRUE)
    }
}

Bill Dunlap
TIBCO Software Inc - Spotfire Division
wdunlap tibco.com  

> -----Original Message-----
> From: luke at stat.uiowa.edu [mailto:luke at stat.uiowa.edu] 
> Sent: Wednesday, June 10, 2009 1:05 PM
> To: William Dunlap
> Cc: r-devel at r-project.org
> Subject: Re: [Rd] reference counting bug related to break and 
> next in loops
> 
> Thanks for the report.
> 
> It turns out that a similar issue arises in while() loops without
> break/next being involved because the test expression is evaluated
> after the final body evaluation.  After some discussion we decided it
> was simplest both for implementation and documentation to have the
> value of a loop expression always be NULL.  This is now implemented in
> R-devel.
> 
> luke
> 
> On Tue, 2 Jun 2009, William Dunlap wrote:
> 
> > One of our R users here just showed me the following problem while
> > investigating the return value of a while loop.  I added some
> > information
> > on a similar bug in for loops.  I think he was using 2.9.0
> > but I see the same problem on today's development version of 2.10.0
> > (svn 48703).
> >
> > Should the semantics of while and for loops be changed 
> slightly to avoid
> > the memory
> > buildup that fixing this to reflect the current docs would 
> entail?  S+'s
> > loops return nothing useful - that change was made long ago to avoid
> > memory buildup resulting from semantics akin the R's 
> present semantics.
> >
> > Bill Dunlap
> > TIBCO Software Inc - Spotfire Division
> > wdunlap tibco.com
> >
> > --------------------Forwarded (and edited) message
> > 
> below---------------------------------------------------------
> ----------
> > ----------
> >
> > I think I have found another reference counting bug.
> >
> > If you type in the following in R you get what I think is the wrong
> > result.
> >
> >> i = 1; y = 1:10; q = while(T) { y[i] = 42; if (i == 8) { 
> break }; i =
> > i + 1; y}; q
> > [1] 42 42 42 42 42 42 42 42  9 10
> >
> > I had expected  [1] 42 42 42 42 42 42 42  8  9 10 which is 
> what you get
> > if you add 0 to y in the last statement in the while loop:
> >
> >> i = 1; y = 1:10; q = while(T) { y[i] = 42; if (i == 8) { 
> break }; i =
> > i + 1; y + 0}; q
> > [1] 42 42 42 42 42 42 42  8  9 10
> >
> > Also,
> >
> >> i = 1; y = 1:10; q = while(T) { y[i] = 42; if (i == 8) { break };
> > i<-i+1 ; if (i<=8&&i>3)next ; cat("Completing iteration", 
> i, "\n"); y};
> > q
> > Completing iteration 2
> > Completing iteration 3
> > [1] 42 42 42 42 42 42 42 42  9 10
> >
> > but if the last statement in the while loop is y+0 instead 
> of y I get
> > the
> > expected result:
> >
> >> i = 1; y = 1:10; q = while(T) { y[i] = 42; if (i == 8) { break };
> > i<-i+1 ; if (i<=8&&i>3)next ; cat("Completing iteration", i, "\n");
> > y+0L}; q
> > Completing iteration 2
> > Completing iteration 3
> > [1] 42 42  3  4  5  6  7  8  9 10
> >
> > A background to the problem is that in R a while-loop 
> returns the value
> > of the last iteration. However there is an exception if an 
> iteration is
> > terminated by a break or a next. Then the value is the value of the
> > previously completed iteration that did not execute a break or next.
> > Thus in an extreme case the value of the while may be the 
> value of the
> > very first iteration even though it executed a million iterations.
> >
> > Thus to implement that correctly one needs to keep a 
> reference to the
> > value of the last non-terminated iteration. It seems as if 
> the current R
> > implementation does that but does not increase the reference counter
> > which explains the odd behavior.
> >
> > The for loop example is
> >
> >> z<-{ tmp<-rep(pi,10);for(i in 1:10){ tmp[i]<-i^2;if(i==9)break ; if
> > (i<9&&i>3)next ; tmp } }
> >> z
> > [1]  1.000000  4.000000  9.000000 16.000000 25.000000 36.000000
> > 49.000000
> > [8] 64.000000 81.000000  3.141593
> >> z<-{ tmp<-rep(pi,10);for(i in 1:10){ tmp[i]<-i^2;if(i==9)break ; if
> > (i<9&&i>3)next ; tmp+0 } }
> >> z
> > [1] 1.000000 4.000000 9.000000 3.141593 3.141593 3.141593 3.141593
> > 3.141593
> > [9] 3.141593 3.141593
> >
> > I can think of a couple of ways to solve this.
> >
> > 1.       Increment the reference counter. This solves the 
> bug but may
> > have serious performance implications. In the while example above it
> > needs to copy y in every iteration.
> >
> > 2.       Change the semantics of while loops by getting rid of the
> > exception described above. When a loop is terminated with a 
> break the
> > value of the loop would be NULL. Thus there is no need to keep a
> > reference to the value of the last non-terminated iteration.
> >
> > Any opinions?
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >
> 
> -- 
> Luke Tierney
> Chair, Statistics and Actuarial Science
> Ralph E. Wareham Professor of Mathematical Sciences
> University of Iowa                  Phone:             319-335-3386
> Department of Statistics and        Fax:               319-335-3017
>     Actuarial Science
> 241 Schaeffer Hall                  email:      luke at stat.uiowa.edu
> Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu
> 


From dutangc at gmail.com  Thu Jun 11 08:32:41 2009
From: dutangc at gmail.com (Christophe Dutang)
Date: Thu, 11 Jun 2009 08:32:41 +0200
Subject: [Rd] cran task view
Message-ID: <A0692CCC-1319-4D30-A3A8-4BCEC9F8382F@gmail.com>

Hi all,

Yesterday, I try to look at a CRAN task view on extreme value theory  
(EVT). Does anyone plan to do a CRAN task view on this topic?

Packages related to this topic seem to be spread among finance,  
econometrics and social econometrics.

Maybe this discussion could wait this july useR?

Thanks in advance for any advice

Christophe

--
Christophe Dutang
Ph. D. student at ISFA, Lyon, France
website: http://dutangc.free.fr


From Achim.Zeileis at wu-wien.ac.at  Thu Jun 11 14:11:50 2009
From: Achim.Zeileis at wu-wien.ac.at (Achim Zeileis)
Date: Thu, 11 Jun 2009 14:11:50 +0200 (CEST)
Subject: [Rd] cran task view
In-Reply-To: <A0692CCC-1319-4D30-A3A8-4BCEC9F8382F@gmail.com>
References: <A0692CCC-1319-4D30-A3A8-4BCEC9F8382F@gmail.com>
Message-ID: <Pine.LNX.4.64.0906111407060.28858@paninaro.stat-math.wu-wien.ac.at>

Christophe:

> Yesterday, I try to look at a CRAN task view on extreme value theory (EVT). 
> Does anyone plan to do a CRAN task view on this topic?

Not that I know of.

> Packages related to this topic seem to be spread among finance, econometrics 
> and social econometrics.

Maybe more on the finance side...

> Maybe this discussion could wait this july useR?

Sure, we can talk, probably together with Dirk. I guess that the number 
of packages for EVT is also not excessive so that we might be able to 
include it in the Finance view.

Best,
Z


From edd at debian.org  Thu Jun 11 14:34:11 2009
From: edd at debian.org (Dirk Eddelbuettel)
Date: Thu, 11 Jun 2009 07:34:11 -0500
Subject: [Rd] cran task view
In-Reply-To: <Pine.LNX.4.64.0906111407060.28858@paninaro.stat-math.wu-wien.ac.at>
References: <A0692CCC-1319-4D30-A3A8-4BCEC9F8382F@gmail.com>
	<Pine.LNX.4.64.0906111407060.28858@paninaro.stat-math.wu-wien.ac.at>
Message-ID: <18992.63939.765779.274015@ron.nulle.part>


On 11 June 2009 at 14:11, Achim Zeileis wrote:
| > Yesterday, I try to look at a CRAN task view on extreme value theory (EVT). 
| > Does anyone plan to do a CRAN task view on this topic?
| 
| Not that I know of.
| 
| > Packages related to this topic seem to be spread among finance, econometrics 
| > and social econometrics.
| 
| Maybe more on the finance side...

I also think that we shouldn't get too granular. 20-some task views is fine,
200-some less so. But that is Achim's editorial call to make.

| > Maybe this discussion could wait this july useR?
| 
| Sure, we can talk, probably together with Dirk. I guess that the number 
| of packages for EVT is also not excessive so that we might be able to 
| include it in the Finance view.

Agreed. Patches to the task view are always welcome.  :-)

Dirk

-- 
Three out of two people have difficulties with fractions.


From dutangc at gmail.com  Thu Jun 11 14:57:05 2009
From: dutangc at gmail.com (Christophe Dutang)
Date: Thu, 11 Jun 2009 14:57:05 +0200
Subject: [Rd] cran task view
In-Reply-To: <18992.63939.765779.274015@ron.nulle.part>
References: <A0692CCC-1319-4D30-A3A8-4BCEC9F8382F@gmail.com>
	<Pine.LNX.4.64.0906111407060.28858@paninaro.stat-math.wu-wien.ac.at>
	<18992.63939.765779.274015@ron.nulle.part>
Message-ID: <161D1C63-5F24-4300-8705-B149D9A1CF7E@gmail.com>

Ok,

For the moment, there is only this in the CTV on finance
"
several packages provide functionality for Extreme Value Theory  
models: evd, evdbayes, evir, extRremes, ismev, POT.
"

Before the useR conference, I tried to think on a future section on  
EVT to start a discussion.

Thanks for your quick answer

Christophe

Le 11 juin 09 ? 14:34, Dirk Eddelbuettel a ?crit :

>
> On 11 June 2009 at 14:11, Achim Zeileis wrote:
> | > Yesterday, I try to look at a CRAN task view on extreme value  
> theory (EVT).
> | > Does anyone plan to do a CRAN task view on this topic?
> |
> | Not that I know of.
> |
> | > Packages related to this topic seem to be spread among finance,  
> econometrics
> | > and social econometrics.
> |
> | Maybe more on the finance side...
>
> I also think that we shouldn't get too granular. 20-some task views  
> is fine,
> 200-some less so. But that is Achim's editorial call to make.
>
> | > Maybe this discussion could wait this july useR?
> |
> | Sure, we can talk, probably together with Dirk. I guess that the  
> number
> | of packages for EVT is also not excessive so that we might be able  
> to
> | include it in the Finance view.
>
> Agreed. Patches to the task view are always welcome.  :-)
>
> Dirk
>
> -- 
> Three out of two people have difficulties with fractions.

--
Christophe Dutang
Ph. D. student at ISFA, Lyon, France
website: http://dutangc.free.fr


From ripley at stats.ox.ac.uk  Thu Jun 11 17:28:08 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 11 Jun 2009 16:28:08 +0100 (BST)
Subject: [Rd] .Rhistory created with wrong permissions (PR#13752)
In-Reply-To: <4A301BE1.50305@bank-banque-canada.ca>
References: <20090610143509.5027C282BE87@mail.pubhealth.ku.dk>
	<4A301BE1.50305@bank-banque-canada.ca>
Message-ID: <alpine.LFD.2.00.0906111619370.23886@gannet.stats.ox.ac.uk>

Yes, it is by design, and not R's design at that.

How (or if) the history is saved is determined by the GUI interface in 
use.  In this case it appears to be command-line R built with readline 
support, in which case the saving is done by readline's write_history. 
And although the history.info manual does not say so, it does open 
files with pemissions 0600 (and there is no provison to change this).

To claim 'wrong permissions' implies that you 'know for certain' what 
the permissions should be -- I don't now how you can know them unless 
you can point to documentation that asserts the correct value as 
something different.

On Wed, 10 Jun 2009, Paul Gilbert wrote:

> Nicolas.Thierry-Mieg at imag.fr wrote:
>> Hi,
>> 
>> 
>> This is with a centos 5.3 x86_64 system, using R 2.8.1 (details below).
>> 
>> In a directory where R is invoked, at the end of a session R offers to 
>> "Save workspace image". Replying yes creates/updates at least two files in 
>> the current directory: .Rhistory and .RData.
>> .Rhistory is created with permissions 0600, therefore it effectively 
>> ignores umask. In particular, .Rhistory cannot be group-readable, which can 
>> be problematic in some environments.
>> This is not the case for .RData (created 0666, modified by umask as usual), 
>> so I doubt that the .Rhistory permissions are restrictive by design?
>> 
> I`m not sure, but it may be by design.  For example, users sometimes use 
> passwords to connections, which one might not want accidentally recorded in a 
> readable file.
>
> Paul
>> If not, it would be better to create .Rhistory 0666 and let the user 
>> control the actual permissions through umask.
>> 
>> Regards,
>> Nicolas Thierry-Mieg
>> 
>> *****************************
>> Steps to reproduce:
>> 
>> [nthierry at tryo ~]$ mkdir ttt
>> [nthierry at tryo ~]$ cd ttt
>> [nthierry at tryo ttt]$ R
>> <snip copyright and greeting message>
>>  > y<-3
>>  > q()
>> Save workspace image? [y/n/c]: y
>> [nthierry at tryo ttt]$ ls -la
>> total 20
>> drwxr-xr-x  2 nthierry timb 4096 Jun 10 16:21 .
>> drwxr-x--- 80 nthierry timb 4096 Jun 10 15:18 ..
>> -rw-r--r--  1 nthierry timb   61 Jun 10 16:21 .RData
>> -rw-------  1 nthierry timb    9 Jun 10 16:21 .Rhistory
>> [nthierry at tryo ttt]$
>> 
>> 
>> 
>> Using strace on the R process shows the following, which seems to confirm 
>> that the problem comes from R itself:

Not at all: it comes from a library R uses.

>> open(".RDataTmp", O_WRONLY|O_CREAT|O_TRUNC, 0666)
>> <snip>
>> rename(".RDataTmp", ".RData")
>> open(".Rhistory", O_WRONLY|O_CREAT|O_TRUNC, 0600)
>> 
>> 
>> 
>> *****************************
>>  > version
>> platform       x86_64-redhat-linux-gnu
>> arch           x86_64
>> os             linux-gnu
>> system         x86_64, linux-gnu
>> status
>> major          2
>> minor          8.1
>> year           2008
>> month          12
>> day            22
>> svn rev        47281
>> language       R
>> version.string R version 2.8.1 (2008-12-22)
>> 
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>> 
> ====================================================================================
>
> La version fran?aise suit le texte anglais.
>
> ------------------------------------------------------------------------------------
>
> This email may contain privileged and/or confidential in...{{dropped:26}}
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From anonruser at mit.edu  Fri Jun 12 02:50:12 2009
From: anonruser at mit.edu (anonruser at mit.edu)
Date: Fri, 12 Jun 2009 02:50:12 +0200 (CEST)
Subject: [Rd] ylim (PR#13753)
Message-ID: <20090612005012.A89032830319@mail.pubhealth.ku.dk>

Full_Name: R User
Version: 2.9
OS: All
Submission from: (NULL) (18.26.0.5)


Add xlim and ylim to 'par' documentation page.

> help.search("ylim")
No help files found with alias or concept or title matching ?ylim?
using regular expression matching.


From daniel.elazar at abs.gov.au  Fri Jun 12 09:03:05 2009
From: daniel.elazar at abs.gov.au (Daniel Elazar)
Date: Fri, 12 Jun 2009 17:03:05 +1000
Subject: [Rd] Can't get F77_CALL(dgemm) to work  [SEC=UNCLASSIFIED]
Message-ID: <OFE29E28EF.C28D7E0C-ONCA2575D3.001EFAAB-CA2575D3.0026B94A@abs.gov.au>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090612/ae32df5a/attachment.pl>

From Nicolas.Thierry-Mieg at imag.fr  Thu Jun 11 19:23:37 2009
From: Nicolas.Thierry-Mieg at imag.fr (Nicolas Thierry-Mieg)
Date: Thu, 11 Jun 2009 19:23:37 +0200
Subject: [Rd] .Rhistory created with wrong permissions (PR#13752)
In-Reply-To: <alpine.LFD.2.00.0906111619370.23886@gannet.stats.ox.ac.uk>
References: <20090610143509.5027C282BE87@mail.pubhealth.ku.dk>
	<4A301BE1.50305@bank-banque-canada.ca>
	<alpine.LFD.2.00.0906111619370.23886@gannet.stats.ox.ac.uk>
Message-ID: <4A313D99.40607@imag.fr>

Prof Brian Ripley wrote:
> Yes, it is by design, and not R's design at that.
> 
> How (or if) the history is saved is determined by the GUI interface in 
> use.  In this case it appears to be command-line R built with readline 
> support, in which case the saving is done by readline's write_history. 
> And although the history.info manual does not say so, it does open files 
> with pemissions 0600 (and there is no provison to change this).

OK, undocumented feature of a library R links to.
Thanks for explaining.

> To claim 'wrong permissions' implies that you 'know for certain' what 
> the permissions should be -- I don't now how you can know them unless 
> you can point to documentation that asserts the correct value as 
> something different.

Woah! No need to get snappy or pedantic. There's no documentation one 
way or the other, so "wrong" has to be relative to standard procedure.
There's no documentation saying R doesn't "rm -rf /" on full moons, but 
one still expects that it doesn't.

Most programs create files 0666 modified by umask, except if there's a 
good reason to restrict things.
0666 is also what fopen does when creating a file.
Furthermore .RData is created 0666, and I didn't think a user's history 
was more sensitive than his data, so I thought .Rhistory should be 0666 
as well. Paul's answer about passwords clears that up.

OK, I should have written "unusual permissions".
And I realize now that I should have posted to r-devel instead of 
submitting a bug. Sorry for the noise, I'm new to R.


Regards,
Nicolas Thierry-Mieg


> On Wed, 10 Jun 2009, Paul Gilbert wrote:
> 
>> Nicolas.Thierry-Mieg at imag.fr wrote:
>>> Hi,
>>>
>>>
>>> This is with a centos 5.3 x86_64 system, using R 2.8.1 (details below).
>>>
>>> In a directory where R is invoked, at the end of a session R offers 
>>> to "Save workspace image". Replying yes creates/updates at least two 
>>> files in the current directory: .Rhistory and .RData.
>>> .Rhistory is created with permissions 0600, therefore it effectively 
>>> ignores umask. In particular, .Rhistory cannot be group-readable, 
>>> which can be problematic in some environments.
>>> This is not the case for .RData (created 0666, modified by umask as 
>>> usual), so I doubt that the .Rhistory permissions are restrictive by 
>>> design?
>>>
>> I`m not sure, but it may be by design.  For example, users sometimes 
>> use passwords to connections, which one might not want accidentally 
>> recorded in a readable file.
>>
>> Paul
>>> If not, it would be better to create .Rhistory 0666 and let the user 
>>> control the actual permissions through umask.
>>>
>>> Regards,
>>> Nicolas Thierry-Mieg
>>>
<snip>


From ligges at statistik.tu-dortmund.de  Fri Jun 12 10:45:56 2009
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Fri, 12 Jun 2009 10:45:56 +0200
Subject: [Rd] ylim (PR#13753)
In-Reply-To: <20090612005012.A89032830319@mail.pubhealth.ku.dk>
References: <20090612005012.A89032830319@mail.pubhealth.ku.dk>
Message-ID: <4A3215C4.8090104@statistik.tu-dortmund.de>



anonruser at mit.edu wrote:
> Full_Name: R User
> Version: 2.9
> OS: All
> Submission from: (NULL) (18.26.0.5)
> 
> 
> Add xlim and ylim to 'par' documentation page.

Does not make sense, since it's not an argument to par():

 > par("xlim"=c(0,1))
Warning message:
In par(xlim = c(0, 1)) : "xlim" is not a graphical parameter

But ?par links prominently to ?plot.default which explains them.


Uwe Ligges



>> help.search("ylim")
> No help files found with alias or concept or title matching ?ylim?
> using regular expression matching.
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From jpnolan at american.edu  Fri Jun 12 14:44:27 2009
From: jpnolan at american.edu (John Nolan)
Date: Fri, 12 Jun 2009 08:44:27 -0400
Subject: [Rd] Can't get F77_CALL(dgemm) to work  [SEC=UNCLASSIFIED]
In-Reply-To: <OFE29E28EF.C28D7E0C-ONCA2575D3.001EFAAB-CA2575D3.0026B94A@abs.gov.au>
References: <OFE29E28EF.C28D7E0C-ONCA2575D3.001EFAAB-CA2575D3.0026B94A@abs.gov.au>
Message-ID: <OF78BE494B.20EC8617-ON852575D3.0045FCCE-852575D3.0045FCED@american.edu>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090612/7b846b1b/attachment.pl>

From rksh1 at cam.ac.uk  Fri Jun 12 15:36:52 2009
From: rksh1 at cam.ac.uk (Robin Hankin)
Date: Fri, 12 Jun 2009 14:36:52 +0100
Subject: [Rd] bundle deprecation
Message-ID: <4A3259F4.4090003@cam.ac.uk>

Hi

I read that bundles are to be deprecated in 2.10.

The BACCO bundle contains three packages
(emulator, calibrator, approximator) which I
am happy to unbundle.

But the 'BACCO' moniker has some considerable
cachet for me in terms of recognizability (eg
with grant-giving bodies), as it has become an umbrella
term for a whole bunch of related statistical
functionality of which the three packages are examples.

I make heavy use of the word "BACCO" in my publications.

If bundles were to be supported indefinitely, I
would add further packages to the BACCO
bundle from time to time and their relationship
with the other packages would be clear.

What is the best way to preserve the 'BACCO'
name in a non-bundled world?

Perhaps adding a 'FormerBundle' line in the DESCRIPTION file?


best wishes

Robin




-- 
Robin K. S. Hankin
Uncertainty Analyst
University of Cambridge
19 Silver Street
Cambridge CB3 9EP
01223-764877


From ggrothendieck at gmail.com  Fri Jun 12 16:30:09 2009
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Fri, 12 Jun 2009 10:30:09 -0400
Subject: [Rd] bundle deprecation
In-Reply-To: <4A3259F4.4090003@cam.ac.uk>
References: <4A3259F4.4090003@cam.ac.uk>
Message-ID: <971536df0906120730r6c014934kcc0875b502ebe66f@mail.gmail.com>

Perhaps you could have a package called BACCO
with no contents rather but lists the components of the
bundle as dependencies.  Then package.install("BACCO")
would still install all the components.

On Fri, Jun 12, 2009 at 9:36 AM, Robin Hankin<rksh1 at cam.ac.uk> wrote:
> Hi
>
> I read that bundles are to be deprecated in 2.10.
>
> The BACCO bundle contains three packages
> (emulator, calibrator, approximator) which I
> am happy to unbundle.
>
> But the 'BACCO' moniker has some considerable
> cachet for me in terms of recognizability (eg
> with grant-giving bodies), as it has become an umbrella
> term for a whole bunch of related statistical
> functionality of which the three packages are examples.
>
> I make heavy use of the word "BACCO" in my publications.
>
> If bundles were to be supported indefinitely, I
> would add further packages to the BACCO
> bundle from time to time and their relationship
> with the other packages would be clear.
>
> What is the best way to preserve the 'BACCO'
> name in a non-bundled world?
>
> Perhaps adding a 'FormerBundle' line in the DESCRIPTION file?
>
>
> best wishes
>
> Robin
>
>
>
>
> --
> Robin K. S. Hankin
> Uncertainty Analyst
> University of Cambridge
> 19 Silver Street
> Cambridge CB3 9EP
> 01223-764877
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From talitaperciano at gmail.com  Fri Jun 12 17:18:25 2009
From: talitaperciano at gmail.com (Talita Perciano)
Date: Fri, 12 Jun 2009 12:18:25 -0300
Subject: [Rd] [Fwd: Problem with tabbed notebook (tcltk, Iwidgets)]
Message-ID: <1244819905.6692.0.camel@talita-laptop>


-- 
Talita Perciano
Department of Computer Science - IME - USP
PhD Student in Computer Science
S?o Paulo, SP, Brazil
Tel: +55 11 8826 7092

-------------- next part --------------
An embedded message was scrubbed...
From: Talita Perciano <talitaperciano at gmail.com>
Subject: Problem with tabbed notebook (tcltk, Iwidgets)
Date: Thu, 11 Jun 2009 00:40:40 -0300
Size: 2401
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090612/96d1142c/attachment.mht>

From talitaperciano at gmail.com  Fri Jun 12 17:23:04 2009
From: talitaperciano at gmail.com (Talita Perciano)
Date: Fri, 12 Jun 2009 12:23:04 -0300
Subject: [Rd] Problem with tabbed notebook (tcltk, Iwidgets)
Message-ID: <1244820184.6692.1.camel@talita-laptop>

Hi,

I'm using R version 2.9.0 and I'm trying to execute an example using
tabnotebook from iwidgets. Unfortunately I get a problem as you can see
bellow:


> library(tcltk)
Loading Tcl/Tk interface ... done
> library(tkrplot)
> tclRequire("Iwidgets")
<Tcl> 4.0.1 
> 
> tt <- tktoplevel()
> tkpack(tn <- tkwidget(tt, "iwidgets::tabnotebook"))

 *** caught segfault ***
address 0xffffffb8, cause 'memory not mapped'

Traceback:
 1: .External("dotTclObjv", objv, PACKAGE = "tcltk")
 2: structure(.External("dotTclObjv", objv, PACKAGE = "tcltk"), class =
"tclObj")
 3: .Tcl.objv(.Tcl.args.objv(...))
 4: tcl(type, win, ...)
 5: tkwidget(tt, "iwidgets::tabnotebook")
 6: .Tcl.args.objv(...)
 7: structure(.External("dotTclObjv", objv, PACKAGE = "tcltk"), class =
"tclObj")
 8: .Tcl.objv(.Tcl.args.objv(...))
 9: tcl("pack", ...)
10: tkpack(tn <- tkwidget(tt, "iwidgets::tabnotebook"))

Possible actions:
1: abort (with core dump, if enabled)
2: normal R exit
3: exit R without saving workspace
4: exit R saving workspace
Selection: error in background error handler:
out of stack space (infinite loop?)
    while executing
"::tcl::Bgerror {out of stack space (infinite loop?)} {-code 1 -level 0
-errorcode NONE -errorinfo {out of stack space (infinite loop?)
    while execu..."
error in background error handler:
out of stack space (infinite loop?)
    while executing
"::tcl::Bgerror {out of stack space (infinite loop?)} {-code 1 -level 0
-errorcode NONE -errorinfo {out of stack space (infinite loop?)
    while execu..."


Anybody could help me?

Thanks,

Talita 


-- 
Talita Perciano
Department of Computer Science - IME - USP
PhD Student in Computer Science
S?o Paulo, SP, Brazil
Tel: +55 11 8826 7092


From luke at stat.uiowa.edu  Fri Jun 12 18:01:42 2009
From: luke at stat.uiowa.edu (luke at stat.uiowa.edu)
Date: Fri, 12 Jun 2009 11:01:42 -0500 (CDT)
Subject: [Rd] formal argument "envir" matched by multiple actual
 arguments
In-Reply-To: <alpine.LFD.2.00.0906021031000.7161@nokomis.stat.uiowa.edu>
References: <4A24839C.50403@fhcrc.org>
	<20090602010540.k6d93dfdycc884wg@webmail.fhcrc.org>
	<59d7961d0906020125w5b399755j594a018ca608318c@mail.gmail.com>
	<alpine.LFD.2.00.0906021031000.7161@nokomis.stat.uiowa.edu>
Message-ID: <alpine.LFD.2.00.0906121100350.7161@nokomis.stat.uiowa.edu>

On Tue, 2 Jun 2009, luke at stat.uiowa.edu wrote:

> On Tue, 2 Jun 2009, Henrik Bengtsson wrote:
>
>> Nice case - I think you're onto something. /Henrik
>> 
>> 2009/6/2  <hpages at fhcrc.org>:
>>> In fact reg.finalizer() looks like a dangerous feature.
>>> 
>>> If the finalizer itself triggers (implicitely or
>>> explicitely) garbage collection, then bad things happen.
>>> In the following example, garbage collection is triggered
>>> explicitely (using R-2.9.0):
>>> 
>>> ? setClass("B", representation(bb="environment"))
>>> 
>>> ? newB <- function()
>>> ? {
>>> ? ? ans <- new("B", bb=new.env())
>>> ? ? reg.finalizer(ans at bb,
>>> ? ? ? ? ? ? ? ? ? function(e)
>>> ? ? ? ? ? ? ? ? ? {
>>> ? ? ? ? ? ? ? ? ? ? ? gc()
>>> ? ? ? ? ? ? ? ? ? ? ? cat("cleaning", class(ans), "object...\n")
>>> ? ? ? ? ? ? ? ? ? }
>>> ? ? )
>>> ? ? return(ans)
>>> ? }
>>> 
>>> ? > for (i in 1:500) {cat(i, "\n"); b1 <- newB()}
>>> ? 1
>>> ? 2
>>> ? 3
>>> ? 4
>>> ? 5
>>> ? 6
>>> ? ...
>>> ? 13
>>> ? cleaning B object...
>>> ? cleaning B object...
>>> ? cleaning B object...
>>> ? cleaning B object...
>>> ? cleaning B object...
>>> ? cleaning B object...
>>> ? cleaning B object...
>>> ? cleaning B object...
>>> ? cleaning B object...
>>> ? cleaning B object...
>>> ? cleaning B object...
>>> ? 14
>>> ? ...
>>> ? 169
>>> ? 170
>>> ? 171
>>> ? Error: not a weak reference
>>> ? Error: not a weak reference
>>> ? [repeat the above line thousands of times]
>>> ? ...
>>> ? Error: not a weak reference
>>> ? Error: not a weak reference
>>> ? cleaning B object...
>>> ? Error: SET_VECTOR_ELT() can only be applied to a 'list', not a 'integer'
>>> ? Error: SET_VECTOR_ELT() can only be applied to a 'list', not a 'integer'
>>> ? [repeat the above line thousands of times]
>>> ? ...
>>> ? Error: SET_VECTOR_ELT() can only be applied to a 'list', not a 'integer'
>>> ? Error: SET_VECTOR_ELT() can only be applied to a 'list', not a 'integer'
>>> ? 172
>>> ? ...
>>> ? 246
>>> ? 247
>>> ? cleaning B object...
>>> ? cleaning B object...
>>> ? cleaning B object...
>>> ? cleaning B object...
>>> ? cleaning B object...
>>> ? cleaning B object...
>>> ? cleaning B object...
>>> ? cleaning B object...
>>> ? cleaning B object...
>>> ? cleaning B object...
>>> ? cleaning B object...
>>> ? cleaning B object...
>>> ? cleaning B object...
>>> ? cleaning B object...
>>> ? cleaning B object...
>>> ? cleaning B object...
>>> ? cleaning B object...
>>> ? cleaning B object...
>>> ? cleaning B object...
>>> 
>>> ? ?*** caught segfault ***
>>> ? address 0x41, cause 'memory not mapped'
>>> 
>>> ? Traceback:
>>> ? ?1: gc()
>>> ? ?2: function (e) { ? ?gc() ? ?cat("cleaning", class(ans),
>>> "object...\n")}(<environment>)
>>> 
>>> ? Possible actions:
>>> ? 1: abort (with core dump, if enabled)
>>> ? 2: normal R exit
>>> ? 3: exit R without saving workspace
>>> ? 4: exit R saving workspace
>>> ? Selection: 2
>>> ? Save workspace image? [y/n/c]: n
>>> ? Segmentation fault
>>> 
>>> So apparently, if the finalizer triggers garbage collection,
>>> then we can end up with a corrupted session. Then anything can
>>> happen, from the strange 'formal argument "envir" matched by
>>> multiple actual arguments' error I reported in the previous post,
>>> to a segfault. In the worse case, nothing apparently happens but
>>> the output produced by the code is wrong.
>>> 
>>> Maybe garbage collection requests should be ignored during the
>>> execution of the finalizer? (and more generally during garbbage
>>> collection itself)
>
> Thanks for the report.  The gc proper does not (or should not) do
> anything that could cause allocation or trigger another gc.  The gc
> proper only identifies objects ready for finalization; running the
> finalizers happens outside the gc proper where allocation and gc calls
> should be safe.  This looks like either a missing PROTECT call in the
> code for running finalizers or possibly a more subltle bug in managing
> the lists of objects in different states of finalization. I will look
> more carefully when I get a chance.

This is now fixed in R-devel and the R-patched (it was essentially a
missing PROTECT call).

luke

>
> luke
>
>
>>> 
>>> Cheers,
>>> H.
>>> 
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>> 
>> 
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>> 
>
>

-- 
Luke Tierney
Chair, Statistics and Actuarial Science
Ralph E. Wareham Professor of Mathematical Sciences
University of Iowa                  Phone:             319-335-3386
Department of Statistics and        Fax:               319-335-3017
    Actuarial Science
241 Schaeffer Hall                  email:      luke at stat.uiowa.edu
Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu

From hb at stat.berkeley.edu  Fri Jun 12 19:25:30 2009
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Fri, 12 Jun 2009 10:25:30 -0700
Subject: [Rd] formal argument "envir" matched by multiple actual
	arguments
In-Reply-To: <alpine.LFD.2.00.0906121100350.7161@nokomis.stat.uiowa.edu>
References: <4A24839C.50403@fhcrc.org>
	<20090602010540.k6d93dfdycc884wg@webmail.fhcrc.org> 
	<59d7961d0906020125w5b399755j594a018ca608318c@mail.gmail.com> 
	<alpine.LFD.2.00.0906021031000.7161@nokomis.stat.uiowa.edu> 
	<alpine.LFD.2.00.0906121100350.7161@nokomis.stat.uiowa.edu>
Message-ID: <59d7961d0906121025hce4f27dmf9fdfb6e8bc6897c@mail.gmail.com>

Thank you Luke!  I know you made many people happy by fixing this one,
especially over at BioC.

Is this a candidate for the contest of the bug that survived the
longest without being caught?

I reported on its symptoms in April 2006, but I think I first observed
them in 2003-2004 (thinking for a long time that it was a problem with
my code).

/Henrik

On Fri, Jun 12, 2009 at 9:01 AM, <luke at stat.uiowa.edu> wrote:
> On Tue, 2 Jun 2009, luke at stat.uiowa.edu wrote:
>
>> On Tue, 2 Jun 2009, Henrik Bengtsson wrote:
>>
>>> Nice case - I think you're onto something. /Henrik
>>>
>>> 2009/6/2 ?<hpages at fhcrc.org>:
>>>>
>>>> In fact reg.finalizer() looks like a dangerous feature.
>>>>
>>>> If the finalizer itself triggers (implicitely or
>>>> explicitely) garbage collection, then bad things happen.
>>>> In the following example, garbage collection is triggered
>>>> explicitely (using R-2.9.0):
>>>>
>>>> ? setClass("B", representation(bb="environment"))
>>>>
>>>> ? newB <- function()
>>>> ? {
>>>> ? ? ans <- new("B", bb=new.env())
>>>> ? ? reg.finalizer(ans at bb,
>>>> ? ? ? ? ? ? ? ? ? function(e)
>>>> ? ? ? ? ? ? ? ? ? {
>>>> ? ? ? ? ? ? ? ? ? ? ? gc()
>>>> ? ? ? ? ? ? ? ? ? ? ? cat("cleaning", class(ans), "object...\n")
>>>> ? ? ? ? ? ? ? ? ? }
>>>> ? ? )
>>>> ? ? return(ans)
>>>> ? }
>>>>
>>>> ? > for (i in 1:500) {cat(i, "\n"); b1 <- newB()}
>>>> ? 1
>>>> ? 2
>>>> ? 3
>>>> ? 4
>>>> ? 5
>>>> ? 6
>>>> ? ...
>>>> ? 13
>>>> ? cleaning B object...
>>>> ? cleaning B object...
>>>> ? cleaning B object...
>>>> ? cleaning B object...
>>>> ? cleaning B object...
>>>> ? cleaning B object...
>>>> ? cleaning B object...
>>>> ? cleaning B object...
>>>> ? cleaning B object...
>>>> ? cleaning B object...
>>>> ? cleaning B object...
>>>> ? 14
>>>> ? ...
>>>> ? 169
>>>> ? 170
>>>> ? 171
>>>> ? Error: not a weak reference
>>>> ? Error: not a weak reference
>>>> ? [repeat the above line thousands of times]
>>>> ? ...
>>>> ? Error: not a weak reference
>>>> ? Error: not a weak reference
>>>> ? cleaning B object...
>>>> ? Error: SET_VECTOR_ELT() can only be applied to a 'list', not a
>>>> 'integer'
>>>> ? Error: SET_VECTOR_ELT() can only be applied to a 'list', not a
>>>> 'integer'
>>>> ? [repeat the above line thousands of times]
>>>> ? ...
>>>> ? Error: SET_VECTOR_ELT() can only be applied to a 'list', not a
>>>> 'integer'
>>>> ? Error: SET_VECTOR_ELT() can only be applied to a 'list', not a
>>>> 'integer'
>>>> ? 172
>>>> ? ...
>>>> ? 246
>>>> ? 247
>>>> ? cleaning B object...
>>>> ? cleaning B object...
>>>> ? cleaning B object...
>>>> ? cleaning B object...
>>>> ? cleaning B object...
>>>> ? cleaning B object...
>>>> ? cleaning B object...
>>>> ? cleaning B object...
>>>> ? cleaning B object...
>>>> ? cleaning B object...
>>>> ? cleaning B object...
>>>> ? cleaning B object...
>>>> ? cleaning B object...
>>>> ? cleaning B object...
>>>> ? cleaning B object...
>>>> ? cleaning B object...
>>>> ? cleaning B object...
>>>> ? cleaning B object...
>>>> ? cleaning B object...
>>>>
>>>> ? ?*** caught segfault ***
>>>> ? address 0x41, cause 'memory not mapped'
>>>>
>>>> ? Traceback:
>>>> ? ?1: gc()
>>>> ? ?2: function (e) { ? ?gc() ? ?cat("cleaning", class(ans),
>>>> "object...\n")}(<environment>)
>>>>
>>>> ? Possible actions:
>>>> ? 1: abort (with core dump, if enabled)
>>>> ? 2: normal R exit
>>>> ? 3: exit R without saving workspace
>>>> ? 4: exit R saving workspace
>>>> ? Selection: 2
>>>> ? Save workspace image? [y/n/c]: n
>>>> ? Segmentation fault
>>>>
>>>> So apparently, if the finalizer triggers garbage collection,
>>>> then we can end up with a corrupted session. Then anything can
>>>> happen, from the strange 'formal argument "envir" matched by
>>>> multiple actual arguments' error I reported in the previous post,
>>>> to a segfault. In the worse case, nothing apparently happens but
>>>> the output produced by the code is wrong.
>>>>
>>>> Maybe garbage collection requests should be ignored during the
>>>> execution of the finalizer? (and more generally during garbbage
>>>> collection itself)
>>
>> Thanks for the report. ?The gc proper does not (or should not) do
>> anything that could cause allocation or trigger another gc. ?The gc
>> proper only identifies objects ready for finalization; running the
>> finalizers happens outside the gc proper where allocation and gc calls
>> should be safe. ?This looks like either a missing PROTECT call in the
>> code for running finalizers or possibly a more subltle bug in managing
>> the lists of objects in different states of finalization. I will look
>> more carefully when I get a chance.
>
> This is now fixed in R-devel and the R-patched (it was essentially a
> missing PROTECT call).
>
> luke
>
>>
>> luke
>>
>>
>>>>
>>>> Cheers,
>>>> H.
>>>>
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>
>>
>
> --
> Luke Tierney
> Chair, Statistics and Actuarial Science
> Ralph E. Wareham Professor of Mathematical Sciences
> University of Iowa ? ? ? ? ? ? ? ? ?Phone: ? ? ? ? ? ? 319-335-3386
> Department of Statistics and ? ? ? ?Fax: ? ? ? ? ? ? ? 319-335-3017
> ? Actuarial Science
> 241 Schaeffer Hall ? ? ? ? ? ? ? ? ?email: ? ? ?luke at stat.uiowa.edu
> Iowa City, IA 52242 ? ? ? ? ? ? ? ? WWW: ?http://www.stat.uiowa.edu
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From wdunlap at tibco.com  Fri Jun 12 21:07:13 2009
From: wdunlap at tibco.com (William Dunlap)
Date: Fri, 12 Jun 2009 12:07:13 -0700
Subject: [Rd] reference counting bug related to break and next in loops
References: <77EB52C6DD32BA4D87471DCD70C8D7000147B96C@NA-PA-VBE03.na.tibco.com>
	<alpine.LFD.2.00.0906101448250.4226@itasca2.wildberry.org> 
Message-ID: <77EB52C6DD32BA4D87471DCD70C8D7000152F72B@NA-PA-VBE03.na.tibco.com>

> -----Original Message-----
> From: William Dunlap 
> Sent: Wednesday, June 10, 2009 2:35 PM
> To: 'luke at stat.uiowa.edu'
> Cc: r-devel at r-project.org
> Subject: RE: [Rd] reference counting bug related to break and 
> next in loops
> 
> Thanks Luke.
> 
> I used codetools::walkCode to look for functions that returned the
> value of a loop and found a surprising number in base R.
> However, it looks like non of these functions were written to return
> anything useful (the side effects were important), so the change
> to loop-returns-NULL should let such functions use less
> memory (and time) and make them correspond better to their
> documentation.

I also use walkCode to look for assignents whose right hand sides
were loops.  The only *.R file in a directory containing a current R
build that had such a thing was 
   ./library/base/R-ex/print.R
(from help(print)) and related files in ./tests.  It had
   rr <- for(i in 1:3) print(1:i)
   rr
That last line used to print
   [1] 1 2 3 
and now prints
   NULL
I didn't notice a corresponding *.Rout.save file so the test won't
notice the change in behavior.

I've attached the code I used.  It is pretty crude.
functionReturnsLoopValue("file")
and functionAssignsLoopValue("file") parse "file" and then return a list
of functions
that return the value of a loop and a list of assignments involving the
value of a loop,
respectively.  functionAssignsLoopValue looks for ordinary assignments
(x<-while(...))
and for default argument values (function(x=while(...)){}).  It does not
yet look for
things passed as arguments in function calls,  c(1, while(x>0)x<-x-1,
3).  The last
might pick up some false positives involving functions that don't
evaluate their
arguments.
 
> 
> E.g., fixup.libraries.URLs is not documented to return anything
> and it returns the value of for loop:
> 
> $`src/library/utils/R/windows/linkhtml.R`[[2]]
> function(lib.loc = .libPaths())
> {
>     for (lib in lib.loc) {
>         if(lib == .Library) next
>         pg <- sort(.packages(all.available = TRUE, lib.loc = lib))
>         for(pkg in pg)
>             try(fixup.package.URLs(file.path(lib,pkg)), silent = TRUE)
>     }
> }
> 
> Bill Dunlap
> TIBCO Software Inc - Spotfire Division
> wdunlap tibco.com  
> 
> > -----Original Message-----
> > From: luke at stat.uiowa.edu [mailto:luke at stat.uiowa.edu] 
> > Sent: Wednesday, June 10, 2009 1:05 PM
> > To: William Dunlap
> > Cc: r-devel at r-project.org
> > Subject: Re: [Rd] reference counting bug related to break and 
> > next in loops
> > 
> > Thanks for the report.
> > 
> > It turns out that a similar issue arises in while() loops without
> > break/next being involved because the test expression is evaluated
> > after the final body evaluation.  After some discussion we 
> decided it
> > was simplest both for implementation and documentation to have the
> > value of a loop expression always be NULL.  This is now 
> implemented in
> > R-devel.
> > 
> > luke
> > 
> > On Tue, 2 Jun 2009, William Dunlap wrote:
> > 
> > > One of our R users here just showed me the following problem while
> > > investigating the return value of a while loop.  I added some
> > > information
> > > on a similar bug in for loops.  I think he was using 2.9.0
> > > but I see the same problem on today's development version 
> of 2.10.0
> > > (svn 48703).
> > >
> > > Should the semantics of while and for loops be changed 
> > slightly to avoid
> > > the memory
> > > buildup that fixing this to reflect the current docs would 
> > entail?  S+'s
> > > loops return nothing useful - that change was made long 
> ago to avoid
> > > memory buildup resulting from semantics akin the R's 
> > present semantics.
> > >
> > > Bill Dunlap
> > > TIBCO Software Inc - Spotfire Division
> > > wdunlap tibco.com
> > >
> > > --------------------Forwarded (and edited) message
> > > 
> > below---------------------------------------------------------
> > ----------
> > > ----------
> > >
> > > I think I have found another reference counting bug.
> > >
> > > If you type in the following in R you get what I think is 
> the wrong
> > > result.
> > >
> > >> i = 1; y = 1:10; q = while(T) { y[i] = 42; if (i == 8) { 
> > break }; i =
> > > i + 1; y}; q
> > > [1] 42 42 42 42 42 42 42 42  9 10
> > >
> > > I had expected  [1] 42 42 42 42 42 42 42  8  9 10 which is 
> > what you get
> > > if you add 0 to y in the last statement in the while loop:
> > >
> > >> i = 1; y = 1:10; q = while(T) { y[i] = 42; if (i == 8) { 
> > break }; i =
> > > i + 1; y + 0}; q
> > > [1] 42 42 42 42 42 42 42  8  9 10
> > >
> > > Also,
> > >
> > >> i = 1; y = 1:10; q = while(T) { y[i] = 42; if (i == 8) { break };
> > > i<-i+1 ; if (i<=8&&i>3)next ; cat("Completing iteration", 
> > i, "\n"); y};
> > > q
> > > Completing iteration 2
> > > Completing iteration 3
> > > [1] 42 42 42 42 42 42 42 42  9 10
> > >
> > > but if the last statement in the while loop is y+0 instead 
> > of y I get
> > > the
> > > expected result:
> > >
> > >> i = 1; y = 1:10; q = while(T) { y[i] = 42; if (i == 8) { break };
> > > i<-i+1 ; if (i<=8&&i>3)next ; cat("Completing iteration", 
> i, "\n");
> > > y+0L}; q
> > > Completing iteration 2
> > > Completing iteration 3
> > > [1] 42 42  3  4  5  6  7  8  9 10
> > >
> > > A background to the problem is that in R a while-loop 
> > returns the value
> > > of the last iteration. However there is an exception if an 
> > iteration is
> > > terminated by a break or a next. Then the value is the 
> value of the
> > > previously completed iteration that did not execute a 
> break or next.
> > > Thus in an extreme case the value of the while may be the 
> > value of the
> > > very first iteration even though it executed a million iterations.
> > >
> > > Thus to implement that correctly one needs to keep a 
> > reference to the
> > > value of the last non-terminated iteration. It seems as if 
> > the current R
> > > implementation does that but does not increase the 
> reference counter
> > > which explains the odd behavior.
> > >
> > > The for loop example is
> > >
> > >> z<-{ tmp<-rep(pi,10);for(i in 1:10){ 
> tmp[i]<-i^2;if(i==9)break ; if
> > > (i<9&&i>3)next ; tmp } }
> > >> z
> > > [1]  1.000000  4.000000  9.000000 16.000000 25.000000 36.000000
> > > 49.000000
> > > [8] 64.000000 81.000000  3.141593
> > >> z<-{ tmp<-rep(pi,10);for(i in 1:10){ 
> tmp[i]<-i^2;if(i==9)break ; if
> > > (i<9&&i>3)next ; tmp+0 } }
> > >> z
> > > [1] 1.000000 4.000000 9.000000 3.141593 3.141593 3.141593 3.141593
> > > 3.141593
> > > [9] 3.141593 3.141593
> > >
> > > I can think of a couple of ways to solve this.
> > >
> > > 1.       Increment the reference counter. This solves the 
> > bug but may
> > > have serious performance implications. In the while 
> example above it
> > > needs to copy y in every iteration.
> > >
> > > 2.       Change the semantics of while loops by getting rid of the
> > > exception described above. When a loop is terminated with a 
> > break the
> > > value of the loop would be NULL. Thus there is no need to keep a
> > > reference to the value of the last non-terminated iteration.
> > >
> > > Any opinions?
> > >
> > > ______________________________________________
> > > R-devel at r-project.org mailing list
> > > https://stat.ethz.ch/mailman/listinfo/r-devel
> > >
> > 
> > -- 
> > Luke Tierney
> > Chair, Statistics and Actuarial Science
> > Ralph E. Wareham Professor of Mathematical Sciences
> > University of Iowa                  Phone:             319-335-3386
> > Department of Statistics and        Fax:               319-335-3017
> >     Actuarial Science
> > 241 Schaeffer Hall                  email:      luke at stat.uiowa.edu
> > Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu
> > 
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: walk.R.txt
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090612/b7ac8136/attachment.txt>

From khansen at stat.berkeley.edu  Fri Jun 12 22:42:46 2009
From: khansen at stat.berkeley.edu (Kasper Daniel Hansen)
Date: Fri, 12 Jun 2009 13:42:46 -0700
Subject: [Rd] formal argument "envir" matched by multiple actual
	arguments
In-Reply-To: <59d7961d0906121025hce4f27dmf9fdfb6e8bc6897c@mail.gmail.com>
References: <4A24839C.50403@fhcrc.org>
	<20090602010540.k6d93dfdycc884wg@webmail.fhcrc.org>
	<59d7961d0906020125w5b399755j594a018ca608318c@mail.gmail.com>
	<alpine.LFD.2.00.0906021031000.7161@nokomis.stat.uiowa.edu>
	<alpine.LFD.2.00.0906121100350.7161@nokomis.stat.uiowa.edu>
	<59d7961d0906121025hce4f27dmf9fdfb6e8bc6897c@mail.gmail.com>
Message-ID: <E85A0771-458C-491D-B52A-9312E4718EDD@stat.berkeley.edu>

Great news ! This bug was driving me mad.

I have some scripts that had _high_ probability of running into the  
bug. I'll recompile and check it out over the weekend.

Kasper

On Jun 12, 2009, at 10:25 , Henrik Bengtsson wrote:

> Thank you Luke!  I know you made many people happy by fixing this one,
> especially over at BioC.
>
> Is this a candidate for the contest of the bug that survived the
> longest without being caught?
>
> I reported on its symptoms in April 2006, but I think I first observed
> them in 2003-2004 (thinking for a long time that it was a problem with
> my code).
>
> /Henrik
>
> On Fri, Jun 12, 2009 at 9:01 AM, <luke at stat.uiowa.edu> wrote:
>> On Tue, 2 Jun 2009, luke at stat.uiowa.edu wrote:
>>
>>> On Tue, 2 Jun 2009, Henrik Bengtsson wrote:
>>>
>>>> Nice case - I think you're onto something. /Henrik
>>>>
>>>> 2009/6/2  <hpages at fhcrc.org>:
>>>>>
>>>>> In fact reg.finalizer() looks like a dangerous feature.
>>>>>
>>>>> If the finalizer itself triggers (implicitely or
>>>>> explicitely) garbage collection, then bad things happen.
>>>>> In the following example, garbage collection is triggered
>>>>> explicitely (using R-2.9.0):
>>>>>
>>>>>   setClass("B", representation(bb="environment"))
>>>>>
>>>>>   newB <- function()
>>>>>   {
>>>>>     ans <- new("B", bb=new.env())
>>>>>     reg.finalizer(ans at bb,
>>>>>                   function(e)
>>>>>                   {
>>>>>                       gc()
>>>>>                       cat("cleaning", class(ans), "object...\n")
>>>>>                   }
>>>>>     )
>>>>>     return(ans)
>>>>>   }
>>>>>
>>>>>   > for (i in 1:500) {cat(i, "\n"); b1 <- newB()}
>>>>>   1
>>>>>   2
>>>>>   3
>>>>>   4
>>>>>   5
>>>>>   6
>>>>>   ...
>>>>>   13
>>>>>   cleaning B object...
>>>>>   cleaning B object...
>>>>>   cleaning B object...
>>>>>   cleaning B object...
>>>>>   cleaning B object...
>>>>>   cleaning B object...
>>>>>   cleaning B object...
>>>>>   cleaning B object...
>>>>>   cleaning B object...
>>>>>   cleaning B object...
>>>>>   cleaning B object...
>>>>>   14
>>>>>   ...
>>>>>   169
>>>>>   170
>>>>>   171
>>>>>   Error: not a weak reference
>>>>>   Error: not a weak reference
>>>>>   [repeat the above line thousands of times]
>>>>>   ...
>>>>>   Error: not a weak reference
>>>>>   Error: not a weak reference
>>>>>   cleaning B object...
>>>>>   Error: SET_VECTOR_ELT() can only be applied to a 'list', not a
>>>>> 'integer'
>>>>>   Error: SET_VECTOR_ELT() can only be applied to a 'list', not a
>>>>> 'integer'
>>>>>   [repeat the above line thousands of times]
>>>>>   ...
>>>>>   Error: SET_VECTOR_ELT() can only be applied to a 'list', not a
>>>>> 'integer'
>>>>>   Error: SET_VECTOR_ELT() can only be applied to a 'list', not a
>>>>> 'integer'
>>>>>   172
>>>>>   ...
>>>>>   246
>>>>>   247
>>>>>   cleaning B object...
>>>>>   cleaning B object...
>>>>>   cleaning B object...
>>>>>   cleaning B object...
>>>>>   cleaning B object...
>>>>>   cleaning B object...
>>>>>   cleaning B object...
>>>>>   cleaning B object...
>>>>>   cleaning B object...
>>>>>   cleaning B object...
>>>>>   cleaning B object...
>>>>>   cleaning B object...
>>>>>   cleaning B object...
>>>>>   cleaning B object...
>>>>>   cleaning B object...
>>>>>   cleaning B object...
>>>>>   cleaning B object...
>>>>>   cleaning B object...
>>>>>   cleaning B object...
>>>>>
>>>>>    *** caught segfault ***
>>>>>   address 0x41, cause 'memory not mapped'
>>>>>
>>>>>   Traceback:
>>>>>    1: gc()
>>>>>    2: function (e) {    gc()    cat("cleaning", class(ans),
>>>>> "object...\n")}(<environment>)
>>>>>
>>>>>   Possible actions:
>>>>>   1: abort (with core dump, if enabled)
>>>>>   2: normal R exit
>>>>>   3: exit R without saving workspace
>>>>>   4: exit R saving workspace
>>>>>   Selection: 2
>>>>>   Save workspace image? [y/n/c]: n
>>>>>   Segmentation fault
>>>>>
>>>>> So apparently, if the finalizer triggers garbage collection,
>>>>> then we can end up with a corrupted session. Then anything can
>>>>> happen, from the strange 'formal argument "envir" matched by
>>>>> multiple actual arguments' error I reported in the previous post,
>>>>> to a segfault. In the worse case, nothing apparently happens but
>>>>> the output produced by the code is wrong.
>>>>>
>>>>> Maybe garbage collection requests should be ignored during the
>>>>> execution of the finalizer? (and more generally during garbbage
>>>>> collection itself)
>>>
>>> Thanks for the report.  The gc proper does not (or should not) do
>>> anything that could cause allocation or trigger another gc.  The gc
>>> proper only identifies objects ready for finalization; running the
>>> finalizers happens outside the gc proper where allocation and gc  
>>> calls
>>> should be safe.  This looks like either a missing PROTECT call in  
>>> the
>>> code for running finalizers or possibly a more subltle bug in  
>>> managing
>>> the lists of objects in different states of finalization. I will  
>>> look
>>> more carefully when I get a chance.
>>
>> This is now fixed in R-devel and the R-patched (it was essentially a
>> missing PROTECT call).
>>
>> luke
>>
>>>
>>> luke
>>>
>>>
>>>>>
>>>>> Cheers,
>>>>> H.
>>>>>
>>>>> ______________________________________________
>>>>> R-devel at r-project.org mailing list
>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>>
>>>>
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>
>>>
>>>
>>
>> --
>> Luke Tierney
>> Chair, Statistics and Actuarial Science
>> Ralph E. Wareham Professor of Mathematical Sciences
>> University of Iowa                  Phone:             319-335-3386
>> Department of Statistics and        Fax:               319-335-3017
>>   Actuarial Science
>> 241 Schaeffer Hall                  email:      luke at stat.uiowa.edu
>> Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From atp at piskorski.com  Fri Jun 12 23:31:48 2009
From: atp at piskorski.com (Andrew Piskorski)
Date: Fri, 12 Jun 2009 17:31:48 -0400
Subject: [Rd] Rprof loses all system() time
Message-ID: <20090612213148.GA97896@piskorski.com>

Rprof seems to ignore all time spent inside system() calls.  E.g.,
this simple example actually takes about 10 seconds, but Rprof thinks
the total time is only 0.12 seconds:

> Rprof("sleep-system.out") ; system.time(system(command="sleep 10")) ; Rprof(NULL)
   user  system elapsed
  0.000   0.004  10.015
> summaryRprof("sleep-system.out")$by.total
              total.time total.pct self.time self.pct
"gc"                0.12       100      0.12      100
"system.time"       0.12       100      0.00        0
>

I assume that what's going on here, is that anytime R blocks waiting
for data from a child process, the profiler stops running entirley,
and it then loses track of all that time spend blocking.

This Rprof behavior is frustrating, because I use a database access
layer which essentially works by having R call system() to run a shell
script.  So, if I write a really slow query that takes 10 minutes to
run, as for as Rprof is concerned, those 10 minutes never happened,
the query consumed zero time.  In complicated code, this makes it much
harder to figure out what parts are slow due to slow R code vs. slow
SQL queries.

Why does Rprof behave this way?  Is there something I can do to
work-around or alleviate this?  What do you think it would take to fix
Rprof to track the time spent waiting for system() to finish, and
where in the R source should I look to attempt that?

Thanks!

-- 
Andrew Piskorski <atp at piskorski.com>
http://www.piskorski.com/


From ggrothendieck at gmail.com  Fri Jun 12 23:41:28 2009
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Fri, 12 Jun 2009 17:41:28 -0400
Subject: [Rd] Rprof loses all system() time
In-Reply-To: <20090612213148.GA97896@piskorski.com>
References: <20090612213148.GA97896@piskorski.com>
Message-ID: <971536df0906121441j5a2ce5ddm334f6cdebe72378@mail.gmail.com>

You could run proc.time() before and after each system call.

x <- proc.time()
# do something
y <- proc.time()
y - x


On Fri, Jun 12, 2009 at 5:31 PM, Andrew Piskorski<atp at piskorski.com> wrote:
> Rprof seems to ignore all time spent inside system() calls. ?E.g.,
> this simple example actually takes about 10 seconds, but Rprof thinks
> the total time is only 0.12 seconds:
>
>> Rprof("sleep-system.out") ; system.time(system(command="sleep 10")) ; Rprof(NULL)
> ? user ?system elapsed
> ?0.000 ? 0.004 ?10.015
>> summaryRprof("sleep-system.out")$by.total
> ? ? ? ? ? ? ?total.time total.pct self.time self.pct
> "gc" ? ? ? ? ? ? ? ?0.12 ? ? ? 100 ? ? ?0.12 ? ? ?100
> "system.time" ? ? ? 0.12 ? ? ? 100 ? ? ?0.00 ? ? ? ?0
>>
>
> I assume that what's going on here, is that anytime R blocks waiting
> for data from a child process, the profiler stops running entirley,
> and it then loses track of all that time spend blocking.
>
> This Rprof behavior is frustrating, because I use a database access
> layer which essentially works by having R call system() to run a shell
> script. ?So, if I write a really slow query that takes 10 minutes to
> run, as for as Rprof is concerned, those 10 minutes never happened,
> the query consumed zero time. ?In complicated code, this makes it much
> harder to figure out what parts are slow due to slow R code vs. slow
> SQL queries.
>
> Why does Rprof behave this way? ?Is there something I can do to
> work-around or alleviate this? ?What do you think it would take to fix
> Rprof to track the time spent waiting for system() to finish, and
> where in the R source should I look to attempt that?
>
> Thanks!
>
> --
> Andrew Piskorski <atp at piskorski.com>
> http://www.piskorski.com/
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From kynnjo at gmail.com  Sat Jun 13 00:34:10 2009
From: kynnjo at gmail.com (Kynn Jones)
Date: Fri, 12 Jun 2009 18:34:10 -0400
Subject: [Rd] Issues converting from JSON to R
Message-ID: <c2350ba40906121534w20944afcq5879dcb520f8ad41@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090612/a5ccd2aa/attachment.pl>

From simon.urbanek at r-project.org  Sat Jun 13 01:05:45 2009
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Fri, 12 Jun 2009 19:05:45 -0400
Subject: [Rd] Issues converting from JSON to R
In-Reply-To: <c2350ba40906121534w20944afcq5879dcb520f8ad41@mail.gmail.com>
References: <c2350ba40906121534w20944afcq5879dcb520f8ad41@mail.gmail.com>
Message-ID: <D5D5E388-F92A-47EF-B991-BE9E02E1722F@r-project.org>


On Jun 12, 2009, at 6:34 PM, Kynn Jones wrote:

> When converting from JSON to R it seems logical that a JSON array  
> would
> correspond to an "unnamed" R list, while a JSON object would  
> correspond to a
> "named" R list.  E.g.
> JSON: [1, 3.1415927, "foo", false, null]   => R: list(1, 3.1415927,  
> "foo",
> FALSE, NA);
>

note that NULL and NA are entirely different concepts - I don't think  
mapping NULL to NA is a good idea ... why don't you just use NULL?


> and
>
> JSON { "int": 1, "float": 3.1415927, "string": "foo", "logical":  
> false,
> "null": null }  => R: list(int=1, float=3.1415927, string="foo",
> logical=FALSE, null=NA)
>
> But I see at least a couple of problems with this scheme.  First,  
> how would
> one distinguish between the R versions of an empty JSON array (i.e.  
> [ ]),
> and an empty JSON object (i.e. { })?
>

Just add an attribute in that special case for one or the other. Or  
even better in general you can make JSON dictionaries (or arrays as  
well) a specific class (each) -- that would also help with future  
dispatch when processing such objects. Also note that specific arrays  
(scalar ones) are actually better mapped to vectors ...


> Second, JSON allows the empty key in an object (e.g., this is a  
> valid JSON
> object: { "": 123 }), but as far as I can tell, R does not allow the  
> empty
> string as a name in a named list:
>

That's not true, try
l=list(123)
names(l)=""

>> list(""=123)
> Error: attempt to use zero-length variable name
>

That has nothing to do with lists per se - the problem is the empty  
argument name in the call to the function `list`. However, you'll be  
creating the list programmatically so you won't run into that.

Cheers,
Simon


>
>
> Any suggestions for dealing with these edge cases would be much  
> appreciated!
>
> TIA!
>
> kynn
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From wdunlap at tibco.com  Sat Jun 13 01:15:50 2009
From: wdunlap at tibco.com (William Dunlap)
Date: Fri, 12 Jun 2009 16:15:50 -0700
Subject: [Rd] .doTrace problem with eval.parent(substitute(expr)) vs. lazy
	evaluation of expr
Message-ID: <77EB52C6DD32BA4D87471DCD70C8D7000152F7D4@NA-PA-VBE03.na.tibco.com>

Here are a couple of problems with the use of
eval.parent(substitute(expr))
instead of just lazily evaluating expr in the .doTrace function used by
trace.

(a) In S+ I sometimes use trace() to see how long a function takes
to run with a tracer expression the saves the start time and calls
on.exit to report the difference between the start and end times
when the trace function ends.  E.g.,

> trace(unix, Quote({START<-proc.time();on.exit(cat(command, "took",
proc.time()-START, "\n"))}))
> unix("sleep 4") # like R's system()
On entry: sleep 4 took 0 0 4.02000000000001 0 0.01
character(0)

This trick fails in R (2.10.0 svn 48672):

   > trace(system, Quote({START<-proc.time();on.exit(cat(command,
"took", proc.time()-START, "\n"))}))
   Tracing function "system" in package "base"
   [1] "system"
   > system("sleep 4")
   Tracing system("sleep 4") on entry
   sleep 4 took 0 0 0 0 0   
   [4 second pause before the next prompt]

If I change .doTrace by changing its
        exprObj <- substitute(expr)
        eval.parent(exprObj)
to just
        expr # evaluate in caller's environment by lazy evaluation
then the on.exit works as I wished it to.  I think the on.exit clause
is being executed at the end of eval.parent() instead of at the end of
the caller of .doTrace (put print(sys.calls()) into the on.exit to see
the evidence).

(b) Another thing I'm used to doing with trace() in S+ is to selectively
expand some of the arguments of the traced function (so I can see
its value instead of just its name), as in
   > trace(match,
Quote({CALL<-match.call();CALL$x<-paste(class(x),"(",length(x),")",sep="
");print(CALL)}))
   > for(x in list(factor(letters), 1:2, "c"))match(x,c("c","d","e")) 
   On entry: match(x = "character(26)", table = exclude)
   On entry: match(x = "character(26)", table = levels)
   On entry: match(x = "factor(26)", table = c("c", "d", "e"))
   On entry: match(x = "character(26)", table = table, nomatch =
nomatch, incomparables =
           incomparables)
   On entry: match(x = "integer(2)", table = c("c", "d", "e"))
   On entry: match(x = "character(1)", table = c("c", "d", "e"))
This fails in R
   > for(x in list(factor(letters), 1:2, "c"))match(x,c("c","d","e"))
   Tracing match(x, table, nomatch = 0L) on entry 
   Error in match.call() :
     unable to find a closure from within which 'match.call' was called
until I make that change to .doTrace
   > for(x in list(factor(letters), 1:2, "c"))match(x,c("c","d","e"))
   Tracing match(x, table, nomatch = 0L) on entry
   match(x = "character(1)", table = table, nomatch = 0L)
   Tracing match(levels, exclude) on entry
   match(x = "character(26)", table = exclude)
   Tracing match(x, levels) on entry
   match(x = "character(26)", table = levels)
   Tracing match(x, c("c", "d", "e")) on entry
   match(x = "factor(26)", table = c("c", "d", "e"))
   Tracing match(x, c("c", "d", "e")) on entry
   match(x = "integer(2)", table = c("c", "d", "e"))
   Tracing match(x, c("c", "d", "e")) on entry
   match(x = "character(1)", table = c("c", "d", "e"))

Would there be any harm in making this change to .doTrace?

I can avoid the on.exit problem by using both the tracer and exit
arguments to
trace:
   > trace(system, Quote(START<-proc.time()), exit=Quote(cat(command,
"took", proc.time()-START, "\n")))
   Tracing function "system" in package "base"
   [1] "system"
   > system("sleep 4")
   Tracing system("sleep 4") on entry
   Tracing system("sleep 4") on exit
   sleep 4 took 0.001 0.002 4.018 0.002 0.002
but I do miss the ability of the tracer to use match.call().

Are there other properties lost by using eval.parent(substitute(expr))
instead lazily evaluating expr?  Should eval.parent(substitute(expr))
try to mimic more closely the lazy evaluation of expr?

The patch I used for testing was
Index: src/library/base/R/methodsSupport.R
===================================================================
--- src/library/base/R/methodsSupport.R (revision 48762)
+++ src/library/base/R/methodsSupport.R (working copy)
@@ -87,8 +87,7 @@
               call <- paste(call[[1L]], "....")
             cat("Tracing", call, msg, "\n")
         }
-        exprObj <- substitute(expr)
-        eval.parent(exprObj)
+        expr # lazily evaluate expr
     }
     NULL
 }


Bill Dunlap
TIBCO Software Inc - Spotfire Division
wdunlap tibco.com 


From hpages at fhcrc.org  Sat Jun 13 03:06:57 2009
From: hpages at fhcrc.org (=?ISO-8859-1?Q?Herv=E9_Pag=E8s?=)
Date: Fri, 12 Jun 2009 18:06:57 -0700
Subject: [Rd] formal argument "envir" matched by multiple actual
	arguments
In-Reply-To: <alpine.LFD.2.00.0906121100350.7161@nokomis.stat.uiowa.edu>
References: <4A24839C.50403@fhcrc.org>
	<20090602010540.k6d93dfdycc884wg@webmail.fhcrc.org>
	<59d7961d0906020125w5b399755j594a018ca608318c@mail.gmail.com>
	<alpine.LFD.2.00.0906021031000.7161@nokomis.stat.uiowa.edu>
	<alpine.LFD.2.00.0906121100350.7161@nokomis.stat.uiowa.edu>
Message-ID: <4A32FBB1.8090902@fhcrc.org>

That's great news Luke! Thanks for finding and fixing that one!
I will do some testing and update the BioC build system with
the latest R.

H.


luke at stat.uiowa.edu wrote:
> On Tue, 2 Jun 2009, luke at stat.uiowa.edu wrote:
> 
>> On Tue, 2 Jun 2009, Henrik Bengtsson wrote:
>>
>>> Nice case - I think you're onto something. /Henrik
>>>
>>> 2009/6/2  <hpages at fhcrc.org>:
>>>> In fact reg.finalizer() looks like a dangerous feature.
>>>>
>>>> If the finalizer itself triggers (implicitely or
>>>> explicitely) garbage collection, then bad things happen.
>>>> In the following example, garbage collection is triggered
>>>> explicitely (using R-2.9.0):
>>>>
>>>>   setClass("B", representation(bb="environment"))
>>>>
>>>>   newB <- function()
>>>>   {
>>>>     ans <- new("B", bb=new.env())
>>>>     reg.finalizer(ans at bb,
>>>>                   function(e)
>>>>                   {
>>>>                       gc()
>>>>                       cat("cleaning", class(ans), "object...\n")
>>>>                   }
>>>>     )
>>>>     return(ans)
>>>>   }
>>>>
>>>>   > for (i in 1:500) {cat(i, "\n"); b1 <- newB()}
>>>>   1
>>>>   2
>>>>   3
>>>>   4
>>>>   5
>>>>   6
>>>>   ...
>>>>   13
>>>>   cleaning B object...
>>>>   cleaning B object...
>>>>   cleaning B object...
>>>>   cleaning B object...
>>>>   cleaning B object...
>>>>   cleaning B object...
>>>>   cleaning B object...
>>>>   cleaning B object...
>>>>   cleaning B object...
>>>>   cleaning B object...
>>>>   cleaning B object...
>>>>   14
>>>>   ...
>>>>   169
>>>>   170
>>>>   171
>>>>   Error: not a weak reference
>>>>   Error: not a weak reference
>>>>   [repeat the above line thousands of times]
>>>>   ...
>>>>   Error: not a weak reference
>>>>   Error: not a weak reference
>>>>   cleaning B object...
>>>>   Error: SET_VECTOR_ELT() can only be applied to a 'list', not a 
>>>> 'integer'
>>>>   Error: SET_VECTOR_ELT() can only be applied to a 'list', not a 
>>>> 'integer'
>>>>   [repeat the above line thousands of times]
>>>>   ...
>>>>   Error: SET_VECTOR_ELT() can only be applied to a 'list', not a 
>>>> 'integer'
>>>>   Error: SET_VECTOR_ELT() can only be applied to a 'list', not a 
>>>> 'integer'
>>>>   172
>>>>   ...
>>>>   246
>>>>   247
>>>>   cleaning B object...
>>>>   cleaning B object...
>>>>   cleaning B object...
>>>>   cleaning B object...
>>>>   cleaning B object...
>>>>   cleaning B object...
>>>>   cleaning B object...
>>>>   cleaning B object...
>>>>   cleaning B object...
>>>>   cleaning B object...
>>>>   cleaning B object...
>>>>   cleaning B object...
>>>>   cleaning B object...
>>>>   cleaning B object...
>>>>   cleaning B object...
>>>>   cleaning B object...
>>>>   cleaning B object...
>>>>   cleaning B object...
>>>>   cleaning B object...
>>>>
>>>>    *** caught segfault ***
>>>>   address 0x41, cause 'memory not mapped'
>>>>
>>>>   Traceback:
>>>>    1: gc()
>>>>    2: function (e) {    gc()    cat("cleaning", class(ans),
>>>> "object...\n")}(<environment>)
>>>>
>>>>   Possible actions:
>>>>   1: abort (with core dump, if enabled)
>>>>   2: normal R exit
>>>>   3: exit R without saving workspace
>>>>   4: exit R saving workspace
>>>>   Selection: 2
>>>>   Save workspace image? [y/n/c]: n
>>>>   Segmentation fault
>>>>
>>>> So apparently, if the finalizer triggers garbage collection,
>>>> then we can end up with a corrupted session. Then anything can
>>>> happen, from the strange 'formal argument "envir" matched by
>>>> multiple actual arguments' error I reported in the previous post,
>>>> to a segfault. In the worse case, nothing apparently happens but
>>>> the output produced by the code is wrong.
>>>>
>>>> Maybe garbage collection requests should be ignored during the
>>>> execution of the finalizer? (and more generally during garbbage
>>>> collection itself)
>>
>> Thanks for the report.  The gc proper does not (or should not) do
>> anything that could cause allocation or trigger another gc.  The gc
>> proper only identifies objects ready for finalization; running the
>> finalizers happens outside the gc proper where allocation and gc calls
>> should be safe.  This looks like either a missing PROTECT call in the
>> code for running finalizers or possibly a more subltle bug in managing
>> the lists of objects in different states of finalization. I will look
>> more carefully when I get a chance.
> 
> This is now fixed in R-devel and the R-patched (it was essentially a
> missing PROTECT call).
> 
> luke
> 
>>
>> luke
>>
>>
>>>>
>>>> Cheers,
>>>> H.
>>>>
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>
>>
> 

-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M2-B876
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fhcrc.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From cgenolin at u-paris10.fr  Sat Jun 13 13:03:21 2009
From: cgenolin at u-paris10.fr (Christophe Genolini)
Date: Sat, 13 Jun 2009 13:03:21 +0200
Subject: [Rd] "median" accepting ordered factor
Message-ID: <4A338779.4020506@u-paris10.fr>

Hi the list,
The function median start by exclude the factor. Indeed, it not possible 
to calculate the median for a factor, but it is possible to evaluate the 
median for an ordered factor.
Would it be possible to change the median function to accept also 
ordered factor? This would be helpful specially in social science...
Christophe


median <- function(x, na.rm=FALSE) UseMethod("median")

median.default <- function(x, na.rm = FALSE)
{
    if(is.factor(x) & !is.ordered(x)) stop("need numeric or ordered data")
    ## all other objects only need sort() & sum() to be working
    if(length(names(x))) names(x) <- NULL # for e.g., c(x = NA_real_)
    if(na.rm) x <- x[!is.na(x)] else if(any(is.na(x))) return(x[FALSE][NA])
    n <- length(x)
    if (n == 0L) return(x[FALSE][NA])
    half <- (n + 1L) %/% 2L
    if(n %% 2L == 1L | is.ordered(x)) sort(x, partial = half)[half]
    else sum(sort(x, partial = half + 0L:1L)[half + 0L:1L])/2
}

a1 <- factor(letters[c(1,2,3,2,3,1,3,5,4,3,4,1,1,1,1,1)],ordered=TRUE)
a2 <- factor(letters[c(1,2,3,2,3,1,3,5,4,3,4,1,1,1,1,1,1)],ordered=TRUE)
median(a1)
median(a2)


From nabble.30.miller_2555 at spamgourmet.com  Sat Jun 13 00:08:40 2009
From: nabble.30.miller_2555 at spamgourmet.com (miller_2555)
Date: Fri, 12 Jun 2009 15:08:40 -0700 (PDT)
Subject: [Rd]  Masked user input
Message-ID: <24005544.post@talk.nabble.com>


Hi - 

   I'm creating a package of database tools. A function in the package
requires the username and password as input to the function in order to
initially connect to the target database(s). Of course, this poses a
significant security issue given the possible retention of the function
statement in cleartext. I did not readily encounter a package meant to mask
input from the user nor do I know of any method to prevent sensitive
information from appearing on-screen or from logging in the command history
of a running R session. While using the --vanilla option when starting R
helps with permanent logging of sensitive information, it is not always
preferable to run R with special flags.  Is any solution available to
prevent the logging/ display of user input. Obviously, hard-coding the
sensitive information is not an option. 

Note: I currently use the following (summarized) convention:

myloginfunction <- function(uname = readline("Enter username") , passwd =
readline("Enter password")) { print(c(uname,passwd)); };

However, the readline function prints the response on-screen. 



Thanks!

-- 
View this message in context: http://www.nabble.com/Masked-user-input-tp24005544p24005544.html
Sent from the R devel mailing list archive at Nabble.com.


From murdoch at stats.uwo.ca  Sat Jun 13 15:57:35 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Sat, 13 Jun 2009 09:57:35 -0400
Subject: [Rd] Masked user input
In-Reply-To: <24005544.post@talk.nabble.com>
References: <24005544.post@talk.nabble.com>
Message-ID: <4A33B04F.5010704@stats.uwo.ca>

On 12/06/2009 6:08 PM, miller_2555 wrote:
> Hi - 
> 
>    I'm creating a package of database tools. A function in the package
> requires the username and password as input to the function in order to
> initially connect to the target database(s). Of course, this poses a
> significant security issue given the possible retention of the function
> statement in cleartext. I did not readily encounter a package meant to mask
> input from the user nor do I know of any method to prevent sensitive
> information from appearing on-screen or from logging in the command history
> of a running R session. While using the --vanilla option when starting R
> helps with permanent logging of sensitive information, it is not always
> preferable to run R with special flags.  Is any solution available to
> prevent the logging/ display of user input. Obviously, hard-coding the
> sensitive information is not an option. 
> 
> Note: I currently use the following (summarized) convention:
> 
> myloginfunction <- function(uname = readline("Enter username") , passwd =
> readline("Enter password")) { print(c(uname,passwd)); };
> 
> However, the readline function prints the response on-screen. 

I think you want to use a GUI toolkit for this.  For example, with tcltk 
(which is available on all platforms):

library(tcltk)
tt<-tktoplevel()
Password <- tclVar("")
entry.Password <-tkentry(tt,width="20",textvariable=Password,show="*")
tkgrid(tklabel(tt,text="Please enter your password."))
tkgrid(entry.Password)
OnOK <- function()
{
     tkdestroy(tt)	
     Password <<- tclvalue(Password)
     cat("The password was ", Password, "\n")
}
OK.but <-tkbutton(tt,text="   OK   ",command=OnOK)
tkbind(entry.Password, "<Return>",OnOK)
tkgrid(OK.but)
tkfocus(tt)

(This is modified from an example on James Wettenhall's page 
http://bioinf.wehi.edu.au/~wettenhall/RTclTkExamples/).

Duncan Murdoch


From murdoch at stats.uwo.ca  Sat Jun 13 22:26:27 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Sat, 13 Jun 2009 16:26:27 -0400
Subject: [Rd] Anyone using Interwrite PRS clickers?
Message-ID: <4A340B73.4040903@stats.uwo.ca>

I've agreed to use the Interwrite PRS "clicker" (an RF input device that 
allows each student in a class to respond to questions) in a class next 
year.  The version of the PRS software we're using stores its files in 
an undocumented (AFAIK) but fairly obvious format, a mixture of XML and 
CSV files.  Is anyone else interested in working with this data from 
within R?   I'd like to use it to have R drive the process; I don't 
think that's possible, but R should at least be able to read the results.

Duncan Murdoch


From kynnjo at gmail.com  Sat Jun 13 22:39:31 2009
From: kynnjo at gmail.com (Kynn Jones)
Date: Sat, 13 Jun 2009 16:39:31 -0400
Subject: [Rd] conditional dependencies & loading
Message-ID: <c2350ba40906131339g69cd80d9k8619c5dc83734242@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090613/35bcd2a5/attachment.pl>

From murdoch at stats.uwo.ca  Sat Jun 13 22:50:59 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Sat, 13 Jun 2009 16:50:59 -0400
Subject: [Rd] conditional dependencies & loading
In-Reply-To: <c2350ba40906131339g69cd80d9k8619c5dc83734242@mail.gmail.com>
References: <c2350ba40906131339g69cd80d9k8619c5dc83734242@mail.gmail.com>
Message-ID: <4A341133.4090402@stats.uwo.ca>

Kynn Jones wrote:
> Hi!
>
> I'm working on a package that must convert data to and from JSON.  For this,
> it can use either the rjson package, or preferably, the faster RJSONIO
> package.
>
> I have two related questions about this.
>
> First, how can I specify that the package depends on *either* RJSONIO *or*
> rjson?  (I.e. both are not required.)
>   

I don't think you can do that.  You can say it suggests both, but it 
will not automatically fail to install if they are not found.  You need 
to put a check into your .onLoad function to fail with an error if 
neither is found.
> Second, what's the best-practice R idiom for such conditional loading?  I.e.
> I'm looking for R's equivalent of Python's
>
>   
>>>> try:
>>>>         
> ...     import json
> ... except ImportError:
> ...     import simplejson as json
>
>   

You would use something like

if (!require(RJSONIO) && !require(rjson)) stop("Need one of RJSONIO or 
rjson")

in your .onLoad function.

Duncan Murdoch
> Thanks!
>
> kynn
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From azevedofilho at usp.br  Sat Jun 13 22:20:11 2009
From: azevedofilho at usp.br (azevedofilho at usp.br)
Date: Sat, 13 Jun 2009 22:20:11 +0200 (CEST)
Subject: [Rd] Portuguese translation problem (PR#13756)
Message-ID: <20090613202011.E5FCA2830315@mail.pubhealth.ku.dk>

Full_Name: Adriano Azevedo Filho
Version: 2.9.0
OS: Windows Vista
Submission from: (NULL) (201.68.79.62)


The error message produced when the function name typed in the console is
misspelled in the Portuguese translation. This is not a new issue but as it is
around for sometime I've decided to report. As this is a frequent message when
beginners start using R, it gives an unfortunate bad impression on the overall
quality of the software which is excellent.

The actual message (with the translation error) is:

Erro: n?o foi posss?vel encontrar a fun??o "functionname"

The correct message should be:

Erro: n?o foi poss?vel encontrar a fun??o "functionname"


From ripley at stats.ox.ac.uk  Sun Jun 14 09:16:18 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sun, 14 Jun 2009 08:16:18 +0100 (BST)
Subject: [Rd] Portuguese translation problem (PR#13756)
In-Reply-To: <20090613202011.E5FCA2830315@mail.pubhealth.ku.dk>
References: <20090613202011.E5FCA2830315@mail.pubhealth.ku.dk>
Message-ID: <alpine.LFD.2.00.0906140757360.15063@gannet.stats.ox.ac.uk>

You were asked to report problems with translation to the appropriate 
translation team: see the section 'How to report a bug' of the FAQ.

For Brazilian Portuguese the translator listed is 
Fernando Henrique Ferraz P. da Rosa <feferraz at ime.usp.br>, not it 
seems far from you.  The Brazilian Portuguese translations are 
drifting out of date, so he may appreciate offers of assistance.

In this case the word is spelled inconsistently in the translations so 
I am confident enough to make the change, but in general the R 
developers have outsourced language expertise to the translation 
teams.

On Sat, 13 Jun 2009, azevedofilho at usp.br wrote:

> Full_Name: Adriano Azevedo Filho
> Version: 2.9.0
> OS: Windows Vista
> Submission from: (NULL) (201.68.79.62)
>
>
> The error message produced when the function name typed in the console is
> misspelled in the Portuguese translation. This is not a new issue but as it is
> around for sometime I've decided to report. As this is a frequent message when
> beginners start using R, it gives an unfortunate bad impression on the overall
> quality of the software which is excellent.
>
> The actual message (with the translation error) is:
>
> Erro: n?o foi posss?vel encontrar a fun??o "functionname"
>
> The correct message should be:
>
> Erro: n?o foi poss?vel encontrar a fun??o "functionname"
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From ggrothendieck at gmail.com  Sun Jun 14 20:56:01 2009
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sun, 14 Jun 2009 14:56:01 -0400
Subject: [Rd] read.csv
Message-ID: <971536df0906141156j78b5570ajf08257c88098d7d8@mail.gmail.com>

If read.csv's colClasses= argument is NOT used then read.csv accepts
double quoted numerics:

1: > read.csv(stdin())
0: A,B
1: "1",1
2: "2",2
3:
  A B
1 1 1
2 2 2

However, if colClasses is used then it seems that it does not:

> read.csv(stdin(), colClasses = "numeric")
0: A,B
1: "1",1
2: "2",2
3:
Error in scan(file, what, nmax, sep, dec, quote, skip, nlines, na.strings,  :
  scan() expected 'a real', got '"1"'

Is this really intended?  I would have expected that a csv file in which
each field is surrounded with double quotes is acceptable in both
cases.   This may be documented as is yet seems undesirable from
both a consistency viewpoint and the viewpoint that it should be
possible to double quote fields in a csv file.


From Ted.Harding at manchester.ac.uk  Sun Jun 14 22:21:24 2009
From: Ted.Harding at manchester.ac.uk ( (Ted Harding))
Date: Sun, 14 Jun 2009 21:21:24 +0100 (BST)
Subject: [Rd] read.csv
In-Reply-To: <971536df0906141156j78b5570ajf08257c88098d7d8@mail.gmail.com>
Message-ID: <XFMail.090614212124.Ted.Harding@manchester.ac.uk>

On 14-Jun-09 18:56:01, Gabor Grothendieck wrote:
> If read.csv's colClasses= argument is NOT used then read.csv accepts
> double quoted numerics:
> 
> 1: > read.csv(stdin())
> 0: A,B
> 1: "1",1
> 2: "2",2
> 3:
>   A B
> 1 1 1
> 2 2 2
> 
> However, if colClasses is used then it seems that it does not:
> 
>> read.csv(stdin(), colClasses = "numeric")
> 0: A,B
> 1: "1",1
> 2: "2",2
> 3:
> Error in scan(file, what, nmax, sep, dec, quote, skip, nlines,
> na.strings,  :
>   scan() expected 'a real', got '"1"'
> 
> Is this really intended?  I would have expected that a csv file
> in which each field is surrounded with double quotes is acceptable
> in both cases. This may be documented as is yet seems undesirable
> from both a consistency viewpoint and the viewpoint that it should
> be possible to double quote fields in a csv file.

Well, the default for colClasses is NA, for which ?read.csv says:
  [...]
  Possible values are 'NA' (when 'type.convert' is used),
  [...]
and then ?type.convert says:
  This is principally a helper function for 'read.table'. Given a
  character vector, it attempts to convert it to logical, integer,
  numeric or complex, and failing that converts it to factor unless
  'as.is = TRUE'.  The first type that can accept all the non-missing
  values is chosen.

It would seem that type 'logical' won't accept integer (naively one
might expect 1 --> TRUE, but see experiment below), so the first
acceptable type for "1" is integer, and that is what happens.
So it is indeed documented (in the R[ecursive] sense of "documented" :))

However, presumably when colClasses is used then type.convert() is
not called, in which case R sees itself being asked to assign a
character entity to a destination which it has been told shall be
integer, and therefore, since the default for as.is is
  as.is = !stringsAsFactors
but for this ?read.csv says that stringsAsFactors "is overridden
bu [sic] 'as.is' and 'colClasses', both of which allow finer
control.", so that wouldn't come to the rescue either.

Experiment:
  X <-logical(10)
  class(X)
  # [1] "logical"
  X[1]<-1
  X
  # [1] 1 0 0 0 0 0 0 0 0 0
  class(X)
  # [1] "numeric"
so R has converted X from class 'logical' to class 'numeric'
on being asked to assign a number to a logical; but in this
case its hands were not tied by colClasses.

Or am I missing something?!!

Ted.



--------------------------------------------------------------------
E-Mail: (Ted Harding) <Ted.Harding at manchester.ac.uk>
Fax-to-email: +44 (0)870 094 0861
Date: 14-Jun-09                                       Time: 21:21:22
------------------------------ XFMail ------------------------------


From ggrothendieck at gmail.com  Sun Jun 14 22:37:51 2009
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sun, 14 Jun 2009 16:37:51 -0400
Subject: [Rd] read.csv
In-Reply-To: <XFMail.090614212124.Ted.Harding@manchester.ac.uk>
References: <971536df0906141156j78b5570ajf08257c88098d7d8@mail.gmail.com> 
	<XFMail.090614212124.Ted.Harding@manchester.ac.uk>
Message-ID: <971536df0906141337i148c3893t6a08afe376c5151c@mail.gmail.com>

On Sun, Jun 14, 2009 at 4:21 PM, Ted
Harding<Ted.Harding at manchester.ac.uk> wrote:
> Or am I missing something?!!

The point of this is that the current behavior is not desirable since you can't
have quoted numeric fields if you specify colClasses = "numeric" yet you
can if you don't.  The concepts are not orthogonal but should be.  If you
specify or not specify colClasses the numeric fields ought to be treated
the same way and if the documentation says otherwise it further means
there is a problem with the design.

One could define their own type quotedNumeric as a workaround
(see below) but I think it would be better if specifying "numeric" or
not specifying
numeric had the same effect.  The way it is now the concepts are intertwined
and not orthogonal.

library(methods)
setClass("quotedNumeric")
setAs("character", "quotedNumeric",
  function(from) as.numeric(gsub("\"", "", from)))
Lines <- 'A,B
"1",1
"2",2'
read.csv(textConnection(Lines), colClasses = c("quotedNumeric", "numeric"))


From romain.francois at dbmail.com  Tue Jun 16 09:57:40 2009
From: romain.francois at dbmail.com (Romain Francois)
Date: Tue, 16 Jun 2009 09:57:40 +0200
Subject: [Rd] calling handlers within R_tryEval
Message-ID: <4A375074.2010401@dbmail.com>


Hello,

When using R_tryEval (from JRI in my case), is there a way to setup 
error recovery strategy and more generally calling handlers.
 From my reading of context.c, R_tryEval calls R_ToplevelExec which 
creates a context like this:

    begincontext(&thiscontext, CTXT_TOPLEVEL, R_NilValue, R_GlobalEnv,
         R_BaseEnv, R_NilValue, R_NilValue);

so I guess what I am trying to do is add "cend" and/or "handlerstack" to 
this context. Is this possible ? Are there examples of packages doing this ?

Romain

-- 
Romain Francois
Independent R Consultant
+33(0) 6 28 91 30 30
http://romainfrancois.blog.free.fr


From nabble.30.miller_2555 at spamgourmet.com  Mon Jun 15 18:39:48 2009
From: nabble.30.miller_2555 at spamgourmet.com (miller_2555)
Date: Mon, 15 Jun 2009 09:39:48 -0700 (PDT)
Subject: [Rd] Masked user input - SOLVED
In-Reply-To: <4A33B04F.5010704@stats.uwo.ca>
References: <24005544.post@talk.nabble.com> <4A33B04F.5010704@stats.uwo.ca>
Message-ID: <24038191.post@talk.nabble.com>




> ...
> (This is modified from an example on James Wettenhall's page 
> http://bioinf.wehi.edu.au/~wettenhall/RTclTkExamples/).
> 
> Duncan Murdoch
> 

I had not considered a GUI solution. This works perfectly! Many thanks for
the help. If I come across a CLI solution, I will post here in case others
find it useful (i.e. in case R is running at a low runlevel for *NIX
environments). Thanks again. 
-- 
View this message in context: http://www.nabble.com/Masked-user-input-tp24005544p24038191.html
Sent from the R devel mailing list archive at Nabble.com.


From mokevin at email.unc.edu  Sun Jun 14 20:16:57 2009
From: mokevin at email.unc.edu (kevmac)
Date: Sun, 14 Jun 2009 11:16:57 -0700 (PDT)
Subject: [Rd] R build fails during make when configured with
 "--with-x=no" (PR#13665)
In-Reply-To: <235F553F-2113-48DC-B933-265F255BB84A@r-project.org>
References: <20090420051009.535E6282C76F@mail.pubhealth.ku.dk>
	<49EC555A.60602@biostat.ku.dk>
	<235F553F-2113-48DC-B933-265F255BB84A@r-project.org>
Message-ID: <24024281.post@talk.nabble.com>


I still have that same error.


Simon Urbanek wrote:
> 
> It should be fixed now.
> 
> Cheers,
> Simon
> 
> On Apr 20, 2009, at 6:58 AM, Peter Dalgaard wrote:
> 
>> jeet at ku.edu wrote:
>>
>>>
>>> If R is configured using the "--with=x=no" option, then the make  
>>> fails with the
>>> following error:
>> ,,,,
>>> make[1]: *** [R] Error 1
>>> make[1]: Leaving directory `/home/jeet/Scratch/r-build/on-frontend/ 
>>> R-2.9.0/src'
>>> make: *** [R] Error 1
>>>
>>> The problem appears to be with the "src/modules/Makefile".  
>>> Specfically, lines
>>> 26-29:
>>>
>>> 	@for d in "$(R_MODULES)"; do \
>>> 	  (cd $${d} && $(MAKE) $@) || exit 1; \
>>> 	done
>>>
>>> Here, R_MODULES is blank, resulting in the "cd" command  
>>> transferring to the
>>> user's home directory, where, of course, no Makefile is found  
>>> resulting in the
>>> error above.
>>
>> (Even more "fun" would ensue if in fact there were a Makefile  
>> there...)
>>
>>
>>> Work-around appears to be to simply disable loop if R_MODULES is  
>>> empty.
>>
>> Shell script and Make portability is a pain in the derriere, but
>> offhand, those double quotes just look wrong:
>>
>> viggo:~/>for i in "" ; do echo $i; done
>>
>> viggo:~/>for i in  ; do echo $i; done
>> viggo:~/>for i in "foo bar" ; do echo $i; done
>> foo bar
>> viggo:~/>for i in foo bar ; do echo $i; done
>> foo
>> bar
>>
>> Notice that the versions with quotes invariably do the Wrong Thing....
>>
>>
>> -- 
>>   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
>>  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
>> (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45)  
>> 35327918
>> ~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45)  
>> 35327907
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 

-- 
View this message in context: http://www.nabble.com/R-build-fails-during-make-when-configured-with-%22--with-x%3Dno%22-%28PR-13665%29-tp23133399p24024281.html
Sent from the R devel mailing list archive at Nabble.com.


From whorfin at pixar.com  Mon Jun 15 23:45:09 2009
From: whorfin at pixar.com (whorfin at pixar.com)
Date: Mon, 15 Jun 2009 23:45:09 +0200 (CEST)
Subject: [Rd] Wishlist: as.raw [or similar] support for tcl strings
	(PR#13758)
Message-ID: <20090615214509.41609282EFF0@mail.pubhealth.ku.dk>

Full_Name: Rick Sayre
Version: 2.9.0
OS: windows, os x, linux
Submission from: (NULL) (138.72.153.236)


if a tcl "string" contains binary data, there is a problem getting this data
to R, since there appears to be no way to get "raw" data without NULL
interpretation.  Here is a simple example.  The data should be
Here are 1<one NULL>Here is 2<two NULLs>And finally three<three NULLS>
> tq <- .Tcl("set tcls [binary format H*
\"48657265206172652031004865726520697320320000416E642066696E616C6C79207468726565000000\"]")
#tclvalue stops returning data after the first NULL
> tclvalue("tcls")
[1] "Here are 1"
#interestingly, as.character gets more, but gets confused
> as.character(tq)
[1] "Here"    "are"     "1"       "is"      "2"       "finally" "three"
> # we confirm that the tcl representation does indeed have the NULLs:
> .Tcl("binary scan $tcls H* tmps")
<Tcl> 1
> tclvalue("tmps")
[1] "48657265206172652031004865726520697320320000416e642066696e616c6c79207468726565000000"

I would naively suggest something like tclrawvalue() and/or as.raw() utilizing
Tcl_GetByteArrayFromObj

A good discussion of the basics of this issue for general tcl embedding can be
found here:
http://www2.tcl.tk/1180

For those who might be wondering "what the heck are you doing trying to pass
binary data from tcl?", the answer is that non-blocking I/O does not work on
windows,
and timeouts, modes, and line control for RS232 ports aren't supported at all on
R.
Using tcl provides a nice portable way to do this in R, but currently requires
converting everything to ascii encodings since the binary data fails to make it
across.

Cheers
   --Rick


From simon.urbanek at r-project.org  Tue Jun 16 13:54:48 2009
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Tue, 16 Jun 2009 07:54:48 -0400
Subject: [Rd] R build fails during make when configured with
	"--with-x=no" (PR#13665)
In-Reply-To: <24024281.post@talk.nabble.com>
References: <20090420051009.535E6282C76F@mail.pubhealth.ku.dk>
	<49EC555A.60602@biostat.ku.dk>
	<235F553F-2113-48DC-B933-265F255BB84A@r-project.org>
	<24024281.post@talk.nabble.com>
Message-ID: <7AC3063C-8CC4-417C-BCB3-F0C0D0068028@r-project.org>


On Jun 14, 2009, at 14:16 , kevmac wrote:

>
> I still have that same error.
>

Can you be more specific, please (exact errors, config.log, R  
version ...)? Are you using latest R?

Cheers,
Simon


Do you have the la

>
> Simon Urbanek wrote:
>>
>> It should be fixed now.
>>
>> Cheers,
>> Simon
>>
>> On Apr 20, 2009, at 6:58 AM, Peter Dalgaard wrote:
>>
>>> jeet at ku.edu wrote:
>>>
>>>>
>>>> If R is configured using the "--with=x=no" option, then the make
>>>> fails with the
>>>> following error:
>>> ,,,,
>>>> make[1]: *** [R] Error 1
>>>> make[1]: Leaving directory `/home/jeet/Scratch/r-build/on-frontend/
>>>> R-2.9.0/src'
>>>> make: *** [R] Error 1
>>>>
>>>> The problem appears to be with the "src/modules/Makefile".
>>>> Specfically, lines
>>>> 26-29:
>>>>
>>>> 	@for d in "$(R_MODULES)"; do \
>>>> 	  (cd $${d} && $(MAKE) $@) || exit 1; \
>>>> 	done
>>>>
>>>> Here, R_MODULES is blank, resulting in the "cd" command
>>>> transferring to the
>>>> user's home directory, where, of course, no Makefile is found
>>>> resulting in the
>>>> error above.
>>>
>>> (Even more "fun" would ensue if in fact there were a Makefile
>>> there...)
>>>
>>>
>>>> Work-around appears to be to simply disable loop if R_MODULES is
>>>> empty.
>>>
>>> Shell script and Make portability is a pain in the derriere, but
>>> offhand, those double quotes just look wrong:
>>>
>>> viggo:~/>for i in "" ; do echo $i; done
>>>
>>> viggo:~/>for i in  ; do echo $i; done
>>> viggo:~/>for i in "foo bar" ; do echo $i; done
>>> foo bar
>>> viggo:~/>for i in foo bar ; do echo $i; done
>>> foo
>>> bar
>>>
>>> Notice that the versions with quotes invariably do the Wrong  
>>> Thing....
>>>
>>>
>>> -- 
>>>  O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
>>> c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
>>> (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45)
>>> 35327918
>>> ~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45)
>>> 35327907
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
>
> -- 
> View this message in context: http://www.nabble.com/R-build-fails-during-make-when-configured-with-%22--with-x%3Dno%22-%28PR-13665%29-tp23133399p24024281.html
> Sent from the R devel mailing list archive at Nabble.com.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From markus.jochmann at strath.ac.uk  Tue Jun 16 14:38:03 2009
From: markus.jochmann at strath.ac.uk (Markus Jochmann)
Date: Tue, 16 Jun 2009 05:38:03 -0700 (PDT)
Subject: [Rd]  Dynamic Library linked with Parallel Intel MKL
Message-ID: <24053462.post@talk.nabble.com>


Hi!

I call some external C++ code from R using dyn.load() and .C(). My dynamic
library is linked to the parallel Intel MKL libraries and thus should make
use of my quadcore processor. In fact, it does if I call it from a C++
program but not if I call it from R 2.8.1 packaged by Ubuntu (there it only
uses one core).

Is there some trick? Do I need to link the whole of R with parallel MKL?

Thanks a lot,
Markus.
-- 
View this message in context: http://www.nabble.com/Dynamic-Library-linked-with-Parallel-Intel-MKL-tp24053462p24053462.html
Sent from the R devel mailing list archive at Nabble.com.


From luke at stat.uiowa.edu  Tue Jun 16 19:14:24 2009
From: luke at stat.uiowa.edu (luke at stat.uiowa.edu)
Date: Tue, 16 Jun 2009 12:14:24 -0500 (CDT)
Subject: [Rd] calling handlers within R_tryEval
In-Reply-To: <4A375074.2010401@dbmail.com>
References: <4A375074.2010401@dbmail.com>
Message-ID: <alpine.DEB.1.00.0906161212420.26719@luke-inspiron>

Not at present.  It would be nice to have at least a mechanism for C
level exiting handlers (which is what the cend ones are intended to be)
but it hasn't risen high enough on my to do list yet to get done.

luke

On Tue, 16 Jun 2009, Romain Francois wrote:

>
> Hello,
>
> When using R_tryEval (from JRI in my case), is there a way to setup error 
> recovery strategy and more generally calling handlers.
> From my reading of context.c, R_tryEval calls R_ToplevelExec which creates a 
> context like this:
>
>   begincontext(&thiscontext, CTXT_TOPLEVEL, R_NilValue, R_GlobalEnv,
>        R_BaseEnv, R_NilValue, R_NilValue);
>
> so I guess what I am trying to do is add "cend" and/or "handlerstack" to this 
> context. Is this possible ? Are there examples of packages doing this ?
>
> Romain
>
>

-- 
Luke Tierney
Chair, Statistics and Actuarial Science
Ralph E. Wareham Professor of Mathematical Sciences
University of Iowa                  Phone:             319-335-3386
Department of Statistics and        Fax:               319-335-3017
    Actuarial Science
241 Schaeffer Hall                  email:      luke at stat.uiowa.edu
Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu


From savicky at cs.cas.cz  Tue Jun 16 20:09:01 2009
From: savicky at cs.cas.cz (Petr Savicky)
Date: Tue, 16 Jun 2009 20:09:01 +0200
Subject: [Rd] read.csv
In-Reply-To: <XFMail.090614212124.Ted.Harding@manchester.ac.uk>
References: <971536df0906141156j78b5570ajf08257c88098d7d8@mail.gmail.com>
	<XFMail.090614212124.Ted.Harding@manchester.ac.uk>
Message-ID: <20090616180901.GA18091@cs.cas.cz>

On Sun, Jun 14, 2009 at 09:21:24PM +0100, Ted Harding wrote:
> On 14-Jun-09 18:56:01, Gabor Grothendieck wrote:
> > If read.csv's colClasses= argument is NOT used then read.csv accepts
> > double quoted numerics:
> > 
> > 1: > read.csv(stdin())
> > 0: A,B
> > 1: "1",1
> > 2: "2",2
> > 3:
> >   A B
> > 1 1 1
> > 2 2 2
> > 
> > However, if colClasses is used then it seems that it does not:
> > 
> >> read.csv(stdin(), colClasses = "numeric")
> > 0: A,B
> > 1: "1",1
> > 2: "2",2
> > 3:
> > Error in scan(file, what, nmax, sep, dec, quote, skip, nlines,
> > na.strings,  :
> >   scan() expected 'a real', got '"1"'
> > 
> > Is this really intended?  I would have expected that a csv file
> > in which each field is surrounded with double quotes is acceptable
> > in both cases. This may be documented as is yet seems undesirable
> > from both a consistency viewpoint and the viewpoint that it should
> > be possible to double quote fields in a csv file.
> 
> Well, the default for colClasses is NA, for which ?read.csv says:
>   [...]
>   Possible values are 'NA' (when 'type.convert' is used),
>   [...]
> and then ?type.convert says:
>   This is principally a helper function for 'read.table'. Given a
>   character vector, it attempts to convert it to logical, integer,
>   numeric or complex, and failing that converts it to factor unless
>   'as.is = TRUE'.  The first type that can accept all the non-missing
>   values is chosen.
> 
> It would seem that type 'logical' won't accept integer (naively one
> might expect 1 --> TRUE, but see experiment below), so the first
> acceptable type for "1" is integer, and that is what happens.
> So it is indeed documented (in the R[ecursive] sense of "documented" :))
> 
> However, presumably when colClasses is used then type.convert() is
> not called, in which case R sees itself being asked to assign a
> character entity to a destination which it has been told shall be
> integer, and therefore, since the default for as.is is
>   as.is = !stringsAsFactors
> but for this ?read.csv says that stringsAsFactors "is overridden
> bu [sic] 'as.is' and 'colClasses', both of which allow finer
> control.", so that wouldn't come to the rescue either.
> 
> Experiment:
>   X <-logical(10)
>   class(X)
>   # [1] "logical"
>   X[1]<-1
>   X
>   # [1] 1 0 0 0 0 0 0 0 0 0
>   class(X)
>   # [1] "numeric"
> so R has converted X from class 'logical' to class 'numeric'
> on being asked to assign a number to a logical; but in this
> case its hands were not tied by colClasses.
> 
> Or am I missing something?!!

In my opinion, you explain, how it happens that there is a difference
in the behavior between
  read.csv(stdin(), colClasses = "numeric")
and
  read.csv(stdin())
but not, why it is so.

The algorithm "use the smallest type, which accepts all non-missing values"
may well be applied to the input values either literally or after removing
the quotes. Is there a reason, why
  read.csv(stdin(), colClasses = "numeric")
removes quotes from the input values and
  read.csv(stdin())
does not?

Using double-quote characters is a part of the definition of CSV file, see,
for example
  http://en.wikipedia.org/wiki/Comma_separated_values
where one may find
  Fields may always be enclosed within double-quote characters, whether necessary or not.

Petr.


From romain.francois at dbmail.com  Tue Jun 16 20:16:09 2009
From: romain.francois at dbmail.com (Romain Francois)
Date: Tue, 16 Jun 2009 20:16:09 +0200
Subject: [Rd] calling handlers within R_tryEval
In-Reply-To: <alpine.DEB.1.00.0906161212420.26719@luke-inspiron>
References: <4A375074.2010401@dbmail.com>
	<alpine.DEB.1.00.0906161212420.26719@luke-inspiron>
Message-ID: <4A37E169.1060704@dbmail.com>

Hi,

If there is something I can do to push up this one, let me know.

Romain

luke at stat.uiowa.edu wrote:
>
> Not at present.  It would be nice to have at least a mechanism for C
> level exiting handlers (which is what the cend ones are intended to be)
> but it hasn't risen high enough on my to do list yet to get done.
>
> luke
>
> On Tue, 16 Jun 2009, Romain Francois wrote:
>
>>
>> Hello,
>>
>> When using R_tryEval (from JRI in my case), is there a way to setup 
>> error recovery strategy and more generally calling handlers.
>> From my reading of context.c, R_tryEval calls R_ToplevelExec which 
>> creates a context like this:
>>
>>   begincontext(&thiscontext, CTXT_TOPLEVEL, R_NilValue, R_GlobalEnv,
>>        R_BaseEnv, R_NilValue, R_NilValue);
>>
>> so I guess what I am trying to do is add "cend" and/or "handlerstack" 
>> to this context. Is this possible ? Are there examples of packages 
>> doing this ?
>>
>> Romain
>>


-- 
Romain Francois
Independent R Consultant
+33(0) 6 28 91 30 30
http://romainfrancois.blog.free.fr


From rvaradhan at jhmi.edu  Wed Jun 17 23:45:11 2009
From: rvaradhan at jhmi.edu (rvaradhan at jhmi.edu)
Date: Wed, 17 Jun 2009 23:45:11 +0200 (CEST)
Subject: [Rd] Inverting a square matrix using solve() with LAPACK=TRUE
	(PR#13762)
Message-ID: <20090617214511.71DAD283201D@mail.pubhealth.ku.dk>

Full_Name: Ravi Varadhan
Version: 2.8.1
OS: Windows
Submission from: (NULL) (162.129.251.19)


Inverting a matrix with solve(), but using LAPACK=TRUE, gives erroneous
results:

Here is an example:

     hilbert <- function(n) { i <- 1:n; 1 / outer(i - 1, i, "+") }
	h5 <- hilbert(5)
	hinv1 <- solve(qr(h5))
	hinv2 <- solve(qr(h5, LAPACK=TRUE))	
	all.equal(hinv1, hinv2)  # They are not equal

Here is a function that I wrote to correct this problem:

	solve.lapack <- function(A, LAPACK=TRUE, tol=1.e-07) {
	# A function to invert a matrix using "LAPACK" or "LINPACK"
        if (nrow(A) != ncol(A)) stop("Matrix muxt be square")
        qrA <- qr(A, LAPACK=LAPACK, tol=tol)
        if (LAPACK) {
	apply(diag(1, ncol(A)), 2, function(x) solve(qrA, x)) 
        } else  solve(qrA)
	}

        hinv3 <- solve.lapack(h5)
	all.equal(hinv1, hinv3)  # Now, they are equal


From p.dalgaard at biostat.ku.dk  Thu Jun 18 09:14:02 2009
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Thu, 18 Jun 2009 10:14:02 +0300
Subject: [Rd] Inverting a square matrix using solve() with LAPACK=TRUE
 (PR#13762)
In-Reply-To: <20090617214511.71DAD283201D@mail.pubhealth.ku.dk>
References: <20090617214511.71DAD283201D@mail.pubhealth.ku.dk>
Message-ID: <4A39E93A.3050705@biostat.ku.dk>

rvaradhan at jhmi.edu wrote:
> Full_Name: Ravi Varadhan
> Version: 2.8.1
> OS: Windows
> Submission from: (NULL) (162.129.251.19)
> 
> 
> Inverting a matrix with solve(), but using LAPACK=TRUE, gives erroneous
> results:

Thanks, but there seems to be a much easier fix.

Inside coef.qr, we have

coef[qr$pivot, ] <-
.Call("qr_coef_real", qr, y, PACKAGE = "base")[seq_len(p)]

which should be [seq_len(p),]

(otherwise, in the matrix case, the RHS will recycle only the 1st p 
elements, i.e., the 1st column).

> 
> Here is an example:
> 
>      hilbert <- function(n) { i <- 1:n; 1 / outer(i - 1, i, "+") }
> 	h5 <- hilbert(5)
> 	hinv1 <- solve(qr(h5))
> 	hinv2 <- solve(qr(h5, LAPACK=TRUE))	
> 	all.equal(hinv1, hinv2)  # They are not equal
> 
> Here is a function that I wrote to correct this problem:
> 
> 	solve.lapack <- function(A, LAPACK=TRUE, tol=1.e-07) {
> 	# A function to invert a matrix using "LAPACK" or "LINPACK"
>         if (nrow(A) != ncol(A)) stop("Matrix muxt be square")
>         qrA <- qr(A, LAPACK=LAPACK, tol=tol)
>         if (LAPACK) {
> 	apply(diag(1, ncol(A)), 2, function(x) solve(qrA, x)) 
>         } else  solve(qrA)
> 	}
> 
>         hinv3 <- solve.lapack(h5)
> 	all.equal(hinv1, hinv3)  # Now, they are equal
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


-- 
    O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
   c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
  (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907


From p.dalgaard at biostat.ku.dk  Thu Jun 18 09:20:09 2009
From: p.dalgaard at biostat.ku.dk (p.dalgaard at biostat.ku.dk)
Date: Thu, 18 Jun 2009 09:20:09 +0200 (CEST)
Subject: [Rd] Inverting a square matrix using solve() with LAPACK=TRUE
	(PR#13765)
Message-ID: <20090618072009.4B483283201C@mail.pubhealth.ku.dk>

rvaradhan at jhmi.edu wrote:
> Full_Name: Ravi Varadhan
> Version: 2.8.1
> OS: Windows
> Submission from: (NULL) (162.129.251.19)
> 
> 
> Inverting a matrix with solve(), but using LAPACK=TRUE, gives erroneous
> results:

Thanks, but there seems to be a much easier fix.

Inside coef.qr, we have

coef[qr$pivot, ] <-
.Call("qr_coef_real", qr, y, PACKAGE = "base")[seq_len(p)]

which should be [seq_len(p),]

(otherwise, in the matrix case, the RHS will recycle only the 1st p 
elements, i.e., the 1st column).

> 
> Here is an example:
> 
>      hilbert <- function(n) { i <- 1:n; 1 / outer(i - 1, i, "+") }
> 	h5 <- hilbert(5)
> 	hinv1 <- solve(qr(h5))
> 	hinv2 <- solve(qr(h5, LAPACK=TRUE))	
> 	all.equal(hinv1, hinv2)  # They are not equal
> 
> Here is a function that I wrote to correct this problem:
> 
> 	solve.lapack <- function(A, LAPACK=TRUE, tol=1.e-07) {
> 	# A function to invert a matrix using "LAPACK" or "LINPACK"
>         if (nrow(A) != ncol(A)) stop("Matrix muxt be square")
>         qrA <- qr(A, LAPACK=LAPACK, tol=tol)
>         if (LAPACK) {
> 	apply(diag(1, ncol(A)), 2, function(x) solve(qrA, x)) 
>         } else  solve(qrA)
> 	}
> 
>         hinv3 <- solve.lapack(h5)
> 	all.equal(hinv1, hinv3)  # Now, they are equal
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


-- 
    O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
   c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
  (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907


From P.Dalgaard at biostat.ku.dk  Thu Jun 18 15:15:24 2009
From: P.Dalgaard at biostat.ku.dk (P.Dalgaard at biostat.ku.dk)
Date: Thu, 18 Jun 2009 15:15:24 +0200 (CEST)
Subject: [Rd] Inverting a square... (PR#13765)
Message-ID: <20090618131524.4BC67283201E@mail.pubhealth.ku.dk>

Drats!. Jitterbug is up to its old PR renaming trick again... This
should have been a followup to PR#13762. Will refile.

p.dalgaard at biostat.ku.dk wrote:
> rvaradhan at jhmi.edu wrote:
>> Full_Name: Ravi Varadhan
>> Version: 2.8.1
>> OS: Windows
>> Submission from: (NULL) (162.129.251.19)
>>
>>
>> Inverting a matrix with solve(), but using LAPACK=3DTRUE, gives errone=
ous
>> results:
>=20
> Thanks, but there seems to be a much easier fix.
=2E....


--=20
   O__  ---- Peter Dalgaard             =C3=98ster Farimagsgade 5, Entr.B=

  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907


From P.Dalgaard at biostat.ku.dk  Thu Jun 18 15:20:23 2009
From: P.Dalgaard at biostat.ku.dk (P.Dalgaard at biostat.ku.dk)
Date: Thu, 18 Jun 2009 15:20:23 +0200 (CEST)
Subject: [Rd] Inverting a square... (PR#13762)
Message-ID: <20090618132023.41248282BE84@mail.pubhealth.ku.dk>

Refiling this.  The actual fix was slightly more complicated. Will soon
be committed to R-Patched (aka 2.9.1 beta).

	-p

rvaradhan at jhmi.edu wrote:
> Full_Name: Ravi Varadhan
> Version: 2.8.1
> OS: Windows
> Submission from: (NULL) (162.129.251.19)
>=20
>=20
> Inverting a matrix with solve(), but using LAPACK=3DTRUE, gives erroneo=
us
> results:

Thanks, but there seems to be a much easier fix.

Inside coef.qr, we have

coef[qr$pivot, ] <-
=2ECall("qr_coef_real", qr, y, PACKAGE =3D "base")[seq_len(p)]

which should be [seq_len(p),]

(otherwise, in the matrix case, the RHS will recycle only the 1st p
elements, i.e., the 1st column).

>=20
> Here is an example:
>=20
>      hilbert <- function(n) { i <- 1:n; 1 / outer(i - 1, i, "+") }
> 	h5 <- hilbert(5)
> 	hinv1 <- solve(qr(h5))
> 	hinv2 <- solve(qr(h5, LAPACK=3DTRUE))=09
> 	all.equal(hinv1, hinv2)  # They are not equal
>=20
> Here is a function that I wrote to correct this problem:
>=20
> 	solve.lapack <- function(A, LAPACK=3DTRUE, tol=3D1.e-07) {
> 	# A function to invert a matrix using "LAPACK" or "LINPACK"
>         if (nrow(A) !=3D ncol(A)) stop("Matrix muxt be square")
>         qrA <- qr(A, LAPACK=3DLAPACK, tol=3Dtol)
>         if (LAPACK) {
> 	apply(diag(1, ncol(A)), 2, function(x) solve(qrA, x))=20
>         } else  solve(qrA)
> 	}
>=20
>         hinv3 <- solve.lapack(h5)
> 	all.equal(hinv1, hinv3)  # Now, they are equal
>=20
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


--=20
   O__  ---- Peter Dalgaard             =C3=98ster Farimagsgade 5, Entr.B=

  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907


From cgenolin at u-paris10.fr  Thu Jun 18 15:57:24 2009
From: cgenolin at u-paris10.fr (Christophe Genolini)
Date: Thu, 18 Jun 2009 15:57:24 +0200
Subject: [Rd] Argument as.integer(NA) to a function C
Message-ID: <4A3A47C4.7060509@u-paris10.fr>

Hi the list,
I am writing a R function that call a C function. The C function needs 
integers but I do not manage to give a NA integer as argument :

--- C code ---
void essai(int *t){
    Rprintf("\nT0=%i T1=%i T2=%i T3=%i",t[0],t[1],t[2],t[3]);
}

--- R ---
boub <- c(1,2,3,4)
.C("pour",as.integer(boub),NAOK=TRUE)

# T0=1 T1=2 T2=3 T3=4[[1]]
# [1] 1 2 3 4

boub <- c(1,2,NA,4)
.C("essai",as.integer(boub),NAOK=TRUE)

# T0=1 T1=2 T2=-2147483648 T3=4[[1]]
# [1]  1  2 NA  4
--- ---

In the second example, T2=-2147483648 and not NA.

I check the "writing R extension", there is a part that explain that the 
test of NA is not the same between double and integer (NA_INTEGER, 
ISNA), but I did not find explanation on passing NA argument as integer.

Any idea of what is wrong in my code?

Christophe


From simon.urbanek at r-project.org  Thu Jun 18 16:24:50 2009
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Thu, 18 Jun 2009 10:24:50 -0400
Subject: [Rd] Argument as.integer(NA) to a function C
In-Reply-To: <4A3A47C4.7060509@u-paris10.fr>
References: <4A3A47C4.7060509@u-paris10.fr>
Message-ID: <C9B014DA-0666-4EB5-916F-CF3087C8BFA0@r-project.org>


On Jun 18, 2009, at 9:57 , Christophe Genolini wrote:

> Hi the list,
> I am writing a R function that call a C function. The C function  
> needs integers but I do not manage to give a NA integer as argument :
>
> --- C code ---
> void essai(int *t){
>   Rprintf("\nT0=%i T1=%i T2=%i T3=%i",t[0],t[1],t[2],t[3]);
> }
>
> --- R ---
> boub <- c(1,2,3,4)
> .C("pour",as.integer(boub),NAOK=TRUE)
>
> # T0=1 T1=2 T2=3 T3=4[[1]]
> # [1] 1 2 3 4
>
> boub <- c(1,2,NA,4)
> .C("essai",as.integer(boub),NAOK=TRUE)
>
> # T0=1 T1=2 T2=-2147483648 T3=4[[1]]
> # [1]  1  2 NA  4
> --- ---
>
> In the second example, T2=-2147483648 and not NA.
>
> I check the "writing R extension", there is a part that explain that  
> the test of NA is not the same between double and integer  
> (NA_INTEGER, ISNA), but I did not find explanation on passing NA  
> argument as integer.
>
> Any idea of what is wrong in my code?
>

I don't see any problem - in C there is no inherent NA, so what you  
get is NA_INTEGER value which prints as -2147483648 when you print it  
as integer (which is what you do in essai).

Cheers,
S


From therneau at mayo.edu  Thu Jun 18 17:44:22 2009
From: therneau at mayo.edu (Terry Therneau)
Date: Thu, 18 Jun 2009 10:44:22 -0500 (CDT)
Subject: [Rd] binding message from R CMD check
Message-ID: <200906181544.n5IFiMg29427@hsrnfs-101.mayo.edu>

When I run R CMD check on the survival package I get one error message that I 
have not been able to figure out:

    survfitCI: no visible binding for global variable 'n.nevent'

I've examined the code and can't see the problem -- the variable in question 
appears several times.  Is there as way to find out EXACTLY what line it objects 
to?

Terry T


From ripley at stats.ox.ac.uk  Thu Jun 18 18:03:43 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 18 Jun 2009 17:03:43 +0100 (BST)
Subject: [Rd] Argument as.integer(NA) to a function C
In-Reply-To: <4A3A47C4.7060509@u-paris10.fr>
References: <4A3A47C4.7060509@u-paris10.fr>
Message-ID: <alpine.LFD.2.00.0906181654290.5417@gannet.stats.ox.ac.uk>

On Thu, 18 Jun 2009, Christophe Genolini wrote:

> Hi the list,
> I am writing a R function that call a C function. The C function needs 
> integers but I do not manage to give a NA integer as argument :
>
> --- C code ---
> void essai(int *t){
>   Rprintf("\nT0=%i T1=%i T2=%i T3=%i",t[0],t[1],t[2],t[3]);
> }
>
> --- R ---
> boub <- c(1,2,3,4)
> .C("pour",as.integer(boub),NAOK=TRUE)
>
> # T0=1 T1=2 T2=3 T3=4[[1]]
> # [1] 1 2 3 4
>
> boub <- c(1,2,NA,4)
> .C("essai",as.integer(boub),NAOK=TRUE)
>
> # T0=1 T1=2 T2=-2147483648 T3=4[[1]]
> # [1]  1  2 NA  4
> --- ---
>
> In the second example, T2=-2147483648 and not NA.
>
> I check the "writing R extension", there is a part that explain that the test 
> of NA is not the same between double and integer (NA_INTEGER, ISNA), but I 
> did not find explanation on passing NA argument as integer.
>
> Any idea of what is wrong in my code?

Simple: Rprintf does not know about NAs (and nor does printf).  From 
the manual:

   The most useful function for printing from a C routine compiled into
   R is Rprintf.  This is used in exactly the same way as printf, but
   is guaranteed to write to R's output (which might be a GUI console
   rather than a file).

The value of NA is stored as NA_INTEGER = -2^32, and if you want your 
C code to be aware of it, *you* need to program so that value is 
treated specially.  (Since double NAs are stored as a particular NaN, 
the default C handling of doubles will probably do something sensible 
but careful code will also need to take the difference between NaNs 
into account.)

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Thu Jun 18 18:09:09 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 18 Jun 2009 17:09:09 +0100 (BST)
Subject: [Rd] binding message from R CMD check
In-Reply-To: <200906181544.n5IFiMg29427@hsrnfs-101.mayo.edu>
References: <200906181544.n5IFiMg29427@hsrnfs-101.mayo.edu>
Message-ID: <alpine.LFD.2.00.0906181704350.5417@gannet.stats.ox.ac.uk>

On Thu, 18 Jun 2009, Terry Therneau wrote:

> When I run R CMD check on the survival package I get one error message that I
> have not been able to figure out:
>
>    survfitCI: no visible binding for global variable 'n.nevent'
>
> I've examined the code and can't see the problem -- the variable in question
> appears several times.  Is there as way to find out EXACTLY what line it objects
> to?

No, as it examines the parsed code (and codetools predates srcref 
records).  But grep finds only one occurrence in survival, at

gannet% grep -F n.nevent *
survfitCI.S:			 n.event=unlist(n.nevent),

Is it a typo for n.event?

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ripley at stats.ox.ac.uk  Thu Jun 18 18:03:43 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 18 Jun 2009 17:03:43 +0100 (BST)
Subject: [Rd] Argument as.integer(NA) to a function C
In-Reply-To: <4A3A47C4.7060509@u-paris10.fr>
References: <4A3A47C4.7060509@u-paris10.fr>
Message-ID: <alpine.LFD.2.00.0906181654290.5417@gannet.stats.ox.ac.uk>

On Thu, 18 Jun 2009, Christophe Genolini wrote:

> Hi the list,
> I am writing a R function that call a C function. The C function needs 
> integers but I do not manage to give a NA integer as argument :
>
> --- C code ---
> void essai(int *t){
>   Rprintf("\nT0=%i T1=%i T2=%i T3=%i",t[0],t[1],t[2],t[3]);
> }
>
> --- R ---
> boub <- c(1,2,3,4)
> .C("pour",as.integer(boub),NAOK=TRUE)
>
> # T0=1 T1=2 T2=3 T3=4[[1]]
> # [1] 1 2 3 4
>
> boub <- c(1,2,NA,4)
> .C("essai",as.integer(boub),NAOK=TRUE)
>
> # T0=1 T1=2 T2=-2147483648 T3=4[[1]]
> # [1]  1  2 NA  4
> --- ---
>
> In the second example, T2=-2147483648 and not NA.
>
> I check the "writing R extension", there is a part that explain that the test 
> of NA is not the same between double and integer (NA_INTEGER, ISNA), but I 
> did not find explanation on passing NA argument as integer.
>
> Any idea of what is wrong in my code?

Simple: Rprintf does not know about NAs (and nor does printf).  From 
the manual:

   The most useful function for printing from a C routine compiled into
   R is Rprintf.  This is used in exactly the same way as printf, but
   is guaranteed to write to R's output (which might be a GUI console
   rather than a file).

The value of NA is stored as NA_INTEGER = -2^32, and if you want your 
C code to be aware of it, *you* need to program so that value is 
treated specially.  (Since double NAs are stored as a particular NaN, 
the default C handling of doubles will probably do something sensible 
but careful code will also need to take the difference between NaNs 
into account.)

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From romain.francois at dbmail.com  Thu Jun 18 20:02:41 2009
From: romain.francois at dbmail.com (Romain Francois)
Date: Thu, 18 Jun 2009 20:02:41 +0200
Subject: [Rd] R_parseVector and syntax error [was: error messages while
 parsing with rniParse]
In-Reply-To: <63D1BDD5-D697-4F84-96A8-CD89AE8C4113@r-project.org>
References: <4A36715A.2020003@dbmail.com>
	<63D1BDD5-D697-4F84-96A8-CD89AE8C4113@r-project.org>
Message-ID: <4A3A8141.6080401@dbmail.com>

Hello,

[I'm redirecting this here from stats-rosuda-devel]

When parsing R code through R_parseVector and the code generates an 
error (syntax error), is there a way to grab the error.
It looks like yyerror populates the buffer "R_ParseErrorMsg", but then 
the variable is not part of the public api.

Would it be possible to add yet another entry point to the parser that 
would basically wrap R_parseVector so that it would have an extra char* 
argument that would bring back the error message if there is an error?

Romain

Simon Urbanek wrote:
> On Jun 15, 2009, at 12:05 , Romain Francois wrote:
>
>> Hello,
>>
>> In JRI, is there a way to get the error message that is generated by the
>> parser through rniParse
>> For example, if I have this :
>>
>> long y = re.rniParse( "rnorm( 10 ))", 1 ) ;
>>
>> this obviously generates a parse error, so y will be the same as
>> (R_NilValue) :
>>
>> long null_id = re.rniEval( re.rniParse( "NULL", 1 ), 0 ) ;
>>
>> I guess the underlying question is : "Is R_ParseErrorMsg exposed to
>> JRI".
>
> AFAICT R_ParseErrorMsg and friends are not exposed by the R API - they 
> are not accessible outside, so they cannot be use by JRI. It would be 
> nice if there was a way of accessing that info, but R doesn't 
> currently support that.
>
> Cheers,
> Simon
>
>> The reason is I would like to bring back the message as part of an
>> exception generated when the code does not parse.
>>
>> Romain


-- 
Romain Francois
Independent R Consultant
+33(0) 6 28 91 30 30
http://romainfrancois.blog.free.fr


From kynnjo at gmail.com  Thu Jun 18 22:34:40 2009
From: kynnjo at gmail.com (Kynn Jones)
Date: Thu, 18 Jun 2009 16:34:40 -0400
Subject: [Rd] ScalarLong?
Message-ID: <c2350ba40906181334j14fbb298j52194bfebf267212@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090618/b0b0b98a/attachment.pl>

From murdoch at stats.uwo.ca  Thu Jun 18 23:02:05 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Thu, 18 Jun 2009 23:02:05 +0200
Subject: [Rd] R_parseVector and syntax error [was: error messages while
 parsing with rniParse]
In-Reply-To: <4A3A8141.6080401@dbmail.com>
References: <4A36715A.2020003@dbmail.com>	<63D1BDD5-D697-4F84-96A8-CD89AE8C4113@r-project.org>
	<4A3A8141.6080401@dbmail.com>
Message-ID: <4A3AAB4D.8030100@stats.uwo.ca>

Romain Francois wrote:
> Hello,
>
> [I'm redirecting this here from stats-rosuda-devel]
>
> When parsing R code through R_parseVector and the code generates an 
> error (syntax error), is there a way to grab the error.
> It looks like yyerror populates the buffer "R_ParseErrorMsg", but then 
> the variable is not part of the public api.
>
> Would it be possible to add yet another entry point to the parser that 
> would basically wrap R_parseVector so that it would have an extra char* 
> argument that would bring back the error message if there is an error?
>
>   

I would oppose that.  Suggest ways to reduce the complexity of the 
parser interface and I'd be interested.  It's a nightmare to make any 
changes there.

You can always call the R function wrapped in try(), so it's not as 
though this would give you anything that you don't already have access to. 

Duncan Murdoch

> Romain
>
> Simon Urbanek wrote:
>   
>> On Jun 15, 2009, at 12:05 , Romain Francois wrote:
>>
>>     
>>> Hello,
>>>
>>> In JRI, is there a way to get the error message that is generated by the
>>> parser through rniParse
>>> For example, if I have this :
>>>
>>> long y = re.rniParse( "rnorm( 10 ))", 1 ) ;
>>>
>>> this obviously generates a parse error, so y will be the same as
>>> (R_NilValue) :
>>>
>>> long null_id = re.rniEval( re.rniParse( "NULL", 1 ), 0 ) ;
>>>
>>> I guess the underlying question is : "Is R_ParseErrorMsg exposed to
>>> JRI".
>>>       
>> AFAICT R_ParseErrorMsg and friends are not exposed by the R API - they 
>> are not accessible outside, so they cannot be use by JRI. It would be 
>> nice if there was a way of accessing that info, but R doesn't 
>> currently support that.
>>
>> Cheers,
>> Simon
>>
>>     
>>> The reason is I would like to bring back the message as part of an
>>> exception generated when the code does not parse.
>>>
>>> Romain
>>>       
>
>
>


From simon.urbanek at r-project.org  Fri Jun 19 00:34:21 2009
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Thu, 18 Jun 2009 18:34:21 -0400
Subject: [Rd] R_parseVector and syntax error [was: error messages while
	parsing with rniParse]
In-Reply-To: <4A3AAB4D.8030100@stats.uwo.ca>
References: <4A36715A.2020003@dbmail.com>	<63D1BDD5-D697-4F84-96A8-CD89AE8C4113@r-project.org>
	<4A3A8141.6080401@dbmail.com> <4A3AAB4D.8030100@stats.uwo.ca>
Message-ID: <EFC2C284-8863-4E5E-85CF-4AB223238302@r-project.org>


On Jun 18, 2009, at 17:02 , Duncan Murdoch wrote:

> Romain Francois wrote:
>> Hello,
>>
>> [I'm redirecting this here from stats-rosuda-devel]
>>
>> When parsing R code through R_parseVector and the code generates an  
>> error (syntax error), is there a way to grab the error.
>> It looks like yyerror populates the buffer "R_ParseErrorMsg", but  
>> then the variable is not part of the public api.
>>
>> Would it be possible to add yet another entry point to the parser  
>> that would basically wrap R_parseVector so that it would have an  
>> extra char* argument that would bring back the error message if  
>> there is an error?
>>
>>
>
> I would oppose that.  Suggest ways to reduce the complexity of the  
> parser interface and I'd be interested.  It's a nightmare to make  
> any changes there.
>
> You can always call the R function wrapped in try(), so it's not as  
> though this would give you anything that you don't already have  
> access to.


I'm not quite following - we're talking about R_ParseVector in C code  
so the point is that the C code gets access to the error message so it  
can relay it to the user. There are no R-level functions involved  
here. The issue here for the moment is that this information is  
retrievable at R level but not (officially) at the C level. As for  
reducing complexity - technically, there is no complexity added since  
all this is already in place ... [adding extra char * argument to  
ParseVector may not be the best way but that's not what I'm arguing  
for]. Or am I missing something?

Cheers,
S


>
>> Romain
>>
>> Simon Urbanek wrote:
>>
>>> On Jun 15, 2009, at 12:05 , Romain Francois wrote:
>>>
>>>
>>>> Hello,
>>>>
>>>> In JRI, is there a way to get the error message that is generated  
>>>> by the
>>>> parser through rniParse
>>>> For example, if I have this :
>>>>
>>>> long y = re.rniParse( "rnorm( 10 ))", 1 ) ;
>>>>
>>>> this obviously generates a parse error, so y will be the same as
>>>> (R_NilValue) :
>>>>
>>>> long null_id = re.rniEval( re.rniParse( "NULL", 1 ), 0 ) ;
>>>>
>>>> I guess the underlying question is : "Is R_ParseErrorMsg exposed to
>>>> JRI".
>>>>
>>> AFAICT R_ParseErrorMsg and friends are not exposed by the R API -  
>>> they are not accessible outside, so they cannot be use by JRI. It  
>>> would be nice if there was a way of accessing that info, but R  
>>> doesn't currently support that.
>>>
>>> Cheers,
>>> Simon
>>>
>>>
>>>> The reason is I would like to bring back the message as part of an
>>>> exception generated when the code does not parse.
>>>>
>>>> Romain
>>>>
>>
>>
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From simon.urbanek at r-project.org  Fri Jun 19 00:44:30 2009
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Thu, 18 Jun 2009 18:44:30 -0400
Subject: [Rd] ScalarLong?
In-Reply-To: <c2350ba40906181334j14fbb298j52194bfebf267212@mail.gmail.com>
References: <c2350ba40906181334j14fbb298j52194bfebf267212@mail.gmail.com>
Message-ID: <2C957AF9-E377-49C6-97D2-0E2CBF2DBB10@r-project.org>


On Jun 18, 2009, at 16:34 , Kynn Jones wrote:

> I was surprised to see that there is a ScalarInteger function in
> Rinlinedfuns.h, but nothing like ScalarLong.
>
> How can one create an R-integer from a C long?
>

There is no such thing as "long" in R (*), so one cannot make a  
"scalar long" vector in R. But to answer your question (how to create  
"R-integer" - interpreted as "integer vector of length one") it's simply
ScalarInteger((int) myLong)

(*) - on 32-bit systems long and int are equivalent, so the conversion  
is lossless, on 64-bit systems there is no way to store a "long" in R  
integer without loss of precision. The only lossless way on 64-bit  
systems is to store it in a raw vector of 8 bytes (but then there's  
not much you can do with it ...). For practical purposes it is usually  
sufficient to convert it to double (real vector in R) since you have  
at least guaranteed 52-bit precision (technically even more) and can  
perform the usual operations on it.

Cheers,
Simon


From paboyoun at fhcrc.org  Fri Jun 19 01:42:37 2009
From: paboyoun at fhcrc.org (Patrick Aboyoun)
Date: Thu, 18 Jun 2009 16:42:37 -0700
Subject: [Rd] validObject throws non-caught error when slot doesn't exist
Message-ID: <4A3AD0ED.4030002@fhcrc.org>

I have been retooling an S4 class definition to include another slot and 
have found that the methods::validObject function (defined in 
methods/R/SClasses.R) in R-devel throws an error that isn't caught 
internally (and thus not controllable by 'test' argument) when 
retrieving a non-existent slot. The offending line of code is shown below:

 > validObject
function (object, test = FALSE, complete = FALSE)
{
...
    for (i in seq_along(slotTypes)) {
        classi <- slotTypes[[i]]
        sloti <- slot(object, slotNames[[i]]) # offending line of code

One potential patch is to substitute the offending line with

        sloti <- try(slot(object, slotNames[[i]]), silent = TRUE)
        if (class(sloti) == "try-error") {
            errors <- c(errors, paste("missing slot \"", slotNames[[i]],
                "\"", sep = ""))
            next
        }

Here is a reproduce and an example using vaildObject2 that substitutes 
the offending line with the code given above:

 > setClass("Foo", representation(bar = "character"))
[1] "Foo"
 > a <- new("Foo", bar = letters)
 > setClass("Foo", representation(bar = "character", star = "numeric"))
[1] "Foo"
 > validObject(a, test = TRUE)
Error in slot(object, slotNames[[i]]) :
  no slot of name "star" for this object of class "Foo"
 > validObject2(a, test = TRUE)
[1] "missing slot \"star\""
 > sessionInfo()
R version 2.10.0 Under development (unstable) (2009-06-12 r48755)
i386-apple-darwin9.6.0

locale:
[1] en_US.UTF-8/en_US.UTF-8/C/C/en_US.UTF-8/en_US.UTF-8

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     



Patrick


From murdoch at stats.uwo.ca  Fri Jun 19 05:40:30 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Fri, 19 Jun 2009 05:40:30 +0200
Subject: [Rd] R_parseVector and syntax error [was: error messages while
 parsing with rniParse]
In-Reply-To: <EFC2C284-8863-4E5E-85CF-4AB223238302@r-project.org>
References: <4A36715A.2020003@dbmail.com>	<63D1BDD5-D697-4F84-96A8-CD89AE8C4113@r-project.org>
	<4A3A8141.6080401@dbmail.com> <4A3AAB4D.8030100@stats.uwo.ca>
	<EFC2C284-8863-4E5E-85CF-4AB223238302@r-project.org>
Message-ID: <4A3B08AE.5080405@stats.uwo.ca>

Simon Urbanek wrote:
> On Jun 18, 2009, at 17:02 , Duncan Murdoch wrote:
>
>   
>> Romain Francois wrote:
>>     
>>> Hello,
>>>
>>> [I'm redirecting this here from stats-rosuda-devel]
>>>
>>> When parsing R code through R_parseVector and the code generates an  
>>> error (syntax error), is there a way to grab the error.
>>> It looks like yyerror populates the buffer "R_ParseErrorMsg", but  
>>> then the variable is not part of the public api.
>>>
>>> Would it be possible to add yet another entry point to the parser  
>>> that would basically wrap R_parseVector so that it would have an  
>>> extra char* argument that would bring back the error message if  
>>> there is an error?
>>>
>>>
>>>       
>> I would oppose that.  Suggest ways to reduce the complexity of the  
>> parser interface and I'd be interested.  It's a nightmare to make  
>> any changes there.
>>
>> You can always call the R function wrapped in try(), so it's not as  
>> though this would give you anything that you don't already have  
>> access to.
>>     
>
>
> I'm not quite following - we're talking about R_ParseVector in C code  
> so the point is that the C code gets access to the error message so it  
> can relay it to the user. 

I understood that.  But the C code can get the error message by 
evaluating an R expression and looking at the result.

> There are no R-level functions involved  
> here. The issue here for the moment is that this information is  
> retrievable at R level but not (officially) at the C level. 

I wouldn't mind exposing the underlying information in a clean way, but 
the string in R_ParseVector isn't all a front end should get. 

At the time of an R_ParseVector syntax error, the parser knows what 
token it couldn't handle, and it knows its classification, and the 
location in the file where it came from.   Not all of that makes it 
through to the error message. 

> As for  
> reducing complexity - technically, there is no complexity added since  
> all this is already in place ... [adding extra char * argument to  
> ParseVector may not be the best way but that's not what I'm arguing  
> for]. 
>   

It was what I was arguing against.

Duncan Murdoch

> Or am I missing something?

> Cheers,
> S
>
>
>   
>>> Romain
>>>
>>> Simon Urbanek wrote:
>>>
>>>       
>>>> On Jun 15, 2009, at 12:05 , Romain Francois wrote:
>>>>
>>>>
>>>>         
>>>>> Hello,
>>>>>
>>>>> In JRI, is there a way to get the error message that is generated  
>>>>> by the
>>>>> parser through rniParse
>>>>> For example, if I have this :
>>>>>
>>>>> long y = re.rniParse( "rnorm( 10 ))", 1 ) ;
>>>>>
>>>>> this obviously generates a parse error, so y will be the same as
>>>>> (R_NilValue) :
>>>>>
>>>>> long null_id = re.rniEval( re.rniParse( "NULL", 1 ), 0 ) ;
>>>>>
>>>>> I guess the underlying question is : "Is R_ParseErrorMsg exposed to
>>>>> JRI".
>>>>>
>>>>>           
>>>> AFAICT R_ParseErrorMsg and friends are not exposed by the R API -  
>>>> they are not accessible outside, so they cannot be use by JRI. It  
>>>> would be nice if there was a way of accessing that info, but R  
>>>> doesn't currently support that.
>>>>
>>>> Cheers,
>>>> Simon
>>>>
>>>>
>>>>         
>>>>> The reason is I would like to bring back the message as part of an
>>>>> exception generated when the code does not parse.
>>>>>
>>>>> Romain
>>>>>
>>>>>           
>>>
>>>       
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
>>


From romain.francois at dbmail.com  Fri Jun 19 08:17:05 2009
From: romain.francois at dbmail.com (Romain Francois)
Date: Fri, 19 Jun 2009 08:17:05 +0200
Subject: [Rd] R_parseVector and syntax error [was: error messages while
 parsing with rniParse]
In-Reply-To: <4A3B08AE.5080405@stats.uwo.ca>
References: <4A36715A.2020003@dbmail.com>	<63D1BDD5-D697-4F84-96A8-CD89AE8C4113@r-project.org>
	<4A3A8141.6080401@dbmail.com> <4A3AAB4D.8030100@stats.uwo.ca>
	<EFC2C284-8863-4E5E-85CF-4AB223238302@r-project.org>
	<4A3B08AE.5080405@stats.uwo.ca>
Message-ID: <4A3B2D61.5050804@dbmail.com>

Duncan Murdoch wrote:
>
> Simon Urbanek wrote:
>> On Jun 18, 2009, at 17:02 , Duncan Murdoch wrote:
>>  
>>> Romain Francois wrote:
>>>    
>>>> Hello,
>>>>
>>>> [I'm redirecting this here from stats-rosuda-devel]
>>>>
>>>> When parsing R code through R_parseVector and the code generates 
>>>> an  error (syntax error), is there a way to grab the error.
>>>> It looks like yyerror populates the buffer "R_ParseErrorMsg", but  
>>>> then the variable is not part of the public api.
>>>>
>>>> Would it be possible to add yet another entry point to the parser  
>>>> that would basically wrap R_parseVector so that it would have an  
>>>> extra char* argument that would bring back the error message if  
>>>> there is an error?
>>>>
>>>>
>>>>       
>>> I would oppose that.  Suggest ways to reduce the complexity of the  
>>> parser interface and I'd be interested.  It's a nightmare to make  
>>> any changes there.
>>>
>>> You can always call the R function wrapped in try(), so it's not as  
>>> though this would give you anything that you don't already have  
>>> access to.
>>>     
>>
>>
>> I'm not quite following - we're talking about R_ParseVector in C 
>> code  so the point is that the C code gets access to the error 
>> message so it  can relay it to the user. 
>
> I understood that.  But the C code can get the error message by 
> evaluating an R expression and looking at the result.
>
>> There are no R-level functions involved  here. The issue here for the 
>> moment is that this information is  retrievable at R level but not 
>> (officially) at the C level. 
>
> I wouldn't mind exposing the underlying information in a clean way, 
> but the string in R_ParseVector isn't all a front end should get.

Great. Let's do that.
Is a function that simply returns some of the static variables used by 
bison clean enough ?


> At the time of an R_ParseVector syntax error, the parser knows what 
> token it couldn't handle, and it knows its classification, and the 
> location in the file where it came from.   Not all of that makes it 
> through to the error message.
>> As for  reducing complexity - technically, there is no complexity 
>> added since  all this is already in place ... [adding extra char * 
>> argument to  ParseVector may not be the best way but that's not what 
>> I'm arguing  for].   
>
> It was what I was arguing against.
>
> Duncan Murdoch
>
>> Or am I missing something?
>
>> Cheers,
>> S
>>
>>
>>  
>>>> Romain
>>>>
>>>> Simon Urbanek wrote:
>>>>
>>>>      
>>>>> On Jun 15, 2009, at 12:05 , Romain Francois wrote:
>>>>>
>>>>>
>>>>>        
>>>>>> Hello,
>>>>>>
>>>>>> In JRI, is there a way to get the error message that is 
>>>>>> generated  by the
>>>>>> parser through rniParse
>>>>>> For example, if I have this :
>>>>>>
>>>>>> long y = re.rniParse( "rnorm( 10 ))", 1 ) ;
>>>>>>
>>>>>> this obviously generates a parse error, so y will be the same as
>>>>>> (R_NilValue) :
>>>>>>
>>>>>> long null_id = re.rniEval( re.rniParse( "NULL", 1 ), 0 ) ;
>>>>>>
>>>>>> I guess the underlying question is : "Is R_ParseErrorMsg exposed to
>>>>>> JRI".
>>>>>>
>>>>>>           
>>>>> AFAICT R_ParseErrorMsg and friends are not exposed by the R API -  
>>>>> they are not accessible outside, so they cannot be use by JRI. It  
>>>>> would be nice if there was a way of accessing that info, but R  
>>>>> doesn't currently support that.
>>>>>
>>>>> Cheers,
>>>>> Simon
>>>>>
>>>>>
>>>>>        
>>>>>> The reason is I would like to bring back the message as part of an
>>>>>> exception generated when the code does not parse.
>>>>>>
>>>>>> Romain
>>>>>>
>>>>>>           
>>>>
>>>>       
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>>
>>>     
>
>
>


-- 
Romain Francois
Independent R Consultant
+33(0) 6 28 91 30 30
http://romainfrancois.blog.free.fr


From murdoch at stats.uwo.ca  Fri Jun 19 08:53:27 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Fri, 19 Jun 2009 08:53:27 +0200
Subject: [Rd] R_parseVector and syntax error [was: error messages while
 parsing with rniParse]
In-Reply-To: <4A3B2D61.5050804@dbmail.com>
References: <4A36715A.2020003@dbmail.com>	<63D1BDD5-D697-4F84-96A8-CD89AE8C4113@r-project.org>	<4A3A8141.6080401@dbmail.com>
	<4A3AAB4D.8030100@stats.uwo.ca>	<EFC2C284-8863-4E5E-85CF-4AB223238302@r-project.org>	<4A3B08AE.5080405@stats.uwo.ca>
	<4A3B2D61.5050804@dbmail.com>
Message-ID: <4A3B35E7.8050202@stats.uwo.ca>

Romain Francois wrote:
> Duncan Murdoch wrote:
>   
>> Simon Urbanek wrote:
>>     
>>> On Jun 18, 2009, at 17:02 , Duncan Murdoch wrote:
>>>  
>>>       
>>>> Romain Francois wrote:
>>>>    
>>>>         
>>>>> Hello,
>>>>>
>>>>> [I'm redirecting this here from stats-rosuda-devel]
>>>>>
>>>>> When parsing R code through R_parseVector and the code generates 
>>>>> an  error (syntax error), is there a way to grab the error.
>>>>> It looks like yyerror populates the buffer "R_ParseErrorMsg", but  
>>>>> then the variable is not part of the public api.
>>>>>
>>>>> Would it be possible to add yet another entry point to the parser  
>>>>> that would basically wrap R_parseVector so that it would have an  
>>>>> extra char* argument that would bring back the error message if  
>>>>> there is an error?
>>>>>
>>>>>
>>>>>       
>>>>>           
>>>> I would oppose that.  Suggest ways to reduce the complexity of the  
>>>> parser interface and I'd be interested.  It's a nightmare to make  
>>>> any changes there.
>>>>
>>>> You can always call the R function wrapped in try(), so it's not as  
>>>> though this would give you anything that you don't already have  
>>>> access to.
>>>>     
>>>>         
>>> I'm not quite following - we're talking about R_ParseVector in C 
>>> code  so the point is that the C code gets access to the error 
>>> message so it  can relay it to the user. 
>>>       
>> I understood that.  But the C code can get the error message by 
>> evaluating an R expression and looking at the result.
>>
>>     
>>> There are no R-level functions involved  here. The issue here for the 
>>> moment is that this information is  retrievable at R level but not 
>>> (officially) at the C level. 
>>>       
>> I wouldn't mind exposing the underlying information in a clean way, 
>> but the string in R_ParseVector isn't all a front end should get.
>>     
>
> Great. Let's do that.
> Is a function that simply returns some of the static variables used by 
> bison clean enough ?
>   
It could be.   I'd like a design that allows for the possibility of 
multiple syntax errors to be reported.  I have parse_Rd doing that, 
though not committed yet.  parse() is different because we have to be 
less tolerant of errors in R code than in Rd files.  But we could still 
report multiple errors in one parse, not just stop at the first one.

Duncan Murdoch

>> At the time of an R_ParseVector syntax error, the parser knows what 
>> token it couldn't handle, and it knows its classification, and the 
>> location in the file where it came from.   Not all of that makes it 
>> through to the error message.
>>     
>>> As for  reducing complexity - technically, there is no complexity 
>>> added since  all this is already in place ... [adding extra char * 
>>> argument to  ParseVector may not be the best way but that's not what 
>>> I'm arguing  for].   
>>>       
>> It was what I was arguing against.
>>
>> Duncan Murdoch
>>
>>     
>>> Or am I missing something?
>>>       
>>> Cheers,
>>> S
>>>
>>>
>>>  
>>>       
>>>>> Romain
>>>>>
>>>>> Simon Urbanek wrote:
>>>>>
>>>>>      
>>>>>           
>>>>>> On Jun 15, 2009, at 12:05 , Romain Francois wrote:
>>>>>>
>>>>>>
>>>>>>        
>>>>>>             
>>>>>>> Hello,
>>>>>>>
>>>>>>> In JRI, is there a way to get the error message that is 
>>>>>>> generated  by the
>>>>>>> parser through rniParse
>>>>>>> For example, if I have this :
>>>>>>>
>>>>>>> long y = re.rniParse( "rnorm( 10 ))", 1 ) ;
>>>>>>>
>>>>>>> this obviously generates a parse error, so y will be the same as
>>>>>>> (R_NilValue) :
>>>>>>>
>>>>>>> long null_id = re.rniEval( re.rniParse( "NULL", 1 ), 0 ) ;
>>>>>>>
>>>>>>> I guess the underlying question is : "Is R_ParseErrorMsg exposed to
>>>>>>> JRI".
>>>>>>>
>>>>>>>           
>>>>>>>               
>>>>>> AFAICT R_ParseErrorMsg and friends are not exposed by the R API -  
>>>>>> they are not accessible outside, so they cannot be use by JRI. It  
>>>>>> would be nice if there was a way of accessing that info, but R  
>>>>>> doesn't currently support that.
>>>>>>
>>>>>> Cheers,
>>>>>> Simon
>>>>>>
>>>>>>
>>>>>>        
>>>>>>             
>>>>>>> The reason is I would like to bring back the message as part of an
>>>>>>> exception generated when the code does not parse.
>>>>>>>
>>>>>>> Romain
>>>>>>>
>>>>>>>           
>>>>>>>               
>>>>>       
>>>>>           
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>
>>>>
>>>>     
>>>>         
>>
>>     
>
>
>


From romain.francois at dbmail.com  Fri Jun 19 09:18:51 2009
From: romain.francois at dbmail.com (Romain Francois)
Date: Fri, 19 Jun 2009 09:18:51 +0200
Subject: [Rd] R_parseVector and syntax error [was: error messages while
 parsing with rniParse]
In-Reply-To: <4A3B35E7.8050202@stats.uwo.ca>
References: <4A36715A.2020003@dbmail.com>	<63D1BDD5-D697-4F84-96A8-CD89AE8C4113@r-project.org>	<4A3A8141.6080401@dbmail.com>
	<4A3AAB4D.8030100@stats.uwo.ca>	<EFC2C284-8863-4E5E-85CF-4AB223238302@r-project.org>	<4A3B08AE.5080405@stats.uwo.ca>
	<4A3B2D61.5050804@dbmail.com> <4A3B35E7.8050202@stats.uwo.ca>
Message-ID: <4A3B3BDB.2040800@dbmail.com>

Duncan Murdoch wrote:
>
> Romain Francois wrote:
>> Duncan Murdoch wrote:
>>  
>>> Simon Urbanek wrote:
>>>    
>>>> On Jun 18, 2009, at 17:02 , Duncan Murdoch wrote:
>>>>  
>>>>      
>>>>> Romain Francois wrote:
>>>>>           
>>>>>> Hello,
>>>>>>
>>>>>> [I'm redirecting this here from stats-rosuda-devel]
>>>>>>
>>>>>> When parsing R code through R_parseVector and the code generates 
>>>>>> an  error (syntax error), is there a way to grab the error.
>>>>>> It looks like yyerror populates the buffer "R_ParseErrorMsg", 
>>>>>> but  then the variable is not part of the public api.
>>>>>>
>>>>>> Would it be possible to add yet another entry point to the 
>>>>>> parser  that would basically wrap R_parseVector so that it would 
>>>>>> have an  extra char* argument that would bring back the error 
>>>>>> message if  there is an error?
>>>>>>
>>>>>>
>>>>>>                 
>>>>> I would oppose that.  Suggest ways to reduce the complexity of 
>>>>> the  parser interface and I'd be interested.  It's a nightmare to 
>>>>> make  any changes there.
>>>>>
>>>>> You can always call the R function wrapped in try(), so it's not 
>>>>> as  though this would give you anything that you don't already 
>>>>> have  access to.
>>>>>             
>>>> I'm not quite following - we're talking about R_ParseVector in C 
>>>> code  so the point is that the C code gets access to the error 
>>>> message so it  can relay it to the user.       
>>> I understood that.  But the C code can get the error message by 
>>> evaluating an R expression and looking at the result.
>>>
>>>    
>>>> There are no R-level functions involved  here. The issue here for 
>>>> the moment is that this information is  retrievable at R level but 
>>>> not (officially) at the C level.       
>>> I wouldn't mind exposing the underlying information in a clean way, 
>>> but the string in R_ParseVector isn't all a front end should get.
>>>     
>>
>> Great. Let's do that.
>> Is a function that simply returns some of the static variables used 
>> by bison clean enough ?
>>   
> It could be.   I'd like a design that allows for the possibility of 
> multiple syntax errors to be reported.  I have parse_Rd doing that, 
> though not committed yet.  parse() is different because we have to be 
> less tolerant of errors in R code than in Rd files.  But we could 
> still report multiple errors in one parse, not just stop at the first 
> one.

This is an interesting problem. Just being curious here: how do you 
continue parsing after a syntax error in parse ? Does it depend on the 
kind of syntax error ? Do you use some of the recovery protocols of 
bison (the special "error" token only appears in the very top level prog 
symbol :

prog    :    END_OF_INPUT            { return 0; }
    |    '\n'                { return xxvalue(NULL,2,NULL); }
    |    expr_or_assign '\n'            { return xxvalue($1,3,&@1); }
    |    expr_or_assign ';'            { return xxvalue($1,4,&@1); }
    |    error                 { YYABORT; }
    ;


Anyway, what about using the extra information to structure an error 
message of a custom condition class.

>
> Duncan Murdoch
>
>>> At the time of an R_ParseVector syntax error, the parser knows what 
>>> token it couldn't handle, and it knows its classification, and the 
>>> location in the file where it came from.   Not all of that makes it 
>>> through to the error message.
>>>    
>>>> As for  reducing complexity - technically, there is no complexity 
>>>> added since  all this is already in place ... [adding extra char * 
>>>> argument to  ParseVector may not be the best way but that's not 
>>>> what I'm arguing  for].         
>>> It was what I was arguing against.
>>>
>>> Duncan Murdoch
>>>
>>>    
>>>> Or am I missing something?
>>>>       Cheers,
>>>> S
>>>>
>>>>
>>>>  
>>>>      
>>>>>> Romain
>>>>>>
>>>>>> Simon Urbanek wrote:
>>>>>>
>>>>>>               
>>>>>>> On Jun 15, 2009, at 12:05 , Romain Francois wrote:
>>>>>>>
>>>>>>>
>>>>>>>                   
>>>>>>>> Hello,
>>>>>>>>
>>>>>>>> In JRI, is there a way to get the error message that is 
>>>>>>>> generated  by the
>>>>>>>> parser through rniParse
>>>>>>>> For example, if I have this :
>>>>>>>>
>>>>>>>> long y = re.rniParse( "rnorm( 10 ))", 1 ) ;
>>>>>>>>
>>>>>>>> this obviously generates a parse error, so y will be the same as
>>>>>>>> (R_NilValue) :
>>>>>>>>
>>>>>>>> long null_id = re.rniEval( re.rniParse( "NULL", 1 ), 0 ) ;
>>>>>>>>
>>>>>>>> I guess the underlying question is : "Is R_ParseErrorMsg 
>>>>>>>> exposed to
>>>>>>>> JRI".
>>>>>>>>
>>>>>>>>                         
>>>>>>> AFAICT R_ParseErrorMsg and friends are not exposed by the R API 
>>>>>>> -  they are not accessible outside, so they cannot be use by 
>>>>>>> JRI. It  would be nice if there was a way of accessing that 
>>>>>>> info, but R  doesn't currently support that.
>>>>>>>
>>>>>>> Cheers,
>>>>>>> Simon
>>>>>>>
>>>>>>>
>>>>>>>                   
>>>>>>>> The reason is I would like to bring back the message as part of an
>>>>>>>> exception generated when the code does not parse.
>>>>>>>>
>>>>>>>> Romain
>>>>>>>>
>>>>>>>>                         
>>>>>>                 
>>>>> ______________________________________________
>>>>> R-devel at r-project.org mailing list
>>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>>
>>>>>
>>>>>             
>>>
>>>     
>>
>>
>>   
>
>
>


-- 
Romain Francois
Independent R Consultant
+33(0) 6 28 91 30 30
http://romainfrancois.blog.free.fr


From Richard.Cotton at hsl.gov.uk  Fri Jun 19 15:10:35 2009
From: Richard.Cotton at hsl.gov.uk (Richard.Cotton at hsl.gov.uk)
Date: Fri, 19 Jun 2009 14:10:35 +0100
Subject: [Rd] RGui Configuration Editor crashes when using an unlisted font
Message-ID: <OF06A2239C.A83A3167-ON802575DA.0046487C-802575DA.0048603F@hsl.gov.uk>

I am using R2.9.0 under Windows XP SP 2 (32-bit).

I just discovered a rather excellent programming font 
(http://www.dafont.com/bitstream-vera-mono.font).  Since it isn't one of 
the fonts listed as an option in the RGui Configuration Editor, I manually 
editted my RConsole file font line to

font = Bitstream Vera Sans Mono

When I opened R, the text in the console displayed correctly, but when I 
tried to open the RGui Configuration Editor (via Edit -> Gui preferences), 
R crashed.

I've repeated this with several other fonts that aren't on the standard 
list of available fonts and the behaviour is reproduced.  I've also 
reproduced the crash on another machine running R2.9.0 and WinXP.

Please can someone check to see if the problem occurs on the development 
build/other operating systems, and I will file a bug report.

Regards,
Richie.

Mathematical Sciences Unit
HSL


------------------------------------------------------------------------
ATTENTION:

This message contains privileged and confidential inform...{{dropped:20}}


From jmc at r-project.org  Fri Jun 19 16:15:28 2009
From: jmc at r-project.org (John Chambers)
Date: Fri, 19 Jun 2009 10:15:28 -0400
Subject: [Rd] validObject throws non-caught error when slot doesn't exist
In-Reply-To: <4A3AD0ED.4030002@fhcrc.org>
References: <4A3AD0ED.4030002@fhcrc.org>
Message-ID: <4A3B9D80.70903@r-project.org>

Patrick,

Thanks for the bug report and the proposed patch.

There are some related ways that validObject can fail (e.g., if the 
revised class definition extends one of the object types or if the 
object is an S3 object), so the patch needs to be a little more general, 
but I will commit something to the 2.10 development version and send mail).

John

Patrick Aboyoun wrote:
> I have been retooling an S4 class definition to include another slot 
> and have found that the methods::validObject function (defined in 
> methods/R/SClasses.R) in R-devel throws an error that isn't caught 
> internally (and thus not controllable by 'test' argument) when 
> retrieving a non-existent slot. The offending line of code is shown 
> below:
>
> > validObject
> function (object, test = FALSE, complete = FALSE)
> {
> ...
>    for (i in seq_along(slotTypes)) {
>        classi <- slotTypes[[i]]
>        sloti <- slot(object, slotNames[[i]]) # offending line of code
>
> One potential patch is to substitute the offending line with
>
>        sloti <- try(slot(object, slotNames[[i]]), silent = TRUE)
>        if (class(sloti) == "try-error") {
>            errors <- c(errors, paste("missing slot \"", slotNames[[i]],
>                "\"", sep = ""))
>            next
>        }
>
> Here is a reproduce and an example using vaildObject2 that substitutes 
> the offending line with the code given above:
>
> > setClass("Foo", representation(bar = "character"))
> [1] "Foo"
> > a <- new("Foo", bar = letters)
> > setClass("Foo", representation(bar = "character", star = "numeric"))
> [1] "Foo"
> > validObject(a, test = TRUE)
> Error in slot(object, slotNames[[i]]) :
>  no slot of name "star" for this object of class "Foo"
> > validObject2(a, test = TRUE)
> [1] "missing slot \"star\""
> > sessionInfo()
> R version 2.10.0 Under development (unstable) (2009-06-12 r48755)
> i386-apple-darwin9.6.0
>
> locale:
> [1] en_US.UTF-8/en_US.UTF-8/C/C/en_US.UTF-8/en_US.UTF-8
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base    
>
>
> Patrick
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From jmc at r-project.org  Fri Jun 19 18:31:48 2009
From: jmc at r-project.org (John Chambers)
Date: Fri, 19 Jun 2009 12:31:48 -0400
Subject: [Rd] validObject throws non-caught error when slot doesn't exist
In-Reply-To: <4A3B9D80.70903@r-project.org>
References: <4A3AD0ED.4030002@fhcrc.org> <4A3B9D80.70903@r-project.org>
Message-ID: <4A3BBD74.9040303@r-project.org>

A fix for this and related problems is now committed (r48803).

Some of the interesting ways that validObject() could fail previously 
are in the attached regression-test file.

John

John Chambers wrote:
> Patrick,
>
> Thanks for the bug report and the proposed patch.
>
> There are some related ways that validObject can fail (e.g., if the 
> revised class definition extends one of the object types or if the 
> object is an S3 object), so the patch needs to be a little more 
> general, but I will commit something to the 2.10 development version 
> and send mail).
>
> John
>
> Patrick Aboyoun wrote:
>> I have been retooling an S4 class definition to include another slot 
>> and have found that the methods::validObject function (defined in 
>> methods/R/SClasses.R) in R-devel throws an error that isn't caught 
>> internally (and thus not controllable by 'test' argument) when 
>> retrieving a non-existent slot. The offending line of code is shown 
>> below:
>>
>> > validObject
>> function (object, test = FALSE, complete = FALSE)
>> {
>> ...
>>    for (i in seq_along(slotTypes)) {
>>        classi <- slotTypes[[i]]
>>        sloti <- slot(object, slotNames[[i]]) # offending line of code
>>
>> One potential patch is to substitute the offending line with
>>
>>        sloti <- try(slot(object, slotNames[[i]]), silent = TRUE)
>>        if (class(sloti) == "try-error") {
>>            errors <- c(errors, paste("missing slot \"", slotNames[[i]],
>>                "\"", sep = ""))
>>            next
>>        }
>>
>> Here is a reproduce and an example using vaildObject2 that 
>> substitutes the offending line with the code given above:
>>
>> > setClass("Foo", representation(bar = "character"))
>> [1] "Foo"
>> > a <- new("Foo", bar = letters)
>> > setClass("Foo", representation(bar = "character", star = "numeric"))
>> [1] "Foo"
>> > validObject(a, test = TRUE)
>> Error in slot(object, slotNames[[i]]) :
>>  no slot of name "star" for this object of class "Foo"
>> > validObject2(a, test = TRUE)
>> [1] "missing slot \"star\""
>> > sessionInfo()
>> R version 2.10.0 Under development (unstable) (2009-06-12 r48755)
>> i386-apple-darwin9.6.0
>>
>> locale:
>> [1] en_US.UTF-8/en_US.UTF-8/C/C/en_US.UTF-8/en_US.UTF-8
>>
>> attached base packages:
>> [1] stats     graphics  grDevices utils     datasets  methods   base   
>>
>> Patrick
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: testValidSlot.R
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090619/1b2bf22f/attachment.pl>

From murdoch at stats.uwo.ca  Sat Jun 20 01:12:23 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Sat, 20 Jun 2009 01:12:23 +0200
Subject: [Rd] Changes to Rd handling in R-devel
Message-ID: <4A3C1B57.4040708@stats.uwo.ca>

I've just committed some fairly big changes to R-devel. 
  - There's a new tag \Sexpr which allows R code to be embedded within 
the Rd file, similar to Sweave,  \RdOpts
    corresponds to \SweaveOpts.
  - The parser now mainly issues warnings, rather than errors, in case 
of syntax errors.  It throws away a few tokens and tries to restart.  
This should let you see most of your errors in one pass, rather than one 
at a time.  (Don't ignore the warnings -- you've lost some of your file 
if you get them!)  (Romain:  yes, this is done using the special "error" 
token in bison.)
  - There are also a number of bug fixes to the rendering code (e.g. 
Rd2HTML).  I'm hoping to switch over soon to the new parser being used 
to produce all man pages.

I need to write up more about \Sexpr, but the basic idea is that the 
format is

\Sexpr{R code}

or

\Sexpr[options]{R code}

Currently the R code is not executed unless you do it manually, but once 
we're using this engine for man pages, you'll be able to choose when to 
execute the code:  build time, install time, or render time.

I hope these changes don't introduce any bugs in old Rd files, but if 
they do, please let me know and I'll fix them.  (Not today; I'll be 
travelling.)

Duncan Murdoch


From h.wickham at gmail.com  Sat Jun 20 03:15:40 2009
From: h.wickham at gmail.com (hadley wickham)
Date: Fri, 19 Jun 2009 20:15:40 -0500
Subject: [Rd] Changes to Rd handling in R-devel
In-Reply-To: <4A3C1B57.4040708@stats.uwo.ca>
References: <4A3C1B57.4040708@stats.uwo.ca>
Message-ID: <f8e6ff050906191815i39753ad3sb62a696cda2680f1@mail.gmail.com>

On Fri, Jun 19, 2009 at 6:12 PM, Duncan Murdoch<murdoch at stats.uwo.ca> wrote:
> I've just committed some fairly big changes to R-devel. ?- There's a new tag
> \Sexpr which allows R code to be embedded within the Rd file, similar to
> Sweave, ?\RdOpts
> ? corresponds to \SweaveOpts.
> ?- The parser now mainly issues warnings, rather than errors, in case of
> syntax errors. ?It throws away a few tokens and tries to restart. ?This
> should let you see most of your errors in one pass, rather than one at a
> time. ?(Don't ignore the warnings -- you've lost some of your file if you
> get them!) ?(Romain: ?yes, this is done using the special "error" token in
> bison.)
> ?- There are also a number of bug fixes to the rendering code (e.g.
> Rd2HTML). ?I'm hoping to switch over soon to the new parser being used to
> produce all man pages.
>
> I need to write up more about \Sexpr, but the basic idea is that the format
> is
>
> \Sexpr{R code}
>
> or
>
> \Sexpr[options]{R code}
>
> Currently the R code is not executed unless you do it manually, but once
> we're using this engine for man pages, you'll be able to choose when to
> execute the code: ?build time, install time, or render time.

Can the R code emit top-level rdoc tags? i.e. could the complete rd
file just be \Sexpr{} ?

Hadley


-- 
http://had.co.nz/


From murdoch at stats.uwo.ca  Sat Jun 20 04:56:43 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Sat, 20 Jun 2009 04:56:43 +0200
Subject: [Rd] Changes to Rd handling in R-devel
In-Reply-To: <f8e6ff050906191815i39753ad3sb62a696cda2680f1@mail.gmail.com>
References: <4A3C1B57.4040708@stats.uwo.ca>
	<f8e6ff050906191815i39753ad3sb62a696cda2680f1@mail.gmail.com>
Message-ID: <4A3C4FEB.2090102@stats.uwo.ca>

hadley wickham wrote:
> On Fri, Jun 19, 2009 at 6:12 PM, Duncan Murdoch<murdoch at stats.uwo.ca> wrote:
>   
>> I've just committed some fairly big changes to R-devel.  - There's a new tag
>> \Sexpr which allows R code to be embedded within the Rd file, similar to
>> Sweave,  \RdOpts
>>   corresponds to \SweaveOpts.
>>  - The parser now mainly issues warnings, rather than errors, in case of
>> syntax errors.  It throws away a few tokens and tries to restart.  This
>> should let you see most of your errors in one pass, rather than one at a
>> time.  (Don't ignore the warnings -- you've lost some of your file if you
>> get them!)  (Romain:  yes, this is done using the special "error" token in
>> bison.)
>>  - There are also a number of bug fixes to the rendering code (e.g.
>> Rd2HTML).  I'm hoping to switch over soon to the new parser being used to
>> produce all man pages.
>>
>> I need to write up more about \Sexpr, but the basic idea is that the format
>> is
>>
>> \Sexpr{R code}
>>
>> or
>>
>> \Sexpr[options]{R code}
>>
>> Currently the R code is not executed unless you do it manually, but once
>> we're using this engine for man pages, you'll be able to choose when to
>> execute the code:  build time, install time, or render time.
>>     
>
> Can the R code emit top-level rdoc tags? i.e. could the complete rd
> file just be \Sexpr{} ?

There are details to be worked out (and bugs to be fixed) as this is 
integrated into the build/install system, but so far I can't think of 
any reason why that would not be possible, as long as the required tags 
(e.g. \alias, \name, \title) were emitted early enough. 

The current plan is that you would use a name like foo.Rdin to indicate 
that you have code to execute before building the tarball, and the build 
system would emit a text .Rd file.  At install time that would be 
converted to a binary representation which is what would be installed, 
and the final conversion to HTML or displayed text or other rendered 
format would happen as late as possible.  (Ideally, this would be fully 
dynamic, doing the conversion when the user asks for help, but that is 
not feasible for all formats, and I'm not sure how much of the final 
implementation will be done before 2.10.0.)

Duncan Murdoch


From rvaradhan at jhmi.edu  Thu Jun 18 16:05:22 2009
From: rvaradhan at jhmi.edu (rvaradhan at jhmi.edu)
Date: Thu, 18 Jun 2009 16:05:22 +0200 (CEST)
Subject: [Rd] Inverting a square... (PR#13762)
Message-ID: <20090618140522.327FE2831FE4@mail.pubhealth.ku.dk>

Yes=2C Peter=2E  I did look at it=2C but not carefully enought to catch =
that=2E

Thanks=2C
Ravi=2E

=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=
=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=
=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F

Ravi Varadhan=2C Ph=2ED=2E
Assistant Professor=2C
Division of Geriatric Medicine and Gerontology
School of Medicine
Johns Hopkins University

Ph=2E (410) 502-2619
email=3A rvaradhan=40jhmi=2Eedu


----- Original Message -----
From=3A Peter Dalgaard =3CP=2EDalgaard=40biostat=2Eku=2Edk=3E
Date=3A Thursday=2C June 18=2C 2009 9=3A15 am
Subject=3A Re=3A =5BRd=5D Inverting a square=2E=2E=2E (PR=2313762)
To=3A rvaradhan=40jhmi=2Eedu
Cc=3A R-bugs=40r-project=2Eorg


=3E Refiling this=2E  The actual fix was slightly more complicated=2E Wi=
ll soon
=3E  be committed to R-Patched (aka 2=2E9=2E1 beta)=2E
=3E  =

=3E  	-p
=3E  =

=3E  rvaradhan=40jhmi=2Eedu wrote=3A
=3E  =3E Full=5FName=3A Ravi Varadhan
=3E  =3E Version=3A 2=2E8=2E1
=3E  =3E OS=3A Windows
=3E  =3E Submission from=3A (NULL) (162=2E129=2E251=2E19)
=3E  =3E =

=3E  =3E =

=3E  =3E Inverting a matrix with solve()=2C but using LAPACK=3DTRUE=2C g=
ives erroneous
=3E  =3E results=3A
=3E  =

=3E  Thanks=2C but there seems to be a much easier fix=2E
=3E  =

=3E  Inside coef=2Eqr=2C we have
=3E  =

=3E  coef=5Bqr=24pivot=2C =5D =3C-
=3E  =2ECall(=22qr=5Fcoef=5Freal=22=2C qr=2C y=2C PACKAGE =3D =22base=22=
)=5Bseq=5Flen(p)=5D
=3E  =

=3E  which should be =5Bseq=5Flen(p)=2C=5D
=3E  =

=3E  (otherwise=2C in the matrix case=2C the RHS will recycle only the 1=
st p
=3E  elements=2C i=2Ee=2E=2C the 1st column)=2E
=3E  =

=3E  =3E =

=3E  =3E Here is an example=3A
=3E  =3E =

=3E  =3E      hilbert =3C- function(n) =7B i =3C- 1=3An=3B 1 / outer(i -=
 1=2C i=2C =22+=22) =7D
=3E  =3E 	h5 =3C- hilbert(5)
=3E  =3E 	hinv1 =3C- solve(qr(h5))
=3E  =3E 	hinv2 =3C- solve(qr(h5=2C LAPACK=3DTRUE))	=

=3E  =3E 	all=2Eequal(hinv1=2C hinv2)  =23 They are not equal
=3E  =3E =

=3E  =3E Here is a function that I wrote to correct this problem=3A
=3E  =3E =

=3E  =3E 	solve=2Elapack =3C- function(A=2C LAPACK=3DTRUE=2C tol=3D1=2Ee=
-07) =7B
=3E  =3E 	=23 A function to invert a matrix using =22LAPACK=22 or =22LIN=
PACK=22
=3E  =3E         if (nrow(A) !=3D ncol(A)) stop(=22Matrix muxt be square=
=22)
=3E  =3E         qrA =3C- qr(A=2C LAPACK=3DLAPACK=2C tol=3Dtol)
=3E  =3E         if (LAPACK) =7B
=3E  =3E 	apply(diag(1=2C ncol(A))=2C 2=2C function(x) solve(qrA=2C x)) =

=3E  =3E         =7D else  solve(qrA)
=3E  =3E 	=7D
=3E  =3E =

=3E  =3E         hinv3 =3C- solve=2Elapack(h5)
=3E  =3E 	all=2Eequal(hinv1=2C hinv3)  =23 Now=2C they are equal
=3E  =3E =

=3E  =3E =5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=
=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=5F=
=5F
=3E  =3E R-devel=40r-project=2Eorg mailing list
=3E  =3E =

=3E  =

=3E  =

=3E  -- =

=3E     O=5F=5F  ---- Peter Dalgaard             =D8ster Farimagsgade 5=2C=
 Entr=2EB
=3E    c/ /=27=5F --- Dept=2E of Biostatistics     PO Box 2099=2C 1014 C=
ph=2E K
=3E   (*) =5C(*) -- University of Copenhagen   Denmark      Ph=3A  (+45)=
 35327918
=3E  =7E=7E=7E=7E=7E=7E=7E=7E=7E=7E - (p=2Edalgaard=40biostat=2Eku=2Edk)=
              FAX=3A (+45) 35327907
=3E  =

=3E


From rbugs09 at kreil.org  Fri Jun 19 13:35:11 2009
From: rbugs09 at kreil.org (rbugs09 at kreil.org)
Date: Fri, 19 Jun 2009 13:35:11 +0200 (CEST)
Subject: [Rd] Floating point precision / guard digits? (PR#13771)
Message-ID: <20090619113511.336752832009@mail.pubhealth.ku.dk>

Full_Name: D Kreil
Version: 2.8.1 and 2.9.0
OS: Debian Linux
Submission from: (NULL) (141.244.140.179)


Group: Accuracy

I understand that most floating point numbers are approximated due to their
binary storage. On the other hand, I thought that modern math CPUs used guard
digits to protect against trivial underflows. Not true?

# integers, no problem
> 1+1+1==3
[1] TRUE
# binary floating point approximation underflows
> .1+.1+.1==.3
[1] FALSE
> .1+.1+.1==.3
[1] FALSE
# binary floating point exact for certain numbers
> .1+.1==.2
[1] TRUE

I know that safe code should not test for quality of floats. Still, is R
underutilizing the power of the underlying hardware?

Grateful for comments,
David.


From maechler at stat.math.ethz.ch  Sat Jun 20 14:31:35 2009
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Sat, 20 Jun 2009 14:31:35 +0200
Subject: [Rd] R-project mailing lists (and SVN) - timeout Sunday 21 June
Message-ID: <19004.54951.107601.981094@cmath-5.math.ethz.ch>

Dear R users,

unfortunately, tomorrow Sunday will be a longish timeout
of our mail services, notably affecting the  
R-<foo> and R-SIG-<bar> mailing lists @r-project.org , i.e.,
hosted by the Stats / Math Department of ETH, stat.math.ethz.ch.

Note that also the svn.r-project.org will suffer from the
timeout.
This should be a  "once in 8 years" event, hopefully, and we are
sorry for any inconvenience.

Well, enjoy Sunday off-work :-)


----------------------------------official-text ------------------

There will be upcoming maintenance work of the central computer services
in our server room :

		Sunday, 21st June, 9 a.m. - 5 p.m. (MEST = GMT+2)

During this time, we have to switch off all of our servers since the main
power supply will be turned off.
Services like email or web will be down.

This interrupt will probably take less than 8 hours. Please check the website

		http://www.math.ethz.ch

As soon as this site is up again, all the servers and dervices should
be back online (within a small delay).

-----------------------------

Martin Maechler,  ETH Zurich
       		  http://stat.ethz.ch/people/maechler
		  Seminar f?r Statistik, ETH Z?rich, SWITZERLAND


From macrakis at alum.mit.edu  Sat Jun 20 14:44:21 2009
From: macrakis at alum.mit.edu (Stavros Macrakis)
Date: Sat, 20 Jun 2009 08:44:21 -0400
Subject: [Rd] Floating point precision / guard digits? (PR#13771)
In-Reply-To: <20090619113511.336752832009@mail.pubhealth.ku.dk>
References: <20090619113511.336752832009@mail.pubhealth.ku.dk>
Message-ID: <8b356f880906200544v5e47505cq33fda38801c9110e@mail.gmail.com>

a) this is not a bug, so this is the wrong list

b) 'underflow' does not mean what you think it means.

c) guard digits and sticky bits do improve rounding behavior, but
floating point will always remain approximate.

d) if it is important to your application to perform exact arithmetic
on rational numbers (and I suspect it is not), you might want to use
that instead of floating-point. But even if implemented in R, most R
calculations cannot use it.

You may want to study up on floating-point arithmetic some more, though.

         -s

On 6/19/09, rbugs09 at kreil.org <rbugs09 at kreil.org> wrote:
> Full_Name: D Kreil
> Version: 2.8.1 and 2.9.0
> OS: Debian Linux
> Submission from: (NULL) (141.244.140.179)
>
>
> Group: Accuracy
>
> I understand that most floating point numbers are approximated due to their
> binary storage. On the other hand, I thought that modern math CPUs used
> guard
> digits to protect against trivial underflows. Not true?
>
> # integers, no problem
>> 1+1+1==3
> [1] TRUE
> # binary floating point approximation underflows
>> .1+.1+.1==.3
> [1] FALSE
>> .1+.1+.1==.3
> [1] FALSE
> # binary floating point exact for certain numbers
>> .1+.1==.2
> [1] TRUE
>
> I know that safe code should not test for quality of floats. Still, is R
> underutilizing the power of the underlying hardware?
>
> Grateful for comments,
> David.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From xieyihui at gmail.com  Sat Jun 20 16:18:43 2009
From: xieyihui at gmail.com (Yihui Xie)
Date: Sat, 20 Jun 2009 22:18:43 +0800
Subject: [Rd] Special characters in Rd example section will cause errors
Message-ID: <89b6b8c90906200718s77f94849lf26d882f13598552@mail.gmail.com>

Hi (Duncan?),

The other day I noticed some characters will cause errors in R CMD
CHECK because of parse_Rd(), and AFAIK, these chars include '%', '{'
and '}'. For example, note the comments in the example section:

%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~%
\name{testfun}
\Rdversion{1.1}
\alias{testfun}
\title{
A Test
}
\description{
A test
}
\usage{
testfun()
}
\value{
NULL
}
\author{
Yihui Xie
}
\examples{
# special characters in comments
# what if a bracket '{' here?
}
\keyword{ misc }
%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~%

## error occurs
> tools:::parse_Rd('testfun.Rd')
Error in tools:::parse_Rd("testfun.Rd") :
  testfun.Rd:23:1: unexpected section header
23: }
24: \keyword
    ^

If I remove the '{', the Rd file can be parsed successfully. When you
put a code line with "%" in it, there will also be an error, e.g. you
put this in the example section

sprintf("%s", letters[1])

and you'll get

> tools:::parse_Rd('testfun.Rd')
Error in tools:::parse_Rd("testfun.Rd") :
  Unexpected end of input (in " quoted string opened at testfun.Rd:23:10)
In addition: Warning message:
In tools:::parse_Rd("testfun.Rd") :
  newline within quoted string at testfun.Rd:24

Rd_parse() will parse the Rd file incorrectly either.

> tools:::Rd_parse('testfun.Rd')
$meta
$meta$aliases
[1] "testfun"

$meta$concepts
character(0)

$meta$keywords
[1] "misc"

$meta$doc_type
character(0)

$meta$encoding
character(0)


$data
                                             vals        tags
1                                         testfun        name
2                                             1.1   Rdversion
3                                      \nA Test\n       title
4                                      \nA test\n description
5                                   \ntestfun()\n       usage
6                                        \nNULL\n       value
7                                   \nYihui Xie\n      author
8 \n# special characters in comments\n# what if '    examples

$rest
         examples
"'? or ''\n\n}\n"


Here is my session info:

> sessionInfo()
R version 2.9.0 (2009-04-17)
i386-pc-mingw32

locale:
LC_COLLATE=English_United States.1252;LC_CTYPE=English_United
States.1252;LC_MONETARY=English_United
States.1252;LC_NUMERIC=C;LC_TIME=English_United States.
1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base
> R.version
               _
platform       i386-pc-mingw32
arch           i386
os             mingw32
system         i386, mingw32
status
major          2
minor          9.0
year           2009
month          04
day            17
svn rev        48333
language       R
version.string R version 2.9.0 (2009-04-17)


Regards,
Yihui
--
Yihui Xie <xieyihui at gmail.com>
Phone: +86-(0)10-82509086 Fax: +86-(0)10-82509086
Mobile: +86-15810805877
Homepage: http://www.yihui.name
School of Statistics, Room 1037, Mingde Main Building,
Renmin University of China, Beijing, 100872, China

From ggrothendieck at gmail.com  Sat Jun 20 16:33:47 2009
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sat, 20 Jun 2009 10:33:47 -0400
Subject: [Rd] Special characters in Rd example section will cause errors
In-Reply-To: <89b6b8c90906200718s77f94849lf26d882f13598552@mail.gmail.com>
References: <89b6b8c90906200718s77f94849lf26d882f13598552@mail.gmail.com>
Message-ID: <971536df0906200733k50c63bbbvb0287bddf5f6ddd0@mail.gmail.com>

I've noticed this as well.  I recently had a % in an Rd file that caused
me problems.

On Sat, Jun 20, 2009 at 10:18 AM, Yihui Xie<xieyihui at gmail.com> wrote:
> Hi (Duncan?),
>
> The other day I noticed some characters will cause errors in R CMD
> CHECK because of parse_Rd(), and AFAIK, these chars include '%', '{'
> and '}'. For example, note the comments in the example section:
>
> %~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~%
> \name{testfun}
> \Rdversion{1.1}
> \alias{testfun}
> \title{
> A Test
> }
> \description{
> A test
> }
> \usage{
> testfun()
> }
> \value{
> NULL
> }
> \author{
> Yihui Xie
> }
> \examples{
> # special characters in comments
> # what if a bracket '{' here?
> }
> \keyword{ misc }
> %~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~%
>
> ## error occurs
>> tools:::parse_Rd('testfun.Rd')
> Error in tools:::parse_Rd("testfun.Rd") :
> ?testfun.Rd:23:1: unexpected section header
> 23: }
> 24: \keyword
> ? ?^
>
> If I remove the '{', the Rd file can be parsed successfully. When you
> put a code line with "%" in it, there will also be an error, e.g. you
> put this in the example section
>
> sprintf("%s", letters[1])
>
> and you'll get
>
>> tools:::parse_Rd('testfun.Rd')
> Error in tools:::parse_Rd("testfun.Rd") :
> ?Unexpected end of input (in " quoted string opened at testfun.Rd:23:10)
> In addition: Warning message:
> In tools:::parse_Rd("testfun.Rd") :
> ?newline within quoted string at testfun.Rd:24
>
> Rd_parse() will parse the Rd file incorrectly either.
>
>> tools:::Rd_parse('testfun.Rd')
> $meta
> $meta$aliases
> [1] "testfun"
>
> $meta$concepts
> character(0)
>
> $meta$keywords
> [1] "misc"
>
> $meta$doc_type
> character(0)
>
> $meta$encoding
> character(0)
>
>
> $data
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? vals ? ? ? ?tags
> 1 ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? testfun ? ? ? ?name
> 2 ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? 1.1 ? Rdversion
> 3 ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?\nA Test\n ? ? ? title
> 4 ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?\nA test\n description
> 5 ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? \ntestfun()\n ? ? ? usage
> 6 ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?\nNULL\n ? ? ? value
> 7 ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? \nYihui Xie\n ? ? ?author
> 8 \n# special characters in comments\n# what if ' ? ?examples
>
> $rest
> ? ? ? ? examples
> "'? or ''\n\n}\n"
>
>
> Here is my session info:
>
>> sessionInfo()
> R version 2.9.0 (2009-04-17)
> i386-pc-mingw32
>
> locale:
> LC_COLLATE=English_United States.1252;LC_CTYPE=English_United
> States.1252;LC_MONETARY=English_United
> States.1252;LC_NUMERIC=C;LC_TIME=English_United States.
> 1252
>
> attached base packages:
> [1] stats ? ? graphics ?grDevices utils ? ? datasets ?methods ? base
>> R.version
> ? ? ? ? ? ? ? _
> platform ? ? ? i386-pc-mingw32
> arch ? ? ? ? ? i386
> os ? ? ? ? ? ? mingw32
> system ? ? ? ? i386, mingw32
> status
> major ? ? ? ? ?2
> minor ? ? ? ? ?9.0
> year ? ? ? ? ? 2009
> month ? ? ? ? ?04
> day ? ? ? ? ? ?17
> svn rev ? ? ? ?48333
> language ? ? ? R
> version.string R version 2.9.0 (2009-04-17)
>
>
> Regards,
> Yihui
> --
> Yihui Xie <xieyihui at gmail.com>
> Phone: +86-(0)10-82509086 Fax: +86-(0)10-82509086
> Mobile: +86-15810805877
> Homepage: http://www.yihui.name
> School of Statistics, Room 1037, Mingde Main Building,
> Renmin University of China, Beijing, 100872, China
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From dpkreil at gmail.com  Sat Jun 20 15:45:58 2009
From: dpkreil at gmail.com (Dr. D. P. Kreil)
Date: Sat, 20 Jun 2009 15:45:58 +0200
Subject: [Rd] Floating point precision / guard digits? (PR#13771)
In-Reply-To: <8b356f880906200544v5e47505cq33fda38801c9110e@mail.gmail.com>
References: <20090619113511.336752832009@mail.pubhealth.ku.dk> 
	<8b356f880906200544v5e47505cq33fda38801c9110e@mail.gmail.com>
Message-ID: <20e578260906200645v79fa0340i37a30b98397ea2cc@mail.gmail.com>

Dear Stavros,

Thank you for your fast reply!

So if I request a calculation of "0.3-0.1-0.1-0.1" and I do not get 0,
that is not an issue of rounding / underflow (or whatever the correct
technical term would be for that behaviour)?

I thought that guard digits would mean that 0.3-0.1*31 should be
calculated in higher precision than the final representation of the
result, i.e., avoiding that this is not equal to 0?

I am sorry if I am not from the field and although I have had some
basic background in numerics that has been more than a decade ago. If
you can suggest an online resource to help me use the right vocabulary
and better understand the fundamental concepts, I am of course
grateful.

Best regards,
David.


2009/6/20 Stavros Macrakis <macrakis at alum.mit.edu>:
> a) this is not a bug, so this is the wrong list
>
> b) 'underflow' does not mean what you think it means.
>
> c) guard digits and sticky bits do improve rounding behavior, but
> floating point will always remain approximate.
>
> d) if it is important to your application to perform exact arithmetic
> on rational numbers (and I suspect it is not), you might want to use
> that instead of floating-point. But even if implemented in R, most R
> calculations cannot use it.
>
> You may want to study up on floating-point arithmetic some more, though.
>
> ? ? ? ? -s
>
> On 6/19/09, rbugs09 at kreil.org <rbugs09 at kreil.org> wrote:
>> Full_Name: D Kreil
>> Version: 2.8.1 and 2.9.0
>> OS: Debian Linux
>> Submission from: (NULL) (141.244.140.179)
>>
>>
>> Group: Accuracy
>>
>> I understand that most floating point numbers are approximated due to their
>> binary storage. On the other hand, I thought that modern math CPUs used
>> guard
>> digits to protect against trivial underflows. Not true?
>>
>> # integers, no problem
>>> 1+1+1==3
>> [1] TRUE
>> # binary floating point approximation underflows
>>> .1+.1+.1==.3
>> [1] FALSE
>>> .1+.1+.1==.3
>> [1] FALSE
>> # binary floating point exact for certain numbers
>>> .1+.1==.2
>> [1] TRUE
>>
>> I know that safe code should not test for quality of floats. Still, is R
>> underutilizing the power of the underlying hardware?
>>
>> Grateful for comments,
>> David.
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>


From hb at stat.berkeley.edu  Sun Jun 21 00:44:24 2009
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Sat, 20 Jun 2009 15:44:24 -0700
Subject: [Rd] Flag '#' in sprintf() format string "%#x"?
Message-ID: <59d7961d0906201544x184e2d4ehd2da3cf66603a3@mail.gmail.com>

Hi, this is a bit of FYI, but also a question.

Is flag '#' in sprintf() format string "%#x" fully supported across
platforms?  Can that be assumed?  I discovered thanks to the r-forge
service, that this was not the case for OSX with "R version 2.9.0
Under development (unstable) (2009-01-13 r47593)", where R CMD check
reports the following:

Error in sprintf("%#x", values) :
  use format %d, %i, %x or %X for integer objects

where values <- as.integer(1:5). Note it works well on other
platforms; I don't know about newer R version on OSX.   Should I
consider this a glitch in an old version of R (newer R version do a
much better validation here), or should I simply avoid '#'?

Thanks,

/Henrik


From marc_schwartz at me.com  Sun Jun 21 01:27:45 2009
From: marc_schwartz at me.com (Marc Schwartz)
Date: Sat, 20 Jun 2009 18:27:45 -0500
Subject: [Rd] Flag '#' in sprintf() format string "%#x"?
In-Reply-To: <59d7961d0906201544x184e2d4ehd2da3cf66603a3@mail.gmail.com>
References: <59d7961d0906201544x184e2d4ehd2da3cf66603a3@mail.gmail.com>
Message-ID: <B307D518-77C8-4A5C-9378-6986B82B3B0E@me.com>


On Jun 20, 2009, at 5:44 PM, Henrik Bengtsson wrote:

> Hi, this is a bit of FYI, but also a question.
>
> Is flag '#' in sprintf() format string "%#x" fully supported across
> platforms?  Can that be assumed?  I discovered thanks to the r-forge
> service, that this was not the case for OSX with "R version 2.9.0
> Under development (unstable) (2009-01-13 r47593)", where R CMD check
> reports the following:
>
> Error in sprintf("%#x", values) :
>  use format %d, %i, %x or %X for integer objects
>
> where values <- as.integer(1:5). Note it works well on other
> platforms; I don't know about newer R version on OSX.   Should I
> consider this a glitch in an old version of R (newer R version do a
> much better validation here), or should I simply avoid '#'?
>
> Thanks,
>
> /Henrik

Henrik,

Using:

R version 2.9.0 Patched (2009-06-05 r48712)

on a fully updated OSX 10.5.7 MacBook Pro:

values <- 1:5

 > sprintf("%#x", values)
[1] "0x1" "0x2" "0x3" "0x4" "0x5"


Note that the as.integer() is not needed, as ':' will return integers  
if both from and to values are integers:

 > str(values)
  int [1:5] 1 2 3 4 5


The only comment that I see in NEWS that may be relevant here for  
2.9.0 is:

     o	sprintf() does stricter error checking on input formats to
	avoid passing invalid formats to the OS (which have a tendency
	to crash under such inputs).


HTH,

Marc Schwartz


From murdoch at stats.uwo.ca  Sun Jun 21 01:49:39 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Sat, 20 Jun 2009 19:49:39 -0400
Subject: [Rd] Special characters in Rd example section will cause errors
In-Reply-To: <89b6b8c90906200718s77f94849lf26d882f13598552@mail.gmail.com>
References: <89b6b8c90906200718s77f94849lf26d882f13598552@mail.gmail.com>
Message-ID: <4A3D7593.1080406@stats.uwo.ca>

On 20/06/2009 10:18 AM, Yihui Xie wrote:
> Hi (Duncan?),
> 
> The other day I noticed some characters will cause errors in R CMD
> CHECK because of parse_Rd(), and AFAIK, these chars include '%', '{'
> and '}'. For example, note the comments in the example section:

This is documented in the reference on the parse_Rd man page.  Since 
yesterday, that document is slightly out of date for R-devel, but it is 
intended to be correct for 2.9.x.  If you notice any behaviour there 
that contradicts the documentation I'd consider it a bug, either in the 
behaviour or the docs.  I'd like to hear about both.  But I don't think 
what you say below contradicts the documented behaviour.

Duncan Murdoch

> 
> %~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~%
> \name{testfun}
> \Rdversion{1.1}
> \alias{testfun}
> \title{
> A Test
> }
> \description{
> A test
> }
> \usage{
> testfun()
> }
> \value{
> NULL
> }
> \author{
> Yihui Xie
> }
> \examples{
> # special characters in comments
> # what if a bracket '{' here?
> }
> \keyword{ misc }
> %~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~%
> 
> ## error occurs
>> tools:::parse_Rd('testfun.Rd')
> Error in tools:::parse_Rd("testfun.Rd") :
>   testfun.Rd:23:1: unexpected section header
> 23: }
> 24: \keyword
>     ^
> 
> If I remove the '{', the Rd file can be parsed successfully. When you
> put a code line with "%" in it, there will also be an error, e.g. you
> put this in the example section
> 
> sprintf("%s", letters[1])
> 
> and you'll get
> 
>> tools:::parse_Rd('testfun.Rd')
> Error in tools:::parse_Rd("testfun.Rd") :
>   Unexpected end of input (in " quoted string opened at testfun.Rd:23:10)
> In addition: Warning message:
> In tools:::parse_Rd("testfun.Rd") :
>   newline within quoted string at testfun.Rd:24
> 
> Rd_parse() will parse the Rd file incorrectly either.
> 
>> tools:::Rd_parse('testfun.Rd')
> $meta
> $meta$aliases
> [1] "testfun"
> 
> $meta$concepts
> character(0)
> 
> $meta$keywords
> [1] "misc"
> 
> $meta$doc_type
> character(0)
> 
> $meta$encoding
> character(0)
> 
> 
> $data
>                                              vals        tags
> 1                                         testfun        name
> 2                                             1.1   Rdversion
> 3                                      \nA Test\n       title
> 4                                      \nA test\n description
> 5                                   \ntestfun()\n       usage
> 6                                        \nNULL\n       value
> 7                                   \nYihui Xie\n      author
> 8 \n# special characters in comments\n# what if '    examples
> 
> $rest
>          examples
> "'? or ''\n\n}\n"
> 
> 
> Here is my session info:
> 
>> sessionInfo()
> R version 2.9.0 (2009-04-17)
> i386-pc-mingw32
> 
> locale:
> LC_COLLATE=English_United States.1252;LC_CTYPE=English_United
> States.1252;LC_MONETARY=English_United
> States.1252;LC_NUMERIC=C;LC_TIME=English_United States.
> 1252
> 
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>> R.version
>                _
> platform       i386-pc-mingw32
> arch           i386
> os             mingw32
> system         i386, mingw32
> status
> major          2
> minor          9.0
> year           2009
> month          04
> day            17
> svn rev        48333
> language       R
> version.string R version 2.9.0 (2009-04-17)
> 
> 
> Regards,
> Yihui
> --
> Yihui Xie <xieyihui at gmail.com>
> Phone: +86-(0)10-82509086 Fax: +86-(0)10-82509086
> Mobile: +86-15810805877
> Homepage: http://www.yihui.name
> School of Statistics, Room 1037, Mingde Main Building,
> Renmin University of China, Beijing, 100872, China
> 
> 
> ------------------------------------------------------------------------
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From gb at stat.umu.se  Sun Jun 21 10:33:13 2009
From: gb at stat.umu.se (=?ISO-8859-1?Q?G=F6ran_Brostr=F6m?=)
Date: Sun, 21 Jun 2009 10:33:13 +0200
Subject: [Rd] Flag '#' in sprintf() format string "%#x"?
In-Reply-To: <B307D518-77C8-4A5C-9378-6986B82B3B0E@me.com>
References: <59d7961d0906201544x184e2d4ehd2da3cf66603a3@mail.gmail.com>
	<B307D518-77C8-4A5C-9378-6986B82B3B0E@me.com>
Message-ID: <4A3DF049.7030209@stat.umu.se>



Marc Schwartz wrote:
> 
> On Jun 20, 2009, at 5:44 PM, Henrik Bengtsson wrote:
> 
>> Hi, this is a bit of FYI, but also a question.
>>
>> Is flag '#' in sprintf() format string "%#x" fully supported across
>> platforms?  Can that be assumed?  I discovered thanks to the r-forge
>> service, that this was not the case for OSX with "R version 2.9.0
>> Under development (unstable) (2009-01-13 r47593)", where R CMD check
>> reports the following:
>>
>> Error in sprintf("%#x", values) :
>>  use format %d, %i, %x or %X for integer objects
>>
>> where values <- as.integer(1:5). Note it works well on other
>> platforms; I don't know about newer R version on OSX.   Should I
>> consider this a glitch in an old version of R (newer R version do a
>> much better validation here), or should I simply avoid '#'?
>>
>> Thanks,
>>
>> /Henrik
> 
> Henrik,
> 
> Using:
> 
> R version 2.9.0 Patched (2009-06-05 r48712)
> 
> on a fully updated OSX 10.5.7 MacBook Pro:
> 
> values <- 1:5
> 
>  > sprintf("%#x", values)
> [1] "0x1" "0x2" "0x3" "0x4" "0x5"
> 
> 
> Note that the as.integer() is not needed, as ':' will return integers if 
> both from and to values are integers:

That is obviously true, but

 > is.integer(1)
 > FALSE


 > is.integer(1:5)
 > TRUE

and, surprisingly,

 > is.integer(1.0:5.2)
 > TRUE

Documentation of ":" says, about 'Value':

"For numeric arguments, a numeric vector.  This will be of type
      'integer' if 'from' and 'to' are both integers and representable
      in the integer type, otherwise of type 'numeric'.

This is true, but not the full truth. Instead it should read

"...This will be of type 'integer' if 'from' is representable in the 
integer type, otherwise of type 'double'"

G?ran
-- 
G?ran Brostr?m               phone: 46 90 786 5223; 46 705 197 507
Department of Statistics     fax: 46 90 786 6614
Ume? University              email: gb at stat.umu.se
SE-90187 Ume?, Sweden        http://tal.stat.umu.se/~gb


From murdoch at stats.uwo.ca  Sun Jun 21 19:17:49 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Sun, 21 Jun 2009 13:17:49 -0400
Subject: [Rd] Changes to Rd handling in R-devel
In-Reply-To: <4A3C1B57.4040708@stats.uwo.ca>
References: <4A3C1B57.4040708@stats.uwo.ca>
Message-ID: <4A3E6B3D.80608@stats.uwo.ca>

On 19/06/2009 7:12 PM, Duncan Murdoch wrote:
> I've just committed some fairly big changes to R-devel. 
>   - There's a new tag \Sexpr which allows R code to be embedded within 
> the Rd file, similar to Sweave,  \RdOpts
>     corresponds to \SweaveOpts.
>   - The parser now mainly issues warnings, rather than errors, in case 
> of syntax errors.  It throws away a few tokens and tries to restart.  
> This should let you see most of your errors in one pass, rather than one 
> at a time.  (Don't ignore the warnings -- you've lost some of your file 
> if you get them!)  (Romain:  yes, this is done using the special "error" 
> token in bison.)
>   - There are also a number of bug fixes to the rendering code (e.g. 
> Rd2HTML).  I'm hoping to switch over soon to the new parser being used 
> to produce all man pages.
> 
> I need to write up more about \Sexpr, 

I've started the writeup, as a new section of the parseRd.pdf file on 
developer.r-project.org.

Duncan Murdoch


but the basic idea is that the
> format is
> 
> \Sexpr{R code}
> 
> or
> 
> \Sexpr[options]{R code}
> 
> Currently the R code is not executed unless you do it manually, but once 
> we're using this engine for man pages, you'll be able to choose when to 
> execute the code:  build time, install time, or render time.
> 
> I hope these changes don't introduce any bugs in old Rd files, but if 
> they do, please let me know and I'll fix them.  (Not today; I'll be 
> travelling.)
> 
> Duncan Murdoch
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From landronimirc at gmail.com  Mon Jun 22 08:31:49 2009
From: landronimirc at gmail.com (Liviu Andronic)
Date: Mon, 22 Jun 2009 08:31:49 +0200
Subject: [Rd] Floating point precision / guard digits? (PR#13771)
In-Reply-To: <20e578260906200645v79fa0340i37a30b98397ea2cc@mail.gmail.com>
References: <20090619113511.336752832009@mail.pubhealth.ku.dk>
	<8b356f880906200544v5e47505cq33fda38801c9110e@mail.gmail.com>
	<20e578260906200645v79fa0340i37a30b98397ea2cc@mail.gmail.com>
Message-ID: <68b1e2610906212331t19cae90fx7f374aadc9bf5479@mail.gmail.com>

On 6/20/09, Dr. D. P. Kreil <dpkreil at gmail.com> wrote:
>  you can suggest an online resource to help me use the right vocabulary
>  and better understand the fundamental concepts, I am of course
>
There is in R the accuracy [1] package. It has a vignette (and paper)
dealing with various computational errors (in R).
Liviu

[1] http://cran.r-project.org/web/packages/accuracy/index.html


From landronimirc at gmail.com  Mon Jun 22 08:35:31 2009
From: landronimirc at gmail.com (landronimirc at gmail.com)
Date: Mon, 22 Jun 2009 08:35:31 +0200 (CEST)
Subject: [Rd] Floating point precision / guard digits? (PR#13771)
Message-ID: <20090622063531.7DAC0283031B@mail.pubhealth.ku.dk>

On 6/20/09, Dr. D. P. Kreil <dpkreil at gmail.com> wrote:
>  you can suggest an online resource to help me use the right vocabulary
>  and better understand the fundamental concepts, I am of course
>
There is in R the accuracy [1] package. It has a vignette (and paper)
dealing with various computational errors (in R).
Liviu

[1] http://cran.r-project.org/web/packages/accuracy/index.html


From charlie at stat.umn.edu  Mon Jun 22 18:49:38 2009
From: charlie at stat.umn.edu (Charles Geyer)
Date: Mon, 22 Jun 2009 11:49:38 -0500
Subject: [Rd] Floating point precision / guard digits? (PR#13771)
In-Reply-To: <mailman.19.1245664806.31869.r-devel@r-project.org>
References: <mailman.19.1245664806.31869.r-devel@r-project.org>
Message-ID: <20090622164938.GA18185@stat.umn.edu>

On Sat, 20 Jun 2009 08:44:21 -0400 Stavros Macrakis <macrakis at alum.mit.edu>
wrote:

> d) if it is important to your application to perform exact arithmetic
> on rational numbers (and I suspect it is not), you might want to use
> that instead of floating-point. But even if implemented in R, most R
> calculations cannot use it.

Just for the record, the contributed package rcdd links the GMP (GNU
multiprecision bignum) library and provides a crude interface, so it
is "implemented in R", although, as you say, "most R calculations cannot
use it".  The rcdd package can do exact linear programming and other
computational geometry operations.

-- 
Charles Geyer
Professor, School of Statistics
University of Minnesota
charlie at stat.umn.edu


From khansen at stat.berkeley.edu  Mon Jun 22 19:11:09 2009
From: khansen at stat.berkeley.edu (Kasper Daniel Hansen)
Date: Mon, 22 Jun 2009 10:11:09 -0700
Subject: [Rd] Floating point precision / guard digits? (PR#13771)
In-Reply-To: <20e578260906200645v79fa0340i37a30b98397ea2cc@mail.gmail.com>
References: <20090619113511.336752832009@mail.pubhealth.ku.dk>
	<8b356f880906200544v5e47505cq33fda38801c9110e@mail.gmail.com>
	<20e578260906200645v79fa0340i37a30b98397ea2cc@mail.gmail.com>
Message-ID: <8B336648-D882-4E5C-9A61-C2ED68C14AC7@stat.berkeley.edu>


On Jun 20, 2009, at 6:45 , Dr. D. P. Kreil wrote:

> I am sorry if I am not from the field and although I have had some
> basic background in numerics that has been more than a decade ago. If
> you can suggest an online resource to help me use the right vocabulary
> and better understand the fundamental concepts, I am of course
> grateful.

Read the R FAQ 7.31. There is a reference there to a document you  
should read.

Kasper


From Troy.Robertson at aad.gov.au  Tue Jun 23 06:53:10 2009
From: Troy.Robertson at aad.gov.au (Troy Robertson)
Date: Tue, 23 Jun 2009 14:53:10 +1000
Subject: [Rd] V2.9.0 changes [Sec=Unclassified]
Message-ID: <42C7503E0B99F248B06BC65E7D2B4E020122C50FB1FD@EX2K7-CCR.AAD.GOV.AU>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090623/458997a0/attachment.pl>

From antonio.fabio at gmail.com  Tue Jun 23 10:21:33 2009
From: antonio.fabio at gmail.com (Antonio, Fabio Di Narzo)
Date: Tue, 23 Jun 2009 10:21:33 +0200
Subject: [Rd] V2.9.0 changes [Sec=Unclassified]
In-Reply-To: <42C7503E0B99F248B06BC65E7D2B4E020122C50FB1FD@EX2K7-CCR.AAD.GOV.AU>
References: <42C7503E0B99F248B06BC65E7D2B4E020122C50FB1FD@EX2K7-CCR.AAD.GOV.AU>
Message-ID: <b0808fdc0906230121n243072fbrd62cbe1614d13b50@mail.gmail.com>

Not a direct answer to your question, but...
You might consider using the R.oo package, from H. Bengtsson. It's
very stable, written in pure R, and cleanly allows you to do
pass-by-reference OO programming, with no tricks.

HTH,
af

2009/6/23 Troy Robertson <Troy.Robertson at aad.gov.au>:
> Hi all,
>
>
>
> Prefix: I am a frustrated Java coder in R.
>
>
>
> I am coding a medium sized ecosystem modelling program in R. ?I have changed to using S4 objects and it has cost me an order of magnitude in execution speed over the functional model. ?I cannot afford this penalty and have found that it is the result of all the passing-by-value of objects.
>
>
>
> I see that you can now safely inherit from environment in V2.9.0.
>
> That got me all excited that I would now be able to pass objects by reference.
>
>
>
> But...
>
> That doesn't seem to be the case.
>
> It only seem that passing an environment which holds the object allows for pass-by-reference and that passing an object which inherits from environment doesn't.
>
> Why is this the case, either an object inherits the properties of its parent or it doesn't.
>
> Has anyone else had a play with this? ?Or have I got it all wrong.
>
>
>
> I tried the below:
>
> -----------------------------------------------------------------------------------------
>
> setClass('foo', representation=representation(stuff='list', bar='numeric'),
>
> ? ? ? ? ? ? ? ? ? ? prototype=list(stuff=list(), bar=0),
>
> ? ? ? ? ? ? ? ? ? ? contains='.environment')
>
>
>
> setGeneric('doit', function(.Object, newfoo='environment') standardGeneric('doit'))
>
>
>
> setMethod('doit', 'foo', function(.Object, newfoo){newfoo at bar <- 10})
>
>
>
> z <- new('foo')
>
>
>
> z at stuff$x <- new('foo')
>
>
>
> doit(z,z at stuff$x)
>
>
>
> z at stuff$x at bar
>
>
>
> [1] 0
>
> ------------------------------------------------------------------------------------------
>
>
>
> Can anyone help with a better way of doing this.
>
> I'm trying to avoid all the indirection of packing and unpacking environments for passing.
>
>
>
>
>
> Thanks heaps
>
>
>
> Troy
>
>
>
>
>
> Troy Robertson
>
> Database and Computing Support Provider
>
> Southern Ocean Ecosystems, ERM/Fish
>
> Australian Antarctic Division
>
> Channel Highway, Kingston 7050
>
> PH: 03 62323571
>
> Troy.Robertson at aad.gov.au
>
>
>
>
> ___________________________________________________________________________
>
> ? ?Australian Antarctic Division - Commonwealth of Australia
> IMPORTANT: This transmission is intended for the addressee only. If you are not the
> intended recipient, you are notified that use or dissemination of this communication is
> strictly prohibited by Commonwealth law. If you have received this transmission in error,
> please notify the sender immediately by e-mail or by telephoning +61 3 6232 3209 and
> DELETE the message.
> ? ? ? ?Visit our web site at http://www.antarctica.gov.au/
> ___________________________________________________________________________
>
> ? ? ? ?[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>



-- 
Antonio, Fabio Di Narzo
Ph.D. student at
Department of Statistical Sciences
University of Bologna, Italy


From dpkreil at gmail.com  Tue Jun 23 03:44:34 2009
From: dpkreil at gmail.com (Dr. D. P. Kreil)
Date: Tue, 23 Jun 2009 03:44:34 +0200
Subject: [Rd] Floating point precision / guard digits? (PR#13771)
In-Reply-To: <68b1e2610906212331t19cae90fx7f374aadc9bf5479@mail.gmail.com>
References: <20090619113511.336752832009@mail.pubhealth.ku.dk> 
	<8b356f880906200544v5e47505cq33fda38801c9110e@mail.gmail.com> 
	<20e578260906200645v79fa0340i37a30b98397ea2cc@mail.gmail.com> 
	<68b1e2610906212331t19cae90fx7f374aadc9bf5479@mail.gmail.com>
Message-ID: <20e578260906221844r838f866m2ef933e5d8cb2f5e@mail.gmail.com>

Dear Liviu,

That's very helpful, thank you!

With best regards,
David

2009/6/22 Liviu Andronic <landronimirc at gmail.com>:
> On 6/20/09, Dr. D. P. Kreil <dpkreil at gmail.com> wrote:
>> ?you can suggest an online resource to help me use the right vocabulary
>> ?and better understand the fundamental concepts, I am of course
>>
> There is in R the accuracy [1] package. It has a vignette (and paper)
> dealing with various computational errors (in R).
> Liviu
>
> [1] http://cran.r-project.org/web/packages/accuracy/index.html
>


From martin.kober at gmail.com  Tue Jun 23 12:48:39 2009
From: martin.kober at gmail.com (Martin Kober)
Date: Tue, 23 Jun 2009 12:48:39 +0200
Subject: [Rd] Accessing an object from the function in its .Data slot?
Message-ID: <116117690906230348m6aca035bo9ea96f7569ed86b7@mail.gmail.com>

I have an S4 object extending "function". Is it there a good way to
access the object (resp. its slots) from within the function in .Data?

If I'm reading help files correctly, it is not possible to overload
'(' (which would be the most elegant solution, I suppose).  I can
enclose the slotted data in the function when it is created, but that
obviously doesn't work when that data changes later on (also it
duplicates the data).

I tried to use the call stack, and this does seem to work:

> setClass("abcd", representation(.Data="function", x="character"))
> a = new("abcd",
>     .Data=function() str( get( as.character( sys.call()[[1]] ), pos=parent.frame() ) ),
>     x="testtxt")
> a()
Formal class 'abcd' [package ".GlobalEnv"] with 2 slots
  ..@ .Data:function (x)
  ..@ x    : chr "testtxt"

That is obviously a not-so-elegant hack, and I'm not sure it works
under all circumstances as I'm not an expert on R's call system.

Is there any better way to achieve this?

Thanks in advance
Martin


From murdoch at stats.uwo.ca  Tue Jun 23 13:36:57 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Tue, 23 Jun 2009 13:36:57 +0200
Subject: [Rd] Accessing an object from the function in its .Data slot?
In-Reply-To: <116117690906230348m6aca035bo9ea96f7569ed86b7@mail.gmail.com>
References: <116117690906230348m6aca035bo9ea96f7569ed86b7@mail.gmail.com>
Message-ID: <4A40BE59.7050804@stats.uwo.ca>

Martin Kober wrote:
> I have an S4 object extending "function". Is it there a good way to
> access the object (resp. its slots) from within the function in .Data?
>   

I don't think so.  That's not really the way the S4 object system is 
designed to work.  If a function needs access to an object, the object 
should be one of the args to the function, or defined in its 
environment.  Where the function happens to be stored is irrelevant.

Duncan Murdoch
> If I'm reading help files correctly, it is not possible to overload
> '(' (which would be the most elegant solution, I suppose).  I can
> enclose the slotted data in the function when it is created, but that
> obviously doesn't work when that data changes later on (also it
> duplicates the data).
>
> I tried to use the call stack, and this does seem to work:
>
>   
>> setClass("abcd", representation(.Data="function", x="character"))
>> a = new("abcd",
>>     .Data=function() str( get( as.character( sys.call()[[1]] ), pos=parent.frame() ) ),
>>     x="testtxt")
>> a()
>>     
> Formal class 'abcd' [package ".GlobalEnv"] with 2 slots
>   ..@ .Data:function (x)
>   ..@ x    : chr "testtxt"
>
> That is obviously a not-so-elegant hack, and I'm not sure it works
> under all circumstances as I'm not an expert on R's call system.
>
> Is there any better way to achieve this?
>
> Thanks in advance
> Martin
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From mtmorgan at fhcrc.org  Tue Jun 23 15:25:22 2009
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Tue, 23 Jun 2009 06:25:22 -0700
Subject: [Rd] V2.9.0 changes [Sec=Unclassified]
In-Reply-To: <42C7503E0B99F248B06BC65E7D2B4E020122C50FB1FD@EX2K7-CCR.AAD.GOV.AU>
References: <42C7503E0B99F248B06BC65E7D2B4E020122C50FB1FD@EX2K7-CCR.AAD.GOV.AU>
Message-ID: <4A40D7C2.7050307@fhcrc.org>

Troy Robertson wrote:
> Hi all,
> 
> 
> 
> Prefix: I am a frustrated Java coder in R.

ah good, if you're frustrated with Java you'll find R very different ;)

> 
> 
> 
> I am coding a medium sized ecosystem modelling program in R.  I have changed to using S4 objects and it has cost me an order of magnitude in execution speed over the functional model.  I cannot afford this penalty and have found that it is the result of all the passing-by-value of objects.
> 
> 
> 
> I see that you can now safely inherit from environment in V2.9.0.
> 
> That got me all excited that I would now be able to pass objects by reference.
> 
> 
> 
> But...
> 
> That doesn't seem to be the case.
> 
> It only seem that passing an environment which holds the object allows for pass-by-reference and that passing an object which inherits from environment doesn't.
> 
> Why is this the case, either an object inherits the properties of its parent or it doesn't.

The object inherits slots from it's parent, and the methods defined on
the parent class. Maybe this example helps?

setClass("Ticker", contains=".environment")

## initialize essential, so each instance gets its own environment
setMethod(initialize, "Ticker",
          function(.Object, ..., .xData=new.env(parent=emptyenv()))
{
    .xData[["count"]] <- 0
    callNextMethod(.Object, ..., .xData=.xData)
})

## tick: increment (private) counter by n
setGeneric("tick", function(reference, n=1L) standardGeneric("tick"),
           signature="reference")

setMethod(tick, "Ticker", function(reference, n=1L) {
    reference[["count"]] <- reference[["count"]] + n
})

## tock: report current value of counter
setGeneric("tock", function(reference) standardGeneric("tock"))

setMethod(tock, "Ticker", function(reference) {
    reference[["count"]]
})

and then

> e <- new("Ticker")
> tock(e)
[1] 0
> tick(e); tick(e, 10); tock(e)
[1] 11
> f <- e
> tock(f); tick(e); tock(f)
[1] 11
[1] 12

The data inside .environment could be structured, too, using S4.
Probably it would be more appropriate to have the environment as a slot,
rather the class that is being extended. And in terms of inherited
'properties', e.g., the "[[" function as defined on environments is
available

> e[["count"]]

Of course I haven't seen your code, but a different interpretation of
your performance issues is that, within the rules of S4, you've chosen
to implement functionality in an inefficient way. So it might be
instructive to step back a bit and try to reformulate your data
structures and methods. This is hard to do.

Martin

> 
> Has anyone else had a play with this?  Or have I got it all wrong.
> 
> 
> 
> I tried the below:
> 
> -----------------------------------------------------------------------------------------
> 
> setClass('foo', representation=representation(stuff='list', bar='numeric'),
> 
>                      prototype=list(stuff=list(), bar=0),
> 
>                      contains='.environment')
> 
> 
> 
> setGeneric('doit', function(.Object, newfoo='environment') standardGeneric('doit'))
> 
> 
> 
> setMethod('doit', 'foo', function(.Object, newfoo){newfoo at bar <- 10})
> 
> 
> 
> z <- new('foo')
> 
> 
> 
> z at stuff$x <- new('foo')
> 
> 
> 
> doit(z,z at stuff$x)
> 
> 
> 
> z at stuff$x at bar
> 
> 
> 
> [1] 0
> 
> ------------------------------------------------------------------------------------------
> 
> 
> 
> Can anyone help with a better way of doing this.
> 
> I'm trying to avoid all the indirection of packing and unpacking environments for passing.
> 
> 
> 
> 
> 
> Thanks heaps
> 
> 
> 
> Troy
> 
> 
> 
> 
> 
> Troy Robertson
> 
> Database and Computing Support Provider
> 
> Southern Ocean Ecosystems, ERM/Fish
> 
> Australian Antarctic Division
> 
> Channel Highway, Kingston 7050
> 
> PH: 03 62323571
> 
> Troy.Robertson at aad.gov.au
> 
> 
> 
> 
> ___________________________________________________________________________
> 
>     Australian Antarctic Division - Commonwealth of Australia
> IMPORTANT: This transmission is intended for the addressee only. If you are not the
> intended recipient, you are notified that use or dissemination of this communication is
> strictly prohibited by Commonwealth law. If you have received this transmission in error,
> please notify the sender immediately by e-mail or by telephoning +61 3 6232 3209 and
> DELETE the message.
>         Visit our web site at http://www.antarctica.gov.au/
> ___________________________________________________________________________
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From mtmorgan at fhcrc.org  Tue Jun 23 15:25:53 2009
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Tue, 23 Jun 2009 06:25:53 -0700
Subject: [Rd] Accessing an object from the function in its .Data slot?
In-Reply-To: <4A40BE59.7050804@stats.uwo.ca>
References: <116117690906230348m6aca035bo9ea96f7569ed86b7@mail.gmail.com>
	<4A40BE59.7050804@stats.uwo.ca>
Message-ID: <4A40D7E1.6050900@fhcrc.org>

Duncan Murdoch wrote:
> Martin Kober wrote:
>> I have an S4 object extending "function". Is it there a good way to
>> access the object (resp. its slots) from within the function in .Data?
>>   
> 
> I don't think so.  That's not really the way the S4 object system is
> designed to work.  If a function needs access to an object, the object
> should be one of the args to the function, or defined in its
> environment.  Where the function happens to be stored is irrelevant.

One variant uses R's lexical scope to maintain state independent of the
S4 object per se, e.g.,

setClass("NthPower",
         representation=representation("function"))

setMethod(initialize, "NthPower", function(.Object, ..., n) {
    callNextMethod(.Object, .Data=function(x) {
        x^n
    }, ...)
})

and then

> twoth <- new("NthPower", n=2)
> tenth <- new("NthPower", n=10)
> twoth(2)
[1] 4
> tenth(2)
[1] 1024

Martin


> Duncan Murdoch
>> If I'm reading help files correctly, it is not possible to overload
>> '(' (which would be the most elegant solution, I suppose).  I can
>> enclose the slotted data in the function when it is created, but that
>> obviously doesn't work when that data changes later on (also it
>> duplicates the data).
>>
>> I tried to use the call stack, and this does seem to work:
>>
>>  
>>> setClass("abcd", representation(.Data="function", x="character"))
>>> a = new("abcd",
>>>     .Data=function() str( get( as.character( sys.call()[[1]] ),
>>> pos=parent.frame() ) ),
>>>     x="testtxt")
>>> a()
>>>     
>> Formal class 'abcd' [package ".GlobalEnv"] with 2 slots
>>   ..@ .Data:function (x)
>>   ..@ x    : chr "testtxt"
>>
>> That is obviously a not-so-elegant hack, and I'm not sure it works
>> under all circumstances as I'm not an expert on R's call system.
>>
>> Is there any better way to achieve this?
>>
>> Thanks in advance
>> Martin
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From luke at stat.uiowa.edu  Tue Jun 23 16:46:37 2009
From: luke at stat.uiowa.edu (luke at stat.uiowa.edu)
Date: Tue, 23 Jun 2009 09:46:37 -0500 (CDT)
Subject: [Rd] Accessing an object from the function in its .Data slot?
In-Reply-To: <4A40BE59.7050804@stats.uwo.ca>
References: <116117690906230348m6aca035bo9ea96f7569ed86b7@mail.gmail.com>
	<4A40BE59.7050804@stats.uwo.ca>
Message-ID: <alpine.LFD.2.00.0906230946110.7161@nokomis.stat.uiowa.edu>

sys.function might be useful.

luke

On Tue, 23 Jun 2009, Duncan Murdoch wrote:

> Martin Kober wrote:
>> I have an S4 object extending "function". Is it there a good way to
>> access the object (resp. its slots) from within the function in .Data?
>> 
>
> I don't think so.  That's not really the way the S4 object system is designed 
> to work.  If a function needs access to an object, the object should be one 
> of the args to the function, or defined in its environment.  Where the 
> function happens to be stored is irrelevant.
>
> Duncan Murdoch
>> If I'm reading help files correctly, it is not possible to overload
>> '(' (which would be the most elegant solution, I suppose).  I can
>> enclose the slotted data in the function when it is created, but that
>> obviously doesn't work when that data changes later on (also it
>> duplicates the data).
>> 
>> I tried to use the call stack, and this does seem to work:
>>
>> 
>>> setClass("abcd", representation(.Data="function", x="character"))
>>> a = new("abcd",
>>>     .Data=function() str( get( as.character( sys.call()[[1]] ), 
>>> pos=parent.frame() ) ),
>>>     x="testtxt")
>>> a()
>>> 
>> Formal class 'abcd' [package ".GlobalEnv"] with 2 slots
>>   ..@ .Data:function (x)
>>   ..@ x    : chr "testtxt"
>> 
>> That is obviously a not-so-elegant hack, and I'm not sure it works
>> under all circumstances as I'm not an expert on R's call system.
>> 
>> Is there any better way to achieve this?
>> 
>> Thanks in advance
>> Martin
>> 
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>> 
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Luke Tierney
Chair, Statistics and Actuarial Science
Ralph E. Wareham Professor of Mathematical Sciences
University of Iowa                  Phone:             319-335-3386
Department of Statistics and        Fax:               319-335-3017
    Actuarial Science
241 Schaeffer Hall                  email:      luke at stat.uiowa.edu
Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu


From macrakis at alum.mit.edu  Tue Jun 23 21:53:30 2009
From: macrakis at alum.mit.edu (Stavros Macrakis)
Date: Tue, 23 Jun 2009 15:53:30 -0400
Subject: [Rd] Documentation/software inconsistency in `:` and seq
Message-ID: <8b356f880906231253q4a4f1d99v3780dc4065a0634c@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090623/eb0b7ea8/attachment.pl>

From khansen at stat.berkeley.edu  Wed Jun 24 07:46:43 2009
From: khansen at stat.berkeley.edu (Kasper Daniel Hansen)
Date: Tue, 23 Jun 2009 22:46:43 -0700
Subject: [Rd] loadNamespace and useDynLib
Message-ID: <AC97AFA9-3CA1-4D31-9E77-E116D44A78C1@stat.berkeley.edu>

I am considering a package with a namespace (Rgraphviz from Bioc). I  
essentially want to have some error handling for loading the dll,  
something like wrapping it into tryCatch or similar (reason: see  
below). Right now I am loading the dynamic libraries by useDynLib in  
my NAMESPACE file. When I look at the code from loadNamespace, I have  
the impression that what I want is impossible (.onLoad and the user  
settable hooks are called after the dynamic libraries have been  
loaded). Is that true? And is the only way to proceed, to not use  
useDynLib in my NAMESPACE file, but instead load the dynamic libraries  
manually in .onLoad?

Reason for my wish: on Windows Rgraphviz links to Graphviz which the  
user needs to install themselves. Unfortunately there are many  
versions of Graphviz and they tend to be incompatible with each other,  
to the extent that certain libraries have been renamed. This has been  
causing a lot of confusion since the Windows binaries have been  
compiled with one specific version, and sometimes the loading of the  
dll itself fails because the libraries have been renamed.... I am  
attempting to inject some kind of helpful error message along the  
lines of "it looks like you did not have version XXX of Graphviz  
installed". For that to happen, I need to do a tryCatch. There is a  
potential similar problem for binaries on OS X (but somewhat fewer  
complaints).

I could see the use for this for other packages that depends on  
external DLLs.

Thanks
Kasper


From Troy.Robertson at aad.gov.au  Wed Jun 24 08:35:29 2009
From: Troy.Robertson at aad.gov.au (Troy Robertson)
Date: Wed, 24 Jun 2009 16:35:29 +1000
Subject: [Rd] V2.9.0 changes [Sec=Unclassified]
In-Reply-To: <b0808fdc0906230121n243072fbrd62cbe1614d13b50@mail.gmail.com>
Message-ID: <42C7503E0B99F248B06BC65E7D2B4E020122C50FB22C@EX2K7-CCR.AAD.GOV.AU>

Yes, I had looked at R.oo, S4 and proto before beginning coding. I had initially assumed that S4 was an enhancement of or replacement to R.oo that was implemented at a lower level and had decided to go with the 'future' of OO in R.

These assumptions were not necessarily correct.

Troy

Troy Robertson
Database and Computing Support Provider
Southern Ocean Ecosystems, ERM/Fish
Australian Antarctic Division
Channel Highway, Kingston 7050
PH: 03 62323571
Troy.Robertson at aad.gov.au


> -----Original Message-----
> From: Antonio, Fabio Di Narzo [mailto:antonio.fabio at gmail.com]
> Sent: Tuesday, 23 June 2009 6:22 PM
> To: Troy Robertson
> Cc: r-devel at R-project.org
> Subject: Re: [Rd] V2.9.0 changes [Sec=Unclassified]
>
> Not a direct answer to your question, but...
> You might consider using the R.oo package, from H. Bengtsson. It's
> very stable, written in pure R, and cleanly allows you to do
> pass-by-reference OO programming, with no tricks.
>
> HTH,
> af
>
> 2009/6/23 Troy Robertson <Troy.Robertson at aad.gov.au>:
> > Hi all,
> >
> >
> >
> > Prefix: I am a frustrated Java coder in R.
> >
> >
> >
> > I am coding a medium sized ecosystem modelling program in R.  I have
> changed to using S4 objects and it has cost me an order of magnitude in
> execution speed over the functional model.  I cannot afford this penalty
> and have found that it is the result of all the passing-by-value of
> objects.
> >
> >
> >
> > I see that you can now safely inherit from environment in V2.9.0.
> >
> > That got me all excited that I would now be able to pass objects by
> reference.
> >
> >
> >
> > But...
> >
> > That doesn't seem to be the case.
> >
> > It only seem that passing an environment which holds the object allows
> for pass-by-reference and that passing an object which inherits from
> environment doesn't.
> >
> > Why is this the case, either an object inherits the properties of its
> parent or it doesn't.
> >
> > Has anyone else had a play with this?  Or have I got it all wrong.
> >
> >
> >
> > I tried the below:
> >
> > ------------------------------------------------------------------------
> -----------------
> >
> > setClass('foo', representation=representation(stuff='list',
> bar='numeric'),
> >
> >                     prototype=list(stuff=list(), bar=0),
> >
> >                     contains='.environment')
> >
> >
> >
> > setGeneric('doit', function(.Object, newfoo='environment')
> standardGeneric('doit'))
> >
> >
> >
> > setMethod('doit', 'foo', function(.Object, newfoo){newfoo at bar <- 10})
> >
> >
> >
> > z <- new('foo')
> >
> >
> >
> > z at stuff$x <- new('foo')
> >
> >
> >
> > doit(z,z at stuff$x)
> >
> >
> >
> > z at stuff$x at bar
> >
> >
> >
> > [1] 0
> >
> > ------------------------------------------------------------------------
> ------------------
> >
> >
> >
> > Can anyone help with a better way of doing this.
> >
> > I'm trying to avoid all the indirection of packing and unpacking
> environments for passing.
> >
> >
> >
> >
> >
> > Thanks heaps
> >
> >
> >
> > Troy
> >
> >
> >
> >
> >
> > Troy Robertson
> >
> > Database and Computing Support Provider
> >
> > Southern Ocean Ecosystems, ERM/Fish
> >
> > Australian Antarctic Division
> >
> > Channel Highway, Kingston 7050
> >
> > PH: 03 62323571
> >
> > Troy.Robertson at aad.gov.au
> >
> >
> >
> >
> >
> __________________________________________________________________________
> _
> >
> >    Australian Antarctic Division - Commonwealth of Australia
> > IMPORTANT: This transmission is intended for the addressee only. If you
> are not the
> > intended recipient, you are notified that use or dissemination of this
> communication is
> > strictly prohibited by Commonwealth law. If you have received this
> transmission in error,
> > please notify the sender immediately by e-mail or by telephoning +61 3
> 6232 3209 and
> > DELETE the message.
> >        Visit our web site at http://www.antarctica.gov.au/
> >
> __________________________________________________________________________
> _
> >
> >        [[alternative HTML version deleted]]
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >
>
>
>
> --
> Antonio, Fabio Di Narzo
> Ph.D. student at
> Department of Statistical Sciences
> University of Bologna, Italy
___________________________________________________________________________

    Australian Antarctic Division - Commonwealth of Australia
IMPORTANT: This transmission is intended for the addressee only. If you are not the
intended recipient, you are notified that use or dissemination of this communication is
strictly prohibited by Commonwealth law. If you have received this transmission in error,
please notify the sender immediately by e-mail or by telephoning +61 3 6232 3209 and
DELETE the message.
        Visit our web site at http://www.antarctica.gov.au/
___________________________________________________________________________


From Troy.Robertson at aad.gov.au  Wed Jun 24 09:15:47 2009
From: Troy.Robertson at aad.gov.au (Troy Robertson)
Date: Wed, 24 Jun 2009 17:15:47 +1000
Subject: [Rd] V2.9.0 changes [Sec=Unclassified]
In-Reply-To: <4A40D7C2.7050307@fhcrc.org>
Message-ID: <42C7503E0B99F248B06BC65E7D2B4E020122C50FB22F@EX2K7-CCR.AAD.GOV.AU>

Thanks Martin,

Yes I can see that a slot can be initialised as an environment, and data stored within that environment but it seems to then require an additional layer of indirection to access data members within the environment and negates the use of slots in the first place.

The same goes for the "[[" function which works on an object which extends environment as I would expect slots within that object to work (but don't), eg allowing a pass-by-reference arrangement.

I hadn't encountered the use of .xdata as you demonstrated below and think I can work with this way of assigning data members to an S4 object, allowing for a pass-by-reference mechanism.  It just seems to negate the point of providing a slot mechanism for objects.

As for stepping back and re-thinking the way I am implementing my data structures and methods.  It is difficult coming from one way of coding in a different language.  It's easy to try and enforce that way of doing things on the new language.  Can you point me to any examples of general programming using S4 that I could use to change my way of thinking about the problem?

I will have a play around more tomorrow.

Cheers

Troy

> -----Original Message-----
> From: Martin Morgan [mailto:mtmorgan at fhcrc.org]
> Sent: Tuesday, 23 June 2009 11:25 PM
> To: Troy Robertson
> Cc: 'r-devel at R-project.org'
> Subject: Re: [Rd] V2.9.0 changes [Sec=Unclassified]
>
> Troy Robertson wrote:
> > Hi all,
> >
> >
> >
> > Prefix: I am a frustrated Java coder in R.
>
> ah good, if you're frustrated with Java you'll find R very different ;)
>
> >
> >
> >
> > I am coding a medium sized ecosystem modelling program in R.  I have
> changed to using S4 objects and it has cost me an order of magnitude in
> execution speed over the functional model.  I cannot afford this penalty
> and have found that it is the result of all the passing-by-value of
> objects.
> >
> >
> >
> > I see that you can now safely inherit from environment in V2.9.0.
> >
> > That got me all excited that I would now be able to pass objects by
> reference.
> >
> >
> >
> > But...
> >
> > That doesn't seem to be the case.
> >
> > It only seem that passing an environment which holds the object allows
> for pass-by-reference and that passing an object which inherits from
> environment doesn't.
> >
> > Why is this the case, either an object inherits the properties of its
> parent or it doesn't.
>
> The object inherits slots from it's parent, and the methods defined on
> the parent class. Maybe this example helps?
>
> setClass("Ticker", contains=".environment")
>
> ## initialize essential, so each instance gets its own environment
> setMethod(initialize, "Ticker",
>           function(.Object, ..., .xData=new.env(parent=emptyenv()))
> {
>     .xData[["count"]] <- 0
>     callNextMethod(.Object, ..., .xData=.xData)
> })
>
> ## tick: increment (private) counter by n
> setGeneric("tick", function(reference, n=1L) standardGeneric("tick"),
>            signature="reference")
>
> setMethod(tick, "Ticker", function(reference, n=1L) {
>     reference[["count"]] <- reference[["count"]] + n
> })
>
> ## tock: report current value of counter
> setGeneric("tock", function(reference) standardGeneric("tock"))
>
> setMethod(tock, "Ticker", function(reference) {
>     reference[["count"]]
> })
>
> and then
>
> > e <- new("Ticker")
> > tock(e)
> [1] 0
> > tick(e); tick(e, 10); tock(e)
> [1] 11
> > f <- e
> > tock(f); tick(e); tock(f)
> [1] 11
> [1] 12
>
> The data inside .environment could be structured, too, using S4.
> Probably it would be more appropriate to have the environment as a slot,
> rather the class that is being extended. And in terms of inherited
> 'properties', e.g., the "[[" function as defined on environments is
> available
>
> > e[["count"]]
>
> Of course I haven't seen your code, but a different interpretation of
> your performance issues is that, within the rules of S4, you've chosen
> to implement functionality in an inefficient way. So it might be
> instructive to step back a bit and try to reformulate your data
> structures and methods. This is hard to do.
>
> Martin
>
> >
> > Has anyone else had a play with this?  Or have I got it all wrong.
> >
> >
> >
> > I tried the below:
> >
> > ------------------------------------------------------------------------
> -----------------
> >
> > setClass('foo', representation=representation(stuff='list',
> bar='numeric'),
> >
> >                      prototype=list(stuff=list(), bar=0),
> >
> >                      contains='.environment')
> >
> >
> >
> > setGeneric('doit', function(.Object, newfoo='environment')
> standardGeneric('doit'))
> >
> >
> >
> > setMethod('doit', 'foo', function(.Object, newfoo){newfoo at bar <- 10})
> >
> >
> >
> > z <- new('foo')
> >
> >
> >
> > z at stuff$x <- new('foo')
> >
> >
> >
> > doit(z,z at stuff$x)
> >
> >
> >
> > z at stuff$x at bar
> >
> >
> >
> > [1] 0
> >
> > ------------------------------------------------------------------------
> ------------------
> >
> >
> >
> > Can anyone help with a better way of doing this.
> >
> > I'm trying to avoid all the indirection of packing and unpacking
> environments for passing.
> >
> >
> >
> >
> >
> > Thanks heaps
> >
> >
> >
> > Troy
> >
> >
> >
> >
> >
> > Troy Robertson
> >
> > Database and Computing Support Provider
> >
> > Southern Ocean Ecosystems, ERM/Fish
> >
> > Australian Antarctic Division
> >
> > Channel Highway, Kingston 7050
> >
> > PH: 03 62323571
> >
> > Troy.Robertson at aad.gov.au
> >
> >
> >
> >
> >
> __________________________________________________________________________
> _
> >
> >     Australian Antarctic Division - Commonwealth of Australia
> > IMPORTANT: This transmission is intended for the addressee only. If you
> are not the
> > intended recipient, you are notified that use or dissemination of this
> communication is
> > strictly prohibited by Commonwealth law. If you have received this
> transmission in error,
> > please notify the sender immediately by e-mail or by telephoning +61 3
> 6232 3209 and
> > DELETE the message.
> >         Visit our web site at http://www.antarctica.gov.au/
> >
> __________________________________________________________________________
> _
> >
> >       [[alternative HTML version deleted]]
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel

___________________________________________________________________________

    Australian Antarctic Division - Commonwealth of Australia
IMPORTANT: This transmission is intended for the addressee only. If you are not the
intended recipient, you are notified that use or dissemination of this communication is
strictly prohibited by Commonwealth law. If you have received this transmission in error,
please notify the sender immediately by e-mail or by telephoning +61 3 6232 3209 and
DELETE the message.
        Visit our web site at http://www.antarctica.gov.au/
___________________________________________________________________________


From maechler at stat.math.ethz.ch  Wed Jun 24 10:27:09 2009
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Wed, 24 Jun 2009 10:27:09 +0200
Subject: [Rd] V2.9.0 changes [Sec=Unclassified]
In-Reply-To: <42C7503E0B99F248B06BC65E7D2B4E020122C50FB22C@EX2K7-CCR.AAD.GOV.AU>
References: <b0808fdc0906230121n243072fbrd62cbe1614d13b50@mail.gmail.com>
	<42C7503E0B99F248B06BC65E7D2B4E020122C50FB22C@EX2K7-CCR.AAD.GOV.AU>
Message-ID: <19009.58205.475035.852783@lynne.math.ethz.ch>

>>>>> "TR" == Troy Robertson <Troy.Robertson at aad.gov.au>
>>>>>     on Wed, 24 Jun 2009 16:35:29 +1000 writes:

    TR> Yes, I had looked at R.oo, S4 and proto before beginning coding. I had initially assumed that S4 was an enhancement of or replacement to R.oo that was implemented at a lower level and had decided to go with the 'future' of OO in R.
    TR> These assumptions were not necessarily correct.

>From the view of the R core team,  
S4  *is* ``the future of OO in R''

But then, as professional statisticians, we should consider the
famous
   >>> Prediction is very difficult, especially about the future <<
attributed to Physics Nobel Prize winner Niels Bohr.

---

Martin Maechler, ETH Zurich & R-core


    TR> Troy

    TR> Troy Robertson
    TR> Database and Computing Support Provider
    TR> Southern Ocean Ecosystems, ERM/Fish
    TR> Australian Antarctic Division
    TR> Channel Highway, Kingston 7050
    TR> PH: 03 62323571
    TR> Troy.Robertson at aad.gov.au


    >> -----Original Message-----
    >> From: Antonio, Fabio Di Narzo [mailto:antonio.fabio at gmail.com]
    >> Sent: Tuesday, 23 June 2009 6:22 PM
    >> To: Troy Robertson
    >> Cc: r-devel at R-project.org
    >> Subject: Re: [Rd] V2.9.0 changes [Sec=Unclassified]
    >> 
    >> Not a direct answer to your question, but...
    >> You might consider using the R.oo package, from H. Bengtsson. It's
    >> very stable, written in pure R, and cleanly allows you to do
    >> pass-by-reference OO programming, with no tricks.
    >> 
    >> HTH,
    >> af
    >> 
    >> 2009/6/23 Troy Robertson <Troy.Robertson at aad.gov.au>:
    >> > Hi all,
    >> >
    >> >
    >> >
    >> > Prefix: I am a frustrated Java coder in R.
    >> >
    >> >
    >> >
    >> > I am coding a medium sized ecosystem modelling program in R.  I have
    >> changed to using S4 objects and it has cost me an order of magnitude in
    >> execution speed over the functional model.  I cannot afford this penalty
    >> and have found that it is the result of all the passing-by-value of
    >> objects.
    >> >
    >> >
    >> >
    >> > I see that you can now safely inherit from environment in V2.9.0.
    >> >
    >> > That got me all excited that I would now be able to pass objects by
    >> reference.
    >> >
    >> >
    >> >
    >> > But...
    >> >
    >> > That doesn't seem to be the case.
    >> >
    >> > It only seem that passing an environment which holds the object allows
    >> for pass-by-reference and that passing an object which inherits from
    >> environment doesn't.
    >> >
    >> > Why is this the case, either an object inherits the properties of its
    >> parent or it doesn't.
    >> >
    >> > Has anyone else had a play with this?  Or have I got it all wrong.
    >> >
    >> >
    >> >
    >> > I tried the below:
    >> >
    >> > ------------------------------------------------------------------------
    >> -----------------
    >> >
    >> > setClass('foo', representation=representation(stuff='list',
    >> bar='numeric'),
    >> >
    >> >                     prototype=list(stuff=list(), bar=0),
    >> >
    >> >                     contains='.environment')
    >> >
    >> >
    >> >
    >> > setGeneric('doit', function(.Object, newfoo='environment')
    >> standardGeneric('doit'))
    >> >
    >> >
    >> >
    >> > setMethod('doit', 'foo', function(.Object, newfoo){newfoo at bar <- 10})
    >> >
    >> >
    >> >
    >> > z <- new('foo')
    >> >
    >> >
    >> >
    >> > z at stuff$x <- new('foo')
    >> >
    >> >
    >> >
    >> > doit(z,z at stuff$x)
    >> >
    >> >
    >> >
    >> > z at stuff$x at bar
    >> >
    >> >
    >> >
    >> > [1] 0
    >> >
    >> > ------------------------------------------------------------------------
    >> ------------------
    >> >
    >> >
    >> >
    >> > Can anyone help with a better way of doing this.
    >> >
    >> > I'm trying to avoid all the indirection of packing and unpacking
    >> environments for passing.
    >> >
    >> >
    >> >
    >> >
    >> >
    >> > Thanks heaps
    >> >
    >> > Troy
    >> >

    ..............


    >> --
    >> Antonio, Fabio Di Narzo
    >> Ph.D. student at
    >> Department of Statistical Sciences
    >> University of Bologna, Italy
    TR> ___________________________________________________________________________


From maechler at stat.math.ethz.ch  Wed Jun 24 11:28:06 2009
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Wed, 24 Jun 2009 11:28:06 +0200
Subject: [Rd] Documentation/software inconsistency in `:` and seq
In-Reply-To: <8b356f880906231253q4a4f1d99v3780dc4065a0634c@mail.gmail.com>
References: <8b356f880906231253q4a4f1d99v3780dc4065a0634c@mail.gmail.com>
Message-ID: <19009.61862.978759.611834@lynne.math.ethz.ch>

Hi Stavros,

>>>>> "SM" == Stavros Macrakis <macrakis at alum.mit.edu>
>>>>>     on Tue, 23 Jun 2009 15:53:30 -0400 writes:

    SM> In 2.8.1/Windows:
    SM> According to ? :

    SM> Details:
    SM> For numeric arguments 'from:to' is equivalent to 'seq(from, to)' ...

that *is* definitely true as    seq(from,to)  leads to  return(from:to)

    SM> Value:
    SM> For numeric arguments, a numeric vector.  This will be of type
    SM> 'integer' if 'from' and 'to' are both integers and representable
    SM> in the integer type, otherwise of type 'numeric'....

    SM> The first claim is inconsistent with the second; it appears that the first
    SM> one is true and the second is false.

{1st, 2nd ... where do you start counting ?}

    SM> Actual behavior:

    SM> storage.mode(1:2.5) => integer
    SM> storage.mode(`:`(from=1L,to=2.5)) => integer   # just to be completely
    SM> explicit

    SM> But of course 2.5 is not an integer or equal to one.

Interestingly, because of an earlier posting on the topic,
two days ago (*), I have fixed the help page (and very slightly also
the code) of ":"  

[for R-devel (to be 2.10.0 in October) only, because R 2.9.1
 has already been in pre-release feature deep freeze ].


    SM> This is the same behavior as seq:

    SM> storage.mode(seq(1,2.5)) => integer
    SM> storage.mode(seq(from=1L,to=2.5)) => integer

{of course, as I mentioned above}

    SM> ---------------------------------

    SM> On the other hand, according to ? seq

    SM> Currently, the default method returns a result of type '"integer"'
    SM> if 'from' is (numerically equal to an) integer

    SM> This is not correct:

Yes, seq(from, to)  {without further arguments} and "default"
'from', indeed returns from:to
and hence should probably either defer to the ":" help page
or copy-paste from it.


Martin Maechler, ETH Zurich

--------------------------------------------
(*)
------------------------------------------------------------------------
r48823 | maechler | 2009-06-22 17:57:05 +0200 (Mon, 22 Jun 2009)
Improve doc of ":" {and code very slightly, at the boundary of MAX_INT}
------------------------------------------------------------------------



    >> seq(1e16,1e16+10)
    SM> [1] 1e+16 1e+16 1e+16 1e+16 1e+16 1e+16 1e+16 1e+16 1e+16 1e+16 1e+16
    >> seq(1e16,1e16+10)-1e16
    SM> [1]  0  0  2  4  4  4  6  8  8  8 10   # not enough precision to represent
    SM> all the distinct integers, OK
    >> storage.mode(seq(1e16,1e16+10))
    SM> [1] "double"

    SM> In this case, the ? : documentation is correct:

    SM> This will be of type 'integer' if ... representable in the integer
    SM> type, otherwise of type 'numeric'.

    SM> [[alternative HTML version deleted]]
    	^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

  {I'm amazed that you still did not find out how to avoid the
   above, e.g., by following the posting guide ...}

    SM> ______________________________________________
    SM> R-devel at r-project.org mailing list
    SM> https://stat.ethz.ch/mailman/listinfo/r-devel


From P.Dalgaard at biostat.ku.dk  Wed Jun 24 11:40:26 2009
From: P.Dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Wed, 24 Jun 2009 11:40:26 +0200
Subject: [Rd] V2.9.0 changes [Sec=Unclassified]
In-Reply-To: <19009.58205.475035.852783@lynne.math.ethz.ch>
References: <b0808fdc0906230121n243072fbrd62cbe1614d13b50@mail.gmail.com>	<42C7503E0B99F248B06BC65E7D2B4E020122C50FB22C@EX2K7-CCR.AAD.GOV.AU>
	<19009.58205.475035.852783@lynne.math.ethz.ch>
Message-ID: <4A41F48A.4080504@biostat.ku.dk>

Martin Maechler wrote:
>
> But then, as professional statisticians, we should consider the
> famous
>    >>> Prediction is very difficult, especially about the future <<
> attributed to Physics Nobel Prize winner Niels Bohr.

...and quotations are even more difficult!

A number of people are known NOT to be the source of that one, including
Bohr, Robert Storm Petersen, and former minister of culture Steincke (in
his memoirs, he mentions it being used in parliament some time during
1935--1939, but he forgot by whom). One source has "Markus M. Ronner,
and others" (he was born in 1938, though!)

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907


From ligges at statistik.tu-dortmund.de  Wed Jun 24 12:05:52 2009
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Wed, 24 Jun 2009 12:05:52 +0200
Subject: [Rd] loadNamespace and useDynLib
In-Reply-To: <AC97AFA9-3CA1-4D31-9E77-E116D44A78C1@stat.berkeley.edu>
References: <AC97AFA9-3CA1-4D31-9E77-E116D44A78C1@stat.berkeley.edu>
Message-ID: <4A41FA80.3060805@statistik.tu-dortmund.de>



Kasper Daniel Hansen wrote:
> I am considering a package with a namespace (Rgraphviz from Bioc). I 
> essentially want to have some error handling for loading the dll, 
> something like wrapping it into tryCatch or similar (reason: see below). 
> Right now I am loading the dynamic libraries by useDynLib in my 
> NAMESPACE file. When I look at the code from loadNamespace, I have the 
> impression that what I want is impossible (.onLoad and the user settable 
> hooks are called after the dynamic libraries have been loaded). Is that 
> true? And is the only way to proceed, to not use useDynLib in my 
> NAMESPACE file, but instead load the dynamic libraries manually in .onLoad?
> 
> Reason for my wish: on Windows Rgraphviz links to Graphviz which the 
> user needs to install themselves. Unfortunately there are many versions 
> of Graphviz and they tend to be incompatible with each other, to the 
> extent that certain libraries have been renamed. This has been causing a 
> lot of confusion since the Windows binaries have been compiled with one 
> specific version, and sometimes the loading of the dll itself fails 
> because the libraries have been renamed.... I am attempting to inject 
> some kind of helpful error message along the lines of "it looks like you 
> did not have version XXX of Graphviz installed". For that to happen, I 
> need to do a tryCatch. There is a potential similar problem for binaries 
> on OS X (but somewhat fewer complaints).


At first, I do not answer your question, but make your request more 
complicated:

It is even hard to find "version XXX of Graphviz", because the numbers 
in the names of the distributed graphviz zip files and the actual 
versions of graphviz are also not always the same. Beside that the 
graphviz folks obviously even change API specifications in patch-level 
releases.

Then to your question: I think your are right and need it in .onLoad 
where you can finally check if the dll has been loaded and generate erro 
messages.

Good luck,
Uwe



> I could see the use for this for other packages that depends on external 
> DLLs.
> 
> Thanks
> Kasper
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From ggrothendieck at gmail.com  Wed Jun 24 12:39:06 2009
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Wed, 24 Jun 2009 06:39:06 -0400
Subject: [Rd] loadNamespace and useDynLib
In-Reply-To: <AC97AFA9-3CA1-4D31-9E77-E116D44A78C1@stat.berkeley.edu>
References: <AC97AFA9-3CA1-4D31-9E77-E116D44A78C1@stat.berkeley.edu>
Message-ID: <971536df0906240339v74f87838n166fe96e3dcdc89d@mail.gmail.com>

I've also experienced this problem with RGraphviz and suggest you expand
the message to: Graphviz version x found at c:\...whatever...\graphviz.dll
but version y found at http://whatever required.

Another approach would be to check that the file size, file name,
checksum or some other attribute of the needed
version matches the version found.  That way you could give the
error message before loading the dll.

A third approach would be to provide an R command that downloads
and installs the correct version of graphviz to reduce the possibility
of error in the first place.  The user must be connected
to the internet for that to work.  For example, in Ryacas, if yacas
itself is not located when the package loads a message is given
to run the command:
  yacasInstall()
Running that command from within R downloads the correct yacas*.zip file,
unpacks it and installs the components.  See:

http://ryacas.googlecode.com/svn/trunk/R/yacasInstall.R
http://ryacas.googlecode.com/svn/trunk/man/yacasInstall.Rd

That won't prevent the wrong version from being used but it makes
it much less likely.

On Wed, Jun 24, 2009 at 1:46 AM, Kasper Daniel
Hansen<khansen at stat.berkeley.edu> wrote:
> I am considering a package with a namespace (Rgraphviz from Bioc). I
> essentially want to have some error handling for loading the dll, something
> like wrapping it into tryCatch or similar (reason: see below). Right now I
> am loading the dynamic libraries by useDynLib in my NAMESPACE file. When I
> look at the code from loadNamespace, I have the impression that what I want
> is impossible (.onLoad and the user settable hooks are called after the
> dynamic libraries have been loaded). Is that true? And is the only way to
> proceed, to not use useDynLib in my NAMESPACE file, but instead load the
> dynamic libraries manually in .onLoad?
>
> Reason for my wish: on Windows Rgraphviz links to Graphviz which the user
> needs to install themselves. Unfortunately there are many versions of
> Graphviz and they tend to be incompatible with each other, to the extent
> that certain libraries have been renamed. This has been causing a lot of
> confusion since the Windows binaries have been compiled with one specific
> version, and sometimes the loading of the dll itself fails because the
> libraries have been renamed.... I am attempting to inject some kind of
> helpful error message along the lines of "it looks like you did not have
> version XXX of Graphviz installed". For that to happen, I need to do a
> tryCatch. There is a potential similar problem for binaries on OS X (but
> somewhat fewer complaints).
>
> I could see the use for this for other packages that depends on external
> DLLs.
>
> Thanks
> Kasper
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From krcoombes at mdacc.tmc.edu  Wed Jun 24 15:46:11 2009
From: krcoombes at mdacc.tmc.edu (Kevin R. Coombes)
Date: Wed, 24 Jun 2009 08:46:11 -0500
Subject: [Rd] Quotations (was Re:  V2.9.0 changes [Sec=Unclassified])
In-Reply-To: <4A41F48A.4080504@biostat.ku.dk>
References: <b0808fdc0906230121n243072fbrd62cbe1614d13b50@mail.gmail.com>	<42C7503E0B99F248B06BC65E7D2B4E020122C50FB22C@EX2K7-CCR.AAD.GOV.AU>	<19009.58205.475035.852783@lynne.math.ethz.ch>
	<4A41F48A.4080504@biostat.ku.dk>
Message-ID: <4A422E23.80204@mdacc.tmc.edu>

Also attributed (incorrectly) to both Yogi Berra and Mark Twain.  The 
Twain attribution leads (because he published numerous essays and short 
stories in The Galaxy magazine) to one possible (and documentable) source:

   "[I]f we found a character in a novel represented as habitually
    uttering true predictions of the future, we should cry out at once
    against the improbability."
       ? Charles Astor Bristed (aka Carl Benson), Casual Cogitations,
          The Galaxy, 1873; 16:196?201.



Peter Dalgaard wrote:
> Martin Maechler wrote:
>   
>> But then, as professional statisticians, we should consider the
>> famous
>>    >>> Prediction is very difficult, especially about the future <<
>> attributed to Physics Nobel Prize winner Niels Bohr.
>>     
>
> ...and quotations are even more difficult!
>
> A number of people are known NOT to be the source of that one, including
> Bohr, Robert Storm Petersen, and former minister of culture Steincke (in
> his memoirs, he mentions it being used in parliament some time during
> 1935--1939, but he forgot by whom). One source has "Markus M. Ronner,
> and others" (he was born in 1938, though!)
>
>


From macrakis at alum.mit.edu  Wed Jun 24 16:34:32 2009
From: macrakis at alum.mit.edu (Stavros Macrakis)
Date: Wed, 24 Jun 2009 10:34:32 -0400
Subject: [Rd] Documentation/software inconsistency in `:` and seq
In-Reply-To: <19009.61862.978759.611834@lynne.math.ethz.ch>
References: <8b356f880906231253q4a4f1d99v3780dc4065a0634c@mail.gmail.com>
	<19009.61862.978759.611834@lynne.math.ethz.ch>
Message-ID: <8b356f880906240734l78b0d477q4b275b2b83067667@mail.gmail.com>

On Wed, Jun 24, 2009 at 5:28 AM, Martin Maechler
<maechler at stat.math.ethz.ch> wrote:
>
> ?? SM> But of course 2.5 is not an integer or equal to one.
>
> Interestingly, because of an earlier posting on the topic,
> two days ago (*), I have fixed the help page (and very slightly also
> the code) of ":"

Sorry for the redundant report -- I don't remember that post.

>
> ? ?SM> Currently, the default method returns a result of type '"integer"'
> ? ?SM> if 'from' is (numerically equal to an) integer
>
> ? ?SM> This is not correct:
>
> Yes, seq(from, to) ?{without further arguments} and "default"? 'from', indeed returns from:to
> and hence should probably either defer to the ":" help page or copy-paste from it.

Agreed.

>
> ?? SM> [[alternative HTML version deleted]]
> ? ? ? ?^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
>
> ?{I'm amazed that you still did not find out how to avoid the
> ? above, e.g., by following the posting guide ...}

I'm amazed you haven't upgraded from your ASR-33 with acoustic coupler :-)

        -s


From richard.cotton at hsl.gov.uk  Wed Jun 24 17:40:10 2009
From: richard.cotton at hsl.gov.uk (richard.cotton at hsl.gov.uk)
Date: Wed, 24 Jun 2009 17:40:10 +0200 (CEST)
Subject: [Rd] RGui Configuration editor crashes when using an unlisted font
	(PR#13780)
Message-ID: <20090624154010.5AEDB283031D@mail.pubhealth.ku.dk>

Full_Name: Richard Cotton
Version: 2.9.0
OS: Windows XP, SP2, 32 bit
Submission from: (NULL) (87.102.99.18)


To reproduce the crash:

1. Create an RConsole file for your user account.

2. Close R.

3. Manually edit the font line to include a font that is not on the standard
list of available fonts, e.g.

font = Verdana

4. Open R.  (At this point the console text should appear in the new font you
have chosen.)

5. Click Edit -> Gui preferences to open the RGui Configuration Editor.  R will
now crash.


I have reproduced this using the names of several different fonts in the
RConsole file, and on several WinXP boxes.

I also tried contacting the R-Devel list [1] to see if the problem extends to
other OSes, though there has been no response so far.

[1] http://www.nabble.com/RGui-Configuration-Editor-crashes-when-using-an-unlisted-font-td24111311.html


From pgilbert at bank-banque-canada.ca  Wed Jun 24 21:29:21 2009
From: pgilbert at bank-banque-canada.ca (Paul Gilbert)
Date: Wed, 24 Jun 2009 15:29:21 -0400
Subject: [Rd] Matrix vignette error in June 24 RC
Message-ID: <4A427E91.5000601@bank-banque-canada.ca>

I am getting the following problem with make check-all on the June 24 
rc. I realize I could probably fix it by installing/setting a path to 
the sty file, but I don't remember having to do that for make check-all 
in the past.

Paul Gilbert
___________
....
checking package 'Matrix'
* checking for working pdflatex ... OK
* using log directory '/home/paul/toolchain/R/src/R-rc/tests/Matrix.Rcheck'
* using R version 2.9.1 RC (2009-06-22 r48830)
* using session charset: UTF-8
* checking for file 'Matrix/DESCRIPTION' ... OK
* this is package 'Matrix' version '0.999375-29'
* checking package name space information ... OK
* checking package dependencies ... OK
* checking if this is a source package ... OK
* checking for executable files ... OK
* skipping installation test
* checking package directory ... OK
* checking for portable file names ... OK
* checking for sufficient/correct file permissions ... OK
* checking DESCRIPTION meta-information ... OK
* checking top-level files ... OK
* checking index information ... OK
* checking package subdirectories ... OK
* checking R files for non-ASCII characters ... OK
* checking R files for syntax errors ... OK
* checking whether the package can be loaded ... OK
* checking whether the package can be loaded with stated dependencies 
.... OK
* checking whether the name space can be loaded with stated dependencies 
.... OK
* checking for unstated dependencies in R code ... OK
* checking S3 generic/method consistency ... OK
* checking replacement functions ... OK
* checking foreign function calls ... OK
* checking R code for possible problems ... NOTE
graph.has.weights: no visible global function definition for
?edgeDataDefaults?
graph.wgtMatrix: no visible global function definition for ?numEdges?
graph.wgtMatrix: no visible global function definition for ?nodes?
graph.wgtMatrix: no visible global function definition for
?edgeDataDefaults?
graph.wgtMatrix: no visible global function definition for ?edgeData?
Tsp2grNEL: no visible global function definition for ?ftM2graphNEL?
coerce,graphAM-sparseMatrix: no visible global function definition for
?edgemode?
coerce,graphNEL-TsparseMatrix: no visible global function definition
for ?nodes?
coerce,graphNEL-TsparseMatrix: no visible global function definition
for ?edgemode?
coerce,graphNEL-TsparseMatrix: no visible global function definition
for ?edgeWeights?
Logic,ltCMatrix-ltCMatrix: no visible global function definition for
?forceTriangular?
* checking Rd files ... OK
* checking Rd files against version 2 parser ... OK
* checking Rd cross-references ... OK
* checking for missing documentation entries ... OK
* checking for code/documentation mismatches ... OK
* checking Rd \usage sections ... OK
* checking data for non-ASCII characters ... OK
* checking line endings in C/C++/Fortran sources/headers ... OK
* checking line endings in Makefiles ... OK
* checking for portable compilation flags in Makevars ... OK
* checking for portable use of $BLAS_LIBS ... OK
* checking examples ... OK
* checking tests ...
Running ?base-matrix-fun.R?
Running ?bind.R?
Comparing ?bind.Rout? to ?bind.Rout.save? ... OK
Running ?Class+Meth.R?
Running ?dg_Matrix.R?
Running ?dpo-test.R?
Running ?dtpMatrix.R?
Running ?factorizing.R?
Running ?group-methods.R?
Running ?indexing.R?
Comparing ?indexing.Rout? to ?indexing.Rout.save? ... OK
Running ?matprod.R?
Running ?matr-exp.R?
Running ?other-pkgs.R?
Running ?Simple.R?
Running ?validObj.R?
Running ?write-read.R?
OK
* checking package vignettes in 'inst/doc' ... NOTE
*** PDFLaTeX Errors ***
File 
/home/paul/toolchain/R/src/R-rc/tests/Matrix.Rcheck/inst/doc/Intro2Matrix.Rnw 
:
Running 'texi2dvi' on 'Intro2Matrix.tex' failed.
LaTeX errors:
! LaTeX Error: File `fullpage.sty' not found.
Type X to quit or <RETURN> to proceed,
or enter new name. (Default extension: sty)
! Emergency stop.
<read *>
l.5 \usepackage
[authoryear,round]{natbib}^^M
! ==> Fatal error occurred, no output PDF file produced!
File 
/home/paul/toolchain/R/src/R-rc/tests/Matrix.Rcheck/inst/doc/sparseModels.Rnw 
:
Running 'texi2dvi' on 'sparseModels.tex' failed.
LaTeX errors:
! LaTeX Error: File `fullpage.sty' not found.
Type X to quit or <RETURN> to proceed,
or enter new name. (Default extension: sty)
! Emergency stop.
<read *>
l.4 \usepackage
{myVignette}^^M
! ==> Fatal error occurred, no output PDF file produced!
* checking PDF version of manual ... OK

make[1]: Leaving directory `/home/paul/toolchain/R/src/R-rc/tests'
paul at dualx:~/toolchain/R/src/R-rc$
====================================================================================

La version fran?aise suit le texte anglais.

------------------------------------------------------------------------------------

This email may contain privileged and/or confidential in...{{dropped:26}}


From hb at stat.berkeley.edu  Thu Jun 25 06:13:34 2009
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Thu, 25 Jun 2009 00:13:34 -0400
Subject: [Rd] V2.9.0 changes [Sec=Unclassified]
In-Reply-To: <19009.58205.475035.852783@lynne.math.ethz.ch>
References: <b0808fdc0906230121n243072fbrd62cbe1614d13b50@mail.gmail.com> 
	<42C7503E0B99F248B06BC65E7D2B4E020122C50FB22C@EX2K7-CCR.AAD.GOV.AU> 
	<19009.58205.475035.852783@lynne.math.ethz.ch>
Message-ID: <59d7961d0906242113i4607ab63g8460386d28375d3a@mail.gmail.com>

On Wed, Jun 24, 2009 at 4:27 AM, Martin
Maechler<maechler at stat.math.ethz.ch> wrote:
>>>>>> "TR" == Troy Robertson <Troy.Robertson at aad.gov.au>
>>>>>> ? ? on Wed, 24 Jun 2009 16:35:29 +1000 writes:
>
> ? ?TR> Yes, I had looked at R.oo, S4 and proto before beginning coding. I had initially assumed that S4 was an enhancement of or replacement to R.oo that was implemented at a lower level and had decided to go with the 'future' of OO in R.
> ? ?TR> These assumptions were not necessarily correct.
>
> >From the view of the R core team,
> S4 ?*is* ``the future of OO in R''

...and until we're there, R.oo (S3) will do it for you.

/Henrik

>
> But then, as professional statisticians, we should consider the
> famous
> ? >>> Prediction is very difficult, especially about the future <<
> attributed to Physics Nobel Prize winner Niels Bohr.
>
> ---
>
> Martin Maechler, ETH Zurich & R-core
>
>
> ? ?TR> Troy
>
> ? ?TR> Troy Robertson
> ? ?TR> Database and Computing Support Provider
> ? ?TR> Southern Ocean Ecosystems, ERM/Fish
> ? ?TR> Australian Antarctic Division
> ? ?TR> Channel Highway, Kingston 7050
> ? ?TR> PH: 03 62323571
> ? ?TR> Troy.Robertson at aad.gov.au
>
>
> ? ?>> -----Original Message-----
> ? ?>> From: Antonio, Fabio Di Narzo [mailto:antonio.fabio at gmail.com]
> ? ?>> Sent: Tuesday, 23 June 2009 6:22 PM
> ? ?>> To: Troy Robertson
> ? ?>> Cc: r-devel at R-project.org
> ? ?>> Subject: Re: [Rd] V2.9.0 changes [Sec=Unclassified]
> ? ?>>
> ? ?>> Not a direct answer to your question, but...
> ? ?>> You might consider using the R.oo package, from H. Bengtsson. It's
> ? ?>> very stable, written in pure R, and cleanly allows you to do
> ? ?>> pass-by-reference OO programming, with no tricks.
> ? ?>>
> ? ?>> HTH,
> ? ?>> af
> ? ?>>
> ? ?>> 2009/6/23 Troy Robertson <Troy.Robertson at aad.gov.au>:
> ? ?>> > Hi all,
> ? ?>> >
> ? ?>> >
> ? ?>> >
> ? ?>> > Prefix: I am a frustrated Java coder in R.
> ? ?>> >
> ? ?>> >
> ? ?>> >
> ? ?>> > I am coding a medium sized ecosystem modelling program in R. ?I have
> ? ?>> changed to using S4 objects and it has cost me an order of magnitude in
> ? ?>> execution speed over the functional model. ?I cannot afford this penalty
> ? ?>> and have found that it is the result of all the passing-by-value of
> ? ?>> objects.
> ? ?>> >
> ? ?>> >
> ? ?>> >
> ? ?>> > I see that you can now safely inherit from environment in V2.9.0.
> ? ?>> >
> ? ?>> > That got me all excited that I would now be able to pass objects by
> ? ?>> reference.
> ? ?>> >
> ? ?>> >
> ? ?>> >
> ? ?>> > But...
> ? ?>> >
> ? ?>> > That doesn't seem to be the case.
> ? ?>> >
> ? ?>> > It only seem that passing an environment which holds the object allows
> ? ?>> for pass-by-reference and that passing an object which inherits from
> ? ?>> environment doesn't.
> ? ?>> >
> ? ?>> > Why is this the case, either an object inherits the properties of its
> ? ?>> parent or it doesn't.
> ? ?>> >
> ? ?>> > Has anyone else had a play with this? ?Or have I got it all wrong.
> ? ?>> >
> ? ?>> >
> ? ?>> >
> ? ?>> > I tried the below:
> ? ?>> >
> ? ?>> > ------------------------------------------------------------------------
> ? ?>> -----------------
> ? ?>> >
> ? ?>> > setClass('foo', representation=representation(stuff='list',
> ? ?>> bar='numeric'),
> ? ?>> >
> ? ?>> > ? ? ? ? ? ? ? ? ? ? prototype=list(stuff=list(), bar=0),
> ? ?>> >
> ? ?>> > ? ? ? ? ? ? ? ? ? ? contains='.environment')
> ? ?>> >
> ? ?>> >
> ? ?>> >
> ? ?>> > setGeneric('doit', function(.Object, newfoo='environment')
> ? ?>> standardGeneric('doit'))
> ? ?>> >
> ? ?>> >
> ? ?>> >
> ? ?>> > setMethod('doit', 'foo', function(.Object, newfoo){newfoo at bar <- 10})
> ? ?>> >
> ? ?>> >
> ? ?>> >
> ? ?>> > z <- new('foo')
> ? ?>> >
> ? ?>> >
> ? ?>> >
> ? ?>> > z at stuff$x <- new('foo')
> ? ?>> >
> ? ?>> >
> ? ?>> >
> ? ?>> > doit(z,z at stuff$x)
> ? ?>> >
> ? ?>> >
> ? ?>> >
> ? ?>> > z at stuff$x at bar
> ? ?>> >
> ? ?>> >
> ? ?>> >
> ? ?>> > [1] 0
> ? ?>> >
> ? ?>> > ------------------------------------------------------------------------
> ? ?>> ------------------
> ? ?>> >
> ? ?>> >
> ? ?>> >
> ? ?>> > Can anyone help with a better way of doing this.
> ? ?>> >
> ? ?>> > I'm trying to avoid all the indirection of packing and unpacking
> ? ?>> environments for passing.
> ? ?>> >
> ? ?>> >
> ? ?>> >
> ? ?>> >
> ? ?>> >
> ? ?>> > Thanks heaps
> ? ?>> >
> ? ?>> > Troy
> ? ?>> >
>
> ? ?..............
>
>
> ? ?>> --
> ? ?>> Antonio, Fabio Di Narzo
> ? ?>> Ph.D. student at
> ? ?>> Department of Statistical Sciences
> ? ?>> University of Bologna, Italy
> ? ?TR> ___________________________________________________________________________
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From xwu at epsilon.com  Wed Jun 24 17:10:11 2009
From: xwu at epsilon.com (xwu at epsilon.com)
Date: Wed, 24 Jun 2009 17:10:11 +0200 (CEST)
Subject: [Rd] compile and install R @ one user defined directory? (PR#13779)
Message-ID: <20090624151012.9D1F1283031D@mail.pubhealth.ku.dk>


Dear Helper,

Under UNIX "Solaris 10 3/05 s10_74L2a SPARC" and with following "R Installa=
tion and Administration" @ http://cran.r-project.org/,

First, I unzipped the unix version winzip source code R-2.9.0.tar.gz  using=
 following commands at my own dir:

              /home/xwu/R1>gzip -dc R-2.9.0.tar.gz | tar xvf -
             (a subdir  /home/xwu/R1R-2.9.0/ was created successfully under=
 /home/xwu/R1)

Then I go to /home/xwu/R1/R-2.9.0 to compilation and installation using fol=
lowing command:

            /home/xwu/R1/R-2.9.0> ./configure --prefix=3D/home/xwu/R1/R-2.9=
.0

The error comes:
        configure: error: --with-readline=3Dyes (default) and headers/libs =
are not available


is there something error? or should I add more env shell variable? or shoul=
d I continue to move on by typing?

    make prefix=3D/home/xwu/R1/R-2.9.0       install


Thanks,

Xuanfu


________________________________
This e-mail and files transmitted with it are confidential, and are intende=
d solely for the use of the individual or entity to whom this e-mail is add=
ressed. If you are not the intended recipient, or the employee or agent res=
ponsible to deliver it to the intended recipient, you are hereby notified t=
hat any dissemination, distribution or copying of this communication is str=
ictly prohibited. If you are not one of the named recipient(s) or otherwise=
 have reason to believe that you received this message in error, please imm=
ediately notify sender by e-mail, and destroy the original message. Thank Y=
ou.

	[[alternative HTML version deleted]]


From P.Dalgaard at biostat.ku.dk  Thu Jun 25 09:56:57 2009
From: P.Dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Thu, 25 Jun 2009 09:56:57 +0200
Subject: [Rd] compile and install R @ one user defined directory?
	(PR#13779)
In-Reply-To: <20090624151012.9D1F1283031D@mail.pubhealth.ku.dk>
References: <20090624151012.9D1F1283031D@mail.pubhealth.ku.dk>
Message-ID: <4A432DC9.1060801@biostat.ku.dk>

xwu at epsilon.com wrote:
> Dear Helper,
> 
> Under UNIX "Solaris 10 3/05 s10_74L2a SPARC" and with following "R Installa=
> tion and Administration" @ http://cran.r-project.org/,
> 
> First, I unzipped the unix version winzip source code R-2.9.0.tar.gz  using=
>  following commands at my own dir:
> 
>               /home/xwu/R1>gzip -dc R-2.9.0.tar.gz | tar xvf -
>              (a subdir  /home/xwu/R1R-2.9.0/ was created successfully under=
>  /home/xwu/R1)
> 
> Then I go to /home/xwu/R1/R-2.9.0 to compilation and installation using fol=
> lowing command:
> 
>             /home/xwu/R1/R-2.9.0> ./configure --prefix=3D/home/xwu/R1/R-2.9=
> .0
> 
> The error comes:
>         configure: error: --with-readline=3Dyes (default) and headers/libs =
> are not available
> 
> 
> is there something error? or should I add more env shell variable? or shoul=
> d I continue to move on by typing?
> 
>     make prefix=3D/home/xwu/R1/R-2.9.0       install

This is not a bug. Please do not abuse the bug repository.

The error is what it says it is: You don't have readline headers and
libraries, or not where configure can find them. Install them or use
configure --without-readline --prefix=....

-- 
   O__  ---- Peter Dalgaard             ?ster Farimagsgade 5, Entr.B
  c/ /'_ --- Dept. of Biostatistics     PO Box 2099, 1014 Cph. K
 (*) \(*) -- University of Copenhagen   Denmark      Ph:  (+45) 35327918
~~~~~~~~~~ - (p.dalgaard at biostat.ku.dk)              FAX: (+45) 35327907


From savicky at cs.cas.cz  Thu Jun 25 11:23:25 2009
From: savicky at cs.cas.cz (Petr Savicky)
Date: Thu, 25 Jun 2009 11:23:25 +0200
Subject: [Rd] read.csv
In-Reply-To: <971536df0906141156j78b5570ajf08257c88098d7d8@mail.gmail.com>
References: <971536df0906141156j78b5570ajf08257c88098d7d8@mail.gmail.com>
Message-ID: <20090625092325.GA13239@cs.cas.cz>

On Sun, Jun 14, 2009 at 02:56:01PM -0400, Gabor Grothendieck wrote:
> If read.csv's colClasses= argument is NOT used then read.csv accepts
> double quoted numerics:
> 
> 1: > read.csv(stdin())
> 0: A,B
> 1: "1",1
> 2: "2",2
> 3:
>   A B
> 1 1 1
> 2 2 2
> 
> However, if colClasses is used then it seems that it does not:
> 
> > read.csv(stdin(), colClasses = "numeric")
> 0: A,B
> 1: "1",1
> 2: "2",2
> 3:
> Error in scan(file, what, nmax, sep, dec, quote, skip, nlines, na.strings,  :
>   scan() expected 'a real', got '"1"'
> 
> Is this really intended?  I would have expected that a csv file in which
> each field is surrounded with double quotes is acceptable in both
> cases.   This may be documented as is yet seems undesirable from
> both a consistency viewpoint and the viewpoint that it should be
> possible to double quote fields in a csv file.

The problem is not specific to read.csv(). The same difference appears
for read.table().
  read.table(stdin())
  "1" 1
  2 "2"
  
  #   V1 V2
  # 1  1  1
  # 2  2  2
but
  read.table(stdin(), colClasses = "numeric")
  "1" 1
  2 "2"
  
  Error in scan(file, what, nmax, sep, dec, quote, skip, nlines, na.strings,  : 
  scan() expected 'a real', got '"1"'

The error occurs in the call of scan() at line 152 in src/library/utils/R/readtable.R,
which is
  data <- scan(file = file, what = what, sep = sep, quote = quote, ...
(This is the third call of scan() in the source code of read.table())

In this call, scan() gets the types of columns in "what" argument. If the type 
is specified, scan() performs the conversion itself and fails, if a numeric field
is quoted. If the type is not specified, the output of scan() is of type character,
but with quotes eliminated, if there are some in the input file. Columns with
unknown type are then converted using type.convert(), which receives the data
already without quotes.

The call of type.convert() is contained in a cycle
    for (i in (1L:cols)[do]) {
        data[[i]] <-
            if (is.na(colClasses[i]))
                type.convert(data[[i]], as.is = as.is[i], dec = dec,
                             na.strings = character(0L))
        ## as na.strings have already been converted to <NA>
            else if (colClasses[i] == "factor") as.factor(data[[i]])
            else if (colClasses[i] == "Date") as.Date(data[[i]])
            else if (colClasses[i] == "POSIXct") as.POSIXct(data[[i]])
            else methods::as(data[[i]], colClasses[i])
    }
which contains also lines, which could perform conversion for columns with
a specified type, but these lines are not used, since the vector "do" 
is defined as
  do <- keep & !known 
where "known" determines for which columns the type is known.

It is possible to modify the code so that scan() is called with all types
unspecified and leave the conversion to the lines
            else if (colClasses[i] == "factor") as.factor(data[[i]])
            else if (colClasses[i] == "Date") as.Date(data[[i]])
            else if (colClasses[i] == "POSIXct") as.POSIXct(data[[i]])
            else methods::as(data[[i]], colClasses[i])
above. Since this solution is already prepared in the code, the patch is very simple
  --- R-devel/src/library/utils/R/readtable.R     2009-05-18 17:53:08.000000000 +0200
  +++ R-devel-readtable/src/library/utils/R/readtable.R   2009-06-25 10:20:06.000000000 +0200
  @@ -143,9 +143,6 @@
       names(what) <- col.names
   
       colClasses[colClasses %in% c("real", "double")] <- "numeric"
  -    known <- colClasses %in%
  -                c("logical", "integer", "numeric", "complex", "character")
  -    what[known] <- sapply(colClasses[known], do.call, list(0))
       what[colClasses %in% "NULL"] <- list(NULL)
       keep <- !sapply(what, is.null)
   
  @@ -189,7 +186,7 @@
          stop(gettextf("'as.is' has the wrong length %d  != cols = %d",
                        length(as.is), cols), domain = NA)
   
  -    do <- keep & !known # & !as.is
  +    do <- keep & !as.is
       if(rlabp) do[1L] <- FALSE # don't convert "row.names"
       for (i in (1L:cols)[do]) {
           data[[i]] <-
(Also in attachment)

I did a test as follows
  d1 <- read.table(stdin())
  "1" TRUE   3.5
  2   NA     "0.1"
  NA  FALSE  0.1
  3   "TRUE" NA

  sapply(d1, typeof)
  #        V1        V2        V3 
  # "integer" "logical"  "double" 
  is.na(d1)
  #         V1    V2    V3
  # [1,] FALSE FALSE FALSE
  # [2,] FALSE  TRUE FALSE
  # [3,]  TRUE FALSE FALSE
  # [4,] FALSE FALSE  TRUE
  
  d2 <- read.table(stdin(), colClasses=c("integer", "logical", "double"))
  "1" TRUE   3.5
  2   NA     "0.1"
  NA  FALSE  0.1
  3   "TRUE" NA

  sapply(d2, typeof)
  #        V1        V2        V3 
  # "integer" "logical"  "double" 
  is.na(d2)
  #         V1    V2    V3
  # [1,] FALSE FALSE FALSE
  # [2,] FALSE  TRUE FALSE
  # [3,]  TRUE FALSE FALSE
  # [4,] FALSE FALSE  TRUE

I think, there was a reason to let scan() to perform the type conversion, for
example, it may be more efficient. So, if correct, the above patch is a possible
solution, but some other may be more appropriate. In particular, function scan()
may be modified to remove quotes also from fields specified as numeric.

Petr.


From savicky at cs.cas.cz  Thu Jun 25 11:29:04 2009
From: savicky at cs.cas.cz (Petr Savicky)
Date: Thu, 25 Jun 2009 11:29:04 +0200
Subject: [Rd] read.csv
In-Reply-To: <20090625092325.GA13239@cs.cas.cz>
References: <971536df0906141156j78b5570ajf08257c88098d7d8@mail.gmail.com>
	<20090625092325.GA13239@cs.cas.cz>
Message-ID: <20090625092904.GB13239@cs.cas.cz>

I am sorry for not including the attachment mentioned in my
previous email. Attached now. Petr.
-------------- next part --------------
--- R-devel/src/library/utils/R/readtable.R	2009-05-18 17:53:08.000000000 +0200
+++ R-devel-readtable/src/library/utils/R/readtable.R	2009-06-25 10:20:06.000000000 +0200
@@ -143,9 +143,6 @@
     names(what) <- col.names
 
     colClasses[colClasses %in% c("real", "double")] <- "numeric"
-    known <- colClasses %in%
-                c("logical", "integer", "numeric", "complex", "character")
-    what[known] <- sapply(colClasses[known], do.call, list(0))
     what[colClasses %in% "NULL"] <- list(NULL)
     keep <- !sapply(what, is.null)
 
@@ -189,7 +186,7 @@
 	stop(gettextf("'as.is' has the wrong length %d  != cols = %d",
                      length(as.is), cols), domain = NA)
 
-    do <- keep & !known # & !as.is
+    do <- keep & !as.is
     if(rlabp) do[1L] <- FALSE # don't convert "row.names"
     for (i in (1L:cols)[do]) {
         data[[i]] <-

From ys1276 at gmail.com  Thu Jun 25 17:40:52 2009
From: ys1276 at gmail.com (Yaniv Semel)
Date: Thu, 25 Jun 2009 18:40:52 +0300
Subject: [Rd] ignoring SIGPIPE signal + error loading lapack routines
Message-ID: <952c604b0906250840m3101168cge7be52a79db76b2a@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090625/76a16f55/attachment.pl>

From thothal at sbox.tugraz.at  Thu Jun 25 19:12:12 2009
From: thothal at sbox.tugraz.at (Thorn Thaler)
Date: Thu, 25 Jun 2009 19:12:12 +0200
Subject: [Rd] Rd: pdf manual: package information not on first page
Message-ID: <4A43AFEC.30901@sbox.tugraz.at>

Hi everybody,

currently I'm working on two packages, where I've included a 
<package-name>-package.Rd documentation file (with \docType set to 
"package") in each case. When I run "R CMD check" everything works fine, 
and a call to "R CMD install" generates the appropriate html, text and 
pdf documentation.

While the package documentation (generated from 
<package-name>-package.Rd) for one of the packages is on the first page 
in the pdf manual, it is on the last page for the other package. It 
seems not to have to do with the alphabetical order, for there are 
documentated function in both packages starting with a letter prior to 
the first letter of the package name.

So my question is, if there is any possibility to get the package 
documentation on the first page?

Best regards,

Thorn Thaler


From cooch17 at verizon.net  Thu Jun 25 21:03:49 2009
From: cooch17 at verizon.net (egc)
Date: Thu, 25 Jun 2009 15:03:49 -0400
Subject: [Rd] failed stats check | R 2.9.0
Message-ID: <4A43CA15.1090702@verizon.net>

Trying to get R 2.90 compiled on a CentOS 5.3 (i.e., RHEL 5.3) box, 
64-bit. Machine has Opteron chips, so downloaded and installed ACML 
4.3.0. Configured R with

./configure --with-lapack="-L/usr/lib64" 
--with-blas="-L/opt/acml4.2.0/gfortran64/lib -lacml" --with-tcltk

Absolutely no problems/errors. Recommended packages there - blas and 
lapack both there.

Ran make. Again, no problems/errors that I could find.

Problems with make check, though.

base -> no problems
tools -> no problems
Devices -> no problems
graphics -> no problems

stats -> failed (!)

Here is what I get - suggestions/pointers to the obvious most appreciated.

Error: testing 'stats' failed
Execution halted
make[3]: *** [test-Examples-Base] Error 1
make[3]: Leaving directory `/root/Desktop/R-2.9.0/tests/Examples'
make[2]: *** [test-Examples] Error 2
make[2]: Leaving directory `/root/Desktop/R-2.9.0/tests'
make[1]: *** [test-all-basics] Error 1
make[1]: Leaving directory `/root/Desktop/R-2.9.0/tests'
make: *** [check] Error 2


From cooch17 at verizon.net  Thu Jun 25 21:13:20 2009
From: cooch17 at verizon.net (egc)
Date: Thu, 25 Jun 2009 15:13:20 -0400
Subject: [Rd] more on make check states failure
Message-ID: <4A43CC50.70804@verizon.net>

Ran make check-devel and make check-all (for more comprehensive 
testing)  - same error messages - not even sure where to look in tests 
or Examples for 'help' - no logs, or files with .fail extension or 
anything I might *guess* to look for.

I've never had this problem before - the only thing different on the box 
from when I had 2.9.0 running fine is

1. change from Fedora Core 8 -> CentOS 5.3

2. ACML updated from 4.2.0 -> 4.3.0

Thats it! Unless AMCL 4.3.0 is doing something 'weird', I'm stumped.


From cooch17 at verizon.net  Thu Jun 25 22:17:41 2009
From: cooch17 at verizon.net (Evan Cooch)
Date: Thu, 25 Jun 2009 16:17:41 -0400
Subject: [Rd] check stats fail | part III
Message-ID: <4A43DB65.6030104@verizon.net>

For grins, tried rebuilding R 2.9.0 without using ACML 4.3.0. Config 
goes fine, make runs without any errors.

make check - and - ta-dah! - no errors for stats. Everything seems to 
check out just fine.

So, it seems as if R 2.9.0, ACML 4.3.0, and perhaps one/more things 
under CentOS don't play nice.

Will trying unloading 4.3.0, installing 4.2.0 (which worked before on 
the Fedora box), and see what happens.


From kynnjo at gmail.com  Thu Jun 25 23:40:04 2009
From: kynnjo at gmail.com (Kynn Jones)
Date: Thu, 25 Jun 2009 17:40:04 -0400
Subject: [Rd] R data inspection under gdb?
Message-ID: <c2350ba40906251440v53b2f00eq75cdd1f405405027@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090625/c8f1fe53/attachment.pl>

From mtmorgan at fhcrc.org  Fri Jun 26 00:05:56 2009
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Thu, 25 Jun 2009 15:05:56 -0700
Subject: [Rd] R data inspection under gdb?
In-Reply-To: <c2350ba40906251440v53b2f00eq75cdd1f405405027@mail.gmail.com>
References: <c2350ba40906251440v53b2f00eq75cdd1f405405027@mail.gmail.com>
Message-ID: <4A43F4C4.5030501@fhcrc.org>

Hi Kynn --

(gdb) call Rf_PrintValue(x)

'void' is I think the return value of R_PV()

Martin

Kynn Jones wrote:
> Hi, everyone.  I'm trying to debug an R-module, written in C, and I'm using
> gdb for this.
> 
> How can I print "standard" R objects from within C code?
> 
> BTW, I'm familiar with the advice to use R_PV given in Writing R Extensions,
> but it's not working for me.  E.g., I get
> 
> (gdb) p R_PV(x)
> $1 = void
> 
> and yet
> 
> (gdb) p *x
> $2 = {sxpinfo = {type = 16, obj = 0, named = 0, gp = 0, mark = 0, debug = 0,
> trace = 0, spare = 0, gcgen = 0, gccls = 1},
>   attrib = 0x608f98, gengc_next_node = 0xa82328, gengc_prev_node = 0xa822c8,
> u = {primsxp = {offset = 1}, symsxp = {
>       pname = 0x1, value = 0x146fb50, internal = 0x2000000a}, listsxp =
> {carval = 0x1, cdrval = 0x146fb50,
>       tagval = 0x2000000a}, envsxp = {frame = 0x1, enclos = 0x146fb50,
> hashtab = 0x2000000a}, closxp = {formals = 0x1,
>       body = 0x146fb50, env = 0x2000000a}, promsxp = {value = 0x1, expr =
> 0x146fb50, env = 0x2000000a}}}
> 
> which suggests to me that x is not "void" (whatever that's supposed to mean
> here).
> 
> 
> What I'd like to do is print out SEXP's the way that the R interactive
> interpreter would display them if one evaluated them on the command line,
> but to do this from within gdb, or at least via a PRINT function called
> directly within the C code.
> 
> Is this possible?
> 
> TIA!
> 
> Kynn
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From cooch17 at verizon.net  Fri Jun 26 00:43:20 2009
From: cooch17 at verizon.net (Evan Cooch)
Date: Thu, 25 Jun 2009 18:43:20 -0400
Subject: [Rd] check stats fail | part III
In-Reply-To: <4A43DB65.6030104@verizon.net>
References: <4A43DB65.6030104@verizon.net>
Message-ID: <4A43FD88.2000506@verizon.net>

Well, tried using 4.2.0 instead - no luck. Regardless of which ACML I 
use, I'm getting the errors described in the original post. So, its not 
an ACML error (directly), but something has changed in the migration 
from Fedora Core 8 -> CentOS which isn't playing nice with ACML. Of 
course, figuring out what is the problem. I suppose the other option is 
another BLAS - say, ATLAS. Never tried that, but I suppose I could take 
it out for a spin.

Pity, since ACML really was doing the trick for some of my linear 
algebra-heavy progs.

Evan Cooch wrote:
> For grins, tried rebuilding R 2.9.0 without using ACML 4.3.0. Config 
> goes fine, make runs without any errors.
>
> make check - and - ta-dah! - no errors for stats. Everything seems to 
> check out just fine.
>
> So, it seems as if R 2.9.0, ACML 4.3.0, and perhaps one/more things 
> under CentOS don't play nice.
>
> Will trying unloading 4.3.0, installing 4.2.0 (which worked before on 
> the Fedora box), and see what happens.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From murdoch at stats.uwo.ca  Fri Jun 26 01:46:09 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Thu, 25 Jun 2009 19:46:09 -0400
Subject: [Rd] Rd: pdf manual: package information not on first page
In-Reply-To: <4A43AFEC.30901@sbox.tugraz.at>
References: <4A43AFEC.30901@sbox.tugraz.at>
Message-ID: <4A440C41.60602@stats.uwo.ca>

On 25/06/2009 1:12 PM, Thorn Thaler wrote:
> Hi everybody,
> 
> currently I'm working on two packages, where I've included a 
> <package-name>-package.Rd documentation file (with \docType set to 
> "package") in each case. When I run "R CMD check" everything works fine, 
> and a call to "R CMD install" generates the appropriate html, text and 
> pdf documentation.
> 
> While the package documentation (generated from 
> <package-name>-package.Rd) for one of the packages is on the first page 
> in the pdf manual, it is on the last page for the other package. It 
> seems not to have to do with the alphabetical order, for there are 
> documentated function in both packages starting with a letter prior to 
> the first letter of the package name.
> 
> So my question is, if there is any possibility to get the package 
> documentation on the first page?

That's where it is supposed to be.  Could you look for errors in the one 
where it comes last?  If you can't spot anything, you could send me the 
tar.gz version of it and I'll take a look.

Duncan Murdoch


From cooch17 at verizon.net  Fri Jun 26 02:20:11 2009
From: cooch17 at verizon.net (Evan Cooch)
Date: Thu, 25 Jun 2009 20:20:11 -0400
Subject: [Rd] 2.9.0 and make check errors | mystery deepens
Message-ID: <4A44143B.9000301@verizon.net>

So, I tried the following configure:

./configure   --with-lapack  --with-blas --with-tcltk

No use of ACML at all, but both lapack and blas. Configure proceeds 
without any errors. Make, same thing.

Make check - same problem with stats. But, this time a .fail file got 
created in tests/Example. Bottom of the file has something which might 
resonate with someone out there:

Error in La.svd(x, nu, nv) :
  BLAS/LAPACK routine 'DGESDD' gave error code -12
Calls: cancor -> svd -> La.svd -> .Call
Execution halted

So, from the admin guide, I find the following

Since ACML contains a full LAPACK, if selected as the BLAS it can be 
used as the LAPACK /via/ --with-lapack.
If you do use --with-lapack, be aware of potential problems with bugs in 
the LAPACK 3.0 sources (or in the posted corrections to those sources). 
In particular, bugs in |DGEEV| and |DGESDD| have resulted in error 
messages such as

DGEBRD gave error code -10

So, seems that I'm seeing something analogous (or exactly like) to the 
'bug' indicated above.

So, suggestions on how to proceed? It seems that the problem lies with 
LAPACK. Indeed, system comes with LAPACK 3.xx (I have both 32- and 
64-bit flavors, which differ a bit; 32-bit is 3.0.37 and 64-bit is 
3.1.1), so not sure what to do.


From cooch17 at verizon.net  Fri Jun 26 05:10:13 2009
From: cooch17 at verizon.net (Evan Cooch)
Date: Thu, 25 Jun 2009 23:10:13 -0400
Subject: [Rd] ready to toss the towel | lapack and 2.9.0
Message-ID: <4A443C15.1000402@verizon.net>

Well, I've now tried just about every permutation I can think of - 
including using the ATLAS lapack (instead of generic), in various 
combinations with ACML, or generic BLAS, or ATLAS blas. No matter what I 
do, so long as I have lapack of any flavour, I get the 'stats error' 
with make check. And, it always seems to throw the error at the same 
point in the stats test file (an svd in cancorr, or some such). 
Specifically, BLAS/LAPACK routine 'DGESDD' gave error code -12.

So, I can pass the 'check tests' so long as I'm willing to drop lapack. 
Fine, except that big algebra things take insane amounts of time without 
lapack (1-20 fold decrease in throughput).

If it matters, here are some specific specs...

gcc version 4.1.2 20080704 (Red Hat 4.1.2-44)
lapack-3.0-37.el5
blas-3.0-37.el5
atlas-3.8.3-1.el5


I'd really not have to go through the cycle of trying one distro after 
another (and I gave up on Fedora because of the all-too-quick end of 
life on each release, not to mention all the 'broken bits' you need to 
live with on the 'bleeding edge'). I'm open to suggestions/obvious 
solutions. I really need to get this working.

Thanks in advance...


From cooch17 at verizon.net  Fri Jun 26 07:45:03 2009
From: cooch17 at verizon.net (Evan Cooch)
Date: Fri, 26 Jun 2009 01:45:03 -0400
Subject: [Rd] proper link to ACML  blas | compiling 2.9.0
Message-ID: <4A44605F.1050901@verizon.net>

Normally, I do the following to configure R for compilation on my 
Opteron box with ACML installed:

./configure --with-tcltk --with-blas="-L/opt/acml4.3.0/gfortran64/lib 
-lacml"

However, when I do so, and look at Makeconf, I see

BLAS_LIBS = -lblas

I thought I would see

BLAS_LIBS = -L/opt/acml4.3.0/gfortran64/lib -lacml

Why isn't Makeconf picking up the right BLAS_LIBS (or is it? does -lblas 
mean its finding the right blas?).

I tried

LD_LIBRARY_PATH=/opt/acml4.3.0/gfortran64/lib
export LD_LIBRARY_PATH

and then did a new Configure, but Makeconf still shows only

BLAS_LIBS = -lblas

When I look at config.log, I see a 'failure' that I think might be part 
of the story:

configure:37157: result: no
configure:37199: checking for dgemm_ in -L/opt/acml4.3.0/gfortran64/lib 
-lacml
configure:37230: gcc -std=gnu99 -o conftest -g -O2  
-I/usr/local/include  -L/usr/local/lib64 conftest.c -L/opt/acml4.3.0/gfo$
conftest.c: In function 'main':
conftest.c:189: warning: implicit declaration of function 'dgemm_'
/usr/bin/ld: warning: libgfortran.so.3, needed by 
/opt/acml4.3.0/gfortran64/lib/libacml.so, not found (try using -rpath or -$
/opt/acml4.3.0/gfortran64/lib/libacml.so: undefined reference to 
`_gfortran_compare_string at GFORTRAN_1.0'
/opt/acml4.3.0/gfortran64/lib/libacml.so: undefined reference to 
`_gfortran_transfer_character at GFORTRAN_1.0'
/opt/acml4.3.0/gfortran64/lib/libacml.so: undefined reference to 
`_gfortran_transfer_integer at GFORTRAN_1.0'
/opt/acml4.3.0/gfortran64/lib/libacml.so: undefined reference to 
`_gfortran_stop_numeric at GFORTRAN_1.0'
/opt/acml4.3.0/gfortran64/lib/libacml.so: undefined reference to 
`_gfortran_st_write_done at GFORTRAN_1.0'
/opt/acml4.3.0/gfortran64/lib/libacml.so: undefined reference to 
`_gfortran_pow_i4_i4 at GFORTRAN_1.0'
/opt/acml4.3.0/gfortran64/lib/libacml.so: undefined reference to 
`_gfortran_transfer_real at GFORTRAN_1.0'
/opt/acml4.3.0/gfortran64/lib/libacml.so: undefined reference to 
`_gfortran_st_read at GFORTRAN_1.0'
/opt/acml4.3.0/gfortran64/lib/libacml.so: undefined reference to 
`_gfortran_st_read_done at GFORTRAN_1.0'
/opt/acml4.3.0/gfortran64/lib/libacml.so: undefined reference to 
`_gfortran_st_write at GFORTRAN_1.0'
/opt/acml4.3.0/gfortran64/lib/libacml.so: undefined reference to 
`_gfortran_concat_string at GFORTRAN_1.0'
/opt/acml4.3.0/gfortran64/lib/libacml.so: undefined reference to 
`_gfortran_string_index at GFORTRAN_1.0'
collect2: ld returned 1 exit status
configure:37236: $? = 1
configure: failed

So, perhaps things go awry at this point...weird thing is, thee is no 
libgfortran.so.3 anywhere on the system that I can find....


From cooch17 at verizon.net  Fri Jun 26 08:57:35 2009
From: cooch17 at verizon.net (Evan Cooch)
Date: Fri, 26 Jun 2009 02:57:35 -0400
Subject: [Rd] can't use ATLAS  or ACML | 2.9.0
Message-ID: <4A44715F.4050204@verizon.net>

So, tried again from scratch. Again, CentOS 5.3, which is essentially 
RHEL 5.3.

./configure --with-blas="-L/opt/acml4.3.0/gfortran64/lib -lacml"

In config.log, get things like

configure:37199: checking for dgemm_ in -L/opt/acml4.3.0/gfortran64/lib 
-lacml
configure:37230: gcc -std=gnu99 -o conftest -g -O2  
-I/usr/local/include  -L/usr/local/lib64 conftest.c 
-L/opt/acml4.3.0/gfortran64/lib -lacml  -$
conftest.c: In function 'main':
conftest.c:189: warning: implicit declaration of function 'dgemm_'
/usr/bin/ld: warning: libgfortran.so.3, needed by 
/opt/acml4.3.0/gfortran64/lib/libacml.so, not found (try using -rpath or 
-rpath-link)


Try

./configure --with-blas="-L/usr/lib64/atlas  -lf77blas -latlas"

I get the following


configure:37199: checking for dgemm_ in -L/usr/lib64/atlas -lf77blas -latlas
configure:37230: gcc -std=gnu99 -o conftest -g -O2  
-I/usr/local/include  -L/usr/local/lib64 conftest.c -L/usr/lib64/atlas 
-lf77blas -latlas  -lg$
conftest.c: In function 'main':
conftest.c:189: warning: implicit declaration of function 'dgemm_'
/usr/bin/ld: cannot find -lf77blas
collect2: ld returned 1 exit status
configure:37236: $? = 1
configure: failed program was:


What puzzles me is that lf77blas is definitely in /usr/lib64/atlas  - 
but configure couldn't find it (?). Perhaps its because 100% of the libs 
in the atlast subdir are xxx.so.3 (perhaps R config is looking for so.1 
libs?).


I suspect that many/most of the problems I'm having with getting R to 
compile (with BLAS and LAPACK) are related to these basic issues - if I 
can't do even a simple compile with blas, then whats left?


From thothal at sbox.tugraz.at  Fri Jun 26 09:20:49 2009
From: thothal at sbox.tugraz.at (Thorn Thaler)
Date: Fri, 26 Jun 2009 09:20:49 +0200
Subject: [Rd] Rd: pdf manual: package information not on first page
In-Reply-To: <4A440C41.60602@stats.uwo.ca>
References: <4A43AFEC.30901@sbox.tugraz.at> <4A440C41.60602@stats.uwo.ca>
Message-ID: <4A4476D1.4090904@sbox.tugraz.at>

Duncan Murdoch schrieb:
>> So my question is, if there is any possibility to get the package 
>> documentation on the first page?
> 
> That's where it is supposed to be.  Could you look for errors in the one 
> where it comes last?  If you can't spot anything, you could send me the 
> tar.gz version of it and I'll take a look.

Hmm, "R CMD check" works fine without any problems. Are there any 
further checks I could perform? As pointed out by another reader of this 
list, could it, however, be an alphabetical issue? The name of the 
package with the information correctly on the first page starts with an 
upper case letter, while the other one doesn't. If upper case letters 
are supposed to come before lower case letters in the ordering, all 
would make sense. It would not be what I would like to have though. ;)

While writing these lines I investigated this behaviour and added a 
documentation file for function 'AAA' to see where it will be printed in 
the manual for the package starting with an upper case letter. And as 
presumed it was put on the very first page. So I think that R internally 
orders all documentation files, in doing so all documentation files 
starting with an upper case take precedence over those starting with a 
lower case letter.

This behaviour is somehow odd, though, a workaround would be of course 
to rename the documentation file for the package as 
"00-<package-name>-package.Rd" to assure that it will come first in the 
manual.

Is this behaviour intentional or is it a bug?

Thorn


From Rau at demogr.mpg.de  Fri Jun 26 10:46:29 2009
From: Rau at demogr.mpg.de (Rau, Roland)
Date: Fri, 26 Jun 2009 10:46:29 +0200
Subject: [Rd] Problem making the manuals (make dvi and make pdf)
Message-ID: <5B2F2CD24AD2764D898AF5A7B9A2ABBF011C6D2F@hermes.demogr.mpg.de>

Dear all,

I am trying to compile and install R from sources on Ubuntu GNU/Linux 64
bit. It usually worked flawlessly for me for more than 4 years (32bit
and 64bit on Mandrake/Mandriva, Suse, Debian, Ubuntu). However, I am
experiencing some problems now -- not during compiling and installing R
itself but with the manuals.

Maybe someone can help me with it? I tried to find some information in
the archives on the web but I was not successful.

Please let me explain therefore in detail where the problem is (incl.
some additional information):

Following the instructions in section 2.2 of the R Installation and
Administration Manual
(http://cran.r-project.org/doc/manuals/R-admin.html#Making-the-manuals),
making the info manuals works fine via "make info"

However, when I want to make the dvi and pdf manuals, I get the
following error:
======================================================

Loading texinfo [version 2007-09-03.05]: pdf, fonts, page headings,
tables,
conditionals, indexing, sectioning, toc, environments, defuns, macros,
cross references, insertions, (./epsf.tex
This is `epsf.tex' v2.7.3 <23 July 2005>
) localization, formatting, and turning on texinfo input format.)
(/usr/share/texmf/tex/lilypond/txi-en.tex
/usr/share/texmf/tex/lilypond/txi-en.tex:22: Undefined control sequence.
l.22 \txisetlanguage
                    {USenglish}{2}{3}
? 
======================================================

The output I am pasting is from:
> version
               _                           
platform       x86_64-unknown-linux-gnu    
arch           x86_64                      
os             linux-gnu                   
system         x86_64, linux-gnu           
status                                     
major          2                           
minor          9.0                         
year           2009                        
month          04                          
day            17                          
svn rev        48333                       
language       R                           
version.string R version 2.9.0 (2009-04-17)


I tried it yesterday also with the latest development and patched
releases --> same result.
Is it a TeX/LaTeX-problem?

Of course, I checked whether I have recent versions of makeinfo and
texi2dvi installed (which is mentioned in the manual). This seems to be
the case:

======================================================
root at roland-desktop-64bit:/extras/R/R-2.9.0# makeinfo --version
makeinfo (GNU texinfo) 4.11

Copyright (C) 2007 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later
<http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.
root at roland-desktop-64bit:/extras/R/R-2.9.0# texi2dvi --version
texi2dvi (GNU Texinfo 4.11) 1.104

Copyright (C) 2007 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later
<http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.

root at roland-desktop-64bit:/extras/R/R-2.9.0# texi2pdf --version
texi2dvi (GNU Texinfo 4.11) 1.104

Copyright (C) 2007 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later
<http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.

======================================================


and finally the output from ./configure

======================================================

R is now configured for x86_64-unknown-linux-gnu

  Source directory:          .
  Installation directory:    /usr/local

  C compiler:                gcc -std=gnu99  -g -O2
  Fortran 77 compiler:       gfortran  -g -O

  C++ compiler:              g++  -g -O2
  Fortran 90/95 compiler:    gfortran -g -O
  Obj-C compiler:	      

  Interfaces supported:      X11, tcltk
  External libraries:        readline
  Additional capabilities:   PNG, JPEG, iconv, MBCS, NLS
  Options enabled:           shared BLAS, R profiling

  Recommended packages:      yes

======================================================


Thanks in advance,
Roland

----------
This mail has been sent through the MPI for Demographic Research.  Should you receive a mail that is apparently from a MPI user without this text displayed, then the address has most likely been faked. If you are uncertain about the validity of this message, please check the mail header or ask your system administrator for assistance.


From murdoch at stats.uwo.ca  Fri Jun 26 13:10:30 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Fri, 26 Jun 2009 07:10:30 -0400
Subject: [Rd] Rd: pdf manual: package information not on first page
In-Reply-To: <4A4476D1.4090904@sbox.tugraz.at>
References: <4A43AFEC.30901@sbox.tugraz.at> <4A440C41.60602@stats.uwo.ca>
	<4A4476D1.4090904@sbox.tugraz.at>
Message-ID: <4A44ACA6.3050206@stats.uwo.ca>

Thorn Thaler wrote:
> Duncan Murdoch schrieb:
>   
>>> So my question is, if there is any possibility to get the package 
>>> documentation on the first page?
>>>       
>> That's where it is supposed to be.  Could you look for errors in the one 
>> where it comes last?  If you can't spot anything, you could send me the 
>> tar.gz version of it and I'll take a look.
>>     
>
> Hmm, "R CMD check" works fine without any problems. Are there any 
> further checks I could perform? As pointed out by another reader of this 
> list, could it, however, be an alphabetical issue? The name of the 
> package with the information correctly on the first page starts with an 
> upper case letter, while the other one doesn't. If upper case letters 
> are supposed to come before lower case letters in the ordering, all 
> would make sense. It would not be what I would like to have though. ;)
>
> While writing these lines I investigated this behaviour and added a 
> documentation file for function 'AAA' to see where it will be printed in 
> the manual for the package starting with an upper case letter. And as 
> presumed it was put on the very first page. So I think that R internally 
> orders all documentation files, in doing so all documentation files 
> starting with an upper case take precedence over those starting with a 
> lower case letter.
>
> This behaviour is somehow odd, though, a workaround would be of course 
> to rename the documentation file for the package as 
> "00-<package-name>-package.Rd" to assure that it will come first in the 
> manual.
>
> Is this behaviour intentional or is it a bug?

How did you produce the manual?  When I do R CMD Rd2dvi on a package, I 
get the package man page first.  There are other ways to produce the 
manual, and in some cases we may not control the sort order.

Duncan Murdoch


From thothal at sbox.tugraz.at  Fri Jun 26 13:36:50 2009
From: thothal at sbox.tugraz.at (Thorn Thaler)
Date: Fri, 26 Jun 2009 13:36:50 +0200
Subject: [Rd] Rd: pdf manual: package information not on first page
In-Reply-To: <4A44ACA6.3050206@stats.uwo.ca>
References: <4A43AFEC.30901@sbox.tugraz.at> <4A440C41.60602@stats.uwo.ca>
	<4A4476D1.4090904@sbox.tugraz.at> <4A44ACA6.3050206@stats.uwo.ca>
Message-ID: <4A44B2D2.2060407@sbox.tugraz.at>

Duncan Murdoch schrieb:
> How did you produce the manual?  When I do R CMD Rd2dvi on a package, I 
> get the package man page first.  There are other ways to produce the 
> manual, and in some cases we may not control the sort order.

Well, I see. There is a misunderstanding regarding the term "package 
documentation". What I meant (but probably didn't make clear enough ;) 
by "package documentation" is the output generated from the file 
"<package-name>-package.Rd", where I put some information about the 
package itself. The idea was that if you type ?<package-name> you will 
get a short overview of what the package is about.

When I ran "R CMD check" a pdf manual was created conveniently. Since 
I'm new to package writing I was not aware that one has the possibility 
to create another type of (pdf) package documentation via "R CMD 
Rd2dvi". Rd2dvi puts a package summary on the very first page. The page 
number on which the output from <package-name>-package.Rd itself appears 
depends on the file name.

However, the output from Rd2dvi looks much neater, so I'll be happy with 
this version. Thanks for your input.

By the way, is it possible to exclude certain "Rd" files from the 
pdftexing process? The reason why I'd like to do that is, that my 
<package-name>-package.Rd file is mainly the same as the preamble 
created by Rd2dvi (basically a list of the functions of the package). It 
would be convenient to have such a file for the R inline help, but it is 
unnecessary in the pdf manual. Any ideas? (however, i've to confess that 
this is really a minor problem ;)

Thorn


From edd at debian.org  Fri Jun 26 13:55:15 2009
From: edd at debian.org (Dirk Eddelbuettel)
Date: Fri, 26 Jun 2009 06:55:15 -0500
Subject: [Rd] Problem making the manuals (make dvi and make pdf)
In-Reply-To: <5B2F2CD24AD2764D898AF5A7B9A2ABBF011C6D2F@hermes.demogr.mpg.de>
References: <5B2F2CD24AD2764D898AF5A7B9A2ABBF011C6D2F@hermes.demogr.mpg.de>
Message-ID: <19012.46883.237113.239576@ron.nulle.part>


Hi Roland,

On 26 June 2009 at 10:46, Rau, Roland wrote:
| Dear all,
| 
| I am trying to compile and install R from sources on Ubuntu GNU/Linux 64
| bit. It usually worked flawlessly for me for more than 4 years (32bit
| and 64bit on Mandrake/Mandriva, Suse, Debian, Ubuntu). However, I am
| experiencing some problems now -- not during compiling and installing R
| itself but with the manuals.
| 
| Maybe someone can help me with it? I tried to find some information in
| the archives on the web but I was not successful.
| 
| Please let me explain therefore in detail where the problem is (incl.
| some additional information):
| 
| Following the instructions in section 2.2 of the R Installation and
| Administration Manual
| (http://cran.r-project.org/doc/manuals/R-admin.html#Making-the-manuals),
| making the info manuals works fine via "make info"
| 
| However, when I want to make the dvi and pdf manuals, I get the
| following error:
| ======================================================
| 
| Loading texinfo [version 2007-09-03.05]: pdf, fonts, page headings,
| tables,
| conditionals, indexing, sectioning, toc, environments, defuns, macros,
| cross references, insertions, (./epsf.tex
| This is `epsf.tex' v2.7.3 <23 July 2005>
| ) localization, formatting, and turning on texinfo input format.)
| (/usr/share/texmf/tex/lilypond/txi-en.tex
| /usr/share/texmf/tex/lilypond/txi-en.tex:22: Undefined control sequence.
| l.22 \txisetlanguage
|                     {USenglish}{2}{3}
| ? 

Can you try again after uninstalling lilypond?

We do this in an automated fashion all the time on Debian and Ubuntu where is
works fine.  But we do this mostly in 'clean chroot' environments (via
pbuilder) which minimises side effects. I'd think you are simply bitten by
lilypond here.

| ======================================================
| 
| The output I am pasting is from:
| > version
|                _                           
| platform       x86_64-unknown-linux-gnu    
| arch           x86_64                      
| os             linux-gnu                   
| system         x86_64, linux-gnu           
| status                                     
| major          2                           
| minor          9.0                         
| year           2009                        
| month          04                          
| day            17                          
| svn rev        48333                       
| language       R                           
| version.string R version 2.9.0 (2009-04-17)
| 
| 
| I tried it yesterday also with the latest development and patched
| releases --> same result.
| Is it a TeX/LaTeX-problem?

I think so.

And if everything else fails: CRAN does have current R packages for amd64 on
Ubuntu. I use those myself at work.

Dirk

| 
| Of course, I checked whether I have recent versions of makeinfo and
| texi2dvi installed (which is mentioned in the manual). This seems to be
| the case:
| 
| ======================================================
| root at roland-desktop-64bit:/extras/R/R-2.9.0# makeinfo --version
| makeinfo (GNU texinfo) 4.11
| 
| Copyright (C) 2007 Free Software Foundation, Inc.
| License GPLv3+: GNU GPL version 3 or later
| <http://gnu.org/licenses/gpl.html>
| This is free software: you are free to change and redistribute it.
| There is NO WARRANTY, to the extent permitted by law.
| root at roland-desktop-64bit:/extras/R/R-2.9.0# texi2dvi --version
| texi2dvi (GNU Texinfo 4.11) 1.104
| 
| Copyright (C) 2007 Free Software Foundation, Inc.
| License GPLv3+: GNU GPL version 3 or later
| <http://gnu.org/licenses/gpl.html>
| This is free software: you are free to change and redistribute it.
| There is NO WARRANTY, to the extent permitted by law.
| 
| root at roland-desktop-64bit:/extras/R/R-2.9.0# texi2pdf --version
| texi2dvi (GNU Texinfo 4.11) 1.104
| 
| Copyright (C) 2007 Free Software Foundation, Inc.
| License GPLv3+: GNU GPL version 3 or later
| <http://gnu.org/licenses/gpl.html>
| This is free software: you are free to change and redistribute it.
| There is NO WARRANTY, to the extent permitted by law.
| 
| ======================================================
| 
| 
| and finally the output from ./configure
| 
| ======================================================
| 
| R is now configured for x86_64-unknown-linux-gnu
| 
|   Source directory:          .
|   Installation directory:    /usr/local
| 
|   C compiler:                gcc -std=gnu99  -g -O2
|   Fortran 77 compiler:       gfortran  -g -O
| 
|   C++ compiler:              g++  -g -O2
|   Fortran 90/95 compiler:    gfortran -g -O
|   Obj-C compiler:	      
| 
|   Interfaces supported:      X11, tcltk
|   External libraries:        readline
|   Additional capabilities:   PNG, JPEG, iconv, MBCS, NLS
|   Options enabled:           shared BLAS, R profiling
| 
|   Recommended packages:      yes
| 
| ======================================================
| 
| 
| Thanks in advance,
| Roland
| 
| ----------
| This mail has been sent through the MPI for Demographic Research.  Should you receive a mail that is apparently from a MPI user without this text displayed, then the address has most likely been faked. If you are uncertain about the validity of this message, please check the mail header or ask your system administrator for assistance.
| 
| ______________________________________________
| R-devel at r-project.org mailing list
| https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Three out of two people have difficulties with fractions.


From Rau at demogr.mpg.de  Fri Jun 26 14:03:18 2009
From: Rau at demogr.mpg.de (Rau, Roland)
Date: Fri, 26 Jun 2009 14:03:18 +0200
Subject: [Rd] Problem making the manuals (make dvi and make pdf)
References: <5B2F2CD24AD2764D898AF5A7B9A2ABBF011C6D2F@hermes.demogr.mpg.de> 
	<19012.46883.237113.239576@ron.nulle.part>
Message-ID: <5B2F2CD24AD2764D898AF5A7B9A2ABBF011C6D30@hermes.demogr.mpg.de>

Dear Dirk, 

thank you very much!

> -----Original Message-----
> From: Dirk Eddelbuettel [mailto:edd at debian.org] 
> Sent: Friday, June 26, 2009 1:55 PM
> To: Rau, Roland
> Cc: r-devel at r-project.org
> Subject: Re: [Rd] Problem making the manuals (make dvi and make pdf)
> 
> 
> Hi Roland,
> 
> On 26 June 2009 at 10:46, Rau, Roland wrote:
> | Dear all,
> | 
> | I am trying to compile and install R from sources on Ubuntu 
> GNU/Linux 64
> | bit. It usually worked flawlessly for me for more than 4 
> years (32bit
> | and 64bit on Mandrake/Mandriva, Suse, Debian, Ubuntu). However, I am
> | experiencing some problems now -- not during compiling and 
> installing R
> | itself but with the manuals.
> | 
> | Maybe someone can help me with it? I tried to find some 
> information in
> | the archives on the web but I was not successful.
> | 
> | Please let me explain therefore in detail where the problem 
> is (incl.
> | some additional information):
> | 
> | Following the instructions in section 2.2 of the R Installation and
> | Administration Manual
> | 
> (http://cran.r-project.org/doc/manuals/R-admin.html#Making-the
-manuals),
> | making the info manuals works fine via "make info"
> | 
> | However, when I want to make the dvi and pdf manuals, I get the
> | following error:
> | ======================================================
> | 
> | Loading texinfo [version 2007-09-03.05]: pdf, fonts, page headings,
> | tables,
> | conditionals, indexing, sectioning, toc, environments, 
> defuns, macros,
> | cross references, insertions, (./epsf.tex
> | This is `epsf.tex' v2.7.3 <23 July 2005>
> | ) localization, formatting, and turning on texinfo input format.)
> | (/usr/share/texmf/tex/lilypond/txi-en.tex
> | /usr/share/texmf/tex/lilypond/txi-en.tex:22: Undefined 
> control sequence.
> | l.22 \txisetlanguage
> |                     {USenglish}{2}{3}
> | ? 
> 
> Can you try again after uninstalling lilypond?
> 
> We do this in an automated fashion all the time on Debian and 
> Ubuntu where is
> works fine.  But we do this mostly in 'clean chroot' environments (via
> pbuilder) which minimises side effects. I'd think you are 
> simply bitten by
> lilypond here.

It works perfectly now (maybe I should have realized it myself)!
And I don't really need lilypond. With a lot of hard disk space to
spare, I decided to simply use the texlive-full metapackage instead of
manually selecting the LaTeX packages I need or don't need. 

Thanks again,
Roland

----------
This mail has been sent through the MPI for Demographic Research.  Should you receive a mail that is apparently from a MPI user without this text displayed, then the address has most likely been faked. If you are uncertain about the validity of this message, please check the mail header or ask your system administrator for assistance.


From murdoch at stats.uwo.ca  Fri Jun 26 14:27:37 2009
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Fri, 26 Jun 2009 08:27:37 -0400
Subject: [Rd] Rd: pdf manual: package information not on first page
In-Reply-To: <4A44B2D2.2060407@sbox.tugraz.at>
References: <4A43AFEC.30901@sbox.tugraz.at>
	<4A440C41.60602@stats.uwo.ca>	<4A4476D1.4090904@sbox.tugraz.at>
	<4A44ACA6.3050206@stats.uwo.ca> <4A44B2D2.2060407@sbox.tugraz.at>
Message-ID: <4A44BEB9.3060709@stats.uwo.ca>

On 26/06/2009 7:36 AM, Thorn Thaler wrote:
> Duncan Murdoch schrieb:
>> How did you produce the manual?  When I do R CMD Rd2dvi on a package, I 
>> get the package man page first.  There are other ways to produce the 
>> manual, and in some cases we may not control the sort order.
> 
> Well, I see. There is a misunderstanding regarding the term "package 
> documentation". What I meant (but probably didn't make clear enough ;) 
> by "package documentation" is the output generated from the file 
> "<package-name>-package.Rd", where I put some information about the 
> package itself. The idea was that if you type ?<package-name> you will 
> get a short overview of what the package is about.

Right, I understood that.  The code run when you install a package is 
intended to sort such pages to be first in the output, regardless of 
what you name them.

> When I ran "R CMD check" a pdf manual was created conveniently. Since 
> I'm new to package writing I was not aware that one has the possibility 
> to create another type of (pdf) package documentation via "R CMD 
> Rd2dvi". Rd2dvi puts a package summary on the very first page. The page 
> number on which the output from <package-name>-package.Rd itself appears 
> depends on the file name.

R CMD check runs R CMD Rd2dvi, and on my system (in R-devel, I didn't 
check older versions) it puts the package page first.  It uses a number 
of options that may be different from what you chose, but I don't think 
we have an option to control sort order for the man pages.


> However, the output from Rd2dvi looks much neater, so I'll be happy with 
> this version. Thanks for your input.
> 
> By the way, is it possible to exclude certain "Rd" files from the 
> pdftexing process? The reason why I'd like to do that is, that my 
> <package-name>-package.Rd file is mainly the same as the preamble 
> created by Rd2dvi (basically a list of the functions of the package). It 
> would be convenient to have such a file for the R inline help, but it is 
> unnecessary in the pdf manual. Any ideas? (however, i've to confess that 
> this is really a minor problem ;)

I don't think there's currently a simple way to do that. What I'd 
suggest is that you decide on what your most important form of 
documentation is (PDF vs HTML, etc.), and then optimize your Rd files 
for that form.  For example, there's no need to list all functions in 
the package man page:  they're listed in the contents listing that comes 
first, and since it is produced automatically, it's less likely to go 
out of date than your own manually edited listing.

Duncan Murdoch


From ripley at stats.ox.ac.uk  Fri Jun 26 14:48:19 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 26 Jun 2009 13:48:19 +0100 (BST)
Subject: [Rd] can't use ATLAS  or ACML | 2.9.0
In-Reply-To: <4A44715F.4050204@verizon.net>
References: <4A44715F.4050204@verizon.net>
Message-ID: <alpine.LFD.2.00.0906261322090.5203@toucan.stats.ox.ac.uk>

On Fri, 26 Jun 2009, Evan Cooch wrote:

> So, tried again from scratch. Again, CentOS 5.3, which is essentially RHEL 
> 5.3.
>
> ./configure --with-blas="-L/opt/acml4.3.0/gfortran64/lib -lacml"
>
> In config.log, get things like
>
> configure:37199: checking for dgemm_ in -L/opt/acml4.3.0/gfortran64/lib 
> -lacml
> configure:37230: gcc -std=gnu99 -o conftest -g -O2  -I/usr/local/include 
> -L/usr/local/lib64 conftest.c -L/opt/acml4.3.0/gfortran64/lib -lacml  -$
> conftest.c: In function 'main':
> conftest.c:189: warning: implicit declaration of function 'dgemm_'
> /usr/bin/ld: warning: libgfortran.so.3, needed by 
> /opt/acml4.3.0/gfortran64/lib/libacml.so, not found (try using -rpath or 
> -rpath-link)

So you don't have a compatible libgfortran installed (not surprising 
as your OS is rather old): try a version of ACML of comparable age to 
your OS that uses.  (I seem to remember needed ACML 4.1.0 on Fedora 
8.)

We also needed to add /opt/acml4.3.0/gfortran64/lib to the ldconfig 
files (something AMD should organize).

> Try
>
> ./configure --with-blas="-L/usr/lib64/atlas  -lf77blas -latlas"
>
> I get the following
>
>
> configure:37199: checking for dgemm_ in -L/usr/lib64/atlas -lf77blas -latlas
> configure:37230: gcc -std=gnu99 -o conftest -g -O2  -I/usr/local/include 
> -L/usr/local/lib64 conftest.c -L/usr/lib64/atlas -lf77blas -latlas  -lg$
> conftest.c: In function 'main':
> conftest.c:189: warning: implicit declaration of function 'dgemm_'
> /usr/bin/ld: cannot find -lf77blas
> collect2: ld returned 1 exit status
> configure:37236: $? = 1
> configure: failed program was:
>
>
> What puzzles me is that lf77blas is definitely in /usr/lib64/atlas  - but 
> configure couldn't find (?). Perhaps its because 100% of the libs in the 
> atlast subdir are xxx.so.3 (perhaps R config is looking for so.1 libs?).

It is looking for .so or .a (a Linux linker always does).  Where did 
you get ATLAS from?  This is what happens if you install the foo and 
not the foo-devel RPM for some package.  And indeed, on Fedora 10 you 
need the atlas-devel RPM ....

> I suspect that many/most of the problems I'm having with getting R to compile 
> (with BLAS and LAPACK) are related to these basic issues - if I can't do even 
> a simple compile with blas, then whats left?

Ask for local help on your OS!  You seem to be asking many questions 
about your OS here, and be assured that R works with ATLAS and ACML 
flawlessly in well-sorted OS installations.  Things like the need for 
the foo-devel RPM are in the R installation manual which the INSTALL 
file asked you to study (before posting).

Note that a much simpler way (as recommended the manual!) to add an 
optimized BLAS is to switch the libRblas.  E.g. I have a note in my 
build file

gannet% cat I.USED
## later
## mv lib/libRblas.so lib/libRblas.so.keep
## ln -s /opt/acml4.3.0/gfortran64_mp/lib/libacml_mp.so lib/libRblas.so

And most users of R do so little linear algebra that an optimized BLAS 
make a negligible difference in performance (but often an appreciable 
one to accuracy).

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From cooch17 at verizon.net  Fri Jun 26 16:16:26 2009
From: cooch17 at verizon.net (egc)
Date: Fri, 26 Jun 2009 10:16:26 -0400
Subject: [Rd] can't use ATLAS  or ACML | 2.9.0
In-Reply-To: <alpine.LFD.2.00.0906261322090.5203@toucan.stats.ox.ac.uk>
References: <4A44715F.4050204@verizon.net>
	<alpine.LFD.2.00.0906261322090.5203@toucan.stats.ox.ac.uk>
Message-ID: <4A44D83A.7020908@verizon.net>

Brian -

Cheers - followups below.

Prof Brian Ripley wrote:
> On Fri, 26 Jun 2009, Evan Cooch wrote:
>
>> So, tried again from scratch. Again, CentOS 5.3, which is essentially 
>> RHEL 5.3.
>>
>> ./configure --with-blas="-L/opt/acml4.3.0/gfortran64/lib -lacml"
>>
>> In config.log, get things like
>>
>> configure:37199: checking for dgemm_ in 
>> -L/opt/acml4.3.0/gfortran64/lib -lacml
>> configure:37230: gcc -std=gnu99 -o conftest -g -O2  
>> -I/usr/local/include -L/usr/local/lib64 conftest.c 
>> -L/opt/acml4.3.0/gfortran64/lib -lacml  -$
>> conftest.c: In function 'main':
>> conftest.c:189: warning: implicit declaration of function 'dgemm_'
>> /usr/bin/ld: warning: libgfortran.so.3, needed by 
>> /opt/acml4.3.0/gfortran64/lib/libacml.so, not found (try using -rpath 
>> or -rpath-link)
>
> So you don't have a compatible libgfortran installed (not surprising 
> as your OS is rather old): try a version of ACML of comparable age to 
> your OS that uses.  (I seem to remember needed ACML 4.1.0 on Fedora 8.)

Thanks - but I'm not sure I would classify CentOS as 'old' - it is RHEL 
5.3 (basically built straight from open-sourced RHEL code), and RHEL 5.3 
is the current release of the 'flagship' OS from Redhat.

I grant you it *is* old by (say) Fedora standards, which has a release 
schedule measured in months (whereas RHEL is measured in 1-2 years), but 
I was aiming for stability.

>
> We also needed to add /opt/acml4.3.0/gfortran64/lib to the ldconfig 
> files (something AMD should organize).
>
>> Try
>>
>> ./configure --with-blas="-L/usr/lib64/atlas  -lf77blas -latlas"
>>
>> I get the following
>>
>>
>> configure:37199: checking for dgemm_ in -L/usr/lib64/atlas -lf77blas 
>> -latlas
>> configure:37230: gcc -std=gnu99 -o conftest -g -O2  
>> -I/usr/local/include -L/usr/local/lib64 conftest.c -L/usr/lib64/atlas 
>> -lf77blas -latlas  -lg$
>> conftest.c: In function 'main':
>> conftest.c:189: warning: implicit declaration of function 'dgemm_'
>> /usr/bin/ld: cannot find -lf77blas
>> collect2: ld returned 1 exit status
>> configure:37236: $? = 1
>> configure: failed program was:
>>
>>
>> What puzzles me is that lf77blas is definitely in /usr/lib64/atlas  - 
>> but configure couldn't find (?). Perhaps its because 100% of the libs 
>> in the atlast subdir are xxx.so.3 (perhaps R config is looking for 
>> so.1 libs?).
>
> It is looking for .so or .a (a Linux linker always does).  Where did 
> you get ATLAS from?  This is what happens if you install the foo and 
> not the foo-devel RPM for some package.  And indeed, on Fedora 10 you 
> need the atlas-devel RPM ....

Ah - that rings a bell (can you tell I was doing this late into the wee 
hours?). Atlas was distributed as an RPM (or, rather, downloaded via the 
CentOS standard yum repo). Everything in /usr/lib64/atlas is an .so.3 
file - nothing with .so or .a as suffix.

>
>> I suspect that many/most of the problems I'm having with getting R to 
>> compile (with BLAS and LAPACK) are related to these basic issues - if 
>> I can't do even a simple compile with blas, then whats left?
>
> Ask for local help on your OS!  You seem to be asking many questions 
> about your OS here, and be assured that R works with ATLAS and ACML 
> flawlessly in well-sorted OS installations.  Things like the need for 
> the foo-devel RPM are in the R installation manual which the INSTALL 
> file asked you to study (before posting).
Well, I've actually gone through the manual you refer to - missed the 
bit on foo-devel (which applies only to atlas, it would seem) - my 
oversight - mea culpa. However, the documentation doesn't (and isn't 
expected) to elaborate on what you refer to as a 'well-sorted' OS. In 
other words, I had no a priori expectation of a problem - since CneenOS 
is RHEL, and RHEL has a rather large market share. I would have assumed 
(naively, in hindsight) that the combination of CentOS and ACML 4.3.x 
would have been 'well sorted'. (as an aside - some of my friends at Sun 
tell me 'standard Linux' for file structures, libs and such is an 
oxymoron ;-)

It would appear not - at least in this instance. On the other hand, 
CentOS picked up all of my twitchy harddare (RAID cards, special NICs) 
without missing a beat, networked without so much as a single tweak 
being needed, and has performed flawlessly for everything...except 
getting R compiled with ACML support.

>
> Note that a much simpler way (as recommended the manual!) to add an 
> optimized BLAS is to switch the libRblas.  E.g. I have a note in my 
> build file
>
> gannet% cat I.USED
> ## later
> ## mv lib/libRblas.so lib/libRblas.so.keep
> ## ln -s /opt/acml4.3.0/gfortran64_mp/lib/libacml_mp.so lib/libRblas.so
>
> And most users of R do so little linear algebra that an optimized BLAS 
> make a negligible difference in performance (but often an appreciable 
> one to accuracy).

Agreed on the latter point (generally), but I do a fair bit of stuff 
with big matrices, and wanted both accuracy *and* speed.

Wrt to the first point, I tried that in fact (but didn't report - in 
fact, I tried about 15-20 different combinations of various approaches). 
When I try that - using *exactly* that syntax (above), and do the 
compile, I got the following error message when starting R:

/usr/local/lib64/R/bin/exec/R: error while loading shared libraries: 
libacml_mv.so: cannot open shared object file: No such file or directory

So, try

LD_LIBRARY_PATH=/opt/acml4.3.0/gfortran64/lib
export LD_LIBRARY_PATH

Seems to do the trick, but I think I'm botching tweaking 
R_HOME/etc/ldpaths to set this permanently. Is there a doc somewhere on 
how to tweak ldpaths? Sorry if I've missed it...

Again, thanks for wading through my various missives. If R wasn't 
mission critical to my users (and R with 'better blas') wasn't  critical 
to *me*, I wouldn't be so fussed about it.


From kynnjo at gmail.com  Fri Jun 26 20:49:20 2009
From: kynnjo at gmail.com (Kynn Jones)
Date: Fri, 26 Jun 2009 14:49:20 -0400
Subject: [Rd] R data inspection under gdb?
In-Reply-To: <4A43F4C4.5030501@fhcrc.org>
References: <c2350ba40906251440v53b2f00eq75cdd1f405405027@mail.gmail.com>
	<4A43F4C4.5030501@fhcrc.org>
Message-ID: <c2350ba40906261149q35179718oeaa5600087c69933@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090626/ced262e8/attachment.pl>

From kynnjo at gmail.com  Fri Jun 26 21:01:30 2009
From: kynnjo at gmail.com (Kynn Jones)
Date: Fri, 26 Jun 2009 15:01:30 -0400
Subject: [Rd] bug in Rf_PrintValue ?
Message-ID: <c2350ba40906261201o2b2224a8w3e641686702fe40a@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090626/6a4374ec/attachment.pl>

From pauljohn32 at gmail.com  Fri Jun 26 21:43:02 2009
From: pauljohn32 at gmail.com (Paul Johnson)
Date: Fri, 26 Jun 2009 14:43:02 -0500
Subject: [Rd] beginner's guide to C++ programming with R packages?
Message-ID: <13e802630906261243s7b071010ldfe6416e8c0ae304@mail.gmail.com>

Hello, again.

I'm interested to learn how programmers develop & test C/C++ code with
R packages in Linux.  I've been reading R source and the manual on
Writing R Extensions but there are just a couple of details I can't
understand.  I wish I could watch over a developer's shoulder to see
how people actually do this.

I've tested a bit.  I am able to take package.tar.gz file, open it up,
fiddle the source code, and then run

R CMD check package-dir

from the directory above "package-dir" ,

R CMD build package-dir

and

R CMD INSTALL

on the tarball that is produced. Then in R, I can load the package and use it.

That part is "all good", but somewhat tedious.  I don't want to
entirely recompile and reinstall the whole package just to test one
function.  I notice that R CMD check creates a new directory called
"package.Rcheck" and the shared objects and example code of the
package are in there.  Can I force R to use those *.so files instead
of the ones in /usr/lib/R ?


I also wonder "what is wrong with gprof?   In the Writing R Extensions
manual, it describes "oprofile" and "sprof" for Linux. I will try
them, but they are unfamilar to me.  I've used gprof in the past in C
projects, and it is a pretty painless thing to add a compiler flag
-pg, run the program, and then review gmon.out.  The Writing R
Extensions manual does not mention gprof in its section on Linux, but
it does mention it under Solaris.  There is a somewhat ambiguous
statement:

3.4.2 Solaris

On 64-bit (only) Solaris, the standard profiling tool gprof collects
information from shared libraries compiled with -pg.

Does "(only)" here mean to differentiate Solaris from other Linux/Unix
systems?  Or does it differentiate 64bit Solaris from other Solaris?

But this draws me back to the basic question.  I don't want to run R
CMD INSTALL 20 times per hour.  How do developers "actually" test
their code?

pj
-- 
Paul E. Johnson
Professor, Political Science
1541 Lilac Lane, Room 504
University of Kansas


From armstrong.whit at gmail.com  Fri Jun 26 22:17:59 2009
From: armstrong.whit at gmail.com (Whit Armstrong)
Date: Fri, 26 Jun 2009 16:17:59 -0400
Subject: [Rd] beginner's guide to C++ programming with R packages?
In-Reply-To: <13e802630906261243s7b071010ldfe6416e8c0ae304@mail.gmail.com>
References: <13e802630906261243s7b071010ldfe6416e8c0ae304@mail.gmail.com>
Message-ID: <8ec76080906261317g77abf908wa1b9614efd19c489@mail.gmail.com>

> But this draws me back to the basic question. ?I don't want to run R
> CMD INSTALL 20 times per hour. ?How do developers "actually" test
> their code?

check out RUnit for tests.
http://cran.r-project.org/web/packages/RUnit/index.html

as for testing c++ code.  I have taken an approach which is probably
different than most.  I try to build my package as a c++ library that
can be used independent of R.  Then you can test your library with
whatever c++ test suite that you prefer.  Once you are happy, then
simply write bindings to convert R's SEXP objects into something
consumable by your library (usually this is just whatever the SEXP
points at). Using git submodules is a nice way to keep your library
separate from the R interface.

here's an example for you.
tslib, which has it's own c++ test suite (using boost.test):
http://github.com/armstrtw/tslib/blob/5b0fe2fc5ecb393d1dca097c2c19008227eb6c7e/test/test.cpp
and fts which simply implements wrappers to call
tslib:http://github.com/armstrtw/fts/blob/2b6cb4045f852211b9334b43730409a13dd353c0/src/interface.cpp

Also, check out Dirk's Rcpp package, which should make your life
easier if you use c++, and check out my RAbstraction package which
tries to do what Rcpp does using templates.

http://cran.r-project.org/web/packages/Rcpp/index.html
http://github.com/armstrtw/rabstraction/tree/master

-Whit


From jeff.a.ryan at gmail.com  Fri Jun 26 23:12:36 2009
From: jeff.a.ryan at gmail.com (J Ryan)
Date: Fri, 26 Jun 2009 16:12:36 -0500
Subject: [Rd] beginner's guide to C++ programming with R packages?
In-Reply-To: <13e802630906261243s7b071010ldfe6416e8c0ae304@mail.gmail.com>
References: <13e802630906261243s7b071010ldfe6416e8c0ae304@mail.gmail.com>
Message-ID: <D45F7FEE-3B7C-46A3-9BD8-7F98EE9316FB@gmail.com>

If your just looking to build and test a single function written in C/C 
++ you can try:

R CMD SHLIB my.c

Which will produce a object that can be loaded in R with 'dyn.load'.

A simple R script including dyn.load('my.so') with your basic tests  
can then be run with:

R --vanilla < my.R

HTH
Jeff

Jeffrey A. Ryan
jeffrey.ryan at insightalgo.com

ia: insight algorithmics
www.insightalgo.com

On Jun 26, 2009, at 2:43 PM, Paul Johnson <pauljohn32 at gmail.com> wrote:

> Hello, again.
>
> I'm interested to learn how programmers develop & test C/C++ code with
> R packages in Linux.  I've been reading R source and the manual on
> Writing R Extensions but there are just a couple of details I can't
> understand.  I wish I could watch over a developer's shoulder to see
> how people actually do this.
>
> I've tested a bit.  I am able to take package.tar.gz file, open it up,
> fiddle the source code, and then run
>
> R CMD check package-dir
>
> from the directory above "package-dir" ,
>
> R CMD build package-dir
>
> and
>
> R CMD INSTALL
>
> on the tarball that is produced. Then in R, I can load the package  
> and use it.
>
> That part is "all good", but somewhat tedious.  I don't want to
> entirely recompile and reinstall the whole package just to test one
> function.  I notice that R CMD check creates a new directory called
> "package.Rcheck" and the shared objects and example code of the
> package are in there.  Can I force R to use those *.so files instead
> of the ones in /usr/lib/R ?
>
>
> I also wonder "what is wrong with gprof?   In the Writing R Extensions
> manual, it describes "oprofile" and "sprof" for Linux. I will try
> them, but they are unfamilar to me.  I've used gprof in the past in C
> projects, and it is a pretty painless thing to add a compiler flag
> -pg, run the program, and then review gmon.out.  The Writing R
> Extensions manual does not mention gprof in its section on Linux, but
> it does mention it under Solaris.  There is a somewhat ambiguous
> statement:
>
> 3.4.2 Solaris
>
> On 64-bit (only) Solaris, the standard profiling tool gprof collects
> information from shared libraries compiled with -pg.
>
> Does "(only)" here mean to differentiate Solaris from other Linux/Unix
> systems?  Or does it differentiate 64bit Solaris from other Solaris?
>
> But this draws me back to the basic question.  I don't want to run R
> CMD INSTALL 20 times per hour.  How do developers "actually" test
> their code?
>
> pj
> -- 
> Paul E. Johnson
> Professor, Political Science
> 1541 Lilac Lane, Room 504
> University of Kansas
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From macrakis at alum.mit.edu  Sat Jun 27 00:59:53 2009
From: macrakis at alum.mit.edu (Stavros Macrakis)
Date: Fri, 26 Jun 2009 18:59:53 -0400
Subject: [Rd] Bugs in unique of data.frame and matrix
Message-ID: <8b356f880906261559s3f381fdaue64b82e520a1837f@mail.gmail.com>

R version 2.8.1 (2008-12-22) / Windows XP

There are several bugs in unique for data frames and matrices. Please
find minimal reproducible examples below.

          -s

-----A-----

Unique of a vector uses numerical comparison:

> nn <- ((1+2^-52)^(5:22))
> unique(nn)
 [1] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1

While unique of a data frame uses comparison of the 15-digit string:

> unique(data.frame(a=nn))
  a
1 1

Similarly:

> unique(matrix(nn,ncol=1))
     [,1]
[1,]    1

-----B-----

> df <- data.frame(a=c("\r",""),b=c("","\r"))
> unique(df)
   a b
1 \r

> unique(as.matrix(df))
     a    b
[1,] "\r" ""

Though "\r" is no doubt rare in strings, it is perfectly legal.

-----C-----

For vectors and data frames, unique preserves the POSIXct class:

dd <- as.POSIXct('1999-1-1')
> unique(dd)
[1] "1999-01-01 EST"

> unique(data.frame(a=dd))
           a
1 1999-01-01

But for matrices, it converts to the underlying number:

> unique(matrix(dd))
          [,1]
[1,] 915166800

-----workaround-----

The first two bugs can be worked around by converting the matrix to a
list of vectors, calling unique, then converting back:

    library(plyr)
    laply(unique(alply(matrix(nn,ncol=1),1,identity)),identity,.drop=FALSE)
    laply(unique(alply(mm,1,identity)),identity,.drop=FALSE)


From mtmorgan at fhcrc.org  Sat Jun 27 01:09:53 2009
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Fri, 26 Jun 2009 16:09:53 -0700
Subject: [Rd] bug in Rf_PrintValue ?
In-Reply-To: <c2350ba40906261201o2b2224a8w3e641686702fe40a@mail.gmail.com>
References: <c2350ba40906261201o2b2224a8w3e641686702fe40a@mail.gmail.com>
Message-ID: <4A455541.2000102@fhcrc.org>

Kynn Jones wrote:
> I'm very green with R, so maybe this is not a bug, but it looks like one to
> me.  The following program segfaults at the second call to Rf_PrintValue().
>  To failure depends on the value of the y-string.  E.g., if I change it from
> "coverage" to, say, "COVERAGE", the segfault does not occur.
> 
> /* bug.c */
> #include <stdio.h>
> #include <Rinternals.h>
> #include <Rembedded.h>
> 
> int main(int argc, char **argv) {
>   char *x = "foo";
>   char *y = "coverage";
>   SEXP x_r, y_r;
> 
>   Rf_initEmbeddedR(argc, argv);
>   PROTECT( x_r = mkChar( x ) );

mkChar creates a CHARSXP. These are not normally user-visible, but
instead are placed into a STRSXP (vector type of 'character' in R). So
you want to

    PROTECT( x_r = allocVector(STRSXP, 1) );
    SET_STRING_ELT(x_r, 0, mkChar( x ));

(There is also mkString( x ) for the special case of constructing
character(1)).

I think the segfault is because the CHARSXP returned by mkChar is
initialized with information different from that expected of
user-visible SEXPs (I think it is the information on chaining the node
to the hash table; see Defn.h:120 and memory.c:2844); I think the
success of Rf_PrintValue on 'foo' is a ghost left over from when
CHARSXPs were user-visible.

Martin

>   Rf_PrintValue( x_r );
>   printf( "OK\n" );
> 
>   PROTECT( y_r = mkChar( y ) );
>   Rf_PrintValue( y_r );
>   printf( "OK\n" );
> 
>   UNPROTECT( 2 );
>   return 0;
> }
> 
> I compile this code with:
> 
> % env -i PATH=/bin:/usr/bin ./myR/bin/R CMD LINK gcc -g
> -I./R-2.9.0/src/include -L./myR/lib64/R/lib -lR -lRblas bug.c -o bug
> 
> A run looks like this:
> 
> % env -i PATH=/bin:/usr/bin R_HOME=$(./myR/bin/R RHOME) ./bug -q --vanilla
> <CHARSXP: "foo">
> OK
> <CHARSXP: "coverage">
> 
>  *** caught segfault ***
> address 0x6c6c756e2e8d, cause 'memory not mapped'
> 
> Possible actions:
> 1: abort (with core dump, if enabled)
> 2: normal R exit
> 3: exit R without saving workspace
> 4: exit R saving workspace
> Selection: 1
> aborting ...
> zsh: segmentation fault  env -i PATH=/bin:/usr/bin R_HOME=$(./myR/bin/R
> RHOME) ./bug -q --vanilla
> 
> 
> I think the problem has to do with the fact that there may already exist a
> cached copy of "coverage" .
> 
> Regards,
> 
> Kynn
> 
> PS: Any comments on my code would be very welcome; I'm very much the noob
> with all this.
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From tplate at acm.org  Sat Jun 27 01:50:26 2009
From: tplate at acm.org (Tony Plate)
Date: Fri, 26 Jun 2009 17:50:26 -0600
Subject: [Rd] should Sys.glob() cope with a UNC windows path beginning with
	backslashes?
Message-ID: <4A455EC2.5020905@acm.org>

I find that Sys.glob() doesn't like UNC paths where the initial slashes are backslashes.  The help page for Sys.glob() doesn't specificly mention UNC paths, but does say: "File paths in Windows are interpreted with separator \ or /."  Is the failure to treat a path beginning with a double-backslash as a UNC network drive path the intended behavior?

E.g., on a Windows system where \\foo is a network drive and \\foo\bar exists, I see:

> Sys.glob("//foo/bar")
[1] "//foo/bar"
> Sys.glob("//foo\\bar")
[1] "//foo\\bar"
> Sys.glob("\\\\foo/bar")
character(0)
> Sys.glob("\\\\foo\\bar")
> 
(the pattern of behavior seems to be that initial backslashes are not equivalent to forward slashes, but later backslashes are.)

This is not a big deal, but I noticed it because it results in Rcmd check giving a spurious warning when started from a cygwin shell with a working directory that is a network drive specified as a UNC path.  This happens because mandir in tools:::.writePkgIndices has the form \\foo/bar/R/packages/mypkg/man, which results in the false warning "there is a 'man' dir but no help pages in this package."  A simple workaround was to use a drive-letter mount for the network drive.

> sessionInfo()
R version 2.9.1 (2009-06-26) 
i386-pc-mingw32 

locale:
LC_COLLATE=English_United States.1252;LC_CTYPE=English_United States.1252;LC_MONETARY=English_United States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     
> 

-- Tony Plate


From ripley at stats.ox.ac.uk  Sat Jun 27 07:16:57 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sat, 27 Jun 2009 06:16:57 +0100 (BST)
Subject: [Rd] should Sys.glob() cope with a UNC windows path beginning
 with backslashes?
In-Reply-To: <4A455EC2.5020905@acm.org>
References: <4A455EC2.5020905@acm.org>
Message-ID: <alpine.LFD.2.00.0906270607460.14974@auk.stats.ox.ac.uk>

On Fri, 26 Jun 2009, Tony Plate wrote:

> I find that Sys.glob() doesn't like UNC paths where the initial slashes are 
> backslashes.  The help page for Sys.glob() doesn't specificly mention UNC 
> paths, but does say: "File paths in Windows are interpreted with separator \ 
> or /."  Is the failure to treat a path beginning with a double-backslash as a 
> UNC network drive path the intended behavior?

Yes.  There are general warnings about non-POSIX Windows paths in 
several of the help files.

The following comments should alert you to possible restrictions:

   The \code{glob} system call is not part of Windows, and we supply an
   emulation.

   File paths in Windows are interpreted with separator \code{\\} or
   \code{/}.  Paths with a drive but relative (such as \code{c:foo\\bar})
   are tricky, but an attempt is made to handle them correctly.

If you want to submit a well-tested patch, it will be considered.

>
> E.g., on a Windows system where \\foo is a network drive and \\foo\bar 
> exists, I see:
>
>> Sys.glob("//foo/bar")
> [1] "//foo/bar"
>> Sys.glob("//foo\\bar")
> [1] "//foo\\bar"
>> Sys.glob("\\\\foo/bar")
> character(0)
>> Sys.glob("\\\\foo\\bar")
>> 
> (the pattern of behavior seems to be that initial backslashes are not 
> equivalent to forward slashes, but later backslashes are.)
>
> This is not a big deal, but I noticed it because it results in Rcmd check 
> giving a spurious warning when started from a cygwin shell with a working 
> directory that is a network drive specified as a UNC path.  This happens 
> because mandir in tools:::.writePkgIndices has the form 
> \\foo/bar/R/packages/mypkg/man, which results in the false warning "there is 
> a 'man' dir but no help pages in this package."  A simple workaround was to 
> use a drive-letter mount for the network drive.
>
>> sessionInfo()
> R version 2.9.1 (2009-06-26) i386-pc-mingw32 
> locale:
> LC_COLLATE=English_United States.1252;LC_CTYPE=English_United 
> States.1252;LC_MONETARY=English_United 
> States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base 
>> 
>
> -- Tony Plate
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From cgb at datanalytics.com  Sat Jun 27 17:44:39 2009
From: cgb at datanalytics.com (Carlos J. Gil Bellosta)
Date: Sat, 27 Jun 2009 17:44:39 +0200
Subject: [Rd] Robust, platform independent method to check for python
Message-ID: <1246117479.4926.11.camel@kropotkin>

Hello,

I have been unsuccessfully struggling for a programmatical method to
find out whether and where Python is installed.

The reason is that I am developing a package that depends on python.

On UNIX/UNIX-like systems I can quite safely assume that python is
directly callable via system if installed. 

My main problems is Windows, though...

Has anybody faced this problem before?

Best regards,

Carlos J. Gil Bellosta
http://www.datanalytics.com


From ggrothendieck at gmail.com  Sat Jun 27 18:01:34 2009
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sat, 27 Jun 2009 12:01:34 -0400
Subject: [Rd] Robust, platform independent method to check for python
In-Reply-To: <1246117479.4926.11.camel@kropotkin>
References: <1246117479.4926.11.camel@kropotkin>
Message-ID: <971536df0906270901u64551ccco8dfc6ca59056f511@mail.gmail.com>

If you can assume its on your path then try this:

pth <- sapply(strsplit(Sys.getenv("PATH"), ";"), function(x)
file.path(x, "python.exe", fsep = "\\"))
pth[file.exists(pth)][1]

On Sat, Jun 27, 2009 at 11:44 AM, Carlos J. Gil
Bellosta<cgb at datanalytics.com> wrote:
> Hello,
>
> I have been unsuccessfully struggling for a programmatical method to
> find out whether and where Python is installed.
>
> The reason is that I am developing a package that depends on python.
>
> On UNIX/UNIX-like systems I can quite safely assume that python is
> directly callable via system if installed.
>
> My main problems is Windows, though...
>
> Has anybody faced this problem before?
>
> Best regards,
>
> Carlos J. Gil Bellosta
> http://www.datanalytics.com
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From romain.francois at dbmail.com  Sat Jun 27 19:00:58 2009
From: romain.francois at dbmail.com (Romain Francois)
Date: Sat, 27 Jun 2009 19:00:58 +0200
Subject: [Rd] Robust, platform independent method to check for python
In-Reply-To: <1246117479.4926.11.camel@kropotkin>
References: <1246117479.4926.11.camel@kropotkin>
Message-ID: <4A46504A.2030005@dbmail.com>

I actually have the same question, about ant. I assume this would be 
what the SystemRequirements field in a package DESCRIPTION is for, but 
at the moment it seems unused. Is there a plan about this ?

Romain

On 06/27/2009 05:44 PM, Carlos J. Gil Bellosta wrote:
> Hello,
>
> I have been unsuccessfully struggling for a programmatical method to
> find out whether and where Python is installed.
>
> The reason is that I am developing a package that depends on python.
>
> On UNIX/UNIX-like systems I can quite safely assume that python is
> directly callable via system if installed.
>
> My main problems is Windows, though...
>
> Has anybody faced this problem before?
>
> Best regards,
>
> Carlos J. Gil Bellosta
> http://www.datanalytics.com
>    

-- 
Romain Francois
Independent R Consultant
+33(0) 6 28 91 30 30
http://romainfrancois.blog.free.fr


From steve at revolution-computing.com  Sat Jun 27 19:51:16 2009
From: steve at revolution-computing.com (Steve Weston)
Date: Sat, 27 Jun 2009 13:51:16 -0400
Subject: [Rd] Robust, platform independent method to check for python
In-Reply-To: <971536df0906270901u64551ccco8dfc6ca59056f511@mail.gmail.com>
References: <1246117479.4926.11.camel@kropotkin>
	<971536df0906270901u64551ccco8dfc6ca59056f511@mail.gmail.com>
Message-ID: <4f7bf0100906271051n101fc510j372478f309f36638@mail.gmail.com>

You can also try to find Python on Windows machines by
reading the registry using the R readRegistry function (added
sometime around R 2.7.0, I think).  You can't count on the
information being there, but it often is, depending on how
Python was installed.

Using the registry seems to work better than using PATH,
since the standard Python installer doesn't update PATH,
although the ActiveState Python installer does.  But both
approaches can fail, depending on the options that were
specified when Python was installed.

Good luck,

- Steve


On Sat, Jun 27, 2009 at 12:01 PM, Gabor
Grothendieck<ggrothendieck at gmail.com> wrote:
> If you can assume its on your path then try this:
>
> pth <- sapply(strsplit(Sys.getenv("PATH"), ";"), function(x)
> file.path(x, "python.exe", fsep = "\\"))
> pth[file.exists(pth)][1]
>
> On Sat, Jun 27, 2009 at 11:44 AM, Carlos J. Gil
> Bellosta<cgb at datanalytics.com> wrote:
>> Hello,
>>
>> I have been unsuccessfully struggling for a programmatical method to
>> find out whether and where Python is installed.
>>
>> The reason is that I am developing a package that depends on python.
>>
>> On UNIX/UNIX-like systems I can quite safely assume that python is
>> directly callable via system if installed.
>>
>> My main problems is Windows, though...
>>
>> Has anybody faced this problem before?
>>
>> Best regards,
>>
>> Carlos J. Gil Bellosta
>> http://www.datanalytics.com
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>



-- 
Steve Weston
REvolution Computing
One Century Tower | 265 Church Street, Suite 1006
New Haven, CT  06510
P: 203-777-7442 x266 | www.revolution-computing.com


From ggrothendieck at gmail.com  Sat Jun 27 22:04:56 2009
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sat, 27 Jun 2009 16:04:56 -0400
Subject: [Rd] Robust, platform independent method to check for python
In-Reply-To: <4f7bf0100906271051n101fc510j372478f309f36638@mail.gmail.com>
References: <1246117479.4926.11.camel@kropotkin>
	<971536df0906270901u64551ccco8dfc6ca59056f511@mail.gmail.com> 
	<4f7bf0100906271051n101fc510j372478f309f36638@mail.gmail.com>
Message-ID: <971536df0906271304g43c03708t57ef10486c8cc7ea@mail.gmail.com>

I think that most python installations won't have a
registry key set.  I have python 2.6 and 2.5 on my
machine but searching the registry found no
occurrence of the string python.   At least the path method
has the advantage that if its not set then the user
only has to modify the path whereas if its not
in the registry the user would have to reinstall python
and to make it worse they would have to use
specific distributions that install a key. Furthermore
they would be stuck if they can't access the registry
on their machine.

Also if its on the path then you don't actually need
to find its location as system("python ...") or
shell("python ...") should find it itself.  For
example, if you have python on  your path try
   system("python --help")
from the R command line.

Depending on how much work you are willing to do
you could check the path, the registry and common
locations such as c:\Python26, c:\Python,
c:\Program Files\Python, etc. and provide a
pythonpath= argument to your function so if even
all those don't work the user can supply the path.

Here is how two other packages handle this

1. read.xls in the gdata package uses perl and the way
it works is to assume that perl is on the path and if
not there is an argument to the function so that the
user can specify its location.

2. The rSymPy package uses python via jython (python
running on java) and actually includes the entire jython
in the package itself to eliminate external dependencies.
If your python code is pure python it should run on jython
in which case you could simply add rSymPy as a dependency
and then use jython from it.  That would work cross platform
and the only dependency eternal to R would be java itself
but that is nearly universal -- much more prevalent than pytyhon.

One thing that would be convenient would be if R had a
package for each of the common scripting languages
such as perl, python and ruby that included the respective
language processor.  This would be help even if
there were no sophisticated interface (as in the case with
tcl) simply so that other packages that provide interfaces to
code in those languages could know where the
scripting language processor is located.

On Sat, Jun 27, 2009 at 1:51 PM, Steve
Weston<steve at revolution-computing.com> wrote:
> You can also try to find Python on Windows machines by
> reading the registry using the R readRegistry function (added
> sometime around R 2.7.0, I think). ?You can't count on the
> information being there, but it often is, depending on how
> Python was installed.
>
> Using the registry seems to work better than using PATH,
> since the standard Python installer doesn't update PATH,
> although the ActiveState Python installer does. ?But both
> approaches can fail, depending on the options that were
> specified when Python was installed.
>
> Good luck,
>
> - Steve
>
>
> On Sat, Jun 27, 2009 at 12:01 PM, Gabor
> Grothendieck<ggrothendieck at gmail.com> wrote:
>> If you can assume its on your path then try this:
>>
>> pth <- sapply(strsplit(Sys.getenv("PATH"), ";"), function(x)
>> file.path(x, "python.exe", fsep = "\\"))
>> pth[file.exists(pth)][1]
>>
>> On Sat, Jun 27, 2009 at 11:44 AM, Carlos J. Gil
>> Bellosta<cgb at datanalytics.com> wrote:
>>> Hello,
>>>
>>> I have been unsuccessfully struggling for a programmatical method to
>>> find out whether and where Python is installed.
>>>
>>> The reason is that I am developing a package that depends on python.
>>>
>>> On UNIX/UNIX-like systems I can quite safely assume that python is
>>> directly callable via system if installed.
>>>
>>> My main problems is Windows, though...
>>>
>>> Has anybody faced this problem before?
>>>
>>> Best regards,
>>>
>>> Carlos J. Gil Bellosta
>>> http://www.datanalytics.com
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
>
>
> --
> Steve Weston
> REvolution Computing
> One Century Tower | 265 Church Street, Suite 1006
> New Haven, CT ?06510
> P: 203-777-7442 x266 | www.revolution-computing.com
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From steve at revolution-computing.com  Sat Jun 27 23:07:58 2009
From: steve at revolution-computing.com (Steve Weston)
Date: Sat, 27 Jun 2009 17:07:58 -0400
Subject: [Rd] Robust, platform independent method to check for python
In-Reply-To: <971536df0906271304g43c03708t57ef10486c8cc7ea@mail.gmail.com>
References: <1246117479.4926.11.camel@kropotkin>
	<971536df0906270901u64551ccco8dfc6ca59056f511@mail.gmail.com>
	<4f7bf0100906271051n101fc510j372478f309f36638@mail.gmail.com>
	<971536df0906271304g43c03708t57ef10486c8cc7ea@mail.gmail.com>
Message-ID: <4f7bf0100906271407t73d17af3s960362845ea74fd8@mail.gmail.com>

On Sat, Jun 27, 2009 at 4:04 PM, Gabor
Grothendieck<ggrothendieck at gmail.com> wrote:
> I think that most python installations won't have a
> registry key set. ?I have python 2.6 and 2.5 on my
> machine but searching the registry found no
> occurrence of the string python. ? At least the path method

The Python 2.5 installer from python.org used to
use the registry key "Software\Python\PythonCore",
at least on Windows XP and 2000.  But I don't believe
it ever sets PATH.  I was simply suggesting that if
you want the greatest likelihood of finding python.exe,
you may want to try both methods.  It all depends on
how bullet-proof you want your installation procedure
to be.

> has the advantage that if its not set then the user
> only has to modify the path whereas if its not
> in the registry the user would have to reinstall python
> and to make it worse they would have to use
> specific distributions that install a key. Furthermore
> they would be stuck if they can't access the registry
> on their machine.

If I was to use only one of the two methods, I would
use PATH because it's fairly easy to set PATH, and
it's a more portable solution.  But many of our
Windows users don't know about PATH, so it may
be worth checking in the registry if python.exe isn't
in PATH, rather than requiring the user to do some
manual reconfiguration.

But Vista seems to have changed the registry in
some confusing ways.  It may not be worth the
trouble.

-- 
Steve Weston
REvolution Computing
One Century Tower | 265 Church Street, Suite 1006
New Haven, CT  06510
P: 203-777-7442 x266 | www.revolution-computing.com


From seth at userprimary.net  Sun Jun 28 19:02:08 2009
From: seth at userprimary.net (Seth Falcon)
Date: Sun, 28 Jun 2009 10:02:08 -0700
Subject: [Rd] bug in Rf_PrintValue ?
In-Reply-To: <4A455541.2000102@fhcrc.org>
References: <c2350ba40906261201o2b2224a8w3e641686702fe40a@mail.gmail.com>
	<4A455541.2000102@fhcrc.org>
Message-ID: <20090628170208.GH383@ziti.local>

Hi,


* Kynn Jones wrote:
> > I'm very green with R, so maybe this is not a bug, but it looks like one to
> > me.  The following program segfaults at the second call to
> > Rf_PrintValue().

Yes, I think you found a bug.

* On 2009-06-26 at 16:09 -0700 Martin Morgan wrote:
> mkChar creates a CHARSXP. These are not normally user-visible, but
> instead are placed into a STRSXP (vector type of 'character' in R). So
> you want to
> 
>     PROTECT( x_r = allocVector(STRSXP, 1) );
>     SET_STRING_ELT(x_r, 0, mkChar( x ));
> 
> (There is also mkString( x ) for the special case of constructing
> character(1)).
> 
> I think the segfault is because the CHARSXP returned by mkChar is
> initialized with information different from that expected of
> user-visible SEXPs (I think it is the information on chaining the node
> to the hash table; see Defn.h:120 and memory.c:2844); I think the
> success of Rf_PrintValue on 'foo' is a ghost left over from when
> CHARSXPs were user-visible.

CHARSXPs are not intended to be user-visible.  However, Rf_PrintValue
should not segfault either.  Indeed the root cause was attempting to
print the attributes for the CHARSXP which have been repurposed for
handling the CHARSXP cache.

I have patched R-devel so that PrintValue works as expected on
CHARSXPs.  The original code should now work without crashing.  But
this should really only be used to assist in debugging.  CHARSXPs
should never be exposed at the user level and should instead be
elements of a character vector (STRSXP).

+ seth

--
Seth Falcon
http://userprimary.net/user


From Troy.Robertson at aad.gov.au  Mon Jun 29 03:50:17 2009
From: Troy.Robertson at aad.gov.au (Troy Robertson)
Date: Mon, 29 Jun 2009 11:50:17 +1000
Subject: [Rd] S4 and connection slot [Sec=Unclassified]
Message-ID: <42C7503E0B99F248B06BC65E7D2B4E020122C50FB2A3@EX2K7-CCR.AAD.GOV.AU>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090629/d5f56e91/attachment.pl>

From stvjc at channing.harvard.edu  Mon Jun 29 05:55:30 2009
From: stvjc at channing.harvard.edu (Vincent Carey)
Date: Sun, 28 Jun 2009 23:55:30 -0400
Subject: [Rd] when prompt() throws an error...
Message-ID: <2c3c9e80906282055i2a05566eyfc65f62a60982da5@mail.gmail.com>

output is lost until sink() is issued...  the 'problem' shown in the following
example lies in utils::promptData

> setClass("A", representation(x="numeric"))
[1] "A"
> Z = new("A", x=4)
> prompt(Z)
Created file named 'Z.Rd'.
Edit the file and move it to the appropriate directory.
> setClass("A", representation(x="numeric", y="numeric"))
[1] "A"
> prompt(Z)
Error in FUN(c("x", "y")[[2L]], ...) :
  no slot of name "y" for this object of class "A"
>
> date()
> sink()
> date()
[1] "Sun Jun 28 23:45:35 2009"
> sessionInfo()
R version 2.10.0 Under development (unstable) (2009-06-23 r48824)
x86_64-unknown-linux-gnu

locale:
[1] C

attached base packages:
[1] stats     graphics  grDevices datasets  utils     methods   base

other attached packages:
[1] ALL_1.4.5     Biobase_2.5.4

loaded via a namespace (and not attached):
[1] tools_2.10.0


-- 
Vincent Carey, PhD
Biostatistics, Channing Lab
617 525 2265


From Troy.Robertson at aad.gov.au  Mon Jun 29 06:39:55 2009
From: Troy.Robertson at aad.gov.au (Troy Robertson)
Date: Mon, 29 Jun 2009 14:39:55 +1000
Subject: [Rd] S4 and connection slot [Sec=Unclassified]
In-Reply-To: <4A484147.8090603@fhcrc.org>
Message-ID: <42C7503E0B99F248B06BC65E7D2B4E020122C50FB2AB@EX2K7-CCR.AAD.GOV.AU>


Right you are Martin,

When you simplify things right down your code below works.

I had kept getting the error below:

Error in validObject(.Object) :
  invalid class "KrillEnvironment" object: class for slot "datafileConn" ("file")

But now realise that it is when the class extends '.environment' and passes through the .xData slot:
--------------------------------
setClass("Element",representation=representation(datafileConn="file"), contains=".environment")

setMethod("initialize", "Element",
  function(.Object,.xData=new.env(parent=emptyenv())) {
    .Object <- callNextMethod(.Object, .xData=.xData)
    return(.Object)
  }
)

s <- new("Element")
--------------------------------

Not sure why that changes things though?

Troy

> -----Original Message-----
> From: Martin Morgan [mailto:mtmorgan at fhcrc.org]
> Sent: Monday, 29 June 2009 2:21 PM
> To: Troy Robertson
> Subject: Re: [Rd] S4 and connection slot [Sec=Unclassified]
>
> Troy Robertson wrote:
> > Hi all,
> >
> >
> >
> > I am having a problem trying to declare a slot representation to hold a
> file connection.
> >
> > With V2.8.0 I had been using:
> >
> >
> >
> > setClass("Element",
> >
> >     representation(
> >
> >         [other slots removed],
> >
> >         datafileConn    = setOldClass(c("file","connection"))
> >
> >     )
> >
> > )
> >
>
> I think
>
> setOldClass(c("file", "connection"))
>
> setClass("Element",
>          representation=representation(datafileConn="file"))
>
> getClass("file")
> getClass("Element")
>
> but I don't usually use S3 classes so I'm not sure...
>
> Martin
>
> >
> >
> > This resulted in a warning but still ran okay.
> >
> >
> >
> > No however with V2.9.0 I am getting an error:
> >
> >
> >
> > Error in representation(state = "list", initialState = "list", polygons
> = "list",  :
> >
> >   element 12 of the representation was not a single character string
> >
> >
> >
> > How can I declare a slot of the appropriate class?  The strings
> "connection", "file" fail.
> >
> >
> >
> > Troy
> >
> >
> >
> >
> >
> > Troy Robertson
> >
> > Database and Computing Support Provider
> >
> > Southern Ocean Ecosystems, ERM/Fish
> >
> > Australian Antarctic Division
> >
> > Channel Highway, Kingston 7050
> >
> > PH: 03 62323571
> >
> > Troy.Robertson at aad.gov.au
> >
> >
> >
> >
> >
> __________________________________________________________________________
> _
> >
> >     Australian Antarctic Division - Commonwealth of Australia
> > IMPORTANT: This transmission is intended for the addressee only. If you
> are not the
> > intended recipient, you are notified that use or dissemination of this
> communication is
> > strictly prohibited by Commonwealth law. If you have received this
> transmission in error,
> > please notify the sender immediately by e-mail or by telephoning +61 3
> 6232 3209 and
> > DELETE the message.
> >         Visit our web site at http://www.antarctica.gov.au/
> >
> __________________________________________________________________________
> _
> >
> >       [[alternative HTML version deleted]]
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel

___________________________________________________________________________

    Australian Antarctic Division - Commonwealth of Australia
IMPORTANT: This transmission is intended for the addressee only. If you are not the
intended recipient, you are notified that use or dissemination of this communication is
strictly prohibited by Commonwealth law. If you have received this transmission in error,
please notify the sender immediately by e-mail or by telephoning +61 3 6232 3209 and
DELETE the message.
        Visit our web site at http://www.antarctica.gov.au/
___________________________________________________________________________


From ripley at stats.ox.ac.uk  Mon Jun 29 11:34:38 2009
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 29 Jun 2009 10:34:38 +0100 (BST)
Subject: [Rd] Removing support for --without-iconv
Message-ID: <alpine.LFD.2.00.0906291026100.14580@gannet.stats.ox.ac.uk>

We made support for a sufficiently general iconv 'essential' in R 
2.5.0 and have been giving configure warnings on --without-iconv ever 
since.  We originally announced that --without-iconv would be 
available in 2.5.x only.

The delay in making iconv compulsory was down to problems with 
installing GNU iconv from public repositories on AIX and 64-bit 
Solaris, but both are now resolved (see the latest R-admin manual, in 
R-patched or R-devel).

So we now propose to make iconv compulsory as from R 2.10.0.  If 
anyone has a compelling reason why this would cause difficulties, 
please post a deatialed case during the next week.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From bates at stat.wisc.edu  Mon Jun 29 11:49:33 2009
From: bates at stat.wisc.edu (Douglas Bates)
Date: Mon, 29 Jun 2009 04:49:33 -0500
Subject: [Rd] beginner's guide to C++ programming with R packages?
In-Reply-To: <13e802630906261243s7b071010ldfe6416e8c0ae304@mail.gmail.com>
References: <13e802630906261243s7b071010ldfe6416e8c0ae304@mail.gmail.com>
Message-ID: <40e66e0b0906290249w422ccb42u4313a7922197f18d@mail.gmail.com>

On Fri, Jun 26, 2009 at 2:43 PM, Paul Johnson<pauljohn32 at gmail.com> wrote:
> Hello, again.
>
> I'm interested to learn how programmers develop & test C/C++ code with
> R packages in Linux. ?I've been reading R source and the manual on
> Writing R Extensions but there are just a couple of details I can't
> understand. ?I wish I could watch over a developer's shoulder to see
> how people actually do this.
>
> I've tested a bit. ?I am able to take package.tar.gz file, open it up,
> fiddle the source code, and then run
>
> R CMD check package-dir
>
> from the directory above "package-dir" ,
>
> R CMD build package-dir
>
> and
>
> R CMD INSTALL

For your purposes it is probably better to avoid building a new tar.gz
file and combine the last two steps as

R CMD INSTALL package-dir

The install process uses the make utility which will check which of
the object files need to be recompiled.  If you only modify one source
file it will be the only file recompiled.
> on the tarball that is produced. Then in R, I can load the package and use it.
>
> That part is "all good", but somewhat tedious. ?I don't want to
> entirely recompile and reinstall the whole package just to test one
> function. ?I notice that R CMD check creates a new directory called
> "package.Rcheck" and the shared objects and example code of the
> package are in there. ?Can I force R to use those *.so files instead
> of the ones in /usr/lib/R ?
>
>
> I also wonder "what is wrong with gprof? ? In the Writing R Extensions
> manual, it describes "oprofile" and "sprof" for Linux. I will try
> them, but they are unfamilar to me. ?I've used gprof in the past in C
> projects, and it is a pretty painless thing to add a compiler flag
> -pg, run the program, and then review gmon.out. ?The Writing R
> Extensions manual does not mention gprof in its section on Linux, but
> it does mention it under Solaris. ?There is a somewhat ambiguous
> statement:
>
> 3.4.2 Solaris
>
> On 64-bit (only) Solaris, the standard profiling tool gprof collects
> information from shared libraries compiled with -pg.
>
> Does "(only)" here mean to differentiate Solaris from other Linux/Unix
> systems? ?Or does it differentiate 64bit Solaris from other Solaris?
>
> But this draws me back to the basic question. ?I don't want to run R
> CMD INSTALL 20 times per hour. ?How do developers "actually" test
> their code?
>
> pj
> --
> Paul E. Johnson
> Professor, Political Science
> 1541 Lilac Lane, Room 504
> University of Kansas
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From pokar at mimuw.edu.pl  Sun Jun 28 18:10:10 2009
From: pokar at mimuw.edu.pl (pokar at mimuw.edu.pl)
Date: Sun, 28 Jun 2009 18:10:10 +0200 (CEST)
Subject: [Rd] pbeta (PR#13786)
Message-ID: <20090628161010.1646F283031C@mail.pubhealth.ku.dk>

Full_Name: Piotr Pokarowski
Version: 2.9.0
OS: linux or windows
Submission from: (NULL) (212.76.37.160)


Dear R Development Core Team,

I would like to submit a bug in pbeta and, consequently, in  pf.
The function -pbeta(x,.5,2047,lower.tail=F,log.p=T) increases
roughly linearly in [.27, .292], next it is equal to Inf in [.293,.299] and
in [.3,.32] it increases linearly again. Please check:
curve(-pbeta(x,.5,2047,lower.tail=F,log.p=T),.27,.32)

Best regards,

Piotr Pokarowski


From mtmorgan at fhcrc.org  Mon Jun 29 15:19:32 2009
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Mon, 29 Jun 2009 06:19:32 -0700
Subject: [Rd] S4 and connection slot [Sec=Unclassified]
In-Reply-To: <42C7503E0B99F248B06BC65E7D2B4E020122C50FB2AB@EX2K7-CCR.AAD.GOV.AU>
References: <42C7503E0B99F248B06BC65E7D2B4E020122C50FB2AB@EX2K7-CCR.AAD.GOV.AU>
Message-ID: <4A48BF64.7070004@fhcrc.org>

Troy Robertson wrote:
> Right you are Martin,
> 
> When you simplify things right down your code below works.
> 
> I had kept getting the error below:
> 
> Error in validObject(.Object) :
>   invalid class "KrillEnvironment" object: class for slot "datafileConn" ("file")
> 
> But now realise that it is when the class extends '.environment' and passes through the .xData slot:

I think the problem now is that the object is not initialized properly,
specifically that the 'datafileConn' slot is NULL, but should be 'file'.
This is true of the simpler case as well

> setClass("Element", representation=representation(datafileConn="file"))
[1] "Element"
> validObject(new("Element"))
Error in validObject(new("Element")) :
  invalid class "Element" object: invalid object for slot "datafileConn"
in class "Element": got class "NULL", should be or extend class "file"

datafileConn needs to be assigned appropriately in the class prototype
(but then all instances would inherit the same connection) or in the
initialize method.

I'm not sure that including a connection in a slot is going to be a good
idea, though -- a connection has reference-like semantics, so you can
end up with multiple objects pointing to the same connection, Also when
an object is garbage collected the connection will not be closed
automatically.

Martin

> --------------------------------
> setClass("Element",representation=representation(datafileConn="file"), contains=".environment")
> 
> setMethod("initialize", "Element",
>   function(.Object,.xData=new.env(parent=emptyenv())) {
>     .Object <- callNextMethod(.Object, .xData=.xData)
>     return(.Object)
>   }
> )
> 
> s <- new("Element")
> --------------------------------
> 
> Not sure why that changes things though?
> 
> Troy
> 
>> -----Original Message-----
>> From: Martin Morgan [mailto:mtmorgan at fhcrc.org]
>> Sent: Monday, 29 June 2009 2:21 PM
>> To: Troy Robertson
>> Subject: Re: [Rd] S4 and connection slot [Sec=Unclassified]
>>
>> Troy Robertson wrote:
>>> Hi all,
>>>
>>>
>>>
>>> I am having a problem trying to declare a slot representation to hold a
>> file connection.
>>> With V2.8.0 I had been using:
>>>
>>>
>>>
>>> setClass("Element",
>>>
>>>     representation(
>>>
>>>         [other slots removed],
>>>
>>>         datafileConn    = setOldClass(c("file","connection"))
>>>
>>>     )
>>>
>>> )
>>>
>> I think
>>
>> setOldClass(c("file", "connection"))
>>
>> setClass("Element",
>>          representation=representation(datafileConn="file"))
>>
>> getClass("file")
>> getClass("Element")
>>
>> but I don't usually use S3 classes so I'm not sure...
>>
>> Martin
>>
>>>
>>> This resulted in a warning but still ran okay.
>>>
>>>
>>>
>>> No however with V2.9.0 I am getting an error:
>>>
>>>
>>>
>>> Error in representation(state = "list", initialState = "list", polygons
>> = "list",  :
>>>   element 12 of the representation was not a single character string
>>>
>>>
>>>
>>> How can I declare a slot of the appropriate class?  The strings
>> "connection", "file" fail.
>>>
>>>
>>> Troy
>>>
>>>
>>>
>>>
>>>
>>> Troy Robertson
>>>
>>> Database and Computing Support Provider
>>>
>>> Southern Ocean Ecosystems, ERM/Fish
>>>
>>> Australian Antarctic Division
>>>
>>> Channel Highway, Kingston 7050
>>>
>>> PH: 03 62323571
>>>
>>> Troy.Robertson at aad.gov.au
>>>
>>>
>>>
>>>
>>>
>> __________________________________________________________________________
>> _
>>>     Australian Antarctic Division - Commonwealth of Australia
>>> IMPORTANT: This transmission is intended for the addressee only. If you
>> are not the
>>> intended recipient, you are notified that use or dissemination of this
>> communication is
>>> strictly prohibited by Commonwealth law. If you have received this
>> transmission in error,
>>> please notify the sender immediately by e-mail or by telephoning +61 3
>> 6232 3209 and
>>> DELETE the message.
>>>         Visit our web site at http://www.antarctica.gov.au/
>>>
>> __________________________________________________________________________
>> _
>>>       [[alternative HTML version deleted]]
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> ___________________________________________________________________________
> 
>     Australian Antarctic Division - Commonwealth of Australia
> IMPORTANT: This transmission is intended for the addressee only. If you are not the
> intended recipient, you are notified that use or dissemination of this communication is
> strictly prohibited by Commonwealth law. If you have received this transmission in error,
> please notify the sender immediately by e-mail or by telephoning +61 3 6232 3209 and
> DELETE the message.
>         Visit our web site at http://www.antarctica.gov.au/
> ___________________________________________________________________________


From macrakis at alum.mit.edu  Mon Jun 29 18:41:18 2009
From: macrakis at alum.mit.edu (Stavros Macrakis)
Date: Mon, 29 Jun 2009 12:41:18 -0400
Subject: [Rd] S4 and connection slot [Sec=Unclassified]
In-Reply-To: <4A48BF64.7070004@fhcrc.org>
References: <42C7503E0B99F248B06BC65E7D2B4E020122C50FB2AB@EX2K7-CCR.AAD.GOV.AU>
	<4A48BF64.7070004@fhcrc.org>
Message-ID: <8b356f880906290941v5f51c4c4pb12d40f510f56bc8@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090629/e0de94ce/attachment.pl>

From phgrosjean at sciviews.org  Mon Jun 29 19:59:31 2009
From: phgrosjean at sciviews.org (Philippe Grosjean)
Date: Mon, 29 Jun 2009 19:59:31 +0200
Subject: [Rd] Installing DLL elsewhere than in \libs?
Message-ID: <4A490103.3000602@sciviews.org>

Hello,

Its a couple of days I am fighting with this problem, and cannot find a 
solution. I need to compile a DLL that is not directly used by R, but 
must be installed elsewhere (it is indeed part of a Tcl/Tk package). So, 
I want to install it in /tklibs/tkpackage/alib.dll (under Windows) in my 
compiled package.

I do manage to compile it in /src, but cannot copy it at the right 
place. I tried using a cleanup.win file that contains:

cp src/alib.dll "${R_PACKAGE_DIR}/tklibs/tkpackage/alib.dll"

but it does not work. The Writing R extensions manual explicitly says 
not to use ${DPKG}. Yet, the following instruction does the job under R 
2.8.0:

cp src/alib.dll "${DPKG}/tklibs/tkpackage/alib.dll"

I become really desperate to get it working!
Thanks for help.
Best,

PhG
-- 
..............................................<?}))><........
  ) ) ) ) )
( ( ( ( (    Prof. Philippe Grosjean
  ) ) ) ) )
( ( ( ( (    Numerical Ecology of Aquatic Systems
  ) ) ) ) )   Mons-Hainaut University, Belgium
( ( ( ( (
..............................................................


From pgilbert at bank-banque-canada.ca  Mon Jun 29 19:59:04 2009
From: pgilbert at bank-banque-canada.ca (Paul Gilbert)
Date: Mon, 29 Jun 2009 13:59:04 -0400
Subject: [Rd] S4 and connection slot [Sec=Unclassified]
In-Reply-To: <8b356f880906290941v5f51c4c4pb12d40f510f56bc8@mail.gmail.com>
References: <42C7503E0B99F248B06BC65E7D2B4E020122C50FB2AB@EX2K7-CCR.AAD.GOV.AU>	<4A48BF64.7070004@fhcrc.org>
	<8b356f880906290941v5f51c4c4pb12d40f510f56bc8@mail.gmail.com>
Message-ID: <4A4900E8.4020705@bank-banque-canada.ca>

There may be a problem that objects with slots can persist into new 
sessions (i.e. be saved)  but I think connections die when a session 
ends, so whatever is in the slot is no longer valid.

Paul

Stavros Macrakis wrote:
> On Mon, Jun 29, 2009 at 9:19 AM, Martin Morgan <mtmorgan at fhcrc.org> wrote:
> 
> 
>>...I'm not sure that including a connection in a slot is going to be a good
>>idea, though -- a connection has reference-like semantics, so you can
>>end up with multiple objects pointing to the same connection, Also when
>>an object is garbage collected the connection will not be closed
>>automatically.
> 
> 
> 
> I'm not sure I understand your point here.  Having multiple objects refer to
> the same connection seems like a perfectly reasonable and useful thing, and
> garbage collection should work just fine -- when *all* of the objects
> referring to that connection are unreachable, then the connection is
> unreachable and will itself be garbage collected.  No?
> 
>            -s
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
====================================================================================

La version fran?aise suit le texte anglais.

------------------------------------------------------------------------------------

This email may contain privileged and/or confidential information, and the Bank of
Canada does not waive any related rights. Any distribution, use, or copying of this
email or the information it contains by other than the intended recipient is
unauthorized. If you received this email in error please delete it immediately from
your system and notify the sender promptly by email that you have done so. 

------------------------------------------------------------------------------------

Le pr?sent courriel peut contenir de l'information privil?gi?e ou confidentielle.
La Banque du Canada ne renonce pas aux droits qui s'y rapportent. Toute diffusion,
utilisation ou copie de ce courriel ou des renseignements qu'il contient par une
personne autre que le ou les destinataires d?sign?s est interdite. Si vous recevez
ce courriel par erreur, veuillez le supprimer imm?diatement et envoyer sans d?lai ?
l'exp?diteur un message ?lectronique pour l'aviser que vous avez ?limin? de votre
ordinateur toute copie du courriel re?u.

From mtmorgan at fhcrc.org  Mon Jun 29 21:12:13 2009
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Mon, 29 Jun 2009 12:12:13 -0700
Subject: [Rd] S4 and connection slot [Sec=Unclassified]
In-Reply-To: <8b356f880906290941v5f51c4c4pb12d40f510f56bc8@mail.gmail.com>
References: <42C7503E0B99F248B06BC65E7D2B4E020122C50FB2AB@EX2K7-CCR.AAD.GOV.AU>	
	<4A48BF64.7070004@fhcrc.org>
	<8b356f880906290941v5f51c4c4pb12d40f510f56bc8@mail.gmail.com>
Message-ID: <4A49120D.7040605@fhcrc.org>

Stavros Macrakis wrote:
> On Mon, Jun 29, 2009 at 9:19 AM, Martin Morgan <mtmorgan at fhcrc.org
> <mailto:mtmorgan at fhcrc.org>> wrote:
> 
>     ...I'm not sure that including a connection in a slot is going to be
>     a good
>     idea, though -- a connection has reference-like semantics, so you can
>     end up with multiple objects pointing to the same connection, Also when
>     an object is garbage collected the connection will not be closed
>     automatically.
> 
> 
> I'm not sure I understand your point here.  Having multiple objects
> refer to the same connection seems like a perfectly reasonable and
> useful thing, and garbage collection should work just fine -- when *all*
> of the objects referring to that connection are unreachable, then the
> connection is unreachable and will itself be garbage collected.  No?

I meant that, in practice, there were enough additional pitfalls that I
wouldn't choose this route (placing a connection in an S4 slot) for
myself. These little experiments were enough to make me cautious...

setOldClass(c("file", "connection"))

## Attempt one -- prototype
setClass("Element",
         representation=representation(conn="file"),
         prototype=prototype(conn=file()))

## oops, all instances share a single connection

close(new("Element")@conn)
## oops, all new instances now have a closed (invalid) connection


## Attempt two -- initialize
setClass("Element",
         representation=representation(conn="file"))

setMethod(initialize, "Element", function(.Object, ..., conn=file()) {
    callNextMethod(.Object, ..., conn=conn)
})

new("Element")
## oops, connection created but not closed; gc() closes (eventually)
## but with an ugly warning
## > gc()
##            used  (Mb) gc trigger  (Mb) max used  (Mb)
## Ncells   717240  38.4    1166886  62.4  1073225  57.4
## Vcells 37333395 284.9   63274729 482.8 60051033 458.2
## > gc()
##            used  (Mb) gc trigger  (Mb) max used  (Mb)
## Ncells   715906  38.3    1166886  62.4  1073225  57.4
## Vcells 37335626 284.9   63274729 482.8 60051033 458.2
## Warning messages:
## 1: closing unused connection 3 ()

setClass("ElementX", contains="Element")
## oops, two connections opened (!)
## > showConnections()
##   description class  mode text   isopen   can read can write
## 3 ""          "file" "w+" "text" "opened" "yes"    "yes"
## 4 ""          "file" "w+" "text" "opened" "yes"    "yes"

And while completely expected the action-at-a-distance of references has
the usual risks

> x <- y <- new("Element")
> close(x at conn)
> y
An object of class "Element"
Slot "conn":
Error in summary.connection(x) : invalid connection

One place I know where S4 and connections are used effectively is in the
AnnotationDbi package in Bioconductor (I did not participate in
developing this package, so am probably misrepresenting its
implementation). Here there is a database connection. But it is stored
in an environment in an S4 class. This part of the class is used
essentially as a singleton -- AnnotationDbi creates packages containing
instances, and users load the package and hence single instance; the
interface never exposes the connection itself to copying. The database
functionality exposed to the user is read-only, and querying the
connection does not change it's state (other than opening it if it were
closed). I think the underlying connection has C code to tidy itself up
appropriately (and quietly) when eventually garbage collected. So yes,
connections and multiple references to them can be useful.

Martin


>            -s
>


From romain.francois at dbmail.com  Mon Jun 29 23:32:08 2009
From: romain.francois at dbmail.com (Romain Francois)
Date: Mon, 29 Jun 2009 23:32:08 +0200
Subject: [Rd] active bindings and ls.str
Message-ID: <4A4932D8.1040501@dbmail.com>

Hello,

Should active binding appear as such in ls.str.

 > makeActiveBinding( "xx", function(arg){ Sys.sleep(10) }, .GlobalEnv )
 > ls.str() # takes 10 seconds
xx :  NULL

What we see here is the result of the "setter" of the binding.

I'm attaching a patch that prints this instead:

 > ls.str()
xx : <active binding>

Although a better behaviour would be to show the binding function.

Romain

-- 
Romain Francois
Independent R Consultant
+33(0) 6 28 91 30 30
http://romainfrancois.blog.free.fr


-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: activebinding.diff
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090629/16a8c41a/attachment.pl>

From tplate at acm.org  Mon Jun 29 23:47:41 2009
From: tplate at acm.org (Tony Plate)
Date: Mon, 29 Jun 2009 15:47:41 -0600
Subject: [Rd] should Sys.glob() cope with a UNC windows path beginning
 with backslashes?
In-Reply-To: <alpine.LFD.2.00.0906270607460.14974@auk.stats.ox.ac.uk>
References: <4A455EC2.5020905@acm.org>
	<alpine.LFD.2.00.0906270607460.14974@auk.stats.ox.ac.uk>
Message-ID: <4A49367D.9080605@acm.org>

Prof Brian Ripley wrote:
> On Fri, 26 Jun 2009, Tony Plate wrote:
>
>> I find that Sys.glob() doesn't like UNC paths where the initial 
>> slashes are backslashes.  The help page for Sys.glob() doesn't 
>> specificly mention UNC paths, but does say: "File paths in Windows 
>> are interpreted with separator \ or /."  Is the failure to treat a 
>> path beginning with a double-backslash as a UNC network drive path 
>> the intended behavior?
>
> Yes.  There are general warnings about non-POSIX Windows paths in 
> several of the help files.
>
> The following comments should alert you to possible restrictions:
>
>   The \code{glob} system call is not part of Windows, and we supply an
>   emulation.
>
>   File paths in Windows are interpreted with separator \code{\\} or
>   \code{/}.  Paths with a drive but relative (such as \code{c:foo\\bar})
>   are tricky, but an attempt is made to handle them correctly.
>
> If you want to submit a well-tested patch, it will be considered.
The problem seems to be in the function dos_wglob() in 
src/gnuwin32/dos_wglob.c.  This function treats backslashes as a escape 
characters when they precede one of the metacharacters []-{}~\.  So, an 
initial double backslash is changed to an initial single backslash. 
Consequently, the existing code does see network drives when the prefix 
is 3 or 4 backslashes.

Here's a patch that adds special treatment for a prefix of exactly two 
backslashes so that Sys.glob() sees a network drive in this case:

/cygdrive/c/Rbuild/R-2.9.1/src/gnuwin32
$ diff -c dos_wglob.c~ dos_wglob.c
*** dos_wglob.c~        Sun Sep 21 16:05:28 2008
--- dos_wglob.c Mon Jun 29 12:09:47 2009
***************
*** 203,208 ****
--- 203,222 ----
        *bufnext++ = BG_SEP;
        patnext += 2;
      }
+     /* Hack to treat UNC network drive specification correctly:
+      * Without this code, '\\' (i.e., literally two backslashes in 
pattern)
+      * at the beginning of a path is not recognized as a network drive,
+      * because the GLOB_QUOTE loop below changes the two backslashes 
to one.
+      * So, in the case where there are two but not three backslashes at
+      * the beginning of the path, transfer these to the output.
+      */
+     if (patnext == pattern && bufend - bufnext > 2 &&
+       pattern[0] == BG_SEP2 && pattern[1] == BG_SEP2 &&
+       pattern[2] != BG_SEP2) {
+       *bufnext++ = pattern[0];
+       *bufnext++ = pattern[1];
+       patnext += 2;
+     }
  #endif

      if (flags & GLOB_QUOTE) {

*** end of patch

This changes behavior in the just the case where the prefix is two 
backslashes.  With the fix, the behavior is:
 > Sys.glob("\\jacona\\home\\tplate")
character(0)
 > Sys.glob("\\\\jacona\\home\\tplate")
[1] "\\\\jacona\\home\\tplate"
 > Sys.glob("\\\\\\jacona\\home\\tplate")
[1] "\\\\jacona\\home\\tplate"
 > Sys.glob("\\\\\\\\jacona\\home\\tplate")
[1] "\\\\jacona\\home\\tplate"

Without the fix, the behavior is:
 > Sys.glob("\\jacona\\home\\tplate")
character(0)
 > Sys.glob("\\\\jacona\\home\\tplate")
character(0)
 > Sys.glob("\\\\\\jacona\\home\\tplate")
[1] "\\\\jacona\\home\\tplate"
 > Sys.glob("\\\\\\\\jacona\\home\\tplate")
[1] "\\\\jacona\\home\\tplate"


Here is a corresponding change to the docs:

tplate at oberon /cygdrive/c/Rbuild/R-2.9.1/src/library/base/man
*** Sys.glob.Rd~        Thu Mar 19 17:05:24 2009
--- Sys.glob.Rd Mon Jun 29 13:52:57 2009
***************
*** 89,94 ****
--- 89,104 ----
    File paths in Windows are interpreted with separator \code{\\} or
    \code{/}.  Paths with a drive but relative (such as \code{c:foo\\bar})
    are tricky, but an attempt is made to handle them correctly.
+   Backslashes in paths are tricky because they can serve dual purposes:
+   meta-function remover and path separator.  As a result, single or
+   double backslashes can serve as path separators.  UNC network drive
+   paths specified with backslashes (such as \code{\\\\foo\\bar}) are
+   treated specially so that the network drive is found when the path
+   begins with two, three, or four backslashes (i.e., paths beginning
+   with \code{\\\\foo\\bar}, \code{\\\\\\foo\\bar}, and
+   \code{\\\\\\foo\\bar} all result in the same output).  UNC network
+   drive paths can also be specified with two forward slashes.
+
  #endif
  }
  \value{
***************
*** 117,122 ****
--- 127,138 ----
  \examples{
  \dontrun{
  Sys.glob(file.path(R.home(), "library", "*", "R", "*.rdx"))
+ # different ways of seeing the same network drive
+ Sys.glob("\\\\\\\\foo\\\\bar")
+ Sys.glob("\\\\\\\\foo\\\\\\\\bar")
+ Sys.glob("\\\\\\\\\\\\foo\\\\\\\\bar")
+ Sys.glob("\\\\\\\\\\\\\\\\foo\\\\\\\\bar")
+ Sys.glob("//foo/bar")
  }}
  \keyword{utilities}
  \keyword{file}

*** end of patch

R compiled with this fix passes 'make check-all' (or at least all the 
differences and warnings printed appear to be minor and unrelated to 
this change.)

I suspect that it is a matter of taste whether or not this "fix" is 
desirable.

The argument for it is that it helps Sys.glob() recognize standard UNC 
network drive specifications, which can begin with a double backslash.  
Paths of this form can be returned by some system calls, e.g., getwd().

The argument against it would be that it is more important that 
Sys.glob() consistently treats backslashes as an escape mechanism when 
preceding any of []-{}~\.  If the latter argument is more forceful, then 
this should be documented in the help page for Sys.glob(), and callers 
of Sys.glob() should be careful not to pass it a UNC double-backslash 
prefix, e.g., as can returned by getwd() (an example of passing a path 
with UNC double-backslash prefix can occur in tools:::.writePkgIndices).

-- Tony Plate
>
>>
>> E.g., on a Windows system where \\foo is a network drive and 
>> \\foo\bar exists, I see:
>>
>>> Sys.glob("//foo/bar")
>> [1] "//foo/bar"
>>> Sys.glob("//foo\\bar")
>> [1] "//foo\\bar"
>>> Sys.glob("\\\\foo/bar")
>> character(0)
>>> Sys.glob("\\\\foo\\bar")
>>>
>> (the pattern of behavior seems to be that initial backslashes are not 
>> equivalent to forward slashes, but later backslashes are.)
>>
>> This is not a big deal, but I noticed it because it results in Rcmd 
>> check giving a spurious warning when started from a cygwin shell with 
>> a working directory that is a network drive specified as a UNC path.  
>> This happens because mandir in tools:::.writePkgIndices has the form 
>> \\foo/bar/R/packages/mypkg/man, which results in the false warning 
>> "there is a 'man' dir but no help pages in this package."  A simple 
>> workaround was to use a drive-letter mount for the network drive.
>>
>>> sessionInfo()
>> R version 2.9.1 (2009-06-26) i386-pc-mingw32 locale:
>> LC_COLLATE=English_United States.1252;LC_CTYPE=English_United 
>> States.1252;LC_MONETARY=English_United 
>> States.1252;LC_NUMERIC=C;LC_TIME=English_United States.1252
>>
>> attached base packages:
>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>>
>>
>> -- Tony Plate
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>


From Troy.Robertson at aad.gov.au  Tue Jun 30 01:39:32 2009
From: Troy.Robertson at aad.gov.au (Troy Robertson)
Date: Tue, 30 Jun 2009 09:39:32 +1000
Subject: [Rd] S4 and connection slot [Sec=Unclassified]
In-Reply-To: <4A49120D.7040605@fhcrc.org>
Message-ID: <42C7503E0B99F248B06BC65E7D2B4E020122C50FB2BB@EX2K7-CCR.AAD.GOV.AU>

Thanks guys,

I wasn't having a problem storing active connections in slots initially.  They were opened during initialisation of the object and then a routine ran through and closed them all before the program exited.

I have now implemented them as environment stored objects as a way around the slot problem (along with all the rest of the class data members so that object passing is more efficient without all the memcpying).  So much for S4 slots.

Troy


> -----Original Message-----
> From: Martin Morgan [mailto:mtmorgan at fhcrc.org]
> Sent: Tuesday, 30 June 2009 5:12 AM
> To: Stavros Macrakis
> Cc: Troy Robertson; r-devel at R-project.org
> Subject: Re: [Rd] S4 and connection slot [Sec=Unclassified]
>
> Stavros Macrakis wrote:
> > On Mon, Jun 29, 2009 at 9:19 AM, Martin Morgan <mtmorgan at fhcrc.org
> > <mailto:mtmorgan at fhcrc.org>> wrote:
> >
> >     ...I'm not sure that including a connection in a slot is going to be
> >     a good
> >     idea, though -- a connection has reference-like semantics, so you
> can
> >     end up with multiple objects pointing to the same connection, Also
> when
> >     an object is garbage collected the connection will not be closed
> >     automatically.
> >
> >
> > I'm not sure I understand your point here.  Having multiple objects
> > refer to the same connection seems like a perfectly reasonable and
> > useful thing, and garbage collection should work just fine -- when *all*
> > of the objects referring to that connection are unreachable, then the
> > connection is unreachable and will itself be garbage collected.  No?
>
> I meant that, in practice, there were enough additional pitfalls that I
> wouldn't choose this route (placing a connection in an S4 slot) for
> myself. These little experiments were enough to make me cautious...
>
> setOldClass(c("file", "connection"))
>
> ## Attempt one -- prototype
> setClass("Element",
>          representation=representation(conn="file"),
>          prototype=prototype(conn=file()))
>
> ## oops, all instances share a single connection
>
> close(new("Element")@conn)
> ## oops, all new instances now have a closed (invalid) connection
>
>
> ## Attempt two -- initialize
> setClass("Element",
>          representation=representation(conn="file"))
>
> setMethod(initialize, "Element", function(.Object, ..., conn=file()) {
>     callNextMethod(.Object, ..., conn=conn)
> })
>
> new("Element")
> ## oops, connection created but not closed; gc() closes (eventually)
> ## but with an ugly warning
> ## > gc()
> ##            used  (Mb) gc trigger  (Mb) max used  (Mb)
> ## Ncells   717240  38.4    1166886  62.4  1073225  57.4
> ## Vcells 37333395 284.9   63274729 482.8 60051033 458.2
> ## > gc()
> ##            used  (Mb) gc trigger  (Mb) max used  (Mb)
> ## Ncells   715906  38.3    1166886  62.4  1073225  57.4
> ## Vcells 37335626 284.9   63274729 482.8 60051033 458.2
> ## Warning messages:
> ## 1: closing unused connection 3 ()
>
> setClass("ElementX", contains="Element")
> ## oops, two connections opened (!)
> ## > showConnections()
> ##   description class  mode text   isopen   can read can write
> ## 3 ""          "file" "w+" "text" "opened" "yes"    "yes"
> ## 4 ""          "file" "w+" "text" "opened" "yes"    "yes"
>
> And while completely expected the action-at-a-distance of references has
> the usual risks
>
> > x <- y <- new("Element")
> > close(x at conn)
> > y
> An object of class "Element"
> Slot "conn":
> Error in summary.connection(x) : invalid connection
>
> One place I know where S4 and connections are used effectively is in the
> AnnotationDbi package in Bioconductor (I did not participate in
> developing this package, so am probably misrepresenting its
> implementation). Here there is a database connection. But it is stored
> in an environment in an S4 class. This part of the class is used
> essentially as a singleton -- AnnotationDbi creates packages containing
> instances, and users load the package and hence single instance; the
> interface never exposes the connection itself to copying. The database
> functionality exposed to the user is read-only, and querying the
> connection does not change it's state (other than opening it if it were
> closed). I think the underlying connection has C code to tidy itself up
> appropriately (and quietly) when eventually garbage collected. So yes,
> connections and multiple references to them can be useful.
>
> Martin
>
>
> >            -s
> >

___________________________________________________________________________

    Australian Antarctic Division - Commonwealth of Australia
IMPORTANT: This transmission is intended for the addressee only. If you are not the
intended recipient, you are notified that use or dissemination of this communication is
strictly prohibited by Commonwealth law. If you have received this transmission in error,
please notify the sender immediately by e-mail or by telephoning +61 3 6232 3209 and
DELETE the message.
        Visit our web site at http://www.antarctica.gov.au/
___________________________________________________________________________


From edd at debian.org  Tue Jun 30 02:42:03 2009
From: edd at debian.org (Dirk Eddelbuettel)
Date: Mon, 29 Jun 2009 19:42:03 -0500
Subject: [Rd] Installing DLL elsewhere than in \libs?
In-Reply-To: <4A490103.3000602@sciviews.org>
References: <4A490103.3000602@sciviews.org>
Message-ID: <19017.24411.324862.531220@ron.nulle.part>


Philippe,

On 29 June 2009 at 19:59, Philippe Grosjean wrote:
| Its a couple of days I am fighting with this problem, and cannot find a 
| solution. I need to compile a DLL that is not directly used by R, but 
| must be installed elsewhere (it is indeed part of a Tcl/Tk package). So, 
| I want to install it in /tklibs/tkpackage/alib.dll (under Windows) in my 
| compiled package.
| 
| I do manage to compile it in /src, but cannot copy it at the right 
| place. I tried using a cleanup.win file that contains:
| 
| cp src/alib.dll "${R_PACKAGE_DIR}/tklibs/tkpackage/alib.dll"
| 
| but it does not work. The Writing R extensions manual explicitly says 
| not to use ${DPKG}. Yet, the following instruction does the job under R 
| 2.8.0:
| 
| cp src/alib.dll "${DPKG}/tklibs/tkpackage/alib.dll"
| 
| I become really desperate to get it working!
| Thanks for help.

I think I am doing something similar to what you are trying to do inside the
Rcpp package [cf r-forge].  There my goal is to provide a package for
'external linking' and I do this in via src/Makevars:

1)  Main target is 'all:' and includes the SHLIB the package would build any
way, as well as an added target userLibrary:

2)  Couple of variable including an extension for the shared lib which gets
filled only on OS X

3)  In the userLibrary target, create (if need be) the target dir and copy
the previously created library over.

4)  Targets for the shared and static user library that userLibrary target
depends upon.

This is essentially the same under Windows. Credit for a lot of this setup
goes to Simon who helped with this while addressing an issue I had on OS X.

Hope this helps,  Dirk



all:            $(SHLIB) userLibrary

USERLIB =       libRcpp$(DYLIB_EXT)
USERLIBST =     libRcpp.a
USERDIR =       ../inst/lib

userLibrary:    $(USERLIB) $(USERLIBST)
                - at if test ! -e $(USERDIR)$(R_ARCH); then mkdir -p $(USERDIR)$(R_ARCH); fi
                cp $(USERLIB) $(USERDIR)$(R_ARCH)
                cp Rcpp.h $(USERDIR)$(R_ARCH)
                cp $(USERLIBST) $(USERDIR)$(R_ARCH)
                rm $(USERLIB) $(USERLIBST)

$(USERLIB):     Rcpp.o
                $(SHLIB_CXXLD) -o $(USERLIB) $^ $(SHLIB_CXXLDFLAGS) $(ALL_LIBS)
                @if test -e "/usr/bin/install_name_tool"; then /usr/bin/install_name_tool -id $(R_PACKAGE_DIR)/lib$(R_ARCH)/$(USERLIB) $(USERLIB); fi

$(USERLIBST):   Rcpp.o
                $(AR) qc $(USERLIBST) Rcpp.o
                @if test -n "$(RANLIB)"; then $(RANLIB) $(USERLIBST); fi

.PHONY:         all clean userLibrary

clean:
                rm -f $(OBJECTS) $(SHLIB) $(USERLIB) $(USERLIBST)




-- 
Three out of two people have difficulties with fractions.


From mathieu.ribatet at epfl.ch  Tue Jun 30 06:06:32 2009
From: mathieu.ribatet at epfl.ch (Mathieu Ribatet)
Date: Tue, 30 Jun 2009 06:06:32 +0200
Subject: [Rd] beginner's guide to C++ programming with R packages?
In-Reply-To: <40e66e0b0906290249w422ccb42u4313a7922197f18d@mail.gmail.com>
References: <13e802630906261243s7b071010ldfe6416e8c0ae304@mail.gmail.com>
	<40e66e0b0906290249w422ccb42u4313a7922197f18d@mail.gmail.com>
Message-ID: <1246334792.3925.3.camel@ubuntu>

An other possibility is to insert new features in your package once you
feel pretty confident with your new code. "R CMD SHLIB myfile.c" will
build the SHared LIBrary and then load it in R by invoking
"dyn.load("myfile.so")" in an R console.

Once you're satisfied with your code, just do as you did before - R CMD
build mypkg".

Cheers,
Mathieu

Le lundi 29 juin 2009 ? 11:49 +0200, Douglas Bates a ?crit :
> On Fri, Jun 26, 2009 at 2:43 PM, Paul Johnson<pauljohn32 at gmail.com> wrote:
> > Hello, again.
> >
> > I'm interested to learn how programmers develop & test C/C++ code with
> > R packages in Linux.  I've been reading R source and the manual on
> > Writing R Extensions but there are just a couple of details I can't
> > understand.  I wish I could watch over a developer's shoulder to see
> > how people actually do this.
> >
> > I've tested a bit.  I am able to take package.tar.gz file, open it up,
> > fiddle the source code, and then run
> >
> > R CMD check package-dir
> >
> > from the directory above "package-dir" ,
> >
> > R CMD build package-dir
> >
> > and
> >
> > R CMD INSTALL
> 
> For your purposes it is probably better to avoid building a new tar.gz
> file and combine the last two steps as
> 
> R CMD INSTALL package-dir
> 
> The install process uses the make utility which will check which of
> the object files need to be recompiled.  If you only modify one source
> file it will be the only file recompiled.
> > on the tarball that is produced. Then in R, I can load the package and use it.
> >
> > That part is "all good", but somewhat tedious.  I don't want to
> > entirely recompile and reinstall the whole package just to test one
> > function.  I notice that R CMD check creates a new directory called
> > "package.Rcheck" and the shared objects and example code of the
> > package are in there.  Can I force R to use those *.so files instead
> > of the ones in /usr/lib/R ?
> >
> >
> > I also wonder "what is wrong with gprof?   In the Writing R Extensions
> > manual, it describes "oprofile" and "sprof" for Linux. I will try
> > them, but they are unfamilar to me.  I've used gprof in the past in C
> > projects, and it is a pretty painless thing to add a compiler flag
> > -pg, run the program, and then review gmon.out.  The Writing R
> > Extensions manual does not mention gprof in its section on Linux, but
> > it does mention it under Solaris.  There is a somewhat ambiguous
> > statement:
> >
> > 3.4.2 Solaris
> >
> > On 64-bit (only) Solaris, the standard profiling tool gprof collects
> > information from shared libraries compiled with -pg.
> >
> > Does "(only)" here mean to differentiate Solaris from other Linux/Unix
> > systems?  Or does it differentiate 64bit Solaris from other Solaris?
> >
> > But this draws me back to the basic question.  I don't want to run R
> > CMD INSTALL 20 times per hour.  How do developers "actually" test
> > their code?
> >
> > pj
> > --
> > Paul E. Johnson
> > Professor, Political Science
> > 1541 Lilac Lane, Room 504
> > University of Kansas
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
-- 
Institute of Mathematics
Ecole Polytechnique F?d?rale de Lausanne
STAT-IMA-FSB-EPFL, Station 8
CH-1015 Lausanne   Switzerland
http://stat.epfl.ch/
Tel: + 41 (0)21 693 7907


From zemlys at gmail.com  Tue Jun 30 09:20:09 2009
From: zemlys at gmail.com (zemlys at gmail.com)
Date: Tue, 30 Jun 2009 09:20:09 +0200 (CEST)
Subject: [Rd] bug in nlme package function predict.lmList (PR#13788)
Message-ID: <20090630072009.AB048282EFCB@mail.pubhealth.ku.dk>

Full_Name: Vaidotas Zemlys
Version: 2.9.0
OS: Ubuntu 8.10
Submission from: (NULL) (213.197.173.50)


Steps to reproduce the bug:

library(nlme)
data(Oxboys)
qm=lmList(height~age|Subject,data=Oxboys)
grid=with(Oxboys,expand.grid(age=seq(min(age),max(age),length=50),Subject=levels(Subject)))

res <- predict(qm,grid,se=TRUE)
Erreur dans if (pool) { : l'argument est de longueur nulle

res <- predict(qm,grid,se=TRUE,pool=TRUE)
Erreur dans sprintf(gettext(fmt, domain = domain), ...) : 
  objet 'form' introuvable

The result: predicting does not work, when new data is supplied. 

The problem is in the function predict.lmList. When argument newdata is not
NULL, argument subset is set to TRUE, and following code gets executed:

####Start of the relevant code snippet
 if (!is.null(subset)) {
        if (any(is.na(match(subset, names(object))))) {
            stop("Non-existent group requested in \"subset\".")
        }
        oclass <- class(object)
        oatt <- attr(object, "call")
        object <- object[subset]
        attr(object, "call") <- oatt
        class(object) <- oclass
        if (is.null(newdata)) {
            myData <- myData[subset]
        }
    }
#####End of relevant code snippet

Only attribute call is saved from original object, but the following code
assumes that attributes groupsForm and pool are present, and when they are not
found, error is produced. The problem with missing pool attribute can be worked
arround by supplying it directly. But it is not possible to do that with
attribute groupsForm. 

The patch which fixes this problem :

--- lmList.R	2008-02-11 16:05:14.000000000 +0200
+++ lmListnew.R	2009-06-30 09:49:21.000000000 +0300
@@ -853,9 +853,10 @@ predict.lmList <-
       stop("Non-existent group requested in \"subset\".")
     }
     oclass <- class(object)
-    oatt <- attr(object, "call")
+    oatt <- attributes(object)[c("call","groupsForm","pool")]
     object <- object[subset]
-    attr(object, "call") <- oatt
+    oatt <- c(attributes(object),oatt)
+    attributes(object) <- oatt
     class(object) <- oclass
     if(is.null(newdata)) {
       myData <- myData[subset]

I did not do extensive tests, but it works with previous example and my own
datasets.
Here is the relevant information about R and nlme on my system:
> R.version
               _                           
platform       i486-pc-linux-gnu           
arch           i486                        
os             linux-gnu                   
system         i486, linux-gnu             
status                                     
major          2                           
minor          9.0                         
year           2009                        
month          04                          
day            17                          
svn rev        48333                       
language       R                           
version.string R version 2.9.0 (2009-04-17)

> packageDescription("nlme")
Package: nlme
Version: 3.1-92
Date: 2009-05-22
Priority: recommended
Title: Linear and Nonlinear Mixed Effects Models
Author: Jose Pinheiro <Jose.Pinheiro at pharma.novartis.com>, Douglas
        Bates <bates at stat.wisc.edu>, Saikat DebRoy
        <saikat at stat.wisc.edu>, Deepayan Sarkar
        <Deepayan.Sarkar at R-project.org>, the R Core team.
Maintainer: R-core <R-core at R-project.org>
Description: Fit and compare Gaussian linear and nonlinear
        mixed-effects models.
Depends: graphics, stats, R (>= 2.4.0)
Imports: lattice
LazyLoad: yes
LazyData: yes
License: GPL (>= 2)
Packaged: 2009-05-23 16:39:47 UTC; ripley
Repository: CRAN
Date/Publication: 2009-05-24 08:46:01
Built: R 2.9.0; i486-pc-linux-gnu; 2009-06-30 06:00:47 UTC; unix

I did update.packages() before testing and reporting the bug. 

I hope that this is correct place to report bug on package of R. 

Vaidotas Zemlys


From thomas.friedrichsmeier at ruhr-uni-bochum.de  Tue Jun 30 10:35:17 2009
From: thomas.friedrichsmeier at ruhr-uni-bochum.de (Thomas Friedrichsmeier)
Date: 30 Jun 2009 10:35:17 +0200
Subject: [Rd] active bindings and ls.str
In-Reply-To: <4A4932D8.1040501@dbmail.com>
References: <4A4932D8.1040501@dbmail.com>
Message-ID: <200906301035.20681.thomas.friedrichsmeier@ruhr-uni-bochum.de>

On Monday 29 June 2009, Romain Francois wrote:
> I'm attaching a patch that prints this instead:
>  > ls.str()
>
> xx : <active binding>
>
> Although a better behaviour would be to show the binding function.

I can see your point, but note that active bindings are not necessarily slow, 
and a special treatment may not be desirable in all use cases. For instance in 
RKWard, we use active bindings to detect, when objects are modified. To do so, 
we move *al* objects from .GlobalEnv to a hidden storage environment, and 
place corresponding active bindings in .GlobalEnv, instead. So, in our case, 
we'd clearly like for active bindings to behave just like regular objects, as 
much as possible.

Regards
Thomas

-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 197 bytes
Desc: This is a digitally signed message part.
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090630/806c901c/attachment.bin>

From romain.francois at dbmail.com  Tue Jun 30 10:54:32 2009
From: romain.francois at dbmail.com (Romain Francois)
Date: Tue, 30 Jun 2009 10:54:32 +0200
Subject: [Rd] active bindings and ls.str
In-Reply-To: <200906301035.20681.thomas.friedrichsmeier@ruhr-uni-bochum.de>
References: <4A4932D8.1040501@dbmail.com>
	<200906301035.20681.thomas.friedrichsmeier@ruhr-uni-bochum.de>
Message-ID: <4A49D2C8.9070005@dbmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090630/7940fcd4/attachment.pl>

From Waclaw.Marcin.Kusnierczyk at idi.ntnu.no  Tue Jun 30 11:11:25 2009
From: Waclaw.Marcin.Kusnierczyk at idi.ntnu.no (Wacek Kusnierczyk)
Date: Tue, 30 Jun 2009 11:11:25 +0200
Subject: [Rd] S4 and connection slot [Sec=Unclassified]
In-Reply-To: <4A49120D.7040605@fhcrc.org>
References: <42C7503E0B99F248B06BC65E7D2B4E020122C50FB2AB@EX2K7-CCR.AAD.GOV.AU>		<4A48BF64.7070004@fhcrc.org>	<8b356f880906290941v5f51c4c4pb12d40f510f56bc8@mail.gmail.com>
	<4A49120D.7040605@fhcrc.org>
Message-ID: <4A49D6BD.6080506@idi.ntnu.no>

Martin Morgan wrote:

[...]


>
> ## Attempt two -- initialize
> setClass("Element",
>          representation=representation(conn="file"))
>
> setMethod(initialize, "Element", function(.Object, ..., conn=file()) {
>     callNextMethod(.Object, ..., conn=conn)
> })
>
> new("Element")
> ## oops, connection created but not closed; gc() closes (eventually)
> ## but with an ugly warning
> ## > gc()
> ##            used  (Mb) gc trigger  (Mb) max used  (Mb)
> ## Ncells   717240  38.4    1166886  62.4  1073225  57.4
> ## Vcells 37333395 284.9   63274729 482.8 60051033 458.2
> ## > gc()
> ##            used  (Mb) gc trigger  (Mb) max used  (Mb)
> ## Ncells   715906  38.3    1166886  62.4  1073225  57.4
> ## Vcells 37335626 284.9   63274729 482.8 60051033 458.2
> ## Warning messages:
> ## 1: closing unused connection 3 ()
>
> setClass("ElementX", contains="Element")
> ## oops, two connections opened (!)

yes, that's because of the nonsense double call to the initializer while 
creating a subclass.  the conceptual bug in the s4 system leads to this 
ridiculous behaviour in your essentially correct and useful pattern.

vQ


From thomas.friedrichsmeier at ruhr-uni-bochum.de  Tue Jun 30 11:41:34 2009
From: thomas.friedrichsmeier at ruhr-uni-bochum.de (Thomas Friedrichsmeier)
Date: 30 Jun 2009 11:41:34 +0200
Subject: [Rd] active bindings and ls.str
In-Reply-To: <4A49D2C8.9070005@dbmail.com>
References: <4A4932D8.1040501@dbmail.com>
	<200906301035.20681.thomas.friedrichsmeier@ruhr-uni-bochum.de>
	<4A49D2C8.9070005@dbmail.com>
Message-ID: <200906301141.37573.thomas.friedrichsmeier@ruhr-uni-bochum.de>

Hi,

On Tuesday 30 June 2009, Romain Francois wrote:
> Not sure your trick is full-proof. What happens when the variable you
> copy is already an active binding ?

see promises, below.

> There should be another way to track
> changes.

I'm open to suggestions.

> It is more about seeing what the object really is than speed. I feel we
> don't see the actual object with the current ls.str.

Hm, but isn't that the point of active bindings (and promises), that they are 
just a transparent layer, and the "actual" object *is* the result of 
evaluating the object? (I'm not really qualified to answer that, but that's the 
way I'm thinking about these concepts).

> I would also argue the same about promises:
>  > delayedAssign( "foobar", { Sys.sleep(5); rnorm(10) } )
>  > ls.str() # takes 5 seconds
>
> foobar :  num [1:10] -0.288 0.827 -0.466 -0.803 -1.622 ...
>
> Maybe the promise does not have to forced at that stage. Thomas, does
> rkward's trick force the promise when the make your copy to the hidden
> environment or later ?

On the C level it's possible (and in fact quite easily) to copy the object "as 
is". That's what we do. Including any active bindings and "unseen" promises. 
See our function doCopyNoEval() in RKWard's rembedinternal.cpp .

> BTW, is there a way to identify an object as a promise ?

Once again, this is possible on the C level:
    TYPEOF (object) == PROMSXP               // a promise
    PRVALUE(object) == R_UnboundValue	   // not yet forced
but when I once looked, I did not find any R level facility for this (and my 
guess is that this is hidden on purpose).

Regards
Thomas
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 197 bytes
Desc: This is a digitally signed message part.
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090630/36e99890/attachment.bin>

From romain.francois at dbmail.com  Tue Jun 30 11:58:50 2009
From: romain.francois at dbmail.com (Romain Francois)
Date: Tue, 30 Jun 2009 11:58:50 +0200
Subject: [Rd] active bindings and ls.str
In-Reply-To: <200906301141.37573.thomas.friedrichsmeier@ruhr-uni-bochum.de>
References: <4A4932D8.1040501@dbmail.com>	<200906301035.20681.thomas.friedrichsmeier@ruhr-uni-bochum.de>	<4A49D2C8.9070005@dbmail.com>
	<200906301141.37573.thomas.friedrichsmeier@ruhr-uni-bochum.de>
Message-ID: <4A49E1DA.4060809@dbmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090630/f7c12acd/attachment.pl>

From romain.francois at dbmail.com  Tue Jun 30 12:13:31 2009
From: romain.francois at dbmail.com (Romain Francois)
Date: Tue, 30 Jun 2009 12:13:31 +0200
Subject: [Rd] progress bar
Message-ID: <4A49E54B.2090707@dbmail.com>

Hello,

Would it be useful to rework txtProgressBar so that front-end can pick 
it up and propose an alternative display.
This could be done for example as a callback, as an option (similar to 
"pager" for example), or maybe handling a condition (if there was a way 
to handle conditions from the top-level).

Romain

-- 
Romain Francois
Independent R Consultant
+33(0) 6 28 91 30 30
http://romainfrancois.blog.free.fr


From thomas.friedrichsmeier at ruhr-uni-bochum.de  Tue Jun 30 13:51:19 2009
From: thomas.friedrichsmeier at ruhr-uni-bochum.de (Thomas Friedrichsmeier)
Date: 30 Jun 2009 13:51:19 +0200
Subject: [Rd] active bindings and ls.str
In-Reply-To: <4A49E1DA.4060809@dbmail.com>
References: <4A4932D8.1040501@dbmail.com>
	<200906301141.37573.thomas.friedrichsmeier@ruhr-uni-bochum.de>
	<4A49E1DA.4060809@dbmail.com>
Message-ID: <200906301351.23177.thomas.friedrichsmeier@ruhr-uni-bochum.de>

On Tuesday 30 June 2009, Romain Francois wrote:
> This was more of a question. I'd like to know if there is a way for
> objects to broadcast that they have changed.
> This would be very useful to for example implement an object browser in
> a front-end, which I guess is part of the reason for the trick ?

Yes, that's around half the reason. The other half is our data.frame-editor, 
which tries to create the illusion of "in-place" editing. For that it's pretty 
important to keep the editor data in sync with R's version of the data.frame.

I would certainly like to see an easier way to detect changed objects as well.

> The problem is as soon as you pass it to a function, you force the
> promise, maybe passing the symbol instead could do the trick, but I have
> not seen something that brings the information that an object is a
> promise. Maybe you are right and I am not supposed to play with them ...

Yes, passing the symbol does the trick, indeed. (And until a few minutes ago, 
there was a regression in RKWard in just that respect.) 

I'll have to admit that we do play with the internals of promises in RKWard, 
too: When the only reason that we forced a promise was that the object browser 
stepped on it, we "put it back" to free up the memory, again. This works 
remarkably well, but in fact I don't think we are supposed to do this...

Regards
Thomas
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 197 bytes
Desc: This is a digitally signed message part.
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090630/55e9d278/attachment.bin>

From j.skoien at geo.uu.nl  Tue Jun 30 15:27:23 2009
From: j.skoien at geo.uu.nl (Jon Olav Skoien)
Date: Tue, 30 Jun 2009 15:27:23 +0200
Subject: [Rd] Conditional dependency between packages
Message-ID: <4A4A12BB.6020504@geo.uu.nl>

Hi,

I have already asked a similar question twice without response on the 
r-help list https://stat.ethz.ch/pipermail/r-help/2009-June/200300.html
but this list might be more appropriate. If there is a particular reason 
for the lacking answers (unclear, missing information, the solution is 
obvious to everyone except me, etc), I would like to know. The 
description below is generalized, but I can send the source code 
off-list if anyone would like to test.

I work on two packages, pkg1 and pkg2 (in two different projects). pkg1 
is quite generic, pkg2 tries to solve a particular problem within same 
field (geostatistics). Therefore, there might be users who want to use 
pkg2 as an add-on package to increase the functionality of pkg1. In 
other words, functions in pkg1 are based on the S3 class system, and I 
want pkg2 to offer methods for pkg2-objects to functions defined in 
pkg1, for users having both packages installed. Merging the packages or 
making pkg2 always depend pkg1 would be the easiest solution, but it is 
not preferred as most users will only be interested in one of the packages.

I thought this could be solved by including the following in NAMESPACE 
of pkg2:

if ("pkg1" %in% rownames(utils:::installed.packages()) {
importFrom(pkg1, fun1, fun2, fun3)
S3method(fun1, class2)
S3method(fun2, class2)
S3method(fun3, class2)
}

Unfortunately, this doesn't seem to work as I expected, particularly 
when I try to build a binary for Windows-users (R CMD build -binary 
pkg2   or R CMD INSTALL --build pkg2). It seems for me that the 
dependency between pkg2 and pkg1 is defined at the time of building a 
binary, not when the package is loaded with library(pkg2):

If I have pkg1 installed when I build pkg2, the package will not load 
for users who do not have pkg1 installed:
 > install.packages("d:/pkg2_0.1-1.zip", repos=NULL)
 > library(pkg2)
(...)
Error : object 'fun1' not found whilst loading namespace 'pkg2'
Error: package/namespace load failed for 'pkg2'

If I remove pkg1 from the library before building pkg2, pkg2 can be 
installed and loaded by everyone, but the new method is not visible for 
those with pkg1 installed:
 > install.packages("d:/pkg2_0.1-2.zip", repos=NULL)
 > library(pkg1)
 > library(pkg2)
 > methods(fun1)
[1] fun1.class1*
  Non-visible functions are asterisked

I have tried with and without one of the following:
Suggests: pkg1
Enhances: pkg1
in the DESCRIPTION file of pkg2, but I cannot see that either of them 
make a difference.

I can of course solve this problem temporarily, building two different 
versions of pkg2, with and without pkg1 installed on my computer. But 
first of all, that seems unnecessary complicated, and more important, 
the plan is also to upload these packages to CRAN where I doubt that 
such a two-version solution is possible or accepted.

Is there a way to build one binary that works both with and without 
having pkg1 installed? I have tried to search in mail archives and 
"Writing R extensions", but either it is not there, or I have missed it.

Thanks,
Jon

BTW, I am using R version 2.9.1 and Rtools version 29 under Windows XP-SP3


From fabio.ufla at yahoo.com.br  Tue Jun 30 16:03:37 2009
From: fabio.ufla at yahoo.com.br (Fabio Mathias)
Date: Tue, 30 Jun 2009 07:03:37 -0700 (PDT)
Subject: [Rd] Matrix with random number
Message-ID: <975647.16534.qm@web59705.mail.ac4.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090630/73e15387/attachment.pl>

From fabio.ufla at yahoo.com.br  Tue Jun 30 16:05:03 2009
From: fabio.ufla at yahoo.com.br (Fabio Mathias)
Date: Tue, 30 Jun 2009 07:05:03 -0700 (PDT)
Subject: [Rd] Matrix with random number
Message-ID: <237102.1638.qm@web59710.mail.ac4.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090630/62996684/attachment.pl>

From spencer.graves at prodsyse.com  Tue Jun 30 16:10:10 2009
From: spencer.graves at prodsyse.com (spencerg)
Date: Tue, 30 Jun 2009 07:10:10 -0700
Subject: [Rd] install.packages with R 2.9.1 under Vista?
Message-ID: <4A4A1CC2.7090001@prodsyse.com>


      What do I need to do to get "install.packages" to work properly 
for me in R 2.9.1 under Vista? 


      Currently, install.packages in Rgui 2.9.1 by default goes to 
"C:\\Users\\sgraves\\Documents/R/win-library/2.9".  This is a problem 
for me, because R running under Emacs does not currently look there. 


      I made the mistake last night of first installing R 2.9.1 in the 
default "C:\Program Files".  When I found that packages I installed 
using Rgui could not be found from within Emacs, I uninstalled R from 
"C:\Program Files" and reinstalled it under "C:\Users\sgraves\R" 
alongside R 2.9.0, which has allowed "install.packages" from Rgui to be 
accessed from R under Emacs. 


      I've traced the problem to the different behavior of ".libPaths()": 


*** Rgui: 
.libPaths()
[1] "C:\\Users\\sgraves\\Documents/R/win-library/2.9"
[2] "C:/Users/sgraves/R/R-2.9.1/library"  


*** R under Emacs: 
 > .libPaths()
[1] "c:/Users/sgraves/R/R-2.9.1/library"


      What do you suggest? 
      Thanks,
      Spencer


From b.rowlingson at lancaster.ac.uk  Tue Jun 30 16:24:22 2009
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Tue, 30 Jun 2009 15:24:22 +0100
Subject: [Rd] Matrix with random number
In-Reply-To: <237102.1638.qm@web59710.mail.ac4.yahoo.com>
References: <237102.1638.qm@web59710.mail.ac4.yahoo.com>
Message-ID: <d8ad40b50906300724x603c81bkbe7d0cd064e28a45@mail.gmail.com>

> ???? ??? x(i,j) = call myrbeta(1,4,5) ! It's correct?

> The code of the error in R is:
> dyn.load("func.so")
> Error in dyn.load("func.so") :
> ? unable to load shared library '/home/julio/Orientados/Fabio/Fortran/mat-fortran/func.so':
> ? /home/julio/Orientados/Fabio/Fortran/mat-fortran/func.so: undefined symbol: callmyrbeta_

 Fortran doesn't use 'CALL' when calling a function. Try:

      x(i,j) = myrbeta(1,4,5)

Fortran has SUBROUTINEs (which are CALLed and don't return a value)
and FUNCTIONs - which are just used like any other function.

Barry


From tplate at acm.org  Tue Jun 30 19:26:46 2009
From: tplate at acm.org (Tony Plate)
Date: Tue, 30 Jun 2009 11:26:46 -0600
Subject: [Rd] active bindings and ls.str
In-Reply-To: <200906301351.23177.thomas.friedrichsmeier@ruhr-uni-bochum.de>
References: <4A4932D8.1040501@dbmail.com>	<200906301141.37573.thomas.friedrichsmeier@ruhr-uni-bochum.de>	<4A49E1DA.4060809@dbmail.com>
	<200906301351.23177.thomas.friedrichsmeier@ruhr-uni-bochum.de>
Message-ID: <4A4A4AD6.5060200@acm.org>

Thomas Friedrichsmeier wrote:
> On Tuesday 30 June 2009, Romain Francois wrote:
>   
>> This was more of a question. I'd like to know if there is a way for
>> objects to broadcast that they have changed.
>> This would be very useful to for example implement an object browser in
>> a front-end, which I guess is part of the reason for the trick ?
>>     
>
> Yes, that's around half the reason. The other half is our data.frame-editor, 
> which tries to create the illusion of "in-place" editing. For that it's pretty 
> important to keep the editor data in sync with R's version of the data.frame.
>
> I would certainly like to see an easier way to detect changed objects as well.
>
>   
I used active bindings for the same purpose (tracking changes to 
objects) in the package trackObjs.  Prior to using active bindings, I 
experimented with changes in the C code that added hooks to an 
environment so that an R function could be called when an object in the 
environment was created, changed or deleted.  This code was reasonably 
simple, and I'd be happy to share it if there is any interest (it was 
for R-2.4.1).

-- Tony Plate
>> The problem is as soon as you pass it to a function, you force the
>> promise, maybe passing the symbol instead could do the trick, but I have
>> not seen something that brings the information that an object is a
>> promise. Maybe you are right and I am not supposed to play with them ...
>>     
>
> Yes, passing the symbol does the trick, indeed. (And until a few minutes ago, 
> there was a regression in RKWard in just that respect.) 
>
> I'll have to admit that we do play with the internals of promises in RKWard, 
> too: When the only reason that we forced a promise was that the object browser 
> stepped on it, we "put it back" to free up the memory, again. This works 
> remarkably well, but in fact I don't think we are supposed to do this...
>
> Regards
> Thomas
>   
> ------------------------------------------------------------------------
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From fabio.ufla at yahoo.com.br  Tue Jun 30 20:02:57 2009
From: fabio.ufla at yahoo.com.br (Fabio Mathias)
Date: Tue, 30 Jun 2009 11:02:57 -0700 (PDT)
Subject: [Rd] Matrix with random number
Message-ID: <30454.53644.qm@web59716.mail.ac4.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090630/d9267d92/attachment.pl>

From ross at biostat.ucsf.edu  Tue Jun 30 21:58:32 2009
From: ross at biostat.ucsf.edu (Ross Boylan)
Date: Tue, 30 Jun 2009 12:58:32 -0700
Subject: [Rd] S4 class redefinition
Message-ID: <1246391912.26310.315.camel@corn.betterworld.us>

I haven't found much on S4 class redefinition; the little I've seen
indicates the following is to be expected:
1. setClass("foo", ....)
2. create objects of class foo.
3. execute the same setClass("foo", ...) again (source the same file).
4. objects from step 2 are now NULL.

Is that the expected behavior (I ran under R 2.7.1)?

Assuming it is, it's kind of unfortunate.  I can wrap my setClass code
like this
if (! isClass("foo")) setClass("foo", ....)
to avoid this problem.  I've seen this in other code; is that the
standard solution? 

I thought that loading a library was about the same as executing the
code in its source files (assuming R only code).  But if this were true
my saved objects would be nulled out each time I loaded the
corresponding library.  That does not seem to be the case.  Can anyone
explain that?

Do I need to put any protections around setMethod so that it doesn't run
if the method is already defined?

At the moment I'm not changing the class defintion but am changing the
methods, so I can simply avoid running setClass.

But if I want to change the class, most likely by adding a slot, what do
I do?  At the moment it looks as if I'd need to make a new class name,
define some coerce methods, and then locate and change the relevant
instances.  Is there a better way?

Thanks.
Ross Boylan


From ross at biostat.ucsf.edu  Tue Jun 30 22:57:44 2009
From: ross at biostat.ucsf.edu (Ross Boylan)
Date: Tue, 30 Jun 2009 13:57:44 -0700
Subject: [Rd] S4 class redefinition
In-Reply-To: <1246391912.26310.315.camel@corn.betterworld.us>
References: <1246391912.26310.315.camel@corn.betterworld.us>
Message-ID: <1246395464.26310.342.camel@corn.betterworld.us>

On Tue, 2009-06-30 at 12:58 -0700, Ross Boylan wrote:
> I haven't found much on S4 class redefinition; the little I've seen
> indicates the following is to be expected:
> 1. setClass("foo", ....)
> 2. create objects of class foo.
> 3. execute the same setClass("foo", ...) again (source the same file).
> 4. objects from step 2 are now NULL.
I'm sorry; step 4 is completely wrong.  The objects seem to be
preserved.  Some slightly modified questions remain.

Is it safe to reexecute identical code for setClass or setMethod when
you have existing objects of the class around?

Is there any protection, such as checking for existing definitions, that
is recommended before executing setClass or setMethod?

If you want to change a class or method, and have existing objects, how
do you do that?

Can scoping rules lead to situations in which some functions or methods
end up with references to the older version of the methods?  One example
is relevant to class constructors, and shows they can:

Here's a little test
> trivial <- function() 3  # stand in for a class constructor
> maker <- function(c=trivial)
+   function(x) x+c()
> oldf <- maker()
> oldf(4)
[1] 7
> trivial <- function() 20
> oldf(4)
[1] 7
> newf <- maker()
> newf(8)
[1] 28

So the old definition is frozen in the inner function, for which it was
captured by lexical scope.  Although definition of maker is not redone
after trivial is redefined, maker's default argument does get the new
value of trivial.  

Methods add another layer.  I'm hoping those with a deeper understanding
than mine can clarify where the danger spots are, and how to deal with
them.

Thanks.
Ross
> 
> Is that the expected behavior (I ran under R 2.7.1)?
> 
> Assuming it is, it's kind of unfortunate.  I can wrap my setClass code
> like this
> if (! isClass("foo")) setClass("foo", ....)
> to avoid this problem.  I've seen this in other code; is that the
> standard solution? 
> 
> I thought that loading a library was about the same as executing the
> code in its source files (assuming R only code).  But if this were true
> my saved objects would be nulled out each time I loaded the
> corresponding library.  That does not seem to be the case.  Can anyone
> explain that?
> 
> Do I need to put any protections around setMethod so that it doesn't run
> if the method is already defined?
> 
> At the moment I'm not changing the class defintion but am changing the
> methods, so I can simply avoid running setClass.
> 
> But if I want to change the class, most likely by adding a slot, what do
> I do?  At the moment it looks as if I'd need to make a new class name,
> define some coerce methods, and then locate and change the relevant
> instances.  Is there a better way?
> 
> Thanks.
> Ross Boylan
> 
>


From fmcron at gmail.com  Tue Jun 30 15:58:10 2009
From: fmcron at gmail.com (=?ISO-8859-1?B?RuFiaW8gQ29ycuph?=)
Date: Tue, 30 Jun 2009 10:58:10 -0300
Subject: [Rd] Matrix with random numbers
Message-ID: <bb2ab3860906300658l1bac1ae6j1db54e2a6af584f2@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20090630/e7ca51b1/attachment.pl>

From e.leoni at gmail.com  Tue Jun 30 18:00:09 2009
From: e.leoni at gmail.com (e.leoni at gmail.com)
Date: Tue, 30 Jun 2009 18:00:09 +0200 (CEST)
Subject: [Rd] possible agrep bug; R 2.9.1, Mac OS X 10.5 (PR#13789)
Message-ID: <20090630160010.01DF6282C761@mail.pubhealth.ku.dk>

Same behavior was noted on R 2.9.0 OS X and WIndows.

> t(sapply(seq(0.01, .99, length=20), function(x) c(x, length(agrep("Staatssekretar im Bundeskanzleramt","Bundeskanzler",max.distance=x)))))
 [1,] 0.01000000    0
 [2,] 0.06157895    0
 [3,] 0.11315789    0
 [4,] 0.16473684    0
 [5,] 0.21631579    0
 [6,] 0.26789474    0
 [7,] 0.31947368    0
 [8,] 0.37105263    0
 [9,] 0.42263158    0
[10,] 0.47421053    0
[11,] 0.52578947    0
[12,] 0.57736842    0
[13,] 0.62894737    1
[14,] 0.68052632    1
[15,] 0.73210526    1
[16,] 0.78368421    1
[17,] 0.83526316    1
[18,] 0.88684211    0   ## NOTE that there is a match reported with a
threshold _lower_ than this!
[19,] 0.93842105    0
[20,] 0.99000000    1

--please do not edit the information below--

Version:
 platform = i386-apple-darwin8.11.1
 arch = i386
 os = darwin8.11.1
 system = i386, darwin8.11.1
 status =
 major = 2
 minor = 9.1
 year = 2009
 month = 06
 day = 26
 svn rev = 48839
 language = R
 version.string = R version 2.9.1 (2009-06-26)

Locale:
en_US.UTF-8/en_US.UTF-8/C/C/en_US.UTF-8/en_US.UTF-8

Search Path:
 .GlobalEnv, package:stats, package:graphics, package:grDevices,
package:utils, package:datasets, package:methods, Autoloads,
package:base


From maurice.berk01 at imperial.ac.uk  Tue Jun 30 19:50:15 2009
From: maurice.berk01 at imperial.ac.uk (maurice.berk01 at imperial.ac.uk)
Date: Tue, 30 Jun 2009 19:50:15 +0200 (CEST)
Subject: [Rd] Bug when specifying size of png/jpg/bmp/tiff in mm (PR#13790)
Message-ID: <20090630175015.515A6282EF42@mail.pubhealth.ku.dk>

Full_Name: Maurice Berk
Version: 2.8.1
OS: RedHat Linux 64bit
Submission from: (NULL) (155.198.195.25)


The offending line in all 4 functions is:

width <- switch(units, `in` = res, cm = res/2.54, mm = 1/25.4,
        px = 1) * width

The case for mm is clearly incorrect


