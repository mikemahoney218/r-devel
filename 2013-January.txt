From jeff.a.ryan at gmail.com  Tue Jan  1 22:35:40 2013
From: jeff.a.ryan at gmail.com (Jeff Ryan)
Date: Tue, 1 Jan 2013 15:35:40 -0600
Subject: [Rd] Behavior or as.environment in function arguments/call (and
	force() behaviors...)
Message-ID: <CABDUZc-98pUS=7cmSJodNKe7kqm5SxN0+ig63tgoe1iGwXcP1A@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20130101/f4f9d308/attachment.pl>

From murdoch.duncan at gmail.com  Tue Jan  1 23:21:10 2013
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Tue, 01 Jan 2013 17:21:10 -0500
Subject: [Rd] Behavior or as.environment in function arguments/call (and
 force() behaviors...)
In-Reply-To: <CABDUZc-98pUS=7cmSJodNKe7kqm5SxN0+ig63tgoe1iGwXcP1A@mail.gmail.com>
References: <CABDUZc-98pUS=7cmSJodNKe7kqm5SxN0+ig63tgoe1iGwXcP1A@mail.gmail.com>
Message-ID: <50E36156.401@gmail.com>

On 13-01-01 4:35 PM, Jeff Ryan wrote:
> Happy 2013!
>
> Can someone with more knowledge of edge case scoping/eval rules explain
> what is happening below?  Happens in all the versions of R I have on hand.

Even though it is used as a default in a number of places, the pos==-1 
value is really poorly documented.  You need to look in the source, in 
particular src/main/envir.c, function pos2env.  There you'll see that 
pos==-1 is special cased to be the environment from which pos.to.env
(or as.environment in your case) was called.  For non-negative values, 
it indexes the search list (i.e. the list returned by search().)  Other 
values are errors.

The trouble in your examples is that this location varies.  In Fn1, it 
is being called in the ls() call.  In Fn2, it is in the force() call. 
In Fn3 and Fn4, it's the Fn3/Fn4 call.

In spite of what the docs say in ?get, I would rarely if ever use a pos 
argument to as.environment.  Use an environment and pass it as envir.

Duncan Murdoch

>
> Behavior itself is confusing, but ?as.environment also provides no clue.
>   The term used in that doc is 'search list', which is ambiguous, but the
> see also section mentions search(), so I would *think* that is what is
> intended.  Either way Fn1() below can't really be explained.
>
> Major question is what in the world is Fn1 doing, and why is Fn2 not equal
> to Fn3? [ Fn3/Fn4 are doing what I want. ]
>
>
> Fn1 <- function(x="test",pos=-1,env=as.environment(pos)) {
> ls(env)
> }
>
> Fn2 <- function(x="test",pos=-1,env=as.environment(pos)) {
> force(env)
> ls(env)
> }
>
> Fn3 <- function(x="test",pos=-1,env=as.environment(pos)) {
> # should be the same as force() in Fn2, but not
> # ?force
> # Note:
> #
> #    This is semantic sugar: just evaluating the symbol will do the
> #    same thing (see the examples).
> env
> ls(env)
> }
>
> Fn4 <- function(x="test",pos=-1,env=as.environment(pos)) {
> # same as Fn3
> env <- env
> ls(env)
> }
>
> Fn1()
> Fn2()
> Fn3()
> Fn4()
> ls()
>
> ###################### output #########################
>> Fn1()
> [1] "doTryCatch" "expr"       "handler"    "name"       "parentenv"
>
>> Fn2()
> [1] "env" "pos" "x"
>
>> Fn3()
> [1] "Fn1" "Fn2" "Fn3" "Fn4"
>
>> Fn4()
> [1] "Fn1" "Fn2" "Fn3" "Fn4"
>
> ### .GlobalEnv
>> ls()
> [1] "Fn1" "Fn2" "Fn3" "Fn4"
>
>> R.version
>                 _
> platform       x86_64-apple-darwin11.2.0
> arch           x86_64
> os             darwin11.2.0
> system         x86_64, darwin11.2.0
> status
> major          2
> minor          15.1
> year           2012
> month          06
> day            22
> svn rev        59600
> language       R
> version.string R version 2.15.1 (2012-06-22)
> nickname       Roasted Marshmallows
>
>> R.version
>                 _
> platform       x86_64-apple-darwin11.2.0
> arch           x86_64
> os             darwin11.2.0
> system         x86_64, darwin11.2.0
> status         Under development (unstable)
> major          3
> minor          0.0
> year           2012
> month          12
> day            28
> svn rev        61464
> language       R
> version.string R Under development (unstable) (2012-12-28 r61464)
> nickname       Unsuffered Consequences
>


From jeff.a.ryan at gmail.com  Tue Jan  1 23:33:29 2013
From: jeff.a.ryan at gmail.com (Jeff Ryan)
Date: Tue, 1 Jan 2013 16:33:29 -0600
Subject: [Rd] Behavior or as.environment in function arguments/call (and
 force() behaviors...)
In-Reply-To: <50E36156.401@gmail.com>
References: <CABDUZc-98pUS=7cmSJodNKe7kqm5SxN0+ig63tgoe1iGwXcP1A@mail.gmail.com>
	<50E36156.401@gmail.com>
Message-ID: <CABDUZc-+hxz+aeaSRUreB1RxUbc-+9w+WvCUvqZxB9zdD+mBQQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20130101/2c9ea9ff/attachment.pl>

From tlumley at uw.edu  Tue Jan  1 23:39:27 2013
From: tlumley at uw.edu (Thomas Lumley)
Date: Wed, 2 Jan 2013 11:39:27 +1300
Subject: [Rd] as.matrix.Surv -- R core question/opinions
In-Reply-To: <50C0B02D.4070803@mayo.edu>
References: <50C0B02D.4070803@mayo.edu>
Message-ID: <CAJ55+dJ=24q7qXSovqy=bBTGLCGX3kLKRybnDuprLMryXF351A@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20130102/86b5b61d/attachment.pl>

From tlumley at uw.edu  Wed Jan  2 00:01:14 2013
From: tlumley at uw.edu (Thomas Lumley)
Date: Wed, 2 Jan 2013 12:01:14 +1300
Subject: [Rd] Understanding svd usage and its necessity in generalized
 inverse calculation
In-Reply-To: <CAErODj9LyK3aZSJjxLPEeTTB3QN9rzEsdHYXnMa26xU98REQgg@mail.gmail.com>
References: <CAErODj9LyK3aZSJjxLPEeTTB3QN9rzEsdHYXnMa26xU98REQgg@mail.gmail.com>
Message-ID: <CAJ55+dKEj5=n85sCyixor2_jJ-gM23u_ocQrLg3V0jvLWyxf=Q@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20130102/4aa61d67/attachment.pl>

From bbolker at gmail.com  Wed Jan  2 03:02:30 2013
From: bbolker at gmail.com (Ben Bolker)
Date: Tue, 1 Jan 2013 21:02:30 -0500
Subject: [Rd] sQuote() on zero-length inputs
Message-ID: <50E39536.10203@gmail.com>


  It's not desperately important, but it would seem more consistent to
me if sQuote(character(0)) or sQuote(NULL) returned character(0) rather
than "??" .  This could easily be achieved by putting

if (length(x)==0) return(character(0))

at the beginning ...

  Ben Bolker


From ripley at stats.ox.ac.uk  Wed Jan  2 07:52:58 2013
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 02 Jan 2013 06:52:58 +0000
Subject: [Rd] Behavior or as.environment in function arguments/call (and
 force() behaviors...)
In-Reply-To: <50E36156.401@gmail.com>
References: <CABDUZc-98pUS=7cmSJodNKe7kqm5SxN0+ig63tgoe1iGwXcP1A@mail.gmail.com>
	<50E36156.401@gmail.com>
Message-ID: <50E3D94A.5000402@stats.ox.ac.uk>

On 01/01/2013 22:21, Duncan Murdoch wrote:
> On 13-01-01 4:35 PM, Jeff Ryan wrote:
>> Happy 2013!
>>
>> Can someone with more knowledge of edge case scoping/eval rules explain
>> what is happening below?  Happens in all the versions of R I have on
>> hand.
>
> Even though it is used as a default in a number of places, the pos==-1
> value is really poorly documented.  You need to look in the source, in

Hmm, I corrected that yesterday in R-patched and R-devel.

> particular src/main/envir.c, function pos2env.  There you'll see that
> pos==-1 is special cased to be the environment from which pos.to.env
> (or as.environment in your case) was called.  For non-negative values,
> it indexes the search list (i.e. the list returned by search().)  Other
> values are errors.

Actually for positive values: 0 is also an error.

>
> The trouble in your examples is that this location varies.  In Fn1, it
> is being called in the ls() call.  In Fn2, it is in the force() call. In
> Fn3 and Fn4, it's the Fn3/Fn4 call.
>
> In spite of what the docs say in ?get, I would rarely if ever use a pos
> argument to as.environment.  Use an environment and pass it as envir.
>
> Duncan Murdoch
>
>>
>> Behavior itself is confusing, but ?as.environment also provides no clue.
>>   The term used in that doc is 'search list', which is ambiguous, but the
>> see also section mentions search(), so I would *think* that is what is
>> intended.  Either way Fn1() below can't really be explained.
>>
>> Major question is what in the world is Fn1 doing, and why is Fn2 not
>> equal
>> to Fn3? [ Fn3/Fn4 are doing what I want. ]
>>
>>
>> Fn1 <- function(x="test",pos=-1,env=as.environment(pos)) {
>> ls(env)
>> }
>>
>> Fn2 <- function(x="test",pos=-1,env=as.environment(pos)) {
>> force(env)
>> ls(env)
>> }
>>
>> Fn3 <- function(x="test",pos=-1,env=as.environment(pos)) {
>> # should be the same as force() in Fn2, but not
>> # ?force
>> # Note:
>> #
>> #    This is semantic sugar: just evaluating the symbol will do the
>> #    same thing (see the examples).
>> env
>> ls(env)
>> }
>>
>> Fn4 <- function(x="test",pos=-1,env=as.environment(pos)) {
>> # same as Fn3
>> env <- env
>> ls(env)
>> }
>>
>> Fn1()
>> Fn2()
>> Fn3()
>> Fn4()
>> ls()
>>
>> ###################### output #########################
>>> Fn1()
>> [1] "doTryCatch" "expr"       "handler"    "name"       "parentenv"
>>
>>> Fn2()
>> [1] "env" "pos" "x"
>>
>>> Fn3()
>> [1] "Fn1" "Fn2" "Fn3" "Fn4"
>>
>>> Fn4()
>> [1] "Fn1" "Fn2" "Fn3" "Fn4"
>>
>> ### .GlobalEnv
>>> ls()
>> [1] "Fn1" "Fn2" "Fn3" "Fn4"
>>
>>> R.version
>>                 _
>> platform       x86_64-apple-darwin11.2.0
>> arch           x86_64
>> os             darwin11.2.0
>> system         x86_64, darwin11.2.0
>> status
>> major          2
>> minor          15.1
>> year           2012
>> month          06
>> day            22
>> svn rev        59600
>> language       R
>> version.string R version 2.15.1 (2012-06-22)
>> nickname       Roasted Marshmallows
>>
>>> R.version
>>                 _
>> platform       x86_64-apple-darwin11.2.0
>> arch           x86_64
>> os             darwin11.2.0
>> system         x86_64, darwin11.2.0
>> status         Under development (unstable)
>> major          3
>> minor          0.0
>> year           2012
>> month          12
>> day            28
>> svn rev        61464
>> language       R
>> version.string R Under development (unstable) (2012-12-28 r61464)
>> nickname       Unsuffered Consequences
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From tobias.verbeke at openanalytics.eu  Wed Jan  2 19:38:27 2013
From: tobias.verbeke at openanalytics.eu (Tobias Verbeke)
Date: Wed, 02 Jan 2013 19:38:27 +0100
Subject: [Rd] scientific notation and comparison with character variable
Message-ID: <50E47EA3.4040800@openanalytics.eu>

L.S.

Is the following expected and/or documented?

 > 1e-2 < "0.05"
[1] TRUE
 > 1e-4 < "0.05"
[1] FALSE

Many thanks in advance for any pointer.

Best,
Tobias

 > sessionInfo()
R Under development (unstable) (2013-01-01 r61512)
Platform: i386-w64-mingw32/i386 (32-bit)

locale:
[1] LC_COLLATE=English_United States.1252
[2] LC_CTYPE=English_United States.1252
[3] LC_MONETARY=English_United States.1252
[4] LC_NUMERIC=C
[5] LC_TIME=English_United States.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base


From josh.m.ulrich at gmail.com  Wed Jan  2 19:43:45 2013
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Wed, 2 Jan 2013 12:43:45 -0600
Subject: [Rd] scientific notation and comparison with character variable
In-Reply-To: <50E47EA3.4040800@openanalytics.eu>
References: <50E47EA3.4040800@openanalytics.eu>
Message-ID: <CAPPM_gSEB=iPwMGoYfyyCuMgMBxfsxxkbD8F6aHXUgzY-iJTJw@mail.gmail.com>

It's expected.  From ?"<":

     If the two arguments are atomic vectors of different types, one is
     coerced to the type of the other, the (decreasing) order of
     precedence being character, complex, numeric, integer, logical and
     raw.

> as.character(1e-2) < 0.05
[1] TRUE
> as.character(1e-4) < 0.05
[1] FALSE

Best,
--
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com


On Wed, Jan 2, 2013 at 12:38 PM, Tobias Verbeke
<tobias.verbeke at openanalytics.eu> wrote:
> L.S.
>
> Is the following expected and/or documented?
>
>> 1e-2 < "0.05"
> [1] TRUE
>> 1e-4 < "0.05"
> [1] FALSE
>
> Many thanks in advance for any pointer.
>
> Best,
> Tobias
>
>> sessionInfo()
> R Under development (unstable) (2013-01-01 r61512)
> Platform: i386-w64-mingw32/i386 (32-bit)
>
> locale:
> [1] LC_COLLATE=English_United States.1252
> [2] LC_CTYPE=English_United States.1252
> [3] LC_MONETARY=English_United States.1252
> [4] LC_NUMERIC=C
> [5] LC_TIME=English_United States.1252
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From tobias.verbeke at openanalytics.eu  Wed Jan  2 19:53:17 2013
From: tobias.verbeke at openanalytics.eu (Tobias Verbeke)
Date: Wed, 02 Jan 2013 19:53:17 +0100
Subject: [Rd] scientific notation and comparison with character variable
In-Reply-To: <CAPPM_gSEB=iPwMGoYfyyCuMgMBxfsxxkbD8F6aHXUgzY-iJTJw@mail.gmail.com>
References: <50E47EA3.4040800@openanalytics.eu>
	<CAPPM_gSEB=iPwMGoYfyyCuMgMBxfsxxkbD8F6aHXUgzY-iJTJw@mail.gmail.com>
Message-ID: <50E4821D.2090500@openanalytics.eu>

Thanks and apologies for the noise.

Best wishes,
Tobias

On 01/02/2013 07:43 PM, Joshua Ulrich wrote:
> It's expected.  From ?"<":
>
>       If the two arguments are atomic vectors of different types, one is
>       coerced to the type of the other, the (decreasing) order of
>       precedence being character, complex, numeric, integer, logical and
>       raw.
>
>> as.character(1e-2) < 0.05
> [1] TRUE
>> as.character(1e-4) < 0.05
> [1] FALSE
>
> Best,
> --
> Joshua Ulrich  |  about.me/joshuaulrich
> FOSS Trading  |  www.fosstrading.com
>
>
> On Wed, Jan 2, 2013 at 12:38 PM, Tobias Verbeke
> <tobias.verbeke at openanalytics.eu> wrote:
>> L.S.
>>
>> Is the following expected and/or documented?
>>
>>> 1e-2 < "0.05"
>> [1] TRUE
>>> 1e-4 < "0.05"
>> [1] FALSE
>>
>> Many thanks in advance for any pointer.
>>
>> Best,
>> Tobias
>>
>>> sessionInfo()
>> R Under development (unstable) (2013-01-01 r61512)
>> Platform: i386-w64-mingw32/i386 (32-bit)
>>
>> locale:
>> [1] LC_COLLATE=English_United States.1252
>> [2] LC_CTYPE=English_United States.1252
>> [3] LC_MONETARY=English_United States.1252
>> [4] LC_NUMERIC=C
>> [5] LC_TIME=English_United States.1252
>>
>> attached base packages:
>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel


From m.blackwell at rochester.edu  Wed Jan  2 21:48:07 2013
From: m.blackwell at rochester.edu (Matt Blackwell)
Date: Wed, 2 Jan 2013 15:48:07 -0500
Subject: [Rd] Understanding svd usage and its necessity in generalized
 inverse calculation
In-Reply-To: <CAJ55+dKEj5=n85sCyixor2_jJ-gM23u_ocQrLg3V0jvLWyxf=Q@mail.gmail.com>
References: <CAErODj9LyK3aZSJjxLPEeTTB3QN9rzEsdHYXnMa26xU98REQgg@mail.gmail.com>
	<CAJ55+dKEj5=n85sCyixor2_jJ-gM23u_ocQrLg3V0jvLWyxf=Q@mail.gmail.com>
Message-ID: <CAK1YySGRg-xOjXDJ6fJ2HExJw_X4iqTWUvVCNHLe2ie1TtvGRA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20130102/03ae2370/attachment.pl>

From jeff.a.ryan at gmail.com  Thu Jan  3 05:28:55 2013
From: jeff.a.ryan at gmail.com (Jeff Ryan)
Date: Wed, 2 Jan 2013 22:28:55 -0600
Subject: [Rd] formal vs. passed args: parent.frame() behavior.
Message-ID: <CABDUZc9MJHM9oQ5Ou=Rrd4FmE_wmmFOHKgGrcM6LAN5pwFf=0g@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20130102/6c5760bc/attachment.pl>

From pdalgd at gmail.com  Thu Jan  3 08:21:36 2013
From: pdalgd at gmail.com (peter dalgaard)
Date: Thu, 3 Jan 2013 08:21:36 +0100
Subject: [Rd] formal vs. passed args: parent.frame() behavior.
In-Reply-To: <CABDUZc9MJHM9oQ5Ou=Rrd4FmE_wmmFOHKgGrcM6LAN5pwFf=0g@mail.gmail.com>
References: <CABDUZc9MJHM9oQ5Ou=Rrd4FmE_wmmFOHKgGrcM6LAN5pwFf=0g@mail.gmail.com>
Message-ID: <FA1B3491-DF18-4045-A020-5C5A399AE114@gmail.com>


On Jan 3, 2013, at 05:28 , Jeff Ryan wrote:

> Happy 2013, Day 2.
> 
> I can't seem to figure out why parent.frame() works differently depending
> on whether it is a formal/default argument or a passed argument.

Because defaults are evaluated in the function's evaluation environment, whereas passed arguments are evaluated in the caller's environment. Notice in particular, that defaults can refer to other arguments (as in probability=!freq in hist.default) and even to internal variables occasionally.

> 
> ##### code: basic setup ####
> 
> tmp <- tempfile()
> A <- 101
> save(A,file=tmp);rm(A)
> 
> # these work as expected, loading into the parent of the call load()
> load(tmp);str(A);rm(A)
> load(tmp, parent.frame());str(A);rm(A)
> load(tmp, environment());str(A);rm(A)
> 
> 
> 
> # but these are odd, using local()
> 
> #     works
> local( { load(tmp); str(A) } )
> 
> #    FAILS even though env=parent.frame() by default !?!!
> local( { load(tmp,env=parent.frame()); str(A) } )
> 
> #     works as well!
> local( { load(tmp,env=environment()); str(A) } )
> 
> ls()            ## NOT in .GlobalEnv, correct!
> args(load)  ## env=parent.frame() by default, but is it???
> 
> 
> My question is why parent.frame() can't be specified in the args without
> changing the behavior of the call itself if you aren't at the top level.
> 
> What am I missing?
> 
> Jeff
> 
> 
> ##### output #####
> 
>> tmp <- tempfile()
>> A <- 101
>> save(A,file=tmp);rm(A)
>> 
>> # these work as expected, loading into the parent of the call load()
>> load(tmp);str(A);rm(A)
> num 101
>> load(tmp, parent.frame());str(A);rm(A)
> num 101
>> load(tmp, environment());str(A);rm(A)
> num 101
>> 
>> 
>> 
>> # but these are odd, using local()
>> 
>> #     works
>> local( { load(tmp); str(A) } )
> num 101
>> 
>> #    fails even though env=parent.frame() by default !?!!
>> local( { load(tmp,env=parent.frame()); str(A) } )
> Error in str(A) : object 'A' not found
>> 
>> #     works as well!
>> local( { load(tmp,env=environment()); str(A) } )
> num 101
>> 
>> ls()            ## NOT in .GlobalEnv, correct!
> [1] "tmp"
>> args(load)  ## env=parent.frame() by default, but is it???
> function (file, envir = parent.frame())
> NULL
>> 
> 
> -- 
> Jeffrey Ryan
> jeffrey.ryan at lemnica.com
> 
> www.lemnica.com
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Peter Dalgaard, Professor,
Center for Statistics, Copenhagen Business School
Solbjerg Plads 3, 2000 Frederiksberg, Denmark
Phone: (+45)38153501
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From karl.forner at gmail.com  Thu Jan  3 10:32:21 2013
From: karl.forner at gmail.com (Karl Forner)
Date: Thu, 3 Jan 2013 10:32:21 +0100
Subject: [Rd] weird bug with parallel, RSQlite and tcltk
In-Reply-To: <52B72508-C480-4DF3-B1E6-8B9DDA0DFD78@r-project.org>
References: <CAMd4_Ac0+CgORVFfhFAXTttAza1iG1aagZ08j_E-U-rYZspLXg@mail.gmail.com>
	<52B72508-C480-4DF3-B1E6-8B9DDA0DFD78@r-project.org>
Message-ID: <CAMd4_Af2FihaiMYsv8vKL4z_V+X4oWUtce4HDH5iqZa-V4ji7A@mail.gmail.com>

Hello,

The point is that I do not use tcltk, it gets loaded probably as a
dependency of a dependency of a package.
When I unload it all work perfectly fine. I just found it because one
of my computer did not have tk8.5 installed, and did not exhibit the
mentioned bug. So I really think something should be done about this.
Maybe the "gui loop" should not be run a the the loading of the tcltk
package, but
at the first function ran, or something like this.

As you can see in my example code, the in-memory database is opened in
the parallel code...

Best,
Karl

On Mon, Dec 31, 2012 at 10:58 PM, Simon Urbanek
<simon.urbanek at r-project.org> wrote:
>
> On Dec 31, 2012, at 1:08 PM, Karl Forner wrote:
>
>> Hello,
>>
>> I spent a lot of a time on a weird bug, and I just managed to narrow it down.
>>
>
> First, tcltk and multicore don't mix well, see the warning in the documentation (it mentions GUIs and AFAIR tcltk fires up a GUI event loop even if you don't actually create GUI elements). Second, using any kind of descriptors in parallel code is asking for trouble since those will be owned by multiple processes. If you use databases files, etc. they must be opened in the parallel code, they cannot be shared by multiple workers. The latter is ok in your code so you're probably bitten by the former.
>
> Cheers,
> Simon
>
>
>
>> In parallel code (here with parallel::mclappy, but I got it
>> doMC/multicore too), if the library(tcltk) is loaded, R hangs when
>> trying to open a DB connection.
>> I got the same behaviour on two different computers, one dual-core,
>> and one 2 xeon quad-core.
>>
>> Here's the code:
>>
>> library(parallel)
>> library(RSQLite)
>> library(tcltk)
>> #unloadNamespace("tcltk")
>>
>> res <- mclapply(1:2, function(x) {
>>       db <- DBI::dbConnect("SQLite", ":memory:")
>> }, mc.cores=2)
>> print("Done")
>>
>> When I execute it (R --vanilla  < test_parallel_db.R), it hangs
>> forever, and I have to type several times CTRL+C to interrupt it. I
>> then get this message:
>>
>> Warning messages:
>> 1: In selectChildren(ac, 1) : error 'Interrupted system call' in select
>> 2: In selectChildren(ac, 1) : error 'Interrupted system call' in select
>>
>> Then, just remove library(tcltk), or uncomment
>> unloadNamespace("tcltk"), and it works fine again.
>>
>> I guess there's a bug somewhere, but where exactly ?
>>
>> Best,
>>
>> Karl Forner
>>
>> Further info:
>>
>>
>> R version 2.15.1 (2012-06-22) -- "Roasted Marshmallows"
>> Copyright (C) 2012 The R Foundation for Statistical Computing
>> ISBN 3-900051-07-0
>> Platform: x86_64-unknown-linux-gnu (64-bit)
>>
>> ubuntu 12.04 and 12.10
>>
>> ubuntu package tk8.5
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
>


From pdalgd at gmail.com  Thu Jan  3 11:59:39 2013
From: pdalgd at gmail.com (peter dalgaard)
Date: Thu, 3 Jan 2013 11:59:39 +0100
Subject: [Rd] weird bug with parallel, RSQlite and tcltk
In-Reply-To: <CAMd4_Af2FihaiMYsv8vKL4z_V+X4oWUtce4HDH5iqZa-V4ji7A@mail.gmail.com>
References: <CAMd4_Ac0+CgORVFfhFAXTttAza1iG1aagZ08j_E-U-rYZspLXg@mail.gmail.com>
	<52B72508-C480-4DF3-B1E6-8B9DDA0DFD78@r-project.org>
	<CAMd4_Af2FihaiMYsv8vKL4z_V+X4oWUtce4HDH5iqZa-V4ji7A@mail.gmail.com>
Message-ID: <CB37B576-979C-462D-8362-10BC6F15B58E@gmail.com>


On Jan 3, 2013, at 10:32 , Karl Forner wrote:

> Hello,
> 
> The point is that I do not use tcltk, it gets loaded probably as a
> dependency of a dependency of a package.
> When I unload it all work perfectly fine. I just found it because one
> of my computer did not have tk8.5 installed, and did not exhibit the
> mentioned bug. So I really think something should be done about this.
> Maybe the "gui loop" should not be run a the the loading of the tcltk
> package, but
> at the first function ran, or something like this.

Doesn't sound doable. It would be tricky to do and wouldn't help in the cases where people actually want to use the GUI - plus, it would leave a time bomb if you directly or indirectly fire up a Tk window (say, the CRAN menu from install.packages()).

More likely, the wisdom of calling R_ProcessEvents and R_PolledEvents in parallel processes should be questioned. I tend to think that they should both be disabled completely conditionally on R_isForkedChild. At least in the Tk loop, some of the events are generated as responses to specific queries, and having one process ask for something and another one handling the reply, leaving the first one waiting indefinitely, is just Not Right.

On the other hand, I'm unsure whether the parent process has its hands free to handle events while a set of parallel processes are in operation. If not, then I suppose that the GUI could get stopped dead in its tracks. 

> 
> As you can see in my example code, the in-memory database is opened in
> the parallel code...
> 
> Best,
> Karl
> 
> On Mon, Dec 31, 2012 at 10:58 PM, Simon Urbanek
> <simon.urbanek at r-project.org> wrote:
>> 
>> On Dec 31, 2012, at 1:08 PM, Karl Forner wrote:
>> 
>>> Hello,
>>> 
>>> I spent a lot of a time on a weird bug, and I just managed to narrow it down.
>>> 
>> 
>> First, tcltk and multicore don't mix well, see the warning in the documentation (it mentions GUIs and AFAIR tcltk fires up a GUI event loop even if you don't actually create GUI elements). Second, using any kind of descriptors in parallel code is asking for trouble since those will be owned by multiple processes. If you use databases files, etc. they must be opened in the parallel code, they cannot be shared by multiple workers. The latter is ok in your code so you're probably bitten by the former.
>> 
>> Cheers,
>> Simon
>> 
>> 
>> 
>>> In parallel code (here with parallel::mclappy, but I got it
>>> doMC/multicore too), if the library(tcltk) is loaded, R hangs when
>>> trying to open a DB connection.
>>> I got the same behaviour on two different computers, one dual-core,
>>> and one 2 xeon quad-core.
>>> 
>>> Here's the code:
>>> 
>>> library(parallel)
>>> library(RSQLite)
>>> library(tcltk)
>>> #unloadNamespace("tcltk")
>>> 
>>> res <- mclapply(1:2, function(x) {
>>>      db <- DBI::dbConnect("SQLite", ":memory:")
>>> }, mc.cores=2)
>>> print("Done")
>>> 
>>> When I execute it (R --vanilla  < test_parallel_db.R), it hangs
>>> forever, and I have to type several times CTRL+C to interrupt it. I
>>> then get this message:
>>> 
>>> Warning messages:
>>> 1: In selectChildren(ac, 1) : error 'Interrupted system call' in select
>>> 2: In selectChildren(ac, 1) : error 'Interrupted system call' in select
>>> 
>>> Then, just remove library(tcltk), or uncomment
>>> unloadNamespace("tcltk"), and it works fine again.
>>> 
>>> I guess there's a bug somewhere, but where exactly ?
>>> 
>>> Best,
>>> 
>>> Karl Forner
>>> 
>>> Further info:
>>> 
>>> 
>>> R version 2.15.1 (2012-06-22) -- "Roasted Marshmallows"
>>> Copyright (C) 2012 The R Foundation for Statistical Computing
>>> ISBN 3-900051-07-0
>>> Platform: x86_64-unknown-linux-gnu (64-bit)
>>> 
>>> ubuntu 12.04 and 12.10
>>> 
>>> ubuntu package tk8.5
>>> 
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>> 
>>> 
>> 
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Peter Dalgaard, Professor
Center for Statistics, Copenhagen Business School
Solbjerg Plads 3, 2000 Frederiksberg, Denmark
Phone: (+45)38153501
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From ggrothendieck at gmail.com  Thu Jan  3 12:14:28 2013
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Thu, 3 Jan 2013 06:14:28 -0500
Subject: [Rd] weird bug with parallel, RSQlite and tcltk
In-Reply-To: <CAMd4_Af2FihaiMYsv8vKL4z_V+X4oWUtce4HDH5iqZa-V4ji7A@mail.gmail.com>
References: <CAMd4_Ac0+CgORVFfhFAXTttAza1iG1aagZ08j_E-U-rYZspLXg@mail.gmail.com>
	<52B72508-C480-4DF3-B1E6-8B9DDA0DFD78@r-project.org>
	<CAMd4_Af2FihaiMYsv8vKL4z_V+X4oWUtce4HDH5iqZa-V4ji7A@mail.gmail.com>
Message-ID: <CAP01uR=pczw-KCZAkJFju0WJ5kut++oxNvxyReHgF+D8-ehEEw@mail.gmail.com>

On Thu, Jan 3, 2013 at 4:32 AM, Karl Forner <karl.forner at gmail.com> wrote:
> Hello,
>
> The point is that I do not use tcltk, it gets loaded probably as a
> dependency of a dependency of a package.
> When I unload it all work perfectly fine. I just found it because one
> of my computer did not have tk8.5 installed, and did not exhibit the
> mentioned bug. So I really think something should be done about this.
> Maybe the "gui loop" should not be run a the the loading of the tcltk
> package, but
> at the first function ran, or something like this.
>
> As you can see in my example code, the in-memory database is opened in
> the parallel code...
>
> Best,
> Karl

If the package you are referring to is gsubfn or a package dependent
on it such as sqldf then you can ask it to use the R engine rather
than the tcltk engine by using this option:

options(gsubfn.engine = "R")

There is more in the FAQs on the gsubfn home page: http://gsubfn.googlecode.com

>
> On Mon, Dec 31, 2012 at 10:58 PM, Simon Urbanek
> <simon.urbanek at r-project.org> wrote:
>>
>> On Dec 31, 2012, at 1:08 PM, Karl Forner wrote:
>>
>>> Hello,
>>>
>>> I spent a lot of a time on a weird bug, and I just managed to narrow it down.
>>>
>>
>> First, tcltk and multicore don't mix well, see the warning in the documentation (it mentions GUIs and AFAIR tcltk fires up a GUI event loop even if you don't actually create GUI elements). Second, using any kind of descriptors in parallel code is asking for trouble since those will be owned by multiple processes. If you use databases files, etc. they must be opened in the parallel code, they cannot be shared by multiple workers. The latter is ok in your code so you're probably bitten by the former.
>>
>> Cheers,
>> Simon
>>
>>
>>
>>> In parallel code (here with parallel::mclappy, but I got it
>>> doMC/multicore too), if the library(tcltk) is loaded, R hangs when
>>> trying to open a DB connection.
>>> I got the same behaviour on two different computers, one dual-core,
>>> and one 2 xeon quad-core.
>>>
>>> Here's the code:
>>>
>>> library(parallel)
>>> library(RSQLite)
>>> library(tcltk)
>>> #unloadNamespace("tcltk")
>>>
>>> res <- mclapply(1:2, function(x) {
>>>       db <- DBI::dbConnect("SQLite", ":memory:")
>>> }, mc.cores=2)
>>> print("Done")
>>>
>>> When I execute it (R --vanilla  < test_parallel_db.R), it hangs
>>> forever, and I have to type several times CTRL+C to interrupt it. I
>>> then get this message:
>>>
>>> Warning messages:
>>> 1: In selectChildren(ac, 1) : error 'Interrupted system call' in select
>>> 2: In selectChildren(ac, 1) : error 'Interrupted system call' in select
>>>
>>> Then, just remove library(tcltk), or uncomment
>>> unloadNamespace("tcltk"), and it works fine again.
>>>
>>> I guess there's a bug somewhere, but where exactly ?
>>>
>>> Best,
>>>
>>> Karl Forner
>>>
>>> Further info:
>>>
>>>
>>> R version 2.15.1 (2012-06-22) -- "Roasted Marshmallows"
>>> Copyright (C) 2012 The R Foundation for Statistical Computing
>>> ISBN 3-900051-07-0
>>> Platform: x86_64-unknown-linux-gnu (64-bit)
>>>
>>> ubuntu 12.04 and 12.10
>>>
>>> ubuntu package tk8.5
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>>
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel



--
Statistics & Software Consulting
GKX Group, GKX Associates Inc.
tel: 1-877-GKX-GROUP
email: ggrothendieck at gmail.com


From ggrothendieck at gmail.com  Thu Jan  3 12:20:38 2013
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Thu, 3 Jan 2013 06:20:38 -0500
Subject: [Rd] weird bug with parallel, RSQlite and tcltk
In-Reply-To: <CB37B576-979C-462D-8362-10BC6F15B58E@gmail.com>
References: <CAMd4_Ac0+CgORVFfhFAXTttAza1iG1aagZ08j_E-U-rYZspLXg@mail.gmail.com>
	<52B72508-C480-4DF3-B1E6-8B9DDA0DFD78@r-project.org>
	<CAMd4_Af2FihaiMYsv8vKL4z_V+X4oWUtce4HDH5iqZa-V4ji7A@mail.gmail.com>
	<CB37B576-979C-462D-8362-10BC6F15B58E@gmail.com>
Message-ID: <CAP01uR=Vm1+_AfhdTbvcuN_g-diXPMS7dgScptRN-82393LCeQ@mail.gmail.com>

On Thu, Jan 3, 2013 at 5:59 AM, peter dalgaard <pdalgd at gmail.com> wrote:
>
> On Jan 3, 2013, at 10:32 , Karl Forner wrote:
>
>> Hello,
>>
>> The point is that I do not use tcltk, it gets loaded probably as a
>> dependency of a dependency of a package.
>> When I unload it all work perfectly fine. I just found it because one
>> of my computer did not have tk8.5 installed, and did not exhibit the
>> mentioned bug. So I really think something should be done about this.
>> Maybe the "gui loop" should not be run a the the loading of the tcltk
>> package, but
>> at the first function ran, or something like this.
>
> Doesn't sound doable. It would be tricky to do and wouldn't help in the cases where people actually want to use the GUI - plus, it would leave a time bomb if you directly or indirectly fire up a Tk window (say, the CRAN menu from install.packages()).
>

Would it be possible to separate the tk and tcl portions of tcltk into
two packages so that the tcltk package would be dependent on a new tcl
package ?  From the viewpoint of a user of tcltk there would be no
change but it would allow packages that only use tcl to declare a
dependency only on that.

By the way, tcl/tk 8.6 was released about 10 days ago with a ton of
attractive new features and it would be nice to have it in the R
windows build:
http://www.tcl.tk/software/tcltk/8.6.html


From murdoch.duncan at gmail.com  Thu Jan  3 12:42:21 2013
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Thu, 03 Jan 2013 06:42:21 -0500
Subject: [Rd] weird bug with parallel, RSQlite and tcltk
In-Reply-To: <CAP01uR=Vm1+_AfhdTbvcuN_g-diXPMS7dgScptRN-82393LCeQ@mail.gmail.com>
References: <CAMd4_Ac0+CgORVFfhFAXTttAza1iG1aagZ08j_E-U-rYZspLXg@mail.gmail.com>
	<52B72508-C480-4DF3-B1E6-8B9DDA0DFD78@r-project.org>
	<CAMd4_Af2FihaiMYsv8vKL4z_V+X4oWUtce4HDH5iqZa-V4ji7A@mail.gmail.com>
	<CB37B576-979C-462D-8362-10BC6F15B58E@gmail.com>
	<CAP01uR=Vm1+_AfhdTbvcuN_g-diXPMS7dgScptRN-82393LCeQ@mail.gmail.com>
Message-ID: <50E56E9D.90508@gmail.com>

On 13-01-03 6:20 AM, Gabor Grothendieck wrote:
> On Thu, Jan 3, 2013 at 5:59 AM, peter dalgaard <pdalgd at gmail.com> wrote:
>>
>> On Jan 3, 2013, at 10:32 , Karl Forner wrote:
>>
>>> Hello,
>>>
>>> The point is that I do not use tcltk, it gets loaded probably as a
>>> dependency of a dependency of a package.
>>> When I unload it all work perfectly fine. I just found it because one
>>> of my computer did not have tk8.5 installed, and did not exhibit the
>>> mentioned bug. So I really think something should be done about this.
>>> Maybe the "gui loop" should not be run a the the loading of the tcltk
>>> package, but
>>> at the first function ran, or something like this.
>>
>> Doesn't sound doable. It would be tricky to do and wouldn't help in the cases where people actually want to use the GUI - plus, it would leave a time bomb if you directly or indirectly fire up a Tk window (say, the CRAN menu from install.packages()).
>>
>
> Would it be possible to separate the tk and tcl portions of tcltk into
> two packages so that the tcltk package would be dependent on a new tcl
> package ?  From the viewpoint of a user of tcltk there would be no
> change but it would allow packages that only use tcl to declare a
> dependency only on that.
>
> By the way, tcl/tk 8.6 was released about 10 days ago with a ton of
> attractive new features and it would be nice to have it in the R
> windows build:
> http://www.tcl.tk/software/tcltk/8.6.html

I think it's unlikely that we will upgrade.  The binaries available at 
that link do not have a license that would allow distribution with R, 
and we no longer have the facilities (specific compiler, time, etc.) to 
compile it ourselves.  I haven't tried myself, but my understanding is 
that the sources are not compatible with our compiler suite.

Duncan Murdoch


From ripley at stats.ox.ac.uk  Thu Jan  3 13:13:29 2013
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 03 Jan 2013 12:13:29 +0000
Subject: [Rd] weird bug with parallel, RSQlite and tcltk
In-Reply-To: <50E56E9D.90508@gmail.com>
References: <CAMd4_Ac0+CgORVFfhFAXTttAza1iG1aagZ08j_E-U-rYZspLXg@mail.gmail.com>
	<52B72508-C480-4DF3-B1E6-8B9DDA0DFD78@r-project.org>
	<CAMd4_Af2FihaiMYsv8vKL4z_V+X4oWUtce4HDH5iqZa-V4ji7A@mail.gmail.com>
	<CB37B576-979C-462D-8362-10BC6F15B58E@gmail.com>
	<CAP01uR=Vm1+_AfhdTbvcuN_g-diXPMS7dgScptRN-82393LCeQ@mail.gmail.com>
	<50E56E9D.90508@gmail.com>
Message-ID: <50E575E9.2000203@stats.ox.ac.uk>

On 03/01/2013 11:42, Duncan Murdoch wrote:
> On 13-01-03 6:20 AM, Gabor Grothendieck wrote:
>> On Thu, Jan 3, 2013 at 5:59 AM, peter dalgaard <pdalgd at gmail.com> wrote:
>>>
>>> On Jan 3, 2013, at 10:32 , Karl Forner wrote:
>>>
>>>> Hello,
>>>>
>>>> The point is that I do not use tcltk, it gets loaded probably as a
>>>> dependency of a dependency of a package.
>>>> When I unload it all work perfectly fine. I just found it because one
>>>> of my computer did not have tk8.5 installed, and did not exhibit the
>>>> mentioned bug. So I really think something should be done about this.
>>>> Maybe the "gui loop" should not be run a the the loading of the tcltk
>>>> package, but
>>>> at the first function ran, or something like this.
>>>
>>> Doesn't sound doable. It would be tricky to do and wouldn't help in
>>> the cases where people actually want to use the GUI - plus, it would
>>> leave a time bomb if you directly or indirectly fire up a Tk window
>>> (say, the CRAN menu from install.packages()).
>>>
>>
>> Would it be possible to separate the tk and tcl portions of tcltk into
>> two packages so that the tcltk package would be dependent on a new tcl
>> package ?  From the viewpoint of a user of tcltk there would be no
>> change but it would allow packages that only use tcl to declare a
>> dependency only on that.
>>
>> By the way, tcl/tk 8.6 was released about 10 days ago with a ton of
>> attractive new features and it would be nice to have it in the R
>> windows build:
>> http://www.tcl.tk/software/tcltk/8.6.html
>
> I think it's unlikely that we will upgrade.  The binaries available at
> that link do not have a license that would allow distribution with R,
> and we no longer have the facilities (specific compiler, time, etc.) to
> compile it ourselves.  I haven't tried myself, but my understanding is
> that the sources are not compatible with our compiler suite.

More specifically, when last checked the sources do compile but do not 
work when loaded into R as memory gets corrupted.

Note that the version of Tcl/Tk made available for the CRAN Mac binary 
is older than that for Windows.

>
> Duncan Murdoch
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From pdalgd at gmail.com  Thu Jan  3 13:45:03 2013
From: pdalgd at gmail.com (peter dalgaard)
Date: Thu, 3 Jan 2013 13:45:03 +0100
Subject: [Rd] weird bug with parallel, RSQlite and tcltk
In-Reply-To: <CAP01uR=Vm1+_AfhdTbvcuN_g-diXPMS7dgScptRN-82393LCeQ@mail.gmail.com>
References: <CAMd4_Ac0+CgORVFfhFAXTttAza1iG1aagZ08j_E-U-rYZspLXg@mail.gmail.com>
	<52B72508-C480-4DF3-B1E6-8B9DDA0DFD78@r-project.org>
	<CAMd4_Af2FihaiMYsv8vKL4z_V+X4oWUtce4HDH5iqZa-V4ji7A@mail.gmail.com>
	<CB37B576-979C-462D-8362-10BC6F15B58E@gmail.com>
	<CAP01uR=Vm1+_AfhdTbvcuN_g-diXPMS7dgScptRN-82393LCeQ@mail.gmail.com>
Message-ID: <1B81C46B-0ADE-4B34-A81A-A02E0636CC16@gmail.com>


On Jan 3, 2013, at 12:20 , Gabor Grothendieck wrote:

> On Thu, Jan 3, 2013 at 5:59 AM, peter dalgaard <pdalgd at gmail.com> wrote:
>> 
>> On Jan 3, 2013, at 10:32 , Karl Forner wrote:
>> 
>>> Hello,
>>> 
>>> The point is that I do not use tcltk, it gets loaded probably as a
>>> dependency of a dependency of a package.
>>> When I unload it all work perfectly fine. I just found it because one
>>> of my computer did not have tk8.5 installed, and did not exhibit the
>>> mentioned bug. So I really think something should be done about this.
>>> Maybe the "gui loop" should not be run a the the loading of the tcltk
>>> package, but
>>> at the first function ran, or something like this.
>> 
>> Doesn't sound doable. It would be tricky to do and wouldn't help in the cases where people actually want to use the GUI - plus, it would leave a time bomb if you directly or indirectly fire up a Tk window (say, the CRAN menu from install.packages()).
>> 
> 
> Would it be possible to separate the tk and tcl portions of tcltk into
> two packages so that the tcltk package would be dependent on a new tcl
> package ?  From the viewpoint of a user of tcltk there would be no
> change but it would allow packages that only use tcl to declare a
> dependency only on that.

Not sure that actually solves much. We do this already if the DISPLAY is unset for X11, so the logic should not be too hard to extend, but the event loop belongs to Tcl, Tk events are just a special type of events.

> 
> By the way, tcl/tk 8.6 was released about 10 days ago with a ton of
> attractive new features and it would be nice to have it in the R
> windows build:
> http://www.tcl.tk/software/tcltk/8.6.html

-- 
Peter Dalgaard, Professor
Center for Statistics, Copenhagen Business School
Solbjerg Plads 3, 2000 Frederiksberg, Denmark
Phone: (+45)38153501
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From pdalgd at gmail.com  Thu Jan  3 14:20:31 2013
From: pdalgd at gmail.com (peter dalgaard)
Date: Thu, 3 Jan 2013 14:20:31 +0100
Subject: [Rd] weird bug with parallel, RSQlite and tcltk
In-Reply-To: <50E575E9.2000203@stats.ox.ac.uk>
References: <CAMd4_Ac0+CgORVFfhFAXTttAza1iG1aagZ08j_E-U-rYZspLXg@mail.gmail.com>
	<52B72508-C480-4DF3-B1E6-8B9DDA0DFD78@r-project.org>
	<CAMd4_Af2FihaiMYsv8vKL4z_V+X4oWUtce4HDH5iqZa-V4ji7A@mail.gmail.com>
	<CB37B576-979C-462D-8362-10BC6F15B58E@gmail.com>
	<CAP01uR=Vm1+_AfhdTbvcuN_g-diXPMS7dgScptRN-82393LCeQ@mail.gmail.com>
	<50E56E9D.90508@gmail.com> <50E575E9.2000203@stats.ox.ac.uk>
Message-ID: <8F04FB21-95E5-4420-A10B-B10B02DB4338@gmail.com>


On Jan 3, 2013, at 13:13 , Prof Brian Ripley wrote:

> On 03/01/2013 11:42, Duncan Murdoch wrote:
>> On 13-01-03 6:20 AM, Gabor Grothendieck wrote:
>> [snipped]


>> I think it's unlikely that we will upgrade.  The binaries available at
>> that link do not have a license that would allow distribution with R,
>> and we no longer have the facilities (specific compiler, time, etc.) to
>> compile it ourselves.  I haven't tried myself, but my understanding is
>> that the sources are not compatible with our compiler suite.
> 
> More specifically, when last checked the sources do compile but do not work when loaded into R as memory gets corrupted.
> 
> Note that the version of Tcl/Tk made available for the CRAN Mac binary is older than that for Windows.

Of course anyone is welcome to try their hand at getting Tcl/Tk to build properly with the R compiler suite. And/or dig into what might be getting in the way. Or, for that matter, build against the ActiveTcl binaries; it is only redistribution that is disallowed --- it is Free as in Beer, but not as in Speech.

(Looks like MacPorts moved to Tcl/Tk 8.6. I'll see if it works with their R port.)

-- 
Peter Dalgaard, Professor
Center for Statistics, Copenhagen Business School
Solbjerg Plads 3, 2000 Frederiksberg, Denmark
Phone: (+45)38153501
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From ggrothendieck at gmail.com  Thu Jan  3 14:36:44 2013
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Thu, 3 Jan 2013 08:36:44 -0500
Subject: [Rd] weird bug with parallel, RSQlite and tcltk
In-Reply-To: <1B81C46B-0ADE-4B34-A81A-A02E0636CC16@gmail.com>
References: <CAMd4_Ac0+CgORVFfhFAXTttAza1iG1aagZ08j_E-U-rYZspLXg@mail.gmail.com>
	<52B72508-C480-4DF3-B1E6-8B9DDA0DFD78@r-project.org>
	<CAMd4_Af2FihaiMYsv8vKL4z_V+X4oWUtce4HDH5iqZa-V4ji7A@mail.gmail.com>
	<CB37B576-979C-462D-8362-10BC6F15B58E@gmail.com>
	<CAP01uR=Vm1+_AfhdTbvcuN_g-diXPMS7dgScptRN-82393LCeQ@mail.gmail.com>
	<1B81C46B-0ADE-4B34-A81A-A02E0636CC16@gmail.com>
Message-ID: <CAP01uRn6sRoDYkKZkFm=uYnWmXsYCBk2kq7zKeURcOj2zfPt-g@mail.gmail.com>

On Thu, Jan 3, 2013 at 7:45 AM, peter dalgaard <pdalgd at gmail.com> wrote:
>
> On Jan 3, 2013, at 12:20 , Gabor Grothendieck wrote:
>
>> On Thu, Jan 3, 2013 at 5:59 AM, peter dalgaard <pdalgd at gmail.com> wrote:
>>>
>>> On Jan 3, 2013, at 10:32 , Karl Forner wrote:
>>>
>>>> Hello,
>>>>
>>>> The point is that I do not use tcltk, it gets loaded probably as a
>>>> dependency of a dependency of a package.
>>>> When I unload it all work perfectly fine. I just found it because one
>>>> of my computer did not have tk8.5 installed, and did not exhibit the
>>>> mentioned bug. So I really think something should be done about this.
>>>> Maybe the "gui loop" should not be run a the the loading of the tcltk
>>>> package, but
>>>> at the first function ran, or something like this.
>>>
>>> Doesn't sound doable. It would be tricky to do and wouldn't help in the cases where people actually want to use the GUI - plus, it would leave a time bomb if you directly or indirectly fire up a Tk window (say, the CRAN menu from install.packages()).
>>>
>>
>> Would it be possible to separate the tk and tcl portions of tcltk into
>> two packages so that the tcltk package would be dependent on a new tcl
>> package ?  From the viewpoint of a user of tcltk there would be no
>> change but it would allow packages that only use tcl to declare a
>> dependency only on that.
>
> Not sure that actually solves much. We do this already if the DISPLAY is unset for X11, so the logic should not be too hard to extend, but the event loop belongs to Tcl, Tk events are just a special type of events.
>

OK. I had assumed the event loop was to process the GUI events only
and therefore would be in tk.

Another possibility might be just to have a standard option that users
or other packages could set to indicate that they don't have or don't
want to use tcltk so packages that do use tcltk could examine that
option and act accordingly (e.g. use alternate code or issue a
meaningful error).  I already use options(gsubfn.engine = "R") for
that purpose but that only works for my packages and if something were
standardized in tcltk then it could be more broadly applicable and
more visible.  As far as tcltk this is basically just a matter of
documentation to set the standard but for the parallel package, say,
the option could be automatically set in the workers.

--
Statistics & Software Consulting
GKX Group, GKX Associates Inc.
tel: 1-877-GKX-GROUP
email: ggrothendieck at gmail.com


From simon.urbanek at r-project.org  Thu Jan  3 18:25:16 2013
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Thu, 3 Jan 2013 12:25:16 -0500
Subject: [Rd] weird bug with parallel, RSQlite and tcltk
In-Reply-To: <CB37B576-979C-462D-8362-10BC6F15B58E@gmail.com>
References: <CAMd4_Ac0+CgORVFfhFAXTttAza1iG1aagZ08j_E-U-rYZspLXg@mail.gmail.com>
	<52B72508-C480-4DF3-B1E6-8B9DDA0DFD78@r-project.org>
	<CAMd4_Af2FihaiMYsv8vKL4z_V+X4oWUtce4HDH5iqZa-V4ji7A@mail.gmail.com>
	<CB37B576-979C-462D-8362-10BC6F15B58E@gmail.com>
Message-ID: <AB9701B6-7C03-42E7-B329-8DB265F528E5@r-project.org>


On Jan 3, 2013, at 5:59 AM, peter dalgaard wrote:

> 
> On Jan 3, 2013, at 10:32 , Karl Forner wrote:
> 
>> Hello,
>> 
>> The point is that I do not use tcltk, it gets loaded probably as a
>> dependency of a dependency of a package.
>> When I unload it all work perfectly fine. I just found it because one
>> of my computer did not have tk8.5 installed, and did not exhibit the
>> mentioned bug. So I really think something should be done about this.
>> Maybe the "gui loop" should not be run a the the loading of the tcltk
>> package, but
>> at the first function ran, or something like this.
> 
> Doesn't sound doable. It would be tricky to do and wouldn't help in the cases where people actually want to use the GUI - plus, it would leave a time bomb if you directly or indirectly fire up a Tk window (say, the CRAN menu from install.packages()).
> 
> More likely, the wisdom of calling R_ProcessEvents and R_PolledEvents in parallel processes should be questioned. I tend to think that they should both be disabled completely conditionally on R_isForkedChild. At least in the Tk loop, some of the events are generated as responses to specific queries, and having one process ask for something and another one handling the reply, leaving the first one waiting indefinitely, is just Not Right.
> 
> On the other hand, I'm unsure whether the parent process has its hands free to handle events while a set of parallel processes are in operation. If not, then I suppose that the GUI could get stopped dead in its tracks. 
> 

But it would anyway - children cannot process the events for the parent, so event processing should be disabled (they are all separate processes after all). The parent may be tied up in a select loop but that's ok as we know how to deal with it and it has hooks as needed (and it would be trivial to add explicit event processing if we think it's a good idea ...).

We already disable it for Cocoa .. the question it whether we should also remove all input handlers (they are likely to break as the FDs will be shared by the parent *and* children) or avoid only R_PolledEvents() ...

Cheers,
Simon


>> 
>> As you can see in my example code, the in-memory database is opened in
>> the parallel code...
>> 
>> Best,
>> Karl
>> 
>> On Mon, Dec 31, 2012 at 10:58 PM, Simon Urbanek
>> <simon.urbanek at r-project.org> wrote:
>>> 
>>> On Dec 31, 2012, at 1:08 PM, Karl Forner wrote:
>>> 
>>>> Hello,
>>>> 
>>>> I spent a lot of a time on a weird bug, and I just managed to narrow it down.
>>>> 
>>> 
>>> First, tcltk and multicore don't mix well, see the warning in the documentation (it mentions GUIs and AFAIR tcltk fires up a GUI event loop even if you don't actually create GUI elements). Second, using any kind of descriptors in parallel code is asking for trouble since those will be owned by multiple processes. If you use databases files, etc. they must be opened in the parallel code, they cannot be shared by multiple workers. The latter is ok in your code so you're probably bitten by the former.
>>> 
>>> Cheers,
>>> Simon
>>> 
>>> 
>>> 
>>>> In parallel code (here with parallel::mclappy, but I got it
>>>> doMC/multicore too), if the library(tcltk) is loaded, R hangs when
>>>> trying to open a DB connection.
>>>> I got the same behaviour on two different computers, one dual-core,
>>>> and one 2 xeon quad-core.
>>>> 
>>>> Here's the code:
>>>> 
>>>> library(parallel)
>>>> library(RSQLite)
>>>> library(tcltk)
>>>> #unloadNamespace("tcltk")
>>>> 
>>>> res <- mclapply(1:2, function(x) {
>>>>     db <- DBI::dbConnect("SQLite", ":memory:")
>>>> }, mc.cores=2)
>>>> print("Done")
>>>> 
>>>> When I execute it (R --vanilla  < test_parallel_db.R), it hangs
>>>> forever, and I have to type several times CTRL+C to interrupt it. I
>>>> then get this message:
>>>> 
>>>> Warning messages:
>>>> 1: In selectChildren(ac, 1) : error 'Interrupted system call' in select
>>>> 2: In selectChildren(ac, 1) : error 'Interrupted system call' in select
>>>> 
>>>> Then, just remove library(tcltk), or uncomment
>>>> unloadNamespace("tcltk"), and it works fine again.
>>>> 
>>>> I guess there's a bug somewhere, but where exactly ?
>>>> 
>>>> Best,
>>>> 
>>>> Karl Forner
>>>> 
>>>> Further info:
>>>> 
>>>> 
>>>> R version 2.15.1 (2012-06-22) -- "Roasted Marshmallows"
>>>> Copyright (C) 2012 The R Foundation for Statistical Computing
>>>> ISBN 3-900051-07-0
>>>> Platform: x86_64-unknown-linux-gnu (64-bit)
>>>> 
>>>> ubuntu 12.04 and 12.10
>>>> 
>>>> ubuntu package tk8.5
>>>> 
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>> 
>>>> 
>>> 
>> 
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> -- 
> Peter Dalgaard, Professor
> Center for Statistics, Copenhagen Business School
> Solbjerg Plads 3, 2000 Frederiksberg, Denmark
> Phone: (+45)38153501
> Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com
> 
> 


From ivo.welch at anderson.ucla.edu  Thu Jan  3 19:00:33 2013
From: ivo.welch at anderson.ucla.edu (ivo welch)
Date: Thu, 3 Jan 2013 10:00:33 -0800
Subject: [Rd] Bounty on Error Checking
Message-ID: <CAPr7RtW=qFqRDS2ZoUgz-pbMR8i5R74YCt+4if-uoyzofpoOnw@mail.gmail.com>

Dear R developers---I just spent half a day debugging an R program,
which had two bugs---I selected the wrongly named variable, which
turns out to have been a scalar, which then happily multiplied as if
it was a matrix; and another wrongly named variable from a data frame,
that triggered no error when used as a[["name"]] or a$name .  there
should be an option to turn on that throws an error inside R when one
does this.  I cannot imagine that there is much code that wants to
reference non-existing columns in data frames.

I know you guys are saints for developing without financial support.
but maybe we non-insider end-users can help by putting up a bounty
list on R-project for us end-users to contribute to?  I would pledge
$500 to a $10,000 fund that funds a project to comprehensively enhance
the programming and debugging aspects of R.  it would only take 20 of
us to make this possible.

personally, I think basic nudgeware is the way to go.  when a user
starts R in interactive mode, there should be a note that says,

 please donate $20 to the R foundation to support the development.
press enter to continue or enter your contribution number to avoid
this message in the future .

you can even accept the same string if need be.  it's a nudge only,
not a requirement.

regards,

/iaw

----
Ivo Welch (ivo.welch at gmail.com)
http://www.ivo-welch.info/
J. Fred Weston Professor of Finance
Anderson School at UCLA, C519
Director, UCLA Anderson Fink Center for Finance and Investments
Free Finance Textbook, http://book.ivo-welch.info/
Editor, Critical Finance Review, http://www.critical-finance-review.org/


From tim.triche at gmail.com  Thu Jan  3 19:13:26 2013
From: tim.triche at gmail.com (Tim Triche, Jr.)
Date: Thu, 3 Jan 2013 10:13:26 -0800
Subject: [Rd] Bounty on Error Checking
In-Reply-To: <CAPr7RtW=qFqRDS2ZoUgz-pbMR8i5R74YCt+4if-uoyzofpoOnw@mail.gmail.com>
References: <CAPr7RtW=qFqRDS2ZoUgz-pbMR8i5R74YCt+4if-uoyzofpoOnw@mail.gmail.com>
Message-ID: <CAC+N9BWsg5GMuFgO1XO7EX6TTsMrQXNrC+uAu_4reNNea9xsCw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20130103/1ff42770/attachment.pl>

From jmc at r-project.org  Thu Jan  3 20:08:30 2013
From: jmc at r-project.org (John Chambers)
Date: Thu, 03 Jan 2013 11:08:30 -0800
Subject: [Rd] Small changes to big objects (1)
Message-ID: <50E5D72E.5010704@r-project.org>

Martin Morgan commented in email to me that a change to any slot of an 
object that has other, large slot(s) does substantial computation, 
presumably from copying the whole object.  Is there anything to be done?

There are in fact two possible changes, one automatic but only partial, 
the other requiring some action on the programmer's part.  Herewith the 
first; I'll discuss the second in a later email.

Some context:  The notion is that our object has some big data and some 
additional smaller things.  We need to change the small things but would 
rather not copy the big things all the time.  (With long vectors, this 
becomes even more relevant.)

There are three likely scenarios: slots, attributes and named list 
components.  Suppose our object has "little" and "BIG" encoded in one of 
these.

The three relevant computations are:

x at little <- other
attr(x, "little") <- other
x$little <- other

It turns out that these are all similar in behavior with one important 
exception--fixing that is the automatic change.

I need to review what R does here. All these are replacement functions, 
`@<-`, `attr<-`, `$<-`.  The evaluator checks before calling any 
replacement whether the object needs to be duplicated (in a routine 
EnsureLocal()).  It does that by examining a special field that holds 
the reference status of the object.

Some languages, such as Python (and S) keep reference counts for each 
object, de-allocating the object when the reference count drops back to 
zero.  R uses a different strategy. Its NAMED() field is 0, 1 or 2 
according to whether the object has been assigned never, once or more 
than once.  The field is not a reference count and is not 
decremented--relevant for this issue.  Objects are de-allocated only 
when garbage collection occurs and the object does not appear in any 
current frame or other context.
(I did not write any of this code, so apologies if I'm misrepresenting it.)

When any of these replacement operations first occurs for a particular 
object in a particular function call, it's very likely that the 
reference status will be 2 and EnsureLocal will duplicate it--all of it. 
Regardless of which of the three forms is used.

Here the non-level-playing-field aspect comes in.  `@<-` is a normal R 
function (a "closure") but the other two are primitives in the main code 
for R.  Primitives have no frame in which arguments are stored.  As a 
result the new version of x is normally stored with status 1.

If one does a second replacement in the same call (in a loop, e.g.) that 
should not normally copy again.  But the result of `@<-` will be an 
object from its frame and will have status 2 when saved, forcing a copy 
each time.

So the change, naturally, is that R 3.0.0 will have a primitive 
implementation of `@<`.  This has been implemented in r-devel (rev. 61544).

Please try it out _before_ we issue that version, especially if you own 
a package that does things related to this question.

John

PS:  Some may have noticed that I didn't mention a fourth approach: 
fields in a reference class object.  The assumption was that we wanted 
classical, functional behavior here.  Reference classes don't have the 
copy problem but don't behave functionally either.  But that is in fact 
the direction for the other approach.  I'll discuss that later, when the 
corresponding code is available.


From mdowle at mdowle.plus.com  Thu Jan  3 20:28:43 2013
From: mdowle at mdowle.plus.com (Matthew Dowle)
Date: Thu, 03 Jan 2013 19:28:43 +0000
Subject: [Rd] Bounty on Error Checking
Message-ID: <b072c553e64b4f47f775cec5a018c922@imap.plus.net>


Ivo,

That's standard R behaviour. But I've had similar bugs
as you.

If you really want to change it then one way would be to
create your own helper function, say strictselect(), or
shorter name and ensure to use that instead of [[ and $.

Or, how about something like this? :

> DF = data.frame(a=1:3,b=4:6)
> DF$foo
NULL
> DF[["foo"]]
NULL
> "$.data.frame" = "[[.data.frame" = function(x,...) {
     if (!..1 %in% names(x)) stop("Column not found!")
     else base::"[[.data.frame"(x,...)
   }
> DF$foo
Error in `$.data.frame`(DF, foo) : Column not found!
> DF[["foo"]]
Error in `[[.data.frame`(DF, "foo") : Column not found!
> DF[["newcol"]] <- 7:9
> DF
   a b newcol
1 1 4      7
2 2 5      8
3 3 6      9

Masking those methods in your .GlobalEnv shouldn't break
packages that may rely on missing columns returning NULL
because all packages now have namespaces. So this mask
should just affect your own code, iiuc.

You could place those masks into your Rprofile.site.

It was quickly typed and tested, and not thoroughly
thought through, so *it is just a straw man*.

Matthew


From pauljohn32 at gmail.com  Thu Jan  3 21:16:49 2013
From: pauljohn32 at gmail.com (Paul Johnson)
Date: Thu, 3 Jan 2013 14:16:49 -0600
Subject: [Rd] weird bug with parallel, RSQlite and tcltk
In-Reply-To: <CAMd4_Ac0+CgORVFfhFAXTttAza1iG1aagZ08j_E-U-rYZspLXg@mail.gmail.com>
References: <CAMd4_Ac0+CgORVFfhFAXTttAza1iG1aagZ08j_E-U-rYZspLXg@mail.gmail.com>
Message-ID: <CAErODj__FyUtTk8drY8TVdKGVuYqZ_WgF=7_p8cRbSnk6U5Taw@mail.gmail.com>

Happy new year.

On Mon, Dec 31, 2012 at 12:08 PM, Karl Forner <karl.forner at gmail.com> wrote:
> Hello,
>
> I spent a lot of a time on a weird bug, and I just managed to narrow it down.
>
> In parallel code (here with parallel::mclappy, but I got it
> doMC/multicore too), if the library(tcltk) is loaded, R hangs when
> trying to open a DB connection.
> I got the same behaviour on two different computers, one dual-core,
> and one 2 xeon quad-core.
>

I believe this is the same problem discussed here:

https://bugs.r-project.org/bugzilla3/show_bug.cgi?id=15040

I am interested to know the long term implications of the discussion
going on here, but can I interject to ask the short term question:

With R-2.15.2, is there something I can do to defend myself before
calling mclapply? Suppose I don't intentionally use tcltk, but some
package I use has loaded it. Or somebody ran install.packages(). What
to do?

I thought this would work:

detach(package:tcltk, unload=TRUE)

I ran one test case where it seemed to work, but then started a
several new sessions and got a big crashes.

Example 1. detach(package:tcltk) without unload=TRUE hangs

> library(parallel)
> library(tcltk)
Loading Tcl/Tk interface ... done
> detach(package:tcltk)
> example(mclapply)

mclppl> ## No test:
mclppl> simplify2array(mclapply(rep(4, 5), rnorm))
           [,1]       [,2]       [,3]       [,4]        [,5]
[1,] -0.1499368 -0.7511576  0.7675234 -0.1324973 -0.01118655
[2,] -0.5989764  0.6605780 -0.9417879  0.2295157 -0.16750436
[3,]  1.4585402  0.2513995  1.6857897 -0.1200986  1.19094290
[4,] -0.1459071 -1.7570450  0.2968794  1.1964827  1.87066283

mclppl> # use the same random numbers for all values
mclppl> set.seed(1)

mclppl> simplify2array(mclapply(rep(4, 5), rnorm, mc.preschedule = FALSE,
mclppl+                 mc.set.seed = FALSE))

Example 2. detach with unload=TRUE dies

> library(tcltk)
Loading Tcl/Tk interface ... done
> library(parallel)
> detach(package:tcltk, unload=TRUE)
> example(mclapply)
called Tcl_FindHashEntry on deleted table
Aborted

Ouch. Back to the shell, completely unceremonious. Does it matter in
which order they are loaded?

> library(parallel)
> library(tcltk)
Loading Tcl/Tk interface ... done
> detach(package:tcltk, unload=TRUE)
> example(mclapply)
called Tcl_FindHashEntry on deleted table
Aborted

In the short term, It would really help if we just had a foolproof way
to close, kill, remove, delete, detach and otherwise block tcltk, its
functions, its anything!

pj

> Here's the code:
>
> library(parallel)
> library(RSQLite)
> library(tcltk)
> #unloadNamespace("tcltk")
>
> res <- mclapply(1:2, function(x) {
>         db <- DBI::dbConnect("SQLite", ":memory:")
> }, mc.cores=2)
> print("Done")
>
> When I execute it (R --vanilla  < test_parallel_db.R), it hangs
> forever, and I have to type several times CTRL+C to interrupt it. I
> then get this message:
>
> Warning messages:
> 1: In selectChildren(ac, 1) : error 'Interrupted system call' in select
> 2: In selectChildren(ac, 1) : error 'Interrupted system call' in select
>
> Then, just remove library(tcltk), or uncomment
> unloadNamespace("tcltk"), and it works fine again.
>
> I guess there's a bug somewhere, but where exactly ?
>
> Best,
>
> Karl Forner
>
> Further info:
>
>
> R version 2.15.1 (2012-06-22) -- "Roasted Marshmallows"
> Copyright (C) 2012 The R Foundation for Statistical Computing
> ISBN 3-900051-07-0
> Platform: x86_64-unknown-linux-gnu (64-bit)
>
> ubuntu 12.04 and 12.10
>
> ubuntu package tk8.5
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel



-- 
Paul E. Johnson
Professor, Political Science      Assoc. Director
1541 Lilac Lane, Room 504      Center for Research Methods
University of Kansas                 University of Kansas
http://pj.freefaculty.org               http://quant.ku.edu


From pdalgd at gmail.com  Thu Jan  3 22:01:33 2013
From: pdalgd at gmail.com (peter dalgaard)
Date: Thu, 3 Jan 2013 22:01:33 +0100
Subject: [Rd] weird bug with parallel, RSQlite and tcltk
In-Reply-To: <8F04FB21-95E5-4420-A10B-B10B02DB4338@gmail.com>
References: <CAMd4_Ac0+CgORVFfhFAXTttAza1iG1aagZ08j_E-U-rYZspLXg@mail.gmail.com>
	<52B72508-C480-4DF3-B1E6-8B9DDA0DFD78@r-project.org>
	<CAMd4_Af2FihaiMYsv8vKL4z_V+X4oWUtce4HDH5iqZa-V4ji7A@mail.gmail.com>
	<CB37B576-979C-462D-8362-10BC6F15B58E@gmail.com>
	<CAP01uR=Vm1+_AfhdTbvcuN_g-diXPMS7dgScptRN-82393LCeQ@mail.gmail.com>
	<50E56E9D.90508@gmail.com> <50E575E9.2000203@stats.ox.ac.uk>
	<8F04FB21-95E5-4420-A10B-B10B02DB4338@gmail.com>
Message-ID: <0F47CF6F-B116-4B3C-B73D-0CA26152C5C5@gmail.com>


On Jan 3, 2013, at 14:20 , peter dalgaard wrote:

> 
> (Looks like MacPorts moved to Tcl/Tk 8.6. I'll see if it works with their R port.)

Done. No obvious consequences (i.e. demo(tkdensity) and a few Rcmdr experiments came out same as they used to).

-- 
Peter Dalgaard, Professor,
Center for Statistics, Copenhagen Business School
Solbjerg Plads 3, 2000 Frederiksberg, Denmark
Phone: (+45)38153501
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From bbolker at gmail.com  Thu Jan  3 23:52:44 2013
From: bbolker at gmail.com (Ben Bolker)
Date: Thu, 3 Jan 2013 22:52:44 +0000
Subject: [Rd] Bounty on Error Checking
References: <CAPr7RtW=qFqRDS2ZoUgz-pbMR8i5R74YCt+4if-uoyzofpoOnw@mail.gmail.com>
Message-ID: <loom.20130103T234406-301@post.gmane.org>

ivo welch <ivo.welch <at> anderson.ucla.edu> writes:

> 
> Dear R developers---I just spent half a day debugging an R program,
> which had two bugs---I selected the wrongly named variable, which
> turns out to have been a scalar, which then happily multiplied as if
> it was a matrix; and another wrongly named variable from a data frame,
> that triggered no error when used as a[["name"]] or a$name .  there
> should be an option to turn on that throws an error inside R when one
> does this.  I cannot imagine that there is much code that wants to
> reference non-existing columns in data frames.
> 
> I know you guys are saints for developing without financial support.
> but maybe we non-insider end-users can help by putting up a bounty
> list on R-project for us end-users to contribute to?  I would pledge
> $500 to a $10,000 fund that funds a project to comprehensively enhance
> the programming and debugging aspects of R.  it would only take 20 of
> us to make this possible.
> 
> personally, I think basic nudgeware is the way to go.  when a user
> starts R in interactive mode, there should be a note that says,
> 
>  please donate $20 to the R foundation to support the development.
> press enter to continue or enter your contribution number to avoid
> this message in the future .
> 
> you can even accept the same string if need be.  it's a nudge only,
> not a requirement.

   I did bring this idea up briefly 5 years ago (for whatever that's
worth)L http://tolstoy.newcastle.edu.au/R/e2/devel/07/05/3202.html.  
I very much doubt R-core will go for this, but there's nothing stopping
some private citizen with time and energy on their hands from setting
up their own private bounty system.  As I see it the challenges would
be:

* setting up and administering the web site and the bounty system
(i.e. figuring out rules for deciding when a bounty should be paid)
* convincing the R community that their money is safe with you;
* figuring out an appropriate payment/escrow system (Paypal?)
* dealing with any tax and reporting issues relevant to your locality of
receiving and disbursing money

It's conceivable that some existing R-oriented entity (Mango Solutions,
Revolution, RStudio?) would want/be willing to partner.

  This won't take care of getting stuff into core R, but (1) 
well-worked out proofs of concept would go a long way to convincing
R-core; (2) a lot can be done outside of core R if (for
example) you moved over to using data.table everywhere instead of
data frames (only translating to data frames where absolutely necessary).

(I would love a scalar data type for R, but I don't think that
can be done without a near-complete rewrite ...)

  Ben Bolker


From xie at yihui.name  Fri Jan  4 03:17:31 2013
From: xie at yihui.name (Yihui Xie)
Date: Thu, 3 Jan 2013 20:17:31 -0600
Subject: [Rd] Bug in R CMD check for \ in Rd?
Message-ID: <CANROs4czvcJ3iHtK3CR122=dpiS89xj7F7VnceXauADqidakpw@mail.gmail.com>

Hi,

I have a function knit_expand() and its source/Rd are below:

https://github.com/yihui/knitr/blob/master/R/template.R#L43-L44
https://github.com/yihui/knitr/blob/master/man/knit_expand.Rd

When I run R CMD check on the package I get this warning (with both R
2.15.2 and R-devel):

* checking for code/documentation mismatches ... WARNING
Codoc mismatches from documentation object 'knit_expand':
knit_expand
  Code: function(file, ..., text = readLines(file, warn = FALSE), delim
                 = "\\{\\{((.|\n)+?)\\}\\}")
  Docs: function(file, ..., text = readLines(file, warn = FALSE), delim
                 = "\{\{((.|\n)+?)\}\}")
  Mismatches in argument default values:
    Name: 'delim' Code: "\\{\\{((.|\n)+?)\\}\\}" Docs: "\{\{((.|\n)+?)\}\}"


I'm very confused by this warning, because in my Rd, I have this in
the usage section:

knit_expand(file, ..., text = readLines(file, warn = FALSE), delim =
"\\\\{\\\\{((.|\\n)+?)\\\\}\\\\}")

I do not understand why four backslashes became one in R CMD check. I
read http://developer.r-project.org/parseRd.pdf again and it says {}
in character strings do not need to be escaped, so the only character
to escape in this case is the backslash. The text/html help page
rendered from my Rd shows "\\{\\{((.|\n)+?)\\}\\}" correctly. So I'm
wondering if this is a bug of R CMD check, or I misunderstood
anything. Thanks!

Regards,
Yihui
--
Yihui Xie <xieyihui at gmail.com>
Phone: 515-294-2465 Web: http://yihui.name
Department of Statistics, Iowa State University
2215 Snedecor Hall, Ames, IA


From gunter.berton at gene.com  Thu Jan  3 19:16:34 2013
From: gunter.berton at gene.com (Bert Gunter)
Date: Thu, 3 Jan 2013 10:16:34 -0800
Subject: [Rd] Bounty on Error Checking
In-Reply-To: <CAPr7RtW=qFqRDS2ZoUgz-pbMR8i5R74YCt+4if-uoyzofpoOnw@mail.gmail.com>
References: <CAPr7RtW=qFqRDS2ZoUgz-pbMR8i5R74YCt+4if-uoyzofpoOnw@mail.gmail.com>
Message-ID: <CACk-te3t1Nc8kPVBuE0okxhpqa-Mgwy2mAevxJ=uvi9Q1ugHWQ@mail.gmail.com>

Well...

On Thu, Jan 3, 2013 at 10:00 AM, ivo welch <ivo.welch at anderson.ucla.edu> wrote:
>
> Dear R developers---I just spent half a day debugging an R program,
> which had two bugs---I selected the wrongly named variable, which
> turns out to have been a scalar, which then happily multiplied as if
> it was a matrix; and another wrongly named variable from a data frame,
> that triggered no error when used as a[["name"]] or a$name .  there
> should be an option to turn on that throws an error inside R when one
> does this.  I cannot imagine that there is much code that wants to
> reference non-existing columns in data frames.


But I can -- and do it all the time: To add a new variable, "d" to a
data frame, df,  containing only "a" and "b" (with 10 rows, say):

df[["d"]] <- 1:10

Trying to outguess documentation to create error triggers is a very bad idea.

R already has plenty of debugging tools -- and there is even a "debug"
package. Perhaps you need a better programming editor/IDE. There are
several listed on CRAN, RStudio, etc.

-- Bert
>
>
> I know you guys are saints for developing without financial support.
> but maybe we non-insider end-users can help by putting up a bounty
> list on R-project for us end-users to contribute to?  I would pledge
> $500 to a $10,000 fund that funds a project to comprehensively enhance
> the programming and debugging aspects of R.  it would only take 20 of
> us to make this possible.
>
> personally, I think basic nudgeware is the way to go.  when a user
> starts R in interactive mode, there should be a note that says,
>
>  please donate $20 to the R foundation to support the development.
> press enter to continue or enter your contribution number to avoid
> this message in the future .
>
> you can even accept the same string if need be.  it's a nudge only,
> not a requirement.
>
> regards,
>
> /iaw
>
> ----
> Ivo Welch (ivo.welch at gmail.com)
> http://www.ivo-welch.info/
> J. Fred Weston Professor of Finance
> Anderson School at UCLA, C519
> Director, UCLA Anderson Fink Center for Finance and Investments
> Free Finance Textbook, http://book.ivo-welch.info/
> Editor, Critical Finance Review, http://www.critical-finance-review.org/
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel




--

Bert Gunter
Genentech Nonclinical Biostatistics

Internal Contact Info:
Phone: 467-7374
Website:
http://pharmadevelopment.roche.com/index/pdb/pdb-functional-groups/pdb-biostatistics/pdb-ncb-home.htm


From lgautier at gmail.com  Fri Jan  4 13:48:17 2013
From: lgautier at gmail.com (Laurent Gautier)
Date: Fri, 04 Jan 2013 13:48:17 +0100
Subject: [Rd] Bounty on Error Checking
In-Reply-To: <mailman.19.1357297205.11472.r-devel@r-project.org>
References: <mailman.19.1357297205.11472.r-devel@r-project.org>
Message-ID: <50E6CF91.10007@gmail.com>

On 2013-01-04 12:00, r-devel-request at r-project.org wrote:
> Message: 16 Date: Thu, 3 Jan 2013 22:52:44 +0000 From: Ben Bolker 
> <bbolker at gmail.com> To: <r-devel at stat.math.ethz.ch> Subject: Re: [Rd] 
> Bounty on Error Checking Message-ID: 
> <loom.20130103T234406-301 at post.gmane.org> Content-Type: text/plain; 
> charset="us-ascii" ivo welch <ivo.welch <at> anderson.ucla.edu> writes:
>> >
>> >Dear R developers---I just spent half a day debugging an R program,
>> >which had two bugs---I selected the wrongly named variable, which
>> >turns out to have been a scalar, which then happily multiplied as if
>> >it was a matrix; and another wrongly named variable from a data frame,
>> >that triggered no error when used as a[["name"]] or a$name .  there
>> >should be an option to turn on that throws an error inside R when one
>> >does this.  I cannot imagine that there is much code that wants to
>> >reference non-existing columns in data frames.
>> >
>> >I know you guys are saints for developing without financial support.
>> >but maybe we non-insider end-users can help by putting up a bounty
>> >list on R-project for us end-users to contribute to?  I would pledge
>> >$500 to a $10,000 fund that funds a project to comprehensively enhance
>> >the programming and debugging aspects of R.  it would only take 20 of
>> >us to make this possible.
>> >
>> >personally, I think basic nudgeware is the way to go.  when a user
>> >starts R in interactive mode, there should be a note that says,
>> >
>> >  please donate $20 to the R foundation to support the development.
>> >press enter to continue or enter your contribution number to avoid
>> >this message in the future .
>> >
>> >you can even accept the same string if need be.  it's a nudge only,
>> >not a requirement.
>     I did bring this idea up briefly 5 years ago (for whatever that's
> worth)Lhttp://tolstoy.newcastle.edu.au/R/e2/devel/07/05/3202.html.
> I very much doubt R-core will go for this, but there's nothing stopping
> some private citizen with time and energy on their hands from setting
> up their own private bounty system.  As I see it the challenges would
> be:
>
> * setting up and administering the web site and the bounty system
> (i.e. figuring out rules for deciding when a bounty should be paid)
> * convincing the R community that their money is safe with you;
> * figuring out an appropriate payment/escrow system (Paypal?)
> * dealing with any tax and reporting issues relevant to your locality of
> receiving and disbursing money
>
> It's conceivable that some existing R-oriented entity (Mango Solutions,
> Revolution, RStudio?) would want/be willing to partner.
>
>    This won't take care of getting stuff into core R, but (1)
> well-worked out proofs of concept would go a long way to convincing
> R-core; (2) a lot can be done outside of core R if (for
> example) you moved over to using data.table everywhere instead of
> data frames (only translating to data frames where absolutely necessary).
>
> (I would love a scalar data type for R, but I don't think that
> can be done without a near-complete rewrite ...)
>
>    Ben Bolker
>

The Pypy project is funding the developments of new features this way 
(http://pypy.org/ - right side of the page, there are proposals, how 
much they cost to implement, and how much was donated). There must be 
others, I am just more aware of that one.

A potential difficulty is that all of R-core is possibly already funded 
(tenure positions in the academia, I'd guess) and might be moderately 
sensitive to the fact that a given feature should be implemented because 
people are paying to see it appear.


From mdowle at mdowle.plus.com  Fri Jan  4 14:32:31 2013
From: mdowle at mdowle.plus.com (Matthew Dowle)
Date: Fri, 04 Jan 2013 13:32:31 +0000
Subject: [Rd] Bounty on Error Checking
Message-ID: <2f8c4a34aa8a78a147d5e093cd68bb4a@imap.plus.net>


On Fri, Jan 3, 2013, Bert Gunter wrote
> Well...
>
> On Thu, Jan 3, 2013 at 10:00 AM, ivo welch <ivo.welch <at> 
> anderson.ucla.edu> wrote:
>>
>> Dear R developers---I just spent half a day debugging an R program,
>> which had two bugs---I selected the wrongly named variable, which
>> turns out to have been a scalar, which then happily multiplied as if
>> it was a matrix; and another wrongly named variable from a data 
>> frame,
>> that triggered no error when used as a[["name"]] or a$name .  there
>> should be an option to turn on that throws an error inside R when 
>> one
>> does this.  I cannot imagine that there is much code that wants to
>> reference non-existing columns in data frames.
>
>But I can -- and do it all the time: To add a new variable, "d" to a
>data frame, df,  containing only "a" and "b" (with 10 rows, say):
>
>df[["d"]] <- 1:10

Yes but that's `[[<-`. Ivo was talking about `[[` and `$`; i.e., select
only not assign, if I understood correctly.

>
>Trying to outguess documentation to create error triggers is a very 
> bad idea.

Why exactly is it a very bad idea? (I don't necessarily disagree, just 
asking
for more colour.)

>R already has plenty of debugging tools -- and there is even a "debug"
>package. Perhaps you need a better programming editor/IDE. There are
>several listed on CRAN, RStudio, etc.

True, but that relies on you knowing there's a bug to hunt for. What if 
you
don't know you're getting incorrect results, silently? In a similar way
that options(warn=2) turns known warnings into errors, to enable you to 
be
more strict if you wish, an option to turn on warnings from `[[` and 
`$`
if the column is missing (select only, not assign) doesn't seem like a
bad option to have. Maybe it would reveal some previously silent bugs.

Anyway, I'm hoping Ivo will let us know if he likes the simple mask I
proposed, or not. That's already an option that can be turned on or 
off.
But if his bug was selecting the wrong column, not a missing one, then
I'm not sure anything could (or needs to be) done about that.

Matthew


From murdoch.duncan at gmail.com  Fri Jan  4 15:03:31 2013
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Fri, 04 Jan 2013 09:03:31 -0500
Subject: [Rd] Bounty on Error Checking
In-Reply-To: <2f8c4a34aa8a78a147d5e093cd68bb4a@imap.plus.net>
References: <2f8c4a34aa8a78a147d5e093cd68bb4a@imap.plus.net>
Message-ID: <50E6E133.5060400@gmail.com>

On 13-01-04 8:32 AM, Matthew Dowle wrote:
>
> On Fri, Jan 3, 2013, Bert Gunter wrote
>> Well...
>>
>> On Thu, Jan 3, 2013 at 10:00 AM, ivo welch <ivo.welch <at>
>> anderson.ucla.edu> wrote:
>>>
>>> Dear R developers---I just spent half a day debugging an R program,
>>> which had two bugs---I selected the wrongly named variable, which
>>> turns out to have been a scalar, which then happily multiplied as if
>>> it was a matrix; and another wrongly named variable from a data
>>> frame,
>>> that triggered no error when used as a[["name"]] or a$name .  there
>>> should be an option to turn on that throws an error inside R when
>>> one
>>> does this.  I cannot imagine that there is much code that wants to
>>> reference non-existing columns in data frames.
>>
>> But I can -- and do it all the time: To add a new variable, "d" to a
>> data frame, df,  containing only "a" and "b" (with 10 rows, say):
>>
>> df[["d"]] <- 1:10
>
> Yes but that's `[[<-`. Ivo was talking about `[[` and `$`; i.e., select
> only not assign, if I understood correctly.
>
>>
>> Trying to outguess documentation to create error triggers is a very
>> bad idea.
>
> Why exactly is it a very bad idea? (I don't necessarily disagree, just
> asking
> for more colour.)
>
>> R already has plenty of debugging tools -- and there is even a "debug"
>> package. Perhaps you need a better programming editor/IDE. There are
>> several listed on CRAN, RStudio, etc.
>
> True, but that relies on you knowing there's a bug to hunt for. What if
> you
> don't know you're getting incorrect results, silently? In a similar way
> that options(warn=2) turns known warnings into errors, to enable you to
> be
> more strict if you wish,

I would say the point of options(warn=2) is rather to let you find the 
location of the warning more easily, because it will abort the 
evaluation.  I would not recommend using code that issues warnings.

an option to turn on warnings from `[[` and
> `$`
> if the column is missing (select only, not assign) doesn't seem like a
> bad option to have. Maybe it would reveal some previously silent bugs.

I agree that this would sometimes be useful, but a very common 
convention is to do something like

if (is.null(obj$element)) {  do something }

These would all have to be re-written to something like

if (missing.field(obj, "element") { do something }

There are several hundred examples of the first usage in base R; I 
imagine thousands more in contributed packages.  I don't think the 
benefit of the change is worth all the work that would be necessary to 
implement it.

Duncan

>
> Anyway, I'm hoping Ivo will let us know if he likes the simple mask I
> proposed, or not. That's already an option that can be turned on or
> off.
> But if his bug was selecting the wrong column, not a missing one, then
> I'm not sure anything could (or needs to be) done about that.
>
> Matthew
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From mdowle at mdowle.plus.com  Fri Jan  4 15:51:56 2013
From: mdowle at mdowle.plus.com (Matthew Dowle)
Date: Fri, 04 Jan 2013 14:51:56 +0000
Subject: [Rd] Bounty on Error Checking
In-Reply-To: <50E6E133.5060400@gmail.com>
References: <2f8c4a34aa8a78a147d5e093cd68bb4a@imap.plus.net>
	<50E6E133.5060400@gmail.com>
Message-ID: <a0812fd86e96e8ffe2b94618709a3405@imap.plus.net>

On 04.01.2013 14:03, Duncan Murdoch wrote:
> On 13-01-04 8:32 AM, Matthew Dowle wrote:
>>
>> On Fri, Jan 3, 2013, Bert Gunter wrote
>>> Well...
>>>
>>> On Thu, Jan 3, 2013 at 10:00 AM, ivo welch <ivo.welch <at>
>>> anderson.ucla.edu> wrote:
>>>>
>>>> Dear R developers---I just spent half a day debugging an R 
>>>> program,
>>>> which had two bugs---I selected the wrongly named variable, which
>>>> turns out to have been a scalar, which then happily multiplied as 
>>>> if
>>>> it was a matrix; and another wrongly named variable from a data
>>>> frame,
>>>> that triggered no error when used as a[["name"]] or a$name .  
>>>> there
>>>> should be an option to turn on that throws an error inside R when
>>>> one
>>>> does this.  I cannot imagine that there is much code that wants to
>>>> reference non-existing columns in data frames.
>>>
>>> But I can -- and do it all the time: To add a new variable, "d" to 
>>> a
>>> data frame, df,  containing only "a" and "b" (with 10 rows, say):
>>>
>>> df[["d"]] <- 1:10
>>
>> Yes but that's `[[<-`. Ivo was talking about `[[` and `$`; i.e., 
>> select
>> only not assign, if I understood correctly.
>>
>>>
>>> Trying to outguess documentation to create error triggers is a very
>>> bad idea.
>>
>> Why exactly is it a very bad idea? (I don't necessarily disagree, 
>> just
>> asking
>> for more colour.)
>>
>>> R already has plenty of debugging tools -- and there is even a 
>>> "debug"
>>> package. Perhaps you need a better programming editor/IDE. There 
>>> are
>>> several listed on CRAN, RStudio, etc.
>>
>> True, but that relies on you knowing there's a bug to hunt for. What 
>> if
>> you
>> don't know you're getting incorrect results, silently? In a similar 
>> way
>> that options(warn=2) turns known warnings into errors, to enable you 
>> to
>> be
>> more strict if you wish,
>
> I would say the point of options(warn=2) is rather to let you find
> the location of the warning more easily, because it will abort the
> evaluation.

True but as well as that, I sometimes like to run production systems 
with
options(warn=2). I'd prefer some tasks to halt at the slightest hint of
trouble than write a warning silently to a log file that may not be 
looked
at. I think of that as being more strict, more robust. Since 
option(warn=2)
is set even when there is no warning, to catch if one arises in future. 
Not
just to find it more easily once you know there is a warning.

> I would not recommend using code that issues warnings.

Not sure what you mean here.

>
> an option to turn on warnings from `[[` and
>> `$`
>> if the column is missing (select only, not assign) doesn't seem like 
>> a
>> bad option to have. Maybe it would reveal some previously silent 
>> bugs.
>
> I agree that this would sometimes be useful, but a very common
> convention is to do something like
>
> if (is.null(obj$element)) {  do something }
>
> These would all have to be re-written to something like
>
> if (missing.field(obj, "element") { do something }
>
> There are several hundred examples of the first usage in base R; I
> imagine thousands more in contributed packages.

Yes but Ivo doesn't seem to be writing that if() in his code. We're
only talking about an option that users can turn on for their own
code, iiuc. Not anything that would affect or break thousands of
packages. That's why I referred to the fact that all packages now
have namespaces, in the earlier post.

> I don't think the
> benefit of the change is worth all the work that would be necessary 
> to
> implement it.

It doesn't seem to be a lot of work. I already posted a working
straw man, for example, as a first step.

Matthew


From murdoch.duncan at gmail.com  Fri Jan  4 15:56:57 2013
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Fri, 04 Jan 2013 09:56:57 -0500
Subject: [Rd] Bounty on Error Checking
In-Reply-To: <a0812fd86e96e8ffe2b94618709a3405@imap.plus.net>
References: <2f8c4a34aa8a78a147d5e093cd68bb4a@imap.plus.net>
	<50E6E133.5060400@gmail.com>
	<a0812fd86e96e8ffe2b94618709a3405@imap.plus.net>
Message-ID: <50E6EDB9.7010303@gmail.com>

On 04/01/2013 9:51 AM, Matthew Dowle wrote:
> On 04.01.2013 14:03, Duncan Murdoch wrote:
> > On 13-01-04 8:32 AM, Matthew Dowle wrote:
> >>
> >> On Fri, Jan 3, 2013, Bert Gunter wrote
> >>> Well...
> >>>
> >>> On Thu, Jan 3, 2013 at 10:00 AM, ivo welch <ivo.welch <at>
> >>> anderson.ucla.edu> wrote:
> >>>>
> >>>> Dear R developers---I just spent half a day debugging an R
> >>>> program,
> >>>> which had two bugs---I selected the wrongly named variable, which
> >>>> turns out to have been a scalar, which then happily multiplied as
> >>>> if
> >>>> it was a matrix; and another wrongly named variable from a data
> >>>> frame,
> >>>> that triggered no error when used as a[["name"]] or a$name .
> >>>> there
> >>>> should be an option to turn on that throws an error inside R when
> >>>> one
> >>>> does this.  I cannot imagine that there is much code that wants to
> >>>> reference non-existing columns in data frames.
> >>>
> >>> But I can -- and do it all the time: To add a new variable, "d" to
> >>> a
> >>> data frame, df,  containing only "a" and "b" (with 10 rows, say):
> >>>
> >>> df[["d"]] <- 1:10
> >>
> >> Yes but that's `[[<-`. Ivo was talking about `[[` and `$`; i.e.,
> >> select
> >> only not assign, if I understood correctly.
> >>
> >>>
> >>> Trying to outguess documentation to create error triggers is a very
> >>> bad idea.
> >>
> >> Why exactly is it a very bad idea? (I don't necessarily disagree,
> >> just
> >> asking
> >> for more colour.)
> >>
> >>> R already has plenty of debugging tools -- and there is even a
> >>> "debug"
> >>> package. Perhaps you need a better programming editor/IDE. There
> >>> are
> >>> several listed on CRAN, RStudio, etc.
> >>
> >> True, but that relies on you knowing there's a bug to hunt for. What
> >> if
> >> you
> >> don't know you're getting incorrect results, silently? In a similar
> >> way
> >> that options(warn=2) turns known warnings into errors, to enable you
> >> to
> >> be
> >> more strict if you wish,
> >
> > I would say the point of options(warn=2) is rather to let you find
> > the location of the warning more easily, because it will abort the
> > evaluation.
>
> True but as well as that, I sometimes like to run production systems
> with
> options(warn=2). I'd prefer some tasks to halt at the slightest hint of
> trouble than write a warning silently to a log file that may not be
> looked
> at. I think of that as being more strict, more robust. Since
> option(warn=2)
> is set even when there is no warning, to catch if one arises in future.
> Not
> just to find it more easily once you know there is a warning.
>
> > I would not recommend using code that issues warnings.
>
> Not sure what you mean here.

I just meant that I consider warnings to be a problem (as you do), so 
they should all be fixed.

>
> >
> > an option to turn on warnings from `[[` and
> >> `$`
> >> if the column is missing (select only, not assign) doesn't seem like
> >> a
> >> bad option to have. Maybe it would reveal some previously silent
> >> bugs.
> >
> > I agree that this would sometimes be useful, but a very common
> > convention is to do something like
> >
> > if (is.null(obj$element)) {  do something }
> >
> > These would all have to be re-written to something like
> >
> > if (missing.field(obj, "element") { do something }
> >
> > There are several hundred examples of the first usage in base R; I
> > imagine thousands more in contributed packages.
>
> Yes but Ivo doesn't seem to be writing that if() in his code. We're
> only talking about an option that users can turn on for their own
> code, iiuc. Not anything that would affect or break thousands of
> packages. That's why I referred to the fact that all packages now
> have namespaces, in the earlier post.
>
> > I don't think the
> > benefit of the change is worth all the work that would be necessary
> > to
> > implement it.
>
> It doesn't seem to be a lot of work. I already posted a working
> straw man, for example, as a first step.

I understood the proposal to be that evaluating "obj$element" would 
issue a warning if element didn't exist.  If that were the case, then 
the common test

is.null(obj$element)

would issue a warning in the cases where it now returns TRUE.

Duncan Murdoch


From bbolker at gmail.com  Fri Jan  4 16:10:56 2013
From: bbolker at gmail.com (Ben Bolker)
Date: Fri, 04 Jan 2013 10:10:56 -0500
Subject: [Rd] Bounty on Error Checking
In-Reply-To: <50E6CF91.10007@gmail.com>
References: <mailman.19.1357297205.11472.r-devel@r-project.org>
	<50E6CF91.10007@gmail.com>
Message-ID: <50E6F100.5090005@gmail.com>

On 13-01-04 07:48 AM, Laurent Gautier wrote:
> On 2013-01-04 12:00, r-devel-request at r-project.org wrote:
>> Message: 16 Date: Thu, 3 Jan 2013 22:52:44 +0000 From: Ben Bolker
>> <bbolker at gmail.com> To: <r-devel at stat.math.ethz.ch> Subject: Re: [Rd]
>> Bounty on Error Checking Message-ID:
>> <loom.20130103T234406-301 at post.gmane.org> Content-Type: text/plain;
>> charset="us-ascii" ivo welch <ivo.welch <at> anderson.ucla.edu> writes:
>>> >
>>> >Dear R developers---I just spent half a day debugging an R program,
>>> >which had two bugs---I selected the wrongly named variable, which
>>> >turns out to have been a scalar, which then happily multiplied as if
>>> >it was a matrix; and another wrongly named variable from a data frame,
>>> >that triggered no error when used as a[["name"]] or a$name .  there
>>> >should be an option to turn on that throws an error inside R when one
>>> >does this.  I cannot imagine that there is much code that wants to
>>> >reference non-existing columns in data frames.
>>> >
>>> >I know you guys are saints for developing without financial support.
>>> >but maybe we non-insider end-users can help by putting up a bounty
>>> >list on R-project for us end-users to contribute to?  I would pledge
>>> >$500 to a $10,000 fund that funds a project to comprehensively enhance
>>> >the programming and debugging aspects of R.  it would only take 20 of
>>> >us to make this possible.
>>> >
>>> >personally, I think basic nudgeware is the way to go.  when a user
>>> >starts R in interactive mode, there should be a note that says,
>>> >
>>> >  please donate $20 to the R foundation to support the development.
>>> >press enter to continue or enter your contribution number to avoid
>>> >this message in the future .
>>> >
>>> >you can even accept the same string if need be.  it's a nudge only,
>>> >not a requirement.
>>     I did bring this idea up briefly 5 years ago (for whatever that's
>> worth)Lhttp://tolstoy.newcastle.edu.au/R/e2/devel/07/05/3202.html.
>> I very much doubt R-core will go for this, but there's nothing stopping
>> some private citizen with time and energy on their hands from setting
>> up their own private bounty system.  As I see it the challenges would
>> be:
>>
>> * setting up and administering the web site and the bounty system
>> (i.e. figuring out rules for deciding when a bounty should be paid)
>> * convincing the R community that their money is safe with you;
>> * figuring out an appropriate payment/escrow system (Paypal?)
>> * dealing with any tax and reporting issues relevant to your locality of
>> receiving and disbursing money
>>
>> It's conceivable that some existing R-oriented entity (Mango Solutions,
>> Revolution, RStudio?) would want/be willing to partner.
>>
>>    This won't take care of getting stuff into core R, but (1)
>> well-worked out proofs of concept would go a long way to convincing
>> R-core; (2) a lot can be done outside of core R if (for
>> example) you moved over to using data.table everywhere instead of
>> data frames (only translating to data frames where absolutely necessary).
>>
>> (I would love a scalar data type for R, but I don't think that
>> can be done without a near-complete rewrite ...)
>>
>>    Ben Bolker
>>
> 
> The Pypy project is funding the developments of new features this way
> (http://pypy.org/ - right side of the page, there are proposals, how
> much they cost to implement, and how much was donated). There must be
> others, I am just more aware of that one.
> 
> A potential difficulty is that all of R-core is possibly already funded
> (tenure positions in the academia, I'd guess) and might be moderately
> sensitive to the fact that a given feature should be implemented because
> people are paying to see it appear.
> 
   To clarify, I am *not* suggesting that R-core be funded this way, nor
that bounty suggestions be implemented in base R or recommended
packages, or in fact that R-core necessarily have anything to do with
such a bounty scheme.  Based on past conversations I think setting up
mechanisms for additional funding is low on R-core's priority list, and
I certainly agree that they would be sensitive about "subsidized"
features.  I imagined solutions being produced in the form of packages
or (in a pinch) patches to specified (stable or development) versions of
R.  I would be hopeful that high-quality patches might then be
considered by R-core ...

  Ben


From mdowle at mdowle.plus.com  Fri Jan  4 16:15:16 2013
From: mdowle at mdowle.plus.com (Matthew Dowle)
Date: Fri, 04 Jan 2013 15:15:16 +0000
Subject: [Rd] Bounty on Error Checking
In-Reply-To: <50E6EDB9.7010303@gmail.com>
References: <2f8c4a34aa8a78a147d5e093cd68bb4a@imap.plus.net>
	<50E6E133.5060400@gmail.com>
	<a0812fd86e96e8ffe2b94618709a3405@imap.plus.net>
	<50E6EDB9.7010303@gmail.com>
Message-ID: <03fee9d77172064b2ca32837a356fc96@imap.plus.net>

On 04.01.2013 14:56, Duncan Murdoch wrote:
> On 04/01/2013 9:51 AM, Matthew Dowle wrote:
>> On 04.01.2013 14:03, Duncan Murdoch wrote:
>> > On 13-01-04 8:32 AM, Matthew Dowle wrote:
>> >>
>> >> On Fri, Jan 3, 2013, Bert Gunter wrote
>> >>> Well...
>> >>>
>> >>> On Thu, Jan 3, 2013 at 10:00 AM, ivo welch <ivo.welch <at>
>> >>> anderson.ucla.edu> wrote:
>> >>>>
>> >>>> Dear R developers---I just spent half a day debugging an R
>> >>>> program,
>> >>>> which had two bugs---I selected the wrongly named variable, 
>> which
>> >>>> turns out to have been a scalar, which then happily multiplied 
>> as
>> >>>> if
>> >>>> it was a matrix; and another wrongly named variable from a data
>> >>>> frame,
>> >>>> that triggered no error when used as a[["name"]] or a$name .
>> >>>> there
>> >>>> should be an option to turn on that throws an error inside R 
>> when
>> >>>> one
>> >>>> does this.  I cannot imagine that there is much code that wants 
>> to
>> >>>> reference non-existing columns in data frames.
>> >>>
>> >>> But I can -- and do it all the time: To add a new variable, "d" 
>> to
>> >>> a
>> >>> data frame, df,  containing only "a" and "b" (with 10 rows, 
>> say):
>> >>>
>> >>> df[["d"]] <- 1:10
>> >>
>> >> Yes but that's `[[<-`. Ivo was talking about `[[` and `$`; i.e.,
>> >> select
>> >> only not assign, if I understood correctly.
>> >>
>> >>>
>> >>> Trying to outguess documentation to create error triggers is a 
>> very
>> >>> bad idea.
>> >>
>> >> Why exactly is it a very bad idea? (I don't necessarily disagree,
>> >> just
>> >> asking
>> >> for more colour.)
>> >>
>> >>> R already has plenty of debugging tools -- and there is even a
>> >>> "debug"
>> >>> package. Perhaps you need a better programming editor/IDE. There
>> >>> are
>> >>> several listed on CRAN, RStudio, etc.
>> >>
>> >> True, but that relies on you knowing there's a bug to hunt for. 
>> What
>> >> if
>> >> you
>> >> don't know you're getting incorrect results, silently? In a 
>> similar
>> >> way
>> >> that options(warn=2) turns known warnings into errors, to enable 
>> you
>> >> to
>> >> be
>> >> more strict if you wish,
>> >
>> > I would say the point of options(warn=2) is rather to let you find
>> > the location of the warning more easily, because it will abort the
>> > evaluation.
>>
>> True but as well as that, I sometimes like to run production systems
>> with
>> options(warn=2). I'd prefer some tasks to halt at the slightest hint 
>> of
>> trouble than write a warning silently to a log file that may not be
>> looked
>> at. I think of that as being more strict, more robust. Since
>> option(warn=2)
>> is set even when there is no warning, to catch if one arises in 
>> future.
>> Not
>> just to find it more easily once you know there is a warning.
>>
>> > I would not recommend using code that issues warnings.
>>
>> Not sure what you mean here.
>
> I just meant that I consider warnings to be a problem (as you do), so
> they should all be fixed.

I see now, good.

>
>>
>> >
>> > an option to turn on warnings from `[[` and
>> >> `$`
>> >> if the column is missing (select only, not assign) doesn't seem 
>> like
>> >> a
>> >> bad option to have. Maybe it would reveal some previously silent
>> >> bugs.
>> >
>> > I agree that this would sometimes be useful, but a very common
>> > convention is to do something like
>> >
>> > if (is.null(obj$element)) {  do something }
>> >
>> > These would all have to be re-written to something like
>> >
>> > if (missing.field(obj, "element") { do something }
>> >
>> > There are several hundred examples of the first usage in base R; I
>> > imagine thousands more in contributed packages.
>>
>> Yes but Ivo doesn't seem to be writing that if() in his code. We're
>> only talking about an option that users can turn on for their own
>> code, iiuc. Not anything that would affect or break thousands of
>> packages. That's why I referred to the fact that all packages now
>> have namespaces, in the earlier post.
>>
>> > I don't think the
>> > benefit of the change is worth all the work that would be 
>> necessary
>> > to
>> > implement it.
>>
>> It doesn't seem to be a lot of work. I already posted a working
>> straw man, for example, as a first step.
>
> I understood the proposal to be that evaluating "obj$element" would
> issue a warning if element didn't exist.  If that were the case, then
> the common test
>
> is.null(obj$element)
>
> would issue a warning in the cases where it now returns TRUE.

Yes, but only for obj$element appearing in Ivo's own code. Not if a 
package
does that (including base). That's why I thought masking "[[<-" and 
"$<-"
in .GlobalEnv might achieve that without affecting packages or base, 
although
I don't know how such an option could be made available by R.
Maybe options(strictselect=TRUE) would create those masks in 
.GlobalEnv,
and options(strictselect=FALSE) would remove them. A package maintainer
might choose to set that in their package to make it stricter (which 
would
create those masks in the package's namespace too).

Or users could just create those masks themselves, since it's only a 
few
lines. Without affecting packages or base.

Matthew


From murdoch.duncan at gmail.com  Fri Jan  4 16:22:48 2013
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Fri, 04 Jan 2013 10:22:48 -0500
Subject: [Rd] Bounty on Error Checking
In-Reply-To: <03fee9d77172064b2ca32837a356fc96@imap.plus.net>
References: <2f8c4a34aa8a78a147d5e093cd68bb4a@imap.plus.net>
	<50E6E133.5060400@gmail.com>
	<a0812fd86e96e8ffe2b94618709a3405@imap.plus.net>
	<50E6EDB9.7010303@gmail.com>
	<03fee9d77172064b2ca32837a356fc96@imap.plus.net>
Message-ID: <50E6F3C8.6050002@gmail.com>

On 04/01/2013 10:15 AM, Matthew Dowle wrote:
> On 04.01.2013 14:56, Duncan Murdoch wrote:
> > On 04/01/2013 9:51 AM, Matthew Dowle wrote:
> >> On 04.01.2013 14:03, Duncan Murdoch wrote:
> >> > On 13-01-04 8:32 AM, Matthew Dowle wrote:
> >> >>
> >> >> On Fri, Jan 3, 2013, Bert Gunter wrote
> >> >>> Well...
> >> >>>
> >> >>> On Thu, Jan 3, 2013 at 10:00 AM, ivo welch <ivo.welch <at>
> >> >>> anderson.ucla.edu> wrote:
> >> >>>>
> >> >>>> Dear R developers---I just spent half a day debugging an R
> >> >>>> program,
> >> >>>> which had two bugs---I selected the wrongly named variable,
> >> which
> >> >>>> turns out to have been a scalar, which then happily multiplied
> >> as
> >> >>>> if
> >> >>>> it was a matrix; and another wrongly named variable from a data
> >> >>>> frame,
> >> >>>> that triggered no error when used as a[["name"]] or a$name .
> >> >>>> there
> >> >>>> should be an option to turn on that throws an error inside R
> >> when
> >> >>>> one
> >> >>>> does this.  I cannot imagine that there is much code that wants
> >> to
> >> >>>> reference non-existing columns in data frames.
> >> >>>
> >> >>> But I can -- and do it all the time: To add a new variable, "d"
> >> to
> >> >>> a
> >> >>> data frame, df,  containing only "a" and "b" (with 10 rows,
> >> say):
> >> >>>
> >> >>> df[["d"]] <- 1:10
> >> >>
> >> >> Yes but that's `[[<-`. Ivo was talking about `[[` and `$`; i.e.,
> >> >> select
> >> >> only not assign, if I understood correctly.
> >> >>
> >> >>>
> >> >>> Trying to outguess documentation to create error triggers is a
> >> very
> >> >>> bad idea.
> >> >>
> >> >> Why exactly is it a very bad idea? (I don't necessarily disagree,
> >> >> just
> >> >> asking
> >> >> for more colour.)
> >> >>
> >> >>> R already has plenty of debugging tools -- and there is even a
> >> >>> "debug"
> >> >>> package. Perhaps you need a better programming editor/IDE. There
> >> >>> are
> >> >>> several listed on CRAN, RStudio, etc.
> >> >>
> >> >> True, but that relies on you knowing there's a bug to hunt for.
> >> What
> >> >> if
> >> >> you
> >> >> don't know you're getting incorrect results, silently? In a
> >> similar
> >> >> way
> >> >> that options(warn=2) turns known warnings into errors, to enable
> >> you
> >> >> to
> >> >> be
> >> >> more strict if you wish,
> >> >
> >> > I would say the point of options(warn=2) is rather to let you find
> >> > the location of the warning more easily, because it will abort the
> >> > evaluation.
> >>
> >> True but as well as that, I sometimes like to run production systems
> >> with
> >> options(warn=2). I'd prefer some tasks to halt at the slightest hint
> >> of
> >> trouble than write a warning silently to a log file that may not be
> >> looked
> >> at. I think of that as being more strict, more robust. Since
> >> option(warn=2)
> >> is set even when there is no warning, to catch if one arises in
> >> future.
> >> Not
> >> just to find it more easily once you know there is a warning.
> >>
> >> > I would not recommend using code that issues warnings.
> >>
> >> Not sure what you mean here.
> >
> > I just meant that I consider warnings to be a problem (as you do), so
> > they should all be fixed.
>
> I see now, good.
>
> >
> >>
> >> >
> >> > an option to turn on warnings from `[[` and
> >> >> `$`
> >> >> if the column is missing (select only, not assign) doesn't seem
> >> like
> >> >> a
> >> >> bad option to have. Maybe it would reveal some previously silent
> >> >> bugs.
> >> >
> >> > I agree that this would sometimes be useful, but a very common
> >> > convention is to do something like
> >> >
> >> > if (is.null(obj$element)) {  do something }
> >> >
> >> > These would all have to be re-written to something like
> >> >
> >> > if (missing.field(obj, "element") { do something }
> >> >
> >> > There are several hundred examples of the first usage in base R; I
> >> > imagine thousands more in contributed packages.
> >>
> >> Yes but Ivo doesn't seem to be writing that if() in his code. We're
> >> only talking about an option that users can turn on for their own
> >> code, iiuc. Not anything that would affect or break thousands of
> >> packages. That's why I referred to the fact that all packages now
> >> have namespaces, in the earlier post.
> >>
> >> > I don't think the
> >> > benefit of the change is worth all the work that would be
> >> necessary
> >> > to
> >> > implement it.
> >>
> >> It doesn't seem to be a lot of work. I already posted a working
> >> straw man, for example, as a first step.
> >
> > I understood the proposal to be that evaluating "obj$element" would
> > issue a warning if element didn't exist.  If that were the case, then
> > the common test
> >
> > is.null(obj$element)
> >
> > would issue a warning in the cases where it now returns TRUE.
>
> Yes, but only for obj$element appearing in Ivo's own code. Not if a
> package
> does that (including base). That's why I thought masking "[[<-" and
> "$<-"
> in .GlobalEnv might achieve that without affecting packages or base,
> although
> I don't know how such an option could be made available by R.
> Maybe options(strictselect=TRUE) would create those masks in
> .GlobalEnv,
> and options(strictselect=FALSE) would remove them. A package maintainer
> might choose to set that in their package to make it stricter (which
> would
> create those masks in the package's namespace too).
>
> Or users could just create those masks themselves, since it's only a
> few
> lines. Without affecting packages or base.

options() are global, but a package could change the meaning of $ or 
[[.  It could even export those new definitions so that people who 
wanted the strict usage could use it.  It would be hard to get the same 
performance as the base definitions, but for debugging purposes that 
might not matter.

Duncan Murdoch


From mdowle at mdowle.plus.com  Fri Jan  4 16:38:42 2013
From: mdowle at mdowle.plus.com (Matthew Dowle)
Date: Fri, 04 Jan 2013 15:38:42 +0000
Subject: [Rd] Bounty on Error Checking
In-Reply-To: <50E6F3C8.6050002@gmail.com>
References: <2f8c4a34aa8a78a147d5e093cd68bb4a@imap.plus.net>
	<50E6E133.5060400@gmail.com>
	<a0812fd86e96e8ffe2b94618709a3405@imap.plus.net>
	<50E6EDB9.7010303@gmail.com>
	<03fee9d77172064b2ca32837a356fc96@imap.plus.net>
	<50E6F3C8.6050002@gmail.com>
Message-ID: <db60f2a484e1ec031a0d4c07f8458aa0@imap.plus.net>

On 04.01.2013 15:22, Duncan Murdoch wrote:
> On 04/01/2013 10:15 AM, Matthew Dowle wrote:
>> On 04.01.2013 14:56, Duncan Murdoch wrote:
>> > On 04/01/2013 9:51 AM, Matthew Dowle wrote:
>> >> On 04.01.2013 14:03, Duncan Murdoch wrote:
>> >> > On 13-01-04 8:32 AM, Matthew Dowle wrote:
>> >> >>
>> >> >> On Fri, Jan 3, 2013, Bert Gunter wrote
>> >> >>> Well...
>> >> >>>
>> >> >>> On Thu, Jan 3, 2013 at 10:00 AM, ivo welch <ivo.welch <at>
>> >> >>> anderson.ucla.edu> wrote:
>> >> >>>>
>> >> >>>> Dear R developers---I just spent half a day debugging an R
>> >> >>>> program,
>> >> >>>> which had two bugs---I selected the wrongly named variable,
>> >> which
>> >> >>>> turns out to have been a scalar, which then happily 
>> multiplied
>> >> as
>> >> >>>> if
>> >> >>>> it was a matrix; and another wrongly named variable from a 
>> data
>> >> >>>> frame,
>> >> >>>> that triggered no error when used as a[["name"]] or a$name .
>> >> >>>> there
>> >> >>>> should be an option to turn on that throws an error inside R
>> >> when
>> >> >>>> one
>> >> >>>> does this.  I cannot imagine that there is much code that 
>> wants
>> >> to
>> >> >>>> reference non-existing columns in data frames.
>> >> >>>
>> >> >>> But I can -- and do it all the time: To add a new variable, 
>> "d"
>> >> to
>> >> >>> a
>> >> >>> data frame, df,  containing only "a" and "b" (with 10 rows,
>> >> say):
>> >> >>>
>> >> >>> df[["d"]] <- 1:10
>> >> >>
>> >> >> Yes but that's `[[<-`. Ivo was talking about `[[` and `$`; 
>> i.e.,
>> >> >> select
>> >> >> only not assign, if I understood correctly.
>> >> >>
>> >> >>>
>> >> >>> Trying to outguess documentation to create error triggers is 
>> a
>> >> very
>> >> >>> bad idea.
>> >> >>
>> >> >> Why exactly is it a very bad idea? (I don't necessarily 
>> disagree,
>> >> >> just
>> >> >> asking
>> >> >> for more colour.)
>> >> >>
>> >> >>> R already has plenty of debugging tools -- and there is even 
>> a
>> >> >>> "debug"
>> >> >>> package. Perhaps you need a better programming editor/IDE. 
>> There
>> >> >>> are
>> >> >>> several listed on CRAN, RStudio, etc.
>> >> >>
>> >> >> True, but that relies on you knowing there's a bug to hunt 
>> for.
>> >> What
>> >> >> if
>> >> >> you
>> >> >> don't know you're getting incorrect results, silently? In a
>> >> similar
>> >> >> way
>> >> >> that options(warn=2) turns known warnings into errors, to 
>> enable
>> >> you
>> >> >> to
>> >> >> be
>> >> >> more strict if you wish,
>> >> >
>> >> > I would say the point of options(warn=2) is rather to let you 
>> find
>> >> > the location of the warning more easily, because it will abort 
>> the
>> >> > evaluation.
>> >>
>> >> True but as well as that, I sometimes like to run production 
>> systems
>> >> with
>> >> options(warn=2). I'd prefer some tasks to halt at the slightest 
>> hint
>> >> of
>> >> trouble than write a warning silently to a log file that may not 
>> be
>> >> looked
>> >> at. I think of that as being more strict, more robust. Since
>> >> option(warn=2)
>> >> is set even when there is no warning, to catch if one arises in
>> >> future.
>> >> Not
>> >> just to find it more easily once you know there is a warning.
>> >>
>> >> > I would not recommend using code that issues warnings.
>> >>
>> >> Not sure what you mean here.
>> >
>> > I just meant that I consider warnings to be a problem (as you do), 
>> so
>> > they should all be fixed.
>>
>> I see now, good.
>>
>> >
>> >>
>> >> >
>> >> > an option to turn on warnings from `[[` and
>> >> >> `$`
>> >> >> if the column is missing (select only, not assign) doesn't 
>> seem
>> >> like
>> >> >> a
>> >> >> bad option to have. Maybe it would reveal some previously 
>> silent
>> >> >> bugs.
>> >> >
>> >> > I agree that this would sometimes be useful, but a very common
>> >> > convention is to do something like
>> >> >
>> >> > if (is.null(obj$element)) {  do something }
>> >> >
>> >> > These would all have to be re-written to something like
>> >> >
>> >> > if (missing.field(obj, "element") { do something }
>> >> >
>> >> > There are several hundred examples of the first usage in base 
>> R; I
>> >> > imagine thousands more in contributed packages.
>> >>
>> >> Yes but Ivo doesn't seem to be writing that if() in his code. 
>> We're
>> >> only talking about an option that users can turn on for their own
>> >> code, iiuc. Not anything that would affect or break thousands of
>> >> packages. That's why I referred to the fact that all packages now
>> >> have namespaces, in the earlier post.
>> >>
>> >> > I don't think the
>> >> > benefit of the change is worth all the work that would be
>> >> necessary
>> >> > to
>> >> > implement it.
>> >>
>> >> It doesn't seem to be a lot of work. I already posted a working
>> >> straw man, for example, as a first step.
>> >
>> > I understood the proposal to be that evaluating "obj$element" 
>> would
>> > issue a warning if element didn't exist.  If that were the case, 
>> then
>> > the common test
>> >
>> > is.null(obj$element)
>> >
>> > would issue a warning in the cases where it now returns TRUE.
>>
>> Yes, but only for obj$element appearing in Ivo's own code. Not if a
>> package
>> does that (including base). That's why I thought masking "[[<-" and
>> "$<-"
>> in .GlobalEnv might achieve that without affecting packages or base,
>> although
>> I don't know how such an option could be made available by R.
>> Maybe options(strictselect=TRUE) would create those masks in
>> .GlobalEnv,
>> and options(strictselect=FALSE) would remove them. A package 
>> maintainer
>> might choose to set that in their package to make it stricter (which
>> would
>> create those masks in the package's namespace too).
>>
>> Or users could just create those masks themselves, since it's only a
>> few
>> lines. Without affecting packages or base.
>
> options() are global

I realise that. I was thinking that inside the options() function it
could see if strictselect was being changed and then create the masks
in .GlobalEnv. But I can see that is ugly, was just thinking out loud.
Wasn't suggesting that "[[" would look at the value of strictselect.

> but a package could change the meaning of $ or
> [[.  It could even export those new definitions so that people who
> wanted the strict usage could use it.  It would be hard to get the
> same performance as the base definitions, but for debugging purposes
> that might not matter.

So in principle this would be a (small) good idea then?  Is it an
option that R could provide? i.e. something for which a patch file
for R would be considered by R core?

Matthew


From ivo.welch at gmail.com  Fri Jan  4 17:28:26 2013
From: ivo.welch at gmail.com (ivo welch)
Date: Fri, 4 Jan 2013 08:28:26 -0800
Subject: [Rd] Bounty on Error Checking
In-Reply-To: <db60f2a484e1ec031a0d4c07f8458aa0@imap.plus.net>
References: <2f8c4a34aa8a78a147d5e093cd68bb4a@imap.plus.net>
	<50E6E133.5060400@gmail.com>
	<a0812fd86e96e8ffe2b94618709a3405@imap.plus.net>
	<50E6EDB9.7010303@gmail.com>
	<03fee9d77172064b2ca32837a356fc96@imap.plus.net>
	<50E6F3C8.6050002@gmail.com>
	<db60f2a484e1ec031a0d4c07f8458aa0@imap.plus.net>
Message-ID: <CAPr7RtWLwDFqXmsfbuPvyr100MW5UzkDvEForw0nOsjPM67uuA@mail.gmail.com>

gents---first, thanks a lot for paying some attention to my suggestion.

I always write programs with options(warn=2).  but it doesn't cover
everything.  In particular, my code is littered with hand tests that
the dimensions are correct and that variables are defined:

stopifnot(is.data.frame(d) & exists("x", where="d") & (is.numeric(x))

of course, I should already know that d$x is what it is supposed to
be, but the whole point is that I make mistakes.  my suggestion is
also not so much for myself, but for all of our students that we get
involved with R.  it is one thing for me to fix my own problems.  it
is another for me to be comfortable recommending our students to learn
programming in R.

perl has an exact equivalent to the variable definition that I think
would help a great deal:
   use warnings FATAL => qw{ uninitialized };

one can test whether a variable is NULL.  one can assign to a variable
that is NULL.  one cannot *use* a variable that is NULL.   I presume
this mostly means that code such as d=data.frame( x=2 ); return d$y+2
would abort.   I guess a better perspective would be that R should
limit what one can do with NULL, not that it should limit the
variables.  R is too generous in allowing mismatched operations.
(this also applies to silent automatic repetition of matrices to make
dimensions fit;  for every time that it helps, there are probably two
times when it bites.)  not being a programmer or language designer, I
am not the best person to suggest what to improve.  but the strictness
of R seems too lax right now, making error tracking too difficult,
from the perspective of an end user.  this is partly why I suggested a
more general bounty to improve on this aspect of R, rather than on my
specific issue(s).

best,

/iaw
----
Ivo Welch (ivo.welch at gmail.com)
http://www.ivo-welch.info/
J. Fred Weston Professor of Finance
Anderson School at UCLA, C519
Director, UCLA Anderson Fink Center for Finance and Investments
Free Finance Textbook, http://book.ivo-welch.info/
Editor, Critical Finance Review, http://www.critical-finance-review.org/



On Fri, Jan 4, 2013 at 7:38 AM, Matthew Dowle <mdowle at mdowle.plus.com> wrote:
> On 04.01.2013 15:22, Duncan Murdoch wrote:
>>
>> On 04/01/2013 10:15 AM, Matthew Dowle wrote:
>>>
>>> On 04.01.2013 14:56, Duncan Murdoch wrote:
>>> > On 04/01/2013 9:51 AM, Matthew Dowle wrote:
>>> >> On 04.01.2013 14:03, Duncan Murdoch wrote:
>>> >> > On 13-01-04 8:32 AM, Matthew Dowle wrote:
>>> >> >>
>>> >> >> On Fri, Jan 3, 2013, Bert Gunter wrote
>>> >> >>> Well...
>>> >> >>>
>>> >> >>> On Thu, Jan 3, 2013 at 10:00 AM, ivo welch <ivo.welch <at>
>>> >> >>> anderson.ucla.edu> wrote:
>>> >> >>>>
>>> >> >>>> Dear R developers---I just spent half a day debugging an R
>>> >> >>>> program,
>>> >> >>>> which had two bugs---I selected the wrongly named variable,
>>> >> which
>>> >> >>>> turns out to have been a scalar, which then happily multiplied
>>> >> as
>>> >> >>>> if
>>> >> >>>> it was a matrix; and another wrongly named variable from a data
>>> >> >>>> frame,
>>> >> >>>> that triggered no error when used as a[["name"]] or a$name .
>>> >> >>>> there
>>> >> >>>> should be an option to turn on that throws an error inside R
>>> >> when
>>> >> >>>> one
>>> >> >>>> does this.  I cannot imagine that there is much code that wants
>>> >> to
>>> >> >>>> reference non-existing columns in data frames.
>>> >> >>>
>>> >> >>> But I can -- and do it all the time: To add a new variable, "d"
>>> >> to
>>> >> >>> a
>>> >> >>> data frame, df,  containing only "a" and "b" (with 10 rows,
>>> >> say):
>>> >> >>>
>>> >> >>> df[["d"]] <- 1:10
>>> >> >>
>>> >> >> Yes but that's `[[<-`. Ivo was talking about `[[` and `$`; i.e.,
>>> >> >> select
>>> >> >> only not assign, if I understood correctly.
>>> >> >>
>>> >> >>>
>>> >> >>> Trying to outguess documentation to create error triggers is a
>>> >> very
>>> >> >>> bad idea.
>>> >> >>
>>> >> >> Why exactly is it a very bad idea? (I don't necessarily disagree,
>>> >> >> just
>>> >> >> asking
>>> >> >> for more colour.)
>>> >> >>
>>> >> >>> R already has plenty of debugging tools -- and there is even a
>>> >> >>> "debug"
>>> >> >>> package. Perhaps you need a better programming editor/IDE. There
>>> >> >>> are
>>> >> >>> several listed on CRAN, RStudio, etc.
>>> >> >>
>>> >> >> True, but that relies on you knowing there's a bug to hunt for.
>>> >> What
>>> >> >> if
>>> >> >> you
>>> >> >> don't know you're getting incorrect results, silently? In a
>>> >> similar
>>> >> >> way
>>> >> >> that options(warn=2) turns known warnings into errors, to enable
>>> >> you
>>> >> >> to
>>> >> >> be
>>> >> >> more strict if you wish,
>>> >> >
>>> >> > I would say the point of options(warn=2) is rather to let you find
>>> >> > the location of the warning more easily, because it will abort the
>>> >> > evaluation.
>>> >>
>>> >> True but as well as that, I sometimes like to run production systems
>>> >> with
>>> >> options(warn=2). I'd prefer some tasks to halt at the slightest hint
>>> >> of
>>> >> trouble than write a warning silently to a log file that may not be
>>> >> looked
>>> >> at. I think of that as being more strict, more robust. Since
>>> >> option(warn=2)
>>> >> is set even when there is no warning, to catch if one arises in
>>> >> future.
>>> >> Not
>>> >> just to find it more easily once you know there is a warning.
>>> >>
>>> >> > I would not recommend using code that issues warnings.
>>> >>
>>> >> Not sure what you mean here.
>>> >
>>> > I just meant that I consider warnings to be a problem (as you do), so
>>> > they should all be fixed.
>>>
>>> I see now, good.
>>>
>>> >
>>> >>
>>> >> >
>>> >> > an option to turn on warnings from `[[` and
>>> >> >> `$`
>>> >> >> if the column is missing (select only, not assign) doesn't seem
>>> >> like
>>> >> >> a
>>> >> >> bad option to have. Maybe it would reveal some previously silent
>>> >> >> bugs.
>>> >> >
>>> >> > I agree that this would sometimes be useful, but a very common
>>> >> > convention is to do something like
>>> >> >
>>> >> > if (is.null(obj$element)) {  do something }
>>> >> >
>>> >> > These would all have to be re-written to something like
>>> >> >
>>> >> > if (missing.field(obj, "element") { do something }
>>> >> >
>>> >> > There are several hundred examples of the first usage in base R; I
>>> >> > imagine thousands more in contributed packages.
>>> >>
>>> >> Yes but Ivo doesn't seem to be writing that if() in his code. We're
>>> >> only talking about an option that users can turn on for their own
>>> >> code, iiuc. Not anything that would affect or break thousands of
>>> >> packages. That's why I referred to the fact that all packages now
>>> >> have namespaces, in the earlier post.
>>> >>
>>> >> > I don't think the
>>> >> > benefit of the change is worth all the work that would be
>>> >> necessary
>>> >> > to
>>> >> > implement it.
>>> >>
>>> >> It doesn't seem to be a lot of work. I already posted a working
>>> >> straw man, for example, as a first step.
>>> >
>>> > I understood the proposal to be that evaluating "obj$element" would
>>> > issue a warning if element didn't exist.  If that were the case, then
>>> > the common test
>>> >
>>> > is.null(obj$element)
>>> >
>>> > would issue a warning in the cases where it now returns TRUE.
>>>
>>> Yes, but only for obj$element appearing in Ivo's own code. Not if a
>>> package
>>> does that (including base). That's why I thought masking "[[<-" and
>>> "$<-"
>>> in .GlobalEnv might achieve that without affecting packages or base,
>>> although
>>> I don't know how such an option could be made available by R.
>>> Maybe options(strictselect=TRUE) would create those masks in
>>> .GlobalEnv,
>>> and options(strictselect=FALSE) would remove them. A package maintainer
>>> might choose to set that in their package to make it stricter (which
>>> would
>>> create those masks in the package's namespace too).
>>>
>>> Or users could just create those masks themselves, since it's only a
>>> few
>>> lines. Without affecting packages or base.
>>
>>
>> options() are global
>
>
> I realise that. I was thinking that inside the options() function it
> could see if strictselect was being changed and then create the masks
> in .GlobalEnv. But I can see that is ugly, was just thinking out loud.
> Wasn't suggesting that "[[" would look at the value of strictselect.
>
>
>> but a package could change the meaning of $ or
>> [[.  It could even export those new definitions so that people who
>> wanted the strict usage could use it.  It would be hard to get the
>> same performance as the base definitions, but for debugging purposes
>> that might not matter.
>
>
> So in principle this would be a (small) good idea then?  Is it an
> option that R could provide? i.e. something for which a patch file
> for R would be considered by R core?
>
> Matthew
>
>


From jmc at r-project.org  Fri Jan  4 18:04:51 2013
From: jmc at r-project.org (John Chambers)
Date: Fri, 04 Jan 2013 09:04:51 -0800
Subject: [Rd] Small changes to big objects (1)
In-Reply-To: <50E5D72E.5010704@r-project.org>
References: <50E5D72E.5010704@r-project.org>
Message-ID: <50E70BB3.4050306@r-project.org>

One point that came up in the CRAN checks, that I should have made explicit:

The new version of "@<-" has to move from the "methods" package to "base".

Therefore you should not (and can not) explicitly import it from 
"methods"--that will fail in the import phase of installation.

John

On 1/3/13 11:08 AM, John Chambers wrote:
> Martin Morgan commented in email to me that a change to any slot of an
> object that has other, large slot(s) does substantial computation,
> presumably from copying the whole object.  Is there anything to be done?
>
> There are in fact two possible changes, one automatic but only partial,
> the other requiring some action on the programmer's part.  Herewith the
> first; I'll discuss the second in a later email.
>
> Some context:  The notion is that our object has some big data and some
> additional smaller things.  We need to change the small things but would
> rather not copy the big things all the time.  (With long vectors, this
> becomes even more relevant.)
>
> There are three likely scenarios: slots, attributes and named list
> components.  Suppose our object has "little" and "BIG" encoded in one of
> these.
>
> The three relevant computations are:
>
> x at little <- other
> attr(x, "little") <- other
> x$little <- other
>
> It turns out that these are all similar in behavior with one important
> exception--fixing that is the automatic change.
>
> I need to review what R does here. All these are replacement functions,
> `@<-`, `attr<-`, `$<-`.  The evaluator checks before calling any
> replacement whether the object needs to be duplicated (in a routine
> EnsureLocal()).  It does that by examining a special field that holds
> the reference status of the object.
>
> Some languages, such as Python (and S) keep reference counts for each
> object, de-allocating the object when the reference count drops back to
> zero.  R uses a different strategy. Its NAMED() field is 0, 1 or 2
> according to whether the object has been assigned never, once or more
> than once.  The field is not a reference count and is not
> decremented--relevant for this issue.  Objects are de-allocated only
> when garbage collection occurs and the object does not appear in any
> current frame or other context.
> (I did not write any of this code, so apologies if I'm misrepresenting it.)
>
> When any of these replacement operations first occurs for a particular
> object in a particular function call, it's very likely that the
> reference status will be 2 and EnsureLocal will duplicate it--all of it.
> Regardless of which of the three forms is used.
>
> Here the non-level-playing-field aspect comes in.  `@<-` is a normal R
> function (a "closure") but the other two are primitives in the main code
> for R.  Primitives have no frame in which arguments are stored.  As a
> result the new version of x is normally stored with status 1.
>
> If one does a second replacement in the same call (in a loop, e.g.) that
> should not normally copy again.  But the result of `@<-` will be an
> object from its frame and will have status 2 when saved, forcing a copy
> each time.
>
> So the change, naturally, is that R 3.0.0 will have a primitive
> implementation of `@<`.  This has been implemented in r-devel (rev. 61544).
>
> Please try it out _before_ we issue that version, especially if you own
> a package that does things related to this question.
>
> John
>
> PS:  Some may have noticed that I didn't mention a fourth approach:
> fields in a reference class object.  The assumption was that we wanted
> classical, functional behavior here.  Reference classes don't have the
> copy problem but don't behave functionally either.  But that is in fact
> the direction for the other approach.  I'll discuss that later, when the
> corresponding code is available.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From murdoch.duncan at gmail.com  Fri Jan  4 18:43:38 2013
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Fri, 04 Jan 2013 12:43:38 -0500
Subject: [Rd] Bounty on Error Checking
In-Reply-To: <db60f2a484e1ec031a0d4c07f8458aa0@imap.plus.net>
References: <2f8c4a34aa8a78a147d5e093cd68bb4a@imap.plus.net>
	<50E6E133.5060400@gmail.com>
	<a0812fd86e96e8ffe2b94618709a3405@imap.plus.net>
	<50E6EDB9.7010303@gmail.com>
	<03fee9d77172064b2ca32837a356fc96@imap.plus.net>
	<50E6F3C8.6050002@gmail.com>
	<db60f2a484e1ec031a0d4c07f8458aa0@imap.plus.net>
Message-ID: <50E714CA.9020106@gmail.com>

On 04/01/2013 10:38 AM, Matthew Dowle wrote:
> On 04.01.2013 15:22, Duncan Murdoch wrote:
> > On 04/01/2013 10:15 AM, Matthew Dowle wrote:
> >> On 04.01.2013 14:56, Duncan Murdoch wrote:
> >> > On 04/01/2013 9:51 AM, Matthew Dowle wrote:
> >> >> On 04.01.2013 14:03, Duncan Murdoch wrote:
> >> >> > On 13-01-04 8:32 AM, Matthew Dowle wrote:
> >> >> >>
> >> >> >> On Fri, Jan 3, 2013, Bert Gunter wrote
> >> >> >>> Well...
> >> >> >>>
> >> >> >>> On Thu, Jan 3, 2013 at 10:00 AM, ivo welch <ivo.welch <at>
> >> >> >>> anderson.ucla.edu> wrote:
> >> >> >>>>
> >> >> >>>> Dear R developers---I just spent half a day debugging an R
> >> >> >>>> program,
> >> >> >>>> which had two bugs---I selected the wrongly named variable,
> >> >> which
> >> >> >>>> turns out to have been a scalar, which then happily
> >> multiplied
> >> >> as
> >> >> >>>> if
> >> >> >>>> it was a matrix; and another wrongly named variable from a
> >> data
> >> >> >>>> frame,
> >> >> >>>> that triggered no error when used as a[["name"]] or a$name .
> >> >> >>>> there
> >> >> >>>> should be an option to turn on that throws an error inside R
> >> >> when
> >> >> >>>> one
> >> >> >>>> does this.  I cannot imagine that there is much code that
> >> wants
> >> >> to
> >> >> >>>> reference non-existing columns in data frames.
> >> >> >>>
> >> >> >>> But I can -- and do it all the time: To add a new variable,
> >> "d"
> >> >> to
> >> >> >>> a
> >> >> >>> data frame, df,  containing only "a" and "b" (with 10 rows,
> >> >> say):
> >> >> >>>
> >> >> >>> df[["d"]] <- 1:10
> >> >> >>
> >> >> >> Yes but that's `[[<-`. Ivo was talking about `[[` and `$`;
> >> i.e.,
> >> >> >> select
> >> >> >> only not assign, if I understood correctly.
> >> >> >>
> >> >> >>>
> >> >> >>> Trying to outguess documentation to create error triggers is
> >> a
> >> >> very
> >> >> >>> bad idea.
> >> >> >>
> >> >> >> Why exactly is it a very bad idea? (I don't necessarily
> >> disagree,
> >> >> >> just
> >> >> >> asking
> >> >> >> for more colour.)
> >> >> >>
> >> >> >>> R already has plenty of debugging tools -- and there is even
> >> a
> >> >> >>> "debug"
> >> >> >>> package. Perhaps you need a better programming editor/IDE.
> >> There
> >> >> >>> are
> >> >> >>> several listed on CRAN, RStudio, etc.
> >> >> >>
> >> >> >> True, but that relies on you knowing there's a bug to hunt
> >> for.
> >> >> What
> >> >> >> if
> >> >> >> you
> >> >> >> don't know you're getting incorrect results, silently? In a
> >> >> similar
> >> >> >> way
> >> >> >> that options(warn=2) turns known warnings into errors, to
> >> enable
> >> >> you
> >> >> >> to
> >> >> >> be
> >> >> >> more strict if you wish,
> >> >> >
> >> >> > I would say the point of options(warn=2) is rather to let you
> >> find
> >> >> > the location of the warning more easily, because it will abort
> >> the
> >> >> > evaluation.
> >> >>
> >> >> True but as well as that, I sometimes like to run production
> >> systems
> >> >> with
> >> >> options(warn=2). I'd prefer some tasks to halt at the slightest
> >> hint
> >> >> of
> >> >> trouble than write a warning silently to a log file that may not
> >> be
> >> >> looked
> >> >> at. I think of that as being more strict, more robust. Since
> >> >> option(warn=2)
> >> >> is set even when there is no warning, to catch if one arises in
> >> >> future.
> >> >> Not
> >> >> just to find it more easily once you know there is a warning.
> >> >>
> >> >> > I would not recommend using code that issues warnings.
> >> >>
> >> >> Not sure what you mean here.
> >> >
> >> > I just meant that I consider warnings to be a problem (as you do),
> >> so
> >> > they should all be fixed.
> >>
> >> I see now, good.
> >>
> >> >
> >> >>
> >> >> >
> >> >> > an option to turn on warnings from `[[` and
> >> >> >> `$`
> >> >> >> if the column is missing (select only, not assign) doesn't
> >> seem
> >> >> like
> >> >> >> a
> >> >> >> bad option to have. Maybe it would reveal some previously
> >> silent
> >> >> >> bugs.
> >> >> >
> >> >> > I agree that this would sometimes be useful, but a very common
> >> >> > convention is to do something like
> >> >> >
> >> >> > if (is.null(obj$element)) {  do something }
> >> >> >
> >> >> > These would all have to be re-written to something like
> >> >> >
> >> >> > if (missing.field(obj, "element") { do something }
> >> >> >
> >> >> > There are several hundred examples of the first usage in base
> >> R; I
> >> >> > imagine thousands more in contributed packages.
> >> >>
> >> >> Yes but Ivo doesn't seem to be writing that if() in his code.
> >> We're
> >> >> only talking about an option that users can turn on for their own
> >> >> code, iiuc. Not anything that would affect or break thousands of
> >> >> packages. That's why I referred to the fact that all packages now
> >> >> have namespaces, in the earlier post.
> >> >>
> >> >> > I don't think the
> >> >> > benefit of the change is worth all the work that would be
> >> >> necessary
> >> >> > to
> >> >> > implement it.
> >> >>
> >> >> It doesn't seem to be a lot of work. I already posted a working
> >> >> straw man, for example, as a first step.
> >> >
> >> > I understood the proposal to be that evaluating "obj$element"
> >> would
> >> > issue a warning if element didn't exist.  If that were the case,
> >> then
> >> > the common test
> >> >
> >> > is.null(obj$element)
> >> >
> >> > would issue a warning in the cases where it now returns TRUE.
> >>
> >> Yes, but only for obj$element appearing in Ivo's own code. Not if a
> >> package
> >> does that (including base). That's why I thought masking "[[<-" and
> >> "$<-"
> >> in .GlobalEnv might achieve that without affecting packages or base,
> >> although
> >> I don't know how such an option could be made available by R.
> >> Maybe options(strictselect=TRUE) would create those masks in
> >> .GlobalEnv,
> >> and options(strictselect=FALSE) would remove them. A package
> >> maintainer
> >> might choose to set that in their package to make it stricter (which
> >> would
> >> create those masks in the package's namespace too).
> >>
> >> Or users could just create those masks themselves, since it's only a
> >> few
> >> lines. Without affecting packages or base.
> >
> > options() are global
>
> I realise that. I was thinking that inside the options() function it
> could see if strictselect was being changed and then create the masks
> in .GlobalEnv. But I can see that is ugly, was just thinking out loud.
> Wasn't suggesting that "[[" would look at the value of strictselect.
>
> > but a package could change the meaning of $ or
> > [[.  It could even export those new definitions so that people who
> > wanted the strict usage could use it.  It would be hard to get the
> > same performance as the base definitions, but for debugging purposes
> > that might not matter.
>
> So in principle this would be a (small) good idea then?  Is it an
> option that R could provide? i.e. something for which a patch file
> for R would be considered by R core?

I don't think there's any need for this to be in base R, so I would 
guess it wouldn't be accepted.  It would be great if someone maintained 
a package full of versions of standard functions and operators that wrap 
the regular versions in extra checking, but that someone doesn't have to 
be in the core group.  Conceivably some of the very low level things 
couldn't be replaced by a package; then I think a minimal patch would be 
considered.

Duncan Murdoch


From xie at yihui.name  Sat Jan  5 05:02:40 2013
From: xie at yihui.name (Yihui Xie)
Date: Fri, 4 Jan 2013 22:02:40 -0600
Subject: [Rd] Bug in R CMD check for \ in Rd?
In-Reply-To: <CANROs4czvcJ3iHtK3CR122=dpiS89xj7F7VnceXauADqidakpw@mail.gmail.com>
References: <CANROs4czvcJ3iHtK3CR122=dpiS89xj7F7VnceXauADqidakpw@mail.gmail.com>
Message-ID: <CANROs4ewsToeYtROK7VYWoe0cUxXT1xLAbs3AsuRo083ZtD7cA@mail.gmail.com>

Just a follow-up: I decided to avoid backslashes in function
arguments, so the problem is now gone for me. But I believe the
possible bug is still in R; if anyone wants to reproduce the problem,
please check out this commit:
https://github.com/yihui/knitr/tree/bf793ca6

https://github.com/yihui/knitr/blob/bf793ca67ac6b78a5b09ab8eb08976ec7667e6e2/man/knit_expand.Rd
https://github.com/yihui/knitr/blob/bf793ca67ac6b78a5b09ab8eb08976ec7667e6e2/R/template.R

Regards,
Yihui
--
Yihui Xie <xieyihui at gmail.com>
Phone: 515-294-2465 Web: http://yihui.name
Department of Statistics, Iowa State University
2215 Snedecor Hall, Ames, IA


On Thu, Jan 3, 2013 at 8:17 PM, Yihui Xie <xie at yihui.name> wrote:
> Hi,
>
> I have a function knit_expand() and its source/Rd are below:
>
> https://github.com/yihui/knitr/blob/master/R/template.R#L43-L44
> https://github.com/yihui/knitr/blob/master/man/knit_expand.Rd
>
> When I run R CMD check on the package I get this warning (with both R
> 2.15.2 and R-devel):
>
> * checking for code/documentation mismatches ... WARNING
> Codoc mismatches from documentation object 'knit_expand':
> knit_expand
>   Code: function(file, ..., text = readLines(file, warn = FALSE), delim
>                  = "\\{\\{((.|\n)+?)\\}\\}")
>   Docs: function(file, ..., text = readLines(file, warn = FALSE), delim
>                  = "\{\{((.|\n)+?)\}\}")
>   Mismatches in argument default values:
>     Name: 'delim' Code: "\\{\\{((.|\n)+?)\\}\\}" Docs: "\{\{((.|\n)+?)\}\}"
>
>
> I'm very confused by this warning, because in my Rd, I have this in
> the usage section:
>
> knit_expand(file, ..., text = readLines(file, warn = FALSE), delim =
> "\\\\{\\\\{((.|\\n)+?)\\\\}\\\\}")
>
> I do not understand why four backslashes became one in R CMD check. I
> read http://developer.r-project.org/parseRd.pdf again and it says {}
> in character strings do not need to be escaped, so the only character
> to escape in this case is the backslash. The text/html help page
> rendered from my Rd shows "\\{\\{((.|\n)+?)\\}\\}" correctly. So I'm
> wondering if this is a bug of R CMD check, or I misunderstood
> anything. Thanks!
>
> Regards,
> Yihui
> --
> Yihui Xie <xieyihui at gmail.com>
> Phone: 515-294-2465 Web: http://yihui.name
> Department of Statistics, Iowa State University
> 2215 Snedecor Hall, Ames, IA


From jmc at r-project.org  Sat Jan  5 19:55:51 2013
From: jmc at r-project.org (John Chambers)
Date: Sat, 05 Jan 2013 10:55:51 -0800
Subject: [Rd] Small changes to big objects (2): Local Reference Classes
Message-ID: <50E87737.2080303@r-project.org>

Back to the scenario in my email of Jan. 3:  We have objects with some 
large (or very large) components and some other components as well.  We 
need to modify the smaller stuff but are not changing the big data.  How 
can we avoid copying the big data?

(A use case might be some modeling of large data where we want to save 
various versions, all including the same original data but differing in 
some stored parameters, estimates, etc.)

A new kind of class, "local reference classes" has been added to r-devel 
(rev. 61562).  It's the idea that using these classes to represent data 
can avoid copying that's not needed, while retaining the standard R 
functional semantics, or close to that.  For a quick look, see 
?LocalReferenceClasses.

Here is the idea.

We imagine that our object has components/slots/attributes/fields 
"BigData", say, and "twiddle".  With normal R evaluation, replacing 
"twiddle" in the object will cause internal duplication of the whole 
thing, in the very likely case that we pass some object, myX say as 
argument x to a function.

As soon as the evaluator sees a replacement function, "@<-", "$<-" or 
"attr<-" for an ordinary object, the EnsureLocal routine calls 
duplicate() if the object has more than one reference, as it will in 
this scenario. And BigData gets copied.  I think it's important to 
understand that this follows from the "replacement function" concept in 
S and R:  A replacement function takes an object from the frame, does 
whatever it does, and returns a replacement for this object.  The 
evaluator doesn't know what the replacement function does, so the 
EnsureLocal strategy is inevitable.

There is one trapdoor, however.  duplicate() does essentially nothing 
for data types that are references, most importantly for environments. 
That's the basis for reference classes.

But a reference class is not exactly what we want here.  Our different 
models share the BigData but should not share the same other fields.  If 
I twiddle parameters in one model, it better not change another model. 
So it's R's standard "functional" semantics we want.

In fact, R is not strictly a functional language.  Rather it has the 
idea of "local references":  ordinary assignments change the references 
in the local frame but have no external effect.

Local reference classes implement essentially this using reference class 
fields.  Specifically, calling a method $ensureLocal() on an object, 
directly or via replacing a field, causes a *shallow* copy of the object 
to be created and remembered locally.  Subsequent replacements have no 
effect on the object passed in to the function.

The implementation is fairly simple, but the programmer does have to be 
aware of what's happening, to some extent.  Please look it over and play 
with it if it seems interesting.

John


From hb at biostat.ucsf.edu  Mon Jan  7 02:07:12 2013
From: hb at biostat.ucsf.edu (Henrik Bengtsson)
Date: Sun, 6 Jan 2013 17:07:12 -0800
Subject: [Rd] Missing /share/dictionaries/en_stats.rds
Message-ID: <CAFDcVCRSGFmjM_s3j8Bq4fjJOc_iyQv8MutcjubCp62eFi2thw@mail.gmail.com>

Hi.  I'm on Windows 7 64-bit with latest R devel with and Rtools
(2.16.0.1926).  When I try to enable spell checking for 'R CMD check'
by setting environment variable '_R_CHECK_CRAN_INCOMING_USE_ASPELL_'
to 'true', I get:

* checking CRAN incoming feasibility ...Warning in aspell(files, filter = "dcf",
 control = control, encoding = encoding,  :
  The following dictionaries were not found:
  en_stats

Looking at the source code, I found that I'm missing 'en_stats.rds', e.g.

> Sys.glob(file.path(R.home("share"), "dictionaries", "*.rds"))
character(0)

I see that the missing file is in
http://svn.r-project.org/R/trunk/share/dictionaries/.  Is there a
reason for why this is not part of the R source/binaries (e.g.
http://cran.r-project.org/src/base/R-2/R-2.15.2.tar.gz)?  Intentional
or forgotten?

/Henrik


From hb at biostat.ucsf.edu  Mon Jan  7 03:00:01 2013
From: hb at biostat.ucsf.edu (Henrik Bengtsson)
Date: Sun, 6 Jan 2013 18:00:01 -0800
Subject: [Rd] aspell(...,
 dictionaries) incorrectly passes double-quoted arguments via
 shell() [and a patch]
Message-ID: <CAFDcVCSMaxBgMiKUvT7HVa5xuJb085i4Rgy6JGXBn_5P2UJGEw@mail.gmail.com>

Hi, I think I found a bug in aspell() on Windows.  Specifying argument
'dictionaries' for aspell() does not work on Windows, which I believe
is because it tries to pass a quoted command line option via shell().

THIS WORKS:
# Create a text file to be spell checked
> writeLines(c("Hello", "world", "ANOVA"), con="text.txt")

# Check it (word 'babaa' is unknown)
> aspell("text.txt")
ANOVA
  text.txt:3:1


THIS DOES NOT WORK:
# Get a dictionary
> url <- "http://svn.r-project.org/R/trunk/share/dictionaries/en_stats.rds"
> download.file(url, "en_stats.rds", mode="wb")

# Check it
> aspell("text.txt", dictionaries="./en_stats.rds")
Error in aspell("text.txt", dictionaries = "./en_stats.rds") :
  Running aspell failed with diagnostics:
The filename, directory name, or volume label syntax is incorrect.
In addition: Warning message:
In shell(sprintf("%s > %s 2> %s", command, outfile, errfile), input = input,  :
  '"C:\PROGRA~2\Aspell\bin\aspell.exe" -a -p
"C:\Users\hb\AppData\Local\Temp\RtmpueSaQa\aspell_personal1d1c378e3241"
< C:\Users\hb\AppData\Local\Temp\RtmpueSaQa\aspell1d1c64e663c9 >
C:\Users\hb\AppData\Local\Temp\RtmpueSaQa\xshell1d1c724c140 2>
C:\Users\hb\AppData\Local\Temp\RtmpueSaQa\xshell1d1c731063f3'
execution failed with error code 1

(You get a similar error with 'R CMD check' and system environment
flag '_R_CHECK_CRAN_INCOMING_USE_ASPELL_' set).


TROUBLESHOOTING:
I rather sure that the above error occurs because the value for
command line argument '-p' is quoted, i.e.

  -p "C:\Users\hb\AppData\Local\Temp\RtmpueSaQa\aspell_personal1d1c378e3241"

and then passed to shell().  The shell() expands to a system("cmd /c
...") call on Windows, and the handling of quotation marks by "cmd /c"
is rather peculiar (for details see the paragraph starting with "If /C
or /K is specified, then [...] the following logic is used to process
quote (") characters [...]" in 'cmd /?').  Example:

% cmd /c R --slave -e "print(1:3)"
[1] 1 2 3

% cmd /c "R" --slave -e "print(1:3)"
'R" --slave -e "print' is not recognized as an internal or external command,
operable program or batch file.

x:\calmate,R-forge>cmd /c "R" --slave -e print(1:3)
[1] 1 2 3

x:\calmate,R-forge>cmd /c "R" --slave -e 'print(1:3)'
[1] "print(1:3)"


PATCH:
Because the the personal dictionary used by aspell() is passed via
tempfile("aspell_personal", tmpdir=tempdir()) it does not need to be
quoted on Windows, because such a temporary pathname will never
contain spaces, cf. "If the path to the directory contains a space in
any of the components, the path returned will use the shortnames
version of the path" from help("tempdir").  A patch is therefore:

--- aspell.R    2012-10-16 20:17:38.126736100 -0700
+++ aspell,patch.R      2013-01-06 17:45:44.092499300 -0800
@@ -111,7 +111,8 @@
             aspell_write_personal_dictionary_file(words, personal,
                                                   program = program)
             ## </FIXME>
-            control <- c(control, "-p", shQuote(personal))
+            if (.Platform$OS.type != "windows") personal <- shQuote(personal)
+            control <- c(control, "-p", personal)
         }
     }


/Henrik

> sessionInfo()
R Under development (unstable) (2013-01-05 r61554)
Platform: x86_64-w64-mingw32/x64 (64-bit)

locale:
[1] LC_COLLATE=English_United States.1252
[2] LC_CTYPE=English_United States.1252
[3] LC_MONETARY=English_United States.1252
[4] LC_NUMERIC=C
[5] LC_TIME=English_United States.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

loaded via a namespace (and not attached):
[1] tools_3.0.0


From maechler at stat.math.ethz.ch  Mon Jan  7 09:47:37 2013
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Mon, 7 Jan 2013 09:47:37 +0100
Subject: [Rd] Missing /share/dictionaries/en_stats.rds
In-Reply-To: <CAFDcVCRSGFmjM_s3j8Bq4fjJOc_iyQv8MutcjubCp62eFi2thw@mail.gmail.com>
References: <CAFDcVCRSGFmjM_s3j8Bq4fjJOc_iyQv8MutcjubCp62eFi2thw@mail.gmail.com>
Message-ID: <20714.35753.877279.423099@stat.math.ethz.ch>

>>>>> Henrik Bengtsson <hb at biostat.ucsf.edu>
>>>>>     on Sun, 6 Jan 2013 17:07:12 -0800 writes:

    > Hi.  I'm on Windows 7 64-bit with latest R devel with and
    > Rtools (2.16.0.1926).  When I try to enable spell checking
    > for 'R CMD check' by setting environment variable
    > '_R_CHECK_CRAN_INCOMING_USE_ASPELL_' to 'true', I get:

    > * checking CRAN incoming feasibility ...Warning in
    > aspell(files, filter = "dcf", control = control, encoding
    > = encoding, : The following dictionaries were not found:
    > en_stats

    > Looking at the source code, I found that I'm missing
    > 'en_stats.rds', e.g.

    >> Sys.glob(file.path(R.home("share"), "dictionaries", "*.rds"))
    > character(0)

    > I see that the missing file is in
    > http://svn.r-project.org/R/trunk/share/dictionaries/.  Is
    > there a reason for why this is not part of the R
    > source/binaries (e.g.
    > http://cran.r-project.org/src/base/R-2/R-2.15.2.tar.gz)?
    > Intentional or forgotten?

But it's in the source tarballs of R-devel, 
and you are talking about R-devel, right?

Also, for me (on Linux), it is in there

    >> Sys.glob(file.path(R.home("share"), "dictionaries", "*.rds"))

are you sure you're not just mixing R-2.15.x
and R-devel ?

Martin


From ligges at statistik.tu-dortmund.de  Mon Jan  7 10:33:39 2013
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Mon, 07 Jan 2013 10:33:39 +0100
Subject: [Rd] Missing /share/dictionaries/en_stats.rds
In-Reply-To: <20714.35753.877279.423099@stat.math.ethz.ch>
References: <CAFDcVCRSGFmjM_s3j8Bq4fjJOc_iyQv8MutcjubCp62eFi2thw@mail.gmail.com>
	<20714.35753.877279.423099@stat.math.ethz.ch>
Message-ID: <50EA9673.5020403@statistik.tu-dortmund.de>



On 07.01.2013 09:47, Martin Maechler wrote:
>>>>>> Henrik Bengtsson <hb at biostat.ucsf.edu>
>>>>>>      on Sun, 6 Jan 2013 17:07:12 -0800 writes:
>
>      > Hi.  I'm on Windows 7 64-bit with latest R devel with and
>      > Rtools (2.16.0.1926).  When I try to enable spell checking
>      > for 'R CMD check' by setting environment variable
>      > '_R_CHECK_CRAN_INCOMING_USE_ASPELL_' to 'true', I get:
>
>      > * checking CRAN incoming feasibility ...Warning in
>      > aspell(files, filter = "dcf", control = control, encoding
>      > = encoding, : The following dictionaries were not found:
>      > en_stats
>
>      > Looking at the source code, I found that I'm missing
>      > 'en_stats.rds', e.g.
>
>      >> Sys.glob(file.path(R.home("share"), "dictionaries", "*.rds"))
>      > character(0)
>
>      > I see that the missing file is in
>      > http://svn.r-project.org/R/trunk/share/dictionaries/.  Is
>      > there a reason for why this is not part of the R
>      > source/binaries (e.g.
>      > http://cran.r-project.org/src/base/R-2/R-2.15.2.tar.gz)?
>      > Intentional or forgotten?
>
> But it's in the source tarballs of R-devel,
> and you are talking about R-devel, right?
>
> Also, for me (on Linux), it is in there
>
>      >> Sys.glob(file.path(R.home("share"), "dictionaries", "*.rds"))
>
> are you sure you're not just mixing R-2.15.x
> and R-devel ?

No, he is right, since it is not shipped with the Windows installer.
We are working on it (and the other aspell error report).

Best,
Uwe



>
> Martin
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From nalimilan at club.fr  Mon Jan  7 10:54:12 2013
From: nalimilan at club.fr (Milan Bouchet-Valat)
Date: Mon, 07 Jan 2013 10:54:12 +0100
Subject: [Rd] Plots not drawn with buffered Cairo 1.12
Message-ID: <1357552452.23196.86.camel@milan>

Hi!

On Fedora 18 [1] and Arch Linux [2], using R 2.15.2, X11 plots are not
drawn (i.e. the window stays blank) when using X11.options(type="cairo")
and X11.options(type="dbcairo"). They are correctly drawn when using
X11.options(type="nbcairo") and X11.options(type="xlib"), or after
resizing the X11 window.

The bug happens with Cairo 1.12.4 and above, but not with 1.10.2 (I have
not tested versions between these two). I've filed a bug against Cairo
[3], and developers replied that R was probably not calling
cairo_surface_flush() when it should, as Cairo relies on this and this
assumption is relied on in more places in recent releases.

I gave a try to that idea but so far I've not been able to fix the bug
by adding cairo_surface_flush() calls in the src/modules/X11/devX11.c
code.

I've also discovered that the code in X11_Mode() is never really run
when drawing a simple plot like 'plot(1:10)'. What happens is that
xd->holdlevel is always 1 when X11_Mode() is called, so the function
returns. And when xd->holdlevel is set back to 0, no call to X11_Mode is
done. On the contrary, if I resize the window, the blocks for mode==0
and mode==1 are run several times. Is this behavior expected?

This also happens with Cairo 1.10.2, when the plot is correctly drawn,
so this is not the cause of the problem. But I find this puzzling, since
a comment says:

/********************************************************/
/* device_Mode is called whenever the graphics engine	*/
/* starts drawing (mode=1) or stops drawing mode=0)	*/
/* the device is not required to do anything		*/
/********************************************************/

According to what I'm seeing, the "starts drawing" part never happens.
So the comments sounds a bit misleading to me, if not completely wrong.

Any ideas?


Regards


1: https://bugzilla.redhat.com/show_bug.cgi?id=891983
2: https://bugs.archlinux.org/task/32597
3: https://bugs.freedesktop.org/show_bug.cgi?id=59085


From ripley at stats.ox.ac.uk  Mon Jan  7 11:23:35 2013
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 07 Jan 2013 10:23:35 +0000
Subject: [Rd] Missing /share/dictionaries/en_stats.rds
In-Reply-To: <50EA9673.5020403@statistik.tu-dortmund.de>
References: <CAFDcVCRSGFmjM_s3j8Bq4fjJOc_iyQv8MutcjubCp62eFi2thw@mail.gmail.com>
	<20714.35753.877279.423099@stat.math.ethz.ch>
	<50EA9673.5020403@statistik.tu-dortmund.de>
Message-ID: <50EAA227.9090409@stats.ox.ac.uk>

On 07/01/2013 09:33, Uwe Ligges wrote:
>
>
> On 07.01.2013 09:47, Martin Maechler wrote:
>>>>>>> Henrik Bengtsson <hb at biostat.ucsf.edu>
>>>>>>>      on Sun, 6 Jan 2013 17:07:12 -0800 writes:
>>
>>      > Hi.  I'm on Windows 7 64-bit with latest R devel with and
>>      > Rtools (2.16.0.1926).  When I try to enable spell checking
>>      > for 'R CMD check' by setting environment variable
>>      > '_R_CHECK_CRAN_INCOMING_USE_ASPELL_' to 'true', I get:
>>
>>      > * checking CRAN incoming feasibility ...Warning in
>>      > aspell(files, filter = "dcf", control = control, encoding
>>      > = encoding, : The following dictionaries were not found:
>>      > en_stats
>>
>>      > Looking at the source code, I found that I'm missing
>>      > 'en_stats.rds', e.g.
>>
>>      >> Sys.glob(file.path(R.home("share"), "dictionaries", "*.rds"))
>>      > character(0)
>>
>>      > I see that the missing file is in
>>      > http://svn.r-project.org/R/trunk/share/dictionaries/.  Is
>>      > there a reason for why this is not part of the R
>>      > source/binaries (e.g.
>>      > http://cran.r-project.org/src/base/R-2/R-2.15.2.tar.gz)?
>>      > Intentional or forgotten?
>>
>> But it's in the source tarballs of R-devel,
>> and you are talking about R-devel, right?
>>
>> Also, for me (on Linux), it is in there
>>
>>      >> Sys.glob(file.path(R.home("share"), "dictionaries", "*.rds"))
>>
>> are you sure you're not just mixing R-2.15.x
>> and R-devel ?
>
> No, he is right, since it is not shipped with the Windows installer.
> We are working on it (and the other aspell error report).

Or put another way, aspell() and its use in R CMD check is not yet 
supported on Windows (which is why the directory was not shipped).


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From karl.forner at gmail.com  Mon Jan  7 17:00:18 2013
From: karl.forner at gmail.com (Karl Forner)
Date: Mon, 7 Jan 2013 17:00:18 +0100
Subject: [Rd] weird bug with parallel, RSQlite and tcltk
In-Reply-To: <CAP01uR=pczw-KCZAkJFju0WJ5kut++oxNvxyReHgF+D8-ehEEw@mail.gmail.com>
References: <CAMd4_Ac0+CgORVFfhFAXTttAza1iG1aagZ08j_E-U-rYZspLXg@mail.gmail.com>
	<52B72508-C480-4DF3-B1E6-8B9DDA0DFD78@r-project.org>
	<CAMd4_Af2FihaiMYsv8vKL4z_V+X4oWUtce4HDH5iqZa-V4ji7A@mail.gmail.com>
	<CAP01uR=pczw-KCZAkJFju0WJ5kut++oxNvxyReHgF+D8-ehEEw@mail.gmail.com>
Message-ID: <CAMd4_Afq=vr-qWpFAtg7GBhKv1pMMhBs45mvwX41q_75xiecUg@mail.gmail.com>

Hello and thank you.
Indeed gsubfn is responsible for loading tcltk in my case.

On Thu, Jan 3, 2013 at 12:14 PM, Gabor Grothendieck
<ggrothendieck at gmail.com> wrote:
> options(gsubfn.engine = "R")


From bates at stat.wisc.edu  Mon Jan  7 18:59:40 2013
From: bates at stat.wisc.edu (Douglas Bates)
Date: Mon, 7 Jan 2013 11:59:40 -0600
Subject: [Rd] Small changes to big objects (1)
In-Reply-To: <50E5D72E.5010704@r-project.org>
References: <50E5D72E.5010704@r-project.org>
Message-ID: <CAO7JsnQ5wdkQ5xrQ7y65iz942qm6dtEHz5GBo857H-XoaVN2uA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20130107/9f0835c7/attachment.pl>

From jmc at r-project.org  Mon Jan  7 20:20:01 2013
From: jmc at r-project.org (John Chambers)
Date: Mon, 07 Jan 2013 11:20:01 -0800
Subject: [Rd] Small changes to big objects (1)
In-Reply-To: <CAO7JsnQ5wdkQ5xrQ7y65iz942qm6dtEHz5GBo857H-XoaVN2uA@mail.gmail.com>
References: <50E5D72E.5010704@r-project.org>
	<CAO7JsnQ5wdkQ5xrQ7y65iz942qm6dtEHz5GBo857H-XoaVN2uA@mail.gmail.com>
Message-ID: <50EB1FE1.5040000@r-project.org>

On 1/7/13 9:59 AM, Douglas Bates wrote:
> Is there a difference in the copying behavior of
>
> x at little <- other
>
> and
>
> x at little[] <- other

Not in the direction you were hoping, as far as I can tell.

Nested replacement expressions in R and S are unraveled and done as 
repeated simple replacements.  So either way you end up with, in effect
   x at little <- something

If x has >1 reference, as it tends to, EnsureLocal() will call duplicate().

I think the only difference is that your second form gets you to 
duplicate the little vector twice. ;-)

John
>
> I was using the second form in (yet another!) modification of the internal
> representation of mixed-effects models in the lme4 package in the hopes
> that it would not trigger copying of the entire object.  The object
> representing the model is quite large but the changes during iterations are
> to small vectors representing parameters and coefficients.
>
>
>
> On Thu, Jan 3, 2013 at 1:08 PM, John Chambers <jmc at r-project.org> wrote:
>
>> Martin Morgan commented in email to me that a change to any slot of an
>> object that has other, large slot(s) does substantial computation,
>> presumably from copying the whole object.  Is there anything to be done?
>>
>> There are in fact two possible changes, one automatic but only partial,
>> the other requiring some action on the programmer's part.  Herewith the
>> first; I'll discuss the second in a later email.
>>
>> Some context:  The notion is that our object has some big data and some
>> additional smaller things.  We need to change the small things but would
>> rather not copy the big things all the time.  (With long vectors, this
>> becomes even more relevant.)
>>
>> There are three likely scenarios: slots, attributes and named list
>> components.  Suppose our object has "little" and "BIG" encoded in one of
>> these.
>>
>> The three relevant computations are:
>>
>> x at little <- other
>> attr(x, "little") <- other
>> x$little <- other
>>
>> It turns out that these are all similar in behavior with one important
>> exception--fixing that is the automatic change.
>>
>> I need to review what R does here. All these are replacement functions,
>> `@<-`, `attr<-`, `$<-`.  The evaluator checks before calling any
>> replacement whether the object needs to be duplicated (in a routine
>> EnsureLocal()).  It does that by examining a special field that holds the
>> reference status of the object.
>>
>> Some languages, such as Python (and S) keep reference counts for each
>> object, de-allocating the object when the reference count drops back to
>> zero.  R uses a different strategy. Its NAMED() field is 0, 1 or 2
>> according to whether the object has been assigned never, once or more than
>> once.  The field is not a reference count and is not decremented--relevant
>> for this issue.  Objects are de-allocated only when garbage collection
>> occurs and the object does not appear in any current frame or other context.
>> (I did not write any of this code, so apologies if I'm misrepresenting it.)
>>
>> When any of these replacement operations first occurs for a particular
>> object in a particular function call, it's very likely that the reference
>> status will be 2 and EnsureLocal will duplicate it--all of it. Regardless
>> of which of the three forms is used.
>>
>> Here the non-level-playing-field aspect comes in.  `@<-` is a normal R
>> function (a "closure") but the other two are primitives in the main code
>> for R.  Primitives have no frame in which arguments are stored.  As a
>> result the new version of x is normally stored with status 1.
>>
>> If one does a second replacement in the same call (in a loop, e.g.) that
>> should not normally copy again.  But the result of `@<-` will be an object
>> from its frame and will have status 2 when saved, forcing a copy each time.
>>
>> So the change, naturally, is that R 3.0.0 will have a primitive
>> implementation of `@<`.  This has been implemented in r-devel (rev. 61544).
>>
>> Please try it out _before_ we issue that version, especially if you own a
>> package that does things related to this question.
>>
>> John
>>
>> PS:  Some may have noticed that I didn't mention a fourth approach: fields
>> in a reference class object.  The assumption was that we wanted classical,
>> functional behavior here.  Reference classes don't have the copy problem
>> but don't behave functionally either.  But that is in fact the direction
>> for the other approach.  I'll discuss that later, when the corresponding
>> code is available.
>>
>> ______________________________**________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/**listinfo/r-devel<https://stat.ethz.ch/mailman/listinfo/r-devel>
>>
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From chris.jewell at warwick.ac.uk  Tue Jan  8 00:23:31 2013
From: chris.jewell at warwick.ac.uk (Chris Jewell)
Date: Tue, 8 Jan 2013 12:23:31 +1300
Subject: [Rd] "Default" accessor in S4 classes
In-Reply-To: <50E5D72E.5010704@r-project.org>
References: <50E5D72E.5010704@r-project.org>
Message-ID: <35A75ECB-EDAD-4FCA-A6D6-4CBD69A163EF@warwick.ac.uk>

Hi All,

I'm currently trying to write an S4 class that mimics a data.frame, but stores data on disc in HDF5 format.  The idea is that the dataset is likely to be too large to fit into a standard desktop machine, and by using subscripts, the user may load bits of the dataset at a time.  eg:

> myLargeData <- LargeData("/path/to/file")
> mySubSet <- myLargeData[1:10, seq(1,15,by=3)]

I've therefore defined by LargeData class thus

> LargeData <- setClass("LargeData", representation(filename="character"))
> setMethod("initialize","LargeData", function(.Object,filename) .Object at filename <- filename)

I've then defined the "[" method to call a C++ function (Rcpp), opening the HDF5 file, and returning the required rows/cols as a data.frame.

However, what if the user wants to load the entire dataset into memory?  Which method do I overload to achieve the following?

> fullData <- myLargeData
> class(fullData)
[1] "data.frame"

or apply transformations:

> myEigen <- eigen(myLargeData)

In C++ I would normally overload the "double" or "float" operator to achieve this -- can I do the same thing in R?

Thanks,

Chris


From simon.urbanek at r-project.org  Tue Jan  8 01:50:59 2013
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Mon, 7 Jan 2013 19:50:59 -0500
Subject: [Rd] "Default" accessor in S4 classes
In-Reply-To: <35A75ECB-EDAD-4FCA-A6D6-4CBD69A163EF@warwick.ac.uk>
References: <50E5D72E.5010704@r-project.org>
	<35A75ECB-EDAD-4FCA-A6D6-4CBD69A163EF@warwick.ac.uk>
Message-ID: <C42F3B9C-85D2-4337-B26D-CDD469901950@r-project.org>

Chris,

On Jan 7, 2013, at 6:23 PM, Chris Jewell wrote:

> Hi All,
> 
> I'm currently trying to write an S4 class that mimics a data.frame, but stores data on disc in HDF5 format.  The idea is that the dataset is likely to be too large to fit into a standard desktop machine, and by using subscripts, the user may load bits of the dataset at a time.  eg:
> 
>> myLargeData <- LargeData("/path/to/file")
>> mySubSet <- myLargeData[1:10, seq(1,15,by=3)]
> 
> I've therefore defined by LargeData class thus
> 
>> LargeData <- setClass("LargeData", representation(filename="character"))
>> setMethod("initialize","LargeData", function(.Object,filename) .Object at filename <- filename)
> 
> I've then defined the "[" method to call a C++ function (Rcpp), opening the HDF5 file, and returning the required rows/cols as a data.frame.
> 
> However, what if the user wants to load the entire dataset into memory?  Which method do I overload to achieve the following?
> 
>> fullData <- myLargeData
>> class(fullData)
> [1] "data.frame"
> 

That makes no sense since a <- b is not a transformation, "a" will have the same value as "b" by definition - and thus the same class. If you really meant

fullData <- as.data.frame(myLargerData)

then you just need to implement the as.data.frame() method for your class.

Note, however, that a more common way to convert between a big data reference and native format in its entirety is simply myLargeData[] -- you may want to have a look at the (many) existing big data packages (AFAIR bigmemory uses C++ back-end as well). Also note that indexing is tricky in R and easy to get wrong (remember: negative indices, index by name etc.)


> or apply transformations:
> 
>> myEigen <- eigen(myLargeData)
> 
> In C++ I would normally overload the "double" or "float" operator to achieve this -- can I do the same thing in R?
> 

Again, there is no implicit coercion in R (you cannot declare variable type in advance) so it doesn't make sense in the context you have in mind from C++ -- in R the equivalent is simply implementing as.double() method, but I suspect that's not what you had in mind. For generics you can simply implement a method for your class (that does the coercion, for example, or uses a more efficient way). If you cannot define a generic or don't want to write your own methods then it's a problem, because the only theoretical way is to subclass numeric vector class, but that is not possible in R if you want to change the representation because it falls through to the more efficient internal code too quickly (without extra dispatch) for you.

Cheers.
Simon


> Thanks,
> 
> Chris
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 


From lawrence.michael at gene.com  Tue Jan  8 01:52:05 2013
From: lawrence.michael at gene.com (Michael Lawrence)
Date: Mon, 7 Jan 2013 16:52:05 -0800
Subject: [Rd] "Default" accessor in S4 classes
In-Reply-To: <35A75ECB-EDAD-4FCA-A6D6-4CBD69A163EF@warwick.ac.uk>
References: <50E5D72E.5010704@r-project.org>
	<35A75ECB-EDAD-4FCA-A6D6-4CBD69A163EF@warwick.ac.uk>
Message-ID: <CAOQ5NyeEBKmrk++Lhxqw8nBfOKiK=e0HTiLf4a6Z-aHcAB2GEQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20130107/68a11e51/attachment.pl>

From jmc at r-project.org  Tue Jan  8 17:59:48 2013
From: jmc at r-project.org (John Chambers)
Date: Tue, 8 Jan 2013 08:59:48 -0800
Subject: [Rd] "Default" accessor in S4 classes
In-Reply-To: <35A75ECB-EDAD-4FCA-A6D6-4CBD69A163EF@warwick.ac.uk>
References: <50E5D72E.5010704@r-project.org>
	<35A75ECB-EDAD-4FCA-A6D6-4CBD69A163EF@warwick.ac.uk>
Message-ID: <61D0EF8F-C6B9-4D83-93BC-31386A314958@r-project.org>

To respond a little more directly to what you seem to be asking for:

You would like an "automatic" conversion from your class (you don't give us its name, let's call it frameHDF for now) and "data.frame".

In R (and in OOP generally) this sounds like inheritance: you want  a frameHDF to be valid wherever a data.frame is wanted.

_IF_ that is really a good idea, it can be done by using setIs() to define the correspondence.  Then methods for data.frame objects (formal methods at least) will convert the argument automatically.

(As noted previously, the simple assignment operation doesn't check types.)

However, this doesn't sound like such a good idea.  The point of your class is to handle objects too large for ordinary data frames.  Converting automatically sounds like a recipe for unpleasant surprises.

A more cautious approach would be for the user to explicitly state when a conversion is needed.  The general tool for defining this is setAs(), very similar to setIs() but not making things automatic, the user then says as(x, "data.frame") to get conversion.

The online documentation for these two functions says some more; also section 9.3 of my 2008 book referenced in the documentation.

One more comment.  It would be likely that your HDF5 objects have reference semantics--any changes made are seen by all the functions using that object.  This is different from R's functional semantics as in S4 classes, and the differences can cause incorrect results in some situations. The more recent reference classes (?ReferenceClasses) were designed to mimic C++, Java, etc style behavior.  (They are used in Rcpp to import C++ classes.)

John


On Jan 7, 2013, at 3:23 PM, Chris Jewell wrote:

> Hi All,
> 
> I'm currently trying to write an S4 class that mimics a data.frame, but stores data on disc in HDF5 format.  The idea is that the dataset is likely to be too large to fit into a standard desktop machine, and by using subscripts, the user may load bits of the dataset at a time.  eg:
> 
>> myLargeData <- LargeData("/path/to/file")
>> mySubSet <- myLargeData[1:10, seq(1,15,by=3)]
> 
> I've therefore defined by LargeData class thus
> 
>> LargeData <- setClass("LargeData", representation(filename="character"))
>> setMethod("initialize","LargeData", function(.Object,filename) .Object at filename <- filename)
> 
> I've then defined the "[" method to call a C++ function (Rcpp), opening the HDF5 file, and returning the required rows/cols as a data.frame.
> 
> However, what if the user wants to load the entire dataset into memory?  Which method do I overload to achieve the following?
> 
>> fullData <- myLargeData
>> class(fullData)
> [1] "data.frame"
> 
> or apply transformations:
> 
>> myEigen <- eigen(myLargeData)
> 
> In C++ I would normally overload the "double" or "float" operator to achieve this -- can I do the same thing in R?
> 
> Thanks,
> 
> Chris
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From Jan-Christoph.Thiele at forst.uni-goettingen.de  Tue Jan  8 17:44:00 2013
From: Jan-Christoph.Thiele at forst.uni-goettingen.de (Thiele, Jan Christoph)
Date: Tue, 8 Jan 2013 17:44:00 +0100
Subject: [Rd] Win 32-bit, stack size problem with third party software?
Message-ID: <99392551BB49ED458ACFE796416D31890214248F@VS3.exc.top.gwdg.de>

Dear R-developers,

since R 2.15.2 I?m getting an error with my RNetLogo package.

The package uses rJava and connects to the Java program NetLogo
(http://ccl.northwestern.edu/netlogo/). 

When starting it in so-called GUI-mode, i.e.: 

library(RNetLogo) 
NLStart("C:/Program Files/NetLogo 5.0.3", gui=T)  #replace the path with the
path to your NetLogo installation directory

on a 32-bit Windows (Vista) system, I?m getting the following error message:

java.lang.OutOfMemoryError: unable to create new native thread

This happens when running it in the RGUI as well as in a MS-DOS prompt. 
The error doesn?t happen on a 64-bit Windows 7 system. 
It also doesn?t happen when I start it from RStudio (version 0.97.248, with R
2.15.2) or from JGR. 
With R 2.15.1 it worked without a problem even with RGUI and MS-DOS prompt.
rJava version is always the same.

I saw that the C stack size was increased with R 2.15.2:
"On Windows, the C stack size has been increased to 64MB (it has been 10MB
since the days of 32MB RAM systems)."
Furthermore, I found a discussion for RStudio which looks very similar to me:
http://support.rstudio.org/help/discussions/problems/4126-rstudio-v-and-v0963
31-running-with-rbbg

I checked the C stack size with Cstack_info() and saw that 
in the RGUI 2.15.2 it is 67108864, 
in the RGUI 2.15.1 it was 10485760 
and in RStudio using R 2.15.2 it is 20971520.

Maybe also this message is related: 
http://r.789695.n4.nabble.com/rJava-td4652659.html

Am I?m right that the problem is related to the increase in C stack size?
Is there a (easy) way to fix the problem with my package or have I refer the
users of my package to RStudio or JGR?

Any help is much appreciated.
Many thanks.

Best wishes,

Jan


-----------------------------------------------------------------------------
---------
Jan C. Thiele
Department of Ecoinformatics, Biometrics & Forest Growth
Faculty of Forest Sciences and Forest Ecology
University of Goettingen

Buesgenweg 4
37077 Goettingen
GERMANY


From chris.jewell at warwick.ac.uk  Wed Jan  9 01:28:49 2013
From: chris.jewell at warwick.ac.uk (Chris Jewell)
Date: Wed, 9 Jan 2013 13:28:49 +1300
Subject: [Rd] "Default" accessor in S4 classes
In-Reply-To: <61D0EF8F-C6B9-4D83-93BC-31386A314958@r-project.org>
References: <50E5D72E.5010704@r-project.org>
	<35A75ECB-EDAD-4FCA-A6D6-4CBD69A163EF@warwick.ac.uk>
	<61D0EF8F-C6B9-4D83-93BC-31386A314958@r-project.org>
Message-ID: <7BE26BCC-F7A3-428B-9833-E6EFEA83BCF0@warwick.ac.uk>

Okay, thanks for the input, All.  I'd settled on the explicit coercion as.data.frame as well as the myObject[] syntax which makes a lot of sense.  I'd also like to implement an as.double() method.  However, I'm having trouble embedding this into my package.  In the R file I have:

setMethod("as.double", "HD5Proxy", function(x) as.double(x[]))

and exportMethods(as.double) in my NAMESPACES file.  However, on checking the package, I get an error saying that method "as.double" cannot be found.  I noticed that the setMethod command actually returns a character vector with "as.numeric", so I'm assuming this is the problem.  How do I explicitly export my as.double method?

Thanks,

Chris


From justintalbot at gmail.com  Wed Jan  9 05:44:40 2013
From: justintalbot at gmail.com (Justin Talbot)
Date: Tue, 8 Jan 2013 20:44:40 -0800
Subject: [Rd] Bug in list subset assignment due to NAMED optimization
Message-ID: <CALLn38PewFgLO-SnLv+8Pk5UDpDKwJFX4rtrV9w5VOC8Os4u-A@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20130108/a7d5edfe/attachment.pl>

From luke-tierney at uiowa.edu  Wed Jan  9 16:16:56 2013
From: luke-tierney at uiowa.edu (luke-tierney at uiowa.edu)
Date: Wed, 9 Jan 2013 09:16:56 -0600
Subject: [Rd] Bug in list subset assignment due to NAMED optimization
In-Reply-To: <CALLn38PewFgLO-SnLv+8Pk5UDpDKwJFX4rtrV9w5VOC8Os4u-A@mail.gmail.com>
References: <CALLn38PewFgLO-SnLv+8Pk5UDpDKwJFX4rtrV9w5VOC8Os4u-A@mail.gmail.com>
Message-ID: <alpine.DEB.2.02.1301090915540.2656@luke-Latitude>

On Tue, 8 Jan 2013, Justin Talbot wrote:

> In R version 2.15.2 (2012-10-26) i386-apple-darwin9.8.0/i386 (32-bit) I get
> the following:
>
>> a <- list(1)
>> (a[[1]] <- a)
> [[1]]
> [[1]][[1]]
> [1] 1
>
> but
>
>> a <- list(1)
>> b <- a
>> (a[[1]] <- a)
> [[1]]
> [1] 1
>
> And similarly:
>
>> a <- list(x=1)
>> (a$x <- a)
> $x
> $x$x
> [1] 1
>
> but
>
>> a <- list(x=1)
>> b <- a
>> (a$x <- a)
> $x
> [1] 1
>
> In both cases the result of the first sequence is wrong. It's returning the
> updated `a` rather than the RHS of the assignment. The second sequence in
> both cases is correct; the assignment to `b` increments the NAMED value
> causing the necessary copy to be made so the RHS is returned from the
> assignment.
>
> Would it be sufficient to add a check to do_subassign2_dflt
> and do_subassign3_dflt that creates a duplicate of the LHS if the LHS & RHS
> are the same object?

Thanks -- that's probably the best fix but I want to think it thorugh
a bit more before committing.

Best,

luke

>
> Justin
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Luke Tierney
Chair, Statistics and Actuarial Science
Ralph E. Wareham Professor of Mathematical Sciences
University of Iowa                  Phone:             319-335-3386
Department of Statistics and        Fax:               319-335-3017
    Actuarial Science
241 Schaeffer Hall                  email:   luke-tierney at uiowa.edu
Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu


From taylor.russ at gmail.com  Thu Jan 10 03:58:22 2013
From: taylor.russ at gmail.com (rtaylor)
Date: Wed, 9 Jan 2013 18:58:22 -0800 (PST)
Subject: [Rd] Cannot override default  -O3 flag on Winodws,
 dll does not have symbols
Message-ID: <1357786702776-4655106.post@n4.nabble.com>

In trying to compile a package with c code using Rtools, -O3 is added by
default. This comes from Makeconf?  Compiler flags (CFLAGS="-O0 -g" ) set in
src/Makevars.win or src/Makevars appear before this.  

nm pkg.dll reveals no symbols!

How can I compile a Windows package with "-O2 -g"?

Thanks,
RT



--
View this message in context: http://r.789695.n4.nabble.com/Cannot-override-default-O3-flag-on-Winodws-dll-does-not-have-symbols-tp4655106.html
Sent from the R devel mailing list archive at Nabble.com.


From edd at debian.org  Thu Jan 10 04:32:00 2013
From: edd at debian.org (Dirk Eddelbuettel)
Date: Wed, 9 Jan 2013 21:32:00 -0600
Subject: [Rd] Cannot override default  -O3 flag on Winodws,
 dll does not have symbols
In-Reply-To: <1357786702776-4655106.post@n4.nabble.com>
References: <1357786702776-4655106.post@n4.nabble.com>
Message-ID: <20718.13872.12950.378498@max.nulle.part>


On 9 January 2013 at 18:58, rtaylor wrote:
| In trying to compile a package with c code using Rtools, -O3 is added by
| default. This comes from Makeconf?  Compiler flags (CFLAGS="-O0 -g" ) set in
| src/Makevars.win or src/Makevars appear before this.  
| 
| nm pkg.dll reveals no symbols!
| 
| How can I compile a Windows package with "-O2 -g"?

a)  [long way] By locally building R with such a configure flag

b)  [shortcut] By editing the Makeconf file of the R installation used for
    compiling, eg in $R_HOME/etc/Makeconf (or maybe Makeconf.win)

Dirk

-- 
Dirk Eddelbuettel | edd at debian.org | http://dirk.eddelbuettel.com


From ripley at stats.ox.ac.uk  Thu Jan 10 08:55:29 2013
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 10 Jan 2013 07:55:29 +0000
Subject: [Rd] Cannot override default  -O3 flag on Winodws,
 dll does not have symbols
In-Reply-To: <1357786702776-4655106.post@n4.nabble.com>
References: <1357786702776-4655106.post@n4.nabble.com>
Message-ID: <50EE73F1.1010800@stats.ox.ac.uk>

On 10/01/2013 02:58, rtaylor wrote:
> In trying to compile a package with c code using Rtools, -O3 is added by
> default. This comes from Makeconf?  Compiler flags (CFLAGS="-O0 -g" ) set in
> src/Makevars.win or src/Makevars appear before this.
>
> nm pkg.dll reveals no symbols!

That is not a function of using -O3, if there is useful code (as there 
needs to be in an R package since you need to link to entry points).
>
> How can I compile a Windows package with "-O2 -g"?

By following the manuals.  'Writing R Extensions' points you to your 
local version of
http://cran.r-project.org/doc/manuals/r-release/R-admin.html#Customizing-package-compilation

But it you want debug symbols, read about how to build a debug version 
of R in that manual (and use -gdwarf-2).


>
> Thanks,
> RT
>
>
>
> --
> View this message in context: http://r.789695.n4.nabble.com/Cannot-override-default-O3-flag-on-Winodws-dll-does-not-have-symbols-tp4655106.html
> Sent from the R devel mailing list archive at Nabble.com.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From maechler at stat.math.ethz.ch  Thu Jan 10 10:44:46 2013
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Thu, 10 Jan 2013 10:44:46 +0100
Subject: [Rd] "Default" accessor in S4 classes
In-Reply-To: <7BE26BCC-F7A3-428B-9833-E6EFEA83BCF0@warwick.ac.uk>
References: <50E5D72E.5010704@r-project.org>
	<35A75ECB-EDAD-4FCA-A6D6-4CBD69A163EF@warwick.ac.uk>
	<61D0EF8F-C6B9-4D83-93BC-31386A314958@r-project.org>
	<7BE26BCC-F7A3-428B-9833-E6EFEA83BCF0@warwick.ac.uk>
Message-ID: <20718.36238.52384.86543@stat.math.ethz.ch>

>>>>> Chris Jewell <chris.jewell at warwick.ac.uk>
>>>>>     on Wed, 9 Jan 2013 13:28:49 +1300 writes:
>>>>> "CJ" == Chris Jewell <chris.jewell at warwick.ac.uk>
>>>>>     on Wed, 9 Jan 2013 13:28:49 +1300 writes:

    CJ> Okay, thanks for the input, All.  I'd settled on the explicit coercion as.data.frame as well as the myObject[] syntax which makes a lot of sense.  I'd also like to implement an as.double() method.  However, I'm having trouble embedding this into my package.  In the R file I have:

    CJ> setMethod("as.double", "HD5Proxy", function(x) as.double(x[]))

    CJ> and exportMethods(as.double) in my NAMESPACES file.  However, on checking the package, I get an error saying that method "as.double" cannot be found.  I noticed that the setMethod command actually returns a character vector with "as.numeric", so I'm assuming this is the problem.  How do I explicitly export my as.double method?

As you've noticed above,  `` R prefers as.numeric ''
and that is what you should be dealing with instead :
It's unsatisfactory I agree, but that's what it currently is:

setMethod("as.numeric", ....

and exportMethods(as.numeric)

Martin


From dries.verheyen at ees.kuleuven.be  Fri Jan 11 11:12:15 2013
From: dries.verheyen at ees.kuleuven.be (Dries Verheyen)
Date: Fri, 11 Jan 2013 02:12:15 -0800 (PST)
Subject: [Rd] Date time conversion bug (as.POSIXct)?
Message-ID: <1357899135306-4655215.post@n4.nabble.com>

There is something wrong, I think, with the date-time conversion from a
numeric value if you use Central European Time (CET) as timezone.
Examples from R:

If I use the GMT time zone it is OK, I get the same time back from
as.POSIXct as I entered

> as.POSIXct(as.numeric(strptime("30/01/2012 13:00:00", format="%d/%m/%Y
> %H:%M:%S",tz="GMT")),origin="1970-01-01",tz="GMT")

[1] "2012-01-30 13:00:00 GMT"

If I go from CET to GMT there is also no problem:

>as.POSIXct(as.numeric(strptime("30/01/2012 13:00:00", format="%d/%m/%Y
%H:%M:%S",tz="CET")),origin="1970-01-01",tz="GMT")

[1] "2012-01-30 12:00:00 GMT"

In winter we are 1 hour ahead of Greenwich.

Also in summer it is OK (2 hours ahead of Greenwich):

>as.POSIXct(as.numeric(strptime("30/05/2012 13:00:00", format="%d/%m/%Y
%H:%M:%S",tz="CET")),origin="1970-01-01",tz="GMT")

[1] "2012-05-30 11:00:00 GMT"

The problem occurs when I use both the same time zone, if it is not GMT:

>as.POSIXct(as.numeric(strptime("30/01/2012 13:00:00", format="%d/%m/%Y
%H:%M:%S",tz="CET")),origin="1970-01-01",tz="CET")

[1] "2012-01-30 12:00:00 CET"

>as.POSIXct(as.numeric(strptime("30/05/2012 13:00:00", format="%d/%m/%Y
%H:%M:%S",tz="CET")),origin="1970-01-01",tz="CET")

[1] "2012-05-30 12:00:00 CEST"

> as.POSIXct(as.numeric(strptime("30/05/2012 13:00:00", format="%d/%m/%Y
> %H:%M:%S",tz="EST")),origin="1970-01-01",tz="EST")
[1] "2012-05-30 18:00:00 EST"

It looks like the function just puts the name of the time zone behind the
time calculated in GMT, and does not calculate the time in the asked time
zone.
Is it just how the function works? because for me it is a bit confusing like
that.



--
View this message in context: http://r.789695.n4.nabble.com/Date-time-conversion-bug-as-POSIXct-tp4655215.html
Sent from the R devel mailing list archive at Nabble.com.


From bbolker at gmail.com  Fri Jan 11 18:59:11 2013
From: bbolker at gmail.com (Ben Bolker)
Date: Fri, 11 Jan 2013 12:59:11 -0500
Subject: [Rd] .print.via.format not found when building r61617?
Message-ID: <50F052EF.5070808@ufl.edu>

  I wouldn't be at all surprised if I turned out to be doing something
boneheaded, but I've *tried* to follow all the relevant rules ...
Based on a clean SVN checkout of R-devel r61617, building in a
separate directory, I end up with

Error in eval(expr, envir, enclos) : object '.print.via.format' not found

  Has anyone encountered this or does anyone have any further
clues/diagnostic hints?  I found .print.via.format defined in the
middle of src/library/tools/all.R , and in the source in
src/library/tools/R/QC.R, and I see that it was added in r61322
(2012-12-14); is there anything else I can try?

  Ben Bolker

> cd r-devel svn update
   At revision 61617.
> cd ../r-devel-build ../r-devel/configure --enable-R-shlib

R is now configured for i686-pc-linux-gnu

  Source directory:          ../r-devel
  Installation directory:    /usr/local

  C compiler:                gcc -std=gnu99  -g -O2
  Fortran 77 compiler:       gfortran  -g -O2

  C++ compiler:              g++  -g -O2
  Fortran 90/95 compiler:    gfortran -g -O2
  Obj-C compiler:	

  Interfaces supported:      X11, tcltk
  External libraries:        readline
  Additional capabilities:   PNG, JPEG, NLS, cairo
  Options enabled:           shared R library, shared BLAS, R
profiling, Java

  Recommended packages:      yes

> make

 ...

make[4]: Leaving directory
`/mnt/hgfs/bolker/Documents/R/r-devel-build/src/library/tools'
Error in eval(expr, envir, enclos) : object '.print.via.format' not found
Error: unable to load R code in package ?tools?
Execution halted


From simon.urbanek at r-project.org  Fri Jan 11 19:27:15 2013
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Fri, 11 Jan 2013 13:27:15 -0500
Subject: [Rd] Date time conversion bug (as.POSIXct)?
In-Reply-To: <1357899135306-4655215.post@n4.nabble.com>
References: <1357899135306-4655215.post@n4.nabble.com>
Message-ID: <4F88DD6E-1BC4-4639-8A46-F591BD0AB26A@r-project.org>

On Jan 11, 2013, at 5:12 AM, Dries Verheyen wrote:

> There is something wrong, I think, with the date-time conversion from a
> numeric value if you use Central European Time (CET) as timezone.
> Examples from R:
> 
> If I use the GMT time zone it is OK, I get the same time back from
> as.POSIXct as I entered
> 
>> as.POSIXct(as.numeric(strptime("30/01/2012 13:00:00", format="%d/%m/%Y
>> %H:%M:%S",tz="GMT")),origin="1970-01-01",tz="GMT")
> 
> [1] "2012-01-30 13:00:00 GMT"
> 
> If I go from CET to GMT there is also no problem:
> 
>> as.POSIXct(as.numeric(strptime("30/01/2012 13:00:00", format="%d/%m/%Y
> %H:%M:%S",tz="CET")),origin="1970-01-01",tz="GMT")
> 
> [1] "2012-01-30 12:00:00 GMT"
> 
> In winter we are 1 hour ahead of Greenwich.
> 
> Also in summer it is OK (2 hours ahead of Greenwich):
> 
>> as.POSIXct(as.numeric(strptime("30/05/2012 13:00:00", format="%d/%m/%Y
> %H:%M:%S",tz="CET")),origin="1970-01-01",tz="GMT")
> 
> [1] "2012-05-30 11:00:00 GMT"
> 
> The problem occurs when I use both the same time zone, if it is not GMT:
> 
>> as.POSIXct(as.numeric(strptime("30/01/2012 13:00:00", format="%d/%m/%Y
> %H:%M:%S",tz="CET")),origin="1970-01-01",tz="CET")
> 
> [1] "2012-01-30 12:00:00 CET"
> 
>> as.POSIXct(as.numeric(strptime("30/05/2012 13:00:00", format="%d/%m/%Y
> %H:%M:%S",tz="CET")),origin="1970-01-01",tz="CET")
> 
> [1] "2012-05-30 12:00:00 CEST"
> 
>> as.POSIXct(as.numeric(strptime("30/05/2012 13:00:00", format="%d/%m/%Y
>> %H:%M:%S",tz="EST")),origin="1970-01-01",tz="EST")
> [1] "2012-05-30 18:00:00 EST"
> 
> It looks like the function just puts the name of the time zone behind the
> time calculated in GMT, and does not calculate the time in the asked time
> zone.

It works perfectly fine the way it's supposed to - you just give it wrong input. What you get from as.numeric(...) is the offset from the epoch (1970-01-01 GMT!) yet you are then forcing as.POSIXct to interpret it as offset from the local time zone which is obviously wrong. I suppose what you really wanted is

> .POSIXct(as.numeric(strptime("30/05/2012 13:00:00", format="%d/%m/%Y%H:%M:%S",tz="EST")),"EST")
[1] "2012-05-30 13:00:00 EST"

The problem in your case is that you want to have origin in a different timezone than the result which is a bit convoluted.

Cheers,
Simon




> Is it just how the function works? because for me it is a bit confusing like
> that.
> 
> 
> 
> --
> View this message in context: http://r.789695.n4.nabble.com/Date-time-conversion-bug-as-POSIXct-tp4655215.html
> Sent from the R devel mailing list archive at Nabble.com.
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 


From bbolker at gmail.com  Fri Jan 11 21:11:53 2013
From: bbolker at gmail.com (Ben Bolker)
Date: Fri, 11 Jan 2013 15:11:53 -0500
Subject: [Rd] .print.via.format not found when building r61617?
In-Reply-To: <50F052EF.5070808@ufl.edu>
References: <50F052EF.5070808@ufl.edu>
Message-ID: <50F07209.4030102@gmail.com>

On 13-01-11 12:59 PM, Ben Bolker wrote:
>   I wouldn't be at all surprised if I turned out to be doing something
> boneheaded, but I've *tried* to follow all the relevant rules ...
> Based on a clean SVN checkout of R-devel r61617, building in a
> separate directory, I end up with
> 
> Error in eval(expr, envir, enclos) : object '.print.via.format' not found
> 
>   Has anyone encountered this or does anyone have any further
> clues/diagnostic hints?  I found .print.via.format defined in the
> middle of src/library/tools/all.R , and in the source in
> src/library/tools/R/QC.R, and I see that it was added in r61322
> (2012-12-14); is there anything else I can try?
> 
>   Ben Bolker

  PS: I did successfully build R by reverting to r61321.  I'm not sure I
have the time and energy to do the full binary search between r61321 and
r61617 [8 steps, rebuilding R each time] to see where it breaks.  I need
to try to get up to r61589 or thereabouts, which is the version in which
the tests of my package broke on the CRAN check ...

  I may yet try: (1) configuring without --enable-R-shlib (I can't see
why that would be relevant here, but it is something I'm doing that's
slightly "non-standard" that therefore might have been missed by
others); (2) updating to r61322 or 61323 and seeing if the breakage
happens right there (although it's possible that something was broken in
61322 and fixed for everyone else thereafter, and the problem is still
my fault -- I don't see anything obvious to that effect in the SVN log,
but I could have missed it ...)
> 
>> cd r-devel svn update
>    At revision 61617.
>> cd ../r-devel-build ../r-devel/configure --enable-R-shlib
> 
> R is now configured for i686-pc-linux-gnu
> 
>   Source directory:          ../r-devel
>   Installation directory:    /usr/local
> 
>   C compiler:                gcc -std=gnu99  -g -O2
>   Fortran 77 compiler:       gfortran  -g -O2
> 
>   C++ compiler:              g++  -g -O2
>   Fortran 90/95 compiler:    gfortran -g -O2
>   Obj-C compiler:	
> 
>   Interfaces supported:      X11, tcltk
>   External libraries:        readline
>   Additional capabilities:   PNG, JPEG, NLS, cairo
>   Options enabled:           shared R library, shared BLAS, R
> profiling, Java
> 
>   Recommended packages:      yes
> 
>> make
> 
>  ...
> 
> make[4]: Leaving directory
> `/mnt/hgfs/bolker/Documents/R/r-devel-build/src/library/tools'
> Error in eval(expr, envir, enclos) : object '.print.via.format' not found
> Error: unable to load R code in package ?tools?
> Execution halted
>


From hb at biostat.ucsf.edu  Fri Jan 11 21:22:21 2013
From: hb at biostat.ucsf.edu (Henrik Bengtsson)
Date: Fri, 11 Jan 2013 12:22:21 -0800
Subject: [Rd] Patch for setwd() to show path in error message
Message-ID: <CAFDcVCSbs3nh_Lnc8xi0RhHpL4WS=QpSakyD+ERyUU7nv-H68Q@mail.gmail.com>

Below is a patch for setwd() to show path in error message.  Current
it just gives error messages such as:

Error in setwd(libdir) : cannot change working directory

with the patch it should (read untested) give:

Error in setwd(libdir) : cannot change working directory to 'path/that/fails/'


PATCH:

% diff -u util.c "util,patch.c"

--- util.c      2012-12-16 13:13:05.002249900 -0800
+++ util,patch.c        2013-01-11 11:52:16.843236400 -0800
@@ -696,14 +696,14 @@
     {
        const wchar_t *path = filenameToWchar(STRING_ELT(s, 0), TRUE);
        if(_wchdir(path) < 0)
-           error(_("cannot change working directory"));
+         error(_("cannot change working directory to '%s'"), path);
     }
 #else
     {
        const char *path
            = R_ExpandFileName(translateChar(STRING_ELT(s, 0)));
     if(chdir(path) < 0)
-       error(_("cannot change working directory"));
+      error(_("cannot change working directory to '%s'"), path);
     }
 #endif
     return(wd);


TRANSLATIONS:
I have zero experience with GNU gettext/*.po files, but I understand
that the above change requires updates to src/library/base/*.po files,
which now looks like (e.g. de.po):

#: src/main/util.c:699 src/main/util.c:706
msgid "cannot change working directory"
msgstr "kann Arbeitsverzeichnis nicht wechseln"

A generic/automatic update would be to use the format:

#: src/main/util.c:699 src/main/util.c:706
msgid "cannot change working directory: '%s'"
msgstr "kann Arbeitsverzeichnis nicht wechseln: '%s'"

but I don't think that is in line with the current R style.

/Henrik

PS. Background for this patch:
https://r-forge.r-project.org/tracker/index.php?func=detail&aid=2395&group_id=34&atid=194


From ripley at stats.ox.ac.uk  Sat Jan 12 07:40:46 2013
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sat, 12 Jan 2013 06:40:46 +0000
Subject: [Rd] Patch for setwd() to show path in error message
In-Reply-To: <CAFDcVCSbs3nh_Lnc8xi0RhHpL4WS=QpSakyD+ERyUU7nv-H68Q@mail.gmail.com>
References: <CAFDcVCSbs3nh_Lnc8xi0RhHpL4WS=QpSakyD+ERyUU7nv-H68Q@mail.gmail.com>
Message-ID: <50F1056E.4050207@stats.ox.ac.uk>

On 11/01/2013 20:22, Henrik Bengtsson wrote:
> Below is a patch for setwd() to show path in error message.  Current
> it just gives error messages such as:
>
> Error in setwd(libdir) : cannot change working directory
>
> with the patch it should (read untested) give:
>
> Error in setwd(libdir) : cannot change working directory to 'path/that/fails/'

And why is this needed?  You know it is 'libdir' and could check what 
that was (or if doing this programatically, check its existence first).

As you fumbled towards, it would require all the translations to be 
redone, so we don't do this sort of thing lightly.  (Redone twice if it 
were done correctly, AFAICS.)  The .pot and .po files are generated 
automatically, but not filled in automatically.  This is all in the 
manuals ....

In any case, the correct procedure was to file an enhancement request on 
R-bugs, with a case and after testing on both platforms you are 
proposing to patch.


>
>
> PATCH:
>
> % diff -u util.c "util,patch.c"
>
> --- util.c      2012-12-16 13:13:05.002249900 -0800
> +++ util,patch.c        2013-01-11 11:52:16.843236400 -0800
> @@ -696,14 +696,14 @@
>       {
>          const wchar_t *path = filenameToWchar(STRING_ELT(s, 0), TRUE);
>          if(_wchdir(path) < 0)
> -           error(_("cannot change working directory"));
> +         error(_("cannot change working directory to '%s'"), path);

That is a wchar_t*, so the format would need to be %ls.

>       }
>   #else
>       {
>          const char *path
>              = R_ExpandFileName(translateChar(STRING_ELT(s, 0)));
>       if(chdir(path) < 0)
> -       error(_("cannot change working directory"));
> +      error(_("cannot change working directory to '%s'"), path);

>       }
>   #endif
>       return(wd);
>
>
> TRANSLATIONS:
> I have zero experience with GNU gettext/*.po files, but I understand
> that the above change requires updates to src/library/base/*.po files,
> which now looks like (e.g. de.po):
>
> #: src/main/util.c:699 src/main/util.c:706
> msgid "cannot change working directory"
> msgstr "kann Arbeitsverzeichnis nicht wechseln"
>
> A generic/automatic update would be to use the format:
>
> #: src/main/util.c:699 src/main/util.c:706
> msgid "cannot change working directory: '%s'"
> msgstr "kann Arbeitsverzeichnis nicht wechseln: '%s'"
>
> but I don't think that is in line with the current R style.
>
> /Henrik
>
> PS. Background for this patch:
> https://r-forge.r-project.org/tracker/index.php?func=detail&aid=2395&group_id=34&atid=194
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ggrothendieck at gmail.com  Sat Jan 12 17:02:04 2013
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sat, 12 Jan 2013 11:02:04 -0500
Subject: [Rd] Tricking Promises into Sending Info Via Args into Caller
Message-ID: <CAP01uRnT_Lvw_97GAhXP7xOo6UjsXCTEVPf-H=OAQfWqwd0h1Q@mail.gmail.com>

The is.pos function below results in the variable, out, being set to
TRUE if the first argument to is.pos is positive and to FALSE
otherwise.

It does this without using the return value or using scoping tricks to
reach into the caller.  Instead it tricks the promise into
communicating one bit of information upwardly from the function to its
caller via the second argument.

One would have thought this to be impossible.  Is this intended behavior?

is.pos <- function(i, x) { if (i > 0) x; NULL }

# in this example actual arg1 of is.pos is positive
out <- FALSE
is.pos(1, out <- TRUE)
out # TRUE

# in this example actual arg1 of is.pos is negative
out <- FALSE
is.pos(-1, out <- TRUE)
out # FALSE

--
Statistics & Software Consulting
GKX Group, GKX Associates Inc.
tel: 1-877-GKX-GROUP
email: ggrothendieck at gmail.com


From pdalgd at gmail.com  Sat Jan 12 18:19:21 2013
From: pdalgd at gmail.com (peter dalgaard)
Date: Sat, 12 Jan 2013 18:19:21 +0100
Subject: [Rd] Tricking Promises into Sending Info Via Args into Caller
In-Reply-To: <CAP01uRnT_Lvw_97GAhXP7xOo6UjsXCTEVPf-H=OAQfWqwd0h1Q@mail.gmail.com>
References: <CAP01uRnT_Lvw_97GAhXP7xOo6UjsXCTEVPf-H=OAQfWqwd0h1Q@mail.gmail.com>
Message-ID: <C855DD54-8358-4E1D-879A-97D98FDED513@gmail.com>


On Jan 12, 2013, at 17:02 , Gabor Grothendieck wrote:

> The is.pos function below results in the variable, out, being set to
> TRUE if the first argument to is.pos is positive and to FALSE
> otherwise.
> 
> It does this without using the return value or using scoping tricks to
> reach into the caller.  Instead it tricks the promise into
> communicating one bit of information upwardly from the function to its
> caller via the second argument.
> 
> One would have thought this to be impossible.  Is this intended behavior?

Yes, this is a generic consequence of lazy evaluation: delayed and unpredictable side effects. Whether it is desirable is an open issue; it is the sort of thing that creates serious headaches for compiler constructors, but it is pretty much unavoidable once you include the lazy eval feature.

> 
> is.pos <- function(i, x) { if (i > 0) x; NULL }
> 
> # in this example actual arg1 of is.pos is positive
> out <- FALSE
> is.pos(1, out <- TRUE)
> out # TRUE
> 
> # in this example actual arg1 of is.pos is negative
> out <- FALSE
> is.pos(-1, out <- TRUE)
> out # FALSE
> 
> --
> Statistics & Software Consulting
> GKX Group, GKX Associates Inc.
> tel: 1-877-GKX-GROUP
> email: ggrothendieck at gmail.com
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Peter Dalgaard, Professor,
Center for Statistics, Copenhagen Business School
Solbjerg Plads 3, 2000 Frederiksberg, Denmark
Phone: (+45)38153501
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From hb at biostat.ucsf.edu  Sat Jan 12 18:50:21 2013
From: hb at biostat.ucsf.edu (Henrik Bengtsson)
Date: Sat, 12 Jan 2013 09:50:21 -0800
Subject: [Rd] Tricking Promises into Sending Info Via Args into Caller
In-Reply-To: <C855DD54-8358-4E1D-879A-97D98FDED513@gmail.com>
References: <CAP01uRnT_Lvw_97GAhXP7xOo6UjsXCTEVPf-H=OAQfWqwd0h1Q@mail.gmail.com>
	<C855DD54-8358-4E1D-879A-97D98FDED513@gmail.com>
Message-ID: <CAFDcVCQuqhLES5YpRqi-6-6LP0hac7sNBB92Eoq_o-2s0n6zPw@mail.gmail.com>

In the spirit of this, but AFAIK not due to lazy evaluation, here's
another illustration why it's easy to mistakes when doing "inline"
assignments:

> x <- 0
> TRUE && (x <- 1)
[1] TRUE
> x
[1] 1

> FALSE && (x <- 2)
[1] FALSE
> x
[1] 1

> (x <- 3) && FALSE
[1] FALSE
> x
[1] 3

> FALSE & (x <- 4)
[1] FALSE
> x
[1] 4

/Henrik

On Sat, Jan 12, 2013 at 9:19 AM, peter dalgaard <pdalgd at gmail.com> wrote:
>
> On Jan 12, 2013, at 17:02 , Gabor Grothendieck wrote:
>
>> The is.pos function below results in the variable, out, being set to
>> TRUE if the first argument to is.pos is positive and to FALSE
>> otherwise.
>>
>> It does this without using the return value or using scoping tricks to
>> reach into the caller.  Instead it tricks the promise into
>> communicating one bit of information upwardly from the function to its
>> caller via the second argument.
>>
>> One would have thought this to be impossible.  Is this intended behavior?
>
> Yes, this is a generic consequence of lazy evaluation: delayed and unpredictable side effects. Whether it is desirable is an open issue; it is the sort of thing that creates serious headaches for compiler constructors, but it is pretty much unavoidable once you include the lazy eval feature.
>
>>
>> is.pos <- function(i, x) { if (i > 0) x; NULL }
>>
>> # in this example actual arg1 of is.pos is positive
>> out <- FALSE
>> is.pos(1, out <- TRUE)
>> out # TRUE
>>
>> # in this example actual arg1 of is.pos is negative
>> out <- FALSE
>> is.pos(-1, out <- TRUE)
>> out # FALSE
>>
>> --
>> Statistics & Software Consulting
>> GKX Group, GKX Associates Inc.
>> tel: 1-877-GKX-GROUP
>> email: ggrothendieck at gmail.com
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
> --
> Peter Dalgaard, Professor,
> Center for Statistics, Copenhagen Business School
> Solbjerg Plads 3, 2000 Frederiksberg, Denmark
> Phone: (+45)38153501
> Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From hb at biostat.ucsf.edu  Sat Jan 12 20:21:22 2013
From: hb at biostat.ucsf.edu (Henrik Bengtsson)
Date: Sat, 12 Jan 2013 11:21:22 -0800
Subject: [Rd] Patch for setwd() to show path in error message
In-Reply-To: <50F1056E.4050207@stats.ox.ac.uk>
References: <CAFDcVCSbs3nh_Lnc8xi0RhHpL4WS=QpSakyD+ERyUU7nv-H68Q@mail.gmail.com>
	<50F1056E.4050207@stats.ox.ac.uk>
Message-ID: <CAFDcVCRCHnyW3=xk6N5z35KtvMcAM9y+iE-geJ9TTRKF+ruf2w@mail.gmail.com>

On Fri, Jan 11, 2013 at 10:40 PM, Prof Brian Ripley
<ripley at stats.ox.ac.uk> wrote:
> On 11/01/2013 20:22, Henrik Bengtsson wrote:
>>
>> Below is a patch for setwd() to show path in error message.  Current
>> it just gives error messages such as:
>>
>> Error in setwd(libdir) : cannot change working directory
>>
>> with the patch it should (read untested) give:
>>
>> Error in setwd(libdir) : cannot change working directory to
>> 'path/that/fails/'
>
>
> And why is this needed?  You know it is 'libdir' and could check what that
> was (or if doing this programatically, check its existence first).

Risking to state the obvious:

To me, the main purpose of error messages is to make troubleshooting
easier. The more informative the error message is, the easier it is to
troubleshoot and the faster the origin of the error can be resolved.
The other extreme is to provide an empty error message (stop("")) and
leave it to whoever needs to troubleshoot to use traceback() and
debug() and/or inspect the source code.

Also, a well written error message makes it more likely that the end
user will be able to resolve the problem without asking others for
help (read r-help, the maintainer, an R savvy person that the user
happens to know, ...).  As an example of this, over at
aroma-project.org I receive fewer support emails after updating the
format of file-not-found error messages from:

  Pathname not found: R-devel/src/library/base/R/R/utils.R

to:

  Pathname not found: R-devel/src/library/base/R/R/utils.R
(R-devel/src/library/base/R/ exists, but nothing beyond; current
directory is 'x:/CRAN')


Moreover, it is not always the person who receives/reads the error
message that is the one who will resolve the problem.  In some cases
it is not even possible for that person to access the environment
where the problem occurs.  However, as a good R citizen, the more
troubleshooting you can at your end before requesting help by the
person who can take action the better.  This also makes it more likely
that the error will be resolved sooner.

As my postscript hinted to, this post originates from an error in the
'R CMD check' service ran by r-forge.r-project.org).  That particular
error is likely to occur internally in tools:::.check_packages();

 if (nzchar(libdir)) {
   setwd(libdir)
   ...
 }

where 'libdir' is an internal object, but there is no way for me (and
all the others who also see this error for their packages) to help out
with the troubleshooting.

/Henrik

>
> As you fumbled towards, it would require all the translations to be redone,
> so we don't do this sort of thing lightly.  (Redone twice if it were done
> correctly, AFAICS.)  The .pot and .po files are generated automatically, but
> not filled in automatically.  This is all in the manuals ....
>
> In any case, the correct procedure was to file an enhancement request on
> R-bugs, with a case and after testing on both platforms you are proposing to
> patch.
>
>
>
>>
>>
>> PATCH:
>>
>> % diff -u util.c "util,patch.c"
>>
>> --- util.c      2012-12-16 13:13:05.002249900 -0800
>> +++ util,patch.c        2013-01-11 11:52:16.843236400 -0800
>> @@ -696,14 +696,14 @@
>>       {
>>          const wchar_t *path = filenameToWchar(STRING_ELT(s, 0), TRUE);
>>          if(_wchdir(path) < 0)
>> -           error(_("cannot change working directory"));
>> +         error(_("cannot change working directory to '%s'"), path);
>
>
> That is a wchar_t*, so the format would need to be %ls.
>
>
>>       }
>>   #else
>>       {
>>          const char *path
>>              = R_ExpandFileName(translateChar(STRING_ELT(s, 0)));
>>       if(chdir(path) < 0)
>> -       error(_("cannot change working directory"));
>> +      error(_("cannot change working directory to '%s'"), path);
>
>
>>       }
>>   #endif
>>       return(wd);
>>
>>
>> TRANSLATIONS:
>> I have zero experience with GNU gettext/*.po files, but I understand
>> that the above change requires updates to src/library/base/*.po files,
>> which now looks like (e.g. de.po):
>>
>> #: src/main/util.c:699 src/main/util.c:706
>> msgid "cannot change working directory"
>> msgstr "kann Arbeitsverzeichnis nicht wechseln"
>>
>> A generic/automatic update would be to use the format:
>>
>> #: src/main/util.c:699 src/main/util.c:706
>> msgid "cannot change working directory: '%s'"
>> msgstr "kann Arbeitsverzeichnis nicht wechseln: '%s'"
>>
>> but I don't think that is in line with the current R style.
>>
>> /Henrik
>>
>> PS. Background for this patch:
>>
>> https://r-forge.r-project.org/tracker/index.php?func=detail&aid=2395&group_id=34&atid=194
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
>
> --
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From johannes_graumann at web.de  Sun Jan 13 09:16:57 2013
From: johannes_graumann at web.de (Johannes Graumann)
Date: Sun, 13 Jan 2013 11:16:57 +0300
Subject: [Rd] Incorporating single functions from other packages: rules and
	regulations?
Message-ID: <kctqel$eoh$1@ger.gmane.org>

Hi,

In a little pkg I'm developing I am in need of the functionality provided by 
plotrix::listDepth.

I am loath of having the depend on and import the whole package just for 
that purpose.

What is an acceptable way of integrating this functionality into my own 
package? Just copying the function and referencing it in the documentation 
appropriately?

Thanks for any hints.

Sincerely, Joh


From ripley at stats.ox.ac.uk  Sun Jan 13 12:12:02 2013
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sun, 13 Jan 2013 11:12:02 +0000
Subject: [Rd] .print.via.format not found when building r61617?
In-Reply-To: <50F07209.4030102@gmail.com>
References: <50F052EF.5070808@ufl.edu> <50F07209.4030102@gmail.com>
Message-ID: <50F29682.5080602@stats.ox.ac.uk>

No on else is having this problem, including the OS X and Windows binary 
builds and all the CRAN platforms.

I wondered if something is wrong with your collation: the function is 
defined in QC.R and used in admin.R pdftools.R sotools.R, so if admin.R 
< QC.R there would be a problem.

You could try setting LC_COLLATE=C in your environment, although the 
Makefile does that.

You really haven't shown enough output before the problem so we don't 
actually know which phase failed.


On 11/01/2013 20:11, Ben Bolker wrote:
> On 13-01-11 12:59 PM, Ben Bolker wrote:
>>    I wouldn't be at all surprised if I turned out to be doing something
>> boneheaded, but I've *tried* to follow all the relevant rules ...
>> Based on a clean SVN checkout of R-devel r61617, building in a
>> separate directory, I end up with
>>
>> Error in eval(expr, envir, enclos) : object '.print.via.format' not found
>>
>>    Has anyone encountered this or does anyone have any further
>> clues/diagnostic hints?  I found .print.via.format defined in the
>> middle of src/library/tools/all.R , and in the source in
>> src/library/tools/R/QC.R, and I see that it was added in r61322
>> (2012-12-14); is there anything else I can try?
>>
>>    Ben Bolker
>
>    PS: I did successfully build R by reverting to r61321.  I'm not sure I
> have the time and energy to do the full binary search between r61321 and
> r61617 [8 steps, rebuilding R each time] to see where it breaks.  I need
> to try to get up to r61589 or thereabouts, which is the version in which
> the tests of my package broke on the CRAN check ...
>
>    I may yet try: (1) configuring without --enable-R-shlib (I can't see
> why that would be relevant here, but it is something I'm doing that's
> slightly "non-standard" that therefore might have been missed by
> others); (2) updating to r61322 or 61323 and seeing if the breakage
> happens right there (although it's possible that something was broken in
> 61322 and fixed for everyone else thereafter, and the problem is still
> my fault -- I don't see anything obvious to that effect in the SVN log,
> but I could have missed it ...)
>>
>>> cd r-devel svn update
>>     At revision 61617.
>>> cd ../r-devel-build ../r-devel/configure --enable-R-shlib
>>
>> R is now configured for i686-pc-linux-gnu
>>
>>    Source directory:          ../r-devel
>>    Installation directory:    /usr/local
>>
>>    C compiler:                gcc -std=gnu99  -g -O2
>>    Fortran 77 compiler:       gfortran  -g -O2
>>
>>    C++ compiler:              g++  -g -O2
>>    Fortran 90/95 compiler:    gfortran -g -O2
>>    Obj-C compiler:	
>>
>>    Interfaces supported:      X11, tcltk
>>    External libraries:        readline
>>    Additional capabilities:   PNG, JPEG, NLS, cairo
>>    Options enabled:           shared R library, shared BLAS, R
>> profiling, Java
>>
>>    Recommended packages:      yes
>>
>>> make
>>
>>   ...
>>
>> make[4]: Leaving directory
>> `/mnt/hgfs/bolker/Documents/R/r-devel-build/src/library/tools'
>> Error in eval(expr, envir, enclos) : object '.print.via.format' not found
>> Error: unable to load R code in package ?tools?
>> Execution halted
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From edd at debian.org  Sun Jan 13 16:05:43 2013
From: edd at debian.org (Dirk Eddelbuettel)
Date: Sun, 13 Jan 2013 09:05:43 -0600
Subject: [Rd] Incorporating single functions from other packages: rules
	and	regulations?
In-Reply-To: <kctqel$eoh$1@ger.gmane.org>
References: <kctqel$eoh$1@ger.gmane.org>
Message-ID: <20722.52551.510334.990311@max.nulle.part>


On 13 January 2013 at 11:16, Johannes Graumann wrote:
| In a little pkg I'm developing I am in need of the functionality provided by 
| plotrix::listDepth.
| 
| I am loath of having the depend on and import the whole package just for 
| that purpose.

Step back and realize that your total R installation (including all packages)
is already much bigger than the single package. And derives value from all
those packages.

So I would use importForm(plotrix, listDepth) in my package's NAMESPACE, and
add the Imports: in the DESCRIPTION.

IMHO that is the right way to do it rather than creating _stale_ and (even
worse) _disconnected_ copies which will never receive updates or fixes from
the _original author_ of that code.

Dirk

-- 
Dirk Eddelbuettel | edd at debian.org | http://dirk.eddelbuettel.com


From sid.2311.sg at gmail.com  Sun Jan 13 18:12:24 2013
From: sid.2311.sg at gmail.com (Siddhant Gupta)
Date: Sun, 13 Jan 2013 22:42:24 +0530
Subject: [Rd] Project wanted
Message-ID: <CALHqV-cPgL-yEARmkC79+8X9qaV8A5yy0tsS8kuPKDBVAZm7qA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20130113/73648e18/attachment.pl>

From edd at debian.org  Sun Jan 13 19:12:12 2013
From: edd at debian.org (Dirk Eddelbuettel)
Date: Sun, 13 Jan 2013 12:12:12 -0600
Subject: [Rd] Project wanted
In-Reply-To: <CALHqV-cPgL-yEARmkC79+8X9qaV8A5yy0tsS8kuPKDBVAZm7qA@mail.gmail.com>
References: <CALHqV-cPgL-yEARmkC79+8X9qaV8A5yy0tsS8kuPKDBVAZm7qA@mail.gmail.com>
Message-ID: <20722.63740.231060.889324@max.nulle.part>


On 13 January 2013 at 22:42, Siddhant Gupta wrote:
| I am quite well versed in R. I can code in C++ and am currently pursuing
| biotechnology from Indian Institute of Technology, Rookee. I am looking for
| a project that I can immediately start working on and which is the need of
| the hour for R as well, so I can carry it to GSoC. Can anyone please help
| me as to how I should proceed about this?
| 
| I don't know whether I should have posted this in R-help or R-devel, but I
| have been searching online for someone to help me with this one but have
| not got a favorable response from anyone.
| 
| Looking to get a response here.

Wrong list.  

GSoC for R has its own list, and this isn't it. AFAIK the GSoC 2013 has not
yet started, it will surely be announced.

Dirk 
(past GSoC mentor and admin)

-- 
Dirk Eddelbuettel | edd at debian.org | http://dirk.eddelbuettel.com


From tim.triche at gmail.com  Sun Jan 13 21:44:31 2013
From: tim.triche at gmail.com (Tim Triche, Jr.)
Date: Sun, 13 Jan 2013 12:44:31 -0800
Subject: [Rd] Incorporating single functions from other packages: rules
 and regulations?
In-Reply-To: <20722.52551.510334.990311@max.nulle.part>
References: <kctqel$eoh$1@ger.gmane.org>
	<20722.52551.510334.990311@max.nulle.part>
Message-ID: <CAC+N9BUFa3j2AatshUF61Vy8B7_DaxEEMDUVnOtaqC7irP0p7A@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20130113/cbcfc5d1/attachment.pl>

From bbolker at gmail.com  Sun Jan 13 23:03:04 2013
From: bbolker at gmail.com (Ben Bolker)
Date: Sun, 13 Jan 2013 22:03:04 +0000
Subject: [Rd] Incorporating single functions from other packages: rules
	and regulations?
References: <kctqel$eoh$1@ger.gmane.org>
	<20722.52551.510334.990311@max.nulle.part>
	<CAC+N9BUFa3j2AatshUF61Vy8B7_DaxEEMDUVnOtaqC7irP0p7A@mail.gmail.com>
Message-ID: <loom.20130113T221531-199@post.gmane.org>

Tim Triche, Jr. <tim.triche <at> gmail.com> writes:

>  a n00b question:
> 
> if I call importFrom(IRanges, ranges) in my NAMESPACE file, that works
> great.
> but if  I call
> 
> R> importFrom(IRanges, ranges)
> ## Error: could not find function "importFrom"
> 
> well, that doesn't work great.  The closest thing I can find in base is
> 
> base:::importIntoEnv
> 
> which helpfully informs me that it is one of several
> 
> Internal namespace support functions.  Not intended to be called directly.
> 
> Where's the best place to learn about how namespaces and import/export
> facilities (particularly in R-3.0) are implemented?

   Have you tried the R Extensions manual?  That doesn't quite
answer the "how are they implemented" question, but it should
cover "how should they be used" about as thoroughly as possible.

http://obeautifulcode.com/R/How-R-Searches-And-Finds-Stuff/ may
be useful as well.

 Beyond that, you have to look at the R language manual (if at
has anything) or the source code, I think.

> On Sun, Jan 13, 2013 at 7:05 AM, Dirk Eddelbuettel <edd <at> debian.org> wrote:
> 
> >
> > On 13 January 2013 at 11:16, Johannes Graumann wrote:
> > | In a little pkg I'm developing I am in need of the functionality
> > provided by
> > | plotrix::listDepth.
> > |
> > | I am loath of having the depend on and import the whole package just for
> > | that purpose.
> >
> > Step back and realize that your total R installation (including all
> > packages)
> > is already much bigger than the single package. And derives value from all
> > those packages.
> >
> > So I would use importForm(plotrix, listDepth) in my package's NAMESPACE,
> > and
> > add the Imports: in the DESCRIPTION.
> >
> > IMHO that is the right way to do it rather than creating _stale_ and (even
> > worse) _disconnected_ copies which will never receive updates or fixes from
> > the _original author_ of that code.
> >
> > Dirk

  I agree/sympathize but can also think of cases, if the function is
short/simple enough, that it would actually make sense to copy it.
It's a judgment call, I think.

Most R packages are under sufficiently permissive licenses (plotrix is
'GPL >=2') that copying is allowed, although it would be courteous to
inform/ask permission from the author(s).

  Ben Bolker


From murdoch.duncan at gmail.com  Mon Jan 14 00:44:31 2013
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Sun, 13 Jan 2013 18:44:31 -0500
Subject: [Rd] Incorporating single functions from other packages: rules
 and regulations?
In-Reply-To: <CAC+N9BUFa3j2AatshUF61Vy8B7_DaxEEMDUVnOtaqC7irP0p7A@mail.gmail.com>
References: <kctqel$eoh$1@ger.gmane.org>
	<20722.52551.510334.990311@max.nulle.part>
	<CAC+N9BUFa3j2AatshUF61Vy8B7_DaxEEMDUVnOtaqC7irP0p7A@mail.gmail.com>
Message-ID: <50F346DF.8020301@gmail.com>

On 13-01-13 3:44 PM, Tim Triche, Jr. wrote:
>   a n00b question:
>
> if I call importFrom(IRanges, ranges) in my NAMESPACE file, that works
> great.
> but if  I call
>
> R> importFrom(IRanges, ranges)
> ## Error: could not find function "importFrom"
>
> well, that doesn't work great.

The NAMESPACE file is parsed as R code, but you should think of it as a 
bunch of declarations, not as something executable.  There's no 
importFrom() function.

If you want to do something similar at run-time, you could use

ranges <- IRanges::ranges

This creates a copy of the function you want in the current environment.


The closest thing I can find in base is
>
> base:::importIntoEnv
>
> which helpfully informs me that it is one of several
>
> Internal namespace support functions.  Not intended to be called directly.
>
>
> Where's the best place to learn about how namespaces and import/export
> facilities (particularly in R-3.0) are implemented?

Probably the source code.

Duncan Murdoch


From francois.michonneau at gmail.com  Mon Jan 14 00:34:36 2013
From: francois.michonneau at gmail.com (=?UTF-8?Q?Fran=C3=A7ois_Michonneau?=)
Date: Sun, 13 Jan 2013 18:34:36 -0500
Subject: [Rd] Regarding the recent changes to @<-
Message-ID: <CAKL30wVySBksnfovg6TxAk9tmHzu_bSc=tip7rDS4iDnA1_mbQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20130113/3f05e180/attachment.pl>

From rowe at muxspace.com  Mon Jan 14 02:43:51 2013
From: rowe at muxspace.com (Brian Lee Yung Rowe)
Date: Sun, 13 Jan 2013 20:43:51 -0500
Subject: [Rd] Issue with getParserData in R3.0.0
Message-ID: <A40C54F1-6BE4-4469-BF23-DB094A214A88@muxspace.com>

Hello,

I am migrating my package lambda.r to R3.0.0 and am experiencing some issues with the getParserData function (which replaces the parser package). Basically the function works in the R shell but fails when either called from RUnit or from R CMD check. 

I've narrowed it down to the function getSrcfile, which is returning different values depending on the code path. From the command line (works okay):

debug: srcfile <- getSrcfile(x)
Browse[2]> 
debug: if (is.null(srcfile)) return(NULL) else data <- srcfile$parseData
Browse[2]> srcfile
<text> 

When running from the Runit script I get this instead:
debug: srcfile <- getSrcfile(x)
Browse[3]> 
debug: if (is.null(srcfile)) return(NULL) else data <- srcfile$parseData
Browse[3]> srcfile
NULL


Below is an example calling the getParserData from the command line:
> text <- "abs_max(a, b) %::% numeric:numeric:numeric"
> parse(text=text)
expression(abs_max(a, b) %::% numeric:numeric:numeric)
> getParseData(parse(text=text))
   line1 col1 line2 col2 id parent                token terminal    text
27     1    1     1   42 27      0                 expr    FALSE        
14     1    1     1   13 14     27                 expr    FALSE        
1      1    1     1    7  1      3 SYMBOL_FUNCTION_CALL     TRUE abs_max
3      1    1     1    7  3     14                 expr    FALSE        
2      1    8     1    8  2     14                  '('     TRUE       (
4      1    9     1    9  4      6               SYMBOL     TRUE       a
... 

The RUnit call from the command line is
  runTestFile('/home/brian/workspace/lambda.r/inst/unitTests/runit.dispatching.4.R')

and fails because of the NULL value of srcfile. The first line of the runit test file is
  abs_max(a, b) %::% numeric:numeric:numeric

Any insights are appreciated.

Brian


From murdoch.duncan at gmail.com  Mon Jan 14 15:34:49 2013
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Mon, 14 Jan 2013 09:34:49 -0500
Subject: [Rd] Issue with getParserData in R3.0.0
In-Reply-To: <A40C54F1-6BE4-4469-BF23-DB094A214A88@muxspace.com>
References: <A40C54F1-6BE4-4469-BF23-DB094A214A88@muxspace.com>
Message-ID: <50F41789.2010408@gmail.com>

On 13-01-13 8:43 PM, Brian Lee Yung Rowe wrote:> Hello,
 >
 > I am migrating my package lambda.r to R3.0.0 and am experiencing some 
issues with the getParserData function (which replaces the parser 
package). Basically the function works in the R shell but fails when 
either called from RUnit or from R CMD check.
 >
 > I've narrowed it down to the function getSrcfile, which is returning 
different values depending on the code path. From the command line 
(works okay):
 >
 > debug: srcfile <- getSrcfile(x)
 > Browse[2]>
 > debug: if (is.null(srcfile)) return(NULL) else data <- srcfile$parseData
 > Browse[2]> srcfile
 > <text>
 >
 > When running from the Runit script I get this instead:
 > debug: srcfile <- getSrcfile(x)
 > Browse[3]>
 > debug: if (is.null(srcfile)) return(NULL) else data <- srcfile$parseData
 > Browse[3]> srcfile
 > NULL
 >
 >
 > Below is an example calling the getParserData from the command line:
 >> text <- "abs_max(a, b) %::% numeric:numeric:numeric"
 >> parse(text=text)
 > expression(abs_max(a, b) %::% numeric:numeric:numeric)
 >> getParseData(parse(text=text))
 >     line1 col1 line2 col2 id parent                token terminal    text
 > 27     1    1     1   42 27      0                 expr    FALSE
 > 14     1    1     1   13 14     27                 expr    FALSE
 > 1      1    1     1    7  1      3 SYMBOL_FUNCTION_CALL     TRUE abs_max
 > 3      1    1     1    7  3     14                 expr    FALSE
 > 2      1    8     1    8  2     14                  '('     TRUE       (
 > 4      1    9     1    9  4      6               SYMBOL     TRUE       a
 > ...
 >
 > The RUnit call from the command line is
 > 
runTestFile('/home/brian/workspace/lambda.r/inst/unitTests/runit.dispatching.4.R')
 >
 > and fails because of the NULL value of srcfile. The first line of the 
runit test file is
 >    abs_max(a, b) %::% numeric:numeric:numeric
 >
 > Any insights are appreciated.

I think in the case that is failing you just don't have any source info 
in the parse.  parse() only installs it if the "keep.source" option is 
TRUE, and the default for that is the result of interactive().  So when 
you are not interactive you don't get source info.

You can fix it by explicitly setting options(keep.source=TRUE).

Duncan Murdoch


From jmc at r-project.org  Mon Jan 14 18:54:27 2013
From: jmc at r-project.org (John Chambers)
Date: Mon, 14 Jan 2013 09:54:27 -0800
Subject: [Rd] Regarding the recent changes to @<-
In-Reply-To: <CAKL30wVySBksnfovg6TxAk9tmHzu_bSc=tip7rDS4iDnA1_mbQ@mail.gmail.com>
References: <CAKL30wVySBksnfovg6TxAk9tmHzu_bSc=tip7rDS4iDnA1_mbQ@mail.gmail.com>
Message-ID: <BD5840E9-B37B-4ACC-B61F-60C45712EFF4@r-project.org>

Thanks.  No need for a complicated example actually:

> C1 <- setClass("C1", slots = c(x = "numeric"))
> c1 <- C1()
> c1 at x <- "Hello"
> validObject(c1)
Error in validObject(c1) : 
  invalid class "C1" object: invalid object for slot "x" in class "C1": got class "character", should be or extend class "numeric"

In making @<- substantially more efficient in r-devel, we lost some error checking.  That's too efficient.

This will be fixed, but given that code has migrated from an R function to C and that I'm not currently at home, it may take a little while.

John


On Jan 13, 2013, at 3:34 PM, Fran?ois Michonneau wrote:

> Hello all,
> 
>  In one of the packages (phylobase) I'm contributing to, we define a class
> as follows:
> 
> setClass("phylo4",
>         representation(edge = "matrix",
>                        edge.length = "numeric",
>                        label = "character",
>                        edge.label = "character",
>                        order = "character",
>                        annote = "list"),
>         prototype = list(
>                        edge = matrix(nrow = 0, ncol = 2,
>                            dimname = list(NULL, c("ancestor",
> "descendant"))),
>                        edge.length = numeric(0),
>                        label = character(0),
>                        edge.label = character(0),
>                        order = "unknown",
>                        annote = list()
>                       ),
>         validity = checkPhylo4)
> 
>  Using today's SVN checkout (r61643), building an object of the class
> 'phylo4' like this:
> 
> phylo4(foo, annote="bar")
> 
>  doesn't return an error as it used to (given that annote is not a list).
> 
>  What is now the preferred way of checking that annote is a actually a
> list?
> 
>  Thanks,
>  -- Fran?ois
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From francois.michonneau at gmail.com  Mon Jan 14 19:00:40 2013
From: francois.michonneau at gmail.com (=?UTF-8?Q?Fran=C3=A7ois_Michonneau?=)
Date: Mon, 14 Jan 2013 13:00:40 -0500
Subject: [Rd] Regarding the recent changes to @<-
In-Reply-To: <BD5840E9-B37B-4ACC-B61F-60C45712EFF4@r-project.org>
References: <CAKL30wVySBksnfovg6TxAk9tmHzu_bSc=tip7rDS4iDnA1_mbQ@mail.gmail.com>
	<BD5840E9-B37B-4ACC-B61F-60C45712EFF4@r-project.org>
Message-ID: <CAKL30wXOs5ivKHdjguR_Aj9UQoMECz40J3DjvoK9nzzBGBKEfw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20130114/f4583530/attachment.pl>

From ingobulla at gmail.com  Mon Jan 14 19:07:51 2013
From: ingobulla at gmail.com (mullahmohammedomar)
Date: Mon, 14 Jan 2013 10:07:51 -0800 (PST)
Subject: [Rd] debug package calling C++ code using valgrind
Message-ID: <1358186871660-4655507.post@n4.nabble.com>

Hi,

I am trying to debug a package which I helped to develop since we were
notified by CRAN that our package randomly fails to run its examples. Hence,
I reinstalled R with "with-valgrind-instrumentation=2" and installed our
package with 

MAKEFLAGS="CFLAGS='-O0 -g3' CXXFLAGS='-O0 -g3'" R CMD INSTALL --build hsmm

Then, I ran the examples of our package with

R -d "valgrind --tool=memcheck" --vanilla < hsmm.Rcheck/hsmm-Ex.R

and got the following output:  out.txt
<http://r.789695.n4.nabble.com/file/n4655507/out.txt>  

Unfortunately, this does not match the error messages from valgrind we were
provided by CRAN:  hsmm-Ex.Rout
<http://r.789695.n4.nabble.com/file/n4655507/hsmm-Ex.Rout>  

In particular, the run by CRAN yielded lots of accesses to uninitialized
variables within the C++ code of the package, whereas I do not get any error
message with regards to the C++ code.

Does anyone know what I am doing wrong?




--
View this message in context: http://r.789695.n4.nabble.com/debug-package-calling-C-code-using-valgrind-tp4655507.html
Sent from the R devel mailing list archive at Nabble.com.


From maechler at stat.math.ethz.ch  Mon Jan 14 19:39:10 2013
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Mon, 14 Jan 2013 19:39:10 +0100
Subject: [Rd] Regarding the recent changes to @<-
In-Reply-To: <CAKL30wVySBksnfovg6TxAk9tmHzu_bSc=tip7rDS4iDnA1_mbQ@mail.gmail.com>
References: <CAKL30wVySBksnfovg6TxAk9tmHzu_bSc=tip7rDS4iDnA1_mbQ@mail.gmail.com>
Message-ID: <20724.20686.556286.756858@stat.math.ethz.ch>

>>>>> Fran?ois Michonneau <francois.michonneau at gmail.com>
>>>>>     on Sun, 13 Jan 2013 18:34:36 -0500 writes:

    > Hello all,
    > In one of the packages (phylobase) I'm contributing to, we define a class
    > as follows:


> setClass("phylo4",
>          representation(edge = "matrix",
>                         edge.length = "numeric",
>                         label = "character",
>                         edge.label = "character",
>                         order = "character",
>                         annote = "list"),
>          prototype = list(
>                         edge = matrix(nrow = 0, ncol = 2,
>                             dimname = list(NULL, c("ancestor",
> "descendant"))),
>                         edge.length = numeric(0),
>                         label = character(0),
>                         edge.label = character(0),
>                         order = "unknown",
>                         annote = list()
>                        ),
>          validity = checkPhylo4)

>   Using today's SVN checkout (r61643), building an object of the class
> 'phylo4' like this:

> phylo4(foo, annote="bar")

>   doesn't return an error as it used to (given that annote is not a list).

Well, the above is not reproducible
{foo  and  checkPhylo4   are missing !}.

If I make it reproducible,
it does work, i.e., give an error for me (rev 61644):

phylo4 <- setClass("phylo4",
         representation(edge = "matrix",
                        edge.length = "numeric",
                        label = "character",
                        edge.label = "character",
                        order = "character",
                        annote = "list"),
         prototype = list(edge = matrix(nrow = 0, ncol = 2,
                                        dimnames = list(NULL,
                                        c("ancestor", "descendant"))),
                          edge.length = numeric(0),
                          label = character(0),
                          edge.label = character(0),
                          order = "unknown",
                          annote = list()
         )
         )##               ),
         ## validity = checkPhylo4)

foo <- phylo4()
phylo4(foo, annote="bar")

-----------

Gives

Error in validObject(.Object) : 
  invalid class "phylo4" object: invalid object for slot "annote" in class "phylo4": got class "character", should be or extend class "list"

as it should.

Can you try providing a simple reproducible example?


>   What is now the preferred way of checking that annote is a actually a
> list?

>   Thanks,
>   -- Fran?ois

> 	[[alternative HTML version deleted]]


From francois.michonneau at gmail.com  Mon Jan 14 19:59:31 2013
From: francois.michonneau at gmail.com (=?UTF-8?Q?Fran=C3=A7ois_Michonneau?=)
Date: Mon, 14 Jan 2013 13:59:31 -0500
Subject: [Rd] Regarding the recent changes to @<-
In-Reply-To: <20724.20686.556286.756858@stat.math.ethz.ch>
References: <CAKL30wVySBksnfovg6TxAk9tmHzu_bSc=tip7rDS4iDnA1_mbQ@mail.gmail.com>
	<20724.20686.556286.756858@stat.math.ethz.ch>
Message-ID: <CAKL30wWzneLOehKrFT1Spk6bWZSjpQmERCpMYRCRsXLt=SBDcw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20130114/5a4d9f6d/attachment.pl>

From oliver at first.in-berlin.de  Mon Jan 14 21:29:33 2013
From: oliver at first.in-berlin.de (oliver)
Date: Mon, 14 Jan 2013 21:29:33 +0100
Subject: [Rd] Who does develop the R core and libs,
	and how / where is it hosted?
Message-ID: <20130114202932.GA1806@siouxsie>

Hello,

I saw Binaries, stable release-souzrces and daily snapshots of R, but
not something like a repository, visible for the public (like on githb for example).

How is the R development handled, what repositories / source code versioning tools
are used, who are the developers?

And is there something like a plan with future goals,
which are planned for the next releases?

Are there areas, where help is needed?
And in which way could support be done?


Ciao,
   Oliver


From josh.m.ulrich at gmail.com  Mon Jan 14 21:38:53 2013
From: josh.m.ulrich at gmail.com (Joshua Ulrich)
Date: Mon, 14 Jan 2013 14:38:53 -0600
Subject: [Rd] Who does develop the R core and libs,
	and how / where is it hosted?
In-Reply-To: <20130114202932.GA1806@siouxsie>
References: <20130114202932.GA1806@siouxsie>
Message-ID: <CAPPM_gQwd9ssv625wQQkCB6k+ev1SVSE2meDMGTi09TZmHZ-hA@mail.gmail.com>

On Mon, Jan 14, 2013 at 2:29 PM, oliver <oliver at first.in-berlin.de> wrote:
> Hello,
>
> I saw Binaries, stable release-souzrces and daily snapshots of R, but
> not something like a repository, visible for the public (like on githb for example).
>
Go to http://www.r-project.org and click the "Developer Page" link in
the left-hand column.

> How is the R development handled, what repositories / source code versioning tools
> are used, who are the developers?
>
Ibid, and
Go to http://www.r-project.org and click the "Contributors" link in
the left-hand column.

> And is there something like a plan with future goals,
> which are planned for the next releases?
>
> Are there areas, where help is needed?
> And in which way could support be done?
>
>
> Ciao,
>    Oliver
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From simon.urbanek at r-project.org  Mon Jan 14 21:50:04 2013
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Mon, 14 Jan 2013 15:50:04 -0500
Subject: [Rd] Who does develop the R core and libs,
	and how / where is it hosted?
In-Reply-To: <20130114202932.GA1806@siouxsie>
References: <20130114202932.GA1806@siouxsie>
Message-ID: <828A41A8-186F-4601-8D0E-C52CCA6F5162@r-project.org>

On Jan 14, 2013, at 3:29 PM, oliver wrote:

> Hello,
> 
> I saw Binaries, stable release-souzrces and daily snapshots of R, but
> not something like a repository, visible for the public (like on githb for example).
> 

Ehm, I would expect a bit better from someone who is on the list for several years ;) - the reading the docs - in particular you'll find answers to most of your questions in the FAQ ...


> How is the R development handled, what repositories / source code versioning tools
> are used, who are the developers?
> 
> And is there something like a plan with future goals,
> which are planned for the next releases?
> 

See developer.r-project.org, other than that features are typically announced in NEWS as they are being implemented.


> Are there areas, where help is needed?

If you have someone with a good R knowledge, check out the wish list.


> And in which way could support be done?
> 

Write good packages, provide patches to R, donate to R foundation?

Cheers,
Simon


From hpages at fhcrc.org  Mon Jan 14 22:14:53 2013
From: hpages at fhcrc.org (=?ISO-8859-1?Q?Herv=E9_Pag=E8s?=)
Date: Mon, 14 Jan 2013 13:14:53 -0800
Subject: [Rd] Patch for setwd() to show path in error message
In-Reply-To: <CAFDcVCRCHnyW3=xk6N5z35KtvMcAM9y+iE-geJ9TTRKF+ruf2w@mail.gmail.com>
References: <CAFDcVCSbs3nh_Lnc8xi0RhHpL4WS=QpSakyD+ERyUU7nv-H68Q@mail.gmail.com>
	<50F1056E.4050207@stats.ox.ac.uk>
	<CAFDcVCRCHnyW3=xk6N5z35KtvMcAM9y+iE-geJ9TTRKF+ruf2w@mail.gmail.com>
Message-ID: <50F4754D.6070705@fhcrc.org>

Hi,

Of course we all want better error messages. What's the point of trying
to make a case against that?

Even the cd Unix command (a shell built-in in that case) -- and Unix
commands are known for their lack of verbosity and minimalist error
messages -- manages to report something informative:

   hpages at thinkpad:~$ cd /aaa/bbb
   bash: cd: /aaa/bbb: No such file or directory

There is an important difference between being "minimalist" and
"uninformative". The former is ok, not the latter.

Henrik's request makes a lot of sense.

Thanks,
H.


On 01/12/2013 11:21 AM, Henrik Bengtsson wrote:
> On Fri, Jan 11, 2013 at 10:40 PM, Prof Brian Ripley
> <ripley at stats.ox.ac.uk> wrote:
>> On 11/01/2013 20:22, Henrik Bengtsson wrote:
>>>
>>> Below is a patch for setwd() to show path in error message.  Current
>>> it just gives error messages such as:
>>>
>>> Error in setwd(libdir) : cannot change working directory
>>>
>>> with the patch it should (read untested) give:
>>>
>>> Error in setwd(libdir) : cannot change working directory to
>>> 'path/that/fails/'
>>
>>
>> And why is this needed?  You know it is 'libdir' and could check what that
>> was (or if doing this programatically, check its existence first).
>
> Risking to state the obvious:
>
> To me, the main purpose of error messages is to make troubleshooting
> easier. The more informative the error message is, the easier it is to
> troubleshoot and the faster the origin of the error can be resolved.
> The other extreme is to provide an empty error message (stop("")) and
> leave it to whoever needs to troubleshoot to use traceback() and
> debug() and/or inspect the source code.
>
> Also, a well written error message makes it more likely that the end
> user will be able to resolve the problem without asking others for
> help (read r-help, the maintainer, an R savvy person that the user
> happens to know, ...).  As an example of this, over at
> aroma-project.org I receive fewer support emails after updating the
> format of file-not-found error messages from:
>
>    Pathname not found: R-devel/src/library/base/R/R/utils.R
>
> to:
>
>    Pathname not found: R-devel/src/library/base/R/R/utils.R
> (R-devel/src/library/base/R/ exists, but nothing beyond; current
> directory is 'x:/CRAN')
>
>
> Moreover, it is not always the person who receives/reads the error
> message that is the one who will resolve the problem.  In some cases
> it is not even possible for that person to access the environment
> where the problem occurs.  However, as a good R citizen, the more
> troubleshooting you can at your end before requesting help by the
> person who can take action the better.  This also makes it more likely
> that the error will be resolved sooner.
>
> As my postscript hinted to, this post originates from an error in the
> 'R CMD check' service ran by r-forge.r-project.org).  That particular
> error is likely to occur internally in tools:::.check_packages();
>
>   if (nzchar(libdir)) {
>     setwd(libdir)
>     ...
>   }
>
> where 'libdir' is an internal object, but there is no way for me (and
> all the others who also see this error for their packages) to help out
> with the troubleshooting.
>
> /Henrik
>
>>
>> As you fumbled towards, it would require all the translations to be redone,
>> so we don't do this sort of thing lightly.  (Redone twice if it were done
>> correctly, AFAICS.)  The .pot and .po files are generated automatically, but
>> not filled in automatically.  This is all in the manuals ....
>>
>> In any case, the correct procedure was to file an enhancement request on
>> R-bugs, with a case and after testing on both platforms you are proposing to
>> patch.
>>
>>
>>
>>>
>>>
>>> PATCH:
>>>
>>> % diff -u util.c "util,patch.c"
>>>
>>> --- util.c      2012-12-16 13:13:05.002249900 -0800
>>> +++ util,patch.c        2013-01-11 11:52:16.843236400 -0800
>>> @@ -696,14 +696,14 @@
>>>        {
>>>           const wchar_t *path = filenameToWchar(STRING_ELT(s, 0), TRUE);
>>>           if(_wchdir(path) < 0)
>>> -           error(_("cannot change working directory"));
>>> +         error(_("cannot change working directory to '%s'"), path);
>>
>>
>> That is a wchar_t*, so the format would need to be %ls.
>>
>>
>>>        }
>>>    #else
>>>        {
>>>           const char *path
>>>               = R_ExpandFileName(translateChar(STRING_ELT(s, 0)));
>>>        if(chdir(path) < 0)
>>> -       error(_("cannot change working directory"));
>>> +      error(_("cannot change working directory to '%s'"), path);
>>
>>
>>>        }
>>>    #endif
>>>        return(wd);
>>>
>>>
>>> TRANSLATIONS:
>>> I have zero experience with GNU gettext/*.po files, but I understand
>>> that the above change requires updates to src/library/base/*.po files,
>>> which now looks like (e.g. de.po):
>>>
>>> #: src/main/util.c:699 src/main/util.c:706
>>> msgid "cannot change working directory"
>>> msgstr "kann Arbeitsverzeichnis nicht wechseln"
>>>
>>> A generic/automatic update would be to use the format:
>>>
>>> #: src/main/util.c:699 src/main/util.c:706
>>> msgid "cannot change working directory: '%s'"
>>> msgstr "kann Arbeitsverzeichnis nicht wechseln: '%s'"
>>>
>>> but I don't think that is in line with the current R style.
>>>
>>> /Henrik
>>>
>>> PS. Background for this patch:
>>>
>>> https://r-forge.r-project.org/tracker/index.php?func=detail&aid=2395&group_id=34&atid=194
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>
>>
>> --
>> Brian D. Ripley,                  ripley at stats.ox.ac.uk
>> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
>> University of Oxford,             Tel:  +44 1865 272861 (self)
>> 1 South Parks Road,                     +44 1865 272866 (PA)
>> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M1-B514
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fhcrc.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From jmc at r-project.org  Mon Jan 14 22:18:26 2013
From: jmc at r-project.org (John Chambers)
Date: Mon, 14 Jan 2013 13:18:26 -0800
Subject: [Rd] Regarding the recent changes to @<-
In-Reply-To: <CAKL30wWzneLOehKrFT1Spk6bWZSjpQmERCpMYRCRsXLt=SBDcw@mail.gmail.com>
References: <CAKL30wVySBksnfovg6TxAk9tmHzu_bSc=tip7rDS4iDnA1_mbQ@mail.gmail.com>
	<20724.20686.556286.756858@stat.math.ethz.ch>
	<CAKL30wWzneLOehKrFT1Spk6bWZSjpQmERCpMYRCRsXLt=SBDcw@mail.gmail.com>
Message-ID: <0ABC5811-D0AD-4EC6-8EB6-60A1A6EF5BE0@r-project.org>

My guess is that the distinction here is between `@<-` and `slot<-`.

The first, but not the second, has been converted to a primitive (the second has an optional argument, making it more of a nuisance to implement.)

Previously they did the same check; after the revision of `@<-` they did not; after a (fairly soon) new revision they will again.

John

On Jan 14, 2013, at 10:59 AM, Fran?ois Michonneau wrote:

> Hello Martin,
> 
>  Below is a reduced version of our code that doesn't produce an error in
> r61643 but does in 2.15.2.
> 
>  Thanks,
>  -- Fran?ois
> 
> setClass("phylo4",
>         representation(edge="matrix",
>                        annote="list"),
>         prototype = list(edge = matrix(nrow = 0, ncol = 2),
>                        annote = list())
> )
> 
> setGeneric("phylo4", function(x, ...) { standardGeneric("phylo4")} )
> 
> setMethod("phylo4", "matrix",
>    function(x, annote = list()) {
>    res <- new("phylo4")
>        res at edge <- x
>        res at annote <- annote
>        res
>    }
> )
> 
> edge <- structure(c(6L, 7L, 8L, 8L, 9L, 9L, 7L, 6L, 7L, 8L, 1L, 9L,
>      2L, 3L, 4L, 5L), .Dim = c(8, 2))
> phylo4(edge, annote="foo")
> 
> 
> 
> 
> On Mon, Jan 14, 2013 at 1:39 PM, Martin Maechler <maechler at stat.math.ethz.ch
>> wrote:
> 
>> phylo4 <- setClass("phylo4",
>>         representation(edge = "matrix",
>>                        edge.length = "numeric",
>>                        label = "character",
>>                        edge.label = "character",
>>                        order = "character",
>>                        annote = "list"),
>>         prototype = list(edge = matrix(nrow = 0, ncol = 2,
>>                                        dimnames = list(NULL,
>>                                        c("ancestor", "descendant"))),
>>                          edge.length = numeric(0),
>>                          label = character(0),
>>                          edge.label = character(0),
>>                          order = "unknown",
>>                          annote = list()
>>         )
>> 
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From oliver at first.in-berlin.de  Tue Jan 15 00:32:21 2013
From: oliver at first.in-berlin.de (oliver)
Date: Tue, 15 Jan 2013 00:32:21 +0100
Subject: [Rd] Who does develop the R core and libs,
 and how / where is it hosted?
In-Reply-To: <828A41A8-186F-4601-8D0E-C52CCA6F5162@r-project.org>
References: <20130114202932.GA1806@siouxsie>
	<828A41A8-186F-4601-8D0E-C52CCA6F5162@r-project.org>
Message-ID: <20130114233221.GC26703@siouxsie>

On Mon, Jan 14, 2013 at 03:50:04PM -0500, Simon Urbanek wrote:
> On Jan 14, 2013, at 3:29 PM, oliver wrote:
> 
> > Hello,
> > 
> > I saw Binaries, stable release-souzrces and daily snapshots of R, but
> > not something like a repository, visible for the public (like on githb for example).
> > 
> 
> Ehm, I would expect a bit better from someone who is on the list for several
> years ;) - the reading the docs - in particular you'll find answers to most of
> your questions in the FAQ ...
[...]

Well, most often, I just save the mailinglist postings into the folder where it belongs to...
(Less than even lurking, only sometimes reading some postings.)


...and... when I'm not involved in a task, things start to disappear in from mind.
Much traffic in my inbox ;-)

Also I thought, sending a direct question might trigger certain responses.
There are much FAQs around in the web.
A FAQ is less direct, and just one of the many text documents around...

Something like "Future plans in development of R" I would not await to be inside a FAQ.


> 
> 
> > How is the R development handled, what repositories / source code versioning tools
> > are used, who are the developers?
> > 
> > And is there something like a plan with future goals,
> > which are planned for the next releases?
> > 
> 
> See developer.r-project.org, other than that features are typically announced in NEWS as they are being implemented.

Future goals I would expect not being part of NEWS.
NEWS is like "what we already have done", not "what our future plans are".

> 
> 
> > Are there areas, where help is needed?
> 
> If you have someone with a good R knowledge, check out the wish list.

OK, wish list seems to be the right thing.


> 
> 
> > And in which way could support be done?
> > 
> 
> Write good packages, provide patches to R, donate to R foundation?
[...]


"Good packages" might be good (in quality), but not necessarily give
the R project a boost, if only a handful of users would need such a package.

Providing patches maybe would make sense to me.

Donate to R foundation? Hmhh, I would rather donate with via source code.



BTW: I looked up the string "wish list" in some of the mentioned docs (mentioned in this thread)
     but did not found it.
     Can you please point me to it directly?
     Googling for "R wish list" brings me links to a producer of toys.

     Or did you mean I should ask R users for their wishes??!

     (Some R users - on this list - asked for Julia language as a speedup alternative for R a while ago...)
      

Thanks for the response.

All in all it seems like no special things need to be done.
The FSF for example has a page where they ask for support in certain areas,
so, this looks rather urgent.
R seems not to have such urgent needs for support....

=> Question answered.

Ciao,
   Oliver


From rowe at muxspace.com  Tue Jan 15 01:11:14 2013
From: rowe at muxspace.com (Brian Lee Yung Rowe)
Date: Mon, 14 Jan 2013 19:11:14 -0500
Subject: [Rd] Who does develop the R core and libs,
	and how / where is it hosted?
In-Reply-To: <20130114233221.GC26703@siouxsie>
References: <20130114202932.GA1806@siouxsie>
	<828A41A8-186F-4601-8D0E-C52CCA6F5162@r-project.org>
	<20130114233221.GC26703@siouxsie>
Message-ID: <B6006DD8-7079-4D6C-B64D-25074375B91E@muxspace.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20130114/8e637c5f/attachment.pl>

From rowe at muxspace.com  Tue Jan 15 01:49:53 2013
From: rowe at muxspace.com (Brian Lee Yung Rowe)
Date: Mon, 14 Jan 2013 19:49:53 -0500
Subject: [Rd] Issue with getParserData in R3.0.0
In-Reply-To: <50F41789.2010408@gmail.com>
References: <A40C54F1-6BE4-4469-BF23-DB094A214A88@muxspace.com>
	<50F41789.2010408@gmail.com>
Message-ID: <95568799-1BFA-4830-9D77-7D2C343F983A@muxspace.com>

Thanks that seems to work. It looks like other packages explicitly change this to FALSE, so I have to set this to TRUE for each function call. Is there any particular policy for packages that update this option? Should I restore the original value upon function exit?

Warm Regards,
Brian


On Jan 14, 2013, at 9:34 AM, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:

> On 13-01-13 8:43 PM, Brian Lee Yung Rowe wrote:> Hello,
> >
> > I am migrating my package lambda.r to R3.0.0 and am experiencing some issues with the getParserData function (which replaces the parser package). Basically the function works in the R shell but fails when either called from RUnit or from R CMD check.
> >
> > I've narrowed it down to the function getSrcfile, which is returning different values depending on the code path. From the command line (works okay):
> >
> > debug: srcfile <- getSrcfile(x)
> > Browse[2]>
> > debug: if (is.null(srcfile)) return(NULL) else data <- srcfile$parseData
> > Browse[2]> srcfile
> > <text>
> >
> > When running from the Runit script I get this instead:
> > debug: srcfile <- getSrcfile(x)
> > Browse[3]>
> > debug: if (is.null(srcfile)) return(NULL) else data <- srcfile$parseData
> > Browse[3]> srcfile
> > NULL
> >
> >
> > Below is an example calling the getParserData from the command line:
> >> text <- "abs_max(a, b) %::% numeric:numeric:numeric"
> >> parse(text=text)
> > expression(abs_max(a, b) %::% numeric:numeric:numeric)
> >> getParseData(parse(text=text))
> >     line1 col1 line2 col2 id parent                token terminal    text
> > 27     1    1     1   42 27      0                 expr    FALSE
> > 14     1    1     1   13 14     27                 expr    FALSE
> > 1      1    1     1    7  1      3 SYMBOL_FUNCTION_CALL     TRUE abs_max
> > 3      1    1     1    7  3     14                 expr    FALSE
> > 2      1    8     1    8  2     14                  '('     TRUE       (
> > 4      1    9     1    9  4      6               SYMBOL     TRUE       a
> > ...
> >
> > The RUnit call from the command line is
> > runTestFile('/home/brian/workspace/lambda.r/inst/unitTests/runit.dispatching.4.R')
> >
> > and fails because of the NULL value of srcfile. The first line of the runit test file is
> >    abs_max(a, b) %::% numeric:numeric:numeric
> >
> > Any insights are appreciated.
> 
> I think in the case that is failing you just don't have any source info in the parse.  parse() only installs it if the "keep.source" option is TRUE, and the default for that is the result of interactive().  So when you are not interactive you don't get source info.
> 
> You can fix it by explicitly setting options(keep.source=TRUE).
> 
> Duncan Murdoch
> 


From oliver at first.in-berlin.de  Tue Jan 15 01:55:09 2013
From: oliver at first.in-berlin.de (Oliver Bandel)
Date: Tue, 15 Jan 2013 01:55:09 +0100
Subject: [Rd] Who does develop the R core and libs,
	and how / where is it hosted?
In-Reply-To: <B6006DD8-7079-4D6C-B64D-25074375B91E@muxspace.com>
References: <20130114202932.GA1806@siouxsie>
	<828A41A8-186F-4601-8D0E-C52CCA6F5162@r-project.org>
	<20130114233221.GC26703@siouxsie>
	<B6006DD8-7079-4D6C-B64D-25074375B91E@muxspace.com>
Message-ID: <C2660820-4B80-438A-B66E-E01CE5D25D20@first.in-berlin.de>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20130115/f66c518e/attachment.pl>

From rowe at muxspace.com  Tue Jan 15 02:01:26 2013
From: rowe at muxspace.com (Brian Lee Yung Rowe)
Date: Mon, 14 Jan 2013 20:01:26 -0500
Subject: [Rd] Who does develop the R core and libs,
	and how / where is it hosted?
In-Reply-To: <C2660820-4B80-438A-B66E-E01CE5D25D20@first.in-berlin.de>
References: <20130114202932.GA1806@siouxsie>
	<828A41A8-186F-4601-8D0E-C52CCA6F5162@r-project.org>
	<20130114233221.GC26703@siouxsie>
	<B6006DD8-7079-4D6C-B64D-25074375B91E@muxspace.com>
	<C2660820-4B80-438A-B66E-E01CE5D25D20@first.in-berlin.de>
Message-ID: <22D0D509-A1DD-4365-BB2C-225D9AF2C90C@muxspace.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20130114/acfe959d/attachment.pl>

From simon.urbanek at r-project.org  Tue Jan 15 02:04:13 2013
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Mon, 14 Jan 2013 20:04:13 -0500
Subject: [Rd] Who does develop the R core and libs,
	and how / where is it hosted?
In-Reply-To: <C2660820-4B80-438A-B66E-E01CE5D25D20@first.in-berlin.de>
References: <20130114202932.GA1806@siouxsie>
	<828A41A8-186F-4601-8D0E-C52CCA6F5162@r-project.org>
	<20130114233221.GC26703@siouxsie>
	<B6006DD8-7079-4D6C-B64D-25074375B91E@muxspace.com>
	<C2660820-4B80-438A-B66E-E01CE5D25D20@first.in-berlin.de>
Message-ID: <72E32EE0-FAC7-4A4A-A6D8-926A862B3D64@r-project.org>

On Jan 14, 2013, at 7:55 PM, Oliver Bandel wrote:

> 
> 
> Am 15.01.2013 um 01:11 schrieb Brian Lee Yung Rowe <rowe at muxspace.com>:
> 
>> 
>> On Jan 14, 2013, at 6:32 PM, oliver <oliver at first.in-berlin.de> wrote:
>> 
>>> BTW: I looked up the string "wish list" in some of the mentioned docs (mentioned in this thread)
>>>     but did not found it.
>>>     Can you please point me to it directly?
>>>     Googling for "R wish list" brings me links to a producer of toys.
>>> 
>>>     Or did you mean I should ask R users for their wishes??!
>>> 
>>>     (Some R users - on this list - asked for Julia language as a speedup alternative for R a while ago?)
>> 
>> Is this what you're looking for: http://developer.r-project.org/ (see TODO lists)
> 
> Ah, yes,there are TODO lists, thanks.
> 
> This is at least some kind of thing yi was looking for.
> But these are personell TODO lists.
> Are their any goals for R as whole project?
> 
> 
> 
>> 
>> 
>>> All in all it seems like no special things need to be done.
>>> The FSF for example has a page where they ask for support in certain areas,
>>> so, this looks rather urgent.
>>> R seems not to have such urgent needs for support....
>> 
>> How about cleaning up some of the documentation/wiki pages?
> 
> I'm not a friend of seperating design, coding, documentation, ...
> 
> IMHO this should be something that is not seperated.
> And I also think, that the way, R packages will be written
> (code as well as documentation together) uses the same
> kind of philosophy.
> I was very happy about this close relation between code and
> documentation,mthat is necessary to wrte a package.
> 
> I thought the same holds true for R project as a whole.
> So I maybe was wrong with this assumption.
> 

Actually, it does hold true - all R documentation is part of the R sources.

Maybe it's a sign of a relative maturity of R that we don't have a particular "milestone"-like agenda. Typically, most things can be supplied as packages - the only reason to touch the core of R itself is if it is something that cannot be done as a package, and given R's modularity that is fortunately not very often the case.

Cheers,
Simon


From drf28 at cornell.edu  Tue Jan 15 03:50:44 2013
From: drf28 at cornell.edu (Daniel Fuka)
Date: Mon, 14 Jan 2013 21:50:44 -0500
Subject: [Rd] Mac libgfortran.2.dylib
Message-ID: <CAB9w6XzcJM495Rr3q_eFJrUrgArZLeqPMAG3bLczO8PWypPpmA@mail.gmail.com>

Howdy,

I was under the impression that CRAN took care of automagically making
sure the CRAN compiled fortran was linked to the fortran libs
distributed in R binaries. Today was the first day I was on a mac
without Xcode and found my fortran based package has issues, which
appears only on the mac. Do we need to have a special compile library
path set in the Makefile to direct CRAN to the R distributed fortram
libraries? My case may be semi-unique as I am having CRAN compile
executables that are system calls from my R scripts rather than
libraries.

Example Code on OSX/Mac:
install.packages("SWATmodel",repos="http://cran.r-project.org")
library("SWATmodel")
testSWAT2005()

dyld: Library not loaded: /usr/local/lib/libgfortran.2.dylib
  Referenced from:
/Library/Frameworks/R.framework/Versions/2.15/Resources/library/SWATmodel/libs/x86_64/rswat2005.exe
  Reason: image not found

I have seen many of the posts on this, but those appear to be centered
around R-Forge or other distributed compiles, and the Mac FAQ appears
to say this is taken care of with CRAN distributed packages:
"...CRAN we make an effort to modify the binaries such that they work
even without the tools they have been compiled with. There are several
possible approaches, but since R itself already uses the same Fortran,
we ship a copy of the Fortran libraries inside R and modify packages
such that they use it instead of the one from developer tools."

Thanks for your time on my behalf,
Daniel Fuka


From simon.urbanek at r-project.org  Tue Jan 15 04:41:39 2013
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Mon, 14 Jan 2013 22:41:39 -0500
Subject: [Rd] Mac libgfortran.2.dylib
In-Reply-To: <CAB9w6XzcJM495Rr3q_eFJrUrgArZLeqPMAG3bLczO8PWypPpmA@mail.gmail.com>
References: <CAB9w6XzcJM495Rr3q_eFJrUrgArZLeqPMAG3bLczO8PWypPpmA@mail.gmail.com>
Message-ID: <8332588D-DC47-48A2-AB24-51348BBE700F@r-project.org>

Daniel,

CRAN only post-processes libraries (dylib/jnilib) and dynamic objects (.so) in packages. However, you seem to have executables (.exe -- really? this not Windows :P) inside your package and those do not get processed. I can add .exe to the list of processed files - that should help in your case although it's a bit unusual...

Cheers,
Simon


On Jan 14, 2013, at 9:50 PM, Daniel Fuka wrote:

> Howdy,
> 
> I was under the impression that CRAN took care of automagically making
> sure the CRAN compiled fortran was linked to the fortran libs
> distributed in R binaries. Today was the first day I was on a mac
> without Xcode and found my fortran based package has issues, which
> appears only on the mac. Do we need to have a special compile library
> path set in the Makefile to direct CRAN to the R distributed fortram
> libraries? My case may be semi-unique as I am having CRAN compile
> executables that are system calls from my R scripts rather than
> libraries.
> 
> Example Code on OSX/Mac:
> install.packages("SWATmodel",repos="http://cran.r-project.org")
> library("SWATmodel")
> testSWAT2005()
> 
> dyld: Library not loaded: /usr/local/lib/libgfortran.2.dylib
>  Referenced from:
> /Library/Frameworks/R.framework/Versions/2.15/Resources/library/SWATmodel/libs/x86_64/rswat2005.exe
>  Reason: image not found
> 
> I have seen many of the posts on this, but those appear to be centered
> around R-Forge or other distributed compiles, and the Mac FAQ appears
> to say this is taken care of with CRAN distributed packages:
> "...CRAN we make an effort to modify the binaries such that they work
> even without the tools they have been compiled with. There are several
> possible approaches, but since R itself already uses the same Fortran,
> we ship a copy of the Fortran libraries inside R and modify packages
> such that they use it instead of the one from developer tools."
> 
> Thanks for your time on my behalf,
> Daniel Fuka
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 


From murdoch.duncan at gmail.com  Tue Jan 15 12:55:33 2013
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Tue, 15 Jan 2013 06:55:33 -0500
Subject: [Rd] Issue with getParserData in R3.0.0
In-Reply-To: <95568799-1BFA-4830-9D77-7D2C343F983A@muxspace.com>
References: <A40C54F1-6BE4-4469-BF23-DB094A214A88@muxspace.com>
	<50F41789.2010408@gmail.com>
	<95568799-1BFA-4830-9D77-7D2C343F983A@muxspace.com>
Message-ID: <50F543B5.6060205@gmail.com>

On 13-01-14 7:49 PM, Brian Lee Yung Rowe wrote:
> Thanks that seems to work. It looks like other packages explicitly change this to FALSE, so I have to set this to TRUE for each function call. Is there any particular policy for packages that update this option? Should I restore the original value upon function exit?

Options belong to the user, not to you.  You should definitely save the 
old value and restore it when you're done.

Duncan Murdoch

> Warm Regards,
> Brian
>
>
> On Jan 14, 2013, at 9:34 AM, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
>
>> On 13-01-13 8:43 PM, Brian Lee Yung Rowe wrote:> Hello,
>>>
>>> I am migrating my package lambda.r to R3.0.0 and am experiencing some issues with the getParserData function (which replaces the parser package). Basically the function works in the R shell but fails when either called from RUnit or from R CMD check.
>>>
>>> I've narrowed it down to the function getSrcfile, which is returning different values depending on the code path. From the command line (works okay):
>>>
>>> debug: srcfile <- getSrcfile(x)
>>> Browse[2]>
>>> debug: if (is.null(srcfile)) return(NULL) else data <- srcfile$parseData
>>> Browse[2]> srcfile
>>> <text>
>>>
>>> When running from the Runit script I get this instead:
>>> debug: srcfile <- getSrcfile(x)
>>> Browse[3]>
>>> debug: if (is.null(srcfile)) return(NULL) else data <- srcfile$parseData
>>> Browse[3]> srcfile
>>> NULL
>>>
>>>
>>> Below is an example calling the getParserData from the command line:
>>>> text <- "abs_max(a, b) %::% numeric:numeric:numeric"
>>>> parse(text=text)
>>> expression(abs_max(a, b) %::% numeric:numeric:numeric)
>>>> getParseData(parse(text=text))
>>>      line1 col1 line2 col2 id parent                token terminal    text
>>> 27     1    1     1   42 27      0                 expr    FALSE
>>> 14     1    1     1   13 14     27                 expr    FALSE
>>> 1      1    1     1    7  1      3 SYMBOL_FUNCTION_CALL     TRUE abs_max
>>> 3      1    1     1    7  3     14                 expr    FALSE
>>> 2      1    8     1    8  2     14                  '('     TRUE       (
>>> 4      1    9     1    9  4      6               SYMBOL     TRUE       a
>>> ...
>>>
>>> The RUnit call from the command line is
>>> runTestFile('/home/brian/workspace/lambda.r/inst/unitTests/runit.dispatching.4.R')
>>>
>>> and fails because of the NULL value of srcfile. The first line of the runit test file is
>>>     abs_max(a, b) %::% numeric:numeric:numeric
>>>
>>> Any insights are appreciated.
>>
>> I think in the case that is failing you just don't have any source info in the parse.  parse() only installs it if the "keep.source" option is TRUE, and the default for that is the result of interactive().  So when you are not interactive you don't get source info.
>>
>> You can fix it by explicitly setting options(keep.source=TRUE).
>>
>> Duncan Murdoch
>>
>


From bbolker at gmail.com  Tue Jan 15 19:26:58 2013
From: bbolker at gmail.com (Ben Bolker)
Date: Tue, 15 Jan 2013 18:26:58 +0000
Subject: [Rd]
	=?utf-8?q?Who_does_develop_the_R_core_and_libs=2C=09and_how_?=
	=?utf-8?q?/_where_is_it_hosted=3F?=
References: <20130114202932.GA1806@siouxsie>
	<828A41A8-186F-4601-8D0E-C52CCA6F5162@r-project.org>
	<20130114233221.GC26703@siouxsie>
	<B6006DD8-7079-4D6C-B64D-25074375B91E@muxspace.com>
	<C2660820-4B80-438A-B66E-E01CE5D25D20@first.in-berlin.de>
Message-ID: <loom.20130115T192022-79@post.gmane.org>

Oliver Bandel <oliver <at> first.in-berlin.de> writes:

> Am 15.01.2013 um 01:11 schrieb Brian Lee Yung Rowe <rowe <at> muxspace.com>:
> > On Jan 14, 2013, at 6:32 PM, oliver <oliver <at> first.in-berlin.de> wrote:

> >> BTW: I looked up the string "wish list"
>  in some of the mentioned docs (mentioned in this thread)
> >>     but did not found it.
> >>     Can you please point me to it directly?
> >>     Googling for "R wish list" brings me links to a producer of toys.
> >> 

  [snip] 
> > Is this what you're looking for: http://developer.r-project.org/ 
> (see TODO lists)

  But do note that most of of them are VERY old ... 
> 
> This is at least some kind of thing yi was looking for.
> But these are personell TODO lists.
> Are their any goals for R as whole project?

> >> All in all it seems like no special things need to be done.
> >> The FSF for example has a page where they ask for support in certain areas,
> >> so, this looks rather urgent.
> >> R seems not to have such urgent needs for support....

 [snip]

  These stack overflow questions might provide some useful
perspective (URLs broken to make Gmane happy -- sorry)

stackoverflow.com/questions/4054585/
     how-can-i-contribute-to-base-r-in-small-ways/

http://stackoverflow.com/questions/8065835/
  proposing-feature-requests-to-the-r-core-team/


From hpages at fhcrc.org  Tue Jan 15 19:46:07 2013
From: hpages at fhcrc.org (=?windows-1252?Q?Herv=E9_Pag=E8s?=)
Date: Tue, 15 Jan 2013 10:46:07 -0800
Subject: [Rd] Who does develop the R core and libs,
 and how / where is it hosted?
In-Reply-To: <72E32EE0-FAC7-4A4A-A6D8-926A862B3D64@r-project.org>
References: <20130114202932.GA1806@siouxsie>
	<828A41A8-186F-4601-8D0E-C52CCA6F5162@r-project.org>
	<20130114233221.GC26703@siouxsie>
	<B6006DD8-7079-4D6C-B64D-25074375B91E@muxspace.com>
	<C2660820-4B80-438A-B66E-E01CE5D25D20@first.in-berlin.de>
	<72E32EE0-FAC7-4A4A-A6D8-926A862B3D64@r-project.org>
Message-ID: <50F5A3EF.8060403@fhcrc.org>

Hi,

On 01/14/2013 05:04 PM, Simon Urbanek wrote:
[...]
>
> Maybe it's a sign of a relative maturity of R that we don't have a particular "milestone"-like agenda.

There are many ways one can interpret the lack of an official roadmap
for a software project. However "maturity" is certainly not one I would
have thought of. But maybe I'm biased by having followed to many other
Open Source projects that do have a roadmap, regardless of whether they
consider themselves mature or not.

> Typically, most things can be supplied as packages - the only reason to touch the core of R itself is if it is something that cannot be done as a package,

Or because it could be (and actually was) done as a package but for
some reasons it feels like it belongs to the core? Examples:
parallel, bitops, getParseData, etc...

> and given R's modularity that is fortunately not very often the case.

Modularity would be even better if more things *in core* were made
generics. For example why the stuff in parallel was not made generic?
(at least S3 generic)

Thanks,
H.

>
> Cheers,
> Simon
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M1-B514
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fhcrc.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From wuolong at gmail.com  Tue Jan 15 20:24:41 2013
From: wuolong at gmail.com (Michael Li)
Date: Tue, 15 Jan 2013 14:24:41 -0500
Subject: [Rd] rpvm arch check
Message-ID: <CAGgMibL9HqfjN1LMA9S_7oEck9kmD4ccEdbP3XZ8-B+EHGg8mg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20130115/babeb810/attachment.pl>

From tlumley at uw.edu  Tue Jan 15 20:47:15 2013
From: tlumley at uw.edu (Thomas Lumley)
Date: Wed, 16 Jan 2013 08:47:15 +1300
Subject: [Rd] R-forge, package dependencies
Message-ID: <CAJ55+d+k8b1UCWs-Rpc5obp=AY_FooZDp9JnRaa5cP9Ey9f6WA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20130116/91d47e1b/attachment.pl>

From ligges at statistik.tu-dortmund.de  Tue Jan 15 21:09:20 2013
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Tue, 15 Jan 2013 21:09:20 +0100
Subject: [Rd] R-forge, package dependencies
In-Reply-To: <CAJ55+d+k8b1UCWs-Rpc5obp=AY_FooZDp9JnRaa5cP9Ey9f6WA@mail.gmail.com>
References: <CAJ55+d+k8b1UCWs-Rpc5obp=AY_FooZDp9JnRaa5cP9Ey9f6WA@mail.gmail.com>
Message-ID: <50F5B770.9000804@statistik.tu-dortmund.de>



On 15.01.2013 20:47, Thomas Lumley wrote:
> I have a project on R-forge (sqlsurvey.r-forge.r-project.org) with two
> packages, RMonetDB and sqlsurvey.
>
> At the moment, sqlsurvey is listed as failing to build.  The error is on
> the Linux package check, which says that RMonetDB is not available:
>
>
> * checking package dependencies ... ERROR
> Package required but not available: ?RMonetDB?
>
> RMonetDB has built successfully: r-forge lists its status as 'current',
> with Linux, Windows, and Mac packages available for download.  The package
> check for sqlsurvey on Windows and Mac finds RMonetDB without any problems,
> it's just on Linux that it appears to be unavailable.
>
> Any suggestions for how to fix this? I've tried uploading a new version of
> RMonetDB, but the situation didn't change: it built successfully, but the
> Linux check of sqlsurvey still couldn't find it.


I think you have to ask Stefan to check the details.

Best,
Uwe


>      -thomas
>
>
>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From nick.sabbe at ugent.be  Tue Jan 15 21:34:52 2013
From: nick.sabbe at ugent.be (Nick Sabbe)
Date: Tue, 15 Jan 2013 21:34:52 +0100
Subject: [Rd] R-forge, package dependencies
In-Reply-To: <50F5B770.9000804@statistik.tu-dortmund.de>
References: <CAJ55+d+k8b1UCWs-Rpc5obp=AY_FooZDp9JnRaa5cP9Ey9f6WA@mail.gmail.com>
	<50F5B770.9000804@statistik.tu-dortmund.de>
Message-ID: <010c01cdf35f$c5e786e0$51b694a0$@ugent.be>

I have exactly the same issue with a pair of my packages on R-Forge.
I've already notified Stefan, but I mentioned it wasn't urgent for  me :)

It must have something to do with the R check using a different environment
than the build...

So good hunting, Stefan!


Nick Sabbe
--
ping: nick.sabbe at ugent.be
link: http://biomath.ugent.be
wink: A1.056, Coupure Links 653, 9000 Gent
ring: 09/264.59.36

-- Do Not Disapprove




-----Original Message-----
From: r-devel-bounces at r-project.org [mailto:r-devel-bounces at r-project.org]
On Behalf Of Uwe Ligges
Sent: dinsdag 15 januari 2013 21:09
To: Thomas Lumley
Cc: Stefan Theussl; R-devel
Subject: Re: [Rd] R-forge, package dependencies



On 15.01.2013 20:47, Thomas Lumley wrote:
> I have a project on R-forge (sqlsurvey.r-forge.r-project.org) with two 
> packages, RMonetDB and sqlsurvey.
>
> At the moment, sqlsurvey is listed as failing to build.  The error is 
> on the Linux package check, which says that RMonetDB is not available:
>
>
> * checking package dependencies ... ERROR Package required but not 
> available: 'RMonetDB'
>
> RMonetDB has built successfully: r-forge lists its status as 
> 'current', with Linux, Windows, and Mac packages available for 
> download.  The package check for sqlsurvey on Windows and Mac finds 
> RMonetDB without any problems, it's just on Linux that it appears to be
unavailable.
>
> Any suggestions for how to fix this? I've tried uploading a new 
> version of RMonetDB, but the situation didn't change: it built 
> successfully, but the Linux check of sqlsurvey still couldn't find it.


I think you have to ask Stefan to check the details.

Best,
Uwe


>      -thomas
>
>
>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

______________________________________________
R-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-devel


From pgilbert902 at gmail.com  Tue Jan 15 21:37:29 2013
From: pgilbert902 at gmail.com (Paul Gilbert)
Date: Tue, 15 Jan 2013 15:37:29 -0500
Subject: [Rd] R-forge, package dependencies
In-Reply-To: <50F5B770.9000804@statistik.tu-dortmund.de>
References: <CAJ55+d+k8b1UCWs-Rpc5obp=AY_FooZDp9JnRaa5cP9Ey9f6WA@mail.gmail.com>
	<50F5B770.9000804@statistik.tu-dortmund.de>
Message-ID: <50F5BE09.7000407@gmail.com>

I'm surprised this works on Windows and Mac, since RMonetDB does not 
seem to be on CRAN. I thought it was still a requirement that 
dependencies need to be on CRAN (which makes development difficult for 
related packages like this).

A related long standing request is that R-forge checking look for 
required newer versions on R-forge rather than just on CRAN. Does anyone 
know if that works on Windows and/or Mac?

Paul

On 13-01-15 03:09 PM, Uwe Ligges wrote:
>
>
> On 15.01.2013 20:47, Thomas Lumley wrote:
>> I have a project on R-forge (sqlsurvey.r-forge.r-project.org) with two
>> packages, RMonetDB and sqlsurvey.
>>
>> At the moment, sqlsurvey is listed as failing to build.  The error is on
>> the Linux package check, which says that RMonetDB is not available:
>>
>>
>> * checking package dependencies ... ERROR
>> Package required but not available: ?RMonetDB?
>>
>> RMonetDB has built successfully: r-forge lists its status as 'current',
>> with Linux, Windows, and Mac packages available for download.  The
>> package
>> check for sqlsurvey on Windows and Mac finds RMonetDB without any
>> problems,
>> it's just on Linux that it appears to be unavailable.
>>
>> Any suggestions for how to fix this? I've tried uploading a new
>> version of
>> RMonetDB, but the situation didn't change: it built successfully, but the
>> Linux check of sqlsurvey still couldn't find it.
>
>
> I think you have to ask Stefan to check the details.
>
> Best,
> Uwe
>
>
>>      -thomas
>>
>>
>>
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From elw at stderr.org  Wed Jan 16 00:25:04 2013
From: elw at stderr.org (elijah wright)
Date: Tue, 15 Jan 2013 17:25:04 -0600
Subject: [Rd] Who does develop the R core and libs,
	and how / where is it hosted?
In-Reply-To: <50F5A3EF.8060403@fhcrc.org>
References: <20130114202932.GA1806@siouxsie>
	<828A41A8-186F-4601-8D0E-C52CCA6F5162@r-project.org>
	<20130114233221.GC26703@siouxsie>
	<B6006DD8-7079-4D6C-B64D-25074375B91E@muxspace.com>
	<C2660820-4B80-438A-B66E-E01CE5D25D20@first.in-berlin.de>
	<72E32EE0-FAC7-4A4A-A6D8-926A862B3D64@r-project.org>
	<50F5A3EF.8060403@fhcrc.org>
Message-ID: <CANQ3A2NswiA-f4F+oV6bZnfX4TeAU+nZOqVQ54KnjdwnWw=F8Q@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20130115/e363b8fc/attachment.pl>

From peter.meilstrup at gmail.com  Wed Jan 16 01:39:49 2013
From: peter.meilstrup at gmail.com (Peter Meilstrup)
Date: Tue, 15 Jan 2013 16:39:49 -0800
Subject: [Rd] Prevent serialization of an environment?
Message-ID: <CAJoaRhabfD2AVoyeB-4yiNpi26sfNXuxQ+eTXuYRqCJ5hs=xnQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20130115/45c2b2d1/attachment.pl>

From murdoch.duncan at gmail.com  Wed Jan 16 01:55:59 2013
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Tue, 15 Jan 2013 19:55:59 -0500
Subject: [Rd] Prevent serialization of an environment?
In-Reply-To: <CAJoaRhabfD2AVoyeB-4yiNpi26sfNXuxQ+eTXuYRqCJ5hs=xnQ@mail.gmail.com>
References: <CAJoaRhabfD2AVoyeB-4yiNpi26sfNXuxQ+eTXuYRqCJ5hs=xnQ@mail.gmail.com>
Message-ID: <50F5FA9F.5090102@gmail.com>

On 13-01-15 7:39 PM, Peter Meilstrup wrote:
> Within I'm using an environment as a hashtable to cache the results of some
> repeated computations in a package. The thing is that the contents of the
> cache will not be valid across R sessions, so I would like to make sure
> that the cache is cleared if the user saves or restores the workspace (or
> when a package is prepared for lazy loading, etc.). Is there a way to mark
> an environment so that its contents do not serialize?
>

Seems like the refhook argument to serialize() could do that.

Duncan Murdoch


From peter.meilstrup at gmail.com  Wed Jan 16 02:33:21 2013
From: peter.meilstrup at gmail.com (Peter Meilstrup)
Date: Tue, 15 Jan 2013 17:33:21 -0800
Subject: [Rd] Prevent serialization of an environment?
In-Reply-To: <50F5FA9F.5090102@gmail.com>
References: <CAJoaRhabfD2AVoyeB-4yiNpi26sfNXuxQ+eTXuYRqCJ5hs=xnQ@mail.gmail.com>
	<50F5FA9F.5090102@gmail.com>
Message-ID: <CAJoaRhbw4r7VMR5UFUiUzc-nPywcWFn2zPehYGnb85V3911NMg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20130115/f97724b4/attachment.pl>

From simon.urbanek at r-project.org  Wed Jan 16 02:53:01 2013
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Tue, 15 Jan 2013 20:53:01 -0500
Subject: [Rd] rpvm arch check
In-Reply-To: <CAGgMibL9HqfjN1LMA9S_7oEck9kmD4ccEdbP3XZ8-B+EHGg8mg@mail.gmail.com>
References: <CAGgMibL9HqfjN1LMA9S_7oEck9kmD4ccEdbP3XZ8-B+EHGg8mg@mail.gmail.com>
Message-ID: <00064623-6B78-4C0E-84B0-EFD2053B1B19@r-project.org>

On Jan 15, 2013, at 2:24 PM, Michael Li wrote:

> I've trying to fix the check error in rpvm package. Right now on my Mac, I use darwinport to install PVM and I can get rpvm to pass the check using 'R -arch x86_64 CMD check'. However the default 'R CMD check' uses i386 which fails since PVM is built for x86_64 only.
> 
> So is there a way to ensure proper architecture is used that matches that of the external library like PVM? What does CRAN use when it checks packages?
> 

We use static builds which have all necessary architectures (so users don't need to install them and can use any architecture).

Cheers,
Simon


From hpages at fhcrc.org  Wed Jan 16 07:12:01 2013
From: hpages at fhcrc.org (=?ISO-8859-1?Q?Herv=E9_Pag=E8s?=)
Date: Tue, 15 Jan 2013 22:12:01 -0800
Subject: [Rd] Who does develop the R core and libs,
 and how / where is it hosted?
In-Reply-To: <CANQ3A2NswiA-f4F+oV6bZnfX4TeAU+nZOqVQ54KnjdwnWw=F8Q@mail.gmail.com>
References: <20130114202932.GA1806@siouxsie>
	<828A41A8-186F-4601-8D0E-C52CCA6F5162@r-project.org>
	<20130114233221.GC26703@siouxsie>
	<B6006DD8-7079-4D6C-B64D-25074375B91E@muxspace.com>
	<C2660820-4B80-438A-B66E-E01CE5D25D20@first.in-berlin.de>
	<72E32EE0-FAC7-4A4A-A6D8-926A862B3D64@r-project.org>
	<50F5A3EF.8060403@fhcrc.org>
	<CANQ3A2NswiA-f4F+oV6bZnfX4TeAU+nZOqVQ54KnjdwnWw=F8Q@mail.gmail.com>
Message-ID: <50F644B1.9070906@fhcrc.org>

On 01/15/2013 03:25 PM, elijah wright wrote:
>
>
>
> On Tue, Jan 15, 2013 at 12:46 PM, Herv? Pag?s <hpages at fhcrc.org
> <mailto:hpages at fhcrc.org>> wrote:
>
>         and given R's modularity that is fortunately not very often the
>         case.
>
>
>     Modularity would be even better if more things *in core* were made
>     generics. For example why the stuff in parallel was not made generic?
>     (at least S3 generic)
>
>
> The better to give interesting people GSoC projects with, of course!  ;-)
>
> ... nearly everyone appreciates patches that improve their projects to
> noticeable benefit.  If you like parallel better a different way...
> collude and make it rock.

Sure. And in that particular case the patch wouldn't be hard to produce.

My comment was more in the context of the roadmap discussion. So to
make my point clear I believe that having an official public roadmap
can't hurt, even for a project that has reached some level of maturity.
One obvious benefit is that it provides more opportunity for
discussion/suggestions/input between the community and R core
*before* things happen.
In the case of the parallel package, maybe there are good reasons
for not making the stuff in parallel generic, I don't know. I could
go ahead and start working on a patch now, living in my own world,
following my own dream, but I'd rather try to discuss this a little
bit before. Don't you think?

To make my point even clearer, I think having a public roadmap is by
itself a sign of maturity. Rather than not having one.

Cheers,
H.

>
> best,
>
> --e

-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M1-B514
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fhcrc.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From peter.meilstrup at gmail.com  Wed Jan 16 07:43:04 2013
From: peter.meilstrup at gmail.com (Peter Meilstrup)
Date: Tue, 15 Jan 2013 22:43:04 -0800
Subject: [Rd] Prevent serialization of an environment?
In-Reply-To: <CAJoaRhbw4r7VMR5UFUiUzc-nPywcWFn2zPehYGnb85V3911NMg@mail.gmail.com>
References: <CAJoaRhabfD2AVoyeB-4yiNpi26sfNXuxQ+eTXuYRqCJ5hs=xnQ@mail.gmail.com>
	<50F5FA9F.5090102@gmail.com>
	<CAJoaRhbw4r7VMR5UFUiUzc-nPywcWFn2zPehYGnb85V3911NMg@mail.gmail.com>
Message-ID: <CAJoaRhbdGbgdS93SNdBdfz13EvDkqG3JZO-UoT-sp04Gjp34Vw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20130115/7b0d3a85/attachment.pl>

From maechler at stat.math.ethz.ch  Wed Jan 16 09:31:41 2013
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Wed, 16 Jan 2013 09:31:41 +0100
Subject: [Rd] R-forge, package dependencies
In-Reply-To: <010c01cdf35f$c5e786e0$51b694a0$@ugent.be>
References: <CAJ55+d+k8b1UCWs-Rpc5obp=AY_FooZDp9JnRaa5cP9Ey9f6WA@mail.gmail.com>
	<50F5B770.9000804@statistik.tu-dortmund.de>
	<010c01cdf35f$c5e786e0$51b694a0$@ugent.be>
Message-ID: <20726.25965.68797.657627@stat.math.ethz.ch>

>>>>> Nick Sabbe <nick.sabbe at ugent.be>
>>>>>     on Tue, 15 Jan 2013 21:34:52 +0100 writes:

    > I have exactly the same issue with a pair of my packages
    > on R-Forge.  I've already notified Stefan, but I mentioned
    > it wasn't urgent for me :)

    > It must have something to do with the R check using a
    > different environment than the build...

notably when using '--as-cran' I think;
this looks like a pretty infelicitous decision to me:

E.g. I can no longer use --as-cran for checking our copula
package (on my own computer), as that suggests Rmpfr and gmp and
these depend on the corresponding external C libraries (mpfr & gmp) 
and these rely on LD_LIBRARY_PATH and that now fails to be
looked at in such circumstances.

To me this somewhat recent change looks like something that
should be re-considered on the R side..

Martin

    > So good hunting, Stefan!
indeed...


    > Nick Sabbe
    > --
    > ping: nick.sabbe at ugent.be link: http://biomath.ugent.be
    > wink: A1.056, Coupure Links 653, 9000 Gent ring:
    > 09/264.59.36

    > -- Do Not Disapprove




    > -----Original Message----- From:
    > r-devel-bounces at r-project.org
    > [mailto:r-devel-bounces at r-project.org] On Behalf Of Uwe
    > Ligges Sent: dinsdag 15 januari 2013 21:09 To: Thomas
    > Lumley Cc: Stefan Theussl; R-devel Subject: Re: [Rd]
    > R-forge, package dependencies



    > On 15.01.2013 20:47, Thomas Lumley wrote:
    >> I have a project on R-forge
    >> (sqlsurvey.r-forge.r-project.org) with two packages,
    >> RMonetDB and sqlsurvey.
    >> 
    >> At the moment, sqlsurvey is listed as failing to build.
    >> The error is on the Linux package check, which says that
    >> RMonetDB is not available:
    >> 
    >> 
    >> * checking package dependencies ... ERROR Package
    >> required but not available: 'RMonetDB'
    >> 
    >> RMonetDB has built successfully: r-forge lists its status
    >> as 'current', with Linux, Windows, and Mac packages
    >> available for download.  The package check for sqlsurvey
    >> on Windows and Mac finds RMonetDB without any problems,
    >> it's just on Linux that it appears to be
    > unavailable.
    >> 
    >> Any suggestions for how to fix this? I've tried uploading
    >> a new version of RMonetDB, but the situation didn't
    >> change: it built successfully, but the Linux check of
    >> sqlsurvey still couldn't find it.


    > I think you have to ask Stefan to check the details.

    > Best, Uwe


    >> -thomas
    >> 
    >> 
    >> 
    >> 
    >> ______________________________________________
    >> R-devel at r-project.org mailing list
    >> https://stat.ethz.ch/mailman/listinfo/r-devel
    >> 

    > ______________________________________________
    > R-devel at r-project.org mailing list
    > https://stat.ethz.ch/mailman/listinfo/r-devel

    > ______________________________________________
    > R-devel at r-project.org mailing list
    > https://stat.ethz.ch/mailman/listinfo/r-devel


From mengsteab.aregay at gmail.com  Wed Jan 16 12:10:30 2013
From: mengsteab.aregay at gmail.com (Mengsteab Aregay)
Date: Wed, 16 Jan 2013 12:10:30 +0100
Subject: [Rd] R-forge, package dependencies
In-Reply-To: <20726.25965.68797.657627@stat.math.ethz.ch>
References: <CAJ55+d+k8b1UCWs-Rpc5obp=AY_FooZDp9JnRaa5cP9Ey9f6WA@mail.gmail.com>
	<50F5B770.9000804@statistik.tu-dortmund.de>
	<010c01cdf35f$c5e786e0$51b694a0$@ugent.be>
	<20726.25965.68797.657627@stat.math.ethz.ch>
Message-ID: <CAC09cvQwZPUJyXBhBgEc5=erJ4EM6TPMJj1va3K+FaBQa=MiOA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20130116/58a25a6b/attachment.pl>

From gdsayshi at gmail.com  Wed Jan 16 13:32:55 2013
From: gdsayshi at gmail.com (Gaurav Dasgupta)
Date: Wed, 16 Jan 2013 18:02:55 +0530
Subject: [Rd] How to call Java main method using rJava package?
Message-ID: <CACq8Ys2TSKahaeVTU6m-zvzh+kXvC1OFgrw0oNQWP16etkqi_g@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20130116/76eefea3/attachment.pl>

From thomas.friedrichsmeier at ruhr-uni-bochum.de  Wed Jan 16 14:00:56 2013
From: thomas.friedrichsmeier at ruhr-uni-bochum.de (Thomas Friedrichsmeier)
Date: 16 Jan 2013 14:00:56 +0100
Subject: [Rd] Small clarification to R-exts, questions on ptr_do_selectlist
Message-ID: <201301161401.10833.thomas.friedrichsmeier@ruhr-uni-bochum.de>

Hi,

1. I suggest adding the following piece of advice at the end of the section 
describing R_getEmbeddingDllInfo() (currently 8.1.3) in R-exts.texi:

---
In order to call registered symbols of the embedding application from a
package, you have to specify @code{PACKAGE = "(embedding)"} in
@code{.C}, @code{.Call}, etc.
---

2. Section 8.1.2 of R-exts.text ("Setting R callbacks") has a new line "These 
callbacks should never be changed in a running R session (and hence cannot be 
called from an extension package)." I had a bit of difficulty understanding 
what "These" refers to. I believe it's meant to refer to "the above 
callbacks", only, and I suggest using that wording for easier reading.

3. While reading the sources, trying to understand how to make use of 
prt_do_selectlist, it seems that this is not actually used to 
utils::select.list(), unless 
  (.Platform$OS.type == "windows" || .Platform$GUI == "AQUA")
Is this intended?
In fact, from reading src/library/utils/src/stubs.c, it looks like 
ptr_do_selectlist (and ptr_do_data(entry|viewer), ptr_R_(add|load|
save)history) is ignored on Windows, although - from a naive POV - it would 
seem easy enough to make it functional across platforms(*).

Regards
Thomas


(*) E.g. changing the selectlist stub to:
--
SEXP selectlist(SEXP call, SEXP op, SEXP args, SEXP env)
{
    if(ptr_do_selectlist) return ptr_do_selectlist(call, op, CDR(args), env);
#ifdef Win32
    return Win_selectlist(CDR(args));
#else
    return R_NilValue;
#endif
}
--
and removing the Windows specific stub, earlier in the file.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 198 bytes
Desc: This is a digitally signed message part.
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20130116/3cc424bd/attachment.bin>

From gavin.simpson at ucl.ac.uk  Wed Jan 16 16:05:06 2013
From: gavin.simpson at ucl.ac.uk (Gavin Simpson)
Date: Wed, 16 Jan 2013 16:05:06 +0100
Subject: [Rd] Trouble building package using R in development
Message-ID: <1358348706.4687.25.camel@chrysothemis.geog.ucl.ac.uk>

Dear List,

I'm having considerable trouble setting up my environment (Linux, Fedora
16, Bash) to build and check packages under R Under Development
(r61660). I'm doing this to better get a handle on difference in the
output from running checks on examples in one of my packages. Note I
compiled R Under Development myself

The problem I am now having is whenever I try to build my analogue
package using R Under Development, R complains about a dependency having
been built before R 3.0.0. I obviously don't have my environment
variables set correctly, but I don't see why or how R is finding my
daily-use package library; if anything I would have expected it to fail
with a missing dependency.

If I start Rdevel with --vanilla (to mimic Rdevel CMD build) I see:

> .libPaths()
[1] "/home/gavin/R/devlibs"             "/home/gavin/R/devel/build/library"

the first entry there is because I have temporarily set R_LIBS to that
directory via export R_LIBS=/home/gavin/R/devlibs. From there we see I
have versions of the dependencies installed in this library and they are
built with 3.0.0:

> installed.packages("~/R/devlibs/")[, "Built", drop = FALSE]
              Built  
analogue      "3.0.0"
ctv           "3.0.0"
permute       "3.0.0"
princurve     "3.0.0"
rgl           "3.0.0"
scatterplot3d "3.0.0"
vegan         "3.0.0"

Note that there are no other versions of vegan inadvertently installed
to the build directory for R Under Development.

Following advice in Writing R Extensions I have also created
~/build.Renviron and ~/check.Renviron and as these are non-standard I
also followed the advice to set R_BUILD_ENVIRON and R_CHECK_ENVIRON
again temporarily via export:

$ cat $R_CHECK_ENVIRON
R_LIBS=/home/gavin/R/devlibs

$ cat $R_BUILD_ENVIRON
R_LIBS=/home/gavin/R/devlibs

Yet still I get errors building analogue:

$ Rdevel CMD build ../analogue/pkg/
* checking for file ?../analogue/pkg/DESCRIPTION? ... OK
* preparing ?analogue?:
* checking DESCRIPTION meta-information ... OK
* cleaning src
* installing the package to re-build vignettes
      -----------------------------------
* installing *source* package ?analogue? ...
** libs
gcc -std=gnu99 -I/home/gavin/R/devel/build/include -DNDEBUG  -I/usr/local/include    -fpic  -g -O2 -pipe -m64 -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector --param=ssp-buffer-size=4 -march=core2 -fasynchronous-unwind-tables  -c c_distx.c -o c_distx.o
gcc -std=gnu99 -I/home/gavin/R/devel/build/include -DNDEBUG  -I/usr/local/include    -fpic  -g -O2 -pipe -m64 -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector --param=ssp-buffer-size=4 -march=core2 -fasynchronous-unwind-tables  -c c_distxy.c -o c_distxy.o
gcc -std=gnu99 -I/home/gavin/R/devel/build/include -DNDEBUG  -I/usr/local/include    -fpic  -g -O2 -pipe -m64 -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector --param=ssp-buffer-size=4 -march=core2 -fasynchronous-unwind-tables  -c distx.c -o distx.o
gcc -std=gnu99 -I/home/gavin/R/devel/build/include -DNDEBUG  -I/usr/local/include    -fpic  -g -O2 -pipe -m64 -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector --param=ssp-buffer-size=4 -march=core2 -fasynchronous-unwind-tables  -c distxy.c -o distxy.o
gcc -std=gnu99 -I/home/gavin/R/devel/build/include -DNDEBUG  -I/usr/local/include    -fpic  -g -O2 -pipe -m64 -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector --param=ssp-buffer-size=4 -march=core2 -fasynchronous-unwind-tables  -c wastats.c -o wastats.o
gcc -std=gnu99 -shared -L/usr/local/lib64 -o analogue.so c_distx.o c_distxy.o distx.o distxy.o wastats.o
installing to /tmp/Rtmpctxbtv/Rinst30e3f762569/analogue/libs
** R
** data
** inst
** byte-compile and prepare package for lazy loading
Error : package ?vegan? was built before R 3.0.0: please re-install it
ERROR: lazy loading failed for package ?analogue?
* removing ?/tmp/Rtmpctxbtv/Rinst30e3f762569/analogue?
      -----------------------------------
ERROR: package installation failed

Can anyone suggest where to go from here?

TIA

Gavin
-- 
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
 Dr. Gavin Simpson             [t] +44 (0)20 7679 0522
 ECRC, UCL Geography,          [f] +44 (0)20 7679 0565
 Pearson Building,             [e] gavin.simpsonATNOSPAMucl.ac.uk
 Gower Street, London          [w] http://www.ucl.ac.uk/~ucfagls/
 UK. WC1E 6BT.                 [w] http://www.freshwaters.org.uk
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%


From simon.urbanek at r-project.org  Wed Jan 16 16:16:26 2013
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Wed, 16 Jan 2013 10:16:26 -0500
Subject: [Rd] How to call Java main method using rJava package?
In-Reply-To: <CACq8Ys2TSKahaeVTU6m-zvzh+kXvC1OFgrw0oNQWP16etkqi_g@mail.gmail.com>
References: <CACq8Ys2TSKahaeVTU6m-zvzh+kXvC1OFgrw0oNQWP16etkqi_g@mail.gmail.com>
Message-ID: <2A6B69EE-64BD-4BBA-BBFD-A9070CEF9663@r-project.org>


On Jan 16, 2013, at 7:32 AM, Gaurav Dasgupta wrote:

> Hi,
> 
> I am trying to integrate my Java program with R using rJava package. I want
> to execute the whole Java program from R. The main() method in my Java code
> calls all the other defined methods. So, I guess I have to call the main()
> method in .jcall.
> 
> An example Java code:
> 
> *class A {
>        public static int mySum(int x, int y) {
>                return x+y;
>        }
>        public static void main (String[] arg) {
>                System.out.println("The sum is " + mySum(2, 4));
>        }
> }*
> 
> I can do the following to call the mySum() method:
> *.jcall(obj, "I", "mySum", as.integer(2), as.integer(4))*
> This will give the output *6*.
> 
> But can some one explain me that how exactly I can execute this program to
> print *The sum is 6* from R? OR how can I call the main method?

.jcall("A","V","main",.jarray(list(), "java/lang/String")

But note that System.out is sent to stdout by Java so it won't output in the R console as R output so you should really avoid it.

You may consider using the stats-rosuda-devel mailing list for rJava questions.

Cheers,
Simon


> I am a beginner in R.
> 
> Thanks,
> Gaurav
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 


From gavin.simpson at ucl.ac.uk  Wed Jan 16 16:25:20 2013
From: gavin.simpson at ucl.ac.uk (Gavin Simpson)
Date: Wed, 16 Jan 2013 16:25:20 +0100
Subject: [Rd] Trouble building package using R in development
In-Reply-To: <1358348706.4687.25.camel@chrysothemis.geog.ucl.ac.uk>
References: <1358348706.4687.25.camel@chrysothemis.geog.ucl.ac.uk>
Message-ID: <1358349920.4687.34.camel@chrysothemis.geog.ucl.ac.uk>

As a follow-up, shortly after I clicked send I decided to do something
silly and rename my ~/.Renviron (which set R_LIBS too). Silly because
the Writing R Extensions (WRE) manual says that these startup files are
not read as R is invoked with --vanilla.

Once I renamed ~/.Renviron so it was not being read I was able to build
the package using R Under Development following the remaining
instructions in the WRE note [1]

So I do wonder if I have misunderstood the note in WRE or if there is
some other issue here? Starting R --vanilla with R Under Development
wasn't reading ~/.Renviron, and by renaming ~/.Renviron that I was able
to build the package indicates that this file was implicated in the
problem I described.

Is it intentional that R CMD build reads ~/.Renviron ? If it is, then
WRE should ideally clarify this or make it explicit. If it wasn't
supposed to be read, is there a bug here?

All the best,

Gavin

[1]
http://cran.r-project.org/doc/manuals/r-devel/R-exts.html#Checking-and-building-packages

On Wed, 2013-01-16 at 16:05 +0100, Gavin Simpson wrote:
> Dear List,
> 
> I'm having considerable trouble setting up my environment (Linux, Fedora
> 16, Bash) to build and check packages under R Under Development
> (r61660). I'm doing this to better get a handle on difference in the
> output from running checks on examples in one of my packages. Note I
> compiled R Under Development myself
> 
> The problem I am now having is whenever I try to build my analogue
> package using R Under Development, R complains about a dependency having
> been built before R 3.0.0. I obviously don't have my environment
> variables set correctly, but I don't see why or how R is finding my
> daily-use package library; if anything I would have expected it to fail
> with a missing dependency.
> 
> If I start Rdevel with --vanilla (to mimic Rdevel CMD build) I see:
> 
> > .libPaths()
> [1] "/home/gavin/R/devlibs"             "/home/gavin/R/devel/build/library"
> 
> the first entry there is because I have temporarily set R_LIBS to that
> directory via export R_LIBS=/home/gavin/R/devlibs. From there we see I
> have versions of the dependencies installed in this library and they are
> built with 3.0.0:
> 
> > installed.packages("~/R/devlibs/")[, "Built", drop = FALSE]
>               Built  
> analogue      "3.0.0"
> ctv           "3.0.0"
> permute       "3.0.0"
> princurve     "3.0.0"
> rgl           "3.0.0"
> scatterplot3d "3.0.0"
> vegan         "3.0.0"
> 
> Note that there are no other versions of vegan inadvertently installed
> to the build directory for R Under Development.
> 
> Following advice in Writing R Extensions I have also created
> ~/build.Renviron and ~/check.Renviron and as these are non-standard I
> also followed the advice to set R_BUILD_ENVIRON and R_CHECK_ENVIRON
> again temporarily via export:
> 
> $ cat $R_CHECK_ENVIRON
> R_LIBS=/home/gavin/R/devlibs
> 
> $ cat $R_BUILD_ENVIRON
> R_LIBS=/home/gavin/R/devlibs
> 
> Yet still I get errors building analogue:
> 
> $ Rdevel CMD build ../analogue/pkg/
> * checking for file ?../analogue/pkg/DESCRIPTION? ... OK
> * preparing ?analogue?:
> * checking DESCRIPTION meta-information ... OK
> * cleaning src
> * installing the package to re-build vignettes
>       -----------------------------------
> * installing *source* package ?analogue? ...
> ** libs
> gcc -std=gnu99 -I/home/gavin/R/devel/build/include -DNDEBUG  -I/usr/local/include    -fpic  -g -O2 -pipe -m64 -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector --param=ssp-buffer-size=4 -march=core2 -fasynchronous-unwind-tables  -c c_distx.c -o c_distx.o
> gcc -std=gnu99 -I/home/gavin/R/devel/build/include -DNDEBUG  -I/usr/local/include    -fpic  -g -O2 -pipe -m64 -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector --param=ssp-buffer-size=4 -march=core2 -fasynchronous-unwind-tables  -c c_distxy.c -o c_distxy.o
> gcc -std=gnu99 -I/home/gavin/R/devel/build/include -DNDEBUG  -I/usr/local/include    -fpic  -g -O2 -pipe -m64 -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector --param=ssp-buffer-size=4 -march=core2 -fasynchronous-unwind-tables  -c distx.c -o distx.o
> gcc -std=gnu99 -I/home/gavin/R/devel/build/include -DNDEBUG  -I/usr/local/include    -fpic  -g -O2 -pipe -m64 -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector --param=ssp-buffer-size=4 -march=core2 -fasynchronous-unwind-tables  -c distxy.c -o distxy.o
> gcc -std=gnu99 -I/home/gavin/R/devel/build/include -DNDEBUG  -I/usr/local/include    -fpic  -g -O2 -pipe -m64 -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector --param=ssp-buffer-size=4 -march=core2 -fasynchronous-unwind-tables  -c wastats.c -o wastats.o
> gcc -std=gnu99 -shared -L/usr/local/lib64 -o analogue.so c_distx.o c_distxy.o distx.o distxy.o wastats.o
> installing to /tmp/Rtmpctxbtv/Rinst30e3f762569/analogue/libs
> ** R
> ** data
> ** inst
> ** byte-compile and prepare package for lazy loading
> Error : package ?vegan? was built before R 3.0.0: please re-install it
> ERROR: lazy loading failed for package ?analogue?
> * removing ?/tmp/Rtmpctxbtv/Rinst30e3f762569/analogue?
>       -----------------------------------
> ERROR: package installation failed
> 
> Can anyone suggest where to go from here?
> 
> TIA
> 
> Gavin

-- 
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
 Dr. Gavin Simpson             [t] +44 (0)20 7679 0522
 ECRC, UCL Geography,          [f] +44 (0)20 7679 0565
 Pearson Building,             [e] gavin.simpsonATNOSPAMucl.ac.uk
 Gower Street, London          [w] http://www.ucl.ac.uk/~ucfagls/
 UK. WC1E 6BT.                 [w] http://www.freshwaters.org.uk
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%


From friendly at yorku.ca  Wed Jan 16 17:25:13 2013
From: friendly at yorku.ca (Michael Friendly)
Date: Wed, 16 Jan 2013 11:25:13 -0500
Subject: [Rd] Declaring/importing non-exported functions [car] in another
	package
Message-ID: <50F6D469.3010305@yorku.ca>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20130116/cc7996c1/attachment.pl>

From murdoch.duncan at gmail.com  Wed Jan 16 17:40:37 2013
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Wed, 16 Jan 2013 11:40:37 -0500
Subject: [Rd] Declaring/importing non-exported functions [car] in
 another package
In-Reply-To: <50F6D469.3010305@yorku.ca>
References: <50F6D469.3010305@yorku.ca>
Message-ID: <50F6D805.1020309@gmail.com>

On 13-01-16 11:25 AM, Michael Friendly wrote:
> A new function in my heplots package wants to use a non-exported utility
> function in the car package,
> df.terms, but this depends on other non-exported functions.
>   From the Writing R extensions manual, I thought I could do this via (in
> my NAMESPACE)
>
> importFrom(car, car:::df.terms, car:::df.terms.default, car:::is.aliased)
>
> but I get:
> ** preparing package for lazy loading
> Error : objects 'car:::df.terms', 'car:::df.terms.default',
> 'car:::is.aliased' are not exported by 'namespace:car'
> ERROR: lazy loading failed for package 'heplots'
>
> \S 1.6.1 of the manual says regarding importFrom():
> Using |foo:::f| instead of |foo::f| allows access to unexported objects.
> This is generally not recommended, as the semantics of unexported
> objects may be changed by the package author in routine maintenance.
>
> Questions:
> 1.  Why doesn't this work?

I think you misread the manual.  It is talking about ways to access 
functions other than by using importFrom.  You can use car:::df.terms in 
your functions.

> 2.  Is my only alternative to copy these functions to my package, also
> unexported?

Using car:::df.terms explicitly is another option.

Another possibility is for the car maintainer (John Fox) to export that 
function from car.

Duncan Murdoch


From friendly at yorku.ca  Wed Jan 16 17:56:45 2013
From: friendly at yorku.ca (Michael Friendly)
Date: Wed, 16 Jan 2013 11:56:45 -0500
Subject: [Rd] Declaring/importing non-exported functions [car] in
 another package
In-Reply-To: <50F6D805.1020309@gmail.com>
References: <50F6D469.3010305@yorku.ca> <50F6D805.1020309@gmail.com>
Message-ID: <50F6DBCD.8060302@yorku.ca>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20130116/3d065d7f/attachment.pl>

From hb at biostat.ucsf.edu  Wed Jan 16 17:59:42 2013
From: hb at biostat.ucsf.edu (Henrik Bengtsson)
Date: Wed, 16 Jan 2013 08:59:42 -0800
Subject: [Rd] Trouble building package using R in development
In-Reply-To: <1358349920.4687.34.camel@chrysothemis.geog.ucl.ac.uk>
References: <1358348706.4687.25.camel@chrysothemis.geog.ucl.ac.uk>
	<1358349920.4687.34.camel@chrysothemis.geog.ucl.ac.uk>
Message-ID: <CAFDcVCQmyZYLpT=vkFaT5feJSS4VcSBKR+VoNAtosVKXBhzU_A@mail.gmail.com>

On Wed, Jan 16, 2013 at 7:25 AM, Gavin Simpson <gavin.simpson at ucl.ac.uk> wrote:
> As a follow-up, shortly after I clicked send I decided to do something
> silly and rename my ~/.Renviron (which set R_LIBS too). Silly because
> the Writing R Extensions (WRE) manual says that these startup files are
> not read as R is invoked with --vanilla.
>
> Once I renamed ~/.Renviron so it was not being read I was able to build
> the package using R Under Development following the remaining
> instructions in the WRE note [1]
>
> So I do wonder if I have misunderstood the note in WRE or if there is
> some other issue here? Starting R --vanilla with R Under Development
> wasn't reading ~/.Renviron, and by renaming ~/.Renviron that I was able
> to build the package indicates that this file was implicated in the
> problem I described.
>
> Is it intentional that R CMD build reads ~/.Renviron ? If it is, then
> WRE should ideally clarify this or make it explicit. If it wasn't
> supposed to be read, is there a bug here?

FYI, related posts:

* Rd thread 'R devel [and R 2.14.1 patched]: R CMD build now sources
~/.Rprofile' on Feb 23, 2012
[https://stat.ethz.ch/pipermail/r-devel/2012-February/063365.html]
* Rd thread 'R CMD build/check on Windows 7' on Jul 17, 2012
[https://stat.ethz.ch/pipermail/r-devel/2012-July/064427.html]

To circumvent this, I check using:

R --no-init-file CMD check foo_1.0.tar.gz

/Henrik

>
> All the best,
>
> Gavin
>
> [1]
> http://cran.r-project.org/doc/manuals/r-devel/R-exts.html#Checking-and-building-packages
>
> On Wed, 2013-01-16 at 16:05 +0100, Gavin Simpson wrote:
>> Dear List,
>>
>> I'm having considerable trouble setting up my environment (Linux, Fedora
>> 16, Bash) to build and check packages under R Under Development
>> (r61660). I'm doing this to better get a handle on difference in the
>> output from running checks on examples in one of my packages. Note I
>> compiled R Under Development myself
>>
>> The problem I am now having is whenever I try to build my analogue
>> package using R Under Development, R complains about a dependency having
>> been built before R 3.0.0. I obviously don't have my environment
>> variables set correctly, but I don't see why or how R is finding my
>> daily-use package library; if anything I would have expected it to fail
>> with a missing dependency.
>>
>> If I start Rdevel with --vanilla (to mimic Rdevel CMD build) I see:
>>
>> > .libPaths()
>> [1] "/home/gavin/R/devlibs"             "/home/gavin/R/devel/build/library"
>>
>> the first entry there is because I have temporarily set R_LIBS to that
>> directory via export R_LIBS=/home/gavin/R/devlibs. From there we see I
>> have versions of the dependencies installed in this library and they are
>> built with 3.0.0:
>>
>> > installed.packages("~/R/devlibs/")[, "Built", drop = FALSE]
>>               Built
>> analogue      "3.0.0"
>> ctv           "3.0.0"
>> permute       "3.0.0"
>> princurve     "3.0.0"
>> rgl           "3.0.0"
>> scatterplot3d "3.0.0"
>> vegan         "3.0.0"
>>
>> Note that there are no other versions of vegan inadvertently installed
>> to the build directory for R Under Development.
>>
>> Following advice in Writing R Extensions I have also created
>> ~/build.Renviron and ~/check.Renviron and as these are non-standard I
>> also followed the advice to set R_BUILD_ENVIRON and R_CHECK_ENVIRON
>> again temporarily via export:
>>
>> $ cat $R_CHECK_ENVIRON
>> R_LIBS=/home/gavin/R/devlibs
>>
>> $ cat $R_BUILD_ENVIRON
>> R_LIBS=/home/gavin/R/devlibs
>>
>> Yet still I get errors building analogue:
>>
>> $ Rdevel CMD build ../analogue/pkg/
>> * checking for file ?../analogue/pkg/DESCRIPTION? ... OK
>> * preparing ?analogue?:
>> * checking DESCRIPTION meta-information ... OK
>> * cleaning src
>> * installing the package to re-build vignettes
>>       -----------------------------------
>> * installing *source* package ?analogue? ...
>> ** libs
>> gcc -std=gnu99 -I/home/gavin/R/devel/build/include -DNDEBUG  -I/usr/local/include    -fpic  -g -O2 -pipe -m64 -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector --param=ssp-buffer-size=4 -march=core2 -fasynchronous-unwind-tables  -c c_distx.c -o c_distx.o
>> gcc -std=gnu99 -I/home/gavin/R/devel/build/include -DNDEBUG  -I/usr/local/include    -fpic  -g -O2 -pipe -m64 -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector --param=ssp-buffer-size=4 -march=core2 -fasynchronous-unwind-tables  -c c_distxy.c -o c_distxy.o
>> gcc -std=gnu99 -I/home/gavin/R/devel/build/include -DNDEBUG  -I/usr/local/include    -fpic  -g -O2 -pipe -m64 -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector --param=ssp-buffer-size=4 -march=core2 -fasynchronous-unwind-tables  -c distx.c -o distx.o
>> gcc -std=gnu99 -I/home/gavin/R/devel/build/include -DNDEBUG  -I/usr/local/include    -fpic  -g -O2 -pipe -m64 -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector --param=ssp-buffer-size=4 -march=core2 -fasynchronous-unwind-tables  -c distxy.c -o distxy.o
>> gcc -std=gnu99 -I/home/gavin/R/devel/build/include -DNDEBUG  -I/usr/local/include    -fpic  -g -O2 -pipe -m64 -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector --param=ssp-buffer-size=4 -march=core2 -fasynchronous-unwind-tables  -c wastats.c -o wastats.o
>> gcc -std=gnu99 -shared -L/usr/local/lib64 -o analogue.so c_distx.o c_distxy.o distx.o distxy.o wastats.o
>> installing to /tmp/Rtmpctxbtv/Rinst30e3f762569/analogue/libs
>> ** R
>> ** data
>> ** inst
>> ** byte-compile and prepare package for lazy loading
>> Error : package ?vegan? was built before R 3.0.0: please re-install it
>> ERROR: lazy loading failed for package ?analogue?
>> * removing ?/tmp/Rtmpctxbtv/Rinst30e3f762569/analogue?
>>       -----------------------------------
>> ERROR: package installation failed
>>
>> Can anyone suggest where to go from here?
>>
>> TIA
>>
>> Gavin
>
> --
> %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
>  Dr. Gavin Simpson             [t] +44 (0)20 7679 0522
>  ECRC, UCL Geography,          [f] +44 (0)20 7679 0565
>  Pearson Building,             [e] gavin.simpsonATNOSPAMucl.ac.uk
>  Gower Street, London          [w] http://www.ucl.ac.uk/~ucfagls/
>  UK. WC1E 6BT.                 [w] http://www.freshwaters.org.uk
> %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From hb at biostat.ucsf.edu  Wed Jan 16 18:03:14 2013
From: hb at biostat.ucsf.edu (Henrik Bengtsson)
Date: Wed, 16 Jan 2013 09:03:14 -0800
Subject: [Rd] Trouble building package using R in development
In-Reply-To: <CAFDcVCQmyZYLpT=vkFaT5feJSS4VcSBKR+VoNAtosVKXBhzU_A@mail.gmail.com>
References: <1358348706.4687.25.camel@chrysothemis.geog.ucl.ac.uk>
	<1358349920.4687.34.camel@chrysothemis.geog.ucl.ac.uk>
	<CAFDcVCQmyZYLpT=vkFaT5feJSS4VcSBKR+VoNAtosVKXBhzU_A@mail.gmail.com>
Message-ID: <CAFDcVCS9o7ujM4+sGkAp2tfgfNwiJGgTTJh+U85QnCUEXXOmMA@mail.gmail.com>

On Wed, Jan 16, 2013 at 8:59 AM, Henrik Bengtsson <hb at biostat.ucsf.edu> wrote:
> On Wed, Jan 16, 2013 at 7:25 AM, Gavin Simpson <gavin.simpson at ucl.ac.uk> wrote:
>> As a follow-up, shortly after I clicked send I decided to do something
>> silly and rename my ~/.Renviron (which set R_LIBS too). Silly because
>> the Writing R Extensions (WRE) manual says that these startup files are
>> not read as R is invoked with --vanilla.
>>
>> Once I renamed ~/.Renviron so it was not being read I was able to build
>> the package using R Under Development following the remaining
>> instructions in the WRE note [1]
>>
>> So I do wonder if I have misunderstood the note in WRE or if there is
>> some other issue here? Starting R --vanilla with R Under Development
>> wasn't reading ~/.Renviron, and by renaming ~/.Renviron that I was able
>> to build the package indicates that this file was implicated in the
>> problem I described.
>>
>> Is it intentional that R CMD build reads ~/.Renviron ? If it is, then
>> WRE should ideally clarify this or make it explicit. If it wasn't
>> supposed to be read, is there a bug here?
>
> FYI, related posts:
>
> * Rd thread 'R devel [and R 2.14.1 patched]: R CMD build now sources
> ~/.Rprofile' on Feb 23, 2012
> [https://stat.ethz.ch/pipermail/r-devel/2012-February/063365.html]
> * Rd thread 'R CMD build/check on Windows 7' on Jul 17, 2012
> [https://stat.ethz.ch/pipermail/r-devel/2012-July/064427.html]
>
> To circumvent this, I check using:
>
> R --no-init-file CMD check foo_1.0.tar.gz

Should have clarified that in your case you need to add '--no-environ'.

/Henrik

>
> /Henrik
>
>>
>> All the best,
>>
>> Gavin
>>
>> [1]
>> http://cran.r-project.org/doc/manuals/r-devel/R-exts.html#Checking-and-building-packages
>>
>> On Wed, 2013-01-16 at 16:05 +0100, Gavin Simpson wrote:
>>> Dear List,
>>>
>>> I'm having considerable trouble setting up my environment (Linux, Fedora
>>> 16, Bash) to build and check packages under R Under Development
>>> (r61660). I'm doing this to better get a handle on difference in the
>>> output from running checks on examples in one of my packages. Note I
>>> compiled R Under Development myself
>>>
>>> The problem I am now having is whenever I try to build my analogue
>>> package using R Under Development, R complains about a dependency having
>>> been built before R 3.0.0. I obviously don't have my environment
>>> variables set correctly, but I don't see why or how R is finding my
>>> daily-use package library; if anything I would have expected it to fail
>>> with a missing dependency.
>>>
>>> If I start Rdevel with --vanilla (to mimic Rdevel CMD build) I see:
>>>
>>> > .libPaths()
>>> [1] "/home/gavin/R/devlibs"             "/home/gavin/R/devel/build/library"
>>>
>>> the first entry there is because I have temporarily set R_LIBS to that
>>> directory via export R_LIBS=/home/gavin/R/devlibs. From there we see I
>>> have versions of the dependencies installed in this library and they are
>>> built with 3.0.0:
>>>
>>> > installed.packages("~/R/devlibs/")[, "Built", drop = FALSE]
>>>               Built
>>> analogue      "3.0.0"
>>> ctv           "3.0.0"
>>> permute       "3.0.0"
>>> princurve     "3.0.0"
>>> rgl           "3.0.0"
>>> scatterplot3d "3.0.0"
>>> vegan         "3.0.0"
>>>
>>> Note that there are no other versions of vegan inadvertently installed
>>> to the build directory for R Under Development.
>>>
>>> Following advice in Writing R Extensions I have also created
>>> ~/build.Renviron and ~/check.Renviron and as these are non-standard I
>>> also followed the advice to set R_BUILD_ENVIRON and R_CHECK_ENVIRON
>>> again temporarily via export:
>>>
>>> $ cat $R_CHECK_ENVIRON
>>> R_LIBS=/home/gavin/R/devlibs
>>>
>>> $ cat $R_BUILD_ENVIRON
>>> R_LIBS=/home/gavin/R/devlibs
>>>
>>> Yet still I get errors building analogue:
>>>
>>> $ Rdevel CMD build ../analogue/pkg/
>>> * checking for file ?../analogue/pkg/DESCRIPTION? ... OK
>>> * preparing ?analogue?:
>>> * checking DESCRIPTION meta-information ... OK
>>> * cleaning src
>>> * installing the package to re-build vignettes
>>>       -----------------------------------
>>> * installing *source* package ?analogue? ...
>>> ** libs
>>> gcc -std=gnu99 -I/home/gavin/R/devel/build/include -DNDEBUG  -I/usr/local/include    -fpic  -g -O2 -pipe -m64 -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector --param=ssp-buffer-size=4 -march=core2 -fasynchronous-unwind-tables  -c c_distx.c -o c_distx.o
>>> gcc -std=gnu99 -I/home/gavin/R/devel/build/include -DNDEBUG  -I/usr/local/include    -fpic  -g -O2 -pipe -m64 -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector --param=ssp-buffer-size=4 -march=core2 -fasynchronous-unwind-tables  -c c_distxy.c -o c_distxy.o
>>> gcc -std=gnu99 -I/home/gavin/R/devel/build/include -DNDEBUG  -I/usr/local/include    -fpic  -g -O2 -pipe -m64 -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector --param=ssp-buffer-size=4 -march=core2 -fasynchronous-unwind-tables  -c distx.c -o distx.o
>>> gcc -std=gnu99 -I/home/gavin/R/devel/build/include -DNDEBUG  -I/usr/local/include    -fpic  -g -O2 -pipe -m64 -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector --param=ssp-buffer-size=4 -march=core2 -fasynchronous-unwind-tables  -c distxy.c -o distxy.o
>>> gcc -std=gnu99 -I/home/gavin/R/devel/build/include -DNDEBUG  -I/usr/local/include    -fpic  -g -O2 -pipe -m64 -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector --param=ssp-buffer-size=4 -march=core2 -fasynchronous-unwind-tables  -c wastats.c -o wastats.o
>>> gcc -std=gnu99 -shared -L/usr/local/lib64 -o analogue.so c_distx.o c_distxy.o distx.o distxy.o wastats.o
>>> installing to /tmp/Rtmpctxbtv/Rinst30e3f762569/analogue/libs
>>> ** R
>>> ** data
>>> ** inst
>>> ** byte-compile and prepare package for lazy loading
>>> Error : package ?vegan? was built before R 3.0.0: please re-install it
>>> ERROR: lazy loading failed for package ?analogue?
>>> * removing ?/tmp/Rtmpctxbtv/Rinst30e3f762569/analogue?
>>>       -----------------------------------
>>> ERROR: package installation failed
>>>
>>> Can anyone suggest where to go from here?
>>>
>>> TIA
>>>
>>> Gavin
>>
>> --
>> %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
>>  Dr. Gavin Simpson             [t] +44 (0)20 7679 0522
>>  ECRC, UCL Geography,          [f] +44 (0)20 7679 0565
>>  Pearson Building,             [e] gavin.simpsonATNOSPAMucl.ac.uk
>>  Gower Street, London          [w] http://www.ucl.ac.uk/~ucfagls/
>>  UK. WC1E 6BT.                 [w] http://www.freshwaters.org.uk
>> %~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel


From friendly at yorku.ca  Wed Jan 16 18:28:30 2013
From: friendly at yorku.ca (Michael Friendly)
Date: Wed, 16 Jan 2013 12:28:30 -0500
Subject: [Rd] Declaring/importing non-exported functions [car] in
 another package
In-Reply-To: <50F6D805.1020309@gmail.com>
References: <50F6D469.3010305@yorku.ca> <50F6D805.1020309@gmail.com>
Message-ID: <50F6E33E.2080302@yorku.ca>

On 1/16/2013 11:40 AM, Duncan Murdoch wrote:
>
>> 2.  Is my only alternative to copy these functions to my package, also
>> unexported?
>
> Using car:::df.terms explicitly is another option.
>
> Another possibility is for the car maintainer (John Fox) to export 
> that function from car.
>
Hmm.  It turns out that this is a bit more complicated, since 
car::df.terms is an S3 generic,
relying on car:::df.terms.default().

In my function, I am now using car::: explicitly--

     # determine "size" of intervals [perhaps need importFrom(car, 
car:::df.terms, ...) in NAMESPACE?]
     if(is.null(df)) {
       df <- if (Scheffe) sum(car:::df.terms(object)) else 2
   }

However, when I removed the definitions of the subsidiary 
df.terms.default from my package, R CMD check
complains bitterly:

 > coefplot(mod, add=TRUE, Scheffe=TRUE, fill=TRUE)
Error in UseMethod("df.terms") :
   no applicable method for 'df.terms' applied to an object of class 
"c('mlm', 'lm')"
Calls: coefplot -> coefplot.mlm -> <Anonymous>
Execution halted

So, the semantics of importFrom() do not allow non-exported functions (I 
still wonder why), and my only direct option is to
copy these functions to my package.

-Michael

-- 
Michael Friendly     Email: friendly AT yorku DOT ca
Professor, Psychology Dept. & Chair, Quantitative Methods
York University      Voice: 416 736-2100 x66249 Fax: 416 736-5814
4700 Keele Street    Web:   http://www.datavis.ca
Toronto, ONT  M3J 1P3 CANADA


From jfox at mcmaster.ca  Wed Jan 16 18:26:52 2013
From: jfox at mcmaster.ca (John Fox)
Date: Wed, 16 Jan 2013 12:26:52 -0500
Subject: [Rd] Declaring/importing non-exported functions [car] in
	another package
In-Reply-To: <50F6D805.1020309@gmail.com>
References: <50F6D469.3010305@yorku.ca>
 <50F6D805.1020309@gmail.com>
Message-ID: <web-440510245@cgpsrv2.cis.mcmaster.ca>

Dear Duncan and Michael,

My initial reaction is that I'd rather not export these functions from the car package since the package already has many exported functions and the functions in question perform low-level operations that won't be of interest to end users. I recognize, however, the functions (and possibly some others) may be useful in other packages, such as heplots, so I'll think about this some more.

Following up on Michael's subsequent message in this thread, I find the current text in Sec. 1.6.1 ("Specifying imports and exports") of Writing R Extensions reasonably clear.

Best,
 John

On Wed, 16 Jan 2013 11:40:37 -0500
 Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
> On 13-01-16 11:25 AM, Michael Friendly wrote:
> > A new function in my heplots package wants to use a non-exported utility
> > function in the car package,
> > df.terms, but this depends on other non-exported functions.
> >   From the Writing R extensions manual, I thought I could do this via (in
> > my NAMESPACE)
> >
> > importFrom(car, car:::df.terms, car:::df.terms.default, car:::is.aliased)
> >
> > but I get:
> > ** preparing package for lazy loading
> > Error : objects 'car:::df.terms', 'car:::df.terms.default',
> > 'car:::is.aliased' are not exported by 'namespace:car'
> > ERROR: lazy loading failed for package 'heplots'
> >
> > \S 1.6.1 of the manual says regarding importFrom():
> > Using |foo:::f| instead of |foo::f| allows access to unexported objects.
> > This is generally not recommended, as the semantics of unexported
> > objects may be changed by the package author in routine maintenance.
> >
> > Questions:
> > 1.  Why doesn't this work?
> 
> I think you misread the manual.  It is talking about ways to access functions other than by using importFrom.  You can use car:::df.terms in your functions.
> 
> > 2.  Is my only alternative to copy these functions to my package, also
> > unexported?
> 
> Using car:::df.terms explicitly is another option.
> 
> Another possibility is for the car maintainer (John Fox) to export that function from car.
> 
> Duncan Murdoch


From friendly at yorku.ca  Wed Jan 16 18:52:15 2013
From: friendly at yorku.ca (Michael Friendly)
Date: Wed, 16 Jan 2013 12:52:15 -0500
Subject: [Rd] Declaring/importing non-exported functions [car] in
 another package
In-Reply-To: <web-440510245@cgpsrv2.cis.mcmaster.ca>
References: <50F6D469.3010305@yorku.ca> <50F6D805.1020309@gmail.com>
	<web-440510245@cgpsrv2.cis.mcmaster.ca>
Message-ID: <50F6E8CF.3030106@yorku.ca>

On 1/16/2013 12:26 PM, John Fox wrote:
> Dear Duncan and Michael,
>
> My initial reaction is that I'd rather not export these functions from the car package since the package already has many exported functions and the functions in question perform low-level operations that won't be of interest to end users. I recognize, however, the functions (and possibly some others) may be useful in other packages, such as heplots, so I'll think about this some more.
This is why I wrote directly to R-devel rather than to you.  It is 
low-level, and doesn't need to be exported.
OTOH, it provides an elegant way to provide Sheffe-type intervals & 
ellipses as you do in car::confidenceEllipse,
which I copied.

best,
-Michael

>
> Following up on Michael's subsequent message in this thread, I find the current text in Sec. 1.6.1 ("Specifying imports and exports") of Writing R Extensions reasonably clear.
>
> Best,
>   John
>
> On Wed, 16 Jan 2013 11:40:37 -0500
>   Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
>> On 13-01-16 11:25 AM, Michael Friendly wrote:
>>> A new function in my heplots package wants to use a non-exported utility
>>> function in the car package,
>>> df.terms, but this depends on other non-exported functions.
>>>    From the Writing R extensions manual, I thought I could do this via (in
>>> my NAMESPACE)
>>>
>>> importFrom(car, car:::df.terms, car:::df.terms.default, car:::is.aliased)
>>>
>>> but I get:
>>> ** preparing package for lazy loading
>>> Error : objects 'car:::df.terms', 'car:::df.terms.default',
>>> 'car:::is.aliased' are not exported by 'namespace:car'
>>> ERROR: lazy loading failed for package 'heplots'
>>>
>>> \S 1.6.1 of the manual says regarding importFrom():
>>> Using |foo:::f| instead of |foo::f| allows access to unexported objects.
>>> This is generally not recommended, as the semantics of unexported
>>> objects may be changed by the package author in routine maintenance.
>>>
>>> Questions:
>>> 1.  Why doesn't this work?
>> I think you misread the manual.  It is talking about ways to access functions other than by using importFrom.  You can use car:::df.terms in your functions.
>>
>>> 2.  Is my only alternative to copy these functions to my package, also
>>> unexported?
>> Using car:::df.terms explicitly is another option.
>>
>> Another possibility is for the car maintainer (John Fox) to export that function from car.
>>
>> Duncan Murdoch


-- 
Michael Friendly     Email: friendly AT yorku DOT ca
Professor, Psychology Dept. & Chair, Quantitative Methods
York University      Voice: 416 736-2100 x66249 Fax: 416 736-5814
4700 Keele Street    Web:   http://www.datavis.ca
Toronto, ONT  M3J 1P3 CANADA


From gavin.simpson at ucl.ac.uk  Wed Jan 16 21:13:34 2013
From: gavin.simpson at ucl.ac.uk (Gavin Simpson)
Date: Wed, 16 Jan 2013 21:13:34 +0100
Subject: [Rd] R CMD check not reading R_LIBS from ~/.R/check.Renviron
Message-ID: <1358367214.4687.43.camel@chrysothemis.geog.ucl.ac.uk>

Dear List,

Further to my earlier email, I note that, for me at least, R CMD check
is *not* reading R_LIBS from ~/.R/check.Renviron on R 2.15.2 patched
(r61228) and R Under Development (r61660). The only way I can get R CMD
check to look for packages in a user-supplied library is by explicitly
exporting R_LIBS set to the relevant directory.

R CMD build *does* read R_LIBS from ~/.R/build.Renviron for the same
versions of R on the same Fedora 16 laptop. So I am in the strange
situation of being able to build but not check a source package having
followed the instructions in Writing R Extensions.

I have tried exporting R_CHECK_ENVIRON via

    export R_CHECK_ENVIRON=/home/gavin/.R/check.Renviron

and that doesn't work either.

~/.R/check.Renviron contains:

R_LIBS=/home/gavin/R/libs/
#R_LIBS=/home/gavin/R/devlibs/

Anyone suggest how/where I am going wrong?

More complete system info follows below.

TIA

Gavin

> sessionInfo()
R version 2.15.2 Patched (2012-12-05 r61228)
Platform: x86_64-unknown-linux-gnu (64-bit)

locale:
 [1] LC_CTYPE=en_GB.utf8       LC_NUMERIC=C             
 [3] LC_TIME=en_GB.utf8        LC_COLLATE=en_GB.utf8    
 [5] LC_MONETARY=en_GB.utf8    LC_MESSAGES=en_GB.utf8   
 [7] LC_PAPER=C                LC_NAME=C                
 [9] LC_ADDRESS=C              LC_TELEPHONE=C           
[11] LC_MEASUREMENT=en_GB.utf8 LC_IDENTIFICATION=C      

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods  
[7] base 

> sessionInfo()
R Under development (unstable) (2013-01-16 r61660)
Platform: x86_64-unknown-linux-gnu (64-bit)

locale:
 [1] LC_CTYPE=en_GB.utf8       LC_NUMERIC=C             
 [3] LC_TIME=en_GB.utf8        LC_COLLATE=en_GB.utf8    
 [5] LC_MONETARY=en_GB.utf8    LC_MESSAGES=en_GB.utf8   
 [7] LC_PAPER=C                LC_NAME=C                
 [9] LC_ADDRESS=C              LC_TELEPHONE=C           
[11] LC_MEASUREMENT=en_GB.utf8 LC_IDENTIFICATION=C      

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods  
[7] base
-- 
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
 Dr. Gavin Simpson             [t] +44 (0)20 7679 0522
 ECRC, UCL Geography,          [f] +44 (0)20 7679 0565
 Pearson Building,             [e] gavin.simpsonATNOSPAMucl.ac.uk
 Gower Street, London          [w] http://www.ucl.ac.uk/~ucfagls/
 UK. WC1E 6BT.                 [w] http://www.freshwaters.org.uk
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%


From h.wickham at gmail.com  Wed Jan 16 21:39:46 2013
From: h.wickham at gmail.com (Hadley Wickham)
Date: Wed, 16 Jan 2013 14:39:46 -0600
Subject: [Rd] Trouble building package using R in development
In-Reply-To: <CAFDcVCQmyZYLpT=vkFaT5feJSS4VcSBKR+VoNAtosVKXBhzU_A@mail.gmail.com>
References: <1358348706.4687.25.camel@chrysothemis.geog.ucl.ac.uk>
	<1358349920.4687.34.camel@chrysothemis.geog.ucl.ac.uk>
	<CAFDcVCQmyZYLpT=vkFaT5feJSS4VcSBKR+VoNAtosVKXBhzU_A@mail.gmail.com>
Message-ID: <CABdHhvH8rMf+7_1vSXErW142vR=xctwXw6YyO6m0QyADxt-=nQ@mail.gmail.com>

> To circumvent this, I check using:
>
> R --no-init-file CMD check foo_1.0.tar.gz

In devtools, we take considerable care to match the R you're running
with the R you're checking in, so we also set the following
environmental variables:

env <- c(
    "LC_ALL" = "C",
    "R_LIBS" = paste(.libPaths(), collapse = .Platform$path.sep),
    "CYGWIN" = "nodosfilewarning",
    "R_TESTS" = "",
    "NOT_CRAN" = "true",
    "TAR" = auto_tar(),
)

and always run /path/to/current/R --vanilla CMD check ...

Hadley

-- 
Chief Scientist, RStudio
http://had.co.nz/


From gavin.simpson at ucl.ac.uk  Wed Jan 16 22:06:16 2013
From: gavin.simpson at ucl.ac.uk (Gavin Simpson)
Date: Wed, 16 Jan 2013 22:06:16 +0100
Subject: [Rd] Trouble building package using R in development
In-Reply-To: <CABdHhvH8rMf+7_1vSXErW142vR=xctwXw6YyO6m0QyADxt-=nQ@mail.gmail.com>
References: <1358348706.4687.25.camel@chrysothemis.geog.ucl.ac.uk>
	<1358349920.4687.34.camel@chrysothemis.geog.ucl.ac.uk>
	<CAFDcVCQmyZYLpT=vkFaT5feJSS4VcSBKR+VoNAtosVKXBhzU_A@mail.gmail.com>
	<CABdHhvH8rMf+7_1vSXErW142vR=xctwXw6YyO6m0QyADxt-=nQ@mail.gmail.com>
Message-ID: <1358370376.4687.48.camel@chrysothemis.geog.ucl.ac.uk>

On Wed, 2013-01-16 at 14:39 -0600, Hadley Wickham wrote:
> > To circumvent this, I check using:
> >
> > R --no-init-file CMD check foo_1.0.tar.gz
> 
> In devtools, we take considerable care to match the R you're running
> with the R you're checking in, so we also set the following
> environmental variables:
<snip />

Thanks Henrik & Hadley,

> and always run /path/to/current/R --vanilla CMD check ...

To what end is the --vanilla here? Writing R Extensions says that R CMD
check (and R CMD build) are invoked via R --vanilla so that would seem
redundant, although my experience from several hours working this
through today suggests there is a difference between R --vanilla CMD
check and R CMD check.

G

> Hadley
> 

-- 
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
 Dr. Gavin Simpson             [t] +44 (0)20 7679 0522
 ECRC, UCL Geography,          [f] +44 (0)20 7679 0565
 Pearson Building,             [e] gavin.simpsonATNOSPAMucl.ac.uk
 Gower Street, London          [w] http://www.ucl.ac.uk/~ucfagls/
 UK. WC1E 6BT.                 [w] http://www.freshwaters.org.uk
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%


From jari.oksanen at oulu.fi  Thu Jan 17 09:55:17 2013
From: jari.oksanen at oulu.fi (Jari Oksanen)
Date: Thu, 17 Jan 2013 08:55:17 +0000
Subject: [Rd] R CMD check not reading R_LIBS from ~/.R/check.Renviron
In-Reply-To: <1358367214.4687.43.camel@chrysothemis.geog.ucl.ac.uk>
References: <1358367214.4687.43.camel@chrysothemis.geog.ucl.ac.uk>
Message-ID: <66C03CD1145C95448A4D73676DD9C2ED3F7056@nippu1.univ.yo.oulu.fi>

Gav,

This is off-list since I only wonder what you are trying to do. It seems to me that you're trying something much too elegant and complicated. One thing that I have learnt to avoid is muck up with environments: that is calling trouble. One day they will change R and you will get errors that are very difficult to track (I had that once with gnome: I did not edit the config file manually, but only used configuration GUI tools, but then gnome changed and I could not start X11 after distro upgrade -- and it was difficult to track the reason).

What I do with R-devel and R release co-existence is that I keep them completely separate. I do  not install (make install) R-devel, but I leave it in its working directory. I have now a symbolic link in ~/bin ($HOME/bin):

cd ~/bin
ln -s ~/R-devel/bin/R R3

So when I want to run R 3.0.0 I use 'R3' and when I want to use stock R of my distro (no 2.15.1) use R. These are completely different beasts, and packages are installed separately for each so that they are 3.0.0 version in R3 and 2.15 versions in R. I don't edit environments, but always use defaults.

With this setup, analogue checks up smoothly with only comment coming from examples:

* checking differences from ?analogue-Ex.Rout? to ?analogue-Ex.Rout.save? ...
2c2
< This is vegan 2.1-23
---
> This is vegan 2.0-5
1104d1103
< Warning: argument 'tol.dw' is not used (yet)
4894d4892
< Warning: argument 'tol.dw' is not used (yet)
4933d4930
< Warning: argument 'tol.dw' is not used (yet)
6139d6135
< Warning: argument 'tol.dw' is not used (yet)
7078d7073
< Warning: argument 'tol.dw' is not used (yet)
7116d7110
< Warning: argument 'tol.dw' is not used (yet)
 OK

Cheers, Jari


________________________________________
From: r-devel-bounces at r-project.org [r-devel-bounces at r-project.org] on behalf of Gavin Simpson [gavin.simpson at ucl.ac.uk]
Sent: 16 January 2013 22:13
To: R Devel Mailing List
Subject: [Rd] R CMD check not reading R_LIBS from ~/.R/check.Renviron

Dear List,

Further to my earlier email, I note that, for me at least, R CMD check
is *not* reading R_LIBS from ~/.R/check.Renviron on R 2.15.2 patched
(r61228) and R Under Development (r61660). The only way I can get R CMD
check to look for packages in a user-supplied library is by explicitly
exporting R_LIBS set to the relevant directory.

R CMD build *does* read R_LIBS from ~/.R/build.Renviron for the same
versions of R on the same Fedora 16 laptop. So I am in the strange
situation of being able to build but not check a source package having
followed the instructions in Writing R Extensions.

I have tried exporting R_CHECK_ENVIRON via

    export R_CHECK_ENVIRON=/home/gavin/.R/check.Renviron

and that doesn't work either.

~/.R/check.Renviron contains:

R_LIBS=/home/gavin/R/libs/
#R_LIBS=/home/gavin/R/devlibs/

Anyone suggest how/where I am going wrong?

More complete system info follows below.

TIA

Gavin

> sessionInfo()
R version 2.15.2 Patched (2012-12-05 r61228)
Platform: x86_64-unknown-linux-gnu (64-bit)

locale:
 [1] LC_CTYPE=en_GB.utf8       LC_NUMERIC=C
 [3] LC_TIME=en_GB.utf8        LC_COLLATE=en_GB.utf8
 [5] LC_MONETARY=en_GB.utf8    LC_MESSAGES=en_GB.utf8
 [7] LC_PAPER=C                LC_NAME=C
 [9] LC_ADDRESS=C              LC_TELEPHONE=C
[11] LC_MEASUREMENT=en_GB.utf8 LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods
[7] base

> sessionInfo()
R Under development (unstable) (2013-01-16 r61660)
Platform: x86_64-unknown-linux-gnu (64-bit)

locale:
 [1] LC_CTYPE=en_GB.utf8       LC_NUMERIC=C
 [3] LC_TIME=en_GB.utf8        LC_COLLATE=en_GB.utf8
 [5] LC_MONETARY=en_GB.utf8    LC_MESSAGES=en_GB.utf8
 [7] LC_PAPER=C                LC_NAME=C
 [9] LC_ADDRESS=C              LC_TELEPHONE=C
[11] LC_MEASUREMENT=en_GB.utf8 LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods
[7] base
--
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
 Dr. Gavin Simpson             [t] +44 (0)20 7679 0522
 ECRC, UCL Geography,          [f] +44 (0)20 7679 0565
 Pearson Building,             [e] gavin.simpsonATNOSPAMucl.ac.uk
 Gower Street, London          [w] http://www.ucl.ac.uk/~ucfagls/
 UK. WC1E 6BT.                 [w] http://www.freshwaters.org.uk
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%

______________________________________________
R-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-devel


From maechler at stat.math.ethz.ch  Thu Jan 17 14:37:47 2013
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Thu, 17 Jan 2013 14:37:47 +0100
Subject: [Rd] Declaring/importing non-exported functions [car] in
 another package
In-Reply-To: <50F6E8CF.3030106@yorku.ca>
References: <50F6D469.3010305@yorku.ca> <50F6D805.1020309@gmail.com>
	<web-440510245@cgpsrv2.cis.mcmaster.ca> <50F6E8CF.3030106@yorku.ca>
Message-ID: <20727.65195.119818.84702@stat.math.ethz.ch>

>>>>> Michael Friendly <friendly at yorku.ca>
>>>>>     on Wed, 16 Jan 2013 12:52:15 -0500 writes:

    > On 1/16/2013 12:26 PM, John Fox wrote:
    >> Dear Duncan and Michael,
    >> 
    >> My initial reaction is that I'd rather not export these
    >> functions from the car package since the package already
    >> has many exported functions and the functions in question
    >> perform low-level operations that won't be of interest to
    >> end users. I recognize, however, the functions (and
    >> possibly some others) may be useful in other packages,
    >> such as heplots, so I'll think about this some more.

    > This is why I wrote directly to R-devel rather than to
    > you.  It is low-level, and doesn't need to be exported.
    > OTOH, it provides an elegant way to provide Sheffe-type
    > intervals & ellipses as you do in car::confidenceEllipse,
    > which I copied.

If it provides an elegant way to something that is useful to
other useRs, it should be exported, ideally.

Consequently, if the author is willing to document and support
it, I'd strongly suggest it be exported.

Martin


    > best, -Michael

    >> 
    >> Following up on Michael's subsequent message in this
    >> thread, I find the current text in Sec. 1.6.1
    >> ("Specifying imports and exports") of Writing R
    >> Extensions reasonably clear.
    >> 
    >> Best, John
    >> 
    >> On Wed, 16 Jan 2013 11:40:37 -0500 Duncan Murdoch
    >> <murdoch.duncan at gmail.com> wrote:
    >>> On 13-01-16 11:25 AM, Michael Friendly wrote:
    >>>> A new function in my heplots package wants to use a
    >>>> non-exported utility function in the car package,
    >>>> df.terms, but this depends on other non-exported
    >>>> functions.  From the Writing R extensions manual, I
    >>>> thought I could do this via (in my NAMESPACE)
    >>>> 
    >>>> importFrom(car, car:::df.terms, car:::df.terms.default,
    >>>> car:::is.aliased)
    >>>> 
    >>>> but I get: ** preparing package for lazy loading Error
    >>>> : objects 'car:::df.terms', 'car:::df.terms.default',
    >>>> 'car:::is.aliased' are not exported by 'namespace:car'
    >>>> ERROR: lazy loading failed for package 'heplots'
    >>>> 
    >>>> \S 1.6.1 of the manual says regarding importFrom():
    >>>> Using |foo:::f| instead of |foo::f| allows access to
    >>>> unexported objects.  This is generally not recommended,
    >>>> as the semantics of unexported objects may be changed
    >>>> by the package author in routine maintenance.
    >>>> 
    >>>> Questions: 1.  Why doesn't this work?
    >>> I think you misread the manual.  It is talking about
    >>> ways to access functions other than by using importFrom.
    >>> You can use car:::df.terms in your functions.
    >>> 
    >>>> 2.  Is my only alternative to copy these functions to
    >>>> my package, also unexported?
    >>> Using car:::df.terms explicitly is another option.
    >>> 
    >>> Another possibility is for the car maintainer (John Fox)
    >>> to export that function from car.
    >>> 
    >>> Duncan Murdoch


    > -- 
    > Michael Friendly Email: friendly AT yorku DOT ca
    > Professor, Psychology Dept. & Chair, Quantitative Methods
    > York University Voice: 416 736-2100 x66249 Fax: 416
    > 736-5814 4700 Keele Street Web: http://www.datavis.ca
    > Toronto, ONT M3J 1P3 CANADA

    > ______________________________________________
    > R-devel at r-project.org mailing list
    > https://stat.ethz.ch/mailman/listinfo/r-devel


From htl10 at users.sourceforge.net  Thu Jan 17 15:49:23 2013
From: htl10 at users.sourceforge.net (Hin-Tak Leung)
Date: Thu, 17 Jan 2013 14:49:23 +0000 (GMT)
Subject: [Rd] FYI cairo/freetype issues affecting cairo_pdf ;
	& using non-English in R code.
Message-ID: <1358434163.2932.YahooMailClassic@web172301.mail.ir2.yahoo.com>

Affecting cairo 1.11.2+ and most versions of freetype.
https://bugzilla.redhat.com/show_bug.cgi?id=891457
The initial problem was seen with R Sweave, but eventually traced back to cairo then onto freetype (comment 10, 13 and comment 33).

Leading up to the whole thing was a new vignette I was writing - more or less about using as much non-English in R code as possible. One interesting use would be for hiding source code in plain sight... I am sure there are other use.

http://sourceforge.net/projects/outmodedbonsai/files/snpMatrix next/1.19.0.18/



From wuolong at gmail.com  Thu Jan 17 16:52:08 2013
From: wuolong at gmail.com (Michael Li)
Date: Thu, 17 Jan 2013 10:52:08 -0500
Subject: [Rd] rpvm arch check
In-Reply-To: <00064623-6B78-4C0E-84B0-EFD2053B1B19@r-project.org>
References: <CAGgMibL9HqfjN1LMA9S_7oEck9kmD4ccEdbP3XZ8-B+EHGg8mg@mail.gmail.com>
	<00064623-6B78-4C0E-84B0-EFD2053B1B19@r-project.org>
Message-ID: <CAGgMibL-JM9Sey-ukPZOC7wLO92yHL0d9sapJb1RkKDSWPym+w@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20130117/5dab2755/attachment.pl>

From simon.urbanek at r-project.org  Thu Jan 17 17:07:04 2013
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Thu, 17 Jan 2013 11:07:04 -0500
Subject: [Rd] rpvm arch check
In-Reply-To: <CAGgMibL-JM9Sey-ukPZOC7wLO92yHL0d9sapJb1RkKDSWPym+w@mail.gmail.com>
References: <CAGgMibL9HqfjN1LMA9S_7oEck9kmD4ccEdbP3XZ8-B+EHGg8mg@mail.gmail.com>
	<00064623-6B78-4C0E-84B0-EFD2053B1B19@r-project.org>
	<CAGgMibL-JM9Sey-ukPZOC7wLO92yHL0d9sapJb1RkKDSWPym+w@mail.gmail.com>
Message-ID: <ED7032DB-ADC3-4BF2-8991-71B1BCAF4CAB@r-project.org>

On Jan 17, 2013, at 10:52 AM, Michael Li wrote:

> OK. I will upload the updated version to CRAN and see if there is any problem with the checking. 
> 
> One additional question, if a user decides to build the library from source he may still encounter the problem. Is there a way (though configure.in  file maybe) to detect the architecture of the external library (libpvm.a) and use the correct architecture automatically when compiling rpvm code?
> 

That is automatic - multi-lib compilers will only pick libraries for the architecture that is currently being compiled.

If you are using autoconf [properly], it will detect the libraries for the architecture being compiled at the time. There is really nothing you as an author need to do as long as you are aware of the multi-arch setup of R.

It seems that rpvm has been removed from CRAN so I cannot comment on the rpvm package in particular.

Cheers,
Simon


> Thanks, 
> 
> Michael
> 
> 
> On Tue, Jan 15, 2013 at 8:53 PM, Simon Urbanek <simon.urbanek at r-project.org> wrote:
> On Jan 15, 2013, at 2:24 PM, Michael Li wrote:
> 
> > I've trying to fix the check error in rpvm package. Right now on my Mac, I use darwinport to install PVM and I can get rpvm to pass the check using 'R -arch x86_64 CMD check'. However the default 'R CMD check' uses i386 which fails since PVM is built for x86_64 only.
> >
> > So is there a way to ensure proper architecture is used that matches that of the external library like PVM? What does CRAN use when it checks packages?
> >
> 
> We use static builds which have all necessary architectures (so users don't need to install them and can use any architecture).
> 
> Cheers,
> Simon
> 
> 


From luke-tierney at uiowa.edu  Thu Jan 17 20:26:58 2013
From: luke-tierney at uiowa.edu (luke-tierney at uiowa.edu)
Date: Thu, 17 Jan 2013 13:26:58 -0600
Subject: [Rd] Bug in list subset assignment due to NAMED optimization
In-Reply-To: <CALLn38PewFgLO-SnLv+8Pk5UDpDKwJFX4rtrV9w5VOC8Os4u-A@mail.gmail.com>
References: <CALLn38PewFgLO-SnLv+8Pk5UDpDKwJFX4rtrV9w5VOC8Os4u-A@mail.gmail.com>
Message-ID: <alpine.LFD.2.03.1301171325530.1915@uiowa.edu>

Thanks for the report.  This is now fixed in R-devel and R-patched
by increasing NAMED on the RHS value to 2 when it is not 0.

Best,

luke

On Tue, 8 Jan 2013, Justin Talbot wrote:

> In R version 2.15.2 (2012-10-26) i386-apple-darwin9.8.0/i386 (32-bit) I get
> the following:
>
>> a <- list(1)
>> (a[[1]] <- a)
> [[1]]
> [[1]][[1]]
> [1] 1
>
> but
>
>> a <- list(1)
>> b <- a
>> (a[[1]] <- a)
> [[1]]
> [1] 1
>
> And similarly:
>
>> a <- list(x=1)
>> (a$x <- a)
> $x
> $x$x
> [1] 1
>
> but
>
>> a <- list(x=1)
>> b <- a
>> (a$x <- a)
> $x
> [1] 1
>
> In both cases the result of the first sequence is wrong. It's returning the
> updated `a` rather than the RHS of the assignment. The second sequence in
> both cases is correct; the assignment to `b` increments the NAMED value
> causing the necessary copy to be made so the RHS is returned from the
> assignment.
>
> Would it be sufficient to add a check to do_subassign2_dflt
> and do_subassign3_dflt that creates a duplicate of the LHS if the LHS & RHS
> are the same object?
>
> Justin
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Luke Tierney
Chair, Statistics and Actuarial Science
Ralph E. Wareham Professor of Mathematical Sciences
University of Iowa                  Phone:             319-335-3386
Department of Statistics and        Fax:               319-335-3017
    Actuarial Science
241 Schaeffer Hall                  email:   luke-tierney at uiowa.edu
Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu


From vitaliy.feoktistov at gmail.com  Fri Jan 18 12:24:40 2013
From: vitaliy.feoktistov at gmail.com (Vitaliy FEOKTISTOV)
Date: Fri, 18 Jan 2013 12:24:40 +0100
Subject: [Rd] debugging C/Fortran code with Visual Studio and Intel compilers
Message-ID: <CAGHrqz8VzjLjPVXnJk5NRQ-qttp3s_9sZuKb3Gyk=L2bYk8REw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20130118/161b7256/attachment.pl>

From murdoch.duncan at gmail.com  Fri Jan 18 12:46:29 2013
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Fri, 18 Jan 2013 06:46:29 -0500
Subject: [Rd] debugging C/Fortran code with Visual Studio and Intel
	compilers
In-Reply-To: <CAGHrqz8VzjLjPVXnJk5NRQ-qttp3s_9sZuKb3Gyk=L2bYk8REw@mail.gmail.com>
References: <CAGHrqz8VzjLjPVXnJk5NRQ-qttp3s_9sZuKb3Gyk=L2bYk8REw@mail.gmail.com>
Message-ID: <50F93615.3020203@gmail.com>

On 13-01-18 6:24 AM, Vitaliy FEOKTISTOV wrote:
> Hello,
>
> My R code calles a C/Fortran dll and I want to debug C code using Visual
> Studio and Intel compilers /debugger
>
> Debugging with Rcpp and RInsight does not work correctly on Windows.
>
> Is there some other way to set breakpoints in C code and access to
> variables ?


I've rarely used those compilers, but I've used two strategies for 
situations like that.

1.  Start Rgui.exe in some debugger that works with your compiler.  It 
won't know how to handle R debug info (and unless you've recompiled R 
there won't be any), but you should be able to set breakpoints in your 
own code.  If your debugger won't set code in an unloaded DLL, you can 
run R, attach the package, then interrupt R to set breakpoints.

2.  If you want to trigger a call to the debugger from your code, there 
are Windows API functions to do that (but I never had any luck with 
them); you may also be able to execute

   asm("int $3");

in your function to trigger a debug interrupt.  This is a little 
dangerous, because I think it will crash R if a debugger is not attached.

Or you can use the old fashioned debugging methods, and just insert lots 
of Rprintf() calls into your C code.  This is quite painful, but 
sometimes is necessary.

Duncan Murdoch


From h.wickham at gmail.com  Fri Jan 18 15:52:46 2013
From: h.wickham at gmail.com (Hadley Wickham)
Date: Fri, 18 Jan 2013 08:52:46 -0600
Subject: [Rd] Trouble building package using R in development
In-Reply-To: <1358370376.4687.48.camel@chrysothemis.geog.ucl.ac.uk>
References: <1358348706.4687.25.camel@chrysothemis.geog.ucl.ac.uk>
	<1358349920.4687.34.camel@chrysothemis.geog.ucl.ac.uk>
	<CAFDcVCQmyZYLpT=vkFaT5feJSS4VcSBKR+VoNAtosVKXBhzU_A@mail.gmail.com>
	<CABdHhvH8rMf+7_1vSXErW142vR=xctwXw6YyO6m0QyADxt-=nQ@mail.gmail.com>
	<1358370376.4687.48.camel@chrysothemis.geog.ucl.ac.uk>
Message-ID: <CABdHhvGbYp+=ayDrTmncbSiu3W09a+mNrKcmvBvS3iP36SZdLg@mail.gmail.com>

> To what end is the --vanilla here? Writing R Extensions says that R CMD
> check (and R CMD build) are invoked via R --vanilla so that would seem
> redundant, although my experience from several hours working this
> through today suggests there is a difference between R --vanilla CMD
> check and R CMD check.

Maybe that's new? We've certainly had problems with R CMD reading user
startup files, which is why we starting using --vanilla.

Hadley

-- 
Chief Scientist, RStudio
http://had.co.nz/


From pgilbert902 at gmail.com  Fri Jan 18 20:04:13 2013
From: pgilbert902 at gmail.com (Paul Gilbert)
Date: Fri, 18 Jan 2013 14:04:13 -0500
Subject: [Rd] maintaining multiple R versions
Message-ID: <50F99CAD.2000401@gmail.com>

(somewhat related to thread [Rd] R CMD check not reading R_LIBS )

For many years I have maintained R versions by building R (./configure ; 
make)  in a directory indicating the version number, putting the 
directory/bin on my path, and setting R_LIBS_SITE.

It seems only one version can easily be installing in /usr/bin, and in 
any case that requires root, so I do not do that. There may be an 
advantage to installing somewhere in a directory with the version 
number, but that does not remove the need to set my path. (If there is 
an advantage to installing I would appreciate someone explaining briefly 
what it is.)

My main question is whether there is a better ways to maintaining 
multiple versions, in some way that lets users choose which one they are 
using?

(The only problem I am aware of with my current way of doing this is:
if the system has some R in /usr/bin then I have to set my preferred 
version first, which means shell commands like "man" find R's pager 
first, and do not work.)

Thanks,
Paul


From kingaa at umich.edu  Fri Jan 18 20:58:27 2013
From: kingaa at umich.edu (Aaron A. King)
Date: Fri, 18 Jan 2013 14:58:27 -0500
Subject: [Rd] maintaining multiple R versions
In-Reply-To: <50F99CAD.2000401@gmail.com>
References: <50F99CAD.2000401@gmail.com>
Message-ID: <20130118195826.GA16033@eeb-tilia.eeb.lsa.umich.edu>

Have you looked at Environment Modules (http://modules.sourceforge.net/)?  I use it to maintain multiple versions of R.  Users can choose their default and switch among them at the command line.

Aaron

On Fri, Jan 18, 2013 at 02:04:13PM -0500, Paul Gilbert wrote:
> (somewhat related to thread [Rd] R CMD check not reading R_LIBS )
> 
> For many years I have maintained R versions by building R
> (./configure ; make)  in a directory indicating the version number,
> putting the directory/bin on my path, and setting R_LIBS_SITE.
> 
> It seems only one version can easily be installing in /usr/bin, and
> in any case that requires root, so I do not do that. There may be an
> advantage to installing somewhere in a directory with the version
> number, but that does not remove the need to set my path. (If there
> is an advantage to installing I would appreciate someone explaining
> briefly what it is.)
> 
> My main question is whether there is a better ways to maintaining
> multiple versions, in some way that lets users choose which one they
> are using?
> 
> (The only problem I am aware of with my current way of doing this is:
> if the system has some R in /usr/bin then I have to set my preferred
> version first, which means shell commands like "man" find R's pager
> first, and do not work.)
> 
> Thanks,
> Paul
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Aaron A. King, Ph.D.
Ecology & Evolutionary Biology
Mathematics
Center for the Study of Complex Systems
University of Michigan
GPG Public Key: 0x15780975


From hpages at fhcrc.org  Sat Jan 19 00:55:38 2013
From: hpages at fhcrc.org (=?windows-1252?Q?Herv=E9_Pag=E8s?=)
Date: Fri, 18 Jan 2013 15:55:38 -0800
Subject: [Rd] utils::tar() and files >= 2GB
Message-ID: <50F9E0FA.5010108@fhcrc.org>

Hi,

The current implementation for utils::tar() seems to generate broken
tarballs when some of the files to include in the tarball are >= 2GB.

For example, when running 'R CMD build' on a big Bioconductor data
package, we see this warning:

   * checking for file ?ChIPXpressData/DESCRIPTION? ... OK
   * preparing ?ChIPXpressData?:
   * checking DESCRIPTION meta-information ... OK
   * checking for LF line-endings in source and make files
   * checking for empty or unneeded directories
   * building ?ChIPXpressData_0.99.1.tar.gz?
   Warning in sprintf("%011o", as.integer(size)) :
     NAs introduced by coercion

probably because 'size' was > .Machine$integer.max for one of the files
included in the tarball. This suggests that the resulting tarball might
be incorrect. Which is confirmed later when running 'tar ztvf' on that
tarball from the Unix comand line:

   -rw-r--r-- biocbuild/phs_compbio 38 2012-12-11 09:37 
ChIPXpressData/.BBSoptions
   -rw-r--r-- biocbuild/phs_compbio 442 2013-01-18 12:04 
ChIPXpressData/DESCRIPTION
   -rw-r--r-- biocbuild/phs_compbio   0 2012-12-11 09:37 
ChIPXpressData/NAMESPACE
   -rw-r--r-- biocbuild/phs_compbio  14 2012-12-11 09:37 
ChIPXpressData/external_data_store.txt
   drwxr-xr-x biocbuild/phs_compbio   0 2012-12-20 13:00 
ChIPXpressData/inst/
   drwxr-xr-x biocbuild/phs_compbio   0 2012-12-20 13:15 
ChIPXpressData/inst/extdata/
   -rw-r--r-- biocbuild/phs_compbio 1601278008 2012-12-20 13:15 
ChIPXpressData/inst/extdata/DB_GPL1261.bigmemory
   -rw-r--r-- biocbuild/phs_compbio     210497 2012-12-20 13:14 
ChIPXpressData/inst/extdata/DB_GPL1261.bigmemory.desc
   tar: Archive contains `  ' where numeric off_t value expected
   -rw-r--r-- biocbuild/phs_compbio 18446744073709551615 2012-12-20 
13:15 ChIPXpressData/inst/extdata/DB_GPL570.bigmemory
tar: Skipping to next header
   -rw-r--r-- biocbuild/phs_compbio               193165 2012-12-20 
13:14 ChIPXpressData/inst/extdata/DB_GPL570.bigmemory.desc
drwxr-xr-x biocbuild/phs_compbio                    0 2012-12-11 09:37 
ChIPXpressData/man/
   -rw-r--r-- biocbuild/phs_compbio                  863 2012-12-11 
09:37 ChIPXpressData/man/ChIPXpressData-package.Rd
   -rw-r--r-- biocbuild/phs_compbio                 1891 2012-12-11 
09:37 ChIPXpressData/man/DB_GPL1261.bigmemory.Rd
   -rw-r--r-- biocbuild/phs_compbio                 1888 2012-12-11 
09:37 ChIPXpressData/man/DB_GPL570.bigmemory.Rd
   tar: Exiting with failure status due to previous errors

Also, not too surprisingly, 'R CMD check' on this tarball fails, but
with a somewhat obscure error message:

   Error in getOct(block, 124, 12) : invalid octal digit
   Execution halted

Would it make sense to support files that are >= 2GB, possibly with a
warning about portability issues, if there are any? If not, maybe
utils::tar() (and consequently 'R CMD build') should just fail, with
an informative error message.

Thanks,
H.

 > sessionInfo()
R Under development (unstable) (2013-01-03 r61544)
Platform: x86_64-unknown-linux-gnu (64-bit)

locale:
  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
  [7] LC_PAPER=C                 LC_NAME=C
  [9] LC_ADDRESS=C               LC_TELEPHONE=C
[11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M1-B514
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fhcrc.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From hankin.robin at gmail.com  Tue Jan 22 02:33:40 2013
From: hankin.robin at gmail.com (robin hankin)
Date: Tue, 22 Jan 2013 14:33:40 +1300
Subject: [Rd] file.system() in packages
Message-ID: <CAHHjBM5WffjRPiTMfWcZdMSZ=vLbU0aeoX7nJa+WwsarYessXg@mail.gmail.com>

Hello.  R-devel, r61697.

I am having difficulty interpreting section 1.4 "Writing package
vignettes" of the R-exts manual.  Specifically, I want to use
system.file() in some of my packages to locate a bib file,
uncertainty.bib, which is part of the emulator package.  I only want
to maintain a single .bib file.

R-exts says: "All other files needed to re-make the vignette PDFs
(such as ... BiBTeX input files) must in the vignette source
directory".  So I've put my Rnw file and also the bib file in
emulator/vignettes/ directory.

And indeed, following R CMD build and then R CMD INSTALL on the
tarball, I can see the Rnw file:

> system.file("doc","emulex.Rnw",package="emulator")
[1] "/home/rksh/Rd/lib64/R/library/emulator/doc/emulex.Rnw"
>

so I know system.file() works as desired.  But I can't find
uncertainty.bib as R CMD INSTALL does not copy it to the system:

> system.file("doc","uncertainty.bib",package="emulator")
[1] ""
>

So I can't retrieve uncertainty.bib and this means that several other
packages can't bibtex correctly.  Can anyone advise?


--
Robin Hankin
Uncertainty Analyst
hankin.robin at gmail.com


From ripley at stats.ox.ac.uk  Tue Jan 22 03:07:21 2013
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 22 Jan 2013 02:07:21 +0000
Subject: [Rd] file.system() in packages
In-Reply-To: <CAHHjBM5WffjRPiTMfWcZdMSZ=vLbU0aeoX7nJa+WwsarYessXg@mail.gmail.com>
References: <CAHHjBM5WffjRPiTMfWcZdMSZ=vLbU0aeoX7nJa+WwsarYessXg@mail.gmail.com>
Message-ID: <50FDF459.2090809@stats.ox.ac.uk>

On 22/01/2013 01:33, robin hankin wrote:
> Hello.  R-devel, r61697.
>
> I am having difficulty interpreting section 1.4 "Writing package
> vignettes" of the R-exts manual.  Specifically, I want to use
> system.file() in some of my packages to locate a bib file,
> uncertainty.bib, which is part of the emulator package.  I only want
> to maintain a single .bib file.
>
> R-exts says: "All other files needed to re-make the vignette PDFs
> (such as ... BiBTeX input files) must in the vignette source
> directory".  So I've put my Rnw file and also the bib file in
> emulator/vignettes/ directory.
>
> And indeed, following R CMD build and then R CMD INSTALL on the
> tarball, I can see the Rnw file:
>
>> system.file("doc","emulex.Rnw",package="emulator")
> [1] "/home/rksh/Rd/lib64/R/library/emulator/doc/emulex.Rnw"
>>
>
> so I know system.file() works as desired.  But I can't find
> uncertainty.bib as R CMD INSTALL does not copy it to the system:
>
>> system.file("doc","uncertainty.bib",package="emulator")
> [1] ""
>>
>
> So I can't retrieve uncertainty.bib and this means that several other
> packages can't bibtex correctly.  Can anyone advise?

Read on:

'When R CMD build builds the vignette PDFs, it copies these and the 
vignette sources from directory vignettes to inst/doc. To install any 
other files from the vignettes directory, include a file 
vignettes/.install_extras which specifies these as Perl-like regular 
expressions on one or more lines. (See the description of the 
.Rinstignore file for full details.)'

>
>
> --
> Robin Hankin
> Uncertainty Analyst
> hankin.robin at gmail.com
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From edd at debian.org  Tue Jan 22 03:53:45 2013
From: edd at debian.org (Dirk Eddelbuettel)
Date: Mon, 21 Jan 2013 20:53:45 -0600
Subject: [Rd] file.system() in packages
In-Reply-To: <50FDF459.2090809@stats.ox.ac.uk>
References: <CAHHjBM5WffjRPiTMfWcZdMSZ=vLbU0aeoX7nJa+WwsarYessXg@mail.gmail.com>
	<50FDF459.2090809@stats.ox.ac.uk>
Message-ID: <20733.65337.284200.889502@max.nulle.part>


Robin,

Rcpp is experimenting with a 'callback' scheme in vignettes.  

For this, Rcpp itself has an unexported function bib() defined as

    bib <- function() {
       sub("\\.bib$", "", system.file( "doc", "Rcpp.bib", package = "Rcpp" ) )
    }

and packages depending on Rcpp can then do this in the vignette header:

    RcppBibfile <- sub("\\.bib$", "", Rcpp:::bib())

which gets used towards the end of the Rnw file as

    \bibliography{\Sexpr{RcppBibfile}}

I think so far only one package is using it.

Hth, Dirk

-- 
Dirk Eddelbuettel | edd at debian.org | http://dirk.eddelbuettel.com


From deville.yves at alpestat.com  Tue Jan 22 13:09:40 2013
From: deville.yves at alpestat.com (Yves Deville)
Date: Tue, 22 Jan 2013 13:09:40 +0100
Subject: [Rd] ordering in 'gnls' with 'corCompSymm' corStruct
Message-ID: <50FE8184.5060309@alpestat.com>

Dear R-devel members,

While writing a new correlation structure similar to 'corCompSymm' and 
intended to be used with 'gnls', I got puzzled with the 'Initialize' method.

Using 'Initialize' before 'gnls' may be regarded as a mean to set an 
initial value for the corStruct parameter. However 'gnls' does not work 
properly with a 'corCompSymm' correlation structure when the data frame 
is not suitably ordered by group and when 'Initialize' is used for the 
corStruct before calling 'gnls'. Maybe the documentation could warn 
about this problem?

As an example, the results of 'fit1' and 'fit2' below are different, and 
only 'fit1' gives the good results. The problem remains if we drop the 
0.2  (for the 'value' formal) when calling Initialize.

My explanation is that when 'Initialize' is used with a 'corCompSymm' 
object and a data frame which is not sorted by the group variable, the 
'start' indices computed by the 'Dim' method are misleading. These 
'start' values will remain attached to the object in 'gnls' even though 
the data frame is sorted therein, since the call to 'Initialize' within 
'gnls' will not then change them. If this explanation is true, 
'Initialize.corCompSymm' should not accept an unordered 'data' formal, 
or should sort the data before computing 'start' with 'match'.

Best

Yves Deville, statistical consultant. France

##-----------------------------------------------------------------------------------
## generate grouped data
M <- 20
set.seed(123)
Ni <- 1 + rpois(M, lambda = 4); N <- sum(Ni)
grp <- factor(rep(1:M, times = Ni))
x <- lapply(Ni, function(n) 1:n)
y <- lapply(x, function(x) 1 + 2*x + rnorm(1) + rnorm(length(x)))
dataOrd <- data.frame(grp = grp, x = unlist(x), y = unlist(y))
## change order
ind <- sample(1:N); dataUnOrd <- dataOrd[ind, ]

library(nlme)
cS1 <- corCompSymm(0.2, form = ~ 1 | grp)
fit1 <- gnls(model = y ~ a + b*x, data = dataUnOrd, start = c(a = 0.1, b 
= 0.3),
             correlation = cS1)     
## the same with 'Initialize'
cS2 <- corCompSymm(0.2, form = ~ 1 | grp)
cS2 <- Initialize(cS2, data = dataUnOrd)
fit2 <- gnls(model = y ~ a + b*x, data = dataUnOrd, start = c(a = 0.1, b 
= 0.3),
             correlation = cS2)  

## Dim does not give the good 'start' on 'cS2'
cS3 <- corCompSymm(0.2, form = ~ 1 | grp)
cS3 <- Initialize(cS3, data = dataOrd)
Dim(cS2)$start
Dim(cS3)$start
##----------------------------------------------------------------------------------


From anilomjf at gmail.com  Tue Jan 22 13:47:33 2013
From: anilomjf at gmail.com (Francisco Javier Molina Lopez)
Date: Tue, 22 Jan 2013 13:47:33 +0100
Subject: [Rd] R_tabulate
Message-ID: <CA+haZ2heKkhR1tAKAdiS=QeCX74=9ykA9MrGaEsEEfXJQ2tjHg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20130122/e86dbab3/attachment.pl>

From ripley at stats.ox.ac.uk  Tue Jan 22 15:02:24 2013
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 22 Jan 2013 14:02:24 +0000
Subject: [Rd] R_tabulate
In-Reply-To: <CA+haZ2heKkhR1tAKAdiS=QeCX74=9ykA9MrGaEsEEfXJQ2tjHg@mail.gmail.com>
References: <CA+haZ2heKkhR1tAKAdiS=QeCX74=9ykA9MrGaEsEEfXJQ2tjHg@mail.gmail.com>
Message-ID: <50FE9BF0.2080701@stats.ox.ac.uk>

On 22/01/13 12:47, Francisco Javier Molina Lopez wrote:
> How could I get the code of the inner function ( written in C, I guess ) of
> R_tabulate?
> This function is used by R function tabulate.

Hmm, not so in current R 2.15.2, which uses R_Tabulate.

You will find it in the appropriate R sources.  Most likely in file 
src/appl/tabulate.c (you did not mention a version of R).


-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From marius.hofert at math.ethz.ch  Wed Jan 23 00:22:46 2013
From: marius.hofert at math.ethz.ch (Marius Hofert)
Date: Wed, 23 Jan 2013 00:22:46 +0100
Subject: [Rd] Length of seed for l'Ecuyer-CMRG
Message-ID: <871udczttl.fsf@sklar.v.cablecom.net>

Dear expeRts,

./src/library/base/man/Random.Rd says that L'Ecuyer requires a seed of length 6.

./src/library/parallel/man/RngStream.Rd also mentions this, but only in the text
part; In the "Arguments"-part, it says that "seed" has to be of length 7

Also:

,----
| > RNGkind("L'Ecuyer-CMRG")
| > length(.Random.seed)
| [1] 7
`----

Is the docu old? Some clarification on the two .Rd files would be great. 

Cheers,

Marius


From ripley at stats.ox.ac.uk  Wed Jan 23 08:16:55 2013
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 23 Jan 2013 07:16:55 +0000
Subject: [Rd] Length of seed for l'Ecuyer-CMRG
In-Reply-To: <871udczttl.fsf@sklar.v.cablecom.net>
References: <871udczttl.fsf@sklar.v.cablecom.net>
Message-ID: <50FF8E67.4040902@stats.ox.ac.uk>

On 22/01/2013 23:22, Marius Hofert wrote:
> Dear expeRts,
>
> ./src/library/base/man/Random.Rd says that L'Ecuyer requires a seed of length 6.
>
> ./src/library/parallel/man/RngStream.Rd also mentions this, but only in the text
> part; In the "Arguments"-part, it says that "seed" has to be of length 7
>
> Also:
>
> ,----
> | > RNGkind("L'Ecuyer-CMRG")
> | > length(.Random.seed)
> | [1] 7
> `----
>
> Is the docu old? Some clarification on the two .Rd files would be great.
>
> Cheers,
>
> Marius
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

What the help page actually says is

     seed: An integer vector of length 7 as given by ?.Random.seed? when
           the ?"L'Ecuyer-CMRG"? RNG is in use.  See ?RNG? for the valid
           values.

.Random.seed is not the seed per se, it is an indicator of the random 
number generators in use, followed by the seed.  So for a generator with 
seed of length 6, .Random.seed is indeed of length 7.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From marius.hofert at math.ethz.ch  Wed Jan 23 08:31:21 2013
From: marius.hofert at math.ethz.ch (Marius Hofert)
Date: Wed, 23 Jan 2013 08:31:21 +0100
Subject: [Rd] Length of seed for l'Ecuyer-CMRG
In-Reply-To: <871udczttl.fsf@sklar.v.cablecom.net> (Marius Hofert's message of
	"Wed, 23 Jan 2013 00:22:46 +0100")
References: <871udczttl.fsf@sklar.v.cablecom.net>
Message-ID: <871udcxsmu.fsf@sklar.v.cablecom.net>

I'm sorry, I must have overlooked the "... as given by .Random.seed".

Thanks for helping.

Marius


From matthieu.stigler at gmail.com  Wed Jan 23 13:52:02 2013
From: matthieu.stigler at gmail.com (Matthieu Stigler)
Date: Wed, 23 Jan 2013 13:52:02 +0100
Subject: [Rd] na.omit option in prcomp: formula interface only
Message-ID: <CAEYvigL_zNns2kO6M1ZOzcLOkZOiNo0p2L1qAjQWS_xbN1gWGw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20130123/540f8274/attachment.pl>

From pgilbert902 at gmail.com  Wed Jan 23 17:06:18 2013
From: pgilbert902 at gmail.com (Paul Gilbert)
Date: Wed, 23 Jan 2013 11:06:18 -0500
Subject: [Rd] maintaining multiple R versions
In-Reply-To: <20130118195826.GA16033@eeb-tilia.eeb.lsa.umich.edu>
References: <50F99CAD.2000401@gmail.com>
	<20130118195826.GA16033@eeb-tilia.eeb.lsa.umich.edu>
Message-ID: <51000A7A.9030106@gmail.com>

Aaron

For the problem I had in mind, changing a couple of environment 
variables does not seem like more work than this,  but it may solve a 
bigger problem than the one I was thinking about. If I understand 
correctly, you can use this to switch among versions of R, similar to 
what I am doing and still with versions in different directories found 
by a PATH setting. But, in addition, it is also possible that the R 
versions were compiled with different gcc and other tools, as long as 
those are still installed on the system.  Does it also work if you 
upgrade the OS and have newer versions of system libraries, etc, or do 
you then need to recompile the R versions?

Thanks,
Paul

On 13-01-18 02:58 PM, Aaron A. King wrote:
> Have you looked at Environment Modules (http://modules.sourceforge.net/)?  I use it to maintain multiple versions of R.  Users can choose their default and switch among them at the command line.
>
> Aaron
>
> On Fri, Jan 18, 2013 at 02:04:13PM -0500, Paul Gilbert wrote:
>> (somewhat related to thread [Rd] R CMD check not reading R_LIBS )
>>
>> For many years I have maintained R versions by building R
>> (./configure ; make)  in a directory indicating the version number,
>> putting the directory/bin on my path, and setting R_LIBS_SITE.
>>
>> It seems only one version can easily be installing in /usr/bin, and
>> in any case that requires root, so I do not do that. There may be an
>> advantage to installing somewhere in a directory with the version
>> number, but that does not remove the need to set my path. (If there
>> is an advantage to installing I would appreciate someone explaining
>> briefly what it is.)
>>
>> My main question is whether there is a better ways to maintaining
>> multiple versions, in some way that lets users choose which one they
>> are using?
>>
>> (The only problem I am aware of with my current way of doing this is:
>> if the system has some R in /usr/bin then I have to set my preferred
>> version first, which means shell commands like "man" find R's pager
>> first, and do not work.)
>>
>> Thanks,
>> Paul
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From peter.meilstrup at gmail.com  Thu Jan 24 00:08:41 2013
From: peter.meilstrup at gmail.com (Peter Meilstrup)
Date: Wed, 23 Jan 2013 15:08:41 -0800
Subject: [Rd] Arguments passing through dot-dot-dot lose ability to check
	for missing()?
Message-ID: <CAJoaRhZe9qCgoLKhZSOQm4HLp1h_BNr-VFq+C4rO1X3smRLcOQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20130123/ab0bcff3/attachment.pl>

From ostrouchovg at ornl.gov  Thu Jan 24 16:14:32 2013
From: ostrouchovg at ornl.gov (George Ostrouchov)
Date: Thu, 24 Jan 2013 10:14:32 -0500
Subject: [Rd] rpvm arch check
In-Reply-To: <ED7032DB-ADC3-4BF2-8991-71B1BCAF4CAB@r-project.org>
References: <CAGgMibL9HqfjN1LMA9S_7oEck9kmD4ccEdbP3XZ8-B+EHGg8mg@mail.gmail.com>
	<00064623-6B78-4C0E-84B0-EFD2053B1B19@r-project.org>
	<CAGgMibL-JM9Sey-ukPZOC7wLO92yHL0d9sapJb1RkKDSWPym+w@mail.gmail.com>
	<ED7032DB-ADC3-4BF2-8991-71B1BCAF4CAB@r-project.org>
Message-ID: <51014FD8.2060709@ornl.gov>

Is there a reason that you choose to use PVM rather than MPI? MPI is the 
current standard and PVM is no longer supported. There are R packages 
pbdMPI and Rmpi that use MPI. There is also additional infrastructure 
for SPMD style programming in other pbd packages on CRAN.

The best instructions on installing MPI on a Mac are at
https://sites.google.com/site/dwhipp/tutorials/installing-open-mpi-on-mac-os-x
Note that you might need to install Xcode and GNU compilers beforehand.

George

On 1/17/13 11:07 AM, Simon Urbanek wrote:
> On Jan 17, 2013, at 10:52 AM, Michael Li wrote:
>
>> OK. I will upload the updated version to CRAN and see if there is any problem with the checking.
>>
>> One additional question, if a user decides to build the library from source he may still encounter the problem. Is there a way (though configure.in  file maybe) to detect the architecture of the external library (libpvm.a) and use the correct architecture automatically when compiling rpvm code?
>>
> That is automatic - multi-lib compilers will only pick libraries for the architecture that is currently being compiled.
>
> If you are using autoconf [properly], it will detect the libraries for the architecture being compiled at the time. There is really nothing you as an author need to do as long as you are aware of the multi-arch setup of R.
>
> It seems that rpvm has been removed from CRAN so I cannot comment on the rpvm package in particular.
>
> Cheers,
> Simon
>
>
>> Thanks,
>>
>> Michael
>>
>>
>> On Tue, Jan 15, 2013 at 8:53 PM, Simon Urbanek<simon.urbanek at r-project.org>  wrote:
>> On Jan 15, 2013, at 2:24 PM, Michael Li wrote:
>>
>>> I've trying to fix the check error in rpvm package. Right now on my Mac, I use darwinport to install PVM and I can get rpvm to pass the check using 'R -arch x86_64 CMD check'. However the default 'R CMD check' uses i386 which fails since PVM is built for x86_64 only.
>>>
>>> So is there a way to ensure proper architecture is used that matches that of the external library like PVM? What does CRAN use when it checks packages?
>>>
>> We use static builds which have all necessary architectures (so users don't need to install them and can use any architecture).
>>
>> Cheers,
>> Simon
>>
>>
> ______________________________________________
> R-devel at r-project.org  mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>

-- 
George Ostrouchov, Ph.D.
Scientific Data Group
Computer Science and Mathematics Division
Oak Ridge National Laboratory
(865) 574-3137http://www.csm.ornl.gov/~ost


From christian at sigg-iten.ch  Thu Jan 24 18:22:44 2013
From: christian at sigg-iten.ch (Christian Sigg)
Date: Thu, 24 Jan 2013 18:22:44 +0100
Subject: [Rd] Implications of a Dependency on a GPLed Package
Message-ID: <0DF07420-6ECC-4F72-BDA8-10EEDDA63A1B@sigg-iten.ch>

I intend to submit a newly developed package to CRAN (to be licensed under the GPL), which prompted me to re-read the GPL FAQ. The following section caught my attention:

> If a programming language interpreter is released under the GPL, does that mean programs written to be interpreted by it must be under GPL-compatible licenses?
> 
>     When the interpreter just interprets a language, the answer is no.
> 
> (...)
> 
>     Another similar and very common case is to provide libraries with the interpreter which are themselves interpreted. For instance, Perl comes with many Perl modules, and a Java implementation comes with many Java classes. These libraries and the programs that call them are always dynamically linked together.
> 
>     A consequence is that if you choose to use GPL'd Perl modules or Java classes in your program, you must release the program in a GPL-compatible way, regardless of the license used in the Perl or Java interpreter that the combined Perl or Java program will run on. 


(from http://www.gnu.org/licenses/gpl-faq.html#IfInterpreterIsGPL)

My understanding of this section is the following:

1. If I develop and distribute an R package which depends on another package that is released under the GPL, I have to release my package in a GPL-compatible way.

2. Given that R itself is distributed as a set of base packages (released under the GPL), and a distinction between making use of the R "language" and making use of functionality provided by the base packages seem impossible, the above section could also imply that it is not possible at all to release R code under a license that is not GPL-compatible.

Yet, there exist several packages on CRAN which seem to violate the GPL, according to the FSF interpretation quoted above. For example, the SDDA package prohibits commercial use of the package (a restriction that is incompatible with the GPL), but states an explicit dependency on the MASS package (which is not a "base" package and released under the GPL). Furthermore, several packages also prohibit commercial use, but list an explicit dependency on the methods package (e.g. gpclib, isa2, optmatch).

As all of these packages are on CRAN, and at least one author is also a core R contributor (Duncan Murdoch for gpclib), I assume that the CRAN maintainers and/or the R Foundation do not consider these packages to violate the GPL, and therefore also do not agree with the FSF interpretation of the GPL quoted above (provided that they share my understanding of the quote). On the other hand, R is an official part of the FSF GNU project, so I would expect the R Foundation to agree with GNU policy in general.

I have not found a statement by the CRAN maintainers and/or the R Foundation that addresses this issue (e.g. it is neither addressed in doc/COPYRIGHTS nor the R FAQ nor the CRAN repository policy). I have also searched the archives and there are at least three references to the above quoted section of the GPL FAQ on R-devel:

https://stat.ethz.ch/pipermail/r-devel/2011-August/061907.html
https://stat.ethz.ch/pipermail/r-devel/2009-April/053159.html
https://stat.ethz.ch/pipermail/r-devel/2006-September/042715.html

and one reference on R-help:

https://stat.ethz.ch/pipermail/r-help/2008-November/179846.html

While several list members provide their personal opinion on the matter, I could not find any statement that could be considered the agreed upon position of the CRAN maintainers and/or the R Foundation. The closest I could find are several replies by Duncan Murdoch where he writes that a package author is free in his choice of license if no actual copying of GPLed code takes place

https://stat.ethz.ch/pipermail/r-devel/2006-September/042716.html
https://stat.ethz.ch/pipermail/r-help/2010-June/240945.html

and where he takes a critical stand against the quoted FSF interpretation of the GPL:

> By your line of reasoning (which I 
> don't agree with), if you write an R script, making use of features of R 
> that are not present in other S dialects, then the only way to make it 
> work would be to use R.  So if you want to distribute it, you would need 
> to GPL it.  So lots of the R packages on CRAN that do not have GPL 
> compatible licenses would be in violation of the GPL, and since CRAN is 
> distributing them, CRAN is in violation of the GPL.  That's nonsense.

(from https://stat.ethz.ch/pipermail/r-help/2008-November/179908.html)

and an email by Prof. Leisch

https://stat.ethz.ch/pipermail/r-devel/2009-April/053141.html

where he mentions ongoing discussions in R Core and the R Foundation. However, these discussions might have only considered Revolution Analytic's ParallelR (the main topic of that thread), and I could not find a follow-up email where the result of that discussion was published.

Did the CRAN maintainers and the R Foundation publish an agreed upon position on the FSF interpretation of the GPL quoted above, and I simply missed it? If yes, could it be added to the R FAQ and/or the CRAN repository policy, such that it is easier to find? If not, may I kindly ask them to explain their position?

Note that I am not asking for legal advice, nor am I advocating for a specific change of the current practices of the R project.

Thank you,
Christian


From ejbrunner at gmail.com  Thu Jan 24 19:07:10 2013
From: ejbrunner at gmail.com (Evan J Brunner)
Date: Thu, 24 Jan 2013 10:07:10 -0800
Subject: [Rd] (patch) Layers for pdf() grDevice
Message-ID: <CA+xQbCV55Z6EjENF4aWvStcR+5UQ399go9DdD_+JZ3hzCmn=mw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20130124/4d953fd1/attachment.pl>

From edd at debian.org  Fri Jan 25 13:27:21 2013
From: edd at debian.org (Dirk Eddelbuettel)
Date: Fri, 25 Jan 2013 06:27:21 -0600
Subject: [Rd] Suggested updated to doc/manual/R-exts.texi
Message-ID: <20738.31273.50759.944360@max.nulle.part>


The R-exts manual still says

  Note also that for running @LaTeX{}, the Debian @acronym{GNU}/Linux
  @acronym{CRAN} check systems use the Debian TeXLive at footnote{currently
  the long obsolete TeXLive 2009.} distribution
  (@uref{http://packages.debian.org/@/en/@/sid/@/texlive}); the Fedora and

and what is in the footnote has not been true for quite some time as a visit
to the URL (or to the even more detailed

  http://packages.debian.org/changelogs/pool/main/t/texlive-base/texlive-base_2012.20120611-5/changelog

will attest. In Debian, Texlive 2011 arrived last March, Texlive 2012 a
little later and is also current on Ubuntu.  

So I suggest to use something like

  Note also that for running @LaTeX{}, the Debian @acronym{GNU}/Linux, Fedora
  and Solaris check systems on @acronym{CRAN} use current TexLive; 

Thanks,  Dirk

-- 
Dirk Eddelbuettel | edd at debian.org | http://dirk.eddelbuettel.com


From murdoch.duncan at gmail.com  Fri Jan 25 13:32:15 2013
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Fri, 25 Jan 2013 07:32:15 -0500
Subject: [Rd] Implications of a Dependency on a GPLed Package
In-Reply-To: <0DF07420-6ECC-4F72-BDA8-10EEDDA63A1B@sigg-iten.ch>
References: <0DF07420-6ECC-4F72-BDA8-10EEDDA63A1B@sigg-iten.ch>
Message-ID: <51027B4F.8040909@gmail.com>

On 13-01-24 12:22 PM, Christian Sigg wrote:
> I intend to submit a newly developed package to CRAN (to be licensed under the GPL), which prompted me to re-read the GPL FAQ. The following section caught my attention:
>
>> If a programming language interpreter is released under the GPL, does that mean programs written to be interpreted by it must be under GPL-compatible licenses?
>>
>>      When the interpreter just interprets a language, the answer is no.
>>
>> (...)
>>
>>      Another similar and very common case is to provide libraries with the interpreter which are themselves interpreted. For instance, Perl comes with many Perl modules, and a Java implementation comes with many Java classes. These libraries and the programs that call them are always dynamically linked together.
>>
>>      A consequence is that if you choose to use GPL'd Perl modules or Java classes in your program, you must release the program in a GPL-compatible way, regardless of the license used in the Perl or Java interpreter that the combined Perl or Java program will run on.
>
>
> (from http://www.gnu.org/licenses/gpl-faq.html#IfInterpreterIsGPL)
>
> My understanding of this section is the following:
>
> 1. If I develop and distribute an R package which depends on another package that is released under the GPL, I have to release my package in a GPL-compatible way.
>
> 2. Given that R itself is distributed as a set of base packages (released under the GPL), and a distinction between making use of the R "language" and making use of functionality provided by the base packages seem impossible, the above section could also imply that it is not possible at all to release R code under a license that is not GPL-compatible.
>
> Yet, there exist several packages on CRAN which seem to violate the GPL, according to the FSF interpretation quoted above. For example, the SDDA package prohibits commercial use of the package (a restriction that is incompatible with the GPL), but states an explicit dependency on the MASS package (which is not a "base" package and released under the GPL). Furthermore, several packages also prohibit commercial use, but list an explicit dependency on the methods package (e.g. gpclib, isa2, optmatch).
>
> As all of these packages are on CRAN, and at least one author is also a core R contributor (Duncan Murdoch for gpclib), I assume that the CRAN maintainers and/or the R Foundation do not consider these packages to violate the GPL, and therefore also do not agree with the FSF interpretation of the GPL quoted above (provided that they share my understanding of the quote). On the other hand, R is an official part of the FSF GNU project, so I would expect the R Foundation to agree with GNU policy in general.
>
> I have not found a statement by the CRAN maintainers and/or the R Foundation that addresses this issue (e.g. it is neither addressed in doc/COPYRIGHTS nor the R FAQ nor the CRAN repository policy). I have also searched the archives and there are at least three references to the above quoted section of the GPL FAQ on R-devel:
>
> https://stat.ethz.ch/pipermail/r-devel/2011-August/061907.html
> https://stat.ethz.ch/pipermail/r-devel/2009-April/053159.html
> https://stat.ethz.ch/pipermail/r-devel/2006-September/042715.html
>
> and one reference on R-help:
>
> https://stat.ethz.ch/pipermail/r-help/2008-November/179846.html
>
> While several list members provide their personal opinion on the matter, I could not find any statement that could be considered the agreed upon position of the CRAN maintainers and/or the R Foundation. The closest I could find are several replies by Duncan Murdoch where he writes that a package author is free in his choice of license if no actual copying of GPLed code takes place
>
> https://stat.ethz.ch/pipermail/r-devel/2006-September/042716.html
> https://stat.ethz.ch/pipermail/r-help/2010-June/240945.html
>
> and where he takes a critical stand against the quoted FSF interpretation of the GPL:

I don't think my point contradicts the FSF interpretation.  I think they 
were talking about using GPL modules in a program you distribute, with 
the implication that you are distributing the modules along with your 
program.  However, I could be wrong.  If I am wrong and the FSF agrees 
with your strong interpretation, then I do think they are wrong.

If you write something that incorporates nothing of mine, I can't see 
how my copyright could influence you at all.  If a user needs my code to 
make yours useful, I don't see how any of that changes.  The GPL is 
quite clear that it doesn't restrict people in how they use the code, it 
just gives them rights to copy it (possibly in a modified form, if they 
follow the rules).

>
>> By your line of reasoning (which I
>> don't agree with), if you write an R script, making use of features of R
>> that are not present in other S dialects, then the only way to make it
>> work would be to use R.  So if you want to distribute it, you would need
>> to GPL it.  So lots of the R packages on CRAN that do not have GPL
>> compatible licenses would be in violation of the GPL, and since CRAN is
>> distributing them, CRAN is in violation of the GPL.  That's nonsense.
>
> (from https://stat.ethz.ch/pipermail/r-help/2008-November/179908.html)
>
> and an email by Prof. Leisch
>
> https://stat.ethz.ch/pipermail/r-devel/2009-April/053141.html
>
> where he mentions ongoing discussions in R Core and the R Foundation. However, these discussions might have only considered Revolution Analytic's ParallelR (the main topic of that thread), and I could not find a follow-up email where the result of that discussion was published.
>
> Did the CRAN maintainers and the R Foundation publish an agreed upon position on the FSF interpretation of the GPL quoted above, and I simply missed it? If yes, could it be added to the R FAQ and/or the CRAN repository policy, such that it is easier to find? If not, may I kindly ask them to explain their position?

No, CRAN and the R Foundation have not published that.  I don't think 
either group will publish a position.  You can guess the current beliefs 
of the folks at CRAN by seeing what they do (under the reasonable 
assumption that they do not think they are doing anything illegal), but 
those beliefs might change.  The R Foundation does almost nothing, so 
it's a little more inscrutable.

> Note that I am not asking for legal advice,

You should be.  If you really want to know whether they are using your 
code illegally, or about whether your proposed use of other peoples code 
is legal, you really should get legal advice.

 > nor am I advocating for a specific change of the current practices of 
the R project.

Duncan Murdoch


From kingaa at umich.edu  Fri Jan 25 15:10:32 2013
From: kingaa at umich.edu (Aaron King)
Date: Fri, 25 Jan 2013 09:10:32 -0500
Subject: [Rd] maintaining multiple R versions
In-Reply-To: <51000A7A.9030106@gmail.com>
References: <50F99CAD.2000401@gmail.com>
	<20130118195826.GA16033@eeb-tilia.eeb.lsa.umich.edu>
	<51000A7A.9030106@gmail.com>
Message-ID: <20130125140948.GA4664@betula>

I agree, environment modules really come into their own when you need to switch back and forth between different versions, as I do when testing my packages.  Since environment modules are used on the cluster I work on, it's actually easier for me to use them on my local machines than to change working styles according to which machine I'm on.

To answer your question, yes, if your OS upgrade doesn't wipe out the needed system libraries, you can continue to use older versions of R.  As to whether a library compiled under one (old) version of gcc will work with any given (newer) version of the system libraries, that will depend on the changes made to gcc, and all of this is resolved by the dynamic linker at runtime.  I don't believe there is any guarantee that gcc's libraries will be fully backward compatible.  At any rate, environment modules only manipulates the user's environment and has no control over what is installed on the system.  Hope this helps. 

On Wed, Jan 23, 2013 at 11:06:18AM -0500, Paul Gilbert wrote:
> For the problem I had in mind, changing a couple of environment
> variables does not seem like more work than this,  but it may solve
> a bigger problem than the one I was thinking about. If I understand
> correctly, you can use this to switch among versions of R, similar
> to what I am doing and still with versions in different directories
> found by a PATH setting. But, in addition, it is also possible that
> the R versions were compiled with different gcc and other tools, as
> long as those are still installed on the system.  Does it also work
> if you upgrade the OS and have newer versions of system libraries,
> etc, or do you then need to recompile the R versions?

-- 
Aaron A. King, Ph.D.
Ecology & Evolutionary Biology
Mathematics
Center for the Study of Complex Systems
University of Michigan
GPG Public Key: 0x15780975


From marc_schwartz at me.com  Fri Jan 25 15:50:26 2013
From: marc_schwartz at me.com (Marc Schwartz)
Date: Fri, 25 Jan 2013 08:50:26 -0600
Subject: [Rd] Implications of a Dependency on a GPLed Package
In-Reply-To: <51027B4F.8040909@gmail.com>
References: <0DF07420-6ECC-4F72-BDA8-10EEDDA63A1B@sigg-iten.ch>
	<51027B4F.8040909@gmail.com>
Message-ID: <D233BCD0-019F-484D-BD42-639419E257DA@me.com>


On Jan 25, 2013, at 6:32 AM, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:

> On 13-01-24 12:22 PM, Christian Sigg wrote:
>> I intend to submit a newly developed package to CRAN (to be licensed under the GPL), which prompted me to re-read the GPL FAQ. The following section caught my attention:
>> 
>>> If a programming language interpreter is released under the GPL, does that mean programs written to be interpreted by it must be under GPL-compatible licenses?
>>> 
>>>     When the interpreter just interprets a language, the answer is no.
>>> 
>>> (...)
>>> 
>>>     Another similar and very common case is to provide libraries with the interpreter which are themselves interpreted. For instance, Perl comes with many Perl modules, and a Java implementation comes with many Java classes. These libraries and the programs that call them are always dynamically linked together.
>>> 
>>>     A consequence is that if you choose to use GPL'd Perl modules or Java classes in your program, you must release the program in a GPL-compatible way, regardless of the license used in the Perl or Java interpreter that the combined Perl or Java program will run on.
>> 
>> 
>> (from http://www.gnu.org/licenses/gpl-faq.html#IfInterpreterIsGPL)
>> 
>> My understanding of this section is the following:
>> 
>> 1. If I develop and distribute an R package which depends on another package that is released under the GPL, I have to release my package in a GPL-compatible way.
>> 
>> 2. Given that R itself is distributed as a set of base packages (released under the GPL), and a distinction between making use of the R "language" and making use of functionality provided by the base packages seem impossible, the above section could also imply that it is not possible at all to release R code under a license that is not GPL-compatible.
>> 
>> Yet, there exist several packages on CRAN which seem to violate the GPL, according to the FSF interpretation quoted above. For example, the SDDA package prohibits commercial use of the package (a restriction that is incompatible with the GPL), but states an explicit dependency on the MASS package (which is not a "base" package and released under the GPL). Furthermore, several packages also prohibit commercial use, but list an explicit dependency on the methods package (e.g. gpclib, isa2, optmatch).
>> 
>> As all of these packages are on CRAN, and at least one author is also a core R contributor (Duncan Murdoch for gpclib), I assume that the CRAN maintainers and/or the R Foundation do not consider these packages to violate the GPL, and therefore also do not agree with the FSF interpretation of the GPL quoted above (provided that they share my understanding of the quote). On the other hand, R is an official part of the FSF GNU project, so I would expect the R Foundation to agree with GNU policy in general.
>> 
>> I have not found a statement by the CRAN maintainers and/or the R Foundation that addresses this issue (e.g. it is neither addressed in doc/COPYRIGHTS nor the R FAQ nor the CRAN repository policy). I have also searched the archives and there are at least three references to the above quoted section of the GPL FAQ on R-devel:
>> 
>> https://stat.ethz.ch/pipermail/r-devel/2011-August/061907.html
>> https://stat.ethz.ch/pipermail/r-devel/2009-April/053159.html
>> https://stat.ethz.ch/pipermail/r-devel/2006-September/042715.html
>> 
>> and one reference on R-help:
>> 
>> https://stat.ethz.ch/pipermail/r-help/2008-November/179846.html
>> 
>> While several list members provide their personal opinion on the matter, I could not find any statement that could be considered the agreed upon position of the CRAN maintainers and/or the R Foundation. The closest I could find are several replies by Duncan Murdoch where he writes that a package author is free in his choice of license if no actual copying of GPLed code takes place
>> 
>> https://stat.ethz.ch/pipermail/r-devel/2006-September/042716.html
>> https://stat.ethz.ch/pipermail/r-help/2010-June/240945.html
>> 
>> and where he takes a critical stand against the quoted FSF interpretation of the GPL:
> 
> I don't think my point contradicts the FSF interpretation.  I think they were talking about using GPL modules in a program you distribute, with the implication that you are distributing the modules along with your program.  However, I could be wrong.  If I am wrong and the FSF agrees with your strong interpretation, then I do think they are wrong.
> 
> If you write something that incorporates nothing of mine, I can't see how my copyright could influence you at all.  If a user needs my code to make yours useful, I don't see how any of that changes.  The GPL is quite clear that it doesn't restrict people in how they use the code, it just gives them rights to copy it (possibly in a modified form, if they follow the rules).
> 
>> 
>>> By your line of reasoning (which I
>>> don't agree with), if you write an R script, making use of features of R
>>> that are not present in other S dialects, then the only way to make it
>>> work would be to use R.  So if you want to distribute it, you would need
>>> to GPL it.  So lots of the R packages on CRAN that do not have GPL
>>> compatible licenses would be in violation of the GPL, and since CRAN is
>>> distributing them, CRAN is in violation of the GPL.  That's nonsense.
>> 
>> (from https://stat.ethz.ch/pipermail/r-help/2008-November/179908.html)
>> 
>> and an email by Prof. Leisch
>> 
>> https://stat.ethz.ch/pipermail/r-devel/2009-April/053141.html
>> 
>> where he mentions ongoing discussions in R Core and the R Foundation. However, these discussions might have only considered Revolution Analytic's ParallelR (the main topic of that thread), and I could not find a follow-up email where the result of that discussion was published.
>> 
>> Did the CRAN maintainers and the R Foundation publish an agreed upon position on the FSF interpretation of the GPL quoted above, and I simply missed it? If yes, could it be added to the R FAQ and/or the CRAN repository policy, such that it is easier to find? If not, may I kindly ask them to explain their position?
> 
> No, CRAN and the R Foundation have not published that.  I don't think either group will publish a position.  You can guess the current beliefs of the folks at CRAN by seeing what they do (under the reasonable assumption that they do not think they are doing anything illegal), but those beliefs might change.  The R Foundation does almost nothing, so it's a little more inscrutable.
> 
>> Note that I am not asking for legal advice,
> 
> You should be.  If you really want to know whether they are using your code illegally, or about whether your proposed use of other peoples code is legal, you really should get legal advice.
> 
> > nor am I advocating for a specific change of the current practices of the R project.
> 
> Duncan Murdoch


With the caveat that I am not a lawyer, you have not really provided enough information here to formulate even an informal (definitely non-binding) response specifically as it pertains to your package, much less the broad issue of packages on CRAN in general.

There are some questions that need to be answered, since these types of questions have to be answered within specific contexts. For example:

1. Is your package "pure R" code and contains only code that you have written?

2. Does your package contain code requiring compilation (eg. C, C++, FORTRAN) that links against other GPL libraries, R or otherwise?

3. Are you including any other source code, not written by you, that is GPL?


If your package is "pure R" (no compiled code and no R code from someone else that is GPL) and contains no linking (in the compiler sense of the term) to R's libraries or the libraries of other GPL licensed code, you are free to distribute your package under any license you wish and even restrict use. Note that I am focusing on the GPL here and not other "looser" open source licenses. 

The same applies if you include a DEPENDS line in your DESCRIPTION file, where other GPL packages are listed. That has no implication for the licensing of your package unless you are linking against libraries in the other GPL packages. 

The so-called viral part of the GPL largely comes into play when you link against other GPL code or possibly embed other GPL code within yours and distribute that product. In that case, your code, at least the part that specifically links against other GPL libraries, would have to be licensed under the GPL or a GPL compatible license as well. Albeit, even there, we are talking about distribution, not use. You could develop a package for "internal" use only, in which case, the license used is irrelevant. 

The GPL really only comes into play when distributing/copying software beyond yourself or perhaps your organization and even in that case, there are scenarios that would allow for multiple licenses to be used and there is a fair amount of commercial software that is distributed in that fashion. The GPL components are distributed intact and source is made available, while it is possible that "proprietary" components are also packaged together as part of the "whole".

There are non-GPL and non-GPL compatible packages on CRAN and this topic has come up for [heated] discussion in the past. The CRAN maintainers have not placed GPL or GPL compatible only restrictions on the packages on CRAN. That there are such packages on CRAN is not a legal issue vis-a-vis the GPL, but a philosophical one, which is where the heated discussions tend to arise from.

I would also point out that there are R packages not on CRAN that have been made available and the same licensing parameters apply.

Regards,

Marc Schwartz


From mdowle at mdowle.plus.com  Fri Jan 25 15:58:11 2013
From: mdowle at mdowle.plus.com (Matthew Dowle)
Date: Fri, 25 Jan 2013 14:58:11 +0000
Subject: [Rd] Implications of a Dependency on a GPLed Package
Message-ID: <d6b4bf5d4f18273afb1581b75d93be94@imap.plus.net>


Christian,

In my mind, rightly or wrongly, it boils down to these four points :

1. CRAN policy excludes closed source packages; i.e., every single 
package on CRAN includes its C code, if any. If an R package included a 
.dll or .so which linked at C level to R, and that was being distributed 
without providing the source, then that would be a clear breach of R's 
GPL. But nobody is aware of any such package. Anyone who is aware of 
that should let the R Foundation know. Whether or not the GPL applies to 
R only interpreted code (by definition you cannot "close-source" 
interpreted code) is important too, but not as important as distribution 
of closed source binaries linking to R at C level.

2. Court cases would never happen unless two lawyers disagreed. Even 
then two judges can disagree (otherwise appeals would never be 
successful).

3. There are two presidents of the R Foundation. And it appears they 
disagree. Therefore it appears very unlikely that the R Foundation would 
bring a GPL case against anyone. Rather, it seems to be up to the 
community to decide for themselves. If you don't mind about close source 
non free software linking to R at C level then buy it (if that exists), 
if you don't, don't.

4. As a package author it is entirely up to you how to approach this 
area. Yes, seek legal advice. And I'd suggest seeking the advice of 
several lawyers, not just one. Then follow the advice that you like the 
best.

Matthew


From christian at sigg-iten.ch  Fri Jan 25 19:16:01 2013
From: christian at sigg-iten.ch (Christian Sigg)
Date: Fri, 25 Jan 2013 19:16:01 +0100
Subject: [Rd] Implications of a Dependency on a GPLed Package
In-Reply-To: <51027B4F.8040909@gmail.com>
References: <0DF07420-6ECC-4F72-BDA8-10EEDDA63A1B@sigg-iten.ch>
	<51027B4F.8040909@gmail.com>
Message-ID: <482D02E2-0BCF-48DA-8D1C-D4C34B0C38B1@sigg-iten.ch>

Dear Duncan

> I don't think my point contradicts the FSF interpretation.  I think they were talking about using GPL modules in a program you distribute, with the implication that you are distributing the modules along with your program.  However, I could be wrong.  If I am wrong and the FSF agrees with your strong interpretation, then I do think they are wrong.

Let me again quote parts of the GPL FAQ:

> Another similar and very common case is to provide libraries with the interpreter which are themselves interpreted. For instance, Perl comes with many Perl modules, and a Java implementation comes with many Java classes. These libraries and the programs that call them are always dynamically linked together.
> 
> A consequence is that if you choose to use GPL'd Perl modules or Java classes in your program, you must release the program in a GPL-compatible way, regardless of the license used in the Perl or Java interpreter that the combined Perl or Java program will run on. 

The second paragraph (applied to R) says that if I use a GPL'd R package, I must release the program in a GPL-compatible way. It makes no mention of distributing the GPLed modules along with the program. 

I think that this FAQ entry precisely exists because in an interpreted environment, it is possible to make use of the functionality of a GPLed package without copying code (in source or binary form) from that package into my program (beyond the API calls), as it would happen in static linking. The last sentence of the first paragraph unambiguously asserts that calling functionality from an R package is equivalent to dynamic linking of my program with the package. 

The preceding entry of the GPL FAQ has this to say:

> If a library is released under the GPL (not the LGPL), does that mean that any software which uses it has to be under the GPL or a GPL-compatible license? (#IfLibraryIsGPL)
> 
>     Yes, because the software as it is actually run includes the library.

There exist several licenses which modify the GPL explicitly to allow for dynamic linking to a GPLed library without having to release the program under the GPL (e.g. LGPL, Classpath Licence, GCC Runtime Library Exception. The following section again states that dynamic linking implies that a program and the package become effectively a single program, which needs to be released under the GPL:

> Can I release a non-free program that's designed to load a GPL-covered plug-in? (#NFUseGPLPlugins)
> 
>    (...)
> 
>     If the program dynamically links plug-ins, and they make function calls to each other and share data structures, we believe they form a single program, which must be treated as an extension of both the main program and the plug-ins. In order to use the GPL-covered plug-ins, the main program must be released under the GPL or a GPL-compatible free software license, and that the terms of the GPL must be followed when the main program is distributed for use with these plug-ins.


I see nothing in the FAQ which would indicate that these points were only valid if the GPLed R package is distributed along with my program.


> If you write something that incorporates nothing of mine, I can't see how my copyright could influence you at all.  If a user needs my code to make yours useful, I don't see how any of that changes.  The GPL is quite clear that it doesn't restrict people in how they use the code, it just gives them rights to copy it (possibly in a modified form, if they follow the rules).

I think I understand your position, and personally applied the same reasoning when reading the GPL. But the above quoted sections unambiguously concern usage and dynamic linking, and make no mention of copying code. 

> No, CRAN and the R Foundation have not published that.  I don't think either group will publish a position.  You can guess the current beliefs of the folks at CRAN by seeing what they do (under the reasonable assumption that they do not think they are doing anything illegal), but those beliefs might change.  The R Foundation does almost nothing, so it's a little more inscrutable.

I already mentioned in my first email what I assume is the position of the CRAN maintainers and the R Foundation, i.e. that they believe that distributing non GPL-compatible packages which depend on GPL packages is not a violation of the GPL. But if my reading of the GPL FAQ has any merit, then the FSF has a different position. And because the R project is an official GNU project, the FSF interpretation of the GPL is important for the R project. A clarification of the position of the CRAN maintainers and the R Foundation would therefore be helpful.

Prof. Leisch explicitly mentions that discussions concerning such issues (e.g. combining R with non-free functionality) are taking place, and that a common position is sought with the intent of publishing it:

> Just a short clarification (by no means intended to stop the thread):
> as you can imagine we are discussing the matter internally in R Core
> and the Foundation, but there are different views and we want to
> consolidate before we make a public statement.  If all of us were of
> the same opinion we would already have made one.




>> Note that I am not asking for legal advice,
> 
> You should be.  If you really want to know whether they are using your code illegally, or about whether your proposed use of other peoples code is legal, you really should get legal advice.

This issue has been brought up several times, making it a frequently asked question (for some definitions of frequently :-). A clarification of the position of the CRAN maintainers and the R Foundation is valuable, and does not have to constitute legal advice.

Best regards,
Christian

From christian at sigg-iten.ch  Fri Jan 25 19:17:11 2013
From: christian at sigg-iten.ch (Christian Sigg)
Date: Fri, 25 Jan 2013 19:17:11 +0100
Subject: [Rd] Implications of a Dependency on a GPLed Package
In-Reply-To: <D233BCD0-019F-484D-BD42-639419E257DA@me.com>
References: <0DF07420-6ECC-4F72-BDA8-10EEDDA63A1B@sigg-iten.ch>
	<51027B4F.8040909@gmail.com>
	<D233BCD0-019F-484D-BD42-639419E257DA@me.com>
Message-ID: <148493C2-BFE9-45DC-8849-AA87F1480372@sigg-iten.ch>

Dear Marc

The GPL FAQ section that I quoted addresses all the points that you raise:

> There are some questions that need to be answered, since these types of questions have to be answered within specific contexts. For example:
> 
> 1. Is your package "pure R" code and contains only code that you have written?

The quoted section of the GLP FAQ concerns purely interpreted R code. Issues of authorship are not part of the argument, but they of course have to be fully resolved.

> 2. Does your package contain code requiring compilation (eg. C, C++, FORTRAN) that links against other GPL libraries, R or otherwise?

See 1.

> 3. Are you including any other source code, not written by you, that is GPL?

No inclusion of third party source code, only making use of functionality of a GPLed R package.


> If your package is "pure R" (no compiled code and no R code from someone else that is GPL) and contains no linking (in the compiler sense of the term) to R's libraries or the libraries of other GPL licensed code, you are free to distribute your package under any license you wish and even restrict use. Note that I am focusing on the GPL here and not other "looser" open source licenses. 
> 
> The same applies if you include a DEPENDS line in your DESCRIPTION file, where other GPL packages are listed. That has no implication for the licensing of your package unless you are linking against libraries in the other GPL packages. 

It is my understanding of the quoted GPL FAQ section that the FSF does not agree with this interpretation of the GPL.

> The so-called viral part of the GPL largely comes into play when you link against other GPL code or possibly embed other GPL code within yours and distribute that product. In that case, your code, at least the part that specifically links against other GPL libraries, would have to be licensed under the GPL or a GPL compatible license as well. Albeit, even there, we are talking about distribution, not use. You could develop a package for "internal" use only, in which case, the license used is irrelevant. 

I provided examples of packages that are already published on CRAN, which are in violation of the GPL according to the FSF interpretation, provided I understood the GPL FAQ correctly.

> There are non-GPL and non-GPL compatible packages on CRAN and this topic has come up for [heated] discussion in the past. The CRAN maintainers have not placed GPL or GPL compatible only restrictions on the packages on CRAN. That there are such packages on CRAN is not a legal issue vis-a-vis the GPL, but a philosophical one, which is where the heated discussions tend to arise from.

I am aware of those discussions, and am not advocating for a change of the current practices of the CRAN maintainers. But I if the current practices of the R project are in conflict with the FSF interpretation of the GPL, they need to be addressed. 

Best regards,
Christian


From christian at sigg-iten.ch  Fri Jan 25 19:27:12 2013
From: christian at sigg-iten.ch (Christian Sigg)
Date: Fri, 25 Jan 2013 19:27:12 +0100
Subject: [Rd] Implications of a Dependency on a GPLed Package
In-Reply-To: <148493C2-BFE9-45DC-8849-AA87F1480372@sigg-iten.ch>
References: <0DF07420-6ECC-4F72-BDA8-10EEDDA63A1B@sigg-iten.ch>
	<51027B4F.8040909@gmail.com>
	<D233BCD0-019F-484D-BD42-639419E257DA@me.com>
	<148493C2-BFE9-45DC-8849-AA87F1480372@sigg-iten.ch>
Message-ID: <8782DABD-9146-45E3-9CBE-1EE2F1B86A41@sigg-iten.ch>

> I am aware of those discussions, and am not advocating for a change of the current practices of the CRAN maintainers. But if the current practices of the R project are in conflict with the FSF interpretation of the GPL, they need to be addressed.

Let me correct my last sentence to "..., this issue should be addressed." to avoid a possible misunderstanding. I am only asking for a clarification of the position of the CRAN maintainers and the R Foundation on this issue.

Best regards,
Christian

From murdoch.duncan at gmail.com  Fri Jan 25 19:31:12 2013
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Fri, 25 Jan 2013 13:31:12 -0500
Subject: [Rd] Implications of a Dependency on a GPLed Package
In-Reply-To: <482D02E2-0BCF-48DA-8D1C-D4C34B0C38B1@sigg-iten.ch>
References: <0DF07420-6ECC-4F72-BDA8-10EEDDA63A1B@sigg-iten.ch>
	<51027B4F.8040909@gmail.com>
	<482D02E2-0BCF-48DA-8D1C-D4C34B0C38B1@sigg-iten.ch>
Message-ID: <5102CF70.9030801@gmail.com>

On 25/01/2013 1:16 PM, Christian Sigg wrote:
> Dear Duncan
>
> > I don't think my point contradicts the FSF interpretation.  I think they were talking about using GPL modules in a program you distribute, with the implication that you are distributing the modules along with your program.  However, I could be wrong.  If I am wrong and the FSF agrees with your strong interpretation, then I do think they are wrong.
>
> Let me again quote parts of the GPL FAQ:
>
> > Another similar and very common case is to provide libraries with the interpreter which are themselves interpreted. For instance, Perl comes with many Perl modules, and a Java implementation comes with many Java classes. These libraries and the programs that call them are always dynamically linked together.
> >
> > A consequence is that if you choose to use GPL'd Perl modules or Java classes in your program, you must release the program in a GPL-compatible way, regardless of the license used in the Perl or Java interpreter that the combined Perl or Java program will run on.
>
> The second paragraph (applied to R) says that if I use a GPL'd R package, I must release the program in a GPL-compatible way. It makes no mention of distributing the GPLed modules along with the program.

I still find that paragraph to be ambiguous, but I'm willing to believe 
that they are making claims with no legal basis for them.

Duncan Murdoch

>
> I think that this FAQ entry precisely exists because in an interpreted environment, it is possible to make use of the functionality of a GPLed package without copying code (in source or binary form) from that package into my program (beyond the API calls), as it would happen in static linking. The last sentence of the first paragraph unambiguously asserts that calling functionality from an R package is equivalent to dynamic linking of my program with the package.
>
> The preceding entry of the GPL FAQ has this to say:
>
> > If a library is released under the GPL (not the LGPL), does that mean that any software which uses it has to be under the GPL or a GPL-compatible license? (#IfLibraryIsGPL)
> >
> >     Yes, because the software as it is actually run includes the library.
>
> There exist several licenses which modify the GPL explicitly to allow for dynamic linking to a GPLed library without having to release the program under the GPL (e.g. LGPL, Classpath Licence, GCC Runtime Library Exception. The following section again states that dynamic linking implies that a program and the package become effectively a single program, which needs to be released under the GPL:
>
> > Can I release a non-free program that's designed to load a GPL-covered plug-in? (#NFUseGPLPlugins)
> >
> >    (...)
> >
> >     If the program dynamically links plug-ins, and they make function calls to each other and share data structures, we believe they form a single program, which must be treated as an extension of both the main program and the plug-ins. In order to use the GPL-covered plug-ins, the main program must be released under the GPL or a GPL-compatible free software license, and that the terms of the GPL must be followed when the main program is distributed for use with these plug-ins.
>
>
> I see nothing in the FAQ which would indicate that these points were only valid if the GPLed R package is distributed along with my program.
>
>
> > If you write something that incorporates nothing of mine, I can't see how my copyright could influence you at all.  If a user needs my code to make yours useful, I don't see how any of that changes.  The GPL is quite clear that it doesn't restrict people in how they use the code, it just gives them rights to copy it (possibly in a modified form, if they follow the rules).
>
> I think I understand your position, and personally applied the same reasoning when reading the GPL. But the above quoted sections unambiguously concern usage and dynamic linking, and make no mention of copying code.
>
> > No, CRAN and the R Foundation have not published that.  I don't think either group will publish a position.  You can guess the current beliefs of the folks at CRAN by seeing what they do (under the reasonable assumption that they do not think they are doing anything illegal), but those beliefs might change.  The R Foundation does almost nothing, so it's a little more inscrutable.
>
> I already mentioned in my first email what I assume is the position of the CRAN maintainers and the R Foundation, i.e. that they believe that distributing non GPL-compatible packages which depend on GPL packages is not a violation of the GPL. But if my reading of the GPL FAQ has any merit, then the FSF has a different position. And because the R project is an official GNU project, the FSF interpretation of the GPL is important for the R project. A clarification of the position of the CRAN maintainers and the R Foundation would therefore be helpful.
>
> Prof. Leisch explicitly mentions that discussions concerning such issues (e.g. combining R with non-free functionality) are taking place, and that a common position is sought with the intent of publishing it:
>
> > Just a short clarification (by no means intended to stop the thread):
> > as you can imagine we are discussing the matter internally in R Core
> > and the Foundation, but there are different views and we want to
> > consolidate before we make a public statement.  If all of us were of
> > the same opinion we would already have made one.
>
>
>
>
> >> Note that I am not asking for legal advice,
> >
> > You should be.  If you really want to know whether they are using your code illegally, or about whether your proposed use of other peoples code is legal, you really should get legal advice.
>
> This issue has been brought up several times, making it a frequently asked question (for some definitions of frequently :-). A clarification of the position of the CRAN maintainers and the R Foundation is valuable, and does not have to constitute legal advice.
>
> Best regards,
> Christian


From marc_schwartz at me.com  Fri Jan 25 21:32:09 2013
From: marc_schwartz at me.com (Marc Schwartz)
Date: Fri, 25 Jan 2013 14:32:09 -0600
Subject: [Rd] Implications of a Dependency on a GPLed Package
In-Reply-To: <482D02E2-0BCF-48DA-8D1C-D4C34B0C38B1@sigg-iten.ch>
References: <0DF07420-6ECC-4F72-BDA8-10EEDDA63A1B@sigg-iten.ch>
	<51027B4F.8040909@gmail.com>
	<482D02E2-0BCF-48DA-8D1C-D4C34B0C38B1@sigg-iten.ch>
Message-ID: <3B55B247-5400-4DF7-A02B-AAA20688463A@me.com>


On Jan 25, 2013, at 12:16 PM, Christian Sigg <christian at sigg-iten.ch> wrote:

> Dear Duncan
> 
>> I don't think my point contradicts the FSF interpretation.  I think they were talking about using GPL modules in a program you distribute, with the implication that you are distributing the modules along with your program.  However, I could be wrong.  If I am wrong and the FSF agrees with your strong interpretation, then I do think they are wrong.
> 
> Let me again quote parts of the GPL FAQ:
> 
>> Another similar and very common case is to provide libraries with the interpreter which are themselves interpreted. For instance, Perl comes with many Perl modules, and a Java implementation comes with many Java classes. These libraries and the programs that call them are always dynamically linked together.
>> 
>> A consequence is that if you choose to use GPL'd Perl modules or Java classes in your program, you must release the program in a GPL-compatible way, regardless of the license used in the Perl or Java interpreter that the combined Perl or Java program will run on. 
> 
> The second paragraph (applied to R) says that if I use a GPL'd R package, I must release the program in a GPL-compatible way. It makes no mention of distributing the GPLed modules along with the program. 
> 
> I think that this FAQ entry precisely exists because in an interpreted environment, it is possible to make use of the functionality of a GPLed package without copying code (in source or binary form) from that package into my program (beyond the API calls), as it would happen in static linking. The last sentence of the first paragraph unambiguously asserts that calling functionality from an R package is equivalent to dynamic linking of my program with the package. 
> 
> The preceding entry of the GPL FAQ has this to say:
> 
>> If a library is released under the GPL (not the LGPL), does that mean that any software which uses it has to be under the GPL or a GPL-compatible license? (#IfLibraryIsGPL)
>> 
>>    Yes, because the software as it is actually run includes the library.
> 
> There exist several licenses which modify the GPL explicitly to allow for dynamic linking to a GPLed library without having to release the program under the GPL (e.g. LGPL, Classpath Licence, GCC Runtime Library Exception. The following section again states that dynamic linking implies that a program and the package become effectively a single program, which needs to be released under the GPL:
> 
>> Can I release a non-free program that's designed to load a GPL-covered plug-in? (#NFUseGPLPlugins)
>> 
>>   (...)
>> 
>>    If the program dynamically links plug-ins, and they make function calls to each other and share data structures, we believe they form a single program, which must be treated as an extension of both the main program and the plug-ins. In order to use the GPL-covered plug-ins, the main program must be released under the GPL or a GPL-compatible free software license, and that the terms of the GPL must be followed when the main program is distributed for use with these plug-ins.
> 
> 
> I see nothing in the FAQ which would indicate that these points were only valid if the GPLed R package is distributed along with my program.
> 
> 
>> If you write something that incorporates nothing of mine, I can't see how my copyright could influence you at all.  If a user needs my code to make yours useful, I don't see how any of that changes.  The GPL is quite clear that it doesn't restrict people in how they use the code, it just gives them rights to copy it (possibly in a modified form, if they follow the rules).
> 
> I think I understand your position, and personally applied the same reasoning when reading the GPL. But the above quoted sections unambiguously concern usage and dynamic linking, and make no mention of copying code. 
> 
>> No, CRAN and the R Foundation have not published that.  I don't think either group will publish a position.  You can guess the current beliefs of the folks at CRAN by seeing what they do (under the reasonable assumption that they do not think they are doing anything illegal), but those beliefs might change.  The R Foundation does almost nothing, so it's a little more inscrutable.
> 
> I already mentioned in my first email what I assume is the position of the CRAN maintainers and the R Foundation, i.e. that they believe that distributing non GPL-compatible packages which depend on GPL packages is not a violation of the GPL. But if my reading of the GPL FAQ has any merit, then the FSF has a different position. And because the R project is an official GNU project, the FSF interpretation of the GPL is important for the R project. A clarification of the position of the CRAN maintainers and the R Foundation would therefore be helpful.
> 
> Prof. Leisch explicitly mentions that discussions concerning such issues (e.g. combining R with non-free functionality) are taking place, and that a common position is sought with the intent of publishing it:
> 
>> Just a short clarification (by no means intended to stop the thread):
>> as you can imagine we are discussing the matter internally in R Core
>> and the Foundation, but there are different views and we want to
>> consolidate before we make a public statement.  If all of us were of
>> the same opinion we would already have made one.
> 
> 
> 
> 
>>> Note that I am not asking for legal advice,
>> 
>> You should be.  If you really want to know whether they are using your code illegally, or about whether your proposed use of other peoples code is legal, you really should get legal advice.
> 
> This issue has been brought up several times, making it a frequently asked question (for some definitions of frequently :-). A clarification of the position of the CRAN maintainers and the R Foundation is valuable, and does not have to constitute legal advice.
> 
> Best regards,
> Christian



Some additional points, if I may:

1. The discussion that Christian points to which references Fritz' comments is now going on 4 years old. I have seen nothing, to my recollection, that represents a formal position being taken by the R Foundation on this issue. Thus, I would not have any expectation that they will. If something has been decided, it appears to be a default position to not change anything vis-a-vis CRAN without sufficient motivation to do so, which would logically be legally based at some level.

2. As Christian notes, R is a GNU project and is therefore a high profile project within the open source community. I take a certain level of comfort that none of the FSF, any other open source advocacy organization or RMS himself (who as we all know is not shy on these issues and who has spoken at a useR meeting), has elected to take a negative position on this issue, resulting in any change in the behavior of CRAN. In other words, there has been no cease and desist communication regarding the distribution of non-GPL compatible packages on CRAN or elsewhere for that matter. If there was, I have no doubt that we all would have heard about it and those packages would be off CRAN or other points of distribution by now. Given some of the "energy" contained in prior communications on this issue, I would envision that one or more of those previous participants would have taken it upon themselves to proactively communicate their concerns to the FSF. Just saying.

3. There are for-profit commercial vendors of R distributions who have built proprietary components on top of R, who distribute R and other components, including add-on packages, under multiple licensing scenarios. I have absolutely no doubt that those vendors' corporate legal counsel have rendered formal legal opinions suitable to the respective companies and their boards of directors/investors/shareholders that a clear separation can be made between R as a GPL application and other components that do not need to be released under a GPL compatible license, given appropriate parameters.

So there appear to be two issues here:

1. Should CRAN, as a distribution network for a GPL application, contain non-GPL compatible packages. As I noted, that appears to be a philosophical issue, with at least a de facto position being held by the R Foundation at this time.

2. Can non-GPL compatible packages for R even be created (even if "pure R"), based upon the interpretation of the GPL that Christian has postulated? Any third party R program is certainly going to call at minimum, base R functions who's source code and/or compiled binaries are not contained in the user's package/code. Thus there is an implicit dependency on base R functionality other than the interpreter/parser itself. Given this, it seems to me that this possible interpretation of the GPL applies even in the scenario where I create an R package that does not depend upon someone else's CRAN package for functionality. The significant and long standing precedent in the marketplace would seem to indicate that the answer is Yes.

Regards,

Marc


From simon.urbanek at r-project.org  Fri Jan 25 21:45:20 2013
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Fri, 25 Jan 2013 15:45:20 -0500
Subject: [Rd] Implications of a Dependency on a GPLed Package
In-Reply-To: <3B55B247-5400-4DF7-A02B-AAA20688463A@me.com>
References: <0DF07420-6ECC-4F72-BDA8-10EEDDA63A1B@sigg-iten.ch>
	<51027B4F.8040909@gmail.com>
	<482D02E2-0BCF-48DA-8D1C-D4C34B0C38B1@sigg-iten.ch>
	<3B55B247-5400-4DF7-A02B-AAA20688463A@me.com>
Message-ID: <DFE65E3C-4C24-47FE-A833-F5120D15480E@r-project.org>


On Jan 25, 2013, at 3:32 PM, Marc Schwartz wrote:

> 
> On Jan 25, 2013, at 12:16 PM, Christian Sigg <christian at sigg-iten.ch> wrote:
> 
>> Dear Duncan
>> 
>>> I don't think my point contradicts the FSF interpretation.  I think they were talking about using GPL modules in a program you distribute, with the implication that you are distributing the modules along with your program.  However, I could be wrong.  If I am wrong and the FSF agrees with your strong interpretation, then I do think they are wrong.
>> 
>> Let me again quote parts of the GPL FAQ:
>> 
>>> Another similar and very common case is to provide libraries with the interpreter which are themselves interpreted. For instance, Perl comes with many Perl modules, and a Java implementation comes with many Java classes. These libraries and the programs that call them are always dynamically linked together.
>>> 
>>> A consequence is that if you choose to use GPL'd Perl modules or Java classes in your program, you must release the program in a GPL-compatible way, regardless of the license used in the Perl or Java interpreter that the combined Perl or Java program will run on. 
>> 
>> The second paragraph (applied to R) says that if I use a GPL'd R package, I must release the program in a GPL-compatible way. It makes no mention of distributing the GPLed modules along with the program. 
>> 
>> I think that this FAQ entry precisely exists because in an interpreted environment, it is possible to make use of the functionality of a GPLed package without copying code (in source or binary form) from that package into my program (beyond the API calls), as it would happen in static linking. The last sentence of the first paragraph unambiguously asserts that calling functionality from an R package is equivalent to dynamic linking of my program with the package. 
>> 
>> The preceding entry of the GPL FAQ has this to say:
>> 
>>> If a library is released under the GPL (not the LGPL), does that mean that any software which uses it has to be under the GPL or a GPL-compatible license? (#IfLibraryIsGPL)
>>> 
>>>   Yes, because the software as it is actually run includes the library.
>> 
>> There exist several licenses which modify the GPL explicitly to allow for dynamic linking to a GPLed library without having to release the program under the GPL (e.g. LGPL, Classpath Licence, GCC Runtime Library Exception. The following section again states that dynamic linking implies that a program and the package become effectively a single program, which needs to be released under the GPL:
>> 
>>> Can I release a non-free program that's designed to load a GPL-covered plug-in? (#NFUseGPLPlugins)
>>> 
>>>  (...)
>>> 
>>>   If the program dynamically links plug-ins, and they make function calls to each other and share data structures, we believe they form a single program, which must be treated as an extension of both the main program and the plug-ins. In order to use the GPL-covered plug-ins, the main program must be released under the GPL or a GPL-compatible free software license, and that the terms of the GPL must be followed when the main program is distributed for use with these plug-ins.
>> 
>> 
>> I see nothing in the FAQ which would indicate that these points were only valid if the GPLed R package is distributed along with my program.
>> 
>> 
>>> If you write something that incorporates nothing of mine, I can't see how my copyright could influence you at all.  If a user needs my code to make yours useful, I don't see how any of that changes.  The GPL is quite clear that it doesn't restrict people in how they use the code, it just gives them rights to copy it (possibly in a modified form, if they follow the rules).
>> 
>> I think I understand your position, and personally applied the same reasoning when reading the GPL. But the above quoted sections unambiguously concern usage and dynamic linking, and make no mention of copying code. 
>> 
>>> No, CRAN and the R Foundation have not published that.  I don't think either group will publish a position.  You can guess the current beliefs of the folks at CRAN by seeing what they do (under the reasonable assumption that they do not think they are doing anything illegal), but those beliefs might change.  The R Foundation does almost nothing, so it's a little more inscrutable.
>> 
>> I already mentioned in my first email what I assume is the position of the CRAN maintainers and the R Foundation, i.e. that they believe that distributing non GPL-compatible packages which depend on GPL packages is not a violation of the GPL. But if my reading of the GPL FAQ has any merit, then the FSF has a different position. And because the R project is an official GNU project, the FSF interpretation of the GPL is important for the R project. A clarification of the position of the CRAN maintainers and the R Foundation would therefore be helpful.
>> 
>> Prof. Leisch explicitly mentions that discussions concerning such issues (e.g. combining R with non-free functionality) are taking place, and that a common position is sought with the intent of publishing it:
>> 
>>> Just a short clarification (by no means intended to stop the thread):
>>> as you can imagine we are discussing the matter internally in R Core
>>> and the Foundation, but there are different views and we want to
>>> consolidate before we make a public statement.  If all of us were of
>>> the same opinion we would already have made one.
>> 
>> 
>> 
>> 
>>>> Note that I am not asking for legal advice,
>>> 
>>> You should be.  If you really want to know whether they are using your code illegally, or about whether your proposed use of other peoples code is legal, you really should get legal advice.
>> 
>> This issue has been brought up several times, making it a frequently asked question (for some definitions of frequently :-). A clarification of the position of the CRAN maintainers and the R Foundation is valuable, and does not have to constitute legal advice.
>> 
>> Best regards,
>> Christian
> 
> 
> 
> Some additional points, if I may:
> 
> 1. The discussion that Christian points to which references Fritz' comments is now going on 4 years old. I have seen nothing, to my recollection, that represents a formal position being taken by the R Foundation on this issue.

I'm somewhat baffled that the one official statement that the R Foundation made specifically for this purpose is apparently being overlooked:

https://stat.ethz.ch/pipermail/r-devel/2009-May/053248.html

Cheers,
Simon




> Thus, I would not have any expectation that they will. If something has been decided, it appears to be a default position to not change anything vis-a-vis CRAN without sufficient motivation to do so, which would logically be legally based at some level.
> 
> 2. As Christian notes, R is a GNU project and is therefore a high profile project within the open source community. I take a certain level of comfort that none of the FSF, any other open source advocacy organization or RMS himself (who as we all know is not shy on these issues and who has spoken at a useR meeting), has elected to take a negative position on this issue, resulting in any change in the behavior of CRAN. In other words, there has been no cease and desist communication regarding the distribution of non-GPL compatible packages on CRAN or elsewhere for that matter. If there was, I have no doubt that we all would have heard about it and those packages would be off CRAN or other points of distribution by now. Given some of the "energy" contained in prior communications on this issue, I would envision that one or more of those previous participants would have taken it upon themselves to proactively communicate their concerns to the FSF. Just saying.
> 
> 3. There are for-profit commercial vendors of R distributions who have built proprietary components on top of R, who distribute R and other components, including add-on packages, under multiple licensing scenarios. I have absolutely no doubt that those vendors' corporate legal counsel have rendered formal legal opinions suitable to the respective companies and their boards of directors/investors/shareholders that a clear separation can be made between R as a GPL application and other components that do not need to be released under a GPL compatible license, given appropriate parameters.
> 
> So there appear to be two issues here:
> 
> 1. Should CRAN, as a distribution network for a GPL application, contain non-GPL compatible packages. As I noted, that appears to be a philosophical issue, with at least a de facto position being held by the R Foundation at this time.
> 
> 2. Can non-GPL compatible packages for R even be created (even if "pure R"), based upon the interpretation of the GPL that Christian has postulated? Any third party R program is certainly going to call at minimum, base R functions who's source code and/or compiled binaries are not contained in the user's package/code. Thus there is an implicit dependency on base R functionality other than the interpreter/parser itself. Given this, it seems to me that this possible interpretation of the GPL applies even in the scenario where I create an R package that does not depend upon someone else's CRAN package for functionality. The significant and long standing precedent in the marketplace would seem to indicate that the answer is Yes.
> 
> Regards,
> 
> Marc
> 
> 


From marc_schwartz at me.com  Fri Jan 25 21:55:08 2013
From: marc_schwartz at me.com (Marc Schwartz)
Date: Fri, 25 Jan 2013 14:55:08 -0600
Subject: [Rd] Implications of a Dependency on a GPLed Package
In-Reply-To: <DFE65E3C-4C24-47FE-A833-F5120D15480E@r-project.org>
References: <0DF07420-6ECC-4F72-BDA8-10EEDDA63A1B@sigg-iten.ch>
	<51027B4F.8040909@gmail.com>
	<482D02E2-0BCF-48DA-8D1C-D4C34B0C38B1@sigg-iten.ch>
	<3B55B247-5400-4DF7-A02B-AAA20688463A@me.com>
	<DFE65E3C-4C24-47FE-A833-F5120D15480E@r-project.org>
Message-ID: <412F40C9-B5FB-4C10-BFC5-1968304D41A8@me.com>


On Jan 25, 2013, at 2:45 PM, Simon Urbanek <Simon.Urbanek at r-project.org> wrote:

> 
> On Jan 25, 2013, at 3:32 PM, Marc Schwartz wrote:
> 
>> 
>> On Jan 25, 2013, at 12:16 PM, Christian Sigg <christian at sigg-iten.ch> wrote:
>> 
>>> Dear Duncan
>>> 
>>>> I don't think my point contradicts the FSF interpretation.  I think they were talking about using GPL modules in a program you distribute, with the implication that you are distributing the modules along with your program.  However, I could be wrong.  If I am wrong and the FSF agrees with your strong interpretation, then I do think they are wrong.
>>> 
>>> Let me again quote parts of the GPL FAQ:
>>> 
>>>> Another similar and very common case is to provide libraries with the interpreter which are themselves interpreted. For instance, Perl comes with many Perl modules, and a Java implementation comes with many Java classes. These libraries and the programs that call them are always dynamically linked together.
>>>> 
>>>> A consequence is that if you choose to use GPL'd Perl modules or Java classes in your program, you must release the program in a GPL-compatible way, regardless of the license used in the Perl or Java interpreter that the combined Perl or Java program will run on. 
>>> 
>>> The second paragraph (applied to R) says that if I use a GPL'd R package, I must release the program in a GPL-compatible way. It makes no mention of distributing the GPLed modules along with the program. 
>>> 
>>> I think that this FAQ entry precisely exists because in an interpreted environment, it is possible to make use of the functionality of a GPLed package without copying code (in source or binary form) from that package into my program (beyond the API calls), as it would happen in static linking. The last sentence of the first paragraph unambiguously asserts that calling functionality from an R package is equivalent to dynamic linking of my program with the package. 
>>> 
>>> The preceding entry of the GPL FAQ has this to say:
>>> 
>>>> If a library is released under the GPL (not the LGPL), does that mean that any software which uses it has to be under the GPL or a GPL-compatible license? (#IfLibraryIsGPL)
>>>> 
>>>>  Yes, because the software as it is actually run includes the library.
>>> 
>>> There exist several licenses which modify the GPL explicitly to allow for dynamic linking to a GPLed library without having to release the program under the GPL (e.g. LGPL, Classpath Licence, GCC Runtime Library Exception. The following section again states that dynamic linking implies that a program and the package become effectively a single program, which needs to be released under the GPL:
>>> 
>>>> Can I release a non-free program that's designed to load a GPL-covered plug-in? (#NFUseGPLPlugins)
>>>> 
>>>> (...)
>>>> 
>>>>  If the program dynamically links plug-ins, and they make function calls to each other and share data structures, we believe they form a single program, which must be treated as an extension of both the main program and the plug-ins. In order to use the GPL-covered plug-ins, the main program must be released under the GPL or a GPL-compatible free software license, and that the terms of the GPL must be followed when the main program is distributed for use with these plug-ins.
>>> 
>>> 
>>> I see nothing in the FAQ which would indicate that these points were only valid if the GPLed R package is distributed along with my program.
>>> 
>>> 
>>>> If you write something that incorporates nothing of mine, I can't see how my copyright could influence you at all.  If a user needs my code to make yours useful, I don't see how any of that changes.  The GPL is quite clear that it doesn't restrict people in how they use the code, it just gives them rights to copy it (possibly in a modified form, if they follow the rules).
>>> 
>>> I think I understand your position, and personally applied the same reasoning when reading the GPL. But the above quoted sections unambiguously concern usage and dynamic linking, and make no mention of copying code. 
>>> 
>>>> No, CRAN and the R Foundation have not published that.  I don't think either group will publish a position.  You can guess the current beliefs of the folks at CRAN by seeing what they do (under the reasonable assumption that they do not think they are doing anything illegal), but those beliefs might change.  The R Foundation does almost nothing, so it's a little more inscrutable.
>>> 
>>> I already mentioned in my first email what I assume is the position of the CRAN maintainers and the R Foundation, i.e. that they believe that distributing non GPL-compatible packages which depend on GPL packages is not a violation of the GPL. But if my reading of the GPL FAQ has any merit, then the FSF has a different position. And because the R project is an official GNU project, the FSF interpretation of the GPL is important for the R project. A clarification of the position of the CRAN maintainers and the R Foundation would therefore be helpful.
>>> 
>>> Prof. Leisch explicitly mentions that discussions concerning such issues (e.g. combining R with non-free functionality) are taking place, and that a common position is sought with the intent of publishing it:
>>> 
>>>> Just a short clarification (by no means intended to stop the thread):
>>>> as you can imagine we are discussing the matter internally in R Core
>>>> and the Foundation, but there are different views and we want to
>>>> consolidate before we make a public statement.  If all of us were of
>>>> the same opinion we would already have made one.
>>> 
>>> 
>>> 
>>> 
>>>>> Note that I am not asking for legal advice,
>>>> 
>>>> You should be.  If you really want to know whether they are using your code illegally, or about whether your proposed use of other peoples code is legal, you really should get legal advice.
>>> 
>>> This issue has been brought up several times, making it a frequently asked question (for some definitions of frequently :-). A clarification of the position of the CRAN maintainers and the R Foundation is valuable, and does not have to constitute legal advice.
>>> 
>>> Best regards,
>>> Christian
>> 
>> 
>> 
>> Some additional points, if I may:
>> 
>> 1. The discussion that Christian points to which references Fritz' comments is now going on 4 years old. I have seen nothing, to my recollection, that represents a formal position being taken by the R Foundation on this issue.
> 
> I'm somewhat baffled that the one official statement that the R Foundation made specifically for this purpose is apparently being overlooked:
> 
> https://stat.ethz.ch/pipermail/r-devel/2009-May/053248.html
> 
> Cheers,
> Simon


Well, clearly my recollection is faulty. Thanks for that Simon. Now that you point that out, I do recall Robert's post, albeit, I think it got lost in the traffic on R-Devel, which contributes to the lack of recall.

Perhaps it would be reasonable to add something to the R FAQs which at least points to that post.

As noted, it implies that the position of the R Foundation is that non-GPL compatible packages are suitable for distribution via CRAN. Note that I am not disagreeing with that position, nor advocating any change.

Regards,

Marc


> 
>> Thus, I would not have any expectation that they will. If something has been decided, it appears to be a default position to not change anything vis-a-vis CRAN without sufficient motivation to do so, which would logically be legally based at some level.
>> 
>> 2. As Christian notes, R is a GNU project and is therefore a high profile project within the open source community. I take a certain level of comfort that none of the FSF, any other open source advocacy organization or RMS himself (who as we all know is not shy on these issues and who has spoken at a useR meeting), has elected to take a negative position on this issue, resulting in any change in the behavior of CRAN. In other words, there has been no cease and desist communication regarding the distribution of non-GPL compatible packages on CRAN or elsewhere for that matter. If there was, I have no doubt that we all would have heard about it and those packages would be off CRAN or other points of distribution by now. Given some of the "energy" contained in prior communications on this issue, I would envision that one or more of those previous participants would have taken it upon themselves to proactively communicate their concerns to the FSF. Just saying.
>> 
>> 3. There are for-profit commercial vendors of R distributions who have built proprietary components on top of R, who distribute R and other components, including add-on packages, under multiple licensing scenarios. I have absolutely no doubt that those vendors' corporate legal counsel have rendered formal legal opinions suitable to the respective companies and their boards of directors/investors/shareholders that a clear separation can be made between R as a GPL application and other components that do not need to be released under a GPL compatible license, given appropriate parameters.
>> 
>> So there appear to be two issues here:
>> 
>> 1. Should CRAN, as a distribution network for a GPL application, contain non-GPL compatible packages. As I noted, that appears to be a philosophical issue, with at least a de facto position being held by the R Foundation at this time.
>> 
>> 2. Can non-GPL compatible packages for R even be created (even if "pure R"), based upon the interpretation of the GPL that Christian has postulated? Any third party R program is certainly going to call at minimum, base R functions who's source code and/or compiled binaries are not contained in the user's package/code. Thus there is an implicit dependency on base R functionality other than the interpreter/parser itself. Given this, it seems to me that this possible interpretation of the GPL applies even in the scenario where I create an R package that does not depend upon someone else's CRAN package for functionality. The significant and long standing precedent in the marketplace would seem to indicate that the answer is Yes.
>> 
>> Regards,
>> 
>> Marc
>> 
>> 
>


From S.Ellison at LGCGroup.com  Fri Jan 25 23:40:46 2013
From: S.Ellison at LGCGroup.com (S Ellison)
Date: Fri, 25 Jan 2013 22:40:46 +0000
Subject: [Rd] Implications of a Dependency on a GPLed Package
In-Reply-To: <0DF07420-6ECC-4F72-BDA8-10EEDDA63A1B@sigg-iten.ch>
References: <0DF07420-6ECC-4F72-BDA8-10EEDDA63A1B@sigg-iten.ch>
Message-ID: <7C52ABB0-EFE2-4F11-8DDC-C8624B854A1D@LGCGroup.com>


> 
> 
> 
> 1. If I develop and distribute an R package which depends on another package that is released under the GPL, I have to release my package in a GPL-compatible way.
It is probably worth remembering that declaring a 'dependency' of package foo on package bar in the R inter-package sense and then distributing package foo does not of itself constitute distribution, propagation or conveying of package bar. 

And if a user of non-gpl  code you have distributed  downloads gpl code themselves,  that would not constitute gpl-forbidden distribution on your part even if they needed to do so to run your code - for the simple reason that you have not distributed the gpl code as part of your software. Nor does the gpl prevent a user from doing that.



> 2. Given that R itself is distributed as a set of base packages (released under the GPL), and a distinction between making use of the R "language" and making use of functionality provided by the base packages seem impossible, the above section could also imply that it is not possible at all to release R code under a license that is not GPL-compatible.

That would be nonsense, as I understand matters. You can distribute R (or any other) code under any license you like provided it does not include GPL'd code (though you can even include gpl'd code if you have due permission - and thereby a different license - from the copyright holder. Assuming you can find them, of course). 
Besides, the language is S. The R software is just a system that implements it. The distinction seems pretty clear to me.


Caveat: I'm a chemist, and the above is an opinion. Like the man said, if yer needs advice on a point of law, yer should get yerself a lawyer. 


*******************************************************************
This email and any attachments are confidential. Any use...{{dropped:8}}


From christian at sigg-iten.ch  Sat Jan 26 01:39:35 2013
From: christian at sigg-iten.ch (Christian Sigg)
Date: Sat, 26 Jan 2013 01:39:35 +0100
Subject: [Rd] Implications of a Dependency on a GPLed Package
In-Reply-To: <DFE65E3C-4C24-47FE-A833-F5120D15480E@r-project.org>
References: <0DF07420-6ECC-4F72-BDA8-10EEDDA63A1B@sigg-iten.ch>
	<51027B4F.8040909@gmail.com>
	<482D02E2-0BCF-48DA-8D1C-D4C34B0C38B1@sigg-iten.ch>
	<3B55B247-5400-4DF7-A02B-AAA20688463A@me.com>
	<DFE65E3C-4C24-47FE-A833-F5120D15480E@r-project.org>
Message-ID: <3440B51F-4B3D-468F-9946-9A2F497B7AEA@sigg-iten.ch>

Dear Simon

Thank you for the link. This is exactly the kind of statement that I was looking for.

I searched the archives for any mention of the GPL, for posts by Prof. Leisch and some other keywords before posting to the list. Could this statement be added to the R FAQ and/or the CRAN repository policy, such that it is easier to find in the future?

Best regards,
Christian

From christian at sigg-iten.ch  Sat Jan 26 01:39:39 2013
From: christian at sigg-iten.ch (Christian Sigg)
Date: Sat, 26 Jan 2013 01:39:39 +0100
Subject: [Rd] Implications of a Dependency on a GPLed Package
In-Reply-To: <3B55B247-5400-4DF7-A02B-AAA20688463A@me.com>
References: <0DF07420-6ECC-4F72-BDA8-10EEDDA63A1B@sigg-iten.ch>
	<51027B4F.8040909@gmail.com>
	<482D02E2-0BCF-48DA-8D1C-D4C34B0C38B1@sigg-iten.ch>
	<3B55B247-5400-4DF7-A02B-AAA20688463A@me.com>
Message-ID: <32715448-CDA7-4818-8E7B-E04AFD0D7944@sigg-iten.ch>

Dear Marc

> 2. Can non-GPL compatible packages for R even be created (even if "pure R"), based upon the interpretation of the GPL that Christian has postulated?

I am not trying to offer my own interpretation of the GPL, which is entirely irrelevant. (If anyone is interested, I fall on the "pragmatic" side of the spectrum). I tried to give an accurate rendition of the interpretation of the FSF as stated in the GPL FAQ, which is relevant for the R project. Even though the legal basis of their reasoning seems unclear, to me, the argumentation as given in the GPL FAQ is quite clear and can be summarised as:

1. In an interpreted environment, using library/module/package functionality in a program implies dynamic linking of the library and the program.

2. Because of the dynamic linking, the library and the program effectively form a single program.

3. Therefore, if the library is released under the GPL (without any linking exception), the program has to be released under a GPL-compatible license.

Of course, others can disagree with my understanding the argument given in the GPL FAQ, and I might not have stated the FSF position correctly. 

If others read the same sections of the GPL FAQ and come to a different conclusion w.r.t. the FSF interpretation of the GPL, I would be interested to hear their reasoning, unless this is considered off-topic for R-devel.

Best regards,
Christian

From bbolker at gmail.com  Sat Jan 26 21:05:38 2013
From: bbolker at gmail.com (Ben Bolker)
Date: Sat, 26 Jan 2013 20:05:38 +0000
Subject: [Rd] (patch) Layers for pdf() grDevice
References: <CA+xQbCV55Z6EjENF4aWvStcR+5UQ399go9DdD_+JZ3hzCmn=mw@mail.gmail.com>
Message-ID: <loom.20130126T210112-959@post.gmane.org>

Evan J Brunner <ejbrunner <at> gmail.com> writes:

> 
> I built a patch (
> https://github.com/3jb/R_layers/blob/master/add_pdf_layers_r61733.diff)
> for grDevice/devPS.c adding an argument 'onepage' to pdf(), if set to
> TRUE, successive plots will be printed to layers within a single pdf
> document page rather than successive documents, or successive pages within
> a document.  The patch works on the HEAD of the current svn development
> tree.
> 

  Lots of context snipped, sorry (using gmane).

  This is a pretty ignorant question because I haven't delved very deeply
into graphics coding in R, but: how much harder would it be for you to
incorporated this code into a driver for an alternative graphics device
(call it "pdfx")?  Then you could put it in a package and release it on CRAN.

 * it would be (much) easier to distribute to people who wanted it -- they
could just install a package rather than rebuilding R.
 * R core wouldn't have to agree or disagree as long as you follow the
package submission rules.
 * if it gets popular it might eventually migrate into base R.

 I can also imagine that the cairoDevice maintainers might be interested/willing
to incorporate your patch or one like it.

library("sos"); findFn("{graphics device} driver")

finds packages incorporating alternative graphics devices.

  Ben Bolker


From mdowle at mdowle.plus.com  Sat Jan 26 21:25:58 2013
From: mdowle at mdowle.plus.com (Matthew Dowle)
Date: Sat, 26 Jan 2013 20:25:58 +0000
Subject: [Rd] Implications of a Dependency on a GPLed Package
References: <0DF07420-6ECC-4F72-BDA8-10EEDDA63A1B@sigg-iten.ch>
	<51027B4F.8040909@gmail.com>
	<482D02E2-0BCF-48DA-8D1C-D4C34B0C38B1@sigg-iten.ch>
	<3B55B247-5400-4DF7-A02B-AAA20688463A@me.com>
	<32715448-CDA7-4818-8E7B-E04AFD0D7944@sigg-iten.ch>
Message-ID: <loom.20130126T194850-393@post.gmane.org>

Christian Sigg <christian <at> sigg-iten.ch> writes:
> 
> Dear Marc
> 
> > 2. Can non-GPL compatible packages for R even be created (even if "pure R"), 
based upon the interpretation
> of the GPL that Christian has postulated?
> 
> I am not trying to offer my own interpretation of the GPL, which is entirely 
irrelevant. (If anyone is
> interested, I fall on the "pragmatic" side of the spectrum). I tried to give 
an accurate rendition of the
> interpretation of the FSF as stated in the GPL FAQ, which is relevant for the 
R project. Even though the
> legal basis of their reasoning seems unclear, to me, the argumentation as 
given in the GPL FAQ is quite
> clear and can be summarised as:
> 
> 1. In an interpreted environment, using library/module/package functionality 
in a program implies
> dynamic linking of the library and the program.
> 
> 2. Because of the dynamic linking, the library and the program effectively 
form a single program.
> 
> 3. Therefore, if the library is released under the GPL (without any linking 
exception), the program has to
> be released under a GPL-compatible license.
> 
> Of course, others can disagree with my understanding the argument given in the 
GPL FAQ, and I might not have
> stated the FSF position correctly. 
> 
> If others read the same sections of the GPL FAQ and come to a different 
conclusion w.r.t. the FSF
> interpretation of the GPL, I would be interested to hear their reasoning, 
unless this is considered
> off-topic for R-devel.
> 
> Best regards,
> Christian
> 

Ok here's a possible different conclusion and reasoning. Here's the 1st 
paragraph of the FAQ, in full :

    http://www.gnu.org/licenses/gpl-faq.html#IfInterpreterIsGPL

   " When the interpreter just interprets a language, the answer is no. The 
interpreted program, to the interpreter, is just data; a free software license 
like the GPL, based on copyright law, cannot limit what data you use the 
interpreter on. You can run it on any data (interpreted program), any way you 
like, and there are no requirements about licensing that data to anyone. "

Therefore, R only packages (no C code) are just data. The GPL doesn't apply to 
them. R only packages depending on other R only packages are just data depending 
on data.

You appear to have been concentrating on the 2nd paragraph onwards of that FAQ. 
The 2nd paragraph starts :

   " However, when the interpreter is extended to provide ?bindings? to other 
facilities... "

There, "bindings" could be seen as related to "linking" at C level. Especially 
since later in the same paragraph the distinctions "statically" and 
"dynamically" are made. Therefore that FAQ's 1st paragraph could be interpreted 
as the only relevant one from that FAQ, for R only packages.

The view that R code is just data is quite widespread and agreed upon, iiuc.

Does that help?

Matthew


From mtmorgan at fhcrc.org  Sun Jan 27 20:20:37 2013
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Sun, 27 Jan 2013 11:20:37 -0800
Subject: [Rd] bug and enhancement to split?
Message-ID: <51057E05.3030907@fhcrc.org>

With

 > R.version.string
[1] "R Under development (unstable) (2013-01-26 r61752)"

'split.default' recycles a short factor for unclassed 'x', but not for an 
instance of x that is a class

 > split(1:5, 1:2)
$`1`
[1] 1 3 5

$`2`
[1] 2 4

Warning message:
In split.default(1:5, 1:2) :
   data length is not a multiple of split variable
 > x = structure(1:5, class="A")
 > split(x, 1:2)
$`1`
[1] 1

$`2`
[1] 2

Also, this is inconsistent with split<-, which does have recycling

 > split(x, 1:2) <- 1:2
Warning message:
In split.default(seq_along(x), f, drop = drop, ...) :
   data length is not a multiple of split variable
 > x
[1] 1 2 1 2 1
attr(,"class")
[1] "A"

A solution is to change a call to seq_along(f) toward the end of split.default 
to seq_along(x).

@@ -32,7 +32,7 @@
      lf <- levels(f)
      y <- vector("list", length(lf))
      names(y) <- lf
-    ind <- .Internal(split(seq_along(f), f))
+    ind <- .Internal(split(seq_along(x), f))
      for(k in lf) y[[k]] <- x[ind[[k]]]
      y
  }



Maybe a little harder to argue the following, but in split.default, for a class 
that one might wish to develop factor-like behaviour, e.g.,

   Rle = setClass("Rle", representation(values="integer", lengths="integer"))
   f = Rle(values=1:2, lengths=2:3)

the code

     if (is.list(f))
         f <- interaction(f, drop = drop, sep = sep)
     else if (drop || !is.factor(f))
         f <- factor(f)

requires that one make factor a generic and develop a method for factor.Rle. 
This contradicts the documentation

        f: a ?factor? in the sense that ?as.factor(f)? defines the
           grouping, or a list of such factors in which case their
           interaction is used for the grouping.

and perhaps the more common (?) pattern of coercion using as.*. A solution is to 
make as.factor a generic and revises the code above to use something like

      if (is.list(f)) f <- interaction(f, drop = drop, sep = sep)
      else if (!is.factor(f)) f <- as.factor(f)
      else if (drop) f <- factor(f)

One then gets split behaviour if there is an as.factor.Rle method

     as.factor.Rle <- function(x, ...)
         factor(rep(x at values, x at lengths), levels=unique(x at values))
     setAs("Rle", "factor", function(from) as.factor.Rle(from))

These more elaborate changes are in the attached diff.

Martin
-- 
Computational Biology / Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N.
PO Box 19024 Seattle, WA 98109

Location: Arnold Building M1 B861
Phone: (206) 667-2793
-------------- next part --------------
A non-text attachment was scrubbed...
Name: split.diff.tar.gz
Type: application/x-gzip
Size: 1184 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20130127/8541e1ea/attachment.gz>

From suharto_anggono at yahoo.com  Mon Jan 28 08:54:50 2013
From: suharto_anggono at yahoo.com (Suharto Anggono Suharto Anggono)
Date: Sun, 27 Jan 2013 23:54:50 -0800 (PST)
Subject: [Rd] Minor issue in code of 'diffinv.vector' in R 2.15.2
Message-ID: <1359359690.66264.YahooMailClassic@web125102.mail.ne1.yahoo.com>

In R 2.15.2 (and not before), in the definition of function 'diffinv.vector' in package stats, there is

difference <- as.integer(differences)

I believe

differences <- as.integer(differences)

is intended, because 'difference' is not referenced anywhere. However, without conversion of 'differences' to integer, 'diffinv.vector' in R 2.15.2 works OK.


Also, to make 'differences' consistently integer,

        diffinv.vector(diffinv.vector(x, lag, differences-1,
                                      diff(xi, lag=lag, differences=1)),
                       lag, 1, xi[1L:lag])

in the end part can be changed to

        diffinv.vector(diffinv.vector(x, lag, differences-1L,
                                      diff(xi, lag=lag, differences=1L)),
                       lag, 1L, xi[1L:lag])


From Thierry.ONKELINX at inbo.be  Mon Jan 28 11:10:38 2013
From: Thierry.ONKELINX at inbo.be (ONKELINX, Thierry)
Date: Mon, 28 Jan 2013 10:10:38 +0000
Subject: [Rd] incorrect import?
Message-ID: <AA818EAD2576BC488B4F623941DA74279885863D@inbomail.inbo.be>

Dear all,

I'm not getting what I'm doing wrong. The line below from my read.fsa.bin function throws an error when just loading my AFLP package and disappears when I load the zoo package as well.

#the line that throws the error
Index <- which(Peak == rollmax(Peak, k = 1 + 2 * floor((min(diff(SizeStandard)) * Fs - 1) / 2), fill = -Inf))
#the error
Error in UseMethod("rollmax") :  no applicable method for 'rollmax' applied to an object of class "c('double', 'numeric')"

DESCRIPTION of the AFLP package contains
Imports: ggplot2, mvtnorm, seqinr, zoo, signal, xtable, vegan

The NAMESPACE contains
importFrom("zoo", rollmax)

What am I missing?

The source files are available on https://r-forge.r-project.org/scm/?group_id=1027

Best regards,

Thierry

ir. Thierry Onkelinx
Instituut voor natuur- en bosonderzoek / Research Institute for Nature and Forest
team Biometrie & Kwaliteitszorg / team Biometrics & Quality Assurance
Kliniekstraat 25
1070 Anderlecht
Belgium
+ 32 2 525 02 51
+ 32 54 43 61 85
Thierry.Onkelinx at inbo.be
www.inbo.be

To call in the statistician after the experiment is done may be no more than asking him to perform a post-mortem examination: he may be able to say what the experiment died of.
~ Sir Ronald Aylmer Fisher

The plural of anecdote is not data.
~ Roger Brinner

The combination of some data and an aching desire for an answer does not ensure that a reasonable answer can be extracted from a given body of data.
~ John Tukey


* * * * * * * * * * * * * D I S C L A I M E R * * * * * * * * * * * * *
Dit bericht en eventuele bijlagen geven enkel de visie van de schrijver weer en binden het INBO onder geen enkel beding, zolang dit bericht niet bevestigd is door een geldig ondertekend document.
The views expressed in this message and any annex are purely those of the writer and may not be regarded as stating an official position of INBO, as long as the message is not confirmed by a duly signed document.


From suharto_anggono at yahoo.com  Mon Jan 28 11:31:51 2013
From: suharto_anggono at yahoo.com (Suharto Anggono Suharto Anggono)
Date: Mon, 28 Jan 2013 02:31:51 -0800 (PST)
Subject: [Rd] Suggestions for 'diff.default'
Message-ID: <1359369111.8635.YahooMailClassic@web125103.mail.ne1.yahoo.com>

I have suggestions for function 'diff.default' in R.


Suggestion 1: If the input is matrix, always return matrix, even if empty.

What happens in R 2.15.2:

> rbind(1:2)    # matrix
     [,1] [,2]
[1,]    1    2
> diff(rbind(1:2))   # not matrix
integer(0)
> sessionInfo()
R version 2.15.2 (2012-10-26)
Platform: i386-w64-mingw32/i386 (32-bit)

locale:
[1] LC_COLLATE=English_United States.1252
[2] LC_CTYPE=English_United States.1252
[3] LC_MONETARY=English_United States.1252
[4] LC_NUMERIC=C
[5] LC_TIME=English_United States.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base


The documentation for 'diff' says, "If 'x' is a matrix then the difference operations are carried out on each column separately."
If the result is empty, I expect that the result still has as many columns as the input.


Suggestion 2: Make 'diff.default' applicable more generally by
(a) not performing 'unclass';
(b) generalizing (changing)
ismat <- is.matrix(x)
to become
ismat <- length(dim(x)) == 2L


If suggestion 1 is to be applied, if 'unclass' is not wanted (point (a) in suggestion 2 is also to be applied),

    if (lag * differences >= xlen)
	return(x[0L])

can be changed to

    if (lag * differences >= xlen)
	return(
            if (ismat) x[0L, , drop = FALSE] - x[0L, , drop = FALSE] else
            x[0L] - x[0L])

It will handle class where subtraction (minus) operation change class.

Otherwise, if 'unclass' is wanted, maybe the handling of empty result can be moved to be after 'unclass', to be consistent with non-empty result.


If point (a) in suggestion 2 is applied, 'diff.default' can handle input of class "Date" and "POSIXt". If, in addition, point (b) in suggestion 2 is also applied, 'diff.default' can handle data frame as input.


From Thierry.ONKELINX at inbo.be  Mon Jan 28 11:39:20 2013
From: Thierry.ONKELINX at inbo.be (ONKELINX, Thierry)
Date: Mon, 28 Jan 2013 10:39:20 +0000
Subject: [Rd] incorrect import?
In-Reply-To: <CAO1zAVYX3VotMcmSAPnRZrSNqO+45M7xB56sy7XEsQY8pejopA@mail.gmail.com>
References: <AA818EAD2576BC488B4F623941DA74279885863D@inbomail.inbo.be>
	<CAO1zAVYX3VotMcmSAPnRZrSNqO+45M7xB56sy7XEsQY8pejopA@mail.gmail.com>
Message-ID: <AA818EAD2576BC488B4F623941DA742798858899@inbomail.inbo.be>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20130128/6355cc68/attachment.pl>

From maechler at stat.math.ethz.ch  Mon Jan 28 11:44:58 2013
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Mon, 28 Jan 2013 11:44:58 +0100
Subject: [Rd] Minor issue in code of 'diffinv.vector' in R 2.15.2
In-Reply-To: <1359359690.66264.YahooMailClassic@web125102.mail.ne1.yahoo.com>
References: <1359359690.66264.YahooMailClassic@web125102.mail.ne1.yahoo.com>
Message-ID: <20742.22186.42206.155505@stat.math.ethz.ch>

>>>>> Suharto Anggono Suharto Anggono <suharto_anggono at yahoo.com>
>>>>>     on Sun, 27 Jan 2013 23:54:50 -0800 writes:

    > In R 2.15.2 (and not before), in the definition of
    > function 'diffinv.vector' in package stats, there is
    > difference <- as.integer(differences)

    > I believe

    > differences <- as.integer(differences)

    > is intended, because 'difference' is not referenced
    > anywhere. However, without conversion of 'differences' to
    > integer, 'diffinv.vector' in R 2.15.2 works OK.

Thank you, Suharto,
you are right... about the typo above, the tweaks below,
*and*  ... ;-) ... that it is a minor issue

  -> changed for R-patched and R-devel.

Martin Maechler, ETH Zurich

    > Also, to make 'differences' consistently integer,

    >         diffinv.vector(diffinv.vector(x, lag,
    > differences-1, diff(xi, lag=lag, differences=1)), lag, 1,
    > xi[1L:lag])

    > in the end part can be changed to

    >         diffinv.vector(diffinv.vector(x, lag,
    > differences-1L, diff(xi, lag=lag, differences=1L)), lag,
    > 1L, xi[1L:lag])


From Mark.Bravington at csiro.au  Mon Jan 28 22:01:16 2013
From: Mark.Bravington at csiro.au (Mark.Bravington at csiro.au)
Date: Tue, 29 Jan 2013 08:01:16 +1100
Subject: [Rd] bug in help: R-devel pre 3.0
In-Reply-To: <51057E05.3030907@fhcrc.org>
References: <51057E05.3030907@fhcrc.org>
Message-ID: <3D59DF35E7CF3E42BA70C23BD5CBE6A8BDFDACA002@exvic-mbx04.nexus.csiro.au>

G'day

There's a bug in R-devel help() when something is documented in multiple places. Eg

> library( gmp)
> ?apply

The browser window then contains:

Error in length(packages):"Help on topic '%s' was found in the following package:" : 
  NA/NaN argument

Also, the *next* time 'help' or '?' is called (even with eg '?glm'), the following warning message appears in the R console.

Warning message:
In ngettext(length(packages):"Help on topic '%s' was found in the following package:",  :
  NAs introduced by coercion

This is on build 61745, but has been around for a while. All good in R 2.15.2 (the browser says there's help in several places, and you get to pick). I'm using windows XP and Firefox as the browser, but the error message looks more general.

bye
Mark

Mark Bravington
CSIRO CMIS
Marine Lab
Hobart
Australia


From murdoch.duncan at gmail.com  Mon Jan 28 22:18:05 2013
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Mon, 28 Jan 2013 16:18:05 -0500
Subject: [Rd] bug in help: R-devel pre 3.0
In-Reply-To: <3D59DF35E7CF3E42BA70C23BD5CBE6A8BDFDACA002@exvic-mbx04.nexus.csiro.au>
References: <51057E05.3030907@fhcrc.org>
	<3D59DF35E7CF3E42BA70C23BD5CBE6A8BDFDACA002@exvic-mbx04.nexus.csiro.au>
Message-ID: <5106EB0D.9060909@gmail.com>

On 13-01-28 4:01 PM, Mark.Bravington at csiro.au wrote:
> G'day
>
> There's a bug in R-devel help() when something is documented in multiple places. Eg
>
>> library( gmp)
>> ?apply
>
> The browser window then contains:
>
> Error in length(packages):"Help on topic '%s' was found in the following package:" :
>    NA/NaN argument
>
> Also, the *next* time 'help' or '?' is called (even with eg '?glm'), the following warning message appears in the R console.
>
> Warning message:
> In ngettext(length(packages):"Help on topic '%s' was found in the following package:",  :
>    NAs introduced by coercion
>
> This is on build 61745, but has been around for a while. All good in R 2.15.2 (the browser says there's help in several places, and you get to pick). I'm using windows XP and Firefox as the browser, but the error message looks more general.
>

It also requires options(help_type="html"); when I set that, I can 
reproduce.  I'll look into it.

Duncan Murdoch


From murdoch.duncan at gmail.com  Mon Jan 28 22:50:36 2013
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Mon, 28 Jan 2013 16:50:36 -0500
Subject: [Rd] bug in help: R-devel pre 3.0
In-Reply-To: <3D59DF35E7CF3E42BA70C23BD5CBE6A8BDFDACA002@exvic-mbx04.nexus.csiro.au>
References: <51057E05.3030907@fhcrc.org>
	<3D59DF35E7CF3E42BA70C23BD5CBE6A8BDFDACA002@exvic-mbx04.nexus.csiro.au>
Message-ID: <5106F2AC.2040600@gmail.com>

On 13-01-28 4:01 PM, Mark.Bravington at csiro.au wrote:
> G'day
>
> There's a bug in R-devel help() when something is documented in multiple places. Eg
>
>> library( gmp)
>> ?apply
>
> The browser window then contains:
>
> Error in length(packages):"Help on topic '%s' was found in the following package:" :
>    NA/NaN argument
>
> Also, the *next* time 'help' or '?' is called (even with eg '?glm'), the following warning message appears in the R console.
>
> Warning message:
> In ngettext(length(packages):"Help on topic '%s' was found in the following package:",  :
>    NAs introduced by coercion
>
> This is on build 61745, but has been around for a while. All good in R 2.15.2 (the browser says there's help in several places, and you get to pick). I'm using windows XP and Firefox as the browser, but the error message looks more general.

Now fixed in r61770.  It was a typo introduced in a change back in 
September having to do with internationalization.  Thanks for the report.

Duncan Murdoch


From peter.ruckdeschel at web.de  Mon Jan 28 23:13:35 2013
From: peter.ruckdeschel at web.de (Peter Ruckdeschel)
Date: Mon, 28 Jan 2013 23:13:35 +0100
Subject: [Rd] R-forge, package dependencies
In-Reply-To: <50F5BE09.7000407@gmail.com>
References: <CAJ55+d+k8b1UCWs-Rpc5obp=AY_FooZDp9JnRaa5cP9Ey9f6WA@mail.gmail.com>
	<50F5B770.9000804@statistik.tu-dortmund.de>
	<50F5BE09.7000407@gmail.com>
Message-ID: <5106F80F.90109@web.de>


Am 15.01.2013 21:37, schrieb Paul Gilbert:
> I'm surprised this works on Windows and Mac, since RMonetDB does not
> seem to be on CRAN. I thought it was still a requirement that
> dependencies need to be on CRAN (which makes development difficult for
> related packages like this).

Sorry for my somewhat belated addition:

AFAICS, the mentioned issue does also bite Windows builds, at least
this holds in case of our distr family of packages, see e.g.

https://r-forge.r-project.org/R/?group_id=89&log=build_win64&pkg=SweaveListingUtils&flavor=patched

but, e.g., also for Thierry Onkelinx's pkg "AFLP"

https://r-forge.r-project.org/R/?group_id=1027&log=build_win64&pkg=AFLP&flavor=patched

> A related long standing request is that R-forge checking look for
> required newer versions on R-forge rather than just on CRAN. Does anyone
> know if that works on Windows and/or Mac?

I cannot answer this, but also considering R-forge hosted versions would
not necessarily fix the present problem: at least for pkg
"SweaveListingUtils", the dependencies listed in its DESCRIPTION file
would be happy with the version of pkg "startupmsg" available on CRAN
(and as well with the one already available currently for download on
R-forge); still, R-forge complains about not finding pkg "startupmsg".

In this case this seems to be unrelated to the checking environment
not finding external libraries because the path is mentioned in some
non-found environment variable (as in Martin's case mentioned in this
thread); I still can use R CMD check --as-cran on all my pkgs on
my machine (R-3.0.0-devel 61755 and R-2.15.2-patched r61745) without
problems, on Linux as well as on Windows; rather, it seems that
R-forge's check process does not search the library of pkgs to which
pkgs already built on R-forge have been installed to (on R-forge).

And therefore I exceptionally x-post this back to
site-bugs at r-forge.r-project.org ...

At any rate, good look to the problem hunters at R-forge, I hope their
great service will be available again soon.

Best regards, Peter

> 
> Paul
> 
> On 13-01-15 03:09 PM, Uwe Ligges wrote:
>>
>>
>> On 15.01.2013 20:47, Thomas Lumley wrote:
>>> I have a project on R-forge (sqlsurvey.r-forge.r-project.org) with two
>>> packages, RMonetDB and sqlsurvey.
>>>
>>> At the moment, sqlsurvey is listed as failing to build.  The error is on
>>> the Linux package check, which says that RMonetDB is not available:
>>>
>>>
>>> * checking package dependencies ... ERROR
>>> Package required but not available: ?RMonetDB?
>>>
>>> RMonetDB has built successfully: r-forge lists its status as 'current',
>>> with Linux, Windows, and Mac packages available for download.  The
>>> package
>>> check for sqlsurvey on Windows and Mac finds RMonetDB without any
>>> problems,
>>> it's just on Linux that it appears to be unavailable.
>>>
>>> Any suggestions for how to fix this? I've tried uploading a new
>>> version of
>>> RMonetDB, but the situation didn't change: it built successfully, but
>>> the
>>> Linux check of sqlsurvey still couldn't find it.
>>
>>
>> I think you have to ask Stefan to check the details.
>>
>> Best,
>> Uwe
>>
>>
>>>      -thomas
>>>
>>>
>>>
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From peter.ruckdeschel at web.de  Mon Jan 28 23:13:35 2013
From: peter.ruckdeschel at web.de (Peter Ruckdeschel)
Date: Mon, 28 Jan 2013 23:13:35 +0100
Subject: [Rd] R-forge, package dependencies
In-Reply-To: <50F5BE09.7000407@gmail.com>
References: <CAJ55+d+k8b1UCWs-Rpc5obp=AY_FooZDp9JnRaa5cP9Ey9f6WA@mail.gmail.com>
	<50F5B770.9000804@statistik.tu-dortmund.de>
	<50F5BE09.7000407@gmail.com>
Message-ID: <5106F80F.90109@web.de>


Am 15.01.2013 21:37, schrieb Paul Gilbert:
> I'm surprised this works on Windows and Mac, since RMonetDB does not
> seem to be on CRAN. I thought it was still a requirement that
> dependencies need to be on CRAN (which makes development difficult for
> related packages like this).

Sorry for my somewhat belated addition:

AFAICS, the mentioned issue does also bite Windows builds, at least
this holds in case of our distr family of packages, see e.g.

https://r-forge.r-project.org/R/?group_id=89&log=build_win64&pkg=SweaveListingUtils&flavor=patched

but, e.g., also for Thierry Onkelinx's pkg "AFLP"

https://r-forge.r-project.org/R/?group_id=1027&log=build_win64&pkg=AFLP&flavor=patched

> A related long standing request is that R-forge checking look for
> required newer versions on R-forge rather than just on CRAN. Does anyone
> know if that works on Windows and/or Mac?

I cannot answer this, but also considering R-forge hosted versions would
not necessarily fix the present problem: at least for pkg
"SweaveListingUtils", the dependencies listed in its DESCRIPTION file
would be happy with the version of pkg "startupmsg" available on CRAN
(and as well with the one already available currently for download on
R-forge); still, R-forge complains about not finding pkg "startupmsg".

In this case this seems to be unrelated to the checking environment
not finding external libraries because the path is mentioned in some
non-found environment variable (as in Martin's case mentioned in this
thread); I still can use R CMD check --as-cran on all my pkgs on
my machine (R-3.0.0-devel 61755 and R-2.15.2-patched r61745) without
problems, on Linux as well as on Windows; rather, it seems that
R-forge's check process does not search the library of pkgs to which
pkgs already built on R-forge have been installed to (on R-forge).

And therefore I exceptionally x-post this back to
site-bugs at r-forge.r-project.org ...

At any rate, good look to the problem hunters at R-forge, I hope their
great service will be available again soon.

Best regards, Peter

> 
> Paul
> 
> On 13-01-15 03:09 PM, Uwe Ligges wrote:
>>
>>
>> On 15.01.2013 20:47, Thomas Lumley wrote:
>>> I have a project on R-forge (sqlsurvey.r-forge.r-project.org) with two
>>> packages, RMonetDB and sqlsurvey.
>>>
>>> At the moment, sqlsurvey is listed as failing to build.  The error is on
>>> the Linux package check, which says that RMonetDB is not available:
>>>
>>>
>>> * checking package dependencies ... ERROR
>>> Package required but not available: ?RMonetDB?
>>>
>>> RMonetDB has built successfully: r-forge lists its status as 'current',
>>> with Linux, Windows, and Mac packages available for download.  The
>>> package
>>> check for sqlsurvey on Windows and Mac finds RMonetDB without any
>>> problems,
>>> it's just on Linux that it appears to be unavailable.
>>>
>>> Any suggestions for how to fix this? I've tried uploading a new
>>> version of
>>> RMonetDB, but the situation didn't change: it built successfully, but
>>> the
>>> Linux check of sqlsurvey still couldn't find it.
>>
>>
>> I think you have to ask Stefan to check the details.
>>
>> Best,
>> Uwe
>>
>>
>>>      -thomas
>>>
>>>
>>>
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From suharto_anggono at yahoo.com  Tue Jan 29 04:32:33 2013
From: suharto_anggono at yahoo.com (Suharto Anggono Suharto Anggono)
Date: Mon, 28 Jan 2013 19:32:33 -0800 (PST)
Subject: [Rd] Suggestions for 'diff.default'
In-Reply-To: <1359369111.8635.YahooMailClassic@web125103.mail.ne1.yahoo.com>
Message-ID: <1359430353.97928.YahooMailClassic@web125103.mail.ne1.yahoo.com>



--- On Mon, 28/1/13, Suharto Anggono Suharto Anggono <suharto_anggono at yahoo.com> wrote:

> From: Suharto Anggono Suharto Anggono <suharto_anggono at yahoo.com>
> Subject: Suggestions for 'diff.default'
> To: R-devel at lists.R-project.org
> Date: Monday, 28 January, 2013, 5:31 PM
> I have suggestions for function
> 'diff.default' in R.
> 
> 
> Suggestion 1: If the input is matrix, always return matrix,
> even if empty.
> 
> What happens in R 2.15.2:
> 
> > rbind(1:2)? ? # matrix
> ? ???[,1] [,2]
> [1,]? ? 1? ? 2
> > diff(rbind(1:2))???# not matrix
> integer(0)
> > sessionInfo()
> R version 2.15.2 (2012-10-26)
> Platform: i386-w64-mingw32/i386 (32-bit)
> 
> locale:
> [1] LC_COLLATE=English_United States.1252
> [2] LC_CTYPE=English_United States.1252
> [3] LC_MONETARY=English_United States.1252
> [4] LC_NUMERIC=C
> [5] LC_TIME=English_United States.1252
> 
> attached base packages:
> [1] stats? ???graphics? grDevices
> utils? ???datasets?
> methods???base
> 
> 
> The documentation for 'diff' says, "If 'x' is a matrix then
> the difference operations are carried out on each column
> separately."
> If the result is empty, I expect that the result still has
> as many columns as the input.
> 
> 
> Suggestion 2: Make 'diff.default' applicable more generally
> by
> (a) not performing 'unclass';
> (b) generalizing (changing)
> ismat <- is.matrix(x)
> to become
> ismat <- length(dim(x)) == 2L
> 
> 
> If suggestion 1 is to be applied, if 'unclass' is not wanted
> (point (a) in suggestion 2 is also to be applied),
> 
> ? ? if (lag * differences >= xlen)
> ??? return(x[0L])
> 
> can be changed to
> 
> ? ? if (lag * differences >= xlen)
> ??? return(
> ? ? ? ? ? ? if (ismat) x[0L, ,
> drop = FALSE] - x[0L, , drop = FALSE] else
> ? ? ? ? ? ? x[0L] - x[0L])
> 
> It will handle class where subtraction (minus) operation
> change class.
Sorry, I wasn't careful enough. To obtain the correct class for the result, differencing should be done as many times as specified by argument 'differences'.

I consider the case of
diff(as.POSIXct(c("2012-01-01", "2012-02-01"), tz="UTC"), d=2)
versus
diff(diff(as.POSIXct(c("2012-01-01", "2012-02-01"), tz="UTC")))
To be safe, maybe just compute as usual, even when it is known that the end result will be empty. It can be done like this.

    empty <- integer()
    if (ismat)
	for (i in seq_len(differences))
	    r <- if (lag >= nrow(r))
                r[empty, , drop = FALSE] - r[empty, , drop = FALSE] else
                ...
    else
        for (i in seq_len(differences))
            r <- if (lag >= length(r))
                r[empty] - r[empty] else
                ...

If that way is used, 'xlen' is no longer needed.
> 
> Otherwise, if 'unclass' is wanted, maybe the handling of
> empty result can be moved to be after 'unclass', to be
> consistent with non-empty result.
> 
> 
> If point (a) in suggestion 2 is applied, 'diff.default' can
> handle input of class "Date" and "POSIXt". If, in addition,
> point (b) in suggestion 2 is also applied, 'diff.default'
> can handle data frame as input.
>


From ggrothendieck at gmail.com  Wed Jan 30 00:13:06 2013
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Tue, 29 Jan 2013 18:13:06 -0500
Subject: [Rd] Creating ref class with same name as S4 class results in error
Message-ID: <CAP01uRmEkThRAw53XJEsXs3dTYDT6dpG+44F95uPiYmSJKP_sQ@mail.gmail.com>

It seems that if one overwrites an S4 class with a Reference Class of
the same name that one gets an error in the situation below. I would
have expected that the Reference Class would replace the S4 class in
such a way that one could now use the Reference Class.

> A <- setClass("A", representation(x = "ANY"))
> x <- A()
> A <- setRefClass("A", fields = "a")
> x <- A$new(a = 1)
Error in initialize(value, ...) : invalid names for slots of class "A": a
> R.version.string
[1] "R version 2.15.2 Patched (2013-01-17 r61672)"

I got the same result on:

 "R Under development (unstable) (2013-01-25 r61745)"

Both were run under Windows 8 64 bit.

--
Statistics & Software Consulting
GKX Group, GKX Associates Inc.
tel: 1-877-GKX-GROUP
email: ggrothendieck at gmail.com


From rkoenker at illinois.edu  Wed Jan 30 17:37:49 2013
From: rkoenker at illinois.edu (Roger Koenker)
Date: Wed, 30 Jan 2013 10:37:49 -0600
Subject: [Rd] Mac v Windows Mystery
References: <2136E22D-2826-47FB-A919-A7DF7C5396FD@illinois.edu>
Message-ID: <D7EAE440-0E8E-4B44-867A-59AA993915B8@illinois.edu>

Dear All,

I'm trying to track down a problem with my quantreg package reported by a user doing censored quantile regression.
When he runs the test4.R file attached below (which reads the csv file also attached) on his windows machine he gets
an error like this:

> Error in dimnames(B) <- list(c("tau", dimnames(x)[[2]], "Qhat"), NULL) :
>   length of 'dimnames' [1] not equal to array extent
> In addition: Warning message:
> In rbind(grid[1:J], B, qhat) :
>   number of columns of result is not a multiple of vector length (arg 2)

However, when I run the same thing on my mac there is no error, no warning.  And --
more strangely-- running this on another windows laptop here in Urbana also encounters
no problems.  I thought that this might just be a seed problem since there is a bootstrapping
step at the end, but the original user has tried several seeds and always gets this error.
We are all running 2.15.1 and V4.94 of quantreg.  I understand that YMMV, especially on
windows,  but it is difficult to debug this sort of thing when I can't reproduce it.  Any suggestions
or other experience would be welcome.  The test problem takes a minute or so to run on my
mac.

Thanks,
Roger


url:    www.econ.uiuc.edu/~roger            Roger Koenker
email    rkoenker at uiuc.edu            Department of Economics
vox:     217-333-4558                University of Illinois
fax:       217-244-6678                Urbana, IL 61801


> 
> 
-------------- next part --------------
> 
-------------- next part --------------


From murdoch.duncan at gmail.com  Wed Jan 30 18:47:39 2013
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Wed, 30 Jan 2013 12:47:39 -0500
Subject: [Rd] Mac v Windows Mystery
In-Reply-To: <D7EAE440-0E8E-4B44-867A-59AA993915B8@illinois.edu>
References: <2136E22D-2826-47FB-A919-A7DF7C5396FD@illinois.edu>
	<D7EAE440-0E8E-4B44-867A-59AA993915B8@illinois.edu>
Message-ID: <51095CBB.60107@gmail.com>

On 13-01-30 11:37 AM, Roger Koenker wrote:
> Dear All,
>
> I'm trying to track down a problem with my quantreg package reported by a user doing censored quantile regression.
> When he runs the test4.R file attached below (which reads the csv file also attached) on his windows machine he gets
> an error like this:
>
>> Error in dimnames(B) <- list(c("tau", dimnames(x)[[2]], "Qhat"), NULL) :
>>    length of 'dimnames' [1] not equal to array extent
>> In addition: Warning message:
>> In rbind(grid[1:J], B, qhat) :
>>    number of columns of result is not a multiple of vector length (arg 2)
>
> However, when I run the same thing on my mac there is no error, no warning.  And --
> more strangely-- running this on another windows laptop here in Urbana also encounters
> no problems.  I thought that this might just be a seed problem since there is a bootstrapping
> step at the end, but the original user has tried several seeds and always gets this error.
> We are all running 2.15.1 and V4.94 of quantreg.  I understand that YMMV, especially on
> windows,  but it is difficult to debug this sort of thing when I can't reproduce it.  Any suggestions
> or other experience would be welcome.  The test problem takes a minute or so to run on my
> mac.

There was no attachment.  It might also be important to give more 
detailed info, e.g. what sessionInfo() prints on the bad system, and 
whether this is from Rgui or Rterm, and what ls() shows (in case some 
function is being masked).

Duncan Murdoch


> Thanks,
> Roger
>
>
> url:    www.econ.uiuc.edu/~roger            Roger Koenker
> email    rkoenker at uiuc.edu            Department of Economics
> vox:     217-333-4558                University of Illinois
> fax:       217-244-6678                Urbana, IL 61801
>
>
>>
>>
>>
>>
>>>
>>>
>>>
>>>
>>>
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel


From rkoenker at illinois.edu  Wed Jan 30 19:04:26 2013
From: rkoenker at illinois.edu (Roger Koenker)
Date: Wed, 30 Jan 2013 12:04:26 -0600
Subject: [Rd] Mac v Windows Mystery
In-Reply-To: <7ee277f1191b476fa6083ff8a53e1db3@CHIHT3.ad.uillinois.edu>
References: <2136E22D-2826-47FB-A919-A7DF7C5396FD@illinois.edu>
	<D7EAE440-0E8E-4B44-867A-59AA993915B8@illinois.edu>
	<7ee277f1191b476fa6083ff8a53e1db3@CHIHT3.ad.uillinois.edu>
Message-ID: <C7C15040-F4C5-4CE8-B652-3F76EFFAE8AA@illinois.edu>

Duncan,

Humm...  files must have been stripped from my original post....  I've put them in http://www.econ.uiuc.edu/~roger/test/
but rerunning the example on my mac a third time revealed that my original "bad seed" hypothesis was vindicated,
So I now have something to work from.  Sorry for adding to the noise.

Roger

url:    www.econ.uiuc.edu/~roger            Roger Koenker
email    rkoenker at uiuc.edu            Department of Economics
vox:     217-333-4558                University of Illinois
fax:       217-244-6678                Urbana, IL 61801

On Jan 30, 2013, at 11:47 AM, Duncan Murdoch wrote:

> On 13-01-30 11:37 AM, Roger Koenker wrote:
>> Dear All,
>> 
>> I'm trying to track down a problem with my quantreg package reported by a user doing censored quantile regression.
>> When he runs the test4.R file attached below (which reads the csv file also attached) on his windows machine he gets
>> an error like this:
>> 
>>> Error in dimnames(B) <- list(c("tau", dimnames(x)[[2]], "Qhat"), NULL) :
>>>   length of 'dimnames' [1] not equal to array extent
>>> In addition: Warning message:
>>> In rbind(grid[1:J], B, qhat) :
>>>   number of columns of result is not a multiple of vector length (arg 2)
>> 
>> However, when I run the same thing on my mac there is no error, no warning.  And --
>> more strangely-- running this on another windows laptop here in Urbana also encounters
>> no problems.  I thought that this might just be a seed problem since there is a bootstrapping
>> step at the end, but the original user has tried several seeds and always gets this error.
>> We are all running 2.15.1 and V4.94 of quantreg.  I understand that YMMV, especially on
>> windows,  but it is difficult to debug this sort of thing when I can't reproduce it.  Any suggestions
>> or other experience would be welcome.  The test problem takes a minute or so to run on my
>> mac.
> 
> There was no attachment.  It might also be important to give more 
> detailed info, e.g. what sessionInfo() prints on the bad system, and 
> whether this is from Rgui or Rterm, and what ls() shows (in case some 
> function is being masked).
> 
> Duncan Murdoch
> 
> 
>> Thanks,
>> Roger
>> 
>> 
>> url:    www.econ.uiuc.edu/~roger            Roger Koenker
>> email    rkoenker at uiuc.edu            Department of Economics
>> vox:     217-333-4558                University of Illinois
>> fax:       217-244-6678                Urbana, IL 61801
>> 
>> 
>>> 
>>> 
>>> 
>>> 
>>>> 
>>>> 
>>>> 
>>>> 
>>>> 
>>>> 
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel


From johannes_graumann at web.de  Wed Jan 30 19:07:52 2013
From: johannes_graumann at web.de (Johannes Graumann)
Date: Wed, 30 Jan 2013 21:07:52 +0300
Subject: [Rd] ROxygen2-Documenting of S4 Method
Message-ID: <kebneh$aqn$1@ger.gmane.org>

Hi all,

I'm trying to come to grips with how to document S4 methods using ROxygen - 
mostly following posts such as this: http://tinyurl.com/ae3kdno

I just can't get it to work (this is roxygen2_2.2.2).

I attach an example below which seems parsed properly, but "R CMD check" 
keeps complaining 
> ...
> Undocumented S4 methods:
> ...
> generic 'set<-' and siglist 'rcfpdsuperclass,character'
> ...

What am I doing wrong?

Thanks for any pointers.

Sincerely, Joh

#' @title set<-
#' @description Blabla
#' @details Blabla
#' @param object An object of class \code{\link{rcfpdsuperclass}} (or a
#' class inheriting from it).
#' @param slot \code{\link{character}} object with the slot name to be 
#' accessed.
#' @param value Content replacing whatever \code{slot} in \code{object} 
#' currently holds.
#' @return Returns an object of class \code{\link{rcfpdsuperclass}} with the
#' appropriate replacement.
#' @seealso \code{\link{rcfpdsuperclass}},\code{\link{get}}
#' @export
#' @docType methods
#' @rdname set-methods
#' @author Johannes Graumann
#' @keywords methods manip
#' @examples
#' rs <- new("rcfpdsuperclass")
#' str(rs)
#' get(rs,"RcfpdVersion")
#' # Works
#' set(rs,"RcfpdVersion") <- "4"
#' get(rs,"RcfpdVersion")
#' \dontrun{
#' # Fails due to replacement not being of class "character"
#' set(rs,"RcfpdVersion") <- 4
#' }
setGeneric("set<-",function(object, slot, value) standardGeneric("set<-"))

#' @rdname set-methods
#' @name set-methods
#' @aliases set<-,rcfpdsuperclass,character,rcfpdsuperclass-
method,character-method
setReplaceMethod(
  "set",
  signature = signature(object = "rcfpdsuperclass",slot="character"),
  definition = function(object,slot,value){
    if(getSlots(class(object))[slot] == "RcfpdStoredObject"){
      slot(object,slot) <- storeObject(value)
    } else {
      slot(object,slot) <- value
    }
    invisible(validObject(object))
    return(object)
  })


From cadeb at usgs.gov  Wed Jan 30 19:18:17 2013
From: cadeb at usgs.gov (Cade, Brian)
Date: Wed, 30 Jan 2013 11:18:17 -0700
Subject: [Rd] Mac v Windows Mystery
In-Reply-To: <C7C15040-F4C5-4CE8-B652-3F76EFFAE8AA@illinois.edu>
References: <2136E22D-2826-47FB-A919-A7DF7C5396FD@illinois.edu>
	<D7EAE440-0E8E-4B44-867A-59AA993915B8@illinois.edu>
	<7ee277f1191b476fa6083ff8a53e1db3@CHIHT3.ad.uillinois.edu>
	<C7C15040-F4C5-4CE8-B652-3F76EFFAE8AA@illinois.edu>
Message-ID: <CAM5M9BRfdRZ9XpdY9xkQ1AEUQkxmMA8i-dvZKCtkdJhfOqvAyA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20130130/73956a19/attachment.pl>

From dwinsemius at comcast.net  Wed Jan 30 20:55:52 2013
From: dwinsemius at comcast.net (David Winsemius)
Date: Wed, 30 Jan 2013 14:55:52 -0500
Subject: [Rd] Mac v Windows Mystery
In-Reply-To: <D7EAE440-0E8E-4B44-867A-59AA993915B8@illinois.edu>
References: <2136E22D-2826-47FB-A919-A7DF7C5396FD@illinois.edu>
	<D7EAE440-0E8E-4B44-867A-59AA993915B8@illinois.edu>
Message-ID: <36C78333-82D3-43C1-AF7E-09A22AB9E6A2@comcast.net>

I think neither of the attachments made it through, at least not to my  
client. If you use the regular Mac Mail.app (or any of hte Windows  
clients that I have seen). I suspect it labels the attachments as  
something other than MIME-text. The best way to get things though the  
R-mailing server is to give the files both .txt extensions and let the  
recipients change the extension names as needed. Then both Mac and  
Windows mail clients will give the proper mail headers so they reach  
the R-subscribers.

-- 
David.
On Jan 30, 2013, at 11:37 AM, Roger Koenker wrote:

> Dear All,
>
> I'm trying to track down a problem with my quantreg package reported  
> by a user doing censored quantile regression.
> When he runs the test4.R file attached below (which reads the csv  
> file also attached) on his windows machine he gets
> an error like this:
>
>> Error in dimnames(B) <- list(c("tau", dimnames(x)[[2]], "Qhat"),  
>> NULL) :
>>  length of 'dimnames' [1] not equal to array extent
>> In addition: Warning message:
>> In rbind(grid[1:J], B, qhat) :
>>  number of columns of result is not a multiple of vector length  
>> (arg 2)
>
> However, when I run the same thing on my mac there is no error, no  
> warning.  And --
> more strangely-- running this on another windows laptop here in  
> Urbana also encounters
> no problems.  I thought that this might just be a seed problem since  
> there is a bootstrapping
> step at the end, but the original user has tried several seeds and  
> always gets this error.
> We are all running 2.15.1 and V4.94 of quantreg.  I understand that  
> YMMV, especially on
> windows,  but it is difficult to debug this sort of thing when I  
> can't reproduce it.  Any suggestions
> or other experience would be welcome.  The test problem takes a  
> minute or so to run on my
> mac.
>
> Thanks,
> Roger
>
>
> url:    www.econ.uiuc.edu/~roger            Roger Koenker
> email    rkoenker at uiuc.edu            Department of Economics
> vox:     217-333-4558                University of Illinois
> fax:       217-244-6678                Urbana, IL 61801
>
>
>>
>>
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

David Winsemius, MD
Alameda, CA, USA


From lgautier at gmail.com  Thu Jan 31 03:48:58 2013
From: lgautier at gmail.com (Laurent Gautier)
Date: Thu, 31 Jan 2013 10:48:58 +0800
Subject: [Rd] Bug: C-level and _set_rl_word_breaks
Message-ID: <5109DB9A.3000606@gmail.com>

Hi,

I filed a bug report in the tracker (id #15169) a short while ago,
along with a patch, but I came back to it to see that there is
relatively little movement or participation on the tracker so I
thought I'd pitch it here (patch attached).

The function `set_rl_word_breaks` in src/unix/sys-std.c relies on
statically-allocated strings local to the function, making other C
code using the readline library, such as a program embedding
R and using readline as well, at risk of creating a segfault when
trying to free `rl_basic_word_break_characters` or
`rl_completer_word_break_characters` when changing them.

The issue was noticed when embedding R in Python (rpy2); I had an
ugly hack for a long time (less work than champion the inclusion
of a patch in R) but the iPython developers pushed what could be
demanded from the rpy2 with their "R magic" extension and
so I wrote a patch (and they have made a brittle workaround in
the meantime).

The fix would be of interest to anyone embedding R in C and using
readline (e.g., language interface developers if the language either
has a console using readline - and chances are that it does - or
an interface to readline).

The patch attached is against today's R-dev and will likely apply to
current R-2.15 branch. With the patch applied, R is building and is
passing `make check`. It could be slightly expanded by handling
cases where the calloc() or realloc() faills, although not an absolute
priority (if allocating 200 bytes fails, the system might have
bigger worries than keeping R from crashing).


Laurent

-------------- next part --------------
A non-text attachment was scrubbed...
Name: fix__set_rl_word_breaks.diff
Type: text/x-patch
Size: 1496 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20130131/454e2ca1/attachment.bin>

From murdoch.duncan at gmail.com  Thu Jan 31 14:09:48 2013
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Thu, 31 Jan 2013 08:09:48 -0500
Subject: [Rd] Bug: C-level and _set_rl_word_breaks
In-Reply-To: <5109DB9A.3000606@gmail.com>
References: <5109DB9A.3000606@gmail.com>
Message-ID: <510A6D1C.7080002@gmail.com>

On 13-01-30 9:48 PM, Laurent Gautier wrote:
> Hi,
>
> I filed a bug report in the tracker (id #15169) a short while ago,
> along with a patch, but I came back to it to see that there is
> relatively little movement or participation on the tracker so I
> thought I'd pitch it here (patch attached).
>
> The function `set_rl_word_breaks` in src/unix/sys-std.c relies on
> statically-allocated strings local to the function, making other C
> code using the readline library, such as a program embedding
> R and using readline as well, at risk of creating a segfault when
> trying to free `rl_basic_word_break_characters` or
> `rl_completer_word_break_characters` when changing them.
>
> The issue was noticed when embedding R in Python (rpy2); I had an
> ugly hack for a long time (less work than champion the inclusion
> of a patch in R) but the iPython developers pushed what could be
> demanded from the rpy2 with their "R magic" extension and
> so I wrote a patch (and they have made a brittle workaround in
> the meantime).
>
> The fix would be of interest to anyone embedding R in C and using
> readline (e.g., language interface developers if the language either
> has a console using readline - and chances are that it does - or
> an interface to readline).
>
> The patch attached is against today's R-dev and will likely apply to
> current R-2.15 branch. With the patch applied, R is building and is
> passing `make check`. It could be slightly expanded by handling
> cases where the calloc() or realloc() faills, although not an absolute
> priority (if allocating 200 bytes fails, the system might have
> bigger worries than keeping R from crashing).

I suspect the reason your bug hasn't been dealt with in the 2 weeks 
since you posted it is that you don't show any code that illustrates the 
problem it causes.  It is much easier to run some code and see that code 
that should be valid is causing a crash, than it is to develop code to 
illustrate it.  Easily illustrated bugs get solved before hard ones.

Your post here gives a lot more detail, but still no code.  This isn't 
an area I'd work on (it seems to be a Unix-only bug), but you might 
attract someone else to look at it if you include a minimal 
self-contained trigger for it.

Duncan Murdoch


From lgautier at gmail.com  Thu Jan 31 14:52:53 2013
From: lgautier at gmail.com (Laurent Gautier)
Date: Thu, 31 Jan 2013 21:52:53 +0800
Subject: [Rd] Bug: C-level and _set_rl_word_breaks
In-Reply-To: <510A6D1C.7080002@gmail.com>
References: <5109DB9A.3000606@gmail.com> <510A6D1C.7080002@gmail.com>
Message-ID: <510A7735.6090200@gmail.com>

On 2013-01-31 21:09, Duncan Murdoch wrote:
> On 13-01-30 9:48 PM, Laurent Gautier wrote:
>> Hi,
>>
>> I filed a bug report in the tracker (id #15169) a short while ago,
>> along with a patch, but I came back to it to see that there is
>> relatively little movement or participation on the tracker so I
>> thought I'd pitch it here (patch attached).
>>
>> The function `set_rl_word_breaks` in src/unix/sys-std.c relies on
>> statically-allocated strings local to the function, making other C
>> code using the readline library, such as a program embedding
>> R and using readline as well, at risk of creating a segfault when
>> trying to free `rl_basic_word_break_characters` or
>> `rl_completer_word_break_characters` when changing them.
>>
>> The issue was noticed when embedding R in Python (rpy2); I had an
>> ugly hack for a long time (less work than champion the inclusion
>> of a patch in R) but the iPython developers pushed what could be
>> demanded from the rpy2 with their "R magic" extension and
>> so I wrote a patch (and they have made a brittle workaround in
>> the meantime).
>>
>> The fix would be of interest to anyone embedding R in C and using
>> readline (e.g., language interface developers if the language either
>> has a console using readline - and chances are that it does - or
>> an interface to readline).
>>
>> The patch attached is against today's R-dev and will likely apply to
>> current R-2.15 branch. With the patch applied, R is building and is
>> passing `make check`. It could be slightly expanded by handling
>> cases where the calloc() or realloc() faills, although not an absolute
>> priority (if allocating 200 bytes fails, the system might have
>> bigger worries than keeping R from crashing).
>
> I suspect the reason your bug hasn't been dealt with in the 2 weeks 
> since you posted it is that you don't show any code that illustrates 
> the problem it causes.  It is much easier to run some code and see 
> that code that should be valid is causing a crash, than it is to 
> develop code to illustrate it.

Fair enough. Now I realize that this might be a part of R codebase that 
is hardly touched; while the problem makes sense to me after spending 
time on it, a demonstrating what it causes in a minimal example might be 
best).

> Easily illustrated bugs get solved before hard ones.

I guess I had a free pass since I provide a solution to the bug.

>
> Your post here gives a lot more detail, but still no code.  This isn't 
> an area I'd work on (it seems to be a Unix-only bug), but you might 
> attract someone else to look at it if you include a minimal 
> self-contained trigger for it.

I'll work on that.

Thanks,

L.
>
> Duncan Murdoch


From friendly at yorku.ca  Thu Jan 31 15:50:33 2013
From: friendly at yorku.ca (Michael Friendly)
Date: Thu, 31 Jan 2013 09:50:33 -0500
Subject: [Rd] CRAN task views: markdown? better .CSS?
Message-ID: <510A84B9.7010907@yorku.ca>

CRAN task views are useful, but they seem difficult to write and 
maintain because the XML format is rather
limited (no sectioning) and the <packagelist> must be maintained manually.
They are also difficult to read because the generated html and .css used 
are extremely basic, giving an
overly dense page.

Are there any markdown-like tools for writing a CTV?  Is it possible to 
apply a custom .css to a CTV?

-Michael

-- 
Michael Friendly     Email: friendly AT yorku DOT ca
Professor, Psychology Dept. & Chair, Quantitative Methods
York University      Voice: 416 736-2100 x66249 Fax: 416 736-5814
4700 Keele Street    Web:   http://www.datavis.ca
Toronto, ONT  M3J 1P3 CANADA


From xie at yihui.name  Thu Jan 31 17:28:50 2013
From: xie at yihui.name (Yihui Xie)
Date: Thu, 31 Jan 2013 10:28:50 -0600
Subject: [Rd] CRAN task views: markdown? better .CSS?
In-Reply-To: <510A84B9.7010907@yorku.ca>
References: <510A84B9.7010907@yorku.ca>
Message-ID: <CANROs4fEFTAW1WT+Y_d13nR-nvOxw_XJTL3ac_A4Ozd1tvL0QQ@mail.gmail.com>

See this page by Barry Rowlingson:
https://stat.ethz.ch/pipermail/r-devel/2012-February/063338.html

Given that CRAN maintainers do not even use JavaScript, I bet CSS does
not matter either; plain text is plain good.

Regards,
Yihui
--
Yihui Xie <xieyihui at gmail.com>
Phone: 515-294-2465 Web: http://yihui.name
Department of Statistics, Iowa State University
2215 Snedecor Hall, Ames, IA


On Thu, Jan 31, 2013 at 8:50 AM, Michael Friendly <friendly at yorku.ca> wrote:
> CRAN task views are useful, but they seem difficult to write and maintain
> because the XML format is rather
> limited (no sectioning) and the <packagelist> must be maintained manually.
> They are also difficult to read because the generated html and .css used are
> extremely basic, giving an
> overly dense page.
>
> Are there any markdown-like tools for writing a CTV?  Is it possible to
> apply a custom .css to a CTV?
>
> -Michael
>
> --
> Michael Friendly     Email: friendly AT yorku DOT ca
> Professor, Psychology Dept. & Chair, Quantitative Methods
> York University      Voice: 416 736-2100 x66249 Fax: 416 736-5814
> 4700 Keele Street    Web:   http://www.datavis.ca
> Toronto, ONT  M3J 1P3 CANADA


From b.rowlingson at lancaster.ac.uk  Thu Jan 31 17:58:56 2013
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Thu, 31 Jan 2013 16:58:56 +0000
Subject: [Rd] CRAN task views: markdown? better .CSS?
In-Reply-To: <3643e1223f2b41d2afe6c3c7f1539ac5@EX-1-HT0.lancs.local>
References: <510A84B9.7010907@yorku.ca>
	<3643e1223f2b41d2afe6c3c7f1539ac5@EX-1-HT0.lancs.local>
Message-ID: <CANVKczP25ondiZXR00tGDZ2dn_o1sWOzB9R_eAyFCisf4Xo-UQ@mail.gmail.com>

On Thu, Jan 31, 2013 at 4:28 PM, Yihui Xie <xie at yihui.name> wrote:
> See this page by Barry Rowlingson:
> https://stat.ethz.ch/pipermail/r-devel/2012-February/063338.html

 Sadly that page is just the lipstick on a pig. Underneath, its still a pig.

> Given that CRAN maintainers do not even use JavaScript, I bet CSS does
> not matter either; plain text is plain good.

 I think we all know that the whole of www.r-project.org could do with
a revamp and that large chunks of the CRAN infrastructure would
benefit from a redesign. But at the moment, it all kinda works, its
just a bit annoying in places, and we put up with it because the
effort to make it more functional or shiny (no, not package:shiny) is
a bit too much.

 Sometimes putting lipstick on the pig is enough...

Barry


From Achim.Zeileis at uibk.ac.at  Thu Jan 31 18:01:30 2013
From: Achim.Zeileis at uibk.ac.at (Achim Zeileis)
Date: Thu, 31 Jan 2013 18:01:30 +0100 (CET)
Subject: [Rd] CRAN task views: markdown? better .CSS?
In-Reply-To: <510A84B9.7010907@yorku.ca>
References: <510A84B9.7010907@yorku.ca>
Message-ID: <alpine.DEB.2.02.1301311752470.22598@paninaro.uibk.ac.at>

Michael:

> CRAN task views are useful, but they seem difficult to write and 
> maintain because the XML format is rather limited (no sectioning)

What type of sectioning would you like to have? In the HTML part, you can 
use the usual structuring tools like <h*>, <p>, etc. It's not

> and the <packagelist> must be maintained manually.

Yes, but I recently started adding tools to help checking this. Hopefully 
I'll also get round to add some more convenience features for this.

> They are also difficult to read because the generated html and .css used 
> are extremely basic, giving an overly dense page.
>
> Is it possible to apply a custom .css to a CTV?

In principle yes. When generating the HTML pages, you can supply the 
desired .css file. It defaults to the CRAN_web.css file also used for the 
rest of the web area on CRAN.

So when you generate your own web pages on your own server, you can plug 
in any .css you like. But as a CRAN user/viewer, I don't think you can 
modify the already existing .html pages.

> Are there any markdown-like tools for writing a CTV?

No. When I wrote "ctv" XML seemed to be the natural format to go with. 
If I were to write it again today, I might use something different. But so 
far XML worked well enough for me.

Best,
Z

>
> -Michael
>
> -- 
> Michael Friendly     Email: friendly AT yorku DOT ca
> Professor, Psychology Dept. & Chair, Quantitative Methods
> York University      Voice: 416 736-2100 x66249 Fax: 416 736-5814
> 4700 Keele Street    Web:   http://www.datavis.ca
> Toronto, ONT  M3J 1P3 CANADA
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From Achim.Zeileis at uibk.ac.at  Thu Jan 31 18:02:29 2013
From: Achim.Zeileis at uibk.ac.at (Achim Zeileis)
Date: Thu, 31 Jan 2013 18:02:29 +0100 (CET)
Subject: [Rd] CRAN task views: markdown? better .CSS?
In-Reply-To: <CANROs4fEFTAW1WT+Y_d13nR-nvOxw_XJTL3ac_A4Ozd1tvL0QQ@mail.gmail.com>
References: <510A84B9.7010907@yorku.ca>
	<CANROs4fEFTAW1WT+Y_d13nR-nvOxw_XJTL3ac_A4Ozd1tvL0QQ@mail.gmail.com>
Message-ID: <alpine.DEB.2.02.1301311801330.22598@paninaro.uibk.ac.at>

On Thu, 31 Jan 2013, Yihui Xie wrote:

> See this page by Barry Rowlingson:
> https://stat.ethz.ch/pipermail/r-devel/2012-February/063338.html
>
> Given that CRAN maintainers do not even use JavaScript, I bet CSS does
> not matter either;

You lose - see help("ctv2html", package = "ctv"). Have I won anything? ;-)

Best,
Z

> plain text is plain good.
>
> Regards,
> Yihui
> --
> Yihui Xie <xieyihui at gmail.com>
> Phone: 515-294-2465 Web: http://yihui.name
> Department of Statistics, Iowa State University
> 2215 Snedecor Hall, Ames, IA
>
>
> On Thu, Jan 31, 2013 at 8:50 AM, Michael Friendly <friendly at yorku.ca> wrote:
>> CRAN task views are useful, but they seem difficult to write and maintain
>> because the XML format is rather
>> limited (no sectioning) and the <packagelist> must be maintained manually.
>> They are also difficult to read because the generated html and .css used are
>> extremely basic, giving an
>> overly dense page.
>>
>> Are there any markdown-like tools for writing a CTV?  Is it possible to
>> apply a custom .css to a CTV?
>>
>> -Michael
>>
>> --
>> Michael Friendly     Email: friendly AT yorku DOT ca
>> Professor, Psychology Dept. & Chair, Quantitative Methods
>> York University      Voice: 416 736-2100 x66249 Fax: 416 736-5814
>> 4700 Keele Street    Web:   http://www.datavis.ca
>> Toronto, ONT  M3J 1P3 CANADA
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From friendly at yorku.ca  Thu Jan 31 22:30:05 2013
From: friendly at yorku.ca (Michael Friendly)
Date: Thu, 31 Jan 2013 16:30:05 -0500
Subject: [Rd] CRAN task views: markdown? better .CSS?
In-Reply-To: <alpine.DEB.2.02.1301311752470.22598@paninaro.uibk.ac.at>
References: <510A84B9.7010907@yorku.ca>
	<alpine.DEB.2.02.1301311752470.22598@paninaro.uibk.ac.at>
Message-ID: <510AE25D.5010407@yorku.ca>

On 1/31/2013 12:01 PM, Achim Zeileis wrote:
> Michael:
>
>> CRAN task views are useful, but they seem difficult to write and 
>> maintain because the XML format is rather limited (no sectioning)
>
> What type of sectioning would you like to have? In the HTML part, you 
> can use the usual structuring tools like <h*>, <p>, etc. It's not
OK. I think you mean the <info> ... </info> section, where I failed to 
read the vignette sufficiently closely, which talks about
using HTML.
>
>> and the <packagelist> must be maintained manually.
>
> Yes, but I recently started adding tools to help checking this. 
> Hopefully I'll also get round to add some more convenience features 
> for this.
Something simple might be a tool to scan the <info> ... </info> section 
for <pkg> ... </pkg> mentions and just print
a new <packagelist> section to the console.  This would avoid having to 
remember what you added recently
and manually add to the <packagelist>

-Michael


-- 
Michael Friendly     Email: friendly AT yorku DOT ca
Professor, Psychology Dept. & Chair, Quantitative Methods
York University      Voice: 416 736-2100 x66249 Fax: 416 736-5814
4700 Keele Street    Web:   http://www.datavis.ca
Toronto, ONT  M3J 1P3 CANADA


