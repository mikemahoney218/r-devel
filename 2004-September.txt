From ripley at stats.ox.ac.uk  Wed Sep  1 00:00:38 2004
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed Sep  1 00:00:40 2004
Subject: [Rd] make check failure
In-Reply-To: <20040831213348.GC3504@stat.umu.se>
Message-ID: <Pine.LNX.4.44.0408312256340.32174-100000@gannet.stats>

On Tue, 31 Aug 2004, gb wrote:

> I have built today's R-devel without problem on a fresh installation of

I don't know what that is, but I am not seeing a failure and I have done 
about 20 builds on different platforms today from the then current
svn checkouts.

Could you please run this example again, debug it, and report the cause of
the problem on your setup. BTW, it is quite slow.

Oh, and a thought: you do have the current recommended packages in your 
sources?

> debian testing. However, 'make check' fails. In 
> 'tests/Examples/tools-Ex.Rout.fail':
> 
> > ### * vignetteDepends
> >
> > flush(stderr()); flush(stdout())
> >
> > ### Name: vignetteDepends
> > ### Title: Retrieve Dependency Information for a Vignette
> > ### Aliases: vignetteDepends
> > ### Keywords: utilities
> >
> > ### ** Examples
> >
> > gridEx <- system.file("doc", "grid.Snw", package = "grid")
> > vignetteDepends(gridEx)
> Error in if ((!is.null(depMtrx)) && (nrow(depMtrx) > 0)) { :
>         missing value where TRUE/FALSE needed
> Execution halted
>  -----------
> Since my debian installation may be incomplete, I checked out R-1.9.1, but
> there 'make check' ran without errors.

vignetteDepends was unchecked in 1.9.1 ....

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From edd at debian.org  Wed Sep  1 04:50:53 2004
From: edd at debian.org (Dirk Eddelbuettel)
Date: Wed Sep  1 04:50:56 2004
Subject: [Rd] Problem with R --gui=GNOME when launched from a menu system
In-Reply-To: <1093967308.30615.115.camel@localhost.localdomain>
References: <20040831023858.GA9751@sonny.eddelbuettel.com>
	<Pine.LNX.4.44.0408311413080.25501-100000@gannet.stats>
	<20040831135509.GA16750@sonny.eddelbuettel.com>
	<1093967308.30615.115.camel@localhost.localdomain>
Message-ID: <20040901025053.GA25318@sonny.eddelbuettel.com>

On Tue, Aug 31, 2004 at 10:48:28AM -0500, Marc Schwartz wrote:
> On Tue, 2004-08-31 at 08:55, Dirk Eddelbuettel wrote:
> > Brian,
> > 
> > On Tue, Aug 31, 2004 at 02:21:40PM +0100, Prof Brian Ripley wrote:
> > > What are stdin/stdout/stderr connected to when you do that? R --gui=GNOME
> > > does write certain error messages (from GDK/GTK) to the controlling
> > > terminal so you may need one, at least if there is an error/warning.
> > > 
> > > I see gnome_start in src/modules/gnome/system.c has
> > > 
> > >     R_Interactive = isatty(0);
> > > 
> > > I would think that was blind copying.  Please see if setting it to 1 
> > > helps.
> > 
> > Excellent suggestion, I'll try that this eve.
> > 
> > Thanks as always,  Dirk
> 
> 
> FWIW, no default change in behavior here under XFCE4 when using the run
> dialog or in a desktop menu with the above source change.

It fixed the problem for me!

So a big Thank you! to Brian for the suggestion.

Dirk

-- 
Those are my principles, and if you don't like them... well, I have others.
                                                -- Groucho Marx

From rpeng at jhsph.edu  Wed Sep  1 04:05:12 2004
From: rpeng at jhsph.edu (Roger D. Peng)
Date: Wed Sep  1 05:44:10 2004
Subject: [Rd] file.info() on file larger than 2GB
In-Reply-To: <Pine.LNX.4.44.0408311601020.29264-100000@gannet.stats>
References: <Pine.LNX.4.44.0408311601020.29264-100000@gannet.stats>
Message-ID: <41352E58.80100@jhsph.edu>

Indeed, when I tried the same on a 64-bit OS I got the usual 
(correct) information from file.info().  The size is wrong in R 
1.9.1 but that seems to have been fixed in R-devel.

-roger

Prof Brian Ripley wrote:

> This is a purely OS issue: your OS has not been set up so the fopen and
> stat calls handle > 2Gb files.  There is one R issue: the size will
> overflow in file.info.
> 
> For example, under Solaris 64-bit applications can handle such files 
> whereas 32-bit ones need calls to stat64, fopen64 etc.
> 
> It seems a very exotic need, but if someone wants to find out how to use 
> the OS-specific ways to extend stat etc and supply patches, please do so.
> 
> We don't put OS-specific limitations on help pages.
> 
> On Tue, 31 Aug 2004, Roger D. Peng wrote:
> 
> 
>>I've got a file that's approximately 2.2GB and it seems to be foiling 
>>file.info().  When I run `stat' from the shell I get
>>
>>zooey:> stat data.csv
>>   File: `data.csv'
>>   Size: 2271197563      Blocks: 4440280    IO Block: 4096   regular file
>>Device: 342h/834d       Inode: 9994308     Links: 1
>>Access: (0644/-rw-r--r--)  Uid: (  500/   rpeng)   Gid: (  500/   rpeng)
>>Access: 2004-08-31 09:50:04.000000000 -0400
>>Modify: 2004-08-26 19:09:42.000000000 -0400
>>Change: 2004-08-31 09:53:29.000000000 -0400
> 
> 
> Take a look at the source code for stat, in coreutils.
> 
> 
>>But, file.info() in R-devel gives me:
>>
>> > file.info("data.csv")
>>          size isdir mode mtime ctime atime uid gid uname grname
>>data.csv   NA    NA <NA>  <NA>  <NA>  <NA>  NA  NA  <NA>   <NA>
>>
>>I assume this has something to do with the underlying call to `stat' 
>>in `do_fileinfo'.
>>
>>This alone is not much of a problem but I also can't seem to be able 
>>to open a file connection to the same file.  For example,
>>
>> > con <- file("data.csv")
>> > open(con, "r")
>>Error in open.connection(con, "r") : unable to open connection
>>In addition: Warning message:
>>cannot open file `data.csv'
>>
>>Also, interestingly,
>>
>> > file.exists("data.csv")
>>[1] FALSE
>>
>>I take it all these things are related.
>>
>>Is it possible to fix this within R?  Or should there be a note in the 
>>help pages?
>>
>> > version
>>          _
>>platform i686-pc-linux-gnu
>>arch     i686
>>os       linux-gnu
>>system   i686, linux-gnu
>>status   Under development (unstable)
>>major    2
>>minor    0.0
>>year     2004
>>month    08
>>day      31
>>language R
>>
>>-roger
>>
>>______________________________________________
>>R-devel@stat.math.ethz.ch mailing list
>>https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
> 
>

From MSchwartz at MedAnalytics.com  Wed Sep  1 05:55:07 2004
From: MSchwartz at MedAnalytics.com (Marc Schwartz)
Date: Wed Sep  1 05:55:25 2004
Subject: [Rd] Problem with R --gui=GNOME when launched from a menu system
In-Reply-To: <20040901025053.GA25318@sonny.eddelbuettel.com>
References: <20040831023858.GA9751@sonny.eddelbuettel.com>
	<Pine.LNX.4.44.0408311413080.25501-100000@gannet.stats>
	<20040831135509.GA16750@sonny.eddelbuettel.com>
	<1093967308.30615.115.camel@localhost.localdomain>
	<20040901025053.GA25318@sonny.eddelbuettel.com>
Message-ID: <1094010906.16458.17.camel@localhost.localdomain>

On Tue, 2004-08-31 at 21:50, Dirk Eddelbuettel wrote:
> On Tue, Aug 31, 2004 at 10:48:28AM -0500, Marc Schwartz wrote:
> > On Tue, 2004-08-31 at 08:55, Dirk Eddelbuettel wrote:
> > > Brian,
> > > 
> > > On Tue, Aug 31, 2004 at 02:21:40PM +0100, Prof Brian Ripley wrote:
> > > > What are stdin/stdout/stderr connected to when you do that? R --gui=GNOME
> > > > does write certain error messages (from GDK/GTK) to the controlling
> > > > terminal so you may need one, at least if there is an error/warning.
> > > > 
> > > > I see gnome_start in src/modules/gnome/system.c has
> > > > 
> > > >     R_Interactive = isatty(0);
> > > > 
> > > > I would think that was blind copying.  Please see if setting it to 1 
> > > > helps.
> > > 
> > > Excellent suggestion, I'll try that this eve.
> > > 
> > > Thanks as always,  Dirk
> > 
> > 
> > FWIW, no default change in behavior here under XFCE4 when using the run
> > dialog or in a desktop menu with the above source change.
> 
> It fixed the problem for me!
> 
> So a big Thank you! to Brian for the suggestion.

Dirk,

What version of GNOME are you running this under and what version of
gcc?

It dawned on me (sorry) that I should have tried this under GNOME here
earlier and not just under XFCE4, given that there could be a bug in the
latter, even though they both use the same gtk libs.

However, I just logged out of XFCE4 and into GNOME, which as I mentioned
earlier, is version 2.6 here under FC2. gcc --version here is:

 gcc (GCC) 3.3.3 20040412 (Red Hat Linux 3.3.3-7)

Unfortunately, the behavior under GNOME is the same as under XFCE4,
which is that R with the GNOME GUI exits if run from the "Run
Application" applet on the GNOME menu or from a launcher created on the
GNOME panel. It does stay if run from gnome-terminal as earlier.

Glad to hear that it is working on your end.

Best regards,

Marc

From gb at stat.umu.se  Wed Sep  1 10:03:50 2004
From: gb at stat.umu.se (gb)
Date: Wed Sep  1 10:04:30 2004
Subject: [Rd] make check failure
In-Reply-To: <Pine.LNX.4.44.0408312256340.32174-100000@gannet.stats>
References: <20040831213348.GC3504@stat.umu.se>
	<Pine.LNX.4.44.0408312256340.32174-100000@gannet.stats>
Message-ID: <20040901080350.GA12371@stat.umu.se>

On Tue, Aug 31, 2004 at 11:00:38PM +0100, Prof Brian Ripley wrote:
> On Tue, 31 Aug 2004, gb wrote:
> 
> > I have built today's R-devel without problem on a fresh installation of
> 
> I don't know what that is, but I am not seeing a failure and I have done 
> about 20 builds on different platforms today from the then current
> svn checkouts.
> 
> Could you please run this example again, debug it, and report the cause of
> the problem on your setup. BTW, it is quite slow.
> 
> Oh, and a thought: you do have the current recommended packages in your 
> sources?

I'm sorry, but I forgot that. Now it works perfectly. 

Thanks!

G?ran

From Andrea.Sa at parceirosdecomunicacao.pt  Wed Sep  1 13:15:48 2004
From: Andrea.Sa at parceirosdecomunicacao.pt (Andreia Sa)
Date: Wed Sep  1 13:14:10 2004
Subject: [Rd] =?iso-8859-1?q?Resposta_autom=E1tica_para_aus=EAncia_do_esc?=
	=?iso-8859-1?q?rit=F3rio=3A_Request?=
Message-ID: <CADB288A47F7D1478D9F41246997759C47FB46@srvmailstrat.STRAT-PT.pt>

Estarei fora do escrit?rio at? Dezembro 2004. I Will be out of the office  until December 04.

Na minha aus?ncia, por favor contacte:
Sofia Burnay em sofia.burnay@parceirosdecomunicacao.pt
Susana.monteiro@parceirosdecomunicacao.pt

From edd at debian.org  Wed Sep  1 13:28:29 2004
From: edd at debian.org (Dirk Eddelbuettel)
Date: Wed Sep  1 13:28:37 2004
Subject: [Rd] With --gui=GNOME,
	gtkDevice is preferred -- documentation on that?
Message-ID: <20040901112829.GA30581@sonny.eddelbuettel.com>


I also had a bug report stating that under R --gui=GNOME, any window
generated by a simple plot() will not get properly refreshed, see
http://bugs.debian.org/269104.

I vaguely remembered that this had come up, and recommended to the submitter
that 
  library(gtkDevice)
  gtk()
is a fix.  Is this documented somewhere?  Should my Debian package r-gnome
depend on the existing Debian package r-cran-gtkdevice?  If so, could I
'alias' the default plot device to be the gtk device?

Thanks, Dirk

-- 
Those are my principles, and if you don't like them... well, I have others.
                                                -- Groucho Marx

From deepayan at stat.wisc.edu  Wed Sep  1 17:18:27 2004
From: deepayan at stat.wisc.edu (Deepayan Sarkar)
Date: Wed Sep  1 17:18:19 2004
Subject: [Rd] sunspot data in R 2.0.0
Message-ID: <4135E843.9030607@stat.wisc.edu>


I noticed this in the NEWS:

     o   Datasets 'sunspot.month' and 'sunspot.year' are available
         separately but not via data(sunspot) (which is used by package
         lattice to retrieve a dataset 'sunspot').

Now, the 'sunspot' dataset included in lattice was actually a mistake, I 
realized later that I instead wanted the 'sunspots' data from base, 
which is currently used in example(xyplot). (Even more recently, I 
realized that I actually want sunspot.year.)

Would it make any difference if I removed the 'sunspot' data from 
lattice? I don't think anyone is going to miss it.

Deepayan

From ripley at stats.ox.ac.uk  Wed Sep  1 17:33:22 2004
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed Sep  1 17:33:27 2004
Subject: [Rd] sunspot data in R 2.0.0
In-Reply-To: <4135E843.9030607@stat.wisc.edu>
Message-ID: <Pine.LNX.4.44.0409011629370.32573-100000@gannet.stats>

On Wed, 1 Sep 2004, Deepayan Sarkar wrote:

> 
> I noticed this in the NEWS:
> 
>      o   Datasets 'sunspot.month' and 'sunspot.year' are available
>          separately but not via data(sunspot) (which is used by package
>          lattice to retrieve a dataset 'sunspot').
> 
> Now, the 'sunspot' dataset included in lattice was actually a mistake, I 
> realized later that I instead wanted the 'sunspots' data from base, 
> which is currently used in example(xyplot). (Even more recently, I 
> realized that I actually want sunspot.year.)
> 
> Would it make any difference if I removed the 'sunspot' data from 
> lattice? I don't think anyone is going to miss it.

Not to that change.  We are trying to encourage the idea that data(foo) 
gives you foo (and possibly more), and also to remove conflicts between 
packages.

I think if you removed sunspot from lattice we could then encourage you to 
use LazyData, which would be good as all other standard and recommended 
packages now do.

Brian

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From p.dalgaard at biostat.ku.dk  Wed Sep  1 17:27:59 2004
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Wed Sep  1 17:33:33 2004
Subject: [Rd] model.matrix.default chokes on backquote (PR#7202)
In-Reply-To: <20040830013521.DDAEC39AA@mprdmxin.myway.com>
References: <20040830013521.DDAEC39AA@mprdmxin.myway.com>
Message-ID: <x2llfuj9fk.fsf@biostat.ku.dk>

"Gabor Grothendieck" <ggrothendieck@myway.com> writes:

> Peter Dalgaard <p.dalgaard@biostat.ku.dk> writes:
> >
> > "Gabor Grothendieck" <ggrothendieck@myway.com> writes:
> > 
> > > > > as.character(attr(terms(`a(b)`~`c(d)`),"variables"))
> > > > [1] "list" "`a(b)`" "`c(d)`"
> > > >
> > > > whereas for instance
> > > >
> > > > > sapply(attr(terms(`a(b)`~`c(d)`),"variables")[-1],as.character)
> > > > [1] "a(b)" "c(d)"
> > >
> > > 1. That is quite subtle but a fix based on that would appear to
> > > solve it.
> > 
> > Hmm, not quite. I tried, and terms like offset(foo) gets me in
> > trouble. Probably, I was fixing the wrong end of the original problem:
> > In the comparisons, we can't have one side with backquotes and the
> > other without them. That doesn't have to mean that they should be
> > removed from both sides, and indeed it would get us in trouble if
> > someone was perverse enough to do things like
> > 
> > y ~ `offset(foo)` + offset(foo)
> > 
> > I.e. perhaps the real issue is that names(data) gets generated without
> > backquotes.
> > 
> > Anyways, this is a real can of worms and I'm not sure we're not too
> > close to 2.0.0 to start tampering with it...
> 
> How about a partial fix that does not address pathological 
> cases where the variable names themselves have embedded 
> backquotes but does address the common cases such as:
> 
> 	y <- ts(1:10); x1 <- y^2; x2 <- y^4
> 	lm(`lag(y)` ~ ., cbind(lag(y), x1, diff(x2)) )
> 
> without having to resort to:
> 
> 	lm(lag.y ~ ., cbind(lag.y = lag(y), x1, diff(x2)) )

I've committed a fix that at least handles Gabor's examples without
breaking the test suite. 

This will *not* cure the issues paraphrased as y ~ `offset(foo)` +
offset(foo), i.e. that a "funny name" and a function call or special
construct can lead to the same variable name in the model frame. I
strongly suspect that this cannot be done without splitting everything
apart and reassembling it into a new design. So, well, just don't do
that! 

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

From rkoenker at uiuc.edu  Wed Sep  1 18:16:36 2004
From: rkoenker at uiuc.edu (roger koenker)
Date: Wed Sep  1 18:16:34 2004
Subject: [Rd] integer overflow
Message-ID: <4C7F60F4-FC32-11D8-9730-000A95A7E3AA@uiuc.edu>

I had a question from a SparseM  user this morning who wanted to do 
something
like this:  (his dimensions, my data)

require(SparseM)
ia <- sample(1:52993,351718,replace=TRUE)
ja <- sample(1:52993,351718,replace=TRUE)
ra <- rnorm(351718)
dim <- as.integer(rep(52993,2))
A <- new("matrix.coo",ra=ra,ia=ia,ja=ja,dim=dim)

The last step failed because validity checking for objects of class 
matrix.coo
wanted to test whether  length(ra)  > prod(dim), but unfortunately I'd 
implemented
the test as nrow*ncol and both were integers of size 52993 so the 
product
produced an integer overflow.  I see in R-help that there was some 
discussion
of this sort of thing with sum() and it appears that perhaps prod was 
also adapted
to avoid this problem.  I'm just wondering whether there was some more 
general
lesson to be learned here.  Other than the well-known "expect the 
unexpected."


url:	www.econ.uiuc.edu/~roger        	Roger Koenker
email	rkoenker@uiuc.edu			Department of Economics
vox: 	217-333-4558				University of Illinois
fax:   	217-244-6678				Champaign, IL 61820

From deepayan at stat.wisc.edu  Wed Sep  1 18:37:18 2004
From: deepayan at stat.wisc.edu (Deepayan Sarkar)
Date: Wed Sep  1 18:37:10 2004
Subject: [Rd] sunspot data in R 2.0.0
In-Reply-To: <Pine.LNX.4.44.0409011629370.32573-100000@gannet.stats>
References: <Pine.LNX.4.44.0409011629370.32573-100000@gannet.stats>
Message-ID: <200409011137.18839.deepayan@stat.wisc.edu>

On Wednesday 01 September 2004 10:33, Prof Brian Ripley wrote:
> On Wed, 1 Sep 2004, Deepayan Sarkar wrote:
> > I noticed this in the NEWS:
> >
> >      o   Datasets 'sunspot.month' and 'sunspot.year' are available
> >          separately but not via data(sunspot) (which is used by
> > package lattice to retrieve a dataset 'sunspot').
> >
> > Now, the 'sunspot' dataset included in lattice was actually a
> > mistake, I realized later that I instead wanted the 'sunspots' data
> > from base, which is currently used in example(xyplot). (Even more
> > recently, I realized that I actually want sunspot.year.)
> >
> > Would it make any difference if I removed the 'sunspot' data from
> > lattice? I don't think anyone is going to miss it.
>
> Not to that change.  We are trying to encourage the idea that
> data(foo) gives you foo (and possibly more), and also to remove
> conflicts between packages.
>
> I think if you removed sunspot from lattice we could then encourage
> you to use LazyData, which would be good as all other standard and
> recommended packages now do.

Sounds good. I'll do that.

Deepayan

From franki at aerodyne.com  Thu Sep  2 18:16:10 2004
From: franki at aerodyne.com (franki@aerodyne.com)
Date: Thu Sep  2 18:16:14 2004
Subject: [Rd] Documentation  R-intro input (PR#7208)
Message-ID: <20040902161610.091C110456@slim.kubism.ku.dk>

Full_Name: Frank J. Iannarilli
Version: 1.9.1
OS: Win2000
Submission from: (NULL) (24.250.56.50)


To the R-intro doc team:

 I'd like to suggest pointing out the sweep() function, probably somewhere in
the section dealing with indexing.  Coming from Mathematica and Matlab, I'm used
to using constructs like All or :. respectively, on the l.h.s. of matrix/vector
assignments to implicitly iterate ["sweep" :-)] across the rows or columns of a
r.h.s. matrix. 

R is great, thanks!

Regards,

From deepayan at stat.wisc.edu  Fri Sep  3 02:13:25 2004
From: deepayan at stat.wisc.edu (Deepayan Sarkar)
Date: Fri Sep  3 02:13:17 2004
Subject: [Rd] .First.lib and namespaces
Message-ID: <200409021913.25918.deepayan@stat.wisc.edu>


The lattice package has a namespace, so it has a .onLoad function. I 
also keep around a .First.lib, for use during development, when I 
temporarily delete the NAMESPACE file.

When using a namespace, I used to comment out the .First.lib function.  
However, that seems unnecessary since it's not executed anyway. Is this 
intended (and dependable) behaviour? 

(If so, this should probably be mentioned in ?library, which currently 
says

     '.First.lib' is called when a package is loaded; '.Last.lib' is
     called when a package is detached.

without any mention of namespaces).

Deepayan

From ripley at stats.ox.ac.uk  Fri Sep  3 08:11:06 2004
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri Sep  3 08:11:09 2004
Subject: [Rd] .First.lib and namespaces
In-Reply-To: <200409021913.25918.deepayan@stat.wisc.edu>
Message-ID: <Pine.LNX.4.44.0409030705160.827-100000@gannet.stats>

On Thu, 2 Sep 2004, Deepayan Sarkar wrote:

> 
> The lattice package has a namespace, so it has a .onLoad function. I 
> also keep around a .First.lib, for use during development, when I 
> temporarily delete the NAMESPACE file.
> 
> When using a namespace, I used to comment out the .First.lib function.  
> However, that seems unnecessary since it's not executed anyway. Is this 
> intended (and dependable) behaviour? 

Yes.

> (If so, this should probably be mentioned in ?library, which currently 
> says
> 
>      '.First.lib' is called when a package is loaded; '.Last.lib' is
>      called when a package is detached.
> 
> without any mention of namespaces).

[.Last.lib is called when a package with a namespace is detached.]

Indeed, but see `Writing R Extensions', under `Load hooks', and

Various @R{} functions in a package can be used to initialize and clean
up.  For packages without a name space, these are @code{.First.lib} and
@code{.Last.lib}.  (For packages with a name space, @xref{Load hooks}.)


I'll update library.Rd to mention this and user hooks.

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From wolski at molgen.mpg.de  Fri Sep  3 10:18:39 2004
From: wolski at molgen.mpg.de (Wolski)
Date: Fri Sep  3 10:18:43 2004
Subject: [Rd] * checking S3 generic/method consistency ... WARNING  Error
 in .tryQuietly({
Message-ID: <200409031018390263.05501AB4@mail.math.fu-berlin.de>

Hi!

In the R directory of the package I have several files. This is because i defined several classes and I like to store each class in separate file.
There is a inheritance defined between those classes.
eg calibrestat (defined in file calibrestat.R) extends (contains) calibstat (defined in file calibstat.R)

While running R CMD check on package I get the following platform (windows/linux) and version (2.0/1.9.1) idependent error.

* checking S3 generic/method consistency ... WARNING
Error in .tryQuietly({ : Error in methodsPackageMetaName("C", name) :
        The name of the object (e.g,. a class or generic function) to find in the meta-data must be a single string (got an object of class "NULL")


Was trying then to point it down and observed the following.
A) If I remove all files except calibstat.R where the superclass is defined * checking S3 generic/method consistency ... OK
B) If I append the content of calibrestat.R >> calibstat.R then * checking S3 generic/method consistency ... OK

So it seems the error are because R dont knows how to build the package - in which order to append the files.

My questions. 
0) Is it something totally different that I think?

1) Is there a way to tell R in which order to merge the files (build(?) the package)
 (eg. by naming the file a_calibstat.R - b_calibrestat.R - to indicicate in which order should they be loaded.) 
I think that this is solution with which I can live with. 

2) Is it intended to implement in future versions mechanisms which automatically will resolve the class dependencies?

3) Or have I to put all the classes in one file by hand and think about it as one of the many features by which R supports package development?


Yours
Eryk.

From ripley at stats.ox.ac.uk  Fri Sep  3 18:34:46 2004
From: ripley at stats.ox.ac.uk (ripley@stats.ox.ac.uk)
Date: Fri Sep  3 18:34:56 2004
Subject: [Rd] Inconsistencies in subassignment with NA index. (PR#7210)
Message-ID: <20040903163446.9B87F10E8B@slim.kubism.ku.dk>

Apart from the inconsistencies, there are two clear bugs here:

1) miscalculating the number of values needed, in the matrix case.  E.g.

> AA[idx, 1] <- B[1:4]
Error in "[<-"(`*tmp*`, idx, 1, value = B[1:4]) :
        number of items to replace is not a multiple of replacement length

although only 4 values are replaced by AA[idx, 1] <- B.

2) the behaviour of the 3D case.

---------- Forwarded message ----------
Date: Fri, 3 Sep 2004 16:40:24 +0100 (BST)
From: Prof Brian Ripley <ripley@stats.ox.ac.uk>
To: "Yao, Minghua" <myao@ou.edu>
Cc: R Help <r-help@stat.math.ethz.ch>
Subject: Re: [R] Different Index behaviors of Array and Matrix

[I will copy a version of this to R-bugs: please be careful when you reply
to only copy to R-bugs a version with a PR number in the subject.]

On Fri, 3 Sep 2004, Yao, Minghua wrote:

>  I found a difference between the indexing of an array and that of a
> matrix when there are NA's in the index array. The screen copy is as
> follows.
>  
> > A <- array(NA, dim=6)
> > A
> [1] NA NA NA NA NA NA

> > idx <- c(1,NA,NA,4,5,6)
> > B <- c(10,20,30,40,50,60)
> > A[idx] <- B
> > A
> [1] 10 NA NA 40 50 60
> > AA <- matrix(NA,6,1)
> > AA
>      [,1]
> [1,]   NA
> [2,]   NA
> [3,]   NA
> [4,]   NA
> [5,]   NA
> [6,]   NA
> > AA[idx,1] <- B
> > AA
>      [,1]
> [1,]   10
> [2,]   NA
> [3,]   NA
> [4,]   20
> [5,]   30
> [6,]   40
> > 
>  In the case of a array, we miss the elements (20 and 30) in B
> corresponding to the NA's in the index array. In the case of a matrix,
> 20 and 30 are assigned to the elements indexed by the indexes following
> the NA's. Is this a reasonable behavior. Thanks in advance for
> explanation.

A is a 1D array but it behaves just like a vector.
Wierder things happen with multi-dimensional arrrays

> A <- array(NA, dim=c(6,1,1))
> A[idx,1,1] <- B
> A
, , 1

     [,1]
[1,]   10
[2,]   NA
[3,]   NA
[4,]   NA
[5,]   NA
[6,]   NA

One problem with what happens for matrices is that

> idx <- c(1,4,5,6)
> AA <- matrix(NA,6,1)
> AA[idx,1] <- B
Error in "[<-"(`*tmp*`, idx, 1, value = B) :
        number of items to replace is not a multiple of replacement length

is an error, so it is not counting the values consistently.

The only discussion I could find (Blue Book p.103, which is also
discussing LHS subscripting) just says

	If a subscript is NA, an NA is returned.

S normally does not use up values when encountering an NA in an index set, 
although it does for logical matrix indexing of data frames.

I can see two possible interpretations.

1) The NA indicates the values was lost after assignment. We don't know
what index the first NA was, so 20 got assigned somewhere.  And as we
don't know where, all the elements had better be NA. However, that is
unless the NA was 0, when no assignment took place any no value was used.

2) The NA indicates the value was lost before assignment, so no assignment 
took place and no value was used.

R does neither of those.  I suspect the correct course of action is to ban 
NAs in subscripted assignments.


-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From gregory_r_warnes at groton.pfizer.com  Fri Sep  3 18:36:12 2004
From: gregory_r_warnes at groton.pfizer.com (Warnes, Gregory R)
Date: Fri Sep  3 18:36:43 2004
Subject: [Rd] reorder [stats] and reorder.factor [lattice]
Message-ID: <D7A3CFD7825BD6119B880002A58F06C20C521B26@groexmb02.pfizer.com>


I also have a reorder.factor defined in the gregmisc package.  It has a
slighly different behavior.
It allows 
	- sorting the factor level names via 'mixedsort', which sorts mixed 
        numeric/character intelligently so that 'Cis 10mg' comes after 
        'Cis 5mg' and before 'Taxol 10mg'
	- reordering by a numeric order 
	- reordering by named factor labels.

Combining it with the version provided by Deepayan we get:

reorder.factor <- function(x,
                           order,
                           X,
                           FUN,
                           sort=mixedsort,
                           make.ordered = is.ordered(x),
                           ... )
  {
    constructor <- if (make.ordered) ordered else factor

    if (!missing(order))
      {
        if (is.numeric(order))
          order = levels(x)[order]
        else
          order = order
      }
    else if (!missing(FUN))
      order = names(sort(tapply(X, x, FUN, ...)))
    else
      order = sort(levels(x))

    constructor( x, levels=order)

  }

Yielding:

>    # Create a 4 level example factor
>    trt <- factor( sample( c("PLACEBO","300 MG", "600 MG", "1200 MG"),
+                   100, replace=TRUE ) )
>    summary(trt)
1200 MG  300 MG  600 MG PLACEBO 
     18      24      30      28 
>    # Note that the levels are not in a meaningful order.
> 
> 
>    # Change the order to something useful
>    # default "mixedsort" ordering
>    trt2 <- reorder(trt)
>    summary(trt2)
 300 MG  600 MG 1200 MG PLACEBO 
     24      30      18      28 
>    # using indexes:
>    trt3 <- reorder(trt, c(4,2,3,1))
>    summary(trt3)
PLACEBO  300 MG  600 MG 1200 MG 
     28      24      30      18 
>    # using label names:
>    trt4 <- reorder(trt, c("PLACEBO","300 MG", "600 MG", "1200 MG") )
>    summary(trt4)
PLACEBO  300 MG  600 MG 1200 MG 
     28      24      30      18 
>    # using frequency
>    trt5 <- reorder(trt, X=as.numeric(trt), FUN=length)
>    summary(trt5)
1200 MG  300 MG PLACEBO  600 MG 
     18      24      28      30 
> 
> 
>    # drop out the '300 MG' level
>    trt6 <- reorder(trt, c("PLACEBO", "600 MG", "1200 MG") )
>    summary(trt6)
PLACEBO  600 MG 1200 MG    NA's 
     28      30      18      24 
> 


-Greg

(the 'mixedsort' function is available in the gregmisc package, or on
request)



> -----Original Message-----
> From: r-devel-bounces@stat.math.ethz.ch
> [mailto:r-devel-bounces@stat.math.ethz.ch]On Behalf Of Deepayan Sarkar
> Sent: Friday, August 27, 2004 3:32 PM
> To: Prof Brian Ripley
> Cc: r-devel@stat.math.ethz.ch
> Subject: Re: [Rd] reorder [stats] and reorder.factor [lattice]
> 
> 
> On Friday 27 August 2004 11:17, Prof Brian Ripley wrote:
> > On Fri, 27 Aug 2004, Deepayan Sarkar wrote:
> > > It was recently pointed out on the lists that the S-PLUS 
> Trellis suite
> > > has a function called reorder.factor that's useful in 
> getting useful
> > > ordering of factors for graphs. I happily went ahead and 
> implemented it,
> > > but it turns out that R (not S-PLUS) has a generic called 
> reorder (with a
> > > method for "dendrogram"). Naturally, this causes R to 
> think I'm defining
> > > a method for "factor", and gives a warning during check because of
> > > mismatching argument names.
> > >
> > > Any suggestions as to what I should do? Retaining S 
> compatibility doesn't
> > > seem to be an option. I could make a reorder method for 
> "factor" (which
> > > sounds like a good option to me), or rename it to something like
> > > reorderFactor.
> >
> > I am pretty sure you don't want to copy the Trellis call, which is
> >
> > function(Factor, X, Function = mean, ...)
> >
> > and suggests it dates from the days when S3 lookup could 
> not distingush
> > functions from other objects by context, hence the 
> capitalization.  Even
> > then, it is inconsistent with tapply etc which use FUN.
> >
> > reorder.factor <- function(x, X, FUN=mean)
> >
> > looks about right.  Another problem though: in Trellis 
> reorder.factor
> > doesn't just reorder the factor, it makes it an ordered 
> factor.  I don't
> > really see why, especially as the modelling functions 
> assume that ordered
> > means equally spaced.  If this is to be used more generally 
> (as Kjetil
> > Halvorsen suggests) then it should record the scores used to do the
> > ordering in an attribute.
> 
> Well, the ordered factor issue had come up before, and I 
> currently define this 
> as
> 
> 
> which is different from the S-PLUS version in 2 ways: 
> 
> 1. for (unordered) factors, it changes the levels, but keeps 
> it a factor
> 
> 2. it works for non-factors as well (which is moot if it's 
> going to be 
>    a factor method)
> 
> 
> Implementation details aside, this seems to me like a good 
> candidate for stats 
> (although it'll probably be used very little). lattice 
> functions (will) have 
> an alternative way of determining panel order based on panel 
> contents, which 
> makes more sense to me in the plotting context.
> 
> Deepayan
> 
> ______________________________________________
> R-devel@stat.math.ethz.ch mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 


LEGAL NOTICE\ Unless expressly stated otherwise, this messag...{{dropped}}

From DiademCEO at aol.com  Fri Sep  3 21:48:20 2004
From: DiademCEO at aol.com (DiademCEO@aol.com)
Date: Fri Sep  3 21:48:33 2004
Subject: [Rd] Guidance implementing high precision integers
Message-ID: <1cf.2a1728e7.2e6a2484@aol.com>

Gracious Experts:

I am considering implementing extended precision integers as an R package, 
using wrappers to C functions.  My intent is to allow, say, 4-word length 
integer values supporting basic arithmetic and a few number theoretic functions.

At this stage of the game, I am looking to you for guidance about how best to 
approach this sort of thing with R.  Ideally, I'd like to use S4 style 
classes on the R side.

What is the most direct, fail-safe approach?

Thank you for any assistance,

Jeffrey A. Sarnoff

	[[alternative HTML version deleted]]

From tlumley at u.washington.edu  Sat Sep  4 01:47:28 2004
From: tlumley at u.washington.edu (tlumley@u.washington.edu)
Date: Sat Sep  4 01:47:35 2004
Subject: [Rd] Inconsistencies in subassignment  (PR#7210)
Message-ID: <20040903234728.CB4B910EB7@slim.kubism.ku.dk>


I have made the 3-d case do the same as the vector case, which is what the
C code clearly intended (a goto label was in the wrong place).

This leaves the bigger question of the right thing to do. I note that data
frames give an error when any indices are NA.

	-thomas

On Fri, 3 Sep 2004 ripley@stats.ox.ac.uk wrote:

> Apart from the inconsistencies, there are two clear bugs here:
>
> 1) miscalculating the number of values needed, in the matrix case.  E.g.
>
> > AA[idx, 1] <- B[1:4]
> Error in "[<-"(`*tmp*`, idx, 1, value = B[1:4]) :
>         number of items to replace is not a multiple of replacement length
>
> although only 4 values are replaced by AA[idx, 1] <- B.
>
> 2) the behaviour of the 3D case.
>
> ---------- Forwarded message ----------
> Date: Fri, 3 Sep 2004 16:40:24 +0100 (BST)
> From: Prof Brian Ripley <ripley@stats.ox.ac.uk>
> To: "Yao, Minghua" <myao@ou.edu>
> Cc: R Help <r-help@stat.math.ethz.ch>
> Subject: Re: [R] Different Index behaviors of Array and Matrix
>
> [I will copy a version of this to R-bugs: please be careful when you reply
> to only copy to R-bugs a version with a PR number in the subject.]
>
> On Fri, 3 Sep 2004, Yao, Minghua wrote:
>
> >  I found a difference between the indexing of an array and that of a
> > matrix when there are NA's in the index array. The screen copy is as
> > follows.
> >
> > > A <- array(NA, dim=6)
> > > A
> > [1] NA NA NA NA NA NA
>
> > > idx <- c(1,NA,NA,4,5,6)
> > > B <- c(10,20,30,40,50,60)
> > > A[idx] <- B
> > > A
> > [1] 10 NA NA 40 50 60
> > > AA <- matrix(NA,6,1)
> > > AA
> >      [,1]
> > [1,]   NA
> > [2,]   NA
> > [3,]   NA
> > [4,]   NA
> > [5,]   NA
> > [6,]   NA
> > > AA[idx,1] <- B
> > > AA
> >      [,1]
> > [1,]   10
> > [2,]   NA
> > [3,]   NA
> > [4,]   20
> > [5,]   30
> > [6,]   40
> > >
> >  In the case of a array, we miss the elements (20 and 30) in B
> > corresponding to the NA's in the index array. In the case of a matrix,
> > 20 and 30 are assigned to the elements indexed by the indexes following
> > the NA's. Is this a reasonable behavior. Thanks in advance for
> > explanation.
>
> A is a 1D array but it behaves just like a vector.
> Wierder things happen with multi-dimensional arrrays
>
> > A <- array(NA, dim=c(6,1,1))
> > A[idx,1,1] <- B
> > A
> , , 1
>
>      [,1]
> [1,]   10
> [2,]   NA
> [3,]   NA
> [4,]   NA
> [5,]   NA
> [6,]   NA
>
> One problem with what happens for matrices is that
>
> > idx <- c(1,4,5,6)
> > AA <- matrix(NA,6,1)
> > AA[idx,1] <- B
> Error in "[<-"(`*tmp*`, idx, 1, value = B) :
>         number of items to replace is not a multiple of replacement length
>
> is an error, so it is not counting the values consistently.
>
> The only discussion I could find (Blue Book p.103, which is also
> discussing LHS subscripting) just says
>
> 	If a subscript is NA, an NA is returned.
>
> S normally does not use up values when encountering an NA in an index set,
> although it does for logical matrix indexing of data frames.
>
> I can see two possible interpretations.
>
> 1) The NA indicates the values was lost after assignment. We don't know
> what index the first NA was, so 20 got assigned somewhere.  And as we
> don't know where, all the elements had better be NA. However, that is
> unless the NA was 0, when no assignment took place any no value was used.
>
> 2) The NA indicates the value was lost before assignment, so no assignment
> took place and no value was used.
>
> R does neither of those.  I suspect the correct course of action is to ban
> NAs in subscripted assignments.
>
>
> --
> Brian D. Ripley,                  ripley@stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>
> ______________________________________________
> R-devel@stat.math.ethz.ch mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

Thomas Lumley			Assoc. Professor, Biostatistics
tlumley@u.washington.edu	University of Washington, Seattle

From deepayan at stat.wisc.edu  Mon Sep  6 06:20:35 2004
From: deepayan at stat.wisc.edu (deepayan@stat.wisc.edu)
Date: Mon Sep  6 06:20:41 2004
Subject: [Rd] minor typo in by.Rd (PR#7211)
Message-ID: <20040906042035.28DA010EAB@slim.kubism.ku.dk>


src/library/base/man/by.Rd has 


\item{INDICES}{a factor or a list of factors, each of 
   length \code{nrow(x)}.}
\item{FUN}{a function to be applied to data frame 
   subsets of \code{x}.}


'x' should be 'data' in both.


Also, in 


\details{
  A data frame is split by row into data frames
  subsetted by the values of one or more factors, and function
  \code{FUN} is applied to each subset in term.


the last word was probably meant to be 'turn'.


-Deepayan

From p.dalgaard at biostat.ku.dk  Mon Sep  6 11:57:11 2004
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Mon Sep  6 11:57:29 2004
Subject: [Rd] First R-2.0.0 alpha version
Message-ID: <x21xhfra88.fsf@biostat.ku.dk>


OK folks,

We're warming up to the release of R-2.0.0 on Oct. 4 (aka 2004-10-04).

There will be two weeks of alpha releases followed by two weeks of
beta releases, starting today. The releases are made available via
CRAN in

  http://cran.r-project.org/src/base-prerelease

and the first one is there already. In case of urgency or CRAN
failure, the releases will also be found at 

  http://www.biostat.ku.dk/~pd/R-pre

Procedures have changed a bit due to the change from a CVS to SVN
source code repository over summer, and the fact that the core team
needed to cut back on remote logins to eachother's computers for
security reasons. Thus, there is a higher risk that something goes
wrong in the packaging this time, and so it is important to get the
tarballs tested thoroughly (only minimal checking takes place during
the build). As always, the need for testing is particularly important
for the less common platforms.

Please make sure to test the tarballs, building from rsync or SVN
checkouts is not quite the same thing.

        for the R Core Team
        Peter Dalgaard

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

From ripley at stats.ox.ac.uk  Mon Sep  6 14:47:26 2004
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon Sep  6 14:47:30 2004
Subject: [Rd] minor typo in by.Rd (PR#7211)
In-Reply-To: <20040906042035.28DA010EAB@slim.kubism.ku.dk>
Message-ID: <Pine.LNX.4.44.0409061347120.7134-100000@gannet.stats>

Thank you, now fixed.

On Mon, 6 Sep 2004 deepayan@stat.wisc.edu wrote:

> 
> src/library/base/man/by.Rd has 
> 
> 
> \item{INDICES}{a factor or a list of factors, each of 
>    length \code{nrow(x)}.}
> \item{FUN}{a function to be applied to data frame 
>    subsets of \code{x}.}
> 
> 
> 'x' should be 'data' in both.
> 
> 
> Also, in 
> 
> 
> \details{
>   A data frame is split by row into data frames
>   subsetted by the values of one or more factors, and function
>   \code{FUN} is applied to each subset in term.
> 
> 
> the last word was probably meant to be 'turn'.
> 
> 
> -Deepayan
> 
> ______________________________________________
> R-devel@stat.math.ethz.ch mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From david.clayton at cimr.cam.ac.uk  Mon Sep  6 18:25:16 2004
From: david.clayton at cimr.cam.ac.uk (david.clayton@cimr.cam.ac.uk)
Date: Mon Sep  6 18:25:18 2004
Subject: [Rd] qchisq (PR#7212)
Message-ID: <20040906162516.C86A110EA1@slim.kubism.ku.dk>

Full_Name: David Clayton
Version: 1.8.1
OS: Linux
Submission from: (NULL) (131.111.126.242)


qchisq behaves very strangely when ncp is passed as zero (forcing internal
qnchisq to be called) when first argument is small.

Eg


> qchisq(1-1e-6, 1, ncp=0, lower.tail=TRUE)
qchisq(1-1e-6, 1, ncp=0, lower.tail=TRUE)
[1] 1024

while, if ncp is unspecified,

> qchisq(1-1e-6, 1)
qchisq(1-1e-6, 1)
[1] 23.92813

From p.dalgaard at biostat.ku.dk  Mon Sep  6 18:46:06 2004
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Mon Sep  6 18:46:23 2004
Subject: [Rd] qchisq (PR#7212)
In-Reply-To: <20040906162516.C86A110EA1@slim.kubism.ku.dk>
References: <20040906162516.C86A110EA1@slim.kubism.ku.dk>
Message-ID: <x27jr7xs4x.fsf@biostat.ku.dk>

david.clayton@cimr.cam.ac.uk writes:

> Full_Name: David Clayton
> Version: 1.8.1
....
> qchisq behaves very strangely when ncp is passed as zero (forcing internal
> qnchisq to be called) when first argument is small.
> 
> Eg
> 
> 
> > qchisq(1-1e-6, 1, ncp=0, lower.tail=TRUE)
> qchisq(1-1e-6, 1, ncp=0, lower.tail=TRUE)
> [1] 1024
> 
> while, if ncp is unspecified,
> 
> > qchisq(1-1e-6, 1)
> qchisq(1-1e-6, 1)
> [1] 23.92813

As Brian once put it, we can't fix old versions retroactively. 1.9.1
has (on "Linux" as well, although that is a bit unspecific for numeric
issues). 

> qchisq(1-1e-6, 1, ncp=0, lower.tail=TRUE)
[1] 23.92813
> qchisq(1-1e-6, 1)
[1] 23.92813

Possibly, this is a side effect of

    o   qchisq(1-e, .., ncp=.) did not terminate for small e.
        (PR#6421 (PR#875))

from BUG FIXES for 1.9.0.

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

From ivo_welch at mailblocks.com  Mon Sep  6 23:44:22 2004
From: ivo_welch at mailblocks.com (ivo welch)
Date: Mon Sep  6 23:44:15 2004
Subject: [Rd] Re: [R] R on gentoo amd64 (gcc 3.3.3) is unstable --- no!
In-Reply-To: <Pine.LNX.4.44.0408211504560.12323-100000@gannet.stats>
References: <Pine.LNX.4.44.0408211504560.12323-100000@gannet.stats>
	<413CDA36.3080705@mailblocks.com>
	<ivo_welch-0qnIYAr8iWHch45kLJ506ZGEc8ogD30@mailblocks.com>
	<ivo_welch-0qnIYAsEiWHcfsY9LiYMTuo5UU87LXJ@mailblocks.com>
	<ivo_welch-0qnIYAsMiWHc2lVv4ukq7PpvhzzvwDj@mailblocks.com>
Message-ID: <ivo_welch-0qnIYAsUiWHc3f7oK+VbFXacVlDzo6D@mailblocks.com>

Prof Brian Ripley wrote:

>On Sat, 21 Aug 2004 ivo_welch-rstat8783@mailblocks.com wrote:
>
>  
>
>>peter/brian:  thank you for the help.  i can now report that gentoo 
>>amd64 can compile R just fine, too; it requires the f77 USE flag and a 
>>gcc compiler rebuild first, though.  I also went to gcc 3.4.1.  my 
>>segfault troubles earlier were caused by my use of f2c.
>>
>>suggestion: would it be possible to add a code snippet  that tests 
>>whether the user is trying to compile with f2c---and if so, bombs the 
>>installation?  (if "f77 --version == f2c" then die)  I know the 
>>problems are not R's fault, but it can percolate into R and it can 
>>protect people like myself.
>>    
>>
>
>The thing is, it does work on some platforms -- I do test i686 RH8.0
>(updated with gcc 3.4.1) from time to time and it looks like I tested
>1.9.0 during beta test.  So `make check' is the only reliable test.
>(I've just run the current R-devel to cross-check.  It runs into the 
>infinite-loop in LAPACK problem with gcc >= 3.4.0 though, with the same 
>fix.)
>
>I suspect f2c on a 64-bit platform is a bad idea as int != long.
>We could detect that.
>
>  
>
gentlemen:  the folks on the gentoo mailing list did some further 
investigation into this f2c incompatibility with blas (boy, they are 
good!).  apparently, this is likely to be a gcc bug:
    http://bugs.gentoo.org/show_bug.cgi?id=61042
they also have a fix for the particular show-stopper, which occurs in 
function blas.c.  (a "const" addition to the parameters cures the problem.)

just in case you are still interested...

regards,

/ivo

From p.dalgaard at biostat.ku.dk  Tue Sep  7 00:17:21 2004
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Tue Sep  7 00:17:47 2004
Subject: [Rd] Glitch involving difftime and data frame
Message-ID: <x2llfn2gb2.fsf@biostat.ku.dk>

This looks unintentional:

> d <- as.Date("2004-09-07")
> dd <- as.Date("2004-10-04")
> data.frame(d,dd,dd-d)
Error in as.data.frame.default(x[[i]], optional = TRUE) :
        can't coerce difftime into a data.frame
> F <- data.frame(d,dd)
> F$foo <- dd-d
> cbind(F,dd-d)
Error in as.data.frame.default(x[[i]], optional = TRUE) :
        can't coerce difftime into a data.frame

Basically, the issue is that as.data.frame on a classed object expects
to find a method and there isn't any for difftime...


-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

From ripley at stats.ox.ac.uk  Tue Sep  7 00:30:36 2004
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue Sep  7 00:30:45 2004
Subject: [Rd] Glitch involving difftime and data frame
In-Reply-To: <x2llfn2gb2.fsf@biostat.ku.dk>
Message-ID: <Pine.LNX.4.44.0409062326140.27999-100000@gannet.stats>

On 7 Sep 2004, Peter Dalgaard wrote:

> This looks unintentional:

Not so.

> > d <- as.Date("2004-09-07")
> > dd <- as.Date("2004-10-04")
> > data.frame(d,dd,dd-d)
> Error in as.data.frame.default(x[[i]], optional = TRUE) :
>         can't coerce difftime into a data.frame
> > F <- data.frame(d,dd)
> > F$foo <- dd-d
> > cbind(F,dd-d)
> Error in as.data.frame.default(x[[i]], optional = TRUE) :
>         can't coerce difftime into a data.frame
> 
> Basically, the issue is that as.data.frame on a classed object expects
> to find a method and there isn't any for difftime...

Difftime depends crucially on attributes on the vector.  I wasn't 
confident that they would be preserved as needed (and I think I had a 
problem example).  Since then we have fixed a lot of the subsetting 
methods, but even so I am not 100% confident.

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From vograno at evafunds.com  Tue Sep  7 00:41:46 2004
From: vograno at evafunds.com (Vadim Ogranovich)
Date: Tue Sep  7 00:42:17 2004
Subject: [Rd] RE: [R] [R] interaction of options(error=) and try(): was how
	to debug a sudden exit in non-interactive mode
Message-ID: <C698D707214E6F4AB39AB7096C3DE5A563D9A4@phost015.EVAFUNDS.intermedia.net>

Hi,

First of all let me thank Prof. Ripley and Peter Dalgaard for their
suggestions about ways to debug my initial problem. Debugger() suggested
by Prof. Ripley could have provided the definitive answer hadn't it
itself be somewhat flaky. Anyway it still helped a lot to pinpoint the
problem.

The problem turned out to be an old R "deficiency" that showed up again
when I used the mgcv package. In Jan 2003 I reported that even when an
error happens inside try() the error handler set by option(error=...)
would still be called (and it shouldn't). If the handler does something
non-local, e.g. quits via q(), then the function is given no chance to
recover. This is precisely what happened in my case.

The mgcv's function get.var() uses try() and then gracefully recovers
from the error, see a verbatim copy below:
get.var <- function (txt, data) 
{
    x <- data[[txt]]
    if (is.null(x)) {
        x <- try(eval(parse(text = txt), data, enclos = NULL), 
            silent = TRUE)
        if (inherits(x, "try-error")) 
            x <- NULL
    }
    x
} 


However inside my .Rprofile I set
if (!interactive()) {
  options(error=quote({dump.frames(to.file=TRUE); q()}))
}
in order to use debugger() later on the dump. (I can no longer do it
since it breaks mgcv).



Back in 2003 I was told that this deficiency would go away when a new
more comprehensive mechanism would be implemented. Has it?

I thought I'd bring it up again since now it affects a recommended
package and therefore is less esoteric than my original example.

Thanks,
Vadim


> -----Original Message-----
> From: Peter Dalgaard [mailto:p.dalgaard@biostat.ku.dk] 
> Sent: Friday, September 03, 2004 1:02 PM
> To: Prof Brian Ripley
> Cc: Vadim Ogranovich; r-help@stat.math.ethz.ch
> Subject: Re: [R] how to debug a sudden exit in non-interactive mode
> 
> Prof Brian Ripley <ripley@stats.ox.ac.uk> writes:
> 
> > If you look in ?debugger, especially right at the end, you will see 
> > how to attempt a post-mortem dump of the frams to a file.  If that 
> > gets run (and this might be a fatal error from C level, but 
> it is not 
> > reporting so), you can reload the dump and use debugger on it.
> > 
> > On Fri, 3 Sep 2004, Vadim Ogranovich wrote:
> [snip]
> > > # Here I run it non-interactively from the shell. Note 
> that the last 
> > > line, cat("after\n"), doesn't get executed. (it does get 
> executed in 
> > > the interactive mode or with --no-init-file) ~% R --no-save 
> > > --no-restore --silent < debug.R
> 
> Also, with an invocation like that, you can run under the debugger as
> follows: 
> 
>   $ R -d gdb
>   (gdb) run --no-save --no-restore --silent < debug.R
> 
> and maybe set a breakpoint in the error handler, or just let 
> it run to completion and see if it segfaults or something.
> 
> -- 
>    O__  ---- Peter Dalgaard             Blegdamsvej 3  
>   c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
>  (*) \(*) -- University of Copenhagen   Denmark      Ph: 
> (+45) 35327918
> ~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: 
> (+45) 35327907
>

From p.dalgaard at biostat.ku.dk  Tue Sep  7 00:54:41 2004
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Tue Sep  7 00:55:04 2004
Subject: [Rd] Glitch involving difftime and data frame
In-Reply-To: <Pine.LNX.4.44.0409062326140.27999-100000@gannet.stats>
References: <Pine.LNX.4.44.0409062326140.27999-100000@gannet.stats>
Message-ID: <x2hdqb2eku.fsf@biostat.ku.dk>

Prof Brian Ripley <ripley@stats.ox.ac.uk> writes:

> On 7 Sep 2004, Peter Dalgaard wrote:
> 
> > This looks unintentional:
> 
> Not so.
> 
> > > d <- as.Date("2004-09-07")
> > > dd <- as.Date("2004-10-04")
> > > data.frame(d,dd,dd-d)
> > Error in as.data.frame.default(x[[i]], optional = TRUE) :
> >         can't coerce difftime into a data.frame
> > > F <- data.frame(d,dd)
> > > F$foo <- dd-d
> > > cbind(F,dd-d)
> > Error in as.data.frame.default(x[[i]], optional = TRUE) :
> >         can't coerce difftime into a data.frame
> > 
> > Basically, the issue is that as.data.frame on a classed object expects
> > to find a method and there isn't any for difftime...
> 
> Difftime depends crucially on attributes on the vector.  I wasn't 
> confident that they would be preserved as needed (and I think I had a 
> problem example).  Since then we have fixed a lot of the subsetting 
> methods, but even so I am not 100% confident.

Hmm. So to get a survival time (say) into a data frame, we should
unclass it? (That $<- works seems coincidental and the resulting data
frame might cause trouble down the line). It does look rather tempting
to do as.data.frame.difftime <- as.data.frame.numeric and begone with
it though....

(It doesn't make much sense to have units other than "days" for Date
differences, so the use of difftime objects is a bit pointless from
the practical perspective, although perhaps not from a consistency
perspective. Any chance of doing months and years?)

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

From znmeb at aracnet.com  Tue Sep  7 01:23:30 2004
From: znmeb at aracnet.com (M. Edward Borasky)
Date: Tue Sep  7 01:24:36 2004
Subject: [Rd] First testing of R-2.0.0 alpha on Gentoo Linux
Message-ID: <1094513009.11470.12.camel@localhost>

I just got R-2.0.0 alpha running on my Gentoo Linux system. The only
issue I had was that if I do "--with-lapack" in the "configure", "make
check" fails very early. Once I removed that option, "make check-all"
passed. I have both "blas-atlas" and "lapack-atlas" installed on my
system. The Atlas version is 3.6.0.

There were a few warnings in the logs of "make check-all". Does anyone
want to see the log files? I'm going to go ahead and test 2.0.0 with
some of the simple things I do. I don't do anything very complicated
with it, so it may not shake out anything. If there's anything
Gentoo-specific you want me to run, please let me know. I'm on the
Gentoo "science" mailing list and I can get their attention fairly
easily.

From p.dalgaard at biostat.ku.dk  Tue Sep  7 08:51:44 2004
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Tue Sep  7 08:52:08 2004
Subject: [Rd] First testing of R-2.0.0 alpha on Gentoo Linux
In-Reply-To: <1094513009.11470.12.camel@localhost>
References: <1094513009.11470.12.camel@localhost>
Message-ID: <x2n0028tbz.fsf@biostat.ku.dk>

"M. Edward Borasky" <znmeb@aracnet.com> writes:

> I just got R-2.0.0 alpha running on my Gentoo Linux system. The only
> issue I had was that if I do "--with-lapack" in the "configure", "make
> check" fails very early. Once I removed that option, "make check-all"
> passed. I have both "blas-atlas" and "lapack-atlas" installed on my
> system. The Atlas version is 3.6.0.

Hmm, but would the linker know where to find them? Also, there could
be an issue with dynamic vs. static libraries. Any configure experts
around? 

> There were a few warnings in the logs of "make check-all". Does anyone
> want to see the log files? 

Not all of them, for every build... I think most of the warnings are
in principle known by the respective authors, but a small "executive
summary" might have some nag factor value.

> I'm going to go ahead and test 2.0.0 with
> some of the simple things I do. I don't do anything very complicated
> with it, so it may not shake out anything. If there's anything
> Gentoo-specific you want me to run, please let me know. I'm on the
> Gentoo "science" mailing list and I can get their attention fairly
> easily.

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

From ripley at stats.ox.ac.uk  Tue Sep  7 09:14:41 2004
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue Sep  7 09:14:47 2004
Subject: [Rd] First testing of R-2.0.0 alpha on Gentoo Linux
In-Reply-To: <x2n0028tbz.fsf@biostat.ku.dk>
Message-ID: <Pine.LNX.4.44.0409070806510.8318-100000@gannet.stats>

On 7 Sep 2004, Peter Dalgaard wrote:

> "M. Edward Borasky" <znmeb@aracnet.com> writes:
> 
> > I just got R-2.0.0 alpha running on my Gentoo Linux system. The only
> > issue I had was that if I do "--with-lapack" in the "configure", "make
> > check" fails very early. 

It would have been helpful to say where, exactly.

> Once I removed that option, "make check-all"
> > passed. I have both "blas-atlas" and "lapack-atlas" installed on my
> > system. The Atlas version is 3.6.0.
> 
> Hmm, but would the linker know where to find them? Also, there could
> be an issue with dynamic vs. static libraries. Any configure experts
> around? 

(Well, I wrote that part of configure, amongst others.) R-admin does warn
against using --with-lapack:

  Provision is made for using an external LAPACK library, principally to
  cope with BLAS libraries which contain a copy of LAPACK ...

Note that lapack-atlas is probably not a complete lapack, and if it is, it 
may not be bug-fixed ...

   If you do use @option{--with-lapack}, be aware of potential problems
   with bugs in the LAPACK 3.0 sources (or in the posted corrections to 
   those sources).

So all I can conclude from this is that Gentoo's libraries are not 
sufficient.

When I do this, I have to be very careful how I build LAPACK, using
-fforce-store where R does.  It then works but I see negligible 
performance boost (Goto's BLAS is better than ATLAS, anyway).

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From wolski at molgen.mpg.de  Tue Sep  7 09:48:06 2004
From: wolski at molgen.mpg.de (Wolski)
Date: Tue Sep  7 09:48:10 2004
Subject: [Rd] package methods different behaviour R1.9.1 patched and R2.0.0
Message-ID: <200409070948060366.039FB48D@mail.math.fu-berlin.de>

Hi!

Concerning different behaviour between 1.9.1 patched and:
R : Copyright 2004, The R Foundation for Statistical Computing
Version 2.0.0 Under development (unstable) (2004-09-06), ISBN 3-900051-07-0

Subtitle:
as(x,"vector"); x is of class "Massvector"; never enters setAs("Massvector","vector"...

The same code:

as(mvl[[1]],"vector")
causes under R1.9.1 to enter the function
setAs("Massvector","vector"
      ,function(from)
...

This never happens under R2.0.0.

The class "Massvector" contains class "Matrix"

A phenomenological description of what happens instead with R2.0.0 is

as(as(mvl[[1]],"Matrix"),"vector")

and its not what I would expect.

Is this an intended behaviour in R2.0.0?

/E

From ripley at stats.ox.ac.uk  Tue Sep  7 10:01:37 2004
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue Sep  7 10:01:39 2004
Subject: [Rd] Run up to R 2.0.0 for package maintainers
Message-ID: <Pine.LNX.4.44.0409070849490.8420-100000@gannet.stats>

The major changes for R 2.0.0 are now in place, and we have provided a set 
of notes for package maintainers at

	http://developer.r-project.org/200update.txt

on both changes needed and new opportunities.

The main thing which needs to be done is to revise the DESCRIPTION file, 
in particular to ensure the Depends: field is accurate.

We do run daily checks over all the CRAN packages. See

	http://cran.r-project.org/src/contrib/checkSummary.html

(Unfortunately although the checks have been run last week, the summary 
has not been updated since Aug 29.)

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From ripley at stats.ox.ac.uk  Tue Sep  7 10:16:51 2004
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue Sep  7 10:16:56 2004
Subject: [Rd] Inconsistencies in subassignment  (PR#7210)
In-Reply-To: <20040903234728.CB4B910EB7@slim.kubism.ku.dk>
Message-ID: <Pine.LNX.4.44.0409070908110.8491-100000@gannet.stats>

On Sat, 4 Sep 2004 tlumley@u.washington.edu wrote:
 
> I have made the 3-d case do the same as the vector case, which is what the
> C code clearly intended (a goto label was in the wrong place).
> 
> This leaves the bigger question of the right thing to do. I note that data
> frames give an error when any indices are NA.

One case is unambiguous and common:

	x[ind] <- val

where `val' is of length one.  I've written code to ban all other 
subassignments involving NAs.  Once I fixed occurrences in R itself 
(notably in ifelse), only three problems remain in tests over the CRAN 
packages

< Running examples in ape-Ex.R failed.
< > ### * popsize
    area[a == 0] <- stepfunction[a == 0]

< Running examples in RandomFields-Ex.R failed.
< > ### * ShowModels
expr[pmatch(covlist, namen)] <- exprlist

< Running examples in sm-Ex.R failed.
< > ### * sm.sphere
    z[xyzok < 0] <- (za - zb)[xyzok < 0]

The first and third are a typical usage, where R makes more sense than S.
[Worryingly, sm was written for S-PLUS and would seem to be incorrect 
there.]

So in R 2.0.0 we will have

\section{NAs in indexing}{
  When subscripting, a numerical, logical or character \code{NA} picks
  an unknown element and so returns \code{NA} in the corresponding
  element of a logical, integer, numeric, complex or character result,
  and \code{NULL} for a list.

  When replacing (that is using subscripting on the lhs of an
  assignment) \code{NA} does not select any element to be replaced.  As
  there is ambiguity as to whether an element of the rhs should
  be used or not (and \R handled this inconsistently prior to \R 2.0.0),
  this is only allowed if the rhs value is of length one (so the two
  interpretations would have the same outcome).  
}

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From wolski at molgen.mpg.de  Tue Sep  7 10:29:05 2004
From: wolski at molgen.mpg.de (Wolski)
Date: Tue Sep  7 10:29:14 2004
Subject: [Rd] package methods different behaviour R1.9.1 patched and R2.0.0
References: <200409070948060366.039FB48D@mail.math.fu-berlin.de>
Message-ID: <200409071029050308.03C539C7@mail.math.fu-berlin.de>

I had a typo in  the previous mail

"Massvector" extends "matrix" not "Matrix"


/E

From JRosten at lehman.com  Tue Sep  7 11:24:46 2004
From: JRosten at lehman.com (JRosten@lehman.com)
Date: Tue Sep  7 11:24:48 2004
Subject: [Rd] FW: Problems with floor, round functions (PR#7215)
Message-ID: <20040907092446.226AF10EC1@slim.kubism.ku.dk>


Please disregard the previous bug report. It appears that the session I was
running had become corrupted and a new one is not reproducing the errors
described.

thanks
>  -----Original Message-----
> From: 	Rosten, Jeremy  
> Sent:	Tuesday, September 07, 2004 9:44 AM
> To:	'R-bugs@R-project.org'
> Subject:	Problems with floor, round functions
> 
> Hi
> 
> I am currently using version 1.6.2 ( I am in the process of getting 1.9.1
> installed) and perhaps this is an old problem that has been resolved.
> 
> Anyway hat I am seeing is the following:
> 
> > floor(4.99)
> [1] 4
> > 0.01*floor(4.99)
> [1] 0.03
> 
> And :
>  0.01*(floor(4.99)+0.00000000001)
> [1] 0.04
> 
> Even when I do:
> 
> as.numeric(as.character(floor(4.99)))+0.1
> 
> I get:
> 
> [1] 4.0
> 
> This happens with round and ceiling as well .
> 
> Thanks
> 
> Jeremy Rosten
> 
> 

------------------------------------------------------------------------------
This message is intended only for the personal and confidential use of the
designated recipient(s) named above.  If you are not the intended recipient of
this message you are hereby notified that any review, dissemination,
distribution or copying of this message is strictly prohibited.  This
communication is for information purposes only and should not be regarded as
an offer to sell or as a solicitation of an offer to buy any financial
product, an official confirmation of any transaction, or as an official
statement of Lehman Brothers.  Email transmission cannot be guaranteed to be
secure or error-free.  Therefore, we do not represent that this information is
complete or accurate and it should not be relied upon as such.  All
information is subject to change without notice.

From wolski at molgen.mpg.de  Tue Sep  7 16:17:21 2004
From: wolski at molgen.mpg.de (Wolski)
Date: Tue Sep  7 16:17:28 2004
Subject: [Rd] as(object,"list")  as(object,"matrix") differences?
Message-ID: <200409071617210704.0504144D@mail.math.fu-berlin.de>

Hello!

as(object,"list") and as(object,"matrix") behave quite differently if it comes to their attributes.
I define two classes. One of them "contains" a "list" the other a "matrix"
setClass("myclass"
,representation(info="character")
,contains="matrix"
)
setClass("mylist"
,representation(info="character")
,contains="list"
)

#init
dd<-matrix(1:6,nrow=2)
rownames(dd)<-c("a","b")
tt<-new("myclass",dd)

tmp<-vector("list",4)
names(tmp)<-1:4
ll <- new("mylist",tmp,info="foo")

rownames(tt)
[1] "a" "b"
> rownames(as(tt,"matrix"))
[1] "a" "b"

> names(ll)
[1] "1" "2" "3" "4"
> names(as(ll,"list")) 
NULL
#but
names(ll@.Data)
The difference in behaviour to which i would like to point your attention is that as(object,"matrix") preserves the "dimnames" but at the same time as(object,"list") drops the "names" attribute.

Is it recomended not to use "contains" with old style classes?
Are there plans to provide standarized S4 versions/wrappers for list, matrix etc... classes?


/E

PS.
R : Copyright 2004, The R Foundation for Statistical Computing
Version 1.9.1 Patched (2004-08-30), ISBN 3-900051-00-3

From jmc at research.bell-labs.com  Tue Sep  7 16:34:46 2004
From: jmc at research.bell-labs.com (John Chambers)
Date: Tue Sep  7 16:35:01 2004
Subject: [Rd] package methods different behaviour R1.9.1 patched and R2.0.0
References: <200409070948060366.039FB48D@mail.math.fu-berlin.de>
Message-ID: <413DC706.AC82153C@research.bell-labs.com>

It's not possible to tell what you're expecting or actually seeing from
this mail.   We need to see your code and the results, not your
interpretation of how as() is implemented.

Meanwhile, here's how a simple class that extends "matrix" works in
2.0.0

With the code:

 setClass("mat1", representation(id="character"), contains = "matrix")

 mm <- matrix(1:12,3,4)

 mmm <- new("mat1", mm, id = "numeric")

The result is:

R> as(mmm, "vector")
 [1]  1  2  3  4  5  6  7  8  9 10 11 12

Class "vector" is one of the basic R classes;  as explained in ?as, the
methods for these use the exisiting as.<class> functions, as.vector in
this case.  

The result is indeed the same as coercing mmm to "matrix" first and then
to vector

R> as(as(mmm, "matrix"), "vector")
 [1]  1  2  3  4  5  6  7  8  9 10 11 12

as one would expect, but the method for coercing class "mat1" does not
go through "matrix":

R> selectMethod("coerce", c("mat1", "vector"))
function (from, to, strict = TRUE) 
{
    value <- as.vector(from)
    if (strict) 
        attributes(value) <- NULL
    value
}
<environment: namespace:methods>



Wolski wrote:
> 
> Hi!
> 
> Concerning different behaviour between 1.9.1 patched and:
> R : Copyright 2004, The R Foundation for Statistical Computing
> Version 2.0.0 Under development (unstable) (2004-09-06), ISBN 3-900051-07-0
> 
> Subtitle:
> as(x,"vector"); x is of class "Massvector"; never enters setAs("Massvector","vector"...
> 
> The same code:
> 
> as(mvl[[1]],"vector")
> causes under R1.9.1 to enter the function
> setAs("Massvector","vector"
>       ,function(from)
> ...
> 
> This never happens under R2.0.0.
> 
> The class "Massvector" contains class "Matrix"
> 
> A phenomenological description of what happens instead with R2.0.0 is
> 
> as(as(mvl[[1]],"Matrix"),"vector")
> 
> and its not what I would expect.
> 
> Is this an intended behaviour in R2.0.0?
> 
> /E
> 
> ______________________________________________
> R-devel@stat.math.ethz.ch mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
John M. Chambers                  
Bell Labs, Lucent Technologies    office: (908)582-2681
700 Mountain Avenue, Room 2C-282  fax:    (908)582-3340
Murray Hill, NJ  07974

From wolski at molgen.mpg.de  Tue Sep  7 16:58:25 2004
From: wolski at molgen.mpg.de (Wolski)
Date: Tue Sep  7 16:58:36 2004
Subject: [Rd] package methods different behaviour R1.9.1 patched and R2.0.0
In-Reply-To: <413DC706.AC82153C@research.bell-labs.com>
References: <200409070948060366.039FB48D@mail.math.fu-berlin.de>
	<413DC706.AC82153C@research.bell-labs.com>
Message-ID: <200409071658250266.06F4D29D@mail.math.fu-berlin.de>

Hello!

A simple example.

setClass("myclass"
,representation(info="character")
,contains="matrix"
)

setAs("myclass","vector"
,def=function(from)
{
	print("enters?")
	to<-summary(from[,1])
	to<-as.vector(to)
	to
}
)

#init
dd<-matrix(1:6,nrow=2)
rownames(dd)<-c("a","b")
tt<-new("myclass",dd)

class(tt)
as(tt,"vector")
summary(dd[,1])

What I expect.
R : Copyright 2004, The R Foundation for Statistical Computing
Version 1.9.1 Patched (2004-08-30), ISBN 3-900051-00-3

> class(tt)
[1] "myclass"
attr(,"package")
[1] ".GlobalEnv"
> as(tt,"vector")
[1] "enters?"
[1] 1.00 1.25 1.50 1.50 1.75 2.00
> summary(dd[,1])
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   1.00    1.25    1.50    1.50    1.75    2.00 


R : Copyright 2004, The R Foundation for Statistical Computing
Version 2.0.0 Under development (unstable) (2004-09-06), ISBN 3-900051-07-0

> class(tt)
[1] "myclass"
attr(,"package")
[1] ".GlobalEnv"
> as(tt,"vector")
[1] 1 2 3 4 5 6
> summary(dd[,1])
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   1.00    1.25    1.50    1.50    1.75    2.00 

Yours
Eryk




*********** REPLY SEPARATOR  ***********

On 9/7/2004 at 10:34 AM John Chambers wrote:

>>>It's not possible to tell what you're expecting or actually seeing
>>>from
>>>this mail.   We need to see your code and the results, not your
>>>interpretation of how as() is implemented.
>>>
>>>Meanwhile, here's how a simple class that extends "matrix" works in
>>>2.0.0
>>>
>>>With the code:
>>>
>>> setClass("mat1", representation(id="character"), contains = "matrix")
>>>
>>> mm <- matrix(1:12,3,4)
>>>
>>> mmm <- new("mat1", mm, id = "numeric")
>>>
>>>The result is:
>>>
>>>R> as(mmm, "vector")
>>> [1]  1  2  3  4  5  6  7  8  9 10 11 12
>>>
>>>Class "vector" is one of the basic R classes;  as explained in ?as, the
>>>methods for these use the exisiting as.<class> functions, as.vector in
>>>this case.  
>>>
>>>The result is indeed the same as coercing mmm to "matrix" first and then
>>>to vector
>>>
>>>R> as(as(mmm, "matrix"), "vector")
>>> [1]  1  2  3  4  5  6  7  8  9 10 11 12
>>>
>>>as one would expect, but the method for coercing class "mat1" does not
>>>go through "matrix":
>>>
>>>R> selectMethod("coerce", c("mat1", "vector"))
>>>function (from, to, strict = TRUE) 
>>>{
>>>    value <- as.vector(from)
>>>    if (strict) 
>>>        attributes(value) <- NULL
>>>    value
>>>}
>>><environment: namespace:methods>
>>>
>>>
>>>
>>>Wolski wrote:
>>>> 
>>>> Hi!
>>>> 
>>>> Concerning different behaviour between 1.9.1 patched and:
>>>> R : Copyright 2004, The R Foundation for Statistical Computing
>>>> Version 2.0.0 Under development (unstable) (2004-09-06), ISBN
>>>3-900051-07-0
>>>> 
>>>> Subtitle:
>>>> as(x,"vector"); x is of class "Massvector"; never enters
>>>setAs("Massvector","vector"...
>>>> 
>>>> The same code:
>>>> 
>>>> as(mvl[[1]],"vector")
>>>> causes under R1.9.1 to enter the function
>>>> setAs("Massvector","vector"
>>>>       ,function(from)
>>>> ...
>>>> 
>>>> This never happens under R2.0.0.
>>>> 
>>>> The class "Massvector" contains class "Matrix"
>>>> 
>>>> A phenomenological description of what happens instead with R2.0.0 is
>>>> 
>>>> as(as(mvl[[1]],"Matrix"),"vector")
>>>> 
>>>> and its not what I would expect.
>>>> 
>>>> Is this an intended behaviour in R2.0.0?
>>>> 
>>>> /E
>>>> 
>>>> ______________________________________________
>>>> R-devel@stat.math.ethz.ch mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>>-- 
>>>John M. Chambers                  
>>>Bell Labs, Lucent Technologies    office: (908)582-2681
>>>700 Mountain Avenue, Room 2C-282  fax:    (908)582-3340
>>>Murray Hill, NJ  07974



Dipl. bio-chem. Witold Eryk Wolski             @         MPI-Moleculare Genetic   
Ihnestrasse 63-73 14195 Berlin                'v'    
tel: 0049-30-83875219                        /   \       
mail: witek96@users.sourceforge.net        ---W-W----    http://www.molgen.mpg.de/~wolski 
      wolski@molgen.mpg.de

From jmc at research.bell-labs.com  Tue Sep  7 17:47:24 2004
From: jmc at research.bell-labs.com (John Chambers)
Date: Tue Sep  7 17:47:43 2004
Subject: [Rd] as(object,"list")  as(object,"matrix") differences?
References: <200409071617210704.0504144D@mail.math.fu-berlin.de>
Message-ID: <413DD80C.2D5EA9C9@research.bell-labs.com>

Yes, there are differences, and you should expect some. 

That as(object, "matrix") preserves dimnames is hardly an accident,
since dimnames are part of the definition of a matrix.

as(object, "list") works like all coercion to basic datatypes.  The
method uses the corresponding old-style as.<class> function.  In
addition, if coercion is strict, all attributes are removed. See ?as.

The effect of this is that names would be removed, unless you used
as(object, "list", strict=FALSE).  (The coerce in dispatching methods is
NOT strict, so a method for class "list" would see the names.)

This is consistent behavior, but yes, the elimination of names may be
surprising.  It's possible that future versions might treat names
differently from other attributes, but there would need to be a strong
argument.

The workaround is to define a new class that trivially extends "list",
and then define classes to extend that instead:

 setClass("listWithNames", "list")

Then if x is an object from a class defined with
contains="listWithNames", rather than contains="list",
  as(x, "listWithNames")
would preserve names.

The problem here is that the definition of class (or dataype) "list" was
never very clear as to whether names were an attribute or part of the
datatype.  The green book and S-Plus take the view that lists are just
vectors, and the current R implementation follows that interpretation.

(There is also in S-Plus a different class, "named", specifically for
the applications that lists with names typically deal with.  But the
spirit of that class is NOT equivalent to lists with a names attribute.)

As for extending basic datatypes by S4 classes, that's generally OK,
provided you understand the consequences (pages 314-316 of the green
book have a brief discussion).

And as for "wrapper" classes, there are no immediate plans.  The basic
datatypes do have class definitions:

R> getClass("list")

No Slots, prototype of class "list"

Extends: "vector"

The main candidates for wrapper classes are "matrix" and "array", since
these do not have a fixed set of attributes (they may or may not have
"dimnames").  Class "ts" is already a formal class.

John Chambers

Wolski wrote:
> 
> Hello!
> 
> as(object,"list") and as(object,"matrix") behave quite differently if it comes to their attributes.
> I define two classes. One of them "contains" a "list" the other a "matrix"
> setClass("myclass"
> ,representation(info="character")
> ,contains="matrix"
> )
> setClass("mylist"
> ,representation(info="character")
> ,contains="list"
> )
> 
> #init
> dd<-matrix(1:6,nrow=2)
> rownames(dd)<-c("a","b")
> tt<-new("myclass",dd)
> 
> tmp<-vector("list",4)
> names(tmp)<-1:4
> ll <- new("mylist",tmp,info="foo")
> 
> rownames(tt)
> [1] "a" "b"
> > rownames(as(tt,"matrix"))
> [1] "a" "b"
> 
> > names(ll)
> [1] "1" "2" "3" "4"
> > names(as(ll,"list"))
> NULL
> #but
> names(ll@.Data)
> The difference in behaviour to which i would like to point your attention is that as(object,"matrix") preserves the "dimnames" but at the same time as(object,"list") drops the "names" attribute.
> 
> Is it recomended not to use "contains" with old style classes?
> Are there plans to provide standarized S4 versions/wrappers for list, matrix etc... classes?
> 
> /E
> 
> PS.
> R : Copyright 2004, The R Foundation for Statistical Computing
> Version 1.9.1 Patched (2004-08-30), ISBN 3-900051-00-3
> 
> ______________________________________________
> R-devel@stat.math.ethz.ch mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
John M. Chambers                  jmc@bell-labs.com
Bell Labs, Lucent Technologies    office: (908)582-2681
700 Mountain Avenue, Room 2C-282  fax:    (908)582-3340
Murray Hill, NJ  07974            web: http://www.cs.bell-labs.com/~jmc

From wolski at molgen.mpg.de  Tue Sep  7 18:00:17 2004
From: wolski at molgen.mpg.de (Wolski)
Date: Tue Sep  7 18:00:32 2004
Subject: [Rd] as(object,"list")  as(object,"matrix") differences?
In-Reply-To: <413DD80C.2D5EA9C9@research.bell-labs.com>
References: <200409071617210704.0504144D@mail.math.fu-berlin.de>
	<413DD80C.2D5EA9C9@research.bell-labs.com>
Message-ID: <200409071800170388.072D7640@mail.math.fu-berlin.de>


Thank you very much.


Sincerely yours
Eryk.



Dipl. bio-chem. Witold Eryk Wolski             @         MPI-Moleculare Genetic   
Ihnestrasse 63-73 14195 Berlin                'v'    
tel: 0049-30-83875219                        /   \       
mail: witek96@users.sourceforge.net        ---W-W----    http://www.molgen.mpg.de/~wolski 
      wolski@molgen.mpg.de

From jmc at research.bell-labs.com  Tue Sep  7 19:41:21 2004
From: jmc at research.bell-labs.com (John Chambers)
Date: Tue Sep  7 19:41:39 2004
Subject: [Rd] package methods different behaviour R1.9.1 patchedand R2.0.0
References: <200409070948060366.039FB48D@mail.math.fu-berlin.de>
	<413DC706.AC82153C@research.bell-labs.com>
	<200409071658250266.06F4D29D@mail.math.fu-berlin.de>
Message-ID: <413DF2C1.FAFAA30E@research.bell-labs.com>

Wolski wrote:
> 
> Hello!
> 
> A simple example.
> 
> setClass("myclass"
> ,representation(info="character")
> ,contains="matrix"
> )
> 
> setAs("myclass","vector"
> ,def=function(from)
> {
>         print("enters?")
>         to<-summary(from[,1])
>         to<-as.vector(to)
>         to
> }
> )
> 
> #init
> dd<-matrix(1:6,nrow=2)
> rownames(dd)<-c("a","b")
> tt<-new("myclass",dd)
> 
> class(tt)
> as(tt,"vector")
> summary(dd[,1])

Good example.  Thanks.  This was a bug in setAs() that did not set the
coerce method in the case of overriding the default method for a
contained class.  There should be a fix installed in a day or two.



> 
> What I expect.
> R : Copyright 2004, The R Foundation for Statistical Computing
> Version 1.9.1 Patched (2004-08-30), ISBN 3-900051-00-3
> 
> > class(tt)
> [1] "myclass"
> attr(,"package")
> [1] ".GlobalEnv"
> > as(tt,"vector")
> [1] "enters?"
> [1] 1.00 1.25 1.50 1.50 1.75 2.00
> > summary(dd[,1])
>    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.
>    1.00    1.25    1.50    1.50    1.75    2.00
> 
> R : Copyright 2004, The R Foundation for Statistical Computing
> Version 2.0.0 Under development (unstable) (2004-09-06), ISBN 3-900051-07-0
> 
> > class(tt)
> [1] "myclass"
> attr(,"package")
> [1] ".GlobalEnv"
> > as(tt,"vector")
> [1] 1 2 3 4 5 6
> > summary(dd[,1])
>    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.
>    1.00    1.25    1.50    1.50    1.75    2.00
> 
> Yours
> Eryk
> 
> *********** REPLY SEPARATOR  ***********
> 
> On 9/7/2004 at 10:34 AM John Chambers wrote:
> 
> >>>It's not possible to tell what you're expecting or actually seeing
> >>>from
> >>>this mail.   We need to see your code and the results, not your
> >>>interpretation of how as() is implemented.
> >>>
> >>>Meanwhile, here's how a simple class that extends "matrix" works in
> >>>2.0.0
> >>>
> >>>With the code:
> >>>
> >>> setClass("mat1", representation(id="character"), contains = "matrix")
> >>>
> >>> mm <- matrix(1:12,3,4)
> >>>
> >>> mmm <- new("mat1", mm, id = "numeric")
> >>>
> >>>The result is:
> >>>
> >>>R> as(mmm, "vector")
> >>> [1]  1  2  3  4  5  6  7  8  9 10 11 12
> >>>
> >>>Class "vector" is one of the basic R classes;  as explained in ?as, the
> >>>methods for these use the exisiting as.<class> functions, as.vector in
> >>>this case.
> >>>
> >>>The result is indeed the same as coercing mmm to "matrix" first and then
> >>>to vector
> >>>
> >>>R> as(as(mmm, "matrix"), "vector")
> >>> [1]  1  2  3  4  5  6  7  8  9 10 11 12
> >>>
> >>>as one would expect, but the method for coercing class "mat1" does not
> >>>go through "matrix":
> >>>
> >>>R> selectMethod("coerce", c("mat1", "vector"))
> >>>function (from, to, strict = TRUE)
> >>>{
> >>>    value <- as.vector(from)
> >>>    if (strict)
> >>>        attributes(value) <- NULL
> >>>    value
> >>>}
> >>><environment: namespace:methods>
> >>>
> >>>
> >>>
> >>>Wolski wrote:
> >>>>
> >>>> Hi!
> >>>>
> >>>> Concerning different behaviour between 1.9.1 patched and:
> >>>> R : Copyright 2004, The R Foundation for Statistical Computing
> >>>> Version 2.0.0 Under development (unstable) (2004-09-06), ISBN
> >>>3-900051-07-0
> >>>>
> >>>> Subtitle:
> >>>> as(x,"vector"); x is of class "Massvector"; never enters
> >>>setAs("Massvector","vector"...
> >>>>
> >>>> The same code:
> >>>>
> >>>> as(mvl[[1]],"vector")
> >>>> causes under R1.9.1 to enter the function
> >>>> setAs("Massvector","vector"
> >>>>       ,function(from)
> >>>> ...
> >>>>
> >>>> This never happens under R2.0.0.
> >>>>
> >>>> The class "Massvector" contains class "Matrix"
> >>>>
> >>>> A phenomenological description of what happens instead with R2.0.0 is
> >>>>
> >>>> as(as(mvl[[1]],"Matrix"),"vector")
> >>>>
> >>>> and its not what I would expect.
> >>>>
> >>>> Is this an intended behaviour in R2.0.0?
> >>>>
> >>>> /E
> >>>>
> >>>> ______________________________________________
> >>>> R-devel@stat.math.ethz.ch mailing list
> >>>> https://stat.ethz.ch/mailman/listinfo/r-devel
> >>>
> >>>--
> >>>John M. Chambers
> >>>Bell Labs, Lucent Technologies    office: (908)582-2681
> >>>700 Mountain Avenue, Room 2C-282  fax:    (908)582-3340
> >>>Murray Hill, NJ  07974
> 
> Dipl. bio-chem. Witold Eryk Wolski             @         MPI-Moleculare Genetic
> Ihnestrasse 63-73 14195 Berlin                'v'
> tel: 0049-30-83875219                        /   \
> mail: witek96@users.sourceforge.net        ---W-W----    http://www.molgen.mpg.de/~wolski
>       wolski@molgen.mpg.de

-- 
John M. Chambers                  jmc@bell-labs.com
Bell Labs, Lucent Technologies    office: (908)582-2681
700 Mountain Avenue, Room 2C-282  fax:    (908)582-3340
Murray Hill, NJ  07974            web: http://www.cs.bell-labs.com/~jmc

From p.dalgaard at biostat.ku.dk  Wed Sep  8 00:34:23 2004
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Wed Sep  8 00:34:46 2004
Subject: [Rd] A couple of issues with colClasses/setAs
Message-ID: <x2hdq9vhcg.fsf@biostat.ku.dk>

Consider this:

$ cat test.dat
1 a
2 b

Now, we want to read the 2nd column as a factor and ignore the first
(since it's just a sequential ID). We can't just put "factor" among
the colClasses (would have been nice), so let's try this instead

> setAs("character","factor",as.factor)
Arguments in definition changed from (x) to (from)
> read.table("test.dat",colClasses=c("numeric","factor"))
Error in inherits(x, "factor") : Object "x" not found

which is a bit peculiar: Why does it change the argument when that's
going to create a function that doesn't work?? You do need to spell it
out:

> setAs("character","factor",function(from)as.factor(from))

And now we get somewhere

> read.table("test.dat",colClasses=c("numeric","factor"))
  V1 V2
1  1  a
2  2  b

but suppose we want to get rid of col.1:

> read.table("test.dat",colClasses=c("NULL","factor"))
Error in data[[i]] : subscript out of bounds

which looks like a pretty clear bug. In contrast, this works fine

> read.table("test.dat",colClasses=c("NULL","character"))
  V2
1  a
2  b

so the issue only arises when you have nontrivial coercions.

Presumably, the issue is that the colClasses in those cases
miscalculate indices by forgetting the columns that were skipped.

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

From Mark.Bravington at csiro.au  Wed Sep  8 03:01:25 2004
From: Mark.Bravington at csiro.au (Mark.Bravington@csiro.au)
Date: Wed Sep  8 03:01:31 2004
Subject: [Rd] having trouble building r-devel
Message-ID: <C4178DC99E08604EA5E2BDB989F093800240A331@extas2-hba.tas.csiro.au>

Dear R-devel

On my Windows 2000 machine, I can build R-patched but not R-devel (since at least 1/9/2004). An error message pops up during the execution of some R code during "make", as below. In terms of "make" etc., I am totally clueless (not being a user of either Linux or C) and just mechanically follow the instructions in the R documentation; hence I've got no idea what to do when things snarf.

More information below. Any advice appreciated-- I'm trying to test a patch for R2.0.0.

Mark

Background factoids:

1. The tools.zip file that I use is dated 9/5/2003.

2. I did expunge the R-devel directory before unzipping the .tar.gz and building.

3. I made my usual 2 changes to default MkRules (WINHELP=NO and TCL_HOME=C:/R/Tcl).

4. I don't have the Latex "bin" directory in the search path, contrary to src/gnuwin32/INSTALL-- but this hasn't been a problem in the past. With R-patched (and all the previous R versions I've built), I do get some errors/warnings about pdflatex not found but the build continues and the .exe files get created just fine.

Here's what happens leading up to the error:

C:\R\R-devel\src\gnuwin32> make

<< no worrying messages>>

  making bootstrap versions of packages ...
  -- base
  -- tools
  making DLL ...

<< no worrying messages >>

  ... DLL made
  installing DLL
  ... done
cp ../../doc/html/R.css ../../library/R.css

writing help indices for package: base tools utils grDevices graphics stats datasets methods grid sp
lines stats4 tcltk

---------- Making package base ------------
  adding build stamp to DESCRIPTION
Error in get(x, envir, mode, inherits) : variable ".install_package_description" was not found
Execution halted
make[4]: *** [frontmatter] Error 1
make[3]: *** [all] Error 2
make[2]: *** [pkg-base] Error 2
make[1]: *** [rpackage] Error 2
make: *** [all] Error 2



*******************************

Mark Bravington
CSIRO (CMIS)
PO Box 1538
Castray Esplanade
Hobart
TAS 7001

phone (61) 3 6232 5118
fax (61) 3 6232 5012
Mark.Bravington@csiro.au

From murdoch at stats.uwo.ca  Wed Sep  8 04:25:09 2004
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Wed Sep  8 04:25:19 2004
Subject: [Rd] having trouble building r-devel
In-Reply-To: <C4178DC99E08604EA5E2BDB989F093800240A331@extas2-hba.tas.csiro.au>
References: <C4178DC99E08604EA5E2BDB989F093800240A331@extas2-hba.tas.csiro.au>
Message-ID: <j4rsj05u66pa2iqs6v3fdcgp51uasaf56a@4ax.com>

On Wed, 8 Sep 2004 11:01:25 +1000, <Mark.Bravington@csiro.au> wrote:

>Dear R-devel
>
>On my Windows 2000 machine, I can build R-patched but not R-devel (since at least 1/9/2004). An error message pops up during the execution of some R code during "make", as below. In terms of "make" etc., I am totally clueless (not being a user of either Linux or C) and just mechanically follow the instructions in the R documentation; hence I've got no idea what to do when things snarf.
>
>More information below. Any advice appreciated-- I'm trying to test a patch for R2.0.0.

I haven't seen the error you report, but the general strategy on
seeing a make error is to "make distclean", and try again.

If that doesn't work, it might be worth checking your Perl version:  R
2.0.0 seems to need 5.8.x.  Previously this was just recommended, and
I ran on 5.6.x until very recently.  I thought I had updated the
Rtools page (www.murdoch-sutherland.com/Rtools) to say this, but
looking just now shows the old page...

Duncan Murdoch

From edd at debian.org  Wed Sep  8 05:25:37 2004
From: edd at debian.org (Dirk Eddelbuettel)
Date: Wed Sep  8 05:25:51 2004
Subject: [Rd] First R-2.0.0 alpha version
In-Reply-To: <x21xhfra88.fsf@biostat.ku.dk>
References: <x21xhfra88.fsf@biostat.ku.dk>
Message-ID: <20040908032537.GA4065@sonny.eddelbuettel.com>

On Mon, Sep 06, 2004 at 11:57:11AM +0200, Peter Dalgaard wrote:
> We're warming up to the release of R-2.0.0 on Oct. 4 (aka 2004-10-04).
[...]
> Please make sure to test the tarballs, building from rsync or SVN
> checkouts is not quite the same thing.

This alpha release of 2.0.0 built like a charm for me yesterday, and also
runs fine. I did not upload it to Debian as a recent rebuilt of 1.9.1 needs
to migrate from 'unstable' to 'testing' first. 

Once that migration is done, I may upload alpha releases of R 2.0.0.  Or
maybe I'll wait for the beta releases as I also need a working R in unstable
to maintain the various packages of CRAN packages. Need to ponder that some
more.

If there is interest, I can make the R 2.0.0 test packages available
somewhere.

Dirk

-- 
Those are my principles, and if you don't like them... well, I have others.
                                                -- Groucho Marx

From sjekkAlderOgPeker at met.no  Wed Sep  8 07:55:40 2004
From: sjekkAlderOgPeker at met.no (sjekkAlderOgPeker@met.no)
Date: Wed Sep  8 07:55:43 2004
Subject: [Rd] Feil i websider (PR#7216)
Message-ID: <20040908055540.EB0A210E98@slim.kubism.ku.dk>


Warnings about /metno/internweb/fouweb/htdocs/teknisk/verktoy/R/faq.html

	BAD LINK: http://stat.ethz.ch/R/manual/
	BAD LINK: http://nlme.stat.wisc.edu/MEMSS/
	BAD LINK: http://stats.mth.uea.ac.uk/Rcgi/
	BAD LINK: http://software.biostat.washington.edu/statsoft/ess/

------------------------------------------------------------
Warnings about /metno/internweb/fouweb/htdocs/teknisk/verktoy/R/resources.html

	BAD LINK: http://fou.oslo.dnmi.no/teknisk/verktoy/R/r-announce@lists.r-project.org
	BAD LINK: http://fou.oslo.dnmi.no/teknisk/verktoy/R/r-help@lists.r-project.org
	BAD LINK: http://fou.oslo.dnmi.no/teknisk/verktoy/R/r-devel@lists.r-project.org
	BAD LINK: http://fou.oslo.dnmi.no/teknisk/verktoy/R/r-announce-request@lists.r-project.org
	BAD LINK: http://fou.oslo.dnmi.no/teknisk/verktoy/R/r-help-request@lists.r-project.org
	BAD LINK: http://fou.oslo.dnmi.no/teknisk/verktoy/R/r-devel-request@lists.r-project.org
	BAD LINK: http://mirror.aarnet.edu.au/pub/CRAN/
	BAD LINK: http://mirrors.theonlinerecordstore.com/CRAN/

From Mark.Bravington at csiro.au  Wed Sep  8 08:24:19 2004
From: Mark.Bravington at csiro.au (Mark.Bravington@csiro.au)
Date: Wed Sep  8 08:24:24 2004
Subject: [Rd] having trouble building r-devel
Message-ID: <C4178DC99E08604EA5E2BDB989F093800240A334@extas2-hba.tas.csiro.au>

Hi Duncan

Thanks but... that doesn't seem to be it. I've upgraded Perl to 5.8 and the problem is still there.

The error seems to be this: the "make" operation in R2.0.0 wants to use the *just-built* R.exe in the search path when it gets to the "Making package base" stage. But unless the user has modified their search path to include R-DEVEL\BIN before calling "make" (and made sure this comes before any other R BIN directories), the R.exe won't be found (on my Windows 2000 machine, anyway). I encountered the following:

When I set PATH to start with C:\R\R-devel\bin, "make" works OK.

When I leave PATH at its usual value that starts with C:\R\R-1.9.0\bin, "make" gives me this:

---------- Making package base ------------
  adding build stamp to DESCRIPTION
Error in get(x, envir, mode, inherits) : variable ".install_package_description" was not found
Execution halted

When I rename C:\R\R-1.9.0 so that there's no copy of R.exe in the PATH, "make" gave me this:

---------- Making package base ------------
  adding build stamp to DESCRIPTION
R: not found

When I set PATH to start with a dot (looking at the INSTALL file section on "Check your path"), "make" fails again with the ".install_package_description" error.

So it looks like either (i) the documentation should be changed to tell the user to reset the path manually (and NB the dot isn't useful for Windows 2000), or preferably (ii) "make" needs to temporarily change the search path, or to look more explicitly for the new R.exe file. Or I've gotten my wires crossed...

Mark

*******************************

Mark Bravington
CSIRO (CMIS)
PO Box 1538
Castray Esplanade
Hobart
TAS 7001

phone (61) 3 6232 5118
fax (61) 3 6232 5012
Mark.Bravington@csiro.au 

#-----Original Message-----
#From: Duncan Murdoch [mailto:murdoch@stats.uwo.ca]
#Sent: Wednesday, 8 September 2004 12:25 PM
#To: Bravington, Mark (CMIS, Hobart)
#Cc: r-devel@stat.math.ethz.ch
#Subject: Re: [Rd] having trouble building r-devel
#
#
#On Wed, 8 Sep 2004 11:01:25 +1000, <Mark.Bravington@csiro.au> wrote:
#
#>Dear R-devel
#>
#>On my Windows 2000 machine, I can build R-patched but not 
#R-devel (since at least 1/9/2004). An error message pops up 
#during the execution of some R code during "make", as below. 
#In terms of "make" etc., I am totally clueless (not being a 
#user of either Linux or C) and just mechanically follow the 
#instructions in the R documentation; hence I've got no idea 
#what to do when things snarf.
#>
#>More information below. Any advice appreciated-- I'm trying 
#to test a patch for R2.0.0.
#
#I haven't seen the error you report, but the general strategy on
#seeing a make error is to "make distclean", and try again.
#
#If that doesn't work, it might be worth checking your Perl version:  R
#2.0.0 seems to need 5.8.x.  Previously this was just recommended, and
#I ran on 5.6.x until very recently.  I thought I had updated the
#Rtools page (www.murdoch-sutherland.com/Rtools) to say this, but
#looking just now shows the old page...
#
#Duncan Murdoch
#

From ripley at stats.ox.ac.uk  Wed Sep  8 08:48:13 2004
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed Sep  8 08:48:24 2004
Subject: [Rd] having trouble building r-devel
In-Reply-To: <C4178DC99E08604EA5E2BDB989F093800240A334@extas2-hba.tas.csiro.au>
Message-ID: <Pine.LNX.4.44.0409080737361.26351-100000@gannet.stats>

On Wed, 8 Sep 2004 Mark.Bravington@csiro.au wrote:

> When I set PATH to start with a dot (looking at the INSTALL file section
> on "Check your path"), "make" fails again with the
> ".install_package_description" error.
> 
> So it looks like either (i) the documentation should be changed to tell
> the user to reset the path manually (and NB the dot isn't useful for
> Windows 2000), 

It was when I ran Windows 2000.  What's wrong for you?

> or preferably (ii) "make" needs to temporarily change the
> search path, or to look more explicitly for the new R.exe file. Or I've
> gotten my wires crossed...

The latter.  Try commenting out

# path (possibly full path) to same version of R on the host system
# R_EXE=R
^^

in MkRules.  It's uncommented there from experiments with cross-compiling.
Works for me.

BTW, getting R-devel to cross-compile has been a nightmare, but has been 
achieved.

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From ligges at statistik.uni-dortmund.de  Wed Sep  8 08:49:54 2004
From: ligges at statistik.uni-dortmund.de (Uwe Ligges)
Date: Wed Sep  8 08:48:40 2004
Subject: [Rd] argument srt for mtext();
 was: [R] using text on the x axis ticks rather than numbers
In-Reply-To: <Pine.GSO.4.31.0409072220370.16358-100000@toucan.stats>
References: <Pine.GSO.4.31.0409072220370.16358-100000@toucan.stats>
Message-ID: <413EAB92.3060506@statistik.uni-dortmund.de>

Prof Brian Ripley wrote:
> On Tue, 7 Sep 2004, Adaikalavan Ramasamy wrote:
> 
> 
>>Out of curiosity, why is srt not respected in mtext ? See examples below
> 
> 
> It doesn't make a lot of sense.  mtext is about putting text on >m<argin
> lines, and even the ability to have text perpendicular to the axis (via
> las) is rather awkward to interpret (and the interpretation will be
> changed in 2.0.0).  If you are going to rotate text you need to able to
> specify a point of rotation and that's much easier via text.
> 
> 
>>It would be nice to have 'srt' as an argument in mtext in future.
> 
> 
> You haven't been listening to the discussions pre-2.0.0 on the semantics
> of `adj' (and now padj as well) in mtext.  Experts seem to find it hard to
> keep even the two current cases (parallel and perpendicular) clear in
> their minds.


[moved to R-devel]

The discussions took place on R-devel, hence some people might not have 
noticed them.

Indeed, I think it is possible to provide an srt command (e.g. in half a 
year for something like R-2.1.0). What is expected for "srt = 0"?
a) the current behaviour, i.e. srt=0 in respect to the las setting *and* 
the margin side to plot the text in, or
b) always horizontally drawn text?

I'd vote for b).

Uwe


> BTW, if you want to use srt with mtext(at=) you can always use S ....
>

From ripley at stats.ox.ac.uk  Wed Sep  8 08:57:46 2004
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed Sep  8 08:57:56 2004
Subject: [Rd] 
 Re: argument srt for mtext(); was: [R] using text on the x axis
 ticks rather than numbers
In-Reply-To: <413EAB92.3060506@statistik.uni-dortmund.de>
Message-ID: <Pine.LNX.4.44.0409080749240.26351-100000@gannet.stats>

On Wed, 8 Sep 2004, Uwe Ligges wrote:

> Prof Brian Ripley wrote:
> > On Tue, 7 Sep 2004, Adaikalavan Ramasamy wrote:
> > 
> > 
> >>Out of curiosity, why is srt not respected in mtext ? See examples below
> > 
> > 
> > It doesn't make a lot of sense.  mtext is about putting text on >m<argin
> > lines, and even the ability to have text perpendicular to the axis (via
> > las) is rather awkward to interpret (and the interpretation will be
> > changed in 2.0.0).  If you are going to rotate text you need to able to
> > specify a point of rotation and that's much easier via text.
> > 
> > 
> >>It would be nice to have 'srt' as an argument in mtext in future.
> > 
> > 
> > You haven't been listening to the discussions pre-2.0.0 on the semantics
> > of `adj' (and now padj as well) in mtext.  Experts seem to find it hard to
> > keep even the two current cases (parallel and perpendicular) clear in
> > their minds.
> 
> 
> [moved to R-devel]
> 
> The discussions took place on R-devel, hence some people might not have 
> noticed them.

Yes, and that's why they `haven't been listening to' them.

> Indeed, I think it is possible to provide an srt command (e.g. in half a 
> year for something like R-2.1.0). What is expected for "srt = 0"?
> a) the current behaviour, i.e. srt=0 in respect to the las setting *and* 
> the margin side to plot the text in, or
> b) always horizontally drawn text?
> 
> I'd vote for b).

That's easy, see the precedent in

> > BTW, if you want to use srt with mtext(at=) you can always use S ....

S ignores las if at= is set, so srt=0 is the current default behaviour.

Where exactly do you rotate about?  I suspect people want the corner 
nearest the axis for near-perpendicular text.  Corner of what?  Probably 
not the actual bounding box but some nomimal bounding box for the font.

Remember the default centring is different for parallel and perpendicular 
text, so what should it be for 45^o text?

I have quite a bit of experience with using S's mtext with srt, and it is 
hard to use well (and very hard to document).

Brian 

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From ripley at stats.ox.ac.uk  Wed Sep  8 09:17:31 2004
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed Sep  8 09:17:34 2004
Subject: [Rd]  Re: argument srt for mtext(); was: [R] using text on the
	x axis ticks rather than numbers
In-Reply-To: <Pine.LNX.4.44.0409080749240.26351-100000@gannet.stats>
Message-ID: <Pine.LNX.4.44.0409080811230.26528-100000@gannet.stats>

On Wed, 8 Sep 2004, Prof Brian Ripley wrote:

> On Wed, 8 Sep 2004, Uwe Ligges wrote:

[...]

> > Indeed, I think it is possible to provide an srt command (e.g. in half a 
> > year for something like R-2.1.0). What is expected for "srt = 0"?
> > a) the current behaviour, i.e. srt=0 in respect to the las setting *and* 
> > the margin side to plot the text in, or
> > b) always horizontally drawn text?
> > 
> > I'd vote for b).
> 
> That's easy, see the precedent in
> 
> > > BTW, if you want to use srt with mtext(at=) you can always use S ....
> 
> S ignores las if at= is set, so srt=0 is the current default behaviour.

Sorry, I garbled that.  In S, srt=0 is horizontal whatever side=, and las
is always ignored.  Not that that is documented AFAICS, and it is hard to
remember ....

[...]

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From Mark.Bravington at csiro.au  Wed Sep  8 09:44:30 2004
From: Mark.Bravington at csiro.au (Mark.Bravington@csiro.au)
Date: Wed Sep  8 09:44:40 2004
Subject: [Rd] having trouble building r-devel
Message-ID: <C4178DC99E08604EA5E2BDB989F093800240A335@extas2-hba.tas.csiro.au>

Aha-- thanks!

>> Or I've
>> gotten my wires crossed...
>
>The latter.  Try commenting out
>
># path (possibly full path) to same version of R on the host system
># R_EXE=R
>^^
>
>in MkRules.  It's uncommented there from experiments with 
>cross-compiling.
>Works for me.

Yes, it's just worked for me too. Is it worth mentioning this in the INSTALL file after the sentence that says "IMPORTANT: edit MkRules to set the appropriate paths..."? [It may be that all my builds hitherto have actually invoked an earlier version of R than the one being built, but that this never mattered before.]

> 
>> So it looks like either (i) the documentation should be 
>changed to tell
>> the user to reset the path manually (and NB the dot isn't useful for
>> Windows 2000), 
>
>It was when I ran Windows 2000.  What's wrong for you?

Just that, at the moment of running "make", the dot refers to src\gnuwin32, which doesn't pick up the R.exe file. With the commenting-out above, "make" now works fine for me now whether or not PATH starts with a dot. [I thought MS-DOS implicitly put a dot in, i.e. doesn't it always look for EXEs and BATs in the current directory first?] I think I need to start the path with <<current-R-version>>\bin  rather than dot.

>-- 
>Brian D. Ripley,                  ripley@stats.ox.ac.uk
>Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
>University of Oxford,             Tel:  +44 1865 272861 (self)
>1 South Parks Road,                     +44 1865 272866 (PA)
>Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>

*******************************

Mark Bravington
CSIRO (CMIS)
PO Box 1538
Castray Esplanade
Hobart
TAS 7001

phone (61) 3 6232 5118
fax (61) 3 6232 5012
Mark.Bravington@csir

From ripley at stats.ox.ac.uk  Wed Sep  8 09:59:42 2004
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed Sep  8 09:59:51 2004
Subject: [Rd] having trouble building r-devel
In-Reply-To: <C4178DC99E08604EA5E2BDB989F093800240A335@extas2-hba.tas.csiro.au>
Message-ID: <Pine.LNX.4.44.0409080854001.5645-100000@gannet.stats>

On Wed, 8 Sep 2004 Mark.Bravington@csiro.au wrote:

> Aha-- thanks!
> 
> >> Or I've
> >> gotten my wires crossed...
> >
> >The latter.  Try commenting out
> >
> ># path (possibly full path) to same version of R on the host system
> ># R_EXE=R
> >^^
> >
> >in MkRules.  It's uncommented there from experiments with 
> >cross-compiling.
> >Works for me.
> 
> Yes, it's just worked for me too. Is it worth mentioning this in the
> INSTALL file after the sentence that says "IMPORTANT: edit MkRules to
> set the appropriate paths..."? [It may be that all my builds hitherto
> have actually invoked an earlier version of R than the one being built,
> but that this never mattered before.]

It's new in R-devel (part of the attempt to make cross-building more
maintainable).  It's a mistake in the archive and it will be commented out
come the final release barring snafus.

> >> So it looks like either (i) the documentation should be 
> >changed to tell
> >> the user to reset the path manually (and NB the dot isn't useful for
> >> Windows 2000), 
> >
> >It was when I ran Windows 2000.  What's wrong for you?
> 
> Just that, at the moment of running "make", the dot refers to
> src\gnuwin32, which doesn't pick up the R.exe file. With the
> commenting-out above, "make" now works fine for me now whether or not
> PATH starts with a dot. [I thought MS-DOS implicitly put a dot in, i.e.
> doesn't it always look for EXEs and BATs in the current directory
> first?] I think I need to start the path with <<current-R-version>>\bin
> rather than dot.

The shell is not often `MS-DOS' (command.com): e.g. I use tcsh, DJM uses
bash and Windows Xp uses cmd.exe.  The first two do not look in the
current directory by default, and so do need `.' in the path to find e.g. 
Rpwd.exe.

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From ligges at statistik.uni-dortmund.de  Wed Sep  8 10:13:27 2004
From: ligges at statistik.uni-dortmund.de (Uwe Ligges)
Date: Wed Sep  8 10:12:10 2004
Subject: [Rd]  Re: argument srt for mtext(); was: [R] using text on the
	x axis ticks rather than numbers
In-Reply-To: <Pine.LNX.4.44.0409080811230.26528-100000@gannet.stats>
References: <Pine.LNX.4.44.0409080811230.26528-100000@gannet.stats>
Message-ID: <413EBF27.7090105@statistik.uni-dortmund.de>

Prof Brian Ripley wrote:

> On Wed, 8 Sep 2004, Prof Brian Ripley wrote:
> 
> 
>>On Wed, 8 Sep 2004, Uwe Ligges wrote:
> 
> 
> [...]
> 
> 
>>>Indeed, I think it is possible to provide an srt command (e.g. in half a 
>>>year for something like R-2.1.0). What is expected for "srt = 0"?
>>>a) the current behaviour, i.e. srt=0 in respect to the las setting *and* 
>>>the margin side to plot the text in, or
>>>b) always horizontally drawn text?
>>>
>>>I'd vote for b).
>>
>>That's easy, see the precedent in
>>
>>
>>>>BTW, if you want to use srt with mtext(at=) you can always use S ....
>>
>>S ignores las if at= is set, so srt=0 is the current default behaviour.
> 
> 
> Sorry, I garbled that.  In S, srt=0 is horizontal whatever side=, and las
> is always ignored.  Not that that is documented AFAICS, and it is hard to
> remember ....
> 
> [...]
> 

Since S is different for mtext() anyway:
We can say that adjustment is determined automatically by las + side, as 
it already is, and has to be adapted by the user if required.

Uwe

From p.dalgaard at biostat.ku.dk  Wed Sep  8 11:25:57 2004
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Wed Sep  8 11:26:26 2004
Subject: [Rd] Feil i websider (PR#7216)
In-Reply-To: <20040908055540.EB0A210E98@slim.kubism.ku.dk>
References: <20040908055540.EB0A210E98@slim.kubism.ku.dk>
Message-ID: <x2d60x863e.fsf@biostat.ku.dk>


This appears to all relate to old R documentation, except that the
nlme.stat.wisc.edu link is indeed dead and still appearing in the FAQ.

(The sender name is "check age and link" in Norwegian, so possibly not
a real person, but he/she/it'll get the reply nonetheless.)

sjekkAlderOgPeker@met.no writes:

> Warnings about /metno/internweb/fouweb/htdocs/teknisk/verktoy/R/faq.html
> 
> 	BAD LINK: http://stat.ethz.ch/R/manual/
> 	BAD LINK: http://nlme.stat.wisc.edu/MEMSS/
> 	BAD LINK: http://stats.mth.uea.ac.uk/Rcgi/
> 	BAD LINK: http://software.biostat.washington.edu/statsoft/ess/
> 
> ------------------------------------------------------------
> Warnings about /metno/internweb/fouweb/htdocs/teknisk/verktoy/R/resources.html
> 
> 	BAD LINK: http://fou.oslo.dnmi.no/teknisk/verktoy/R/r-announce@lists.r-project.org
> 	BAD LINK: http://fou.oslo.dnmi.no/teknisk/verktoy/R/r-help@lists.r-project.org
> 	BAD LINK: http://fou.oslo.dnmi.no/teknisk/verktoy/R/r-devel@lists.r-project.org
> 	BAD LINK: http://fou.oslo.dnmi.no/teknisk/verktoy/R/r-announce-request@lists.r-project.org
> 	BAD LINK: http://fou.oslo.dnmi.no/teknisk/verktoy/R/r-help-request@lists.r-project.org
> 	BAD LINK: http://fou.oslo.dnmi.no/teknisk/verktoy/R/r-devel-request@lists.r-project.org
> 	BAD LINK: http://mirror.aarnet.edu.au/pub/CRAN/
> 	BAD LINK: http://mirrors.theonlinerecordstore.com/CRAN/
> 
> ______________________________________________
> R-devel@stat.math.ethz.ch mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

From ripley at stats.ox.ac.uk  Wed Sep  8 11:31:53 2004
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed Sep  8 11:31:58 2004
Subject: [Rd] A couple of issues with colClasses/setAs
In-Reply-To: <x2hdq9vhcg.fsf@biostat.ku.dk>
Message-ID: <Pine.LNX.4.44.0409081019001.8331-100000@gannet.stats>

>From ?read.table (this is about read.table, despite the subject line, I 
believe?)

colClasses: character.  A vector of classes to be assumed for the columns.

"NULL" is not a class in my book (and certainly not one a column can
have).  So no wonder it does not work, and it is not a bug not to work in
undocumented cases.

We can look into making it work, but once you start skipping columns I 
think you should be using scan().  (I also suspect scan did not accept 
NULL when this was implemented.)

On 8 Sep 2004, Peter Dalgaard wrote:

> Consider this:
> 
> $ cat test.dat
> 1 a
> 2 b
> 
> Now, we want to read the 2nd column as a factor and ignore the first
> (since it's just a sequential ID). 

Well, you have to have row names, so that's not actually an advantage.

> We can't just put "factor" among
> the colClasses (would have been nice), so let's try this instead
> 
> > setAs("character","factor",as.factor)
> Arguments in definition changed from (x) to (from)
> > read.table("test.dat",colClasses=c("numeric","factor"))
> Error in inherits(x, "factor") : Object "x" not found
> 
> which is a bit peculiar: Why does it change the argument when that's
> going to create a function that doesn't work?? You do need to spell it
> out:
> 
> > setAs("character","factor",function(from)as.factor(from))

> And now we get somewhere
> 
> > read.table("test.dat",colClasses=c("numeric","factor"))
>   V1 V2
> 1  1  a
> 2  2  b

Might be a good idea to teach colClasses about "factor".

> 
> but suppose we want to get rid of col.1:
> 
> > read.table("test.dat",colClasses=c("NULL","factor"))
> Error in data[[i]] : subscript out of bounds
> 
> which looks like a pretty clear bug. In contrast, this works fine
> 
> > read.table("test.dat",colClasses=c("NULL","character"))
>   V2
> 1  a
> 2  b
> 
> so the issue only arises when you have nontrivial coercions.
> 
> Presumably, the issue is that the colClasses in those cases
> miscalculate indices by forgetting the columns that were skipped.
> 
> 

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From p.dalgaard at biostat.ku.dk  Wed Sep  8 12:09:07 2004
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Wed Sep  8 12:09:37 2004
Subject: [Rd] A couple of issues with colClasses/setAs
In-Reply-To: <Pine.LNX.4.44.0409081019001.8331-100000@gannet.stats>
References: <Pine.LNX.4.44.0409081019001.8331-100000@gannet.stats>
Message-ID: <x28ybl843g.fsf@biostat.ku.dk>

Prof Brian Ripley <ripley@stats.ox.ac.uk> writes:

> >From ?read.table (this is about read.table, despite the subject line, I 
> believe?)
> 
> colClasses: character.  A vector of classes to be assumed for the columns.
> 
> "NULL" is not a class in my book (and certainly not one a column can
> have).  So no wonder it does not work, and it is not a bug not to work in
> undocumented cases.

> class(NULL)
[1] "NULL"

But you're right, I sort of assumed that NULL would work, and guessed
the syntax. 
 
> We can look into making it work, but once you start skipping columns I 
> think you should be using scan().  (I also suspect scan did not accept 
> NULL when this was implemented.)

One-stop shopping would be a good target here I think; it would be
good if we can teach read.table to skip columns while retaining all
the other niceties. 

The reason that it appeared to work sometimes is in this loop

    for (i in 1:cols) {
        if (known[i])
            next
        data[[i]] <- if (!is.na(colClasses[i]))
            as(data[[i]], colClasses[i])
        else type.convert(data[[i]], as.is = as.is[i], dec = dec,
            na.strings = character(0))
    }

which sets data[[i]] <- NULL when colClasses[i] is "NULL". Had this
been intentional, it would of course be horribly wrong, since it makes
the index of all subsequent columns decrease by 1...

To make it actually work, we should probably fixup the "what" that is
being passed to scan a bit further upstreams.


> Might be a good idea to teach colClasses about "factor".

That's what I thought. Other ideas would be to predefine some standard
date classes (it's a bit annoying that there's no way to give
auxiliary information like formats), and maybe to allow a second
header line containing class names.

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

From p.dalgaard at biostat.ku.dk  Wed Sep  8 12:11:54 2004
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Wed Sep  8 12:12:18 2004
Subject: [Rd] Feil i websider (PR#7216)
In-Reply-To: <x2d60x863e.fsf@biostat.ku.dk>
References: <20040908055540.EB0A210E98@slim.kubism.ku.dk>
	<x2d60x863e.fsf@biostat.ku.dk>
Message-ID: <x24qm983yt.fsf@biostat.ku.dk>

Peter Dalgaard <p.dalgaard@biostat.ku.dk> writes:

> This appears to all relate to old R documentation, except that the
> nlme.stat.wisc.edu link is indeed dead and still appearing in the FAQ.
> 
> (The sender name is "check age and link" in Norwegian, so possibly not
> a real person, but he/she/it'll get the reply nonetheless.)

Indeed, the mail bounced...


-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

From wolski at molgen.mpg.de  Wed Sep  8 12:19:02 2004
From: wolski at molgen.mpg.de (Wolski)
Date: Wed Sep  8 12:19:15 2004
Subject: [Rd] as(object,"list")  as(object,"matrix") differences?
In-Reply-To: <413DD80C.2D5EA9C9@research.bell-labs.com>
References: <200409071617210704.0504144D@mail.math.fu-berlin.de>
	<413DD80C.2D5EA9C9@research.bell-labs.com>
Message-ID: <200409081219020786.0B1B546F@mail.math.fu-berlin.de>

Hi!

Some follow up questions concerning the class definition of list.

On 9/7/2004 at 11:47 AM John Chambers wrote:
>>>
>>>as(object, "list") works like all coercion to basic datatypes.  The
>>>method uses the corresponding old-style as.<class> function.  In
>>>addition, if coercion is strict, all attributes are removed. See ?as.
>>>
>>>The effect of this is that names would be removed, unless you used
>>>as(object, "list", strict=FALSE).  (The coerce in dispatching methods is
>>>NOT strict, so a method for class "list" would see the names.)
>>>
setClass("Mlist"
         ,representation(info="character") #uniq names have to be unique?
         ,contains="list"
         ,prototype(uniq=FALSE)
         )

tmp <- as.list(1:10)
names(tmp) <- letters[1:10]
mylist<-new("Mlist" , tmp , content="numeric" ,uniq=FALSE)


as.list(tmp) #preserves names
as.list(tmp,strict=TRUE) #preserves names 

In both cases R preserves the names attribute! So it seems to me that current R's list definition includes the names attribute.  

But

as(mylist,"list") #names are gone.

does not.

>>>datatype.  The green book and S-Plus take the view that lists are just
>>>vectors, and the current R implementation follows that interpretation.

are "as.list" as it is, is deprecated?


Eryk




*********** REPLY SEPARATOR  ***********

>>>Yes, there are differences, and you should expect some. 
>>>
>>>That as(object, "matrix") preserves dimnames is hardly an accident,
>>>since dimnames are part of the definition of a matrix.
>>>
>>>as(object, "list") works like all coercion to basic datatypes.  The
>>>method uses the corresponding old-style as.<class> function.  In
>>>addition, if coercion is strict, all attributes are removed. See ?as.
>>>
>>>The effect of this is that names would be removed, unless you used
>>>as(object, "list", strict=FALSE).  (The coerce in dispatching methods is
>>>NOT strict, so a method for class "list" would see the names.)
>>>
>>>This is consistent behavior, but yes, the elimination of names may be
>>>surprising.  It's possible that future versions might treat names
>>>differently from other attributes, but there would need to be a strong
>>>argument.
>>>
>>>The workaround is to define a new class that trivially extends "list",
>>>and then define classes to extend that instead:
>>>
>>> setClass("listWithNames", "list")
>>>
>>>Then if x is an object from a class defined with
>>>contains="listWithNames", rather than contains="list",
>>>  as(x, "listWithNames")
>>>would preserve names.
>>>
>>>The problem here is that the definition of class (or dataype) "list" was
>>>never very clear as to whether names were an attribute or part of the
>>>datatype.  The green book and S-Plus take the view that lists are just
>>>vectors, and the current R implementation follows that interpretation.
>>>
>>>(There is also in S-Plus a different class, "named", specifically for
>>>the applications that lists with names typically deal with.  But the
>>>spirit of that class is NOT equivalent to lists with a names attribute.)
>>>
>>>As for extending basic datatypes by S4 classes, that's generally OK,
>>>provided you understand the consequences (pages 314-316 of the green
>>>book have a brief discussion).
>>>
>>>And as for "wrapper" classes, there are no immediate plans.  The basic
>>>datatypes do have class definitions:
>>>
>>>R> getClass("list")
>>>
>>>No Slots, prototype of class "list"
>>>
>>>Extends: "vector"
>>>
>>>The main candidates for wrapper classes are "matrix" and "array", since
>>>these do not have a fixed set of attributes (they may or may not have
>>>"dimnames").  Class "ts" is already a formal class.
>>>
>>>John Chambers
>>>
>>>Wolski wrote:
>>>> 
>>>> Hello!
>>>> 
>>>> as(object,"list") and as(object,"matrix") behave quite differently if
>>>it comes to their attributes.
>>>> I define two classes. One of them "contains" a "list" the other a
>>>"matrix"
>>>> setClass("myclass"
>>>> ,representation(info="character")
>>>> ,contains="matrix"
>>>> )
>>>> setClass("mylist"
>>>> ,representation(info="character")
>>>> ,contains="list"
>>>> )
>>>> 
>>>> #init
>>>> dd<-matrix(1:6,nrow=2)
>>>> rownames(dd)<-c("a","b")
>>>> tt<-new("myclass",dd)
>>>> 
>>>> tmp<-vector("list",4)
>>>> names(tmp)<-1:4
>>>> ll <- new("mylist",tmp,info="foo")
>>>> 
>>>> rownames(tt)
>>>> [1] "a" "b"
>>>> > rownames(as(tt,"matrix"))
>>>> [1] "a" "b"
>>>> 
>>>> > names(ll)
>>>> [1] "1" "2" "3" "4"
>>>> > names(as(ll,"list"))
>>>> NULL
>>>> #but
>>>> names(ll@.Data)
>>>> The difference in behaviour to which i would like to point your
>>>attention is that as(object,"matrix") preserves the "dimnames" but at
>>>the same time as(object,"list") drops the "names" attribute.
>>>> 
>>>> Is it recomended not to use "contains" with old style classes?
>>>> Are there plans to provide standarized S4 versions/wrappers for list,
>>>matrix etc... classes?
>>>> 
>>>> /E
>>>> 
>>>> PS.
>>>> R : Copyright 2004, The R Foundation for Statistical Computing
>>>> Version 1.9.1 Patched (2004-08-30), ISBN 3-900051-00-3
>>>> 
>>>> ______________________________________________
>>>> R-devel@stat.math.ethz.ch mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>>-- 
>>>John M. Chambers                  jmc@bell-labs.com
>>>Bell Labs, Lucent Technologies    office: (908)582-2681
>>>700 Mountain Avenue, Room 2C-282  fax:    (908)582-3340
>>>Murray Hill, NJ  07974            web: http://www.cs.bell-labs.com/~jmc



Dipl. bio-chem. Witold Eryk Wolski             @         MPI-Moleculare Genetic   
Ihnestrasse 63-73 14195 Berlin                'v'    
tel: 0049-30-83875219                        /   \       
mail: witek96@users.sourceforge.net        ---W-W----    http://www.molgen.mpg.de/~wolski 
      wolski@molgen.mpg.de

From MSchwartz at MedAnalytics.com  Wed Sep  8 14:42:10 2004
From: MSchwartz at MedAnalytics.com (Marc Schwartz)
Date: Wed Sep  8 14:42:14 2004
Subject: [Rd]  Re: argument srt for mtext(); was: [R] using text on the
	x axis ticks rather than numbers
In-Reply-To: <413EBF27.7090105@statistik.uni-dortmund.de>
References: <Pine.LNX.4.44.0409080811230.26528-100000@gannet.stats>
	<413EBF27.7090105@statistik.uni-dortmund.de>
Message-ID: <1094647329.4384.45.camel@localhost.localdomain>

On Wed, 2004-09-08 at 03:13, Uwe Ligges wrote:
> Prof Brian Ripley wrote:
> 
> > On Wed, 8 Sep 2004, Prof Brian Ripley wrote:
> > 
> > 
> >>On Wed, 8 Sep 2004, Uwe Ligges wrote:
> > 
> > 
> > [...]
> > 
> > 
> >>>Indeed, I think it is possible to provide an srt command (e.g. in half a 
> >>>year for something like R-2.1.0). What is expected for "srt = 0"?
> >>>a) the current behaviour, i.e. srt=0 in respect to the las setting *and* 
> >>>the margin side to plot the text in, or
> >>>b) always horizontally drawn text?
> >>>
> >>>I'd vote for b).
> >>
> >>That's easy, see the precedent in
> >>
> >>
> >>>>BTW, if you want to use srt with mtext(at=) you can always use S ....
> >>
> >>S ignores las if at= is set, so srt=0 is the current default behaviour.
> > 
> > 
> > Sorry, I garbled that.  In S, srt=0 is horizontal whatever side=, and las
> > is always ignored.  Not that that is documented AFAICS, and it is hard to
> > remember ....
> > 
> > [...]
> > 
> 
> Since S is different for mtext() anyway:
> We can say that adjustment is determined automatically by las + side, as 
> it already is, and has to be adapted by the user if required.
> 
> Uwe


Perhaps this is because I have only had one cup of coffee so far this
morning, but is the bias at this point towards making the change or not
making the change? I'm a little confuzzled...

If it is towards making the change, I would vote for an explicit 'srt'
to override 'las' as per Uwe's option "b" and Prof. Ripley's last
comment. That would seem to me to be quite logical at first glance.

In either case, as a possible option, I could draft some text for a FAQ
on this issue of rotated axis labels, since it seems to get asked often,
and send it to Kurt.

Let me know.

Marc

From ligges at statistik.uni-dortmund.de  Wed Sep  8 15:02:34 2004
From: ligges at statistik.uni-dortmund.de (Uwe Ligges)
Date: Wed Sep  8 15:01:12 2004
Subject: [Rd]  Re: argument srt for mtext(); was: [R] using text on the
	x axis ticks rather than numbers
In-Reply-To: <1094647329.4384.45.camel@localhost.localdomain>
References: <Pine.LNX.4.44.0409080811230.26528-100000@gannet.stats>	
	<413EBF27.7090105@statistik.uni-dortmund.de>
	<1094647329.4384.45.camel@localhost.localdomain>
Message-ID: <413F02EA.3070507@statistik.uni-dortmund.de>

Marc Schwartz wrote:

> On Wed, 2004-09-08 at 03:13, Uwe Ligges wrote:
> 
>>Prof Brian Ripley wrote:
>>
>>
>>>On Wed, 8 Sep 2004, Prof Brian Ripley wrote:
>>>
>>>
>>>
>>>>On Wed, 8 Sep 2004, Uwe Ligges wrote:
>>>
>>>
>>>[...]
>>>
>>>
>>>
>>>>>Indeed, I think it is possible to provide an srt command (e.g. in half a 
>>>>>year for something like R-2.1.0). What is expected for "srt = 0"?
>>>>>a) the current behaviour, i.e. srt=0 in respect to the las setting *and* 
>>>>>the margin side to plot the text in, or
>>>>>b) always horizontally drawn text?
>>>>>
>>>>>I'd vote for b).
>>>>
>>>>That's easy, see the precedent in
>>>>
>>>>
>>>>
>>>>>>BTW, if you want to use srt with mtext(at=) you can always use S ....
>>>>
>>>>S ignores las if at= is set, so srt=0 is the current default behaviour.
>>>
>>>
>>>Sorry, I garbled that.  In S, srt=0 is horizontal whatever side=, and las
>>>is always ignored.  Not that that is documented AFAICS, and it is hard to
>>>remember ....
>>>
>>>[...]
>>>
>>
>>Since S is different for mtext() anyway:
>>We can say that adjustment is determined automatically by las + side, as 
>>it already is, and has to be adapted by the user if required.
>>
>>Uwe
> 
> 
> 
> Perhaps this is because I have only had one cup of coffee so far this
> morning, but is the bias at this point towards making the change or not
> making the change? I'm a little confuzzled...

As Brian already pointed out, you are not the only "confuzzled" one ... 
  at least one of the other "confuzzled" people here has not decided 
anything yet. ;-)
If someone is going to force a decision and convinces me, I'll probably 
try to provide a patch.

The most problematic point (mentioned by Brian Ripley) is the automatic 
settings of the "adj" and "padj" values (related to reading direction, 
as of R-2.0.0 alpha). Both have good defaults for parallel and 
perpendicular text (related to axis) now, but what happens if srt is 
set, and in particluar what happens if
   (srt %% 90) != 0
My suggestion is to use the default settings for *adjustment* ("adj" and 
"padj") derived from "las" and "side" as usual - even if *rotation* is 
no longer derived from "las" and "side".

Uwe


> If it is towards making the change, I would vote for an explicit 'srt'
> to override 'las' as per Uwe's option "b" and Prof. Ripley's last
> comment. That would seem to me to be quite logical at first glance.
> 
> In either case, as a possible option, I could draft some text for a FAQ
> on this issue of rotated axis labels, since it seems to get asked often,
> and send it to Kurt.
> 
> Let me know.
> 
> Marc
>

From jmc at research.bell-labs.com  Wed Sep  8 16:10:51 2004
From: jmc at research.bell-labs.com (John Chambers)
Date: Wed Sep  8 16:11:09 2004
Subject: [Rd] as(object,"list")  as(object,"matrix") differences?
References: <200409071617210704.0504144D@mail.math.fu-berlin.de>
	<413DD80C.2D5EA9C9@research.bell-labs.com>
	<200409081219020786.0B1B546F@mail.math.fu-berlin.de>
Message-ID: <413F12EB.5F76BBA5@research.bell-labs.com>

Please re-read the previous mail to see answers to your questions, as
noted below.

Wolski wrote:
> 
> Hi!
> 
> Some follow up questions concerning the class definition of list.
> 
> On 9/7/2004 at 11:47 AM John Chambers wrote:
> >>>
> >>>as(object, "list") works like all coercion to basic datatypes.  The
> >>>method uses the corresponding old-style as.<class> function.  In
> >>>addition, if coercion is strict, all attributes are removed. See ?as.

NOTE -------------------------^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

> >>>
> >>>The effect of this is that names would be removed, unless you used
> >>>as(object, "list", strict=FALSE).  (The coerce in dispatching methods is
> >>>NOT strict, so a method for class "list" would see the names.)
> >>>
> setClass("Mlist"
>          ,representation(info="character") #uniq names have to be unique?
>          ,contains="list"
>          ,prototype(uniq=FALSE)
>          )
> 
> tmp <- as.list(1:10)
> names(tmp) <- letters[1:10]
> mylist<-new("Mlist" , tmp , content="numeric" ,uniq=FALSE)
> 
> as.list(tmp) #preserves names
> as.list(tmp,strict=TRUE) #preserves names

You are misusing as.list, it has no strict=argument.  See ?as.list.

> 
> In both cases R preserves the names attribute! So it seems to me that current R's list definition includes the names attribute.
> 
> But
> 
> as(mylist,"list") #names are gone.
> 
> does not.

As previously explained.

> 
> >>>datatype.  The green book and S-Plus take the view that lists are just
> >>>vectors, and the current R implementation follows that interpretation.
> 
> are "as.list" as it is, is deprecated?

No, but it belongs to a different, earlier programming model.  The
current implementation maps the "basic" classes such as list in a
particular way, but it's not possible to be entirely compatible with
earlier functions which did not always follow a consistent class model
(naturally, since there wasn't one at the time).  We can discuss whether
to change the implementation, but there needs to be a good general
argument for doing so.

> 
> Eryk
> 
> *********** REPLY SEPARATOR  ***********
> 
> >>>Yes, there are differences, and you should expect some.
> >>>
> >>>That as(object, "matrix") preserves dimnames is hardly an accident,
> >>>since dimnames are part of the definition of a matrix.
> >>>
> >>>as(object, "list") works like all coercion to basic datatypes.  The
> >>>method uses the corresponding old-style as.<class> function.  In
> >>>addition, if coercion is strict, all attributes are removed. See ?as.
> >>>
> >>>The effect of this is that names would be removed, unless you used
> >>>as(object, "list", strict=FALSE).  (The coerce in dispatching methods is
> >>>NOT strict, so a method for class "list" would see the names.)
> >>>
> >>>This is consistent behavior, but yes, the elimination of names may be
> >>>surprising.  It's possible that future versions might treat names
> >>>differently from other attributes, but there would need to be a strong
> >>>argument.
> >>>
> >>>The workaround is to define a new class that trivially extends "list",
> >>>and then define classes to extend that instead:
> >>>
> >>> setClass("listWithNames", "list")
> >>>
> >>>Then if x is an object from a class defined with
> >>>contains="listWithNames", rather than contains="list",
> >>>  as(x, "listWithNames")
> >>>would preserve names.
> >>>
> >>>The problem here is that the definition of class (or dataype) "list" was
> >>>never very clear as to whether names were an attribute or part of the
> >>>datatype.  The green book and S-Plus take the view that lists are just
> >>>vectors, and the current R implementation follows that interpretation.
> >>>
> >>>(There is also in S-Plus a different class, "named", specifically for
> >>>the applications that lists with names typically deal with.  But the
> >>>spirit of that class is NOT equivalent to lists with a names attribute.)
> >>>
> >>>As for extending basic datatypes by S4 classes, that's generally OK,
> >>>provided you understand the consequences (pages 314-316 of the green
> >>>book have a brief discussion).
> >>>
> >>>And as for "wrapper" classes, there are no immediate plans.  The basic
> >>>datatypes do have class definitions:
> >>>
> >>>R> getClass("list")
> >>>
> >>>No Slots, prototype of class "list"
> >>>
> >>>Extends: "vector"
> >>>
> >>>The main candidates for wrapper classes are "matrix" and "array", since
> >>>these do not have a fixed set of attributes (they may or may not have
> >>>"dimnames").  Class "ts" is already a formal class.
> >>>
> >>>John Chambers
> >>>
> >>>Wolski wrote:
> >>>>
> >>>> Hello!
> >>>>
> >>>> as(object,"list") and as(object,"matrix") behave quite differently if
> >>>it comes to their attributes.
> >>>> I define two classes. One of them "contains" a "list" the other a
> >>>"matrix"
> >>>> setClass("myclass"
> >>>> ,representation(info="character")
> >>>> ,contains="matrix"
> >>>> )
> >>>> setClass("mylist"
> >>>> ,representation(info="character")
> >>>> ,contains="list"
> >>>> )
> >>>>
> >>>> #init
> >>>> dd<-matrix(1:6,nrow=2)
> >>>> rownames(dd)<-c("a","b")
> >>>> tt<-new("myclass",dd)
> >>>>
> >>>> tmp<-vector("list",4)
> >>>> names(tmp)<-1:4
> >>>> ll <- new("mylist",tmp,info="foo")
> >>>>
> >>>> rownames(tt)
> >>>> [1] "a" "b"
> >>>> > rownames(as(tt,"matrix"))
> >>>> [1] "a" "b"
> >>>>
> >>>> > names(ll)
> >>>> [1] "1" "2" "3" "4"
> >>>> > names(as(ll,"list"))
> >>>> NULL
> >>>> #but
> >>>> names(ll@.Data)
> >>>> The difference in behaviour to which i would like to point your
> >>>attention is that as(object,"matrix") preserves the "dimnames" but at
> >>>the same time as(object,"list") drops the "names" attribute.
> >>>>
> >>>> Is it recomended not to use "contains" with old style classes?
> >>>> Are there plans to provide standarized S4 versions/wrappers for list,
> >>>matrix etc... classes?
> >>>>
> >>>> /E
> >>>>
> >>>> PS.
> >>>> R : Copyright 2004, The R Foundation for Statistical Computing
> >>>> Version 1.9.1 Patched (2004-08-30), ISBN 3-900051-00-3
> >>>>
> >>>> ______________________________________________
> >>>> R-devel@stat.math.ethz.ch mailing list
> >>>> https://stat.ethz.ch/mailman/listinfo/r-devel
> >>>
> >>>--
> >>>John M. Chambers                  jmc@bell-labs.com
> >>>Bell Labs, Lucent Technologies    office: (908)582-2681
> >>>700 Mountain Avenue, Room 2C-282  fax:    (908)582-3340
> >>>Murray Hill, NJ  07974            web: http://www.cs.bell-labs.com/~jmc
> 
> Dipl. bio-chem. Witold Eryk Wolski             @         MPI-Moleculare Genetic
> Ihnestrasse 63-73 14195 Berlin                'v'
> tel: 0049-30-83875219                        /   \
> mail: witek96@users.sourceforge.net        ---W-W----    http://www.molgen.mpg.de/~wolski
>       wolski@molgen.mpg.de

-- 
John M. Chambers                  jmc@bell-labs.com
Bell Labs, Lucent Technologies    office: (908)582-2681
700 Mountain Avenue, Room 2C-282  fax:    (908)582-3340
Murray Hill, NJ  07974            web: http://www.cs.bell-labs.com/~jmc

From MSchwartz at MedAnalytics.com  Wed Sep  8 16:22:26 2004
From: MSchwartz at MedAnalytics.com (Marc Schwartz)
Date: Wed Sep  8 16:22:31 2004
Subject: [Rd]  Re: argument srt for mtext(); was: [R] using text on the
	x axis ticks rather than numbers
In-Reply-To: <413F02EA.3070507@statistik.uni-dortmund.de>
References: <Pine.LNX.4.44.0409080811230.26528-100000@gannet.stats>
	<413EBF27.7090105@statistik.uni-dortmund.de>
	<1094647329.4384.45.camel@localhost.localdomain>
	<413F02EA.3070507@statistik.uni-dortmund.de>
Message-ID: <1094653346.4384.106.camel@localhost.localdomain>

On Wed, 2004-09-08 at 08:02, Uwe Ligges wrote:
> Marc Schwartz wrote:
> 
> > On Wed, 2004-09-08 at 03:13, Uwe Ligges wrote:
> > 
> >>Prof Brian Ripley wrote:
> >>
> >>
> >>>On Wed, 8 Sep 2004, Prof Brian Ripley wrote:
> >>>
> >>>
> >>>
> >>>>On Wed, 8 Sep 2004, Uwe Ligges wrote:
> >>>
> >>>
> >>>[...]
> >>>
> >>>
> >>>
> >>>>>Indeed, I think it is possible to provide an srt command (e.g. in half a 
> >>>>>year for something like R-2.1.0). What is expected for "srt = 0"?
> >>>>>a) the current behaviour, i.e. srt=0 in respect to the las setting *and* 
> >>>>>the margin side to plot the text in, or
> >>>>>b) always horizontally drawn text?
> >>>>>
> >>>>>I'd vote for b).
> >>>>
> >>>>That's easy, see the precedent in
> >>>>
> >>>>
> >>>>
> >>>>>>BTW, if you want to use srt with mtext(at=) you can always use S ....
> >>>>
> >>>>S ignores las if at= is set, so srt=0 is the current default behaviour.
> >>>
> >>>
> >>>Sorry, I garbled that.  In S, srt=0 is horizontal whatever side=, and las
> >>>is always ignored.  Not that that is documented AFAICS, and it is hard to
> >>>remember ....
> >>>
> >>>[...]
> >>>
> >>
> >>Since S is different for mtext() anyway:
> >>We can say that adjustment is determined automatically by las + side, as 
> >>it already is, and has to be adapted by the user if required.
> >>
> >>Uwe
> > 
> > 
> > 
> > Perhaps this is because I have only had one cup of coffee so far this
> > morning, but is the bias at this point towards making the change or not
> > making the change? I'm a little confuzzled...
> 
> As Brian already pointed out, you are not the only "confuzzled" one ... 
>   at least one of the other "confuzzled" people here has not decided 
> anything yet. ;-)
> If someone is going to force a decision and convinces me, I'll probably 
> try to provide a patch.
> 
> The most problematic point (mentioned by Brian Ripley) is the automatic 
> settings of the "adj" and "padj" values (related to reading direction, 
> as of R-2.0.0 alpha). Both have good defaults for parallel and 
> perpendicular text (related to axis) now, but what happens if srt is 
> set, and in particluar what happens if
>    (srt %% 90) != 0
> My suggestion is to use the default settings for *adjustment* ("adj" and 
> "padj") derived from "las" and "side" as usual - even if *rotation* is 
> no longer derived from "las" and "side".
> 
> Uwe


OK...well, let me think "outside the polygon" for a moment. Notice that
I did not say "box", as the shape is not quite fixed yet.... ;-)

First, I would not twist your arm on this. There is an option already
that solves the problem and provides a great deal of flexibility, as I
described in my initial reply in the r-help thread and as others have
referenced in prior posts. A new FAQ on this might not be a bad idea
however.

Second, in scanning do_axis() in plot.c, I wonder if (in any body's
mind) it might be easier in some fashion to modify axis() by adding a
'srt' argument? The comments in the relevant sections of the switch()
code are:

	/* The order of processing is important here. */
	/* We must ensure that the labels are drawn left-to-right. */
	/* The logic here is getting way too convoluted. */
	/* This needs a serious rewrite. */

If a rewrite is to occur at some point (perhaps as a better use of
time), one could feasibly add a check such that if 'srt' is specified in
the call to axis (or perhaps the higher level plots as part of the '...'
argument), do_text() is used (with sensible defaults for 'x,' y', 'xpd',
'mar', etc.) instead of GMMathText() and/or GMtext() as it is at
present?

Being a firm believer in Pareto's 80/20 Rule, if some sensible defaults
would help with the typical cases, one could still use the manually
coded approach with text() as per my example, where greater flexibility
is required, as is always the case with R.

On the other hand, under the 80/20 Rule, is this even worth spending a
lot of time on?

Does this make any sense?

Marc

From p.dalgaard at biostat.ku.dk  Wed Sep  8 16:38:58 2004
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Wed Sep  8 16:39:29 2004
Subject: [Rd] A couple of issues with colClasses/setAs
In-Reply-To: <x28ybl843g.fsf@biostat.ku.dk>
References: <Pine.LNX.4.44.0409081019001.8331-100000@gannet.stats>
	<x28ybl843g.fsf@biostat.ku.dk>
Message-ID: <x2y8jk7rlp.fsf@biostat.ku.dk>

Peter Dalgaard <p.dalgaard@biostat.ku.dk> writes:

> To make it actually work, we should probably fixup the "what" that is
> being passed to scan a bit further upstreams.
> 
> 
> > Might be a good idea to teach colClasses about "factor".
> 
> That's what I thought. Other ideas would be to predefine some standard
> date classes (it's a bit annoying that there's no way to give
> auxiliary information like formats), and maybe to allow a second
> header line containing class names.

Done already, I see (except the class-header idea, which probably
requires more thought). Thanks.

While we're in there should we perhaps consider adding pseudo-classes

"Ymd"
"dmY"
"mdY"
"Y/m/d"
"d/m-Y"
"m/d/Y"

etc?  Or perhaps it is better with a catchall "Date-fmt", i.e., e.g.,
"Date-%Y%m%d"? That'd be fairly easy to code:

else if (length(grep("^Date-",colClasses[i])))  
        as.Date(data[[i]], sub("^Date-(.*)$","\\1", colClasses[i]))

although perhaps not so easy to document concisely.
-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

From ligges at statistik.uni-dortmund.de  Wed Sep  8 16:48:18 2004
From: ligges at statistik.uni-dortmund.de (Uwe Ligges)
Date: Wed Sep  8 16:46:57 2004
Subject: [Rd]  Re: argument srt for mtext(); was: [R] using text on the
	x axis ticks rather than numbers
In-Reply-To: <1094653346.4384.106.camel@localhost.localdomain>
References: <Pine.LNX.4.44.0409080811230.26528-100000@gannet.stats>	
	<413EBF27.7090105@statistik.uni-dortmund.de>	
	<1094647329.4384.45.camel@localhost.localdomain>	
	<413F02EA.3070507@statistik.uni-dortmund.de>
	<1094653346.4384.106.camel@localhost.localdomain>
Message-ID: <413F1BB2.3080703@statistik.uni-dortmund.de>

Marc Schwartz wrote:

> On Wed, 2004-09-08 at 08:02, Uwe Ligges wrote:
> 
>>Marc Schwartz wrote:
>>
>>
>>>On Wed, 2004-09-08 at 03:13, Uwe Ligges wrote:
>>>
>>>
>>>>Prof Brian Ripley wrote:
>>>>
>>>>
>>>>
>>>>>On Wed, 8 Sep 2004, Prof Brian Ripley wrote:
>>>>>
>>>>>
>>>>>
>>>>>
>>>>>>On Wed, 8 Sep 2004, Uwe Ligges wrote:
>>>>>
>>>>>
>>>>>[...]
>>>>>
>>>>>
>>>>>
>>>>>
>>>>>>>Indeed, I think it is possible to provide an srt command (e.g. in half a 
>>>>>>>year for something like R-2.1.0). What is expected for "srt = 0"?
>>>>>>>a) the current behaviour, i.e. srt=0 in respect to the las setting *and* 
>>>>>>>the margin side to plot the text in, or
>>>>>>>b) always horizontally drawn text?
>>>>>>>
>>>>>>>I'd vote for b).
>>>>>>
>>>>>>That's easy, see the precedent in
>>>>>>
>>>>>>
>>>>>>
>>>>>>
>>>>>>>>BTW, if you want to use srt with mtext(at=) you can always use S ....
>>>>>>
>>>>>>S ignores las if at= is set, so srt=0 is the current default behaviour.
>>>>>
>>>>>
>>>>>Sorry, I garbled that.  In S, srt=0 is horizontal whatever side=, and las
>>>>>is always ignored.  Not that that is documented AFAICS, and it is hard to
>>>>>remember ....
>>>>>
>>>>>[...]
>>>>>
>>>>
>>>>Since S is different for mtext() anyway:
>>>>We can say that adjustment is determined automatically by las + side, as 
>>>>it already is, and has to be adapted by the user if required.
>>>>
>>>>Uwe
>>>
>>>
>>>
>>>Perhaps this is because I have only had one cup of coffee so far this
>>>morning, but is the bias at this point towards making the change or not
>>>making the change? I'm a little confuzzled...
>>
>>As Brian already pointed out, you are not the only "confuzzled" one ... 
>>  at least one of the other "confuzzled" people here has not decided 
>>anything yet. ;-)
>>If someone is going to force a decision and convinces me, I'll probably 
>>try to provide a patch.
>>
>>The most problematic point (mentioned by Brian Ripley) is the automatic 
>>settings of the "adj" and "padj" values (related to reading direction, 
>>as of R-2.0.0 alpha). Both have good defaults for parallel and 
>>perpendicular text (related to axis) now, but what happens if srt is 
>>set, and in particluar what happens if
>>   (srt %% 90) != 0
>>My suggestion is to use the default settings for *adjustment* ("adj" and 
>>"padj") derived from "las" and "side" as usual - even if *rotation* is 
>>no longer derived from "las" and "side".
>>
>>Uwe
> 
> 
> 
> OK...well, let me think "outside the polygon" for a moment. Notice that
> I did not say "box", as the shape is not quite fixed yet.... ;-)
> 
> First, I would not twist your arm on this. There is an option already
> that solves the problem and provides a great deal of flexibility, as I
> described in my initial reply in the r-help thread and as others have
> referenced in prior posts. A new FAQ on this might not be a bad idea
> however.
> 
> Second, in scanning do_axis() in plot.c, I wonder if (in any body's
> mind) it might be easier in some fashion to modify axis() by adding a
> 'srt' argument? The comments in the relevant sections of the switch()
> code are:
> 
> 	/* The order of processing is important here. */
> 	/* We must ensure that the labels are drawn left-to-right. */
> 	/* The logic here is getting way too convoluted. */
> 	/* This needs a serious rewrite. */
 >
> If a rewrite is to occur at some point (perhaps as a better use of
> time), one could feasibly add a check such that if 'srt' is specified in
> the call to axis (or perhaps the higher level plots as part of the '...'
> argument), do_text() is used (with sensible defaults for 'x,' y', 'xpd',
> 'mar', etc.) instead of GMMathText() and/or GMtext() as it is at
> present?

a) "This needs a serious rewrite" means that it needs a serious rewrite. ;-)
b) if do_text is used,  you have to deal with the clipping stuff again.
c) It is very easy to do it in GMText, since "angle" is used anyway to 
rotate the text.
As an example, replace in GMtext (graphics.c) all lines containing angle 
= ... by, e.g., angle = 45 and play around. Just the wrappers have to be 
modified a little bit. It's work of half a day, if nobody expects that 
something very fuzzy happens ...

Uwe



> Being a firm believer in Pareto's 80/20 Rule, if some sensible defaults
> would help with the typical cases, one could still use the manually
> coded approach with text() as per my example, where greater flexibility
> is required, as is always the case with R.
> 
> On the other hand, under the 80/20 Rule, is this even worth spending a
> lot of time on?
> 
> Does this make any sense?
> 
> Marc
>

From MSchwartz at MedAnalytics.com  Wed Sep  8 16:57:37 2004
From: MSchwartz at MedAnalytics.com (Marc Schwartz)
Date: Wed Sep  8 16:57:41 2004
Subject: [Rd]  Re: argument srt for mtext(); was: [R] using text on the
	x axis ticks rather than numbers
In-Reply-To: <413F1BB2.3080703@statistik.uni-dortmund.de>
References: <Pine.LNX.4.44.0409080811230.26528-100000@gannet.stats>
	<413EBF27.7090105@statistik.uni-dortmund.de>
	<1094647329.4384.45.camel@localhost.localdomain>
	<413F02EA.3070507@statistik.uni-dortmund.de>
	<1094653346.4384.106.camel@localhost.localdomain>
	<413F1BB2.3080703@statistik.uni-dortmund.de>
Message-ID: <1094655457.4384.116.camel@localhost.localdomain>

On Wed, 2004-09-08 at 09:48, Uwe Ligges wrote:
> Marc Schwartz wrote:

<snip>

> > 
> > OK...well, let me think "outside the polygon" for a moment. Notice that
> > I did not say "box", as the shape is not quite fixed yet.... ;-)
> > 
> > First, I would not twist your arm on this. There is an option already
> > that solves the problem and provides a great deal of flexibility, as I
> > described in my initial reply in the r-help thread and as others have
> > referenced in prior posts. A new FAQ on this might not be a bad idea
> > however.
> > 
> > Second, in scanning do_axis() in plot.c, I wonder if (in any body's
> > mind) it might be easier in some fashion to modify axis() by adding a
> > 'srt' argument? The comments in the relevant sections of the switch()
> > code are:
> > 
> > 	/* The order of processing is important here. */
> > 	/* We must ensure that the labels are drawn left-to-right. */
> > 	/* The logic here is getting way too convoluted. */
> > 	/* This needs a serious rewrite. */
>  >
> > If a rewrite is to occur at some point (perhaps as a better use of
> > time), one could feasibly add a check such that if 'srt' is specified in
> > the call to axis (or perhaps the higher level plots as part of the '...'
> > argument), do_text() is used (with sensible defaults for 'x,' y', 'xpd',
> > 'mar', etc.) instead of GMMathText() and/or GMtext() as it is at
> > present?
> 
> a) "This needs a serious rewrite" means that it needs a serious rewrite. ;-)

OK...no more joking around then... ;-)

> b) if do_text is used,  you have to deal with the clipping stuff again.

which is why a change in 'xpd' would be required as I mentioned.

> c) It is very easy to do it in GMText, since "angle" is used anyway to 
> rotate the text.
> As an example, replace in GMtext (graphics.c) all lines containing angle 
> = ... by, e.g., angle = 45 and play around. Just the wrappers have to be 
> modified a little bit. It's work of half a day, if nobody expects that 
> something very fuzzy happens ...

OK...just thought that I would raise it for consideration.

As Roseanne Rosanna-Danna would say: "Never Mind"... :-)

Thanks Uwe.

Marc

From wolski at molgen.mpg.de  Wed Sep  8 17:46:51 2004
From: wolski at molgen.mpg.de (Wolski)
Date: Wed Sep  8 17:47:02 2004
Subject: [Rd] Re: [R] Sweave echoing comments (again)
In-Reply-To: <413C4A66.30008@hhbio.wasser.tu-dresden.de>
References: <413C4A66.30008@hhbio.wasser.tu-dresden.de>
Message-ID: <200409081746510955.0C476E9B@mail.math.fu-berlin.de>

Hi!

I observed it also. There are cases where it is not desirable. It will be quite helpfull, if possible, to have a parameter that allows one to switch of removing the #comments. 

/E

*********** REPLY SEPARATOR  ***********

On 9/6/2004 at 1:30 PM Thomas Petzoldt wrote:

>>>Hello,
>>>
>>>I try to document some R scripts for my collegues and observed the 
>>>problem, that Sweave strips comment lines away.
>>>
>>>As a small example I write in an Rtex file:
>>>
>>>\begin{Scode}
>>>## a small example
>>>test() # line comment
>>>\end{Scode}
>>>
>>>... the .tex file generated by Sweave only contains:
>>>
>>>\begin{Schunk}
>>>\begin{Sinput}
>>>  test()
>>>\end{Sinput}
>>>\end{Schunk}
>>>
>>>
>>>... and all the comments are lost. Looking into the archives, I found, 
>>>that such a question appeared already some months ago. Are there any 
>>>advances or workarounds doing such things today?
>>>
>>>Thank you in advance!
>>>
>>>Thomas P.
>>>
>>>______________________________________________
>>>R-help@stat.math.ethz.ch mailing list
>>>https://stat.ethz.ch/mailman/listinfo/r-help
>>>PLEASE do read the posting guide! http://www.R-project.org/posting-guide.html



Dipl. bio-chem. Witold Eryk Wolski             @         MPI-Moleculare Genetic   
Ihnestrasse 63-73 14195 Berlin                'v'    
tel: 0049-30-83875219                        /   \       
mail: witek96@users.sourceforge.net        ---W-W----    http://www.molgen.mpg.de/~wolski 
      wolski@molgen.mpg.de

From ripley at stats.ox.ac.uk  Wed Sep  8 18:49:52 2004
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed Sep  8 18:49:57 2004
Subject: [Rd] A couple of issues with colClasses/setAs
In-Reply-To: <x2y8jk7rlp.fsf@biostat.ku.dk>
Message-ID: <Pine.LNX.4.44.0409081744290.24881-100000@gannet.stats>

On 8 Sep 2004, Peter Dalgaard wrote:

> Peter Dalgaard <p.dalgaard@biostat.ku.dk> writes:
> 
> > To make it actually work, we should probably fixup the "what" that is
> > being passed to scan a bit further upstreams.
> > 
> > 
> > > Might be a good idea to teach colClasses about "factor".
> > 
> > That's what I thought. Other ideas would be to predefine some standard
> > date classes (it's a bit annoying that there's no way to give
> > auxiliary information like formats), and maybe to allow a second
> > header line containing class names.
> 
> Done already, I see (except the class-header idea, which probably
> requires more thought). Thanks.

I've done some.  If you allow columns to be dropped it gets increasing 
hard to work out what as.is for example refers to, so I am looking at 
allowing named vectors.

> While we're in there should we perhaps consider adding pseudo-classes
> 
> "Ymd"
> "dmY"
> "mdY"
> "Y/m/d"
> "d/m-Y"
> "m/d/Y"
> 
> etc?  Or perhaps it is better with a catchall "Date-fmt", i.e., e.g.,
> "Date-%Y%m%d"? That'd be fairly easy to code:
> 
> else if (length(grep("^Date-",colClasses[i])))  
>         as.Date(data[[i]], sub("^Date-(.*)$","\\1", colClasses[i]))
> 
> although perhaps not so easy to document concisely.

Is it really so hard to convert such columns from character afterwards?


-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From p.dalgaard at biostat.ku.dk  Wed Sep  8 19:19:29 2004
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Wed Sep  8 19:19:55 2004
Subject: [Rd] A couple of issues with colClasses/setAs
In-Reply-To: <Pine.LNX.4.44.0409081744290.24881-100000@gannet.stats>
References: <Pine.LNX.4.44.0409081744290.24881-100000@gannet.stats>
Message-ID: <x24qm8r84e.fsf@biostat.ku.dk>

Prof Brian Ripley <ripley@stats.ox.ac.uk> writes:

> > etc?  Or perhaps it is better with a catchall "Date-fmt", i.e., e.g.,
> > "Date-%Y%m%d"? That'd be fairly easy to code:
> > 
> > else if (length(grep("^Date-",colClasses[i])))  
> >         as.Date(data[[i]], sub("^Date-(.*)$","\\1", colClasses[i]))
> > 
> > although perhaps not so easy to document concisely.
> 
> Is it really so hard to convert such columns from character afterwards?

Couldn't that be said for all of the classes?

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

From Andrea.Sa at parceirosdecomunicacao.pt  Wed Sep  8 20:14:45 2004
From: Andrea.Sa at parceirosdecomunicacao.pt (Andreia Sa)
Date: Wed Sep  8 20:13:07 2004
Subject: [Rd] =?iso-8859-1?q?Resposta_autom=E1tica_para_aus=EAncia_do_esc?=
	=?iso-8859-1?q?rit=F3rio=3A_Administration?=
Message-ID: <CADB288A47F7D1478D9F41246997759C47FB7D@srvmailstrat.STRAT-PT.pt>

Estarei fora do escrit?rio at? Dezembro 2004. I Will be out of the office  until December 04.

Na minha aus?ncia, por favor contacte:
Sofia Burnay em sofia.burnay@parceirosdecomunicacao.pt
Susana.monteiro@parceirosdecomunicacao.pt

From ripley at stats.ox.ac.uk  Wed Sep  8 20:19:57 2004
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed Sep  8 20:20:03 2004
Subject: [Rd] A couple of issues with colClasses/setAs
In-Reply-To: <x24qm8r84e.fsf@biostat.ku.dk>
Message-ID: <Pine.LNX.4.44.0409081918180.25093-100000@gannet.stats>

On 8 Sep 2004, Peter Dalgaard wrote:

> Prof Brian Ripley <ripley@stats.ox.ac.uk> writes:
> 
> > > etc?  Or perhaps it is better with a catchall "Date-fmt", i.e., e.g.,
> > > "Date-%Y%m%d"? That'd be fairly easy to code:
> > > 
> > > else if (length(grep("^Date-",colClasses[i])))  
> > >         as.Date(data[[i]], sub("^Date-(.*)$","\\1", colClasses[i]))
> > > 
> > > although perhaps not so easy to document concisely.
> > 
> > Is it really so hard to convert such columns from character afterwards?
> 
> Couldn't that be said for all of the classes?

Yes, which is why the original colClasses only dealt with those that could 
avoid conversion (where there can be large time and space benefits).

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From OBENCHAIN_ROBERT_L at Lilly.com  Thu Sep  9 01:22:53 2004
From: OBENCHAIN_ROBERT_L at Lilly.com (Robert L Obenchain)
Date: Thu Sep  9 01:23:03 2004
Subject: [Rd] Interacting with Clusters...
Message-ID: <OF70454222.55045215-ON05256F09.007F543C@EliLilly.lilly.com>

Dear R-devel,

My current research focuses upon sensitivity analyses which require

[1] clusterings of patients in a baseline covariate X-space and
[2] examining the distribution of within-cluster treatment differences in 
outcome.

I have generated some primitive R code for this, but I really need to be 
able to interact with graphical displays of within-cluster information (local average treatment effects) to 
identify individual clusters and/or compare pairs of clusters in terms for 
the X-characteristics of their patients.

Is anybody currently working on developing this sort of point-and-click 
capability in R?  I would be very interested in becoming an alpha or beta 
tester of this functionality.   ...BobO.

Bob Obenchain, PhD, Research Advisor
US Medical - Outcomes Research
Lilly Corporate Center, Indianapolis, IN 46285-5024
(317) 276-3150 voice, (317) 276-0427 fax, ochain@lilly.com
	[[alternative HTML version deleted]]

From rossini at blindglobe.net  Thu Sep  9 02:11:26 2004
From: rossini at blindglobe.net (A.J. Rossini)
Date: Thu Sep  9 02:04:28 2004
Subject: [Rd] Interacting with Clusters...
In-Reply-To: <OF70454222.55045215-ON05256F09.007F543C@EliLilly.lilly.com>
	(Robert
	L. Obenchain's message of "Wed, 08 Sep 2004 18:22:53 -0500")
References: <OF70454222.55045215-ON05256F09.007F543C@EliLilly.lilly.com>
Message-ID: <851xhcs3m9.fsf@servant.blindglobe.net>


ROrca has some of the tools you need.  I'm getting it ready for
submission (note that it requires SJava to be installed).

See 

http://www.analytics.washington.edu/~rossini/

and either get the zip package (if you have Windows) or the tar.gz
package (for Unixes).  


Robert L Obenchain <OBENCHAIN_ROBERT_L@Lilly.com> writes:

> Dear R-devel,
>
> My current research focuses upon sensitivity analyses which require
>
> [1] clusterings of patients in a baseline covariate X-space and
> [2] examining the distribution of within-cluster treatment differences in 
> outcome.
>
> I have generated some primitive R code for this, but I really need to be 
> able to interact with graphical displays of within-cluster information (local average treatment effects) to 
> identify individual clusters and/or compare pairs of clusters in terms for 
> the X-characteristics of their patients.
>
> Is anybody currently working on developing this sort of point-and-click 
> capability in R?  I would be very interested in becoming an alpha or beta 
> tester of this functionality.   ...BobO.
>
> Bob Obenchain, PhD, Research Advisor
> US Medical - Outcomes Research
> Lilly Corporate Center, Indianapolis, IN 46285-5024
> (317) 276-3150 voice, (317) 276-0427 fax, ochain@lilly.com
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel@stat.math.ethz.ch mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Anthony Rossini			    Research Associate Professor
rossini@u.washington.edu            http://www.analytics.washington.edu/ 
Biomedical and Health Informatics   University of Washington
Biostatistics, SCHARP/HVTN          Fred Hutchinson Cancer Research Center
UW (Tu/Th/F): 206-616-7630 FAX=206-543-3461 | Voicemail is unreliable
FHCRC  (M/W): 206-667-7025 FAX=206-667-4812 | use Email

CONFIDENTIALITY NOTICE: This e-mail message and any attachme...{{dropped}}

From ligges at statistik.uni-dortmund.de  Thu Sep  9 09:38:26 2004
From: ligges at statistik.uni-dortmund.de (Uwe Ligges)
Date: Thu Sep  9 09:37:05 2004
Subject: [Rd] Run up to R 2.0.0 for package maintainers
In-Reply-To: <Pine.LNX.4.44.0409070849490.8420-100000@gannet.stats>
References: <Pine.LNX.4.44.0409070849490.8420-100000@gannet.stats>
Message-ID: <41400872.8020202@statistik.uni-dortmund.de>

Prof Brian Ripley wrote:

> The major changes for R 2.0.0 are now in place, and we have provided a set 
> of notes for package maintainers at
> 
> 	http://developer.r-project.org/200update.txt
> 
> on both changes needed and new opportunities.
> 
> The main thing which needs to be done is to revise the DESCRIPTION file, 
> in particular to ensure the Depends: field is accurate.
> 
> We do run daily checks over all the CRAN packages. See
> 
> 	http://cran.r-project.org/src/contrib/checkSummary.html
> 
> (Unfortunately although the checks have been run last week, the summary 
> has not been updated since Aug 29.)
> 

Additionally, package maintainers might want to look at the checks under 
Windows:
http://cran.r-project.org/bin/windows/contrib/checkSummaryWin.html

Uwe Ligges

From andy_liaw at merck.com  Thu Sep  9 12:36:43 2004
From: andy_liaw at merck.com (Liaw, Andy)
Date: Thu Sep  9 12:37:15 2004
Subject: [Rd] Run up to R 2.0.0 for package maintainers
Message-ID: <3A822319EB35174CA3714066D590DCD504AF8354@usrymx25.merck.com>

> From: Uwe Ligges
> 
> Prof Brian Ripley wrote:
> 
> > The major changes for R 2.0.0 are now in place, and we have 
> provided a set 
> > of notes for package maintainers at
> > 
> > 	http://developer.r-project.org/200update.txt
> > 
> > on both changes needed and new opportunities.
> > 
> > The main thing which needs to be done is to revise the 
> DESCRIPTION file, 
> > in particular to ensure the Depends: field is accurate.
> > 
> > We do run daily checks over all the CRAN packages. See
> > 
> > 	http://cran.r-project.org/src/contrib/checkSummary.html
> > 
> > (Unfortunately although the checks have been run last week, 
> the summary 
> > has not been updated since Aug 29.)

Am I missing something?  I just checked, and the summary ends at
`logistf'...

(The top of that page now says "Last updated on 2004-09-06 20:26:18".)

Andy


> 
> Additionally, package maintainers might want to look at the 
> checks under 
> Windows:
> http://cran.r-project.org/bin/windows/contrib/checkSummaryWin.html
> 
> Uwe Ligges
> 
> ______________________________________________
> R-devel@stat.math.ethz.ch mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
>

From ripley at stats.ox.ac.uk  Thu Sep  9 12:43:40 2004
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu Sep  9 12:43:43 2004
Subject: [Rd] Run up to R 2.0.0 for package maintainers
In-Reply-To: <3A822319EB35174CA3714066D590DCD504AF8354@usrymx25.merck.com>
Message-ID: <Pine.LNX.4.44.0409091141490.1182-100000@gannet.stats>

On Thu, 9 Sep 2004, Liaw, Andy wrote:

> > From: Uwe Ligges
> > 
> > Prof Brian Ripley wrote:
> > 
> > > The major changes for R 2.0.0 are now in place, and we have 
> > provided a set 
> > > of notes for package maintainers at
> > > 
> > > 	http://developer.r-project.org/200update.txt
> > > 
> > > on both changes needed and new opportunities.
> > > 
> > > The main thing which needs to be done is to revise the 
> > DESCRIPTION file, 
> > > in particular to ensure the Depends: field is accurate.
> > > 
> > > We do run daily checks over all the CRAN packages. See
> > > 
> > > 	http://cran.r-project.org/src/contrib/checkSummary.html
> > > 
> > > (Unfortunately although the checks have been run last week, 
> > the summary 
> > > has not been updated since Aug 29.)
> 
> Am I missing something?  I just checked, and the summary ends at
> `logistf'...
> 
> (The top of that page now says "Last updated on 2004-09-06 20:26:18".)

It didn't when I sent that message.  I did note there was a problem,
and it said it had been updated last week even when it had not.

It looks like we need to wait until CRAN is manned again (next week) for 
this to be resolved.

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From wolski at molgen.mpg.de  Thu Sep  9 15:57:36 2004
From: wolski at molgen.mpg.de (Wolski)
Date: Thu Sep  9 15:57:45 2004
Subject: [Rd] as(object,"list")  as(object,"matrix") differences?
In-Reply-To: <413F12EB.5F76BBA5@research.bell-labs.com>
References: <200409071617210704.0504144D@mail.math.fu-berlin.de>
	<413DD80C.2D5EA9C9@research.bell-labs.com>
	<200409081219020786.0B1B546F@mail.math.fu-berlin.de>
	<413F12EB.5F76BBA5@research.bell-labs.com>
Message-ID: <200409091557360623.0F3F7FD6@mail.math.fu-berlin.de>

Hi!

First of all thanks a lot to John Chambers.  I think S4 makes some tasks really easier. 
This mail tries to summarise the mail exchange concerning contains="list" in S4.
I do not know all the R "internals" so instead of talking I try to use and to play around with S4. People like I learn by example. But I would like to use all features of S4. I dont say that anything is good or bad. I just ask on which parts and features can I rely on? About which parts of methods I be sure that there are not going to change in the nearest future? And making a search on several hundred packages in the lib directory, and finding that setAs is used only in the file methods/R-ex/as.R its not reassuring.

I like to use S4 and i like to use lists.

I like to use lists like maps or multimaps with key value pairs. I believe that I am not the only one who uses lists to store different types of objects and to access them using mylist[["key"]]. So in my opinion list had have and should have names. (I am not a phyton user yet but I know that phyton has also a data structure to store key value pairs and it is a quite important one.)

R provides a lot of powerfull functions which are operating on "lists" like sapply, lapply, mapply, [[]] [] etc.... 
And all the list methods lapply, [], etc preserve the list names. So if they "return a type" are "list" then list have names.  But as I said i understand examples and so probably nothing new to what you have already said. And I think that my examples will show that even in S4 except for the function as(object,"list") old style "list" have names attribute.

If I write a new class, and this class is a mainly a container class, I would like rather inherit from a list (contains="list") with names rather then include it (include means representation(list="list") like e.g. class Biobase:container does). I like to inherit because I would not like to wrap every possible list function which is available for lists. Its just because I even not know all of them. And if I have inheritance as a tool this is not neceassary. Any function working on lists can be used on a class inheriting from list.

The following code summarizes, by example, how names are treated when "list" is "contained" by a class. 
I show 3 versions how to inherit from "list" showing the problems with the 'naive' inheritance.
And I think that the example shows also that in S4 the old styl "list" class are with "names"! 
There are also some inconsistencies, bugs which I am going to show on occasion?



#NAIVE inheritance from list.
#define cass
setClass("ListWithNames","list")
setClass("Mlist"
         ,representation(info="character") #uniq names have to be unique?
         ,contains="ListWithNames"
         ,prototype(uniq=FALSE)
         )
         
tmp <- as.list(1:4)
names(tmp) <- letters[1:4]
mylist<-new("Mlist" , tmp , info="numeric" )

#Example of manipulating the list part of the object. 
as(mylist,"list")<-lapply(mylist,"+",3)
as(mylist,"list") <- mylist[2:4]

as(mylist,"list") <- as(mylist,"ListWithNames")[2:4]


#what does not work is assigning shorter lists without names. Seems like a bug. Or is there an explanation.
as(mylist,"list")<-as.list(1:5)
as(mylist,"list")<-as.list(1:4)

class(Mlist)
#I have not defined in class Representation 
# a names attribute but there is the name attribute anyway inherited by from list.

mylist@names

# But this does not work. Of course.
mylist@names <- letters[5:9]

#Slots are implemented using attributes?

attributes(mylist@.Data)$names #this is what is expected.
attributes(mylist)$names #But whats this?
attributes(mylist)$names <- letters[2:11]  
attributes(mylist@.Data)$names #are they the same? synchronized?

# So if @names are there why not make it official ?
# I make it official with a new class definition.
# REFINED version of "list" inheritance.

setClass("MlistN"
         ,representation(info="character",names="character") #uniq names have to be unique?
         ,contains="ListWithNames"
         )

mylistNam<-new("MlistN" , tmp , info="numeric")
mylistNam@names<-letters[4:7]
mylistNam["d"]
mylistNam[["d"]]

as(mylistNam,"list")<-tmp[1:3]

as(mylistNam,"list")<-as.list(1:4) 
as(mylistNam,"list")<-as.list(1:3) #<- the same error as before.
as(mylistNam,"list")<-list(a=1,b=2,c=3,d=4)

#to get it more complicated
as(mylistNam,"ListWithNames") # Is without names??

## MORE REFINED version of list inheritance.
setClass("MlistN"
         ,representation(info="character",names="character") #uniq names have to be unique?
         ,contains="list"
         )

# I dont like the as(o,"list") 
# My Solution. Now it does not mether wheter the list has or has not names is longer or shorter.

setAs("MlistN","list"
	,def=function(from){
		print("test")
		to<-from@.Data
		names(to)<-from@names
		to
	}
	,replace=function(from,value)
	{
		from@.Data<-value
		from@names<-names(value)
		from	
	}
 )


bublegum <- list(b=1, u=3, b=4, l=4, e=2, g=1, u=4, m=2)
mylistNam <- bublegum
bubl<-bublegum[1:4]
names(bubl)<-NULL
as(mylistNam,"list") <- bubl

I have just one question: Can I rely that this is not going to change in further versions of R? 

/E

From jmc at research.bell-labs.com  Thu Sep  9 17:41:33 2004
From: jmc at research.bell-labs.com (John Chambers)
Date: Thu Sep  9 17:41:51 2004
Subject: [Rd] as(object,"list")  as(object,"matrix") differences?
References: <200409071617210704.0504144D@mail.math.fu-berlin.de>
	<413DD80C.2D5EA9C9@research.bell-labs.com>
	<200409081219020786.0B1B546F@mail.math.fu-berlin.de>
	<413F12EB.5F76BBA5@research.bell-labs.com>
	<200409091557360623.0F3F7FD6@mail.math.fu-berlin.de>
Message-ID: <414079AD.A9307DF6@research.bell-labs.com>

If the only issue is whether as(x, "list") preserves the names
attribute, this is certainly an easy change to implement, if the R
community decides that's the better solution.

With the release of 2.0 only a few weeks away, there's not much chance
of resolving the question for that version.  Although the change is
simple, there may be some implications that will not arise until a good
deal of testing is done.  So a more likely target is to resolve the
question for version 2.1.

By the way, one argument in your favor is that S-Plus retains the names
in as(x, "list") (but not in as(x, "numeric"), even if x had names in
that case).  So a closer approximation to compatibility with the
behavior of S-Plus would retain names.  (I'm not quite convinced this is
what the discussion in the green book would imply, but it's what
happens!)

If others have opinions, it would be good to hear them.

Meanwhile, a candidate for the simplest workaround:  Have new classes
extend the class "listNamed" defined below, rather than "list" directly,
and as(x, "list") should retain names, I think.

---------------------------------------------
setClass("listNamed", "list")

setAs("listNamed", "list", function(from) {
    if(strict) class(from) <- "list"
    from
})
---------------------------------------------

Although not necessary for correctness, it's probably good to add the
following method for "show".  (With the default method, names are not
printed, even though they are there--users are likely to be confused.)

---------------------------------------------
setMethod("show", "listNamed",
          function(object) {
              cat("An object of class ", class(object), "\n", sep="")
              show(as(object, "list"))
          })
---------------------------------------------

(By the way, the workaround depends on the bug fix to setAs committed
recently to r-devel, so if you try this you should use the latest
version.)

Wolski wrote:
> 
> Hi!
> 
> First of all thanks a lot to John Chambers.  I think S4 makes some tasks really easier.
> This mail tries to summarise the mail exchange concerning contains="list" in S4.
> I do not know all the R "internals" so instead of talking I try to use and to play around with S4. People like I learn by example. But I would like to use all features of S4. I dont say that anything is good or bad. I just ask on which parts and features can I rely on? About which parts of methods I be sure that there are not going to change in the nearest future? And making a search on several hundred packages in the lib directory, and finding that setAs is used only in the file methods/R-ex/as.R its not reassuring.
> 
> I like to use S4 and i like to use lists.
> 
> I like to use lists like maps or multimaps with key value pairs. I believe that I am not the only one who uses lists to store different types of objects and to access them using mylist[["key"]]. So in my opinion list had have and should have names. (I am not a phyton user yet but I know that phyton has also a data structure to store key value pairs and it is a quite important one.)
> 
> R provides a lot of powerfull functions which are operating on "lists" like sapply, lapply, mapply, [[]] [] etc....
> And all the list methods lapply, [], etc preserve the list names. So if they "return a type" are "list" then list have names.  But as I said i understand examples and so probably nothing new to what you have already said. And I think that my examples will show that even in S4 except for the function as(object,"list") old style "list" have names attribute.
> 
> If I write a new class, and this class is a mainly a container class, I would like rather inherit from a list (contains="list") with names rather then include it (include means representation(list="list") like e.g. class Biobase:container does). I like to inherit because I would not like to wrap every possible list function which is available for lists. Its just because I even not know all of them. And if I have inheritance as a tool this is not neceassary. Any function working on lists can be used on a class inheriting from list.
> 
> The following code summarizes, by example, how names are treated when "list" is "contained" by a class.
> I show 3 versions how to inherit from "list" showing the problems with the 'naive' inheritance.
> And I think that the example shows also that in S4 the old styl "list" class are with "names"!
> There are also some inconsistencies, bugs which I am going to show on occasion?
> 
> #NAIVE inheritance from list.
> #define cass
> setClass("ListWithNames","list")
> setClass("Mlist"
>          ,representation(info="character") #uniq names have to be unique?
>          ,contains="ListWithNames"
>          ,prototype(uniq=FALSE)
>          )
> 
> tmp <- as.list(1:4)
> names(tmp) <- letters[1:4]
> mylist<-new("Mlist" , tmp , info="numeric" )
> 
> #Example of manipulating the list part of the object.
> as(mylist,"list")<-lapply(mylist,"+",3)
> as(mylist,"list") <- mylist[2:4]
> 
> as(mylist,"list") <- as(mylist,"ListWithNames")[2:4]
> 
> #what does not work is assigning shorter lists without names. Seems like a bug. Or is there an explanation.
> as(mylist,"list")<-as.list(1:5)
> as(mylist,"list")<-as.list(1:4)
> 
> class(Mlist)
> #I have not defined in class Representation
> # a names attribute but there is the name attribute anyway inherited by from list.
> 
> mylist@names
> 
> # But this does not work. Of course.
> mylist@names <- letters[5:9]
> 
> #Slots are implemented using attributes?
> 
> attributes(mylist@.Data)$names #this is what is expected.
> attributes(mylist)$names #But whats this?
> attributes(mylist)$names <- letters[2:11]
> attributes(mylist@.Data)$names #are they the same? synchronized?
> 
> # So if @names are there why not make it official ?
> # I make it official with a new class definition.
> # REFINED version of "list" inheritance.
> 
> setClass("MlistN"
>          ,representation(info="character",names="character") #uniq names have to be unique?
>          ,contains="ListWithNames"
>          )
> 
> mylistNam<-new("MlistN" , tmp , info="numeric")
> mylistNam@names<-letters[4:7]
> mylistNam["d"]
> mylistNam[["d"]]
> 
> as(mylistNam,"list")<-tmp[1:3]
> 
> as(mylistNam,"list")<-as.list(1:4)
> as(mylistNam,"list")<-as.list(1:3) #<- the same error as before.
> as(mylistNam,"list")<-list(a=1,b=2,c=3,d=4)
> 
> #to get it more complicated
> as(mylistNam,"ListWithNames") # Is without names??
> 
> ## MORE REFINED version of list inheritance.
> setClass("MlistN"
>          ,representation(info="character",names="character") #uniq names have to be unique?
>          ,contains="list"
>          )
> 
> # I dont like the as(o,"list")
> # My Solution. Now it does not mether wheter the list has or has not names is longer or shorter.
> 
> setAs("MlistN","list"
>         ,def=function(from){
>                 print("test")
>                 to<-from@.Data
>                 names(to)<-from@names
>                 to
>         }
>         ,replace=function(from,value)
>         {
>                 from@.Data<-value
>                 from@names<-names(value)
>                 from
>         }
>  )
> 
> bublegum <- list(b=1, u=3, b=4, l=4, e=2, g=1, u=4, m=2)
> mylistNam <- bublegum
> bubl<-bublegum[1:4]
> names(bubl)<-NULL
> as(mylistNam,"list") <- bubl
> 
> I have just one question: Can I rely that this is not going to change in further versions of R?
> 
> /E

-- 
John M. Chambers                  jmc@bell-labs.com
Bell Labs, Lucent Technologies    office: (908)582-2681
700 Mountain Avenue, Room 2C-282  fax:    (908)582-3340
Murray Hill, NJ  07974            web: http://www.cs.bell-labs.com/~jmc

From epurdom at stanford.edu  Thu Sep  9 18:46:34 2004
From: epurdom at stanford.edu (epurdom@stanford.edu)
Date: Thu Sep  9 18:46:37 2004
Subject: [Rd] hist( ) fails with 'Inf' values unlike plot( ) (PR#7220)
Message-ID: <20040909164634.6267610451@slim.kubism.ku.dk>

Full_Name: Elizabeth Purdom
Version: 1.9.1
OS: Windows
Submission from: (NULL) (171.64.102.192)


hist() fails if encounters 'Inf' value, rather than giving warning and removing.
Other graphics, like plot(), don't have this problem. It's actually rather
confusing if you are taking the log of data real valued data with a few
non-positive numbers. hist() works fine in this situation unless you happen to
have an exact 0, as oppose to just negative numbers. Then log(0)=Inf while
log(-1)=NA and NA values are removed by the program while Inf kills it. At least
a better error message would be good, because as it is, it looks like the
program can't handle NAs. 

> x<-seq(-5,100,by=1)
##Gives error, no output
> hist(log(x))
Error in pretty(range(x), n = breaks, min.n = 1) : 
        NA/NaN/Inf in foreign function call (arg 1)
In addition: Warning message: 
NaNs produced in: log(x) 
##Gives log() warning
> hist(log(x)[!is.infinite(log(x))])
Warning messages: 
1: NaNs produced in: log(x) 
2: NaNs produced in: log(x)

From f.harrell at vanderbilt.edu  Thu Sep  9 18:49:43 2004
From: f.harrell at vanderbilt.edu (Frank E Harrell Jr)
Date: Thu Sep  9 18:48:09 2004
Subject: [Rd] Rd syntax error detected in CRAN daily checks
Message-ID: <414089A7.4000605@vanderbilt.edu>

Please forgive me if you already received this.  I had an e-mail sending 
glitch this morning.


http://cran.r-project.org/src/contrib/checkSummary.html reported an 
error in Design.trans.Rd

* checking Rd files ... ERROR
Rd files with syntax errors:
   /var/mnt/hda3/R.check/r-devel/PKGS/Design/man/Design.trans.Rd:
     unterminated section 'alias'

The .Rd file is attached.  It begins with

\name{Design.trans}
\alias{Design.trans}
\alias{asis}
\alias{pol}
\alias{lsp}
\alias{rcs}
\alias{catg}
\alias{scored}
\alias{strat}
\alias{matrx}
\alias{\%ia\%}
\title{
Design Special Transformation Functions
}
\description{
This is a series of functions (\code{asis}, \code{pol}, \code{lsp},
....

No error is detected when I run CMD CHECK using the latest R-devel 
locally, using the 5 Sep 04 version.  I would appreciate assistance. 
Please cc: me because I get r-devel in digest format.

Thanks -Frank
-- 
Frank E Harrell Jr   Professor and Chair           School of Medicine
                      Department of Biostatistics   Vanderbilt University
-------------- next part --------------
\name{Design.trans}
\alias{Design.trans}
\alias{asis}
\alias{pol}
\alias{lsp}
\alias{rcs}
\alias{catg}
\alias{scored}
\alias{strat}
\alias{matrx}
\alias{\%ia\%}
\title{
Design Special Transformation Functions
}
\description{
This is a series of functions (\code{asis}, \code{pol}, \code{lsp}, \code{rcs}, \code{catg},
\code{scored}, \code{strat}, \code{matrx}, and \code{\%ia\%}) that set up special attributes 
(such as
knots and nonlinear term indicators) that are carried through to fits
(using for example \code{lrm},\code{cph}, \code{ols}, \code{psm}). \code{anova.Design}, \code{summary.Design},
\code{plot.Design}, \code{survplot}, \code{fastbw}, \code{validate}, \code{specs}, 
\code{which.influence}, \code{nomogram.Design} and \code{latex.Design} use these
attributes to automate certain analyses (e.g., automatic tests of linearity
for each predictor are done by \code{anova.Design}). Many of the functions
are called implicitly.  Some S functions such as \code{ns} derive data-dependent
transformations that are not "remembered" when predicted values are
later computed, so the predictions will be incorrect. The functions listed
here solve that problem. 


\code{asis} is the identity transformation, \code{pol} is an ordinary (non-orthogonal) polynomial, \code{rcs} is
a linear tail-restricted cubic spline function (natural spline, for which the
\code{rcspline.eval} function generates the design matrix),
\code{catg} is for a categorical
variable, \code{scored} is for an ordered categorical
variable, \code{strat} is for a stratification factor
in a Cox model, \code{matrx} is for a matrix predictor, and \code{\%ia\%} represents
restricted interactions in which products involving nonlinear effects on both
variables are not included in the model.  \code{asis, catg, scored, matrx} are seldom invoked
explicitly by the user (only to specify \code{label} or \code{name}, usually).

In the list below, functions \code{asis} through \code{strat} can have
arguments \code{x, parms, label, name} except that \code{parms} does not
apply to \code{asis, matrx, strat}.
}
\synopsis{
asis(\dots)
matrx(\dots)
pol(\dots)
lsp(\dots)
rcs(\dots)
catg(\dots)
scored(\dots)
strat(\dots)
\%ia\%(x1, x2)
}
\usage{
asis(x, parms, label, name)
matrx(x, label, name)
pol(x, parms, label, name)
lsp(x, parms, label, name)
rcs(x, parms, label, name)
catg(x, parms, label, name)
scored(x, parms, label, name)
strat(x, label, name)
\%ia\%(x1, x2)
}
\arguments{
\item{x}{
a predictor variable (or a function of one).  If you specify e.g.
\code{pol(pmin(age,10),3)}, a cubic polynomial will be fitted in \code{pmin(age,10)}
(\code{pmin} is the S vector element--by--element function).
The predictor will be labeled \code{age} in the output, and plots with have
\code{age} in its original units on the axes. If you use a function such as
\code{pmin}, the predictor is taken as the first argument, and other arguments
must be defined in the frame in effect when predicted values, etc., are
computed.
}
\item{parms}{
parameters of transformation (e.g. number or location of knots).
For \code{pol} the argument is the order of the polynomial,
e.g. \code{2} for quadratic (the usual default). For \code{lsp} it is a
vector of knot locations (\code{lsp} will not estimate knot locations).
For \code{rcs} it is the
number of knots (if scalar), or vector of knot locations (if \code{>2} elements).
The default number is the \code{nknots} system option if \code{parms} is not given.
If the number of knots is given,
locations are computed for that number of knots.
For \code{catg}, \code{parms} is the
category labels (not needed if variable is an S category or factor variable). If
omitted, \code{catg} will use \code{unique(x)}, or \code{levels(x)} if \code{x} is a \code{category}
or a \code{factor}.
For \code{scored}, \code{parms} is a
vector of unique values of variable (uses \code{unique(x)} by default).
This is not needed if \code{x} is an S \code{ordered} variable.
For \code{strat}, \code{parms} is the category labels (not needed if variable is an S category variable). If
omitted, will use \code{unique(x)}, or \code{levels(x)} if \code{x} is
\code{category} or \code{factor}.
\code{parms} is not used for \code{matrix}.
}
\item{label}{
label of predictor for plotting (default = \code{"label"} attribute or variable
name)
}
\item{name}{
Name to use for predictor in model. Default is name of argument to
function
}
\item{x1}{}
\item{x2}{two continuous variables for which to form a
  non-doubly-nonlinear interaction}
\item{\dots}{a variety of things}
}
\author{
Frank Harrell\cr
Department of Biostatistics, Vanderbilt University\cr
f.harrell@vanderbilt.edu
}
\seealso{
\code{\link[Hmisc]{rcspline.eval}}, \code{\link[Hmisc]{rcspline.restate}}, \code{\link{Design}}, \code{\link{cph}}, \code{\link{lrm}}, \code{\link{ols}}, \code{\link{datadist}}
}
\examples{
\dontrun{
options(knots=4, poly.degree=2)
country <- factor(country.codes)
blood.pressure <- cbind(sbp=systolic.bp, dbp=diastolic.bp)
fit <- lrm(Y ~ sqrt(x1)*rcs(x2) + rcs(x3,c(5,10,15)) + 
       lsp(x4,c(10,20)) + country + blood.pressure + poly(age,2))
# sqrt(x1) is an implicit asis variable, but limits of x1, not sqrt(x1)
#       are used for later plotting and effect estimation
# x2 fitted with restricted cubic spline with 4 default knots
# x3 fitted with r.c.s. with 3 specified knots
# x4 fitted with linear spline with 2 specified knots
# country is an implied catg variable
# blood.pressure is an implied matrx variable
# since poly is not a Design function (pol is), it creates a
#       matrx type variable with no automatic linearity testing
#       or plotting
f1 <- lrm(y ~ rcs(x1) + rcs(x2) + rcs(x1) \%ia\% rcs(x2))
# \%ia\% restricts interactions. Here it removes terms nonlinear in
# both x1 and x2
f2 <- lrm(y ~ rcs(x1) + rcs(x2) + x1 \%ia\% rcs(x2))
# interaction linear in x1
f3 <- lrm(y ~ rcs(x1) + rcs(x2) + x1 \%ia\% x2)
# simple product interaction (doubly linear)
# Use x1 \%ia\% x2 instead of x1:x2 because x1 \%ia\% x2 triggers
# anova to pool x1*x2 term into x1 terms to test total effect
# of x1
}
}
\keyword{models}
\keyword{regression}
\keyword{math}
\keyword{manip}
\keyword{methods}
\keyword{survival}
\keyword{smooth}
\concept{logistic regression model}
\concept{transformation}
From ripley at stats.ox.ac.uk  Thu Sep  9 18:56:05 2004
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu Sep  9 18:56:10 2004
Subject: [Rd] Rd syntax error detected in CRAN daily checks
In-Reply-To: <414089A7.4000605@vanderbilt.edu>
Message-ID: <Pine.LNX.4.44.0409091753050.1605-100000@gannet.stats>

Frank,

The version of Design on CRAN

Package: Design
Version: 2.0-8
Date: 2004-05-31

has

\alias{%ia%}

and that has two unescaped comment characters which I guess you have
already fixed.

Brian


On Thu, 9 Sep 2004, Frank E Harrell Jr wrote:

> Please forgive me if you already received this.  I had an e-mail sending 
> glitch this morning.
> 
> 
> http://cran.r-project.org/src/contrib/checkSummary.html reported an 
> error in Design.trans.Rd
> 
> * checking Rd files ... ERROR
> Rd files with syntax errors:
>    /var/mnt/hda3/R.check/r-devel/PKGS/Design/man/Design.trans.Rd:
>      unterminated section 'alias'
> 
> The .Rd file is attached.  It begins with
> 
> \name{Design.trans}
> \alias{Design.trans}
> \alias{asis}
> \alias{pol}
> \alias{lsp}
> \alias{rcs}
> \alias{catg}
> \alias{scored}
> \alias{strat}
> \alias{matrx}
> \alias{\%ia\%}
> \title{
> Design Special Transformation Functions
> }
> \description{
> This is a series of functions (\code{asis}, \code{pol}, \code{lsp},
> ....
> 
> No error is detected when I run CMD CHECK using the latest R-devel 
> locally, using the 5 Sep 04 version.  I would appreciate assistance. 
> Please cc: me because I get r-devel in digest format.

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From p.dalgaard at biostat.ku.dk  Thu Sep  9 19:16:03 2004
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Thu Sep  9 19:16:34 2004
Subject: [Rd] Run up to R 2.0.0 for package maintainers
In-Reply-To: <Pine.LNX.4.44.0409091141490.1182-100000@gannet.stats>
References: <Pine.LNX.4.44.0409091141490.1182-100000@gannet.stats>
Message-ID: <x24qm7wegc.fsf@biostat.ku.dk>

Prof Brian Ripley <ripley@stats.ox.ac.uk> writes:


> > > > (Unfortunately although the checks have been run last week, 
> > > the summary 
> > > > has not been updated since Aug 29.)
> > 
> > Am I missing something?  I just checked, and the summary ends at
> > `logistf'...
> > 
> > (The top of that page now says "Last updated on 2004-09-06 20:26:18".)
> 
> It didn't when I sent that message.  I did note there was a problem,
> and it said it had been updated last week even when it had not.
> 
> It looks like we need to wait until CRAN is manned again (next week) for 
> this to be resolved.

Fritz tried to fix it on Monday and failed, so we're probably seeing
the point that he couldn't get past. Need to wait for Kurt, or a Fritz
with more time on his hand.

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

From andy_liaw at merck.com  Thu Sep  9 19:33:33 2004
From: andy_liaw at merck.com (Liaw, Andy)
Date: Thu Sep  9 19:34:05 2004
Subject: [Rd] Run up to R 2.0.0 for package maintainers
Message-ID: <3A822319EB35174CA3714066D590DCD504AF835E@usrymx25.merck.com>

Thanks to Peter and Brian for the info.  Also, thanks to Fritz and Kurt for
the fantastic service they provided!!

Best,
Andy

> -----Original Message-----
> From: Peter Dalgaard [mailto:p.dalgaard@biostat.ku.dk] 
> Sent: Thursday, September 09, 2004 1:16 PM
> To: Prof Brian Ripley
> Cc: Liaw, Andy; R-devel@r-project.org; 'Uwe Ligges'
> Subject: Re: [Rd] Run up to R 2.0.0 for package maintainers
> 
> 
> Prof Brian Ripley <ripley@stats.ox.ac.uk> writes:
> 
> 
> > > > > (Unfortunately although the checks have been run last week, 
> > > > the summary 
> > > > > has not been updated since Aug 29.)
> > > 
> > > Am I missing something?  I just checked, and the summary ends at
> > > `logistf'...
> > > 
> > > (The top of that page now says "Last updated on 
> 2004-09-06 20:26:18".)
> > 
> > It didn't when I sent that message.  I did note there was a problem,
> > and it said it had been updated last week even when it had not.
> > 
> > It looks like we need to wait until CRAN is manned again 
> (next week) for 
> > this to be resolved.
> 
> Fritz tried to fix it on Monday and failed, so we're probably seeing
> the point that he couldn't get past. Need to wait for Kurt, or a Fritz
> with more time on his hand.
> 
> -- 
>    O__  ---- Peter Dalgaard             Blegdamsvej 3  
>   c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
>  (*) \(*) -- University of Copenhagen   Denmark      Ph: 
> (+45) 35327918
> ~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: 
> (+45) 35327907
> 
>

From f.harrell at vanderbilt.edu  Thu Sep  9 19:35:51 2004
From: f.harrell at vanderbilt.edu (Frank E Harrell Jr)
Date: Thu Sep  9 19:34:21 2004
Subject: [Rd] Rd syntax error detected in CRAN daily checks
Message-ID: <41409477.10706@vanderbilt.edu>

Brian Ripley pointed out that I had forgotten how old is the version of 
Design on CRAN.  The problem was already fixed.  Sorry for the bother -Frank

From jaroslaw.w.tuszynski at saic.com  Thu Sep  9 20:01:32 2004
From: jaroslaw.w.tuszynski at saic.com (jaroslaw.w.tuszynski@saic.com)
Date: Thu Sep  9 20:01:39 2004
Subject: [Rd] function "apply" and 3D arrays (PR#7221)
Message-ID: <20040909180132.7977A10460@slim.kubism.ku.dk>

Full_Name: jarek tuszynski
Version: 1.8.1
OS: windows 2000
Submission from: (NULL) (198.151.13.10)


Example code:
> a=array(1:27, c(3,3,3))
> apply(a,2, var)
      [,1] [,2] [,3]
 [1,]    1    1    1
 [2,]    1    1    1
 [3,]    1    1    1
 [4,]    1    1    1
 [5,]    1    1    1
 [6,]    1    1    1
 [7,]    1    1    1
 [8,]    1    1    1
 [9,]    1    1    1
> apply(a,2, mean)
[1] 11 14 17
> apply(a,2, sd)
     [,1] [,2] [,3]
[1,]    1    1    1
[2,]    1    1    1
[3,]    1    1    1

I could not figure out from the documentation how MARGIN argument of function
"apply" works in case of arrays with dimentions larger than 2, so I created the
above test code. I still do not know how it suppose to work but I should not get
the results with different dimentions, while calculating var and sd.

Hope this helps,

Jarek

From rossini at blindglobe.net  Thu Sep  9 20:07:59 2004
From: rossini at blindglobe.net (A.J. Rossini)
Date: Thu Sep  9 20:07:32 2004
Subject: [Rd] man page of hist points to truehist,
 which can't be viewed without loading a library?
Message-ID: <85brgfiadc.fsf@servant.blindglobe.net>


rdevel from yesterday, also in 1.9.1 (Debian, -3).

The man page of 'hist' (from the graphics package, obtained by
"?hist") suggests 'truehist' under "see also", but 'truehist' isn't
loaded by default (a sensible "of course"), so that "?truehist" fails.
One can do help.search(), of course, which points what to do, but
leads to my question:

  In referencing functions in other packages, should the "See Also"
  link mention the library that they are coming from?  I'm less
  concerned about the example and more concerned about some packages
  I'm wrapping up.

(this was from the command line in a terminal window, not w/in ESS).

best,
-tony

-- 
Anthony Rossini			    Research Associate Professor
rossini@u.washington.edu            http://www.analytics.washington.edu/ 
Biomedical and Health Informatics   University of Washington
Biostatistics, SCHARP/HVTN          Fred Hutchinson Cancer Research Center
UW (Tu/Th/F): 206-616-7630 FAX=206-543-3461 | Voicemail is unreliable
FHCRC  (M/W): 206-667-7025 FAX=206-667-4812 | use Email

CONFIDENTIALITY NOTICE: This e-mail message and any attachme...{{dropped}}

From andy_liaw at merck.com  Thu Sep  9 20:22:38 2004
From: andy_liaw at merck.com (Liaw, Andy)
Date: Thu Sep  9 20:23:00 2004
Subject: [Rd] function "apply" and 3D arrays (PR#7221)
Message-ID: <3A822319EB35174CA3714066D590DCD504AF8363@usrymx25.merck.com>

The `problem', I think, is your expectation that the output of apply(a, 2,
var) to be of the same dimension as apply(a, 2, sd) if a has dimensions > 2.
Note that:

> sd(matrix(1:9, 3, 3))
[1] 1 1 1
> var(matrix(1:9, 3, 3))
     [,1] [,2] [,3]
[1,]    1    1    1
[2,]    1    1    1
[3,]    1    1    1

because var(), when given a matrix, returns the variance-covariance matrix
of the columns.

The output of sd() can be a bit surprising:

> sd(array(1:27, rep(3, 3)))
[1] 7.937254

This is because sd() looks like:

> sd
function (x, na.rm = FALSE) 
{
    if (is.matrix(x)) 
        apply(x, 2, sd, na.rm = na.rm)
    else if (is.vector(x)) 
        sqrt(var(x, na.rm = na.rm))
    else if (is.data.frame(x)) 
        sapply(x, sd, na.rm = na.rm)
    else sqrt(var(as.vector(x), na.rm = na.rm))
}

So for matrices and data frames, sd() returns the column standard
deviations.  Otherwise it treats the input as a vector and compute the SD.

Andy


> From: jaroslaw.w.tuszynski@saic.com
> 
> Full_Name: jarek tuszynski
> Version: 1.8.1
> OS: windows 2000
> Submission from: (NULL) (198.151.13.10)
> 
> 
> Example code:
> > a=array(1:27, c(3,3,3))
> > apply(a,2, var)
>       [,1] [,2] [,3]
>  [1,]    1    1    1
>  [2,]    1    1    1
>  [3,]    1    1    1
>  [4,]    1    1    1
>  [5,]    1    1    1
>  [6,]    1    1    1
>  [7,]    1    1    1
>  [8,]    1    1    1
>  [9,]    1    1    1
> > apply(a,2, mean)
> [1] 11 14 17
> > apply(a,2, sd)
>      [,1] [,2] [,3]
> [1,]    1    1    1
> [2,]    1    1    1
> [3,]    1    1    1
> 
> I could not figure out from the documentation how MARGIN 
> argument of function
> "apply" works in case of arrays with dimentions larger than 
> 2, so I created the
> above test code. I still do not know how it suppose to work 
> but I should not get
> the results with different dimentions, while calculating var and sd.
> 
> Hope this helps,
> 
> Jarek
> 
> ______________________________________________
> R-devel@stat.math.ethz.ch mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
>

From wolski at molgen.mpg.de  Thu Sep  9 20:26:40 2004
From: wolski at molgen.mpg.de (Wolski)
Date: Thu Sep  9 20:26:48 2004
Subject: [Rd] as(object,"list")  as(object,"matrix") differences?
In-Reply-To: <413F12EB.5F76BBA5@research.bell-labs.com>
References: <200409071617210704.0504144D@mail.math.fu-berlin.de>
	<413DD80C.2D5EA9C9@research.bell-labs.com>
	<200409081219020786.0B1B546F@mail.math.fu-berlin.de>
	<413F12EB.5F76BBA5@research.bell-labs.com>
Message-ID: <200409092026400894.103612E2@mail.math.fu-berlin.de>

Hi!

Is this behaviour intended? Now no, nie, niente names are possible. Is this intended?
Please run the sample code below.

R : Copyright 2004, The R Foundation for Statistical Computing
Version 2.0.0 alpha (2004-09-09), ISBN 3-900051-07-0

setClass("listNamed", "list")
setAs("listNamed", "list", function(from) {
   if(strict) class(from) <- "list"
   from
   })

setMethod("show", "listNamed",
          function(object) {
              cat("An object of class ", class(object), "\n", sep="")
              show(as(object, "list"))
          })

                                                                                                                                                                                                                                            
                                        #NAIVE inheritance from list.
                                        #define cass

setClass("Mlist"
         ,representation(info="character") #uniq names have to be unique?
         ,contains="listNamed"
         )
         
tmp <- as.list(1:4)
names(tmp) <- letters[1:4]
mylist<-new("Mlist" , tmp , info="numeric" )
mylist

/E


Dipl. bio-chem. Eryk Witold Wolski             @    MPI-Moleculare Genetic   
Ihnestrasse 63-73 14195 Berlin                'v'                            
tel: 0049-30-83875219                        /   \                           
mail: witek96@users.sourceforge.net        ---W-W----                        
http://r4proteomics.sourceforg.net

From tplate at blackmesacapital.com  Thu Sep  9 20:29:53 2004
From: tplate at blackmesacapital.com (Tony Plate)
Date: Thu Sep  9 20:30:19 2004
Subject: [Rd] function "apply" and 3D arrays (PR#7221)
In-Reply-To: <20040909180132.7977A10460@slim.kubism.ku.dk>
References: <20040909180132.7977A10460@slim.kubism.ku.dk>
Message-ID: <6.1.0.6.2.20040909121949.05a35db8@mailhost.blackmesacapital.com>

[This appears to have been misposted to r-bugs -- there is no bug reported 
here.]

It's easiest to explore the behavior of high-d apply when your test array 
has different extents on each dimension.  That way you can easily see 
what's happening with each dimension.  Also, when experimenting, use 
FUN=function(x) browser() to see what is getting passed to FUN.

The way I remember what apply() does is that the MAR= argument specifies 
the dimensions to be kept in the result.  Iin apply(x, MAR, FUN), FUN gets 
passed an object with dimensions dim(x)[-MAR].  So, in your example, FUN is 
getting passed a matrix.  The reason you get differently shaped results 
with mean, sd, and var is that each of these gives a differently shaped 
result (scalar, vector, and matrix) when given a matrix.

 > a <- array(1:24, c(2,3,4))
 > apply(a, 2, function(x) browser())
Called from: FUN(array(newX[, i], d.call, dn.call), ...)
Browse[1]> dim(x)
[1] 2 4
Browse[1]> x
      [,1] [,2] [,3] [,4]
[1,]    1    7   13   19
[2,]    2    8   14   20
Browse[1]> mean(x)
[1] 10.5
Browse[1]> sd(x)
[1] 0.7071068 0.7071068 0.7071068 0.7071068
Browse[1]> var(x)
      [,1] [,2] [,3] [,4]
[1,]  0.5  0.5  0.5  0.5
[2,]  0.5  0.5  0.5  0.5
[3,]  0.5  0.5  0.5  0.5
[4,]  0.5  0.5  0.5  0.5

hope this helps,

Tony Plate

At Thursday 12:01 PM 9/9/2004, jaroslaw.w.tuszynski@saic.com wrote:
>Full_Name: jarek tuszynski
>Version: 1.8.1
>OS: windows 2000
>Submission from: (NULL) (198.151.13.10)
>
>
>Example code:
> > a=array(1:27, c(3,3,3))
> > apply(a,2, var)
>       [,1] [,2] [,3]
>  [1,]    1    1    1
>  [2,]    1    1    1
>  [3,]    1    1    1
>  [4,]    1    1    1
>  [5,]    1    1    1
>  [6,]    1    1    1
>  [7,]    1    1    1
>  [8,]    1    1    1
>  [9,]    1    1    1
> > apply(a,2, mean)
>[1] 11 14 17
> > apply(a,2, sd)
>      [,1] [,2] [,3]
>[1,]    1    1    1
>[2,]    1    1    1
>[3,]    1    1    1
>
>I could not figure out from the documentation how MARGIN argument of function
>"apply" works in case of arrays with dimentions larger than 2, so I 
>created the
>above test code. I still do not know how it suppose to work but I should 
>not get
>the results with different dimentions, while calculating var and sd.
>
>Hope this helps,
>
>Jarek
>
>______________________________________________
>R-devel@stat.math.ethz.ch mailing list
>https://stat.ethz.ch/mailman/listinfo/r-devel

From p.dalgaard at biostat.ku.dk  Thu Sep  9 20:33:17 2004
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Thu Sep  9 20:33:53 2004
Subject: [Rd] function "apply" and 3D arrays (PR#7221)
In-Reply-To: <20040909180132.7977A10460@slim.kubism.ku.dk>
References: <20040909180132.7977A10460@slim.kubism.ku.dk>
Message-ID: <x2zn3zuwb6.fsf@biostat.ku.dk>

jaroslaw.w.tuszynski@saic.com writes:

> Full_Name: jarek tuszynski
> Version: 1.8.1
> OS: windows 2000
> Submission from: (NULL) (198.151.13.10)
> 
> 
> Example code:
> > a=array(1:27, c(3,3,3))
> > apply(a,2, var)
>       [,1] [,2] [,3]
>  [1,]    1    1    1
>  [2,]    1    1    1
>  [3,]    1    1    1
>  [4,]    1    1    1
>  [5,]    1    1    1
>  [6,]    1    1    1
>  [7,]    1    1    1
>  [8,]    1    1    1
>  [9,]    1    1    1
> > apply(a,2, mean)
> [1] 11 14 17
> > apply(a,2, sd)
>      [,1] [,2] [,3]
> [1,]    1    1    1
> [2,]    1    1    1
> [3,]    1    1    1
> 
> I could not figure out from the documentation how MARGIN argument of function
> "apply" works in case of arrays with dimentions larger than 2, so I created the
> above test code. I still do not know how it suppose to work but I should not get
> the results with different dimentions, while calculating var and sd.

All in accordance with documentation, i.e. no bug. The fundamental
issue is that

> mean(a[,3,])
[1] 17
> var(a[,3,])
     [,1] [,2] [,3]
[1,]    1    1    1
[2,]    1    1    1
[3,]    1    1    1
> sd(a[,3,])
[1] 1 1 1

In particular, var() gives a covariance matrix, but there's no such
thing as an sd() matrix, so you get the columnwise sd().

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

From ripley at stats.ox.ac.uk  Thu Sep  9 20:52:28 2004
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu Sep  9 20:52:32 2004
Subject: [Rd] man page of hist points to truehist, which can't be viewed
	without loading a library?
In-Reply-To: <85brgfiadc.fsf@servant.blindglobe.net>
Message-ID: <Pine.LNX.4.44.0409091946440.3233-100000@gannet.stats>

On Thu, 9 Sep 2004, A.J. Rossini wrote:

> 
> rdevel from yesterday, also in 1.9.1 (Debian, -3).
> 
> The man page of 'hist' (from the graphics package, obtained by
> "?hist") suggests 'truehist' under "see also", but 'truehist' isn't
> loaded by default (a sensible "of course"), so that "?truehist" fails.
> One can do help.search(), of course, which points what to do, but
> leads to my question:
> 
>   In referencing functions in other packages, should the "See Also"
>   link mention the library that they are coming from?  I'm less
>   concerned about the example and more concerned about some packages
>   I'm wrapping up.
> 
> (this was from the command line in a terminal window, not w/in ESS).

It is the norm: see e.g. format.Date.Rd or write.table.Rd, and a good 
idea.

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From rossini at blindglobe.net  Thu Sep  9 21:14:59 2004
From: rossini at blindglobe.net (A.J. Rossini)
Date: Thu Sep  9 21:14:11 2004
Subject: [Rd] man page of hist points to truehist, which can't be viewed
	without loading a library?
In-Reply-To: <Pine.LNX.4.44.0409091946440.3233-100000@gannet.stats> (Brian
	Ripley's message of "Thu, 9 Sep 2004 19:52:28 +0100 (BST)")
References: <Pine.LNX.4.44.0409091946440.3233-100000@gannet.stats>
Message-ID: <85wtz3gsp8.fsf@servant.blindglobe.net>

Prof Brian Ripley <ripley@stats.ox.ac.uk> writes:

> On Thu, 9 Sep 2004, A.J. Rossini wrote:
>
>> 
>> rdevel from yesterday, also in 1.9.1 (Debian, -3).
>> 
>> The man page of 'hist' (from the graphics package, obtained by
>> "?hist") suggests 'truehist' under "see also", but 'truehist' isn't
>> loaded by default (a sensible "of course"), so that "?truehist" fails.
>> One can do help.search(), of course, which points what to do, but
>> leads to my question:
>> 
>>   In referencing functions in other packages, should the "See Also"
>>   link mention the library that they are coming from?  I'm less
>>   concerned about the example and more concerned about some packages
>>   I'm wrapping up.
>> 
>> (this was from the command line in a terminal window, not w/in ESS).
>
> It is the norm: see e.g. format.Date.Rd or write.table.Rd, and a good 
> idea.

I apologize for not being clear.  It actually does what you describe
in the underlying markup for the help page for "hist".  What I'm
referring to is the display of text, not in the source code which
generates the man page.  i.e.  it would be nice if the markup

   \code{\link[OtherPackage]{relatedFunction}}

generated text such as for example, "relatedFunction (in OtherPackage)".

So to be a bit more explicit, I was wondering whether:

   \code{\link[OtherPackage]{relatedFunction}}  

or

   \code{\link[OtherPackage]{relatedFunction}}  (in OtherPackage)

would be better, stylistically.  I am leaning towards the use of the
latter.  I guess I could submit a patch for the former, not sure if I
can get it done for 2.0 (or if it is even too late).

best,
-tony

-- 
Anthony Rossini			    Research Associate Professor
rossini@u.washington.edu            http://www.analytics.washington.edu/ 
Biomedical and Health Informatics   University of Washington
Biostatistics, SCHARP/HVTN          Fred Hutchinson Cancer Research Center
UW (Tu/Th/F): 206-616-7630 FAX=206-543-3461 | Voicemail is unreliable
FHCRC  (M/W): 206-667-7025 FAX=206-667-4812 | use Email

CONFIDENTIALITY NOTICE: This e-mail message and any attachme...{{dropped}}

From ripley at stats.ox.ac.uk  Thu Sep  9 21:22:44 2004
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu Sep  9 21:22:49 2004
Subject: [Rd] man page of hist points to truehist, which can't be viewed
	without loading a library?
In-Reply-To: <85wtz3gsp8.fsf@servant.blindglobe.net>
Message-ID: <Pine.LNX.4.44.0409092018340.3322-100000@gannet.stats>

On Thu, 9 Sep 2004, A.J. Rossini wrote:

> Prof Brian Ripley <ripley@stats.ox.ac.uk> writes:
> 
> > On Thu, 9 Sep 2004, A.J. Rossini wrote:
> >
> >> 
> >> rdevel from yesterday, also in 1.9.1 (Debian, -3).
> >> 
> >> The man page of 'hist' (from the graphics package, obtained by
> >> "?hist") suggests 'truehist' under "see also", but 'truehist' isn't
> >> loaded by default (a sensible "of course"), so that "?truehist" fails.
> >> One can do help.search(), of course, which points what to do, but
> >> leads to my question:
> >> 
> >>   In referencing functions in other packages, should the "See Also"
> >>   link mention the library that they are coming from?  I'm less
> >>   concerned about the example and more concerned about some packages
> >>   I'm wrapping up.
> >> 
> >> (this was from the command line in a terminal window, not w/in ESS).
> >
> > It is the norm: see e.g. format.Date.Rd or write.table.Rd, and a good 
> > idea.
> 
> I apologize for not being clear.  It actually does what you describe
> in the underlying markup for the help page for "hist".  What I'm
> referring to is the display of text, not in the source code which
> generates the man page.  i.e.  it would be nice if the markup
> 
>    \code{\link[OtherPackage]{relatedFunction}}
> 
> generated text such as for example, "relatedFunction (in OtherPackage)".

It doesn't and people have written assuming so (see below).

> So to be a bit more explicit, I was wondering whether:
> 
>    \code{\link[OtherPackage]{relatedFunction}}  
> 
> or
> 
>    \code{\link[OtherPackage]{relatedFunction}}  (in OtherPackage)
> 
> would be better, stylistically.  I am leaning towards the use of the
> latter.  I guess I could submit a patch for the former, not sure if I
> can get it done for 2.0 (or if it is even too late).

The latter.  format.date says 

  Also objects of class
  \code{"date"} (from package \pkg{\link[date:as.date]{date}} or
  \pkg{\link[survival:as.date]{survival}}) and
  \code{"dates"} (from package \pkg{\link[chron]{chron}}).

and there are lots of other examples.  So the first would need a lot of 
rewriting.

I've just added several instances of (from package \pkg{foo}) to base.

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From ripley at stats.ox.ac.uk  Thu Sep  9 21:29:57 2004
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu Sep  9 21:30:08 2004
Subject: [Rd] hist( ) fails with 'Inf' values unlike plot( ) (PR#7220)
In-Reply-To: <20040909164634.6267610451@slim.kubism.ku.dk>
Message-ID: <Pine.LNX.4.44.0409092014510.3322-100000@gannet.stats>

One problem here is pretty() which should accept non-finite values as it 
does in S.  It will in 2.0.0.

It is easiest to change !is.na to is.finite, which is what some plot() 
methods use.

On Thu, 9 Sep 2004 epurdom@stanford.edu wrote:

> Full_Name: Elizabeth Purdom
> Version: 1.9.1
> OS: Windows
> Submission from: (NULL) (171.64.102.192)
> 
> 
> hist() fails if encounters 'Inf' value, rather than giving warning and removing.
> Other graphics, like plot(), don't have this problem. It's actually rather
> confusing if you are taking the log of data real valued data with a few
> non-positive numbers. hist() works fine in this situation unless you happen to
> have an exact 0, as oppose to just negative numbers. Then log(0)=Inf while
> log(-1)=NA and NA values are removed by the program while Inf kills it. At least
> a better error message would be good, because as it is, it looks like the
> program can't handle NAs. 
> 
> > x<-seq(-5,100,by=1)
> ##Gives error, no output
> > hist(log(x))
> Error in pretty(range(x), n = breaks, min.n = 1) : 
>         NA/NaN/Inf in foreign function call (arg 1)
> In addition: Warning message: 
> NaNs produced in: log(x) 
> ##Gives log() warning
> > hist(log(x)[!is.infinite(log(x))])
> Warning messages: 
> 1: NaNs produced in: log(x) 
> 2: NaNs produced in: log(x)
> 
> ______________________________________________
> R-devel@stat.math.ethz.ch mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From jmc at research.bell-labs.com  Thu Sep  9 22:05:52 2004
From: jmc at research.bell-labs.com (John Chambers)
Date: Thu Sep  9 22:06:17 2004
Subject: [Rd] as(object,"list")  as(object,"matrix") differences?
References: <200409071617210704.0504144D@mail.math.fu-berlin.de>
	<413DD80C.2D5EA9C9@research.bell-labs.com>
	<200409081219020786.0B1B546F@mail.math.fu-berlin.de>
	<413F12EB.5F76BBA5@research.bell-labs.com>
	<200409092026400894.103612E2@mail.math.fu-berlin.de>
Message-ID: <4140B7A0.292B8ADA@research.bell-labs.com>

I did say the workaround was only a candidate!

Try changing the first line to:

setClass("listNamed",
         representation(names = "character"), contains = "list")

(because the automatically generated as() methods for further derived
classes, e.g. your Mlist,  will not copy the names unless that is an
explicit slot in the inherited class)

The workaround then does have the disadvantage that objects from it
_must_ have names, but then that was what we presumably wanted the
workaround for anyway.



Wolski wrote:
> 
> Hi!
> 
> Is this behaviour intended? Now no, nie, niente names are possible. Is this intended?
> Please run the sample code below.
> 
> R : Copyright 2004, The R Foundation for Statistical Computing
> Version 2.0.0 alpha (2004-09-09), ISBN 3-900051-07-0
> 
> setClass("listNamed", "list")
> setAs("listNamed", "list", function(from) {
>    if(strict) class(from) <- "list"
>    from
>    })
> 
> setMethod("show", "listNamed",
>           function(object) {
>               cat("An object of class ", class(object), "\n", sep="")
>               show(as(object, "list"))
>           })
> 
> 
>                                         #NAIVE inheritance from list.
>                                         #define cass
> 
> setClass("Mlist"
>          ,representation(info="character") #uniq names have to be unique?
>          ,contains="listNamed"
>          )
> 
> tmp <- as.list(1:4)
> names(tmp) <- letters[1:4]
> mylist<-new("Mlist" , tmp , info="numeric" )
> mylist
> 
> /E
> 
> Dipl. bio-chem. Eryk Witold Wolski             @    MPI-Moleculare Genetic
> Ihnestrasse 63-73 14195 Berlin                'v'
> tel: 0049-30-83875219                        /   \
> mail: witek96@users.sourceforge.net        ---W-W----
> http://r4proteomics.sourceforg.net

-- 
John M. Chambers                  jmc@bell-labs.com
Bell Labs, Lucent Technologies    office: (908)582-2681
700 Mountain Avenue, Room 2C-282  fax:    (908)582-3340
Murray Hill, NJ  07974            web: http://www.cs.bell-labs.com/~jmc

From wolski at molgen.mpg.de  Fri Sep 10 15:39:17 2004
From: wolski at molgen.mpg.de (Wolski)
Date: Fri Sep 10 15:39:26 2004
Subject: [Rd] as(object,"list")<- error In .mergeAttrs() ??
In-Reply-To: <413F12EB.5F76BBA5@research.bell-labs.com>
References: <200409071617210704.0504144D@mail.math.fu-berlin.de>
	<413DD80C.2D5EA9C9@research.bell-labs.com>
	<200409081219020786.0B1B546F@mail.math.fu-berlin.de>
	<413F12EB.5F76BBA5@research.bell-labs.com>
Message-ID: <200409101539170921.1455535A@mail.math.fu-berlin.de>

Hi!

I am open to any arbitrary way of extending a list. It does not matter to me how complicated it gets. I do it once for my class.
What matters to me is what I can do with objects extending from list. Because this is what I am doing often.
Hence,  further proposals even more complicated are wellcome.

The problem with as(mylist,"list") I would say we sorted out temporarily. Thanks.

Whats next are the following set of examples that does not work.
At least one of the following calls fails with any of thy proposed implementation patterns on version of R1.9.1 or R2.0.0.


#Example of manipulating the list part of the object. 
as(mylist,"list") <- lapply(mylist,"+",3)
as(mylist,"list") <- mylist[2:4] 					#was working on 1.9.1 patched. Does not work on 2.0.0 alpha *
as(mylist,"list") <- as(mylist,"listNamed")[2:4]			#was working on 1.9.1 patched. Does not work on 2.0.0 alpha.*


#what does not work is assigning shorter lists without names. Seems like a bug. Or is there an explanation.
as(mylist,"list")<-as.list(1:5) 					#was working on 1.9.1. Is working on 2.0.0 even if the list has no names.
as(mylist,"list")<-as.list(1:4)					#is not working on 1.9.1 2.0.0

*A little different implementation of inheritance.

The samples above almost work, except the last two on 1.9.1 with one of the implementation patterns for inheritance.
Is intended to support such assignments automatically?

Almost non of them is working with the newest version of R.2.0.0 as you can easily reproduce running the code belowe.

As I understand I can provide by myself an assignemnt replace function by setAs. 
(I got all the examples above working working in this way on 1.9.1 
-> using the property that as long as shorter list has names has names it can be assigned and the following setAs function).

	,replace=function(from,value)
	{
		if(is.null(attributes(value)$names))
			attributes(value)$names<-character(0)

		from@.Data <- value
		from@names<-names(value)
		from	
	}

It was not easy because  .mergeAttrs()  was complaining for a while.
Now there is NO chance to build this work arround. Because now the assignment does not work for lists with names of shorter length.

I dont think that it is neccessary as it is now (?) that a class which extends a basic class has already an appropriate as<- method. They do not work.
Its seems quite easy provide an setAs method or setIs method. But not for a class extending from "list". Probably I am naive.

As I realise that this assignments will work on R2.0.0, I happily also realise that inheritance from old type classes is probably not important.
I can provide a method as.list for myclass and so myclass should work with all possible functions working on lists because they call "as.list" first in most cases.

Sincerely yours
Eryk.

The not working code example.
setClass("listNamed", contains="list",representation(names="character"))

setAs("listNamed", "list", function(from) {
   if(strict) class(from) <- "list"
   from
   })

setMethod("show"
	  ,"listNamed",
          def = function(object) {
              cat("An object of class ", class(object), "\n", sep="")
              show(as(object, "list"))
          })
                                                                                                                                                                                                                                            
                                        #NAIVE inheritance from list.
                                        #define cass

setClass("Mlist"
         ,representation(info="character") #uniq names have to be unique?
         ,contains="listNamed"
         )
         
tmp <- as.list(1:4)
names(tmp) <- letters[1:4]
mylist<-new("Mlist" , tmp , info="numeric" )
mylist
                                                                                                                                                                                                                                            
#Example of manipulating the list part of the object. 
as(mylist,"list") <- lapply(mylist,"+",3)
as(mylist,"list") <- mylist[2:4]
as(mylist,"list") <- as(mylist,"listNamed")[2:4]


#what does not work is assigning shorter lists without names. Seems like a bug. Or is there an explanation.
as(mylist,"list")<-as.list(1:5)
as(mylist,"list")<-as.list(1:4)


setAs("listNamed", "list", function(from) {
   if(strict) class(from) <- "list"
   from
   }
   ,replace=function(from,value)
   {
   	print("replace")
	print(class(value))
   	from@.Data<- value
   	from@names<- names(value)
	from
   }
   )

#Example of manipulating the list part of the object. 
as(mylist,"list") <- lapply(mylist,"+",3)
as(mylist,"list") <- mylist[2:4]
as(mylist,"list") <- as(mylist,"listNamed")[2:4]


#what does not work is assigning shorter lists without names. Seems like a bug. Or is there an explanation.
as(mylist,"list")<-as.list(1:5)
as(mylist,"list")<-as.list(1:4)

From wolski at molgen.mpg.de  Fri Sep 10 19:08:45 2004
From: wolski at molgen.mpg.de (Wolski)
Date: Fri Sep 10 19:08:49 2004
Subject: [Rd] as(object,"list")<- error In .mergeAttrs() ??
References: <200409071617210704.0504144D@mail.math.fu-berlin.de>
	<413DD80C.2D5EA9C9@research.bell-labs.com>
	<200409081219020786.0B1B546F@mail.math.fu-berlin.de>
	<413F12EB.5F76BBA5@research.bell-labs.com>
	<200409101539170921.1455535A@mail.math.fu-berlin.de>
Message-ID: <200409101908450513.15151765@mail.math.fu-berlin.de>

Hi!

Forgot to ask: Can you restore the behaviour from version 1.9.1? Please.
I have 2 packages on Bioconductor and one almost ready which rely on it. And as I just tested the rewrite which changes the inheritance to a contains relation would have more consequences then I thought and not be as easy.

Please let me know as soon as possible.

Sincerely yours
Eryk.

From kwright at eskimo.com  Fri Sep 10 22:30:21 2004
From: kwright at eskimo.com (Kevin Wright)
Date: Fri Sep 10 22:30:28 2004
Subject: [Rd] Multi-line string constants: proposed patch
Message-ID: <200409102030.NAA04020@eskimo.com>


R 1.9.1 requires multi-line strings to contain a backslash at the
end of each line (except the last line).  As noted by Mark
Bravington (http://tolstoy.newcastle.edu.au/R/help/02b/5199.html)
this requirement appears to be undocumented.

In S-Plus 6.2, multi-line strings do not need a backslash for continuation.

I recently (http://tolstoy.newcastle.edu.au/R/devel/04b/0256.html)
requested compatability with S-Plus and was told to contribute
a patch and then it would be considered.  Here is the proposed patch.
  
In the files src/main/gram.y and src/main/gram.c strings
are parsed with the StringValue function.  Looking at the function it is
clear that a newline character (not the two-byte '\n') generates an error:

static int StringValue(int c)
{
...
	if (c == '\n') {
	    xxungetc(c);
	    return ERROR;
	}

...
}

I tracked this code down and Mark Bravington confirmed (by building r-devel 
on Windows) that commenting out the four lines that start with
  if (c == '\n')
will allow R to handle multi-line strings either with or without backslashes
for continuation.  A 'diff' appears at the end of this mesage.

Note that if EOF is encountered while R thinks it's reading a string, it 
will silently add the string terminator rather than causing an error. 
I can't really see this as undesirable but I suppose we should mention it. 
(Currently the same thing happens if the last character of the last line is 
a backslash, so it's "consistent" anyway.)

I've searched through S-Plus and R documentation.  Here are few relevant
texts:

S-Plus 6.2 Programmer's Guide, Page 11
"character strings [are] enclosed by double quotes or apostrophes"

S-Plus 6.2 Programmer's Guide, Page 947 (abbreviated)
"Strings consist of zero or more characters typed between
two apostrophes or double quotes.  Table 23.2 lists some special
characters for use in string literals.  These special characters are
for string control, obtaining characters that are not represented on
the keyboard, or delimiting character strings.
  \t tab
  \\ backslash
  \n newline

R Language Definition
String constants are delimited by a pair of single (') or double (")
quotes and can contain all other printable characters.  Quotes and
other special characters within strings are specified using escape
sequences.

Here are some simple examples:

f1 <- function(){
  # This function generates a warning in S-Plus that "the initial
  # backslash is ignored", but then is read in as intended (two lines).
  # In R 1.9.0 this becomes one-line: "function 1 text"
  l1 <- "function \
1 text"
}

f2 <- function(){
  # This fails in R 1.9.0.  Works fine in S-Plus 6.2
  l2 <- "function
2 text"
}

f3 <- function(){
  # Identical in R and S-Plus
  l3 <- "function \n3 text"
}
  

Mark Bravington supllied the diff and writes:

I've now gotten R-devel to build, and your patch works fine. I just commented out the code rather than deleting it, though the R team might want to do that differently. I renamed 'gram.c' to 'ogram.c' and ran 'diff'-- here's the output (yes it is trivial):

C:\R\R-devel\src\main>diff ogram.c gram.c
3122,3125c3122,3125
<       if (c == '\n') {
<           xxungetc(c);
<           return ERROR;
<       }
---
//    if (c == '\n') {
//        xxungetc(c);
//        return ERROR;
//    }

Presumably the same change should be made in gram.y


Thanks for considering this patch.

Kevin Wright ( & Mark Bravington )

From p.dalgaard at biostat.ku.dk  Sat Sep 11 01:29:33 2004
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Sat Sep 11 01:30:15 2004
Subject: [Rd] Multi-line string constants: proposed patch
In-Reply-To: <200409102030.NAA04020@eskimo.com>
References: <200409102030.NAA04020@eskimo.com>
Message-ID: <x24qm5snxe.fsf@biostat.ku.dk>

Kevin Wright <kwright@eskimo.com> writes:

> R 1.9.1 requires multi-line strings to contain a backslash at the
> end of each line (except the last line).  As noted by Mark
> Bravington (http://tolstoy.newcastle.edu.au/R/help/02b/5199.html)
> this requirement appears to be undocumented.
> 
> In S-Plus 6.2, multi-line strings do not need a backslash for continuation.
> 
> I recently (http://tolstoy.newcastle.edu.au/R/devel/04b/0256.html)
> requested compatability with S-Plus and was told to contribute
> a patch and then it would be considered.  Here is the proposed patch.
>   
> In the files src/main/gram.y and src/main/gram.c strings
> are parsed with the StringValue function.  Looking at the function it is
> clear that a newline character (not the two-byte '\n') generates an error:
> 
> static int StringValue(int c)
> {
> ...
> 	if (c == '\n') {
> 	    xxungetc(c);
> 	    return ERROR;
> 	}
> 
> ...
> }

...
> 
> C:\R\R-devel\src\main>diff ogram.c gram.c
> 3122,3125c3122,3125
> <       if (c == '\n') {
> <           xxungetc(c);
> <           return ERROR;
> <       }
> ---
> //    if (c == '\n') {
> //        xxungetc(c);
> //        return ERROR;
> //    }
> 
> Presumably the same change should be made in gram.y
> 
> 
> Thanks for considering this patch.

Sorry, I don't think that is good enough (notwithstanding the
nonstandard comment character). Notice that Splus does this:

> x <- "foo
Continue string: bar
Continue string: baz"

(and the entry is interruptible with Ctrl-C too)

There's a very good reason for the change of prompt, as anyone who has
debugged SAS code with stray quotes will tell you: The system would
appear to be completely unresponsive because all input is being eaten
by the string readers.

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

From ivo_welch-rstat8783 at mailblocks.com  Mon Sep 13 00:04:20 2004
From: ivo_welch-rstat8783 at mailblocks.com (ivo_welch-rstat8783@mailblocks.com)
Date: Mon Sep 13 00:04:32 2004
Subject: [Rd] Re: [R] R on gentoo amd64 (gcc 3.3.3) is unstable --- no!
In-Reply-To: <20040821175935.GA418@sonny.eddelbuettel.com>
References: <Pine.LNX.4.44.0408201652270.13691-100000@gannet.stats>
	<200408211359.i7LDxG3D032187@hypatia.math.ethz.ch>
	<20040821175935.GA418@sonny.eddelbuettel.com>
Message-ID: <200409122204.i8CM4OCq010039@hypatia.math.ethz.ch>


from the gentoo folks, on f2c problems with R on 64bit platforms:

"Config and me finally found the reason. When R calls fortran functions 
 from its c sources, it uses strictly ints for intgeres, not long ints. 
But f2c is perfectly right to use long ints on 64bit arches."

---
ivo welch

From ripley at stats.ox.ac.uk  Mon Sep 13 08:20:24 2004
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon Sep 13 08:20:30 2004
Subject: [Rd] Re: [R] R on gentoo amd64 (gcc 3.3.3) is unstable --- no!
In-Reply-To: <E1C6cSP-0002Vo-1w@rx0.oucs.ox.ac.uk>
Message-ID: <Pine.LNX.4.44.0409130718360.11324-100000@gannet.stats>

This has been in the R-admin manual for a least a week, and I reported it 
here earlier than that.

R 2.0.0 alpha does not allow f2c on 64-bit platforms.

It's all been dealt with quite awhile ago ....

On Sun, 12 Sep 2004 ivo_welch-rstat8783@mailblocks.com wrote:

> 
> from the gentoo folks, on f2c problems with R on 64bit platforms:
> 
> "Config and me finally found the reason. When R calls fortran functions 
>  from its c sources, it uses strictly ints for intgeres, not long ints. 
> But f2c is perfectly right to use long ints on 64bit arches."
> 
> ---
> ivo welch
> 
> 

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From ripley at stats.ox.ac.uk  Mon Sep 13 08:40:48 2004
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon Sep 13 08:40:51 2004
Subject: [Rd] Re: [R] R on gentoo amd64 (gcc 3.3.3) is unstable --- no!
In-Reply-To: <Pine.LNX.4.44.0409130718360.11324-100000@gannet.stats>
Message-ID: <Pine.LNX.4.44.0409130737310.11324-100000@gannet.stats>

On Mon, 13 Sep 2004, Prof Brian Ripley wrote:

> This has been in the R-admin manual for a least a week, and I reported it 
> here earlier than that.
> 
> R 2.0.0 alpha does not allow f2c on 64-bit platforms.
> 
> It's all been dealt with quite awhile ago ....
> 
> On Sun, 12 Sep 2004 ivo_welch-rstat8783@mailblocks.com wrote:
> 
> > 
> > from the gentoo folks, on f2c problems with R on 64bit platforms:
> > 
> > "Config and me finally found the reason. When R calls fortran functions 
> >  from its c sources, it uses strictly ints for intgeres, not long ints. 
> > But f2c is perfectly right to use long ints on 64bit arches."

They may assert so, but no real Fortran compiler we have ever 
encountered does, in particular not g77 based on f2c.  So it does rather 
sound like `I am perfectly right but the world is out of step with me'.

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From daniel.hoppe at univie.ac.at  Mon Sep 13 18:12:44 2004
From: daniel.hoppe at univie.ac.at (Daniel Hoppe)
Date: Mon Sep 13 18:13:06 2004
Subject: [Rd] Problem with mle in stats4 (R 1.9.1)
Message-ID: <003c01c499ac$82016290$82b98283@DH>

Hi!

This is a repost of an earlier message (with a clearer example
demonstrating the problem I ran into). If you run the mle example in
stats4

     library(stats4)
     x <- 0:10
     y <- c(26, 17, 13, 12, 20, 5, 9, 8, 5, 4, 8)
     ll <- function(ymax=15, xhalf=6)
         -sum(stats::dpois(y, lambda=ymax/(1+x/xhalf), log=TRUE))
     (fit <- mle(ll))
     plot(profile(fit), absVal=FALSE)

everything works fine. Now run 

     (fit <- mle(ll, method="BFGS", control=list(ndeps=c(1e-3, 1e-3))))
     plot(profile(fit), absVal=FALSE)

and you will get

Error in interpSpline.default(obj[[i]]$par.vals[, i], obj[[i]]$z,
na.action = na.omit) : 
        only 0's may mix with negative subscripts

This happens because optim gets the old ndeps but just one variable to
optimize. The optim error is not reported, so the problem is rather hard
to trace. Would you agree that this would be worth fixing?

Best regards,

Daniel

(original posting with quick workaround
http://tolstoy.newcastle.edu.au/R/help/04/07/1778.html)

--
Daniel Hoppe
Department of Marketing
University of Vienna
Bruenner Strasse 72
1210 Vienna
Austria

From ripley at stats.ox.ac.uk  Mon Sep 13 18:58:53 2004
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon Sep 13 18:58:56 2004
Subject: [Rd] Problem with mle in stats4 (R 1.9.1)
In-Reply-To: <003c01c499ac$82016290$82b98283@DH>
Message-ID: <Pine.LNX.4.44.0409131750290.22504-100000@gannet.stats>

We are currently on R 2.0.0 alpha.  If you submit a bug fix, preferably 
this week and at the latest next week, it will be considered for 2.0.0.

Please take seriously that R is an open project and does not have `staff' 
to fix bugs.  If you think it is worth fixing, please fix it for us
by providing a complete analysis and fixes for all the possible options 
that might be affected.

The best place for a patch to be sent is R-bugs.

On Mon, 13 Sep 2004, Daniel Hoppe wrote:

> Hi!
> 
> This is a repost of an earlier message (with a clearer example
> demonstrating the problem I ran into). If you run the mle example in
> stats4
> 
>      library(stats4)
>      x <- 0:10
>      y <- c(26, 17, 13, 12, 20, 5, 9, 8, 5, 4, 8)
>      ll <- function(ymax=15, xhalf=6)
>          -sum(stats::dpois(y, lambda=ymax/(1+x/xhalf), log=TRUE))
>      (fit <- mle(ll))
>      plot(profile(fit), absVal=FALSE)
> 
> everything works fine. Now run 
> 
>      (fit <- mle(ll, method="BFGS", control=list(ndeps=c(1e-3, 1e-3))))
>      plot(profile(fit), absVal=FALSE)
> 
> and you will get
> 
> Error in interpSpline.default(obj[[i]]$par.vals[, i], obj[[i]]$z,
> na.action = na.omit) : 
>         only 0's may mix with negative subscripts
> 
> This happens because optim gets the old ndeps but just one variable to
> optimize. The optim error is not reported, so the problem is rather hard
> to trace. Would you agree that this would be worth fixing?
> 
> Best regards,
> 
> Daniel
> 
> (original posting with quick workaround
> http://tolstoy.newcastle.edu.au/R/help/04/07/1778.html)
> 
> --
> Daniel Hoppe
> Department of Marketing
> University of Vienna
> Bruenner Strasse 72
> 1210 Vienna
> Austria
> 
> ______________________________________________
> R-devel@stat.math.ethz.ch mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From p.dalgaard at biostat.ku.dk  Mon Sep 13 19:11:36 2004
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Mon Sep 13 19:12:25 2004
Subject: [Rd] Problem with mle in stats4 (R 1.9.1)
In-Reply-To: <003c01c499ac$82016290$82b98283@DH>
References: <003c01c499ac$82016290$82b98283@DH>
Message-ID: <x2isaijdpz.fsf@biostat.ku.dk>

"Daniel Hoppe" <daniel.hoppe@univie.ac.at> writes:

> Hi!
> 
> This is a repost of an earlier message (with a clearer example
> demonstrating the problem I ran into). If you run the mle example in
> stats4
....
> This happens because optim gets the old ndeps but just one variable to
> optimize. The optim error is not reported, so the problem is rather hard
> to trace. Would you agree that this would be worth fixing?

Definitely (and the problem is still in 2.0.0 alpha). Thanks for the
reminder.

> (original posting with quick workaround
> http://tolstoy.newcastle.edu.au/R/help/04/07/1778.html)

Could well be fix, not just workaround.... Given that optim wasn't
designed to be able to hold arguments constant, any fix is going to be
somewhat kludgy.

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

From t.short at epri-peac.com  Mon Sep 13 20:18:25 2004
From: t.short at epri-peac.com (t.short@epri-peac.com)
Date: Mon Sep 13 20:18:35 2004
Subject: [Rd] Wishlist: axis() and line widths (PR#7223)
Message-ID: <20040913181825.B30C611112@slim.kubism.ku.dk>

Full_Name: Tom Short
Version: 1.9.1
OS: Win2000 & Debian
Submission from: (NULL) (64.65.255.41)


WISHLIST:

axis() has a default parameter of "lwd = 1". I want skinnier lines as the
default. If I change the default lty, it doesn't change what axis uses.

The following code produces a graph with a box around it, but the axis lines are
twice as thick as the box around the plot, so it looks funny. I can manually add
axes and explicitly set line widths, but that's a pain. The box() function does
not set lty, so it uses the default par()$lwd.

> par(lty = 0.5)
> plot(c(1,2,3)) 

RECOMMENDATION: In axis(), change the default for "lwd" from 1 to par()$lwd.

From t.short at epri-peac.com  Mon Sep 13 20:42:59 2004
From: t.short at epri-peac.com (t.short@epri-peac.com)
Date: Mon Sep 13 20:43:01 2004
Subject: [Rd] bitmap() doesn't finish with file in Windows (PR#7224)
Message-ID: <20040913184259.F012911128@slim.kubism.ku.dk>

Full_Name: Tom Short
Version: 1.9.0
OS: Win2000 
Submission from: (NULL) (64.65.255.41)


POSSIBLE WISHLIST, POSSIBLE BUG:

The following code works on Debian, but fails on Windows 2000 with 'Error in
file("test.png", "r") : unable to open connection':

bitmap("test.png")
plot(c(1,2,3))
dev.off()
x = file("test.png","r")

The problem is that when bitmap uses ghostscript to convert the PS file to a
PNG, the postscript drive doesn't wait for ghostscript to finish (under
Windows). In the Linux version, the postscript driver does wait for the printing
command to finish. Compare the following lines of devPS.c that actually call the
"cmd":

#ifdef Unix
	    err = R_system(buff);
#endif
#ifdef Win32
	    err = runcmd(buff, 0, 0, NULL);
#endif

RECOMMENDATION: Change runcmd(buff, 0, 0, NULL) to runcmd(buff, 1, 0, NULL) in
devPS.c to make the driver wait for the command to finish.

From tucker at mpi.com  Mon Sep 13 20:57:42 2004
From: tucker at mpi.com (tucker@mpi.com)
Date: Mon Sep 13 20:57:44 2004
Subject: [Rd] propogation of rounding error for t.tests with unequal sample
	sizes (PR#7225)
Message-ID: <20040913185742.A1F341138D@slim.kubism.ku.dk>


# users would benefit from a warning about the behavior in the
# groups.unbalanced case below.  A propogation of difference is the variance
# calculation is leading to an apparently significant difference in
# means, even though the numeric values are all identical.  Obviously upon
# inspection the difference in means is meaningless, but users might be warned
# if all of the input data is identical

xx <- rep(2.10,80)

groups.balanced <- as.factor(c(rep("one",40),rep("two",40)))
groups.unbalanced <- as.factor(c(rep("one",44),rep("two",36)))

t.test(xx ~ groups.balanced)

t.test(xx ~ groups.unbalanced)



<<insert bug report here>>



--please do not edit the information below--

Version:
 platform = sparc-sun-solaris2.8
 arch = sparc
 os = solaris2.8
 system = sparc, solaris2.8
 status = 
 major = 1
 minor = 9.0
 year = 2004
 month = 04
 day = 12
 language = R

Search Path:
 .GlobalEnv, package:methods, package:stats, package:graphics, package:utils, Autoloads, package:base



This e-mail, including any attachments, is a confidential business communication, and may contain information that is confidential, proprietary and/or privileged.  This e-mail is intended only for the individual(s) to whom it is addressed, and may not be saved, copied, printed, disclosed or used by anyone else.  If you are not the(an) intended recipient, please immediately delete this e-mail from your computer system and notify the sender.  Thank you.

From ripley at stats.ox.ac.uk  Mon Sep 13 21:03:11 2004
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon Sep 13 21:03:16 2004
Subject: [Rd] bitmap() doesn't finish with file in Windows (PR#7224)
In-Reply-To: <20040913184259.F012911128@slim.kubism.ku.dk>
Message-ID: <Pine.LNX.4.44.0409132000470.22859-100000@gannet.stats>

This is deliberate, as processing can take a long time and we don't
want to lock R whilst a printer prints a file for example.

Just insert a sleep(1).

It certainly is not a bug, as no one said you would be able to access a 
file immediately.

On Mon, 13 Sep 2004 t.short@epri-peac.com wrote:

> Full_Name: Tom Short
> Version: 1.9.0
> OS: Win2000 
> Submission from: (NULL) (64.65.255.41)
> 
> 
> POSSIBLE WISHLIST, POSSIBLE BUG:
> 
> The following code works on Debian, but fails on Windows 2000 with 'Error in
> file("test.png", "r") : unable to open connection':
> 
> bitmap("test.png")
> plot(c(1,2,3))
> dev.off()
> x = file("test.png","r")
> 
> The problem is that when bitmap uses ghostscript to convert the PS file to a
> PNG, the postscript drive doesn't wait for ghostscript to finish (under
> Windows). In the Linux version, the postscript driver does wait for the printing
> command to finish. Compare the following lines of devPS.c that actually call the
> "cmd":
> 
> #ifdef Unix
> 	    err = R_system(buff);
> #endif
> #ifdef Win32
> 	    err = runcmd(buff, 0, 0, NULL);
> #endif
> 
> RECOMMENDATION: Change runcmd(buff, 0, 0, NULL) to runcmd(buff, 1, 0, NULL) in
> devPS.c to make the driver wait for the command to finish.
> 
> ______________________________________________
> R-devel@stat.math.ethz.ch mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From deepayan at stat.wisc.edu  Mon Sep 13 21:54:52 2004
From: deepayan at stat.wisc.edu (Deepayan Sarkar)
Date: Mon Sep 13 21:54:35 2004
Subject: [Rd] reorder [stats] and reorder.factor [lattice]
In-Reply-To: <D7A3CFD7825BD6119B880002A58F06C20C521B26@groexmb02.pfizer.com>
References: <D7A3CFD7825BD6119B880002A58F06C20C521B26@groexmb02.pfizer.com>
Message-ID: <200409131454.52268.deepayan@stat.wisc.edu>


Before it's too late for R 2.0.0, do we have a final decision yet on 
having a reorder method for "factor" in stats?

Deepayan

On Friday 03 September 2004 11:36, Warnes, Gregory R wrote:
> I also have a reorder.factor defined in the gregmisc package.  It has
> a slighly different behavior.
> It allows
>  - sorting the factor level names via 'mixedsort', which sorts mixed
>         numeric/character intelligently so that 'Cis 10mg' comes
> after 'Cis 5mg' and before 'Taxol 10mg'
>  - reordering by a numeric order
>  - reordering by named factor labels.
>
> Combining it with the version provided by Deepayan we get:
>
> reorder.factor <- function(x,
>                            order,
>                            X,
>                            FUN,
>                            sort=mixedsort,
>                            make.ordered = is.ordered(x),
>                            ... )
>   {
>     constructor <- if (make.ordered) ordered else factor
>
>     if (!missing(order))
>       {
>         if (is.numeric(order))
>           order = levels(x)[order]
>         else
>           order = order
>       }
>     else if (!missing(FUN))
>       order = names(sort(tapply(X, x, FUN, ...)))
>     else
>       order = sort(levels(x))
>
>     constructor( x, levels=order)
>
>   }
>
> Yielding:
> >    # Create a 4 level example factor
> >    trt <- factor( sample( c("PLACEBO","300 MG", "600 MG", "1200
> > MG"),
>
> +                   100, replace=TRUE ) )
>
> >    summary(trt)
>
> 1200 MG  300 MG  600 MG PLACEBO
>      18      24      30      28
>
> >    # Note that the levels are not in a meaningful order.
> >
> >
> >    # Change the order to something useful
> >    # default "mixedsort" ordering
> >    trt2 <- reorder(trt)
> >    summary(trt2)
>
>  300 MG  600 MG 1200 MG PLACEBO
>      24      30      18      28
>
> >    # using indexes:
> >    trt3 <- reorder(trt, c(4,2,3,1))
> >    summary(trt3)
>
> PLACEBO  300 MG  600 MG 1200 MG
>      28      24      30      18
>
> >    # using label names:
> >    trt4 <- reorder(trt, c("PLACEBO","300 MG", "600 MG", "1200 MG")
> > ) summary(trt4)
>
> PLACEBO  300 MG  600 MG 1200 MG
>      28      24      30      18
>
> >    # using frequency
> >    trt5 <- reorder(trt, X=as.numeric(trt), FUN=length)
> >    summary(trt5)
>
> 1200 MG  300 MG PLACEBO  600 MG
>      18      24      28      30
>
> >    # drop out the '300 MG' level
> >    trt6 <- reorder(trt, c("PLACEBO", "600 MG", "1200 MG") )
> >    summary(trt6)
>
> PLACEBO  600 MG 1200 MG    NA's
>      28      30      18      24
>
>
>
> -Greg
>
> (the 'mixedsort' function is available in the gregmisc package, or on
> request)
>
> > -----Original Message-----
> > From: r-devel-bounces@stat.math.ethz.ch
> > [mailto:r-devel-bounces@stat.math.ethz.ch]On Behalf Of Deepayan
> > Sarkar Sent: Friday, August 27, 2004 3:32 PM
> > To: Prof Brian Ripley
> > Cc: r-devel@stat.math.ethz.ch
> > Subject: Re: [Rd] reorder [stats] and reorder.factor [lattice]
> >
> > On Friday 27 August 2004 11:17, Prof Brian Ripley wrote:
> > > On Fri, 27 Aug 2004, Deepayan Sarkar wrote:
> > > > It was recently pointed out on the lists that the S-PLUS
> >
> > Trellis suite
> >
> > > > has a function called reorder.factor that's useful in
> >
> > getting useful
> >
> > > > ordering of factors for graphs. I happily went ahead and
> >
> > implemented it,
> >
> > > > but it turns out that R (not S-PLUS) has a generic called
> >
> > reorder (with a
> >
> > > > method for "dendrogram"). Naturally, this causes R to
> >
> > think I'm defining
> >
> > > > a method for "factor", and gives a warning during check because
> > > > of mismatching argument names.
> > > >
> > > > Any suggestions as to what I should do? Retaining S
> >
> > compatibility doesn't
> >
> > > > seem to be an option. I could make a reorder method for
> >
> > "factor" (which
> >
> > > > sounds like a good option to me), or rename it to something
> > > > like reorderFactor.
> > >
> > > I am pretty sure you don't want to copy the Trellis call, which
> > > is
> > >
> > > function(Factor, X, Function = mean, ...)
> > >
> > > and suggests it dates from the days when S3 lookup could
> >
> > not distingush
> >
> > > functions from other objects by context, hence the
> >
> > capitalization.  Even
> >
> > > then, it is inconsistent with tapply etc which use FUN.
> > >
> > > reorder.factor <- function(x, X, FUN=mean)
> > >
> > > looks about right.  Another problem though: in Trellis
> >
> > reorder.factor
> >
> > > doesn't just reorder the factor, it makes it an ordered
> >
> > factor.  I don't
> >
> > > really see why, especially as the modelling functions
> >
> > assume that ordered
> >
> > > means equally spaced.  If this is to be used more generally
> >
> > (as Kjetil
> >
> > > Halvorsen suggests) then it should record the scores used to do
> > > the ordering in an attribute.
> >
> > Well, the ordered factor issue had come up before, and I
> > currently define this
> > as
> >
> >
> > which is different from the S-PLUS version in 2 ways:
> >
> > 1. for (unordered) factors, it changes the levels, but keeps
> > it a factor
> >
> > 2. it works for non-factors as well (which is moot if it's
> > going to be
> >    a factor method)
> >
> >
> > Implementation details aside, this seems to me like a good
> > candidate for stats
> > (although it'll probably be used very little). lattice
> > functions (will) have
> > an alternative way of determining panel order based on panel
> > contents, which
> > makes more sense to me in the plotting context.
> >
> > Deepayan
> >
> > ______________________________________________
> > R-devel@stat.math.ethz.ch mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
>
> LEGAL NOTICE
> Unless expressly stated otherwise, this message is confidential and
> may be privileged. It is intended for the addressee(s) only. Access
> to this E-mail by anyone else is unauthorized. If you are not an
> addressee, any disclosure or copying of the contents of this E-mail
> or any action taken (or not taken) in reliance on it is unauthorized
> and may be unlawful. If you are not an addressee, please inform the
> sender immediately.

From ripley at stats.ox.ac.uk  Mon Sep 13 22:04:20 2004
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon Sep 13 22:04:31 2004
Subject: [Rd] (PR#7225) propogation of rounding error for t.tests with
	unequal sample sizes (PR#7225)
In-Reply-To: <20040913185742.A1F341138D@slim.kubism.ku.dk>
Message-ID: <Pine.LNX.4.44.0409132102100.23143-100000@gannet.stats>

What are you seeing here?  I get identical results in the two cases.

On Mon, 13 Sep 2004 tucker@mpi.com wrote:

> 
> # users would benefit from a warning about the behavior in the
> # groups.unbalanced case below.  A propogation of difference is the variance
> # calculation is leading to an apparently significant difference in
> # means, even though the numeric values are all identical.  Obviously upon
> # inspection the difference in means is meaningless, but users might be warned
> # if all of the input data is identical

That's not so easy to achieve, given rounding error, but I am seeing
0 variance in both cases.

> xx <- rep(2.10,80)
> 
> groups.balanced <- as.factor(c(rep("one",40),rep("two",40)))
> groups.unbalanced <- as.factor(c(rep("one",44),rep("two",36)))
> 
> t.test(xx ~ groups.balanced)
> 
> t.test(xx ~ groups.unbalanced)
> 
> 
> 
> <<insert bug report here>>
> 
> 
> 
> --please do not edit the information below--
> 
> Version:
>  platform = sparc-sun-solaris2.8
>  arch = sparc
>  os = solaris2.8
>  system = sparc, solaris2.8
>  status = 
>  major = 1
>  minor = 9.0
>  year = 2004
>  month = 04
>  day = 12
>  language = R
> 
> Search Path:
>  .GlobalEnv, package:methods, package:stats, package:graphics, package:utils, Autoloads, package:base
> 
> 
> 
> This e-mail, including any attachments, is a confidential business communication, and may contain information that is confidential, proprietary and/or privileged.  This e-mail is intended only for the individual(s) to whom it is addressed, and may not be saved, copied, printed, disclosed or used by anyone else.  If you are not the(an) intended recipient, please immediately delete this e-mail from your computer system and notify the sender.  Thank you.
> 
> ______________________________________________
> R-devel@stat.math.ethz.ch mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From Gregory.Tucker-Kellogg at mpi.com  Mon Sep 13 22:07:21 2004
From: Gregory.Tucker-Kellogg at mpi.com (Tucker-Kellogg, Gregory)
Date: Mon Sep 13 22:07:33 2004
Subject: [Rd] (PR#7225) propogation of rounding error for t.tests with
	unequal sample sizes (PR#7225)
Message-ID: <9AB4AB593A64B247870F76EB551BA4A3064E43D9@US-VS1.corp.mpi.com>


My apologies for not including the transcript in the original message:

> xx <- rep(2.10,80)
> groups.balanced <- as.factor(c(rep("one",40),rep("two",40)))
> groups.unbalanced <- as.factor(c(rep("one",44),rep("two",36)))
> t.test(xx ~ groups.balanced)

	Welch Two Sample t-test

data:  xx by groups.balanced 
t = 0, df = 78, p-value = 1
alternative hypothesis: true difference in means is not equal to 0 
95 percent confidence interval:
 -4.004247e-16  4.004247e-16 
sample estimates:
mean in group one mean in group two 
              2.1               2.1 

> t.test(xx ~ groups.unbalanced)

	Welch Two Sample t-test

data:  xx by groups.unbalanced 
t = -4.1007, df = 54.298, p-value = 0.0001388
alternative hypothesis: true difference in means is not equal to 0 
95 percent confidence interval:
 -1.322366e-15 -4.539911e-16 
sample estimates:
mean in group one mean in group two 
              2.1               2.1 



>-----Original Message-----
>From: Prof Brian Ripley [mailto:ripley@stats.ox.ac.uk] 
>Sent: Monday, September 13, 2004 4:04 PM
>To: Tucker-Kellogg, Gregory
>Cc: r-devel@stat.math.ethz.ch; R-bugs@biostat.ku.dk
>Subject: Re: [Rd] (PR#7225) propogation of rounding error for 
>t.tests with unequal sample sizes (PR#7225)
>
>
>What are you seeing here?  I get identical results in the two cases.
>
>On Mon, 13 Sep 2004 tucker@mpi.com wrote:
>
>> 
>> # users would benefit from a warning about the behavior in the # 
>> groups.unbalanced case below.  A propogation of difference is the 
>> variance # calculation is leading to an apparently significant 
>> difference in # means, even though the numeric values are all 
>> identical.  Obviously upon # inspection the difference in means is 
>> meaningless, but users might be warned # if all of the input data is 
>> identical
>
>That's not so easy to achieve, given rounding error, but I am 
>seeing 0 variance in both cases.
>
>> xx <- rep(2.10,80)
>> 
>> groups.balanced <- as.factor(c(rep("one",40),rep("two",40)))
>> groups.unbalanced <- as.factor(c(rep("one",44),rep("two",36)))
>> 
>> t.test(xx ~ groups.balanced)
>> 
>> t.test(xx ~ groups.unbalanced)
>> 
>> 
>> 
>> <<insert bug report here>>
>> 
>> 
>> 
>> --please do not edit the information below--
>> 
>> Version:
>>  platform = sparc-sun-solaris2.8
>>  arch = sparc
>>  os = solaris2.8
>>  system = sparc, solaris2.8
>>  status =
>>  major = 1
>>  minor = 9.0
>>  year = 2004
>>  month = 04
>>  day = 12
>>  language = R
>> 
>> Search Path:
>>  .GlobalEnv, package:methods, package:stats, package:graphics, 
>> package:utils, Autoloads, package:base
>> 
>> 
>> 
>> This e-mail, including any attachments, is a confidential business 
>> communication, and may contain information that is confidential, 
>> proprietary and/or privileged.  This e-mail is intended only for the 
>> individual(s) to whom it is addressed, and may not be saved, copied, 
>> printed, disclosed or used by anyone else.  If you are not the(an) 
>> intended recipient, please immediately delete this e-mail from your 
>> computer system and notify the sender.  Thank you.
>> 
>> ______________________________________________
>> R-devel@stat.math.ethz.ch mailing list 
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>> 
>> 
>
>-- 
>Brian D. Ripley,                  ripley@stats.ox.ac.uk
>Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
>University of Oxford,             Tel:  +44 1865 272861 (self)
>1 South Parks Road,                     +44 1865 272866 (PA)
>Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>
>



This e-mail, including any attachments, is a confidential business communication, and may contain information that is confidential, proprietary and/or privileged.  This e-mail is intended only for the individual(s) to whom it is addressed, and may not be saved, copied, printed, disclosed or used by anyone else.  If you are not the(an) intended recipient, please immediately delete this e-mail from your computer system and notify the sender.  Thank you.

From ripley at stats.ox.ac.uk  Mon Sep 13 22:14:12 2004
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon Sep 13 22:14:17 2004
Subject: [Rd] (PR#7225) propogation of rounding error for t.tests with
	unequal sample sizes (PR#7225)
In-Reply-To: <9AB4AB593A64B247870F76EB551BA4A3064E43D9@US-VS1.corp.mpi.com>
Message-ID: <Pine.LNX.4.44.0409132111110.23206-100000@gannet.stats>

I am seeing NaNs, which is more sensible.

We will add a test for stderr small compared to the larger group mean.

On Mon, 13 Sep 2004, Tucker-Kellogg, Gregory wrote:

> 
> My apologies for not including the transcript in the original message:
> 
> > xx <- rep(2.10,80)
> > groups.balanced <- as.factor(c(rep("one",40),rep("two",40)))
> > groups.unbalanced <- as.factor(c(rep("one",44),rep("two",36)))
> > t.test(xx ~ groups.balanced)
> 
> 	Welch Two Sample t-test
> 
> data:  xx by groups.balanced 
> t = 0, df = 78, p-value = 1
> alternative hypothesis: true difference in means is not equal to 0 
> 95 percent confidence interval:
>  -4.004247e-16  4.004247e-16 
> sample estimates:
> mean in group one mean in group two 
>               2.1               2.1 
> 
> > t.test(xx ~ groups.unbalanced)
> 
> 	Welch Two Sample t-test
> 
> data:  xx by groups.unbalanced 
> t = -4.1007, df = 54.298, p-value = 0.0001388
> alternative hypothesis: true difference in means is not equal to 0 
> 95 percent confidence interval:
>  -1.322366e-15 -4.539911e-16 
> sample estimates:
> mean in group one mean in group two 
>               2.1               2.1 
> 
> 
> 
> >-----Original Message-----
> >From: Prof Brian Ripley [mailto:ripley@stats.ox.ac.uk] 
> >Sent: Monday, September 13, 2004 4:04 PM
> >To: Tucker-Kellogg, Gregory
> >Cc: r-devel@stat.math.ethz.ch; R-bugs@biostat.ku.dk
> >Subject: Re: [Rd] (PR#7225) propogation of rounding error for 
> >t.tests with unequal sample sizes (PR#7225)
> >
> >
> >What are you seeing here?  I get identical results in the two cases.
> >
> >On Mon, 13 Sep 2004 tucker@mpi.com wrote:
> >
> >> 
> >> # users would benefit from a warning about the behavior in the # 
> >> groups.unbalanced case below.  A propogation of difference is the 
> >> variance # calculation is leading to an apparently significant 
> >> difference in # means, even though the numeric values are all 
> >> identical.  Obviously upon # inspection the difference in means is 
> >> meaningless, but users might be warned # if all of the input data is 
> >> identical
> >
> >That's not so easy to achieve, given rounding error, but I am 
> >seeing 0 variance in both cases.
> >
> >> xx <- rep(2.10,80)
> >> 
> >> groups.balanced <- as.factor(c(rep("one",40),rep("two",40)))
> >> groups.unbalanced <- as.factor(c(rep("one",44),rep("two",36)))
> >> 
> >> t.test(xx ~ groups.balanced)
> >> 
> >> t.test(xx ~ groups.unbalanced)
> >> 
> >> 
> >> 
> >> <<insert bug report here>>
> >> 
> >> 
> >> 
> >> --please do not edit the information below--
> >> 
> >> Version:
> >>  platform = sparc-sun-solaris2.8
> >>  arch = sparc
> >>  os = solaris2.8
> >>  system = sparc, solaris2.8
> >>  status =
> >>  major = 1
> >>  minor = 9.0
> >>  year = 2004
> >>  month = 04
> >>  day = 12
> >>  language = R
> >> 
> >> Search Path:
> >>  .GlobalEnv, package:methods, package:stats, package:graphics, 
> >> package:utils, Autoloads, package:base
> >> 
> >> 
> >> 
> >> This e-mail, including any attachments, is a confidential business 
> >> communication, and may contain information that is confidential, 
> >> proprietary and/or privileged.  This e-mail is intended only for the 
> >> individual(s) to whom it is addressed, and may not be saved, copied, 
> >> printed, disclosed or used by anyone else.  If you are not the(an) 
> >> intended recipient, please immediately delete this e-mail from your 
> >> computer system and notify the sender.  Thank you.
> >> 
> >> ______________________________________________
> >> R-devel@stat.math.ethz.ch mailing list 
> >> https://stat.ethz.ch/mailman/listinfo/r-devel
> >> 
> >> 
> >
> >-- 
> >Brian D. Ripley,                  ripley@stats.ox.ac.uk
> >Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> >University of Oxford,             Tel:  +44 1865 272861 (self)
> >1 South Parks Road,                     +44 1865 272866 (PA)
> >Oxford OX1 3TG, UK                Fax:  +44 1865 272595
> >
> >
> 
> 
> 
> This e-mail, including any attachments, is a confidential business communication, and may contain information that is confidential, proprietary and/or privileged.  This e-mail is intended only for the individual(s) to whom it is addressed, and may not be saved, copied, printed, disclosed or used by anyone else.  If you are not the(an) intended recipient, please immediately delete this e-mail from your computer system and notify the sender.  Thank you.
> 
> ______________________________________________
> R-devel@stat.math.ethz.ch mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From Gregory.Tucker-Kellogg at mpi.com  Mon Sep 13 22:49:16 2004
From: Gregory.Tucker-Kellogg at mpi.com (Tucker-Kellogg, Gregory)
Date: Mon Sep 13 22:50:14 2004
Subject: [Rd] (PR#7225) propogation of rounding error for t.tests with
	unequal sample sizes (PR#7225)
Message-ID: <9AB4AB593A64B247870F76EB551BA4A3064E43DB@US-VS1.corp.mpi.com>


Thanks, I'm sure our users will welcome it.  

This is also the fastest bug response I've ever seen on any software,
and much appreciated.

GTK

>-----Original Message-----
>From: Prof Brian Ripley [mailto:ripley@stats.ox.ac.uk] 
>Sent: Monday, September 13, 2004 4:14 PM
>To: Tucker-Kellogg, Gregory
>Cc: R-bugs@biostat.ku.dk; r-devel@stat.math.ethz.ch
>Subject: RE: [Rd] (PR#7225) propogation of rounding error for 
>t.tests with unequal sample sizes (PR#7225)
>
>
>I am seeing NaNs, which is more sensible.
>
>We will add a test for stderr small compared to the larger group mean.
>
>On Mon, 13 Sep 2004, Tucker-Kellogg, Gregory wrote:
>
>> 
>> My apologies for not including the transcript in the 
>original message:
>> 
>> > xx <- rep(2.10,80)
>> > groups.balanced <- as.factor(c(rep("one",40),rep("two",40)))
>> > groups.unbalanced <- as.factor(c(rep("one",44),rep("two",36)))
>> > t.test(xx ~ groups.balanced)
>> 
>> 	Welch Two Sample t-test
>> 
>> data:  xx by groups.balanced
>> t = 0, df = 78, p-value = 1
>> alternative hypothesis: true difference in means is not equal to 0 
>> 95 percent confidence interval:
>>  -4.004247e-16  4.004247e-16 
>> sample estimates:
>> mean in group one mean in group two 
>>               2.1               2.1 
>> 
>> > t.test(xx ~ groups.unbalanced)
>> 
>> 	Welch Two Sample t-test
>> 
>> data:  xx by groups.unbalanced
>> t = -4.1007, df = 54.298, p-value = 0.0001388
>> alternative hypothesis: true difference in means is not equal to 0 
>> 95 percent confidence interval:
>>  -1.322366e-15 -4.539911e-16 
>> sample estimates:
>> mean in group one mean in group two 
>>               2.1               2.1 
>> 
>> 
>> 
>> >-----Original Message-----
>> >From: Prof Brian Ripley [mailto:ripley@stats.ox.ac.uk]
>> >Sent: Monday, September 13, 2004 4:04 PM
>> >To: Tucker-Kellogg, Gregory
>> >Cc: r-devel@stat.math.ethz.ch; R-bugs@biostat.ku.dk
>> >Subject: Re: [Rd] (PR#7225) propogation of rounding error for 
>> >t.tests with unequal sample sizes (PR#7225)
>> >
>> >
>> >What are you seeing here?  I get identical results in the two cases.
>> >
>> >On Mon, 13 Sep 2004 tucker@mpi.com wrote:
>> >
>> >> 
>> >> # users would benefit from a warning about the behavior in the #
>> >> groups.unbalanced case below.  A propogation of difference is the 
>> >> variance # calculation is leading to an apparently significant 
>> >> difference in # means, even though the numeric values are all 
>> >> identical.  Obviously upon # inspection the difference in 
>means is 
>> >> meaningless, but users might be warned # if all of the 
>input data is 
>> >> identical
>> >
>> >That's not so easy to achieve, given rounding error, but I am
>> >seeing 0 variance in both cases.
>> >
>> >> xx <- rep(2.10,80)
>> >> 
>> >> groups.balanced <- as.factor(c(rep("one",40),rep("two",40)))
>> >> groups.unbalanced <- as.factor(c(rep("one",44),rep("two",36)))
>> >> 
>> >> t.test(xx ~ groups.balanced)
>> >> 
>> >> t.test(xx ~ groups.unbalanced)
>> >> 
>> >> 
>> >> 
>> >> <<insert bug report here>>
>> >> 
>> >> 
>> >> 
>> >> --please do not edit the information below--
>> >> 
>> >> Version:
>> >>  platform = sparc-sun-solaris2.8
>> >>  arch = sparc
>> >>  os = solaris2.8
>> >>  system = sparc, solaris2.8
>> >>  status =
>> >>  major = 1
>> >>  minor = 9.0
>> >>  year = 2004
>> >>  month = 04
>> >>  day = 12
>> >>  language = R
>> >> 
>> >> Search Path:
>> >>  .GlobalEnv, package:methods, package:stats, package:graphics,
>> >> package:utils, Autoloads, package:base
>> >> 
>> >> 
>> >> 
>> >> This e-mail, including any attachments, is a confidential business
>> >> communication, and may contain information that is confidential, 
>> >> proprietary and/or privileged.  This e-mail is intended 
>only for the 
>> >> individual(s) to whom it is addressed, and may not be 
>saved, copied, 
>> >> printed, disclosed or used by anyone else.  If you are 
>not the(an) 
>> >> intended recipient, please immediately delete this e-mail 
>from your 
>> >> computer system and notify the sender.  Thank you.
>> >> 
>> >> ______________________________________________
>> >> R-devel@stat.math.ethz.ch mailing list
>> >> https://stat.ethz.ch/mailman/listinfo/r-devel
>> >> 
>> >> 
>> >
>> >-- 
>> >Brian D. Ripley,                  ripley@stats.ox.ac.uk
>> >Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
>> >University of Oxford,             Tel:  +44 1865 272861 (self)
>> >1 South Parks Road,                     +44 1865 272866 (PA)
>> >Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>> >
>> >
>> 
>> 
>> 
>> This e-mail, including any attachments, is a confidential business 
>> communication, and may contain information that is confidential, 
>> proprietary and/or privileged.  This e-mail is intended only for the 
>> individual(s) to whom it is addressed, and may not be saved, copied, 
>> printed, disclosed or used by anyone else.  If you are not the(an) 
>> intended recipient, please immediately delete this e-mail from your 
>> computer system and notify the sender.  Thank you.
>> 
>> ______________________________________________
>> R-devel@stat.math.ethz.ch mailing list 
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>> 
>> 
>
>-- 
>Brian D. Ripley,                  ripley@stats.ox.ac.uk
>Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
>University of Oxford,             Tel:  +44 1865 272861 (self)
>1 South Parks Road,                     +44 1865 272866 (PA)
>Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>
>



This e-mail, including any attachments, is a confidential business communication, and may contain information that is confidential, proprietary and/or privileged.  This e-mail is intended only for the individual(s) to whom it is addressed, and may not be saved, copied, printed, disclosed or used by anyone else.  If you are not the(an) intended recipient, please immediately delete this e-mail from your computer system and notify the sender.  Thank you.

From p.dalgaard at biostat.ku.dk  Tue Sep 14 01:13:49 2004
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Tue Sep 14 01:14:37 2004
Subject: [Rd] Problem with mle in stats4 (R 1.9.1)
In-Reply-To: <x2isaijdpz.fsf@biostat.ku.dk>
References: <003c01c499ac$82016290$82b98283@DH> <x2isaijdpz.fsf@biostat.ku.dk>
Message-ID: <x2656hkbiq.fsf@biostat.ku.dk>

Peter Dalgaard <p.dalgaard@biostat.ku.dk> writes:

> > (original posting with quick workaround
> > http://tolstoy.newcastle.edu.au/R/help/04/07/1778.html)
> 
> Could well be fix, not just workaround.... Given that optim wasn't
> designed to be able to hold arguments constant, any fix is going to be
> somewhat kludgy.

Had another look and your workaround turned out to be a bit too
kludgy. This seems to work (the eval() is important):

        if (!is.null(call$control$ndeps))
           call$control$ndeps <- eval(call$control$ndeps)[-i]
        if (!is.null(call$control$parscale))
           call$control$parscale <- eval(call$control$parscale)[-i]

and a bit further down, I think you need to move the assignment to
"call" inside the "for (i in which)" loop, so that the changes don't
accumulate. 

Leaves one issue, namely *where* to eval, and the above code is not
quite right (you might capture a local variable of profile.mle, and if
you called mle from a function, references to local variables inside
that function can not be passed). Then again it actually never was
right since the try(eval(call),....) call has the same issue. We
really ought to save the environment of the original call to mle to be
safe. How best to do that is a bit unclear to me. Could add a slot of
just set the environment of the call (but that seems not to be
documented to work...).

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

From Mark.Bravington at csiro.au  Tue Sep 14 01:38:55 2004
From: Mark.Bravington at csiro.au (Mark.Bravington@csiro.au)
Date: Tue Sep 14 01:39:11 2004
Subject: [Rd] memory allocation questions
Message-ID: <C4178DC99E08604EA5E2BDB989F0938002618EF6@extas2-hba.tas.csiro.au>

Dear R-devel

This one seems a bit arcane for R-help. I very often use R to call routines written in Delphi (son of Pascal), doing "persistent" memory allocation within Delphi. That is, I start R and load the Delphi DLL; then I use .C to call a Delphi routine which allocates a piece of memory X and returns to R a pointer to X; then I do some more stuff in R; then I call another Delphi routine, passing it the pointer to X. Finally, I call another Delphi routine from R to free the memory at X.

For years, I've used Delphi's own memory manager for this (the basic one, not SHAREMEM.DLL), but recently I've been wondering whether it would be better to use R's wrappers for "alloc" etc. instead. The Delphi routines seem generally to work fine, but my nagging concern [based on ignorance] is whether R's memory manager will somehow not realize that Delphi has already allocated the memory, and will overwrite it inadvertently. It's fairly easy to replace Delphi's manager with the R routines, following the instructions in section 5.1.2 of R-EXTS and the Delphi manual. So my first question is: 

should I bother using the R routines instead?

My second question is: 

if I do use the R replacements, what are their names nowadays?

R-EXTS refers to Calloc, Realloc and Free, but these aren't exported by R.DLL (for R1.9.0 or 1.9.1) and I couldn't find mention of any name change in the NEWS file. Running

dumpbin /exports R.dll | find /i "alloc"

suggests either "memalloc/memrealloc/memfree" or "Rm_alloc..." (or "R_chk_alloc..."). I gather that the S_alloc family is intended for temporary allocations that are cleared at the end of the the .C call.

Any insights appreciated. FWIW I use Windows 2000 and Delphi 6.

Mark

*******************************

Mark Bravington
CSIRO (CMIS)
PO Box 1538
Castray Esplanade
Hobart
TAS 7001

phone (61) 3 6232 5118
fax (61) 3 6232 5012
Mark.Bravington@csiro.au

From ripley at stats.ox.ac.uk  Tue Sep 14 08:06:19 2004
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue Sep 14 08:06:31 2004
Subject: [Rd] memory allocation questions
In-Reply-To: <C4178DC99E08604EA5E2BDB989F0938002618EF6@extas2-hba.tas.csiro.au>
Message-ID: <Pine.LNX.4.44.0409140703180.8690-100000@gannet.stats>

On Tue, 14 Sep 2004 Mark.Bravington@csiro.au wrote:

> My second question is: 
> 
> if I do use the R replacements, what are their names nowadays?

> R-EXTS refers to Calloc, Realloc and Free, but these aren't exported by
> R.DLL (for R1.9.0 or 1.9.1) and I couldn't find mention of any name
> change in the NEWS file.

There is no change.  R-exts does say you must include the appropriate 
headers, in this case include/R_ext/RS.h.  They are defines, and not just 
simple calls to entry points.  I'll leave you to take a closer look.

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From ligges at statistik.uni-dortmund.de  Tue Sep 14 08:36:24 2004
From: ligges at statistik.uni-dortmund.de (ligges@statistik.uni-dortmund.de)
Date: Tue Sep 14 08:36:27 2004
Subject: [Rd] Wishlist: axis() and line widths (PR#7223)
Message-ID: <20040914063624.E6E8511392@slim.kubism.ku.dk>

t.short@epri-peac.com wrote:

> Full_Name: Tom Short
> Version: 1.9.1
> OS: Win2000 & Debian
> Submission from: (NULL) (64.65.255.41)
> 
> 
> WISHLIST:
> 
> axis() has a default parameter of "lwd = 1". I want skinnier lines as the
> default. If I change the default lty, it doesn't change what axis uses.

Looks like you are confusing lty and lwd???

Anyway, both lty and lwd work fine:

  plot(1:10)
  axis(1, lty=2, col="red")
  axis(2, lwd=2)


> The following code produces a graph with a box around it, but the axis lines are
> twice as thick as the box around the plot, so it looks funny. I can manually add
> axes and explicitly set line widths, but that's a pain. The box() function does
> not set lty, so it uses the default par()$lwd.
> 
> 
>>par(lty = 0.5)
>>plot(c(1,2,3)) 

For sure you mean

par(lwd=0.5)
plot(1:3)

But that won't work on arbitrary devices (AFAIR), because 0.5 is smaller 
than 1 - and it's hard to draw things that are smaller than one point.


> 
> RECOMMENDATION: In axis(), change the default for "lwd" from 1 to par()$lwd.


No. If you want to change line widths of stuff within your plot, you 
don't want to change it for your axes as well.


Uwe Ligges


> ______________________________________________
> R-devel@stat.math.ethz.ch mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

From maechler at stat.math.ethz.ch  Tue Sep 14 08:50:55 2004
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Tue Sep 14 08:50:58 2004
Subject: [Rd] reorder [stats] and reorder.factor [lattice]
In-Reply-To: <200409131454.52268.deepayan@stat.wisc.edu>
References: <D7A3CFD7825BD6119B880002A58F06C20C521B26@groexmb02.pfizer.com>
	<200409131454.52268.deepayan@stat.wisc.edu>
Message-ID: <16710.38095.845558.684502@gargle.gargle.HOWL>

>>>>> "DeepS" == Deepayan Sarkar <deepayan@stat.wisc.edu>
>>>>>     on Mon, 13 Sep 2004 14:54:52 -0500 writes:

    DeepS> Before it's too late for R 2.0.0, do we have a final decision yet on 
    DeepS> having a reorder method for "factor" in stats?

Since the thread is quite a bit old, (and I have been in vacation back then),
could you summarize what you think about it?

When skimming through the thread I got the impression that, yes,
it was worth to "centralize" such a method in 'stats' rather
than have different slightly incompatible versions in different
other packages.
This is of tangential interest to me as I have been slightly
involved with reorder.dendrogram()

Regards,
Martin

From ripley at stats.ox.ac.uk  Tue Sep 14 09:06:54 2004
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue Sep 14 09:06:59 2004
Subject: [Rd] reorder [stats] and reorder.factor [lattice]
In-Reply-To: <16710.38095.845558.684502@gargle.gargle.HOWL>
Message-ID: <Pine.LNX.4.44.0409140758450.8982-100000@gannet.stats>

Summary: I have just put a version in stats as supplied by Deepayan.  It
is more or less the same as that in Trellis (there never was one in
lattice AFAIK), except that the result is by default only ordered if the
input was, and the `scores' used to do the ordering are returned. (Both 
points I raised in earlier discussions.)

Package gregmisc has a different function of that name which appears to be
more related to relevel and levels<-.

On Tue, 14 Sep 2004, Martin Maechler wrote:

> >>>>> "DeepS" == Deepayan Sarkar <deepayan@stat.wisc.edu>
> >>>>>     on Mon, 13 Sep 2004 14:54:52 -0500 writes:
> 
>     DeepS> Before it's too late for R 2.0.0, do we have a final decision yet on 
>     DeepS> having a reorder method for "factor" in stats?
> 
> Since the thread is quite a bit old, (and I have been in vacation back then),
> could you summarize what you think about it?
> 
> When skimming through the thread I got the impression that, yes,
> it was worth to "centralize" such a method in 'stats' rather
> than have different slightly incompatible versions in different
> other packages.
> This is of tangential interest to me as I have been slightly
> involved with reorder.dendrogram()
> 
> Regards,
> Martin
> 
> ______________________________________________
> R-devel@stat.math.ethz.ch mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From zpcibhokamkicff at mvuusx.rx-factory.com  Tue Sep 14 10:26:32 2004
From: zpcibhokamkicff at mvuusx.rx-factory.com (Kristine Bolton)
Date: Tue Sep 14 09:31:11 2004
Subject: [Rd] freeman description
Message-ID: <D22E4FD6.07634@rx-factory.com>

Hi,

Prescription prices in the states are extremely high, drug developers figure they can charge a small fortune.

Buying overseas cuts costs.
Copy and paste http://rx-factory.com/ into your address bar to recieve your discount

Notifications off
http://rx-factory.com/u

Kristine Bolton
zpcibhokamkicff@mvuusx.rx-factory.com

From ripley at stats.ox.ac.uk  Tue Sep 14 12:34:05 2004
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue Sep 14 12:34:08 2004
Subject: [Rd] Re: [R] R-2.0.0 CMD check .  and datasets
In-Reply-To: <a06002003bd6c69b01b0a@[139.166.242.29]>
Message-ID: <Pine.LNX.4.44.0409141126380.29156-100000@gannet.stats>

This is question about the the development version of R and should have 
gone to the R-devel list according to the posting guide.

  R-devel is intended for questions and discussion about code development 
  in R. Questions likely to prompt discussion unintelligible to non-programmers 
  should go to to R-devel. 

Did you read the NEWS for that version, and did you look at the notes on 
developer.r-project.org for 2.0.0 (as posted to the R-devel list 
recently)?  If not, please do so now.

Please, as the FAQ asks, don't give us an incorrect explanation but facts.
Your problem *appears* to be that you have ignored the following statement
in `Writing R Extensions':

  Note that R code should be "self-sufficient" and not make use of extra 
  functionality provided by the package, so that the data file can also be 
  used without having to load the package.

and as the notes for 2.0.0 say, this is now enforced.  As you have 
quibbled once before, let me stress this a pre-existing error that is now 
detected.


On Tue, 14 Sep 2004, Robin Hankin wrote:

> Hello everyone
> 
> I'm having a little difficulty with R-2.0.0 CMD check.  My field is 
> Bayesian calibration of computer models.
> 
> The problem is  that I have a large collection of toy datasets, that 
> in R-1.9.1 were specified with lines
> like this:
> 
> x.toy <- 1:6
> y.toy <- computer.model(x.toy)
> z.toy <- reality(x.toy)
> 
> in file ./data/toys.R ; functions computer.model() and reality() are 
> defined in ./R/calibrator.R.
> 
> [In this application,  the (toy) functions computer.model() and 
> reality() are the objects of inference, as
> per the standard Bayesian approach.  The functions are nonrandom in 
> that they are deterministic but
> random in the Bayesian sense.  Thus y.toy and z.toy are observations 
> of (random) functions].
> 
> In the Real World, one would have access to x.toy, y.toy, and z.toy 
> but not (of course) computer.model()
> or reality().  These functions should never be seen or referred to 
> because they are Unknown.
> 
> So, in many of the code examples, I use  things like 
> "some.function(y.toy, z.toy)" . . . and  I need
> y.toy and z.toy to be consistent between different functions.
> 
> I think R-2.0.0 sources ./data/toys.R *before* the files in ./R/   ; 
> and this throws an error in
> R2 CMD check, because the functions are not found.
> 
> What is best practice to generate this kind of toy dataset?
> 
> 
> 
> 

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From murdoch at stats.uwo.ca  Tue Sep 14 15:03:20 2004
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Tue Sep 14 15:03:30 2004
Subject: [Rd] memory allocation questions
In-Reply-To: <C4178DC99E08604EA5E2BDB989F0938002618EF6@extas2-hba.tas.csiro.au>
References: <C4178DC99E08604EA5E2BDB989F0938002618EF6@extas2-hba.tas.csiro.au>
Message-ID: <bgqdk0lso4fj1j69etfpm1545aqca9ei7n@4ax.com>

On Tue, 14 Sep 2004 09:38:55 +1000, <Mark.Bravington@csiro.au> wrote :

>Dear R-devel
>
>This one seems a bit arcane for R-help. I very often use R to call routines written in Delphi (son of Pascal), doing "persistent" memory allocation within Delphi. That is, I start R and load the Delphi DLL; then I use .C to call a Delphi routine which allocates a piece of memory X and returns to R a pointer to X; then I do some more stuff in R; then I call another Delphi routine, passing it the pointer to X. Finally, I call another Delphi routine from R to free the memory at X.
>
>For years, I've used Delphi's own memory manager for this (the basic one, not SHAREMEM.DLL), but recently I've been wondering whether it would be better to use R's wrappers for "alloc" etc. instead. The Delphi routines seem generally to work fine, but my nagging concern [based on ignorance] is whether R's memory manager will somehow not realize that Delphi has already allocated the memory, and will overwrite it inadvertently. It's fairly easy to replace Delphi's manager with the R routines, following the instructions in section 5.1.2 of R-EXTS and the Delphi manual. So my first question is: 
>
>should I bother using the R routines instead?

There is not much reason to need to use the R routines.  The
disadvantages of using Delphi allocation are:

  - Your allocations won't be automatically deleted by the garbage
collector (but neither are those of Calloc, you need R_alloc for that)
  - If allocation fails, it will be up to you to detect that and deal
with it.

The disadvantage of using the R routines Calloc etc. is that
  - You need to translate C macros to Delphi.
  - You need to worry about whether the RS.h file has changed with
each release (but the Calloc etc. macros are likely to be very stable,
they haven't changed since 2000).

Duncan Murdoch

From joehl at gmx.de  Tue Sep 14 16:10:36 2004
From: joehl at gmx.de (joehl@gmx.de)
Date: Tue Sep 14 16:10:41 2004
Subject: [Rd] documentation error par("cin") and par("cra") (PR#7227)
Message-ID: <20040914141036.6681E11399@slim.kubism.ku.dk>


Dear all,

the help of par() claims that 
cin and cra are 
c(width, height)
but it appears to be rather 
c(height, width)

Best regards


Jens Oehlschl?gel


> plot.new()
> strheight("W", unit="inches")
[1] 0.1354167
> par("cin")
[1] 0.1354167 0.1875000
> version
         _              
platform i386-pc-mingw32
arch     i386           
os       mingw32        
system   i386, mingw32  
status                  
major    1              
minor    9.1            
year     2004           
month    06             
day      21             
language R 

--

From andy_liaw at merck.com  Tue Sep 14 16:28:31 2004
From: andy_liaw at merck.com (Liaw, Andy)
Date: Tue Sep 14 16:28:59 2004
Subject: [Rd] is it a typo?
Message-ID: <3A822319EB35174CA3714066D590DCD504AF83A0@usrymx25.merck.com>

In ?options:

     'warning.expression': an R code expression to be called if a
          warning is generated, replacing the standard message.  If
          non-null is called irrespective of the value of option
          'warn'.

Is there a missing `it' between `non-null' and `is'?

Best,
Andy

From ripley at stats.ox.ac.uk  Tue Sep 14 17:06:50 2004
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue Sep 14 17:07:05 2004
Subject: [Rd] documentation error par("cin") and par("cra") (PR#7227)
In-Reply-To: <20040914141036.6681E11399@slim.kubism.ku.dk>
Message-ID: <Pine.LNX.4.44.0409141546490.29765-100000@gannet.stats>

On Tue, 14 Sep 2004 joehl@gmx.de wrote:

> the help of par() claims that 
> cin and cra are 
> c(width, height)

That is the design intention.

> but it appears to be rather 
> c(height, width)

On what evidence?  W has no descenders, so its height is less than the
typical box.  It's coincidence, BTW, that the numbers are the same: I get

> par("cin")
[1] 0.15 0.20
> strheight("W", unit="inches")
[1] 0.1196667

and characters are on average taller than they are wide.  strheight
reports the same for all characters, but strwidth does not.

Here is the code (in par.c)

    else if (streql(what, "cin")) {
	value = allocVector(REALSXP, 2);
	REAL(value)[0] = Rf_dpptr(dd)->cra[0]*Rf_dpptr(dd)->ipr[0];
	REAL(value)[1] = Rf_dpptr(dd)->cra[1]*Rf_dpptr(dd)->ipr[1];
    }

cra is set in the driver, and postscript has

    dd->cra[0] = 0.9 * pointsize;
    dd->cra[1] = 1.2 * pointsize;

whereas windows() has

    gcharmetric(xd->gawin, xd->font, -1, &a, &d, &w);
    dd->cra[0] = w * xd->rescale_factor;
    dd->cra[1] = (a + d) * xd->rescale_factor;

so it really is (width, height).  OTOH, strheight doesn't look at the 
character, just the height of "M" (no descenders).  See the comment

        /* cra is based on the font pointsize at the
         * time the device was created.
         * Adjust for potentially different current pointsize
         * This is a crude calculation that might be better
         * performed using a device call that responds with
         * the current font pointsize in device coordinates.
         */
         /* Add in the ascent of the font, if available */

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From maechler at stat.math.ethz.ch  Tue Sep 14 17:52:11 2004
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Tue Sep 14 17:52:12 2004
Subject: [Rd] is it a typo?
In-Reply-To: <3A822319EB35174CA3714066D590DCD504AF83A0@usrymx25.merck.com>
References: <3A822319EB35174CA3714066D590DCD504AF83A0@usrymx25.merck.com>
Message-ID: <16711.5035.433997.79445@gargle.gargle.HOWL>

>>>>> "AndyL" == Liaw, Andy <andy_liaw@merck.com>
>>>>>     on Tue, 14 Sep 2004 10:28:31 -0400 writes:

    AndyL> In ?options:
    AndyL> 'warning.expression': an R code expression to be called if a
    AndyL> warning is generated, replacing the standard message.  If
    AndyL> non-null is called irrespective of the value of option
    AndyL> 'warn'.

    AndyL> Is there a missing `it' between `non-null' and `is'?

yes, thank you -- now fixed.

Martin

From andy_liaw at merck.com  Tue Sep 14 19:49:46 2004
From: andy_liaw at merck.com (Liaw, Andy)
Date: Tue Sep 14 19:50:10 2004
Subject: [Rd] how to use update if method for formula is not in namespace?
Message-ID: <3A822319EB35174CA3714066D590DCD504AF83AC@usrymx25.merck.com>

Dear R-devel,

I've noticed that if the method for formula is not exported in NAMESPACE,
then update() would fail.  As an example:

> library(e1071)
> data(iris)
> iris.svm <- svm(Species ~ ., data=iris)
> update(iris.svm)
Error in eval(expr, envir, enclos) : couldn't find function "svm.formula"

The same thing happens with randomForest, because randomForest.formula() was
not exported.  Is this the intended behavior of update()?  What would be the
preferred work-around?

Best,
Andy

From ripley at stats.ox.ac.uk  Tue Sep 14 21:42:49 2004
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue Sep 14 21:42:55 2004
Subject: [Rd] how to use update if method for formula is not in namespace?
In-Reply-To: <3A822319EB35174CA3714066D590DCD504AF83AC@usrymx25.merck.com>
Message-ID: <Pine.LNX.4.44.0409142040230.30384-100000@gannet.stats>

On Tue, 14 Sep 2004, Liaw, Andy wrote:

> Dear R-devel,
> 
> I've noticed that if the method for formula is not exported in NAMESPACE,
> then update() would fail.  As an example:
> 
> > library(e1071)
> > data(iris)
> > iris.svm <- svm(Species ~ ., data=iris)
> > update(iris.svm)
> Error in eval(expr, envir, enclos) : couldn't find function "svm.formula"
> 
> The same thing happens with randomForest, because randomForest.formula() was
> not exported.  Is this the intended behavior of update()?  What would be the
> preferred work-around?

It is.   randomForest.formula should be written to report its call as to 
randomForest.  Take a look at e.g. rlm.formula.

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From andy_liaw at merck.com  Tue Sep 14 21:53:42 2004
From: andy_liaw at merck.com (Liaw, Andy)
Date: Tue Sep 14 21:54:16 2004
Subject: [Rd] how to use update if method for formula is not in namesp ace?
Message-ID: <3A822319EB35174CA3714066D590DCD504AF83B2@usrymx25.merck.com>

> From: Prof Brian Ripley 
> 
> On Tue, 14 Sep 2004, Liaw, Andy wrote:
> 
> > Dear R-devel,
> > 
> > I've noticed that if the method for formula is not exported 
> in NAMESPACE,
> > then update() would fail.  As an example:
> > 
> > > library(e1071)
> > > data(iris)
> > > iris.svm <- svm(Species ~ ., data=iris)
> > > update(iris.svm)
> > Error in eval(expr, envir, enclos) : couldn't find function 
> "svm.formula"
> > 
> > The same thing happens with randomForest, because 
> randomForest.formula() was
> > not exported.  Is this the intended behavior of update()?  
> What would be the
> > preferred work-around?
> 
> It is.   randomForest.formula should be written to report its 
> call as to 
> randomForest.  Take a look at e.g. rlm.formula.

Got it!  Works now.  Many thanks!

Best,
Andy

 
> -- 
> Brian D. Ripley,                  ripley@stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
> 
> 
>

From wolski at molgen.mpg.de  Tue Sep 14 22:34:18 2004
From: wolski at molgen.mpg.de (Wolski)
Date: Tue Sep 14 22:34:28 2004
Subject: [Rd] prototype in setClass.
Message-ID: <200409142234180547.08111512@mail.math.fu-berlin.de>

Hi!

To specify a prototype in the setClass declaration is a great feature.
But prototype seems no to work for slots of the "super" class.
eg. The following code is declaring first the super class "List".  This class has a slot "content". 
The class "AtomList" inherits from it and I would like to set content="Atom" by prototype(content="Atom").
But after new("AtomList") is called the slot content is empty as you can see running the code below.

setClass("List"
         ,representation(
                         uniq="logical"
                         ,content="character"                           ##### would like to set this when declaring the inheriting class.
                         ,names="character") 
         ,contains="list"
         ,prototype(uniq=FALSE)
         )


setClass("AtomList"
         ,contains="List"
         ,prototype(content="Atom")                                ## would like to specify this
         )

new("AtomList")


An object of class "AtomList"
list()
Slot "uniq":
[1] FALSE

Slot "content":
character(0)                                                            #######<-still not specified even if provided in prototype.

Slot "names":
character(0)


Version:

R : Copyright 2004, The R Foundation for Statistical Computing
Version 2.0.0 alpha (2004-09-14), ISBN 3-900051-07-0
or
R1.9.1 patched.

/E

From Mark.Bravington at csiro.au  Wed Sep 15 00:47:31 2004
From: Mark.Bravington at csiro.au (Mark.Bravington@csiro.au)
Date: Wed Sep 15 00:47:36 2004
Subject: [Rd] memory allocation questions
Message-ID: <C4178DC99E08604EA5E2BDB989F093800240A34D@extas2-hba.tas.csiro.au>

Thanks both

All seems to work now, whether I use R_chk_alloc etc. (as per RS.h) or the Delphi routines. Sounds like I might as well stick with the latter though, since I have to do the housekeeping anyway.

Mark

#>should I bother using the R [memory allocation] routines instead [of the Delphi built-ins]?
#
#There is not much reason to need to use the R routines.  The
#disadvantages of using Delphi allocation are:
#
#  - Your allocations won't be automatically deleted by the garbage
#collector (but neither are those of Calloc, you need R_alloc for that)
#  - If allocation fails, it will be up to you to detect that and deal
#with it.
#
#The disadvantage of using the R routines Calloc etc. is that
#  - You need to translate C macros to Delphi.
#  - You need to worry about whether the RS.h file has changed with
#each release (but the Calloc etc. macros are likely to be very stable,
#they haven't changed since 2000).
#
#Duncan Murdoch
#

#> if I do use the R replacements, what are their names nowadays?
#
#> R-EXTS refers to Calloc, Realloc and Free, but these aren't exported by
#> R.DLL (for R1.9.0 or 1.9.1) and I couldn't find mention of any name
#> change in the NEWS file.
#
#There is no change.  R-exts does say you must include the appropriate 
#headers, in this case include/R_ext/RS.h.  They are defines, and not just 
#simple calls to entry points.  I'll leave you to take a closer look.
#
#-- 
#Brian D. Ripley,                  ripley@stats.ox.ac.uk

From sjekkAlderOgPeker at met.no  Wed Sep 15 07:55:01 2004
From: sjekkAlderOgPeker at met.no (sjekkAlderOgPeker@met.no)
Date: Wed Sep 15 07:55:06 2004
Subject: [Rd] Feil i websider (PR#7228)
Message-ID: <20040915055501.CD81B1138B@slim.kubism.ku.dk>


Warnings about /metno/internweb/fouweb/htdocs/teknisk/verktoy/R/faq.html

	BAD LINK: http://stat.ethz.ch/R/manual/
	BAD LINK: http://nlme.stat.wisc.edu/MEMSS/
	BAD LINK: http://stats.mth.uea.ac.uk/Rcgi/
	BAD LINK: http://software.biostat.washington.edu/statsoft/ess/

------------------------------------------------------------
Warnings about /metno/internweb/fouweb/htdocs/teknisk/verktoy/R/resources.html

	BAD LINK: http://fou.oslo.dnmi.no/teknisk/verktoy/R/r-announce@lists.r-project.org
	BAD LINK: http://fou.oslo.dnmi.no/teknisk/verktoy/R/r-help@lists.r-project.org
	BAD LINK: http://fou.oslo.dnmi.no/teknisk/verktoy/R/r-devel@lists.r-project.org
	BAD LINK: http://fou.oslo.dnmi.no/teknisk/verktoy/R/r-announce-request@lists.r-project.org
	BAD LINK: http://fou.oslo.dnmi.no/teknisk/verktoy/R/r-help-request@lists.r-project.org
	BAD LINK: http://fou.oslo.dnmi.no/teknisk/verktoy/R/r-devel-request@lists.r-project.org
	BAD LINK: http://mirror.aarnet.edu.au/pub/CRAN/
	BAD LINK: http://mirrors.theonlinerecordstore.com/CRAN/

From ligges at statistik.uni-dortmund.de  Wed Sep 15 16:59:33 2004
From: ligges at statistik.uni-dortmund.de (Uwe Ligges)
Date: Wed Sep 15 16:58:03 2004
Subject: [Rd] Bug in merge() in R-2.0.0 alpha
Message-ID: <414858D5.7060308@statistik.uni-dortmund.de>

In some cases, merge() has a problem in R-2.0.0 alpha (2004-09-14):

   x <- structure(c("a", "b", "2", "0.2-26", "O", "O"), .Dim = c(2, 3),
     .Dimnames = list(c("1", "2"), c("P", "V", "2")))

   y <- structure(c("a", "b", "2", "0.2-25", "O", "O"), .Dim = c(2, 3),
     .Dimnames = list(c("1", "2"), c("P", "V", "1")))

   merge(x, y, all.y=TRUE)

Error in "[<-"(`*tmp*`, ri, value = NULL) :
         incompatible types


Looks like the NA handling has changed anywhere.

Uwe Ligges

From jmc at research.bell-labs.com  Wed Sep 15 17:13:47 2004
From: jmc at research.bell-labs.com (John Chambers)
Date: Wed Sep 15 17:14:04 2004
Subject: [Rd] prototype in setClass.
References: <200409142234180547.08111512@mail.math.fu-berlin.de>
Message-ID: <41485C2B.C71C52B6@research.bell-labs.com>

It works better if you give setClass the right arguments.

In your second call,  you omitted the representation= argument, so you
need to name the prototype argument:

setClass("AtomList"
         ,contains="List"
         ,prototype =
prototype(content="Atom")                                ## would like
to specify this
         )

With this change:

R> new("AtomList")
An object of class "AtomList"
list()
Slot "uniq":
[1] FALSE

Slot "content":
[1] "Atom"

(We can probably do some bullet-proofing, since the object returned from
prototype() has a specific class, but that may have to wait until
2.0.1.)


Wolski wrote:
> 
> Hi!
> 
> To specify a prototype in the setClass declaration is a great feature.
> But prototype seems no to work for slots of the "super" class.
> eg. The following code is declaring first the super class "List".  This class has a slot "content".
> The class "AtomList" inherits from it and I would like to set content="Atom" by prototype(content="Atom").
> But after new("AtomList") is called the slot content is empty as you can see running the code below.
> 
> setClass("List"
>          ,representation(
>                          uniq="logical"
>                          ,content="character"                           ##### would like to set this when declaring the inheriting class.
>                          ,names="character")
>          ,contains="list"
>          ,prototype(uniq=FALSE)
>          )
> 
> setClass("AtomList"
>          ,contains="List"
>          ,prototype(content="Atom")                                ## would like to specify this
>          )
> 
> new("AtomList")
> 
> An object of class "AtomList"
> list()
> Slot "uniq":
> [1] FALSE
> 
> Slot "content":
> character(0)                                                            #######<-still not specified even if provided in prototype.
> 
> Slot "names":
> character(0)
> 
> Version:
> 
> R : Copyright 2004, The R Foundation for Statistical Computing
> Version 2.0.0 alpha (2004-09-14), ISBN 3-900051-07-0
> or
> R1.9.1 patched.
> 
> /E
> 
> ______________________________________________
> R-devel@stat.math.ethz.ch mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
John M. Chambers                  jmc@bell-labs.com
Bell Labs, Lucent Technologies    office: (908)582-2681
700 Mountain Avenue, Room 2C-282  fax:    (908)582-3340
Murray Hill, NJ  07974            web: http://www.cs.bell-labs.com/~jmc

From ripley at stats.ox.ac.uk  Wed Sep 15 17:57:39 2004
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed Sep 15 17:57:44 2004
Subject: [Rd] file.info() on file larger than 2GB
In-Reply-To: <Pine.LNX.4.44.0408311601020.29264-100000@gannet.stats>
Message-ID: <Pine.LNX.4.44.0409151650550.17296-100000@gannet.stats>

This appears to be fairly easy to solve, at least on Linux.  R-devel now 
has an option --enable-linux-lfs that sets up the appropriate flags (and a 
very few other code changes were needed).  Similar options work on 
Solaris.

I have been able to create a 2.5Gb text file, move around it and read
lines from here and there including near the end, both as a plain file and
as a gzip-ed file.  And file.info reports correctly.

On Tue, 31 Aug 2004, Prof Brian Ripley wrote:

> This is a purely OS issue: your OS has not been set up so the fopen and
> stat calls handle > 2Gb files.  There is one R issue: the size will
> overflow in file.info.
> 
> For example, under Solaris 64-bit applications can handle such files 
> whereas 32-bit ones need calls to stat64, fopen64 etc.
> 
> It seems a very exotic need, but if someone wants to find out how to use 
> the OS-specific ways to extend stat etc and supply patches, please do so.
> 
> We don't put OS-specific limitations on help pages.
> 
> On Tue, 31 Aug 2004, Roger D. Peng wrote:
> 
> > I've got a file that's approximately 2.2GB and it seems to be foiling 
> > file.info().  When I run `stat' from the shell I get
> > 
> > zooey:> stat data.csv
> >    File: `data.csv'
> >    Size: 2271197563      Blocks: 4440280    IO Block: 4096   regular file
> > Device: 342h/834d       Inode: 9994308     Links: 1
> > Access: (0644/-rw-r--r--)  Uid: (  500/   rpeng)   Gid: (  500/   rpeng)
> > Access: 2004-08-31 09:50:04.000000000 -0400
> > Modify: 2004-08-26 19:09:42.000000000 -0400
> > Change: 2004-08-31 09:53:29.000000000 -0400
> 
> Take a look at the source code for stat, in coreutils.
> 
> > But, file.info() in R-devel gives me:
> > 
> >  > file.info("data.csv")
> >           size isdir mode mtime ctime atime uid gid uname grname
> > data.csv   NA    NA <NA>  <NA>  <NA>  <NA>  NA  NA  <NA>   <NA>
> > 
> > I assume this has something to do with the underlying call to `stat' 
> > in `do_fileinfo'.
> > 
> > This alone is not much of a problem but I also can't seem to be able 
> > to open a file connection to the same file.  For example,
> > 
> >  > con <- file("data.csv")
> >  > open(con, "r")
> > Error in open.connection(con, "r") : unable to open connection
> > In addition: Warning message:
> > cannot open file `data.csv'
> > 
> > Also, interestingly,
> > 
> >  > file.exists("data.csv")
> > [1] FALSE
> > 
> > I take it all these things are related.
> > 
> > Is it possible to fix this within R?  Or should there be a note in the 
> > help pages?
> > 
> >  > version
> >           _
> > platform i686-pc-linux-gnu
> > arch     i686
> > os       linux-gnu
> > system   i686, linux-gnu
> > status   Under development (unstable)
> > major    2
> > minor    0.0
> > year     2004
> > month    08
> > day      31
> > language R
> > 
> > -roger
> > 
> > ______________________________________________
> > R-devel@stat.math.ethz.ch mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> > 
> > 
> 
> 

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From p.dalgaard at biostat.ku.dk  Wed Sep 15 18:00:27 2004
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Wed Sep 15 18:01:23 2004
Subject: [Rd] Bug in merge() in R-2.0.0 alpha
In-Reply-To: <414858D5.7060308@statistik.uni-dortmund.de>
References: <414858D5.7060308@statistik.uni-dortmund.de>
Message-ID: <x2fz5j4j50.fsf@biostat.ku.dk>

Uwe Ligges <ligges@statistik.uni-dortmund.de> writes:

> In some cases, merge() has a problem in R-2.0.0 alpha (2004-09-14):
> 
>    x <- structure(c("a", "b", "2", "0.2-26", "O", "O"), .Dim = c(2, 3),
>      .Dimnames = list(c("1", "2"), c("P", "V", "2")))
> 
>    y <- structure(c("a", "b", "2", "0.2-25", "O", "O"), .Dim = c(2, 3),
>      .Dimnames = list(c("1", "2"), c("P", "V", "1")))
> 
>    merge(x, y, all.y=TRUE)
> 
> Error in "[<-"(`*tmp*`, ri, value = NULL) :
>          incompatible types
> 
> 
> Looks like the NA handling has changed anywhere.

Names handling, more likely:

> v <- structure(list("2" = NA), .Names = "2", class = "data.frame", row.names = "2")
> u <- structure(list("2" = structure(1, .Names = "1", .Label = "O", class = "factor")), .Names = "2", class = "data.frame", row.names = "1")
> uu <- structure(list("2" = structure(1,  .Label = "O", class = "factor")), .Names = "2", class = "data.frame", row.names = "1")
> rbind(v,u)
     2
2 <NA>
1    O
> rbind(v,uu)
     2
2 <NA>
1    O
> rbind(u,v)
Error during wrapup: incompatible types
> rbind(uu,v)
     2
1    O
2 <NA>


(Notice that the only difference between u and uu is the .Names bit)

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

From mayeul.kauffmann at tiscali.fr  Thu Sep 16 01:23:09 2004
From: mayeul.kauffmann at tiscali.fr (Mayeul KAUFFMANN)
Date: Thu Sep 16 01:23:28 2004
Subject: [Rd] cor() fails with big dataframe
Message-ID: <000501c49b7a$fafebb50$ce979a53@amd>

Hello,

I have a big dataframe with *NO* na's (9 columns, 293380 rows).

# doing
memory.limit(size = 1000000000)
cor(x)
#gives
Error in cor(x) : missing observations in cov/cor
In addition: Warning message:
NAs introduced by coercion

#I found the obvious workaround:
COR <- matrix(rep(0, 81),9,9)
for (i in 1:9) for (j in 1:9) {if (i>j) COR[i,j] <- cor (x[,i],x[,j])}
#which works fine, with no warning

#looks like a "cor()" bug.

#I checked absence of NA's by
x <- x[complete.cases(x),]
summary(x)
apply(x,2, function (x) (sum(is.na(x))))

#I use R 1.9.1

Cheers,
Mayeul KAUFFMANN
Universit? Pierre Mend?s France
Grenoble - France

From Mark.Bravington at csiro.au  Thu Sep 16 05:21:07 2004
From: Mark.Bravington at csiro.au (Mark.Bravington@csiro.au)
Date: Thu Sep 16 05:21:15 2004
Subject: FW: [Rd] Parsing multi-line strings.  Bug?  Feature?
Message-ID: <C4178DC99E08604EA5E2BDB989F093800240A352@extas2-hba.tas.csiro.au>

>  Kevin Wright <kwright@eskimo.com> writes:
>
>  > R 1.9.1 requires multi-line strings to contain a backslash at the
>  > end of each line (except the last line).  As noted by Mark
>  > Bravington (http://tolstoy.newcastle.edu.au/R/help/02b/5199.html)
>  > this requirement appears to be undocumented.
>  > 
>  > In S-Plus 6.2, multi-line strings do not need a backslash for continuation.
>  > 
>  > I recently (http://tolstoy.newcastle.edu.au/R/devel/04b/0256.html)
>  > requested compatability with S-Plus and was told to contribute
>  > a patch and then it would be considered.  Here is the proposed patch.

<<snip>>

>  > Thanks for considering this patch.
>
> Peter Dalgaard wrote:

>  Sorry, I don't think that is good enough (notwithstanding the
>  nonstandard comment character). Notice that Splus does this:
>
>  > x <- "foo
>  Continue string: bar
>  Continue string: baz"
>
>  (and the entry is interruptible with Ctrl-C too)
>
>  There's a very good reason for the change of prompt, as anyone who has
>  debugged SAS code with stray quotes will tell you: The system would
>  appear to be completely unresponsive because all input is being eaten
>  by the string readers.

I think the following patch in StringValue might address Peter Dalgaard's point: when a bare newline is found (i.e. not preceded by a backslash), it's pushed back onto the character stack via xxungetc(c) and StringValue pretends that it's just read a backslash instead. Then, as usual, it looks for the next character which is of course a newline, and proceeds as normal.

Output is from diff gram.c on R-devel from 7/9/2004. I hope the comments look sufficiently standard now (I'm not a C programmer).

Mark

3122a3123,3124
>           /* Old behaviour was: return ERROR; */
>           /* Now pretend there was a backslash before EOL */
3124c3126
<           return ERROR;
---
>           c = '\\';



>

*******************************

Mark Bravington
CSIRO (CMIS)
PO Box 1538
Castray Esplanade
Hobart
TAS 7001

phone (61) 3 6232 5118
fax (61) 3 6232 5012
Mark.Bravington@csiro.au

From ripley at stats.ox.ac.uk  Thu Sep 16 07:50:18 2004
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu Sep 16 07:50:20 2004
Subject: [Rd] Bug in merge() in R-2.0.0 alpha
In-Reply-To: <414858D5.7060308@statistik.uni-dortmund.de>
Message-ID: <Pine.LNX.4.44.0409160644390.9075-100000@gannet.stats>

On Wed, 15 Sep 2004, Uwe Ligges wrote:

> In some cases, merge() has a problem in R-2.0.0 alpha (2004-09-14):
> 
>    x <- structure(c("a", "b", "2", "0.2-26", "O", "O"), .Dim = c(2, 3),
>      .Dimnames = list(c("1", "2"), c("P", "V", "2")))
> 
>    y <- structure(c("a", "b", "2", "0.2-25", "O", "O"), .Dim = c(2, 3),
>      .Dimnames = list(c("1", "2"), c("P", "V", "1")))
> 
>    merge(x, y, all.y=TRUE)
> 
> Error in "[<-"(`*tmp*`, ri, value = NULL) :
>          incompatible types
> 
> 
> Looks like the NA handling has changed anywhere.

Peter was right.  rbind.data.frame had

                ## copy names if any
                names(value[[jj]])[ri] <- names(xj)

but did not test if there were any.  It would probably be a good idea if 
that did work but for now I have added a test.

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From vangyzen at stat.duke.edu  Wed Sep 15 19:51:17 2004
From: vangyzen at stat.duke.edu (vangyzen@stat.duke.edu)
Date: Thu Sep 16 12:00:37 2004
Subject: [Rd] R CMD INSTALL doesn't always clean up (PR#7230)
Message-ID: <20040915175117.E62B51138A@slim.kubism.ku.dk>

Full_Name: Eric van Gyzen
Version: 1.9.1
OS: FreeBSD
Submission from: (NULL) (152.3.22.120)


In several cases, "R CMD INSTALL" doesn't remove its temporary directory.  It
should call "do_cleanup" before every "exit".

From ripley at stats.ox.ac.uk  Thu Sep 16 12:36:26 2004
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu Sep 16 12:36:31 2004
Subject: [Rd] R CMD INSTALL doesn't always clean up (PR#7230)
In-Reply-To: <20040915175117.E62B51138A@slim.kubism.ku.dk>
Message-ID: <Pine.LNX.4.44.0409161134580.23664-100000@gannet.stats>

1) Please give us a reproducible example, as asked in the FAQ.

2) We are in alpha test, near beta test, of R 2.0.0, so please check your 
examples under the public alphas of R 2.0.0.

On Wed, 15 Sep 2004 vangyzen@stat.duke.edu wrote:

> Full_Name: Eric van Gyzen
> Version: 1.9.1
> OS: FreeBSD
> Submission from: (NULL) (152.3.22.120)
> 
> 
> In several cases, "R CMD INSTALL" doesn't remove its temporary directory.  It
> should call "do_cleanup" before every "exit".

Perhaps those cases are deliberate?

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From maechler at stat.math.ethz.ch  Thu Sep 16 12:44:09 2004
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Thu Sep 16 12:44:11 2004
Subject: [Rd] cor() fails with big dataframe
In-Reply-To: <000501c49b7a$fafebb50$ce979a53@amd>
References: <000501c49b7a$fafebb50$ce979a53@amd>
Message-ID: <16713.28281.444833.509876@gargle.gargle.HOWL>

>>>>> "Mayeul" == Mayeul KAUFFMANN <mayeul.kauffmann@tiscali.fr>
>>>>>     on Thu, 16 Sep 2004 01:23:09 +0200 writes:

    Mayeul> Hello,
    Mayeul> I have a big dataframe with *NO* na's (9 columns, 293380 rows).

    Mayeul> # doing
    Mayeul> memory.limit(size = 1000000000)
    Mayeul> cor(x)
    Mayeul> #gives
    Mayeul> Error in cor(x) : missing observations in cov/cor
    Mayeul> In addition: Warning message:
    Mayeul> NAs introduced by coercion

"by coercion" means there were other things *coerced* to NAs!

One of the biggest problem with R users (and other S users for
that matter) is that if they get an error, they throw hands up
and ask for help - assuming the error message to be
non-intelligible.  Whereas it *is* intelligible (slightly ? ;-)
more often than not ...


    Mayeul> #I found the obvious workaround:
    Mayeul> COR <- matrix(rep(0, 81),9,9)
    Mayeul> for (i in 1:9) for (j in 1:9) {if (i>j) COR[i,j] <- cor (x[,i],x[,j])}
    Mayeul> #which works fine, with no warning

    Mayeul> #looks like a "cor()" bug.

quite improbably.

The following works flawlessly for me
and the only things that takes a bit of time is construction of
x, not cor():

  > n <- 300000
  > set.seed(1)
  > x <- as.data.frame(matrix(rnorm(n*9), n,9))
  > cx <- cor(x)
  > str(cx)
   num [1:9, 1:9]  1.00000 -0.00039  0.00113  0.00134 -0.00228 ...
   - attr(*, "dimnames")=List of 2
    ..$ : chr [1:9] "V1" "V2" "V3" "V4" ...
    ..$ : chr [1:9] "V1" "V2" "V3" "V4" ...


    Mayeul> #I checked absence of NA's by
    Mayeul> x <- x[complete.cases(x),]
    Mayeul> summary(x)
    Mayeul> apply(x,2, function (x) (sum(is.na(x))))

    Mayeul> #I use R 1.9.1

What does
    sapply(x, function(u)all(is.finite(u)))
return ?

From mayeul.kauffmann at tiscali.fr  Thu Sep 16 13:33:31 2004
From: mayeul.kauffmann at tiscali.fr (Mayeul KAUFFMANN)
Date: Thu Sep 16 13:33:48 2004
Subject: [Rd] cor() fails with big dataframe
References: <000501c49b7a$fafebb50$ce979a53@amd>
	<16713.28281.444833.509876@gargle.gargle.HOWL>
Message-ID: <002201c49be0$ff9745e0$09e29b53@amd>

Thanks all for your answers.

#The difference between the 2 following commands might be a puzzle even
for intermediate users. (I give explanation below)
> cor(x[,4],x[,5])
[1] -0.4352342
> cor(x[,4:5])
Error in cor(x[, 4:5]) : missing observations in cov/cor
In addition: Warning message:
NAs introduced by coercion

From: "Martin Maechler" <maechler@stat.math.ethz.ch>
To: "Mayeul KAUFFMANN" <mayeul.kauffmann@tiscali.fr>
>     Mayeul> #I found the obvious workaround:
>     Mayeul> COR <- matrix(rep(0, 81),9,9)
>     Mayeul> for (i in 1:9) for (j in 1:9) {if (i>j) COR[i,j] <- cor
(x[,i],x[,j])}
>     Mayeul> #which works fine, with no warning
>     Mayeul> #looks like a "cor()" bug.
Martin Maechler wrote:
> quite improbably.
if it is wrong, can you say what is wrong then propose an alternate
workaround? (or should I ask on r-help).


> What does
>     sapply(x, function(u)all(is.finite(u)))
> return ?

sapply(x2, function(u)all(is.finite(u)))
  jntdem smldepnp lrgdepnp contigkb logdstab  majdyds  alliesr  lncaprt
GATT
    TRUE     TRUE     TRUE     TRUE     TRUE     TRUE     TRUE     TRUE
TRUE

_______________________________________________

But I now got the explanation. It is not due to size.
#Tony Plate wrote:
#I would suspect that your dataframe has columns that result in NA's when
it
#is coerced to a matrix

That's not yet the explanation, but you are close to it.

All columns are numerics, except 3 that are logical (I thought they would
be coerced to 0 an 1, which they are with cor(x[,4],x[,5]) not with
cor(x[,4:5]) )
They do not changes to NA's or infinite values, they ALL change to TEXT

?as.matrix
 'as.matrix' is a generic function. The method for data frames will
     convert any non-numeric/complex column into a character vector
     using 'format' and so return a character matrix, except that
     all-logical data frames will be coerced to a logical matrix.

> as.matrix(x[1:3,1:9])
  jntdem smldepnp     lrgdepnp    contigkb logdstab   majdyds alliesr
1 "400"  "0.01420874" "0.2156945" "TRUE"   "5.820108" "TRUE"  "TRUE"
2 "400"  "0.01534535" "0.2496879" "TRUE"   "5.820108" "TRUE"  "TRUE"
3 "400"  "0.01585586" "0.2570493" "TRUE"   "5.820108" "TRUE"  "TRUE"
  lncaprt    GATT
1 "2.883204" "1"
2 "2.906521" "1"
3 "2.833357" "1"

?cor says it accepts data.frame. In fact, it does iff they have no (or
only: cor(x[,6:7]) works) logical columns.
doing cor with a logical (a dummy variable) and a numeric is maybe not as
sensible as doing it with 2 numerics.
But it may still usefull to explore data.

Maybe one may want either to change the documentation of ?cor , or not
rely on as.matrix to convert the data.frame if some columns  are logical.


Cheers,
Mayeul

From ripley at stats.ox.ac.uk  Thu Sep 16 13:57:41 2004
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu Sep 16 13:57:44 2004
Subject: [Rd] cor() fails with big dataframe
In-Reply-To: <002201c49be0$ff9745e0$09e29b53@amd>
Message-ID: <Pine.LNX.4.44.0409161254210.24539-100000@gannet.stats>

On Thu, 16 Sep 2004, Mayeul KAUFFMANN claimed:

> ?cor says it accepts data.frame. In fact, it does iff they have no (or

It actually says

       x: a numeric vector, matrix or data frame.
            ^^^^^^^

If you want to do the conversions as you say, you should be calling
data.matrix.


On Thu, 16 Sep 2004, Mayeul KAUFFMANN wrote:

> Thanks all for your answers.
> 
> #The difference between the 2 following commands might be a puzzle even
> for intermediate users. (I give explanation below)
> > cor(x[,4],x[,5])
> [1] -0.4352342
> > cor(x[,4:5])
> Error in cor(x[, 4:5]) : missing observations in cov/cor
> In addition: Warning message:
> NAs introduced by coercion
> 
> From: "Martin Maechler" <maechler@stat.math.ethz.ch>
> To: "Mayeul KAUFFMANN" <mayeul.kauffmann@tiscali.fr>
> >     Mayeul> #I found the obvious workaround:
> >     Mayeul> COR <- matrix(rep(0, 81),9,9)
> >     Mayeul> for (i in 1:9) for (j in 1:9) {if (i>j) COR[i,j] <- cor
> (x[,i],x[,j])}
> >     Mayeul> #which works fine, with no warning
> >     Mayeul> #looks like a "cor()" bug.
> Martin Maechler wrote:
> > quite improbably.
> if it is wrong, can you say what is wrong then propose an alternate
> workaround? (or should I ask on r-help).
> 
> 
> > What does
> >     sapply(x, function(u)all(is.finite(u)))
> > return ?
> 
> sapply(x2, function(u)all(is.finite(u)))
>   jntdem smldepnp lrgdepnp contigkb logdstab  majdyds  alliesr  lncaprt
> GATT
>     TRUE     TRUE     TRUE     TRUE     TRUE     TRUE     TRUE     TRUE
> TRUE
> 
> _______________________________________________
> 
> But I now got the explanation. It is not due to size.
> #Tony Plate wrote:
> #I would suspect that your dataframe has columns that result in NA's when
> it
> #is coerced to a matrix
> 
> That's not yet the explanation, but you are close to it.
> 
> All columns are numerics, except 3 that are logical (I thought they would
> be coerced to 0 an 1, which they are with cor(x[,4],x[,5]) not with
> cor(x[,4:5]) )
> They do not changes to NA's or infinite values, they ALL change to TEXT
> 
> ?as.matrix
>  'as.matrix' is a generic function. The method for data frames will
>      convert any non-numeric/complex column into a character vector
>      using 'format' and so return a character matrix, except that
>      all-logical data frames will be coerced to a logical matrix.
> 
> > as.matrix(x[1:3,1:9])
>   jntdem smldepnp     lrgdepnp    contigkb logdstab   majdyds alliesr
> 1 "400"  "0.01420874" "0.2156945" "TRUE"   "5.820108" "TRUE"  "TRUE"
> 2 "400"  "0.01534535" "0.2496879" "TRUE"   "5.820108" "TRUE"  "TRUE"
> 3 "400"  "0.01585586" "0.2570493" "TRUE"   "5.820108" "TRUE"  "TRUE"
>   lncaprt    GATT
> 1 "2.883204" "1"
> 2 "2.906521" "1"
> 3 "2.833357" "1"
> 
> ?cor says it accepts data.frame. In fact, it does iff they have no (or
> only: cor(x[,6:7]) works) logical columns.
> doing cor with a logical (a dummy variable) and a numeric is maybe not as
> sensible as doing it with 2 numerics.
> But it may still usefull to explore data.
> 
> Maybe one may want either to change the documentation of ?cor , or not
> rely on as.matrix to convert the data.frame if some columns  are logical.
> 
> 
> Cheers,
> Mayeul
> 
> ______________________________________________
> R-devel@stat.math.ethz.ch mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From wolski at molgen.mpg.de  Thu Sep 16 14:23:05 2004
From: wolski at molgen.mpg.de (Wolski)
Date: Thu Sep 16 14:23:09 2004
Subject: [Rd] checking for _non-existing_ documentation entries.
Message-ID: <200409161423050845.109C16BA@mail.math.fu-berlin.de>

Hi!

I have renamed some functions and deleted others. I have noticed that R CMD check complains only about newly added functions, but documented non-anymore-existing functions seem not to matter. 
I knew about prompt and promptMethods promptClass. They are extremely useful if you are starting to write a package. But what with existing packages that have to be rewritten?

Having code and documentation in one place would be a great help. Has anyone a tool which is able to generate from appropriately commented R-code files (e.g. <<example>>= -example section) Rd files:
e.g. a noweb lit-prog file or patched version of Doxygen?

Yours
Eryk.

From mayeul.kauffmann at tiscali.fr  Thu Sep 16 14:33:15 2004
From: mayeul.kauffmann at tiscali.fr (Mayeul KAUFFMANN)
Date: Thu Sep 16 14:33:47 2004
Subject: [Rd] cor() fails with big dataframe
References: <Pine.LNX.4.44.0409161254210.24539-100000@gannet.stats>
Message-ID: <000601c49be9$5a349fe0$09e29b53@amd>

On Thu, 16 Sep 2004, Mayeul KAUFFMANN claimed:
> ?cor says it accepts data.frame. In fact, it does iff they have no (or

It actually says
       x: a numeric vector, matrix or data frame.
            ^^^^^^^
If you want to do the conversions as you say, you should be calling
data.matrix.

@@@@@@@@@@@@@@@@@@@@@@@@

Thanks a lot !!!
When reading it first , I mistranslated it in my mind in a phrase that
would mean
"a numeric vector, a matrix or a data frame." (I'm not a native  English
speaker). Sorry for all that stuff....

*But* let's admit that the two followings are not treated identically:
cor(x[,4],x[,5])
cor(x[,4:5])
in the first case, the non-numeric vector is transformed to a numeric one
in the second case, the (partially) non-numeric dataframe is not
transformed to a numeric one

To be more exact,
the doc should not say
       x: a numeric vector, matrix or data frame.
            ^^^^^^^
but
       x: a vector that can be coerced to numeric,  a numeric matrix or a
numeric data frame.
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^     ^^^^^^^
^^^^^^^


Cheers,
Mayeul

PS:
by the way, if someones changes the doc,
the claim  'The default is equivalent to  'y = x' (but more efficient).'
is inexact as evidenced by the following:
X <- (data.frame(x=rep(1,5),y=1:5))
> cor(X,X)
   x  y
x NA NA
y NA  1
Warning message:
The standard deviation is zero in: cor(x, y, na.method, method ==
"kendall")
> cor(X)
   x  y
x  1 NA
y NA  1
Warning message:
The standard deviation is zero in: cor(x, y, na.method, method ==
"kendall")

From ripley at stats.ox.ac.uk  Thu Sep 16 14:39:26 2004
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu Sep 16 14:39:29 2004
Subject: [Rd] cor() fails with big dataframe
In-Reply-To: <000601c49be9$5a349fe0$09e29b53@amd>
Message-ID: <Pine.LNX.4.44.0409161335170.25162-100000@gannet.stats>

We do not in general say things like `can be coerced'.  It's taken for 
granted, and hard to be precise (your phrase is not precise, for there are 
non-numeric matrices that will be coerced, too).

We do expect what is stated as valid input to work, and do encourage users
to coerce objects themselves.

On Thu, 16 Sep 2004, Mayeul KAUFFMANN wrote:

> On Thu, 16 Sep 2004, Mayeul KAUFFMANN claimed:
> > ?cor says it accepts data.frame. In fact, it does iff they have no (or
> 
> It actually says
>        x: a numeric vector, matrix or data frame.
>             ^^^^^^^
> If you want to do the conversions as you say, you should be calling
> data.matrix.
> 
> @@@@@@@@@@@@@@@@@@@@@@@@
> 
> Thanks a lot !!!
> When reading it first , I mistranslated it in my mind in a phrase that
> would mean
> "a numeric vector, a matrix or a data frame." (I'm not a native  English
> speaker). Sorry for all that stuff....
> 
> *But* let's admit that the two followings are not treated identically:
> cor(x[,4],x[,5])
> cor(x[,4:5])

Where does it say that would be?

> in the first case, the non-numeric vector is transformed to a numeric one
> in the second case, the (partially) non-numeric dataframe is not
> transformed to a numeric one
> 
> To be more exact,
> the doc should not say
>        x: a numeric vector, matrix or data frame.
>             ^^^^^^^
> but
>        x: a vector that can be coerced to numeric,  a numeric matrix or a
> numeric data frame.
>                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^     ^^^^^^^
> ^^^^^^^
> 
> 
> Cheers,
> Mayeul
> 
> PS:
> by the way, if someones changes the doc,
> the claim  'The default is equivalent to  'y = x' (but more efficient).'
> is inexact as evidenced by the following:
> X <- (data.frame(x=rep(1,5),y=1:5))
> > cor(X,X)
>    x  y
> x NA NA
> y NA  1
> Warning message:
> The standard deviation is zero in: cor(x, y, na.method, method ==
> "kendall")
> > cor(X)
>    x  y
> x  1 NA
> y NA  1
> Warning message:
> The standard deviation is zero in: cor(x, y, na.method, method ==
> "kendall")
> 
> 

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From vangyzen at stat.duke.edu  Thu Sep 16 17:11:20 2004
From: vangyzen at stat.duke.edu (Eric van Gyzen)
Date: Thu Sep 16 17:11:25 2004
Subject: [Rd] R CMD INSTALL doesn't always clean up (PR#7230)
In-Reply-To: <Pine.LNX.4.44.0409161134580.23664-100000@gannet.stats>
References: <Pine.LNX.4.44.0409161134580.23664-100000@gannet.stats>
Message-ID: <4149AD18.5080600@stat.duke.edu>

Prof Brian Ripley wrote:
> 1) Please give us a reproducible example, as asked in the FAQ.

R CMD INSTALL --help
R CMD INSTALL --version
R CMD INSTALL
R CMD INSTALL nonexistent
R CMD INSTALL existent-but-invalid.tar.gz

...and every other case in which "exit" is called without a preceding 
do_cleanup().

> 2) We are in alpha test, near beta test, of R 2.0.0, so please check your 
> examples under the public alphas of R 2.0.0.

I tested the snapshot from today (2004-09-16).

> On Wed, 15 Sep 2004 vangyzen@stat.duke.edu wrote:
> 
> 
>>Full_Name: Eric van Gyzen
>>Version: 1.9.1
>>OS: FreeBSD
>>Submission from: (NULL) (152.3.22.120)
>>
>>
>>In several cases, "R CMD INSTALL" doesn't remove its temporary directory.  It
>>should call "do_cleanup" before every "exit".
> 
> 
> Perhaps those cases are deliberate?
> 

-- 
Eric van Gyzen                        Sr. Systems Programmer
http://www.stat.duke.edu/~vangyzen/   ISDS, Duke University

From rkoenker at uiuc.edu  Thu Sep 16 18:30:49 2004
From: rkoenker at uiuc.edu (roger koenker)
Date: Thu Sep 16 18:31:02 2004
Subject: [Rd] fortran data statement
Message-ID: <C4A3DBF2-07FD-11D9-9CCE-000A95A7E3AA@uiuc.edu>

For the record:

I had an inquiry about a problem with the function lm.fit.recursive
in my quantreg package on a 64bit gentoo linux system.  After
some debugging the problem was traced to the fact that on this
system g77 took the view that the statement:

	data one/1.0d0/

meant that the symbol one should take the value  zero.  Replacing such 
data
statements with their parameter statement equivalent, resolved
the problem.   This obnoxious behavior seems  not to be news to the gcc 
folks,
see http://gcc.gnu.org/ml/gcc-bugs/2002-08/msg00195.html
but they don't show any inclination  to fix it either.  I am in the
process of updating my packages and thought that others might
appreciate a warning  -- or,more likely,  enjoy the schadenfreude of 
enlightened
C-aphones.

url:	www.econ.uiuc.edu/~roger        	Roger Koenker
email	rkoenker@uiuc.edu			Department of Economics
vox: 	217-333-4558				University of Illinois
fax:   	217-244-6678				Champaign, IL 61820

From gregory_r_warnes at groton.pfizer.com  Thu Sep 16 22:11:13 2004
From: gregory_r_warnes at groton.pfizer.com (Warnes, Gregory R)
Date: Thu Sep 16 22:25:41 2004
Subject: [Rd] Proper way to export S3 method when base is not in a namespace
Message-ID: <D7A3CFD7825BD6119B880002A58F06C20C521C1C@groexmb02.pfizer.com>


What is the proper method of exporting an S3 method from a package with a
NAMESPACE when the base method is from a package which does not have a
namespace?

EG,  The Design library defines 'contrast', 'contrast.ols', ..  and I've
written 'contrast.lm' which I want to include in a private package.   If I
put

	S3method(contrast, lm)

in the NAMESPACE file, R CMD check fails with

Error in .tryQuietly({ : Error in library(package, lib.loc = lib.loc,
character.only = TRUE, verbose = FALSE) : 
	package/namespace load failed
Execution halted

For the moment, I've simply put contrast.lm in the exports, but I would like
to know what the proper procedure is.

Gregory R. Warnes
Manager, Non-Clinical Statistics
Pfizer Global Research and Development



LEGAL NOTICE\ Unless expressly stated otherwise, this messag...{{dropped}}

From bates at stat.wisc.edu  Fri Sep 17 00:03:42 2004
From: bates at stat.wisc.edu (Douglas Bates)
Date: Fri Sep 17 00:04:45 2004
Subject: [Rd] ODBC connector for SQLite
Message-ID: <414A0DBE.60108@stat.wisc.edu>

I have wanted to compare the RSQLite package and access to SQLite 
through the RODBC package.  However, the web site for the SQLite ODBC 
driver (http://www.ch-werner.de/sqliteodbc/) just gives me a blank page. 
  Has anyone been successful in downloading that driver in the last few 
days?

From Mark.Bravington at csiro.au  Fri Sep 17 01:07:51 2004
From: Mark.Bravington at csiro.au (Mark.Bravington@csiro.au)
Date: Fri Sep 17 01:08:01 2004
Subject: [Rd] checking for _non-existing_ documentation entries.
Message-ID: <C4178DC99E08604EA5E2BDB989F093800240A355@extas2-hba.tas.csiro.au>

Wolski wrote:
 
#I knew about prompt and promptMethods promptClass. They are 
#extremely useful if you are starting to write a package. But 
#what with existing packages that have to be rewritten?
#
#Having code and documentation in one place would be a great 
#help. Has anyone a tool which is able to generate from 
#appropriately commented R-code files (e.g. <<example>>= 
#-example section) Rd files:
#e.g. a noweb lit-prog file or patched version of Doxygen?
#

Yes, there is such a tool-- or something close to it, anyway. My 'mvbutils' package lets you keep documentation in the same source "file" as the the function definition, appended at the end. Usually, when I am developing a function I start by writing informal documentation (which still displays with "?" but isn't an Rd file). Eventually I convert the documentation into a plain-text format close to the pager representation of R help files; this format can be converted into a .Rd file using my 'doc2Rd' function. Once I am close to having a whole package ready, I use the 'formalize.package' function to set up the a whole package; it creates the skeleton and the .R source file, and all the .Rd files via 'doc2Rd', ready for RCMD.

For more details, have a look at README.mvbutils()

Hope this helps

Mark

*******************************

Mark Bravington
CSIRO (CMIS)
PO Box 1538
Castray Esplanade
Hobart
TAS 7001

phone (61) 3 6232 5118
fax (61) 3 6232 5012
Mark.Bravington@csiro.au

From kjetil at acelerate.com  Fri Sep 17 05:35:19 2004
From: kjetil at acelerate.com (Kjetil Brinchmann Halvorsen)
Date: Fri Sep 17 05:36:49 2004
Subject: [Rd] Problems with Rcmd check in rw2000dev
Message-ID: <414A5B77.50902@acelerate.com>

Hola!

I am doing some minimal changes on the package SenSrivastava to make it 
fit for
R2.0.0  (This package passed Rcmd check on earlier versions of R,
and are passing the CRAN daily checks!) I am using
rw2000dev from CRAN. Now i get (running in an Xemacs shell):

installing R.css in C:/R/rw2000dev/src/gnuwin32/SenSrivastava.Rcheck


---------- Making package SenSrivastava ------------
  adding build stamp to DESCRIPTION
  no R files in this package
  installing data files
  installing man source files
  installing indices
Error: restore file may be from a newer version of R -- no data loaded
Execution halted
make[2]: *** [indices] Error 1
make[1]: *** [all] Error 2
make: *** [pkg-SenSrivastava] Error 2
*** Installation of SenSrivastava failed ***

Removing 'C:/R/rw2000dev/src/gnuwin32/SenSrivastava.Rcheck/SenSrivastava'

Just checked: Running Rcmd check under rw1091 gives exactly the same error.

What does it mean: Error: restore file may be from a newer version of R 
-- no data loaded
especially running under rw2000dev this doesn't seem to make sense!


-- 

Kjetil Halvorsen.

Peace is the most effective weapon of mass construction.
               --  Mahdi Elmandjra

From ripley at stats.ox.ac.uk  Fri Sep 17 06:23:26 2004
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri Sep 17 06:23:37 2004
Subject: [Rd] Problems with Rcmd check in rw2000dev
In-Reply-To: <414A5B77.50902@acelerate.com>
Message-ID: <Pine.LNX.4.44.0409170513380.29638-100000@gannet.stats>

Your subject is I think misleading as you say

> Just checked: Running Rcmd check under rw1091 gives exactly the same error.

So it appears to be a problem with your package.  The version of 
SenSrivastava on CRAN does work for me on current rw2000dev.

On Thu, 16 Sep 2004, Kjetil Brinchmann Halvorsen wrote:

> Hola!
> 
> I am doing some minimal changes on the package SenSrivastava to make it 
> fit for
> R2.0.0  (This package passed Rcmd check on earlier versions of R,
> and are passing the CRAN daily checks!) I am using
> rw2000dev from CRAN. Now i get (running in an Xemacs shell):
> 
> installing R.css in C:/R/rw2000dev/src/gnuwin32/SenSrivastava.Rcheck
> 
> 
> ---------- Making package SenSrivastava ------------
>   adding build stamp to DESCRIPTION
>   no R files in this package
>   installing data files
>   installing man source files
>   installing indices
> Error: restore file may be from a newer version of R -- no data loaded
> Execution halted
> make[2]: *** [indices] Error 1
> make[1]: *** [all] Error 2
> make: *** [pkg-SenSrivastava] Error 2
> *** Installation of SenSrivastava failed ***
> 
> Removing 'C:/R/rw2000dev/src/gnuwin32/SenSrivastava.Rcheck/SenSrivastava'
> 
> Just checked: Running Rcmd check under rw1091 gives exactly the same error.
> 
> What does it mean: Error: restore file may be from a newer version of R 
> -- no data loaded
> especially running under rw2000dev this doesn't seem to make sense!

It means a file which you are asking it to load() cannot be loaded.  Since 
this is in the indices, it means one of your data/*.Rdata files, I 
believe.  What it is actually telling you is that it started reading the 
file and got RD followed by something it did not understand, a format 
reserved for future formats.

My guess is that a binary .RData file has been transferred in text mode.
It's a pity the error message does not tell us the file name.

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From wolski at molgen.mpg.de  Fri Sep 17 10:45:10 2004
From: wolski at molgen.mpg.de (Wolski)
Date: Fri Sep 17 10:47:13 2004
Subject: [Rd] checking for _non-existing_  -> documentation and
	sources at one place.
In-Reply-To: <C4178DC99E08604EA5E2BDB989F093800240A355@extas2-hba.tas.csiro.au>
References: <C4178DC99E08604EA5E2BDB989F093800240A355@extas2-hba.tas.csiro.au>
Message-ID: <200409171045100060.00623FF2@mail.math.fu-berlin.de>

Hi!

Is it working with S4? If I understand it right you have to keep each function in an separate file?

What I am looking for is something what would resembles more something like this:


setClass("test",                                   #The test data storage class.                               <-from this the title section is generated automatically. 
	representation(
	size="numeric"                     # list size                                     <-section slots is generated automatically.
	bla="list"                              # stores content                            <-goes to section slots
	##description : Stores test results....                                                               <- goes to the description section.
	##example: x <- new("test",size=1000,bla=vector("list",1000))                            <-goes to the example section of the Rd file.
	))

setMethod("unlist" # unlists a list.
	,signature(x="test"  #+                  <-the #+ sign indicates that the docu of this function should be integrated in the docu file of the class "test" above. If non in a speparate file.
	
	)
	def=function(x,...)
	{
		.....	
	}
	#example: unlist(x)                       <- because as indicated by the "+" above it is appendended to the example section of the test-Class.Rd file.
	)

setMethod("unlist" # unlists a list.
	,signature(x="test"                 # an object of class test        <- no plus means it goes to a own unlist-methods.Rd file and the comment goes to the argument section.
               )                     
	def=function(x,...)
	{
	##Description : function does this and that.
	## further description...
		....
	}

	##example : data(x)
	## unlist(x)                      
	)


And then to have a tool eg something working like R CMD makeRd (perl script)... which genreates Rd files out of it..
Has nobody a perl-script that parseres the R files to generate Rd files? Would someone be interested in something similar. If so let me know please.


/E



*********** REPLY SEPARATOR  ***********

On 9/17/2004 at 9:07 AM Mark.Bravington@csiro.au wrote:

>>>Wolski wrote:
>>> 
>>>#I knew about prompt and promptMethods promptClass. They are 
>>>#extremely useful if you are starting to write a package. But 
>>>#what with existing packages that have to be rewritten?
>>>#
>>>#Having code and documentation in one place would be a great 
>>>#help. Has anyone a tool which is able to generate from 
>>>#appropriately commented R-code files (e.g. <<example>>= 
>>>#-example section) Rd files:
>>>#e.g. a noweb lit-prog file or patched version of Doxygen?
>>>#
>>>
>>>Yes, there is such a tool-- or something close to it, anyway. My
>>>'mvbutils' package lets you keep documentation in the same source "file"
>>>as the the function definition, appended at the end. Usually, when I am
>>>developing a function I start by writing informal documentation (which
>>>still displays with "?" but isn't an Rd file). Eventually I convert the
>>>documentation into a plain-text format close to the pager representation
>>>of R help files; this format can be converted into a .Rd file using my
>>>'doc2Rd' function. Once I am close to having a whole package ready, I
>>>use the 'formalize.package' function to set up the a whole package; it
>>>creates the skeleton and the .R source file, and all the .Rd files via
>>>'doc2Rd', ready for RCMD.
>>>
>>>For more details, have a look at README.mvbutils()
>>>
>>>Hope this helps
>>>
>>>Mark
>>>
>>>*******************************
>>>
>>>Mark Bravington
>>>CSIRO (CMIS)
>>>PO Box 1538
>>>Castray Esplanade
>>>Hobart
>>>TAS 7001
>>>
>>>phone (61) 3 6232 5118
>>>fax (61) 3 6232 5012
>>>Mark.Bravington@csiro.au



Dipl. bio-chem. Witold Eryk Wolski             @         MPI-Moleculare Genetic   
Ihnestrasse 63-73 14195 Berlin                'v'    
tel: 0049-30-83875219                        /   \       
mail: witek96@users.sourceforge.net        ---W-W----    http://www.molgen.mpg.de/~wolski 
      wolski@molgen.mpg.de

From wolski at molgen.mpg.de  Fri Sep 17 11:13:56 2004
From: wolski at molgen.mpg.de (Wolski)
Date: Fri Sep 17 11:14:01 2004
Subject: [Rd] R CMD check does not checks for superfluous documentation
 entries.
Message-ID: <200409171113560495.151546A3@mail.math.fu-berlin.de>

Hi!

Due to package maintenance I have removed some functions but forgot to update the coresponding Rd files. 
If R CMD check is checking for missing documentation entries why it does not check for documentation entries which tell the user about nonexisting funcitons?

In my opinion checking for documentation entries that document non-existing functions is much more important than the other way around.
To type by accident the name of an undocumented functions is not really a danger especially if it is not exported.
But to tell the user that there is a function if there are non ...

By looking on the tools::undoc function and at the check(.pl) file it seems to me that all info is available to output also 

all_doc_topics %w/o% code_objs 


Yours Eryk.

From wolski at molgen.mpg.de  Fri Sep 17 11:14:15 2004
From: wolski at molgen.mpg.de (wolski@molgen.mpg.de)
Date: Fri Sep 17 11:14:17 2004
Subject: [Rd] R CMD check does not checks for superfluous documentation
	(PR#7231)
Message-ID: <20040917091415.3425C112E6@slim.kubism.ku.dk>

Hi!

Due to package maintenance I have removed some functions but forgot to update the coresponding Rd files. 
If R CMD check is checking for missing documentation entries why it does not check for documentation entries which tell the user about nonexisting funcitons?

In my opinion checking for documentation entries that document non-existing functions is much more important than the other way around.
To type by accident the name of an undocumented functions is not really a danger especially if it is not exported.
But to tell the user that there is a function if there are non ...

By looking on the tools::undoc function and at the check(.pl) file it seems to me that all info is available to output also 

all_doc_topics %w/o% code_objs 


Yours Eryk.

From Kurt.Hornik at wu-wien.ac.at  Fri Sep 17 11:38:53 2004
From: Kurt.Hornik at wu-wien.ac.at (Kurt Hornik)
Date: Fri Sep 17 11:38:08 2004
Subject: [Rd] R CMD check does not checks for superfluous documentation
	(PR#7231)
In-Reply-To: <20040917091415.3425C112E6@slim.kubism.ku.dk>
References: <20040917091415.3425C112E6@slim.kubism.ku.dk>
Message-ID: <16714.45229.796882.564857@mithrandir.hornik.net>

>>>>> wolski  writes:

> Hi!

> Due to package maintenance I have removed some functions but forgot to
> update the coresponding Rd files.  If R CMD check is checking for
> missing documentation entries why it does not check for documentation
> entries which tell the user about nonexisting funcitons?

It can do all these things, but we can have topics which do not have
corresponding functions, nor even R objects.

You can use

library(tools)

classifyRdTopics <-
function(package = "base", lib.loc = NULL)
{
    ## Classify Rd topics in an installed package according to whether
    ## they correspond to an object in the code or not.

    ## Useful output via
    ##   summary(classifyRdTopics())
    
    dir <- .find.package(package, lib.loc)
    isBase <- basename(dir) == "base"
    if(!isBase) tools:::.loadPackageQuietly(package, lib.loc)
    codeEnv <-
        as.environment(paste("package", package, sep = ":"))
    contents <- .readRDS(file.path(dir, "Meta", "Rd.rds"))
    keywords <- contents[ , "Keywords"]
    ## Disregard data sets docs.
    idx <- keywords != "datasets"
    ## Also, just to make sure, disregard everything marked as internal.
    idx <- idx & is.na(sapply(keywords,
                              function(x) match("internal", x)))
    ## Should really also ignore defunct and maybe also deprecated stuff
    ## when computing on base.
    contents <- contents[idx, , drop = FALSE]
    aliases <- unlist(contents$Aliases)
    topicIsAnObject <-
        aliases %in% objects(envir = codeEnv, all.names = TRUE)
    x <- list(aliases = aliases,
              topicIsAnObject = topicIsAnObject)
    class(x) <- "classifyRdTopics"
    x
}

summary.classifyRdTopics <- function(x) {
    x <- list(table(x$topicIsAnObject),
              x$aliases[!x$topicIsAnObject])
    class(x) <- "summary.classifyRdTopics"
    x
}
print.summary.classifyRdTopics <- function(x, ...) {
    writeLines("Numbers of topics which are objects (or not):")
    print(c(x[[1]]), ...)
    writeLines(c("", "Topics which are not objects:"))
    print(x[[2]], ...)
    invisible(x)
}

and then e.g. get

R> summary(classifyRdTopics("base"))
Numbers of topics which are objects (or not):
FALSE  TRUE 
   90   980 

Topics which are not objects:
 [1] "Arithmetic"         "AsIs"               "bessel"            
 [4] "Bessel"             "Comparison"         "Control"           
 [7] "else"               "DateTimeClasses"    "POSIXct"           
[10] "POSIXlt"            "POSIXt"             "Math.POSIXlt"      
[13] "Date"               "Dates"              "Defunct"           
[16] "Deprecated"         "Extract"            "Subscript"         
[19] "Foreign"            "Logic"              "Memory-limits"     
[22] "Memory"             "NA"                 "NULL"              
[25] "Paren"              "Random.user"        ".Random.seed"      
[28] "RNG"                "Rdconv"             "Rd2txt"            
[31] "Rd2dvi"             "Sd2Rd"              "Special"           
[34] "Startup"            "Rprofile"           ".Rprofile"         
[37] "Rprofile.site"      "Renviron.site"      ".Renviron"         
[40] ".First"             "Syntax"             "Trig"              
[43] "S3Methods"          "fuzzy matching"     "->"                
[46] "->>"                ".Autoloaded"        "base-deprecated"   
[49] "connections"        "connection"         "copyright"         
[52] "copyrights"         "files"              ".Method"           
[55] ".Generic"           ".Group"             ".Class"            
[58] "Math"               "Ops"                "Summary"           
[61] "Arith"              "Compare"            "Complex"           
[64] "Math2"              "group generic"      "Inf"               
[67] "NaN"                "R_LIBS"             ".First.lib"        
[70] ".Last.lib"          "localeconv"         "locales"           
[73] "TRUE"               "FALSE"              "matmult"           
[76] "name"               "NotYetImplemented"  "NotYetUsed"        
[79] ".onLoad"            ".onUnload"          ".onAttach"         
[82] "print.htest"        ".Last"              "regex"             
[85] "regexp"             "regular expression" "tilde"             
[88] ".Traceback"         "InternalMethods"    "Signals"           

to assess the magnitude of the issue at hand: about 10% of the base
topics do *not* corresponding to R objects.

Admittedly, some of these are perhaps not quite right, or better made
into \concept entries, but e.g. for a documentation object explaining R
CMD stuff, there will most likely never be an R object to use as topic.

More long term, I am planning to include ways to report "possible"
problems such as the above, perhaps alongside with us integrating Luke's
code analysis tools which face a similar issue.  But I don't think we
can peruse R CMD check to generate warnings about possible problems by
default.

[It detects enough real problems these days which package maintainers
are not always quick to fix ...]

-k


> In my opinion checking for documentation entries that document
> non-existing functions is much more important than the other way
> around.  To type by accident the name of an undocumented functions is
> not really a danger especially if it is not exported.  But to tell the
> user that there is a function if there are non ...

> By looking on the tools::undoc function and at the check(.pl) file it
> seems to me that all info is available to output also

> all_doc_topics %w/o% code_objs




> Yours Eryk.

> ______________________________________________
> R-devel@stat.math.ethz.ch mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

From ej at duvel.ir.iit.edu  Fri Sep 17 18:31:09 2004
From: ej at duvel.ir.iit.edu (ej@duvel.ir.iit.edu)
Date: Fri Sep 17 18:31:14 2004
Subject: [Rd] RSPerl Causes Segfaults with Perl 5.8.0 (PR#7233)
Message-ID: <20040917163109.D6811115CC@slim.kubism.ku.dk>

Full_Name: Eric Jensen
Version: 1.9.1
OS: Redhat 9 Linux
Submission from: (NULL) (152.163.190.1)


RSPerl causes random segfaults (it occassionally works) in Rf_isValidName ()
from /usr/lib/R/bin/libR.so when I call wilcox.test on some perl array
references.  This is with R built from the r-project source RPM modified to have
the --enable-shared-R option and RSPerl built with the default options, except
for having to set PERL_MODULES to not include modperl or Apache.

From jfox at mcmaster.ca  Fri Sep 17 19:10:39 2004
From: jfox at mcmaster.ca (John Fox)
Date: Fri Sep 17 19:10:42 2004
Subject: [Rd] Function some()
Message-ID: <20040917171038.YRUK7925.tomts25-srv.bellnexxia.net@JohnDesktop8300>

Dear R-devel list members,

Probably not an opportune time for this, given the immanent release of
2.0.0, but I was just reminded (while preparing a lecture) of a function
that I find useful and that I though might be a candidate for the utils
package: The function, which I call some(), behaves like head() and tail(),
from which it is adapted, except that it samples from an object (e.g., rows
of a data frame). 

I like to use some() to get a quick look at data. Perhaps there's some other
already existing function that I'm not aware of that does the same thing.

Regards,
 John

-------------- snip ---------------------

# adapted from head() and tail()

some <- function(x, ...) UseMethod("some")

some.default <- function(x, n=10, ...){
    len <- length(x)
    ans <- x[sort(sample(len, min(n, len)))]
    if (length(dim(x)) == 1)
        array(ans, n, list(names(ans)))
    else ans
    }

some.matrix <- function(x, n=10, ...){
  nr <- nrow(x)
  x[sort(sample(nr, min(n, nr))), , drop = FALSE]
  }

some.data.frame <- function(x, n=10, ...){
    nr <- nrow(x)
    x[sort(sample(nr, min(n, nr))), , drop=FALSE]
    }

From ggrothendieck at myway.com  Fri Sep 17 19:51:56 2004
From: ggrothendieck at myway.com (Gabor Grothendieck)
Date: Fri Sep 17 19:52:07 2004
Subject: [Rd] Function some()
References: <20040917171038.YRUK7925.tomts25-srv.bellnexxia.net@JohnDesktop8300>
Message-ID: <loom.20040917T192748-719@post.gmane.org>

John Fox <jfox <at> mcmaster.ca> writes:

: 
: Dear R-devel list members,
: 
: Probably not an opportune time for this, given the immanent release of
: 2.0.0, but I was just reminded (while preparing a lecture) of a function
: that I find useful and that I though might be a candidate for the utils
: package: The function, which I call some(), behaves like head() and tail(),
: from which it is adapted, except that it samples from an object (e.g., rows
: of a data frame). 
: 
: I like to use some() to get a quick look at data. Perhaps there's some other
: already existing function that I'm not aware of that does the same thing.


Its cute but you could do it on vectors and data frames with 
2 function calls.  First get some test data:

   data(iris) 
   data(state)

# Now we have:

   head(sample(iris))                  # data frame
   head(sample(data.frame(state.x77))) # matrix 
   head(sample(letters))               # vector

The only nuisance is that sample samples from the elements
of matrices rather than from their rows thereby necessitating 
the conversion in the middle call to head(sample(...)).  

Perhaps an alternate suggestion would be to modify sample 
so it becomes an S3 generic with methods for matrices and 
data frames such that sample.matrix samples from the rows 
of a matrix and sample.data.frame samples from the rows 
of a data.frame.  Then (1) the above idiom becomes consistent
across the above mentioned classes.  (2) This would also avoid
burdening the base with an extra function and would (3) provide 
for the possibility of extending sample to other classes.

From jfox at mcmaster.ca  Fri Sep 17 20:13:36 2004
From: jfox at mcmaster.ca (John Fox)
Date: Fri Sep 17 20:13:39 2004
Subject: [Rd] Function some()
In-Reply-To: <loom.20040917T192748-719@post.gmane.org>
Message-ID: <20040917181335.BFBQ4758.tomts13-srv.bellnexxia.net@JohnDesktop8300>

 

> -----Original Message-----
> From: r-devel-bounces@stat.math.ethz.ch 
> [mailto:r-devel-bounces@stat.math.ethz.ch] On Behalf Of Gabor 
> Grothendieck
> Sent: Friday, September 17, 2004 12:52 PM
> To: r-devel@stat.math.ethz.ch
> Subject: Re: [Rd] Function some()
> 
> John Fox <jfox <at> mcmaster.ca> writes:
. . .
> 
> 
> Its cute but you could do it on vectors and data frames with
> 2 function calls.  First get some test data:
> 
>    data(iris) 
>    data(state)
> 
> # Now we have:
> 
>    head(sample(iris))                  # data frame
>    head(sample(data.frame(state.x77))) # matrix 
>    head(sample(letters))               # vector
> 

A possible disadvantage of this approach is that it permutes the entire,
potentially large, object before picking the presumably small sample.

> The only nuisance is that sample samples from the elements of 
> matrices rather than from their rows thereby necessitating 
> the conversion in the middle call to head(sample(...)).  
> 
> Perhaps an alternate suggestion would be to modify sample so 
> it becomes an S3 generic with methods for matrices and data 
> frames such that sample.matrix samples from the rows of a 
> matrix and sample.data.frame samples from the rows of a 
> data.frame.  Then (1) the above idiom becomes consistent 
> across the above mentioned classes.  (2) This would also 
> avoid burdening the base with an extra function and would (3) 
> provide for the possibility of extending sample to other classes.
> 

This occurred to me, too [as did providing a random argument to head()], but
seemed a more radical proposal than introducing a simple new generic. 

Regards,
 John

> ______________________________________________
> R-devel@stat.math.ethz.ch mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

From gregory_r_warnes at groton.pfizer.com  Fri Sep 17 20:18:29 2004
From: gregory_r_warnes at groton.pfizer.com (Warnes, Gregory R)
Date: Fri Sep 17 20:19:02 2004
Subject: [Rd] R-2.0.0 Install problem for package bundle with
	inter-dependent n amespaces
Message-ID: <D7A3CFD7825BD6119B880002A58F06C20C521C2E@groexmb02.pfizer.com>



I have a revised version of the gregmisc package, which I've converted into
a package bundle each of which has a namespace:  gplots,  gmodels, gdata,
gtoools.  Of course, there are interdependencies among these namespaces:

	gsun374: /tmp [11]> cd gregmisc/
	gsun374: gregmisc [12]> grep import */NAMESPACE
	gdata/NAMESPACE:importFrom(gtools, odd, invalid, mixedsort)
	gmodels/NAMESPACE:importFrom(MASS, ginv)
	gplots/NAMESPACE:importFrom(gtools, invalid)
	gplots/NAMESPACE:importFrom(gtools, odd)
	gplots/NAMESPACE:importFrom(gdata, nobs)

Under R-1.9.1, this package bundle passes R CMD check and installs happily.
However, under yesterday's R-2.0.0-alpha, the package fails to install (&
hence pass CMD CHECK) with the error 

	** preparing package for lazy loading
	Error in loadNamespace(i[[1]], c(lib.loc, .libPaths()), keep.source)
: 
	        There is no package called 'gdata'
	Execution halted
	ERROR: lazy loading failed for package 'gplots'

because the gdata package is the last in the bundle to be installed, so it
is not yet present.

So, what is the proper way to handle this?  Is there some way to manually
specify the package install order?

Gregory R. Warnes
Manager, Non-Clinical Statistics
Pfizer Global Research and Development



LEGAL NOTICE\ Unless expressly stated otherwise, this messag...{{dropped}}

From p.dalgaard at biostat.ku.dk  Fri Sep 17 20:37:50 2004
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Fri Sep 17 20:39:03 2004
Subject: [Rd] Function some()
In-Reply-To: <loom.20040917T192748-719@post.gmane.org>
References: <20040917171038.YRUK7925.tomts25-srv.bellnexxia.net@JohnDesktop8300>
	<loom.20040917T192748-719@post.gmane.org>
Message-ID: <x2d60k4u81.fsf@biostat.ku.dk>

Gabor Grothendieck <ggrothendieck@myway.com> writes:

>    data(iris) 
>    data(state)
> 
> # Now we have:
> 
>    head(sample(iris))                  # data frame
>    head(sample(data.frame(state.x77))) # matrix 
>    head(sample(letters))               # vector

Nope. Think again:

> names(sample(iris))
[1] "Species"      "Sepal.Width"  "Sepal.Length" "Petal.Length"
"Petal.Width"
> names(sample(iris))
[1] "Sepal.Length" "Species"      "Petal.Width"  "Petal.Length"
"Sepal.Width"

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

From ggrothendieck at myway.com  Fri Sep 17 21:04:56 2004
From: ggrothendieck at myway.com (Gabor Grothendieck)
Date: Fri Sep 17 21:05:03 2004
Subject: [Rd] Function some()
References: <loom.20040917T192748-719@post.gmane.org>
	<20040917181335.BFBQ4758.tomts13-srv.bellnexxia.net@JohnDesktop8300>
Message-ID: <loom.20040917T203958-486@post.gmane.org>

John Fox <jfox <at> mcmaster.ca> writes:

: 
: > -----Original Message-----
: > From: r-devel-bounces <at> stat.math.ethz.ch 
: > [mailto:r-devel-bounces <at> stat.math.ethz.ch] On Behalf Of Gabor 
: > Grothendieck
: > Sent: Friday, September 17, 2004 12:52 PM
: > To: r-devel <at> stat.math.ethz.ch
: > Subject: Re: [Rd] Function some()
: > 
: > John Fox <jfox <at> mcmaster.ca> writes:
: . . .
: > 
: > 
: > Its cute but you could do it on vectors and data frames with
: > 2 function calls.  First get some test data:
: > 
: >    data(iris) 
: >    data(state)
: > 
: > # Now we have:
: > 
: >    head(sample(iris))                  # data frame
: >    head(sample(data.frame(state.x77))) # matrix 
: >    head(sample(letters))               # vector
: > 
: 
: A possible disadvantage of this approach is that it permutes the entire,
: potentially large, object before picking the presumably small sample.
: 
: > The only nuisance is that sample samples from the elements of 
: > matrices rather than from their rows thereby necessitating 
: > the conversion in the middle call to head(sample(...)).  
: > 
: > Perhaps an alternate suggestion would be to modify sample so 
: > it becomes an S3 generic with methods for matrices and data 
: > frames such that sample.matrix samples from the rows of a 
: > matrix and sample.data.frame samples from the rows of a 
: > data.frame.  Then (1) the above idiom becomes consistent 
: > across the above mentioned classes.  (2) This would also 
: > avoid burdening the base with an extra function and would (3) 
: > provide for the possibility of extending sample to other classes.
: > 
: 
: This occurred to me, too [as did providing a random argument to head()], but
: seemed a more radical proposal than introducing a simple new generic. 

I think I was wrong regarding my examples.  sample(iris) samples from
the columns of iris, not the rows, thus my examples do not work except
for the vector case.  One would have to do this:

   iris[sample(150,10),]

some() is nice since it reduces the mental load of iris[sample(150,10),] 
yet I wonder if its worth the feature creep and if we are to make change 
whether it would not be better to fix sample, as suggested, in which case

   head(sample(iris))

does work as would:

   sample(iris, 10)

If backward compatibility were an issue we could define a new name
for the new generic so that sample remains unchanged.  Optionally,
sample could be made defunct, over time.

From murdoch at stats.uwo.ca  Sat Sep 18 01:44:17 2004
From: murdoch at stats.uwo.ca (murdoch@stats.uwo.ca)
Date: Sat Sep 18 01:44:24 2004
Subject: [Rd] file.access() is unreliable in Windows (PR#7234)
Message-ID: <20040917234417.D9E4D1160B@slim.kubism.ku.dk>

The file.access() function in base relies on the access() function in
the C library.  In Windows, that function only checks the directory's
permission bits for a file.   In versions of Windows post NT4, it's
possible to have access controls that change a user's access without
showing up in the directory record, and file.access() returns wrong
answers (e.g. if a user has read-only access to a network share, but a
particular file is not marked read-only).

I've changed the man page for file.access to record the fact that it's
results can't really be trusted on any multi-tasking system, and
especially on Windows, but I think a better fix should be made.  I
won't have time to do it until after 2.0.0.

Duncan Murdoch

From kjetil at acelerate.com  Sat Sep 18 02:55:48 2004
From: kjetil at acelerate.com (Kjetil Brinchmann Halvorsen)
Date: Sat Sep 18 02:59:05 2004
Subject: [Rd] Rcmd problems and questions, lazyloading
Message-ID: <414B8794.4070006@acelerate.com>

Hola!

I got past the problems I asked about two days ago, thanks. No I am 
updating
CRAN package asypow (the daily package check on CRAN gave warnings due to
.Rd problems, fixed).

Now it PASSED Rcmd check
(WindowsXP home edition, rw2000dev, on a new toshiba laptop, if that 
matters.)

but then Rcmd build --binary
gives problems:
.
.
.
  preparing package asypow for lazy loading
Error in tools:::.read_description(file) :
    file '/DESCRIPTION' does not exist
Execution halted
make: *** [lazyload] Error 1
*** Installation of asypow failed ***

Removing 'C:/DOCUME~1/HALVOR~1/LOCALS~1/Temp/Rbuild.852/asypow'
 ERROR
* installation failed
.
.
.
but as it passed make check, DESCRIPTION obviuosly is there, so this 
must be symptoms of something else.

Then, adding the line
LazyLoad:             FALSE

to DESCRIPTION,
Rcmd build --binary
runs without problems!

What is happening?

Kjetil

-- 

Kjetil Halvorsen.

Peace is the most effective weapon of mass construction.
               --  Mahdi Elmandjra

From daniel.jeske at ucr.edu  Sat Sep 18 04:10:40 2004
From: daniel.jeske at ucr.edu (daniel.jeske@ucr.edu)
Date: Sat Sep 18 04:10:42 2004
Subject: [Rd] Covergence FLAG in glm (PR#7235)
Message-ID: <20040918021040.A130B1160D@slim.kubism.ku.dk>

Full_Name: Daniel R Jeske
Version: 1.8.1
OS: Windows 2000
Submission from: (NULL) (138.23.228.79)


We have just noticed that when you use glm() it seems the logical
output 'converged' is always TRUE.  The same data set that shows
FALSE in version 1.7.1 shows TRUE in 1.8.1.  And I know that FALSE
is the correct answer...so it seems like we cannot trust the 'converged'
flag for glm() in version 1.8.1 ?????

From ligges at statistik.uni-dortmund.de  Sat Sep 18 16:46:10 2004
From: ligges at statistik.uni-dortmund.de (Uwe Ligges)
Date: Sat Sep 18 16:46:41 2004
Subject: [Rd] Rcmd problems and questions, lazyloading
In-Reply-To: <414B8794.4070006@acelerate.com>
References: <414B8794.4070006@acelerate.com>
Message-ID: <414C4A32.9060606@statistik.uni-dortmund.de>

Kjetil Brinchmann Halvorsen wrote:

> Hola!
> 
> I got past the problems I asked about two days ago, thanks. No I am 
> updating
> CRAN package asypow (the daily package check on CRAN gave warnings due to
> .Rd problems, fixed).
> 
> Now it PASSED Rcmd check
> (WindowsXP home edition, rw2000dev, on a new toshiba laptop, if that 
> matters.)
> 
> but then Rcmd build --binary

Kjetil,
works for me with the asypow 1.0, R-2.0.0 alpha (2004-09-16).

Which version of R (I mean the date, a lot of stuff changed during the 
last 2 weeks re. lazy loading and related bug fixes on Windows)?

If it still does not work with a recent alpha version, please send me 
the source package.


What happens if you try
    R CMD INSTALL --build

This way some references get resolves more correctly, and this way is 
probably better tested by the developers and the CRAN Windows package 
maintainer.

Uwe


> gives problems:
> .
> .
> .
>  preparing package asypow for lazy loading
> Error in tools:::.read_description(file) :
>    file '/DESCRIPTION' does not exist
> Execution halted
> make: *** [lazyload] Error 1
> *** Installation of asypow failed ***
> 
> Removing 'C:/DOCUME~1/HALVOR~1/LOCALS~1/Temp/Rbuild.852/asypow'
> ERROR
> * installation failed
> .
> .
> .
> but as it passed make check, DESCRIPTION obviuosly is there, so this 
> must be symptoms of something else.
> 
> Then, adding the line
> LazyLoad:             FALSE
> 
> to DESCRIPTION,
> Rcmd build --binary
> runs without problems!
> 
> What is happening?
> 
> Kjetil
>

From ligges at statistik.uni-dortmund.de  Sat Sep 18 16:53:38 2004
From: ligges at statistik.uni-dortmund.de (Uwe Ligges)
Date: Sat Sep 18 16:54:08 2004
Subject: [Rd] Covergence FLAG in glm (PR#7235)
In-Reply-To: <20040918021040.A130B1160D@slim.kubism.ku.dk>
References: <20040918021040.A130B1160D@slim.kubism.ku.dk>
Message-ID: <414C4BF2.5090604@statistik.uni-dortmund.de>

daniel.jeske@ucr.edu wrote:

> Full_Name: Daniel R Jeske
> Version: 1.8.1
> OS: Windows 2000
> Submission from: (NULL) (138.23.228.79)
> 
> 
> We have just noticed that when you use glm() it seems the logical
> output 'converged' is always TRUE.  The same data set that shows
> FALSE in version 1.7.1 shows TRUE in 1.8.1.  And I know that FALSE
> is the correct answer...so it seems like we cannot trust the 'converged'
> flag for glm() in version 1.8.1 ?????

Please try again with a recent alpha version of R-2.0.0 (R-1.8.1 is 
quite outdated).
If it still happens, please specify a reproducible example and explain 
why converged=FALSE is expected.

Uwe Ligges


> ______________________________________________
> R-devel@stat.math.ethz.ch mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

From maechler at stat.math.ethz.ch  Sat Sep 18 16:54:48 2004
From: maechler at stat.math.ethz.ch (maechler@stat.math.ethz.ch)
Date: Sat Sep 18 16:54:50 2004
Subject: [Rd] Covergence FLAG in glm (PR#7235)
Message-ID: <20040918145448.3E72D11084@slim.kubism.ku.dk>

>>>>> "daniel" == daniel jeske <daniel.jeske@ucr.edu>
>>>>>     on Sat, 18 Sep 2004 04:10:40 +0200 (CEST) writes:

    daniel> Full_Name: Daniel R Jeske Version: 1.8.1 OS: Windows
    daniel> 2000 Submission from: (NULL) (138.23.228.79)


    daniel> We have just noticed that when you use glm() it
    daniel> seems the logical output 'converged' is always TRUE.
    daniel> The same data set that shows FALSE in version 1.7.1
    daniel> shows TRUE in 1.8.1.  And I know that FALSE is the
    daniel> correct answer...so it seems like we cannot trust
    daniel> the 'converged' flag for glm() in version 1.8.1
    daniel> ?????

I'm pretty sure you're wrong:

The  NEWS  file for 1.8.0  contains

>>    o	   The defaults for glm.control(epsilon=1e-8, maxit=25) have been
>>         tightened: this will produce more accurate results, slightly slower.

Hence, compared to 1.7.1, glm() in your (still very outdated!!)
version 1.8.1 will by default use more iterations and may well
converge in cases it didn't in 1.7.1 

If there weren't such cases, the change wouldn't have been
worth!

---

Note that even if you were right, your bug report would be
basically unusable as bug report and we ask to   
PLEASE only send bug reports (to R-bugs@... that is) if you know
how to do it -- i.e. if you have read that section in the R FAQ.

Regards,
Martin Maechler

From kjetil at acelerate.com  Sun Sep 19 04:31:13 2004
From: kjetil at acelerate.com (Kjetil Brinchmann Halvorsen)
Date: Sun Sep 19 04:35:36 2004
Subject: [Rd] Rcmd problems and questions, lazyloading
In-Reply-To: <414C4A32.9060606@statistik.uni-dortmund.de>
References: <414B8794.4070006@acelerate.com>
	<414C4A32.9060606@statistik.uni-dortmund.de>
Message-ID: <414CEF71.8070508@acelerate.com>

Uwe Ligges wrote:

> Kjetil Brinchmann Halvorsen wrote:
>
>> Hola!
>>
>> I got past the problems I asked about two days ago, thanks. No I am 
>> updating
>> CRAN package asypow (the daily package check on CRAN gave warnings 
>> due to
>> .Rd problems, fixed).
>>
>> Now it PASSED Rcmd check
>> (WindowsXP home edition, rw2000dev, on a new toshiba laptop, if that 
>> matters.)
>>
>> but then Rcmd build --binary
>
>
> Kjetil,
> works for me with the asypow 1.0, R-2.0.0 alpha (2004-09-16).
>
> Which version of R (I mean the date, a lot of stuff changed during the 
> last 2 weeks re. lazy loading and related bug fixes on Windows)?
>
> If it still does not work with a recent alpha version, please send me 
> the source package.
>
OK, just downloaded latest rw2000dev, but before installing, trying what 
you says below:

>
> What happens if you try
>    R CMD INSTALL --build


With LazyLoad   TRUE this gives the same error:

  preparing package asypow for lazy loading
Error in tools:::.read_description(file) :
    file '/DESCRIPTION' does not exist
Execution halted
make: *** [lazyload] Error 1
*** Installation of asypow failed ***

Again, with LazyLoad  FALSE, it works. (This is rw2000dev dated  
2004-09-13).

Then installing todays build:   (dated  2004-09-17)

(again LazyLoad TRUE)
-- passes Rcmd check
But again the same problem with Rcmd build --binary

 preparing package asypow for lazy loading
Error in tools:::.read_description(file) :
    file '/DESCRIPTION' does not exist
Execution halted
make: *** [lazyload] Error 1
*** Installation of asypow failed ***

Removing 'C:/DOCUME~1/HALVOR~1/LOCALS~1/Temp/Rbuild.2760/asypow'
 ERROR
* installation failed

Again, R CMD INSTALL --build  ..\library\asypow
gives exactly the same error message.

Changing to LazyLoad FALSE  
the problems disappear.

There is probably something with the package hindering lazyloading, but 
it is still strange
that it passes "Rcmd check" when a binary package cannot be built.

Kjetil Halvorsen

-- 

Kjetil Halvorsen.

Peace is the most effective weapon of mass construction.
               --  Mahdi Elmandjra

From kjetil at acelerate.com  Sun Sep 19 04:58:39 2004
From: kjetil at acelerate.com (Kjetil Brinchmann Halvorsen)
Date: Sun Sep 19 05:06:12 2004
Subject: [Rd] doc error for .First.lib
Message-ID: <414CF5DF.6090300@acelerate.com>

The help page of .First.lib in rw2000dev, downloaded a few hours ago, 
contains:

Packages that require other packages:

     The source code for a package that requires one or more other
     packages should have a call to 'require', preferably near the
     beginning of the source, and of course before any code that uses
     functions, classes or methods from the other package.  The default
     for argument 'save' will save the names of all required packages
     in the environment of the new package.  The saved package names
     are used by 'detach' when a package is detached to warn if other
     packages still require the detached package.  Also, if a package
     is installed with saved image (see INSTALL), the saved package
     names are used to require these packages when the new package is
     attached.

which is contradicted, by the information on the page
http://developer.r-project.org/200update.txt

which bans require etc.

Kjetil

-- 

Kjetil Halvorsen.

Peace is the most effective weapon of mass construction.
               --  Mahdi Elmandjra

From ligges at statistik.uni-dortmund.de  Sun Sep 19 15:05:24 2004
From: ligges at statistik.uni-dortmund.de (Uwe Ligges)
Date: Sun Sep 19 15:05:54 2004
Subject: [Rd] Rcmd problems and questions, lazyloading
In-Reply-To: <414CEF71.8070508@acelerate.com>
References: <414B8794.4070006@acelerate.com>
	<414C4A32.9060606@statistik.uni-dortmund.de>
	<414CEF71.8070508@acelerate.com>
Message-ID: <414D8414.4030806@statistik.uni-dortmund.de>

Kjetil Brinchmann Halvorsen wrote:

> Uwe Ligges wrote:
> 
>> Kjetil Brinchmann Halvorsen wrote:
>>
>>> Hola!
>>>
>>> I got past the problems I asked about two days ago, thanks. No I am 
>>> updating
>>> CRAN package asypow (the daily package check on CRAN gave warnings 
>>> due to
>>> .Rd problems, fixed).
>>>
>>> Now it PASSED Rcmd check
>>> (WindowsXP home edition, rw2000dev, on a new toshiba laptop, if that 
>>> matters.)
>>>
>>> but then Rcmd build --binary
>>
>>
>>
>> Kjetil,
>> works for me with the asypow 1.0, R-2.0.0 alpha (2004-09-16).
>>
>> Which version of R (I mean the date, a lot of stuff changed during the 
>> last 2 weeks re. lazy loading and related bug fixes on Windows)?
>>
>> If it still does not work with a recent alpha version, please send me 
>> the source package.
>>
> OK, just downloaded latest rw2000dev, but before installing, trying what 
> you says below:
> 
>>
>> What happens if you try
>>    R CMD INSTALL --build
> 
> 
> 
> With LazyLoad   TRUE this gives the same error:

Kjetil,

I tested the package and it appears to binary-build perfectly on my machine.
Have you made a clean build from scratch (don't only overwrite any old 
directories of R)?
Have you set all the paths correctly and are all tools installed?



>  preparing package asypow for lazy loading
> Error in tools:::.read_description(file) :
>    file '/DESCRIPTION' does not exist
> Execution halted
> make: *** [lazyload] Error 1
> *** Installation of asypow failed ***
> 
> Again, with LazyLoad  FALSE, it works. (This is rw2000dev dated  
> 2004-09-13).
> 
> Then installing todays build:   (dated  2004-09-17)
> 
> (again LazyLoad TRUE)
> -- passes Rcmd check
> But again the same problem with Rcmd build --binary
> 
> preparing package asypow for lazy loading
> Error in tools:::.read_description(file) :
>    file '/DESCRIPTION' does not exist
> Execution halted
> make: *** [lazyload] Error 1
> *** Installation of asypow failed ***
> 
> Removing 'C:/DOCUME~1/HALVOR~1/LOCALS~1/Temp/Rbuild.2760/asypow'
> ERROR
> * installation failed
> 
> Again, R CMD INSTALL --build  ..\library\asypow



Ahhhhh! Here you will need forward slashes:

   R CMD INSTALL --build ../library/asypow
or
   R CMD BUILD --binary ../library/asypow


Uwe


> gives exactly the same error message.
> 
> Changing to LazyLoad FALSE  the problems disappear.
> 
> There is probably something with the package hindering lazyloading, but 
> it is still strange
> that it passes "Rcmd check" when a binary package cannot be built.
> 
> Kjetil Halvorsen
>

From gb at stat.umu.se  Sun Sep 19 17:57:41 2004
From: gb at stat.umu.se (gb)
Date: Sun Sep 19 17:57:43 2004
Subject: [Rd] NAMESPACE Warning
Message-ID: <20040919155741.GA7765@stat.umu.se>

I'm trying to learn how to use namespaces, so I have created a small
package with two functions. My NAMESPACE file is

importFrom(survival, Surv)
export(mlreg.fit, risksets)

because 'mlreg.fit' uses 'Surv' from 'survival'. However I get

* checking package dependencies ... WARNING
Namespace dependencies not required:
  survival

Why? (If I remove 'importFrom' I get the expected Error message.)

G?ran
--
 G?ran Brostr?m                    tel: +46 90 786 5223
 Department of Statistics          fax: +46 90 786 6614
 Ume? University                   http://www.stat.umu.se/egna/gb/
 SE-90187 Ume?, Sweden             e-mail: gb@stat.umu.se

From gb at stat.umu.se  Sun Sep 19 18:03:35 2004
From: gb at stat.umu.se (gb)
Date: Sun Sep 19 18:03:37 2004
Subject: [Rd] Re: NAMESPACE Warning
In-Reply-To: <20040919155741.GA7765@stat.umu.se>
References: <20040919155741.GA7765@stat.umu.se>
Message-ID: <20040919160335.GB7765@stat.umu.se>

On Sun, Sep 19, 2004 at 05:57:41PM +0200,  wrote:
> I'm trying to learn how to use namespaces, so I have created a small
> package with two functions. My NAMESPACE file is
> 
> importFrom(survival, Surv)
> export(mlreg.fit, risksets)
> 
> because 'mlreg.fit' uses 'Surv' from 'survival'. However I get
> 
> * checking package dependencies ... WARNING
> Namespace dependencies not required:
>   survival
> 
> Why? (If I remove 'importFrom' I get the expected Error message.)

I added 'survival' to 'Depends:' in 'DESCRIPTION' and the warning
disappeared. 


> G?ran

From gb at stat.umu.se  Sun Sep 19 18:51:49 2004
From: gb at stat.umu.se (gb)
Date: Sun Sep 19 18:51:54 2004
Subject: [Rd] Namespace problem
Message-ID: <20040919165149.GA7954@stat.umu.se>

Now I try to add some C and Fortan code to my package, so the NAMESPACE
file is

useDynLib(eha)
importFrom(survival, Surv)
export(mlreg.fit, risksets)

but I get 

.....
* checking R files for library.dynam ... OK
* checking S3 generic/method consistency ... WARNING
Error in .try_quietly({ : Error in library(package, lib.loc = lib.loc, character.only = TRUE, verbose = FALSE) :
        package/namespace load failed for 'eha'
Execution halted
See section 'Generic functions and methods' of the 'Writing R Extensions'
manual.
.....

I've checked that section, but I am not adding methods to generics, I'm not
writing new generic functions.

If I remove useDynLib(eha), I get no errors or warnings, except that the
example in mlreg.fit.Rd doesn't work (of course).

So what's wrong?
 
G?ran
-- 
 G?ran Brostr?m                    tel: +46 90 786 5223
 Department of Statistics          fax: +46 90 786 6614
 Ume? University                   http://www.stat.umu.se/egna/gb/
 SE-90187 Ume?, Sweden             e-mail: gb@stat.umu.se

From ligges at statistik.uni-dortmund.de  Sun Sep 19 20:01:45 2004
From: ligges at statistik.uni-dortmund.de (Uwe Ligges)
Date: Sun Sep 19 20:02:13 2004
Subject: [Rd] Incorrect display of b[hat((a))] expression in plots
In-Reply-To: <41081B7C.1030104@stat.auckland.ac.nz>
References: <000001c473fc$e927a9a0$01000001@hblaptop>
	<4107608F.2090802@statistik.uni-dortmund.de>
	<41081B7C.1030104@stat.auckland.ac.nz>
Message-ID: <414DC989.1050703@statistik.uni-dortmund.de>

Paul Murrell wrote:

> Hi
> 
> 
> Uwe Ligges wrote:
> 
>> Confirmed.
>>
>> I might look at it during August, since the underlying code is not 
>> that new to me. If Paul (or anybody else from R Core) has not answered 
>> yet and there is not already a related bug report in the database, I'd 
>> suggest to submit a bug report.
> 
> 
> 
> Yep, bug not lack-of-implementation.
> 
> Uwe:  sounds like you might get to this before me.  Some possibly useful 
> observations from a brief look yesterday:
> (i)  Looks like only the actual drawing that is wrong;  the bounding box 
> calculations appear correct (the parentheses around the outside look 
> about right)
> (ii)  The offending accents are all common to RenderAccent() (they all 
> appear in AccentTable)




Paul, Henrik,

here we go - later than promised, but not too late for 2.0.0, I hope.


The last lines of RenderAccent() need:

+   if(draw)
     PMoveTo(savedX + width, savedY, mc);

rather than just

     PMoveTo(savedX + width, savedY, mc);

and it took me more than 2 painful hours to get the point! :-(

(Do we have a PR#? I don't find it.)

Uwe



> Paul
> 
> 
>> Henrik Bengtsson wrote:
>>
>>> Hi, I am not sure if this is a bug or a non-implement feature of
>>> text-drawing functions with TeX-style expression, but hat() and some 
>>> of its
>>> equals does not get the right "bounding boxes" if they are put in 
>>> sub- or
>>> superscripts. For instance, for the expression 'b[hat(a)]' the hat() 
>>> seems
>>> to shift 'hat(a)' too much to the right of 'b'. Try the below example 
>>> and
>>> you'll see what I mean:
>>>
>>> label <- list(
>>>   expression((b[sqrt(a)])),
>>>   expression((b[bar(a)])),
>>>   expression((b[widehat(a)])),
>>>   expression((b[widetilde(a)])),
>>>   expression((tilde(a))),
>>>   # Problematic:
>>>   expression((b[dot(a)])),
>>>   expression((b[ring(a)])),
>>>   expression((b[hat(a)])),
>>>   expression((b[tilde(a)])),
>>>   expression((b^dot(a))),
>>>   expression((b^ring(a))),
>>>   expression((b^hat(a))),
>>>   expression((b^tilde(a)))
>>> )
>>>
>>> plot(NA, xlim=c(0,2), ylim=c(-1,length(label)))
>>> for (kk in seq(label))
>>>   text(1,length(label)-kk, label=label[[kk]])
>>>
>>> The problem occurs for the postscript and png devices too (I haven't 
>>> tried
>>> the others).
>>>
>>> I'm on WindowsXP and "R version 1.9.1, 2004-06-21" (non-patched).
>>>
>>> Best wishes
>>>
>>> Henrik Bengtsson
>>>
>>> Dept. of Mathematical Statistics @ Centre for Mathematical Sciences 
>>> Lund Institute of Technology/Lund University, Sweden (+2h UTC)
>>> +46 46 2229611 (off), +46 708 909208 (cell), +46 46 2224623 (fax)
>>> h b @ m a t h s . l t h . s e, http://www.maths.lth.se/~hb/
>>>
>>> ______________________________________________
>>> R-devel@stat.math.ethz.ch mailing list
>>> https://www.stat.math.ethz.ch/mailman/listinfo/r-devel
>>
>>
>>
>> ______________________________________________
>> R-devel@stat.math.ethz.ch mailing list
>> https://www.stat.math.ethz.ch/mailman/listinfo/r-devel
> 
> 
>

From p.murrell at auckland.ac.nz  Sun Sep 19 23:11:50 2004
From: p.murrell at auckland.ac.nz (Paul Murrell)
Date: Sun Sep 19 23:12:01 2004
Subject: [Rd] Incorrect display of b[hat((a))] expression in plots
References: <000001c473fc$e927a9a0$01000001@hblaptop>
	<4107608F.2090802@statistik.uni-dortmund.de>
	<41081B7C.1030104@stat.auckland.ac.nz>
	<414DC989.1050703@statistik.uni-dortmund.de>
Message-ID: <414DF616.4010104@stat.auckland.ac.nz>

Hi


Uwe Ligges wrote:
> Paul Murrell wrote:
> 
>> Hi
>>
>>
>> Uwe Ligges wrote:
>>
>>> Confirmed.
>>>
>>> I might look at it during August, since the underlying code is not 
>>> that new to me. If Paul (or anybody else from R Core) has not 
>>> answered yet and there is not already a related bug report in the 
>>> database, I'd suggest to submit a bug report.
>>
>>
>>
>>
>> Yep, bug not lack-of-implementation.
>>
>> Uwe:  sounds like you might get to this before me.  Some possibly 
>> useful observations from a brief look yesterday:
>> (i)  Looks like only the actual drawing that is wrong;  the bounding 
>> box calculations appear correct (the parentheses around the outside 
>> look about right)
>> (ii)  The offending accents are all common to RenderAccent() (they all 
>> appear in AccentTable)
> 
> 
> 
> 
> 
> Paul, Henrik,
> 
> here we go - later than promised, but not too late for 2.0.0, I hope.
> 
> 
> The last lines of RenderAccent() need:
> 
> +   if(draw)
>     PMoveTo(savedX + width, savedY, mc);
> 
> rather than just
> 
>     PMoveTo(savedX + width, savedY, mc);
> 
> and it took me more than 2 painful hours to get the point! :-(


Looks good to me.  Committing for 2.0.0
Thanks heaps Uwe! :)


> (Do we have a PR#? I don't find it.)


Don't think so.

Paul


>>> Henrik Bengtsson wrote:
>>>
>>>> Hi, I am not sure if this is a bug or a non-implement feature of
>>>> text-drawing functions with TeX-style expression, but hat() and some 
>>>> of its
>>>> equals does not get the right "bounding boxes" if they are put in 
>>>> sub- or
>>>> superscripts. For instance, for the expression 'b[hat(a)]' the hat() 
>>>> seems
>>>> to shift 'hat(a)' too much to the right of 'b'. Try the below 
>>>> example and
>>>> you'll see what I mean:
>>>>
>>>> label <- list(
>>>>   expression((b[sqrt(a)])),
>>>>   expression((b[bar(a)])),
>>>>   expression((b[widehat(a)])),
>>>>   expression((b[widetilde(a)])),
>>>>   expression((tilde(a))),
>>>>   # Problematic:
>>>>   expression((b[dot(a)])),
>>>>   expression((b[ring(a)])),
>>>>   expression((b[hat(a)])),
>>>>   expression((b[tilde(a)])),
>>>>   expression((b^dot(a))),
>>>>   expression((b^ring(a))),
>>>>   expression((b^hat(a))),
>>>>   expression((b^tilde(a)))
>>>> )
>>>>
>>>> plot(NA, xlim=c(0,2), ylim=c(-1,length(label)))
>>>> for (kk in seq(label))
>>>>   text(1,length(label)-kk, label=label[[kk]])
>>>>
>>>> The problem occurs for the postscript and png devices too (I haven't 
>>>> tried
>>>> the others).
>>>>
>>>> I'm on WindowsXP and "R version 1.9.1, 2004-06-21" (non-patched).
>>>>
>>>> Best wishes
>>>>
>>>> Henrik Bengtsson
>>>>
>>>> Dept. of Mathematical Statistics @ Centre for Mathematical Sciences 
>>>> Lund Institute of Technology/Lund University, Sweden (+2h UTC)
>>>> +46 46 2229611 (off), +46 708 909208 (cell), +46 46 2224623 (fax)
>>>> h b @ m a t h s . l t h . s e, http://www.maths.lth.se/~hb/
>>>>
>>>> ______________________________________________
>>>> R-devel@stat.math.ethz.ch mailing list
>>>> https://www.stat.math.ethz.ch/mailman/listinfo/r-devel
>>>
>>>
>>>
>>>
>>> ______________________________________________
>>> R-devel@stat.math.ethz.ch mailing list
>>> https://www.stat.math.ethz.ch/mailman/listinfo/r-devel
>>
>>
>>
>>


-- 
Dr Paul Murrell
Department of Statistics
The University of Auckland
Private Bag 92019
Auckland
New Zealand
64 9 3737599 x85392
paul@stat.auckland.ac.nz
http://www.stat.auckland.ac.nz/~paul/

From maechler at stat.math.ethz.ch  Mon Sep 20 10:43:44 2004
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Mon Sep 20 10:43:46 2004
Subject: [Rd] Namespace problem
In-Reply-To: <20040919165149.GA7954@stat.umu.se>
References: <20040919165149.GA7954@stat.umu.se>
Message-ID: <16718.38976.221866.25262@gargle.gargle.HOWL>

>>>>> "GB" == G?ran Brostr?m <gb@stat.umu.se>
>>>>>     on Sun, 19 Sep 2004 18:51:49 +0200 writes:

    GB> Now I try to add some C and Fortan code to my package, so the NAMESPACE
    GB> file is

    GB> useDynLib(eha)
    GB> importFrom(survival, Surv)
    GB> export(mlreg.fit, risksets)

    GB> but I get 

    GB> .....
    GB> * checking R files for library.dynam ... OK
    GB> * checking S3 generic/method consistency ... WARNING
    GB> Error in .try_quietly({ : Error in library(package, lib.loc = lib.loc, character.only = TRUE, verbose = FALSE) :
    GB> package/namespace load failed for 'eha'
    GB> Execution halted
    GB> See section 'Generic functions and methods' of the 'Writing R Extensions'
    GB> manual.
    GB> .....

    GB> I've checked that section, but I am not adding methods to generics, 

sure? 
Aren't you trying to export  mlreg.fit
which looks like a 'fit' S3 method for the 'mlreg' generic?

In that case you need to add
S3method(mlreg, fit)
to the NAMESPACE file.

    GB> I'm not writing new generic functions.

    GB> If I remove useDynLib(eha), I get no errors or warnings, except that the
    GB> example in mlreg.fit.Rd doesn't work (of course).

    GB> So what's wrong?
 
(see above)?

Regards,
Martin

Martin Maechler <maechler@stat.math.ethz.ch>	http://stat.ethz.ch/~maechler/
Seminar fuer Statistik, ETH-Zentrum  LEO C16	Leonhardstr. 27
ETH (Federal Inst. Technology)	8092 Zurich	SWITZERLAND
phone: x-41-1-632-3408		fax: ...-1228			<><

From gb at stat.umu.se  Mon Sep 20 11:00:57 2004
From: gb at stat.umu.se (gb)
Date: Mon Sep 20 11:01:00 2004
Subject: [Rd] Namespace problem
In-Reply-To: <16718.38976.221866.25262@gargle.gargle.HOWL>
References: <20040919165149.GA7954@stat.umu.se>
	<16718.38976.221866.25262@gargle.gargle.HOWL>
Message-ID: <20040920090057.GB20279@stat.umu.se>

On Mon, Sep 20, 2004 at 10:43:44AM +0200, Martin Maechler wrote:
> >>>>> "GB" == G?ran Brostr?m <gb@stat.umu.se>
> >>>>>     on Sun, 19 Sep 2004 18:51:49 +0200 writes:

[...]

>     GB> I've checked that section, but I am not adding methods to generics, 
> 
> sure? 
> Aren't you trying to export  mlreg.fit
> which looks like a 'fit' S3 method for the 'mlreg' generic?

But it isn't. I just have found '.' to be a convenient separator in
variable names, since '_' (my C favourite) wasn't available. So what you
are suggesting is that I have to change all the variable names with dots in
them. Or add 'S3metod(...' for each of them. I guess that the former is
preferable.  

But how is this problem connected to using C/Fortran code?

G?ran
-- 
 G?ran Brostr?m                    tel: +46 90 786 5223
 Department of Statistics          fax: +46 90 786 6614
 Ume? University                   http://www.stat.umu.se/egna/gb/
 SE-90187 Ume?, Sweden             e-mail: gb@stat.umu.se

From J.C.Rougier at durham.ac.uk  Mon Sep 20 11:17:50 2004
From: J.C.Rougier at durham.ac.uk (Jonathan Rougier)
Date: Mon Sep 20 11:17:58 2004
Subject: [Rd] checking for _non-existing_ documentation entries.
In-Reply-To: <C4178DC99E08604EA5E2BDB989F093800240A355@extas2-hba.tas.csiro.au>
References: <C4178DC99E08604EA5E2BDB989F093800240A355@extas2-hba.tas.csiro.au>
Message-ID: <414EA03E.8080702@durham.ac.uk>

Hi Mark, Hi Wolski,

I do this using noweb and a large-ish makefile.  For a package I create 
a noweb subdirectory, stick the combined files in as "*.nw", and then 
use the Unix utility "make" with various targets to split these up into 
*.tex (etc), *.R, and *.Rd files, put into the right place; I also use 
make to install or build the updated package, so it all happens pretty 
seamlessly.

I'd be happy to send the makefile on if it would be helpful, although 
I'd be the first to admit that my understanding of make is not exactly 
state-of-the-art.

Cheers, Jonathan.

Mark Bravington wrote

>Wolski wrote:
> 
>#I knew about prompt and promptMethods promptClass. They are 
>#extremely useful if you are starting to write a package. But 
>#what with existing packages that have to be rewritten?
>#
>#Having code and documentation in one place would be a great 
>#help. Has anyone a tool which is able to generate from 
>#appropriately commented R-code files (e.g. <<example>>= 
>#-example section) Rd files:
>#e.g. a noweb lit-prog file or patched version of Doxygen?
>#
>
>Yes, there is such a tool-- or something close to it, anyway. My 'mvbutils' package lets you keep documentation in the same source "file" as the the function definition, appended at the end. Usually, when I am developing a function I start by writing informal documentation (which still displays with "?" but isn't an Rd file). Eventually I convert the documentation into a plain-text format close to the pager representation of R help files; this format can be converted into a .Rd file using my 'doc2Rd' function. Once I am close to having a whole package ready, I use the 'formalize.package' function to set up the a whole package; it creates the skeleton and the .R source file, and all the .Rd files via 'doc2Rd', ready for RCMD.
>
>For more details, have a look at README.mvbutils()
>
>Hope this helps
>
>Mark
>
>*******************************
>
>Mark Bravington
>CSIRO (CMIS)
>PO Box 1538
>Castray Esplanade
>Hobart
>TAS 7001
>
>phone (61) 3 6232 5118
>fax (61) 3 6232 5012
>Mark.Bravington@csiro.au
>
>______________________________________________
>R-devel@stat.math.ethz.ch mailing list
>https://stat.ethz.ch/mailman/listinfo/r-devel
>  
>

-- 
Jonathan Rougier                       Science Laboratories
Department of Mathematical Sciences    South Road
University of Durham                   Durham DH1 3LE
tel: +44 (0)191 334 3111, fax: +44 (0)191 334 3051
http://www.maths.dur.ac.uk/stats/people/jcr/jcr.html

From maechler at stat.math.ethz.ch  Mon Sep 20 11:41:05 2004
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Mon Sep 20 11:41:07 2004
Subject: [Rd] R-2.0.0 Install problem for pkg bundle w inter-dependent
	namespaces
In-Reply-To: <D7A3CFD7825BD6119B880002A58F06C20C521C2E@groexmb02.pfizer.com>
References: <D7A3CFD7825BD6119B880002A58F06C20C521C2E@groexmb02.pfizer.com>
Message-ID: <16718.42417.822821.357884@gargle.gargle.HOWL>

>>>>> "Greg" == Warnes, Gregory R <gregory_r_warnes@groton.pfizer.com>
>>>>>     on Fri, 17 Sep 2004 14:18:29 -0400 writes:

    Greg> I have a revised version of the gregmisc package,
    Greg> which I've converted into a package bundle each of
    Greg> which has a namespace: gplots, gmodels, gdata,
    Greg> gtoools.  Of course, there are interdependencies among
    Greg> these namespaces:

    Greg> gsun374: /tmp [11]> cd gregmisc/
    Greg> gsun374: gregmisc [12]> grep import */NAMESPACE
    Greg>   gdata/NAMESPACE:importFrom(gtools, odd, invalid, mixedsort)
    Greg> gmodels/NAMESPACE:importFrom(MASS, ginv)
    Greg>  gplots/NAMESPACE:importFrom(gtools, invalid)
    Greg>  gplots/NAMESPACE:importFrom(gtools, odd)
    Greg>  gplots/NAMESPACE:importFrom(gdata, nobs)

since nobody else has answered yet (and a considerable portion
of R-core is traveling this week) :

If I understand correctly, your basic package 'gtools' and the
dependency you need is

 gplots --> gdata --> gtools
        \----->----/

Have you made sure to use the proper  'Depends: ' entries in
the DESCRIPTION(.in) files of your bundle packages ?

This works fine if the packages are *not* in a bundle, right?

    Greg> Under R-1.9.1, this package bundle passes R CMD check
    Greg> and installs happily.  However, under yesterday's
    Greg> R-2.0.0-alpha, the package fails to install (& hence
    Greg> pass CMD CHECK) with the error

    Greg> ** preparing package for lazy loading
    Greg> Error in loadNamespace(i[[1]], c(lib.loc, .libPaths()), keep.source)
    Greg> : 
    Greg> There is no package called 'gdata'
    Greg> Execution halted
    Greg> ERROR: lazy loading failed for package 'gplots'

    Greg> because the gdata package is the last in the bundle to
    Greg> be installed, so it is not yet present.

    Greg> So, what is the proper way to handle this?  Is there
    Greg> some way to manually specify the package install order?

Well, isn't the order in the 'Contains:' field of the bundle
DESCRIPTION file used?  
If not, please consider sending patches for  
src/scripts/INSTALL.in

There are not too many bundles AFAIK, and conceptually
(inspite of the recommended VR one) the improved package
management tools that we (and the bioconductor project) have
been adding to R for a while noe
really aim for "R package objects" and clean version /
dependency handling of inidividual packages in many different concepts.

If bundle installation etc could rely entirely on the package
tools, bundles would "work automagically".  But probably, for
this a bundle would have to be treated as a "package repository"
which it isn't currently AFAIK.

Regards,
Martin Maechler

From maechler at stat.math.ethz.ch  Mon Sep 20 12:26:45 2004
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Mon Sep 20 12:26:46 2004
Subject: [Rd] Namespace problem
In-Reply-To: <20040920090057.GB20279@stat.umu.se>
References: <20040919165149.GA7954@stat.umu.se>
	<16718.38976.221866.25262@gargle.gargle.HOWL>
	<20040920090057.GB20279@stat.umu.se>
Message-ID: <16718.45157.239090.972874@gargle.gargle.HOWL>

>>>>> "GB" == G?ran Brostr?m <gb@stat.umu.se>
>>>>>     on Mon, 20 Sep 2004 11:00:57 +0200 writes:

    GB> On Mon, Sep 20, 2004 at 10:43:44AM +0200, Martin Maechler wrote:
    >> >>>>> "GB" == G?ran Brostr?m <gb@stat.umu.se>
    >> >>>>>     on Sun, 19 Sep 2004 18:51:49 +0200 writes:

    GB> [...]

    GB> I've checked that section, but I am not adding methods to generics, 
    >> 
    >> sure? 
    >> Aren't you trying to export  mlreg.fit
    >> which looks like a 'fit' S3 method for the 'mlreg' generic?

    GB> But it isn't. I just have found '.' to be a convenient separator in
    GB> variable names, since '_' (my C favourite) wasn't available. So what you
    GB> are suggesting

no!! I'm not.

    GB> that I have to change all the variable names with dots in
    GB> them. Or add 'S3metod(...' for each of them. I guess that the former is
    GB> preferable.  

no, really neither should be required.

We do encourage not using "." for new function names because of
the reason above, but it's definitely not a requirement.
In the case where  'foo'  is an S3 generic function name,
we however recommend quite strongly not to use 
   'foo.bar'
as function name since it looks "too much" like an S3 method.
Is this the case for you?

    GB> But how is this problem connected to using C/Fortran code?

only via "namespace magic".

E.g., for packages with namespaces and R 2.0.0, 
 it' will become recommended  to *NOT* use the 'PACKAGE = "foobar"'
 argument to .C(.) or .Fortran() calls because then, the package
 version can be taken into account,
since NEWS for 2.0.0 has

>> C-LEVEL FACILITIES
>> 
>>     o	The PACKAGE argument for .C/.Call/.Fortran/.External can be
>> 	omitted if the call is within code within a package with a
>> 	namespace.  This ensures that the native routine being called
>> 	is found in the DLL of the correct version of the package if
>> 	multiple versions of a package are loaded in the R session.
>> 	Using a namespace and omitting the PACKAGE argument is
>> 	currently the only way to ensure that the correct version is
>> 	used.

From gb at stat.umu.se  Mon Sep 20 12:46:58 2004
From: gb at stat.umu.se (gb)
Date: Mon Sep 20 12:47:06 2004
Subject: [Rd] Namespace problem
In-Reply-To: <16718.45157.239090.972874@gargle.gargle.HOWL>
References: <20040919165149.GA7954@stat.umu.se>
	<16718.38976.221866.25262@gargle.gargle.HOWL>
	<20040920090057.GB20279@stat.umu.se>
	<16718.45157.239090.972874@gargle.gargle.HOWL>
Message-ID: <20040920104658.GA32606@stat.umu.se>

On Mon, Sep 20, 2004 at 12:26:45PM +0200, Martin Maechler wrote:
> >>>>> "GB" == G?ran Brostr?m <gb@stat.umu.se>
> >>>>>     on Mon, 20 Sep 2004 11:00:57 +0200 writes:
> 
>     GB> On Mon, Sep 20, 2004 at 10:43:44AM +0200, Martin Maechler wrote:
>     >> >>>>> "GB" == G?ran Brostr?m <gb@stat.umu.se>
>     >> >>>>>     on Sun, 19 Sep 2004 18:51:49 +0200 writes:
> 

> We do encourage not using "." for new function names because of
> the reason above, but it's definitely not a requirement.
> In the case where  'foo'  is an S3 generic function name,
> we however recommend quite strongly not to use 
>    'foo.bar'
> as function name since it looks "too much" like an S3 method.
> Is this the case for you?

No.

> 
>     GB> But how is this problem connected to using C/Fortran code?
> 
> only via "namespace magic".

Yes, magic is the word: I got 'R CMD check' and NAMESPACE working by
cleaning 'R' from '*.R~' files and 'src' from old '.o' files and an old
'eha.so' (from 1.x.x something)!  

Another thought: Since I really haven't used S3 methods so far, should I go
for S4 methods directly?

G?ran
-- 
 G?ran Brostr?m                    tel: +46 90 786 5223
 Department of Statistics          fax: +46 90 786 6614
 Ume? University                   http://www.stat.umu.se/egna/gb/
 SE-90187 Ume?, Sweden             e-mail: gb@stat.umu.se

From ligges at statistik.uni-dortmund.de  Mon Sep 20 12:54:55 2004
From: ligges at statistik.uni-dortmund.de (Uwe Ligges)
Date: Mon Sep 20 12:55:25 2004
Subject: [Rd] Namespace problem
In-Reply-To: <20040920104658.GA32606@stat.umu.se>
References: <20040919165149.GA7954@stat.umu.se>	<16718.38976.221866.25262@gargle.gargle.HOWL>	<20040920090057.GB20279@stat.umu.se>	<16718.45157.239090.972874@gargle.gargle.HOWL>
	<20040920104658.GA32606@stat.umu.se>
Message-ID: <414EB6FF.40609@statistik.uni-dortmund.de>

gb wrote:

> On Mon, Sep 20, 2004 at 12:26:45PM +0200, Martin Maechler wrote:
> 
>>>>>>>"GB" == G?ran Brostr?m <gb@stat.umu.se>
>>>>>>>    on Mon, 20 Sep 2004 11:00:57 +0200 writes:
>>
>>    GB> On Mon, Sep 20, 2004 at 10:43:44AM +0200, Martin Maechler wrote:
>>    >> >>>>> "GB" == G?ran Brostr?m <gb@stat.umu.se>
>>    >> >>>>>     on Sun, 19 Sep 2004 18:51:49 +0200 writes:
>>
> 
> 
>>We do encourage not using "." for new function names because of
>>the reason above, but it's definitely not a requirement.
>>In the case where  'foo'  is an S3 generic function name,
>>we however recommend quite strongly not to use 
>>   'foo.bar'
>>as function name since it looks "too much" like an S3 method.
>>Is this the case for you?
> 
> 
> No.
> 
> 
>>    GB> But how is this problem connected to using C/Fortran code?
>>
>>only via "namespace magic".
> 
> 
> Yes, magic is the word: I got 'R CMD check' and NAMESPACE working by
> cleaning 'R' from '*.R~' files and 'src' from old '.o' files and an old
> 'eha.so' (from 1.x.x something)!  
> 
> Another thought: Since I really haven't used S3 methods so far, should I go
> for S4 methods directly?

[This is my opinion and might not be shared by others.]
Depends on what you are going to do.
For a set of new classes, generics and methods, I'd go for S4. For 
extending S3 classes or aiming at similar stuff that is closely related 
to existing S3 classes, I'd rather stay with S3.

Uwe Ligges


> G?ran

From rossini at blindglobe.net  Mon Sep 20 16:04:36 2004
From: rossini at blindglobe.net (A.J. Rossini)
Date: Mon Sep 20 16:04:44 2004
Subject: [Rd] R-2.0.0 Install problem for pkg bundle w inter-dependent
	namespaces
In-Reply-To: <16718.42417.822821.357884@gargle.gargle.HOWL> (Martin
	Maechler's message of "Mon, 20 Sep 2004 11:41:05 +0200")
References: <D7A3CFD7825BD6119B880002A58F06C20C521C2E@groexmb02.pfizer.com>
	<16718.42417.822821.357884@gargle.gargle.HOWL>
Message-ID: <85d60hox3f.fsf@servant.blindglobe.net>


I recall that we (the BioC group) ended up shying away from bundles,
since there were so few successful ones in existence; hence the work
put into the reposTools package (for making repositories).  That might
be a better approach, Greg (i.e. make a 3rd party repository, rather
than a bundle, and make sure that the dependencies are not circular,
which was a nasty problem for an (unreleased) while with BioC).

best,
-tony


Martin Maechler <maechler@stat.math.ethz.ch> writes:

>>>>>> "Greg" == Warnes, Gregory R <gregory_r_warnes@groton.pfizer.com>
>>>>>>     on Fri, 17 Sep 2004 14:18:29 -0400 writes:
>
>     Greg> I have a revised version of the gregmisc package,
>     Greg> which I've converted into a package bundle each of
>     Greg> which has a namespace: gplots, gmodels, gdata,
>     Greg> gtoools.  Of course, there are interdependencies among
>     Greg> these namespaces:
>
>     Greg> gsun374: /tmp [11]> cd gregmisc/
>     Greg> gsun374: gregmisc [12]> grep import */NAMESPACE
>     Greg>   gdata/NAMESPACE:importFrom(gtools, odd, invalid, mixedsort)
>     Greg> gmodels/NAMESPACE:importFrom(MASS, ginv)
>     Greg>  gplots/NAMESPACE:importFrom(gtools, invalid)
>     Greg>  gplots/NAMESPACE:importFrom(gtools, odd)
>     Greg>  gplots/NAMESPACE:importFrom(gdata, nobs)
>
> since nobody else has answered yet (and a considerable portion
> of R-core is traveling this week) :
>
> If I understand correctly, your basic package 'gtools' and the
> dependency you need is
>
>  gplots --> gdata --> gtools
>         \----->----/
>
> Have you made sure to use the proper  'Depends: ' entries in
> the DESCRIPTION(.in) files of your bundle packages ?
>
> This works fine if the packages are *not* in a bundle, right?
>
>     Greg> Under R-1.9.1, this package bundle passes R CMD check
>     Greg> and installs happily.  However, under yesterday's
>     Greg> R-2.0.0-alpha, the package fails to install (& hence
>     Greg> pass CMD CHECK) with the error
>
>     Greg> ** preparing package for lazy loading
>     Greg> Error in loadNamespace(i[[1]], c(lib.loc, .libPaths()), keep.source)
>     Greg> : 
>     Greg> There is no package called 'gdata'
>     Greg> Execution halted
>     Greg> ERROR: lazy loading failed for package 'gplots'
>
>     Greg> because the gdata package is the last in the bundle to
>     Greg> be installed, so it is not yet present.
>
>     Greg> So, what is the proper way to handle this?  Is there
>     Greg> some way to manually specify the package install order?
>
> Well, isn't the order in the 'Contains:' field of the bundle
> DESCRIPTION file used?  
> If not, please consider sending patches for  
> src/scripts/INSTALL.in
>
> There are not too many bundles AFAIK, and conceptually
> (inspite of the recommended VR one) the improved package
> management tools that we (and the bioconductor project) have
> been adding to R for a while noe
> really aim for "R package objects" and clean version /
> dependency handling of inidividual packages in many different concepts.
>
> If bundle installation etc could rely entirely on the package
> tools, bundles would "work automagically".  But probably, for
> this a bundle would have to be treated as a "package repository"
> which it isn't currently AFAIK.
>
> Regards,
> Martin Maechler
>
> ______________________________________________
> R-devel@stat.math.ethz.ch mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Anthony Rossini			    Research Associate Professor
rossini@u.washington.edu            http://www.analytics.washington.edu/ 
Biomedical and Health Informatics   University of Washington
Biostatistics, SCHARP/HVTN          Fred Hutchinson Cancer Research Center
UW (Tu/Th/F): 206-616-7630 FAX=206-543-3461 | Voicemail is unreliable
FHCRC  (M/W): 206-667-7025 FAX=206-667-4812 | use Email

CONFIDENTIALITY NOTICE: This e-mail message and any attachme...{{dropped}}

From wsetzer at mindspring.com  Mon Sep 20 18:10:15 2004
From: wsetzer at mindspring.com (wsetzer@mindspring.com)
Date: Mon Sep 20 18:10:19 2004
Subject: [Rd] problem typcasting return of R_ExternalPtrAddr(SEXP s)
Message-ID: <1363993.1095696616305.JavaMail.root@wamui06.slb.atl.earthlink.net>

In the odesolve routine lsoda(), I allow the function (named func) that calculates the system of differential equations to be defined in a dll that has been dynamically loaded from the file named in dllname.  I use getNativeSymbolInfo(func, dllname)$address to get the address of the function  and pass it to a C function called via the .Call interface.  Inside that C function,  I use R_ExternalPtrAddr(deriv_func) to get the function pointer.  This requires typcasting the return value of R_ExternalPtrAddr from (void *) to (deriv_func *), defined in a typedef in call_lsoda().  

To be more explicit (I'm replacing irrelevant arguments with ellipses):
In lsoda(...,func,dllname,...), func contains a string giving the name of a function which is defined in the dll whose name is contained in dllname.

inside lsoda() are lines like
func <- getNativeSymbolInfo(symbol.C(func),PACKAGE=dllname)

.Call("call_lsoda",...,func)
 
inside call_lsoda.c are the lines:
SEXP func;

typedef void deriv_func(long int *, double *,double *, double *);

derivs = (deriv_func *) R_ExternalPtrAddr(func);


This all worked up to now, but now, (as Kurt Hornik kindly informs me) gcc 3.4 gives the warning:

warning: ISO C forbids conversion of object pointer to function pointer type

so I need to clean this up so odesolve will compile cleanly for version 2.0.0 of R.  I'm at a loss of what to do, though, since the return value of R_ExternalPtrAddr is (void *), and I need a function pointer.

I'd guess there would need to be a special function (say declared as 
( R_ExternalFnPtr(SEXP s) *)(), 
or something like that), to make all this work, but I can't find such a function.   My C programming is pretty rusty, so I'm wondering if someone has an idea about how I can get around this problem (or perhaps I've misunderstood the meaning of the error message? )

Woody Setzer

From ripley at stats.ox.ac.uk  Mon Sep 20 18:30:46 2004
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon Sep 20 18:30:49 2004
Subject: [Rd] R-2.0.0 Install problem for pkg bundle w inter-dependent
	namespaces
In-Reply-To: <16718.42417.822821.357884@gargle.gargle.HOWL>
Message-ID: <Pine.LNX.4.44.0409201728470.11743-100000@gannet.stats>

On Mon, 20 Sep 2004, Martin Maechler wrote:

> >>>>> "Greg" == Warnes, Gregory R <gregory_r_warnes@groton.pfizer.com>
> >>>>>     on Fri, 17 Sep 2004 14:18:29 -0400 writes:
> 
>     Greg> I have a revised version of the gregmisc package,
>     Greg> which I've converted into a package bundle each of
>     Greg> which has a namespace: gplots, gmodels, gdata,
>     Greg> gtoools.  Of course, there are interdependencies among
>     Greg> these namespaces:
> 
>     Greg> gsun374: /tmp [11]> cd gregmisc/
>     Greg> gsun374: gregmisc [12]> grep import */NAMESPACE
>     Greg>   gdata/NAMESPACE:importFrom(gtools, odd, invalid, mixedsort)
>     Greg> gmodels/NAMESPACE:importFrom(MASS, ginv)
>     Greg>  gplots/NAMESPACE:importFrom(gtools, invalid)
>     Greg>  gplots/NAMESPACE:importFrom(gtools, odd)
>     Greg>  gplots/NAMESPACE:importFrom(gdata, nobs)
> 
> since nobody else has answered yet (and a considerable portion
> of R-core is traveling this week) :
> 
> If I understand correctly, your basic package 'gtools' and the
> dependency you need is
> 
>  gplots --> gdata --> gtools
>         \----->----/
> 
> Have you made sure to use the proper  'Depends: ' entries in
> the DESCRIPTION(.in) files of your bundle packages ?
> 
> This works fine if the packages are *not* in a bundle, right?
> 
>     Greg> Under R-1.9.1, this package bundle passes R CMD check
>     Greg> and installs happily.  However, under yesterday's
>     Greg> R-2.0.0-alpha, the package fails to install (& hence
>     Greg> pass CMD CHECK) with the error
> 
>     Greg> ** preparing package for lazy loading
>     Greg> Error in loadNamespace(i[[1]], c(lib.loc, .libPaths()), keep.source)
>     Greg> : 
>     Greg> There is no package called 'gdata'
>     Greg> Execution halted
>     Greg> ERROR: lazy loading failed for package 'gplots'
> 
>     Greg> because the gdata package is the last in the bundle to
>     Greg> be installed, so it is not yet present.
> 
>     Greg> So, what is the proper way to handle this?  Is there
>     Greg> some way to manually specify the package install order?
> 
> Well, isn't the order in the 'Contains:' field of the bundle
> DESCRIPTION file used?  

I believe so (but am in Slovenia).   We have ways to resolve dependencies 
for non-bundles (new in 2.0.0), but for bundles we assume the order given 
by the author(s) is the correct one.

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From jetaudio at cowon.com  Mon Sep 20 18:35:46 2004
From: jetaudio at cowon.com (jetAudio)
Date: Mon Sep 20 18:35:32 2004
Subject: [Rd] =?iso-8859-1?q?=BA=CE=C0=E7_=C1=DF_=C0=DA=B5=BF_=C8=B8=BD?=
	=?iso-8859-1?q?=C5=3A_Hi?=
Message-ID: <98633C251DD0C34FAE221E26A960444E31E9AA@ns.cowon.com>

Dear jetAudio lovers,

Thank you very much for your interests on jetAudio. We accept all jetAudio software related inquiries at jetaudio@jetaudio.com. Please forward your messages to jetaudio@jetaudio.com. Thanks again for being with us.

Cowon Systems

http://www.cowon.com

JetAudio, Inc.

http://www.jetaudio.com

	[[alternative HTML version deleted]]

From ripley at stats.ox.ac.uk  Mon Sep 20 18:49:06 2004
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon Sep 20 18:49:08 2004
Subject: [Rd] Namespace problem
In-Reply-To: <20040920090057.GB20279@stat.umu.se>
Message-ID: <Pine.LNX.4.44.0409201746200.11743-100000@gannet.stats>

Please try to load/attach your package before trying to check it -- you
will get more informative error messages from library(eha). The message is
almost certainly spurious, because your package is too badly broken to be
loaded.  We've seen quite a few examples in package testing, but have not 
yet managed to find a way to trap the more informative message.

On Mon, 20 Sep 2004, gb wrote:

> On Mon, Sep 20, 2004 at 10:43:44AM +0200, Martin Maechler wrote:
> > >>>>> "GB" == G?ran Brostr?m <gb@stat.umu.se>
> > >>>>>     on Sun, 19 Sep 2004 18:51:49 +0200 writes:
> 
> [...]
> 
> >     GB> I've checked that section, but I am not adding methods to generics, 
> > 
> > sure? 
> > Aren't you trying to export  mlreg.fit
> > which looks like a 'fit' S3 method for the 'mlreg' generic?
> 
> But it isn't. I just have found '.' to be a convenient separator in
> variable names, since '_' (my C favourite) wasn't available. So what you
> are suggesting is that I have to change all the variable names with dots in
> them. Or add 'S3metod(...' for each of them. I guess that the former is
> preferable.  
> 
> But how is this problem connected to using C/Fortran code?
> 
> G?ran
> 

-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From wolski at molgen.mpg.de  Mon Sep 20 18:49:47 2004
From: wolski at molgen.mpg.de (Wolski)
Date: Mon Sep 20 18:49:51 2004
Subject: [Rd] specifying _no_ class in setClass representation.
Message-ID: <200409201849470333.021C7313@mail.math.fu-berlin.de>

Hi,

Is it possible to have a slot to which any arbitrary class can be assigned?

/E

Dipl. bio-chem. Witold Eryk Wolski             @         MPI-Moleculare Genetic   
Ihnestrasse 63-73 14195 Berlin                'v'    
tel: 0049-30-83875219                        /   \       
mail: witek96@users.sourceforge.net        ---W-W----    http://www.molgen.mpg.de/~wolski 
      wolski@molgen.mpg.de

From ripley at stats.ox.ac.uk  Mon Sep 20 18:55:12 2004
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon Sep 20 18:55:16 2004
Subject: [Rd] problem typcasting return of R_ExternalPtrAddr(SEXP s)
In-Reply-To: <1363993.1095696616305.JavaMail.root@wamui06.slb.atl.earthlink.net>
Message-ID: <Pine.LNX.4.44.0409201752470.11743-100000@gannet.stats>

It's a warning, and occurs several times in R itself.  I don't think it is 
fatal to live with it.

There exists systems on which function pointers are not simple pointers, 
but probably none of them run R -- and they do not support dynamic loading 
of packages' DLLs if they do.

On Mon, 20 Sep 2004 wsetzer@mindspring.com wrote:

> In the odesolve routine lsoda(), I allow the function (named func) that calculates the system of differential equations to be defined in a dll that has been dynamically loaded from the file named in dllname.  I use getNativeSymbolInfo(func, dllname)$address to get the address of the function  and pass it to a C function called via the .Call interface.  Inside that C function,  I use R_ExternalPtrAddr(deriv_func) to get the function pointer.  This requires typcasting the return value of R_ExternalPtrAddr from (void *) to (deriv_func *), defined in a typedef in call_lsoda().  
> 
> To be more explicit (I'm replacing irrelevant arguments with ellipses):
> In lsoda(...,func,dllname,...), func contains a string giving the name of a function which is defined in the dll whose name is contained in dllname.
> 
> inside lsoda() are lines like
> func <- getNativeSymbolInfo(symbol.C(func),PACKAGE=dllname)
> 
> .Call("call_lsoda",...,func)
>  
> inside call_lsoda.c are the lines:
> SEXP func;
> 
> typedef void deriv_func(long int *, double *,double *, double *);
> 
> derivs = (deriv_func *) R_ExternalPtrAddr(func);
> 
> 
> This all worked up to now, but now, (as Kurt Hornik kindly informs me) gcc 3.4 gives the warning:
> 
> warning: ISO C forbids conversion of object pointer to function pointer type
> 
> so I need to clean this up so odesolve will compile cleanly for version 2.0.0 of R.  I'm at a loss of what to do, though, since the return value of R_ExternalPtrAddr is (void *), and I need a function pointer.
> 
> I'd guess there would need to be a special function (say declared as 
> ( R_ExternalFnPtr(SEXP s) *)(), 
> or something like that), to make all this work, but I can't find such a function.   My C programming is pretty rusty, so I'm wondering if someone has an idea about how I can get around this problem (or perhaps I've misunderstood the meaning of the error message? )


-- 
Brian D. Ripley,                  ripley@stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From wolski at molgen.mpg.de  Mon Sep 20 19:20:46 2004
From: wolski at molgen.mpg.de (Wolski)
Date: Mon Sep 20 19:20:50 2004
Subject: [Rd] Assignment of a derived instance to the parent container.
 S3/S4 differences
Message-ID: <200409201920460875.0239109A@mail.math.fu-berlin.de>

Hi,

Is it intended to support assignment of a derived instance (S3) to a parent container (S4)?

setClass("any")
setClass("myclass",representation(x="any",y="any")) # I define parent containers x,y

#I have an S3 object.
xx<-3
class(x)

#instantiate a new object of class myclass
tt<-new("myclass")
tt@x<-xx   #not allowed as expected.

# I want to assign xx anyway.  This should be possible if xx inherits class "any".  This can be easily achieved by ?class.
class(xx)<-c(class(xx),"any")
class(xx) #now it is of class "any"

tt@x <- xx #but it still can not be assigned to the parent container.


#The same works for 'pure' S4 classes.
setClass("Numeric",contains="any")
xx<-new("Numeric")
is(xx)


tt@x<-xx #works.

Is it intended to support S3 class inheritance within S4? It would be great because most of the objects in R are still S3.

Yours 
/E

From gb at stat.umu.se  Mon Sep 20 20:55:41 2004
From: gb at stat.umu.se (gb)
Date: Mon Sep 20 20:55:44 2004
Subject: [Rd] [Old '.so' file
Message-ID: <20040920185541.GB20668@stat.umu.se>

I noticed the same thing as I reported below, when I upgraded from
R-2.0.0-alpha-20040918 to today's beta version: 

'R CMD check' failed as before; but after cleaning 'src' from .o and .so
files, it worked again. So the two-day-old '.so' file is obviously different
from today's. Has compiler directives changed in the two last days? Or what
is happening? 

G?ran

On Mon, Sep 20, 2004 at 12:46:58PM +0200, gb wrote:
> On Mon, Sep 20, 2004 at 12:26:45PM +0200, Martin Maechler wrote:
> > >>>>> "GB" == G?ran Brostr?m <gb@stat.umu.se>
> > >>>>>     on Mon, 20 Sep 2004 11:00:57 +0200 writes:
> > 
> >     GB> On Mon, Sep 20, 2004 at 10:43:44AM +0200, Martin Maechler wrote:
> >     >> >>>>> "GB" == G?ran Brostr?m <gb@stat.umu.se>
> >     >> >>>>>     on Sun, 19 Sep 2004 18:51:49 +0200 writes:
> > 
> 
> > We do encourage not using "." for new function names because of
> > the reason above, but it's definitely not a requirement.
> > In the case where  'foo'  is an S3 generic function name,
> > we however recommend quite strongly not to use 
> >    'foo.bar'
> > as function name since it looks "too much" like an S3 method.
> > Is this the case for you?
> 
> No.
> 
> > 
> >     GB> But how is this problem connected to using C/Fortran code?
> > 
> > only via "namespace magic".
> 
> Yes, magic is the word: I got 'R CMD check' and NAMESPACE working by
> cleaning 'R' from '*.R~' files and 'src' from old '.o' files and an old
> 'eha.so' (from 1.x.x something)!  
> 
> Another thought: Since I really haven't used S3 methods so far, should I go
> for S4 methods directly?
> 
> G?ran
> -- 
>  G?ran Brostr?m                    tel: +46 90 786 5223
>  Department of Statistics          fax: +46 90 786 6614
>  Ume? University                   http://www.stat.umu.se/egna/gb/
>  SE-90187 Ume?, Sweden             e-mail: gb@stat.umu.se
> 
> ______________________________________________
> R-devel@stat.math.ethz.ch mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
 G?ran Brostr?m                    tel: +46 90 786 5223
 Department of Statistics          fax: +46 90 786 6614
 Ume? University                   http://www.stat.umu.se/egna/gb/
 SE-90187 Ume?, Sweden             e-mail: gb@stat.umu.se


----- End forwarded message -----

-- 
 G?ran Brostr?m                    tel: +46 90 786 5223
 Department of Statistics          fax: +46 90 786 6614
 Ume? University                   http://www.stat.umu.se/egna/gb/
 SE-90187 Ume?, Sweden             e-mail: gb@stat.umu.se

From gregory_r_warnes at groton.pfizer.com  Mon Sep 20 21:10:32 2004
From: gregory_r_warnes at groton.pfizer.com (Warnes, Gregory R)
Date: Mon Sep 20 21:10:52 2004
Subject: [Rd] R-2.0.0 Install problem for pkg bundle w inter-dependent
	namespaces
Message-ID: <D7A3CFD7825BD6119B880002A58F06C20C521C42@groexmb02.pfizer.com>



> -----Original Message-----
> From: Martin Maechler [mailto:maechler@stat.math.ethz.ch]
[...]
>     Greg> So, what is the proper way to handle this?  Is there
>     Greg> some way to manually specify the package install order?
> 
> Well, isn't the order in the 'Contains:' field of the bundle
> DESCRIPTION file used?  
> If not, please consider sending patches for  
> src/scripts/INSTALL.in
> 

OK, that's the simple thing that I had been overlooking. Changing the the
Contains line to provide the packages in the order that they should be
installed fixed the problem.

May I suggest that the significance of the ordering in the Contains: field
be added to the (extremely brief) description of in "Writing R Extensions"?

Perhaps change the text to:

	The 'Contains' field lists the packages, which should be contained
	in separate subdirectories with the names given.   During buiding 
	and installation, packages will be installed in the order specified.
	Be sure to order this list so that dependencies are appropriately
met.  

	The packages contained in a bundle are standard packages in all 
	respects except that the 'DESCRIPTION' file is replaced by a
'DESCRIPTION.in' 
	file which just contains fields additional to the 'DESCRIPTION' file

	of the bundle, for example 
	...

-Greg


LEGAL NOTICE\ Unless expressly stated otherwise, this messag...{{dropped}}

From gregory_r_warnes at groton.pfizer.com  Mon Sep 20 22:05:52 2004
From: gregory_r_warnes at groton.pfizer.com (Warnes, Gregory R)
Date: Mon Sep 20 22:06:15 2004
Subject: [Rd] "Namespace dependencies not required" message
Message-ID: <D7A3CFD7825BD6119B880002A58F06C20C521C44@groexmb02.pfizer.com>


I'm still working to add namespace support to some of my packages. I've
removed the 'Depends'  line from the DESCRIPTION file, and created an
appropriate NAMESPACE files.

Strangely, whenever I use 'importFrom(package, function)'  R CMD check
generates "Namespace dependencies not required" warnings .  Without the
import statements, the warning does not occur, but the code tests fail with
the expected object not found errors.  

This occurs with both R 1.9.1 and R 2.0.0.

So, should are these errors just bogus and I just ignore these errors, or is
there something I've done wrong with the NAMESPACE or elsewhere?

-Greg

Gregory R. Warnes
Manager, Non-Clinical Statistics
Pfizer Global Research and Development



LEGAL NOTICE\ Unless expressly stated otherwise, this messag...{{dropped}}

From sego at vt.edu  Mon Sep 20 22:07:11 2004
From: sego at vt.edu (sego@vt.edu)
Date: Mon Sep 20 22:07:16 2004
Subject: [Rd] problem with R CMD build (PR#7240)
Message-ID: <20040920200711.2D803110EE@slim.kubism.ku.dk>

Hello,

This may not be a bug--but I'm not sure.  I have R 1.91 installed on a 
machine that's running Windows XP.  In Cygwin, when I attempt to use the 
"build" command it tells me that TMPDIR is set to an invalid directory. 
See the results below:

stat20:/cygdrive/d/dirk/bands/implementation -> which r
/cygdrive/d/Programs/R/rw1091/bin/r

stat20:/cygdrive/d/dirk/bands/implementation -> r CMD build --help
Please set TMPDIR to a valid temporary directory

stat20:/cygdrive/d/dirk/bands/implementation -> r CMD build validate
Please set TMPDIR to a valid temporary directory

stat20:/cygdrive/d/dirk/bands/implementation -> echo $TMPDIR
TMPDIR: Undefined variable.

stat20:/cygdrive/d/dirk/bands/implementation -> echo $TMP
/cygdrive/c/DOCUME~1/sego/LOCALS~1/Temp

stat20:/cygdrive/d/dirk/bands/implementation -> echo $TEMP
/cygdrive/c/DOCUME~1/sego/LOCALS~1/Temp

What is TMPDIR?  How can I set it?

I've installed Perl as well as the extra binary files (make.exe, etc.) 
needed to build and install libraries under Windows (not that they're 
related to this problem...)

Any suggestions would be much appreciated.

Thanks,

Landon Sego
_________________________________________

Landon Sego
Department of Statistics
Virginia Tech
414 Hutcheson
(540) 231-2144

From gb at stat.umu.se  Mon Sep 20 22:28:08 2004
From: gb at stat.umu.se (gb)
Date: Mon Sep 20 22:28:11 2004
Subject: [Rd] "Namespace dependencies not required" message
In-Reply-To: <D7A3CFD7825BD6119B880002A58F06C20C521C44@groexmb02.pfizer.com>
References: <D7A3CFD7825BD6119B880002A58F06C20C521C44@groexmb02.pfizer.com>
Message-ID: <20040920202808.GA24025@stat.umu.se>

On Mon, Sep 20, 2004 at 04:05:52PM -0400, Warnes, Gregory R wrote:
> 
> I'm still working to add namespace support to some of my packages. I've
> removed the 'Depends'  line from the DESCRIPTION file, and created an
> appropriate NAMESPACE files.
> 
> Strangely, whenever I use 'importFrom(package, function)'  R CMD check
> generates "Namespace dependencies not required" warnings .  Without the
> import statements, the warning does not occur, but the code tests fail with
> the expected object not found errors.  
> 
> This occurs with both R 1.9.1 and R 2.0.0.
> 
> So, should are these errors just bogus and I just ignore these errors, or is
> there something I've done wrong with the NAMESPACE or elsewhere?

I had the same problem. I think you must keep the 'Depends' field in
DESCRIPTION file.

G?ran 

> 
> -Greg
> 
> Gregory R. Warnes
> Manager, Non-Clinical Statistics
> Pfizer Global Research and Development
> 
> 
> 
> LEGAL NOTICE\ Unless expressly stated otherwise, this messag...{{dropped}}
> 
> ______________________________________________
> R-devel@stat.math.ethz.ch mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
 G?ran Brostr?m                    tel: +46 90 786 5223
 Department of Statistics          fax: +46 90 786 6614
 Ume? University                   http://www.stat.umu.se/egna/gb/
 SE-90187 Ume?, Sweden             e-mail: gb@stat.umu.se

From sego at vt.edu  Mon Sep 20 22:36:22 2004
From: sego at vt.edu (sego@vt.edu)
Date: Mon Sep 20 22:36:26 2004
Subject: [Rd] RE: problem with R CMD build--FIXED (PR#7241)
Message-ID: <20040920203622.805BC110E0@slim.kubism.ku.dk>

> I'm puzzled. One thing I'd try would be to get Cygwin out of the picture,
> at least for a moment. Try to set TMPDIR (and maybe TMP and TEMP) to
> C:\Temp,
> and try to run the whole thing from a "DOS" Cmd.exe window.

Here it is:

D:\dirk\bands\implementation>set TMPDIR=d:\tmp

D:\dirk\bands\implementation>echo %TMPDIR%
d:\tmp

D:\dirk\bands\implementation>r CMD BUILD --help
Usage: R CMD BUILD [options] pkgdirs

Build R packages from package sources in the directories specified by
pkgdirs.

Options:
   -h, --help            print short help message and exit
   -v, --version         print version info and exit

   --force               force overwriting of INDEX file
   --no-vignettes        do not rebuild package vignettes

   --binary              build pre-compiled binary packages, with options:
   --docs=TYPE           type(s) of documentation to build and install
   --auto-zip            select zipping of data and help based on size
   --use-zip-data        collect data files in zip archive
   --use-zip-help        collect help and examples into zip archives
   --use-zip             combine '--use-zip-data' and '--use-zip-help'

Email bug reports to <r-bugs@r-project.org>.


So that works.  I then right-clicked on "My Computer", then clicked on 
"Properties", "Advanced", "Environment Variables" and then set new 
variable called "TMPDIR".

Having done that, "r CMD build"  works in Cygwin too.

I wonder why I never saw this before with the previous machine?  Well it 
looks like this one is fixed.

Landon

_________________________________________

Landon Sego
Department of Statistics
Virginia Tech
414 Hutcheson
(540) 231-2144

From p.dalgaard at biostat.ku.dk  Mon Sep 20 22:47:09 2004
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Mon Sep 20 22:48:27 2004
Subject: [Rd] problem with R CMD build (PR#7240)
In-Reply-To: <20040920200711.2D803110EE@slim.kubism.ku.dk>
References: <20040920200711.2D803110EE@slim.kubism.ku.dk>
Message-ID: <x2fz5cis6q.fsf@biostat.ku.dk>

sego@vt.edu writes:

> Hello,
> 
> This may not be a bug--but I'm not sure.

In that case you should not submit a bug report. Someone will have to
clean up after you.

> I have R 1.91 installed on a 
> machine that's running Windows XP.  

And the current year is approx. 2045... (1.9.1 is the current version)

> In Cygwin, when I attempt to use the 
> "build" command it tells me that TMPDIR is set to an invalid directory. 
> See the results below:

It is saying that TMPDIR is not set to a valid directory, which is not
quite the same thing. It would appear that it is not set at all.

> stat20:/cygdrive/d/dirk/bands/implementation -> which r
> /cygdrive/d/Programs/R/rw1091/bin/r
> 
> stat20:/cygdrive/d/dirk/bands/implementation -> r CMD build --help
> Please set TMPDIR to a valid temporary directory
> 
> stat20:/cygdrive/d/dirk/bands/implementation -> r CMD build validate
> Please set TMPDIR to a valid temporary directory
> 
> stat20:/cygdrive/d/dirk/bands/implementation -> echo $TMPDIR
> TMPDIR: Undefined variable.
> 
> stat20:/cygdrive/d/dirk/bands/implementation -> echo $TMP
> /cygdrive/c/DOCUME~1/sego/LOCALS~1/Temp
> 
> stat20:/cygdrive/d/dirk/bands/implementation -> echo $TEMP
> /cygdrive/c/DOCUME~1/sego/LOCALS~1/Temp
> 
> What is TMPDIR?  How can I set it?

A temporary directory. "export TMPDIR=$TMP" would be a guess if you're
using bash. Otherwise, however you normally set environment variables.
Did you read the INSTALL and README.packages files? In particular
there seems to be a couple of gotchas involved when running under
Cygwin. 

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

From sego at vt.edu  Mon Sep 20 23:37:54 2004
From: sego at vt.edu (sego@vt.edu)
Date: Mon Sep 20 23:37:57 2004
Subject: [Rd] problem with R CMD build (PR#7240)
Message-ID: <20040920213754.50D73110E0@slim.kubism.ku.dk>

My apologies for CC'ing to r-bugs@r-project.org.  No doubt it created 
extra work for someone.

With regard to this problem:

stat20:/cygdrive/d/dirk/bands/implementation -> r CMD build --help
Please set TMPDIR to a valid temporary directory

I fixed it by setting a variable TMPDIR in Windows (right-clicked on "My 
Computer", then clicked on "Properties", "Advanced", "Environment 
Variables" and then set new variable called "TMPDIR".)

Having done that, "r CMD build"  works in Cygwin.

_________________________________________

Landon Sego
Department of Statistics
Virginia Tech
414 Hutcheson
(540) 231-2144

From Mark.Bravington at csiro.au  Tue Sep 21 08:10:08 2004
From: Mark.Bravington at csiro.au (Mark.Bravington@csiro.au)
Date: Tue Sep 21 08:10:25 2004
Subject: [Rd] checking for _non-existing_ -> documentation and sources at
	one place.
Message-ID: <C4178DC99E08604EA5E2BDB989F093800240A35F@extas2-hba.tas.csiro.au>

Wolski wrote:

#>>>Has anyone a tool which is able to generate from 
#>>>#appropriately commented R-code files (e.g. <<example>>= 
#>>>#-example section) Rd files:

Mark Bravington mentioned something similar in the 'mvbutils' package:

Wolski wrote:

#
#
#Hi!
#
#Is it working with S4?

Mark's reply:

Don't know whether it works with S4 methods-- they're something I'm strongly hoping to avoid ;) However, I guess they have to start life as functions, and then get "methodized" via 'setClass' or whatever. Presumably my system would work on the original functions.

#  If I understand it right you have to keep each function in an separate file?

I don't actually keep function source code in files-- I rely on .Rdata files and the 'source' attribute of functions. My system also sets up another 'doc' attribute which contains the documentation. When the function is being sent to / read from a text editor (I have a function 'fixr' for that, but people could write their own), the 'doc' and 'source' attributes are combined into the one file so that you edit both together. Files only get used (i) for linking with a text editor, and (ii) as part of the automatic text backup system that's built-in to my utilities (I put quotes around "file" in my original post to avoid having to explain all this...)

For example, if I type 'library( debug); fixr( get.retval)' then in the text editor I see this:

structure( function() do.in.envir( envir=sys.frame( find.active.control.frame()), 
 j
)
,doc=flatdoc( EOF="<<end of doc>>"))
get.retval      package:debug

Show current return value when debugging

DESCRIPTION

When debugging a function, 'get.retval' gives the current return value, i.e. the result of the most recent valid statement executed in the function body, whether typed or in the original code, and excluding calls to 'go' etc.. Presumably only relevant when in exit code.


USAGE

get.retval()

...and the rest of the documentation...
<<end of doc>>

#Has nobody a perl-script that parseres the R files to generate 
#Rd files? Would someone be interested in something similar. If 
#so let me know please.

My 'doc2Rd' function pretty much does that, provided you follow simple rules when writing the "informal" documentation. It works directly from the 'doc' attribute though.

Obviously I have tweaked the 'mvbutils' to match the way I work, and so it might not suit everybody; but now that I've gone through the pain barrier of actually writing the stuff, I do find it makes package preparation and maintenance vastly easy.

Hope this helps

Mark



#
#What I am looking for is something what would resembles more 
#something like this:
#
#
#setClass("test",                                   #The test 
#data storage class.                               <-from this 
#the title section is generated automatically. 
#	representation(
#	size="numeric"                     # list size          
#                           <-section slots is generated automatically.
#	bla="list"                              # stores 
#content                            <-goes to section slots
#	##description : Stores test results....                 
#                                              <- goes to the 
#description section.
#	##example: x <- 
#new("test",size=1000,bla=vector("list",1000))                  
#          <-goes to the example section of the Rd file.
#	))
#
#setMethod("unlist" # unlists a list.
#	,signature(x="test"  #+                  <-the #+ sign 
#indicates that the docu of this function should be integrated 
#in the docu file of the class "test" above. If non in a speparate file.
#	
#	)
#	def=function(x,...)
#	{
#		.....	
#	}
#	#example: unlist(x)                       <- because as 
#indicated by the "+" above it is appendended to the example 
#section of the test-Class.Rd file.
#	)
#
#setMethod("unlist" # unlists a list.
#	,signature(x="test"                 # an object of 
#class test        <- no plus means it goes to a own 
#unlist-methods.Rd file and the comment goes to the argument section.
#               )                     
#	def=function(x,...)
#	{
#	##Description : function does this and that.
#	## further description...
#		....
#	}
#
#	##example : data(x)
#	## unlist(x)                      
#	)
#
#
#And then to have a tool eg something working like R CMD makeRd 
#(perl script)... which genreates Rd files out of it..
#Has nobody a perl-script that parseres the R files to generate 
#Rd files? Would someone be interested in something similar. If 
#so let me know please.
#
#
#/E
#
#
#
#*********** REPLY SEPARATOR  ***********
#
#On 9/17/2004 at 9:07 AM Mark.Bravington@csiro.au wrote:
#
#>>>Wolski wrote:
#>>> 
#>>>#I knew about prompt and promptMethods promptClass. They are 
#>>>#extremely useful if you are starting to write a package. But 
#>>>#what with existing packages that have to be rewritten?
#>>>#
#>>>#Having code and documentation in one place would be a great 
#>>>#help. Has anyone a tool which is able to generate from 
#>>>#appropriately commented R-code files (e.g. <<example>>= 
#>>>#-example section) Rd files:
#>>>#e.g. a noweb lit-prog file or patched version of Doxygen?
#>>>#
#>>>
#>>>Yes, there is such a tool-- or something close to it, anyway. My
#>>>'mvbutils' package lets you keep documentation in the same 
#source "file"
#>>>as the the function definition, appended at the end. 
#Usually, when I am
#>>>developing a function I start by writing informal 
#documentation (which
#>>>still displays with "?" but isn't an Rd file). Eventually I 
#convert the
#>>>documentation into a plain-text format close to the pager 
#representation
#>>>of R help files; this format can be converted into a .Rd 
#file using my
#>>>'doc2Rd' function. Once I am close to having a whole 
#package ready, I
#>>>use the 'formalize.package' function to set up the a whole 
#package; it
#>>>creates the skeleton and the .R source file, and all the 
#.Rd files via
#>>>'doc2Rd', ready for RCMD.
#>>>
#>>>For more details, have a look at README.mvbutils()
#>>>
#>>>Hope this helps
#>>>
#>>>Mark
#>>>
#>>>*******************************
#>>>
#>>>Mark Bravington
#>>>CSIRO (CMIS)
#>>>PO Box 1538
#>>>Castray Esplanade
#>>>Hobart
#>>>TAS 7001
#>>>
#>>>phone (61) 3 6232 5118
#>>>fax (61) 3 6232 5012
#>>>Mark.Bravington@csiro.au
#
#
#
#Dipl. bio-chem. Witold Eryk Wolski             @         
#MPI-Moleculare Genetic   
#Ihnestrasse 63-73 14195 Berlin                'v'    
#tel: 0049-30-83875219                        /   \       
#mail: witek96@users.sourceforge.net        ---W-W----    
http://www.molgen.mpg.de/~wolski 
      wolski@molgen.mpg.de

From maechler at stat.math.ethz.ch  Tue Sep 21 08:58:16 2004
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Tue Sep 21 08:58:17 2004
Subject: [Rd] R-2.0.0 Install problem for pkg bundle w inter-dependent
	namespaces
In-Reply-To: <D7A3CFD7825BD6119B880002A58F06C20C521C42@groexmb02.pfizer.com>
References: <D7A3CFD7825BD6119B880002A58F06C20C521C42@groexmb02.pfizer.com>
Message-ID: <16719.53512.90991.731709@gargle.gargle.HOWL>

>>>>> "Greg" == Warnes, Gregory R <gregory_r_warnes@groton.pfizer.com>
>>>>>     on Mon, 20 Sep 2004 15:10:32 -0400 writes:

    >> -----Original Message----- From: Martin Maechler
    >> [mailto:maechler@stat.math.ethz.ch]
    Greg> [...]  So, what is the proper way to handle this?  Is
    Greg> there some way to manually specify the package install
    Greg> order?
    >>  Well, isn't the order in the 'Contains:' field of the
    >> bundle DESCRIPTION file used?  If not, please consider
    >> sending patches for src/scripts/INSTALL.in
    >> 

    Greg> OK, that's the simple thing that I had been
    Greg> overlooking. Changing the the Contains line to provide
    Greg> the packages in the order that they should be
    Greg> installed fixed the problem.

    Greg> May I suggest that the significance of the ordering in
    Greg> the Contains: field be added to the (extremely brief)
    Greg> description of in "Writing R Extensions"?

    Greg> Perhaps change the text to:

    Greg> 	The 'Contains' field lists the packages, which
    Greg> should be contained in separate subdirectories with
    Greg> the names given.  During buiding and installation,
    Greg> packages will be installed in the order specified.  Be
    Greg> sure to order this list so that dependencies are
    Greg> appropriately met.

    Greg> 	The packages contained in a bundle are standard
    Greg> packages in all respects except that the 'DESCRIPTION'
    Greg> file is replaced by a 'DESCRIPTION.in' file which just
    Greg> contains fields additional to the 'DESCRIPTION' file
    Greg> of the bundle, for example ...

Good idea, thank you!
I just committed this (with a typo corrected).

Martin

From maechler at stat.math.ethz.ch  Tue Sep 21 09:03:14 2004
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Tue Sep 21 09:03:16 2004
Subject: [Rd] "Namespace dependencies not required" message
In-Reply-To: <20040920202808.GA24025@stat.umu.se>
References: <D7A3CFD7825BD6119B880002A58F06C20C521C44@groexmb02.pfizer.com>
	<20040920202808.GA24025@stat.umu.se>
Message-ID: <16719.53810.537414.318805@gargle.gargle.HOWL>

>>>>> "GB" == G?ran Brostr?m <gb@stat.umu.se>
>>>>>     on Mon, 20 Sep 2004 22:28:08 +0200 writes:

    GB> On Mon, Sep 20, 2004 at 04:05:52PM -0400, Warnes,
    GB> Gregory R wrote:
    >>  I'm still working to add namespace support to some of my
    >> packages. I've removed the 'Depends' line from the
    >> DESCRIPTION file, and created an appropriate NAMESPACE
    >> files.
    >> 
    >> Strangely, whenever I use 'importFrom(package, function)'
    >> R CMD check generates "Namespace dependencies not
    >> required" warnings .  Without the import statements, the
    >> warning does not occur, but the code tests fail with the
    >> expected object not found errors.
    >> 
    >> This occurs with both R 1.9.1 and R 2.0.0.
    >> 
    >> So, should are these errors just bogus and I just ignore
    >> these errors, or is there something I've done wrong with
    >> the NAMESPACE or elsewhere?

    GB> I had the same problem. I think you must keep the
    GB> 'Depends' field in DESCRIPTION file.

yes, definitely.

And since you are (rightly, thank you!) working with 2.0.0-beta,
please consider
   http://developer.r-project.org/200update.txt

which mentions more things on 'Depends:', 'Suggests:' etc.
Also, don't forget to use 'Writing R Extensions' of 2.0.0.

Martin

From gregory_r_warnes at groton.pfizer.com  Tue Sep 21 15:59:17 2004
From: gregory_r_warnes at groton.pfizer.com (Warnes, Gregory R)
Date: Tue Sep 21 15:59:28 2004
Subject: [Rd] "Namespace dependencies not required" message
Message-ID: <D7A3CFD7825BD6119B880002A58F06C20C521C48@groexmb02.pfizer.com>


> -----Original Message-----
> From: r-devel-bounces@stat.math.ethz.ch
> [mailto:r-devel-bounces@stat.math.ethz.ch]On Behalf Of Martin Maechler
> Sent: Tuesday, September 21, 2004 3:03 AM
> To: r-devel@stat.math.ethz.ch
> Subject: Re: [Rd] "Namespace dependencies not required" message
> 
> 
> >>>>> "GB" == G?ran Brostr?m <gb@stat.umu.se>
> >>>>>     on Mon, 20 Sep 2004 22:28:08 +0200 writes:
> 
[...]
>     GB> I had the same problem. I think you must keep the
>     GB> 'Depends' field in DESCRIPTION file.
> 
> yes, definitely.
> 
> And since you are (rightly, thank you!) working with 2.0.0-beta,
> please consider
>    http://developer.r-project.org/200update.txt
> 
> which mentions more things on 'Depends:', 'Suggests:' etc.
> Also, don't forget to use 'Writing R Extensions' of 2.0.0.

For some reason, I got the impression that the import directives in the
NAMESPACE file _replaced_ the 'Depends:' line, rather than _augmenting_ it.
It seems that G?ran had the same problem.  

May I suggest two changes:  First, a more informative error message would be
very helpful.  Perhaps replacing 
	"Namespace dependencies not required" 
which doesn't really state the nature of the problem with 
	"NAMESPACE imports package(s) not listed package dependencies".  
Second, it would help to add a paragraph noting that all of the packages
'import'ed must also be listed in the package 'Depends:' field to section
1.6 of the R Extensions document.   [I would suggest verbage, but I've gotta
go to an appointment now..]

-Greg




LEGAL NOTICE\ Unless expressly stated otherwise, this messag...{{dropped}}

From spam.admin at benetton.it  Tue Sep 21 17:08:31 2004
From: spam.admin at benetton.it (benetton.it PostMaster)
Date: Tue Sep 21 17:08:56 2004
Subject: [Rd] Error sending message [1095779314503.2808.as-dmz11] from
	[benetton.it]
Message-ID: <200409211508.i8LF8pv9023073@hypatia.math.ethz.ch>

[<00>] XMail bounce: Rcpt=[4@benetton.it];Error=[550 4@benetton.it... No such user]


[<01>] Error sending message [1095779314503.2808.as-dmz11] from [benetton.it].

ID:        <LE4B08>
Mail From: <r-devel@lists.r-project.org>
Rcpt To:   <4@benetton.it>
Server:    <maila.benetton.org> [10.47.0.63]


[<02>] The reason of the delivery failure was:

550 4@benetton.it... No such user


[<05>] Here is listed the initial part of the message:

Received: from /spool/local
	by benetton.it with [XMail 1.17mod3 (Win32/Ix86) LMAIL Server]
	for <4@benetton.it> from <r-devel@lists.r-project.org>;
	Tue, 21 Sep 2004 17:08:30 +0200
Received: from benetton.it (80.180.112.111)
	by benetton.it with [XMail 1.17mod3 (Win32/Ix86) ESMTP Server];
	Tue, 21 Sep 2004 17:08:17 +0200
From: r-devel@lists.r-project.org
To: 4@benetton.it
Subject: Spamed?
Date: Tue, 21 Sep 2004 17:12:37 +0200
MIME-Version: 1.0
Content-Type: multipart/mixed;
	boundary="----=_NextPart_000_0016----=_NextPart_000_0016"
X-Priority: 3
X-MSMail-Priority: Normal

From MSchwartz at MedAnalytics.com  Wed Sep 22 01:32:51 2004
From: MSchwartz at MedAnalytics.com (Marc Schwartz)
Date: Wed Sep 22 01:32:57 2004
Subject: [Rd] Compile error in 2004-09-21 R 1.9.1 Patched
Message-ID: <1095809571.22731.21.camel@localhost.localdomain>

Hi all,

I just downloaded the latest R-patched tarball [Version 1.9.1 Patched
(2004-09-21)] and ran into an error during compilation. This is on FC2
and the error is as follows:

dounzip.c: In function `do_unzip':
dounzip.c:144: error: syntax error before '/' token
make[3]: *** [dounzip.o] Error 1

In reviewing the source file, there appears to be an errant '/' on line
144. A code snippet follows. Note the '/' on the third line below, just
before the closing brace:

#endif
	}
 /  } else {
	for (i = 0; i < nfiles; i++) {


Removal of the character enables successful compilation.

I reviewed the tarballs for the past few days and this appears to be new
as of today.

I also checked today's 2.0.0 beta tarball and the errant character is
not present in that version.

Best regards,

Marc Schwartz

From MSchwartz at MedAnalytics.com  Wed Sep 22 04:50:31 2004
From: MSchwartz at MedAnalytics.com (Marc Schwartz)
Date: Wed Sep 22 04:50:36 2004
Subject: [Rd] Re: Compile error in 2004-09-21 R 1.9.1 Patched
In-Reply-To: <1095809571.22731.21.camel@localhost.localdomain>
References: <1095809571.22731.21.camel@localhost.localdomain>
Message-ID: <1095821431.22731.28.camel@localhost.localdomain>

On Tue, 2004-09-21 at 18:32, Marc Schwartz wrote:
> Hi all,
> 
> I just downloaded the latest R-patched tarball [Version 1.9.1 Patched
> (2004-09-21)] and ran into an error during compilation. This is on FC2
> and the error is as follows:
> 
> dounzip.c: In function `do_unzip':
> dounzip.c:144: error: syntax error before '/' token
> make[3]: *** [dounzip.o] Error 1
> 
> In reviewing the source file, there appears to be an errant '/' on line
> 144. A code snippet follows. Note the '/' on the third line below, just
> before the closing brace:
> 
> #endif
> 	}
>  /  } else {
> 	for (i = 0; i < nfiles; i++) {
> 
> 
> Removal of the character enables successful compilation.
> 
> I reviewed the tarballs for the past few days and this appears to be new
> as of today.
> 
> I also checked today's 2.0.0 beta tarball and the errant character is
> not present in that version.


Just a quick follow up to confirm that, perhaps not surprisingly, the
same error persists in the 2004-09-22 1.9.1 R-patched tarball.

Marc

From lecoutre at stat.ucl.ac.be  Wed Sep 22 10:21:48 2004
From: lecoutre at stat.ucl.ac.be (Eric Lecoutre)
Date: Wed Sep 22 10:25:34 2004
Subject: [Rd] S4 methods and polymorophism
Message-ID: <6.0.1.1.2.20040922095129.02d97608@stat4ux.stat.ucl.ac.be>


Hello R Power Users,

There is a rather large introduction you may skip to go directly to 
my  question about S4 classes.

I am working on some toy code to help me get in through S4 classes.
Doing this homework, I have some questions about S4 classes. I have 
carefully read available help and some additional material such as Robert 
Gentleman's slides and special attention to "Programming with Data".

I am working with R 1.9 on Windows.

Final goal is the complete rewriting of my R2HTML package from scratch to 
provide to users a convenient way to describe their output and to allow 
different output format (provided by special functions - drivers, "? la" 
Sweave - HTML, LaTeX, XML...).

As BillGates guys often have good ideas (or find or buy them), I take the 
structure of Word documents as a starting point.

A document will be a collection of Objects, which will be either a standard 
R object or a graph, in both cases with some Formatting Options (FO) added. 
Formatting Options (a class) is a list of named components like (font-size: 
16, forecolor: darkred).

Here is what I have for the moment:

 > setClassUnion("ROMA_ID", c("NULL","character"))
 > setClass("Objects",representation("list",ID="ROMA_ID"))

ie: Objects is a list (there will be objects of class "Object" without "s") 
and ID provided to all objects.

Then, as I will manipulate several such collections, such as Documents, 
Graphs, and so on, I define the virtual class Collection. At the moment:

 > setClassUnion("Collection",c("Objects","Documents","Graphs"))

Then, I follow Chambers's samples to add some functionality such as show() 
functions and manipulations. A "+" method applied on two "Object" creates a 
new Objects collection.

As you can see from this output, both the definition of the mehod for "+" 
and for "show" are correct:


---------- output ---------------
 > Object(1)+Object("Oui")
<ROMA> Collection of Objects: 2 objects.

ID:  numeric
         <ROMA> Object
         Classe: numeric
         FO:  alignment

ID:  character
         <ROMA> Object
         Classe: character
         FO:  font;fontsize;fontcolor;alignment
---------- output ---------------



I have succedded adding a method to generic "+" operator, which is 
initially defined as:

 > getMethod("+")
.Primitive("+")

As I understand it, the fact that it is a .Primitive call ensures the 
default method for any extendion (that is: we can add methods).

Now, I try to add a method for length to handle "Collection" classes.

 > getMethod("length")
.Primitive("length")


*** QUESTION:


I dont undertand the following error message when trying to define this method:

 > setMethod("length","Collection",function(object){ length(object@ID)})
Error in conformMethod(signature, mnames, fnames, f) :
         In method for function "length": Formal arguments omitted in the 
method definition cannot be in the signature (x = "Collection")

How is it possible to extend length to my own class?



Be HappyR and HappyR again,

Eric

Eric Lecoutre
UCL /  Institut de Statistique
Voie du Roman Pays, 20
1348 Louvain-la-Neuve
Belgium

tel: (+32)(0)10473050
lecoutre@stat.ucl.ac.be
http://www.stat.ucl.ac.be/ISpersonnel/lecoutre

If the statistics are boring, then you've got the wrong numbers. -Edward 
Tufte

From wolski at molgen.mpg.de  Wed Sep 22 10:37:25 2004
From: wolski at molgen.mpg.de (Wolski)
Date: Wed Sep 22 10:37:32 2004
Subject: [Rd] S4 methods and polymorophism
In-Reply-To: <6.0.1.1.2.20040922095129.02d97608@stat4ux.stat.ucl.ac.be>
References: <6.0.1.1.2.20040922095129.02d97608@stat4ux.stat.ucl.ac.be>
Message-ID: <200409221037250788.0078AC6D@mail.math.fu-berlin.de>

Hi!
Have you tried ?

setMethod("length",signature(object="Collection"),function(object){ length(object@ID)})
                            ???????????
And I would use R.2.0 instead of R.1.9

/E


*********** REPLY SEPARATOR  ***********

On 9/22/2004 at 10:21 AM Eric Lecoutre wrote:

>>>Hello R Power Users,
>>>
>>>There is a rather large introduction you may skip to go directly to 
>>>my  question about S4 classes.
>>>
>>>I am working on some toy code to help me get in through S4 classes.
>>>Doing this homework, I have some questions about S4 classes. I have 
>>>carefully read available help and some additional material such as
>>>Robert 
>>>Gentleman's slides and special attention to "Programming with Data".
>>>
>>>I am working with R 1.9 on Windows.
>>>
>>>Final goal is the complete rewriting of my R2HTML package from scratch
>>>to 
>>>provide to users a convenient way to describe their output and to allow 
>>>different output format (provided by special functions - drivers, "? la" 
>>>Sweave - HTML, LaTeX, XML...).
>>>
>>>As BillGates guys often have good ideas (or find or buy them), I take
>>>the 
>>>structure of Word documents as a starting point.
>>>
>>>A document will be a collection of Objects, which will be either a
>>>standard 
>>>R object or a graph, in both cases with some Formatting Options (FO)
>>>added. 
>>>Formatting Options (a class) is a list of named components like
>>>(font-size: 
>>>16, forecolor: darkred).
>>>
>>>Here is what I have for the moment:
>>>
>>> > setClassUnion("ROMA_ID", c("NULL","character"))
>>> > setClass("Objects",representation("list",ID="ROMA_ID"))
>>>
>>>ie: Objects is a list (there will be objects of class "Object" without
>>>"s") 
>>>and ID provided to all objects.
>>>
>>>Then, as I will manipulate several such collections, such as Documents, 
>>>Graphs, and so on, I define the virtual class Collection. At the moment:
>>>
>>> > setClassUnion("Collection",c("Objects","Documents","Graphs"))
>>>
>>>Then, I follow Chambers's samples to add some functionality such as
>>>show() 
>>>functions and manipulations. A "+" method applied on two "Object"
>>>creates a 
>>>new Objects collection.
>>>
>>>As you can see from this output, both the definition of the mehod for
>>>"+" 
>>>and for "show" are correct:
>>>
>>>
>>>---------- output ---------------
>>> > Object(1)+Object("Oui")
>>><ROMA> Collection of Objects: 2 objects.
>>>
>>>ID:  numeric
>>>         <ROMA> Object
>>>         Classe: numeric
>>>         FO:  alignment
>>>
>>>ID:  character
>>>         <ROMA> Object
>>>         Classe: character
>>>         FO:  font;fontsize;fontcolor;alignment
>>>---------- output ---------------
>>>
>>>
>>>
>>>I have succedded adding a method to generic "+" operator, which is 
>>>initially defined as:
>>>
>>> > getMethod("+")
>>>.Primitive("+")
>>>
>>>As I understand it, the fact that it is a .Primitive call ensures the 
>>>default method for any extendion (that is: we can add methods).
>>>
>>>Now, I try to add a method for length to handle "Collection" classes.
>>>
>>> > getMethod("length")
>>>.Primitive("length")
>>>
>>>
>>>*** QUESTION:
>>>
>>>
>>>I dont undertand the following error message when trying to define this
>>>method:
>>>
>>> > setMethod("length","Collection",function(object){ length(object@ID)})
>>>Error in conformMethod(signature, mnames, fnames, f) :
>>>         In method for function "length": Formal arguments omitted in
>>>the 
>>>method definition cannot be in the signature (x = "Collection")
>>>
>>>How is it possible to extend length to my own class?
>>>
>>>
>>>
>>>Be HappyR and HappyR again,
>>>
>>>Eric
>>>
>>>Eric Lecoutre
>>>UCL /  Institut de Statistique
>>>Voie du Roman Pays, 20
>>>1348 Louvain-la-Neuve
>>>Belgium
>>>
>>>tel: (+32)(0)10473050
>>>lecoutre@stat.ucl.ac.be
>>>http://www.stat.ucl.ac.be/ISpersonnel/lecoutre
>>>
>>>If the statistics are boring, then you've got the wrong numbers. -Edward 
>>>Tufte
>>>
>>>______________________________________________
>>>R-devel@stat.math.ethz.ch mailing list
>>>https://stat.ethz.ch/mailman/listinfo/r-devel



Dipl. bio-chem. Witold Eryk Wolski             @         MPI-Moleculare Genetic   
Ihnestrasse 63-73 14195 Berlin                'v'    
tel: 0049-30-83875219                        /   \       
mail: witek96@users.sourceforge.net        ---W-W----    http://www.molgen.mpg.de/~wolski 
      wolski@molgen.mpg.de

From Matthias.Kohl at uni-bayreuth.de  Wed Sep 22 10:52:03 2004
From: Matthias.Kohl at uni-bayreuth.de (Matthias.Kohl@uni-bayreuth.de)
Date: Wed Sep 22 10:52:08 2004
Subject: [Rd] S4 methods and polymorophism
In-Reply-To: <200409221037250788.0078AC6D@mail.math.fu-berlin.de>
References: <6.0.1.1.2.20040922095129.02d97608@stat4ux.stat.ucl.ac.be>
	<200409221037250788.0078AC6D@mail.math.fu-berlin.de>
Message-ID: <1124.132.180.246.60.1095843123.squirrel@mail.uni-bayreuth.de>

I think, it must be x instead of object?

setMethod("length", signature(x="Collection"), function(x) length(x@ID))

> Hi!
> Have you tried ?
>
> setMethod("length",signature(object="Collection"),function(object){
> length(object@ID)})
>                             ???????????
> And I would use R.2.0 instead of R.1.9
>
> /E
>
>
> *********** REPLY SEPARATOR  ***********
>
> On 9/22/2004 at 10:21 AM Eric Lecoutre wrote:
>
>>>>Hello R Power Users,
>>>>
>>>>There is a rather large introduction you may skip to go directly to
>>>> my  question about S4 classes.
>>>>
>>>>I am working on some toy code to help me get in through S4 classes.
>>>> Doing this homework, I have some questions about S4 classes. I have
>>>> carefully read available help and some additional material such as
>>>> Robert
>>>>Gentleman's slides and special attention to "Programming with Data".
>>>>
>>>>I am working with R 1.9 on Windows.
>>>>
>>>>Final goal is the complete rewriting of my R2HTML package from
>>>> scratch to
>>>>provide to users a convenient way to describe their output and to
>>>> allow  different output format (provided by special functions -
>>>> drivers, "? la"  Sweave - HTML, LaTeX, XML...).
>>>>
>>>>As BillGates guys often have good ideas (or find or buy them), I take
>>>> the
>>>>structure of Word documents as a starting point.
>>>>
>>>>A document will be a collection of Objects, which will be either a
>>>> standard
>>>>R object or a graph, in both cases with some Formatting Options (FO)
>>>> added.
>>>>Formatting Options (a class) is a list of named components like
>>>> (font-size:
>>>>16, forecolor: darkred).
>>>>
>>>>Here is what I have for the moment:
>>>>
>>>> > setClassUnion("ROMA_ID", c("NULL","character"))
>>>> > setClass("Objects",representation("list",ID="ROMA_ID"))
>>>>
>>>>ie: Objects is a list (there will be objects of class "Object"
>>>> without "s")
>>>>and ID provided to all objects.
>>>>
>>>>Then, as I will manipulate several such collections, such as
>>>> Documents,  Graphs, and so on, I define the virtual class Collection.
>>>> At the moment:
>>>>
>>>> > setClassUnion("Collection",c("Objects","Documents","Graphs"))
>>>>
>>>>Then, I follow Chambers's samples to add some functionality such as
>>>> show()
>>>>functions and manipulations. A "+" method applied on two "Object"
>>>> creates a
>>>>new Objects collection.
>>>>
>>>>As you can see from this output, both the definition of the mehod for
>>>> "+"
>>>>and for "show" are correct:
>>>>
>>>>
>>>>---------- output ---------------
>>>> > Object(1)+Object("Oui")
>>>><ROMA> Collection of Objects: 2 objects.
>>>>
>>>>ID:  numeric
>>>>         <ROMA> Object
>>>>         Classe: numeric
>>>>         FO:  alignment
>>>>
>>>>ID:  character
>>>>         <ROMA> Object
>>>>         Classe: character
>>>>         FO:  font;fontsize;fontcolor;alignment
>>>>---------- output ---------------
>>>>
>>>>
>>>>
>>>>I have succedded adding a method to generic "+" operator, which is
>>>> initially defined as:
>>>>
>>>> > getMethod("+")
>>>>.Primitive("+")
>>>>
>>>>As I understand it, the fact that it is a .Primitive call ensures the
>>>>  default method for any extendion (that is: we can add methods).
>>>>
>>>>Now, I try to add a method for length to handle "Collection" classes.
>>>>
>>>> > getMethod("length")
>>>>.Primitive("length")
>>>>
>>>>
>>>>*** QUESTION:
>>>>
>>>>
>>>>I dont undertand the following error message when trying to define
>>>> this method:
>>>>
>>>> > setMethod("length","Collection",function(object){
>>>> length(object@ID)})
>>>>Error in conformMethod(signature, mnames, fnames, f) :
>>>>         In method for function "length": Formal arguments omitted in
>>>>the
>>>>method definition cannot be in the signature (x = "Collection")
>>>>
>>>>How is it possible to extend length to my own class?
>>>>
>>>>
>>>>
>>>>Be HappyR and HappyR again,
>>>>
>>>>Eric
>>>>
>>>>Eric Lecoutre
>>>>UCL /  Institut de Statistique
>>>>Voie du Roman Pays, 20
>>>>1348 Louvain-la-Neuve
>>>>Belgium
>>>>
>>>>tel: (+32)(0)10473050
>>>>lecoutre@stat.ucl.ac.be
>>>>http://www.stat.ucl.ac.be/ISpersonnel/lecoutre
>>>>
>>>>If the statistics are boring, then you've got the wrong numbers.
>>>> -Edward  Tufte
>>>>
>>>>______________________________________________
>>>>R-devel@stat.math.ethz.ch mailing list
>>>>https://stat.ethz.ch/mailman/listinfo/r-devel
>
>
>
> Dipl. bio-chem. Witold Eryk Wolski             @         MPI-Moleculare
> Genetic    Ihnestrasse 63-73 14195 Berlin                'v'
> tel: 0049-30-83875219                        /   \
> mail: witek96@users.sourceforge.net        ---W-W----
> http://www.molgen.mpg.de/~wolski
>       wolski@molgen.mpg.de
>
> ______________________________________________
> R-devel@stat.math.ethz.ch mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

From lecoutre at stat.ucl.ac.be  Wed Sep 22 11:20:09 2004
From: lecoutre at stat.ucl.ac.be (Eric Lecoutre)
Date: Wed Sep 22 11:23:53 2004
Subject: [Rd] S4 methods and polymorophism
In-Reply-To: <1124.132.180.246.60.1095843123.squirrel@mail.uni-bayreuth.
 de>
References: <6.0.1.1.2.20040922095129.02d97608@stat4ux.stat.ucl.ac.be>
	<200409221037250788.0078AC6D@mail.math.fu-berlin.de>
	<1124.132.180.246.60.1095843123.squirrel@mail.uni-bayreuth.de>
Message-ID: <6.0.1.1.2.20040922111519.02dc9ce0@stat4ux.stat.ucl.ac.be>



At 10:52 22/09/2004, Matthias.Kohl@uni-bayreuth.de wrote:
>I think, it must be x instead of object?
>
>setMethod("length", signature(x="Collection"), function(x) length(x@ID))

Hi,

This is right, this latest works - Thank you.

For "show" methods, I did understand I had to use "object" with

---
 > getGeneric("show")
standardGeneric for "show" defined from package "methods"

function (object)
standardGeneric("show")
<environment: 017E6D18>
Methods may be defined for arguments: object
---

I didn't have the same information for "length"... except in the help page 
of the function length which provides the list of its arguments, so that I 
should have found that myself.
Anyway, thank you very much: now at least I have understand that argument 
names must exactly match argument names of the generic and my knowledge of 
S4 classes is better.

Eric

From p.dalgaard at biostat.ku.dk  Wed Sep 22 11:43:46 2004
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Wed Sep 22 11:45:20 2004
Subject: [Rd] Re: Compile error in 2004-09-21 R 1.9.1 Patched
In-Reply-To: <1095821431.22731.28.camel@localhost.localdomain>
References: <1095809571.22731.21.camel@localhost.localdomain>
	<1095821431.22731.28.camel@localhost.localdomain>
Message-ID: <x24qlqfxkd.fsf@biostat.ku.dk>

Marc Schwartz <MSchwartz@medanalytics.com> writes:

> On Tue, 2004-09-21 at 18:32, Marc Schwartz wrote:
> > Hi all,
> > 
> > I just downloaded the latest R-patched tarball [Version 1.9.1 Patched
> > (2004-09-21)] and ran into an error during compilation. This is on FC2
> > and the error is as follows:

Those will be obsolete in about 12 days.... Maybe we should just let
it be a hint to people to try the 2.0.0 beta tarballs instead? ;-)

Jokes aside, this is not in the current SVN archive, and the file
has no log entries since 

>>
------------------------------------------------------------------------
r28973 | (no author) | 2004-04-12 14:11:32 +0200 (Mon, 12 Apr 2004) | 2 lines

This commit was manufactured by cvs2svn to create branch
'R-1-9-patches'.
<<

(I thought the conversion took place in July? Oh well, Schwamm
dar?ber...)

I suppose that the tarballs are not made from clean checkouts and
there was an accidental modification of the checked-out file. 

        -p

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

From murdoch at stats.uwo.ca  Wed Sep 22 12:39:27 2004
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Wed Sep 22 12:39:36 2004
Subject: [Rd] Re: Compile error in 2004-09-21 R 1.9.1 Patched
In-Reply-To: <x24qlqfxkd.fsf@biostat.ku.dk>
References: <1095809571.22731.21.camel@localhost.localdomain>
	<1095821431.22731.28.camel@localhost.localdomain>
	<x24qlqfxkd.fsf@biostat.ku.dk>
Message-ID: <ngl2l0l1hdcpd4ndv79dal0lknl9eb9k8d@4ax.com>

On 22 Sep 2004 11:43:46 +0200, Peter Dalgaard
<p.dalgaard@biostat.ku.dk> wrote:


>------------------------------------------------------------------------
>r28973 | (no author) | 2004-04-12 14:11:32 +0200 (Mon, 12 Apr 2004) | 2 lines
>
>This commit was manufactured by cvs2svn to create branch
>'R-1-9-patches'.
><<
>
>(I thought the conversion took place in July? Oh well, Schwamm
>dar?ber...)

cvs2svn tries to keep the original CVS dates when it does the
conversion.

Duncan Murdoch

From shaogang at gmail.com  Wed Sep 22 16:04:09 2004
From: shaogang at gmail.com (Shaogang Qu)
Date: Wed Sep 22 16:04:17 2004
Subject: [Rd] Re: R-devel Digest, Vol 19, Issue 20
In-Reply-To: <200409221026.i8MAQY8f010064@hypatia.math.ethz.ch>
References: <200409221026.i8MAQY8f010064@hypatia.math.ethz.ch>
Message-ID: <b064264704092207045d352e70@mail.gmail.com>

 I met several problems in using R, and I can not find the 
> exact answer after reading some r-docs and searching the web, maybe I 
> use them in a wrong way.
> 
> So, I hope you may offer me some guide on it if possible. The problems 
> are as follows:
> 
> 1           I see the example source for creating an R package, but indeed,
> the package submitted to CRAN is nod this simple, so I wonder how I 
> can create an R package like this.
> 
> 2           And when a package like this is generated, how can I do some
> modification? For example, add some new function into it or do some 
> modifications for certain function?
> 
> I try to do this on an existed package, but it does not work, the new 
> package can not be found.
> 
>          3       Could you offer me some e-documents for R apart from the
> R-help docs?
> 
>          4       Could you offer me some advise on R learning if I am only
> interested in R package management not R language programming now?
            5       I used the Tools to create a package in windows,
but it seems in the last step, zip command does not work? Is there any
good reference about the way creating a package using RGui?
> 
>          
> 
>  
> 
> Thanks a lot!!
> 
>  
> 
> Jimmy

From pburns at pburns.seanet.com  Wed Sep 22 19:30:10 2004
From: pburns at pburns.seanet.com (Patrick Burns)
Date: Wed Sep 22 19:30:18 2004
Subject: [Rd] attaching to position 1
Message-ID: <4151B6A2.7080103@pburns.seanet.com>

If an attempt is made to attach to position 1, it appears to work
(not even a warning) but in fact it doesn't work as many would
expect.  "search" thinks that it gets placed in position 2, but nothing
is actually there (according to "ls").

This is guaranteed to be confusing (and annoying) to people who
are used to attaching to position 1 in S-PLUS.

I'm not clear on all of the implications of changing this, but my
first inclination would be to make it an error to attach to position 1.
The help file says that you can't do it.

At the very least there should be a warning .  My guess is that it is
rare for someone to attach to position 1 and not attempt to modify
what is being attached.

 > attach('foo.RData')
 > search()
 [1] ".GlobalEnv"        "file:foo.RData"    "package:methods" 
 [4] "package:stats"     "package:graphics"  "package:grDevices"
 [7] "package:utils"     "package:datasets"  "Autoloads"       
[10] "package:base"    
 > ls(2)
[1] "jj"
 > jj
[1] 1 2 3 4 5 6 7 8 9
 > detach()
 > search()
[1] ".GlobalEnv"        "package:methods"   "package:stats"   
[4] "package:graphics"  "package:grDevices" "package:utils"   
[7] "package:datasets"  "Autoloads"         "package:base"    
 > attach('foo.RData', pos=1)
 > search()
 [1] ".GlobalEnv"        "file:foo.RData"    "package:methods" 
 [4] "package:stats"     "package:graphics"  "package:grDevices"
 [7] "package:utils"     "package:datasets"  "Autoloads"       
[10] "package:base"    
 > ls(2)
character(0)

         _                          
platform i386-pc-mingw32            
arch     i386                       
os       mingw32                    
system   i386, mingw32              
status   Under development (unstable)
major    2                          
minor    0.0                        
year     2004                       
month    09                         
day      17                         
language R 


Pat

From saurin_jani at yahoo.com  Wed Sep 22 22:11:35 2004
From: saurin_jani at yahoo.com (Saurin Jani)
Date: Wed Sep 22 22:11:42 2004
Subject: [Rd] Rgraphviz compilation error
Message-ID: <20040922201135.55579.qmail@web41121.mail.yahoo.com>

Hi,

I am installing Rgraphviz at Linux Fedora Core 2 with
32 bit AMD athlon with 512 RAM.

I have installed graphviz version:
graphviz-1.16-1.src.rpm installed already on system. 

I am doing: 

$ R CMD INSTALL  -l /usr/local/lib/R/library   
  Rgraphviz_1.4.0.tar.gz
---------------------------------
* Installing *source* package 'Rgraphviz' ...
** libs
gcc -I/usr/local/lib/R/include `dotneato-config
--cflags`  -I/usr/local/include -D__NO_MATH_INLINES
-mieee-fp -Wall -fPIC  -g -O2 -c Rgraphviz.c -o
Rgraphviz.o
In file included from
/usr/local/include/graphviz/render.h:45,
                 from common.h:21,
                 from Rgraphviz.c:1:
/usr/local/include/graphviz/macros.h:34:1: warning:
"NEW" redefined
In file included from common.h:13,
                 from Rgraphviz.c:1:
/usr/local/lib/R/include/Rdefines.h:129:1: warning:
this is the location of the previous definition
Rgraphviz.c: In function `Rgraphviz_agopen':
Rgraphviz.c:244: warning: implicit declaration of
function `GD_gvc'
Rgraphviz.c:244: error: invalid lvalue in assignment
make: *** [Rgraphviz.o] Error 1
ERROR: compilation failed for package 'Rgraphviz'
** Removing '/usr/local/lib/R/library/Rgraphviz'
--------------------

please let me know...if someone has same problem,

Thanks,
Saurin

From ligges at statistik.uni-dortmund.de  Thu Sep 23 08:11:50 2004
From: ligges at statistik.uni-dortmund.de (Uwe Ligges)
Date: Thu Sep 23 08:12:16 2004
Subject: [Rd] Re: R-devel Digest, Vol 19, Issue 20
In-Reply-To: <b064264704092207045d352e70@mail.gmail.com>
References: <200409221026.i8MAQY8f010064@hypatia.math.ethz.ch>
	<b064264704092207045d352e70@mail.gmail.com>
Message-ID: <41526926.6000903@statistik.uni-dortmund.de>

Shaogang Qu wrote:

>  I met several problems in using R, and I can not find the 
> 
>>exact answer after reading some r-docs and searching the web, maybe I 
>>use them in a wrong way.
>>
>>So, I hope you may offer me some guide on it if possible. The problems 
>>are as follows:
>>
>>1           I see the example source for creating an R package, but indeed,
>>the package submitted to CRAN is nod this simple, so I wonder how I 
>>can create an R package like this.

Have you read "Writing R Extensions"? Your question is too unspecific to 
get any other useful help.
And what does "a package like this" mean?


>>2           And when a package like this is generated, how can I do some
>>modification? For example, add some new function into it or do some 
>>modifications for certain function?
>>
>>I try to do this on an existed package, but it does not work, the new 
>>package can not be found.

see 1

>>         3       Could you offer me some e-documents for R apart from the
>>R-help docs?

see 1

>>         4       Could you offer me some advise on R learning if I am only
>>interested in R package management not R language programming now?

see 1


>             5       I used the Tools to create a package in windows,
> but it seems in the last step, zip command does not work? Is there any
> good reference about the way creating a package using RGui?

If you are under Windows, please also read .../src/gnuwin32/README.packages

Uwe Ligges



>>         
>>
>> 
>>
>>Thanks a lot!!
>>
>> 
>>
>>Jimmy
> 
> 
> ______________________________________________
> R-devel@stat.math.ethz.ch mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

From maechler at stat.math.ethz.ch  Thu Sep 23 09:54:18 2004
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Thu Sep 23 09:54:20 2004
Subject: [Rd] attaching to position 1
In-Reply-To: <4151B6A2.7080103@pburns.seanet.com>
References: <4151B6A2.7080103@pburns.seanet.com>
Message-ID: <16722.33066.488926.79512@gargle.gargle.HOWL>

>>>>> "PatBurns" == Patrick Burns <pburns@pburns.seanet.com>
>>>>>     on Wed, 22 Sep 2004 18:30:10 +0100 writes:

    PatBurns> If an attempt is made to attach to position 1, it
    PatBurns> appears to work (not even a warning) but in fact
    PatBurns> it doesn't work as many would expect.  "search"
    PatBurns> thinks that it gets placed in position 2, but
    PatBurns> nothing is actually there (according to "ls").

    PatBurns> This is guaranteed to be confusing (and annoying)
    PatBurns> to people who are used to attaching to position 1
    PatBurns> in S-PLUS.

yes; thanks for bringing this up!

    PatBurns> I'm not clear on all of the implications of
    PatBurns> changing this, but my first inclination would be
    PatBurns> to make it an error to attach to position 1.  The
    PatBurns> help file says that you can't do it.

and has done so for a long time AFAIR.

    PatBurns> At the very least there should be a warning .  My
    PatBurns> guess is that it is rare for someone to attach to
    PatBurns> position 1 and not attempt to modify what is being
    PatBurns> attached.

Hence (together with the arguments further above),
I think an error would be more appropriate
[if there's only a warning and the user's code continues on 
 the wrong assumption, more problems lay ahead].

OTOH, in the current "beta" phase I can think of a case where an
error would be too "hard": 
The worst I can see is an R script that has attach(*, pos=1)
which doesn't attach at all {as you say, it *seems* to attach to
position 2 but doesn't really provide the object}, but for some
reason still continues to produce reasonable things.

Hene, for 2.0.0 in "deep freeze", I'd propose to give a warning only.
However, we wouldn't the database' to search()[2]  "seemingly" only,
and this could be a problem if a user's script does a detach(..) later.
I.e., we should attach() to pos=2 *properly* (instead of
"seemingly") only.

At the latest for 2.1.0, we should rather make the warning an error.

In any case, this looks like a very simple fix (to the C
source);

Martin Maechler





    >> attach('foo.RData')
    >> search()
    PatBurns> [1] ".GlobalEnv"        "file:foo.RData"    "package:methods" 
    PatBurns> [4] "package:stats"     "package:graphics"  "package:grDevices"
    PatBurns> [7] "package:utils"     "package:datasets"  "Autoloads"       
    PatBurns> [10] "package:base"    
    >> ls(2)
    PatBurns> [1] "jj"
    >> jj
    PatBurns> [1] 1 2 3 4 5 6 7 8 9
    >> detach()
    >> search()
    PatBurns> [1] ".GlobalEnv"        "package:methods"   "package:stats"   
    PatBurns> [4] "package:graphics"  "package:grDevices" "package:utils"   
    PatBurns> [7] "package:datasets"  "Autoloads"         "package:base"    
    >> attach('foo.RData', pos=1)
    >> search()
    PatBurns> [1] ".GlobalEnv"        "file:foo.RData"    "package:methods" 
    PatBurns> [4] "package:stats"     "package:graphics"  "package:grDevices"
    PatBurns> [7] "package:utils"     "package:datasets"  "Autoloads"       
    PatBurns> [10] "package:base"    
    >> ls(2)
    PatBurns> character(0)

    PatBurns> _                          
    PatBurns> platform i386-pc-mingw32            
    PatBurns> arch     i386                       
    PatBurns> os       mingw32                    
    PatBurns> system   i386, mingw32              
    PatBurns> status   Under development (unstable)
    PatBurns> major    2                          
    PatBurns> minor    0.0                        
    PatBurns> year     2004                       
    PatBurns> month    09                         
    PatBurns> day      17                         
    PatBurns> language R

From edd at debian.org  Thu Sep 23 18:34:19 2004
From: edd at debian.org (Dirk Eddelbuettel)
Date: Thu Sep 23 18:34:24 2004
Subject: [Rd] Rgraphviz compilation error
In-Reply-To: <20040922201135.55579.qmail@web41121.mail.yahoo.com>
References: <20040922201135.55579.qmail@web41121.mail.yahoo.com>
Message-ID: <20040923163419.GA19330@sonny.eddelbuettel.com>

On Wed, Sep 22, 2004 at 01:11:35PM -0700, Saurin Jani wrote:
[...]
> I have installed graphviz version:
> graphviz-1.16-1.src.rpm installed already on system. 
[...]
> $ R CMD INSTALL  -l /usr/local/lib/R/library   
>   Rgraphviz_1.4.0.tar.gz
[...]
> make: *** [Rgraphviz.o] Error 1
> ERROR: compilation failed for package 'Rgraphviz'
> ** Removing '/usr/local/lib/R/library/Rgraphviz'
> --------------------
> 
> please let me know...if someone has same problem,

RGraphviz 1.4.0 says this in its README:

  Installing Rgraphviz:
  
  The Rgraphviz package requires a bit of extra work beyond 
  simply installing the package itself to run properly.  The user
  must first have installed the GraphViz software provided by AT&T.
  For users of the release version of Rgraphviz from Bioconductor 1.3,
  this must be Graphviz version 1.10.  For users of Rgraphviz for
  Bioconductor 1.4 (or the devel versions leading up to the 1.4 release)
  this must be Graphviz version 1.12.
  
So you may have to back out graphviz-1.16.

For what it's worth, RGraphviz-1.4.0 built on my Debian testing system (on
which graphviz 1.12 is installed) as a script-generated Debian package which
is available, along with over 400 other CRAN/BioC packages, as part of
Quantian -- see http://dirk.eddelbuettel.com/quantian

Dirk

-- 
Those are my principles, and if you don't like them... well, I have others.
                                                -- Groucho Marx

From wolski at molgen.mpg.de  Thu Sep 23 20:00:44 2004
From: wolski at molgen.mpg.de (Wolski)
Date: Thu Sep 23 20:00:49 2004
Subject: [Rd] browser() is called incidentally (?) somewhere from inside
 methods::as
Message-ID: <200409232000440019.053BF973@mail.math.fu-berlin.de>

Hi,

Executing the following code causes the prompt to enter browser() mode.

>dd<-as(Npatrick1,"list")
Called from: as(Npatrick1, "list")
Browse[1]> 

R : Copyright 2004, The R Foundation for Statistical Computing
Version 2.0.0 beta (2004-09-20), ISBN 3-900051-07-0

Some addtitional info about Npatrick1

> is(Npatrick1)
[1] "Massvectorlist" "Mlist"          "List"           "list"          
[5] "vector"  

/E

Dipl. bio-chem. Witold Eryk Wolski             @         MPI-Moleculare Genetic   
Ihnestrasse 63-73 14195 Berlin                'v'    
tel: 0049-30-83875219                        /   \       
mail: witek96@users.sourceforge.net        ---W-W----    http://www.molgen.mpg.de/~wolski 
      wolski@molgen.mpg.de

From meyerjp at jmu.edu  Thu Sep 23 21:27:09 2004
From: meyerjp at jmu.edu (meyerjp@jmu.edu)
Date: Thu Sep 23 21:27:13 2004
Subject: [Rd] noncentrality paramter in power.anova.test (PR#7244)
Message-ID: <20040923192709.3D66110FBC@slim.kubism.ku.dk>

Full_Name: 
Version: 1.9.0
OS: Windows XP
Submission from: (NULL) (134.126.93.191)


I believe the noncentrality parameter, lambda, in power.anova.test is incorrect.
The noncentrality paramter is defined as lambda <- (groups - 1) * n *
(between.var/within.var). The n should not be there. The function pf defines the
noncentrality parameter as the sum of squares of the means. Therefore, the
noncentrality paramter, lambda, in power.anova.test should be lambda <- (groups
- 1) * (between.var/within.var). The following code shows the difference in
results. I've compared a few power computations using the new lambda to values
from a text on power. The new lambda produces more correct values for power.


groups <- 3
n <- 5
between.var <- 10.295
within.var <- 1
sig.level <- 0.05


#The first, incorrect lambda is used in power.anova.test
#incorrect labmda
lambda <- (groups - 1) * n * (between.var/within.var)
pf(qf(sig.level, groups - 1, (n - 1) * groups, lower = FALSE), 
            groups - 1, (n - 1) * groups, lambda, lower = FALSE)

#This correct lambda should be used instead
lambda <- (groups - 1) * (between.var/within.var)
pf(qf(sig.level, groups - 1, (n - 1) * groups, lower = FALSE), 
      		groups - 1, (n - 1) * groups, lambda, lower = FALSE)

From saurin_jani at yahoo.com  Thu Sep 23 22:00:20 2004
From: saurin_jani at yahoo.com (Saurin Jani)
Date: Thu Sep 23 22:03:19 2004
Subject: [Rd] Rgraphviz + graphviz 1.12.1 compilation error
In-Reply-To: <6.0.0.22.2.20040923123241.01bf16c8@paris7.jussieu.fr>
Message-ID: <20040923200020.41315.qmail@web41108.mail.yahoo.com>

Hi,

I have Linux Fedora 32 bit with 512 RAM 

I would like to use Rgraphviz package.so, I did:

$ [root@localhost packages]# rpm -i
graphviz-1.12-1.i386.rpm 

package graphviz-1.12-1 is already installed

[root@localhost packages]# R CMD INSTALL -l 
/usr/local/lib/R/library Rgraphviz_1.4.0.tar.gz
---------------------------------------------
* Installing *source* package 'Rgraphviz' ...
** libs
gcc -I/usr/local/lib/R/include `dotneato-config
--cflags`  -I/usr/local/include -D__NO_MATH_INLINES
-mieee-fp -Wall -fPIC  -g -O2 -c Rgraphviz.c -o
Rgraphviz.o
In file included from
/usr/local/include/graphviz/render.h:45,
                 from common.h:21,
                 from Rgraphviz.c:1:
/usr/local/include/graphviz/macros.h:34:1: warning:
"NEW" redefined
In file included from common.h:13,
                 from Rgraphviz.c:1:
/usr/local/lib/R/include/Rdefines.h:129:1: warning:
this is the location of the previous definition
Rgraphviz.c: In function `Rgraphviz_agopen':
Rgraphviz.c:244: warning: implicit declaration of
function `GD_gvc'
Rgraphviz.c:244: error: invalid lvalue in assignment
make: *** [Rgraphviz.o] Error 1
ERROR: compilation failed for package 'Rgraphviz'
** Removing '/usr/local/lib/R/library/Rgraphviz'
-----------------------------------------------------

anyone has this before....?

thanks,
Saurin

From p.dalgaard at biostat.ku.dk  Thu Sep 23 22:03:43 2004
From: p.dalgaard at biostat.ku.dk (Peter Dalgaard)
Date: Thu Sep 23 22:05:14 2004
Subject: [Rd] noncentrality paramter in power.anova.test (PR#7244)
In-Reply-To: <20040923192709.3D66110FBC@slim.kubism.ku.dk>
References: <20040923192709.3D66110FBC@slim.kubism.ku.dk>
Message-ID: <x2acvg4usg.fsf@biostat.ku.dk>

meyerjp@jmu.edu writes:

> Full_Name: 
> Version: 1.9.0
> OS: Windows XP
> Submission from: (NULL) (134.126.93.191)
> 
> 
> I believe the noncentrality parameter, lambda, in power.anova.test is incorrect.
> The noncentrality paramter is defined as lambda <- (groups - 1) * n *
> (between.var/within.var). The n should not be there. The function pf defines the
> noncentrality parameter as the sum of squares of the means. Therefore, the
> noncentrality paramter, lambda, in power.anova.test should be lambda <- (groups
> - 1) * (between.var/within.var). The following code shows the difference in
> results. I've compared a few power computations using the new lambda to values
> from a text on power. The new lambda produces more correct values for power.

Correct by which measure? Surely not by consistency with power.t.test
in the groups==2 case!

I think you're forgetting that there is a scale factor of n needed to
make the variance of the sample means comparable to the sample
variance. The means referred to in the definition of ncp for pf are
only indirectly related to the actual group means.
 

> groups <- 3
> n <- 5
> between.var <- 10.295
> within.var <- 1
> sig.level <- 0.05
> 
> 
> #The first, incorrect lambda is used in power.anova.test
> #incorrect labmda
> lambda <- (groups - 1) * n * (between.var/within.var)
> pf(qf(sig.level, groups - 1, (n - 1) * groups, lower = FALSE), 
>             groups - 1, (n - 1) * groups, lambda, lower = FALSE)
> 
> #This correct lambda should be used instead
> lambda <- (groups - 1) * (between.var/within.var)
> pf(qf(sig.level, groups - 1, (n - 1) * groups, lower = FALSE), 
>       		groups - 1, (n - 1) * groups, lambda, lower = FALSE)
> 
> ______________________________________________
> R-devel@stat.math.ethz.ch mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 

-- 
   O__  ---- Peter Dalgaard             Blegdamsvej 3  
  c/ /'_ --- Dept. of Biostatistics     2200 Cph. N   
 (*) \(*) -- University of Copenhagen   Denmark      Ph: (+45) 35327918
~~~~~~~~~~ - (p.dalgaard@biostat.ku.dk)             FAX: (+45) 35327907

From vograno at evafunds.com  Fri Sep 24 02:48:45 2004
From: vograno at evafunds.com (Vadim Ogranovich)
Date: Fri Sep 24 02:49:12 2004
Subject: [Rd] algorithm reference for sample()
Message-ID: <C698D707214E6F4AB39AB7096C3DE5A56D850A@phost015.EVAFUNDS.intermedia.net>

Hi,
 
Don't know if it belongs to r-devel or r-help, but since I am planning
to alter some of R's internal code I am sending it here.
 
The existing implementation of the sample() function, when the optional
'prob' argument is given, is quite inefficient. The complexity is
O(sampleSize * universeSize), see ProbSampleReplace() and
ProbSampleNoReplace() in random.c. This makes the function impractical
for the vector sizes I use.  I want to re-code these functions and I
"think" I can come up with a more efficient algorithm. However before I
go and reinvent the wheel I wonder if there is a published description
of an efficient sampling algorithm with user-specified probabilities?
 
Thanks,
Vadim

	[[alternative HTML version deleted]]

From edd at debian.org  Fri Sep 24 02:58:58 2004
From: edd at debian.org (Dirk Eddelbuettel)
Date: Fri Sep 24 02:59:14 2004
Subject: [Rd] Cannot build cluster_1.9,6 under R 2.0.0 beta Sep 21
Message-ID: <20040924005858.GA23719@sonny.eddelbuettel.com>

Doing the normal build process [1] for a first time with a R 2.0.0 snapshot
-- the Sep 21 version I uploaded to Debian's 'experimental' section two days
ago, ended in failure. The package in question is cluster 1.9.6 which should
be 2.0.0-ready.

The (partial) log follows:

-----------------------------------------------------------------------------
[...]
g77 -mieee-fp  -fPIC  -g -O2 -c twins.f -o twins.o
gcc -shared  -o cluster.so clara.o daisy.o dysta.o fanny.o meet.o mona.o pam.o spannel.o twins.o  -L/usr/lib/gcc-lib/i486-linux/3.3.4 -L/usr/lib/gcc-lib/i486-linux/3.3.4/../../.. -lfrtbegin -lg2c -lm -lgcc_s -L/usr/lib/R/lib -lR
make[1]: Leaving directory `/tmp/buildd/cluster-1.9.6/src'
** R
** data
**  moving datasets to lazyload DB
** preparing package for lazy loading

** help
 >>> Building/Updating help pages for package 'cluster'
     Formats: text html latex example 
  agnes                             text    html    latex   example
  agnes.object                      text    html    latex
  agriculture                       text    html    latex   example
  animals                           text    html    latex   example
  bannerplot                        text    html    latex
  clara                             text    html    latex   example
  clara.object                      text    html    latex
  clusplot                          text    html    latex
  clusplot.default                  text    html    latex   example
  clusplot.partition                text    html    latex   example
  cluster-internal                  text    html    latex
  daisy                             text    html    latex   example
  diana                             text    html    latex   example
  diana.object                      text    html    latex   example
  dissimilarity.object              text    html    latex
  ellipsoidhull                     text    html    latex   example
  fanny                             text    html    latex   example
  fanny.object                      text    html    latex
  flower                            text    html    latex   example
  lower.to.upper.tri.inds           text    html    latex   example
  mona                              text    html    latex   example
  mona.object                       text    html    latex
  pam                               text    html    latex   example
  pam.object                        text    html    latex   example
  partition.object                  text    html    latex
  plot.agnes                        text    html    latex   example
  plot.diana                        text    html    latex   example
  plot.mona                         text    html    latex
  plot.partition                    text    html    latex   example
  pltree                            text    html    latex
  pltree.twins                      text    html    latex   example
  pluton                            text    html    latex   example
  predict.ellipsoid                 text    html    latex
  print.agnes                       text    html    latex
  print.clara                       text    html    latex
  print.diana                       text    html    latex
  print.dissimilarity               text    html    latex   example
  print.fanny                       text    html    latex
  print.mona                        text    html    latex
  print.pam                         text    html    latex
  ruspini                           text    html    latex   example
  silhouette                        text    html    latex   example
  sizeDiss                          text    html    latex   example
  summary.agnes                     text    html    latex   example
  summary.clara                     text    html    latex   example
  summary.diana                     text    html    latex
  summary.fanny                     text    html    latex
  summary.mona                      text    html    latex
  summary.pam                       text    html    latex
  twins.object                      text    html    latex
  volume.ellipsoid                  text    html    latex   example
  votes.repub                       text    html    latex
  xclara                            text    html    latex
Error in .find.package(package, lib.loc, verbose = verbose) : 
	none of the packages were found
Execution halted
ERROR: installing package indices failed
make: *** [R_any_arch] Error 1
pbuilder: Failed autobuilding of package
 -> Aborting with an error
 -> unmounting dev/pts filesystem
 -> unmounting proc filesystem
 -> cleaning the build env 
    -> removing directory /var/local/cache/pbuilder/build//8487 and its subdirectories

-----------------------------------------------------------------------------

The 'make' and 'pbuilder' messages come from the build environment.

Any idea what is wrong here, and what I'd need to change?

Dirk



[1] This happens in a chroot(8) ennvironment, from a well-defined and very
    basic Debian base system. "Build Dependendies" are then installed -- which
    in this case includes the R 2.0.0 beta from two days ago, as well a large
    number of other things given all the various header and libs R needs.
    This process is very close, but not identical to, what the Debian
    autobuilders use.
-- 
Those are my principles, and if you don't like them... well, I have others.
                                                -- Groucho Marx

From edd at debian.org  Fri Sep 24 03:36:26 2004
From: edd at debian.org (Dirk Eddelbuettel)
Date: Fri Sep 24 03:36:29 2004
Subject: [Rd] Cannot build cluster_1.9,6 under R 2.0.0 beta Sep 21
In-Reply-To: <20040924005858.GA23719@sonny.eddelbuettel.com>
References: <20040924005858.GA23719@sonny.eddelbuettel.com>
Message-ID: <20040924013626.GA23976@sonny.eddelbuettel.com>

On Thu, Sep 23, 2004 at 07:58:58PM -0500, Dirk Eddelbuettel wrote:
> Doing the normal build process [1] for a first time with a R 2.0.0 snapshot
> -- the Sep 21 version I uploaded to Debian's 'experimental' section two days
> ago, ended in failure. The package in question is cluster 1.9.6 which should
> be 2.0.0-ready.
> 
> The (partial) log follows:

(See other mail for rest)

Three more points:

i)   R 1.9.1 beta 20040921 works fine as packaged and installed into the
     chroot'ed build environment, and
    
ii)  The package stats, graphics and utils upon which cluster Depends: all
     load nicely in an interactive session.
    
iii) The same error occurrs when I call 'R CMD INSTALL cluster-1.9.6' by
     hand.
    
I'm still lost as to why I get 

  Error in .find.package(package, lib.loc, verbose = verbose) : 
          none of the packages were found
  Execution halted

when building cluster.

Dirk

-- 
Those are my principles, and if you don't like them... well, I have others.
                                                -- Groucho Marx

From edd at debian.org  Fri Sep 24 04:31:50 2004
From: edd at debian.org (Dirk Eddelbuettel)
Date: Fri Sep 24 04:31:52 2004
Subject: [Rd] Cannot build cluster_1.9,6 under R 2.0.0 beta Sep 21
In-Reply-To: <20040924013626.GA23976@sonny.eddelbuettel.com>
References: <20040924005858.GA23719@sonny.eddelbuettel.com>
	<20040924013626.GA23976@sonny.eddelbuettel.com>
Message-ID: <20040924023150.GA24368@sonny.eddelbuettel.com>

And another follow-up -- this may well be related to cluster as mgcv-1.1.2
builds fine.

Dirk

-- 
Those are my principles, and if you don't like them... well, I have others.
                                                -- Groucho Marx

From mai at ms.uky.edu  Fri Sep 24 04:53:18 2004
From: mai at ms.uky.edu (mai@ms.uky.edu)
Date: Fri Sep 24 04:53:25 2004
Subject: [Rd] bug in  power.t.test( ) (PR#7245)
Message-ID: <20040924025318.D8E0010FB9@slim.kubism.ku.dk>

Full_Name: Mai Zhou
Version: 1.9.1
OS: Win XP Professional
Submission from: (NULL) (12.222.227.93)


> power.t.test(n=25, delta=0.1, sig.level=1.1, strict=TRUE, type="one.sample")

     One-sample t test power calculation 

              n = 25
          delta = 0.1
             sd = 1
      sig.level = 1.1
          power = 1.088311
    alternative = two.sided

### power can never be over one!  Of course, sig.level should not take value > 1
### either.
### Possible solution: A check in the input to truncate sig.level into [0, 1]??

From ligges at statistik.uni-dortmund.de  Fri Sep 24 08:43:56 2004
From: ligges at statistik.uni-dortmund.de (ligges@statistik.uni-dortmund.de)
Date: Fri Sep 24 08:44:00 2004
Subject: [Rd] bug in  power.t.test( ) (PR#7245)
Message-ID: <20040924064356.DFC2410FBC@slim.kubism.ku.dk>

mai@ms.uky.edu wrote:
> Full_Name: Mai Zhou
> Version: 1.9.1
> OS: Win XP Professional
> Submission from: (NULL) (12.222.227.93)
> 
> 
> 
>>power.t.test(n=25, delta=0.1, sig.level=1.1, strict=TRUE, type="one.sample")
> 
> 
>      One-sample t test power calculation 
> 
>               n = 25
>           delta = 0.1
>              sd = 1
>       sig.level = 1.1
>           power = 1.088311
>     alternative = two.sided
> 
> ### power can never be over one!  Of course, sig.level should not take value > 1
> ### either.
> ### Possible solution: A check in the input to truncate sig.level into [0, 1]??

Well, an error (or at least warning) message seems to be more 
appropriate rather than silently changing some values, e.g. somehwere at 
the top of the functions body:

     if(any(sig.level < 0 | sig.level > 1))
         stop("sig.level must be in [0,1]")


Uwe Ligges


> ______________________________________________
> R-devel@stat.math.ethz.ch mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

From ligges at statistik.uni-dortmund.de  Fri Sep 24 09:08:36 2004
From: ligges at statistik.uni-dortmund.de (Uwe Ligges)
Date: Fri Sep 24 09:09:02 2004
Subject: [Rd] browser() is called incidentally (?) somewhere from inside
	methods::as
In-Reply-To: <200409232000440019.053BF973@mail.math.fu-berlin.de>
References: <200409232000440019.053BF973@mail.math.fu-berlin.de>
Message-ID: <4153C7F4.9090501@statistik.uni-dortmund.de>

Wolski wrote:

> Hi,
> 
> Executing the following code causes the prompt to enter browser() mode.
> 


Yes, a bug in line 23 of .../src/library/methods/as.R

Uwe Ligges


>>dd<-as(Npatrick1,"list")
 >
> Called from: as(Npatrick1, "list")
> Browse[1]> 
> 
> R : Copyright 2004, The R Foundation for Statistical Computing
> Version 2.0.0 beta (2004-09-20), ISBN 3-900051-07-0
> 
> Some addtitional info about Npatrick1
> 
> 
>>is(Npatrick1)
> 
> [1] "Massvectorlist" "Mlist"          "List"           "list"          
> [5] "vector"  
> 
> /E
> 
> Dipl. bio-chem. Witold Eryk Wolski             @         MPI-Moleculare Genetic   
> Ihnestrasse 63-73 14195 Berlin                'v'    
> tel: 0049-30-83875219                        /   \       
> mail: witek96@users.sourceforge.net        ---W-W----    http://www.molgen.mpg.de/~wolski 
>       wolski@molgen.mpg.de
> 
> ______________________________________________
> R-devel@stat.math.ethz.ch mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

From maechler at stat.math.ethz.ch  Fri Sep 24 10:02:53 2004
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Fri Sep 24 10:02:55 2004
Subject: [Rd] algorithm reference for sample()
In-Reply-To: <C698D707214E6F4AB39AB7096C3DE5A56D850A@phost015.EVAFUNDS.intermedia.net>
References: <C698D707214E6F4AB39AB7096C3DE5A56D850A@phost015.EVAFUNDS.intermedia.net>
Message-ID: <200409240802.i8O82rwY006319@lynne.ethz.ch>

Hi Vadim,

>>>>> "Vadim" == Vadim Ogranovich <vograno@evafunds.com>
>>>>>     on Thu, 23 Sep 2004 17:48:45 -0700 writes:

    Vadim> Hi, Don't know if it belongs to r-devel or r-help,
    Vadim> but since I am planning to alter some of R's internal code

i.e., you will propose a patch to the R sources eventually ?

    Vadim>  I am sending it here.

good choice.  Also, since you are talking about
internal (non-API) C code from R - which I would deem
inappropriate on R-help.

    Vadim> The existing implementation of the sample() function,
    Vadim> when the optional 'prob' argument is given, is quite
    Vadim> inefficient. The complexity is O(sampleSize *
    Vadim> universeSize), see ProbSampleReplace() and
    Vadim> ProbSampleNoReplace() in random.c. This makes the
    Vadim> function impractical for the vector sizes I use. 

I'm interested: What problem are you solving where sample() is
the bottleneck (rather than what you *do* with the sample ..)

    Vadim> I want to re-code these functions and I "think" I can
    Vadim> come up with a more efficient algorithm.

I agree. It's a kind of table lookup, that definitely can be
made faster e.g. by bisection ideas.

    Vadim> However before I go and reinvent the wheel I wonder if there
    Vadim> is a published description of an efficient sampling
    Vadim> algorithm with user-specified probabilities?

I've got some ideas, but maybe would first want to get a reply to the
current ones.

    Vadim> Thanks, Vadim

    Vadim> 	[[alternative HTML version deleted]]
		^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

(you *did* read the posting guide or just the general
 instructions on http://www.R-project.org/mail.html  ?
)

Martin Maechler

From maechler at stat.math.ethz.ch  Fri Sep 24 11:36:18 2004
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Fri Sep 24 11:36:21 2004
Subject: [Rd] Cannot build cluster_1.9,6 under R 2.0.0 beta Sep 21
In-Reply-To: <20040924023150.GA24368@sonny.eddelbuettel.com>
References: <20040924005858.GA23719@sonny.eddelbuettel.com>
	<20040924013626.GA23976@sonny.eddelbuettel.com>
	<20040924023150.GA24368@sonny.eddelbuettel.com>
Message-ID: <16723.60050.817234.817765@gargle.gargle.HOWL>

>>>>> "Dirk" == Dirk Eddelbuettel <edd@debian.org>
>>>>>     on Thu, 23 Sep 2004 21:31:50 -0500 writes:

    Dirk> And another follow-up -- this may well be related to
    Dirk> cluster as mgcv-1.1.2 builds fine.

Well, thanks, Dirk, for all these.
As maintainer of cluster, I should be interested..

But then, I just see I did successfully "R CMD check cluster" on 
Sep 21 (your snapshot's date) on several Linux platforms,
and have just now tried to install from the local Sep.24 snapshot
i.e. ftp://ftp.stat.math.ethz.ch/Software/R/R-devel_2004-09-24.tar.gz
(which needs  'tools/rsync-recommended' after unpacking) without
a problem.

I'll try the <CRAN>/src/base-prerelease/R-2.0.0-beta-20040924.tgz 
one, subsequently.

Are you sure it's not a problem just with your copy of
something?

Martin

From kjetil at acelerate.com  Fri Sep 24 16:10:39 2004
From: kjetil at acelerate.com (Kjetil Brinchmann Halvorsen)
Date: Fri Sep 24 16:11:55 2004
Subject: [Rd] rw2000dev: problems with library(foreign)
Message-ID: <41542ADF.4000001@acelerate.com>

I get the following

 > library(foreign)
Error in namespaceExport(ns, exports) : undefined exports: write.foreign
Error in library(foreign) : package/namespace load failed for 'foreign'

with rw2000dev as of   (2004-09-17

Kjetil

-- 

Kjetil Halvorsen.

Peace is the most effective weapon of mass construction.
               --  Mahdi Elmandjra

From maechler at stat.math.ethz.ch  Fri Sep 24 16:36:00 2004
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Fri Sep 24 16:36:02 2004
Subject: [Rd] rw2000dev: problems with library(foreign)
In-Reply-To: <41542ADF.4000001@acelerate.com>
References: <41542ADF.4000001@acelerate.com>
Message-ID: <16724.12496.56426.982370@gargle.gargle.HOWL>

>>>>> "Kjetil" == Kjetil Brinchmann Halvorsen <kjetil@acelerate.com>
>>>>>     on Fri, 24 Sep 2004 10:10:39 -0400 writes:

    Kjetil> I get the following
    >> library(foreign)
    Kjetil> Error in namespaceExport(ns, exports) : undefined
    Kjetil> exports: write.foreign Error in library(foreign) :
    Kjetil> package/namespace load failed for 'foreign'

    Kjetil> with rw2000dev as of (2004-09-17

Does
  > system.file(package="foreign")

give the same initial path as
  > system.file(package="base")

?

If yes, I cannot help further;
if no,  this explains the problem:  you're picking up a wrong
version of the  foreign package.

Regards,
Martin

From kjetil at acelerate.com  Fri Sep 24 16:49:39 2004
From: kjetil at acelerate.com (Kjetil Brinchmann Halvorsen)
Date: Fri Sep 24 16:49:46 2004
Subject: [Rd] rw2000dev: problems with library(foreign)
In-Reply-To: <16724.12496.56426.982370@gargle.gargle.HOWL>
References: <41542ADF.4000001@acelerate.com>
	<16724.12496.56426.982370@gargle.gargle.HOWL>
Message-ID: <41543403.50803@acelerate.com>

Martin Maechler wrote:

>>>>>>"Kjetil" == Kjetil Brinchmann Halvorsen <kjetil@acelerate.com>
>>>>>>    on Fri, 24 Sep 2004 10:10:39 -0400 writes:
>>>>>>            
>>>>>>
>
>    Kjetil> I get the following
>    >> library(foreign)
>    Kjetil> Error in namespaceExport(ns, exports) : undefined
>    Kjetil> exports: write.foreign Error in library(foreign) :
>    Kjetil> package/namespace load failed for 'foreign'
>
>    Kjetil> with rw2000dev as of (2004-09-17
>
>Does
>  > system.file(package="foreign")
>
>give the same initial path as
>  > system.file(package="base")
>
>?
>
>If yes, I cannot help further;
>if no,  this explains the problem:  you're picking up a wrong
>version of the  foreign package.
>  
>

 > system.file(package="foreign")
[1] "C:/R/rw2000dev/library/foreign"
 > system.file(package="base")
[1] "C:/R/rw2000dev/library/base"

Kjetil

>Regards,
>Martin
>
>
>  
>


-- 

Kjetil Halvorsen.

Peace is the most effective weapon of mass construction.
               --  Mahdi Elmandjra

From maechler at stat.math.ethz.ch  Fri Sep 24 17:09:16 2004
From: maechler at stat.math.ethz.ch (maechler@stat.math.ethz.ch)
Date: Fri Sep 24 17:09:22 2004
Subject: [Rd] bug in  power.t.test( ) (PR#7245)
Message-ID: <20040924150916.4CB0A10FD1@slim.kubism.ku.dk>

>>>>> "UweL" == Uwe Ligges <ligges@statistik.uni-dortmund.de>
>>>>>     on Fri, 24 Sep 2004 08:43:56 +0200 (CEST) writes:

    UweL> mai@ms.uky.edu wrote:
    >> Full_Name: Mai Zhou Version: 1.9.1 OS: Win XP
    >> Professional Submission from: (NULL) (12.222.227.93)
    >> 
    >> 
    >> 
    >>> power.t.test(n=25, delta=0.1, sig.level=1.1,
    >>> strict=TRUE, type="one.sample")
    >> 
    >> 
    >> One-sample t test power calculation
    >> 
    >> n = 25 delta = 0.1 sd = 1 sig.level = 1.1 power =
    >> 1.088311 alternative = two.sided
    >> 
    >> ### power can never be over one!  Of course, sig.level
    >> should not take value > 1 ### either.  ### Possible
    >> solution: A check in the input to truncate sig.level into
    >> [0, 1]??

    UweL> Well, an error (or at least warning) message seems to
    UweL> be more appropriate rather than silently changing some
    UweL> values, e.g. somehwere at the top of the functions
    UweL> body:

    UweL>      if(any(sig.level < 0 | sig.level > 1))
    UweL>               stop("sig.level must be in [0,1]")

yes, in principle;
thank you, Uwe!

Since  sig.level can also be NULL (which works with the way you
constructed the test - on purpose?), I'd use the test a bit
differently.

BTW, did you know that e.g., sig.level or delta can be *vectors*
giving vectorized results - at least in some cases...
That will hopefully leed to more documentation / code updates, 
but not for 2.0.0 I presume.

Martin Maechler

From ligges at statistik.uni-dortmund.de  Fri Sep 24 17:12:17 2004
From: ligges at statistik.uni-dortmund.de (ligges@statistik.uni-dortmund.de)
Date: Fri Sep 24 17:12:19 2004
Subject: [Rd] bug in  power.t.test( ) (PR#7245)
Message-ID: <20040924151217.1D5A610FD1@slim.kubism.ku.dk>

Martin Maechler wrote:

>>>>>>"UweL" == Uwe Ligges <ligges@statistik.uni-dortmund.de>
>>>>>>    on Fri, 24 Sep 2004 08:43:56 +0200 (CEST) writes:
> 
> 
>     UweL> mai@ms.uky.edu wrote:
>     >> Full_Name: Mai Zhou Version: 1.9.1 OS: Win XP
>     >> Professional Submission from: (NULL) (12.222.227.93)
>     >> 
>     >> 
>     >> 
>     >>> power.t.test(n=25, delta=0.1, sig.level=1.1,
>     >>> strict=TRUE, type="one.sample")
>     >> 
>     >> 
>     >> One-sample t test power calculation
>     >> 
>     >> n = 25 delta = 0.1 sd = 1 sig.level = 1.1 power =
>     >> 1.088311 alternative = two.sided
>     >> 
>     >> ### power can never be over one!  Of course, sig.level
>     >> should not take value > 1 ### either.  ### Possible
>     >> solution: A check in the input to truncate sig.level into
>     >> [0, 1]??
> 
>     UweL> Well, an error (or at least warning) message seems to
>     UweL> be more appropriate rather than silently changing some
>     UweL> values, e.g. somehwere at the top of the functions
>     UweL> body:
> 
>     UweL>      if(any(sig.level < 0 | sig.level > 1))
>     UweL>               stop("sig.level must be in [0,1]")
> 
> yes, in principle;
> thank you, Uwe!
> 
> Since  sig.level can also be NULL

Yes.

> (which works with the way you
> constructed the test - on purpose?), I'd use the test a bit
> differently.
> 
> BTW, did you know that e.g., sig.level or delta can be *vectors*

Yes, hence the "|" rather than "||".

Uwe


> giving vectorized results - at least in some cases...
> That will hopefully leed to more documentation / code updates, 
> but not for 2.0.0 I presume.
> 
> Martin Maechler

From ligges at statistik.uni-dortmund.de  Fri Sep 24 17:48:20 2004
From: ligges at statistik.uni-dortmund.de (Uwe Ligges)
Date: Fri Sep 24 17:48:43 2004
Subject: [Rd] rw2000dev: problems with library(foreign)
In-Reply-To: <41543403.50803@acelerate.com>
References: <41542ADF.4000001@acelerate.com>	<16724.12496.56426.982370@gargle.gargle.HOWL>
	<41543403.50803@acelerate.com>
Message-ID: <415441C4.4030100@statistik.uni-dortmund.de>

Kjetil Brinchmann Halvorsen wrote:

> Martin Maechler wrote:
> 
>>>>>>> "Kjetil" == Kjetil Brinchmann Halvorsen <kjetil@acelerate.com>
>>>>>>>    on Fri, 24 Sep 2004 10:10:39 -0400 writes:
>>>>>>>           
>>
>>
>>    Kjetil> I get the following
>>    >> library(foreign)
>>    Kjetil> Error in namespaceExport(ns, exports) : undefined
>>    Kjetil> exports: write.foreign Error in library(foreign) :
>>    Kjetil> package/namespace load failed for 'foreign'
>>
>>    Kjetil> with rw2000dev as of (2004-09-17
>>
>> Does
>>  > system.file(package="foreign")
>>
>> give the same initial path as
>>  > system.file(package="base")
>>
>> ?
>>
>> If yes, I cannot help further;
>> if no,  this explains the problem:  you're picking up a wrong
>> version of the  foreign package.
>>  
>>
> 
>  > system.file(package="foreign")
> [1] "C:/R/rw2000dev/library/foreign"
>  > system.file(package="base")
> [1] "C:/R/rw2000dev/library/base"


Works for me with the recent beta (both with my own as well as with 
Duncan's build).
Kjetil, can you please try out the recent build?

Thanks!

Uwe


> Kjetil
> 
>> Regards,
>> Martin

From pburns at pburns.seanet.com  Fri Sep 24 18:18:22 2004
From: pburns at pburns.seanet.com (Patrick Burns)
Date: Fri Sep 24 18:19:57 2004
Subject: [Rd] rw2000dev: problems with library(foreign)
In-Reply-To: <415441C4.4030100@statistik.uni-dortmund.de>
References: <41542ADF.4000001@acelerate.com>	<16724.12496.56426.982370@gargle.gargle.HOWL>	<41543403.50803@acelerate.com>
	<415441C4.4030100@statistik.uni-dortmund.de>
Message-ID: <415448CE.2090002@pburns.seanet.com>

For what it is worth, I have the same development version as Kjetil

platform i386-pc-mingw32            
arch     i386                       
os       mingw32                    
system   i386, mingw32              
status   Under development (unstable)
major    2                          
minor    0.0                        
year     2004                       
month    09                         
day      17                         
language R 

(Duncan's compilation) with Windows 2000

and I get the error message.

Pat


Uwe Ligges wrote:

> Kjetil Brinchmann Halvorsen wrote:
>
>> Martin Maechler wrote:
>>
>>>>>>>> "Kjetil" == Kjetil Brinchmann Halvorsen <kjetil@acelerate.com>
>>>>>>>>    on Fri, 24 Sep 2004 10:10:39 -0400 writes:
>>>>>>>>           
>>>>>>>
>>>
>>>
>>>    Kjetil> I get the following
>>>    >> library(foreign)
>>>    Kjetil> Error in namespaceExport(ns, exports) : undefined
>>>    Kjetil> exports: write.foreign Error in library(foreign) :
>>>    Kjetil> package/namespace load failed for 'foreign'
>>>
>>>    Kjetil> with rw2000dev as of (2004-09-17
>>>
>>> Does
>>>  > system.file(package="foreign")
>>>
>>> give the same initial path as
>>>  > system.file(package="base")
>>>
>>> ?
>>>
>>> If yes, I cannot help further;
>>> if no,  this explains the problem:  you're picking up a wrong
>>> version of the  foreign package.
>>>  
>>>
>>
>>  > system.file(package="foreign")
>> [1] "C:/R/rw2000dev/library/foreign"
>>  > system.file(package="base")
>> [1] "C:/R/rw2000dev/library/base"
>
>
>
> Works for me with the recent beta (both with my own as well as with 
> Duncan's build).
> Kjetil, can you please try out the recent build?
>
> Thanks!
>
> Uwe
>
>
>> Kjetil
>>
>>> Regards,
>>> Martin
>>
>
> ______________________________________________
> R-devel@stat.math.ethz.ch mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>

From murdoch at stats.uwo.ca  Fri Sep 24 20:15:03 2004
From: murdoch at stats.uwo.ca (Duncan Murdoch)
Date: Fri Sep 24 20:15:09 2004
Subject: [Rd] rw2000dev: problems with library(foreign)
In-Reply-To: <41542ADF.4000001@acelerate.com>
References: <41542ADF.4000001@acelerate.com>
Message-ID: <5uo8l053rsi1hbu766h0nrr7s57hn4vkee@4ax.com>

On Fri, 24 Sep 2004 10:10:39 -0400, Kjetil Brinchmann Halvorsen
<kjetil@acelerate.com> wrote :

>I get the following
>
> > library(foreign)
>Error in namespaceExport(ns, exports) : undefined exports: write.foreign
>Error in library(foreign) : package/namespace load failed for 'foreign'
>
>with rw2000dev as of   (2004-09-17

CRAN has an 09-22 build now, and it includes a fix to seek() that was
affecting foreign.  I don't see how it would have led to the error you
saw, but you never know...

Please do try a current download, and let me know if you still see the
error.

Duncan

From kjetil at acelerate.com  Fri Sep 24 20:21:01 2004
From: kjetil at acelerate.com (Kjetil Brinchmann Halvorsen)
Date: Fri Sep 24 21:05:23 2004
Subject: [Rd] rw2000dev: problems with library(foreign)
In-Reply-To: <415441C4.4030100@statistik.uni-dortmund.de>
References: <41542ADF.4000001@acelerate.com>	<16724.12496.56426.982370@gargle.gargle.HOWL>	<41543403.50803@acelerate.com>
	<415441C4.4030100@statistik.uni-dortmund.de>
Message-ID: <4154658D.7030007@acelerate.com>

Uwe Ligges wrote:

Just downloaded and installed todays rw2000beta,
problem disappeared (as Patrick Burns also reported).

Kjetil

> Kjetil Brinchmann Halvorsen wrote:
>
>> Martin Maechler wrote:
>>
>>>>>>>> "Kjetil" == Kjetil Brinchmann Halvorsen <kjetil@acelerate.com>
>>>>>>>>    on Fri, 24 Sep 2004 10:10:39 -0400 writes:
>>>>>>>>           
>>>>>>>
>>>
>>>
>>>    Kjetil> I get the following
>>>    >> library(foreign)
>>>    Kjetil> Error in namespaceExport(ns, exports) : undefined
>>>    Kjetil> exports: write.foreign Error in library(foreign) :
>>>    Kjetil> package/namespace load failed for 'foreign'
>>>
>>>    Kjetil> with rw2000dev as of (2004-09-17
>>>
>>> Does
>>>  > system.file(package="foreign")
>>>
>>> give the same initial path as
>>>  > system.file(package="base")
>>>
>>> ?
>>>
>>> If yes, I cannot help further;
>>> if no,  this explains the problem:  you're picking up a wrong
>>> version of the  foreign package.
>>>  
>>>
>>
>>  > system.file(package="foreign")
>> [1] "C:/R/rw2000dev/library/foreign"
>>  > system.file(package="base")
>> [1] "C:/R/rw2000dev/library/base"
>
>
>
> Works for me with the recent beta (both with my own as well as with 
> Duncan's build).
> Kjetil, can you please try out the recent build?
>
> Thanks!
>
> Uwe
>
>
>> Kjetil
>>
>>> Regards,
>>> Martin
>>
>
> ______________________________________________
> R-devel@stat.math.ethz.ch mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


-- 

Kjetil Halvorsen.

Peace is the most effective weapon of mass construction.
               --  Mahdi Elmandjra

From vograno at evafunds.com  Fri Sep 24 23:17:43 2004
From: vograno at evafunds.com (Vadim Ogranovich)
Date: Fri Sep 24 23:18:10 2004
Subject: [Rd] algorithm reference for sample() - Knuth
Message-ID: <C698D707214E6F4AB39AB7096C3DE5A56D8597@phost015.EVAFUNDS.intermedia.net>

Thank you for the reference to Knuth. Indeed in vol. 2 he has a  

> -----Original Message-----
> From: Tony Plate [mailto:tplate@blackmesacapital.com] 
> Sent: Friday, September 24, 2004 8:05 AM
> To: Vadim Ogranovich
> Subject: Re: [Rd] algorithm reference for sample()
> 
> Have you tried looking in Knuth's books on computer 
> algorithms?  (They are classics for good reason!)  If I 
> remember correctly, a colleague found a very clever and fast 
> algorithm for just this problem in one of those volumes.
> 
> -- Tony Plate
> 
> 
> At Thursday 06:48 PM 9/23/2004, Vadim Ogranovich wrote:
> >Hi,
> >
> >Don't know if it belongs to r-devel or r-help, but since I 
> am planning 
> >to alter some of R's internal code I am sending it here.
> >
> >The existing implementation of the sample() function, when 
> the optional 
> >'prob' argument is given, is quite inefficient. The complexity is 
> >O(sampleSize * universeSize), see ProbSampleReplace() and
> >ProbSampleNoReplace() in random.c. This makes the function 
> impractical 
> >for the vector sizes I use.  I want to re-code these functions and I 
> >"think" I can come up with a more efficient algorithm. 
> However before I 
> >go and reinvent the wheel I wonder if there is a published 
> description 
> >of an efficient sampling algorithm with user-specified probabilities?
> >
> >Thanks,
> >Vadim
> >
> >         [[alternative HTML version deleted]]
> >
> >______________________________________________
> >R-devel@stat.math.ethz.ch mailing list
> >https://stat.ethz.ch/mailman/listinfo/r-devel
> 
>

From vograno at evafunds.com  Fri Sep 24 23:36:45 2004
From: vograno at evafunds.com (Vadim Ogranovich)
Date: Fri Sep 24 23:37:09 2004
Subject: [Rd] algorithm reference for sample() - Knuth
Message-ID: <C698D707214E6F4AB39AB7096C3DE5A56D859A@phost015.EVAFUNDS.intermedia.net>

My apologies for the previous incomplete message, I accidentally hit
"send". Here is another try.


Thank you all for the reference to Knuth. Indeed in vol. 2 he has a
section "Random Sampling and Shuffling" which looks relevant.
Unfortunately, I don't have an access to the book itself so I couldn't
figure if this section discusses samples w/o replacement WITH
pre-specified sampling probability. The only public library around that
has the book is a parking nightmare so before I go there I would really
appreciate if someone, who has the book on his shelf, could tell me that
the section is relevant indeed?

Many thanks,
Vadim

> -----Original Message-----
> From: Tony Plate [mailto:tplate@blackmesacapital.com] 
> Sent: Friday, September 24, 2004 8:05 AM
> To: Vadim Ogranovich
> Subject: Re: [Rd] algorithm reference for sample()
> 
> Have you tried looking in Knuth's books on computer 
> algorithms?  (They are classics for good reason!)  If I 
> remember correctly, a colleague found a very clever and fast 
> algorithm for just this problem in one of those volumes.
> 
> -- Tony Plate
> 
> 
> At Thursday 06:48 PM 9/23/2004, Vadim Ogranovich wrote:
> >Hi,
> >
> >Don't know if it belongs to r-devel or r-help, but since I 
> am planning 
> >to alter some of R's internal code I am sending it here.
> >
> >The existing implementation of the sample() function, when 
> the optional 
> >'prob' argument is given, is quite inefficient. The complexity is 
> >O(sampleSize * universeSize), see ProbSampleReplace() and
> >ProbSampleNoReplace() in random.c. This makes the function 
> impractical 
> >for the vector sizes I use.  I want to re-code these functions and I 
> >"think" I can come up with a more efficient algorithm. 
> However before I 
> >go and reinvent the wheel I wonder if there is a published 
> description 
> >of an efficient sampling algorithm with user-specified probabilities?
> >
> >Thanks,
> >Vadim
> >
> >         [[alternative HTML version deleted]]
> >
> >______________________________________________
> >R-devel@stat.math.ethz.ch mailing list
> >https://stat.ethz.ch/mailman/listinfo/r-devel
> 
>

From gregr at rand.org  Sun Sep 26 21:08:26 2004
From: gregr at rand.org (Greg Ridgeway)
Date: Sun Sep 26 21:08:53 2004
Subject: [Rd] Developing R packages in an IDE
Message-ID: <200409261208.27008.gregr@rand.org>


R development folks,

I want to get a sense if there is general interest/use of integrated 
development environments (MS Visual Studio, Eclipse, KDevelop, etc.) among R 
package (C/C++/Fortran) developers. I've used Visual Studio (as well as 
ESS/vi setups) in the past and am toying with KDevelop these days. Are there 
others out there who have tried using KDevelop for R package development? Any 
success or pitfalls?

If there's no one else out there using KDevelop I might forge ahead and write 
up a tutorial on R package development with KDevelop. I can't tell just yet 
whether it's a good route but so far it seems promising.

Greg Ridgeway

--------------------

This email message is for the sole use of the intended recipient(s) and
may contain privileged information. Any unauthorized review, use,
disclosure or distribution is prohibited. If you are not the intended
recipient, please contact the sender by reply email and destroy all copies
of the original message.

From maechler at stat.math.ethz.ch  Mon Sep 27 08:39:44 2004
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Mon Sep 27 08:39:46 2004
Subject: [Rd] Re: [R] installing on alpha (tru64)
In-Reply-To: <6.0.2.0.2.20040921174236.02856f08@ces12.nih.gov>
References: <6.0.2.0.2.20040920133126.028d6680@ces12.nih.gov>
	<16719.57615.794789.619756@gargle.gargle.HOWL>
	<6.0.2.0.2.20040921174236.02856f08@ces12.nih.gov>
Message-ID: <16727.46512.242252.90181@gargle.gargle.HOWL>

>>>>> "Alexa" == Alexa Sorant <ajms@mail.nih.gov>
>>>>>     on Tue, 21 Sep 2004 18:01:00 -0400 writes:

    Alexa> Dear Martin Maechler, I have tried installing today's
    Alexa> version of R-2.0.0 and have exactly the same problem.

I'm reverting to R-devel.  Please *never* direct such topics to
individuals unless they invite you particularly to it.

    Alexa> I have read INSTALL and the relevant sections of "R
    Alexa> Installation and Administration" (which does
    Alexa> recommend the GNU make).  We have the default Tru64
    Alexa> unix "make" and a POSIX "make" which I also tried.

    Alexa> I do not have the GNU version of "make" and have not
    Alexa> found it easy in the past when I looked into
    Alexa> obtaining GNU software for our platform.  It would be
    Alexa> unfortunate if that is the only solution.

I don't know for sure, but I doubt that it would be difficult to
get a working GNU make on Tru64 .. though that may not be the
important thing at the moment.

    Alexa> What is frustrating is that I had no trouble
    Alexa> installing an earlier version of R (1.4.0), 

that was 3 year ago -- a "decade" in software time-space
if we hadn't changed things, R would not collaborate with
today's (as opposed to 2001's) operating systems, system
libraries, compiler, etc.

    Alexa> so it seems that the installation procedure has been
    Alexa> changed along with the software.

I'm sure the software on your computer has been changed in other
ways as well during the last 3 year; that's simply inevitable

    Alexa> The "include" works fine when I specify an absolute
    Alexa> path or when I put a definition of top_srcdir prior
    Alexa> to it (but that seems to cause other problems).  I am
    Alexa> thinking that I may have to put in an absolute path
    Alexa> in other places as well to get this to work.  But
    Alexa> that may take a considerable time to trace through
    Alexa> all of the various make files.

that definitely shouldn't be necessary.
We'd rather have to see what went wrong and may only need a
small change to fix it.

We may need more details (e.g., output of 'configure' ; exact error message).

Have you followed my advice below and installed into a different 
*build* directory ?
Please reply to R-devel.

Regards,
Martin Maechler

    Alexa> Alexa Sorant

    Alexa> At 04:06 AM 9/21/2004, you wrote:
    >> >>>>> "Alexa" == Alexa Sorant <ajms@mail.nih.gov> >>>>>
    >> on Mon, 20 Sep 2004 17:35:43 -0400 writes:

    Alexa> I am trying to install R-1.9.1 on an alpha (Tru64
    Alexa> unix) platform.  I had no problem previously
    Alexa> installing R-1.4.0, but cannot get the new
    Alexa> installation to work.  First I ran "configure"
    Alexa> specifying an alternate installation

    Alexa> directory: ./configure --prefix=/appl/R-1.9.1
    >>  We even recommend using an alternate *build* directory:
    >> 
    >> mkdir <Rbuild> cd <Rbuild> ../<Rsrc>/configure ....
    >> 
    >> and indeed, since R 2.0.0 is beta now (which means
    >> "testing" and almost stable, not "unstable"!), we'd
    >> appreciate (and feel more willing to support you) if
    >> you'd tried to install R-2.0.0 directly.
    >> 
    Alexa> then ran "make" (note that this is NOT gmake, which
    Alexa> may make the difference).  The error message I get
    Alexa> is: Make: cannot open /share/make/vars.mk.  Stop.
    >>
    Alexa> The file share/make/vars.mk is there and readable,
    Alexa> but share is a subdirectory of the main installation
    Alexa> directory.  Upon examining Makefile and associated
    Alexa> files, I found a statement in Makeconf include
    Alexa> $(top_srcdir)/share/make/vars.mk which I suspected
    Alexa> was the problem -- perhaps the definition of
    Alexa> top_srcdir not is carrying over from the Makefile
    Alexa> that references Makeconf.
    >>  yes, that seems clear.  If your 'make' is not supporting
    >> such 'include' statements in Makefiles, you definitely
    >> must use GNU make (seemingly called 'gmake' on alpha) !
    >> 
    >> Did you look at the INSTALL file, or even consult the "R
    >> Administration and Installation" manual (available from
    >> R-projec.org as well) ?
    >> 
    Alexa> (One reason I suspect this statement is that it is
    Alexa> new since the version of R that I installed easily,
    Alexa> as well as the early reference to this particular
    Alexa> file.)
    >>
    Alexa> I have tried a bunch of ways of modifying this
    Alexa> statement, including an explicit path in this
    Alexa> statement.  I think that did work, but a similar
    Alexa> problem then occurred at a later point that I haven't
    Alexa> yet located.
    >>
    Alexa> Has anyone gotten this installation to work on this
    Alexa> platform?
    >>
    Alexa> Alexa J. M. Sorant NIH/NHGRI 333 Cassell Drive Suite
    Alexa> 2000 Baltimore, MD 21224
    >>
    Alexa> ajms@mail.nih.gov

From znmeb at aracnet.com  Mon Sep 27 09:17:58 2004
From: znmeb at aracnet.com (M. Edward Borasky)
Date: Mon Sep 27 09:18:46 2004
Subject: [Rd] Re: [R] installing on alpha (tru64)
In-Reply-To: <16727.46512.242252.90181@gargle.gargle.HOWL>
References: <6.0.2.0.2.20040920133126.028d6680@ces12.nih.gov>
	<16719.57615.794789.619756@gargle.gargle.HOWL>
	<6.0.2.0.2.20040921174236.02856f08@ces12.nih.gov>
	<16727.46512.242252.90181@gargle.gargle.HOWL>
Message-ID: <1096269478.17915.19.camel@localhost>

I have built R on Tru64 boxes using the following cheats:

1. Build Perl, make, binutils and gcc from source. I've forgotten the
exact order; I can look it up tomorrow at work if you really want it.
IIRC Perl builds just fine with the Tru64 toolset, but everything else
works better with a GNU toolset.

2. Put all of the GNU stuff and the new Perl at the head of your path
and build R. I used to have to turn off external BLAS to get it to work,
but it's been a while since I did this.

3. Build any extra libraries using the newly built R.

I made a few feeble attempts to get it to work using the native Tru64
tool set, but the main stumbling block was the unavailability of Fortran
(it costs extra) and the inability to get "f2c" to work. It turned out
to be easier to build Perl, make, binutils and gcc/g77 from scratch.

From znmeb at aracnet.com  Mon Sep 27 16:06:46 2004
From: znmeb at aracnet.com (M. Edward Borasky)
Date: Mon Sep 27 16:07:28 2004
Subject: [Rd] Re: [R] installing on alpha (tru64)
In-Reply-To: <1096269478.17915.19.camel@localhost>
References: <6.0.2.0.2.20040920133126.028d6680@ces12.nih.gov>
	<16719.57615.794789.619756@gargle.gargle.HOWL>
	<6.0.2.0.2.20040921174236.02856f08@ces12.nih.gov>
	<16727.46512.242252.90181@gargle.gargle.HOWL>
	<1096269478.17915.19.camel@localhost>
Message-ID: <1096294006.27184.1.camel@localhost>

On Mon, 2004-09-27 at 00:17, M. Edward Borasky wrote:
> I have built R on Tru64 boxes using the following cheats:

[snip]

There were some other workarounds involving X libraries, but I've
forgotten what they were.

From roebuck at odin.mdacc.tmc.edu  Mon Sep 27 21:10:11 2004
From: roebuck at odin.mdacc.tmc.edu (Paul Roebuck)
Date: Mon Sep 27 21:12:55 2004
Subject: [Rd] read.table documentation correction
Message-ID: <Pine.OSF.4.58.0409271406580.314830@odin.mdacc.tmc.edu>

My copy shows the following in the example section:
     ## Not run:
     ## To write a CSV file for input to Excel one might use
     write.table(x, file = "foo.csv", sep = ",", col.names = NA)
     ## and to read this file back into R one needs
     read.table("file.csv", header = TRUE, sep = ",", row.names=1)
     ## End(Not run)

The filename must be the same in the read.table call in
order to read the file back into R.

----------------------------------------------------------
SIGSIG -- signature too long (core dumped)

From YP.Ongena at fsw.vu.nl  Tue Sep 28 11:42:27 2004
From: YP.Ongena at fsw.vu.nl (YP.Ongena@fsw.vu.nl)
Date: Tue Sep 28 11:42:33 2004
Subject: [Rd] fatal error: unable to restor saved data . Rdata (PR#7253)
Message-ID: <20040928094227.B319410E97@slim.kubism.ku.dk>

Full_Name: Yfke Ongena
Version: Aqua GUI for R 1.9.1
OS: MAC OS 10.3.5
Submission from: (NULL) (130.37.168.69)


R was succesfully installed and worked fine, however, after I closed the session
and also tried to save this, the next time staringup R I get the message "fatal
error: unable to restore saved dat in .RData. I tried to re-install R but this
did not work

From stefano.iacus at unimi.it  Tue Sep 28 11:58:47 2004
From: stefano.iacus at unimi.it (stefano iacus)
Date: Tue Sep 28 11:59:01 2004
Subject: [Rd] fatal error: unable to restor saved data . Rdata (PR#7253)
In-Reply-To: <20040928094227.B319410E97@slim.kubism.ku.dk>
References: <20040928094227.B319410E97@slim.kubism.ku.dk>
Message-ID: <FDD51B90-1134-11D9-82D8-000A95C87F66@unimi.it>

Please check the directory you are working on.

stefano iacus

On Sep 28, 2004, at 11:42 AM, YP.Ongena@fsw.vu.nl wrote:

> Full_Name: Yfke Ongena
> Version: Aqua GUI for R 1.9.1
> OS: MAC OS 10.3.5
> Submission from: (NULL) (130.37.168.69)
>
>
> R was succesfully installed and worked fine, however, after I closed 
> the session
> and also tried to save this, the next time staringup R I get the 
> message "fatal
> error: unable to restore saved dat in .RData. I tried to re-install R 
> but this
> did not work
>
> ______________________________________________
> R-devel@stat.math.ethz.ch mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

From wolski at molgen.mpg.de  Wed Sep 29 17:17:54 2004
From: wolski at molgen.mpg.de (Witold Eryk Wolski)
Date: Wed Sep 29 17:17:59 2004
Subject: [Rd] Ordering of values returned by unique
Message-ID: <415AD222.4050908@molgen.mpg.de>

Hi,

Is the ordering of the values returned something on what I can rely on, 
a form of a standard,  that a function called unique in R (in futher 
versions) will return the uniq elements in order of they first occurcence.

 > x<-c(2,2,1,2)
 > unique(x)
[1] 2 1

Its seems not to be the standard. E.g. matlab
 >> x=[2,2,1,2]
x =
     2     2     1     2
 >> unique(x)
ans =
     1     2

I just noted it because, the way how it is working now is extremely 
usefull for some applications (e.g tree traversal), so i use it in a 
script. But I am a little woried if I can rely on this behaviour in 
further versions. And furthermore can I assume that someone reading the 
code will think that it works in that way?
Or is it better to define a additional function?
keeporderunique<-function(x)
{
    res<-rep(NA,length(unique(x))
    count<-0
    for(i in x)
    {
        if(!i%in%res)
            {
                    count<-count+1
                     res[count]<-i
            }  
    }
    res
}

/E



-- 
Dipl. bio-chem. Witold Eryk Wolski         
MPI-Moleculare Genetic
Ihnestrasse 63-73 14195 Berlin           _
tel: 0049-30-83875219                   'v'
http://www.molgen.mpg.de/~wolski       /   \
mail: witek96@users.sourceforge.net  ---W-W----
      wolski@molgen.mpg.de

From tplate at blackmesacapital.com  Wed Sep 29 18:09:18 2004
From: tplate at blackmesacapital.com (Tony Plate)
Date: Wed Sep 29 18:09:34 2004
Subject: [Rd] Ordering of values returned by unique
In-Reply-To: <415AD222.4050908@molgen.mpg.de>
References: <415AD222.4050908@molgen.mpg.de>
Message-ID: <6.1.0.6.2.20040929094231.05e42a00@mailhost.blackmesacapital.com>

AFAIK, it has always worked that way in S-plus and R.  Furthermore, the 
documentation in R for 'unique' says that it removes duplicated 
elements.  This does seem to leave the possibility that element other than 
the first of a set of duplicates is retained, which could mess up the 
order.  However, the documentation for 'duplicated' is clearer: it says 
that 'duplicated' identifies duplicates of earlier elements.  Also in the 
examples for 'duplicated', it says that x[!duplicated(x)] == unique(x) 
(paraphrased).

I depend on this all the time, so I also checked some references.  In the 
Blue book the documentation for the functions unique and duplicated is 
combined and implies the above.  In MASS 4th Ed, the page referred to by 
the index entry for 'unique' (p48, #9 in my copy) states that 'unique' 
removes duplicates as identified by 'duplicated', which implies that the 
order of retained elements is not changed.  The Green book has no index 
entry for 'unique'.  In S-plus the implementation of unique.default(x) uses 
x[!duplicated(x)].

So, I think the evidence is pretty strong that unique(x) will always return 
elements in the same order as they first appear in x.  But it would be nice 
if the documentation for 'unique' explicitly stated that this is the 
behavior for all methods.  (It does state this for the array method for 
'unique').

-- Tony Plate

At Wednesday 09:17 AM 9/29/2004, Witold Eryk Wolski wrote:
>Hi,
>
>Is the ordering of the values returned something on what I can rely on, a 
>form of a standard,  that a function called unique in R (in futher 
>versions) will return the uniq elements in order of they first occurcence.
>
> > x<-c(2,2,1,2)
> > unique(x)
>[1] 2 1
>
>Its seems not to be the standard. E.g. matlab
> >> x=[2,2,1,2]
>x =
>     2     2     1     2
> >> unique(x)
>ans =
>     1     2
>
>I just noted it because, the way how it is working now is extremely 
>usefull for some applications (e.g tree traversal), so i use it in a 
>script. But I am a little woried if I can rely on this behaviour in 
>further versions. And furthermore can I assume that someone reading the 
>code will think that it works in that way?
>Or is it better to define a additional function?
>keeporderunique<-function(x)
>{
>    res<-rep(NA,length(unique(x))
>    count<-0
>    for(i in x)
>    {
>        if(!i%in%res)
>            {
>                    count<-count+1
>                     res[count]<-i
>            }
>    }
>    res
>}
>
>/E
>
>
>
>--
>Dipl. bio-chem. Witold Eryk Wolski
>MPI-Moleculare Genetic
>Ihnestrasse 63-73 14195 Berlin           _
>tel: 0049-30-83875219                   'v'
>http://www.molgen.mpg.de/~wolski       /   \
>mail: witek96@users.sourceforge.net  ---W-W----
>      wolski@molgen.mpg.de
>
>______________________________________________
>R-devel@stat.math.ethz.ch mailing list
>https://stat.ethz.ch/mailman/listinfo/r-devel

From wolski at molgen.mpg.de  Wed Sep 29 18:24:28 2004
From: wolski at molgen.mpg.de (Witold Eryk Wolski)
Date: Wed Sep 29 18:24:34 2004
Subject: [Rd] Ordering of values returned by unique
In-Reply-To: <6.1.0.6.2.20040929094231.05e42a00@mailhost.blackmesacapital.com>
References: <415AD222.4050908@molgen.mpg.de>
	<6.1.0.6.2.20040929094231.05e42a00@mailhost.blackmesacapital.com>
Message-ID: <415AE1BC.6060804@molgen.mpg.de>

Hi!

Thanks for this explanation and pointing me to value section of the 
documention and the function duplicate. Indeed the documentation entry 
in the value section states:
An object of the same type of 'x'. but if an element is equal to one 
with a smaller index, it is removed. Could have found it by myself.

/E


Tony Plate wrote:

> AFAIK, it has always worked that way in S-plus and R.  Furthermore, 
> the documentation in R for 'unique' says that it removes duplicated 
> elements.  This does seem to leave the possibility that element other 
> than the first of a set of duplicates is retained, which could mess up 
> the order.  However, the documentation for 'duplicated' is clearer: it 
> says that 'duplicated' identifies duplicates of earlier elements.  
> Also in the examples for 'duplicated', it says that x[!duplicated(x)] 
> == unique(x) (paraphrased).
>
> I depend on this all the time, so I also checked some references.  In 
> the Blue book the documentation for the functions unique and 
> duplicated is combined and implies the above.  In MASS 4th Ed, the 
> page referred to by the index entry for 'unique' (p48, #9 in my copy) 
> states that 'unique' removes duplicates as identified by 'duplicated', 
> which implies that the order of retained elements is not changed.  The 
> Green book has no index entry for 'unique'.  In S-plus the 
> implementation of unique.default(x) uses x[!duplicated(x)].
>
> So, I think the evidence is pretty strong that unique(x) will always 
> return elements in the same order as they first appear in x.  But it 
> would be nice if the documentation for 'unique' explicitly stated that 
> this is the behavior for all methods.  (It does state this for the 
> array method for 'unique').
>
> -- Tony Plate
>
> At Wednesday 09:17 AM 9/29/2004, Witold Eryk Wolski wrote:
>
>> Hi,
>>
>> Is the ordering of the values returned something on what I can rely 
>> on, a form of a standard,  that a function called unique in R (in 
>> futher versions) will return the uniq elements in order of they first 
>> occurcence.
>>
>> > x<-c(2,2,1,2)
>> > unique(x)
>> [1] 2 1
>>
>> Its seems not to be the standard. E.g. matlab
>> >> x=[2,2,1,2]
>> x =
>>     2     2     1     2
>> >> unique(x)
>> ans =
>>     1     2
>>
>> I just noted it because, the way how it is working now is extremely 
>> usefull for some applications (e.g tree traversal), so i use it in a 
>> script. But I am a little woried if I can rely on this behaviour in 
>> further versions. And furthermore can I assume that someone reading 
>> the code will think that it works in that way?
>> Or is it better to define a additional function?
>> keeporderunique<-function(x)
>> {
>>    res<-rep(NA,length(unique(x))
>>    count<-0
>>    for(i in x)
>>    {
>>        if(!i%in%res)
>>            {
>>                    count<-count+1
>>                     res[count]<-i
>>            }
>>    }
>>    res
>> }
>>
>> /E
>>
>>
>>
>> -- 
>> Dipl. bio-chem. Witold Eryk Wolski
>> MPI-Moleculare Genetic
>> Ihnestrasse 63-73 14195 Berlin           _
>> tel: 0049-30-83875219                   'v'
>> http://www.molgen.mpg.de/~wolski       /   \
>> mail: witek96@users.sourceforge.net  ---W-W----
>>      wolski@molgen.mpg.de
>>
>> ______________________________________________
>> R-devel@stat.math.ethz.ch mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


-- 
Dipl. bio-chem. Witold Eryk Wolski         
MPI-Moleculare Genetic
Ihnestrasse 63-73 14195 Berlin           _
tel: 0049-30-83875219                   'v'
http://www.molgen.mpg.de/~wolski       /   \
mail: witek96@users.sourceforge.net  ---W-W----
      wolski@molgen.mpg.de

From tplate at blackmesacapital.com  Wed Sep 29 18:37:19 2004
From: tplate at blackmesacapital.com (Tony Plate)
Date: Wed Sep 29 18:37:27 2004
Subject: [Rd] Ordering of values returned by unique
In-Reply-To: <6.1.0.6.2.20040929094231.05e42a00@mailhost.blackmesacapita l.com>
References: <415AD222.4050908@molgen.mpg.de>
	<6.1.0.6.2.20040929094231.05e42a00@mailhost.blackmesacapital.com>
Message-ID: <6.1.0.6.2.20040929103553.05eb1248@mailhost.blackmesacapital.com>

At Wednesday 10:09 AM 9/29/2004, I wrote:
>[snip]

>So, I think the evidence is pretty strong that unique(x) will always 
>return elements in the same order as they first appear in x.  But it would 
>be nice if the documentation for 'unique' explicitly stated that this is 
>the behavior for all methods.  (It does state this for the array method 
>for 'unique').

My mistake.  The documentation for 'unique' does actually state this in the 
"VALUE" section, as Eryk points out.

-- Tony Plate

From efg at stowers-institute.org  Wed Sep 29 18:39:52 2004
From: efg at stowers-institute.org (Earl F. Glynn)
Date: Wed Sep 29 19:00:35 2004
Subject: [Rd] Ordering of values returned by unique
References: <415AD222.4050908@molgen.mpg.de>
	<6.1.0.6.2.20040929094231.05e42a00@mailhost.blackmesacapital.com>
Message-ID: <cjeogs$hjh$1@sea.gmane.org>

"Tony Plate" <tplate@blackmesacapital.com> wrote in message
news:6.1.0.6.2.20040929094231.05e42a00@mailhost.blackmesacapital.com...
> I depend on this all the time, so I also checked some references.  In the
> Blue book the documentation for the functions unique and duplicated is
> combined and implies the above.  In MASS 4th Ed, the page referred to by
> the index entry for 'unique' (p48, #9 in my copy) states that 'unique'
> removes duplicates as identified by 'duplicated', which implies that the
> order of retained elements is not changed.  The Green book has no index
> entry for 'unique'.  In S-plus the implementation of unique.default(x)
uses
> x[!duplicated(x)].

So what is the "Blue book", the "Green book", and MASS 4th Ed?

efg

From wolski at molgen.mpg.de  Wed Sep 29 19:20:31 2004
From: wolski at molgen.mpg.de (Wolski)
Date: Wed Sep 29 19:20:35 2004
Subject: [Rd] Problem with _new_  if  class "lm" in object representation.
Message-ID: <200409291920310735.30925C98@mail.math.fu-berlin.de>

Hi!
Consider this code.


setClass("Ctest"
	,representation(
		test="character"
		,bla="character"
		,mod="lm" 
		)
	)
	
new("Ctest",test="bla")                     #This produces an error.

#Error in validObject(.Object) : Invalid "Ctest" object: Invalid object for slot "mod" in class "Ctest": got class "NULL", should be or extend class "lm"



setClass("Ctest"
	,representation(
		test="character"
		,bla="character"
		,mod="character"                # its the only with the class definition above.
	)
	)
new("Ctest",test="bla")                         #this works as I would expect.

#An object of class "Ctest"
#Slot "test":
#[1] "bla"
#
#Slot "bla":
#character(0)
#
#Slot "mod":
#character(0)


Thought that this is due to that the class lm has no lm(0) object. Hence i tried

setClass("brum",representation(brum="brum"))
setClass("Ctest"
	,representation(
		test="character"
		,bla="character"
		,mod="brum"                # its the only with the class definition above.
	)
	)

new("Ctest",test="best")  #but this works to.

From tplate at blackmesacapital.com  Wed Sep 29 19:23:42 2004
From: tplate at blackmesacapital.com (Tony Plate)
Date: Wed Sep 29 19:24:05 2004
Subject: [Rd] Ordering of values returned by unique
In-Reply-To: <cjeogs$hjh$1@sea.gmane.org>
References: <415AD222.4050908@molgen.mpg.de>
	<6.1.0.6.2.20040929094231.05e42a00@mailhost.blackmesacapital.com>
	<cjeogs$hjh$1@sea.gmane.org>
Message-ID: <6.1.0.6.2.20040929112035.05eee5d0@mailhost.blackmesacapital.com>

"Blue book" and "Green book" are nicknames for books that are primary 
references for the S language, see FAQ 3.1.

"MASS 4th Ed" is W. N. Venables and B. D. Ripley (2002), "Modern Applied 
Statistics with S. Fourth Edition". Springer, ISBN 0-387-95457-0

At Wednesday 10:39 AM 9/29/2004, Earl F. Glynn wrote:
>"Tony Plate" <tplate@blackmesacapital.com> wrote in message
>news:6.1.0.6.2.20040929094231.05e42a00@mailhost.blackmesacapital.com...
> > I depend on this all the time, so I also checked some references.  In the
> > Blue book the documentation for the functions unique and duplicated is
> > combined and implies the above.  In MASS 4th Ed, the page referred to by
> > the index entry for 'unique' (p48, #9 in my copy) states that 'unique'
> > removes duplicates as identified by 'duplicated', which implies that the
> > order of retained elements is not changed.  The Green book has no index
> > entry for 'unique'.  In S-plus the implementation of unique.default(x)
>uses
> > x[!duplicated(x)].
>
>So what is the "Blue book", the "Green book", and MASS 4th Ed?
>
>efg
>
>______________________________________________
>R-devel@stat.math.ethz.ch mailing list
>https://stat.ethz.ch/mailman/listinfo/r-devel

From wolski at molgen.mpg.de  Wed Sep 29 19:25:06 2004
From: wolski at molgen.mpg.de (Witold Eryk Wolski)
Date: Wed Sep 29 19:25:13 2004
Subject: [Rd] Ordering of values returned by unique
In-Reply-To: <cjeogs$hjh$1@sea.gmane.org>
References: <415AD222.4050908@molgen.mpg.de>	<6.1.0.6.2.20040929094231.05e42a00@mailhost.blackmesacapital.com>
	<cjeogs$hjh$1@sea.gmane.org>
Message-ID: <415AEFF2.5070501@molgen.mpg.de>

Hi,

If you go to the frame on www.r-project.org -> documentation -> publication
and search for "blue book" "green book" you will find that this refers to
two books :
/"The New S Language"
//"Programming with Data"
respectively
/
Mass refers to "/Modern Applied Statistics with S"/
/E

Earl F. Glynn wrote:

>"Tony Plate" <tplate@blackmesacapital.com> wrote in message
>news:6.1.0.6.2.20040929094231.05e42a00@mailhost.blackmesacapital.com...
>  
>
>>I depend on this all the time, so I also checked some references.  In the
>>Blue book the documentation for the functions unique and duplicated is
>>combined and implies the above.  In MASS 4th Ed, the page referred to by
>>the index entry for 'unique' (p48, #9 in my copy) states that 'unique'
>>removes duplicates as identified by 'duplicated', which implies that the
>>order of retained elements is not changed.  The Green book has no index
>>entry for 'unique'.  In S-plus the implementation of unique.default(x)
>>    
>>
>uses
>  
>
>>x[!duplicated(x)].
>>    
>>
>
>So what is the "Blue book", the "Green book", and MASS 4th Ed?
>
>efg
>
>______________________________________________
>R-devel@stat.math.ethz.ch mailing list
>https://stat.ethz.ch/mailman/listinfo/r-devel
>
>  
>


-- 
Dipl. bio-chem. Witold Eryk Wolski         
MPI-Moleculare Genetic
Ihnestrasse 63-73 14195 Berlin           _
tel: 0049-30-83875219                   'v'
http://www.molgen.mpg.de/~wolski       /   \
mail: witek96@users.sourceforge.net  ---W-W----
      wolski@molgen.mpg.de

From jmc at research.bell-labs.com  Wed Sep 29 20:16:11 2004
From: jmc at research.bell-labs.com (John Chambers)
Date: Wed Sep 29 20:16:30 2004
Subject: [Rd] Problem with _new_ if class "lm" in object representation.
References: <200409291920310735.30925C98@mail.math.fu-berlin.de>
Message-ID: <415AFBEB.8C1F58B4@research.bell-labs.com>

Wolski wrote:
> 
> Hi!
> Consider this code.
> 
> setClass("Ctest"
>         ,representation(
>                 test="character"
>                 ,bla="character"
>                 ,mod="lm"
>                 )
>         )
> 
> new("Ctest",test="bla")                     #This produces an error.
> 
> #Error in validObject(.Object) : Invalid "Ctest" object: Invalid object for slot "mod" in class "Ctest": got class "NULL", should be or extend class "lm"

And the error message is correct.  Since "lm" is an S3 class, there is
no way to generate an object automatically from it.  new("lm") will also
produce an error.

If you want objects to be generated from your class with a default "lm"
object, you have to first decide what that is.  Assuming you know, you
need to either put that element into the protoype for the class, or have
a method for initialize() that does something sensible, using the rest
of the data in the object.

The prototype solution could look something like:

R> lm0 = lm(1~1)
R> setClass("Ctest", representation(test = "character", 
    bla = "character", mod = "lm"), prototype=prototype(mod = lm0))
R> new("Ctest", test="bla")
An object of class "Ctest"
Slot "test":
[1] "bla"

Slot "bla":
character(0)

Slot "mod":

Call:
lm(formula = 1 ~ 1)

Coefficients:
(Intercept)  
          1  


There is no automatic relation between the class "lm" and the function
lm().  The green book recommends having a generator function, but the R
code can't assume this has been done.

> 
> setClass("Ctest"
>         ,representation(
>                 test="character"
>                 ,bla="character"
>                 ,mod="character"                # its the only with the class definition above.
>         )
>         )
> new("Ctest",test="bla")                         #this works as I would expect.
> 
> #An object of class "Ctest"
> #Slot "test":
> #[1] "bla"
> #
> #Slot "bla":
> #character(0)
> #
> #Slot "mod":
> #character(0)
> 
> Thought that this is due to that the class lm has no lm(0) object. Hence i tried
> 
> setClass("brum",representation(brum="brum"))
> setClass("Ctest"
>         ,representation(
>                 test="character"
>                 ,bla="character"
>                 ,mod="brum"                # its the only with the class definition above.
>         )
>         )
> 
> new("Ctest",test="best")  #but this works to.
> 
> ______________________________________________
> R-devel@stat.math.ethz.ch mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
John M. Chambers                  jmc@bell-labs.com
Bell Labs, Lucent Technologies    office: (908)582-2681
700 Mountain Avenue, Room 2C-282  fax:    (908)582-3340
Murray Hill, NJ  07974            web: http://www.cs.bell-labs.com/~jmc

From wolski at molgen.mpg.de  Wed Sep 29 21:09:14 2004
From: wolski at molgen.mpg.de (Witold Eryk Wolski)
Date: Wed Sep 29 21:09:32 2004
Subject: [Rd] Problem with _new_ if class "lm" in object representation.
In-Reply-To: <415AFBEB.8C1F58B4@research.bell-labs.com>
References: <200409291920310735.30925C98@mail.math.fu-berlin.de>
	<415AFBEB.8C1F58B4@research.bell-labs.com>
Message-ID: <415B085A.9010109@molgen.mpg.de>

Hi,
The hint to use an lm0 instance in the protopy is a solution.

But I thought about a different solution to which I got used. This is to 
declare class "lm" as an S4 class by setClass("lm"). This is because I 
have to do it anyway quite frequently when using S3 classes, declared  
in contributed packages, in S4 classes.
Please consider the following code with this quite recent version 
generating a warning.
R : Copyright 2004, The R Foundation for Statistical Computing
Version 2.0.0 beta (2004-09-20), ISBN 3-900051-07-0

#I like to have an object which  contains an object of class fields:Krig.

library(fields)

setClass("Ctest"
        ,representation(
                test="character"
                ,bla="character"
                ,mod="Krig"
                )
        )

#Warning message: 
#Undefined slot classes in definition of "Ctest": mod (class " Krig ") in: .completeClassSlots(ClassDef, where) 

The overcome this warning i just modify the code adding

setClass("Krig")
setClass("Ctest"
        ,representation(
....

previous to defining class Ctest.
This is my working solution. But this one does not work with class "lm". 
Since,

 > setClass("lm")
Error in setClass("lm") : "lm" has a sealed class definition and cannot 
be redefined

I understand the errror message but I can't see the difference between 
class Krig and lm which are both S3 classes. (of course except that lm 
is in in THE stats package)
Is it intended to keep two different "models" of treating S3 classes? 
One for S3 class from the recomended, "base" packages and a different 
one for S3 classes from contributed packages? I assume not.
If, so I feel a alienated because my code so far rely on the behaviour 
which I observed for S3/contributed classes.


/E,

John Chambers wrote:

>Wolski wrote:
>  
>
>>Hi!
>>Consider this code.
>>
>>setClass("Ctest"
>>        ,representation(
>>                test="character"
>>                ,bla="character"
>>                ,mod="lm"
>>                )
>>        )
>>
>>new("Ctest",test="bla")                     #This produces an error.
>>
>>#Error in validObject(.Object) : Invalid "Ctest" object: Invalid object for slot "mod" in class "Ctest": got class "NULL", should be or extend class "lm"
>>    
>>
>
>And the error message is correct.  Since "lm" is an S3 class, there is
>no way to generate an object automatically from it.  new("lm") will also
>produce an error.
>
>If you want objects to be generated from your class with a default "lm"
>object, you have to first decide what that is.  Assuming you know, you
>need to either put that element into the protoype for the class, or have
>a method for initialize() that does something sensible, using the rest
>of the data in the object.
>
>The prototype solution could look something like:
>
>R> lm0 = lm(1~1)
>R> setClass("Ctest", representation(test = "character", 
>    bla = "character", mod = "lm"), prototype=prototype(mod = lm0))
>R> new("Ctest", test="bla")
>An object of class "Ctest"
>Slot "test":
>[1] "bla"
>
>Slot "bla":
>character(0)
>
>Slot "mod":
>
>Call:
>lm(formula = 1 ~ 1)
>
>Coefficients:
>(Intercept)  
>          1  
>
>
>There is no automatic relation between the class "lm" and the function
>lm().  The green book recommends having a generator function, but the R
>code can't assume this has been done.
>
>  
>
>>setClass("Ctest"
>>        ,representation(
>>                test="character"
>>                ,bla="character"
>>                ,mod="character"                # its the only with the class definition above.
>>        )
>>        )
>>new("Ctest",test="bla")                         #this works as I would expect.
>>
>>#An object of class "Ctest"
>>#Slot "test":
>>#[1] "bla"
>>#
>>#Slot "bla":
>>#character(0)
>>#
>>#Slot "mod":
>>#character(0)
>>
>>Thought that this is due to that the class lm has no lm(0) object. Hence i tried
>>
>>setClass("brum",representation(brum="brum"))
>>setClass("Ctest"
>>        ,representation(
>>                test="character"
>>                ,bla="character"
>>                ,mod="brum"                # its the only with the class definition above.
>>        )
>>        )
>>
>>new("Ctest",test="best")  #but this works to.
>>
>>______________________________________________
>>R-devel@stat.math.ethz.ch mailing list
>>https://stat.ethz.ch/mailman/listinfo/r-devel
>>    
>>
>
>  
>


-- 
Dipl. bio-chem. Witold Eryk Wolski         
MPI-Moleculare Genetic
Ihnestrasse 63-73 14195 Berlin           _
tel: 0049-30-83875219                   'v'
http://www.molgen.mpg.de/~wolski       /   \
mail: witek96@users.sourceforge.net  ---W-W----
      wolski@molgen.mpg.de

From jmc at research.bell-labs.com  Wed Sep 29 21:34:02 2004
From: jmc at research.bell-labs.com (John Chambers)
Date: Wed Sep 29 21:34:15 2004
Subject: [Rd] Problem with _new_ if class "lm" in object representation.
References: <200409291920310735.30925C98@mail.math.fu-berlin.de>
	<415AFBEB.8C1F58B4@research.bell-labs.com>
	<415B085A.9010109@molgen.mpg.de>
Message-ID: <415B0E2A.1EB9FE80@research.bell-labs.com>

Witold Eryk Wolski wrote:
> 
> Hi,
> The hint to use an lm0 instance in the protopy is a solution.
> 
> But I thought about a different solution to which I got used. This is to
> declare class "lm" as an S4 class by setClass("lm"). 

It's a good idea to declare S3 classes, but that's not the way to do
it.  If you want to use an S3 class as an S4 class, that's what
setOldClass() is for.  See the green book or the documentation.

Why doesn't that work for "lm"?   As the error message says below, "lm"
is already defined in this way & sealed, just as other standard classes
are sealed.

This is NOT a solution to your previous problem, however, since it's
still totally unknown what a default object from an S3 class should be
like.

You will still get an error from new("Ctest", test = "bla") if you have
an undefined slot from an S3 class, or any other VIRTUAL class.  (It
happens that new("Ctest") doesn't fail because if there are no arguments
to new() other than the class name, the validity method isn't called.)

Your "working" solution doesn't work, as in the following simpler
example:

R> setClass("bar")
[1] "bar"
R> setClass("foo", representation(x="numeric", y="bar"))
R> new("foo", x=1)
Error in validObject(.Object) : Invalid "foo" object: Invalid object for
slot "y" in class "foo": got class "NULL", should be or extend class
"bar"

(We should in fact warn on the call to setClass() in this case, since
the protoype object is not a valid object from the class.  For 2.0.1)

> This is because I
> have to do it anyway quite frequently when using S3 classes, declared
> in contributed packages, in S4 classes.
> Please consider the following code with this quite recent version
> generating a warning.
> R : Copyright 2004, The R Foundation for Statistical Computing
> Version 2.0.0 beta (2004-09-20), ISBN 3-900051-07-0
> 
> #I like to have an object which  contains an object of class fields:Krig.
> 
> library(fields)
> 
> setClass("Ctest"
>         ,representation(
>                 test="character"
>                 ,bla="character"
>                 ,mod="Krig"
>                 )
>         )
> 
> #Warning message:
> #Undefined slot classes in definition of "Ctest": mod (class " Krig ") in: .completeClassSlots(ClassDef, where)
> 
> The overcome this warning i just modify the code adding
> 
> setClass("Krig")
> setClass("Ctest"
>         ,representation(
> ....
> 
> previous to defining class Ctest.
> This is my working solution. But this one does not work with class "lm".
> Since,
> 
>  > setClass("lm")
> Error in setClass("lm") : "lm" has a sealed class definition and cannot
> be redefined
> 
> I understand the errror message but I can't see the difference between
> class Krig and lm which are both S3 classes. (of course except that lm
> is in in THE stats package)
> Is it intended to keep two different "models" of treating S3 classes?
> One for S3 class from the recomended, "base" packages and a different
> one for S3 classes from contributed packages? I assume not.
> If, so I feel a alienated because my code so far rely on the behaviour
> which I observed for S3/contributed classes.
> 
> /E,
> 
> John Chambers wrote:
> 
> >Wolski wrote:
> >
> >
> >>Hi!
> >>Consider this code.
> >>
> >>setClass("Ctest"
> >>        ,representation(
> >>                test="character"
> >>                ,bla="character"
> >>                ,mod="lm"
> >>                )
> >>        )
> >>
> >>new("Ctest",test="bla")                     #This produces an error.
> >>
> >>#Error in validObject(.Object) : Invalid "Ctest" object: Invalid object for slot "mod" in class "Ctest": got class "NULL", should be or extend class "lm"
> >>
> >>
> >
> >And the error message is correct.  Since "lm" is an S3 class, there is
> >no way to generate an object automatically from it.  new("lm") will also
> >produce an error.
> >
> >If you want objects to be generated from your class with a default "lm"
> >object, you have to first decide what that is.  Assuming you know, you
> >need to either put that element into the protoype for the class, or have
> >a method for initialize() that does something sensible, using the rest
> >of the data in the object.
> >
> >The prototype solution could look something like:
> >
> >R> lm0 = lm(1~1)
> >R> setClass("Ctest", representation(test = "character",
> >    bla = "character", mod = "lm"), prototype=prototype(mod = lm0))
> >R> new("Ctest", test="bla")
> >An object of class "Ctest"
> >Slot "test":
> >[1] "bla"
> >
> >Slot "bla":
> >character(0)
> >
> >Slot "mod":
> >
> >Call:
> >lm(formula = 1 ~ 1)
> >
> >Coefficients:
> >(Intercept)
> >          1
> >
> >
> >There is no automatic relation between the class "lm" and the function
> >lm().  The green book recommends having a generator function, but the R
> >code can't assume this has been done.
> >
> >
> >
> >>setClass("Ctest"
> >>        ,representation(
> >>                test="character"
> >>                ,bla="character"
> >>                ,mod="character"                # its the only with the class definition above.
> >>        )
> >>        )
> >>new("Ctest",test="bla")                         #this works as I would expect.
> >>
> >>#An object of class "Ctest"
> >>#Slot "test":
> >>#[1] "bla"
> >>#
> >>#Slot "bla":
> >>#character(0)
> >>#
> >>#Slot "mod":
> >>#character(0)
> >>
> >>Thought that this is due to that the class lm has no lm(0) object. Hence i tried
> >>
> >>setClass("brum",representation(brum="brum"))
> >>setClass("Ctest"
> >>        ,representation(
> >>                test="character"
> >>                ,bla="character"
> >>                ,mod="brum"                # its the only with the class definition above.
> >>        )
> >>        )
> >>
> >>new("Ctest",test="best")  #but this works to.
> >>
> >>______________________________________________
> >>R-devel@stat.math.ethz.ch mailing list
> >>https://stat.ethz.ch/mailman/listinfo/r-devel
> >>
> >>
> >
> >
> >
> 
> --
> Dipl. bio-chem. Witold Eryk Wolski
> MPI-Moleculare Genetic
> Ihnestrasse 63-73 14195 Berlin           _
> tel: 0049-30-83875219                   'v'
> http://www.molgen.mpg.de/~wolski       /   \
> mail: witek96@users.sourceforge.net  ---W-W----
>       wolski@molgen.mpg.de

-- 
John M. Chambers                  jmc@bell-labs.com
Bell Labs, Lucent Technologies    office: (908)582-2681
700 Mountain Avenue, Room 2C-282  fax:    (908)582-3340
Murray Hill, NJ  07974            web: http://www.cs.bell-labs.com/~jmc

From wolski at molgen.mpg.de  Wed Sep 29 22:23:37 2004
From: wolski at molgen.mpg.de (Witold Eryk Wolski)
Date: Wed Sep 29 22:23:54 2004
Subject: [Rd] Problem with _new_ if class "lm" in object representation.
In-Reply-To: <415B0E2A.1EB9FE80@research.bell-labs.com>
References: <200409291920310735.30925C98@mail.math.fu-berlin.de>
	<415AFBEB.8C1F58B4@research.bell-labs.com>
	<415B085A.9010109@molgen.mpg.de>
	<415B0E2A.1EB9FE80@research.bell-labs.com>
Message-ID: <415B19C9.4020403@molgen.mpg.de>

Hi,

Thanks a lot for pointing me to setOldClass().

What is exactly the point against it, to allow NULL to be a special case 
which can be assigned to any slot? I think in java one can assing null 
to any slot (I do not like java but not because of that).
I am asking because for some objects it may be hard to define something 
equivalent to numeric(0). And even lm(1~1) is not that what I am looking 
for. I would like to have the case
of an unassigned slot (Just think about storage?) even to the expense 
checking every time if the slot is not null.


There are of course more solutions. Since the validity method is not 
called  I can do:
dd<-new("Ctest")
dd@test<-"bla"

Or of course as you have mentioned to write an initialization method. 
But this points me to a further question.
How to write a good initialization method which covers all possible 
cases? In programming languages like C and java you can provide 
different types of constructors.
But in S4 you can provide just one method initialize?
How to handle for example

new("Ctest",mod=lm(1~1))
new("Ctest",test="bla")
new("Ctest",bla="brum")
and
new("Ctest",test="bla",bla="brum")

within one initialization function? Using match.call? missing is not 
enough I think.


/E

setClass("Ctest"
	,representation(
		test="character"
		,bla="character"
		,mod="lm" 
		)
	)
	



John Chambers wrote:

>Witold Eryk Wolski wrote:
>  
>
>>Hi,
>>The hint to use an lm0 instance in the protopy is a solution.
>>
>>But I thought about a different solution to which I got used. This is to
>>declare class "lm" as an S4 class by setClass("lm"). 
>>    
>>
>
>It's a good idea to declare S3 classes, but that's not the way to do
>it.  If you want to use an S3 class as an S4 class, that's what
>setOldClass() is for.  See the green book or the documentation.
>
>Why doesn't that work for "lm"?   As the error message says below, "lm"
>is already defined in this way & sealed, just as other standard classes
>are sealed.
>
>This is NOT a solution to your previous problem, however, since it's
>still totally unknown what a default object from an S3 class should be
>like.
>
>You will still get an error from new("Ctest", test = "bla") if you have
>an undefined slot from an S3 class, or any other VIRTUAL class.  (It
>happens that new("Ctest") doesn't fail because if there are no arguments
>to new() other than the class name, the validity method isn't called.)
>
>Your "working" solution doesn't work, as in the following simpler
>example:
>
>R> setClass("bar")
>[1] "bar"
>R> setClass("foo", representation(x="numeric", y="bar"))
>R> new("foo", x=1)
>Error in validObject(.Object) : Invalid "foo" object: Invalid object for
>slot "y" in class "foo": got class "NULL", should be or extend class
>"bar"
>
>(We should in fact warn on the call to setClass() in this case, since
>the protoype object is not a valid object from the class.  For 2.0.1)
>
>  
>
>>This is because I
>>have to do it anyway quite frequently when using S3 classes, declared
>>in contributed packages, in S4 classes.
>>Please consider the following code with this quite recent version
>>generating a warning.
>>R : Copyright 2004, The R Foundation for Statistical Computing
>>Version 2.0.0 beta (2004-09-20), ISBN 3-900051-07-0
>>
>>#I like to have an object which  contains an object of class fields:Krig.
>>
>>library(fields)
>>
>>setClass("Ctest"
>>        ,representation(
>>                test="character"
>>                ,bla="character"
>>                ,mod="Krig"
>>                )
>>        )
>>
>>#Warning message:
>>#Undefined slot classes in definition of "Ctest": mod (class " Krig ") in: .completeClassSlots(ClassDef, where)
>>
>>The overcome this warning i just modify the code adding
>>
>>setClass("Krig")
>>setClass("Ctest"
>>        ,representation(
>>....
>>
>>previous to defining class Ctest.
>>This is my working solution. But this one does not work with class "lm".
>>Since,
>>
>> > setClass("lm")
>>Error in setClass("lm") : "lm" has a sealed class definition and cannot
>>be redefined
>>
>>I understand the errror message but I can't see the difference between
>>class Krig and lm which are both S3 classes. (of course except that lm
>>is in in THE stats package)
>>Is it intended to keep two different "models" of treating S3 classes?
>>One for S3 class from the recomended, "base" packages and a different
>>one for S3 classes from contributed packages? I assume not.
>>If, so I feel a alienated because my code so far rely on the behaviour
>>which I observed for S3/contributed classes.
>>
>>/E,
>>
>>John Chambers wrote:
>>
>>    
>>
>>>Wolski wrote:
>>>
>>>
>>>      
>>>
>>>>Hi!
>>>>Consider this code.
>>>>
>>>>setClass("Ctest"
>>>>       ,representation(
>>>>               test="character"
>>>>               ,bla="character"
>>>>               ,mod="lm"
>>>>               )
>>>>       )
>>>>
>>>>new("Ctest",test="bla")                     #This produces an error.
>>>>
>>>>#Error in validObject(.Object) : Invalid "Ctest" object: Invalid object for slot "mod" in class "Ctest": got class "NULL", should be or extend class "lm"
>>>>
>>>>
>>>>        
>>>>
>>>And the error message is correct.  Since "lm" is an S3 class, there is
>>>no way to generate an object automatically from it.  new("lm") will also
>>>produce an error.
>>>
>>>If you want objects to be generated from your class with a default "lm"
>>>object, you have to first decide what that is.  Assuming you know, you
>>>need to either put that element into the protoype for the class, or have
>>>a method for initialize() that does something sensible, using the rest
>>>of the data in the object.
>>>
>>>The prototype solution could look something like:
>>>
>>>R> lm0 = lm(1~1)
>>>R> setClass("Ctest", representation(test = "character",
>>>   bla = "character", mod = "lm"), prototype=prototype(mod = lm0))
>>>R> new("Ctest", test="bla")
>>>An object of class "Ctest"
>>>Slot "test":
>>>[1] "bla"
>>>
>>>Slot "bla":
>>>character(0)
>>>
>>>Slot "mod":
>>>
>>>Call:
>>>lm(formula = 1 ~ 1)
>>>
>>>Coefficients:
>>>(Intercept)
>>>         1
>>>
>>>
>>>There is no automatic relation between the class "lm" and the function
>>>lm().  The green book recommends having a generator function, but the R
>>>code can't assume this has been done.
>>>
>>>
>>>
>>>      
>>>
>>>>setClass("Ctest"
>>>>       ,representation(
>>>>               test="character"
>>>>               ,bla="character"
>>>>               ,mod="character"                # its the only with the class definition above.
>>>>       )
>>>>       )
>>>>new("Ctest",test="bla")                         #this works as I would expect.
>>>>
>>>>#An object of class "Ctest"
>>>>#Slot "test":
>>>>#[1] "bla"
>>>>#
>>>>#Slot "bla":
>>>>#character(0)
>>>>#
>>>>#Slot "mod":
>>>>#character(0)
>>>>
>>>>Thought that this is due to that the class lm has no lm(0) object. Hence i tried
>>>>
>>>>setClass("brum",representation(brum="brum"))
>>>>setClass("Ctest"
>>>>       ,representation(
>>>>               test="character"
>>>>               ,bla="character"
>>>>               ,mod="brum"                # its the only with the class definition above.
>>>>       )
>>>>       )
>>>>
>>>>new("Ctest",test="best")  #but this works to.
>>>>
>>>>______________________________________________
>>>>R-devel@stat.math.ethz.ch mailing list
>>>>https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>
>>>>
>>>>        
>>>>
>>>
>>>      
>>>
>>--
>>Dipl. bio-chem. Witold Eryk Wolski
>>MPI-Moleculare Genetic
>>Ihnestrasse 63-73 14195 Berlin           _
>>tel: 0049-30-83875219                   'v'
>>http://www.molgen.mpg.de/~wolski       /   \
>>mail: witek96@users.sourceforge.net  ---W-W----
>>      wolski@molgen.mpg.de
>>    
>>
>
>  
>


-- 
Dipl. bio-chem. Witold Eryk Wolski         
MPI-Moleculare Genetic
Ihnestrasse 63-73 14195 Berlin           _
tel: 0049-30-83875219                   'v'
http://www.molgen.mpg.de/~wolski       /   \
mail: witek96@users.sourceforge.net  ---W-W----
      wolski@molgen.mpg.de

From Bernhard.Pfaff at drkw.com  Thu Sep 30 12:33:29 2004
From: Bernhard.Pfaff at drkw.com (Pfaff, Bernhard)
Date: Thu Sep 30 12:33:36 2004
Subject: [Rd] Documentation: Reference Index (.pdf) -- setOldClass (PR#7254)
Message-ID: <18D602BD42B7E24EB810D6454A58DB900A29BB7D@ibfftce505.de.ad.drkw.net>

Apologies for cross postings or manual work caused by resending; the
intially sent bug report through the web-interface bounced, however.


Full_Name: Bernhard Pfaff
Version: 1.9.1
OS: Windows NT
Submission from: (NULL) (193.194.7.77)


Dear core team members / maintainers,

in the pdf version of the reference index I observed two entries of
"setOldClass" in the bookmark section of Adobe Acrobat Reader. Furthermore,
the
second bookmark entry points to **4.1 setOldClass** which is type setted out
of
the context.
This ill-typesetting does however not occur in the html-versions; I have
checked
my locally one installed version (i.e. help.start()), as well as the R-devel
version at: 
http://stat.ethz.ch/R-manual/R-devel/library/methods/html/00Index.html

I have also checked the submitted bug reports in the documentation section
and
it seemed that this one has not been detected by now.

Best,
Bernhard



--------------------------------------------------------------------------------
The information contained herein is confidential and is inte...{{dropped}}

From wolski at molgen.mpg.de  Thu Sep 30 14:35:43 2004
From: wolski at molgen.mpg.de (Witold Eryk Wolski)
Date: Thu Sep 30 14:35:49 2004
Subject: [Rd] Problem with _new_ if class "lm" in object representatio n.
In-Reply-To: <18D602BD42B7E24EB810D6454A58DB900A29BB79@ibfftce505.de.ad.drkw.net>
References: <18D602BD42B7E24EB810D6454A58DB900A29BB79@ibfftce505.de.ad.drkw.net>
Message-ID: <415BFD9F.2080101@molgen.mpg.de>

Hi,

But "any" rises some other problems well known from S3. One has "any" 
for "free" in S3. You don't need S4. . But I know how "if" polluted 
functions  look like in S3. They are hard to understand and  to 
maintain. Hence I am quite happy to use S4.
Type-checking is usefull if you program with data. Also if you are on 
the "C side" of the object. A further problem which I have with "any" 
is, that lm="any" in setClass tells you exactly ANYthing (and you are 
back in S3). And thats not what I like.*
Hence, I do not want to use any in this case.

I think that allowing to assing NULL to a slot will solve some problems 
which I have with S4 so far.

a) How to express that an a slot content was not assigned so far? J.C. 
suggest to use character(0), lm(1~1) etc. The problem I have with 
insterting lm(1~1) in slot mod in my class Ctest are that I have 100000 
instances of object Ctest. At initialization everyone contains an object 
lm(1~1). But please  note the following.

 > x<-lm(1~1)
 > object.size(x)
[1] 6388
 > object.size(NULL)
[1] 0

Unfortunately S4 do not have references. Hence, I can not store a 
reference to a single instance of lm(1~1) .

Exactly the same problems I have if I want to "delete" an object. For 
example you like to have a slot  which stores some data which is 
important if the object is in one state. But if the state of the object 
changes you do not need that data anymore. Hence, you would like to 
delete it to get storage.  You can only do it if you have like you 
suggest "any", but the consequence is "if" polluted code, or using 
slot(obj,"mod",check=FALSE)<- NULL.

But the documentation for slot states.
check: " You should never set this to 'FALSE' in normal
          use, since the result can create invalid objects. "


b) The Problem which I have writing intitialization functions like 
suggested by J.C  is:  Imagine you have an object with twenty slots. You 
have to write and initialize function with approximately 20 "if"'s. One 
of the contribution of S4, as mentioned above, is to help you to avoid 
writing such "if" polluted functions. But as I sometimes forget any role 
has it's exceptions. So I can live with one function looking ugly in S4 
instead of having all functions "if" polluted like in case of S3.  The 
only consequence so far is that I try to avoid to write initialize 
functions. I do it only in some rare very special cases.

The NULL exception in slot assignement will allow me object 
initialization using just "new" without providing a "if" polluted 
function initialize.

 > setClass("bar")
[1] "bar"
 > setClass("foo", representation(x="numeric", y="bar"))
[1] "foo"
 > new("foo", x=1)
Error in validObject(.Object) : Invalid "foo" object: Invalid object for 
slot "y" in class "foo": got class "NULL", should be or extend class "bar"
 >


Are there S4 inherent solutions to this questions?


Yours.
/E

*(I would rather compare "any" to the Object class then to null in java. 
It has a different function.)

Pfaff, Bernhard wrote:

>>Hi,
>>
>>Thanks a lot for pointing me to setOldClass().
>>
>>What is exactly the point against it, to allow NULL to be a 
>>special case 
>>which can be assigned to any slot? I think in java one can 
>>assing null 
>>to any slot (I do not like java but not because of that).
>>I am asking because for some objects it may be hard to define 
>>something 
>>equivalent to numeric(0). And even lm(1~1) is not that what I 
>>am looking 
>>for. I would like to have the case
>>of an unassigned slot (Just think about storage?) even to the expense 
>>checking every time if the slot is not null.
>>    
>>
>
>
>Hello Eryk,
>
>how about "ANY" and checking where suitable/needed if the passed object for
>"mod" is of class "lm" at a later stage in your code, like in:
>
>setClass("Ctest"
>	,representation(
>		test="character"
>		,bla="character"
>		,mod="ANY" 
>		)
>	)
>
>test1 <- new("Ctest",mod=lm(1~1))
>is(test1@mod, "lm")
>
>test2 <- new("Ctest",test="bla")
>is(test2@mod, "lm")
>
>test3 <- new("Ctest",bla="brum")
>is(test3@mod, "lm")
>
>test4 <- new("Ctest",test="bla",bla="brum")
>is(test4@mod, "lm")
>
>>From there on you could use stop() or warning() or whatever you want to
>return to the user as information which class mod should belong to.
>
>HTH,
>Bernhard  
>  
>

From javimunozlara at wanadoo.es  Thu Sep 30 14:49:38 2004
From: javimunozlara at wanadoo.es (javimunozlara@wanadoo.es)
Date: Thu Sep 30 14:49:40 2004
Subject: [Rd] Print multivariate time series (PR#7255)
Message-ID: <20040930124938.69E7210EA7@slim.kubism.ku.dk>

Full_Name: Javier Mu?oz
Version: 1.9.1
OS: Windows NT 4.0
Submission from: (NULL) (193.128.25.20)


The print.ts function don't show properly the information about year for class
mts objects.
An example:

x <- ts(1:24, end = c(2004, 8), frequency = 12)
print(cbind(x, x))

#it shows Jan 2002 instead of Jan 2003

From lecoutre at stat.ucl.ac.be  Thu Sep 30 15:06:53 2004
From: lecoutre at stat.ucl.ac.be (Eric Lecoutre)
Date: Thu Sep 30 15:12:00 2004
Subject: [Rd] Problem with _new_ if class "lm" in object representatio n.
In-Reply-To: <415BFD9F.2080101@molgen.mpg.de>
References: <18D602BD42B7E24EB810D6454A58DB900A29BB79@ibfftce505.de.ad.drkw.net>
	<415BFD9F.2080101@molgen.mpg.de>
Message-ID: <6.0.1.1.2.20040930145247.01faaec0@stat4ux.stat.ucl.ac.be>


Hi,

For your lm problem, you could begin to create a virtual class that accepts 
either NULL or a lm object:

 > setClassUnion("mylm", c("NULL","lm"))
 > setClass("foo", representation(x="numeric", y="mylm"))
 > new("foo",x=1,y=NULL)

Then, you have to check the content of slot y in any function that will 
manipulate objects of class "foo":


         setMethod("show","foo",function(object)
         {
         cat("\n object of class foo")
         if (!is.null(object@y)) cat(" does have a lm object in slot y!")
         })


Eric


At 14:35 30/09/2004, Witold Eryk Wolski wrote:
>Hi,
>
>But "any" rises some other problems well known from S3. One has "any" for 
>"free" in S3. You don't need S4. . But I know how "if" polluted 
>functions  look like in S3. They are hard to understand and  to maintain. 
>Hence I am quite happy to use S4.
>Type-checking is usefull if you program with data. Also if you are on the 
>"C side" of the object. A further problem which I have with "any" is, that 
>lm="any" in setClass tells you exactly ANYthing (and you are back in S3). 
>And thats not what I like.*
>Hence, I do not want to use any in this case.
>
>I think that allowing to assing NULL to a slot will solve some problems 
>which I have with S4 so far.
>
>a) How to express that an a slot content was not assigned so far? J.C. 
>suggest to use character(0), lm(1~1) etc. The problem I have with 
>insterting lm(1~1) in slot mod in my class Ctest are that I have 100000 
>instances of object Ctest. At initialization everyone contains an object 
>lm(1~1). But please  note the following.
>
> > x<-lm(1~1)
> > object.size(x)
>[1] 6388
> > object.size(NULL)
>[1] 0
>
>Unfortunately S4 do not have references. Hence, I can not store a 
>reference to a single instance of lm(1~1) .
>
>Exactly the same problems I have if I want to "delete" an object. For 
>example you like to have a slot  which stores some data which is important 
>if the object is in one state. But if the state of the object changes you 
>do not need that data anymore. Hence, you would like to delete it to get 
>storage.  You can only do it if you have like you suggest "any", but the 
>consequence is "if" polluted code, or using slot(obj,"mod",check=FALSE)<- NULL.
>
>But the documentation for slot states.
>check: " You should never set this to 'FALSE' in normal
>          use, since the result can create invalid objects. "
>
>
>b) The Problem which I have writing intitialization functions like 
>suggested by J.C  is:  Imagine you have an object with twenty slots. You 
>have to write and initialize function with approximately 20 "if"'s. One of 
>the contribution of S4, as mentioned above, is to help you to avoid 
>writing such "if" polluted functions. But as I sometimes forget any role 
>has it's exceptions. So I can live with one function looking ugly in S4 
>instead of having all functions "if" polluted like in case of S3.  The 
>only consequence so far is that I try to avoid to write initialize 
>functions. I do it only in some rare very special cases.
>
>The NULL exception in slot assignement will allow me object initialization 
>using just "new" without providing a "if" polluted function initialize.
>
> > setClass("bar")
>[1] "bar"
> > setClass("foo", representation(x="numeric", y="bar"))
>[1] "foo"
> > new("foo", x=1)
>Error in validObject(.Object) : Invalid "foo" object: Invalid object for 
>slot "y" in class "foo": got class "NULL", should be or extend class "bar"
> >
>
>
>Are there S4 inherent solutions to this questions?
>
>
>Yours.
>/E
>
>*(I would rather compare "any" to the Object class then to null in java. 
>It has a different function.)
>
>Pfaff, Bernhard wrote:
>
>>>Hi,
>>>
>>>Thanks a lot for pointing me to setOldClass().
>>>
>>>What is exactly the point against it, to allow NULL to be a special case 
>>>which can be assigned to any slot? I think in java one can assing null 
>>>to any slot (I do not like java but not because of that).
>>>I am asking because for some objects it may be hard to define something 
>>>equivalent to numeric(0). And even lm(1~1) is not that what I am looking 
>>>for. I would like to have the case
>>>of an unassigned slot (Just think about storage?) even to the expense 
>>>checking every time if the slot is not null.
>>>
>>
>>
>>Hello Eryk,
>>
>>how about "ANY" and checking where suitable/needed if the passed object for
>>"mod" is of class "lm" at a later stage in your code, like in:
>>
>>setClass("Ctest"
>>         ,representation(
>>                 test="character"
>>                 ,bla="character"
>>                 ,mod="ANY"              )
>>         )
>>
>>test1 <- new("Ctest",mod=lm(1~1))
>>is(test1@mod, "lm")
>>
>>test2 <- new("Ctest",test="bla")
>>is(test2@mod, "lm")
>>
>>test3 <- new("Ctest",bla="brum")
>>is(test3@mod, "lm")
>>
>>test4 <- new("Ctest",test="bla",bla="brum")
>>is(test4@mod, "lm")
>>
>> From there on you could use stop() or warning() or whatever you want to
>>return to the user as information which class mod should belong to.
>>
>>HTH,
>>Bernhard
>>
>
>______________________________________________
>R-devel@stat.math.ethz.ch mailing list
>https://stat.ethz.ch/mailman/listinfo/r-devel

Eric Lecoutre
UCL /  Institut de Statistique
Voie du Roman Pays, 20
1348 Louvain-la-Neuve
Belgium

tel: (+32)(0)10473050
lecoutre@stat.ucl.ac.be
http://www.stat.ucl.ac.be/ISpersonnel/lecoutre

If the statistics are boring, then you've got the wrong numbers. -Edward 
Tufte

From wolski at molgen.mpg.de  Thu Sep 30 15:21:01 2004
From: wolski at molgen.mpg.de (Witold Eryk Wolski)
Date: Thu Sep 30 15:21:10 2004
Subject: [Rd] Problem with _new_ if class "lm" in object  representatio n.
In-Reply-To: <6.0.1.1.2.20040930145247.01faaec0@stat4ux.stat.ucl.ac.be>
References: <18D602BD42B7E24EB810D6454A58DB900A29BB79@ibfftce505.de.ad.drkw.net>
	<415BFD9F.2080101@molgen.mpg.de>
	<6.0.1.1.2.20040930145247.01faaec0@stat4ux.stat.ucl.ac.be>
Message-ID: <415C083D.8000106@molgen.mpg.de>

Hi,

Yes indeed. Thanks.

Yours



Eric Lecoutre wrote:

>
> Hi,
>
> For your lm problem, you could begin to create a virtual class that 
> accepts either NULL or a lm object:
>
> > setClassUnion("mylm", c("NULL","lm"))
> > setClass("foo", representation(x="numeric", y="mylm"))
> > new("foo",x=1,y=NULL)
>
> Then, you have to check the content of slot y in any function that 
> will manipulate objects of class "foo":
>
>
>         setMethod("show","foo",function(object)
>         {
>         cat("\n object of class foo")
>         if (!is.null(object@y)) cat(" does have a lm object in slot y!")
>         })
>
>
> Eric
>


-- 
Dipl. bio-chem. Witold Eryk Wolski         
MPI-Moleculare Genetic
Ihnestrasse 63-73 14195 Berlin           _
tel: 0049-30-83875219                   'v'
http://www.molgen.mpg.de/~wolski       /   \
mail: witek96@users.sourceforge.net  ---W-W----
      wolski@molgen.mpg.de

