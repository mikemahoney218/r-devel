From Kurt@Hornik @ending from wu@@c@@t  Sun Jul  1 09:45:40 2018
From: Kurt@Hornik @ending from wu@@c@@t (Kurt Hornik)
Date: Sun, 1 Jul 2018 09:45:40 +0200
Subject: [Rd] Bug 16719: kruskal.test documentation for formula
In-Reply-To: <20180423205935.756F5E508E@mailuser.nyi.internal>
References: <20180423205935.756F5E508E@mailuser.nyi.internal>
Message-ID: <23352.34468.960846.938339@hornik.net>

>>>>> Thomas Levine writes:

Thanks: this is now fixed in the trunk with c74945.

Best
-k

> I submit a couple options for addressing bug 16719: kruskal.test
> documentation for formula.
> https://bugs.r-project.org/bugzilla3/show_bug.cgi?id=16719

> disallow-character.diff changes the documentation and error message
> to indicate that factors are accepted.

> allow-character.diff changes the kruskal.test functions to convert
> character vectors to factors; documentation is updated accordingly.

> I tested the updated functions with the examples in example.R. It is
> based on the examples in the bug report.

> If there is interest in applying either patch, especially the latter,
> I want first to test the change on lots of existing programs that call
> kruskal.test, to see if it causes any regressions. Is there a good place
> to look for programs that use particular R functions?

> I am having trouble building R, so I have so far tested these changes
> only by patching revision 74631 (SVN head) and sourcing the resulting
> kruskal.test.R in R 3.4.1 on OpenBSD 6.2. I thus have not tested the
> R documentation files.
> x[DELETED ATTACHMENT disallow-character.diff, plain text]
> x[DELETED ATTACHMENT allow-character.diff, plain text]
> x[DELETED ATTACHMENT example.R, plain text]
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From wewol@ki @ending from gm@il@com  Mon Jul  2 16:30:17 2018
From: wewol@ki @ending from gm@il@com (Witold E Wolski)
Date: Mon, 2 Jul 2018 16:30:17 +0200
Subject: [Rd] Parametrized Vignettest in R packages
Message-ID: <CAAjnpdhaeX+=RXCmq3g7jwYQZanfvps1q5i5znmynAGqxb1MPw@mail.gmail.com>

Hello,

I have a package which includes some parameterized r-markdown report
which I would also like to build as package vignettes.

Is there a way to run the parameterized vignette creation with the
package build or package check?

Thank you

-- 
Witold Eryk Wolski


From becker@g@be @ending from gene@com  Mon Jul  2 16:34:34 2018
From: becker@g@be @ending from gene@com (Gabe Becker)
Date: Mon, 2 Jul 2018 07:34:34 -0700
Subject: [Rd] Parametrized Vignettest in R packages
In-Reply-To: <CAAjnpdhaeX+=RXCmq3g7jwYQZanfvps1q5i5znmynAGqxb1MPw@mail.gmail.com>
References: <CAAjnpdhaeX+=RXCmq3g7jwYQZanfvps1q5i5znmynAGqxb1MPw@mail.gmail.com>
Message-ID: <CAMFmJskNvcpe-DX3YxebLx0bcozJFpUGnJqNkTPqcO4vEPOCLQ@mail.gmail.com>

Witold,

Vignettes, in the package sense, are and must be entirely self-contained as
far as I know. They are run automatically in completely clean R sessions.
I'm not sure a parameterized vignette makes a ton of sense within that
context.

Can you explain what you would want to have happen when the package is
built that would require parameterization?

~G

On Mon, Jul 2, 2018 at 7:30 AM, Witold E Wolski <wewolski at gmail.com> wrote:

> Hello,
>
> I have a package which includes some parameterized r-markdown report
> which I would also like to build as package vignettes.
>
> Is there a way to run the parameterized vignette creation with the
> package build or package check?
>
> Thank you
>
> --
> Witold Eryk Wolski
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


-- 
Gabriel Becker, Ph.D
Scientist
Bioinformatics and Computational Biology
Genentech Research

	[[alternative HTML version deleted]]


From murdoch@dunc@n @ending from gm@il@com  Mon Jul  2 16:56:10 2018
From: murdoch@dunc@n @ending from gm@il@com (Duncan Murdoch)
Date: Mon, 2 Jul 2018 10:56:10 -0400
Subject: [Rd] Parametrized Vignettest in R packages
In-Reply-To: <CAAjnpdhaeX+=RXCmq3g7jwYQZanfvps1q5i5znmynAGqxb1MPw@mail.gmail.com>
References: <CAAjnpdhaeX+=RXCmq3g7jwYQZanfvps1q5i5znmynAGqxb1MPw@mail.gmail.com>
Message-ID: <129b8986-700f-20bc-fefd-b813df73d06c@gmail.com>

On 02/07/2018 10:30 AM, Witold E Wolski wrote:
> Hello,
> 
> I have a package which includes some parameterized r-markdown report
> which I would also like to build as package vignettes.
> 
> Is there a way to run the parameterized vignette creation with the
> package build or package check?


Doesn't the usual method work?  You can specify defaults for parameters 
in the YAML header; I'd expect those to be the parameter values that get 
used.

You can give instructions to your users on how to rebuild the reports 
with different parameters.

Duncan Murdoch

> 
> Thank you
>


From murdoch@dunc@n @ending from gm@il@com  Mon Jul  2 17:21:28 2018
From: murdoch@dunc@n @ending from gm@il@com (Duncan Murdoch)
Date: Mon, 2 Jul 2018 11:21:28 -0400
Subject: [Rd] Parametrized Vignettest in R packages
In-Reply-To: <CAMFmJskNvcpe-DX3YxebLx0bcozJFpUGnJqNkTPqcO4vEPOCLQ@mail.gmail.com>
References: <CAAjnpdhaeX+=RXCmq3g7jwYQZanfvps1q5i5znmynAGqxb1MPw@mail.gmail.com>
 <CAMFmJskNvcpe-DX3YxebLx0bcozJFpUGnJqNkTPqcO4vEPOCLQ@mail.gmail.com>
Message-ID: <60ded1f0-7bce-477d-be59-f354ca4ff6f2@gmail.com>

On 02/07/2018 10:34 AM, Gabe Becker wrote:
> Witold,
> 
> Vignettes, in the package sense, are and must be entirely self-contained as
> far as I know. They are run automatically in completely clean R sessions.
> I'm not sure a parameterized vignette makes a ton of sense within that
> context.

The defaults for parameters are contained in the source, so a vignette 
using default parameter values would be completely self-contained.

It seems like a good way to document parameterized reports:  Include one 
as a vignette that has more explanation about what the parameters mean, 
how they are used, etc.  Then users can try it out with new parameter 
values before customizing it to their own needs.

Duncan Murdoch

> 
> Can you explain what you would want to have happen when the package is
> built that would require parameterization?
> 
> ~G
> 
> On Mon, Jul 2, 2018 at 7:30 AM, Witold E Wolski <wewolski at gmail.com> wrote:
> 
>> Hello,
>>
>> I have a package which includes some parameterized r-markdown report
>> which I would also like to build as package vignettes.
>>
>> Is there a way to run the parameterized vignette creation with the
>> package build or package check?
>>
>> Thank you
>>
>> --
>> Witold Eryk Wolski
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
> 
>


From wewol@ki @ending from gm@il@com  Mon Jul  2 17:22:54 2018
From: wewol@ki @ending from gm@il@com (Witold E Wolski)
Date: Mon, 2 Jul 2018 17:22:54 +0200
Subject: [Rd] Parametrized Vignettest in R packages
In-Reply-To: <129b8986-700f-20bc-fefd-b813df73d06c@gmail.com>
References: <CAAjnpdhaeX+=RXCmq3g7jwYQZanfvps1q5i5znmynAGqxb1MPw@mail.gmail.com>
 <129b8986-700f-20bc-fefd-b813df73d06c@gmail.com>
Message-ID: <CAAjnpdikxuy=KW1OVQEsqkQRwX8VLfedqwxO9mWzZ=cnijx-ZA@mail.gmail.com>

Hello,

Thank you for the questions as well as remaining me of the default
parameters in the yaml session.
Indeed this seems to be the solution.


But how would I assign package data as a default parameter?
So originally I thought to render the markdown with :

<code>
data(sample_analysis)
data(skylineconfig)
x <- rmarkdown::render("report.Rmd", output_format = "html_document",
                      params = list(data = sample_analysis,
                                    configuration =
skylineconfig),envir = new.env())
<code>

I do not think I can write:

params:
  configuration: !r data(sample_analysis)
  data: !r data(skylineconfig)

since data does not return the package just puts them in the env as a
side effect. Is there a different base function to achieve it.


Thank you
Witek




On 2 July 2018 at 16:56, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
> On 02/07/2018 10:30 AM, Witold E Wolski wrote:
>>
>> Hello,
>>
>> I have a package which includes some parameterized r-markdown report
>> which I would also like to build as package vignettes.
>>
>> Is there a way to run the parameterized vignette creation with the
>> package build or package check?
>
>
>
> Doesn't the usual method work?  You can specify defaults for parameters in
> the YAML header; I'd expect those to be the parameter values that get used.
>
> You can give instructions to your users on how to rebuild the reports with
> different parameters.
>
> Duncan Murdoch
>
>>
>> Thank you
>>
>



-- 
Witold Eryk Wolski


From j@gorecki @ending from wit@edu@pl  Mon Jul  2 17:25:07 2018
From: j@gorecki @ending from wit@edu@pl (Jan Gorecki)
Date: Mon, 2 Jul 2018 17:25:07 +0200
Subject: [Rd] base::mean not consistent about NA/NaN
Message-ID: <CAOO9MKXXtUm=XJc-Wb7k=1ah5yheP-KMfFS3rQKZc7o6GfQF=w@mail.gmail.com>

Hi,
base::mean is not consistent in terms of handling NA/NaN.
Mean should not depend on order of its arguments while currently it is.

    mean(c(NA, NaN))
    #[1] NA
    mean(c(NaN, NA))
    #[1] NaN

I created issue so in case of no replies here status of it can be looked up
at:
https://bugs.r-project.org/bugzilla/show_bug.cgi?id=17441

Best,
Jan

	[[alternative HTML version deleted]]


From i@t@z@hn @ending from gm@il@com  Mon Jul  2 18:20:30 2018
From: i@t@z@hn @ending from gm@il@com (Ista Zahn)
Date: Mon, 2 Jul 2018 12:20:30 -0400
Subject: [Rd] base::mean not consistent about NA/NaN
In-Reply-To: <CAOO9MKXXtUm=XJc-Wb7k=1ah5yheP-KMfFS3rQKZc7o6GfQF=w@mail.gmail.com>
References: <CAOO9MKXXtUm=XJc-Wb7k=1ah5yheP-KMfFS3rQKZc7o6GfQF=w@mail.gmail.com>
Message-ID: <CA+vqiLHW_V27YLiz9xJw4qfr6o4kL6OCSo1zBaanRH1BX9oDug@mail.gmail.com>

The current behavior is as documented. See ?NA, which says

"Numerical computations using ?NA? will normally result in ?NA?: a
     possible exception is where ?NaN? is also involved, in which case
     either might result"

--Ista

On Mon, Jul 2, 2018 at 11:25 AM, Jan Gorecki <j.gorecki at wit.edu.pl> wrote:
> Hi,
> base::mean is not consistent in terms of handling NA/NaN.
> Mean should not depend on order of its arguments while currently it is.
>
>     mean(c(NA, NaN))
>     #[1] NA
>     mean(c(NaN, NA))
>     #[1] NaN
>
> I created issue so in case of no replies here status of it can be looked up
> at:
> https://bugs.r-project.org/bugzilla/show_bug.cgi?id=17441
>
> Best,
> Jan
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From murdoch@dunc@n @ending from gm@il@com  Mon Jul  2 18:21:38 2018
From: murdoch@dunc@n @ending from gm@il@com (Duncan Murdoch)
Date: Mon, 2 Jul 2018 12:21:38 -0400
Subject: [Rd] Parametrized Vignettest in R packages
In-Reply-To: <CAAjnpdikxuy=KW1OVQEsqkQRwX8VLfedqwxO9mWzZ=cnijx-ZA@mail.gmail.com>
References: <CAAjnpdhaeX+=RXCmq3g7jwYQZanfvps1q5i5znmynAGqxb1MPw@mail.gmail.com>
 <129b8986-700f-20bc-fefd-b813df73d06c@gmail.com>
 <CAAjnpdikxuy=KW1OVQEsqkQRwX8VLfedqwxO9mWzZ=cnijx-ZA@mail.gmail.com>
Message-ID: <cafaec59-174f-9259-4d5c-f963299cdf23@gmail.com>

On 02/07/2018 11:22 AM, Witold E Wolski wrote:
> Hello,
> 
> Thank you for the questions as well as remaining me of the default
> parameters in the yaml session.
> Indeed this seems to be the solution.
> 
> 
> But how would I assign package data as a default parameter?
> So originally I thought to render the markdown with :
> 
> <code>
> data(sample_analysis)
> data(skylineconfig)
> x <- rmarkdown::render("report.Rmd", output_format = "html_document",
>                        params = list(data = sample_analysis,
>                                      configuration =
> skylineconfig),envir = new.env())
> <code>
> 
> I do not think I can write:
> 
> params:
>    configuration: !r data(sample_analysis)
>    data: !r data(skylineconfig)
> 
> since data does not return the package just puts them in the env as a
> side effect. Is there a different base function to achieve it.

I think you could use

  params:
   configuration: !r get(data(sample_analysis))
   data: !r get(data(skylineconfig))

but if that doesn't work, a longer version is

  params:
   configuration: !r {data(sample_analysis); sample_analysis}
   data: !r {data(skylineconfig); skylineconfig}

Duncan Murdoch

> 
> 
> Thank you
> Witek
> 
> 
> 
> 
> On 2 July 2018 at 16:56, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
>> On 02/07/2018 10:30 AM, Witold E Wolski wrote:
>>>
>>> Hello,
>>>
>>> I have a package which includes some parameterized r-markdown report
>>> which I would also like to build as package vignettes.
>>>
>>> Is there a way to run the parameterized vignette creation with the
>>> package build or package check?
>>
>>
>>
>> Doesn't the usual method work?  You can specify defaults for parameters in
>> the YAML header; I'd expect those to be the parameter values that get used.
>>
>> You can give instructions to your users on how to rebuild the reports with
>> different parameters.
>>
>> Duncan Murdoch
>>
>>>
>>> Thank you
>>>
>>
> 
> 
>


From murdoch@dunc@n @ending from gm@il@com  Mon Jul  2 18:32:19 2018
From: murdoch@dunc@n @ending from gm@il@com (Duncan Murdoch)
Date: Mon, 2 Jul 2018 12:32:19 -0400
Subject: [Rd] base::mean not consistent about NA/NaN
In-Reply-To: <CAOO9MKXXtUm=XJc-Wb7k=1ah5yheP-KMfFS3rQKZc7o6GfQF=w@mail.gmail.com>
References: <CAOO9MKXXtUm=XJc-Wb7k=1ah5yheP-KMfFS3rQKZc7o6GfQF=w@mail.gmail.com>
Message-ID: <3ec5f4c7-824d-e216-0f07-97a055834386@gmail.com>

On 02/07/2018 11:25 AM, Jan Gorecki wrote:
> Hi,
> base::mean is not consistent in terms of handling NA/NaN.
> Mean should not depend on order of its arguments while currently it is.

The result of mean() can depend on the order even with regular numbers. 
For example,

 > x <- rep(c(1, 10^(-15)), 1000000)
 > mean(sort(x)) - 0.5
[1] 5.551115e-16
 > mean(rev(sort(x))) - 0.5
[1] 0


> 
>      mean(c(NA, NaN))
>      #[1] NA
>      mean(c(NaN, NA))
>      #[1] NaN
> 
> I created issue so in case of no replies here status of it can be looked up
> at:
> https://bugs.r-project.org/bugzilla/show_bug.cgi?id=17441

The help page for ?NaN says,

"Computations involving NaN will return NaN or perhaps NA: which of 
those two is not guaranteed and may depend on the R platform (since 
compilers may re-order computations)."

And ?NA says,

"Numerical computations using NA will normally result in NA: a possible 
exception is where NaN is also involved, in which case either might 
result (which may depend on the R platform). "

So I doubt if this inconsistency will be fixed.

Duncan Murdoch

> 
> Best,
> Jan
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From b@rowling@on @ending from l@nc@@ter@@c@uk  Mon Jul  2 20:28:46 2018
From: b@rowling@on @ending from l@nc@@ter@@c@uk (Barry Rowlingson)
Date: Mon, 2 Jul 2018 19:28:46 +0100
Subject: [Rd] base::mean not consistent about NA/NaN
In-Reply-To: <339fdae8e2a3431c9773b51e2ac93ab9@AM6PR04MB4264.eurprd04.prod.outlook.com>
References: <CAOO9MKXXtUm=XJc-Wb7k=1ah5yheP-KMfFS3rQKZc7o6GfQF=w@mail.gmail.com>
 <339fdae8e2a3431c9773b51e2ac93ab9@AM6PR04MB4264.eurprd04.prod.outlook.com>
Message-ID: <CANVKczPSN6NRVJkwnq3+=RmCxcgQ5OiZAWDoR4qQmNyUeD-PKQ@mail.gmail.com>

And for a starker example of this (documented) inconsistency,
arithmetic addition is not commutative:

 > NA + NaN
 [1] NA
 > NaN + NA
 [1] NaN



On Mon, Jul 2, 2018 at 5:32 PM, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
> On 02/07/2018 11:25 AM, Jan Gorecki wrote:
>> Hi,
>> base::mean is not consistent in terms of handling NA/NaN.
>> Mean should not depend on order of its arguments while currently it is.
>
> The result of mean() can depend on the order even with regular numbers.
> For example,
>
>  > x <- rep(c(1, 10^(-15)), 1000000)
>  > mean(sort(x)) - 0.5
> [1] 5.551115e-16
>  > mean(rev(sort(x))) - 0.5
> [1] 0
>
>
>>
>>      mean(c(NA, NaN))
>>      #[1] NA
>>      mean(c(NaN, NA))
>>      #[1] NaN
>>
>> I created issue so in case of no replies here status of it can be looked up
>> at:
>> https://bugs.r-project.org/bugzilla/show_bug.cgi?id=17441
>
> The help page for ?NaN says,
>
> "Computations involving NaN will return NaN or perhaps NA: which of
> those two is not guaranteed and may depend on the R platform (since
> compilers may re-order computations)."
>
> And ?NA says,
>
> "Numerical computations using NA will normally result in NA: a possible
> exception is where NaN is also involved, in which case either might
> result (which may depend on the R platform). "
>
> So I doubt if this inconsistency will be fixed.
>
> Duncan Murdoch
>
>>
>> Best,
>> Jan
>>
>>       [[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From hp@ge@ @ending from fredhutch@org  Tue Jul  3 00:42:35 2018
From: hp@ge@ @ending from fredhutch@org (=?UTF-8?B?SGVydsOpIFBhZ8Oocw==?=)
Date: Mon, 2 Jul 2018 15:42:35 -0700
Subject: [Rd] MARGIN in base::unique.matrix() and base::unique.array()
Message-ID: <ca23524c-1c26-1ef1-8a26-998effd78219@fredhutch.org>

Hi,

The man page for base::unique.matrix() and base::unique.array() says
that MARGIN is expected to be a single integer. OTOH the code in charge
of checking the user supplied MARGIN is:

     if (length(MARGIN) > ndim || any(MARGIN > ndim))
         stop(gettextf("MARGIN = %d is invalid for dim = %d",
             MARGIN, dx), domain = NA)

which doesn't really make sense.

As a consequence the user gets an obscure error message when specifying
a MARGIN that satisfies the above check but is in fact invalid:

   > unique(matrix(1:10, ncol=2), MARGIN=1:2)
   Error in args[[MARGIN]] <- !duplicated.default(temp, fromLast = 
fromLast,  :
     object of type 'symbol' is not subsettable

Also the code used by the above check to generate the error message
is broken:

   > unique(matrix(1:10, ncol=2), MARGIN=1:3)
   Error in sprintf(gettext(fmt, domain = domain), ...) :
     arguments cannot be recycled to the same length

   > unique(matrix(1:10, ncol=2), MARGIN=3)
   Error in unique.matrix(matrix(1:10, ncol = 2), MARGIN = 3) :
     c("MARGIN = 3 is invalid for dim = 5", "MARGIN = 3 is invalid for 
dim = 2")

Thanks,
H.

-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M1-B514
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fredhutch.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From mli@t@ @ending from nick-kennedy@com  Tue Jul  3 01:11:34 2018
From: mli@t@ @ending from nick-kennedy@com (Nick Kennedy)
Date: Tue, 3 Jul 2018 00:11:34 +0100
Subject: [Rd] Bug in file.access on Windows when using network shares
Message-ID: <CADWT1NMxqSQ4Mf15cazp4Dnz9i7_GjNKWLo1fjPC_aFPXLRVVQ@mail.gmail.com>

Dear R-Devel,

I've run into an issue with a package (vcfR) that uses file.access to check
a file is readable before opening it. The issue is actually in base R
though. I've looked into the package code, and it calls file.access(path,
mode = 4). I've created a minimal working example of the code in winAccessW
from src/gnuwin32/extra.c, and the problem arises when GetFileSecurityW is
called on shared files under certain circumstances.

One situation I've seen it in are when a file is shared from a non-Windows
host (e.g. Linux), which is similar to the situation documented at
https://social.msdn.microsoft.com/Forums/sqlserver/en-US/f57928d3-d89b-426d-a174-d06d97355afc/how-to-check-if-a-filefolder-is-writable-or-not?forum=windowssdk
.

The other situation arises when a file is cached offline by Windows Offline
files feature. The call to GetFileSecurityW works fine when the network is
up (and so the file is being accessed from the share), but fails when the
network is down and the file is being accessed from the offline files cache.

Is there any reason that there is a custom function here? Windows supports
the use of access (as is used on other OSes), although the ISO C++ _waccess
would be preferred. This seems to work well even in situations where the
current code does not.

BW

Nick

	[[alternative HTML version deleted]]


From tom@@@k@liber@ @ending from gm@il@com  Tue Jul  3 10:21:56 2018
From: tom@@@k@liber@ @ending from gm@il@com (Tomas Kalibera)
Date: Tue, 3 Jul 2018 10:21:56 +0200
Subject: [Rd] Bug in file.access on Windows when using network shares
In-Reply-To: <CADWT1NMxqSQ4Mf15cazp4Dnz9i7_GjNKWLo1fjPC_aFPXLRVVQ@mail.gmail.com>
References: <CADWT1NMxqSQ4Mf15cazp4Dnz9i7_GjNKWLo1fjPC_aFPXLRVVQ@mail.gmail.com>
Message-ID: <9119b59d-f679-021b-d35f-a6ea51cde3e2@gmail.com>


Dear Nick,

thank you for your report. In general one cannot know reliably in 
advance whether reading a file will work, if nothing else, there are 
possible race conditions with other applications and/or the system (e.g. 
a service may lock the file, move it away temporarily, etc). The only 
correct way to handle errors is try the read and catch errors. Please 
note there is a disclaimer in ?file.access to this effect.

If you still want to report a bug in file.access, please provide an 
example that does not require a package, and provide more details (what 
do you think would be the correct behavior, etc). From looking at the 
code, when winAccessW/GetFileSecurityW fails to retrieve information 
about the file, file.access would signal an error, which seems to be a 
fine behavior for me. It is not surprising to me that in some cases 
(like working on a local copy of a file in a distributed file-system), 
the OS would not know whether a file is readable/writeable before trying 
out on/syncing the distributed version.

Best
Tomas

On 07/03/2018 01:11 AM, Nick Kennedy wrote:
> Dear R-Devel,
>
> I've run into an issue with a package (vcfR) that uses file.access to check
> a file is readable before opening it. The issue is actually in base R
> though. I've looked into the package code, and it calls file.access(path,
> mode = 4). I've created a minimal working example of the code in winAccessW
> from src/gnuwin32/extra.c, and the problem arises when GetFileSecurityW is
> called on shared files under certain circumstances.
>
> One situation I've seen it in are when a file is shared from a non-Windows
> host (e.g. Linux), which is similar to the situation documented at
> https://social.msdn.microsoft.com/Forums/sqlserver/en-US/f57928d3-d89b-426d-a174-d06d97355afc/how-to-check-if-a-filefolder-is-writable-or-not?forum=windowssdk
> .
>
> The other situation arises when a file is cached offline by Windows Offline
> files feature. The call to GetFileSecurityW works fine when the network is
> up (and so the file is being accessed from the share), but fails when the
> network is down and the file is being accessed from the offline files cache.
>
> Is there any reason that there is a custom function here? Windows supports
> the use of access (as is used on other OSes), although the ISO C++ _waccess
> would be preferred. This seems to work well even in situations where the
> current code does not.
>
> BW
>
> Nick
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From j@gorecki @ending from wit@edu@pl  Tue Jul  3 11:12:07 2018
From: j@gorecki @ending from wit@edu@pl (Jan Gorecki)
Date: Tue, 3 Jul 2018 11:12:07 +0200
Subject: [Rd] base::mean not consistent about NA/NaN
In-Reply-To: <CANVKczPSN6NRVJkwnq3+=RmCxcgQ5OiZAWDoR4qQmNyUeD-PKQ@mail.gmail.com>
References: <CAOO9MKXXtUm=XJc-Wb7k=1ah5yheP-KMfFS3rQKZc7o6GfQF=w@mail.gmail.com>
 <339fdae8e2a3431c9773b51e2ac93ab9@AM6PR04MB4264.eurprd04.prod.outlook.com>
 <CANVKczPSN6NRVJkwnq3+=RmCxcgQ5OiZAWDoR4qQmNyUeD-PKQ@mail.gmail.com>
Message-ID: <CAOO9MKX+NxqRVL=+9iHg0TQi275PzJ99zUTzp5=kLKve1PAL-g@mail.gmail.com>

Thank you for interesting examples.
I would find useful to document this behavior also in `?mean`, while `+`
operator is also affected, the `sum` function is not.
For mean, NA / NaN could be handled in loop in summary.c. I assume that
performance penalty of fix is the reason why this inconsistency still
exists.
Jan

On Mon, Jul 2, 2018 at 8:28 PM, Barry Rowlingson <
b.rowlingson at lancaster.ac.uk> wrote:

> And for a starker example of this (documented) inconsistency,
> arithmetic addition is not commutative:
>
>  > NA + NaN
>  [1] NA
>  > NaN + NA
>  [1] NaN
>
>
>
> On Mon, Jul 2, 2018 at 5:32 PM, Duncan Murdoch <murdoch.duncan at gmail.com>
> wrote:
> > On 02/07/2018 11:25 AM, Jan Gorecki wrote:
> >> Hi,
> >> base::mean is not consistent in terms of handling NA/NaN.
> >> Mean should not depend on order of its arguments while currently it is.
> >
> > The result of mean() can depend on the order even with regular numbers.
> > For example,
> >
> >  > x <- rep(c(1, 10^(-15)), 1000000)
> >  > mean(sort(x)) - 0.5
> > [1] 5.551115e-16
> >  > mean(rev(sort(x))) - 0.5
> > [1] 0
> >
> >
> >>
> >>      mean(c(NA, NaN))
> >>      #[1] NA
> >>      mean(c(NaN, NA))
> >>      #[1] NaN
> >>
> >> I created issue so in case of no replies here status of it can be
> looked up
> >> at:
> >> https://bugs.r-project.org/bugzilla/show_bug.cgi?id=17441
> >
> > The help page for ?NaN says,
> >
> > "Computations involving NaN will return NaN or perhaps NA: which of
> > those two is not guaranteed and may depend on the R platform (since
> > compilers may re-order computations)."
> >
> > And ?NA says,
> >
> > "Numerical computations using NA will normally result in NA: a possible
> > exception is where NaN is also involved, in which case either might
> > result (which may depend on the R platform). "
> >
> > So I doubt if this inconsistency will be fixed.
> >
> > Duncan Murdoch
> >
> >>
> >> Best,
> >> Jan
> >>
> >>       [[alternative HTML version deleted]]
> >>
> >> ______________________________________________
> >> R-devel at r-project.org mailing list
> >> https://stat.ethz.ch/mailman/listinfo/r-devel
> >>
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
>

	[[alternative HTML version deleted]]


From b@rowling@on @ending from l@nc@@ter@@c@uk  Tue Jul  3 12:12:35 2018
From: b@rowling@on @ending from l@nc@@ter@@c@uk (Barry Rowlingson)
Date: Tue, 3 Jul 2018 11:12:35 +0100
Subject: [Rd] base::mean not consistent about NA/NaN
In-Reply-To: <0035dc229d8c4bdfb7975b4a9975c398@AM6PR04MB4264.eurprd04.prod.outlook.com>
References: <CAOO9MKXXtUm=XJc-Wb7k=1ah5yheP-KMfFS3rQKZc7o6GfQF=w@mail.gmail.com>
 <339fdae8e2a3431c9773b51e2ac93ab9@AM6PR04MB4264.eurprd04.prod.outlook.com>
 <CANVKczPSN6NRVJkwnq3+=RmCxcgQ5OiZAWDoR4qQmNyUeD-PKQ@mail.gmail.com>
 <0035dc229d8c4bdfb7975b4a9975c398@AM6PR04MB4264.eurprd04.prod.outlook.com>
Message-ID: <CANVKczPDibVW_i119aOHkqcR1Ar+ppMaaoRkOz9w-VkV8ZnTNw@mail.gmail.com>

On Tue, Jul 3, 2018 at 10:12 AM, Jan Gorecki <j.gorecki at wit.edu.pl> wrote:
> Thank you for interesting examples.
> I would find useful to document this behavior also in `?mean`, while `+`
> operator is also affected, the `sum` function is not.

`sum` is "affected" on my system, if you mean:

> sum(c(NA,NaN))
[1] NA
> sum(c(NaN,NA))
[1] NaN

oh, maybe you mean:

> sum(NaN, NA)
[1] NA
> sum(NA, NaN)
[1] NA

But whatever, no money back guarantee:

     Computations involving ?NaN? will return ?NaN? or perhaps ?NA?:
     which of those two is not guaranteed and may depend on the R
     platform (since compilers may re-order computations).

> For mean, NA / NaN could be handled in loop in summary.c. I assume that
> performance penalty of fix is the reason why this inconsistency still
> exists.
> Jan
>
> On Mon, Jul 2, 2018 at 8:28 PM, Barry Rowlingson
> <b.rowlingson at lancaster.ac.uk> wrote:
>>
>> And for a starker example of this (documented) inconsistency,
>> arithmetic addition is not commutative:
>>
>>  > NA + NaN
>>  [1] NA
>>  > NaN + NA
>>  [1] NaN
>>
>>
>>
>> On Mon, Jul 2, 2018 at 5:32 PM, Duncan Murdoch <murdoch.duncan at gmail.com>
>> wrote:
>> > On 02/07/2018 11:25 AM, Jan Gorecki wrote:
>> >> Hi,
>> >> base::mean is not consistent in terms of handling NA/NaN.
>> >> Mean should not depend on order of its arguments while currently it is.
>> >
>> > The result of mean() can depend on the order even with regular numbers.
>> > For example,
>> >
>> >  > x <- rep(c(1, 10^(-15)), 1000000)
>> >  > mean(sort(x)) - 0.5
>> > [1] 5.551115e-16
>> >  > mean(rev(sort(x))) - 0.5
>> > [1] 0
>> >
>> >
>> >>
>> >>      mean(c(NA, NaN))
>> >>      #[1] NA
>> >>      mean(c(NaN, NA))
>> >>      #[1] NaN
>> >>
>> >> I created issue so in case of no replies here status of it can be
>> >> looked up
>> >> at:
>> >> https://bugs.r-project.org/bugzilla/show_bug.cgi?id=17441
>> >
>> > The help page for ?NaN says,
>> >
>> > "Computations involving NaN will return NaN or perhaps NA: which of
>> > those two is not guaranteed and may depend on the R platform (since
>> > compilers may re-order computations)."
>> >
>> > And ?NA says,
>> >
>> > "Numerical computations using NA will normally result in NA: a possible
>> > exception is where NaN is also involved, in which case either might
>> > result (which may depend on the R platform). "
>> >
>> > So I doubt if this inconsistency will be fixed.
>> >
>> > Duncan Murdoch
>> >
>> >>
>> >> Best,
>> >> Jan
>> >>
>> >>       [[alternative HTML version deleted]]
>> >>
>> >> ______________________________________________
>> >> R-devel at r-project.org mailing list
>> >> https://stat.ethz.ch/mailman/listinfo/r-devel
>> >>
>> >
>> > ______________________________________________
>> > R-devel at r-project.org mailing list
>> > https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From emil@bode @ending from d@n@@kn@w@nl  Tue Jul  3 15:46:58 2018
From: emil@bode @ending from d@n@@kn@w@nl (Emil Bode)
Date: Tue, 3 Jul 2018 13:46:58 +0000
Subject: [Rd] Inconsistencies when extracting with non-integer numeric
 indices near zero
Message-ID: <844EE523-2D01-4856-9A9E-1384C5DEE597@dans.knaw.nl>

Dear R-devel,

When I was playing around with different kind of indices when subsetting I noticed some unexpected behaviours when using non-integer numeric indices, especially near zero.
From the docs: ?Numeric values are coerced to integer as by as.integer<http://127.0.0.1:14277/help/library/base/help/as.integer> (and hence truncated towards zero).?
But some behaviour differs from that, and the behaviour also differs between [ and [[ :
c(1,2)[as.integer(.5)]               --> numeric(0) # As expected
c(1,2)[.5]                                 --> numeric(0) # As expected
c(1,2)[[as.integer(.5)]]            --> Error in c(1, 2)[[as.integer(0.5)]] : attempt to select less than one element in integerOneIndex # Also as expected
c(1,2)[[.5]]                               --> [1] 1            # Not so expected
c(1,2)[[1.5]]                             --> [1] 1            # As expected, but this also means somevector[[n]] and somevector[[n+1]] give back the same element for 0<n<1
c(1,2)[[as.integer(-1.5)]]         --> [1] 2            # As would be expected, though negative subscript for [[ is of course sketchy
c(1,2)[[-1.5]]                            --> [1] 1            # But coerced to -2 is the last thing I?d expect
c(1,2)[as.integer(-.5)]             --> numeric(0) # As expected
c(1,2)[-.5]                                --> [1] 2            # Coerced to -1?, this also means that length(union(c(1,2)[-n], c(1,2)[n])) != 2 for -1<n<1
c(1,2)[-1.5]                              --> [1] 2            # Again as expected, but same problem as before: indexing with n and n+1 can give same element back.

I suspect most of this behaviour is due to the case of special treatment of zero, where first 0-indices are dropped, and only then the casting to integer is done, and when that returns zero some unforeseen behaviour occurs.
Along with using negative indices when extracting with [[, which in any case only succeeds with length-2 vectors (We need a length-one index resulting in the return of a single element). For the last case I?d think we?d do best in throwing an error whenever negative indices are used with [[, but for other cases I think we need to change the underlying code, or at the very least update documentation.
Any thoughts?

Best regards,
Emil Bode

Data-analyst

+31 6 43 83 89 33
emil.bode at dans.knaw.nl<mailto:emil.bode at dans.knaw.nl>

DANS: Netherlands Institute for Permanent Access to Digital Research Resources
Anna van Saksenlaan 51 | 2593 HW Den Haag | +31 70 349 44 50 | info at dans.knaw.nl<mailto:info at dans.kn> | dans.knaw.nl<applewebdata://71F677F0-6872-45F3-A6C4-4972BF87185B/www.dans.knaw.nl>
DANS is an institute of the Dutch Academy KNAW<http://knaw.nl/nl> and funding organisation NWO<http://www.nwo.nl/>.

	[[alternative HTML version deleted]]


From mli@t@ @ending from nick-kennedy@com  Tue Jul  3 23:08:21 2018
From: mli@t@ @ending from nick-kennedy@com (Nick Kennedy)
Date: Tue, 3 Jul 2018 22:08:21 +0100
Subject: [Rd] Bug in file.access on Windows when using network shares
In-Reply-To: <9119b59d-f679-021b-d35f-a6ea51cde3e2@gmail.com>
References: <CADWT1NMxqSQ4Mf15cazp4Dnz9i7_GjNKWLo1fjPC_aFPXLRVVQ@mail.gmail.com>
 <9119b59d-f679-021b-d35f-a6ea51cde3e2@gmail.com>
Message-ID: <CADWT1NMEs8Pkj=uc4JTkvax8cbrey69-31vwn2jKC9CPfztdUg@mail.gmail.com>

Dear Tomas,

Thanks for your email. This can be easily reproduced if there is access to
a shared folder. I've reproduced this behaviour on both Windows 7 and
Windows 10.

Steps to reproduce:

1. Ensure Offline Files is turned on within Windows
2. Using Windows Explorer, browse to a folder shared on a network using a
UNC path, e.g. \\mypc\myshare\
3. Create a test file, e.g. test.txt
4. Within R, try the following:

file.access("//mypc/myshare/test.txt",0)
# Returns 0
file.access("//mypc/myshare/test.txt",4)
# Returns -1 if the share is on a non-Windows host, 0 if it is on a Windows
host

5. Right click on the file within Windows Explorer and ensure 'always
available offline' is checked.
6. Wait for the sync to take place.
7. Disconnect from the network.
8. Within R, try the same commands again

file.access("//mypc/myshare/test.txt",0)
# Returns 0
file.access("//mypc/myshare/test.txt",4)
# Returns -1 regardless of whether the original host was Windows or
non-Windows

In all cases the file is actually readable.

I've created my own version of winAccessW in extra.c at
https://github.com/NikNakk/r-source/commit/0a82f6d23b8a2ace44e43a28cb6eb923145a13c8

Almost all of the code in here can be replaced with a simple call to
_waccess, other than the check for executable. This seems to work as
expected. Since _waccess exists as a system call within Windows and has the
same syntax (other than wide characters) as access in POSIX, why not use it?

BW

Nick

On 3 July 2018 at 09:21, Tomas Kalibera <tomas.kalibera at gmail.com> wrote:

>
> Dear Nick,
>
> thank you for your report. In general one cannot know reliably in advance
> whether reading a file will work, if nothing else, there are possible race
> conditions with other applications and/or the system (e.g. a service may
> lock the file, move it away temporarily, etc). The only correct way to
> handle errors is try the read and catch errors. Please note there is a
> disclaimer in ?file.access to this effect.
>
> If you still want to report a bug in file.access, please provide an
> example that does not require a package, and provide more details (what do
> you think would be the correct behavior, etc). From looking at the code,
> when winAccessW/GetFileSecurityW fails to retrieve information about the
> file, file.access would signal an error, which seems to be a fine behavior
> for me. It is not surprising to me that in some cases (like working on a
> local copy of a file in a distributed file-system), the OS would not know
> whether a file is readable/writeable before trying out on/syncing the
> distributed version.
>
> Best
> Tomas
>
>
> On 07/03/2018 01:11 AM, Nick Kennedy wrote:
>
>> Dear R-Devel,
>>
>> I've run into an issue with a package (vcfR) that uses file.access to
>> check
>> a file is readable before opening it. The issue is actually in base R
>> though. I've looked into the package code, and it calls file.access(path,
>> mode = 4). I've created a minimal working example of the code in
>> winAccessW
>> from src/gnuwin32/extra.c, and the problem arises when GetFileSecurityW is
>> called on shared files under certain circumstances.
>>
>> One situation I've seen it in are when a file is shared from a non-Windows
>> host (e.g. Linux), which is similar to the situation documented at
>> https://social.msdn.microsoft.com/Forums/sqlserver/en-US/f57
>> 928d3-d89b-426d-a174-d06d97355afc/how-to-check-if-a-
>> filefolder-is-writable-or-not?forum=windowssdk
>> .
>>
>> The other situation arises when a file is cached offline by Windows
>> Offline
>> files feature. The call to GetFileSecurityW works fine when the network is
>> up (and so the file is being accessed from the share), but fails when the
>> network is down and the file is being accessed from the offline files
>> cache.
>>
>> Is there any reason that there is a custom function here? Windows supports
>> the use of access (as is used on other OSes), although the ISO C++
>> _waccess
>> would be preferred. This seems to work well even in situations where the
>> current code does not.
>>
>> BW
>>
>> Nick
>>
>>         [[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
>
>

	[[alternative HTML version deleted]]


From pd@lgd @ending from gm@il@com  Wed Jul  4 23:09:15 2018
From: pd@lgd @ending from gm@il@com (peter dalgaard)
Date: Wed, 4 Jul 2018 23:09:15 +0200
Subject: [Rd] 
 [R] R is creating a new level which is emty after importing a
 SAS file
In-Reply-To: <CY4PR05MB31573C71D954314DD86AA2F2A8410@CY4PR05MB3157.namprd05.prod.outlook.com>
References: <CY4PR05MB31573C71D954314DD86AA2F2A8410@CY4PR05MB3157.namprd05.prod.outlook.com>
Message-ID: <58657783-39C2-454E-8CFD-EEA771BE1688@gmail.com>

It is not obvious that this is an error. If your nominal variable in SAS has a level which is not present in data, then R might just be making a faithful translation. There is a distinction between (a) having a gender variable with two levels of which 0 females and (b) pretending that male is the only possible gender.

Anyways, droplevels() is your friend. (Notice that it easier to remove levels that you do not want than to insert levels that have been unwantedly deleted on input.) 

-pd

> On 4 Jul 2018, at 19:16 , Adam Z. Jabir <Adam.Z.Jabir at outlook.fr> wrote:
> 
> Hi,
> 
> I have imported some sasdata into R using the sas7bdat package. I have some nominal variables with some missing values.
> 
> R is creating a new level which is emty ?.When I ask for tabulate this new level is presented with 0 as a frequency.
> 
> I want to get rid of this level and have my file imported correctly.
> 
> Do you have some hint to help solve this problem?
> 
> 
> Please use this email adress to answer this query.
> 
> 
> Best,
> 
> Adam
> 
> 
> Envoy? ? partir de Outlook<http://aka.ms/weboutlook>
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-help at r-project.org mailing list -- To UNSUBSCRIBE and more, see
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.

-- 
Peter Dalgaard, Professor,
Center for Statistics, Copenhagen Business School
Solbjerg Plads 3, 2000 Frederiksberg, Denmark
Phone: (+45)38153501
Office: A 4.23
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From p@ul@@chrimpf @ending from gm@il@com  Wed Jul  4 22:08:28 2018
From: p@ul@@chrimpf @ending from gm@il@com (Paul Schrimpf)
Date: Wed, 4 Jul 2018 13:08:28 -0700
Subject: [Rd] unexpected behavior of unzip with list=T and
 unzip=/usr/bin/unzip
Message-ID: <CAPFf-rUFbDw_-DtQaPQ6v1uq6aJSXzzrVeDEy+2=AJh-dnDRmA@mail.gmail.com>

Hello,

I encountered some unexpected behavior of unzip when using info-zip's unzip
instead of R's internal program. Specifically, unzip("file.zip", list=TRUE,
unzip=/usr/bin/unzip) produces incorrect output if the zip archive has
filenames with spaces, and results in an error if the zip archive includes
an archive comment or file comments.

Here is some code to reproduce along with the attached files

## (mostly) expected behavior
res.intern <- unzip("noSpaces.zip",list=TRUE)
res.infozip <- unzip("noSpaces.zip",list=TRUE,unzip="/usr/bin/unzip")

identical(res.intern,res.infozip) ## will be false, but expected from
                                  ## documentation about dates
identical(res.infozip$Name,res.intern$Name)     ## True
res.infozip$Length==res.intern$Length           ## TRUE
identical(res.infozip$Length,res.intern$Length) ## FALSE, because
                                                ## former numeric, later
integer

## More problematic cases
print(unzip("fileNameWithSpaces.zip",list=TRUE))
print(unzip("fileNameWithSpaces.zip",list=TRUE,unzip="/usr/bin/unzip"))
      ## read.table is used to parse output of unzip -l, and gets
      ## confused by extra spaces

print(unzip("withArchiveComment.zip",list=TRUE))
print(unzip("withArchiveComment.zip",list=TRUE,unzip="/usr/bin/unzip"))
      ## produces an error

print(unzip("entryComments.zip",list=TRUE))
print(unzip("entryComments.zip",list=TRUE,unzip="/usr/bin/unzip"))
      ## produces an error

Looking at the code for R's unzip, the basic problem is that it makes a
bunch of assumptions about the format of the output of "unzip -l"  that are
not always true and are not verified.

It's unclear to me whether R's unzip should be expected to be compatible
with all sorts of external unzip programs, so perhaps a sufficient solution
is simply to revise the documentation (which already mentions potential
problems  with dates and unzip, list=TRUE, and external programs).

Alternatively, R's unzip function could be changed to work with info-zip
unzip by :
(1) add "-ql" instead of just "-l" when list=TRUE to eliminate the printing
of comments
(2) not use read.table to parse the output of unzip, instead to something
like the following (which is an admittedly messy workaround)

            res <- if (WINDOWS)
                system2(unzip, c("-ql", shQuote(zipfile)), stdout = TRUE)
            else system2(unzip, c("-ql", shQuote(zipfile)), stdout = TRUE,
                env = c("TZ=UTC"))
            dashes <- grep("--",res)
            s <- dashes[1]+1
            l <- dashes[2]-1
            starts <- gregexpr("-+",res[dashes[1]])[[1]]
            ends <- gregexpr("[[:space:]]+",res[dashes[1]])[[1]]
            z <- data.frame(
                Name=sapply(res[s:l], function(x) {
                  substr(x, starts[4], stop=nchar(x))
                }),
                Length=sapply(res[s:l], function(x) {
                  as.numeric(substr(x, starts[1], stop=ends[1]))
                }),
                Date=sapply(res[s:l], function(x) {
                  substr(x, starts[2], stop=ends[2])
                }),
                Time=sapply(res[s:l], function(x) {
                  substr(x, starts[3], stop=ends[3])
                }),
                stringsAsFactors=FALSE
            )
            rownames(z) <- NULL

I can submit a patch if this is appropriate. I'm really not sure though
because I am new to R-devel. Also, this has the downsides of relying on the
behavior of info-zip unzip, which might change in future versions and is
unlikely to be the same for other external unzip programs. On the other
hand, the current code also relies on the behavior of info-zip unzip, but
also doesn't work in some cases.

Thanks,
Paul

P.S.

My sessionInfo is

> sessionInfo()
R version 3.5.1 (2018-07-02)
Platform: x86_64-pc-linux-gnu (64-bit)
Running under: Arch Linux

Matrix products: default
BLAS/LAPACK: /usr/lib/libopenblas_haswellp-r0.3.1.so

locale:
 [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
 [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
LC_PAPER=en_US.UTF-8       LC_NAME=C
 [9] LC_ADDRESS=C               LC_TELEPHONE=C
LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] devtools_1.13.5

loaded via a namespace (and not attached):
[1] compiler_3.5.1 tools_3.5.1    withr_2.1.2    memoise_1.1.0
digest_0.6.15

And unzip -v

UnZip 6.00 of 20 April 2009, by Info-ZIP.  Maintained by C. Spieler.  Send
bug reports using http://www.info-zip.org/zip-bug.html; see README for
details.

Latest sources and executables are at ftp://ftp.info-zip.org/pub/infozip/ ;
see ftp://ftp.info-zip.org/pub/infozip/UnZip.html for other sites.

Compiled with gcc 5.3.0 for Unix (Linux ELF) on Apr 17 2016.

UnZip special compilation options:
        ACORN_FTYPE_NFS
        COPYRIGHT_CLEAN (PKZIP 0.9x unreducing method not supported)
        SET_DIR_ATTRIB
        SYMLINKS (symbolic links supported, if RTL and file system permit)
        TIMESTAMP
        UNIXBACKUP
        USE_EF_UT_TIME
        USE_UNSHRINK (PKZIP/Zip 1.x unshrinking method supported)
        USE_DEFLATE64 (PKZIP 4.x Deflate64(tm) supported)
        UNICODE_SUPPORT [wide-chars, char coding: UTF-8] (handle UTF-8
paths)
        LARGE_FILE_SUPPORT (large files over 2 GiB supported)
        ZIP64_SUPPORT (archives using Zip64 for large files supported)
        USE_BZIP2 (PKZIP 4.6+, using bzip2 lib version 1.0.6, 6-Sept-2010)
        VMS_TEXT_CONV
        WILD_STOP_AT_DIR
        [decryption, version 2.11 of 05 Jan 2007]

UnZip and ZipInfo environment options:
           UNZIP:  [none]
        UNZIPOPT:  [none]
         ZIPINFO:  [none]
      ZIPINFOOPT:  [none]

From emil@bode @ending from d@n@@kn@w@nl  Thu Jul  5 17:19:29 2018
From: emil@bode @ending from d@n@@kn@w@nl (Emil Bode)
Date: Thu, 5 Jul 2018 15:19:29 +0000
Subject: [Rd] write.table with quote=TRUE fails on nested data.frames
Message-ID: <E5B213BA-2BC0-4DF0-B018-E582910AAACF@dans.knaw.nl>

Looks like I?m bumping a lot into unexpected behaviour lately, but I think I found a bug again, but don?t have access to Bugzilla:
Write.table (from core-package utils) doesn?t handle nested data.frames well, the quote arguments only marks top-level character (or-factor columns) for quoting, so this fails:

df <- data.frame(a='One;Two;Three',
                 b=I(data.frame(c="OtherVal",
                                d='Four;Five;Six',
                                e=4)),
                f=5)
write.table(df, "~/Desktop/Tempfile.csv", quote = T, col.names = NA,
           sep = ";", dec = ",", qmethod = "double")

The ?four;five;six? string is stored unquoted, so read.table (or read.csv) breaks down.
This also affects write.csv and write.csv2, but I?ve written a patch,
See here-under.
Anyone who could file this for me?

Best regards,
Emil Bode

New write.table, note that its environment needs to be set to namespace:utils
write.table <- function (x, file = "", append = FALSE, quote = TRUE, sep = " ",
                         eol = "\n", na = "NA", dec = ".", row.names = TRUE, col.names = TRUE,
                         qmethod = c("escape", "double"), fileEncoding = "")
{
  qmethod <- match.arg(qmethod)
  if (is.logical(quote) && (length(quote) != 1L || is.na(quote)))
    stop("'quote' must be 'TRUE', 'FALSE' or numeric")
  quoteC <- if (is.logical(quote))
    quote
  else TRUE
  qset <- is.logical(quote) && quote
  if (!is.data.frame(x) && !is.matrix(x))
    x <- data.frame(x)
  makeRownames <- isTRUE(row.names)
  makeColnames <- is.logical(col.names) && !identical(FALSE,
                                                      col.names)
  if (is.matrix(x)) {
    p <- ncol(x)
    d <- dimnames(x)
    if (is.null(d))
      d <- list(NULL, NULL)
    if (is.null(d[[1L]]) && makeRownames)
      d[[1L]] <- seq_len(nrow(x))
    if (is.null(d[[2L]]) && makeColnames && p > 0L)
      d[[2L]] <- paste0("V", 1L:p)
    if (qset)
      quote <- if (is.character(x))
        seq_len(p)
    else numeric()
  }
  else {
    if (any(sapply(x, function(z) length(dim(z)) == 2 &&
                   dim(z)[2L] > 1))) {
      if (qset) {
        quote <- which(rapply(x, function(x) is.character(x) || is.factor(x)))
      }
      c1 <- names(x)
      x <- as.matrix(x, rownames.force = makeRownames)
      d <- dimnames(x)
    }
    else {
      if (qset)
        quote <- if (length(x))
          which(unlist(lapply(x, function(x) is.character(x) ||
                                is.factor(x))))
      else numeric()
      d <- list(if (makeRownames) row.names(x), if (makeColnames) names(x))
    }
    p <- ncol(x)
  }
  nocols <- p == 0L
  if (is.logical(quote))
    quote <- NULL
  else if (is.numeric(quote)) {
    if (any(quote < 1L | quote > p))
      stop("invalid numbers in 'quote'")
  }
  else stop("invalid 'quote' specification")
  rn <- FALSE
  rnames <- NULL
  if (is.logical(row.names)) {
    if (row.names) {
      rnames <- as.character(d[[1L]])
      rn <- TRUE
    }
  }
  else {
    rnames <- as.character(row.names)
    rn <- TRUE
    if (length(rnames) != nrow(x))
      stop("invalid 'row.names' specification")
  }
  if (!is.null(quote) && rn)
    quote <- c(0, quote)
  if (is.logical(col.names)) {
    if (!rn && is.na(col.names))
      stop("'col.names = NA' makes no sense when 'row.names = FALSE'")
    col.names <- if (is.na(col.names) && rn)
      c("", d[[2L]])
    else if (col.names)
      d[[2L]]
    else NULL
  }
  else {
    col.names <- as.character(col.names)
    if (length(col.names) != p)
      stop("invalid 'col.names' specification")
  }
  if (file == "")
    file <- stdout()
  else if (is.character(file)) {
    file <- if (nzchar(fileEncoding))
      file(file, ifelse(append, "a", "w"), encoding = fileEncoding)
    else file(file, ifelse(append, "a", "w"))
    on.exit(close(file))
  }
  else if (!isOpen(file, "w")) {
    open(file, "w")
    on.exit(close(file))
  }
  if (!inherits(file, "connection"))
    stop("'file' must be a character string or connection")
  qstring <- switch(qmethod, escape = "\\\\\"", double = "\"\"")
  if (!is.null(col.names)) {
    if (append)
      warning("appending column names to file")
    if (quoteC)
      col.names <- paste0("\"", gsub("\"", qstring, col.names),
                          "\"")
    writeLines(paste(col.names, collapse = sep), file, sep = eol)
  }
  if (nrow(x) == 0L)
    return(invisible())
  if (nocols && !rn)
    return(cat(rep.int(eol, NROW(x)), file = file, sep = ""))
  if (is.matrix(x) && !is.atomic(x))
    mode(x) <- "character"
  if (is.data.frame(x)) {
    x[] <- lapply(x, function(z) {
      if (is.object(z) && !is.factor(z))
        as.character(z)
      else z
    })
  }
  invisible(.External2(C_writetable, x, file, nrow(x), p,
                       rnames, sep, eol, na, dec, as.integer(quote), qmethod !=
                         "double"))
}

	[[alternative HTML version deleted]]


From jon @ending from thon@cc  Fri Jul  6 05:32:50 2018
From: jon @ending from thon@cc (Jonathon Love)
Date: Fri, 6 Jul 2018 13:32:50 +1000
Subject: [Rd] CRAN: Update protocol buffers on macOS? (for RProtoBuf)
Message-ID: <c25cf101-4df9-9606-4115-a4041bc66dea@thon.love>

Hi,

I notice that the CRAN binary for the macOS version of RProtoBuf is 
built against quite an old version of protocol buffers (from 2014, 
before v3 format support was added).

the windows version is (blessedly) kept up-to-date, but I'd like to 
float the suggestion that the macOS version get an update too.

with thanks

jonathon


From wdunl@p @ending from tibco@com  Fri Jul  6 19:00:37 2018
From: wdunl@p @ending from tibco@com (William Dunlap)
Date: Fri, 6 Jul 2018 10:00:37 -0700
Subject: [Rd] NEWS vs. inst/NEWS
Message-ID: <CAF8bMcZfodnWrOpHdNouMBzyZQNSREzd+wu0e_Tv9YEUdVqKig@mail.gmail.com>

'Writing R Extensions', section 1.1.5, in the part about a package's 'inst'
directory, says that if NEW is in both the top level and in the inst
directory, the in inst will be installed:

Note that with the exceptions of INDEX, LICENSE/LICENCE and NEWS,
information files at the top level of the package will *not* be installed
and so not be known to users of Windows and macOS compiled packages (and
not seen by those who use R CMD INSTALL or install.packages on the
tarball). So any information files you wish an end user to see should be
included in inst. Note that if the named exceptions also occur in inst, the
version in inst will be that seen in the installed package.

However, if I have a package with a NEWS file in both the top-level and in
the inst directory, the top-level one appears in the installed file, not
the one in inst.

Try the following script that makes and installs a package in tempdir():
pkgName <- "junk"
dir.create(tdir <- tempfile())
dir.create(srcPkg <- file.path(tdir, pkgName))
cat(file=file.path(srcPkg, "DESCRIPTION"), sep="\n",
   paste("Package:", pkgName),
   paste("Title: NEWS vs. inst/NEWS"),
   paste("Description: Which is installed, NEWS or inst/NEWS?"),
   paste("Version: 0.1"))
file.create(file.path(srcPkg, "NAMESPACE"))
dir.create(inst <- file.path(srcPkg, "inst"))

instFiles <- c("NEWS", "CITATION") # these both at top-level and in inst
directory
for(instFile in instFiles) {
   cat(file=file.path(srcPkg, instFile), sep="\n",
       paste0("The original top-level ", instFile, " file"))
   cat(file=file.path(inst, instFile), sep="\n",
       paste0("inst/", instFile, " - the ", instFile, " file from the
source package's inst directory"))
}

dir.create(lib <- file.path(tdir, "lib"))
install.packages(lib=lib, srcPkg, repos=NULL, type="source")
sapply(instFiles, function(instFile) readLines(system.file(package=pkgName,
lib.loc=lib, mustWork=TRUE, instFile)))
# unlink(recursive=TRUE, tdir) # to clean up

The final sapply() gives me
> sapply(instFiles, function(instFile)
readLines(system.file(package=pkgName, lib.loc=lib, mustWork=TRUE,
instFile)))
                                                                        NEWS
                                          "The original top-level NEWS file"
                                                                    CITATION
"inst/CITATION - the CITATION file from the source package's inst directory"

Several CRAN packages have both NEWS and inst/NEWS (gdata, genetics,
gplots, mcgibbsit, modeltools, nimble, RRF, session, SII).  In most the two
files are identical but in RRF and nimble they differ.

Is the manual wrong is the code wrong?


Bill Dunlap
TIBCO Software
wdunlap tibco.com

	[[alternative HTML version deleted]]


From gor@n@bro@trom @ending from umu@@e  Fri Jul  6 23:57:29 2018
From: gor@n@bro@trom @ending from umu@@e (=?UTF-8?Q?G=c3=b6ran_Brostr=c3=b6m?=)
Date: Fri, 6 Jul 2018 23:57:29 +0200
Subject: [Rd] undefined symbol: cholmod_factorize_p
Message-ID: <39cb5a4b-c39f-fbbb-0c65-a84874e630e6@umu.se>

I am installing R_3.5.1 from source on ubuntu 18.04, and 'config' + 
'make' gives me (at the end)

Loading required package: Matrix
Error: package or namespace load failed for ?Matrix? in dyn.load(file, 
DLLpath = DLLpath, ...):
  unable to load shared object 
'/home/goran/src/R-3.5.1/library/Matrix/libs/Matrix.so':
   /home/goran/src/R-3.5.1/library/Matrix/libs/Matrix.so: undefined 
symbol: cholmod_factorize_p
Error in eval(exprs[i], envir) : require(Matrix) is not TRUE
ERROR: installing package indices failed
* removing ?/home/goran/src/R-3.5.1/library/Matrix?
Makefile:51: recipe for target 'Matrix.ts' failed
make[2]: *** [Matrix.ts] Error 1
make[2]: Leaving directory '/home/goran/src/R-3.5.1/src/library/Recommended'
Makefile:39: recipe for target 'recommended-packages' failed
make[1]: *** [recommended-packages] Error 2
make[1]: Leaving directory '/home/goran/src/R-3.5.1/src/library/Recommended'
Makefile:77: recipe for target 'stamp-recommended' failed
make: *** [stamp-recommended] Error 2

What am I missing?

G?ran


From ripley @ending from @t@t@@ox@@c@uk  Sat Jul  7 11:38:53 2018
From: ripley @ending from @t@t@@ox@@c@uk (Prof Brian Ripley)
Date: Sat, 7 Jul 2018 10:38:53 +0100
Subject: [Rd] CRAN: Update protocol buffers on macOS? (for RProtoBuf)
In-Reply-To: <c25cf101-4df9-9606-4115-a4041bc66dea@thon.love>
References: <c25cf101-4df9-9606-4115-a4041bc66dea@thon.love>
Message-ID: <ac0e29ab-a56d-2591-8251-5817762b2f21@stats.ox.ac.uk>

On 06/07/2018 04:32, Jonathon Love wrote:
> Hi,
> 
> I notice that the CRAN binary for the macOS version of RProtoBuf is 
> built against quite an old version of protocol buffers (from 2014, 
> before v3 format support was added).
> 
> the windows version is (blessedly) kept up-to-date, but I'd like to 
> float the suggestion that the macOS version get an update too.

If you mean the CRAN macOS binary package for RProtoBuf, why did you 
post here?  R-sig-Mac would have been more appropriate, but the CRAN 
policies tell you how to report issues/wishes for binary packages.  Only 
one person can help you with that, and it is most effective to contact 
him directly.

RProtoBuf does not compile on macOS against the current/latest version 
3.6.0 of protobuf (sic), and I have reported to the maintainer.  It did 
compile against 3.5.1, and you could compile from sources yourself.

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Emeritus Professor of Applied Statistics, University of Oxford


From jeroenoom@ @ending from gm@il@com  Sat Jul  7 13:08:31 2018
From: jeroenoom@ @ending from gm@il@com (Jeroen Ooms)
Date: Sat, 7 Jul 2018 13:08:31 +0200
Subject: [Rd] undefined symbol: cholmod_factorize_p
In-Reply-To: <39cb5a4b-c39f-fbbb-0c65-a84874e630e6@umu.se>
References: <39cb5a4b-c39f-fbbb-0c65-a84874e630e6@umu.se>
Message-ID: <CABFfbXuXb2EWRfoZOSMYzryOO1GxA8rqGRrhp0DfHO6J7PgBzg@mail.gmail.com>

On Fri, Jul 6, 2018 at 11:57 PM, G?ran Brostr?m <goran.brostrom at umu.se> wrote:
> I am installing R_3.5.1 from source on ubuntu 18.04, and 'config' + 'make'
> gives me (at the end)

Probably something went wrong earlier in the build when compiling the
Matrix package. However it's much easier to install R form the
binaries:

  sudo add-apt-repository -y ppa:marutter/rrutter3.5
  sudo apt-get update
  sudo apt-get install r-base

If you really want to build from source, have a look at which flags
and dependencies are used in the r-base source package on
Debian/Ubuntu.


From gor@n@bro@trom @ending from umu@@e  Sat Jul  7 13:41:05 2018
From: gor@n@bro@trom @ending from umu@@e (=?UTF-8?Q?G=c3=b6ran_Brostr=c3=b6m?=)
Date: Sat, 7 Jul 2018 13:41:05 +0200
Subject: [Rd] undefined symbol: cholmod_factorize_p
In-Reply-To: <CABFfbXuXb2EWRfoZOSMYzryOO1GxA8rqGRrhp0DfHO6J7PgBzg@mail.gmail.com>
References: <39cb5a4b-c39f-fbbb-0c65-a84874e630e6@umu.se>
 <CABFfbXuXb2EWRfoZOSMYzryOO1GxA8rqGRrhp0DfHO6J7PgBzg@mail.gmail.com>
Message-ID: <8070c7f1-0802-7c0a-795f-5f37a11d8e9f@umu.se>



On 2018-07-07 13:08, Jeroen Ooms wrote:
> On Fri, Jul 6, 2018 at 11:57 PM, G?ran Brostr?m
> <goran.brostrom at umu.se> wrote:
>> I am installing R_3.5.1 from source on ubuntu 18.04, and 'config' +
>> 'make' gives me (at the end)
> 
> Probably something went wrong earlier in the build when compiling
> the Matrix package. However it's much easier to install R form the 
> binaries:
> 
> sudo add-apt-repository -y ppa:marutter/rrutter3.5 sudo apt-get
> update sudo apt-get install r-base

Thanks, after a discussion with Dirk on r-sig-debian I did just that.
The reason I compiled R from source was that I had some problems with 
the binary install but without the ppa:marutter. With it everything works.

> 
> If you really want to build from source, have a look at which flags 
> and dependencies are used in the r-base source package on 
> Debian/Ubuntu.
> 
I certainly will be able to do that (it has "always" worked seamlessly 
for me, don't understand what happened this time. Maybe the upgrade to 
18.04), so I will have a look.

Many thanks, G?ran


From gor@n@bro@trom @ending from umu@@e  Sat Jul  7 14:25:01 2018
From: gor@n@bro@trom @ending from umu@@e (=?UTF-8?Q?G=c3=b6ran_Brostr=c3=b6m?=)
Date: Sat, 7 Jul 2018 14:25:01 +0200
Subject: [Rd] undefined symbol: cholmod_factorize_p (solved)
In-Reply-To: <8070c7f1-0802-7c0a-795f-5f37a11d8e9f@umu.se>
References: <39cb5a4b-c39f-fbbb-0c65-a84874e630e6@umu.se>
 <CABFfbXuXb2EWRfoZOSMYzryOO1GxA8rqGRrhp0DfHO6J7PgBzg@mail.gmail.com>
 <8070c7f1-0802-7c0a-795f-5f37a11d8e9f@umu.se>
Message-ID: <94709392-3f2d-5822-9a67-57be2e7ec98f@umu.se>



On 2018-07-07 13:41, G?ran Brostr?m wrote:
> 
> 
> On 2018-07-07 13:08, Jeroen Ooms wrote:
>> On Fri, Jul 6, 2018 at 11:57 PM, G?ran Brostr?m
>> <goran.brostrom at umu.se> wrote:
>>> I am installing R_3.5.1 from source on ubuntu 18.04, and 'config' +
>>> 'make' gives me (at the end)
>>
>> Probably something went wrong earlier in the build when compiling
>> the Matrix package. However it's much easier to install R form the 
>> binaries:
>>
>> sudo add-apt-repository -y ppa:marutter/rrutter3.5 sudo apt-get
>> update sudo apt-get install r-base
> 
> Thanks, after a discussion with Dirk on r-sig-debian I did just that.
> The reason I compiled R from source was that I had some problems with 
> the binary install but without the ppa:marutter. With it everything works.
> 
>>
>> If you really want to build from source, have a look at which flags 
>> and dependencies are used in the r-base source package on Debian/Ubuntu.
>>
> I certainly will be able to do that (it has "always" worked seamlessly 
> for me, don't understand what happened this time. Maybe the upgrade to 
> 18.04), so I will have a look.

I had a look in ~/.R and there I found a file 'Makevars' containing:

PKG_LIBS = $(LAPACK_LIBS) $(BLAS_LIBS) $(FLIBS)

Removing it removed the problem! Its existence was a result of a 
discussion on r-pkg-devel, which I now will take up again (but after the 
game).

G?ran

> Many thanks, G?ran
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From h@wickh@m @ending from gm@il@com  Sat Jul  7 19:20:29 2018
From: h@wickh@m @ending from gm@il@com (Hadley Wickham)
Date: Sat, 7 Jul 2018 12:20:29 -0500
Subject: [Rd] Testing for vectors
Message-ID: <CABdHhvF5gqJt3kDj-QuU92BWPiLWwGugxnNzOfHOHo9tp_AigA@mail.gmail.com>

Hi all,

Is there are base function that I've missed that tests if an object is
a vector in the dimensionality sense, rather than the data structure
sense? i.e. something that checks is.null(dim(x)) ?

is.vector() is trivially disqualified since it also checks for the
presence of non-names attributes:

x <- factor(c("a", "a", "b"))
is.vector(x)
#> [1] FALSE

is.null(dim(x))
#> [1] TRUE

Hadley

-- 
http://hadley.nz


From murdoch@dunc@n @ending from gm@il@com  Sat Jul  7 19:54:14 2018
From: murdoch@dunc@n @ending from gm@il@com (Duncan Murdoch)
Date: Sat, 7 Jul 2018 13:54:14 -0400
Subject: [Rd] Testing for vectors
In-Reply-To: <CABdHhvF5gqJt3kDj-QuU92BWPiLWwGugxnNzOfHOHo9tp_AigA@mail.gmail.com>
References: <CABdHhvF5gqJt3kDj-QuU92BWPiLWwGugxnNzOfHOHo9tp_AigA@mail.gmail.com>
Message-ID: <2b0f1462-99d1-d908-5ea6-e9d21be02d11@gmail.com>

On 07/07/2018 1:20 PM, Hadley Wickham wrote:
> Hi all,
> 
> Is there are base function that I've missed that tests if an object is
> a vector in the dimensionality sense, rather than the data structure
> sense? i.e. something that checks is.null(dim(x)) ?
> 
> is.vector() is trivially disqualified since it also checks for the
> presence of non-names attributes:
> 
> x <- factor(c("a", "a", "b"))
> is.vector(x)
> #> [1] FALSE
> 
> is.null(dim(x))
> #> [1] TRUE
> 

I don't know of one.  I can't think of nontrivial cases where that 
distinction matters; do you know of any where base functions act 
differently on vectors and 1D arrays?  (A trivial example is that 
dimnames(x) gives different results for a named vector and an array with 
dimnames.)

Duncan Murdoch


From h@wickh@m @ending from gm@il@com  Sat Jul  7 20:20:40 2018
From: h@wickh@m @ending from gm@il@com (Hadley Wickham)
Date: Sat, 7 Jul 2018 13:20:40 -0500
Subject: [Rd] Testing for vectors
In-Reply-To: <2b0f1462-99d1-d908-5ea6-e9d21be02d11@gmail.com>
References: <CABdHhvF5gqJt3kDj-QuU92BWPiLWwGugxnNzOfHOHo9tp_AigA@mail.gmail.com>
 <2b0f1462-99d1-d908-5ea6-e9d21be02d11@gmail.com>
Message-ID: <CABdHhvHuqb82RjNwD4US_oD1pEXLdc2C3YRYpCaV7QTYhUVB9g@mail.gmail.com>

On Sat, Jul 7, 2018 at 12:54 PM, Duncan Murdoch
<murdoch.duncan at gmail.com> wrote:
> On 07/07/2018 1:20 PM, Hadley Wickham wrote:
>>
>> Hi all,
>>
>> Is there are base function that I've missed that tests if an object is
>> a vector in the dimensionality sense, rather than the data structure
>> sense? i.e. something that checks is.null(dim(x)) ?
>>
>> is.vector() is trivially disqualified since it also checks for the
>> presence of non-names attributes:
>>
>> x <- factor(c("a", "a", "b"))
>> is.vector(x)
>> #> [1] FALSE
>>
>> is.null(dim(x))
>> #> [1] TRUE
>>
>
> I don't know of one.  I can't think of nontrivial cases where that
> distinction matters; do you know of any where base functions act differently
> on vectors and 1D arrays?  (A trivial example is that dimnames(x) gives
> different results for a named vector and an array with dimnames.)

I was thinking primarily of completing the set of is.matrix() and
is.array(), or generally, how do you say: is `x` a 1d dimensional
thing?

(I don't have any feel for whether the check should be is.null(dim(x))
vs. length(dim(x)) <= 1)

Hadley
-- 
http://hadley.nz


From becker@g@be @ending from gene@com  Sat Jul  7 20:50:57 2018
From: becker@g@be @ending from gene@com (Gabe Becker)
Date: Sat, 7 Jul 2018 11:50:57 -0700
Subject: [Rd] Testing for vectors
In-Reply-To: <CABdHhvHuqb82RjNwD4US_oD1pEXLdc2C3YRYpCaV7QTYhUVB9g@mail.gmail.com>
References: <CABdHhvF5gqJt3kDj-QuU92BWPiLWwGugxnNzOfHOHo9tp_AigA@mail.gmail.com>
 <2b0f1462-99d1-d908-5ea6-e9d21be02d11@gmail.com>
 <CABdHhvHuqb82RjNwD4US_oD1pEXLdc2C3YRYpCaV7QTYhUVB9g@mail.gmail.com>
Message-ID: <CAMFmJs=Fybj+FA1anmPSsWBnak+msX5C2524G=sZ9jFOnJtCTw@mail.gmail.com>

Hadley,


> I was thinking primarily of completing the set of is.matrix() and
> is.array(), or generally, how do you say: is `x` a 1d dimensional
> thing?
>

Can you clarify what you mean by dimensionality sense and specifically 1d
here?

You can have a 1d array which is different from what your proposed function
would call a vector. So is.null(dim(x)) doesn't seem the same as 1d, right?

> x = array(1:10)

> x

 [1]  1  2  3  4  5  6  7  8  9 10

> class(x)

[1] "array"

> dim(x)

[1] 10

> dim(1:10)

NULL


You can also have an n x 1 matrix, which *technically* has 2 dimensions but
conceptually is equivalent to a 1d array and/or a vector.

Also, are you including lists in your conceptions of 1d vector here? I'm
with Duncan here, in that i'm having trouble understanding exactly what you
want to do without a bit more context.

Best,
~G



>
> (I don't have any feel for whether the check should be is.null(dim(x))
> vs. length(dim(x)) <= 1)
>
> Hadley
> --
> http://hadley.nz
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


-- 
Gabriel Becker, Ph.D
Scientist
Bioinformatics and Computational Biology
Genentech Research

	[[alternative HTML version deleted]]


From h@wickh@m @ending from gm@il@com  Sat Jul  7 22:32:28 2018
From: h@wickh@m @ending from gm@il@com (Hadley Wickham)
Date: Sat, 7 Jul 2018 15:32:28 -0500
Subject: [Rd] Testing for vectors
In-Reply-To: <CAMFmJs=Fybj+FA1anmPSsWBnak+msX5C2524G=sZ9jFOnJtCTw@mail.gmail.com>
References: <CABdHhvF5gqJt3kDj-QuU92BWPiLWwGugxnNzOfHOHo9tp_AigA@mail.gmail.com>
 <2b0f1462-99d1-d908-5ea6-e9d21be02d11@gmail.com>
 <CABdHhvHuqb82RjNwD4US_oD1pEXLdc2C3YRYpCaV7QTYhUVB9g@mail.gmail.com>
 <CAMFmJs=Fybj+FA1anmPSsWBnak+msX5C2524G=sZ9jFOnJtCTw@mail.gmail.com>
Message-ID: <CABdHhvHkRcx=S5ShWkK4Y-yipX-F=xOx=8R1qm8qxeEDojrrCw@mail.gmail.com>

On Sat, Jul 7, 2018 at 1:50 PM, Gabe Becker <becker.gabe at gene.com> wrote:
> Hadley,
>
>>
>> I was thinking primarily of completing the set of is.matrix() and
>> is.array(), or generally, how do you say: is `x` a 1d dimensional
>> thing?
>
>
> Can you clarify what you mean by dimensionality sense and specifically 1d
> here?

What do we call a vector that is not an array? (or matrix)

What do we call an object that acts 1-dimensional? (i.e. has
length(dim()) %in% c(0, 1)) ?

> You can also have an n x 1 matrix, which technically has 2 dimensions but
> conceptually is equivalent to a 1d array and/or a vector.

Yes. You can also have array that's n x 1 x 1.

> Also, are you including lists in your conceptions of 1d vector here? I'm
> with Duncan here, in that i'm having trouble understanding exactly what you
> want to do without a bit more context.

Isn't it standard terminology that a vector is the set of atomic vectors + list?

Hadley

-- 
http://hadley.nz


From ruipb@rr@d@@ @ending from @@po@pt  Sat Jul  7 22:47:40 2018
From: ruipb@rr@d@@ @ending from @@po@pt (Rui Barradas)
Date: Sat, 7 Jul 2018 21:47:40 +0100
Subject: [Rd] Testing for vectors
In-Reply-To: <CABdHhvHkRcx=S5ShWkK4Y-yipX-F=xOx=8R1qm8qxeEDojrrCw@mail.gmail.com>
References: <CABdHhvF5gqJt3kDj-QuU92BWPiLWwGugxnNzOfHOHo9tp_AigA@mail.gmail.com>
 <2b0f1462-99d1-d908-5ea6-e9d21be02d11@gmail.com>
 <CABdHhvHuqb82RjNwD4US_oD1pEXLdc2C3YRYpCaV7QTYhUVB9g@mail.gmail.com>
 <CAMFmJs=Fybj+FA1anmPSsWBnak+msX5C2524G=sZ9jFOnJtCTw@mail.gmail.com>
 <CABdHhvHkRcx=S5ShWkK4Y-yipX-F=xOx=8R1qm8qxeEDojrrCw@mail.gmail.com>
Message-ID: <aafd75e7-4c10-a57b-3a4f-263ee5f7ac75@sapo.pt>

Hello,

Inline.

?s 21:32 de 07-07-2018, Hadley Wickham escreveu:
> On Sat, Jul 7, 2018 at 1:50 PM, Gabe Becker <becker.gabe at gene.com> wrote:
>> Hadley,
>>
>>>
>>> I was thinking primarily of completing the set of is.matrix() and
>>> is.array(), or generally, how do you say: is `x` a 1d dimensional
>>> thing?
>>
>>
>> Can you clarify what you mean by dimensionality sense and specifically 1d
>> here?
> 
> What do we call a vector that is not an array? (or matrix)
> 
> What do we call an object that acts 1-dimensional? (i.e. has
> length(dim()) %in% c(0, 1)) ?
> 
>> You can also have an n x 1 matrix, which technically has 2 dimensions but
>> conceptually is equivalent to a 1d array and/or a vector.
> 
> Yes. You can also have array that's n x 1 x 1.

In which case it would be

(length(dim(.)) - sum(dim(.) == 1)) %in% c(0, 1)

Hope this helps,

Rui Barradas

> 
>> Also, are you including lists in your conceptions of 1d vector here? I'm
>> with Duncan here, in that i'm having trouble understanding exactly what you
>> want to do without a bit more context.
> 
> Isn't it standard terminology that a vector is the set of atomic vectors + list?
> 
> Hadley
>


From otoomet @ending from gm@il@com  Sat Jul  7 22:48:55 2018
From: otoomet @ending from gm@il@com (Ott Toomet)
Date: Sat, 7 Jul 2018 13:48:55 -0700
Subject: [Rd] Testing for vectors
In-Reply-To: <CABdHhvHkRcx=S5ShWkK4Y-yipX-F=xOx=8R1qm8qxeEDojrrCw@mail.gmail.com>
References: <CABdHhvF5gqJt3kDj-QuU92BWPiLWwGugxnNzOfHOHo9tp_AigA@mail.gmail.com>
 <2b0f1462-99d1-d908-5ea6-e9d21be02d11@gmail.com>
 <CABdHhvHuqb82RjNwD4US_oD1pEXLdc2C3YRYpCaV7QTYhUVB9g@mail.gmail.com>
 <CAMFmJs=Fybj+FA1anmPSsWBnak+msX5C2524G=sZ9jFOnJtCTw@mail.gmail.com>
 <CABdHhvHkRcx=S5ShWkK4Y-yipX-F=xOx=8R1qm8qxeEDojrrCw@mail.gmail.com>
Message-ID: <CAMMJQ0b8crhiRzn5x-19RJkavwZP11kvCvFMefGfpXg0nBagOg@mail.gmail.com>

Thanks, Hadley for bringing this up:-)

I am teaching R and I can suggest 5 different definitions of 'vector':

a) vector as a collection of homogeneous objects, indexed by [ ] (more
precisely atomic vector).  Sometimes you hear that in R, "everything is a
vector", but this is only true for atomic objects.
b) vector as a collection of objects, indexed by either [ ] and [[ ]].
This includes atomic vectors and lists.
c) vector versus scalar.  It pops up when teaching math and stats, and is
somewhat confusing, in particular if my previous claim was that "R does not
have scalars".
d) vector versus matrix (or other arrays).  Again, it only matters when
doing matrix operations where 'vectors', i.e. objects with NULL dimension,
behave their own way.
e) finally, 'is.vector' has it's own understanding what constitutes a
vector.

Maybe there are more...  I don't think there are any easy answers but both
me and my students would appreciate more consistent terminology.

Cheers,
Ott



On Sat, Jul 7, 2018 at 1:32 PM, Hadley Wickham <h.wickham at gmail.com> wrote:

> On Sat, Jul 7, 2018 at 1:50 PM, Gabe Becker <becker.gabe at gene.com> wrote:
> > Hadley,
> >
> >>
> >> I was thinking primarily of completing the set of is.matrix() and
> >> is.array(), or generally, how do you say: is `x` a 1d dimensional
> >> thing?
> >
> >
> > Can you clarify what you mean by dimensionality sense and specifically 1d
> > here?
>
> What do we call a vector that is not an array? (or matrix)
>
> What do we call an object that acts 1-dimensional? (i.e. has
> length(dim()) %in% c(0, 1)) ?
>
> > You can also have an n x 1 matrix, which technically has 2 dimensions but
> > conceptually is equivalent to a 1d array and/or a vector.
>
> Yes. You can also have array that's n x 1 x 1.
>
> > Also, are you including lists in your conceptions of 1d vector here? I'm
> > with Duncan here, in that i'm having trouble understanding exactly what
> you
> > want to do without a bit more context.
>
> Isn't it standard terminology that a vector is the set of atomic vectors +
> list?
>
> Hadley
>
> --
> http://hadley.nz
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

	[[alternative HTML version deleted]]


From becker@g@be @ending from gene@com  Sun Jul  8 06:19:20 2018
From: becker@g@be @ending from gene@com (Gabe Becker)
Date: Sat, 7 Jul 2018 21:19:20 -0700
Subject: [Rd] Testing for vectors
In-Reply-To: <CABdHhvHkRcx=S5ShWkK4Y-yipX-F=xOx=8R1qm8qxeEDojrrCw@mail.gmail.com>
References: <CABdHhvF5gqJt3kDj-QuU92BWPiLWwGugxnNzOfHOHo9tp_AigA@mail.gmail.com>
 <2b0f1462-99d1-d908-5ea6-e9d21be02d11@gmail.com>
 <CABdHhvHuqb82RjNwD4US_oD1pEXLdc2C3YRYpCaV7QTYhUVB9g@mail.gmail.com>
 <CAMFmJs=Fybj+FA1anmPSsWBnak+msX5C2524G=sZ9jFOnJtCTw@mail.gmail.com>
 <CABdHhvHkRcx=S5ShWkK4Y-yipX-F=xOx=8R1qm8qxeEDojrrCw@mail.gmail.com>
Message-ID: <CAMFmJsmYxCmHx1zNQ3mgwEWA_-98rAusE3bunTKwavHYaiHDAA@mail.gmail.com>

Hadley,


On Sat, Jul 7, 2018 at 1:32 PM, Hadley Wickham <h.wickham at gmail.com> wrote:

> On Sat, Jul 7, 2018 at 1:50 PM, Gabe Becker <becker.gabe at gene.com> wrote:
> > Hadley,
> >
> >>
> >> I was thinking primarily of completing the set of is.matrix() and
> >> is.array(), or generally, how do you say: is `x` a 1d dimensional
> >> thing?
> >
> >
> > Can you clarify what you mean by dimensionality sense and specifically 1d
> > here?
>
> What do we call a vector that is not an array? (or matrix)
>
> What do we call an object that acts 1-dimensional? (i.e. has
> length(dim()) %in% c(0, 1)) ?
>


Right, or even (length(dim()) == 0 || sum(dim() > 1) <= 1)

 but that is exactly my point, those two(/three) sets of things are not the
same. 1d arrays meet the second definition but not the first. Matrices and
arrays that don't meet either of yours would still meet mine. Which
definition are you proposing strictly define what a vector is?

Before we have a function which performs the test we need to actually know
what is being tested. So again I would mirror Duncan's question: What code
do you have now or are you planning to write that needs to check this, and
how would it feel about the various types of objects being discussed here?

In other words, in what cases do you actually need to strictly check if
something "is a vector"?

Another completely unrelated way to define vector, btw, is via the vector
interface (from what I recall this is roughly [, [[, length, and format
methods, though I'm probably forgetting some). This is (more or less)
equivalent to defining a vector as "a thing that can be the column of a
data.frame and have all the base-provided machinery work".

> You can also have an n x 1 matrix, which technically has 2 dimensions but
> > conceptually is equivalent to a 1d array and/or a vector.
>
> Yes. You can also have array that's n x 1 x 1.
>
> > Also, are you including lists in your conceptions of 1d vector here? I'm
> > with Duncan here, in that i'm having trouble understanding exactly what
> you
> > want to do without a bit more context.
>
> Isn't it standard terminology that a vector is the set of atomic vectors +
> list?
>

Maybe. If by standard you mean commonly used/understood, though, I doubt
most R users would understand a list to be a vector. I think most people
think of atomic vectors exclusively when they hear "vector" unless they've
very specifically been trained not to do so.

Best,
~G



>
> Hadley
>
> --
> http://hadley.nz
>



-- 
Gabriel Becker, Ph.D
Scientist
Bioinformatics and Computational Biology
Genentech Research

	[[alternative HTML version deleted]]


From otoomet @ending from gm@il@com  Sun Jul  8 06:44:24 2018
From: otoomet @ending from gm@il@com (Ott Toomet)
Date: Sat, 7 Jul 2018 21:44:24 -0700
Subject: [Rd] Testing for vectors
In-Reply-To: <CAMFmJsmYxCmHx1zNQ3mgwEWA_-98rAusE3bunTKwavHYaiHDAA@mail.gmail.com>
References: <CABdHhvF5gqJt3kDj-QuU92BWPiLWwGugxnNzOfHOHo9tp_AigA@mail.gmail.com>
 <2b0f1462-99d1-d908-5ea6-e9d21be02d11@gmail.com>
 <CABdHhvHuqb82RjNwD4US_oD1pEXLdc2C3YRYpCaV7QTYhUVB9g@mail.gmail.com>
 <CAMFmJs=Fybj+FA1anmPSsWBnak+msX5C2524G=sZ9jFOnJtCTw@mail.gmail.com>
 <CABdHhvHkRcx=S5ShWkK4Y-yipX-F=xOx=8R1qm8qxeEDojrrCw@mail.gmail.com>
 <CAMFmJsmYxCmHx1zNQ3mgwEWA_-98rAusE3bunTKwavHYaiHDAA@mail.gmail.com>
Message-ID: <CAMMJQ0Z9ObfQQZ_dWkBwODsLWqCQtL7-8n+gF1ptQu_yPS5Bbw@mail.gmail.com>

Gabe,
I agree that

If by standard you mean commonly used/understood, though, I doubt
> most R users would understand a list to be a vector. I think most people
> think of atomic vectors exclusively when they hear "vector" unless they've
> very specifically been trained not to do so.


However, a common way to create lists is by a construct like
'vector("list", n)'.  Also, 'is.vector' reports TRUE for lists (but FALSE
for many other vectors).  This causes quite a bit of confusion, unless
everyone understands the different 'vector' concepts, embedded in R.

Cheers,
Ott

	[[alternative HTML version deleted]]


From @orenh @ending from m@th@@@u@dk  Sun Jul  8 17:46:26 2018
From: @orenh @ending from m@th@@@u@dk (=?iso-8859-1?Q?S=F8ren_H=F8jsgaard?=)
Date: Sun, 8 Jul 2018 15:46:26 +0000
Subject: [Rd] 
 [R] consider running tools::compactPDF(gs_quality = "ebook")
In-Reply-To: <CAGxFJbRBPGmt9NLdZs-k_9_X-r92Evrh1jE5+5UG=-Q+oA3ziQ@mail.gmail.com>
References: <7E8037094A0C2146AA3E6F94DAE621C3012A64C771@AD-EXCHMBX3-3.aau.dk>,
 <CAGxFJbRBPGmt9NLdZs-k_9_X-r92Evrh1jE5+5UG=-Q+oA3ziQ@mail.gmail.com>
Message-ID: <7E8037094A0C2146AA3E6F94DAE621C3012A64CBF5@AD-EXCHMBX3-3.aau.dk>

Dear all,

I run

R CMD build --compact-vignettes="both"  gRbase

and/or

R CMD build --compact-vignettes="gs+qpdf"  gRbase

and in the log from r-devel (on winbuilder) I get

* checking sizes of PDF files under 'inst/doc' ... WARNING
  'gs+qpdf' made some significant size reductions:
     compacted 'gRbase-arrays.pdf' from 421Kb to 115Kb
  consider running tools::compactPDF(gs_quality = "ebook") on these files

According to "writing R extensions" things should be fine (I have gs and qpdf on my system):

"The --compact-vignettes option will run tools::compactPDF over the PDF files in inst/doc (and its subdirectories) to losslessly compress them. This is not enabled by default (it can be selected by environment variable _R_BUILD_COMPACT_VIGNETTES_) and needs qpdf (http://qpdf.sourceforge.net/) to be available. "

Can anyone please tell me what to do?

Best regards
S?ren

---

> sessionInfo()
R version 3.4.4 (2018-03-15)
Platform: x86_64-pc-linux-gnu (64-bit)
Running under: Ubuntu 16.04.4 LTS

Matrix products: default
BLAS: /usr/lib/libblas/libblas.so.3.

6.0
LAPACK: /usr/lib/lapack/liblapack.so.3.6.0

locale:
 [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
 [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
 [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
 [7] LC_PAPER=en_US.UTF-8       LC_NAME=C
 [9] LC_ADDRESS=C               LC_TELEPHONE=C
[11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] Rcpp_0.12.17    shtools_1.0     markdown_0.8    knitr_1.20
[5] rmarkdown_1.10  devtools_1.13.5

loaded via a namespace (and not attached):
 [1] lattice_0.20-35         digest_0.6.15           withr_2.1.2
 [4] rprojroot_1.3-2         grid_3.4.4              backports_1.1.2
 [7] magrittr_1.5            evaluate_0.10.1         stringi_1.2.3
[10] curl_3.2                RcppArmadillo_0.8.500.0 Matrix_1.2-14
[13] tools_3.4.4             RcppEigen_0.3.3.4.0     stringr_1.3.1
[16] compiler_3.4.4          memoise_1.1.0           htmltools_0.3.6




	[[alternative HTML version deleted]]


From jinghu@zh@o @ending from hotm@il@com  Sun Jul  8 18:00:56 2018
From: jinghu@zh@o @ending from hotm@il@com (jing hua zhao)
Date: Sun, 8 Jul 2018 16:00:56 +0000
Subject: [Rd] 
 [R] consider running tools::compactPDF(gs_quality = "ebook")
In-Reply-To: <7E8037094A0C2146AA3E6F94DAE621C3012A64CBF5@AD-EXCHMBX3-3.aau.dk>
References: <7E8037094A0C2146AA3E6F94DAE621C3012A64C771@AD-EXCHMBX3-3.aau.dk>, 
 <CAGxFJbRBPGmt9NLdZs-k_9_X-r92Evrh1jE5+5UG=-Q+oA3ziQ@mail.gmail.com>,
 <7E8037094A0C2146AA3E6F94DAE621C3012A64CBF5@AD-EXCHMBX3-3.aau.dk>
Message-ID: <DB6P189MB0581E6669D34563F2AAC1AD0A5450@DB6P189MB0581.EURP189.PROD.OUTLOOK.COM>


?did this inside R; not ideal but worked.

________________________________
From: R-devel <r-devel-bounces at r-project.org> on behalf of S?ren H?jsgaard <sorenh at math.aau.dk>
Sent: 08 July 2018 15:46
To: r-devel at r-project.org
Subject: Re: [Rd] [R] consider running tools::compactPDF(gs_quality = "ebook")

Dear all,

I run

R CMD build --compact-vignettes="both"  gRbase

and/or

R CMD build --compact-vignettes="gs+qpdf"  gRbase

and in the log from r-devel (on winbuilder) I get

* checking sizes of PDF files under 'inst/doc' ... WARNING
  'gs+qpdf' made some significant size reductions:
     compacted 'gRbase-arrays.pdf' from 421Kb to 115Kb
  consider running tools::compactPDF(gs_quality = "ebook") on these files

According to "writing R extensions" things should be fine (I have gs and qpdf on my system):

"The --compact-vignettes option will run tools::compactPDF over the PDF files in inst/doc (and its subdirectories) to losslessly compress them. This is not enabled by default (it can be selected by environment variable _R_BUILD_COMPACT_VIGNETTES_) and needs qpdf (http://qpdf.sourceforge.net/) to be available. "
QPDF: A Content-Preserving PDF Transformation System<http://qpdf.sourceforge.net/>
qpdf.sourceforge.net
What is QPDF? QPDF is a command-line program that does structural, content-preserving transformations on PDF files. It could have been called something like pdf-to-pdf.



Can anyone please tell me what to do?

Best regards
S?ren

---

> sessionInfo()
R version 3.4.4 (2018-03-15)
Platform: x86_64-pc-linux-gnu (64-bit)
Running under: Ubuntu 16.04.4 LTS

Matrix products: default
BLAS: /usr/lib/libblas/libblas.so.3.

6.0
LAPACK: /usr/lib/lapack/liblapack.so.3.6.0

locale:
 [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
 [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
 [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
 [7] LC_PAPER=en_US.UTF-8       LC_NAME=C
 [9] LC_ADDRESS=C               LC_TELEPHONE=C
[11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] Rcpp_0.12.17    shtools_1.0     markdown_0.8    knitr_1.20
[5] rmarkdown_1.10  devtools_1.13.5

loaded via a namespace (and not attached):
 [1] lattice_0.20-35         digest_0.6.15           withr_2.1.2
 [4] rprojroot_1.3-2         grid_3.4.4              backports_1.1.2
 [7] magrittr_1.5            evaluate_0.10.1         stringi_1.2.3
[10] curl_3.2                RcppArmadillo_0.8.500.0 Matrix_1.2-14
[13] tools_3.4.4             RcppEigen_0.3.3.4.0     stringr_1.3.1
[16] compiler_3.4.4          memoise_1.1.0           htmltools_0.3.6




        [[alternative HTML version deleted]]


	[[alternative HTML version deleted]]


From jinghu@zh@o @ending from hotm@il@com  Sun Jul  8 18:05:07 2018
From: jinghu@zh@o @ending from hotm@il@com (jing hua zhao)
Date: Sun, 8 Jul 2018 16:05:07 +0000
Subject: [Rd] 
 [R] consider running tools::compactPDF(gs_quality = "ebook")
In-Reply-To: <DB6P189MB0581E6669D34563F2AAC1AD0A5450@DB6P189MB0581.EURP189.PROD.OUTLOOK.COM>
References: <7E8037094A0C2146AA3E6F94DAE621C3012A64C771@AD-EXCHMBX3-3.aau.dk>, 
 <CAGxFJbRBPGmt9NLdZs-k_9_X-r92Evrh1jE5+5UG=-Q+oA3ziQ@mail.gmail.com>, 
 <7E8037094A0C2146AA3E6F94DAE621C3012A64CBF5@AD-EXCHMBX3-3.aau.dk>,
 <DB6P189MB0581E6669D34563F2AAC1AD0A5450@DB6P189MB0581.EURP189.PROD.OUTLOOK.COM>
Message-ID: <DB6P189MB05813F4D80AE35B33FAAE5C6A5450@DB6P189MB0581.EURP189.PROD.OUTLOOK.COM>

A bit clarification -- tools::compactPDF() worked on the PDF at the current directory for me -- not sure about building PDF on the fly.

________________________________
From: R-devel <r-devel-bounces at r-project.org> on behalf of jing hua zhao <jinghuazhao at hotmail.com>
Sent: 08 July 2018 16:00
To: S?ren H?jsgaard; r-devel at r-project.org
Subject: Re: [Rd] [R] consider running tools::compactPDF(gs_quality = "ebook")


?did this inside R; not ideal but worked.

________________________________
From: R-devel <r-devel-bounces at r-project.org> on behalf of S?ren H?jsgaard <sorenh at math.aau.dk>
Sent: 08 July 2018 15:46
To: r-devel at r-project.org
Subject: Re: [Rd] [R] consider running tools::compactPDF(gs_quality = "ebook")

Dear all,

I run

R CMD build --compact-vignettes="both"  gRbase

and/or

R CMD build --compact-vignettes="gs+qpdf"  gRbase

and in the log from r-devel (on winbuilder) I get

* checking sizes of PDF files under 'inst/doc' ... WARNING
  'gs+qpdf' made some significant size reductions:
     compacted 'gRbase-arrays.pdf' from 421Kb to 115Kb
  consider running tools::compactPDF(gs_quality = "ebook") on these files

According to "writing R extensions" things should be fine (I have gs and qpdf on my system):

"The --compact-vignettes option will run tools::compactPDF over the PDF files in inst/doc (and its subdirectories) to losslessly compress them. This is not enabled by default (it can be selected by environment variable _R_BUILD_COMPACT_VIGNETTES_) and needs qpdf (http://qpdf.sourceforge.net/) to be available. "
QPDF: A Content-Preserving PDF Transformation System<http://qpdf.sourceforge.net/>
qpdf.sourceforge.net
What is QPDF? QPDF is a command-line program that does structural, content-preserving transformations on PDF files. It could have been called something like pdf-to-pdf.


QPDF: A Content-Preserving PDF Transformation System<http://qpdf.sourceforge.net/>
qpdf.sourceforge.net
What is QPDF? QPDF is a command-line program that does structural, content-preserving transformations on PDF files. It could have been called something like pdf-to-pdf.



Can anyone please tell me what to do?

Best regards
S?ren

---

> sessionInfo()
R version 3.4.4 (2018-03-15)
Platform: x86_64-pc-linux-gnu (64-bit)
Running under: Ubuntu 16.04.4 LTS

Matrix products: default
BLAS: /usr/lib/libblas/libblas.so.3.

6.0
LAPACK: /usr/lib/lapack/liblapack.so.3.6.0

locale:
 [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
 [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
 [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
 [7] LC_PAPER=en_US.UTF-8       LC_NAME=C
 [9] LC_ADDRESS=C               LC_TELEPHONE=C
[11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] Rcpp_0.12.17    shtools_1.0     markdown_0.8    knitr_1.20
[5] rmarkdown_1.10  devtools_1.13.5

loaded via a namespace (and not attached):
 [1] lattice_0.20-35         digest_0.6.15           withr_2.1.2
 [4] rprojroot_1.3-2         grid_3.4.4              backports_1.1.2
 [7] magrittr_1.5            evaluate_0.10.1         stringi_1.2.3
[10] curl_3.2                RcppArmadillo_0.8.500.0 Matrix_1.2-14
[13] tools_3.4.4             RcppEigen_0.3.3.4.0     stringr_1.3.1
[16] compiler_3.4.4          memoise_1.1.0           htmltools_0.3.6




        [[alternative HTML version deleted]]


        [[alternative HTML version deleted]]

______________________________________________
R-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-devel

	[[alternative HTML version deleted]]


From h@wickh@m @ending from gm@il@com  Mon Jul  9 01:10:14 2018
From: h@wickh@m @ending from gm@il@com (Hadley Wickham)
Date: Sun, 8 Jul 2018 18:10:14 -0500
Subject: [Rd] Testing for vectors
In-Reply-To: <CAMMJQ0b8crhiRzn5x-19RJkavwZP11kvCvFMefGfpXg0nBagOg@mail.gmail.com>
References: <CABdHhvF5gqJt3kDj-QuU92BWPiLWwGugxnNzOfHOHo9tp_AigA@mail.gmail.com>
 <2b0f1462-99d1-d908-5ea6-e9d21be02d11@gmail.com>
 <CABdHhvHuqb82RjNwD4US_oD1pEXLdc2C3YRYpCaV7QTYhUVB9g@mail.gmail.com>
 <CAMFmJs=Fybj+FA1anmPSsWBnak+msX5C2524G=sZ9jFOnJtCTw@mail.gmail.com>
 <CABdHhvHkRcx=S5ShWkK4Y-yipX-F=xOx=8R1qm8qxeEDojrrCw@mail.gmail.com>
 <CAMMJQ0b8crhiRzn5x-19RJkavwZP11kvCvFMefGfpXg0nBagOg@mail.gmail.com>
Message-ID: <CABdHhvE386HD0C4+YFUyQ_n1s0bvyeL+QK8XHMPxN2ccSCLOsg@mail.gmail.com>

On Sat, Jul 7, 2018 at 3:48 PM, Ott Toomet <otoomet at gmail.com> wrote:
> Thanks, Hadley for bringing this up:-)
>
> I am teaching R and I can suggest 5 different definitions of 'vector':
>
> a) vector as a collection of homogeneous objects, indexed by [ ] (more
> precisely atomic vector).  Sometimes you hear that in R, "everything is a
> vector", but this is only true for atomic objects.
> b) vector as a collection of objects, indexed by either [ ] and [[ ]].  This
> includes atomic vectors and lists.
> c) vector versus scalar.  It pops up when teaching math and stats, and is
> somewhat confusing, in particular if my previous claim was that "R does not
> have scalars".
> d) vector versus matrix (or other arrays).  Again, it only matters when
> doing matrix operations where 'vectors', i.e. objects with NULL dimension,
> behave their own way.
> e) finally, 'is.vector' has it's own understanding what constitutes a
> vector.

Yes!

And to add to the confusion there are three meanings to numeric vector:

* As an alias for double (i.e. numeric() and as.numeric())
* To refer to integer and double types jointly (as is S3 and S4 class)
* A vector that behaves as if it is a number (e.g. is.numeric(), which
excludes factors)

Hadley

-- 
http://hadley.nz


From h@wickh@m @ending from gm@il@com  Mon Jul  9 01:13:41 2018
From: h@wickh@m @ending from gm@il@com (Hadley Wickham)
Date: Sun, 8 Jul 2018 18:13:41 -0500
Subject: [Rd] Testing for vectors
In-Reply-To: <CAMFmJsmYxCmHx1zNQ3mgwEWA_-98rAusE3bunTKwavHYaiHDAA@mail.gmail.com>
References: <CABdHhvF5gqJt3kDj-QuU92BWPiLWwGugxnNzOfHOHo9tp_AigA@mail.gmail.com>
 <2b0f1462-99d1-d908-5ea6-e9d21be02d11@gmail.com>
 <CABdHhvHuqb82RjNwD4US_oD1pEXLdc2C3YRYpCaV7QTYhUVB9g@mail.gmail.com>
 <CAMFmJs=Fybj+FA1anmPSsWBnak+msX5C2524G=sZ9jFOnJtCTw@mail.gmail.com>
 <CABdHhvHkRcx=S5ShWkK4Y-yipX-F=xOx=8R1qm8qxeEDojrrCw@mail.gmail.com>
 <CAMFmJsmYxCmHx1zNQ3mgwEWA_-98rAusE3bunTKwavHYaiHDAA@mail.gmail.com>
Message-ID: <CABdHhvHj3ZUQhqzBQP+1gb=fO9g2w4buKnbGGrmJHof3WZtZjg@mail.gmail.com>

On Sat, Jul 7, 2018 at 11:19 PM, Gabe Becker <becker.gabe at gene.com> wrote:
> Hadley,
>
>
> On Sat, Jul 7, 2018 at 1:32 PM, Hadley Wickham <h.wickham at gmail.com> wrote:
>>
>> On Sat, Jul 7, 2018 at 1:50 PM, Gabe Becker <becker.gabe at gene.com> wrote:
>> > Hadley,
>> >
>> >>
>> >> I was thinking primarily of completing the set of is.matrix() and
>> >> is.array(), or generally, how do you say: is `x` a 1d dimensional
>> >> thing?
>> >
>> >
>> > Can you clarify what you mean by dimensionality sense and specifically
>> > 1d
>> > here?
>>
>> What do we call a vector that is not an array? (or matrix)
>>
>> What do we call an object that acts 1-dimensional? (i.e. has
>> length(dim()) %in% c(0, 1)) ?
>
>
>
> Right, or even (length(dim()) == 0 || sum(dim() > 1) <= 1)
>
>  but that is exactly my point, those two(/three) sets of things are not the
> same. 1d arrays meet the second definition but not the first. Matrices and
> arrays that don't meet either of yours would still meet mine. Which
> definition are you proposing strictly define what a vector is?

I am not proposing any definition. I am enquiring if there is a
definition in base R. The answer appears to be now.

> Another completely unrelated way to define vector, btw, is via the vector
> interface (from what I recall this is roughly [, [[, length, and format
> methods, though I'm probably forgetting some). This is (more or less)
> equivalent to defining a vector as "a thing that can be the column of a
> data.frame and have all the base-provided machinery work".

I don't know if that definition is adequate because a call would be a
vector by that definition. I'm pretty sure a call does not make sense
as a data frame column.

Also technically data frames don't require their columns to have equal
length(), but equal NROW(). So the spirit of that definition would
imply that a matrices and arrays are also vectors, which seems like it
might be undesirable.

Hadley

-- 
http://hadley.nz


From wewol@ki @ending from gm@il@com  Mon Jul  9 14:49:52 2018
From: wewol@ki @ending from gm@il@com (Witold E Wolski)
Date: Mon, 9 Jul 2018 14:49:52 +0200
Subject: [Rd] Parametrized Vignettest in R packages
In-Reply-To: <cafaec59-174f-9259-4d5c-f963299cdf23@gmail.com>
References: <CAAjnpdhaeX+=RXCmq3g7jwYQZanfvps1q5i5znmynAGqxb1MPw@mail.gmail.com>
 <129b8986-700f-20bc-fefd-b813df73d06c@gmail.com>
 <CAAjnpdikxuy=KW1OVQEsqkQRwX8VLfedqwxO9mWzZ=cnijx-ZA@mail.gmail.com>
 <cafaec59-174f-9259-4d5c-f963299cdf23@gmail.com>
Message-ID: <CAAjnpdhkSa2_-4yCMvM5pNPjdLem-D4MwM=UmNJrjTGeV8AQfQ@mail.gmail.com>

Dear Duncan,

Following your advice (Thank you for it) I did include into the vignettes
params:
  configuration: !r get(data(sample_analysis))
  data: !r get(data(skylineconfig))

And everything seemed (see below) to work fine.
devtools::build_vignettes() builds the vignettes.

Runs with NO error. By this the .Rmd file, html file and corresponding
.R files is being placed into the inst/doc directory.

However, when I did want to check the package by running
devtools::check(build_args="--no-build-vignettes")

The following warning is shown:

Warning: parse error in file
'C:/Users/wolski/AppData/Local/Temp/Rtmp4QanHv/SRMService.Rcheck/SRMService/doc/tr_srm_summary.R':
/Users/wolski/AppData/Local/Temp/Rtmp4QanHv/SRMService.Rcheck/SRMService/doc/tr_srm_summary.R:2:22:
unexpected '<'
1: params <-
2: list(configuration = <

This is how the start of the .R file produced from the vignette looks like.

params <-
list(configuration = <environment>, data = structure(list(protein_Id =
c("CiRT standards",

I am worried that this is the end of this road with parameterized
vignettes then? What do you think?

regards
Witek





On 2 July 2018 at 18:21, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
> On 02/07/2018 11:22 AM, Witold E Wolski wrote:
>>
>> Hello,
>>
>> Thank you for the questions as well as remaining me of the default
>> parameters in the yaml session.
>> Indeed this seems to be the solution.
>>
>>
>> But how would I assign package data as a default parameter?
>> So originally I thought to render the markdown with :
>>
>> <code>
>> data(sample_analysis)
>> data(skylineconfig)
>> x <- rmarkdown::render("report.Rmd", output_format = "html_document",
>>                        params = list(data = sample_analysis,
>>                                      configuration =
>> skylineconfig),envir = new.env())
>> <code>
>>
>> I do not think I can write:
>>
>> params:
>>    configuration: !r data(sample_analysis)
>>    data: !r data(skylineconfig)
>>
>> since data does not return the package just puts them in the env as a
>> side effect. Is there a different base function to achieve it.
>
>
> I think you could use
>
>  params:
>   configuration: !r get(data(sample_analysis))
>   data: !r get(data(skylineconfig))
>
> but if that doesn't work, a longer version is
>
>  params:
>   configuration: !r {data(sample_analysis); sample_analysis}
>   data: !r {data(skylineconfig); skylineconfig}
>
> Duncan Murdoch
>
>
>>
>>
>> Thank you
>> Witek
>>
>>
>>
>>
>> On 2 July 2018 at 16:56, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
>>>
>>> On 02/07/2018 10:30 AM, Witold E Wolski wrote:
>>>>
>>>>
>>>> Hello,
>>>>
>>>> I have a package which includes some parameterized r-markdown report
>>>> which I would also like to build as package vignettes.
>>>>
>>>> Is there a way to run the parameterized vignette creation with the
>>>> package build or package check?
>>>
>>>
>>>
>>>
>>> Doesn't the usual method work?  You can specify defaults for parameters
>>> in
>>> the YAML header; I'd expect those to be the parameter values that get
>>> used.
>>>
>>> You can give instructions to your users on how to rebuild the reports
>>> with
>>> different parameters.
>>>
>>> Duncan Murdoch
>>>
>>>>
>>>> Thank you
>>>>
>>>
>>
>>
>>
>



-- 
Witold Eryk Wolski


From murdoch@dunc@n @ending from gm@il@com  Mon Jul  9 17:37:50 2018
From: murdoch@dunc@n @ending from gm@il@com (Duncan Murdoch)
Date: Mon, 9 Jul 2018 11:37:50 -0400
Subject: [Rd] Parametrized Vignettest in R packages
In-Reply-To: <CAAjnpdhkSa2_-4yCMvM5pNPjdLem-D4MwM=UmNJrjTGeV8AQfQ@mail.gmail.com>
References: <CAAjnpdhaeX+=RXCmq3g7jwYQZanfvps1q5i5znmynAGqxb1MPw@mail.gmail.com>
 <129b8986-700f-20bc-fefd-b813df73d06c@gmail.com>
 <CAAjnpdikxuy=KW1OVQEsqkQRwX8VLfedqwxO9mWzZ=cnijx-ZA@mail.gmail.com>
 <cafaec59-174f-9259-4d5c-f963299cdf23@gmail.com>
 <CAAjnpdhkSa2_-4yCMvM5pNPjdLem-D4MwM=UmNJrjTGeV8AQfQ@mail.gmail.com>
Message-ID: <6ac69071-c1b9-a7df-b33c-3c9ab1a5c973@gmail.com>

On 09/07/2018 8:49 AM, Witold E Wolski wrote:
> Dear Duncan,
> 
> Following your advice (Thank you for it) I did include into the vignettes
> params:
>    configuration: !r get(data(sample_analysis))
>    data: !r get(data(skylineconfig))
> 
> And everything seemed (see below) to work fine.
> devtools::build_vignettes() builds the vignettes.
> 
> Runs with NO error. By this the .Rmd file, html file and corresponding
> .R files is being placed into the inst/doc directory.
> 
> However, when I did want to check the package by running
> devtools::check(build_args="--no-build-vignettes")
> 
> The following warning is shown:
> 
> Warning: parse error in file
> 'C:/Users/wolski/AppData/Local/Temp/Rtmp4QanHv/SRMService.Rcheck/SRMService/doc/tr_srm_summary.R':
> /Users/wolski/AppData/Local/Temp/Rtmp4QanHv/SRMService.Rcheck/SRMService/doc/tr_srm_summary.R:2:22:
> unexpected '<'
> 1: params <-
> 2: list(configuration = <
> 
> This is how the start of the .R file produced from the vignette looks like.
> 
> params <-
> list(configuration = <environment>, data = structure(list(protein_Id =
> c("CiRT standards",
> 
> I am worried that this is the end of this road with parameterized
> vignettes then? What do you think?

Interesting.  The issue is that the value being assigned to 
configuration is an environment, and whatever code produces those lines 
in tr_srm_summary.R isn't deparsing it into something parseable.  (This 
isn't a big surprise:  dput and deparse both fail at that.)

I'd guess a solution is not to save sample_analysis as an environment, 
but maybe you didn't know you were doing that since some other 
structures are implemented as environments.

Perhaps you could use

configuration: !r as.list(get(data(sample_analysis)))

and then when you need to use it, convert it back to the original type?

Duncan Murdoch
> 
> regards
> Witek
> 
> 
> 
> 
> 
> On 2 July 2018 at 18:21, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
>> On 02/07/2018 11:22 AM, Witold E Wolski wrote:
>>>
>>> Hello,
>>>
>>> Thank you for the questions as well as remaining me of the default
>>> parameters in the yaml session.
>>> Indeed this seems to be the solution.
>>>
>>>
>>> But how would I assign package data as a default parameter?
>>> So originally I thought to render the markdown with :
>>>
>>> <code>
>>> data(sample_analysis)
>>> data(skylineconfig)
>>> x <- rmarkdown::render("report.Rmd", output_format = "html_document",
>>>                         params = list(data = sample_analysis,
>>>                                       configuration =
>>> skylineconfig),envir = new.env())
>>> <code>
>>>
>>> I do not think I can write:
>>>
>>> params:
>>>     configuration: !r data(sample_analysis)
>>>     data: !r data(skylineconfig)
>>>
>>> since data does not return the package just puts them in the env as a
>>> side effect. Is there a different base function to achieve it.
>>
>>
>> I think you could use
>>
>>   params:
>>    configuration: !r get(data(sample_analysis))
>>    data: !r get(data(skylineconfig))
>>
>> but if that doesn't work, a longer version is
>>
>>   params:
>>    configuration: !r {data(sample_analysis); sample_analysis}
>>    data: !r {data(skylineconfig); skylineconfig}
>>
>> Duncan Murdoch
>>
>>
>>>
>>>
>>> Thank you
>>> Witek
>>>
>>>
>>>
>>>
>>> On 2 July 2018 at 16:56, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
>>>>
>>>> On 02/07/2018 10:30 AM, Witold E Wolski wrote:
>>>>>
>>>>>
>>>>> Hello,
>>>>>
>>>>> I have a package which includes some parameterized r-markdown report
>>>>> which I would also like to build as package vignettes.
>>>>>
>>>>> Is there a way to run the parameterized vignette creation with the
>>>>> package build or package check?
>>>>
>>>>
>>>>
>>>>
>>>> Doesn't the usual method work?  You can specify defaults for parameters
>>>> in
>>>> the YAML header; I'd expect those to be the parameter values that get
>>>> used.
>>>>
>>>> You can give instructions to your users on how to rebuild the reports
>>>> with
>>>> different parameters.
>>>>
>>>> Duncan Murdoch
>>>>
>>>>>
>>>>> Thank you
>>>>>
>>>>
>>>
>>>
>>>
>>
> 
> 
>


From xie @ending from yihui@n@me  Mon Jul  9 18:24:42 2018
From: xie @ending from yihui@n@me (Yihui Xie)
Date: Mon, 9 Jul 2018 11:24:42 -0500
Subject: [Rd] Parametrized Vignettest in R packages
In-Reply-To: <6ac69071-c1b9-a7df-b33c-3c9ab1a5c973@gmail.com>
References: <CAAjnpdhaeX+=RXCmq3g7jwYQZanfvps1q5i5znmynAGqxb1MPw@mail.gmail.com>
 <129b8986-700f-20bc-fefd-b813df73d06c@gmail.com>
 <CAAjnpdikxuy=KW1OVQEsqkQRwX8VLfedqwxO9mWzZ=cnijx-ZA@mail.gmail.com>
 <cafaec59-174f-9259-4d5c-f963299cdf23@gmail.com>
 <CAAjnpdhkSa2_-4yCMvM5pNPjdLem-D4MwM=UmNJrjTGeV8AQfQ@mail.gmail.com>
 <6ac69071-c1b9-a7df-b33c-3c9ab1a5c973@gmail.com>
Message-ID: <CANROs4ffNzoB5ZCDpVjkz6RjboyYuDGb+BCP5Z2NtKywmXuRTQ@mail.gmail.com>

So far you haven't provided a reproducible example yet. I wonder what
exactly the object `sample_analysis` is. Sounds like it is an
environment. If that is the case, devtools::build_vignettes() will
tangle (for the meaning of "tangle", see ?tools::buildVignette) your
vignette into an invalid R script. Environments cannot be represented
via dput(), so knitr's purl() (eventually called by the vignette
engine) cannot really create a valid R script when your vignette
contains `params` that uses environment values. Most other types of
values should be fine.

Regards,
Yihui
--
https://yihui.name


On Mon, Jul 9, 2018 at 10:37 AM, Duncan Murdoch
<murdoch.duncan at gmail.com> wrote:
> On 09/07/2018 8:49 AM, Witold E Wolski wrote:
>>
>> Dear Duncan,
>>
>> Following your advice (Thank you for it) I did include into the vignettes
>> params:
>>    configuration: !r get(data(sample_analysis))
>>    data: !r get(data(skylineconfig))
>>
>> And everything seemed (see below) to work fine.
>> devtools::build_vignettes() builds the vignettes.
>>
>> Runs with NO error. By this the .Rmd file, html file and corresponding
>> .R files is being placed into the inst/doc directory.
>>
>> However, when I did want to check the package by running
>> devtools::check(build_args="--no-build-vignettes")
>>
>> The following warning is shown:
>>
>> Warning: parse error in file
>>
>> 'C:/Users/wolski/AppData/Local/Temp/Rtmp4QanHv/SRMService.Rcheck/SRMService/doc/tr_srm_summary.R':
>>
>> /Users/wolski/AppData/Local/Temp/Rtmp4QanHv/SRMService.Rcheck/SRMService/doc/tr_srm_summary.R:2:22:
>> unexpected '<'
>> 1: params <-
>> 2: list(configuration = <
>>
>> This is how the start of the .R file produced from the vignette looks
>> like.
>>
>> params <-
>> list(configuration = <environment>, data = structure(list(protein_Id =
>> c("CiRT standards",
>>
>> I am worried that this is the end of this road with parameterized
>> vignettes then? What do you think?
>
>
> Interesting.  The issue is that the value being assigned to configuration is
> an environment, and whatever code produces those lines in tr_srm_summary.R
> isn't deparsing it into something parseable.  (This isn't a big surprise:
> dput and deparse both fail at that.)
>
> I'd guess a solution is not to save sample_analysis as an environment, but
> maybe you didn't know you were doing that since some other structures are
> implemented as environments.
>
> Perhaps you could use
>
> configuration: !r as.list(get(data(sample_analysis)))
>
> and then when you need to use it, convert it back to the original type?
>
> Duncan Murdoch
>>
>>
>> regards
>> Witek
>>
>>
>>
>>
>>
>> On 2 July 2018 at 18:21, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
>>>
>>> On 02/07/2018 11:22 AM, Witold E Wolski wrote:
>>>>
>>>>
>>>> Hello,
>>>>
>>>> Thank you for the questions as well as remaining me of the default
>>>> parameters in the yaml session.
>>>> Indeed this seems to be the solution.
>>>>
>>>>
>>>> But how would I assign package data as a default parameter?
>>>> So originally I thought to render the markdown with :
>>>>
>>>> <code>
>>>> data(sample_analysis)
>>>> data(skylineconfig)
>>>> x <- rmarkdown::render("report.Rmd", output_format = "html_document",
>>>>                         params = list(data = sample_analysis,
>>>>                                       configuration =
>>>> skylineconfig),envir = new.env())
>>>> <code>
>>>>
>>>> I do not think I can write:
>>>>
>>>> params:
>>>>     configuration: !r data(sample_analysis)
>>>>     data: !r data(skylineconfig)
>>>>
>>>> since data does not return the package just puts them in the env as a
>>>> side effect. Is there a different base function to achieve it.
>>>
>>>
>>>
>>> I think you could use
>>>
>>>   params:
>>>    configuration: !r get(data(sample_analysis))
>>>    data: !r get(data(skylineconfig))
>>>
>>> but if that doesn't work, a longer version is
>>>
>>>   params:
>>>    configuration: !r {data(sample_analysis); sample_analysis}
>>>    data: !r {data(skylineconfig); skylineconfig}
>>>
>>> Duncan Murdoch
>>>
>>>
>>>>
>>>>
>>>> Thank you
>>>> Witek
>>>>
>>>>
>>>>
>>>>
>>>> On 2 July 2018 at 16:56, Duncan Murdoch <murdoch.duncan at gmail.com>
>>>> wrote:
>>>>>
>>>>>
>>>>> On 02/07/2018 10:30 AM, Witold E Wolski wrote:
>>>>>>
>>>>>>
>>>>>>
>>>>>> Hello,
>>>>>>
>>>>>> I have a package which includes some parameterized r-markdown report
>>>>>> which I would also like to build as package vignettes.
>>>>>>
>>>>>> Is there a way to run the parameterized vignette creation with the
>>>>>> package build or package check?
>>>>>
>>>>>
>>>>>
>>>>>
>>>>>
>>>>> Doesn't the usual method work?  You can specify defaults for parameters
>>>>> in
>>>>> the YAML header; I'd expect those to be the parameter values that get
>>>>> used.
>>>>>
>>>>> You can give instructions to your users on how to rebuild the reports
>>>>> with
>>>>> different parameters.
>>>>>
>>>>> Duncan Murdoch
>>>>>
>>>>>>
>>>>>> Thank you
>>>>>>
>>>>>
>>>>
>>>>
>>>>
>>>
>>
>>
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From murdoch@dunc@n @ending from gm@il@com  Mon Jul  9 19:57:53 2018
From: murdoch@dunc@n @ending from gm@il@com (Duncan Murdoch)
Date: Mon, 9 Jul 2018 13:57:53 -0400
Subject: [Rd] Parametrized Vignettest in R packages
In-Reply-To: <CANROs4ffNzoB5ZCDpVjkz6RjboyYuDGb+BCP5Z2NtKywmXuRTQ@mail.gmail.com>
References: <CAAjnpdhaeX+=RXCmq3g7jwYQZanfvps1q5i5znmynAGqxb1MPw@mail.gmail.com>
 <129b8986-700f-20bc-fefd-b813df73d06c@gmail.com>
 <CAAjnpdikxuy=KW1OVQEsqkQRwX8VLfedqwxO9mWzZ=cnijx-ZA@mail.gmail.com>
 <cafaec59-174f-9259-4d5c-f963299cdf23@gmail.com>
 <CAAjnpdhkSa2_-4yCMvM5pNPjdLem-D4MwM=UmNJrjTGeV8AQfQ@mail.gmail.com>
 <6ac69071-c1b9-a7df-b33c-3c9ab1a5c973@gmail.com>
 <CANROs4ffNzoB5ZCDpVjkz6RjboyYuDGb+BCP5Z2NtKywmXuRTQ@mail.gmail.com>
Message-ID: <ed9337d5-5788-aa37-6607-58b43ec33189@gmail.com>

On 09/07/2018 12:24 PM, Yihui Xie wrote:
> So far you haven't provided a reproducible example yet. I wonder what
> exactly the object `sample_analysis` is. Sounds like it is an
> environment. If that is the case, devtools::build_vignettes() will
> tangle (for the meaning of "tangle", see ?tools::buildVignette) your
> vignette into an invalid R script. Environments cannot be represented
> via dput(), so knitr's purl() (eventually called by the vignette
> engine) cannot really create a valid R script when your vignette
> contains `params` that uses environment values. Most other types of
> values should be fine.

One possibility is to delay evaluation of the parameter.  For example 
putting

params:
   configuration:  !r quote(get(data(sample_analysis)))

in the YAML will set configuration to the expression needed to get the 
environment;

     eval(params$configuration)

gives you the environment itself.

Duncan Murdoch




> 
> Regards,
> Yihui
> --
> https://yihui.name
> 
> 
> On Mon, Jul 9, 2018 at 10:37 AM, Duncan Murdoch
> <murdoch.duncan at gmail.com> wrote:
>> On 09/07/2018 8:49 AM, Witold E Wolski wrote:
>>>
>>> Dear Duncan,
>>>
>>> Following your advice (Thank you for it) I did include into the vignettes
>>> params:
>>>     configuration: !r get(data(sample_analysis))
>>>     data: !r get(data(skylineconfig))
>>>
>>> And everything seemed (see below) to work fine.
>>> devtools::build_vignettes() builds the vignettes.
>>>
>>> Runs with NO error. By this the .Rmd file, html file and corresponding
>>> .R files is being placed into the inst/doc directory.
>>>
>>> However, when I did want to check the package by running
>>> devtools::check(build_args="--no-build-vignettes")
>>>
>>> The following warning is shown:
>>>
>>> Warning: parse error in file
>>>
>>> 'C:/Users/wolski/AppData/Local/Temp/Rtmp4QanHv/SRMService.Rcheck/SRMService/doc/tr_srm_summary.R':
>>>
>>> /Users/wolski/AppData/Local/Temp/Rtmp4QanHv/SRMService.Rcheck/SRMService/doc/tr_srm_summary.R:2:22:
>>> unexpected '<'
>>> 1: params <-
>>> 2: list(configuration = <
>>>
>>> This is how the start of the .R file produced from the vignette looks
>>> like.
>>>
>>> params <-
>>> list(configuration = <environment>, data = structure(list(protein_Id =
>>> c("CiRT standards",
>>>
>>> I am worried that this is the end of this road with parameterized
>>> vignettes then? What do you think?
>>
>>
>> Interesting.  The issue is that the value being assigned to configuration is
>> an environment, and whatever code produces those lines in tr_srm_summary.R
>> isn't deparsing it into something parseable.  (This isn't a big surprise:
>> dput and deparse both fail at that.)
>>
>> I'd guess a solution is not to save sample_analysis as an environment, but
>> maybe you didn't know you were doing that since some other structures are
>> implemented as environments.
>>
>> Perhaps you could use
>>
>> configuration: !r as.list(get(data(sample_analysis)))
>>
>> and then when you need to use it, convert it back to the original type?
>>
>> Duncan Murdoch
>>>
>>>
>>> regards
>>> Witek
>>>
>>>
>>>
>>>
>>>
>>> On 2 July 2018 at 18:21, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
>>>>
>>>> On 02/07/2018 11:22 AM, Witold E Wolski wrote:
>>>>>
>>>>>
>>>>> Hello,
>>>>>
>>>>> Thank you for the questions as well as remaining me of the default
>>>>> parameters in the yaml session.
>>>>> Indeed this seems to be the solution.
>>>>>
>>>>>
>>>>> But how would I assign package data as a default parameter?
>>>>> So originally I thought to render the markdown with :
>>>>>
>>>>> <code>
>>>>> data(sample_analysis)
>>>>> data(skylineconfig)
>>>>> x <- rmarkdown::render("report.Rmd", output_format = "html_document",
>>>>>                          params = list(data = sample_analysis,
>>>>>                                        configuration =
>>>>> skylineconfig),envir = new.env())
>>>>> <code>
>>>>>
>>>>> I do not think I can write:
>>>>>
>>>>> params:
>>>>>      configuration: !r data(sample_analysis)
>>>>>      data: !r data(skylineconfig)
>>>>>
>>>>> since data does not return the package just puts them in the env as a
>>>>> side effect. Is there a different base function to achieve it.
>>>>
>>>>
>>>>
>>>> I think you could use
>>>>
>>>>    params:
>>>>     configuration: !r get(data(sample_analysis))
>>>>     data: !r get(data(skylineconfig))
>>>>
>>>> but if that doesn't work, a longer version is
>>>>
>>>>    params:
>>>>     configuration: !r {data(sample_analysis); sample_analysis}
>>>>     data: !r {data(skylineconfig); skylineconfig}
>>>>
>>>> Duncan Murdoch
>>>>
>>>>
>>>>>
>>>>>
>>>>> Thank you
>>>>> Witek
>>>>>
>>>>>
>>>>>
>>>>>
>>>>> On 2 July 2018 at 16:56, Duncan Murdoch <murdoch.duncan at gmail.com>
>>>>> wrote:
>>>>>>
>>>>>>
>>>>>> On 02/07/2018 10:30 AM, Witold E Wolski wrote:
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>> Hello,
>>>>>>>
>>>>>>> I have a package which includes some parameterized r-markdown report
>>>>>>> which I would also like to build as package vignettes.
>>>>>>>
>>>>>>> Is there a way to run the parameterized vignette creation with the
>>>>>>> package build or package check?
>>>>>>
>>>>>>
>>>>>>
>>>>>>
>>>>>>
>>>>>> Doesn't the usual method work?  You can specify defaults for parameters
>>>>>> in
>>>>>> the YAML header; I'd expect those to be the parameter values that get
>>>>>> used.
>>>>>>
>>>>>> You can give instructions to your users on how to rebuild the reports
>>>>>> with
>>>>>> different parameters.
>>>>>>
>>>>>> Duncan Murdoch
>>>>>>
>>>>>>>
>>>>>>> Thank you
>>>>>>>
>>>>>>
>>>>>
>>>>>
>>>>>
>>>>
>>>
>>>
>>>
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel


From wewol@ki @ending from gm@il@com  Mon Jul  9 21:24:57 2018
From: wewol@ki @ending from gm@il@com (Witold E Wolski)
Date: Mon, 9 Jul 2018 21:24:57 +0200
Subject: [Rd] Parametrized Vignettest in R packages
In-Reply-To: <CANROs4ffNzoB5ZCDpVjkz6RjboyYuDGb+BCP5Z2NtKywmXuRTQ@mail.gmail.com>
References: <CAAjnpdhaeX+=RXCmq3g7jwYQZanfvps1q5i5znmynAGqxb1MPw@mail.gmail.com>
 <129b8986-700f-20bc-fefd-b813df73d06c@gmail.com>
 <CAAjnpdikxuy=KW1OVQEsqkQRwX8VLfedqwxO9mWzZ=cnijx-ZA@mail.gmail.com>
 <cafaec59-174f-9259-4d5c-f963299cdf23@gmail.com>
 <CAAjnpdhkSa2_-4yCMvM5pNPjdLem-D4MwM=UmNJrjTGeV8AQfQ@mail.gmail.com>
 <6ac69071-c1b9-a7df-b33c-3c9ab1a5c973@gmail.com>
 <CANROs4ffNzoB5ZCDpVjkz6RjboyYuDGb+BCP5Z2NtKywmXuRTQ@mail.gmail.com>
Message-ID: <CAAjnpdjWuQGYPBEstqHQn0wz-9d+8fyEH8oaArA+EDZ-u-WeGQ@mail.gmail.com>

Dear Yihui,

Thank you for the valuable questions.

sample_analysis is a "tibble" while
configuration is an "R6" class.
But I also have parametrized reports where I pass R reference classes
as arguments.

This is the Rmd yaml params part corresponding to the error message.

params:
  configuration:  !r get(data(skylineconfig))
  data: !r get(data(sample_analysis))

Might the R6 class which I pass to  configuration the source of the
problem here? I have heard somewhere that R6 uses environments to
implemented some features.



There is also a further problem I am encountering reproducible when
running devtools::install() or R CMD INSTALL

** installing vignettes
   'tr_srm_summary.Rmd' using 'UTF-8'
Warning in data(skylineconfig) : data set 'skylineconfig' not found
Error in get(data(skylineconfig)) : object 'skylineconfig' not found

This problem isn't happening when running
devtools::build_vignettes()

The Package install works however if I first build the vignettes with
devtools::build_vignettes() and than run R CMD INSTALL


I will be sending to you a link to a repository with a reproducible
example in a separate e-mail.

Kind regards
Witek

On 9 July 2018 at 18:24, Yihui Xie <xie at yihui.name> wrote:
> So far you haven't provided a reproducible example yet. I wonder what
> exactly the object `sample_analysis` is. Sounds like it is an
> environment. If that is the case, devtools::build_vignettes() will
> tangle (for the meaning of "tangle", see ?tools::buildVignette) your
> vignette into an invalid R script. Environments cannot be represented
> via dput(), so knitr's purl() (eventually called by the vignette
> engine) cannot really create a valid R script when your vignette
> contains `params` that uses environment values. Most other types of
> values should be fine.
>
> Regards,
> Yihui
> --
> https://yihui.name
>
>
> On Mon, Jul 9, 2018 at 10:37 AM, Duncan Murdoch
> <murdoch.duncan at gmail.com> wrote:
>> On 09/07/2018 8:49 AM, Witold E Wolski wrote:
>>>
>>> Dear Duncan,
>>>
>>> Following your advice (Thank you for it) I did include into the vignettes
>>> params:
>>>    configuration: !r get(data(sample_analysis))
>>>    data: !r get(data(skylineconfig))
>>>
>>> And everything seemed (see below) to work fine.
>>> devtools::build_vignettes() builds the vignettes.
>>>
>>> Runs with NO error. By this the .Rmd file, html file and corresponding
>>> .R files is being placed into the inst/doc directory.
>>>
>>> However, when I did want to check the package by running
>>> devtools::check(build_args="--no-build-vignettes")
>>>
>>> The following warning is shown:
>>>
>>> Warning: parse error in file
>>>
>>> 'C:/Users/wolski/AppData/Local/Temp/Rtmp4QanHv/SRMService.Rcheck/SRMService/doc/tr_srm_summary.R':
>>>
>>> /Users/wolski/AppData/Local/Temp/Rtmp4QanHv/SRMService.Rcheck/SRMService/doc/tr_srm_summary.R:2:22:
>>> unexpected '<'
>>> 1: params <-
>>> 2: list(configuration = <
>>>
>>> This is how the start of the .R file produced from the vignette looks
>>> like.
>>>
>>> params <-
>>> list(configuration = <environment>, data = structure(list(protein_Id =
>>> c("CiRT standards",
>>>
>>> I am worried that this is the end of this road with parameterized
>>> vignettes then? What do you think?
>>
>>
>> Interesting.  The issue is that the value being assigned to configuration is
>> an environment, and whatever code produces those lines in tr_srm_summary.R
>> isn't deparsing it into something parseable.  (This isn't a big surprise:
>> dput and deparse both fail at that.)
>>
>> I'd guess a solution is not to save sample_analysis as an environment, but
>> maybe you didn't know you were doing that since some other structures are
>> implemented as environments.
>>
>> Perhaps you could use
>>
>> configuration: !r as.list(get(data(sample_analysis)))
>>
>> and then when you need to use it, convert it back to the original type?
>>
>> Duncan Murdoch
>>>
>>>
>>> regards
>>> Witek
>>>
>>>
>>>
>>>
>>>
>>> On 2 July 2018 at 18:21, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
>>>>
>>>> On 02/07/2018 11:22 AM, Witold E Wolski wrote:
>>>>>
>>>>>
>>>>> Hello,
>>>>>
>>>>> Thank you for the questions as well as remaining me of the default
>>>>> parameters in the yaml session.
>>>>> Indeed this seems to be the solution.
>>>>>
>>>>>
>>>>> But how would I assign package data as a default parameter?
>>>>> So originally I thought to render the markdown with :
>>>>>
>>>>> <code>
>>>>> data(sample_analysis)
>>>>> data(skylineconfig)
>>>>> x <- rmarkdown::render("report.Rmd", output_format = "html_document",
>>>>>                         params = list(data = sample_analysis,
>>>>>                                       configuration =
>>>>> skylineconfig),envir = new.env())
>>>>> <code>
>>>>>
>>>>> I do not think I can write:
>>>>>
>>>>> params:
>>>>>     configuration: !r data(sample_analysis)
>>>>>     data: !r data(skylineconfig)
>>>>>
>>>>> since data does not return the package just puts them in the env as a
>>>>> side effect. Is there a different base function to achieve it.
>>>>
>>>>
>>>>
>>>> I think you could use
>>>>
>>>>   params:
>>>>    configuration: !r get(data(sample_analysis))
>>>>    data: !r get(data(skylineconfig))
>>>>
>>>> but if that doesn't work, a longer version is
>>>>
>>>>   params:
>>>>    configuration: !r {data(sample_analysis); sample_analysis}
>>>>    data: !r {data(skylineconfig); skylineconfig}
>>>>
>>>> Duncan Murdoch
>>>>
>>>>
>>>>>
>>>>>
>>>>> Thank you
>>>>> Witek
>>>>>
>>>>>
>>>>>
>>>>>
>>>>> On 2 July 2018 at 16:56, Duncan Murdoch <murdoch.duncan at gmail.com>
>>>>> wrote:
>>>>>>
>>>>>>
>>>>>> On 02/07/2018 10:30 AM, Witold E Wolski wrote:
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>> Hello,
>>>>>>>
>>>>>>> I have a package which includes some parameterized r-markdown report
>>>>>>> which I would also like to build as package vignettes.
>>>>>>>
>>>>>>> Is there a way to run the parameterized vignette creation with the
>>>>>>> package build or package check?
>>>>>>
>>>>>>
>>>>>>
>>>>>>
>>>>>>
>>>>>> Doesn't the usual method work?  You can specify defaults for parameters
>>>>>> in
>>>>>> the YAML header; I'd expect those to be the parameter values that get
>>>>>> used.
>>>>>>
>>>>>> You can give instructions to your users on how to rebuild the reports
>>>>>> with
>>>>>> different parameters.
>>>>>>
>>>>>> Duncan Murdoch
>>>>>>
>>>>>>>
>>>>>>> Thank you
>>>>>>>
>>>>>>
>>>>>
>>>>>
>>>>>
>>>>
>>>
>>>
>>>
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel



-- 
Witold Eryk Wolski


From murdoch@dunc@n @ending from gm@il@com  Mon Jul  9 21:32:38 2018
From: murdoch@dunc@n @ending from gm@il@com (Duncan Murdoch)
Date: Mon, 9 Jul 2018 15:32:38 -0400
Subject: [Rd] Parametrized Vignettest in R packages
In-Reply-To: <CAAjnpdjWuQGYPBEstqHQn0wz-9d+8fyEH8oaArA+EDZ-u-WeGQ@mail.gmail.com>
References: <CAAjnpdhaeX+=RXCmq3g7jwYQZanfvps1q5i5znmynAGqxb1MPw@mail.gmail.com>
 <129b8986-700f-20bc-fefd-b813df73d06c@gmail.com>
 <CAAjnpdikxuy=KW1OVQEsqkQRwX8VLfedqwxO9mWzZ=cnijx-ZA@mail.gmail.com>
 <cafaec59-174f-9259-4d5c-f963299cdf23@gmail.com>
 <CAAjnpdhkSa2_-4yCMvM5pNPjdLem-D4MwM=UmNJrjTGeV8AQfQ@mail.gmail.com>
 <6ac69071-c1b9-a7df-b33c-3c9ab1a5c973@gmail.com>
 <CANROs4ffNzoB5ZCDpVjkz6RjboyYuDGb+BCP5Z2NtKywmXuRTQ@mail.gmail.com>
 <CAAjnpdjWuQGYPBEstqHQn0wz-9d+8fyEH8oaArA+EDZ-u-WeGQ@mail.gmail.com>
Message-ID: <95032c71-f99c-23d1-64a2-1651efa15cb0@gmail.com>

On 09/07/2018 3:24 PM, Witold E Wolski wrote:
> Dear Yihui,
> 
> Thank you for the valuable questions.
> 
> sample_analysis is a "tibble" while
> configuration is an "R6" class.
> But I also have parametrized reports where I pass R reference classes
> as arguments.
> 
> This is the Rmd yaml params part corresponding to the error message.
> 
> params:
>    configuration:  !r get(data(skylineconfig))
>    data: !r get(data(sample_analysis))
> 
> Might the R6 class which I pass to  configuration the source of the
> problem here? I have heard somewhere that R6 uses environments to
> implemented some features.
> 
> 
> 
> There is also a further problem I am encountering reproducible when
> running devtools::install() or R CMD INSTALL
> 
> ** installing vignettes
>     'tr_srm_summary.Rmd' using 'UTF-8'
> Warning in data(skylineconfig) : data set 'skylineconfig' not found
> Error in get(data(skylineconfig)) : object 'skylineconfig' not found

You likely need to specify the package name, e.g.

data("skylineconfig", package = "yourpackage")

Also see my suggestion to use quote() to delay evaluation:

> params:
>    configuration:  !r quote(get(data(sample_analysis)))
> 
> in the YAML will set configuration to the expression needed to get the 
> environment;
> 
>      eval(params$configuration)

Duncan Murdoch


From wewol@ki @ending from gm@il@com  Mon Jul  9 22:11:32 2018
From: wewol@ki @ending from gm@il@com (Witold E Wolski)
Date: Mon, 9 Jul 2018 22:11:32 +0200
Subject: [Rd] Parametrized Vignettest in R packages
In-Reply-To: <95032c71-f99c-23d1-64a2-1651efa15cb0@gmail.com>
References: <CAAjnpdhaeX+=RXCmq3g7jwYQZanfvps1q5i5znmynAGqxb1MPw@mail.gmail.com>
 <129b8986-700f-20bc-fefd-b813df73d06c@gmail.com>
 <CAAjnpdikxuy=KW1OVQEsqkQRwX8VLfedqwxO9mWzZ=cnijx-ZA@mail.gmail.com>
 <cafaec59-174f-9259-4d5c-f963299cdf23@gmail.com>
 <CAAjnpdhkSa2_-4yCMvM5pNPjdLem-D4MwM=UmNJrjTGeV8AQfQ@mail.gmail.com>
 <6ac69071-c1b9-a7df-b33c-3c9ab1a5c973@gmail.com>
 <CANROs4ffNzoB5ZCDpVjkz6RjboyYuDGb+BCP5Z2NtKywmXuRTQ@mail.gmail.com>
 <CAAjnpdjWuQGYPBEstqHQn0wz-9d+8fyEH8oaArA+EDZ-u-WeGQ@mail.gmail.com>
 <95032c71-f99c-23d1-64a2-1651efa15cb0@gmail.com>
Message-ID: <CAAjnpdhgaDipXmcydysPmnM9+VCGCMVBc0NPm2rdUfVZX=UUgg@mail.gmail.com>

Dear Duncan,

Was close to giving up to use the parameterized rmarkown as vignettes.
But your suggestions to use quote and eval, as well as to use the
package parameter in data
 made it work, with all devtools::install,check,build and
build_vignettes as well as with R CMD ... etc.
But most importantly it also still works with:
rmarkdown::render("vignettes/tr_srm_summary.Rmd",
params=list(configuration=skylineconfig, data=sample_analysis    ))

THANK YOU.

This is how my vignette header looks (see below) and it works.

---
title: "Titel"
author: "WEW at FGCZ.ETHZ.CH"
date: "`r Sys.Date()`"
output:
  pdf_document: default
  html_document: default
params:
  configuration:  !r quote(get(data(skylineconfig, package="myPackage")))
  data: !r quote(get(data(sample_analysis, package="myPackage")))
vignette: >
  %\VignetteIndexEntry{Summarize Peptide Level Measurements}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---


```{r setup, include=FALSE}
library(tidyverse)

knitr::opts_chunk$set(echo = FALSE, message=FALSE)
data <- eval(params$data)
configuration <- eval(params$configuration)
```

Have a great evening.

regards
Witek

On 9 July 2018 at 21:32, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
> On 09/07/2018 3:24 PM, Witold E Wolski wrote:
>>
>> Dear Yihui,
>>
>> Thank you for the valuable questions.
>>
>> sample_analysis is a "tibble" while
>> configuration is an "R6" class.
>> But I also have parametrized reports where I pass R reference classes
>> as arguments.
>>
>> This is the Rmd yaml params part corresponding to the error message.
>>
>> params:
>>    configuration:  !r get(data(skylineconfig))
>>    data: !r get(data(sample_analysis))
>>
>> Might the R6 class which I pass to  configuration the source of the
>> problem here? I have heard somewhere that R6 uses environments to
>> implemented some features.
>>
>>
>>
>> There is also a further problem I am encountering reproducible when
>> running devtools::install() or R CMD INSTALL
>>
>> ** installing vignettes
>>     'tr_srm_summary.Rmd' using 'UTF-8'
>> Warning in data(skylineconfig) : data set 'skylineconfig' not found
>> Error in get(data(skylineconfig)) : object 'skylineconfig' not found
>
>
> You likely need to specify the package name, e.g.
>
> data("skylineconfig", package = "yourpackage")
>
> Also see my suggestion to use quote() to delay evaluation:
>
>
>> params:
>>    configuration:  !r quote(get(data(sample_analysis)))
>>
>> in the YAML will set configuration to the expression needed to get the
>> environment;
>>
>>      eval(params$configuration)
>
>
> Duncan Murdoch



-- 
Witold Eryk Wolski


From xie @ending from yihui@n@me  Mon Jul  9 22:19:38 2018
From: xie @ending from yihui@n@me (Yihui Xie)
Date: Mon, 9 Jul 2018 15:19:38 -0500
Subject: [Rd] Parametrized Vignettest in R packages
In-Reply-To: <CAAjnpdhgaDipXmcydysPmnM9+VCGCMVBc0NPm2rdUfVZX=UUgg@mail.gmail.com>
References: <CAAjnpdhaeX+=RXCmq3g7jwYQZanfvps1q5i5znmynAGqxb1MPw@mail.gmail.com>
 <129b8986-700f-20bc-fefd-b813df73d06c@gmail.com>
 <CAAjnpdikxuy=KW1OVQEsqkQRwX8VLfedqwxO9mWzZ=cnijx-ZA@mail.gmail.com>
 <cafaec59-174f-9259-4d5c-f963299cdf23@gmail.com>
 <CAAjnpdhkSa2_-4yCMvM5pNPjdLem-D4MwM=UmNJrjTGeV8AQfQ@mail.gmail.com>
 <6ac69071-c1b9-a7df-b33c-3c9ab1a5c973@gmail.com>
 <CANROs4ffNzoB5ZCDpVjkz6RjboyYuDGb+BCP5Z2NtKywmXuRTQ@mail.gmail.com>
 <CAAjnpdjWuQGYPBEstqHQn0wz-9d+8fyEH8oaArA+EDZ-u-WeGQ@mail.gmail.com>
 <95032c71-f99c-23d1-64a2-1651efa15cb0@gmail.com>
 <CAAjnpdhgaDipXmcydysPmnM9+VCGCMVBc0NPm2rdUfVZX=UUgg@mail.gmail.com>
Message-ID: <CANROs4cuDNBEZGSd-vFk73Qk=pR9pb4f0vLqv1wMtmZPP4r28A@mail.gmail.com>

I wonder if get(data(foo, package="myPackage")) could be rewritten as
myPackage::foo. The latter will be a little more rigorous, because
data(foo) simply returns a character string "foo", so you are
essentially calling get ("foo"), and the default get(, inherits =
FALSE) may cause you trouble sometimes.

Anyway, the value returned by quote() can be represented when calling
dput(), so knitr can support it when generating the R script from the
vignette.

Another way to specify the params defaults could be:

---
params:
  foo: null
---

```{r}
if (is.null(params$foo)) params$foo = myPackage::foo
```

Regards,
Yihui
--
https://yihui.name


On Mon, Jul 9, 2018 at 3:11 PM, Witold E Wolski <wewolski at gmail.com> wrote:
> Dear Duncan,
>
> Was close to giving up to use the parameterized rmarkown as vignettes.
> But your suggestions to use quote and eval, as well as to use the
> package parameter in data
>  made it work, with all devtools::install,check,build and
> build_vignettes as well as with R CMD ... etc.
> But most importantly it also still works with:
> rmarkdown::render("vignettes/tr_srm_summary.Rmd",
> params=list(configuration=skylineconfig, data=sample_analysis    ))
>
> THANK YOU.
>
> This is how my vignette header looks (see below) and it works.
>
> ---
> title: "Titel"
> author: "WEW at FGCZ.ETHZ.CH"
> date: "`r Sys.Date()`"
> output:
>   pdf_document: default
>   html_document: default
> params:
>   configuration:  !r quote(get(data(skylineconfig, package="myPackage")))
>   data: !r quote(get(data(sample_analysis, package="myPackage")))
> vignette: >
>   %\VignetteIndexEntry{Summarize Peptide Level Measurements}
>   %\VignetteEngine{knitr::rmarkdown}
>   %\VignetteEncoding{UTF-8}
> ---
>
>
> ```{r setup, include=FALSE}
> library(tidyverse)
>
> knitr::opts_chunk$set(echo = FALSE, message=FALSE)
> data <- eval(params$data)
> configuration <- eval(params$configuration)
> ```
>
> Have a great evening.
>
> regards
> Witek
>
> On 9 July 2018 at 21:32, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
>> On 09/07/2018 3:24 PM, Witold E Wolski wrote:
>>>
>>> Dear Yihui,
>>>
>>> Thank you for the valuable questions.
>>>
>>> sample_analysis is a "tibble" while
>>> configuration is an "R6" class.
>>> But I also have parametrized reports where I pass R reference classes
>>> as arguments.
>>>
>>> This is the Rmd yaml params part corresponding to the error message.
>>>
>>> params:
>>>    configuration:  !r get(data(skylineconfig))
>>>    data: !r get(data(sample_analysis))
>>>
>>> Might the R6 class which I pass to  configuration the source of the
>>> problem here? I have heard somewhere that R6 uses environments to
>>> implemented some features.
>>>
>>>
>>>
>>> There is also a further problem I am encountering reproducible when
>>> running devtools::install() or R CMD INSTALL
>>>
>>> ** installing vignettes
>>>     'tr_srm_summary.Rmd' using 'UTF-8'
>>> Warning in data(skylineconfig) : data set 'skylineconfig' not found
>>> Error in get(data(skylineconfig)) : object 'skylineconfig' not found
>>
>>
>> You likely need to specify the package name, e.g.
>>
>> data("skylineconfig", package = "yourpackage")
>>
>> Also see my suggestion to use quote() to delay evaluation:
>>
>>
>>> params:
>>>    configuration:  !r quote(get(data(sample_analysis)))
>>>
>>> in the YAML will set configuration to the expression needed to get the
>>> environment;
>>>
>>>      eval(params$configuration)
>>
>>
>> Duncan Murdoch
>
>
>
> --
> Witold Eryk Wolski


From n@k@m@ @ending from ki@rim@or@jp  Tue Jul 10 06:07:02 2018
From: n@k@m@ @ending from ki@rim@or@jp (Ei-ji Nakama)
Date: Tue, 10 Jul 2018 13:07:02 +0900
Subject: [Rd] problem with display of complex number
Message-ID: <CAJqeyYbp9fqJSx6KrgEx9Q_WOSKF5Sr6a2CBYD+Jsf1fm6cVQQ@mail.gmail.com>

Hi,

> 1e10+5i
[1] 1e+10+0e+00i
> Im(1e10+5i)
[1] 5

maybe little better...

--- R-3.5.1.orig/src/main/complex.c    2018-03-26 07:02:25.000000000 +0900
+++ R-3.5.1/src/main/complex.c    2018-07-10 12:50:42.523874767 +0900
@@ -381,6 +381,7 @@
     r->i = fround(pow10 * x->i, digits)/pow10;
     } else {
     digits = (double)(dig);
+    if(digits < 1) digits=1; /* a little better */
     r->r = fround(x->r, digits);
     r->i = fround(x->i, digits);
     }


-- 
Best Regards,
-- 
Eiji NAKAMA <nakama (a) ki.rim.or.jp>
"\u4e2d\u9593\u6804\u6cbb"  <nakama (a) ki.rim.or.jp>


From wewol@ki @ending from gm@il@com  Tue Jul 10 17:44:24 2018
From: wewol@ki @ending from gm@il@com (Witold E Wolski)
Date: Tue, 10 Jul 2018 17:44:24 +0200
Subject: [Rd] RMarkdown Vignettest in R packages with child is failing in
 package build
Message-ID: <CAAjnpdj7FFxJhj0b=AbX6dvXY5ErqDrEtpRfvohPFF40ra0c_Q@mail.gmail.com>

Dear List,

I am working on moving some Rmarkdown reports into the vignettes
folder of a package. While I was able to solve to problem of
parametrized reports in vignettes folder thanks to your invaluable
help (Thank you), I am now struggling with the following problem.


One of the reports which I am moving to vignettes includes the following code :


```{r}
child_docs <- "Grp2Analysis_MissingInOneCondtion.Rmd_t"
if(TRUE){
  child_docs <- "Grp2Analysis_Empty.Rmd_t"
}

```

```{r includeMissingInOne, child = child_docs}
```
   # this is line 351 from the error message

which depending on a test outcome includes one or the other Rmarkdown
document into the main document.


While this report renders executing rmarkdown::render or
devtools::build_vignettes, it fails when building the package with
devtools::build or R CMD build
given the following error:


Error in eval(x, envir = envir) : object 'child_docs' not found
Warning in readLines(if (is.character(input2)) { :
  cannot open file './child_docs': No such file or directory
Quitting from lines 351-351 (./child_docs)
Error in readLines(if (is.character(input2)) { :
  cannot open the connection
ERROR: installing vignettes failed
* removing 'C:/Users/wolski/AppData/Local/Temp/RtmpIti891/Rinst2cec49ca2170/SRMService'
In R CMD INSTALL


Have a great evening,
Best regards
Witek



-- 
Witold Eryk Wolski


From murdoch@dunc@n @ending from gm@il@com  Tue Jul 10 19:52:38 2018
From: murdoch@dunc@n @ending from gm@il@com (Duncan Murdoch)
Date: Tue, 10 Jul 2018 13:52:38 -0400
Subject: [Rd] 
 RMarkdown Vignettest in R packages with child is failing in
 package build
In-Reply-To: <CAAjnpdj7FFxJhj0b=AbX6dvXY5ErqDrEtpRfvohPFF40ra0c_Q@mail.gmail.com>
References: <CAAjnpdj7FFxJhj0b=AbX6dvXY5ErqDrEtpRfvohPFF40ra0c_Q@mail.gmail.com>
Message-ID: <b3c7e9b2-f9a6-855c-9029-e6af1dc0ca60@gmail.com>

On 10/07/2018 11:44 AM, Witold E Wolski wrote:
> Dear List,
> 
> I am working on moving some Rmarkdown reports into the vignettes
> folder of a package. While I was able to solve to problem of
> parametrized reports in vignettes folder thanks to your invaluable
> help (Thank you), I am now struggling with the following problem.
> 
> 
> One of the reports which I am moving to vignettes includes the following code :
> 
> 
> ```{r}
> child_docs <- "Grp2Analysis_MissingInOneCondtion.Rmd_t"
> if(TRUE){
>    child_docs <- "Grp2Analysis_Empty.Rmd_t"
> }
> 
> ```
> 
> ```{r includeMissingInOne, child = child_docs}
> ```
>     # this is line 351 from the error message
> 
> which depending on a test outcome includes one or the other Rmarkdown
> document into the main document.
> 
> 
> While this report renders executing rmarkdown::render or
> devtools::build_vignettes, it fails when building the package with
> devtools::build or R CMD build
> given the following error:
> 
> 
> Error in eval(x, envir = envir) : object 'child_docs' not found
> Warning in readLines(if (is.character(input2)) { :
>    cannot open file './child_docs': No such file or directory
> Quitting from lines 351-351 (./child_docs)
> Error in readLines(if (is.character(input2)) { :
>    cannot open the connection
> ERROR: installing vignettes failed
> * removing 'C:/Users/wolski/AppData/Local/Temp/RtmpIti891/Rinst2cec49ca2170/SRMService'
> In R CMD INSTALL
> 


Since you didn't give a path to that file, it will use the current 
working directory, which might be a temporary directory used during the 
package installation.  Since you want this to work as a vignette, you 
need to include the child docs in your package.  One way to do that is 
to put them in a new directory called "inst/children", which will be 
installed to "children" when your package is installed.  Then the 
vignette can find the file as

     system.file(file.path("children", child_docs), package = "yourpackage")

You could also put them in the "vignettes" directory, but there are 
special rules for how files there are installed or not, so I'd recommend 
against it.

Duncan Murdoch


From c@@rdi@g@bor @ending from gm@il@com  Thu Jul 12 12:33:02 2018
From: c@@rdi@g@bor @ending from gm@il@com (=?UTF-8?B?R8OhYm9yIENzw6FyZGk=?=)
Date: Thu, 12 Jul 2018 11:33:02 +0100
Subject: [Rd] Top level \Sexpr and R CMD check
Message-ID: <CABtg=KkE7gNvho-PLvsS-48yOR5nVTTSsekf35uLS4JJiZmjjg@mail.gmail.com>

I would like to create \examples{} in the manual dynamically, and
while it is possible to do this with a \Sexpr at the top level, R CMD
check issues a warning for it. (See below.)

Is it intentional that \Sexpr is not allowed at the top level?  The Rd
grammar allows this, but R CMD check does not.

Is there any other way to generate/modify the \examples{} section dynamically?

Thanks, Gabor

In the Rd  file:

\Sexpr[stage=install,strip.white=FALSE,results=rd]{pkg:::decorate_examples('
CODE
')}

and pkg::decorate_examples outputs

\examples{
MODIFIED CODE
}

But then:

* checking Rd files ... WARNING
prepare_Rd: ps_cmdline.Rd:36-42: Section \Sexpr is unrecognized and
will be dropped


From murdoch@dunc@n @ending from gm@il@com  Thu Jul 12 13:23:34 2018
From: murdoch@dunc@n @ending from gm@il@com (Duncan Murdoch)
Date: Thu, 12 Jul 2018 07:23:34 -0400
Subject: [Rd] Top level \Sexpr and R CMD check
In-Reply-To: <CABtg=KkE7gNvho-PLvsS-48yOR5nVTTSsekf35uLS4JJiZmjjg@mail.gmail.com>
References: <CABtg=KkE7gNvho-PLvsS-48yOR5nVTTSsekf35uLS4JJiZmjjg@mail.gmail.com>
Message-ID: <eaf1c672-fb4c-5327-9b5a-4349ef75eec7@gmail.com>

On 12/07/2018 6:33 AM, G?bor Cs?rdi wrote:
> I would like to create \examples{} in the manual dynamically, and
> while it is possible to do this with a \Sexpr at the top level, R CMD
> check issues a warning for it. (See below.)
> 
> Is it intentional that \Sexpr is not allowed at the top level?  The Rd
> grammar allows this, but R CMD check does not.
> 
> Is there any other way to generate/modify the \examples{} section dynamically?

That looks like a bug in the check code, but wouldn't it be possible to 
work around it with something like this?

\examples{
\Sexpr[stage=install,strip.white=FALSE,results=rd]{pkg:::decorate_code('
   CODE
  ')}
}

Duncan Murdoch

> 
> Thanks, Gabor
> 
> In the Rd  file:
> 
> \Sexpr[stage=install,strip.white=FALSE,results=rd]{pkg:::decorate_examples('
> CODE
> ')}
> 
> and pkg::decorate_examples outputs
> 
> \examples{
> MODIFIED CODE
> }
> 
> But then:
> 
> * checking Rd files ... WARNING
> prepare_Rd: ps_cmdline.Rd:36-42: Section \Sexpr is unrecognized and
> will be dropped
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From c@@rdi@g@bor @ending from gm@il@com  Thu Jul 12 13:30:02 2018
From: c@@rdi@g@bor @ending from gm@il@com (=?UTF-8?B?R8OhYm9yIENzw6FyZGk=?=)
Date: Thu, 12 Jul 2018 12:30:02 +0100
Subject: [Rd] Top level \Sexpr and R CMD check
In-Reply-To: <eaf1c672-fb4c-5327-9b5a-4349ef75eec7@gmail.com>
References: <CABtg=KkE7gNvho-PLvsS-48yOR5nVTTSsekf35uLS4JJiZmjjg@mail.gmail.com>
 <eaf1c672-fb4c-5327-9b5a-4349ef75eec7@gmail.com>
Message-ID: <CABtg=KkNXXPBg+6yzQZ2FOdWsUqZj0xnbUAaOu=-ZG7pGUOvHQ@mail.gmail.com>

On Thu, Jul 12, 2018 at 12:23 PM Duncan Murdoch
<murdoch.duncan at gmail.com> wrote:
>
> On 12/07/2018 6:33 AM, G?bor Cs?rdi wrote:
> > I would like to create \examples{} in the manual dynamically, and
> > while it is possible to do this with a \Sexpr at the top level, R CMD
> > check issues a warning for it. (See below.)
> >
> > Is it intentional that \Sexpr is not allowed at the top level?  The Rd
> > grammar allows this, but R CMD check does not.
> >
> > Is there any other way to generate/modify the \examples{} section dynamically?
>
> That looks like a bug in the check code, but wouldn't it be possible to
> work around it with something like this?
>
> \examples{
> \Sexpr[stage=install,strip.white=FALSE,results=rd]{pkg:::decorate_code('
>    CODE
>   ')}
> }

Thanks for the reply! Unfortunately it seems that \Sexpr is not allowed inside
\examples, either:

checkRd: (7) ps_handle.Rd:46-47: Tag \Sexpr is invalid in a \examples block

G.

[...]


From murdoch@dunc@n @ending from gm@il@com  Thu Jul 12 15:21:51 2018
From: murdoch@dunc@n @ending from gm@il@com (Duncan Murdoch)
Date: Thu, 12 Jul 2018 09:21:51 -0400
Subject: [Rd] Top level \Sexpr and R CMD check
In-Reply-To: <CABtg=KkNXXPBg+6yzQZ2FOdWsUqZj0xnbUAaOu=-ZG7pGUOvHQ@mail.gmail.com>
References: <CABtg=KkE7gNvho-PLvsS-48yOR5nVTTSsekf35uLS4JJiZmjjg@mail.gmail.com>
 <eaf1c672-fb4c-5327-9b5a-4349ef75eec7@gmail.com>
 <CABtg=KkNXXPBg+6yzQZ2FOdWsUqZj0xnbUAaOu=-ZG7pGUOvHQ@mail.gmail.com>
Message-ID: <b03ecf4b-f59b-eed6-ddb2-4788a4cd98ef@gmail.com>

On 12/07/2018 7:30 AM, G?bor Cs?rdi wrote:
> On Thu, Jul 12, 2018 at 12:23 PM Duncan Murdoch
> <murdoch.duncan at gmail.com> wrote:
>>
>> On 12/07/2018 6:33 AM, G?bor Cs?rdi wrote:
>>> I would like to create \examples{} in the manual dynamically, and
>>> while it is possible to do this with a \Sexpr at the top level, R CMD
>>> check issues a warning for it. (See below.)
>>>
>>> Is it intentional that \Sexpr is not allowed at the top level?  The Rd
>>> grammar allows this, but R CMD check does not.
>>>
>>> Is there any other way to generate/modify the \examples{} section dynamically?
>>
>> That looks like a bug in the check code, but wouldn't it be possible to
>> work around it with something like this?
>>
>> \examples{
>> \Sexpr[stage=install,strip.white=FALSE,results=rd]{pkg:::decorate_code('
>>     CODE
>>    ')}
>> }
> 
> Thanks for the reply! Unfortunately it seems that \Sexpr is not allowed inside
> \examples, either:
> 
> checkRd: (7) ps_handle.Rd:46-47: Tag \Sexpr is invalid in a \examples block
> 
> G.

I think I found the bug.  The tools::checkRd function only processes 
\Sexpr's with "stage=render".  I think the author (who might have been 
me, I forget) assumed that would imply all the earlier stages as well, 
but apparently it doesn't.

So you could use that as a workaround.

I'll do some more checking, then submit a bug report and patch to Bugzilla.

Duncan Murdoch


From c@@rdi@g@bor @ending from gm@il@com  Thu Jul 12 15:30:42 2018
From: c@@rdi@g@bor @ending from gm@il@com (=?UTF-8?B?R8OhYm9yIENzw6FyZGk=?=)
Date: Thu, 12 Jul 2018 14:30:42 +0100
Subject: [Rd] Top level \Sexpr and R CMD check
In-Reply-To: <b03ecf4b-f59b-eed6-ddb2-4788a4cd98ef@gmail.com>
References: <CABtg=KkE7gNvho-PLvsS-48yOR5nVTTSsekf35uLS4JJiZmjjg@mail.gmail.com>
 <eaf1c672-fb4c-5327-9b5a-4349ef75eec7@gmail.com>
 <CABtg=KkNXXPBg+6yzQZ2FOdWsUqZj0xnbUAaOu=-ZG7pGUOvHQ@mail.gmail.com>
 <b03ecf4b-f59b-eed6-ddb2-4788a4cd98ef@gmail.com>
Message-ID: <CABtg=KkH8UO93RggxZwtKgJxcN+5JS-HQ0NBQX0yYrLNi5PEXw@mail.gmail.com>

On Thu, Jul 12, 2018 at 2:21 PM Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
> I think I found the bug.  The tools::checkRd function only processes
> \Sexpr's with "stage=render".  I think the author (who might have been
> me, I forget) assumed that would imply all the earlier stages as well,
> but apparently it doesn't.
>
> So you could use that as a workaround.
>
> I'll do some more checking, then submit a bug report and patch to Bugzilla.
>
> Duncan Murdoch

Thanks much! I tried using stage=render, but then I get an error at
install time:

Warning: /private/var/folders/59/0gkmw1yj2w7bf2dfc3jznv5w0000gn/T/RtmpCG4Qz9/R.INSTALLec4743ba8cf4/ps/man/ps_handle.Rd:45-48:
Section \Sexpr is unrecognized and will be dropped

And indeed the whole section is dropped.

Seems like there is no clean workaround here.

Thanks again,
G.


From c@@rdi@g@bor @ending from gm@il@com  Thu Jul 12 15:46:53 2018
From: c@@rdi@g@bor @ending from gm@il@com (=?UTF-8?B?R8OhYm9yIENzw6FyZGk=?=)
Date: Thu, 12 Jul 2018 14:46:53 +0100
Subject: [Rd] Top level \Sexpr and R CMD check
In-Reply-To: <CABtg=KkH8UO93RggxZwtKgJxcN+5JS-HQ0NBQX0yYrLNi5PEXw@mail.gmail.com>
References: <CABtg=KkE7gNvho-PLvsS-48yOR5nVTTSsekf35uLS4JJiZmjjg@mail.gmail.com>
 <eaf1c672-fb4c-5327-9b5a-4349ef75eec7@gmail.com>
 <CABtg=KkNXXPBg+6yzQZ2FOdWsUqZj0xnbUAaOu=-ZG7pGUOvHQ@mail.gmail.com>
 <b03ecf4b-f59b-eed6-ddb2-4788a4cd98ef@gmail.com>
 <CABtg=KkH8UO93RggxZwtKgJxcN+5JS-HQ0NBQX0yYrLNi5PEXw@mail.gmail.com>
Message-ID: <CABtg=K=Rvt98Z9XdLLEd7FogzSiXGZRzGOofxP12pzyn5rfr7A@mail.gmail.com>

On Thu, Jul 12, 2018 at 2:30 PM G?bor Cs?rdi <csardi.gabor at gmail.com> wrote:
>
> On Thu, Jul 12, 2018 at 2:21 PM Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
> > I think I found the bug.  The tools::checkRd function only processes
> > \Sexpr's with "stage=render".  I think the author (who might have been
> > me, I forget) assumed that would imply all the earlier stages as well,
> > but apparently it doesn't.
> >
> > So you could use that as a workaround.
> >
> > I'll do some more checking, then submit a bug report and patch to Bugzilla.
> >
> > Duncan Murdoch
>
> Thanks much! I tried using stage=render, but then I get an error at
> install time:
>
> Warning: /private/var/folders/59/0gkmw1yj2w7bf2dfc3jznv5w0000gn/T/RtmpCG4Qz9/R.INSTALLec4743ba8cf4/ps/man/ps_handle.Rd:45-48:
> Section \Sexpr is unrecognized and will be dropped
>
> And indeed the whole section is dropped.
>
> Seems like there is no clean workaround here.
>
> Thanks again,
> G.

Btw. would it make sense to just allow \Sexpr as a top level section?
Maybe here:
https://github.com/wch/r-source/blob/98e9999eb0e8616550632a1675e4d2dbe630d5e4/src/library/tools/R/RdConv2.R#L500-L503

At least if stage=render, there is no way to check if the returned
value is always a valid top level section, anyway.
If it is not a valid section (or \Sexpr returns some bad markup in
general), then the user gets a render-time error,
but with stage=render I guess one cannot do better.

G.


From murdoch@dunc@n @ending from gm@il@com  Thu Jul 12 16:35:40 2018
From: murdoch@dunc@n @ending from gm@il@com (Duncan Murdoch)
Date: Thu, 12 Jul 2018 10:35:40 -0400
Subject: [Rd] Top level \Sexpr and R CMD check
In-Reply-To: <CABtg=K=Rvt98Z9XdLLEd7FogzSiXGZRzGOofxP12pzyn5rfr7A@mail.gmail.com>
References: <CABtg=KkE7gNvho-PLvsS-48yOR5nVTTSsekf35uLS4JJiZmjjg@mail.gmail.com>
 <eaf1c672-fb4c-5327-9b5a-4349ef75eec7@gmail.com>
 <CABtg=KkNXXPBg+6yzQZ2FOdWsUqZj0xnbUAaOu=-ZG7pGUOvHQ@mail.gmail.com>
 <b03ecf4b-f59b-eed6-ddb2-4788a4cd98ef@gmail.com>
 <CABtg=KkH8UO93RggxZwtKgJxcN+5JS-HQ0NBQX0yYrLNi5PEXw@mail.gmail.com>
 <CABtg=K=Rvt98Z9XdLLEd7FogzSiXGZRzGOofxP12pzyn5rfr7A@mail.gmail.com>
Message-ID: <d84e24ef-0443-cbf9-cfb8-75d925f1f180@gmail.com>

On 12/07/2018 9:46 AM, G?bor Cs?rdi wrote:
> On Thu, Jul 12, 2018 at 2:30 PM G?bor Cs?rdi <csardi.gabor at gmail.com> wrote:
>>
>> On Thu, Jul 12, 2018 at 2:21 PM Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
>>> I think I found the bug.  The tools::checkRd function only processes
>>> \Sexpr's with "stage=render".  I think the author (who might have been
>>> me, I forget) assumed that would imply all the earlier stages as well,
>>> but apparently it doesn't.
>>>
>>> So you could use that as a workaround.
>>>
>>> I'll do some more checking, then submit a bug report and patch to Bugzilla.
>>>
>>> Duncan Murdoch
>>
>> Thanks much! I tried using stage=render, but then I get an error at
>> install time:
>>
>> Warning: /private/var/folders/59/0gkmw1yj2w7bf2dfc3jznv5w0000gn/T/RtmpCG4Qz9/R.INSTALLec4743ba8cf4/ps/man/ps_handle.Rd:45-48:
>> Section \Sexpr is unrecognized and will be dropped
>>
>> And indeed the whole section is dropped.
>>
>> Seems like there is no clean workaround here.
>>
>> Thanks again,
>> G.
> 
> Btw. would it make sense to just allow \Sexpr as a top level section?
> Maybe here:
> https://github.com/wch/r-source/blob/98e9999eb0e8616550632a1675e4d2dbe630d5e4/src/library/tools/R/RdConv2.R#L500-L503

I think the mental model is that \Sexpr is essentially a preprocessor 
directive, and should disappear before rendering.  It's the final result 
that needs to be checked.  So \Sexpr should be able to produce top level 
sections, but it shouldn't be considered to be one.

The reason checkRd has a stages argument is because it might be working 
on partially processed Rd objects, rather than the original .Rd file. 
Each of the stages should be processed exactly once, in order.

> 
> At least if stage=render, there is no way to check if the returned
> value is always a valid top level section, anyway.

But you can check if it is sometimes, which is better than nothing. 
Most \Sexpr content is really simple, so this is probably good enough.

Duncan

> If it is not a valid section (or \Sexpr returns some bad markup in
> general), then the user gets a render-time error,
> but with stage=render I guess one cannot do better.
> 
> G.
>


From @ndeol@ev@in @ending from gm@il@com  Thu Jul 12 17:15:49 2018
From: @ndeol@ev@in @ending from gm@il@com (=?UTF-8?Q?And=C3=A9ol_Evain?=)
Date: Thu, 12 Jul 2018 16:15:49 +0100
Subject: [Rd] R API for C/C++ initialisation issue appears with update to
 R.3.5
Message-ID: <CAGOu7fVQXLnbsCJ9GLkTghkWtLxhXY7MAD0ha+RDV+XrEHAq9g@mail.gmail.com>

Hello everyone,

I have a C++ program that calls R using R_tryEval, very similarly to what
package RInside does.
It used to work with R.3.4.3 and R.3.4.4. However, since I updated it to
R.3.5.1, R sends an error message: "*Error in < My command > : the base
graphics system is not registered*"  for any command related to the
graphics package.

I made a ticket on stackoverflow about it: https://stackoverflow.com/
questions/51242993/difference-between-r-3-4-4-and-r-3-5-1-in-r-api-for-c

But nobody could explain why so far. And after reducing my code further, I
am now enclined to think this is actually a bug.

The code provided in stackOverflow is already reduced, but not minimal yet.
Since then, I reduced it further to really ensure that it was not an
interference from anything around it. So I removed the GUI and the
callbacks.
Here is a really minimal example attached.

In its current form, the program just sends the command :   par("mar") to
R, and then the command  dev.off()   .
With R.3.4.4, this program print as output what is expected. No error
occured during evaluation of the command :









*No error occured during eval of "par(\"mar\")"EXAMPLE #1 Output: EXAMPLE
#1 Output: Result is:  "5.1"Result is:  "5.1"Result is:  "5.1"Result is:
"5.1"No error occured during eval of "dev.off()"Result is:  "1"*

But the exact same program with R.3.5.1 gives:





*An error occured during eval of "par(\"mar\")"No error occured during eval
of "dev.off()"Result is:  "1"*

The error that occured is not displayed here, since I removed the callbacks
to fetch it, but it was:
*Error in par("mar") : the base graphics system is not registered*


I compiled Microsoft Visual C++ Compiler 15.0 (amd64), and uses 64bits
version of R. But previously I also observed the same behovior with 32bits.
I also tried re-installing R from scratch, without effect.

I am using Windows 10, 64bits
Registry variables PATH and R_HOME are correctly set and points to the
appropriate version of R, installed in the default directory.

I'd be glad to hear any ideas about potential fixes or workaround.

Cheers,

And?ol Evain

-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: main.cpp
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20180712/decb3068/attachment.ksh>

-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: rmanager.h
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20180712/decb3068/attachment.h>

-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: rmanager.cpp
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20180712/decb3068/attachment-0001.ksh>

From murdoch@dunc@n @ending from gm@il@com  Thu Jul 12 18:29:19 2018
From: murdoch@dunc@n @ending from gm@il@com (Duncan Murdoch)
Date: Thu, 12 Jul 2018 12:29:19 -0400
Subject: [Rd] Top level \Sexpr and R CMD check
In-Reply-To: <CABtg=K=Rvt98Z9XdLLEd7FogzSiXGZRzGOofxP12pzyn5rfr7A@mail.gmail.com>
References: <CABtg=KkE7gNvho-PLvsS-48yOR5nVTTSsekf35uLS4JJiZmjjg@mail.gmail.com>
 <eaf1c672-fb4c-5327-9b5a-4349ef75eec7@gmail.com>
 <CABtg=KkNXXPBg+6yzQZ2FOdWsUqZj0xnbUAaOu=-ZG7pGUOvHQ@mail.gmail.com>
 <b03ecf4b-f59b-eed6-ddb2-4788a4cd98ef@gmail.com>
 <CABtg=KkH8UO93RggxZwtKgJxcN+5JS-HQ0NBQX0yYrLNi5PEXw@mail.gmail.com>
 <CABtg=K=Rvt98Z9XdLLEd7FogzSiXGZRzGOofxP12pzyn5rfr7A@mail.gmail.com>
Message-ID: <f5f9aff9-cca1-9da6-8155-ac4571bc90da@gmail.com>

On 12/07/2018 9:46 AM, G?bor Cs?rdi wrote:
> On Thu, Jul 12, 2018 at 2:30 PM G?bor Cs?rdi <csardi.gabor at gmail.com> wrote:
>>
>> On Thu, Jul 12, 2018 at 2:21 PM Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
>>> I think I found the bug.  The tools::checkRd function only processes
>>> \Sexpr's with "stage=render".  I think the author (who might have been
>>> me, I forget) assumed that would imply all the earlier stages as well,
>>> but apparently it doesn't.
>>>
>>> So you could use that as a workaround.
>>>
>>> I'll do some more checking, then submit a bug report and patch to Bugzilla.
>>>
>>> Duncan Murdoch
>>
>> Thanks much! I tried using stage=render, but then I get an error at
>> install time:
>>
>> Warning: /private/var/folders/59/0gkmw1yj2w7bf2dfc3jznv5w0000gn/T/RtmpCG4Qz9/R.INSTALLec4743ba8cf4/ps/man/ps_handle.Rd:45-48:
>> Section \Sexpr is unrecognized and will be dropped
>>
>> And indeed the whole section is dropped.
>>
>> Seems like there is no clean workaround here.
>>
>> Thanks again,
>> G.
> 
> Btw. would it make sense to just allow \Sexpr as a top level section?
> Maybe here:
> https://github.com/wch/r-source/blob/98e9999eb0e8616550632a1675e4d2dbe630d5e4/src/library/tools/R/RdConv2.R#L500-L503
> 
> At least if stage=render, there is no way to check if the returned
> value is always a valid top level section, anyway.
> If it is not a valid section (or \Sexpr returns some bad markup in
> general), then the user gets a render-time error,
> but with stage=render I guess one cannot do better.
> 

I believe the problem is in the tools:::.check_package_parseRd function. 
  It checks the .Rd files rather than parsed Rd objects, so it needs to 
be told to expand all \Sexpr's, not just render-time ones.  I think it 
is fixed by the below patch to R-devel.  Can you give it a try before I 
submit the bug report?

Duncan Murdoch

Index: src/library/tools/R/QC.R
===================================================================
--- src/library/tools/R/QC.R	(revision 74954)
+++ src/library/tools/R/QC.R	(working copy)
@@ -6430,7 +6430,8 @@
          if(basename(f) %in% c("iconv.Rd", "showNonASCII.Rd")) def_enc 
<- TRUE
  	tmp <- tryCatch(suppressMessages(checkRd(f, encoding = enc,
  						 def_enc = def_enc,
-                                                 macros = macros)),
+                                                 macros = macros,
+                                                 stages = c("build", 
"install", "render"))),
  			error = identity)
  	if(inherits(tmp, "error")) {
  	    bad <- c(bad, f)


From luke-tier@ey m@ili@g off uiow@@edu  Fri Jul 13 00:50:28 2018
From: luke-tier@ey m@ili@g off uiow@@edu (luke-tier@ey m@ili@g off uiow@@edu)
Date: Thu, 12 Jul 2018 17:50:28 -0500 (CDT)
Subject: [Rd] 
 R API for C/C++ initialisation issue appears with update to R.3.5
In-Reply-To: <CAGOu7fVQXLnbsCJ9GLkTghkWtLxhXY7MAD0ha+RDV+XrEHAq9g@mail.gmail.com>
References: <CAGOu7fVQXLnbsCJ9GLkTghkWtLxhXY7MAD0ha+RDV+XrEHAq9g@mail.gmail.com>
Message-ID: <alpine.OSX.2.21.1807121746080.632@lukes-macbook-air.local>

You might have more luck getting help with a completely self-contained
example (no QT in particular) and a complete description of how you
built and ran your example.

That said, the placement of the call to Rf_endEmbedded looks a little
odd.

Best,

luke

On Thu, 12 Jul 2018, And?ol Evain wrote:

> Hello everyone,
>
> I have a C++ program that calls R using R_tryEval, very similarly to what
> package RInside does.
> It used to work with R.3.4.3 and R.3.4.4. However, since I updated it to
> R.3.5.1, R sends an error message: "*Error in < My command > : the base
> graphics system is not registered*"  for any command related to the
> graphics package.
>
> I made a ticket on stackoverflow about it: https://stackoverflow.com/
> questions/51242993/difference-between-r-3-4-4-and-r-3-5-1-in-r-api-for-c
>
> But nobody could explain why so far. And after reducing my code further, I
> am now enclined to think this is actually a bug.
>
> The code provided in stackOverflow is already reduced, but not minimal yet.
> Since then, I reduced it further to really ensure that it was not an
> interference from anything around it. So I removed the GUI and the
> callbacks.
> Here is a really minimal example attached.
>
> In its current form, the program just sends the command :   par("mar") to
> R, and then the command  dev.off()   .
> With R.3.4.4, this program print as output what is expected. No error
> occured during evaluation of the command :
>
>
>
>
>
>
>
>
>
> *No error occured during eval of "par(\"mar\")"EXAMPLE #1 Output: EXAMPLE
> #1 Output: Result is:  "5.1"Result is:  "5.1"Result is:  "5.1"Result is:
> "5.1"No error occured during eval of "dev.off()"Result is:  "1"*
>
> But the exact same program with R.3.5.1 gives:
>
>
>
>
>
> *An error occured during eval of "par(\"mar\")"No error occured during eval
> of "dev.off()"Result is:  "1"*
>
> The error that occured is not displayed here, since I removed the callbacks
> to fetch it, but it was:
> *Error in par("mar") : the base graphics system is not registered*
>
>
> I compiled Microsoft Visual C++ Compiler 15.0 (amd64), and uses 64bits
> version of R. But previously I also observed the same behovior with 32bits.
> I also tried re-installing R from scratch, without effect.
>
> I am using Windows 10, 64bits
> Registry variables PATH and R_HOME are correctly set and points to the
> appropriate version of R, installed in the default directory.
>
> I'd be glad to hear any ideas about potential fixes or workaround.
>
> Cheers,
>
> And?ol Evain
>

-- 
Luke Tierney
Ralph E. Wareham Professor of Mathematical Sciences
University of Iowa                  Phone:             319-335-3386
Department of Statistics and        Fax:               319-335-3017
    Actuarial Science
241 Schaeffer Hall                  email:   luke-tierney at uiowa.edu
Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu

From wewol@ki @ending from gm@il@com  Fri Jul 13 08:32:01 2018
From: wewol@ki @ending from gm@il@com (Witold E Wolski)
Date: Fri, 13 Jul 2018 08:32:01 +0200
Subject: [Rd] 
 RMarkdown Vignettest in R packages with child is failing in
 package build
In-Reply-To: <b3c7e9b2-f9a6-855c-9029-e6af1dc0ca60@gmail.com>
References: <CAAjnpdj7FFxJhj0b=AbX6dvXY5ErqDrEtpRfvohPFF40ra0c_Q@mail.gmail.com>
 <b3c7e9b2-f9a6-855c-9029-e6af1dc0ca60@gmail.com>
Message-ID: <CAAjnpdiZN9QFnAgrko_x-MqNXRMh9DPJTEnm813u7-eQ7g=eUQ@mail.gmail.com>

Dear Duncan,

Thank you, got it working with your advice.

I did placed the child markdown documents into inst/ParametrizedReportsChild

And this is the code in the main vignette by which I include them:

child_docs <- "Grp2Analysis_MissingInOneCondtion.Rmd_t"

if(!sum(NAinfo$nrProteins > 0) > 0){
  child_docs <- "Grp2Analysis_Empty.Rmd_t"
}

child_docs <- system.file(file.path("ParametrizedReportsChild",child_docs),package
= "SRMService")


However, according to writing package vignettes
[https://cran.r-project.org/doc/manuals/R-exts.html#Writing-package-vignettes]
:
"All other files needed to re-make the vignettes (such as LaTeX style
files, BibTeX input files and files for any figures not created by
running the code in the vignette) _must_ be in the vignette source
directory."

So why placing those files i.e.
Grp2Analysis_MissingInOneCondtion.Rmd_t and Grp2Analysis_Empty.Rmd_t
in the vignettes folder and including them by:

child_docs <- "Grp2Analysis_MissingInOneCondtion.Rmd_t"

if(!sum(NAinfo$nrProteins > 0) > 0){
  child_docs <- "Grp2Analysis_Empty.Rmd_t"
}

, did not work?

Have a great day,
best regards
Witek


On 10 July 2018 at 19:52, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
> On 10/07/2018 11:44 AM, Witold E Wolski wrote:
>>
>> Dear List,
>>
>> I am working on moving some Rmarkdown reports into the vignettes
>> folder of a package. While I was able to solve to problem of
>> parametrized reports in vignettes folder thanks to your invaluable
>> help (Thank you), I am now struggling with the following problem.
>>
>>
>> One of the reports which I am moving to vignettes includes the following
>> code :
>>
>>
>> ```{r}
>> child_docs <- "Grp2Analysis_MissingInOneCondtion.Rmd_t"
>> if(TRUE){
>>    child_docs <- "Grp2Analysis_Empty.Rmd_t"
>> }
>>
>> ```
>>
>> ```{r includeMissingInOne, child = child_docs}
>> ```
>>     # this is line 351 from the error message
>>
>> which depending on a test outcome includes one or the other Rmarkdown
>> document into the main document.
>>
>>
>> While this report renders executing rmarkdown::render or
>> devtools::build_vignettes, it fails when building the package with
>> devtools::build or R CMD build
>> given the following error:
>>
>>
>> Error in eval(x, envir = envir) : object 'child_docs' not found
>> Warning in readLines(if (is.character(input2)) { :
>>    cannot open file './child_docs': No such file or directory
>> Quitting from lines 351-351 (./child_docs)
>> Error in readLines(if (is.character(input2)) { :
>>    cannot open the connection
>> ERROR: installing vignettes failed
>> * removing
>> 'C:/Users/wolski/AppData/Local/Temp/RtmpIti891/Rinst2cec49ca2170/SRMService'
>> In R CMD INSTALL
>>
>
>
> Since you didn't give a path to that file, it will use the current working
> directory, which might be a temporary directory used during the package
> installation.  Since you want this to work as a vignette, you need to
> include the child docs in your package.  One way to do that is to put them
> in a new directory called "inst/children", which will be installed to
> "children" when your package is installed.  Then the vignette can find the
> file as
>
>     system.file(file.path("children", child_docs), package = "yourpackage")
>
> You could also put them in the "vignettes" directory, but there are special
> rules for how files there are installed or not, so I'd recommend against it.
>
> Duncan Murdoch



-- 
Witold Eryk Wolski


From murdoch@dunc@n @ending from gm@il@com  Fri Jul 13 12:32:09 2018
From: murdoch@dunc@n @ending from gm@il@com (Duncan Murdoch)
Date: Fri, 13 Jul 2018 06:32:09 -0400
Subject: [Rd] 
 RMarkdown Vignettest in R packages with child is failing in
 package build
In-Reply-To: <CAAjnpdiZN9QFnAgrko_x-MqNXRMh9DPJTEnm813u7-eQ7g=eUQ@mail.gmail.com>
References: <CAAjnpdj7FFxJhj0b=AbX6dvXY5ErqDrEtpRfvohPFF40ra0c_Q@mail.gmail.com>
 <b3c7e9b2-f9a6-855c-9029-e6af1dc0ca60@gmail.com>
 <CAAjnpdiZN9QFnAgrko_x-MqNXRMh9DPJTEnm813u7-eQ7g=eUQ@mail.gmail.com>
Message-ID: <33d643bf-dcec-263e-6ed2-8125e400efbb@gmail.com>

On 13/07/2018 2:32 AM, Witold E Wolski wrote:
> Dear Duncan,
> 
> Thank you, got it working with your advice.
> 
> I did placed the child markdown documents into inst/ParametrizedReportsChild
> 
> And this is the code in the main vignette by which I include them:
> 
> child_docs <- "Grp2Analysis_MissingInOneCondtion.Rmd_t"
> 
> if(!sum(NAinfo$nrProteins > 0) > 0){
>    child_docs <- "Grp2Analysis_Empty.Rmd_t"
> }
> 
> child_docs <- system.file(file.path("ParametrizedReportsChild",child_docs),package
> = "SRMService")
> 
> 
> However, according to writing package vignettes
> [https://cran.r-project.org/doc/manuals/R-exts.html#Writing-package-vignettes]
> :
> "All other files needed to re-make the vignettes (such as LaTeX style
> files, BibTeX input files and files for any figures not created by
> running the code in the vignette) _must_ be in the vignette source
> directory."
> 
> So why placing those files i.e.
> Grp2Analysis_MissingInOneCondtion.Rmd_t and Grp2Analysis_Empty.Rmd_t
> in the vignettes folder and including them by:
> 
> child_docs <- "Grp2Analysis_MissingInOneCondtion.Rmd_t"
> 
> if(!sum(NAinfo$nrProteins > 0) > 0){
>    child_docs <- "Grp2Analysis_Empty.Rmd_t"
> }
> 
> , did not work?

In that paragraph, "must" is ambiguous:  it could signify a necessary 
condition, or it could signify a directive.  Perhaps in this case it is 
a directive:  even though things work, maybe the author of that 
paragraph wants you to do it in some other way.

Or perhaps necessity was intended, and it is just incorrect.

Duncan Murdoch

> 
> Have a great day,
> best regards
> Witek
> 
> 
> On 10 July 2018 at 19:52, Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
>> On 10/07/2018 11:44 AM, Witold E Wolski wrote:
>>>
>>> Dear List,
>>>
>>> I am working on moving some Rmarkdown reports into the vignettes
>>> folder of a package. While I was able to solve to problem of
>>> parametrized reports in vignettes folder thanks to your invaluable
>>> help (Thank you), I am now struggling with the following problem.
>>>
>>>
>>> One of the reports which I am moving to vignettes includes the following
>>> code :
>>>
>>>
>>> ```{r}
>>> child_docs <- "Grp2Analysis_MissingInOneCondtion.Rmd_t"
>>> if(TRUE){
>>>     child_docs <- "Grp2Analysis_Empty.Rmd_t"
>>> }
>>>
>>> ```
>>>
>>> ```{r includeMissingInOne, child = child_docs}
>>> ```
>>>      # this is line 351 from the error message
>>>
>>> which depending on a test outcome includes one or the other Rmarkdown
>>> document into the main document.
>>>
>>>
>>> While this report renders executing rmarkdown::render or
>>> devtools::build_vignettes, it fails when building the package with
>>> devtools::build or R CMD build
>>> given the following error:
>>>
>>>
>>> Error in eval(x, envir = envir) : object 'child_docs' not found
>>> Warning in readLines(if (is.character(input2)) { :
>>>     cannot open file './child_docs': No such file or directory
>>> Quitting from lines 351-351 (./child_docs)
>>> Error in readLines(if (is.character(input2)) { :
>>>     cannot open the connection
>>> ERROR: installing vignettes failed
>>> * removing
>>> 'C:/Users/wolski/AppData/Local/Temp/RtmpIti891/Rinst2cec49ca2170/SRMService'
>>> In R CMD INSTALL
>>>
>>
>>
>> Since you didn't give a path to that file, it will use the current working
>> directory, which might be a temporary directory used during the package
>> installation.  Since you want this to work as a vignette, you need to
>> include the child docs in your package.  One way to do that is to put them
>> in a new directory called "inst/children", which will be installed to
>> "children" when your package is installed.  Then the vignette can find the
>> file as
>>
>>      system.file(file.path("children", child_docs), package = "yourpackage")
>>
>> You could also put them in the "vignettes" directory, but there are special
>> rules for how files there are installed or not, so I'd recommend against it.
>>
>> Duncan Murdoch
> 
> 
>


From @ndeol@ev@in @ending from gm@il@com  Fri Jul 13 15:08:51 2018
From: @ndeol@ev@in @ending from gm@il@com (=?UTF-8?Q?And=C3=A9ol_Evain?=)
Date: Fri, 13 Jul 2018 14:08:51 +0100
Subject: [Rd] 
 R API for C/C++ initialisation issue appears with update to R.3.5
In-Reply-To: <alpine.OSX.2.21.1807121746080.632@lukes-macbook-air.local>
References: <CAGOu7fVQXLnbsCJ9GLkTghkWtLxhXY7MAD0ha+RDV+XrEHAq9g@mail.gmail.com>
 <alpine.OSX.2.21.1807121746080.632@lukes-macbook-air.local>
Message-ID: <CAGOu7fWJ0cbL8VQsDeytVgGnhgPp5P2RFG0t2NhOF_rHkdh6Tw@mail.gmail.com>

Thanks you very much !

I cleaned up all the Qt dependencies to simplify reproducibility, but when
I moved the call to Rf_endEmbedded to the destructor of class RManager
instead of right after the callbacks settings, the issue disappeared.
It still seems a bit weird that this placement of Rf_endEmbedded was ok for
R.3.4, but not for R.3.5. Maybe there used to be some bug that allowed it
to work while it shouldn't.

And?ol

2018-07-12 23:50 GMT+01:00 <luke-tierney at uiowa.edu>:

> You might have more luck getting help with a completely self-contained
> example (no QT in particular) and a complete description of how you
> built and ran your example.
>
> That said, the placement of the call to Rf_endEmbedded looks a little
> odd.
>
> Best,
>
> luke
>
> On Thu, 12 Jul 2018, And?ol Evain wrote:
>
> Hello everyone,
>>
>> I have a C++ program that calls R using R_tryEval, very similarly to what
>> package RInside does.
>> It used to work with R.3.4.3 and R.3.4.4. However, since I updated it to
>> R.3.5.1, R sends an error message: "*Error in < My command > : the base
>> graphics system is not registered*"  for any command related to the
>> graphics package.
>>
>> I made a ticket on stackoverflow about it: https://stackoverflow.com/
>> questions/51242993/difference-between-r-3-4-4-and-r-3-5-1-in-r-api-for-c
>>
>> But nobody could explain why so far. And after reducing my code further, I
>> am now enclined to think this is actually a bug.
>>
>> The code provided in stackOverflow is already reduced, but not minimal
>> yet.
>> Since then, I reduced it further to really ensure that it was not an
>> interference from anything around it. So I removed the GUI and the
>> callbacks.
>> Here is a really minimal example attached.
>>
>> In its current form, the program just sends the command :   par("mar") to
>> R, and then the command  dev.off()   .
>> With R.3.4.4, this program print as output what is expected. No error
>> occured during evaluation of the command :
>>
>>
>>
>>
>>
>>
>>
>>
>>
>> *No error occured during eval of "par(\"mar\")"EXAMPLE #1 Output: EXAMPLE
>> #1 Output: Result is:  "5.1"Result is:  "5.1"Result is:  "5.1"Result is:
>> "5.1"No error occured during eval of "dev.off()"Result is:  "1"*
>>
>> But the exact same program with R.3.5.1 gives:
>>
>>
>>
>>
>>
>> *An error occured during eval of "par(\"mar\")"No error occured during
>> eval
>> of "dev.off()"Result is:  "1"*
>>
>> The error that occured is not displayed here, since I removed the
>> callbacks
>> to fetch it, but it was:
>> *Error in par("mar") : the base graphics system is not registered*
>>
>>
>> I compiled Microsoft Visual C++ Compiler 15.0 (amd64), and uses 64bits
>> version of R. But previously I also observed the same behovior with
>> 32bits.
>> I also tried re-installing R from scratch, without effect.
>>
>> I am using Windows 10, 64bits
>> Registry variables PATH and R_HOME are correctly set and points to the
>> appropriate version of R, installed in the default directory.
>>
>> I'd be glad to hear any ideas about potential fixes or workaround.
>>
>> Cheers,
>>
>> And?ol Evain
>>
>>
> --
> Luke Tierney
> Ralph E. Wareham Professor of Mathematical Sciences
> University of Iowa                  Phone:             319-335-3386
> Department of Statistics and        Fax:               319-335-3017
>    Actuarial Science
> 241 Schaeffer Hall                  email:   luke-tierney at uiowa.edu
> Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu

	[[alternative HTML version deleted]]


From chri@ti@nr@u080 @ending from gm@il@com  Mon Jul 16 14:28:44 2018
From: chri@ti@nr@u080 @ending from gm@il@com (Christian Rau)
Date: Mon, 16 Jul 2018 14:28:44 +0200
Subject: [Rd] persp command
Message-ID: <CADX8qG3jK8rmPPpAjZ2NFOdhahEzGE=Mq0q=kGJbaiTHBbj4Dw@mail.gmail.com>

Dear R-devel mailing list,

I am wondering whether the "theta" and "phi" parameters of the "persp"
function
in the graphics commands are named in error (the names seem to have been
swapped). Also, in the documentation to "persp", reference is made to
"colatitude"
when the effect in the image is actually that of "latitude".

Thank you,
Sincerely,
Christian

	[[alternative HTML version deleted]]


From rb@er @ending from @t@u@edu  Mon Jul 16 20:47:57 2018
From: rb@er @ending from @t@u@edu (Robert Baer)
Date: Mon, 16 Jul 2018 13:47:57 -0500
Subject: [Rd] persp command
In-Reply-To: <CADX8qG3jK8rmPPpAjZ2NFOdhahEzGE=Mq0q=kGJbaiTHBbj4Dw@mail.gmail.com>
References: <CADX8qG3jK8rmPPpAjZ2NFOdhahEzGE=Mq0q=kGJbaiTHBbj4Dw@mail.gmail.com>
Message-ID: <b75ae71f-3909-c151-01c4-260fc2d08687@atsu.edu>


On 7/16/2018 7:28 AM, Christian Rau wrote:
> Dear R-devel mailing list,
>
> I am wondering whether the "theta" and "phi" parameters of the "persp"
> function
> in the graphics commands are named in error (the names seem to have been
> swapped).
Not that it is authoritative, but one gleans from wikipedia, 
https://en.wikipedia.org/wiki/Spherical_coordinate_system ,? that 
phyicists and mathematicians have exactly opposite conventions for the 
meaning of theta and phi .

In the end, a symbol is just a standin for what it "stands for" so, we 
just need to follow the persp convention when using persp. :-)

> Also, in the documentation to "persp", reference is made to
> "colatitude"
> when the effect in the image is actually that of "latitude".
>
> Thank you,
> Sincerely,
> Christian
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 


--
Robert W. Baer, Ph.D.
Professor of Physiology
Kirksville College of Osteopathic Medicine
A T Still University of Health Sciences
800 W. Jefferson St
Kirksville, MO 63501
660-626-2321 Department
660-626-2965 FAX


From chri@ti@nr@u080 @ending from gm@il@com  Mon Jul 16 21:24:51 2018
From: chri@ti@nr@u080 @ending from gm@il@com (Christian Rau)
Date: Mon, 16 Jul 2018 21:24:51 +0200
Subject: [Rd] persp command
In-Reply-To: <b75ae71f-3909-c151-01c4-260fc2d08687@atsu.edu>
References: <CADX8qG3jK8rmPPpAjZ2NFOdhahEzGE=Mq0q=kGJbaiTHBbj4Dw@mail.gmail.com>
 <b75ae71f-3909-c151-01c4-260fc2d08687@atsu.edu>
Message-ID: <CADX8qG0j24dPvpvRYDW0O23SGYVsbeB0oesE5sbnGLQnwtJv-g@mail.gmail.com>

Dear Robert,

Thank you for pointing out the existence of the two different conventions
in mathematics
and physics --- sorry that I hadn't investigated this in advance. As far as
I am aware, the
mathematicians use the "physics" convention quite often, but can certainly
accept the
different convention used in R. My other point on "latitude" being
erroneously labelled as "colatitude"
still seems to stand.

Best Regards,
Christian


On Mon, Jul 16, 2018 at 8:47 PM Robert Baer <rbaer at atsu.edu> wrote:

>
> On 7/16/2018 7:28 AM, Christian Rau wrote:
> > Dear R-devel mailing list,
> >
> > I am wondering whether the "theta" and "phi" parameters of the "persp"
> > function
> > in the graphics commands are named in error (the names seem to have been
> > swapped).
> Not that it is authoritative, but one gleans from wikipedia,
> https://en.wikipedia.org/wiki/Spherical_coordinate_system ,  that
> phyicists and mathematicians have exactly opposite conventions for the
> meaning of theta and phi .
>
> In the end, a symbol is just a standin for what it "stands for" so, we
> just need to follow the persp convention when using persp. :-)
>
> > Also, in the documentation to "persp", reference is made to
> > "colatitude"
> > when the effect in the image is actually that of "latitude".
> >
> > Thank you,
> > Sincerely,
> > Christian
> >
> >       [[alternative HTML version deleted]]
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
>
> --
>
>
> --
> Robert W. Baer, Ph.D.
> Professor of Physiology
> Kirksville College of Osteopathic Medicine
> A T Still University of Health Sciences
> 800 W. Jefferson St
> Kirksville, MO 63501
> 660-626-2321 Department
> 660-626-2965 FAX
>
>

	[[alternative HTML version deleted]]


From d@tud@r @ending from gm@il@com  Mon Jul 16 21:32:23 2018
From: d@tud@r @ending from gm@il@com (Daniel Raduta)
Date: Mon, 16 Jul 2018 14:32:23 -0500
Subject: [Rd] Memory leakage from large lists
Message-ID: <CAAuWi_Yz3ssujY_hyEB9jzGjjqe3rmFA=2uJE9PUtqeiphQKeg@mail.gmail.com>

Hello,

I am experiencing a very noticeable memory leak when using large lists of
large data. The code below creates a list of matrices, yet the memory does
not free up after removing that item and performing a garbage collection.
Is there a something I can do to prevent this memory leak? Any help would
be greatly appreciated. By the way, if you execute the code, please run it
in a new R session.

# Start of code
================================================================

# Function that returns memory being used
MemoryUsed <- function(){
  pid <- Sys.getpid()
  system(paste0("top -n 1 -p ", pid, " -b"), intern = TRUE)[c(7,8)]
}

# Initial memory (VIRT memory equals about 400,000 bytes on my machine)
MemoryUsed()

# Create a large list of large data, remove it, and perform garbarge
collection
ncols <- 100
nrows <- 10000
mat <- matrix(seq(nrows * ncols), nrow = nrows, ncol = ncols)
ls <- lapply(1:1000, function(x) as.data.frame(mat))
rm(list = setdiff(ls(), 'MemoryUsed'))
invisible(gc())

# Final memory (now, VIRT memory equals about 4,600,000 bytes on my machine)
MemoryUsed()

# End of code
==================================================================

My session info is:

R version 3.4.4 (2018-03-15)
Platform: x86_64-pc-linux-gnu (64-bit)
Running under: Ubuntu 16.04.3 LTS

Matrix products: default
BLAS: /usr/lib/libblas/libblas.so.3.6.0
LAPACK: /usr/lib/lapack/liblapack.so.3.6.0

locale:
 [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
 [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
LC_PAPER=en_US.UTF-8       LC_NAME=C
 [9] LC_ADDRESS=C               LC_TELEPHONE=C
LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

loaded via a namespace (and not attached):
[1] compiler_3.4.4 tools_3.4.4    yaml_2.1.19

	[[alternative HTML version deleted]]


From kevinu@hey @ending from gm@il@com  Mon Jul 16 22:01:50 2018
From: kevinu@hey @ending from gm@il@com (Kevin Ushey)
Date: Mon, 16 Jul 2018 13:01:50 -0700
Subject: [Rd] Output mis-encoded on Windows w/ RGui 3.5.1 in strange case
Message-ID: <CAJXgQP2vJPAJav3F_g=LT+-a4ogV+e-7c97DGu6uy-e4_VWL3g@mail.gmail.com>

Given the following R script:

   x <- 1
   print(list())
   save(x, file = tempfile())
   output <- encodeString("apple")
   print(output)

If I source this script from RGui on Windows, I see the output:

   > source("encoding.R")
   list()
   [1] "\002??apple\003??"

That is, it's as though R has injected what looks like byte order
marks around the encoded string:

   > charToRaw(output)
    [1] 02 ff fe 61 70 70 6c 65 03 ff fe

FWIW I see the same output in R-patched and R-devel. Any idea what
might be going on? For what it's worth, I don't see the same issue
with R as run from the terminal.

Thanks,
Kevin


From c@@rdi@g@bor @ending from gm@il@com  Tue Jul 17 02:46:31 2018
From: c@@rdi@g@bor @ending from gm@il@com (=?UTF-8?B?R8OhYm9yIENzw6FyZGk=?=)
Date: Tue, 17 Jul 2018 01:46:31 +0100
Subject: [Rd] Top level \Sexpr and R CMD check
In-Reply-To: <f5f9aff9-cca1-9da6-8155-ac4571bc90da@gmail.com>
References: <CABtg=KkE7gNvho-PLvsS-48yOR5nVTTSsekf35uLS4JJiZmjjg@mail.gmail.com>
 <eaf1c672-fb4c-5327-9b5a-4349ef75eec7@gmail.com>
 <CABtg=KkNXXPBg+6yzQZ2FOdWsUqZj0xnbUAaOu=-ZG7pGUOvHQ@mail.gmail.com>
 <b03ecf4b-f59b-eed6-ddb2-4788a4cd98ef@gmail.com>
 <CABtg=KkH8UO93RggxZwtKgJxcN+5JS-HQ0NBQX0yYrLNi5PEXw@mail.gmail.com>
 <CABtg=K=Rvt98Z9XdLLEd7FogzSiXGZRzGOofxP12pzyn5rfr7A@mail.gmail.com>
 <f5f9aff9-cca1-9da6-8155-ac4571bc90da@gmail.com>
Message-ID: <CABtg=KmKig4n3sAJepeBThARQE0rVcJk2BriYgvgDYtBJ+unRQ@mail.gmail.com>

The patch indeed solves the issue.

Thanks  much,
G.
On Thu, Jul 12, 2018 at 5:29 PM Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
>
> On 12/07/2018 9:46 AM, G?bor Cs?rdi wrote:
> > On Thu, Jul 12, 2018 at 2:30 PM G?bor Cs?rdi <csardi.gabor at gmail.com> wrote:
> >>
> >> On Thu, Jul 12, 2018 at 2:21 PM Duncan Murdoch <murdoch.duncan at gmail.com> wrote:
> >>> I think I found the bug.  The tools::checkRd function only processes
> >>> \Sexpr's with "stage=render".  I think the author (who might have been
> >>> me, I forget) assumed that would imply all the earlier stages as well,
> >>> but apparently it doesn't.
> >>>
> >>> So you could use that as a workaround.
> >>>
> >>> I'll do some more checking, then submit a bug report and patch to Bugzilla.
> >>>
> >>> Duncan Murdoch
> >>
> >> Thanks much! I tried using stage=render, but then I get an error at
> >> install time:
> >>
> >> Warning: /private/var/folders/59/0gkmw1yj2w7bf2dfc3jznv5w0000gn/T/RtmpCG4Qz9/R.INSTALLec4743ba8cf4/ps/man/ps_handle.Rd:45-48:
> >> Section \Sexpr is unrecognized and will be dropped
> >>
> >> And indeed the whole section is dropped.
> >>
> >> Seems like there is no clean workaround here.
> >>
> >> Thanks again,
> >> G.
> >
> > Btw. would it make sense to just allow \Sexpr as a top level section?
> > Maybe here:
> > https://github.com/wch/r-source/blob/98e9999eb0e8616550632a1675e4d2dbe630d5e4/src/library/tools/R/RdConv2.R#L500-L503
> >
> > At least if stage=render, there is no way to check if the returned
> > value is always a valid top level section, anyway.
> > If it is not a valid section (or \Sexpr returns some bad markup in
> > general), then the user gets a render-time error,
> > but with stage=render I guess one cannot do better.
> >
>
> I believe the problem is in the tools:::.check_package_parseRd function.
>   It checks the .Rd files rather than parsed Rd objects, so it needs to
> be told to expand all \Sexpr's, not just render-time ones.  I think it
> is fixed by the below patch to R-devel.  Can you give it a try before I
> submit the bug report?
>
> Duncan Murdoch
>
> Index: src/library/tools/R/QC.R
> ===================================================================
> --- src/library/tools/R/QC.R    (revision 74954)
> +++ src/library/tools/R/QC.R    (working copy)
> @@ -6430,7 +6430,8 @@
>           if(basename(f) %in% c("iconv.Rd", "showNonASCII.Rd")) def_enc
> <- TRUE
>         tmp <- tryCatch(suppressMessages(checkRd(f, encoding = enc,
>                                                  def_enc = def_enc,
> -                                                 macros = macros)),
> +                                                 macros = macros,
> +                                                 stages = c("build",
> "install", "render"))),
>                         error = identity)
>         if(inherits(tmp, "error")) {
>             bad <- c(bad, f)
>


From jo@h@m@ulrich @ending from gm@il@com  Tue Jul 17 12:56:37 2018
From: jo@h@m@ulrich @ending from gm@il@com (Joshua Ulrich)
Date: Tue, 17 Jul 2018 05:56:37 -0500
Subject: [Rd] Memory leakage from large lists
In-Reply-To: <CAAuWi_Yz3ssujY_hyEB9jzGjjqe3rmFA=2uJE9PUtqeiphQKeg@mail.gmail.com>
References: <CAAuWi_Yz3ssujY_hyEB9jzGjjqe3rmFA=2uJE9PUtqeiphQKeg@mail.gmail.com>
Message-ID: <CAPPM_gQqPM7eeiaNqpV4fzxk9htZvfBynNx+SXF4DUOmm2ELLA@mail.gmail.com>

This looks like a case of FAQ 7.42:
https://cran.r-project.org/doc/FAQ/R-FAQ.html#Why-is-R-apparently-not-releasing-memory_003f

On Mon, Jul 16, 2018 at 2:32 PM, Daniel Raduta <datudar at gmail.com> wrote:
> Hello,
>
> I am experiencing a very noticeable memory leak when using large lists of
> large data. The code below creates a list of matrices, yet the memory does
> not free up after removing that item and performing a garbage collection.
> Is there a something I can do to prevent this memory leak? Any help would
> be greatly appreciated. By the way, if you execute the code, please run it
> in a new R session.
>
> # Start of code
> ================================================================
>
> # Function that returns memory being used
> MemoryUsed <- function(){
>   pid <- Sys.getpid()
>   system(paste0("top -n 1 -p ", pid, " -b"), intern = TRUE)[c(7,8)]
> }
>
> # Initial memory (VIRT memory equals about 400,000 bytes on my machine)
> MemoryUsed()
>
> # Create a large list of large data, remove it, and perform garbarge
> collection
> ncols <- 100
> nrows <- 10000
> mat <- matrix(seq(nrows * ncols), nrow = nrows, ncol = ncols)
> ls <- lapply(1:1000, function(x) as.data.frame(mat))
> rm(list = setdiff(ls(), 'MemoryUsed'))
> invisible(gc())
>
> # Final memory (now, VIRT memory equals about 4,600,000 bytes on my machine)
> MemoryUsed()
>
> # End of code
> ==================================================================
>
> My session info is:
>
> R version 3.4.4 (2018-03-15)
> Platform: x86_64-pc-linux-gnu (64-bit)
> Running under: Ubuntu 16.04.3 LTS
>
> Matrix products: default
> BLAS: /usr/lib/libblas/libblas.so.3.6.0
> LAPACK: /usr/lib/lapack/liblapack.so.3.6.0
>
> locale:
>  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
> LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
>  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
> LC_PAPER=en_US.UTF-8       LC_NAME=C
>  [9] LC_ADDRESS=C               LC_TELEPHONE=C
> LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> loaded via a namespace (and not attached):
> [1] compiler_3.4.4 tools_3.4.4    yaml_2.1.19
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel



-- 
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com
R/Finance 2018 | www.rinfinance.com


From tom@@@k@liber@ @ending from gm@il@com  Tue Jul 17 13:11:23 2018
From: tom@@@k@liber@ @ending from gm@il@com (Tomas Kalibera)
Date: Tue, 17 Jul 2018 13:11:23 +0200
Subject: [Rd] Memory leakage from large lists
In-Reply-To: <CAPPM_gQqPM7eeiaNqpV4fzxk9htZvfBynNx+SXF4DUOmm2ELLA@mail.gmail.com>
References: <CAAuWi_Yz3ssujY_hyEB9jzGjjqe3rmFA=2uJE9PUtqeiphQKeg@mail.gmail.com>
 <CAPPM_gQqPM7eeiaNqpV4fzxk9htZvfBynNx+SXF4DUOmm2ELLA@mail.gmail.com>
Message-ID: <90d95a4d-1ab9-1849-e826-92a53e7765b5@gmail.com>

On 07/17/2018 12:56 PM, Joshua Ulrich wrote:
> This looks like a case of FAQ 7.42:
> https://cran.r-project.org/doc/FAQ/R-FAQ.html#Why-is-R-apparently-not-releasing-memory_003f
Yes. A true memory leak in R would mean that repeated execution of the 
same code (e.g. creation and deletion of the list) would start failing 
due to running out of memory at some (high) iteration number.

Also, gc(verbose=TRUE, full=TRUE) run before and after the code snippet 
suggests there is no leak. Well, a little bit of memory could be added 
initially (e.g. byte-compilation, some internal caching at different 
levels) - and this is why "high iteration number" above - but eventually 
the memory use in cons cells and vectors should become constant and it 
does on my system.

Tomas
> On Mon, Jul 16, 2018 at 2:32 PM, Daniel Raduta <datudar at gmail.com> wrote:
>> Hello,
>>
>> I am experiencing a very noticeable memory leak when using large lists of
>> large data. The code below creates a list of matrices, yet the memory does
>> not free up after removing that item and performing a garbage collection.
>> Is there a something I can do to prevent this memory leak? Any help would
>> be greatly appreciated. By the way, if you execute the code, please run it
>> in a new R session.
>>
>> # Start of code
>> ================================================================
>>
>> # Function that returns memory being used
>> MemoryUsed <- function(){
>>    pid <- Sys.getpid()
>>    system(paste0("top -n 1 -p ", pid, " -b"), intern = TRUE)[c(7,8)]
>> }
>>
>> # Initial memory (VIRT memory equals about 400,000 bytes on my machine)
>> MemoryUsed()
>>
>> # Create a large list of large data, remove it, and perform garbarge
>> collection
>> ncols <- 100
>> nrows <- 10000
>> mat <- matrix(seq(nrows * ncols), nrow = nrows, ncol = ncols)
>> ls <- lapply(1:1000, function(x) as.data.frame(mat))
>> rm(list = setdiff(ls(), 'MemoryUsed'))
>> invisible(gc())
>>
>> # Final memory (now, VIRT memory equals about 4,600,000 bytes on my machine)
>> MemoryUsed()
>>
>> # End of code
>> ==================================================================
>>
>> My session info is:
>>
>> R version 3.4.4 (2018-03-15)
>> Platform: x86_64-pc-linux-gnu (64-bit)
>> Running under: Ubuntu 16.04.3 LTS
>>
>> Matrix products: default
>> BLAS: /usr/lib/libblas/libblas.so.3.6.0
>> LAPACK: /usr/lib/lapack/liblapack.so.3.6.0
>>
>> locale:
>>   [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
>> LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
>>   [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
>> LC_PAPER=en_US.UTF-8       LC_NAME=C
>>   [9] LC_ADDRESS=C               LC_TELEPHONE=C
>> LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
>>
>> attached base packages:
>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>
>> loaded via a namespace (and not attached):
>> [1] compiler_3.4.4 tools_3.4.4    yaml_2.1.19
>>
>>          [[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From tom@@@k@liber@ @ending from gm@il@com  Tue Jul 17 15:12:18 2018
From: tom@@@k@liber@ @ending from gm@il@com (Tomas Kalibera)
Date: Tue, 17 Jul 2018 15:12:18 +0200
Subject: [Rd] 
 Output mis-encoded on Windows w/ RGui 3.5.1 in strange case
In-Reply-To: <CAJXgQP2vJPAJav3F_g=LT+-a4ogV+e-7c97DGu6uy-e4_VWL3g@mail.gmail.com>
References: <CAJXgQP2vJPAJav3F_g=LT+-a4ogV+e-7c97DGu6uy-e4_VWL3g@mail.gmail.com>
Message-ID: <ce6639ac-5467-558e-94cc-9f72d9ce8720@gmail.com>

Hi Kevin,

the extra bytes you are seeing are escapes for UTF-8 strings used in 
input to RGui console. Recently ascii strings are converted to UTF-8 so 
you would get these escapes for ascii strings now as well. RGui 
understands these escapes and converts from UTF-8 to wide characters 
before printing on Windows. The escapes should not be used unless 
printing to RGui console.

I suppose you managed to leak the escapes but I cannot reproduce, the 
example you sent seems incomplete ("x" not used, not clear what 
encoding.R is, not clear where the encodeString is run) and none of the 
variations I ran leaked the escapes on R-devel. Please clarify the 
example if you believe it is a bug. Please also use current R-devel 
(I've relatively recently fixed a bug in decoding these escaped strings, 
perhaps unlikely, but not impossible it could be related).

Best
Tomas

On 07/16/2018 10:01 PM, Kevin Ushey wrote:
> Given the following R script:
>
>     x <- 1
>     print(list())
>     save(x, file = tempfile())
>     output <- encodeString("apple")
>     print(output)
>
> If I source this script from RGui on Windows, I see the output:
>
>     > source("encoding.R")
>     list()
>     [1] "\002??apple\003??"
>
> That is, it's as though R has injected what looks like byte order
> marks around the encoded string:
>
>     > charToRaw(output)
>      [1] 02 ff fe 61 70 70 6c 65 03 ff fe
>
> FWIW I see the same output in R-patched and R-devel. Any idea what
> might be going on? For what it's worth, I don't see the same issue
> with R as run from the terminal.
>
> Thanks,
> Kevin
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From kevinu@hey @ending from gm@il@com  Tue Jul 17 17:16:30 2018
From: kevinu@hey @ending from gm@il@com (Kevin Ushey)
Date: Tue, 17 Jul 2018 08:16:30 -0700
Subject: [Rd] 
 Output mis-encoded on Windows w/ RGui 3.5.1 in strange case
In-Reply-To: <ce6639ac-5467-558e-94cc-9f72d9ce8720@gmail.com>
References: <CAJXgQP2vJPAJav3F_g=LT+-a4ogV+e-7c97DGu6uy-e4_VWL3g@mail.gmail.com>
 <ce6639ac-5467-558e-94cc-9f72d9ce8720@gmail.com>
Message-ID: <CAJXgQP26TTfgZPwTr4Cc=HACcbY2yQavSd1M-MBThtWkFEWeaQ@mail.gmail.com>

Sorry, I should have been more clear -- if I write the contents of
that script to a file called 'encoding.R' and source that, then I see
the reported behavior.

Here's something standalone that you should hopefully be able to copy
+ paste into RGui to reproduce:

code <- '
   x <- 1
   print(list())
   save(x, file = tempfile())
   output <- encodeString("apple")
   print(output)
'

file <- tempfile(fileext = ".R")
writeLines(code, con = file)
source(file)

When I run this, I see:

> code <- '
+    x <- 1
+    print(list())
+    save(x, file = tempfile())
+    output <- encodeString("apple")
+    print(output)
+ '
>
> file <- tempfile(fileext = ".R")
> writeLines(code, con = file)
> source(file)
list()
[1] "\002??apple\003??"

This is with today's R-devel:

> sessionInfo()
R Under development (unstable) (2018-07-16 r74967)
Platform: x86_64-w64-mingw32/x64 (64-bit)
Running under: Windows 10 x64 (build 17134)

Matrix products: default

locale:
[1] LC_COLLATE=English_United States.1252
[2] LC_CTYPE=English_United States.1252
[3] LC_MONETARY=English_United States.1252
[4] LC_NUMERIC=C
[5] LC_TIME=English_United States.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

loaded via a namespace (and not attached):
[1] compiler_3.6.0

I realize the example looks incomplete, but it seems like each step is
required to reproduce the strange behavior:

   1) You need to print an empty list,
   2) You need to invoke save() after printing that empty list,
   3) Then, attempts to call encodeString() will produce the strange output.

For what it's worth, it may be related to a behavior I'm seeing where
the first name printed for an R list is quoted with backticks even
when not necessary:

> list(x = 1, y = 2)
$`x`
[1] 1

$y
[1] 2

Thanks,
Kevin

On Tue, Jul 17, 2018 at 6:12 AM Tomas Kalibera <tomas.kalibera at gmail.com> wrote:
>
> Hi Kevin,
>
> the extra bytes you are seeing are escapes for UTF-8 strings used in
> input to RGui console. Recently ascii strings are converted to UTF-8 so
> you would get these escapes for ascii strings now as well. RGui
> understands these escapes and converts from UTF-8 to wide characters
> before printing on Windows. The escapes should not be used unless
> printing to RGui console.
>
> I suppose you managed to leak the escapes but I cannot reproduce, the
> example you sent seems incomplete ("x" not used, not clear what
> encoding.R is, not clear where the encodeString is run) and none of the
> variations I ran leaked the escapes on R-devel. Please clarify the
> example if you believe it is a bug. Please also use current R-devel
> (I've relatively recently fixed a bug in decoding these escaped strings,
> perhaps unlikely, but not impossible it could be related).
>
> Best
> Tomas
>
> On 07/16/2018 10:01 PM, Kevin Ushey wrote:
> > Given the following R script:
> >
> >     x <- 1
> >     print(list())
> >     save(x, file = tempfile())
> >     output <- encodeString("apple")
> >     print(output)
> >
> > If I source this script from RGui on Windows, I see the output:
> >
> >     > source("encoding.R")
> >     list()
> >     [1] "\002??apple\003??"
> >
> > That is, it's as though R has injected what looks like byte order
> > marks around the encoded string:
> >
> >     > charToRaw(output)
> >      [1] 02 ff fe 61 70 70 6c 65 03 ff fe
> >
> > FWIW I see the same output in R-patched and R-devel. Any idea what
> > might be going on? For what it's worth, I don't see the same issue
> > with R as run from the terminal.
> >
> > Thanks,
> > Kevin
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


From @purdle@@ @ending from gm@il@com  Wed Jul 18 03:40:46 2018
From: @purdle@@ @ending from gm@il@com (Abs Spurdle)
Date: Wed, 18 Jul 2018 13:40:46 +1200
Subject: [Rd] R's Identity
Message-ID: <CAB8pepyLTjn0Ze-tFZAXETyCKuY4mBe3nth273X60j8EDL93Fw@mail.gmail.com>

According to R's website, R should be cited as "R: A Language and
Environment for Statistical Computing".
According to the home page, "R is a free environment for statistical
computing and graphics".
I think the term "Language" is important and should be included.
But not everyone using R uses it for statistics or graphics.
Some people use it for numerical linear algebra, discrete mathematics,
computer algebra, differential equations, optimization or probability,
amongst other things.
So I think it would be better to say "R: A Language and Environment for
Mathematics and Statistics" or "R is a language and environment for
mathematics and statistics".
(I'm removing the word "Computing"),
I think changing R's identity to reflect mathematics more would make it
more appealing.

On a side issue, I think probability and statistics should be separated.
According to Wikipedia, probability theory is a branch of mathematics,
which I agree with.

	[[alternative HTML version deleted]]


From tom@@@k@liber@ @ending from gm@il@com  Wed Jul 18 12:03:26 2018
From: tom@@@k@liber@ @ending from gm@il@com (Tomas Kalibera)
Date: Wed, 18 Jul 2018 12:03:26 +0200
Subject: [Rd] 
 Output mis-encoded on Windows w/ RGui 3.5.1 in strange case
In-Reply-To: <CAJXgQP26TTfgZPwTr4Cc=HACcbY2yQavSd1M-MBThtWkFEWeaQ@mail.gmail.com>
References: <CAJXgQP2vJPAJav3F_g=LT+-a4ogV+e-7c97DGu6uy-e4_VWL3g@mail.gmail.com>
 <ce6639ac-5467-558e-94cc-9f72d9ce8720@gmail.com>
 <CAJXgQP26TTfgZPwTr4Cc=HACcbY2yQavSd1M-MBThtWkFEWeaQ@mail.gmail.com>
Message-ID: <0058f426-c292-430b-8a1f-8f77b62bb76f@gmail.com>

Thanks, I can now reproduce and it is a bug that is easy to fix, I will 
do so shortly.

Fyi it can be reproduced simply by running these two lines in Rgui:

list()
encodeString("apple")

Best
Tomas

On 07/17/2018 05:16 PM, Kevin Ushey wrote:
> Sorry, I should have been more clear -- if I write the contents of
> that script to a file called 'encoding.R' and source that, then I see
> the reported behavior.
>
> Here's something standalone that you should hopefully be able to copy
> + paste into RGui to reproduce:
>
> code <- '
>     x <- 1
>     print(list())
>     save(x, file = tempfile())
>     output <- encodeString("apple")
>     print(output)
> '
>
> file <- tempfile(fileext = ".R")
> writeLines(code, con = file)
> source(file)
>
> When I run this, I see:
>
>> code <- '
> +    x <- 1
> +    print(list())
> +    save(x, file = tempfile())
> +    output <- encodeString("apple")
> +    print(output)
> + '
>> file <- tempfile(fileext = ".R")
>> writeLines(code, con = file)
>> source(file)
> list()
> [1] "\002??apple\003??"
>
> This is with today's R-devel:
>
>> sessionInfo()
> R Under development (unstable) (2018-07-16 r74967)
> Platform: x86_64-w64-mingw32/x64 (64-bit)
> Running under: Windows 10 x64 (build 17134)
>
> Matrix products: default
>
> locale:
> [1] LC_COLLATE=English_United States.1252
> [2] LC_CTYPE=English_United States.1252
> [3] LC_MONETARY=English_United States.1252
> [4] LC_NUMERIC=C
> [5] LC_TIME=English_United States.1252
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> loaded via a namespace (and not attached):
> [1] compiler_3.6.0
>
> I realize the example looks incomplete, but it seems like each step is
> required to reproduce the strange behavior:
>
>     1) You need to print an empty list,
>     2) You need to invoke save() after printing that empty list,
>     3) Then, attempts to call encodeString() will produce the strange output.
>
> For what it's worth, it may be related to a behavior I'm seeing where
> the first name printed for an R list is quoted with backticks even
> when not necessary:
>
>> list(x = 1, y = 2)
> $`x`
> [1] 1
>
> $y
> [1] 2
>
> Thanks,
> Kevin
>
> On Tue, Jul 17, 2018 at 6:12 AM Tomas Kalibera <tomas.kalibera at gmail.com> wrote:
>> Hi Kevin,
>>
>> the extra bytes you are seeing are escapes for UTF-8 strings used in
>> input to RGui console. Recently ascii strings are converted to UTF-8 so
>> you would get these escapes for ascii strings now as well. RGui
>> understands these escapes and converts from UTF-8 to wide characters
>> before printing on Windows. The escapes should not be used unless
>> printing to RGui console.
>>
>> I suppose you managed to leak the escapes but I cannot reproduce, the
>> example you sent seems incomplete ("x" not used, not clear what
>> encoding.R is, not clear where the encodeString is run) and none of the
>> variations I ran leaked the escapes on R-devel. Please clarify the
>> example if you believe it is a bug. Please also use current R-devel
>> (I've relatively recently fixed a bug in decoding these escaped strings,
>> perhaps unlikely, but not impossible it could be related).
>>
>> Best
>> Tomas
>>
>> On 07/16/2018 10:01 PM, Kevin Ushey wrote:
>>> Given the following R script:
>>>
>>>      x <- 1
>>>      print(list())
>>>      save(x, file = tempfile())
>>>      output <- encodeString("apple")
>>>      print(output)
>>>
>>> If I source this script from RGui on Windows, I see the output:
>>>
>>>      > source("encoding.R")
>>>      list()
>>>      [1] "\002??apple\003??"
>>>
>>> That is, it's as though R has injected what looks like byte order
>>> marks around the encoded string:
>>>
>>>      > charToRaw(output)
>>>       [1] 02 ff fe 61 70 70 6c 65 03 ff fe
>>>
>>> FWIW I see the same output in R-patched and R-devel. Any idea what
>>> might be going on? For what it's worth, I don't see the same issue
>>> with R as run from the terminal.
>>>
>>> Thanks,
>>> Kevin
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>


	[[alternative HTML version deleted]]


From tom@@@k@liber@ @ending from gm@il@com  Wed Jul 18 15:38:39 2018
From: tom@@@k@liber@ @ending from gm@il@com (Tomas Kalibera)
Date: Wed, 18 Jul 2018 15:38:39 +0200
Subject: [Rd] 
 Output mis-encoded on Windows w/ RGui 3.5.1 in strange case
In-Reply-To: <0058f426-c292-430b-8a1f-8f77b62bb76f@gmail.com>
References: <CAJXgQP2vJPAJav3F_g=LT+-a4ogV+e-7c97DGu6uy-e4_VWL3g@mail.gmail.com>
 <ce6639ac-5467-558e-94cc-9f72d9ce8720@gmail.com>
 <CAJXgQP26TTfgZPwTr4Cc=HACcbY2yQavSd1M-MBThtWkFEWeaQ@mail.gmail.com>
 <0058f426-c292-430b-8a1f-8f77b62bb76f@gmail.com>
Message-ID: <ee40625c-3a82-399f-8b9c-5e093eca3ce3@gmail.com>

Fixed in R-devel and R-patched,
Tomas

On 07/18/2018 12:03 PM, Tomas Kalibera wrote:
> Thanks, I can now reproduce and it is a bug that is easy to fix, I 
> will do so shortly.
>
> Fyi it can be reproduced simply by running these two lines in Rgui:
>
> list()
> encodeString("apple")
>
> Best
> Tomas
>
> On 07/17/2018 05:16 PM, Kevin Ushey wrote:
>> Sorry, I should have been more clear -- if I write the contents of
>> that script to a file called 'encoding.R' and source that, then I see
>> the reported behavior.
>>
>> Here's something standalone that you should hopefully be able to copy
>> + paste into RGui to reproduce:
>>
>> code <- '
>>     x <- 1
>>     print(list())
>>     save(x, file = tempfile())
>>     output <- encodeString("apple")
>>     print(output)
>> '
>>
>> file <- tempfile(fileext = ".R")
>> writeLines(code, con = file)
>> source(file)
>>
>> When I run this, I see:
>>
>>> code <- '
>> +    x <- 1
>> +    print(list())
>> +    save(x, file = tempfile())
>> +    output <- encodeString("apple")
>> +    print(output)
>> + '
>>> file <- tempfile(fileext = ".R")
>>> writeLines(code, con = file)
>>> source(file)
>> list()
>> [1] "\002??apple\003??"
>>
>> This is with today's R-devel:
>>
>>> sessionInfo()
>> R Under development (unstable) (2018-07-16 r74967)
>> Platform: x86_64-w64-mingw32/x64 (64-bit)
>> Running under: Windows 10 x64 (build 17134)
>>
>> Matrix products: default
>>
>> locale:
>> [1] LC_COLLATE=English_United States.1252
>> [2] LC_CTYPE=English_United States.1252
>> [3] LC_MONETARY=English_United States.1252
>> [4] LC_NUMERIC=C
>> [5] LC_TIME=English_United States.1252
>>
>> attached base packages:
>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>
>> loaded via a namespace (and not attached):
>> [1] compiler_3.6.0
>>
>> I realize the example looks incomplete, but it seems like each step is
>> required to reproduce the strange behavior:
>>
>>     1) You need to print an empty list,
>>     2) You need to invoke save() after printing that empty list,
>>     3) Then, attempts to call encodeString() will produce the strange output.
>>
>> For what it's worth, it may be related to a behavior I'm seeing where
>> the first name printed for an R list is quoted with backticks even
>> when not necessary:
>>
>>> list(x = 1, y = 2)
>> $`x`
>> [1] 1
>>
>> $y
>> [1] 2
>>
>> Thanks,
>> Kevin
>>
>> On Tue, Jul 17, 2018 at 6:12 AM Tomas Kalibera<tomas.kalibera at gmail.com>  wrote:
>>> Hi Kevin,
>>>
>>> the extra bytes you are seeing are escapes for UTF-8 strings used in
>>> input to RGui console. Recently ascii strings are converted to UTF-8 so
>>> you would get these escapes for ascii strings now as well. RGui
>>> understands these escapes and converts from UTF-8 to wide characters
>>> before printing on Windows. The escapes should not be used unless
>>> printing to RGui console.
>>>
>>> I suppose you managed to leak the escapes but I cannot reproduce, the
>>> example you sent seems incomplete ("x" not used, not clear what
>>> encoding.R is, not clear where the encodeString is run) and none of the
>>> variations I ran leaked the escapes on R-devel. Please clarify the
>>> example if you believe it is a bug. Please also use current R-devel
>>> (I've relatively recently fixed a bug in decoding these escaped strings,
>>> perhaps unlikely, but not impossible it could be related).
>>>
>>> Best
>>> Tomas
>>>
>>> On 07/16/2018 10:01 PM, Kevin Ushey wrote:
>>>> Given the following R script:
>>>>
>>>>      x <- 1
>>>>      print(list())
>>>>      save(x, file = tempfile())
>>>>      output <- encodeString("apple")
>>>>      print(output)
>>>>
>>>> If I source this script from RGui on Windows, I see the output:
>>>>
>>>>      > source("encoding.R")
>>>>      list()
>>>>      [1] "\002??apple\003??"
>>>>
>>>> That is, it's as though R has injected what looks like byte order
>>>> marks around the encoded string:
>>>>
>>>>      > charToRaw(output)
>>>>       [1] 02 ff fe 61 70 70 6c 65 03 ff fe
>>>>
>>>> FWIW I see the same output in R-patched and R-devel. Any idea what
>>>> might be going on? For what it's worth, I don't see the same issue
>>>> with R as run from the terminal.
>>>>
>>>> Thanks,
>>>> Kevin
>>>>
>>>> ______________________________________________
>>>> R-devel at r-project.org  mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>


	[[alternative HTML version deleted]]


From m@echler @ending from @t@t@m@th@ethz@ch  Wed Jul 18 15:40:53 2018
From: m@echler @ending from @t@t@m@th@ethz@ch (Martin Maechler)
Date: Wed, 18 Jul 2018 15:40:53 +0200
Subject: [Rd] Tiny bug in lm()?
In-Reply-To: <87h8lscpgf.fsf@ufl.edu>
References: <87in68cuyp.fsf@ufl.edu>
	<87h8lscpgf.fsf@ufl.edu>
Message-ID: <23375.17253.421709.832356@stat.math.ethz.ch>

>>>>> Brett Presnell 
>>>>>     on Sun, 24 Jun 2018 13:57:04 +0100 writes:

    > I meant ncol(y) of course.

    > Brett Presnell <presnell at ufl.edu> writes:

    >> I suppose that this never affects anything, but in line
    >> 57 of lm.R, where the coefficients are defined for an
    >> empty model, when y is a matrix, shouldn't the value be
    >> matrix(,0,nrow(y)) rather than matrix(,0,3)?

Yes ("ncol(y)") and actually it should be 'double', not
'logical'.

OTOH: Multivariate empty models are probably pretty rare, so no
      wonder this has never been reported the last 13.374 years
      this has been in the sources.

Of course, I will still fix it.  Thank you, Brett, for reporting!

Martin


From kevinu@hey @ending from gm@il@com  Wed Jul 18 16:48:44 2018
From: kevinu@hey @ending from gm@il@com (Kevin Ushey)
Date: Wed, 18 Jul 2018 07:48:44 -0700
Subject: [Rd] 
 Output mis-encoded on Windows w/ RGui 3.5.1 in strange case
In-Reply-To: <ee40625c-3a82-399f-8b9c-5e093eca3ce3@gmail.com>
References: <CAJXgQP2vJPAJav3F_g=LT+-a4ogV+e-7c97DGu6uy-e4_VWL3g@mail.gmail.com>
 <ce6639ac-5467-558e-94cc-9f72d9ce8720@gmail.com>
 <CAJXgQP26TTfgZPwTr4Cc=HACcbY2yQavSd1M-MBThtWkFEWeaQ@mail.gmail.com>
 <0058f426-c292-430b-8a1f-8f77b62bb76f@gmail.com>
 <ee40625c-3a82-399f-8b9c-5e093eca3ce3@gmail.com>
Message-ID: <CAJXgQP181bZeztbZfdiF86DaeKdOTvMu3yaVMK6eY7HXtEJW2g@mail.gmail.com>

Thank you for the quick fix! I could've sworn the 'save()' dance was a
necessary part of the reproducible example, but evidently not ...
On Wed, Jul 18, 2018 at 6:38 AM Tomas Kalibera <tomas.kalibera at gmail.com> wrote:
>
> Fixed in R-devel and R-patched,
> Tomas
>
> On 07/18/2018 12:03 PM, Tomas Kalibera wrote:
>
> Thanks, I can now reproduce and it is a bug that is easy to fix, I will do so shortly.
>
> Fyi it can be reproduced simply by running these two lines in Rgui:
>
> list()
> encodeString("apple")
>
> Best
> Tomas
>
> On 07/17/2018 05:16 PM, Kevin Ushey wrote:
>
> Sorry, I should have been more clear -- if I write the contents of
> that script to a file called 'encoding.R' and source that, then I see
> the reported behavior.
>
> Here's something standalone that you should hopefully be able to copy
> + paste into RGui to reproduce:
>
> code <- '
>    x <- 1
>    print(list())
>    save(x, file = tempfile())
>    output <- encodeString("apple")
>    print(output)
> '
>
> file <- tempfile(fileext = ".R")
> writeLines(code, con = file)
> source(file)
>
> When I run this, I see:
>
> code <- '
>
> +    x <- 1
> +    print(list())
> +    save(x, file = tempfile())
> +    output <- encodeString("apple")
> +    print(output)
> + '
>
> file <- tempfile(fileext = ".R")
> writeLines(code, con = file)
> source(file)
>
> list()
> [1] "\002??apple\003??"
>
> This is with today's R-devel:
>
> sessionInfo()
>
> R Under development (unstable) (2018-07-16 r74967)
> Platform: x86_64-w64-mingw32/x64 (64-bit)
> Running under: Windows 10 x64 (build 17134)
>
> Matrix products: default
>
> locale:
> [1] LC_COLLATE=English_United States.1252
> [2] LC_CTYPE=English_United States.1252
> [3] LC_MONETARY=English_United States.1252
> [4] LC_NUMERIC=C
> [5] LC_TIME=English_United States.1252
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> loaded via a namespace (and not attached):
> [1] compiler_3.6.0
>
> I realize the example looks incomplete, but it seems like each step is
> required to reproduce the strange behavior:
>
>    1) You need to print an empty list,
>    2) You need to invoke save() after printing that empty list,
>    3) Then, attempts to call encodeString() will produce the strange output.
>
> For what it's worth, it may be related to a behavior I'm seeing where
> the first name printed for an R list is quoted with backticks even
> when not necessary:
>
> list(x = 1, y = 2)
>
> $`x`
> [1] 1
>
> $y
> [1] 2
>
> Thanks,
> Kevin
>
> On Tue, Jul 17, 2018 at 6:12 AM Tomas Kalibera <tomas.kalibera at gmail.com> wrote:
>
> Hi Kevin,
>
> the extra bytes you are seeing are escapes for UTF-8 strings used in
> input to RGui console. Recently ascii strings are converted to UTF-8 so
> you would get these escapes for ascii strings now as well. RGui
> understands these escapes and converts from UTF-8 to wide characters
> before printing on Windows. The escapes should not be used unless
> printing to RGui console.
>
> I suppose you managed to leak the escapes but I cannot reproduce, the
> example you sent seems incomplete ("x" not used, not clear what
> encoding.R is, not clear where the encodeString is run) and none of the
> variations I ran leaked the escapes on R-devel. Please clarify the
> example if you believe it is a bug. Please also use current R-devel
> (I've relatively recently fixed a bug in decoding these escaped strings,
> perhaps unlikely, but not impossible it could be related).
>
> Best
> Tomas
>
> On 07/16/2018 10:01 PM, Kevin Ushey wrote:
>
> Given the following R script:
>
>     x <- 1
>     print(list())
>     save(x, file = tempfile())
>     output <- encodeString("apple")
>     print(output)
>
> If I source this script from RGui on Windows, I see the output:
>
>     > source("encoding.R")
>     list()
>     [1] "\002??apple\003??"
>
> That is, it's as though R has injected what looks like byte order
> marks around the encoded string:
>
>     > charToRaw(output)
>      [1] 02 ff fe 61 70 70 6c 65 03 ff fe
>
> FWIW I see the same output in R-patched and R-devel. Any idea what
> might be going on? For what it's worth, I don't see the same issue
> with R as run from the terminal.
>
> Thanks,
> Kevin
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>
>
>


From Kurt@Hornik @ending from wu@@c@@t  Wed Jul 18 16:56:32 2018
From: Kurt@Hornik @ending from wu@@c@@t (Kurt Hornik)
Date: Wed, 18 Jul 2018 16:56:32 +0200
Subject: [Rd] MARGIN in base::unique.matrix() and base::unique.array()
In-Reply-To: <ca23524c-1c26-1ef1-8a26-998effd78219@fredhutch.org>
References: <ca23524c-1c26-1ef1-8a26-998effd78219@fredhutch.org>
Message-ID: <23375.21792.207543.185760@hornik.net>

>>>>> Herv? Pag?s writes:

Thanks for spotting this.

With c74978 I just committed, we now get

R>     unique(matrix(1:10, ncol=2), MARGIN=1:3)
Error in unique.matrix(matrix(1:10, ncol = 2), MARGIN = 1:3) : 
  MARGIN = 1,2,3 is invalid for dim = 5,2
Calls: unique -> unique.matrix
R>     unique(matrix(1:10, ncol=2), MARGIN=3)
Error in unique.matrix(matrix(1:10, ncol = 2), MARGIN = 3) : 
  MARGIN = 3 is invalid for dim = 5,2
Calls: unique -> unique.matrix

Best
-k

> Hi,
> The man page for base::unique.matrix() and base::unique.array() says
> that MARGIN is expected to be a single integer. OTOH the code in charge
> of checking the user supplied MARGIN is:

>      if (length(MARGIN) > ndim || any(MARGIN > ndim))
>          stop(gettextf("MARGIN = %d is invalid for dim = %d",
>              MARGIN, dx), domain = NA)

> which doesn't really make sense.

> As a consequence the user gets an obscure error message when specifying
> a MARGIN that satisfies the above check but is in fact invalid:

>> unique(matrix(1:10, ncol=2), MARGIN=1:2)
>    Error in args[[MARGIN]] <- !duplicated.default(temp, fromLast = 
> fromLast,  :
>      object of type 'symbol' is not subsettable

> Also the code used by the above check to generate the error message
> is broken:

>> unique(matrix(1:10, ncol=2), MARGIN=1:3)
>    Error in sprintf(gettext(fmt, domain = domain), ...) :
>      arguments cannot be recycled to the same length

>> unique(matrix(1:10, ncol=2), MARGIN=3)
>    Error in unique.matrix(matrix(1:10, ncol = 2), MARGIN = 3) :
>      c("MARGIN = 3 is invalid for dim = 5", "MARGIN = 3 is invalid for 
> dim = 2")

> Thanks,
> H.

> -- 
> Herv? Pag?s

> Program in Computational Biology
> Division of Public Health Sciences
> Fred Hutchinson Cancer Research Center
> 1100 Fairview Ave. N, M1-B514
> P.O. Box 19024
> Seattle, WA 98109-1024

> E-mail: hpages at fredhutch.org
> Phone:  (206) 667-5791
> Fax:    (206) 667-1319

> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From tom@@@k@liber@ @ending from gm@il@com  Wed Jul 18 17:24:12 2018
From: tom@@@k@liber@ @ending from gm@il@com (Tomas Kalibera)
Date: Wed, 18 Jul 2018 17:24:12 +0200
Subject: [Rd] base::mean not consistent about NA/NaN
In-Reply-To: <CAOO9MKX+NxqRVL=+9iHg0TQi275PzJ99zUTzp5=kLKve1PAL-g@mail.gmail.com>
References: <CAOO9MKXXtUm=XJc-Wb7k=1ah5yheP-KMfFS3rQKZc7o6GfQF=w@mail.gmail.com>
 <339fdae8e2a3431c9773b51e2ac93ab9@AM6PR04MB4264.eurprd04.prod.outlook.com>
 <CANVKczPSN6NRVJkwnq3+=RmCxcgQ5OiZAWDoR4qQmNyUeD-PKQ@mail.gmail.com>
 <CAOO9MKX+NxqRVL=+9iHg0TQi275PzJ99zUTzp5=kLKve1PAL-g@mail.gmail.com>
Message-ID: <44f1c63a-b0ab-c485-6981-3023a5ff5c25@gmail.com>

Yes, the performance overhead of fixing this at R level would be too 
large and it would complicate the code significantly. The result of 
binary operations involving NA and NaN is hardware dependent (the 
propagation of NaN payload) - on some hardware, it actually works the 
way we would like - NA is returned - but on some hardware you get NaN or 
sometimes NA and sometimes NaN. Also there are C compiler optimizations 
re-ordering code, as mentioned in ?NaN. Then there are also external 
numerical libraries that do not distinguish NA from NaN (NA is an R 
concept). So I am afraid this is unfixable. The disclaimer mentioned by 
Duncan is in ?NaN/?NA, which I think is ok - there are so many numerical 
functions through which one might run into these problems that it would 
be infeasible to document them all. Some functions in fact will preserve 
NA, and we would not let NA turn into NaN unnecessarily, but the 
disclaimer says it is something not to depend on.

Tomas

On 07/03/2018 11:12 AM, Jan Gorecki wrote:
> Thank you for interesting examples.
> I would find useful to document this behavior also in `?mean`, while `+`
> operator is also affected, the `sum` function is not.
> For mean, NA / NaN could be handled in loop in summary.c. I assume that
> performance penalty of fix is the reason why this inconsistency still
> exists.
> Jan
>
> On Mon, Jul 2, 2018 at 8:28 PM, Barry Rowlingson <
> b.rowlingson at lancaster.ac.uk> wrote:
>
>> And for a starker example of this (documented) inconsistency,
>> arithmetic addition is not commutative:
>>
>>   > NA + NaN
>>   [1] NA
>>   > NaN + NA
>>   [1] NaN
>>
>>
>>
>> On Mon, Jul 2, 2018 at 5:32 PM, Duncan Murdoch <murdoch.duncan at gmail.com>
>> wrote:
>>> On 02/07/2018 11:25 AM, Jan Gorecki wrote:
>>>> Hi,
>>>> base::mean is not consistent in terms of handling NA/NaN.
>>>> Mean should not depend on order of its arguments while currently it is.
>>> The result of mean() can depend on the order even with regular numbers.
>>> For example,
>>>
>>>   > x <- rep(c(1, 10^(-15)), 1000000)
>>>   > mean(sort(x)) - 0.5
>>> [1] 5.551115e-16
>>>   > mean(rev(sort(x))) - 0.5
>>> [1] 0
>>>
>>>
>>>>       mean(c(NA, NaN))
>>>>       #[1] NA
>>>>       mean(c(NaN, NA))
>>>>       #[1] NaN
>>>>
>>>> I created issue so in case of no replies here status of it can be
>> looked up
>>>> at:
>>>> https://bugs.r-project.org/bugzilla/show_bug.cgi?id=17441
>>> The help page for ?NaN says,
>>>
>>> "Computations involving NaN will return NaN or perhaps NA: which of
>>> those two is not guaranteed and may depend on the R platform (since
>>> compilers may re-order computations)."
>>>
>>> And ?NA says,
>>>
>>> "Numerical computations using NA will normally result in NA: a possible
>>> exception is where NaN is also involved, in which case either might
>>> result (which may depend on the R platform). "
>>>
>>> So I doubt if this inconsistency will be fixed.
>>>
>>> Duncan Murdoch
>>>
>>>> Best,
>>>> Jan
>>>>
>>>>        [[alternative HTML version deleted]]
>>>>
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From btyner @ending from gm@il@com  Thu Jul 19 02:22:30 2018
From: btyner @ending from gm@il@com (Benjamin Tyner)
Date: Wed, 18 Jul 2018 20:22:30 -0400
Subject: [Rd] missing news entry?
Message-ID: <dbdf74b2-53a3-9624-996b-2766f5c49c86@gmail.com>

Hi,

Unless I am mistaken, this enhancement to gc():

------------------------------------------------------------------------
r73749 | luke | 2017-11-18 13:26:25 -0500 (Sat, 18 Nov 2017) | 2 lines

Added 'full' argument to gc() with default 'TRUE' for now.

------------------------------------------------------------------------

appears to be lacking an entry in doc/NEWS.Rd. Just FYI, in case there 
is capacity to add one.

Regards

Ben


From d@tr7320 @ending from uni@@ydney@edu@@u  Thu Jul 19 10:00:08 2018
From: d@tr7320 @ending from uni@@ydney@edu@@u (Dario Strbenac)
Date: Thu, 19 Jul 2018 08:00:08 +0000
Subject: [Rd] Library lib.loc Option Ignored for Dependencies
Message-ID: <SYAPR01MB25584DFE469B02994EFBEA10CD520@SYAPR01MB2558.ausprd01.prod.outlook.com>

Good day,

If there's a library folder of the latest R packages and a particular package from it is loaded using the lib.loc option, the dependencies of that package are still attempted to be loaded from another folder of older packages specified by R_LIBS, which may cause errors about version requirements not being met. The documentation of the library function doesn't explain what the intended result is in such a case, but it could reasonably be expected that R would also load the dependencies from the user-specified lib.loc folder.

--------------------------------------
Dario Strbenac
University of Sydney
Camperdown NSW 2050
Australia


From m@echler @ending from @t@t@m@th@ethz@ch  Thu Jul 19 11:27:19 2018
From: m@echler @ending from @t@t@m@th@ethz@ch (Martin Maechler)
Date: Thu, 19 Jul 2018 11:27:19 +0200
Subject: [Rd] problem with display of complex number
In-Reply-To: <CAJqeyYbp9fqJSx6KrgEx9Q_WOSKF5Sr6a2CBYD+Jsf1fm6cVQQ@mail.gmail.com>
References: <CAJqeyYbp9fqJSx6KrgEx9Q_WOSKF5Sr6a2CBYD+Jsf1fm6cVQQ@mail.gmail.com>
Message-ID: <23376.22903.680729.630526@stat.math.ethz.ch>

TL;DR :  It's more complicated and needs more discussion
      	 (which I start below)

> Hi,
> > 1e10+5i
> [1] 1e+10+0e+00i
> > Im(1e10+5i)
> [1] 5
> 
> maybe little better...
> 
> --- R-3.5.1.orig/src/main/complex.c    2018-03-26 07:02:25.000000000 +0900
> +++ R-3.5.1/src/main/complex.c    2018-07-10 12:50:42.523874767 +0900
> @@ -381,6 +381,7 @@
>      r->i = fround(pow10 * x->i, digits)/pow10;
>      } else {
>      digits = (double)(dig);
> +    if(digits < 1) digits=1; /* a little better */
>      r->r = fround(x->r, digits);
>      r->i = fround(x->i, digits);
>      }
> 
> 
> -- 
> Best Regards,
> -- 
> Eiji NAKAMA <nakama (a) ki.rim.or.jp>
> "\u4e2d\u9593\u6804\u6cbb"  <nakama (a) ki.rim.or.jp>

Thanks a lot, Eiji!
Yes, your proposed change does  "prevent the worst", in this
case, however it is more complicated.

I do think the current display {i.e., format(), as.character(),..}, 
of such complex numbers is far from optimal, not only in the example
you show above but also more generally, when the real and
complex parts of the complex vector(s) are of different magnitude.

If only the Mod(z) of the complex number z was of importance, one
could argue that indeed it makes sense to use the same format
for the real and imaginary parts; this is however not always the
case, and rather the Re(z) and/or Im(z) are of interest in
themselves.  For such cases, the current formatting of complex
numbers is unfortunate also in my view.

I've checked other systems:
  1) octave, matlab, python
  2) mathematica, maple

and they all format Re() and Im() separately, and I think we
should do.


However, we have "known" about this for a long time 
In R/tests/reg-tests-2.Rout.save, line 5641 ff, we have had,
from svn c39481 | 2006-09-22 ), log 'tweak printing of complex numbers' ,

    > ## printing of complex numbers of very different magnitudes
    > 1e100  + 1e44i
    [1] 1e+100+0e+00i
    > 1e100 + pi*1i*10^(c(-100,0,1,40,100))
    [1] 1e+100+ 0.000000e+00i 1e+100+ 0.000000e+00i 1e+100+ 0.000000e+00i
    [4] 1e+100+ 0.000000e+00i 1e+100+3.141593e+100i
    > ## first was silly, second not rounded correctly in 2.2.0 - 2.3.1
    > ## We don't get them lining up, but that is a printf issue
    > ## that only happens for very large complex nos.
    > 
    > 
    > ### end of tests added in 2.4.0 ###

and with your change the output of the above example also
changes.

I now found more history:
The fundamental changes is indeed from 2005,  for  R 2.2.0 :

------------------------------------------------------------------------
r35253 | ripley | 2005-08-11 18:34:24 +0200 (Thu, 11 Aug 2005) | 2 lines
Changed paths:
   M NEWS
   M src/main/complex.c
   M src/main/format.c
   M tests/arith.R
   M tests/arith.Rout.save
   M tests/complex.R
   M tests/complex.Rout.save
   M tests/print-tests.Rout.save

enhance printing of complex numbers to use pairs together.
---------------------------------------------------------------

where the NEWS entry (now in  <R>/doc/NEWS.2 )  has been 

    o	The printing of complex numbers has changed, handling numbers
	as a whole rather than in two parts.  So both real and
	imaginary parts are shown to the same accuracy, with the
	'digits' parameter referring to the accuracy of the larger
	component, and both components are shown in fixed or
	scientific notation (unless one is entirely zero when it is
	always shown in fixed notation).

There was a bug in the implementation on which Robin Hankin
wrote about year later in a thread on R-devel :

  https://stat.ethz.ch/pipermail/r-devel/2006-September/042792.html

where Brian Ripley mentioned the (above, not the buggy one)
behavior as "by design", and Robin then also found and mentioned
the above entry. ... and notably the above regression test was
added after the bug fix also in Sept. 2006.

Apart from that NEWS entry (now basically only visible in the
source code), the only documentation about this behavior, is the
one sentence in the  ?signif  help page

  "Complex numbers are rounded to retain the specified number
   of digits in the larger of the components"

And where this does make (some) sense for
    signif(<complex>, digits),

it seems wrong to me (and you) for format() and print()  and
I think we should reconsider using it when format()ing  complex
numbers.

Note that your proposed change does change the z_prec_r()
function which in fact *is* used for signif(<complex>), and so
your change also does affect signif(<complex>) which I think is
more than I'd want here.

For instance, it would change the following (regression test in
tests/complex.R )

> signif(1.678932e80+0i, 5)
[1] 1.678932e+80+0i
>

instead of really showing 5 digits for the real part as it does
now :

[1] 1.6789e+80+0i

---------------------

I'm proposing to reconsider and change such that

1) print() {and auto-print} and format() of complex numbers should
   treat Re() and Im() separately, and identically to how double()
   are print()ed / format()ted in such case, notably, using
   'digits' to both parts "separately".

2) We can and probably should keep signif(<complex>)'s  behavior
   as current,  as that has been documented to behave as it does
   for almost 13 years.

Martin


From @h@bbychef @ending from gm@il@com  Fri Jul 20 06:51:07 2018
From: @h@bbychef @ending from gm@il@com (steven pav)
Date: Thu, 19 Jul 2018 21:51:07 -0700
Subject: [Rd] Should there be a confint.mlm ?
Message-ID: <CAM9gkkX4_vd7DKGxCs_hFYDQ2oK1MUoBeuedg7XdtWkmbp=N-w@mail.gmail.com>

It seems that confint.default returns an empty data.frame for objects of
class mlm. For example:

```
nobs <- 20
set.seed(1234)
# some fake data
datf <-
data.frame(x1=rnorm(nobs),x2=runif(nobs),y1=rnorm(nobs),y2=rnorm(nobs))
fitm <- lm(cbind(y1,y2) ~ x1 + x2,data=datf)
confint(fitm)
# returns:
     2.5 % 97.5 %
```

I have seen proposed workarounds on stackoverflow and elsewhere, but
suspect this should be fixed in the stats package. A proposed
implementation would be:

```
# I need this to run the code, but stats does not:
format.perc <- stats:::format.perc

# compute confidence intervals for mlm object.
confint.mlm <- function (object, level = 0.95, ...) {
  cf <- coef(object)
  ncfs <- as.numeric(cf)
  a <- (1 - level)/2
  a <- c(a, 1 - a)
  fac <- qt(a, object$df.residual)
  pct <- format.perc(a, 3)
  ses <- sqrt(diag(vcov(object)))
  ci <- ncfs + ses %o% fac
  setNames(data.frame(ci),pct)
}

# returning to the example above,
confint(fitm)
# returns:
                 2.5 % 97.5 %
y1:(Intercept) -1.2261 0.7037
y1:x1          -0.5100 0.2868
y1:x2          -2.7554 0.8736
y2:(Intercept) -0.6980 2.2182
y2:x1          -0.6162 0.5879
y2:x2          -3.9724 1.5114
```




-- 

--sep

	[[alternative HTML version deleted]]


From m@echler @ending from @t@t@m@th@ethz@ch  Fri Jul 20 18:06:46 2018
From: m@echler @ending from @t@t@m@th@ethz@ch (Martin Maechler)
Date: Fri, 20 Jul 2018 18:06:46 +0200
Subject: [Rd] Should there be a confint.mlm ?
In-Reply-To: <CAM9gkkX4_vd7DKGxCs_hFYDQ2oK1MUoBeuedg7XdtWkmbp=N-w@mail.gmail.com>
References: <CAM9gkkX4_vd7DKGxCs_hFYDQ2oK1MUoBeuedg7XdtWkmbp=N-w@mail.gmail.com>
Message-ID: <23378.2198.168453.222329@stat.math.ethz.ch>

>>>>> steven pav 
>>>>>     on Thu, 19 Jul 2018 21:51:07 -0700 writes:

    > It seems that confint.default returns an empty data.frame
    > for objects of class mlm. For example:

> It seems that confint.default returns an empty data.frame for objects of
> class mlm.

Not quite: Note that 'mlm' objects are also 'lm' objects, and so
it is confint.lm() which is called here and fails.

> For example:
> 
> ```
> nobs <- 20
> set.seed(1234)
> # some fake data
> datf <-
> data.frame(x1=rnorm(nobs),x2=runif(nobs),y1=rnorm(nobs),y2=rnorm(nobs))
> fitm <- lm(cbind(y1,y2) ~ x1 + x2,data=datf)
> confint(fitm)
> # returns:
>      2.5 % 97.5 %
> ```
> 
> I have seen proposed workarounds on stackoverflow and elsewhere, but
> suspect this should be fixed in the stats package. 

I agree.
It may be nicer to tweak  confint.lm() instead though.

I'm looking into doing that.

> A proposed implementation would be:
> 
> ```
> # I need this to run the code, but stats does not:
> format.perc <- stats:::format.perc

or better (mainly for esthetical reasons), use

  environment(confint.mlm) <- asNamespace("stats")

after defining  confint.mlm [below]

> # compute confidence intervals for mlm object.
> confint.mlm <- function (object, level = 0.95, ...) {
>   cf <- coef(object)
>   ncfs <- as.numeric(cf)
>   a <- (1 - level)/2
>   a <- c(a, 1 - a)
>   fac <- qt(a, object$df.residual)
>   pct <- format.perc(a, 3)
>   ses <- sqrt(diag(vcov(object)))
           ^^^^^^^^^^^^^^^^^^^^^^^^
BTW --- and this is a diversion ---  This is nice mathematically
    (and used in other places, also in "base R" I think)
but in principle is a waste:  Computing a full 
k x k matrix and then throwing away all but the length-k
diagonal ...
In the past I had contemplated but never RFC'ed or really
implemented a stderr() generic with default method

   stderr.default <- function(object) sqrt(diag(vcov(object)))

but allow non-default methods to be smarter and hence more efficient.

>   ci <- ncfs + ses %o% fac
>   setNames(data.frame(ci),pct)
> }
> 
> # returning to the example above,
> confint(fitm)
> # returns:
>                  2.5 % 97.5 %
> y1:(Intercept) -1.2261 0.7037
> y1:x1          -0.5100 0.2868
> y1:x2          -2.7554 0.8736
> y2:(Intercept) -0.6980 2.2182
> y2:x1          -0.6162 0.5879
> y2:x2          -3.9724 1.5114
> ```

I'm looking into a relatively small patch to confint.lm()
*instead* of the confint.mlm() above

Thank you very much, Steven, for your proposal!
I will let you (and the R-devel audience) know the outcome.

Best regards,
Martin Maechler
ETH Zurich  and  R Core Team

> -- 
> 
> --sep
> 
> 	[[alternative HTML version deleted]]
>


From ru@@ell-lenth @ending from uiow@@edu  Sat Jul 21 00:05:54 2018
From: ru@@ell-lenth @ending from uiow@@edu (Lenth, Russell V)
Date: Fri, 20 Jul 2018 22:05:54 +0000
Subject: [Rd] Model formulas with explicit references
Message-ID: <DM6PR04MB4380B2B4CD35DA6FEF91A8BCF1510@DM6PR04MB4380.namprd04.prod.outlook.com>

Dear R-Devel,

I seem to no longer be able to access the bug-reporting system, so am doing this by e-mail.

My report concerns models where variables are explicitly referenced (or is it "dereferenced"?), such as:

    cars.lm <- lm(mtcars[[1]] ~ factor(mtcars$cyl) + mtcars[["disp"]])

I have found that it is not possible to predict such models with new data. For example:

> predict(cars.lm, newdata = mtcars[1:5, )
       1        2        3        4        5        6        7        8        9       10 
20.37954 20.37954 26.58543 17.70329 14.91157 18.60448 14.91157 25.52859 25.68971 20.17199 
      11       12       13       14       15       16       17       18       19       20 
20.17199 17.21096 17.21096 17.21096 11.85300 12.18071 12.72688 27.38558 27.46750 27.59312 
      21       22       23       24       25       26       27       28       29       30 
26.25500 16.05853 16.44085 15.18466 13.81922 27.37738 26.24954 26.93772 15.15735 20.78917 
      31       32 
16.52278 26.23042 
Warning message:
'newdata' had 5 rows but variables found have 32 rows 

Instead of returning 5 predictions, it returns the 32 original predicted values. There is a warning message suggesting that something went wrong. This tickled my curiosity, and hance this result:

> predict(cars.lm, newdata = data.frame(x = 1:32))
       1        2        3        4        5        6        7        8        9       10 
20.37954 20.37954 26.58543 17.70329 14.91157 18.60448 14.91157 25.52859 25.68971 20.17199 
      11       12       13       14       15       16       17       18       19       20 
20.17199 17.21096 17.21096 17.21096 11.85300 12.18071 12.72688 27.38558 27.46750 27.59312 
      21       22       23       24       25       26       27       28       29       30 
26.25500 16.05853 16.44085 15.18466 13.81922 27.37738 26.24954 26.93772 15.15735 20.78917 
      31       32 
16.52278 26.23042

Again, the new data are ignored, but there is no warning message, because the previous warning was based only on a discrepancy with the number of rows and the number of predictions. Indeed, the new data set makes no sense at all in the context of this model.

At the root of this behavior is the fact that the model.frame function ignores its data argument with such models. So instead of constructing a new frame based on the new data, it just returns the original model frame.

I am not really suggesting that you try to make these things work with models when the formula is like this. Instead, I am hoping that it throws an actual error message rather than just a warning, and that you be a little bit more sophisticated than merely checking the number of rows. Both predict() with newdata provided, and model.frame() with a data argument, should return an informative error message that says that model formulas like this are not supported with new data. Here is what appears to be an easy way to check:

> get_all_vars(terms(cars.lm))
Error in eval(inp, data, env) : object 'cyl' not found


Thanks

Russ

Russell V. Lenth? -? Professor Emeritus
Department of Statistics and Actuarial Science
The University of Iowa ?-? Iowa City, IA 52242? USA?
Voice (319)335-0712 (Dept. office)? -? FAX (319)335-3017


From btyner @ending from gm@il@com  Sat Jul 21 01:42:09 2018
From: btyner @ending from gm@il@com (Benjamin Tyner)
Date: Fri, 20 Jul 2018 19:42:09 -0400
Subject: [Rd] Library lib.loc Option Ignored for Dependencies
In-Reply-To: <SYAPR01MB25584DFE469B02994EFBEA10CD520@SYAPR01MB2558.ausprd01.prod.outlook.com>
References: <SYAPR01MB25584DFE469B02994EFBEA10CD520@SYAPR01MB2558.ausprd01.prod.outlook.com>
Message-ID: <eebc4452-4bdb-d6d3-b438-dea208ab14b8@gmail.com>

Here's a trick/workaround; if lib.loc is the path to your library, then 
prior to calling library(),

 > environment(.libPaths)$.lib.loc <- lib.loc

> ------------------------------------------------------------------------
> Good day,
>
> If there's a library folder of the latest R packages and a particular package from it is loaded using the lib.loc option, the dependencies of that package are still attempted to be loaded from another folder of older packages specified by R_LIBS, which may cause errors about version requirements not being met. The documentation of the library function doesn't explain what the intended result is in such a case, but it could reasonably be expected that R would also load the dependencies from the user-specified lib.loc folder.
>
> --------------------------------------
> Dario Strbenac
> University of Sydney
> Camperdown NSW 2050
> Australia
>


From j@gorecki @ending from wit@edu@pl  Fri Jul 20 21:52:25 2018
From: j@gorecki @ending from wit@edu@pl (Jan Gorecki)
Date: Fri, 20 Jul 2018 22:52:25 +0300
Subject: [Rd] base::mean not consistent about NA/NaN
In-Reply-To: <44f1c63a-b0ab-c485-6981-3023a5ff5c25@gmail.com>
References: <CAOO9MKXXtUm=XJc-Wb7k=1ah5yheP-KMfFS3rQKZc7o6GfQF=w@mail.gmail.com>
 <339fdae8e2a3431c9773b51e2ac93ab9@AM6PR04MB4264.eurprd04.prod.outlook.com>
 <CANVKczPSN6NRVJkwnq3+=RmCxcgQ5OiZAWDoR4qQmNyUeD-PKQ@mail.gmail.com>
 <CAOO9MKX+NxqRVL=+9iHg0TQi275PzJ99zUTzp5=kLKve1PAL-g@mail.gmail.com>
 <44f1c63a-b0ab-c485-6981-3023a5ff5c25@gmail.com>
Message-ID: <CAOO9MKVV2hbNKk7h5V3SPWR07DSUPD_JKiWX7ajxrUskUNc1FQ@mail.gmail.com>

Thank you Tomas for detailed explanation. Such a nice description deserves
to be included somewhere in documentation, R-internals maybe.
Regards
Jan

On 18 Jul 2018 18:24, "Tomas Kalibera" <tomas.kalibera at gmail.com> wrote:

Yes, the performance overhead of fixing this at R level would be too
large and it would complicate the code significantly. The result of
binary operations involving NA and NaN is hardware dependent (the
propagation of NaN payload) - on some hardware, it actually works the
way we would like - NA is returned - but on some hardware you get NaN or
sometimes NA and sometimes NaN. Also there are C compiler optimizations
re-ordering code, as mentioned in ?NaN. Then there are also external
numerical libraries that do not distinguish NA from NaN (NA is an R
concept). So I am afraid this is unfixable. The disclaimer mentioned by
Duncan is in ?NaN/?NA, which I think is ok - there are so many numerical
functions through which one might run into these problems that it would
be infeasible to document them all. Some functions in fact will preserve
NA, and we would not let NA turn into NaN unnecessarily, but the
disclaimer says it is something not to depend on.


Tomas


On 07/03/2018 11:12 AM, Jan Gorecki wrote:
> Thank you for interesting examples.
> I would find useful to document this behavior also in `?mean`, while `+`
> operator is also affected, the `sum` function is not.
> For mean, NA / NaN could be handled in loop in summary.c. I assume that
> performance penalty of fix is the reason why this inconsistency still
> exists.
> Jan
>
> On Mon, Jul 2, 2018 at 8:28 PM, Barry Rowlingson <
> b.rowlingson at lancaster.ac.uk> wrote:
>
>> And for a starker example of this (documented) inconsistency,
>> arithmetic addition is not commutative:
>>
>>   > NA + NaN
>>   [1] NA
>>   > NaN + NA
>>   [1] NaN
>>
>>
>>
>> On Mon, Jul 2, 2018 at 5:32 PM, Duncan Murdoch <murdoch.duncan at gmail.com>
>> wrote:
>>> On 02/07/2018 11:25 AM, Jan Gorecki wrote:
>>>> Hi,
>>>> base::mean is not consistent in terms of handling NA/NaN.
>>>> Mean should not depend on order of its arguments while currently it is.
>>> The result of mean() can depend on the order even with regular numbers.
>>> For example,
>>>
>>>   > x <- rep(c(1, 10^(-15)), 1000000)
>>>   > mean(sort(x)) - 0.5
>>> [1] 5.551115e-16
>>>   > mean(rev(sort(x))) - 0.5
>>> [1] 0
>>>
>>>
>>>>       mean(c(NA, NaN))
>>>>       #[1] NA
>>>>       mean(c(NaN, NA))
>>>>       #[1] NaN
>>>>
>>>> I created issue so in case of no replies here status of it can be
>> looked up
>>>> at:
>>>> https://bugs.r-project.org/bugzilla/show_bug.cgi?id=17441
>>> The help page for ?NaN says,
>>>
>>> "Computations involving NaN will return NaN or perhaps NA: which of
>>> those two is not guaranteed and may depend on the R platform (since
>>> compilers may re-order computations)."
>>>
>>> And ?NA says,
>>>
>>> "Numerical computations using NA will normally result in NA: a possible
>>> exception is where NaN is also involved, in which case either might
>>> result (which may depend on the R platform). "
>>>
>>> So I doubt if this inconsistency will be fixed.
>>>
>>> Duncan Murdoch
>>>
>>>> Best,
>>>> Jan
>>>>
>>>>        [[alternative HTML version deleted]]
>>>>
>>>> ______________________________________________
>>>> R-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>       [[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

	[[alternative HTML version deleted]]


From m@echler @ending from @t@t@m@th@ethz@ch  Sat Jul 21 18:34:26 2018
From: m@echler @ending from @t@t@m@th@ethz@ch (Martin Maechler)
Date: Sat, 21 Jul 2018 18:34:26 +0200
Subject: [Rd] Library lib.loc Option Ignored for Dependencies
In-Reply-To: <eebc4452-4bdb-d6d3-b438-dea208ab14b8@gmail.com>
References: <SYAPR01MB25584DFE469B02994EFBEA10CD520@SYAPR01MB2558.ausprd01.prod.outlook.com>
 <eebc4452-4bdb-d6d3-b438-dea208ab14b8@gmail.com>
Message-ID: <23379.24722.804755.262952@stat.math.ethz.ch>

>>>>> Benjamin Tyner 
>>>>>     on Fri, 20 Jul 2018 19:42:09 -0400 writes:

    > Here's a trick/workaround; if lib.loc is the path to your
    > library, then prior to calling library(),

    >> environment(.libPaths)$.lib.loc <- lib.loc

Well, that is quite a "trick"  -- and potentially a pretty
dangerous one, not intended when making .libPaths a closure ....


I do think that there is a problem with R's dealing of R_LIBS
and other libPaths settings, notably when checking packages and
within that recompiling vignettes etc, where the R process
starts new versions of R via system() / system2() and then gets
to wrong .libPaths() settings,
and I personally would be very happy if we got reprex'es with
small fake packages -- possibly only easily reproducible on
unix-alikes ... so we could address this as a bug (or more than
one) to be fixed.

Notably with the 3.4.x --> 3.5.0 transition and my/our tendency
of having quite a few paths in R_LIBS / lib.loc / ... I've been
bitten by problems when the wrong version of package was taken
from the wrong library path ....

Martin


    >> ------------------------------------------------------------------------
    >> Good day,
    >> 
    >> If there's a library folder of the latest R packages and
    >> a particular package from it is loaded using the lib.loc
    >> option, the dependencies of that package are still
    >> attempted to be loaded from another folder of older
    >> packages specified by R_LIBS, which may cause errors
    >> about version requirements not being met. The
    >> documentation of the library function doesn't explain
    >> what the intended result is in such a case, but it could
    >> reasonably be expected that R would also load the
    >> dependencies from the user-specified lib.loc folder.
    >> 
    >> --------------------------------------
    >> Dario Strbenac University of Sydney Camperdown NSW 2050
    >> Australia


From ccberry @ending from uc@d@edu  Sat Jul 21 19:02:22 2018
From: ccberry @ending from uc@d@edu (Berry, Charles)
Date: Sat, 21 Jul 2018 17:02:22 +0000
Subject: [Rd] Model formulas with explicit references
In-Reply-To: <DM6PR04MB4380B2B4CD35DA6FEF91A8BCF1510@DM6PR04MB4380.namprd04.prod.outlook.com>
References: <DM6PR04MB4380B2B4CD35DA6FEF91A8BCF1510@DM6PR04MB4380.namprd04.prod.outlook.com>
Message-ID: <9EEBB2E0-97DF-4902-B0BA-9578E5824B30@ucsd.edu>



> On Jul 20, 2018, at 3:05 PM, Lenth, Russell V <russell-lenth at uiowa.edu> wrote:
> 
> Dear R-Devel,
> 
> I seem to no longer be able to access the bug-reporting system, so am doing this by e-mail.
> 
> My report concerns models where variables are explicitly referenced (or is it "dereferenced"?), such as:
> 
>    cars.lm <- lm(mtcars[[1]] ~ factor(mtcars$cyl) + mtcars[["disp"]])
> 
> I have found that it is not possible to predict such models with new data. For example:
> 
>> predict(cars.lm, newdata = mtcars[1:5, )
>       1        2        3        4        5        6        7        8        9       10 
> 20.37954 20.37954 26.58543 17.70329 14.91157 18.60448 14.91157 25.52859 25.68971 20.17199 
>      11       12       13       14       15       16       17       18       19       20 
> 20.17199 17.21096 17.21096 17.21096 11.85300 12.18071 12.72688 27.38558 27.46750 27.59312 
>      21       22       23       24       25       26       27       28       29       30 
> 26.25500 16.05853 16.44085 15.18466 13.81922 27.37738 26.24954 26.93772 15.15735 20.78917 
>      31       32 
> 16.52278 26.23042 
> Warning message:
> 'newdata' had 5 rows but variables found have 32 rows 
> 
> Instead of returning 5 predictions, it returns the 32 original predicted values. There is a warning message suggesting that something went wrong. This tickled my curiosity, and hance this result:
> 
>> predict(cars.lm, newdata = data.frame(x = 1:32))
>       1        2        3        4        5        6        7        8        9       10 
> 20.37954 20.37954 26.58543 17.70329 14.91157 18.60448 14.91157 25.52859 25.68971 20.17199 
>      11       12       13       14       15       16       17       18       19       20 
> 20.17199 17.21096 17.21096 17.21096 11.85300 12.18071 12.72688 27.38558 27.46750 27.59312 
>      21       22       23       24       25       26       27       28       29       30 
> 26.25500 16.05853 16.44085 15.18466 13.81922 27.37738 26.24954 26.93772 15.15735 20.78917 
>      31       32 
> 16.52278 26.23042
> 
> Again, the new data are ignored, but there is no warning message, because the previous warning was based only on a discrepancy with the number of rows and the number of predictions. Indeed, the new data set makes no sense at all in the context of this model.
> 
> At the root of this behavior is the fact that the model.frame function ignores its data argument with such models. So instead of constructing a new frame based on the new data, it just returns the original model frame.
> 

This produces what I think you intended:

> predict(cars.lm, newdata = list(mtcars=mtcars[1:5,]) )
       1        2        3        4        5 
20.37954 20.37954 26.58543 17.70329 14.91157 
>


> I am not really suggesting that you try to make these things work with models when the formula is like this. Instead, I am hoping that it throws an actual error message rather than just a warning, and that you be a little bit more sophisticated than merely checking the number of rows. Both predict() with newdata provided, and model.frame() with a data argument, should return an informative error message that says that model formulas like this are not supported with new data.

As you can see they are supported, but you have to make sure that the objects in the formula can be found in the newdata arg. If this is puzzling, try 

debugonce(predict.lm)
predict(cars.lm, newdata = mtcars[1:5, )

and inspect the newdata object and terms(object). You should see why the terms in the formula are not found in newdata.

If you  think that something like your idiom for formula is required, maybe you should  repost on r-help and say what you are trying to do with it.  I expect you'll get some advice on how to reformulate your call.

HTH,

Chuck

From btyner @ending from gm@il@com  Sat Jul 21 19:42:43 2018
From: btyner @ending from gm@il@com (Benjamin Tyner)
Date: Sat, 21 Jul 2018 13:42:43 -0400
Subject: [Rd] Library lib.loc Option Ignored for Dependencies
In-Reply-To: <23379.24722.804755.262952@stat.math.ethz.ch>
References: <SYAPR01MB25584DFE469B02994EFBEA10CD520@SYAPR01MB2558.ausprd01.prod.outlook.com>
 <eebc4452-4bdb-d6d3-b438-dea208ab14b8@gmail.com>
 <23379.24722.804755.262952@stat.math.ethz.ch>
Message-ID: <235f764d-fe20-e2cd-86a3-15bb14e0ca11@gmail.com>

Not sure whether it is the same issue as was raised here:

https://stat.ethz.ch/pipermail/r-devel/2010-October/058729.html

but in any case perhaps the problem could partially be remedied on line 
245 of src/library/base/R/library.R by passing the lib.loc to 
.getRequiredPackages2() ...here is a patch (untested)

Index: src/library/base/R/library.R
===================================================================
--- src/library/base/R/library.R??? (revision 74997)
+++ src/library/base/R/library.R??? (working copy)
@@ -242,7 +242,7 @@
 ???????????????????? pos <- 2
 ???????????????? } else pos <- npos
 ???????????? }
-??????????? .getRequiredPackages2(pkgInfo, quietly = quietly)
+??????????? .getRequiredPackages2(pkgInfo, lib.loc = lib.loc, quietly = 
quietly)
 ???????????? deps <- unique(names(pkgInfo$Depends))

 ???????????? ## If the namespace mechanism is available and the package


On 07/21/2018 12:34 PM, Martin Maechler wrote:
>>>>>> Benjamin Tyner
>>>>>>      on Fri, 20 Jul 2018 19:42:09 -0400 writes:
>      > Here's a trick/workaround; if lib.loc is the path to your
>      > library, then prior to calling library(),
>
>      >> environment(.libPaths)$.lib.loc <- lib.loc
>
> Well, that is quite a "trick"  -- and potentially a pretty
> dangerous one, not intended when making .libPaths a closure ....
>
>
> I do think that there is a problem with R's dealing of R_LIBS
> and other libPaths settings, notably when checking packages and
> within that recompiling vignettes etc, where the R process
> starts new versions of R via system() / system2() and then gets
> to wrong .libPaths() settings,
> and I personally would be very happy if we got reprex'es with
> small fake packages -- possibly only easily reproducible on
> unix-alikes ... so we could address this as a bug (or more than
> one) to be fixed.
>
> Notably with the 3.4.x --> 3.5.0 transition and my/our tendency
> of having quite a few paths in R_LIBS / lib.loc / ... I've been
> bitten by problems when the wrong version of package was taken
> from the wrong library path ....
>
> Martin
>
>
>      >> ------------------------------------------------------------------------
>      >> Good day,
>      >>
>      >> If there's a library folder of the latest R packages and
>      >> a particular package from it is loaded using the lib.loc
>      >> option, the dependencies of that package are still
>      >> attempted to be loaded from another folder of older
>      >> packages specified by R_LIBS, which may cause errors
>      >> about version requirements not being met. The
>      >> documentation of the library function doesn't explain
>      >> what the intended result is in such a case, but it could
>      >> reasonably be expected that R would also load the
>      >> dependencies from the user-specified lib.loc folder.
>      >>
>      >> --------------------------------------
>      >> Dario Strbenac University of Sydney Camperdown NSW 2050
>      >> Australia


From d@tr7320 @ending from uni@@ydney@edu@@u  Sun Jul 22 02:00:16 2018
From: d@tr7320 @ending from uni@@ydney@edu@@u (Dario Strbenac)
Date: Sun, 22 Jul 2018 00:00:16 +0000
Subject: [Rd] Library lib.loc Option Ignored for Dependencies
In-Reply-To: <235f764d-fe20-e2cd-86a3-15bb14e0ca11@gmail.com>
References: <SYAPR01MB25584DFE469B02994EFBEA10CD520@SYAPR01MB2558.ausprd01.prod.outlook.com>
 <eebc4452-4bdb-d6d3-b438-dea208ab14b8@gmail.com>
 <23379.24722.804755.262952@stat.math.ethz.ch>,
 <235f764d-fe20-e2cd-86a3-15bb14e0ca11@gmail.com>
Message-ID: <SYAPR01MB2558C24394B2BAF407C719F1CD500@SYAPR01MB2558.ausprd01.prod.outlook.com>

Good day,

Now that I read about Renaud's problem, I realise that it is effectively the same as mine.

--------------------------------------
Dario Strbenac
University of Sydney
Camperdown NSW 2050
Australia

From @h@bbychef @ending from gm@il@com  Sun Jul 22 06:58:41 2018
From: @h@bbychef @ending from gm@il@com (steven pav)
Date: Sat, 21 Jul 2018 21:58:41 -0700
Subject: [Rd] Should there be a confint.mlm ?
In-Reply-To: <23378.2198.168453.222329@stat.math.ethz.ch>
References: <CAM9gkkX4_vd7DKGxCs_hFYDQ2oK1MUoBeuedg7XdtWkmbp=N-w@mail.gmail.com>
 <23378.2198.168453.222329@stat.math.ethz.ch>
Message-ID: <CAM9gkkXPwvnSpPpeC7qxGYEzya5NwFYORD1YFuO14TtGVc-DEw@mail.gmail.com>

I would welcome the fixes suggested by Martin. I did not think my
implementation was pretty, but didn't want to suggest a bugfix without
submitting code.

Regarding the idea of a `stderr` function, I am all for potential
efficiency gains, but I suspect that in many situations `vcov` is the
result of a matrix inversion. This might mean an 'efficient computation of
only the diagonal of the inverse of a matrix' function would be required to
achieve widespread use. (I am not aware of the algorithm for that, but I am
ignorant.)

Again, thanks for patching `confint.lm`.


On Fri, Jul 20, 2018 at 9:06 AM, Martin Maechler <maechler at stat.math.ethz.ch
> wrote:

> >>>>> steven pav
> >>>>>     on Thu, 19 Jul 2018 21:51:07 -0700 writes:
>
>     > It seems that confint.default returns an empty data.frame
>     > for objects of class mlm. For example:
>
> > It seems that confint.default returns an empty data.frame for objects of
> > class mlm.
>
> Not quite: Note that 'mlm' objects are also 'lm' objects, and so
> it is confint.lm() which is called here and fails.
>
> > For example:
> >
> > ```
> > nobs <- 20
> > set.seed(1234)
> > # some fake data
> > datf <-
> > data.frame(x1=rnorm(nobs),x2=runif(nobs),y1=rnorm(nobs),y2=rnorm(nobs))
> > fitm <- lm(cbind(y1,y2) ~ x1 + x2,data=datf)
> > confint(fitm)
> > # returns:
> >      2.5 % 97.5 %
> > ```
> >
> > I have seen proposed workarounds on stackoverflow and elsewhere, but
> > suspect this should be fixed in the stats package.
>
> I agree.
> It may be nicer to tweak  confint.lm() instead though.
>
> I'm looking into doing that.
>
> > A proposed implementation would be:
> >
> > ```
> > # I need this to run the code, but stats does not:
> > format.perc <- stats:::format.perc
>
> or better (mainly for esthetical reasons), use
>
>   environment(confint.mlm) <- asNamespace("stats")
>
> after defining  confint.mlm [below]
>
> > # compute confidence intervals for mlm object.
> > confint.mlm <- function (object, level = 0.95, ...) {
> >   cf <- coef(object)
> >   ncfs <- as.numeric(cf)
> >   a <- (1 - level)/2
> >   a <- c(a, 1 - a)
> >   fac <- qt(a, object$df.residual)
> >   pct <- format.perc(a, 3)
> >   ses <- sqrt(diag(vcov(object)))
>            ^^^^^^^^^^^^^^^^^^^^^^^^
> BTW --- and this is a diversion ---  This is nice mathematically
>     (and used in other places, also in "base R" I think)
> but in principle is a waste:  Computing a full
> k x k matrix and then throwing away all but the length-k
> diagonal ...
> In the past I had contemplated but never RFC'ed or really
> implemented a stderr() generic with default method
>
>    stderr.default <- function(object) sqrt(diag(vcov(object)))
>
> but allow non-default methods to be smarter and hence more efficient.
>
> >   ci <- ncfs + ses %o% fac
> >   setNames(data.frame(ci),pct)
> > }
> >
> > # returning to the example above,
> > confint(fitm)
> > # returns:
> >                  2.5 % 97.5 %
> > y1:(Intercept) -1.2261 0.7037
> > y1:x1          -0.5100 0.2868
> > y1:x2          -2.7554 0.8736
> > y2:(Intercept) -0.6980 2.2182
> > y2:x1          -0.6162 0.5879
> > y2:x2          -3.9724 1.5114
> > ```
>
> I'm looking into a relatively small patch to confint.lm()
> *instead* of the confint.mlm() above
>
> Thank you very much, Steven, for your proposal!
> I will let you (and the R-devel audience) know the outcome.
>
> Best regards,
> Martin Maechler
> ETH Zurich  and  R Core Team
>
> > --
> >
> > --sep
> >
> >       [[alternative HTML version deleted]]
> >
>



-- 

--sep

	[[alternative HTML version deleted]]


From @theriel @ending from gm@il@com  Sun Jul 22 04:54:33 2018
From: @theriel @ending from gm@il@com (Aaron Jacobs)
Date: Sat, 21 Jul 2018 22:54:33 -0400
Subject: [Rd] R History: Why is there no importFrom() function?
Message-ID: <CAPncpof0FyXBh+p=SjGHPtcpQi=mS+TSZ+c0pWVMuak6Vy3oaQ@mail.gmail.com>

Excuse me if this is inappropriate content for this list, but I thought it
might be the best place -- and the best audience -- to ask about a design
decision for the R language.

Programs or analyses written in R typically use library() to pull in
functions from non-core packages. This differs markedly from most
languages*, which usually offer some way to selectively import symbols. For
example, in Python you'd see "from random import randint", and so on.

Within R packages, the NAMESPACE file provides this exact functionality
with the importFrom() directive, but the R language itself does not expose
this as a function for regular users.

I know that R did not have namespaces for some of its early existence, but
I'm curious as to why the language never acquired an import() or
importFrom() replacement for library() when it did get them. Was it purely
for compatibility with S and earlier R versions? Or was there a principled
difference of opinion on how R code should be written at stake?

Any insight from those of you familiar with R's history would be deeply
appreciated.

Regards,
Aaron

ps. I am aware of the very clever "import" package, which provides exactly
this feature -- I am more wondering why such an approach was never adopted
by the language itself.

* Most languages with real modules/namespaces, I mean.

	[[alternative HTML version deleted]]


From btyner @ending from gm@il@com  Sun Jul 22 14:47:45 2018
From: btyner @ending from gm@il@com (Benjamin Tyner)
Date: Sun, 22 Jul 2018 08:47:45 -0400
Subject: [Rd] Should there be a confint.mlm ?
In-Reply-To: <23378.2198.168453.222329@stat.math.ethz.ch>
References: <23378.2198.168453.222329@stat.math.ethz.ch>
Message-ID: <c088ddd2-9658-fd2c-9cb7-c7d8e6d5636a@gmail.com>

> BTW --- and this is a diversion ---  This is nice mathematically
>      (and used in other places, also in "base R" I think)
> but in principle is a waste:  Computing a full
> k x k matrix and then throwing away all but the length-k
> diagonal ...
> In the past I had contemplated but never RFC'ed or really
> implemented a stderr() generic with default method
>
>     stderr.default <- function(object) sqrt(diag(vcov(object)))
>
> but allow non-default methods to be smarter and hence more efficient.
>
A fine idea for sure, but perhaps use a different name in order to avoid 
conflicts with:

 > base::stderr
function ()
.Internal(stderr())
<bytecode: 0x32e1e98>
<environment: namespace:base>


From murdoch@dunc@n @ending from gm@il@com  Sun Jul 22 15:10:05 2018
From: murdoch@dunc@n @ending from gm@il@com (Duncan Murdoch)
Date: Sun, 22 Jul 2018 09:10:05 -0400
Subject: [Rd] R History: Why is there no importFrom() function?
In-Reply-To: <CAPncpof0FyXBh+p=SjGHPtcpQi=mS+TSZ+c0pWVMuak6Vy3oaQ@mail.gmail.com>
References: <CAPncpof0FyXBh+p=SjGHPtcpQi=mS+TSZ+c0pWVMuak6Vy3oaQ@mail.gmail.com>
Message-ID: <2b263bd8-c2d8-e56f-4314-fd3f2773021d@gmail.com>

On 21/07/2018 10:54 PM, Aaron Jacobs wrote:
> Excuse me if this is inappropriate content for this list, but I thought it
> might be the best place -- and the best audience -- to ask about a design
> decision for the R language.
> 
> Programs or analyses written in R typically use library() to pull in
> functions from non-core packages. This differs markedly from most
> languages*, which usually offer some way to selectively import symbols. For
> example, in Python you'd see "from random import randint", and so on.

I think there are two reasons.  First, the :: operator is so convenient. 
  If you really wanted "from random import randint" you could write

randint <- random::randint

but most people don't bother with the assignment, preferring to just 
work with random::randint in their code.

The second reason is that R encourages complex programs to be written as 
packages, which do have the importFrom() directive.  If you've got great 
big scripts where you would want to import certain functions and don't 
want the overhead of the package:: prefix, you're doing it wrong.

Duncan Murdoch


> 
> Within R packages, the NAMESPACE file provides this exact functionality
> with the importFrom() directive, but the R language itself does not expose
> this as a function for regular users.
> 
> I know that R did not have namespaces for some of its early existence, but
> I'm curious as to why the language never acquired an import() or
> importFrom() replacement for library() when it did get them. Was it purely
> for compatibility with S and earlier R versions? Or was there a principled
> difference of opinion on how R code should be written at stake?
> 
> Any insight from those of you familiar with R's history would be deeply
> appreciated.
> 
> Regards,
> Aaron
> 
> ps. I am aware of the very clever "import" package, which provides exactly
> this feature -- I am more wondering why such an approach was never adopted
> by the language itself.
> 
> * Most languages with real modules/namespaces, I mean.
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From l@wrence@mich@el @ending from gene@com  Sun Jul 22 15:13:09 2018
From: l@wrence@mich@el @ending from gene@com (Michael Lawrence)
Date: Sun, 22 Jul 2018 06:13:09 -0700
Subject: [Rd] R History: Why is there no importFrom() function?
In-Reply-To: <CAPncpof0FyXBh+p=SjGHPtcpQi=mS+TSZ+c0pWVMuak6Vy3oaQ@mail.gmail.com>
References: <CAPncpof0FyXBh+p=SjGHPtcpQi=mS+TSZ+c0pWVMuak6Vy3oaQ@mail.gmail.com>
Message-ID: <CAOQ5NycXw4uCnr8sqg4_0xjNAndty_jheANHN_EX3YEwmeXY5A@mail.gmail.com>

I can't speak to the history per se, but I can give an opinion on the
current situation. R is a programming language, as is Python, but R is
also a system for interactive data analysis. Outside of the
software/package context, library() is almost always sufficient. When
it is not, consider "foo <- package::foo". While not as well
structured as an importFrom() call, it does make the side effect
explicit. When that becomes onerous, it is probably past time to
transition to a package.

Michael

On Sat, Jul 21, 2018 at 7:54 PM, Aaron Jacobs <atheriel at gmail.com> wrote:
> Excuse me if this is inappropriate content for this list, but I thought it
> might be the best place -- and the best audience -- to ask about a design
> decision for the R language.
>
> Programs or analyses written in R typically use library() to pull in
> functions from non-core packages. This differs markedly from most
> languages*, which usually offer some way to selectively import symbols. For
> example, in Python you'd see "from random import randint", and so on.
>
> Within R packages, the NAMESPACE file provides this exact functionality
> with the importFrom() directive, but the R language itself does not expose
> this as a function for regular users.
>
> I know that R did not have namespaces for some of its early existence, but
> I'm curious as to why the language never acquired an import() or
> importFrom() replacement for library() when it did get them. Was it purely
> for compatibility with S and earlier R versions? Or was there a principled
> difference of opinion on how R code should be written at stake?
>
> Any insight from those of you familiar with R's history would be deeply
> appreciated.
>
> Regards,
> Aaron
>
> ps. I am aware of the very clever "import" package, which provides exactly
> this feature -- I am more wondering why such an approach was never adopted
> by the language itself.
>
> * Most languages with real modules/namespaces, I mean.
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From ru@@ell-lenth @ending from uiow@@edu  Sun Jul 22 22:12:42 2018
From: ru@@ell-lenth @ending from uiow@@edu (Lenth, Russell V)
Date: Sun, 22 Jul 2018 20:12:42 +0000
Subject: [Rd] Model formulas with explicit references
In-Reply-To: <9EEBB2E0-97DF-4902-B0BA-9578E5824B30@ucsd.edu>
References: <DM6PR04MB4380B2B4CD35DA6FEF91A8BCF1510@DM6PR04MB4380.namprd04.prod.outlook.com>
 <9EEBB2E0-97DF-4902-B0BA-9578E5824B30@ucsd.edu>
Message-ID: <DM6PR04MB438083FCB6960F425C86A4C9F1570@DM6PR04MB4380.namprd04.prod.outlook.com>

Chuck,

Thanks for your response. I am impressed to find out how to get 'newdata' to work with a model like this. I couldn't have figured that out from the documentation. The context is trying to write code for my emmeans package that supports whatever model the user gives it, even ones like my example. Since emmeans uses predictions, it stumbles on this kind of model specification. I may be able to work around it with the help you provided.

However, the real gist of my question is in the last part, where the call ' predict(cars.lm, newdata = data.frame(x = 1:32))' does NOT throw an error, or even a warning, even though the supplied 'newdata' is clearly inappropriate for this model. This is not the way 'predict' behaves if the model has plain names:

> nicecars.lm <- lm(mpg ~ factor(cyl) + disp, data = mtcars)

> predict(nicecars.lm, newdata = data.frame(x = 1:32))
Error in factor(cyl) : object 'cyl' not found

I still suggest that predict(..., newdata = ...) should *always* return an error when newdata does not provide new values of the model data.

Russ

-----Original Message-----
From: Berry, Charles <ccberry at ucsd.edu> 
Sent: Saturday, July 21, 2018 12:02 PM
To: Lenth, Russell V <russell-lenth at uiowa.edu>
Cc: r-devel at r-project.org
Subject: Re: Model formulas with explicit references



> On Jul 20, 2018, at 3:05 PM, Lenth, Russell V <russell-lenth at uiowa.edu> wrote:
> 
> Dear R-Devel,
> 
> I seem to no longer be able to access the bug-reporting system, so am doing this by e-mail.
> 
> My report concerns models where variables are explicitly referenced (or is it "dereferenced"?), such as:
> 
>    cars.lm <- lm(mtcars[[1]] ~ factor(mtcars$cyl) + mtcars[["disp"]])
> 
> I have found that it is not possible to predict such models with new data. For example:
> 
>> predict(cars.lm, newdata = mtcars[1:5, )
>       1        2        3        4        5        6        7        8        9       10 
> 20.37954 20.37954 26.58543 17.70329 14.91157 18.60448 14.91157 25.52859 25.68971 20.17199 
>      11       12       13       14       15       16       17       18       19       20 
> 20.17199 17.21096 17.21096 17.21096 11.85300 12.18071 12.72688 27.38558 27.46750 27.59312 
>      21       22       23       24       25       26       27       28       29       30 
> 26.25500 16.05853 16.44085 15.18466 13.81922 27.37738 26.24954 26.93772 15.15735 20.78917 
>      31       32 
> 16.52278 26.23042 
> Warning message:
> 'newdata' had 5 rows but variables found have 32 rows 
> 
> Instead of returning 5 predictions, it returns the 32 original predicted values. There is a warning message suggesting that something went wrong. This tickled my curiosity, and hance this result:
> 
>> predict(cars.lm, newdata = data.frame(x = 1:32))
>       1        2        3        4        5        6        7        8        9       10 
> 20.37954 20.37954 26.58543 17.70329 14.91157 18.60448 14.91157 25.52859 25.68971 20.17199 
>      11       12       13       14       15       16       17       18       19       20 
> 20.17199 17.21096 17.21096 17.21096 11.85300 12.18071 12.72688 27.38558 27.46750 27.59312 
>      21       22       23       24       25       26       27       28       29       30 
> 26.25500 16.05853 16.44085 15.18466 13.81922 27.37738 26.24954 26.93772 15.15735 20.78917 
>      31       32 
> 16.52278 26.23042
> 
> Again, the new data are ignored, but there is no warning message, because the previous warning was based only on a discrepancy with the number of rows and the number of predictions. Indeed, the new data set makes no sense at all in the context of this model.
> 
> At the root of this behavior is the fact that the model.frame function ignores its data argument with such models. So instead of constructing a new frame based on the new data, it just returns the original model frame.
> 

This produces what I think you intended:

> predict(cars.lm, newdata = list(mtcars=mtcars[1:5,]) )
       1        2        3        4        5 
20.37954 20.37954 26.58543 17.70329 14.91157 
>


> I am not really suggesting that you try to make these things work with models when the formula is like this. Instead, I am hoping that it throws an actual error message rather than just a warning, and that you be a little bit more sophisticated than merely checking the number of rows. Both predict() with newdata provided, and model.frame() with a data argument, should return an informative error message that says that model formulas like this are not supported with new data.

As you can see they are supported, but you have to make sure that the objects in the formula can be found in the newdata arg. If this is puzzling, try 

debugonce(predict.lm)
predict(cars.lm, newdata = mtcars[1:5, )

and inspect the newdata object and terms(object). You should see why the terms in the formula are not found in newdata.

If you  think that something like your idiom for formula is required, maybe you should  repost on r-help and say what you are trying to do with it.  I expect you'll get some advice on how to reformulate your call.

HTH,

Chuck


From jtelleri@@rproject @ending from gm@il@com  Mon Jul 23 08:36:44 2018
From: jtelleri@@rproject @ending from gm@il@com (Juan Telleria Ruiz de Aguirre)
Date: Mon, 23 Jul 2018 08:36:44 +0200
Subject: [Rd] CRAN: R 3.5.0 Not Available
Message-ID: <CAJXDcw0i3oNP5QsuqT0NXj7eP6-EVt6x4vMV9-URLUpxDugaVg@mail.gmail.com>

In CRAN, R 3.5.0 is not available for download on "Previous Releases
of R for Windows". ?Could it be added?

https://cran.r-project.org/

Thanks.


From ggrothendieck @ending from gm@il@com  Mon Jul 23 16:51:53 2018
From: ggrothendieck @ending from gm@il@com (Gabor Grothendieck)
Date: Mon, 23 Jul 2018 10:51:53 -0400
Subject: [Rd] oddity in transform
Message-ID: <CAP01uRn1wbE4sFMoLn4YBJmXY4fO9zZsECf08RgCs4_HAN=jbQ@mail.gmail.com>

Note the inconsistency in the names in these two examples.  X.Time in
the first case and Time.1 in the second case.

  > transform(BOD, X = BOD[1:2] * seq(6))
    Time demand X.Time X.demand
  1    1    8.3      1      8.3
  2    2   10.3      4     20.6
  3    3   19.0      9     57.0
  4    4   16.0     16     64.0
  5    5   15.6     25     78.0
  6    7   19.8     42    118.8

  > transform(BOD, X = BOD[1] * seq(6))
    Time demand Time.1
  1    1    8.3      1
  2    2   10.3      4
  3    3   19.0      9
  4    4   16.0     16
  5    5   15.6     25
  6    7   19.8     42

-- 
Statistics & Software Consulting
GKX Group, GKX Associates Inc.
tel: 1-877-GKX-GROUP
email: ggrothendieck at gmail.com


From xqrong1056 @ending from gm@il@com  Mon Jul 23 18:03:55 2018
From: xqrong1056 @ending from gm@il@com (Xiaoqing Claire Rong-Mullins)
Date: Mon, 23 Jul 2018 12:03:55 -0400
Subject: [Rd] Suggestion for updating `p.adjust` with new method (BKY 2006)
Message-ID: <CAMS45KvD6y4kfwarwSDAb+zuOBTe2WN-aZAopa-UHOsaYnDgnQ@mail.gmail.com>

Dear R contributors,

I suggest adding a new method to `p.adjust` ("Adjust P-values for Multiple
Comparisons",
https://stat.ethz.ch/R-manual/R-devel/library/stats/html/p.adjust.html).

This new method is published in Benjamini, Krieger, Yekutieli 2016 Adaptive
linear step-up procedures that control the false discovery rate
(Biometrika). https://doi.org/10.1093/biomet/93.3.491

This paper described multiple methods for adjusting p-values, where the "TST"
method (Definition 6) performed the best when test statistics are
positively correlated, per my interpretation. This method can be labeled as
"BKY", for the three authors Benjamini, Krieger, Yekutieli.

I apologize if this is a duplication.


Best,
Claire

Xiaoqing Claire Rong-Mullins
Bioinformatic Specialist
Division of Biostatistics
College of Public Health
The Ohio State University

	[[alternative HTML version deleted]]


From h@wickh@m @ending from gm@il@com  Mon Jul 23 21:03:06 2018
From: h@wickh@m @ending from gm@il@com (Hadley Wickham)
Date: Mon, 23 Jul 2018 14:03:06 -0500
Subject: [Rd] Is NULL a vector?
Message-ID: <CABdHhvHuCuaytOP-5VOYO=5+fiQQPNFPYeeU-jJrN9=k_1t+yA@mail.gmail.com>

Hi all,

Would you generally consider NULL to be a vector? Base R functions are
a little inconsistent:

## In favour

``` r
identical(as.vector(NULL), NULL)
#> [1] TRUE

identical(as(NULL, "vector"), NULL)
#> [1] TRUE

# supports key vector vector generics
length(NULL)
#> [1] 0
NULL[c(3, 4, 5)]
#> NULL
NULL[[1]]
#> NULL
```

## Against

``` r
is.vector(NULL)
#> [1] FALSE

is(NULL, "vector")
#> [1] FALSE
```

## Abstentions

``` r
is.atomic(NULL)
#> [1] TRUE
# documentation states "returns NULL if x is of an atomic type (or NULL)"
# is "or" exclusive or inclusive?
```

Hadley

-- 
http://hadley.nz


From murdoch@dunc@n @ending from gm@il@com  Mon Jul 23 21:17:25 2018
From: murdoch@dunc@n @ending from gm@il@com (Duncan Murdoch)
Date: Mon, 23 Jul 2018 15:17:25 -0400
Subject: [Rd] Is NULL a vector?
In-Reply-To: <CABdHhvHuCuaytOP-5VOYO=5+fiQQPNFPYeeU-jJrN9=k_1t+yA@mail.gmail.com>
References: <CABdHhvHuCuaytOP-5VOYO=5+fiQQPNFPYeeU-jJrN9=k_1t+yA@mail.gmail.com>
Message-ID: <12e7b0be-5284-39a0-e3d9-b1558901bc53@gmail.com>

On 23/07/2018 3:03 PM, Hadley Wickham wrote:
> Hi all,
> 
> Would you generally consider NULL to be a vector? 

According to the language definition (in the doc directory), it is not: 
"Vectors can be thought of as contiguous cells containing data. Cells 
are accessed through indexing operations such as x[5]. More details are 
given in Indexing.

R has six basic (?atomic?) vector types: logical, integer, real, 
complex, string (or character) and raw. The modes and storage modes for 
the different vector types are listed in the following table."

and later

"There is a special object called NULL. It is used whenever there is a 
need to indicate or specify that an object is absent. It should not be 
confused with a vector or list of zero length."

Duncan Murdoch

Base R functions are
> a little inconsistent:
> 
> ## In favour
> 
> ``` r
> identical(as.vector(NULL), NULL)
> #> [1] TRUE
> 
> identical(as(NULL, "vector"), NULL)
> #> [1] TRUE
> 
> # supports key vector vector generics
> length(NULL)
> #> [1] 0
> NULL[c(3, 4, 5)]
> #> NULL
> NULL[[1]]
> #> NULL
> ```
> 
> ## Against
> 
> ``` r
> is.vector(NULL)
> #> [1] FALSE
> 
> is(NULL, "vector")
> #> [1] FALSE
> ```
> 
> ## Abstentions
> 
> ``` r
> is.atomic(NULL)
> #> [1] TRUE
> # documentation states "returns NULL if x is of an atomic type (or NULL)"
> # is "or" exclusive or inclusive?
> ```
> 
> Hadley
>


From h@wickh@m @ending from gm@il@com  Mon Jul 23 21:23:30 2018
From: h@wickh@m @ending from gm@il@com (Hadley Wickham)
Date: Mon, 23 Jul 2018 14:23:30 -0500
Subject: [Rd] Is NULL a vector?
In-Reply-To: <12e7b0be-5284-39a0-e3d9-b1558901bc53@gmail.com>
References: <CABdHhvHuCuaytOP-5VOYO=5+fiQQPNFPYeeU-jJrN9=k_1t+yA@mail.gmail.com>
 <12e7b0be-5284-39a0-e3d9-b1558901bc53@gmail.com>
Message-ID: <CABdHhvGAwKu4-v-d=OWpVUHz0xnDxTkXtn=sP2OgavZ6nmHT3Q@mail.gmail.com>

On Mon, Jul 23, 2018 at 2:17 PM, Duncan Murdoch
<murdoch.duncan at gmail.com> wrote:
> On 23/07/2018 3:03 PM, Hadley Wickham wrote:
>>
>> Hi all,
>>
>> Would you generally consider NULL to be a vector?
>
>
> According to the language definition (in the doc directory), it is not:
> "Vectors can be thought of as contiguous cells containing data. Cells are
> accessed through indexing operations such as x[5]. More details are given in
> Indexing.
>
> R has six basic (?atomic?) vector types: logical, integer, real, complex,
> string (or character) and raw. The modes and storage modes for the different
> vector types are listed in the following table."
>
> and later
>
> "There is a special object called NULL. It is used whenever there is a need
> to indicate or specify that an object is absent. It should not be confused
> with a vector or list of zero length."

Perfect, thanks!

Also available online at
https://cran.r-project.org/doc/manuals/r-release/R-lang.html#Vector-objects

Hadley

-- 
http://hadley.nz


From emil@bode @ending from d@n@@kn@w@nl  Tue Jul 24 13:14:29 2018
From: emil@bode @ending from d@n@@kn@w@nl (Emil Bode)
Date: Tue, 24 Jul 2018 11:14:29 +0000
Subject: [Rd] oddity in transform
In-Reply-To: <CAP01uRn1wbE4sFMoLn4YBJmXY4fO9zZsECf08RgCs4_HAN=jbQ@mail.gmail.com>
References: <CAP01uRn1wbE4sFMoLn4YBJmXY4fO9zZsECf08RgCs4_HAN=jbQ@mail.gmail.com>
Message-ID: <77BC9D74-70D3-4E35-8427-15882C0BB62D@dans.knaw.nl>

I think you meant to call BOD[,1]
From ?transform, the ... arguments are supposed to be vectors, and BOD[1] is still a data.frame (with one column). So I don't think it's surprising transform gets confused by which name to use (X, or Time?), and kind of compromises on the name "Time". It's also in a note in ?transform: "If some of the values are not vectors of the appropriate length, you deserve whatever you get!"
And if you want to do it with multiple extra columns (and are not satisfied with these labels), I think the proper way to go would be " transform(BOD, X=BOD[,1]*seq(6), Y=BOD[,2]*seq(6))"
 
If you want to trace it back further, it's not in transform but in data.frame. Column-names are prepended with a higher-level name if the object has more than one column.
And it uses the tag-name if simply supplied with a vector:
data.frame(BOD[1:2], X=BOD[1]*seq(6)) takes the name of the only column of BOD[1], Time. Only because that column name is already present, it's changed to Time.1
data.frame(BOD[1:2], X=BOD[,1]*seq(6)) gives third column-name X (as X is now a vector)
data.frame(BOD[1:2], X=BOD[1:2]*seq(6)) or with BOD[,1:2] gives columns names X.Time and X.demand, to show these (multiple) columns are coming from X

So I don't think there's much to fix here. I this case having X.Time in all cases would have been better, but in general the column-naming of data.frame works, changing it would likely cause a lot of problems.
You can always change the column-names later.

Best regards, 
Emil Bode
 
Data-analyst
 
+31 6 43 83 89 33
emil.bode at dans.knaw.nl
 
DANS: Netherlands Institute for Permanent Access to Digital Research Resources
Anna van Saksenlaan 51 | 2593 HW Den Haag | +31 70 349 44 50 | info at dans.knaw.nl <mailto:info at dans.kn> | dans.knaw.nl <applewebdata://71F677F0-6872-45F3-A6C4-4972BF87185B/www.dans.knaw.nl>
DANS is an institute of the Dutch Academy KNAW <http://knaw.nl/nl> and funding organisation NWO <http://www.nwo.nl/>. 

?On 23/07/2018, 16:52, "R-devel on behalf of Gabor Grothendieck" <r-devel-bounces at r-project.org on behalf of ggrothendieck at gmail.com> wrote:

    Note the inconsistency in the names in these two examples.  X.Time in
    the first case and Time.1 in the second case.
    
      > transform(BOD, X = BOD[1:2] * seq(6))
        Time demand X.Time X.demand
      1    1    8.3      1      8.3
      2    2   10.3      4     20.6
      3    3   19.0      9     57.0
      4    4   16.0     16     64.0
      5    5   15.6     25     78.0
      6    7   19.8     42    118.8
    
      > transform(BOD, X = BOD[1] * seq(6))
        Time demand Time.1
      1    1    8.3      1
      2    2   10.3      4
      3    3   19.0      9
      4    4   16.0     16
      5    5   15.6     25
      6    7   19.8     42
    
    -- 
    Statistics & Software Consulting
    GKX Group, GKX Associates Inc.
    tel: 1-877-GKX-GROUP
    email: ggrothendieck at gmail.com
    
    ______________________________________________
    R-devel at r-project.org mailing list
    https://stat.ethz.ch/mailman/listinfo/r-devel
    


From m@echler @ending from @t@t@m@th@ethz@ch  Tue Jul 24 13:50:38 2018
From: m@echler @ending from @t@t@m@th@ethz@ch (Martin Maechler)
Date: Tue, 24 Jul 2018 13:50:38 +0200
Subject: [Rd] Library lib.loc Option Ignored for Dependencies
In-Reply-To: <235f764d-fe20-e2cd-86a3-15bb14e0ca11@gmail.com>
References: <SYAPR01MB25584DFE469B02994EFBEA10CD520@SYAPR01MB2558.ausprd01.prod.outlook.com>
 <eebc4452-4bdb-d6d3-b438-dea208ab14b8@gmail.com>
 <23379.24722.804755.262952@stat.math.ethz.ch>
 <235f764d-fe20-e2cd-86a3-15bb14e0ca11@gmail.com>
Message-ID: <23383.4750.718313.873781@stat.math.ethz.ch>

>>>>> Benjamin Tyner 
>>>>>     on Sat, 21 Jul 2018 13:42:43 -0400 writes:

    > Not sure whether it is the same issue as was raised here:
    > https://stat.ethz.ch/pipermail/r-devel/2010-October/058729.html

    > but in any case perhaps the problem could partially be remedied on line 
    > 245 of src/library/base/R/library.R by passing the lib.loc to 
    > .getRequiredPackages2() ...here is a patch (untested)

    > Index: src/library/base/R/library.R
    > ===================================================================
    > --- src/library/base/R/library.R??? (revision 74997)
    > +++ src/library/base/R/library.R??? (working copy)
    > @@ -242,7 +242,7 @@
    > ???????????????????? pos <- 2
    > ???????????????? } else pos <- npos
    > ???????????? }
    > -??????????? .getRequiredPackages2(pkgInfo, quietly = quietly)
    > +??????????? .getRequiredPackages2(pkgInfo, lib.loc = lib.loc, quietly = quietly)
    > ???????????? deps <- unique(names(pkgInfo$Depends))

    > ???????????? ## If the namespace mechanism is available and the package

This - directly - fails even more miserably e.g. in my own setup
when I have dependency to my package.

But it seems a good idea to use 'lib.loc', and safer and
probably better than the current code maybe to use

  .getRequiredPackages2(pkgInfo,
			lib.loc = c(lib.loc, .libPaths()),
			quietly = quietly)

instead of the current code which uses lib.loc = NULL
equivalently to   lib.loc = .libPaths()

Others / ideas?
Reproducible examples with small fake packages?

Martin

    > On 07/21/2018 12:34 PM, Martin Maechler wrote:
    >>>>>>> Benjamin Tyner
    >>>>>>> on Fri, 20 Jul 2018 19:42:09 -0400 writes:
    >> > Here's a trick/workaround; if lib.loc is the path to your
    >> > library, then prior to calling library(),
    >> 
    >> >> environment(.libPaths)$.lib.loc <- lib.loc
    >> 
    >> Well, that is quite a "trick"  -- and potentially a pretty
    >> dangerous one, not intended when making .libPaths a closure ....
    >> 
    >> 
    >> I do think that there is a problem with R's dealing of R_LIBS
    >> and other libPaths settings, notably when checking packages and
    >> within that recompiling vignettes etc, where the R process
    >> starts new versions of R via system() / system2() and then gets
    >> to wrong .libPaths() settings,
    >> and I personally would be very happy if we got reprex'es with
    >> small fake packages -- possibly only easily reproducible on
    >> unix-alikes ... so we could address this as a bug (or more than
    >> one) to be fixed.
    >> 
    >> Notably with the 3.4.x --> 3.5.0 transition and my/our tendency
    >> of having quite a few paths in R_LIBS / lib.loc / ... I've been
    >> bitten by problems when the wrong version of package was taken
    >> from the wrong library path ....
    >> 
    >> Martin
    >> 
    >> 
    >> >> ------------------------------------------------------------------------
    >> >> Good day,
    >> >>
    >> >> If there's a library folder of the latest R packages and
    >> >> a particular package from it is loaded using the lib.loc
    >> >> option, the dependencies of that package are still
    >> >> attempted to be loaded from another folder of older
    >> >> packages specified by R_LIBS, which may cause errors
    >> >> about version requirements not being met. The
    >> >> documentation of the library function doesn't explain
    >> >> what the intended result is in such a case, but it could
    >> >> reasonably be expected that R would also load the
    >> >> dependencies from the user-specified lib.loc folder.
    >> >>
    >> >> --------------------------------------
    >> >> Dario Strbenac University of Sydney Camperdown NSW 2050
    >> >> Australia


From ggrothendieck @ending from gm@il@com  Tue Jul 24 13:59:10 2018
From: ggrothendieck @ending from gm@il@com (Gabor Grothendieck)
Date: Tue, 24 Jul 2018 07:59:10 -0400
Subject: [Rd] oddity in transform
In-Reply-To: <77BC9D74-70D3-4E35-8427-15882C0BB62D@dans.knaw.nl>
References: <CAP01uRn1wbE4sFMoLn4YBJmXY4fO9zZsECf08RgCs4_HAN=jbQ@mail.gmail.com>
 <77BC9D74-70D3-4E35-8427-15882C0BB62D@dans.knaw.nl>
Message-ID: <CAP01uRkvYnHRUtE6026gMFP1oV5bwiUO4mqRAVdsFdWj6z==eQ@mail.gmail.com>

The idea is that one wants to write the line of code below
 in a general way which works the same
whether you specify ix as one column or multiple columns but the naming entirely
changes when you do this and BOD[, 1] and transform(BOD, X=..., Y=...) or
other hard coding solutions still require writing multiple cases.

ix <- 1:2
transform(BOD, X = BOD[ix] * seq(6))



On Tue, Jul 24, 2018 at 7:14 AM, Emil Bode <emil.bode at dans.knaw.nl> wrote:
> I think you meant to call BOD[,1]
> From ?transform, the ... arguments are supposed to be vectors, and BOD[1] is still a data.frame (with one column). So I don't think it's surprising transform gets confused by which name to use (X, or Time?), and kind of compromises on the name "Time". It's also in a note in ?transform: "If some of the values are not vectors of the appropriate length, you deserve whatever you get!"
> And if you want to do it with multiple extra columns (and are not satisfied with these labels), I think the proper way to go would be " transform(BOD, X=BOD[,1]*seq(6), Y=BOD[,2]*seq(6))"
>
> If you want to trace it back further, it's not in transform but in data.frame. Column-names are prepended with a higher-level name if the object has more than one column.
> And it uses the tag-name if simply supplied with a vector:
> data.frame(BOD[1:2], X=BOD[1]*seq(6)) takes the name of the only column of BOD[1], Time. Only because that column name is already present, it's changed to Time.1
> data.frame(BOD[1:2], X=BOD[,1]*seq(6)) gives third column-name X (as X is now a vector)
> data.frame(BOD[1:2], X=BOD[1:2]*seq(6)) or with BOD[,1:2] gives columns names X.Time and X.demand, to show these (multiple) columns are coming from X
>
> So I don't think there's much to fix here. I this case having X.Time in all cases would have been better, but in general the column-naming of data.frame works, changing it would likely cause a lot of problems.
> You can always change the column-names later.
>
> Best regards,
> Emil Bode
>
> Data-analyst
>
> +31 6 43 83 89 33
> emil.bode at dans.knaw.nl
>
> DANS: Netherlands Institute for Permanent Access to Digital Research Resources
> Anna van Saksenlaan 51 | 2593 HW Den Haag | +31 70 349 44 50 | info at dans.knaw.nl <mailto:info at dans.kn> | dans.knaw.nl <applewebdata://71F677F0-6872-45F3-A6C4-4972BF87185B/www.dans.knaw.nl>
> DANS is an institute of the Dutch Academy KNAW <http://knaw.nl/nl> and funding organisation NWO <http://www.nwo.nl/>.
>
> ?On 23/07/2018, 16:52, "R-devel on behalf of Gabor Grothendieck" <r-devel-bounces at r-project.org on behalf of ggrothendieck at gmail.com> wrote:
>
>     Note the inconsistency in the names in these two examples.  X.Time in
>     the first case and Time.1 in the second case.
>
>       > transform(BOD, X = BOD[1:2] * seq(6))
>         Time demand X.Time X.demand
>       1    1    8.3      1      8.3
>       2    2   10.3      4     20.6
>       3    3   19.0      9     57.0
>       4    4   16.0     16     64.0
>       5    5   15.6     25     78.0
>       6    7   19.8     42    118.8
>
>       > transform(BOD, X = BOD[1] * seq(6))
>         Time demand Time.1
>       1    1    8.3      1
>       2    2   10.3      4
>       3    3   19.0      9
>       4    4   16.0     16
>       5    5   15.6     25
>       6    7   19.8     42
>
>     --
>     Statistics & Software Consulting
>     GKX Group, GKX Associates Inc.
>     tel: 1-877-GKX-GROUP
>     email: ggrothendieck at gmail.com
>
>     ______________________________________________
>     R-devel at r-project.org mailing list
>     https://stat.ethz.ch/mailman/listinfo/r-devel
>
>



-- 
Statistics & Software Consulting
GKX Group, GKX Associates Inc.
tel: 1-877-GKX-GROUP
email: ggrothendieck at gmail.com


From i@t@z@hn @ending from gm@il@com  Tue Jul 24 17:41:30 2018
From: i@t@z@hn @ending from gm@il@com (Ista Zahn)
Date: Tue, 24 Jul 2018 11:41:30 -0400
Subject: [Rd] oddity in transform
In-Reply-To: <CAP01uRkvYnHRUtE6026gMFP1oV5bwiUO4mqRAVdsFdWj6z==eQ@mail.gmail.com>
References: <CAP01uRn1wbE4sFMoLn4YBJmXY4fO9zZsECf08RgCs4_HAN=jbQ@mail.gmail.com>
 <77BC9D74-70D3-4E35-8427-15882C0BB62D@dans.knaw.nl>
 <CAP01uRkvYnHRUtE6026gMFP1oV5bwiUO4mqRAVdsFdWj6z==eQ@mail.gmail.com>
Message-ID: <CA+vqiLETG3cu8kN6gPSKUtpQq4aoQOrymokJWPecCgtb8M=yMA@mail.gmail.com>

I don't think it has much to do with transform in particular:

> BOD <- data.frame(Time = 1:6, demand = runif(6))
> BOD[["X"]] <- BOD[1:2] * seq(6); BOD
  Time    demand X.Time  X.demand
1    1 0.8649628      1 0.8649628
2    2 0.5895380      4 1.1790761
3    3 0.6854635      9 2.0563906
4    4 0.4255801     16 1.7023206
5    5 0.5738793     25 2.8693967
6    6 0.9996713     36 5.9980281
> BOD <- data.frame(Time = 1:6, demand = runif(6))
> BOD[["X"]] <- BOD[1] * seq(6); BOD
  Time     demand Time
1    1 0.72990231    1
2    2 0.61721422    4
3    3 0.02389160    9
4    4 0.28341746   16
5    5 0.06116124   25
6    6 0.67966577   36

--Ista


On Tue, Jul 24, 2018 at 7:59 AM, Gabor Grothendieck
<ggrothendieck at gmail.com> wrote:
> The idea is that one wants to write the line of code below
>  in a general way which works the same
> whether you specify ix as one column or multiple columns but the naming entirely
> changes when you do this and BOD[, 1] and transform(BOD, X=..., Y=...) or
> other hard coding solutions still require writing multiple cases.
>
> ix <- 1:2
> transform(BOD, X = BOD[ix] * seq(6))
>
>
>
> On Tue, Jul 24, 2018 at 7:14 AM, Emil Bode <emil.bode at dans.knaw.nl> wrote:
>> I think you meant to call BOD[,1]
>> From ?transform, the ... arguments are supposed to be vectors, and BOD[1] is still a data.frame (with one column). So I don't think it's surprising transform gets confused by which name to use (X, or Time?), and kind of compromises on the name "Time". It's also in a note in ?transform: "If some of the values are not vectors of the appropriate length, you deserve whatever you get!"
>> And if you want to do it with multiple extra columns (and are not satisfied with these labels), I think the proper way to go would be " transform(BOD, X=BOD[,1]*seq(6), Y=BOD[,2]*seq(6))"
>>
>> If you want to trace it back further, it's not in transform but in data.frame. Column-names are prepended with a higher-level name if the object has more than one column.
>> And it uses the tag-name if simply supplied with a vector:
>> data.frame(BOD[1:2], X=BOD[1]*seq(6)) takes the name of the only column of BOD[1], Time. Only because that column name is already present, it's changed to Time.1
>> data.frame(BOD[1:2], X=BOD[,1]*seq(6)) gives third column-name X (as X is now a vector)
>> data.frame(BOD[1:2], X=BOD[1:2]*seq(6)) or with BOD[,1:2] gives columns names X.Time and X.demand, to show these (multiple) columns are coming from X
>>
>> So I don't think there's much to fix here. I this case having X.Time in all cases would have been better, but in general the column-naming of data.frame works, changing it would likely cause a lot of problems.
>> You can always change the column-names later.
>>
>> Best regards,
>> Emil Bode
>>
>> Data-analyst
>>
>> +31 6 43 83 89 33
>> emil.bode at dans.knaw.nl
>>
>> DANS: Netherlands Institute for Permanent Access to Digital Research Resources
>> Anna van Saksenlaan 51 | 2593 HW Den Haag | +31 70 349 44 50 | info at dans.knaw.nl <mailto:info at dans.kn> | dans.knaw.nl <applewebdata://71F677F0-6872-45F3-A6C4-4972BF87185B/www.dans.knaw.nl>
>> DANS is an institute of the Dutch Academy KNAW <http://knaw.nl/nl> and funding organisation NWO <http://www.nwo.nl/>.
>>
>> ?On 23/07/2018, 16:52, "R-devel on behalf of Gabor Grothendieck" <r-devel-bounces at r-project.org on behalf of ggrothendieck at gmail.com> wrote:
>>
>>     Note the inconsistency in the names in these two examples.  X.Time in
>>     the first case and Time.1 in the second case.
>>
>>       > transform(BOD, X = BOD[1:2] * seq(6))
>>         Time demand X.Time X.demand
>>       1    1    8.3      1      8.3
>>       2    2   10.3      4     20.6
>>       3    3   19.0      9     57.0
>>       4    4   16.0     16     64.0
>>       5    5   15.6     25     78.0
>>       6    7   19.8     42    118.8
>>
>>       > transform(BOD, X = BOD[1] * seq(6))
>>         Time demand Time.1
>>       1    1    8.3      1
>>       2    2   10.3      4
>>       3    3   19.0      9
>>       4    4   16.0     16
>>       5    5   15.6     25
>>       6    7   19.8     42
>>
>>     --
>>     Statistics & Software Consulting
>>     GKX Group, GKX Associates Inc.
>>     tel: 1-877-GKX-GROUP
>>     email: ggrothendieck at gmail.com
>>
>>     ______________________________________________
>>     R-devel at r-project.org mailing list
>>     https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>>
>
>
>
> --
> Statistics & Software Consulting
> GKX Group, GKX Associates Inc.
> tel: 1-877-GKX-GROUP
> email: ggrothendieck at gmail.com
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From i@t@z@hn @ending from gm@il@com  Tue Jul 24 17:47:47 2018
From: i@t@z@hn @ending from gm@il@com (Ista Zahn)
Date: Tue, 24 Jul 2018 11:47:47 -0400
Subject: [Rd] oddity in transform
In-Reply-To: <CA+vqiLETG3cu8kN6gPSKUtpQq4aoQOrymokJWPecCgtb8M=yMA@mail.gmail.com>
References: <CAP01uRn1wbE4sFMoLn4YBJmXY4fO9zZsECf08RgCs4_HAN=jbQ@mail.gmail.com>
 <77BC9D74-70D3-4E35-8427-15882C0BB62D@dans.knaw.nl>
 <CAP01uRkvYnHRUtE6026gMFP1oV5bwiUO4mqRAVdsFdWj6z==eQ@mail.gmail.com>
 <CA+vqiLETG3cu8kN6gPSKUtpQq4aoQOrymokJWPecCgtb8M=yMA@mail.gmail.com>
Message-ID: <CA+vqiLH_zkwU37aZ3Q86hAdx8VP=SvsXSaGKk7Cs0+r=V_r3bQ@mail.gmail.com>

On Tue, Jul 24, 2018 at 11:41 AM, Ista Zahn <istazahn at gmail.com> wrote:
> I don't think it has much to do with transform in particular:
>
>> BOD <- data.frame(Time = 1:6, demand = runif(6))
>> BOD[["X"]] <- BOD[1:2] * seq(6); BOD
>   Time    demand X.Time  X.demand
> 1    1 0.8649628      1 0.8649628
> 2    2 0.5895380      4 1.1790761
> 3    3 0.6854635      9 2.0563906
> 4    4 0.4255801     16 1.7023206
> 5    5 0.5738793     25 2.8693967
> 6    6 0.9996713     36 5.9980281
>> BOD <- data.frame(Time = 1:6, demand = runif(6))
>> BOD[["X"]] <- BOD[1] * seq(6); BOD
>   Time     demand Time
> 1    1 0.72990231    1
> 2    2 0.61721422    4
> 3    3 0.02389160    9
> 4    4 0.28341746   16
> 5    5 0.06116124   25
> 6    6 0.67966577   36

Ugh, well, I see now that

BOD[["X"]] <- BOD[1:2] * seq(6); BOD

and

transform(BOD, X = BOD[1:2] * seq(6))

don't produce the same thing, despite printing in ways that look
similar. However,

data.frame(BOD, X = BOD[1:2] * seq(6))

and

data.frame(BOD, X = BOD[1] * seq(6))

do produce the same result as transform, so the point about this being
much more pervasive still holds.

--Ista



>
> --Ista
>
>
> On Tue, Jul 24, 2018 at 7:59 AM, Gabor Grothendieck
> <ggrothendieck at gmail.com> wrote:
>> The idea is that one wants to write the line of code below
>>  in a general way which works the same
>> whether you specify ix as one column or multiple columns but the naming entirely
>> changes when you do this and BOD[, 1] and transform(BOD, X=..., Y=...) or
>> other hard coding solutions still require writing multiple cases.
>>
>> ix <- 1:2
>> transform(BOD, X = BOD[ix] * seq(6))
>>
>>
>>
>> On Tue, Jul 24, 2018 at 7:14 AM, Emil Bode <emil.bode at dans.knaw.nl> wrote:
>>> I think you meant to call BOD[,1]
>>> From ?transform, the ... arguments are supposed to be vectors, and BOD[1] is still a data.frame (with one column). So I don't think it's surprising transform gets confused by which name to use (X, or Time?), and kind of compromises on the name "Time". It's also in a note in ?transform: "If some of the values are not vectors of the appropriate length, you deserve whatever you get!"
>>> And if you want to do it with multiple extra columns (and are not satisfied with these labels), I think the proper way to go would be " transform(BOD, X=BOD[,1]*seq(6), Y=BOD[,2]*seq(6))"
>>>
>>> If you want to trace it back further, it's not in transform but in data.frame. Column-names are prepended with a higher-level name if the object has more than one column.
>>> And it uses the tag-name if simply supplied with a vector:
>>> data.frame(BOD[1:2], X=BOD[1]*seq(6)) takes the name of the only column of BOD[1], Time. Only because that column name is already present, it's changed to Time.1
>>> data.frame(BOD[1:2], X=BOD[,1]*seq(6)) gives third column-name X (as X is now a vector)
>>> data.frame(BOD[1:2], X=BOD[1:2]*seq(6)) or with BOD[,1:2] gives columns names X.Time and X.demand, to show these (multiple) columns are coming from X
>>>
>>> So I don't think there's much to fix here. I this case having X.Time in all cases would have been better, but in general the column-naming of data.frame works, changing it would likely cause a lot of problems.
>>> You can always change the column-names later.
>>>
>>> Best regards,
>>> Emil Bode
>>>
>>> Data-analyst
>>>
>>> +31 6 43 83 89 33
>>> emil.bode at dans.knaw.nl
>>>
>>> DANS: Netherlands Institute for Permanent Access to Digital Research Resources
>>> Anna van Saksenlaan 51 | 2593 HW Den Haag | +31 70 349 44 50 | info at dans.knaw.nl <mailto:info at dans.kn> | dans.knaw.nl <applewebdata://71F677F0-6872-45F3-A6C4-4972BF87185B/www.dans.knaw.nl>
>>> DANS is an institute of the Dutch Academy KNAW <http://knaw.nl/nl> and funding organisation NWO <http://www.nwo.nl/>.
>>>
>>> ?On 23/07/2018, 16:52, "R-devel on behalf of Gabor Grothendieck" <r-devel-bounces at r-project.org on behalf of ggrothendieck at gmail.com> wrote:
>>>
>>>     Note the inconsistency in the names in these two examples.  X.Time in
>>>     the first case and Time.1 in the second case.
>>>
>>>       > transform(BOD, X = BOD[1:2] * seq(6))
>>>         Time demand X.Time X.demand
>>>       1    1    8.3      1      8.3
>>>       2    2   10.3      4     20.6
>>>       3    3   19.0      9     57.0
>>>       4    4   16.0     16     64.0
>>>       5    5   15.6     25     78.0
>>>       6    7   19.8     42    118.8
>>>
>>>       > transform(BOD, X = BOD[1] * seq(6))
>>>         Time demand Time.1
>>>       1    1    8.3      1
>>>       2    2   10.3      4
>>>       3    3   19.0      9
>>>       4    4   16.0     16
>>>       5    5   15.6     25
>>>       6    7   19.8     42
>>>
>>>     --
>>>     Statistics & Software Consulting
>>>     GKX Group, GKX Associates Inc.
>>>     tel: 1-877-GKX-GROUP
>>>     email: ggrothendieck at gmail.com
>>>
>>>     ______________________________________________
>>>     R-devel at r-project.org mailing list
>>>     https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>>
>>
>>
>>
>> --
>> Statistics & Software Consulting
>> GKX Group, GKX Associates Inc.
>> tel: 1-877-GKX-GROUP
>> email: ggrothendieck at gmail.com
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel


From btyner @ending from gm@il@com  Tue Jul 24 23:37:46 2018
From: btyner @ending from gm@il@com (Benjamin Tyner)
Date: Tue, 24 Jul 2018 17:37:46 -0400
Subject: [Rd] Library lib.loc Option Ignored for Dependencies
In-Reply-To: <23383.4750.718313.873781@stat.math.ethz.ch>
References: <SYAPR01MB25584DFE469B02994EFBEA10CD520@SYAPR01MB2558.ausprd01.prod.outlook.com>
 <eebc4452-4bdb-d6d3-b438-dea208ab14b8@gmail.com>
 <23379.24722.804755.262952@stat.math.ethz.ch>
 <235f764d-fe20-e2cd-86a3-15bb14e0ca11@gmail.com>
 <23383.4750.718313.873781@stat.math.ethz.ch>
Message-ID: <6e156ac6-472b-bae4-e711-b8cde12c0d1a@gmail.com>



On 07/24/2018 07:50 AM, Martin Maechler wrote:
>>>>>> Benjamin Tyner
>>>>>>      on Sat, 21 Jul 2018 13:42:43 -0400 writes:
>      > Not sure whether it is the same issue as was raised here:
>      > https://stat.ethz.ch/pipermail/r-devel/2010-October/058729.html
>
>      > but in any case perhaps the problem could partially be remedied on line
>      > 245 of src/library/base/R/library.R by passing the lib.loc to
>      > .getRequiredPackages2() ...here is a patch (untested)
>
>      > Index: src/library/base/R/library.R
>      > ===================================================================
>      > --- src/library/base/R/library.R??? (revision 74997)
>      > +++ src/library/base/R/library.R??? (working copy)
>      > @@ -242,7 +242,7 @@
>      > ???????????????????? pos <- 2
>      > ???????????????? } else pos <- npos
>      > ???????????? }
>      > -??????????? .getRequiredPackages2(pkgInfo, quietly = quietly)
>      > +??????????? .getRequiredPackages2(pkgInfo, lib.loc = lib.loc, quietly = quietly)
>      > ???????????? deps <- unique(names(pkgInfo$Depends))
>
>      > ???????????? ## If the namespace mechanism is available and the package
>
> This - directly - fails even more miserably e.g. in my own setup
> when I have dependency to my package.
>
> But it seems a good idea to use 'lib.loc', and safer and
> probably better than the current code maybe to use
>
>    .getRequiredPackages2(pkgInfo,
> 			lib.loc = c(lib.loc, .libPaths()),
> 			quietly = quietly)
>
> instead of the current code which uses lib.loc = NULL
> equivalently to   lib.loc = .libPaths()
Seems reasonable to me.
>
> Others / ideas?
> Reproducible examples with small fake packages?
Or how about an example with a "real" CRAN package with just one dependency:

 ??? > dir.create("~/lib")
 ??? > list.files("~/lib")
 ??? character(0)
 ??? > install.packages("spam", lib = "~/lib", dependencies = TRUE)
 ??? > list.files("~/lib")
 ??? [1] "dotCall64" "spam"
 ??? > library(spam, lib.loc = "~/lib")
 ??? Error: package ?dotCall64? required by ?spam? could not be found

>
> Martin
>
>      > On 07/21/2018 12:34 PM, Martin Maechler wrote:
>      >>>>>>> Benjamin Tyner
>      >>>>>>> on Fri, 20 Jul 2018 19:42:09 -0400 writes:
>      >> > Here's a trick/workaround; if lib.loc is the path to your
>      >> > library, then prior to calling library(),
>      >>
>      >> >> environment(.libPaths)$.lib.loc <- lib.loc
>      >>
>      >> Well, that is quite a "trick"  -- and potentially a pretty
>      >> dangerous one, not intended when making .libPaths a closure ....
>      >>
>      >>
>      >> I do think that there is a problem with R's dealing of R_LIBS
>      >> and other libPaths settings, notably when checking packages and
>      >> within that recompiling vignettes etc, where the R process
>      >> starts new versions of R via system() / system2() and then gets
>      >> to wrong .libPaths() settings,
>      >> and I personally would be very happy if we got reprex'es with
>      >> small fake packages -- possibly only easily reproducible on
>      >> unix-alikes ... so we could address this as a bug (or more than
>      >> one) to be fixed.
>      >>
>      >> Notably with the 3.4.x --> 3.5.0 transition and my/our tendency
>      >> of having quite a few paths in R_LIBS / lib.loc / ... I've been
>      >> bitten by problems when the wrong version of package was taken
>      >> from the wrong library path ....
>      >>
>      >> Martin
>      >>
>      >>
>      >> >> ------------------------------------------------------------------------
>      >> >> Good day,
>      >> >>
>      >> >> If there's a library folder of the latest R packages and
>      >> >> a particular package from it is loaded using the lib.loc
>      >> >> option, the dependencies of that package are still
>      >> >> attempted to be loaded from another folder of older
>      >> >> packages specified by R_LIBS, which may cause errors
>      >> >> about version requirements not being met. The
>      >> >> documentation of the library function doesn't explain
>      >> >> what the intended result is in such a case, but it could
>      >> >> reasonably be expected that R would also load the
>      >> >> dependencies from the user-specified lib.loc folder.
>      >> >>
>      >> >> --------------------------------------
>      >> >> Dario Strbenac University of Sydney Camperdown NSW 2050
>      >> >> Australia


From d@tr7320 @ending from uni@@ydney@edu@@u  Wed Jul 25 04:00:09 2018
From: d@tr7320 @ending from uni@@ydney@edu@@u (Dario Strbenac)
Date: Wed, 25 Jul 2018 02:00:09 +0000
Subject: [Rd] Library lib.loc Option Ignored for Dependencies
In-Reply-To: <23383.4750.718313.873781@stat.math.ethz.ch>
References: <SYAPR01MB25584DFE469B02994EFBEA10CD520@SYAPR01MB2558.ausprd01.prod.outlook.com>
 <eebc4452-4bdb-d6d3-b438-dea208ab14b8@gmail.com>
 <23379.24722.804755.262952@stat.math.ethz.ch>
 <235f764d-fe20-e2cd-86a3-15bb14e0ca11@gmail.com>,
 <23383.4750.718313.873781@stat.math.ethz.ch>
Message-ID: <SYAPR01MB25586F58C0B6C49019D09F27CD540@SYAPR01MB2558.ausprd01.prod.outlook.com>

Good day,

A self-contained example which reproduces the problem is

packagesFolder <- tempdir()
latestFolder <- file.path(packagesFolder, "latest")
dir.create(latestFolder)

devtools::create(file.path(latestFolder, "statistics"), description = list(Version = "1.1.0", Depends = "extras (>= 1.0.5)"))
devtools::create(file.path(packagesFolder, "extras"), description = list(Version = "1.0.0"))
devtools::create(file.path(latestFolder, "extras"), description = list(Version = "1.1.0"))

latestInstall <- file.path(.libPaths()[1], "latest")
dir.create(latestInstall)
install.packages(file.path(packagesFolder, "extras"), type = "source", repos = NULL)
install.packages(file.path(latestFolder, "extras"), type = "source", repos = NULL, lib = latestInstall)
install.packages(file.path(latestFolder, "statistics"), type = "source", repos = NULL, lib = latestInstall)

> library(statistics, lib.loc = latestInstall)
  Error: package ?extras? 1.0.0 was found, but >= 1.0.5 is required by ?statistics?

The latest version of the statistics package is loaded, but the directory of latest packages is ignored by R when it considers the package dependency.

--------------------------------------
Dario Strbenac
University of Sydney
Camperdown NSW 2050
Australia

From ligge@ @ending from @t@ti@tik@tu-dortmund@de  Wed Jul 25 10:28:27 2018
From: ligge@ @ending from @t@ti@tik@tu-dortmund@de (Uwe Ligges)
Date: Wed, 25 Jul 2018 10:28:27 +0200
Subject: [Rd] Library lib.loc Option Ignored for Dependencies
In-Reply-To: <6e156ac6-472b-bae4-e711-b8cde12c0d1a@gmail.com>
References: <SYAPR01MB25584DFE469B02994EFBEA10CD520@SYAPR01MB2558.ausprd01.prod.outlook.com>
 <eebc4452-4bdb-d6d3-b438-dea208ab14b8@gmail.com>
 <23379.24722.804755.262952@stat.math.ethz.ch>
 <235f764d-fe20-e2cd-86a3-15bb14e0ca11@gmail.com>
 <23383.4750.718313.873781@stat.math.ethz.ch>
 <6e156ac6-472b-bae4-e711-b8cde12c0d1a@gmail.com>
Message-ID: <27252aea-aa35-dab9-f4db-00b3558af3f7@statistik.tu-dortmund.de>



On 24.07.2018 23:37, Benjamin Tyner wrote:
> 
> 
> On 07/24/2018 07:50 AM, Martin Maechler wrote:
>>>>>>> Benjamin Tyner
>>>>>>> ???? on Sat, 21 Jul 2018 13:42:43 -0400 writes:
>> ???? > Not sure whether it is the same issue as was raised here:
>> ???? > https://stat.ethz.ch/pipermail/r-devel/2010-October/058729.html
>>
>> ???? > but in any case perhaps the problem could partially be remedied 
>> on line
>> ???? > 245 of src/library/base/R/library.R by passing the lib.loc to
>> ???? > .getRequiredPackages2() ...here is a patch (untested)
>>
>> ???? > Index: src/library/base/R/library.R
>> ???? > 
>> ===================================================================
>> ???? > --- src/library/base/R/library.R??? (revision 74997)
>> ???? > +++ src/library/base/R/library.R??? (working copy)
>> ???? > @@ -242,7 +242,7 @@
>> ???? > ???????????????????? pos <- 2
>> ???? > ???????????????? } else pos <- npos
>> ???? > ???????????? }
>> ???? > -??????????? .getRequiredPackages2(pkgInfo, quietly = quietly)
>> ???? > +??????????? .getRequiredPackages2(pkgInfo, lib.loc = lib.loc, 
>> quietly = quietly)
>> ???? > ???????????? deps <- unique(names(pkgInfo$Depends))
>>
>> ???? > ???????????? ## If the namespace mechanism is available and the 
>> package
>>
>> This - directly - fails even more miserably e.g. in my own setup
>> when I have dependency to my package.
>>
>> But it seems a good idea to use 'lib.loc', and safer and
>> probably better than the current code maybe to use
>>
>> ?? .getRequiredPackages2(pkgInfo,
>> ??????????? lib.loc = c(lib.loc, .libPaths()),
>> ??????????? quietly = quietly)
>>
>> instead of the current code which uses lib.loc = NULL
>> equivalently to?? lib.loc = .libPaths()
> Seems reasonable to me.
>>
>> Others / ideas?
>> Reproducible examples with small fake packages?
> Or how about an example with a "real" CRAN package with just one 
> dependency:
> 
>  ??? > dir.create("~/lib")
>  ??? > list.files("~/lib")
>  ??? character(0)
>  ??? > install.packages("spam", lib = "~/lib", dependencies = TRUE)
>  ??? > list.files("~/lib")
>  ??? [1] "dotCall64" "spam"
>  ??? > library(spam, lib.loc = "~/lib")
>  ??? Error: package ?dotCall64? required by ?spam? could not be found


Not sure if this is a bug: where is it documented that this works not as 
above (which is what I would expect)?

For development puposes, you may want to try some devekopment version of 
one package agaiunst release versions of the others.
This is the purpose of the above: take spam from ~lib and the other from 
.libPath().

Best,
Uwe Ligges


>>
>> Martin
>>
>> ???? > On 07/21/2018 12:34 PM, Martin Maechler wrote:
>> ???? >>>>>>> Benjamin Tyner
>> ???? >>>>>>> on Fri, 20 Jul 2018 19:42:09 -0400 writes:
>> ???? >> > Here's a trick/workaround; if lib.loc is the path to your
>> ???? >> > library, then prior to calling library(),
>> ???? >>
>> ???? >> >> environment(.libPaths)$.lib.loc <- lib.loc
>> ???? >>
>> ???? >> Well, that is quite a "trick"? -- and potentially a pretty
>> ???? >> dangerous one, not intended when making .libPaths a closure ....
>> ???? >>
>> ???? >>
>> ???? >> I do think that there is a problem with R's dealing of R_LIBS
>> ???? >> and other libPaths settings, notably when checking packages and
>> ???? >> within that recompiling vignettes etc, where the R process
>> ???? >> starts new versions of R via system() / system2() and then gets
>> ???? >> to wrong .libPaths() settings,
>> ???? >> and I personally would be very happy if we got reprex'es with
>> ???? >> small fake packages -- possibly only easily reproducible on
>> ???? >> unix-alikes ... so we could address this as a bug (or more than
>> ???? >> one) to be fixed.
>> ???? >>
>> ???? >> Notably with the 3.4.x --> 3.5.0 transition and my/our tendency
>> ???? >> of having quite a few paths in R_LIBS / lib.loc / ... I've been
>> ???? >> bitten by problems when the wrong version of package was taken
>> ???? >> from the wrong library path ....
>> ???? >>
>> ???? >> Martin
>> ???? >>
>> ???? >>
>> ???? >> >> 
>> ------------------------------------------------------------------------
>> ???? >> >> Good day,
>> ???? >> >>
>> ???? >> >> If there's a library folder of the latest R packages and
>> ???? >> >> a particular package from it is loaded using the lib.loc
>> ???? >> >> option, the dependencies of that package are still
>> ???? >> >> attempted to be loaded from another folder of older
>> ???? >> >> packages specified by R_LIBS, which may cause errors
>> ???? >> >> about version requirements not being met. The
>> ???? >> >> documentation of the library function doesn't explain
>> ???? >> >> what the intended result is in such a case, but it could
>> ???? >> >> reasonably be expected that R would also load the
>> ???? >> >> dependencies from the user-specified lib.loc folder.
>> ???? >> >>
>> ???? >> >> --------------------------------------
>> ???? >> >> Dario Strbenac University of Sydney Camperdown NSW 2050
>> ???? >> >> Australia
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From ligge@ @ending from @t@ti@tik@tu-dortmund@de  Wed Jul 25 10:29:52 2018
From: ligge@ @ending from @t@ti@tik@tu-dortmund@de (Uwe Ligges)
Date: Wed, 25 Jul 2018 10:29:52 +0200
Subject: [Rd] Library lib.loc Option Ignored for Dependencies
In-Reply-To: <SYAPR01MB25586F58C0B6C49019D09F27CD540@SYAPR01MB2558.ausprd01.prod.outlook.com>
References: <SYAPR01MB25584DFE469B02994EFBEA10CD520@SYAPR01MB2558.ausprd01.prod.outlook.com>
 <eebc4452-4bdb-d6d3-b438-dea208ab14b8@gmail.com>
 <23379.24722.804755.262952@stat.math.ethz.ch>
 <235f764d-fe20-e2cd-86a3-15bb14e0ca11@gmail.com>
 <23383.4750.718313.873781@stat.math.ethz.ch>
 <SYAPR01MB25586F58C0B6C49019D09F27CD540@SYAPR01MB2558.ausprd01.prod.outlook.com>
Message-ID: <a7806c00-ce01-e8aa-c47a-749cd13f9dee@statistik.tu-dortmund.de>



On 25.07.2018 04:00, Dario Strbenac wrote:
> Good day,
> 
> A self-contained example which reproduces the problem is
> 
> packagesFolder <- tempdir()
> latestFolder <- file.path(packagesFolder, "latest")
> dir.create(latestFolder)
> 
> devtools::create(file.path(latestFolder, "statistics"), description = list(Version = "1.1.0", Depends = "extras (>= 1.0.5)"))
> devtools::create(file.path(packagesFolder, "extras"), description = list(Version = "1.0.0"))
> devtools::create(file.path(latestFolder, "extras"), description = list(Version = "1.1.0"))
> 
> latestInstall <- file.path(.libPaths()[1], "latest")
> dir.create(latestInstall)
> install.packages(file.path(packagesFolder, "extras"), type = "source", repos = NULL)
> install.packages(file.path(latestFolder, "extras"), type = "source", repos = NULL, lib = latestInstall)
> install.packages(file.path(latestFolder, "statistics"), type = "source", repos = NULL, lib = latestInstall)
> 
>> library(statistics, lib.loc = latestInstall)
>    Error: package ?extras? 1.0.0 was found, but >= 1.0.5 is required by ?statistics?
> 
> The latest version of the statistics package is loaded, but the directory of latest packages is ignored by R when it considers the package dependency.

See my other mail, I think this is epctected, why don't youi set the 
.libPaths() correctly?

Nor is this self contained as we need some extra package  to try your 
example...

Best,
Uwe Ligges


> --------------------------------------
> Dario Strbenac
> University of Sydney
> Camperdown NSW 2050
> Australia
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From btyner @ending from gm@il@com  Wed Jul 25 13:37:03 2018
From: btyner @ending from gm@il@com (Benjamin Tyner)
Date: Wed, 25 Jul 2018 07:37:03 -0400
Subject: [Rd] Library lib.loc Option Ignored for Dependencies
In-Reply-To: <27252aea-aa35-dab9-f4db-00b3558af3f7@statistik.tu-dortmund.de>
References: <SYAPR01MB25584DFE469B02994EFBEA10CD520@SYAPR01MB2558.ausprd01.prod.outlook.com>
 <eebc4452-4bdb-d6d3-b438-dea208ab14b8@gmail.com>
 <23379.24722.804755.262952@stat.math.ethz.ch>
 <235f764d-fe20-e2cd-86a3-15bb14e0ca11@gmail.com>
 <23383.4750.718313.873781@stat.math.ethz.ch>
 <6e156ac6-472b-bae4-e711-b8cde12c0d1a@gmail.com>
 <27252aea-aa35-dab9-f4db-00b3558af3f7@statistik.tu-dortmund.de>
Message-ID: <f20372ed-7d38-3b1d-b2f3-cd44c2a67e66@gmail.com>


On 07/25/2018 04:28 AM, Uwe Ligges wrote:
>
> Not sure if this is a bug: where is it documented that this works not 
> as above (which is what I would expect)?
The documentation doesn't say one way or the other. But the fact remains 
that base:::.getRequiredPackages2, when provided a non-null lib.loc, 
uses that lib.loc when checking versions of dependencies. So (to me) it 
seems a little incongruous that base:::.getRequiredPackages2 offers this 
functionality but library() doesn't take advantage of it. Moreover, it 
is already passing the 'quietly' argument...
>
> For development puposes, you may want to try some devekopment version 
> of one package agaiunst release versions of the others.
Agreed, in which case I would explicitly load the dependency first 
specifying a custom lib.loc.
> This is the purpose of the above: take spam from ~lib and the other 
> from .libPath().
>
> Best,
> Uwe Ligges
>


From d@tr7320 @ending from uni@@ydney@edu@@u  Wed Jul 25 14:00:11 2018
From: d@tr7320 @ending from uni@@ydney@edu@@u (Dario Strbenac)
Date: Wed, 25 Jul 2018 12:00:11 +0000
Subject: [Rd] Library lib.loc Option Ignored for Dependencies
In-Reply-To: <a7806c00-ce01-e8aa-c47a-749cd13f9dee@statistik.tu-dortmund.de>
References: <SYAPR01MB25584DFE469B02994EFBEA10CD520@SYAPR01MB2558.ausprd01.prod.outlook.com>
 <eebc4452-4bdb-d6d3-b438-dea208ab14b8@gmail.com>
 <23379.24722.804755.262952@stat.math.ethz.ch>
 <235f764d-fe20-e2cd-86a3-15bb14e0ca11@gmail.com>
 <23383.4750.718313.873781@stat.math.ethz.ch>
 <SYAPR01MB25586F58C0B6C49019D09F27CD540@SYAPR01MB2558.ausprd01.prod.outlook.com>,
 <a7806c00-ce01-e8aa-c47a-749cd13f9dee@statistik.tu-dortmund.de>
Message-ID: <MEAPR01MB2550A9669420877C9EDFB936CD540@MEAPR01MB2550.ausprd01.prod.outlook.com>

Good day,

Indeed, the setting of .libPaths() would avoid the error shown by the example. But, it seems unintuitive that R tries to load a package from one directory and its dependencies from another if the dependency is present in the same library as the package being loaded by the user's library command. The documentation of library and its description of lib.loc doesn't suggest that the alternation of source directories would occur.

--------------------------------------
Dario Strbenac
University of Sydney
Camperdown NSW 2050
Australia

From c@@rdi@g@bor @ending from gm@il@com  Thu Jul 26 01:22:27 2018
From: c@@rdi@g@bor @ending from gm@il@com (=?UTF-8?B?R8OhYm9yIENzw6FyZGk=?=)
Date: Thu, 26 Jul 2018 00:22:27 +0100
Subject: [Rd] Possible bug: R --slave --interactive stdin echo on Linux when
 stdin is a fifo
Message-ID: <CABtg=KnwNEtKbNB3X1KKhLBLJP2W3_g7vc-RLwJ9=yiwfq0E8A@mail.gmail.com>

I am trying to control a background R session, connected via a fifo /
named pipe.

The problem is, R --slave --interactive does not echo the input on
stdout on macOS and Windows, but it does echo it on Linux. This is
very unfortunate, because there is no easy way to separate the input
and the stdout of the R process here.

Here is how to reproduce it easily:

mkfifo fif
R --slave --interactive < fif > out &
(echo 1+1; echo '"foobar"') > fif
cat out

#> 1+1
#> [1] 2
#> "foobar"
#> [1] "foobar"

This is recent  R-devel, but at least 3.4.x has this behavior as well.

Would it be possible to eliminate the echo on Linux as well?

Thanks,
Gabor


From @tephenforpre@ident @ending from gm@il@com  Thu Jul 26 03:04:56 2018
From: @tephenforpre@ident @ending from gm@il@com (Stephen Marsh)
Date: Wed, 25 Jul 2018 21:04:56 -0400
Subject: [Rd] Possible To Enable Building R With Cairo But Without X11
 Dependencies?
Message-ID: <CAP1gB3dPwmpXCORG11PTKB2by5CJj0LxpHosbAj=G_6Y8m7QXA@mail.gmail.com>

Hello,

So the Homebrew community dropped support for --with-cairo which is a shame
because --without-x --with-cairo is an important combination for any
environment that might need to generate graphics without X11 (or related)
dependencies (macOS, headless linux servers).

This rejected GitHub PR contains more detail:
https://github.com/Homebrew/homebrew-core/pull/24094

(See also these comments:
https://github.com/uluyol/homebrew-core/commit/c377e6ebb3c7bc8fe6edf098e259d76e9935aacf
)

Specifically:

?It looks like the only issue is their configure scripts using cairo-xlib.h
instead of cairo.h, but to be honest I'm not familiar with the code. If
they remove the dependency, I think the default homebrew R could probably
enable cairo by default.?

I suppose my general questions are:
1) Is this actually the case? You cannot successfully build R with Cairo
capabilities but without X11 dependencies?
2) If so, is it possible to fix this in a future release of R?

Thanks a lot,
-Stephen Marsh

	[[alternative HTML version deleted]]


From edd @ending from debi@n@org  Thu Jul 26 03:35:13 2018
From: edd @ending from debi@n@org (Dirk Eddelbuettel)
Date: Wed, 25 Jul 2018 20:35:13 -0500
Subject: [Rd] Possible To Enable Building R With Cairo But Without X11
 Dependencies?
In-Reply-To: <CAP1gB3dPwmpXCORG11PTKB2by5CJj0LxpHosbAj=G_6Y8m7QXA@mail.gmail.com>
References: <CAP1gB3dPwmpXCORG11PTKB2by5CJj0LxpHosbAj=G_6Y8m7QXA@mail.gmail.com>
Message-ID: <23385.9553.581811.803017@rob.eddelbuettel.com>


On 25 July 2018 at 21:04, Stephen Marsh wrote:
| So the Homebrew community dropped support for --with-cairo which is a shame
| because --without-x --with-cairo is an important combination for any
| environment that might need to generate graphics without X11 (or related)
| dependencies (macOS, headless linux servers).

For headless use on Linux, just build as usual and run via `xvfb-run`. If you
need to create cairo-based graphics, install one of the (at least two) cairo
device packages from CRAN.

Dirk

-- 
http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From b@rowling@on @ending from l@nc@@ter@@c@uk  Thu Jul 26 13:25:48 2018
From: b@rowling@on @ending from l@nc@@ter@@c@uk (Barry Rowlingson)
Date: Thu, 26 Jul 2018 12:25:48 +0100
Subject: [Rd] 
 Possible bug: R --slave --interactive stdin echo on Linux when
 stdin is a fifo
In-Reply-To: <f85c602f061144619f89a71b5f056a04@AM6PR04MB4264.eurprd04.prod.outlook.com>
References: <f85c602f061144619f89a71b5f056a04@AM6PR04MB4264.eurprd04.prod.outlook.com>
Message-ID: <CANVKczMGuQ0n1XKRu5=sRqeTOxmA52wOeLTrff9kV8N3LcgJ-Q@mail.gmail.com>

On Thu, Jul 26, 2018 at 12:22 AM, G?bor Cs?rdi <csardi.gabor at gmail.com> wrote:
> I am trying to control a background R session, connected via a fifo /
> named pipe.

 Is the fifo significant here? If I read the same R code from a file
via `<` I get the input echoed (R 3.4.4, Ubuntu).

Barry


From c@@rdi@g@bor @ending from gm@il@com  Thu Jul 26 13:54:27 2018
From: c@@rdi@g@bor @ending from gm@il@com (=?UTF-8?B?R8OhYm9yIENzw6FyZGk=?=)
Date: Thu, 26 Jul 2018 12:54:27 +0100
Subject: [Rd] 
 Possible bug: R --slave --interactive stdin echo on Linux when
 stdin is a fifo
In-Reply-To: <CANVKczMGuQ0n1XKRu5=sRqeTOxmA52wOeLTrff9kV8N3LcgJ-Q@mail.gmail.com>
References: <f85c602f061144619f89a71b5f056a04@AM6PR04MB4264.eurprd04.prod.outlook.com>
 <CANVKczMGuQ0n1XKRu5=sRqeTOxmA52wOeLTrff9kV8N3LcgJ-Q@mail.gmail.com>
Message-ID: <CABtg=KnbkMSCgAYeiuOGJ3-kOgjc4McPhw2skS-6eyydCf8N0A@mail.gmail.com>

On Thu, Jul 26, 2018 at 12:25 PM Barry Rowlingson
<b.rowlingson at lancaster.ac.uk> wrote:
>
> On Thu, Jul 26, 2018 at 12:22 AM, G?bor Cs?rdi <csardi.gabor at gmail.com> wrote:
> > I am trying to control a background R session, connected via a fifo /
> > named pipe.
>
>  Is the fifo significant here? If I read the same R code from a file
> via `<` I get the input echoed (R 3.4.4, Ubuntu).

Yeah, for a file I get echo on both macOS and Linux, but not on Windows.

I think the most useful behavior for --slave is no echo at all, maybe?
But I might be missing the motivation behind --slave.

Another thing is that windows does not have --interactive. Is there a
way to run R
1) without echoing stdin, and
2) without quitting on the first error,
on all platforms?

Gabor

> Barry


From m@echler @ending from @t@t@m@th@ethz@ch  Thu Jul 26 14:43:01 2018
From: m@echler @ending from @t@t@m@th@ethz@ch (Martin Maechler)
Date: Thu, 26 Jul 2018 14:43:01 +0200
Subject: [Rd] 
 Suggestion for updating `p.adjust` with new method (BKY 2006)
In-Reply-To: <CAMS45KvD6y4kfwarwSDAb+zuOBTe2WN-aZAopa-UHOsaYnDgnQ@mail.gmail.com>
References: <CAMS45KvD6y4kfwarwSDAb+zuOBTe2WN-aZAopa-UHOsaYnDgnQ@mail.gmail.com>
Message-ID: <23385.49621.298333.21996@stat.math.ethz.ch>

>>>>> Xiaoqing Claire Rong-Mullins 
>>>>>     on Mon, 23 Jul 2018 12:03:55 -0400 writes:

    > Dear R contributors,
    > I suggest adding a new method to `p.adjust` ("Adjust P-values for Multiple
    > Comparisons",
    > https://stat.ethz.ch/R-manual/R-devel/library/stats/html/p.adjust.html).

    > This new method is published in Benjamini, Krieger, Yekutieli 2016 Adaptive
    > linear step-up procedures that control the false discovery rate
    > (Biometrika). https://doi.org/10.1093/biomet/93.3.491

    > This paper described multiple methods for adjusting p-values, where the "TST"
    > method (Definition 6) performed the best when test statistics are
    > positively correlated, per my interpretation. This method can be labeled as
    > "BKY", for the three authors Benjamini, Krieger, Yekutieli.

    > I apologize if this is a duplication.

Not at all a duplication.  AFAICS this is the first time this is
proposed here.  As a matter of fact this seems such a good (and well
confined) suggestion, that I've proposed it as semester project
here, and so with high probability we will get a "BKY" method
for p.adjust() within a few months.

Thank you, indeed, for the proposal!

Best,
Martin

--
Martin <Maechler at stat.math.ethz.ch>   http://stat.ethz.ch/~maechler
Seminar f?r Statistik, ETH Z?rich   HG G 16         R?mistrasse 101
CH-8092 Zurich, SWITZERLAND
phone: +41-44-632-3408      fax: ...-1228     <><


    > Best,
    > Claire

    > Xiaoqing Claire Rong-Mullins
    > Bioinformatic Specialist
    > Division of Biostatistics
    > College of Public Health
    > The Ohio State University

    > [[alternative HTML version deleted]]

    > ______________________________________________
    > R-devel at r-project.org mailing list
    > https://stat.ethz.ch/mailman/listinfo/r-devel


From luke-tier@ey m@ili@g off uiow@@edu  Thu Jul 26 14:43:06 2018
From: luke-tier@ey m@ili@g off uiow@@edu (luke-tier@ey m@ili@g off uiow@@edu)
Date: Thu, 26 Jul 2018 07:43:06 -0500 (CDT)
Subject: [Rd] 
 Possible bug: R --slave --interactive stdin echo on Linux when
 stdin is a fifo
In-Reply-To: <CABtg=KnbkMSCgAYeiuOGJ3-kOgjc4McPhw2skS-6eyydCf8N0A@mail.gmail.com>
References: <f85c602f061144619f89a71b5f056a04@AM6PR04MB4264.eurprd04.prod.outlook.com>
 <CANVKczMGuQ0n1XKRu5=sRqeTOxmA52wOeLTrff9kV8N3LcgJ-Q@mail.gmail.com>
 <CABtg=KnbkMSCgAYeiuOGJ3-kOgjc4McPhw2skS-6eyydCf8N0A@mail.gmail.com>
Message-ID: <alpine.DEB.2.20.1807260738270.3311@luke-Latitude-7480>

On Thu, 26 Jul 2018, G?bor Cs?rdi wrote:

> On Thu, Jul 26, 2018 at 12:25 PM Barry Rowlingson
> <b.rowlingson at lancaster.ac.uk> wrote:
>>
>> On Thu, Jul 26, 2018 at 12:22 AM, G?bor Cs?rdi <csardi.gabor at gmail.com> wrote:
>>> I am trying to control a background R session, connected via a fifo /
>>> named pipe.
>>
>>  Is the fifo significant here? If I read the same R code from a file
>> via `<` I get the input echoed (R 3.4.4, Ubuntu).
>
> Yeah, for a file I get echo on both macOS and Linux, but not on Windows.
>
> I think the most useful behavior for --slave is no echo at all, maybe?
> But I might be missing the motivation behind --slave.
>
> Another thing is that windows does not have --interactive. Is there a
> way to run R
> 1) without echoing stdin, and

I'm not seeing an echo for your example on Ubuntu or Fedora.

> 2) without quitting on the first error,
> on all platforms?

One option is to use

     options(error = function() invokeRestart("abort"))

There may be better ways.

Best,

luke

>
> Gabor
>
>> Barry
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Luke Tierney
Ralph E. Wareham Professor of Mathematical Sciences
University of Iowa                  Phone:             319-335-3386
Department of Statistics and        Fax:               319-335-3017
    Actuarial Science
241 Schaeffer Hall                  email:   luke-tierney at uiowa.edu
Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu

From c@@rdi@g@bor @ending from gm@il@com  Thu Jul 26 14:54:49 2018
From: c@@rdi@g@bor @ending from gm@il@com (=?UTF-8?B?R8OhYm9yIENzw6FyZGk=?=)
Date: Thu, 26 Jul 2018 13:54:49 +0100
Subject: [Rd] 
 Possible bug: R --slave --interactive stdin echo on Linux when
 stdin is a fifo
In-Reply-To: <alpine.DEB.2.20.1807260738270.3311@luke-Latitude-7480>
References: <f85c602f061144619f89a71b5f056a04@AM6PR04MB4264.eurprd04.prod.outlook.com>
 <CANVKczMGuQ0n1XKRu5=sRqeTOxmA52wOeLTrff9kV8N3LcgJ-Q@mail.gmail.com>
 <CABtg=KnbkMSCgAYeiuOGJ3-kOgjc4McPhw2skS-6eyydCf8N0A@mail.gmail.com>
 <alpine.DEB.2.20.1807260738270.3311@luke-Latitude-7480>
Message-ID: <CABtg=K=Sk+P8uJMJNSRQoTh180P_R6B3AZ45DK9miUPcFvZy_w@mail.gmail.com>

On Thu, Jul 26, 2018 at 1:43 PM <luke-tierney at uiowa.edu> wrote:
>
> On Thu, 26 Jul 2018, G?bor Cs?rdi wrote:
>
> > On Thu, Jul 26, 2018 at 12:25 PM Barry Rowlingson
> > <b.rowlingson at lancaster.ac.uk> wrote:
> >>
> >> On Thu, Jul 26, 2018 at 12:22 AM, G?bor Cs?rdi <csardi.gabor at gmail.com> wrote:
> >>> I am trying to control a background R session, connected via a fifo /
> >>> named pipe.
> >>
> >>  Is the fifo significant here? If I read the same R code from a file
> >> via `<` I get the input echoed (R 3.4.4, Ubuntu).
> >
> > Yeah, for a file I get echo on both macOS and Linux, but not on Windows.
> >
> > I think the most useful behavior for --slave is no echo at all, maybe?
> > But I might be missing the motivation behind --slave.
> >
> > Another thing is that windows does not have --interactive. Is there a
> > way to run R
> > 1) without echoing stdin, and
>
> I'm not seeing an echo for your example on Ubuntu or Fedora.

Interesting. Do you mean the fifo example, or just a file? Or both?
I wonder what this depends on then....

Particularly interesting that this does echo on macOS:
echo '1+1' | R --slave --interactive
But the FIFO example does not.

Anyway, it seems that if I remove --interactive then I get no echo.

> > 2) without quitting on the first error,
> > on all platforms?
>
> One option is to use
>
>      options(error = function() invokeRestart("abort"))

This seems good enough for my use case, thanks much!
Luckily, this also solves the "disabling the crash dialog" problem, which I
have if I specify --interactive.

Gabor

> There may be better ways.
>
> Best,
>
> luke
>
> >
> > Gabor
> >
> >> Barry
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >
>
> --
> Luke Tierney
> Ralph E. Wareham Professor of Mathematical Sciences
> University of Iowa                  Phone:             319-335-3386
> Department of Statistics and        Fax:               319-335-3017
>     Actuarial Science
> 241 Schaeffer Hall                  email:   luke-tierney at uiowa.edu
> Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu


From luke-tier@ey m@ili@g off uiow@@edu  Thu Jul 26 15:47:20 2018
From: luke-tier@ey m@ili@g off uiow@@edu (luke-tier@ey m@ili@g off uiow@@edu)
Date: Thu, 26 Jul 2018 08:47:20 -0500 (CDT)
Subject: [Rd] 
 Possible bug: R --slave --interactive stdin echo on Linux when
 stdin is a fifo
In-Reply-To: <CABtg=K=Sk+P8uJMJNSRQoTh180P_R6B3AZ45DK9miUPcFvZy_w@mail.gmail.com>
References: <f85c602f061144619f89a71b5f056a04@AM6PR04MB4264.eurprd04.prod.outlook.com>
 <CANVKczMGuQ0n1XKRu5=sRqeTOxmA52wOeLTrff9kV8N3LcgJ-Q@mail.gmail.com>
 <CABtg=KnbkMSCgAYeiuOGJ3-kOgjc4McPhw2skS-6eyydCf8N0A@mail.gmail.com>
 <alpine.DEB.2.20.1807260738270.3311@luke-Latitude-7480>
 <CABtg=K=Sk+P8uJMJNSRQoTh180P_R6B3AZ45DK9miUPcFvZy_w@mail.gmail.com>
Message-ID: <alpine.OSX.2.21.1807260824130.1437@lukes-macbook-air.local>

On Thu, 26 Jul 2018, G?bor Cs?rdi wrote:

> On Thu, Jul 26, 2018 at 1:43 PM <luke-tierney at uiowa.edu> wrote:
>>
>> On Thu, 26 Jul 2018, G?bor Cs?rdi wrote:
>>
>>> On Thu, Jul 26, 2018 at 12:25 PM Barry Rowlingson
>>> <b.rowlingson at lancaster.ac.uk> wrote:
>>>>
>>>> On Thu, Jul 26, 2018 at 12:22 AM, G?bor Cs?rdi <csardi.gabor at gmail.com> wrote:
>>>>> I am trying to control a background R session, connected via a fifo /
>>>>> named pipe.
>>>>
>>>>  Is the fifo significant here? If I read the same R code from a file
>>>> via `<` I get the input echoed (R 3.4.4, Ubuntu).
>>>
>>> Yeah, for a file I get echo on both macOS and Linux, but not on Windows.
>>>
>>> I think the most useful behavior for --slave is no echo at all, maybe?
>>> But I might be missing the motivation behind --slave.
>>>
>>> Another thing is that windows does not have --interactive. Is there a
>>> way to run R
>>> 1) without echoing stdin, and
>>
>> I'm not seeing an echo for your example on Ubuntu or Fedora.
>
> Interesting. Do you mean the fifo example, or just a file? Or both?
> I wonder what this depends on then....

The fifo one -- I didn't try a file.

>
> Particularly interesting that this does echo on macOS:
> echo '1+1' | R --slave --interactive
> But the FIFO example does not.
>
> Anyway, it seems that if I remove --interactive then I get no echo.

Looks like this has to do with readline, which --interactive turns on.
If I use '--no-readline --interactive' (in that order) on Mac OS and
Linux I get no echo.

The code in R for all this should be identical on Linux and Mac OS --
both use the unix code. readline libraries may differ, shell/stty
settings may differ for your setup.

Best,

luke

>
>>> 2) without quitting on the first error,
>>> on all platforms?
>>
>> One option is to use
>>
>>      options(error = function() invokeRestart("abort"))
>
> This seems good enough for my use case, thanks much!
> Luckily, this also solves the "disabling the crash dialog" problem, which I
> have if I specify --interactive.
>
> Gabor
>
>> There may be better ways.
>>
>> Best,
>>
>> luke
>>
>>>
>>> Gabor
>>>
>>>> Barry
>>>
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>
>> --
>> Luke Tierney
>> Ralph E. Wareham Professor of Mathematical Sciences
>> University of Iowa                  Phone:             319-335-3386
>> Department of Statistics and        Fax:               319-335-3017
>>     Actuarial Science
>> 241 Schaeffer Hall                  email:   luke-tierney at uiowa.edu
>> Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu
>

-- 
Luke Tierney
Ralph E. Wareham Professor of Mathematical Sciences
University of Iowa                  Phone:             319-335-3386
Department of Statistics and        Fax:               319-335-3017
    Actuarial Science
241 Schaeffer Hall                  email:   luke-tierney at uiowa.edu
Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu

From c@@rdi@g@bor @ending from gm@il@com  Thu Jul 26 15:55:43 2018
From: c@@rdi@g@bor @ending from gm@il@com (=?UTF-8?B?R8OhYm9yIENzw6FyZGk=?=)
Date: Thu, 26 Jul 2018 14:55:43 +0100
Subject: [Rd] 
 Possible bug: R --slave --interactive stdin echo on Linux when
 stdin is a fifo
In-Reply-To: <alpine.OSX.2.21.1807260824130.1437@lukes-macbook-air.local>
References: <f85c602f061144619f89a71b5f056a04@AM6PR04MB4264.eurprd04.prod.outlook.com>
 <CANVKczMGuQ0n1XKRu5=sRqeTOxmA52wOeLTrff9kV8N3LcgJ-Q@mail.gmail.com>
 <CABtg=KnbkMSCgAYeiuOGJ3-kOgjc4McPhw2skS-6eyydCf8N0A@mail.gmail.com>
 <alpine.DEB.2.20.1807260738270.3311@luke-Latitude-7480>
 <CABtg=K=Sk+P8uJMJNSRQoTh180P_R6B3AZ45DK9miUPcFvZy_w@mail.gmail.com>
 <alpine.OSX.2.21.1807260824130.1437@lukes-macbook-air.local>
Message-ID: <CABtg=KnQy=STdfdjFh0kjof318vxyc9XXgP4ZwCsQpr_F_8Kwg@mail.gmail.com>

On Thu, Jul 26, 2018 at 2:47 PM <luke-tierney at uiowa.edu> wrote:
[...]
> Looks like this has to do with readline, which --interactive turns on.
> If I use '--no-readline --interactive' (in that order) on Mac OS and
> Linux I get no echo.

Great! Makes sense. Thanks much.

G.

[...]


From thib@ult@v@tter @ending from gm@il@com  Thu Jul 26 20:37:36 2018
From: thib@ult@v@tter @ending from gm@il@com (Thibault Vatter)
Date: Thu, 26 Jul 2018 14:37:36 -0400
Subject: [Rd] Random behavior of mclapply
Message-ID: <CAFyih6CkMstJXQrg2fL6K015qUsbLj23tbCY+RgijA-92iYzLg@mail.gmail.com>

Hi,

I wondered about the behavior described in the following stackoverflow
question:

https://stackoverflow.com/questions/20674538/mclapply-returns-null-randomly

More specifically, I would like to know if you ever considered the
suggestion made in the comments of the first answer, namely to somehow warn
the user if one of the processes has been killed by the out-of-memory
killer ?

I am always surprised to see the random NULLs without message/warning/error
of any kind, and I think that it could be a useful feature to know whether
the function executed by mclapply returned a NULL or if the process was
killed for some reason.

In the following gist, I have an example of this (in this case non-random)
behavior:

https://gist.github.com/tvatter/2fcf3a9a99c256f9b9360f596b300715

For the record, I generate the list of NULLs in the 4th mclapply in the
girst above with a late 2013 macbook pro with macOS High Sierra, 16GB of
memory, and my sessionInfo() is:

R version 3.5.0 (2018-04-23)
Platform: x86_64-apple-darwin16.7.0 (64-bit)
Running under: macOS High Sierra 10.13.6

Matrix products: default
BLAS:
/System/Library/Frameworks/Accelerate.framework/Versions/A/Frameworks/vecLib.framework/Versions/A/libBLAS.dylib
LAPACK:
/System/Library/Frameworks/Accelerate.framework/Versions/A/Frameworks/vecLib.framework/Versions/A/libLAPACK.dylib

locale:
[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8

attached base packages:
[1] parallel  stats     graphics  grDevices utils     datasets  methods
 base

loaded via a namespace (and not attached):
[1] compiler_3.5.0 tools_3.5.0    yaml_2.1.19

------------------------------------------------------------
Thibault Vatter
Department of Statistics
Columbia University

	[[alternative HTML version deleted]]


From c@@rdi@g@bor @ending from gm@il@com  Sat Jul 28 18:30:28 2018
From: c@@rdi@g@bor @ending from gm@il@com (=?UTF-8?B?R8OhYm9yIENzw6FyZGk=?=)
Date: Sat, 28 Jul 2018 17:30:28 +0100
Subject: [Rd] re-throwing an interrupt condition
Message-ID: <CABtg=Knd2fmhRZcokroQmV8yv_p_X3OKRWtfwiRrhb-5YJMfpg@mail.gmail.com>

Anyone knows a way to re-throw a caught interrupt condition, so that
it behaves just like the original one? I.e. no error message is
printed, but the execution is stopped of course. With just calling
stop in the error handler, it prints the error message, or, if there
is no error message (like in the original interrupt condition),
another error happens.

tryCatch(Sys.sleep(100), interrupt = function(e) {  e$message <-
"interrupted"; stop(e) } )
<press CTRL + C / ESC here>
#> Error: interrupted

tryCatch(Sys.sleep(100), interrupt = function(e) stop(e))
<press CTRL + C / ESC here>
#> Error in stop(e) : bad error message

Thanks,
Gabor


From i@uc@r86 @ending from gm@il@com  Sat Jul 28 18:59:43 2018
From: i@uc@r86 @ending from gm@il@com (=?UTF-8?B?ScOxYWtpIMOaY2Fy?=)
Date: Sat, 28 Jul 2018 18:59:43 +0200
Subject: [Rd] re-throwing an interrupt condition
In-Reply-To: <CABtg=Knd2fmhRZcokroQmV8yv_p_X3OKRWtfwiRrhb-5YJMfpg@mail.gmail.com>
References: <CABtg=Knd2fmhRZcokroQmV8yv_p_X3OKRWtfwiRrhb-5YJMfpg@mail.gmail.com>
Message-ID: <CALEXWq0aNQR7FG7pSiDbcMuUTG6c1K2sF-GK-GeGaeVOv=Y=Kw@mail.gmail.com>

El s?b., 28 jul. 2018 a las 18:30, G?bor Cs?rdi
(<csardi.gabor at gmail.com>) escribi?:
>
> Anyone knows a way to re-throw a caught interrupt condition, so that
> it behaves just like the original one? I.e. no error message is
> printed, but the execution is stopped of course. With just calling
> stop in the error handler, it prints the error message, or, if there
> is no error message (like in the original interrupt condition),
> another error happens.
>
> tryCatch(Sys.sleep(100), interrupt = function(e) {  e$message <-
> "interrupted"; stop(e) } )
> <press CTRL + C / ESC here>
> #> Error: interrupted
>
> tryCatch(Sys.sleep(100), interrupt = function(e) stop(e))
> <press CTRL + C / ESC here>
> #> Error in stop(e) : bad error message

Sorry, I probably misunderstood your intention, but... simply by not
calling stop at all? This is what I see:

> tryCatch(Sys.sleep(100), interrupt = function(e) do_something <<- 1)
<press CTRL + C / ESC here>
^C>
> do_something
[1] 1

I?aki


From t@m@@@ferenci @ending from med@t@t@hu  Sat Jul 28 18:44:59 2018
From: t@m@@@ferenci @ending from med@t@t@hu (Ferenci Tamas)
Date: Sat, 28 Jul 2018 18:44:59 +0200
Subject: [Rd] possible bug in plot.intervals.lmList
Message-ID: <406904256.20180728184459@medstat.hu>

Dear R-devel members,

I think I've found a minor bug in plot.intervals.lmList. ( The guide
https://www.r-project.org/bugs.html suggests to report it here, as I
do not have a bugzilla account.)

Here is a minimal reproducible example to demonstrate the problem:

fm1 <- lmList(distance ~ age | Subject, Orthodont)
plot(intervals(fm1),ylab="a")

This results in: "Error in bwplot.formula(x = group ~ intervals |
what, data = list(group = c(1L,  :   formal argument "ylab" matched by
multiple actual arguments".

I am not an experienced R programmer at that level, but I think the
problem is due to the fact that ylab is explicitly passed as an
argument to dotplot *and* the ... is also passed (which will also
include ylab in the above example).

Tamas


From c@@rdi@g@bor @ending from gm@il@com  Sat Jul 28 19:25:53 2018
From: c@@rdi@g@bor @ending from gm@il@com (=?UTF-8?B?R8OhYm9yIENzw6FyZGk=?=)
Date: Sat, 28 Jul 2018 18:25:53 +0100
Subject: [Rd] re-throwing an interrupt condition
In-Reply-To: <CALEXWq0aNQR7FG7pSiDbcMuUTG6c1K2sF-GK-GeGaeVOv=Y=Kw@mail.gmail.com>
References: <CABtg=Knd2fmhRZcokroQmV8yv_p_X3OKRWtfwiRrhb-5YJMfpg@mail.gmail.com>
 <CALEXWq0aNQR7FG7pSiDbcMuUTG6c1K2sF-GK-GeGaeVOv=Y=Kw@mail.gmail.com>
Message-ID: <CABtg=KkzVQEH0ryq5YrTg9mr=pQ71EGQgL32afJ+qY0nvFqZMQ@mail.gmail.com>

I don't want to return a value, I want to interrupt the computation,
that's why I need to re-throw .
But before getting back to the user I want to run some cleanup code.

G.
On Sat, Jul 28, 2018 at 5:59 PM I?aki ?car <i.ucar86 at gmail.com> wrote:
>
> El s?b., 28 jul. 2018 a las 18:30, G?bor Cs?rdi
> (<csardi.gabor at gmail.com>) escribi?:
> >
> > Anyone knows a way to re-throw a caught interrupt condition, so that
> > it behaves just like the original one? I.e. no error message is
> > printed, but the execution is stopped of course. With just calling
> > stop in the error handler, it prints the error message, or, if there
> > is no error message (like in the original interrupt condition),
> > another error happens.
> >
> > tryCatch(Sys.sleep(100), interrupt = function(e) {  e$message <-
> > "interrupted"; stop(e) } )
> > <press CTRL + C / ESC here>
> > #> Error: interrupted
> >
> > tryCatch(Sys.sleep(100), interrupt = function(e) stop(e))
> > <press CTRL + C / ESC here>
> > #> Error in stop(e) : bad error message
>
> Sorry, I probably misunderstood your intention, but... simply by not
> calling stop at all? This is what I see:
>
> > tryCatch(Sys.sleep(100), interrupt = function(e) do_something <<- 1)
> <press CTRL + C / ESC here>
> ^C>
> > do_something
> [1] 1
>
> I?aki


From luke-tier@ey m@ili@g off uiow@@edu  Sat Jul 28 19:37:33 2018
From: luke-tier@ey m@ili@g off uiow@@edu (luke-tier@ey m@ili@g off uiow@@edu)
Date: Sat, 28 Jul 2018 12:37:33 -0500 (CDT)
Subject: [Rd] re-throwing an interrupt condition
In-Reply-To: <CABtg=Knd2fmhRZcokroQmV8yv_p_X3OKRWtfwiRrhb-5YJMfpg@mail.gmail.com>
References: <CABtg=Knd2fmhRZcokroQmV8yv_p_X3OKRWtfwiRrhb-5YJMfpg@mail.gmail.com>
Message-ID: <alpine.DEB.2.20.1807281230170.3311@luke-Latitude-7480>

The internal code does more or less

     signalCondition(e)     ## allows for (another) handler
     cat("\n")              ## cleans up console
     invokeRestart("abort") ## jump to 'abort' restart if not handled

[for back compatibility it also runs the error option code if that is
set, but that may go away eventually].

A version of your example:

> {
+     tryCatch(Sys.sleep(100),
+              interrupt = function(e) {
+                  e$message <- "interrupted"
+                  signalCondition(e)
+                  cat("\n")
+                  invokeRestart("abort")
+     })
+     cat("next step\n")
+ }
^C
>

Best,

luke

On Sat, 28 Jul 2018, G?bor Cs?rdi wrote:

> Anyone knows a way to re-throw a caught interrupt condition, so that
> it behaves just like the original one? I.e. no error message is
> printed, but the execution is stopped of course. With just calling
> stop in the error handler, it prints the error message, or, if there
> is no error message (like in the original interrupt condition),
> another error happens.
>
> tryCatch(Sys.sleep(100), interrupt = function(e) {  e$message <-
> "interrupted"; stop(e) } )
> <press CTRL + C / ESC here>
> #> Error: interrupted
>
> tryCatch(Sys.sleep(100), interrupt = function(e) stop(e))
> <press CTRL + C / ESC here>
> #> Error in stop(e) : bad error message
>
> Thanks,
> Gabor
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Luke Tierney
Ralph E. Wareham Professor of Mathematical Sciences
University of Iowa                  Phone:             319-335-3386
Department of Statistics and        Fax:               319-335-3017
    Actuarial Science
241 Schaeffer Hall                  email:   luke-tierney at uiowa.edu
Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu

From c@@rdi@g@bor @ending from gm@il@com  Sat Jul 28 19:40:30 2018
From: c@@rdi@g@bor @ending from gm@il@com (=?UTF-8?B?R8OhYm9yIENzw6FyZGk=?=)
Date: Sat, 28 Jul 2018 18:40:30 +0100
Subject: [Rd] re-throwing an interrupt condition
In-Reply-To: <alpine.DEB.2.20.1807281230170.3311@luke-Latitude-7480>
References: <CABtg=Knd2fmhRZcokroQmV8yv_p_X3OKRWtfwiRrhb-5YJMfpg@mail.gmail.com>
 <alpine.DEB.2.20.1807281230170.3311@luke-Latitude-7480>
Message-ID: <CABtg=K=VSpVTN1AOGHi7rJYgrVHd7Lh0gGZ+vv7D-4h8CBVcBA@mail.gmail.com>

Great! invokeRestart("abort") is a life saver again, the second time this week!

Thanks much!

Gabor

On Sat, Jul 28, 2018 at 6:37 PM <luke-tierney at uiowa.edu> wrote:
>
> The internal code does more or less
>
>      signalCondition(e)     ## allows for (another) handler
>      cat("\n")              ## cleans up console
>      invokeRestart("abort") ## jump to 'abort' restart if not handled
>
> [for back compatibility it also runs the error option code if that is
> set, but that may go away eventually].
>
> A version of your example:
>
> > {
> +     tryCatch(Sys.sleep(100),
> +              interrupt = function(e) {
> +                  e$message <- "interrupted"
> +                  signalCondition(e)
> +                  cat("\n")
> +                  invokeRestart("abort")
> +     })
> +     cat("next step\n")
> + }
> ^C
> >
>
> Best,
>
> luke
>
> On Sat, 28 Jul 2018, G?bor Cs?rdi wrote:
>
> > Anyone knows a way to re-throw a caught interrupt condition, so that
> > it behaves just like the original one? I.e. no error message is
> > printed, but the execution is stopped of course. With just calling
> > stop in the error handler, it prints the error message, or, if there
> > is no error message (like in the original interrupt condition),
> > another error happens.
> >
> > tryCatch(Sys.sleep(100), interrupt = function(e) {  e$message <-
> > "interrupted"; stop(e) } )
> > <press CTRL + C / ESC here>
> > #> Error: interrupted
> >
> > tryCatch(Sys.sleep(100), interrupt = function(e) stop(e))
> > <press CTRL + C / ESC here>
> > #> Error in stop(e) : bad error message
> >
> > Thanks,
> > Gabor
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >
>
> --
> Luke Tierney
> Ralph E. Wareham Professor of Mathematical Sciences
> University of Iowa                  Phone:             319-335-3386
> Department of Statistics and        Fax:               319-335-3017
>     Actuarial Science
> 241 Schaeffer Hall                  email:   luke-tierney at uiowa.edu
> Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu


From luke-tier@ey m@ili@g off uiow@@edu  Sat Jul 28 19:43:37 2018
From: luke-tier@ey m@ili@g off uiow@@edu (luke-tier@ey m@ili@g off uiow@@edu)
Date: Sat, 28 Jul 2018 12:43:37 -0500 (CDT)
Subject: [Rd] re-throwing an interrupt condition
In-Reply-To: <CABtg=KkzVQEH0ryq5YrTg9mr=pQ71EGQgL32afJ+qY0nvFqZMQ@mail.gmail.com>
References: <CABtg=Knd2fmhRZcokroQmV8yv_p_X3OKRWtfwiRrhb-5YJMfpg@mail.gmail.com>
 <CALEXWq0aNQR7FG7pSiDbcMuUTG6c1K2sF-GK-GeGaeVOv=Y=Kw@mail.gmail.com>
 <CABtg=KkzVQEH0ryq5YrTg9mr=pQ71EGQgL32afJ+qY0nvFqZMQ@mail.gmail.com>
Message-ID: <alpine.DEB.2.20.1807281238100.3311@luke-Latitude-7480>

On Sat, 28 Jul 2018, G?bor Cs?rdi wrote:

> I don't want to return a value, I want to interrupt the computation,
> that's why I need to re-throw .
> But before getting back to the user I want to run some cleanup code.

If it is just cleanup you want then a finally clause or on.exit should
do, and will cover all form of non-local transfer of control.

Best,

luke

>
> G.
> On Sat, Jul 28, 2018 at 5:59 PM I?aki ?car <i.ucar86 at gmail.com> wrote:
>>
>> El s?b., 28 jul. 2018 a las 18:30, G?bor Cs?rdi
>> (<csardi.gabor at gmail.com>) escribi?:
>>>
>>> Anyone knows a way to re-throw a caught interrupt condition, so that
>>> it behaves just like the original one? I.e. no error message is
>>> printed, but the execution is stopped of course. With just calling
>>> stop in the error handler, it prints the error message, or, if there
>>> is no error message (like in the original interrupt condition),
>>> another error happens.
>>>
>>> tryCatch(Sys.sleep(100), interrupt = function(e) {  e$message <-
>>> "interrupted"; stop(e) } )
>>> <press CTRL + C / ESC here>
>>> #> Error: interrupted
>>>
>>> tryCatch(Sys.sleep(100), interrupt = function(e) stop(e))
>>> <press CTRL + C / ESC here>
>>> #> Error in stop(e) : bad error message
>>
>> Sorry, I probably misunderstood your intention, but... simply by not
>> calling stop at all? This is what I see:
>>
>>> tryCatch(Sys.sleep(100), interrupt = function(e) do_something <<- 1)
>> <press CTRL + C / ESC here>
>> ^C>
>>> do_something
>> [1] 1
>>
>> I?aki
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Luke Tierney
Ralph E. Wareham Professor of Mathematical Sciences
University of Iowa                  Phone:             319-335-3386
Department of Statistics and        Fax:               319-335-3017
    Actuarial Science
241 Schaeffer Hall                  email:   luke-tierney at uiowa.edu
Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu

From c@@rdi@g@bor @ending from gm@il@com  Sat Jul 28 19:51:11 2018
From: c@@rdi@g@bor @ending from gm@il@com (=?UTF-8?B?R8OhYm9yIENzw6FyZGk=?=)
Date: Sat, 28 Jul 2018 18:51:11 +0100
Subject: [Rd] re-throwing an interrupt condition
In-Reply-To: <alpine.DEB.2.20.1807281238100.3311@luke-Latitude-7480>
References: <CABtg=Knd2fmhRZcokroQmV8yv_p_X3OKRWtfwiRrhb-5YJMfpg@mail.gmail.com>
 <CALEXWq0aNQR7FG7pSiDbcMuUTG6c1K2sF-GK-GeGaeVOv=Y=Kw@mail.gmail.com>
 <CABtg=KkzVQEH0ryq5YrTg9mr=pQ71EGQgL32afJ+qY0nvFqZMQ@mail.gmail.com>
 <alpine.DEB.2.20.1807281238100.3311@luke-Latitude-7480>
Message-ID: <CABtg=K=XxCBP5tsLviREHqbO47bdq-tm=jmB3ogHfd+=p8ZOxg@mail.gmail.com>

Good points. In my case I also want to add an extra class to the
condition, before re-throwing it.
Sorry, this was not clear in my first email, I actually just realized it now.

Gabor
On Sat, Jul 28, 2018 at 6:43 PM <luke-tierney at uiowa.edu> wrote:
>
> On Sat, 28 Jul 2018, G?bor Cs?rdi wrote:
>
> > I don't want to return a value, I want to interrupt the computation,
> > that's why I need to re-throw .
> > But before getting back to the user I want to run some cleanup code.
>
> If it is just cleanup you want then a finally clause or on.exit should
> do, and will cover all form of non-local transfer of control.
>
> Best,
>
> luke
>
> >
> > G.
> > On Sat, Jul 28, 2018 at 5:59 PM I?aki ?car <i.ucar86 at gmail.com> wrote:
> >>
> >> El s?b., 28 jul. 2018 a las 18:30, G?bor Cs?rdi
> >> (<csardi.gabor at gmail.com>) escribi?:
> >>>
> >>> Anyone knows a way to re-throw a caught interrupt condition, so that
> >>> it behaves just like the original one? I.e. no error message is
> >>> printed, but the execution is stopped of course. With just calling
> >>> stop in the error handler, it prints the error message, or, if there
> >>> is no error message (like in the original interrupt condition),
> >>> another error happens.
> >>>
> >>> tryCatch(Sys.sleep(100), interrupt = function(e) {  e$message <-
> >>> "interrupted"; stop(e) } )
> >>> <press CTRL + C / ESC here>
> >>> #> Error: interrupted
> >>>
> >>> tryCatch(Sys.sleep(100), interrupt = function(e) stop(e))
> >>> <press CTRL + C / ESC here>
> >>> #> Error in stop(e) : bad error message
> >>
> >> Sorry, I probably misunderstood your intention, but... simply by not
> >> calling stop at all? This is what I see:
> >>
> >>> tryCatch(Sys.sleep(100), interrupt = function(e) do_something <<- 1)
> >> <press CTRL + C / ESC here>
> >> ^C>
> >>> do_something
> >> [1] 1
> >>
> >> I?aki
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >
>
> --
> Luke Tierney
> Ralph E. Wareham Professor of Mathematical Sciences
> University of Iowa                  Phone:             319-335-3386
> Department of Statistics and        Fax:               319-335-3017
>     Actuarial Science
> 241 Schaeffer Hall                  email:   luke-tierney at uiowa.edu
> Iowa City, IA 52242                 WWW:  http://www.stat.uiowa.edu


From ggrothendieck @ending from gm@il@com  Sun Jul 29 15:31:57 2018
From: ggrothendieck @ending from gm@il@com (Gabor Grothendieck)
Date: Sun, 29 Jul 2018 09:31:57 -0400
Subject: [Rd] odd behavior of names
Message-ID: <CAP01uR=K40ZD9M=wMdtAh77pyOd-4B39dcDzhE4Jdeh4XPDCrg@mail.gmail.com>

The first component name has backticks around it and the second does
not. Though not wrong, it seems inconsistent.

list(a = 1, b = 2)
## $`a`
## [1] 1
##
## $b
## [1] 2

R.version.string
## [1] "R version 3.5.1 Patched (2018-07-02 r74950)"



-- 
Statistics & Software Consulting
GKX Group, GKX Associates Inc.
tel: 1-877-GKX-GROUP
email: ggrothendieck at gmail.com


From dwin@emiu@ @ending from comc@@t@net  Sun Jul 29 17:45:52 2018
From: dwin@emiu@ @ending from comc@@t@net (David Winsemius)
Date: Sun, 29 Jul 2018 08:45:52 -0700
Subject: [Rd] odd behavior of names
In-Reply-To: <CAP01uR=K40ZD9M=wMdtAh77pyOd-4B39dcDzhE4Jdeh4XPDCrg@mail.gmail.com>
References: <CAP01uR=K40ZD9M=wMdtAh77pyOd-4B39dcDzhE4Jdeh4XPDCrg@mail.gmail.com>
Message-ID: <CCAD7D06-AC31-483A-90C9-756C0F402247@comcast.net>


> On Jul 29, 2018, at 6:31 AM, Gabor Grothendieck <ggrothendieck at gmail.com> wrote:
> 
> The first component name has backticks around it and the second does
> not. Though not wrong, it seems inconsistent.
> 
> list(a = 1, b = 2)
> ## $`a`
> ## [1] 1
> ##
> ## $b
> ## [1] 2
> 
> R.version.string
> ## [1] "R version 3.5.1 Patched (2018-07-02 r74950)"

Agree it would be unexpected. Unable to reproduce on Mac:

list(a = 1, b = 2)
#------
$a
[1] 1

$b
[1] 2

 R.version.string
#[1] "R version 3.5.1 (2018-07-02)"
Platform: x86_64-apple-darwin15.6.0 (64-bit)


> 
> 
> 
> -- 
> Statistics & Software Consulting
> GKX Group, GKX Associates Inc.
> tel: 1-877-GKX-GROUP
> email: ggrothendieck at gmail.com
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

David Winsemius
Alameda, CA, USA

'Any technology distinguishable from magic is insufficiently advanced.'   -Gehm's Corollary to Clarke's Third Law


From wdunl@p @ending from tibco@com  Sun Jul 29 19:06:40 2018
From: wdunl@p @ending from tibco@com (William Dunlap)
Date: Sun, 29 Jul 2018 10:06:40 -0700
Subject: [Rd] odd behavior of names
In-Reply-To: <CCAD7D06-AC31-483A-90C9-756C0F402247@comcast.net>
References: <CAP01uR=K40ZD9M=wMdtAh77pyOd-4B39dcDzhE4Jdeh4XPDCrg@mail.gmail.com>
 <CCAD7D06-AC31-483A-90C9-756C0F402247@comcast.net>
Message-ID: <CAF8bMcZYoaN02TpYh2O=1zYWyjynHti2gga1O0pfdkrgKAojFg@mail.gmail.com>

Bugzilla issue 16101 describes another first-list-name-printed-differently
oddity
with the Windows GUI version of R:

> a <- "One is \u043E\u0434\u0438\u043D\nTwo is \u0434\u0432\u0430\n"
> Encoding(a) # expect "UTF-8"
[1] "UTF-8"
> sapply(strsplit(a, "\n")[[1]], charToRaw)[c(1,1,2)]
$`One is ????`
 [1] 4f 6e 65 20 69 73 20 d0 be d0 b4 d0
[13] b8 d0 bd

$`One is <U+043E><U+0434><U+0438><U+043D>`
 [1] 4f 6e 65 20 69 73 20 d0 be d0 b4 d0
[13] b8 d0 bd

$`Two is <U+0434><U+0432><U+0430>`
 [1] 54 77 6f 20 69 73 20 d0 b4 d0 b2 d0
[13] b0

> names(.Last.value)
[1] "One is ????" "One is ????"
[3] "Two is ???"





Bill Dunlap
TIBCO Software
wdunlap tibco.com

On Sun, Jul 29, 2018 at 8:45 AM, David Winsemius <dwinsemius at comcast.net>
wrote:

>
> > On Jul 29, 2018, at 6:31 AM, Gabor Grothendieck <ggrothendieck at gmail.com>
> wrote:
> >
> > The first component name has backticks around it and the second does
> > not. Though not wrong, it seems inconsistent.
> >
> > list(a = 1, b = 2)
> > ## $`a`
> > ## [1] 1
> > ##
> > ## $b
> > ## [1] 2
> >
> > R.version.string
> > ## [1] "R version 3.5.1 Patched (2018-07-02 r74950)"
>
> Agree it would be unexpected. Unable to reproduce on Mac:
>
> list(a = 1, b = 2)
> #------
> $a
> [1] 1
>
> $b
> [1] 2
>
>  R.version.string
> #[1] "R version 3.5.1 (2018-07-02)"
> Platform: x86_64-apple-darwin15.6.0 (64-bit)
>
>
> >
> >
> >
> > --
> > Statistics & Software Consulting
> > GKX Group, GKX Associates Inc.
> > tel: 1-877-GKX-GROUP
> > email: ggrothendieck at gmail.com
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
>
> David Winsemius
> Alameda, CA, USA
>
> 'Any technology distinguishable from magic is insufficiently advanced.'
>  -Gehm's Corollary to Clarke's Third Law
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

	[[alternative HTML version deleted]]


From @tephenforpre@ident @ending from gm@il@com  Mon Jul 30 02:02:38 2018
From: @tephenforpre@ident @ending from gm@il@com (Stephen Marsh)
Date: Sun, 29 Jul 2018 20:02:38 -0400
Subject: [Rd] Possible To Enable Building R With Cairo But Without X11
 Dependencies?
In-Reply-To: <23385.9553.581811.803017@rob.eddelbuettel.com>
References: <CAP1gB3dPwmpXCORG11PTKB2by5CJj0LxpHosbAj=G_6Y8m7QXA@mail.gmail.com>
 <23385.9553.581811.803017@rob.eddelbuettel.com>
Message-ID: <CAP1gB3dXLcBBXZjb1VzdxUfWmwds7bs9Rw4PjowfmPwPpEDS3A@mail.gmail.com>

Thanks for the reply, Dirk.  It sounds like xvfb-run is a great solution
when you want R to assume an X window system is present but isn?t?

I think what I'm trying to figure out, and propose for the community to
possibly fix, is slightly different than would be solved by xvfb-run.

I'm wondering if --with-cairo presents a design flaw (maybe an abstraction
inversion https://en.wikipedia.org/wiki/Abstraction_inversion) wherein the
window system is taken for granted to be X and there is no way to change
it/use Cairo differently?

This has at least two consequences that I understand:
  - Most importantly, it makes --with-cairo silently incompatible with
--without-x.  If this is really intended, I think it should at least raise
a warning?
  - I think it also means, (as far as I know, but could well be wrong),
that there is not a way to use R where you rely solely Cairo?s rendering
abilities to replace the complexity of needing a specific window system
present? (This is my use case -- use cairo so R can be agnostic about a
window system).

Given that the earlier conversations made a fix sound rather trivial (use
cairo.h instead of cairo-xlib.h), I?m wondering if there is a path to
getting that implemented?

Thanks a lot,
-Stephen Marsh

On Wed, Jul 25, 2018 at 9:35 PM, Dirk Eddelbuettel <edd at debian.org> wrote:

>
> On 25 July 2018 at 21:04, Stephen Marsh wrote:
> | So the Homebrew community dropped support for --with-cairo which is a
> shame
> | because --without-x --with-cairo is an important combination for any
> | environment that might need to generate graphics without X11 (or related)
> | dependencies (macOS, headless linux servers).
>
> For headless use on Linux, just build as usual and run via `xvfb-run`. If
> you
> need to create cairo-based graphics, install one of the (at least two)
> cairo
> device packages from CRAN.
>
> Dirk
>
> --
> http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
>



-- 
stephenmarsh.co

	[[alternative HTML version deleted]]


From d@vidhughjone@ @ending from gm@il@com  Mon Jul 30 06:33:19 2018
From: d@vidhughjone@ @ending from gm@il@com (David Hugh-Jones)
Date: Mon, 30 Jul 2018 05:33:19 +0100
Subject: [Rd] apply with zero-row matrix
In-Reply-To: <CAARY7khVXzxutThhKcq+ZftTE8-66eH-B-82xs-8TFyTTmGrkw@mail.gmail.com>
References: <CAARY7khVXzxutThhKcq+ZftTE8-66eH-B-82xs-8TFyTTmGrkw@mail.gmail.com>
Message-ID: <CAARY7kjL=buR9GE9rP8Y64D_WTdrFunfTMUXD2mw8P4gMsNrTQ@mail.gmail.com>

Forgive me if this has been asked many times before, but I couldn't find
anything on the mailing lists.

I'd expect apply(m, 1, foo) not to call `foo` if m is a matrix with zero
rows.
In fact:

m <- matrix(NA, 0, 5)
apply(m, 1, function (x) {cat("Called...\n"); print(x)})
## Called...
## [1] FALSE FALSE FALSE FALSE FALSE

Similarly for apply(m, 2,...) if m has no columns.
Is there a reason for this? Could it be documented?

David
-- 
Sent from Gmail Mobile

	[[alternative HTML version deleted]]


From d@vidhughjone@ @ending from gm@il@com  Mon Jul 30 06:35:12 2018
From: d@vidhughjone@ @ending from gm@il@com (David Hugh-Jones)
Date: Mon, 30 Jul 2018 05:35:12 +0100
Subject: [Rd] Fwd: help building very old R
In-Reply-To: <CAARY7kj8WtzzCjdkNgW_XZUwXzucqGv8c=MtYL7xDwhcvo4BYw@mail.gmail.com>
References: <CAARY7kj8WtzzCjdkNgW_XZUwXzucqGv8c=MtYL7xDwhcvo4BYw@mail.gmail.com>
Message-ID: <CAARY7kg8Drx9Fmv3id597VVN3MVipR6P=xuSJS9J69hQrm+wbA@mail.gmail.com>

Hi guys,

Perhaps someone here can help.

I am trying to build versions of R 1 for the rcheology package (just
arrived on CRAN).

For R prior to 1.5.0, I cannot configure support for tcl-tk.

I am building on Debian Woody (provided by Docker debian/eol) and have the
following packages installed:
r-base-dev tclx8.3-dev tk8.3-dev xvfb xbase-clients x-window-system-core

I download R source from http://cran.r-project.org/src/base/R-1 and run

./configure --with-tcl-tk=yes
--with-tcl-config=/usr/lib/tcl8.3/tclConfig.sh
      --with-tk-config=/usr/lib/tk8.3/tkConfig.sh

These are the locations for the relevant tkConfig.sh and tclConfig.sh files.
This gives output as follows:

R is now configured for x86_64-unknown-linux-gnu

  Source directory:          .
  Installation directory:    /usr/local

  C compiler:                gcc  -g -O2
  C++ compiler:              c++  -g -O2
  FORTRAN compiler:          g77  -g -O2
  X11 support:               yes
  Gnome support:             no
  Tcl/Tk support:            no
  R profiling support:       yes
  R as a shared library:     no

And config.log reveals:
configure:13099: checking for /usr/lib/tcl8.3/tclConfig.sh
configure:13134: checking for /usr/lib/tk8.3/tkConfig.sh
configure:13204: checking for /usr/include/tcl8.3/tcl.h
configure:13214: gcc -E -I/usr/local/include conftest.c >/dev/null
2>conftest.out
configure:13313: checking for /usr/include/tk8.3/tk.h
configure:13323: gcc -E -I/usr/local/include -I/usr/X11R6/include
-I/usr/include
/tcl8.3 conftest.c >/dev/null 2>conftest.out
configure:13319: /usr/include/tk8.3/tk.h: No such file or directory
configure: failed program was:
#line 13318 "configure"
#include "confdefs.h"
#include </usr/include/tk8.3/tk.h>
configure:13348: checking for /usr/include/tk.h
configure:13358: gcc -E -I/usr/local/include -I/usr/X11R6/include
-I/usr/include
/tcl8.3 conftest.c >/dev/null 2>conftest.out
configure:13354: /usr/include/tk.h: No such file or directory
configure: failed program was:
#line 13353 "configure"
#include "confdefs.h"
#include </usr/include/tk.h>
configure:13385: checking for tk.h
configure:13389: tk.h: No such file or directory

In fact, tk.h is in  /usr/include/tcl8.3/ , despite the failed program
compilation report.

R 1.5.0 and above work fine. Can anyone remember far back, if something
changed in the configure script?

Alternatively, those who are feeling brave can download the Docker image
creation scripts from github.com/hughjonesd/rcheology .

Cheers,

David
-- 
Sent from Gmail Mobile

	[[alternative HTML version deleted]]


From m@echler @ending from @t@t@m@th@ethz@ch  Mon Jul 30 09:32:16 2018
From: m@echler @ending from @t@t@m@th@ethz@ch (Martin Maechler)
Date: Mon, 30 Jul 2018 09:32:16 +0200
Subject: [Rd] odd behavior of names
In-Reply-To: <CAF8bMcZYoaN02TpYh2O=1zYWyjynHti2gga1O0pfdkrgKAojFg@mail.gmail.com>
References: <CAP01uR=K40ZD9M=wMdtAh77pyOd-4B39dcDzhE4Jdeh4XPDCrg@mail.gmail.com>
 <CCAD7D06-AC31-483A-90C9-756C0F402247@comcast.net>
 <CAF8bMcZYoaN02TpYh2O=1zYWyjynHti2gga1O0pfdkrgKAojFg@mail.gmail.com>
Message-ID: <23390.48896.646829.975074@stat.math.ethz.ch>

>>>>> William Dunlap via R-devel 
>>>>>     on Sun, 29 Jul 2018 10:06:40 -0700 writes:

    > Bugzilla issue 16101 describes another
    > first-list-name-printed-differently oddity with 
    > the Windows GUI version of R:
      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Indeed:
	1) "first-list-name-printed" [i.e "names" only in that
	   			     context of printing]
	2) Windows GUI version of R only
	   (not 'Rterm', i.e., not in ESS (emacs speaks
	   statistics), nor in Rstudio on Windows

Kevin Ushey has reported this last week in an official (and
perfect) bug report to R's bugzilla bug reporting site:

 https://bugs.r-project.org/bugzilla/show_bug.cgi?id=17447

            Bug ID: 17447
           Summary: list() prints first variable name in backticks
	   ....
         Component: Windows GUI / Window specific
          Reporter: kevinushey ..  gmail ..

His minimal REPREX was even much simpler:

   > list(a = 1, b = 2)
    $`a`
    [1] 1

    $b
    [1] 2


Thank you, Bill, for the nice extra example.

Martin Maechler
ETH Zurich and R Core Team



> > a <- "One is \u043E\u0434\u0438\u043D\nTwo is \u0434\u0432\u0430\n"
> > Encoding(a) # expect "UTF-8"
> [1] "UTF-8"
> > sapply(strsplit(a, "\n")[[1]], charToRaw)[c(1,1,2)]
> $`One is ????`
>  [1] 4f 6e 65 20 69 73 20 d0 be d0 b4 d0
> [13] b8 d0 bd
> 
> $`One is <U+043E><U+0434><U+0438><U+043D>`
>  [1] 4f 6e 65 20 69 73 20 d0 be d0 b4 d0
> [13] b8 d0 bd
> 
> $`Two is <U+0434><U+0432><U+0430>`
>  [1] 54 77 6f 20 69 73 20 d0 b4 d0 b2 d0
> [13] b0
> 
> > names(.Last.value)
> [1] "One is ????" "One is ????"
> [3] "Two is ???"
> 
> 
> 
> Bill Dunlap
> TIBCO Software
> wdunlap tibco.com

[..............................]


From m@echler @ending from @t@t@m@th@ethz@ch  Mon Jul 30 09:41:39 2018
From: m@echler @ending from @t@t@m@th@ethz@ch (Martin Maechler)
Date: Mon, 30 Jul 2018 09:41:39 +0200
Subject: [Rd] apply with zero-row matrix
In-Reply-To: <CAARY7kjL=buR9GE9rP8Y64D_WTdrFunfTMUXD2mw8P4gMsNrTQ@mail.gmail.com>
References: <CAARY7khVXzxutThhKcq+ZftTE8-66eH-B-82xs-8TFyTTmGrkw@mail.gmail.com>
 <CAARY7kjL=buR9GE9rP8Y64D_WTdrFunfTMUXD2mw8P4gMsNrTQ@mail.gmail.com>
Message-ID: <23390.49459.112386.395212@stat.math.ethz.ch>

>>>>> David Hugh-Jones 
>>>>>     on Mon, 30 Jul 2018 05:33:19 +0100 writes:

    > Forgive me if this has been asked many times before, but I
    > couldn't find anything on the mailing lists.

    > I'd expect apply(m, 1, foo) not to call `foo` if m is a
    > matrix with zero rows.  In fact:

    > m <- matrix(NA, 0, 5)
    > apply(m, 1, function (x) {cat("Called...\n"); print(x)})
    > ## Called...
    > ## [1] FALSE FALSE FALSE FALSE FALSE


    > Similarly for apply(m, 2,...) if m has no columns.  Is
    > there a reason for this?

Yes :

The reverse is really true for almost all basic R functions:

    They *are* called and give an "empty" result automatically
    when the main argument is empty.

What you basicaly propose is to add an extra

     if(<length 0 input>)
     	 return(<correspondingly formatted length-0 output>)

to all R functions.  While that makes sense for high-level R
functions that do a lot of things, this would really be a bad
idea in general :

This would make all of these basic functions larger {more to maintain} and
slightly slower for all non-zero cases just to make them
slightly faster for the rare zero-length case.

Martin Maechler
ETH Zurich and R core Team


From d@vidhughjone@ @ending from gm@il@com  Mon Jul 30 11:12:24 2018
From: d@vidhughjone@ @ending from gm@il@com (David Hugh-Jones)
Date: Mon, 30 Jul 2018 10:12:24 +0100
Subject: [Rd] apply with zero-row matrix
In-Reply-To: <23390.49459.112386.395212@stat.math.ethz.ch>
References: <CAARY7khVXzxutThhKcq+ZftTE8-66eH-B-82xs-8TFyTTmGrkw@mail.gmail.com>
 <CAARY7kjL=buR9GE9rP8Y64D_WTdrFunfTMUXD2mw8P4gMsNrTQ@mail.gmail.com>
 <23390.49459.112386.395212@stat.math.ethz.ch>
Message-ID: <CAARY7kgmMCbMtigw4i6NZMVMfv-VFdg0VQY1qKECPyAaJ=kbYA@mail.gmail.com>

Hi Martin,

Fair enough for R functions in general. But the behaviour of apply violates
the expectation that apply(m, 1, fun) calls fun n times when m has n rows.
That seems pretty basic.

Also, I understand from your argument why it makes sense to call apply and
return a special result (presumably NULL) for an empty argument; but why
should apply call fun?

Cheers
David

On Mon, 30 Jul 2018 at 08:41, Martin Maechler <maechler at stat.math.ethz.ch>
wrote:

> >>>>> David Hugh-Jones
> >>>>>     on Mon, 30 Jul 2018 05:33:19 +0100 writes:
>
>     > Forgive me if this has been asked many times before, but I
>     > couldn't find anything on the mailing lists.
>
>     > I'd expect apply(m, 1, foo) not to call `foo` if m is a
>     > matrix with zero rows.  In fact:
>
>     > m <- matrix(NA, 0, 5)
>     > apply(m, 1, function (x) {cat("Called...\n"); print(x)})
>     > ## Called...
>     > ## [1] FALSE FALSE FALSE FALSE FALSE
>
>
>     > Similarly for apply(m, 2,...) if m has no columns.  Is
>     > there a reason for this?
>
> Yes :
>
> The reverse is really true for almost all basic R functions:
>
>     They *are* called and give an "empty" result automatically
>     when the main argument is empty.
>
> What you basicaly propose is to add an extra
>
>      if(<length 0 input>)
>          return(<correspondingly formatted length-0 output>)
>
> to all R functions.  While that makes sense for high-level R
> functions that do a lot of things, this would really be a bad
> idea in general :
>
> This would make all of these basic functions larger {more to maintain} and
> slightly slower for all non-zero cases just to make them
> slightly faster for the rare zero-length case.
>
> Martin Maechler
> ETH Zurich and R core Team
>
> --
Sent from Gmail Mobile

	[[alternative HTML version deleted]]


From edd @ending from debi@n@org  Mon Jul 30 13:27:03 2018
From: edd @ending from debi@n@org (Dirk Eddelbuettel)
Date: Mon, 30 Jul 2018 06:27:03 -0500
Subject: [Rd] Fwd: help building very old R
In-Reply-To: <CAARY7kg8Drx9Fmv3id597VVN3MVipR6P=xuSJS9J69hQrm+wbA@mail.gmail.com>
References: <CAARY7kj8WtzzCjdkNgW_XZUwXzucqGv8c=MtYL7xDwhcvo4BYw@mail.gmail.com>
 <CAARY7kg8Drx9Fmv3id597VVN3MVipR6P=xuSJS9J69hQrm+wbA@mail.gmail.com>
Message-ID: <23390.62983.467663.35227@rob.eddelbuettel.com>


On 30 July 2018 at 05:35, David Hugh-Jones wrote:
| Hi guys,
| 
| Perhaps someone here can help.
| 
| I am trying to build versions of R 1 for the rcheology package (just
| arrived on CRAN).
| 
| For R prior to 1.5.0, I cannot configure support for tcl-tk.
| 
| I am building on Debian Woody (provided by Docker debian/eol) and have the
| following packages installed:
| r-base-dev tclx8.3-dev tk8.3-dev xvfb xbase-clients x-window-system-core
| 
| I download R source from http://cran.r-project.org/src/base/R-1 and run
| 
| ./configure --with-tcl-tk=yes
| --with-tcl-config=/usr/lib/tcl8.3/tclConfig.sh
|       --with-tk-config=/usr/lib/tk8.3/tkConfig.sh
| 
| These are the locations for the relevant tkConfig.sh and tclConfig.sh files.
| This gives output as follows:
| 
| R is now configured for x86_64-unknown-linux-gnu
| 
|   Source directory:          .
|   Installation directory:    /usr/local
| 
|   C compiler:                gcc  -g -O2
|   C++ compiler:              c++  -g -O2
|   FORTRAN compiler:          g77  -g -O2
|   X11 support:               yes
|   Gnome support:             no
|   Tcl/Tk support:            no
|   R profiling support:       yes
|   R as a shared library:     no
| 
| And config.log reveals:
| configure:13099: checking for /usr/lib/tcl8.3/tclConfig.sh
| configure:13134: checking for /usr/lib/tk8.3/tkConfig.sh
| configure:13204: checking for /usr/include/tcl8.3/tcl.h
| configure:13214: gcc -E -I/usr/local/include conftest.c >/dev/null
| 2>conftest.out
| configure:13313: checking for /usr/include/tk8.3/tk.h
| configure:13323: gcc -E -I/usr/local/include -I/usr/X11R6/include
| -I/usr/include
| /tcl8.3 conftest.c >/dev/null 2>conftest.out
| configure:13319: /usr/include/tk8.3/tk.h: No such file or directory
| configure: failed program was:
| #line 13318 "configure"
| #include "confdefs.h"
| #include </usr/include/tk8.3/tk.h>
| configure:13348: checking for /usr/include/tk.h
| configure:13358: gcc -E -I/usr/local/include -I/usr/X11R6/include
| -I/usr/include
| /tcl8.3 conftest.c >/dev/null 2>conftest.out
| configure:13354: /usr/include/tk.h: No such file or directory
| configure: failed program was:
| #line 13353 "configure"
| #include "confdefs.h"
| #include </usr/include/tk.h>
| configure:13385: checking for tk.h
| configure:13389: tk.h: No such file or directory
| 
| In fact, tk.h is in  /usr/include/tcl8.3/ , despite the failed program
| compilation report.
| 
| R 1.5.0 and above work fine. Can anyone remember far back, if something
| changed in the configure script?
| 
| Alternatively, those who are feeling brave can download the Docker image
| creation scripts from github.com/hughjonesd/rcheology .

Have you considered the actual Debian packages from "way back then" ?
Debian has this nifty snapshot archive where you can get old binaries:

  http://snapshot.debian.org/

For (source package) r-base we see 3.5.1 all the way down to 0.61.2

  http://snapshot.debian.org/package/r-base/

Alternatively, the package itself is now (finally, my bad) in a git repo
which goes back to 0.61.2 as well (using snapshot as the feeder)

  https://salsa.debian.org/edd/r-base/commits/master

Hth,  Dirk

-- 
http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From m@echler @ending from @t@t@m@th@ethz@ch  Mon Jul 30 14:38:36 2018
From: m@echler @ending from @t@t@m@th@ethz@ch (Martin Maechler)
Date: Mon, 30 Jul 2018 14:38:36 +0200
Subject: [Rd] apply with zero-row matrix
In-Reply-To: <CAARY7kgmMCbMtigw4i6NZMVMfv-VFdg0VQY1qKECPyAaJ=kbYA@mail.gmail.com>
References: <CAARY7khVXzxutThhKcq+ZftTE8-66eH-B-82xs-8TFyTTmGrkw@mail.gmail.com>
 <CAARY7kjL=buR9GE9rP8Y64D_WTdrFunfTMUXD2mw8P4gMsNrTQ@mail.gmail.com>
 <23390.49459.112386.395212@stat.math.ethz.ch>
 <CAARY7kgmMCbMtigw4i6NZMVMfv-VFdg0VQY1qKECPyAaJ=kbYA@mail.gmail.com>
Message-ID: <23391.1740.722692.223110@stat.math.ethz.ch>

>>>>> David Hugh-Jones 
>>>>>     on Mon, 30 Jul 2018 10:12:24 +0100 writes:

    > Hi Martin, Fair enough for R functions in general. But the
    > behaviour of apply violates the expectation that apply(m,
    > 1, fun) calls fun n times when m has n rows.  That seems
    > pretty basic.

Well, that expectation is obviously wrong ;-)  see below

    > Also, I understand from your argument why it makes sense
    > to call apply and return a special result (presumably
    > NULL) for an empty argument; but why should apply call fun?

    > Cheers David

The reason is seen e.g. in

    > apply(matrix(,0,3), 2, quantile)
	 [,1] [,2] [,3]
    0%     NA   NA   NA
    25%    NA   NA   NA
    50%    NA   NA   NA
    75%    NA   NA   NA
    100%   NA   NA   NA
    > 

and that is documented (+/-) in the first paragraph of the
'Value:' section of help(apply) :

 > Value:
 > 
 >      If each call to ?FUN? returns a vector of length ?n?, then ?apply?
 >      returns an array of dimension ?c(n, dim(X)[MARGIN])? if ?n > 1?.
 >      If ?n? equals ?1?, ?apply? returns a vector if ?MARGIN? has length
 >      1 and an array of dimension ?dim(X)[MARGIN]? otherwise.  If ?n? is
 >      ?0?, the result has length 0 but not necessarily the ?correct?
 >      dimension.


To determine 'n', the function *is* called once even when
length(X) ==  0

It may indeed be would helpful to add this explicitly to the
help page  ( <R>/src/library/base/man/apply.Rd ).
Can you propose a wording (in *.Rd if possible) ?

With regards,
Martin


From emil@bode @ending from d@n@@kn@w@nl  Mon Jul 30 15:16:10 2018
From: emil@bode @ending from d@n@@kn@w@nl (Emil Bode)
Date: Mon, 30 Jul 2018 13:16:10 +0000
Subject: [Rd] apply with zero-row matrix
In-Reply-To: <60C6DC2D-8C09-4CF7-B7B6-F7D6F4397CBD@dans.knaw.nl>
References: <CAARY7khVXzxutThhKcq+ZftTE8-66eH-B-82xs-8TFyTTmGrkw@mail.gmail.com>
 <CAARY7kjL=buR9GE9rP8Y64D_WTdrFunfTMUXD2mw8P4gMsNrTQ@mail.gmail.com>
 <23390.49459.112386.395212@stat.math.ethz.ch>
 <CAARY7kgmMCbMtigw4i6NZMVMfv-VFdg0VQY1qKECPyAaJ=kbYA@mail.gmail.com>
 <60C6DC2D-8C09-4CF7-B7B6-F7D6F4397CBD@dans.knaw.nl>
Message-ID: <4EC3C1FC-74CE-4C06-9603-B553DBCD68F7@dans.knaw.nl>

    Hi David,
    
    Besides Martins point, there is also the issue that for a lot of cases you would still like to have the right class returned.
    Right now these are returns:
    
    > apply(matrix(NA_integer_,0,5), 1, class)
    character(0)
    > apply(matrix(NA_integer_,0,5), 1, identity)
    integer(0)
    > apply(matrix(NA,0,5), 1, identity)
    logical(0)
    
    In your case, these would all return NULL, so I think there is value in running FUN at least once (Say if you'd want to check if FUN always returns the right class). 
    And from a philosophical point of view, R is mostly a functional programming language, I think if you want side-effects a for-loop would look better.
    
    
    Best regards, 
    Emil Bode
     
    Data-analyst
     
    +31 6 43 83 89 33
    emil.bode at dans.knaw.nl
     
    DANS: Netherlands Institute for Permanent Access to Digital Research Resources
    Anna van Saksenlaan 51 | 2593 HW Den Haag | +31 70 349 44 50 | info at dans.knaw.nl <mailto:info at dans.kn> | dans.knaw.nl <applewebdata://71F677F0-6872-45F3-A6C4-4972BF87185B/www.dans.knaw.nl>
    DANS is an institute of the Dutch Academy KNAW <http://knaw.nl/nl> and funding organisation NWO <http://www.nwo.nl/>. 
    
    On 30/07/2018, 11:12, "R-devel on behalf of David Hugh-Jones" <r-devel-bounces at r-project.org on behalf of davidhughjones at gmail.com> wrote:
    
        Hi Martin,
        
        Fair enough for R functions in general. But the behaviour of apply violates
        the expectation that apply(m, 1, fun) calls fun n times when m has n rows.
        That seems pretty basic.
        
        Also, I understand from your argument why it makes sense to call apply and
        return a special result (presumably NULL) for an empty argument; but why
        should apply call fun?
        
        Cheers
        David
        
        On Mon, 30 Jul 2018 at 08:41, Martin Maechler <maechler at stat.math.ethz.ch>
        wrote:
        
        > >>>>> David Hugh-Jones
        > >>>>>     on Mon, 30 Jul 2018 05:33:19 +0100 writes:
        >
        >     > Forgive me if this has been asked many times before, but I
        >     > couldn't find anything on the mailing lists.
        >
        >     > I'd expect apply(m, 1, foo) not to call `foo` if m is a
        >     > matrix with zero rows.  In fact:
        >
        >     > m <- matrix(NA, 0, 5)
        >     > apply(m, 1, function (x) {cat("Called...\n"); print(x)})
        >     > ## Called...
        >     > ## [1] FALSE FALSE FALSE FALSE FALSE
        >
        >
        >     > Similarly for apply(m, 2,...) if m has no columns.  Is
        >     > there a reason for this?
        >
        > Yes :
        >
        > The reverse is really true for almost all basic R functions:
        >
        >     They *are* called and give an "empty" result automatically
        >     when the main argument is empty.
        >
        > What you basicaly propose is to add an extra
        >
        >      if(<length 0 input>)
        >          return(<correspondingly formatted length-0 output>)
        >
        > to all R functions.  While that makes sense for high-level R
        > functions that do a lot of things, this would really be a bad
        > idea in general :
        >
        > This would make all of these basic functions larger {more to maintain} and
        > slightly slower for all non-zero cases just to make them
        > slightly faster for the rare zero-length case.
        >
        > Martin Maechler
        > ETH Zurich and R core Team
        >
        > --
        Sent from Gmail Mobile
        
        	[[alternative HTML version deleted]]
        
        ______________________________________________
        R-devel at r-project.org mailing list
        https://stat.ethz.ch/mailman/listinfo/r-devel
        
    
    


From ggrothendieck @ending from gm@il@com  Mon Jul 30 16:04:27 2018
From: ggrothendieck @ending from gm@il@com (Gabor Grothendieck)
Date: Mon, 30 Jul 2018 10:04:27 -0400
Subject: [Rd] apply with zero-row matrix
In-Reply-To: <CAARY7kjL=buR9GE9rP8Y64D_WTdrFunfTMUXD2mw8P4gMsNrTQ@mail.gmail.com>
References: <CAARY7khVXzxutThhKcq+ZftTE8-66eH-B-82xs-8TFyTTmGrkw@mail.gmail.com>
 <CAARY7kjL=buR9GE9rP8Y64D_WTdrFunfTMUXD2mw8P4gMsNrTQ@mail.gmail.com>
Message-ID: <CAP01uRkYM7CMZ2eJGLQmeybdAnsV9AGDtwROMnGB2toukG15SQ@mail.gmail.com>

Try pmap and related functions in purrr:

  pmap(as.data.frame(m), ~ { cat("Called...\n"); print(c(...)) })
  ## list()

On Mon, Jul 30, 2018 at 12:33 AM, David Hugh-Jones
<davidhughjones at gmail.com> wrote:
> Forgive me if this has been asked many times before, but I couldn't find
> anything on the mailing lists.
>
> I'd expect apply(m, 1, foo) not to call `foo` if m is a matrix with zero
> rows.
> In fact:
>
> m <- matrix(NA, 0, 5)
> apply(m, 1, function (x) {cat("Called...\n"); print(x)})
> ## Called...
> ## [1] FALSE FALSE FALSE FALSE FALSE
>
> Similarly for apply(m, 2,...) if m has no columns.
> Is there a reason for this? Could it be documented?
>
> David
> --
> Sent from Gmail Mobile
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel



-- 
Statistics & Software Consulting
GKX Group, GKX Associates Inc.
tel: 1-877-GKX-GROUP
email: ggrothendieck at gmail.com


From d@vidhughjone@ @ending from gm@il@com  Mon Jul 30 17:12:44 2018
From: d@vidhughjone@ @ending from gm@il@com (David Hugh-Jones)
Date: Mon, 30 Jul 2018 16:12:44 +0100
Subject: [Rd] apply with zero-row matrix
In-Reply-To: <CAP01uRkYM7CMZ2eJGLQmeybdAnsV9AGDtwROMnGB2toukG15SQ@mail.gmail.com>
References: <CAARY7khVXzxutThhKcq+ZftTE8-66eH-B-82xs-8TFyTTmGrkw@mail.gmail.com>
 <CAARY7kjL=buR9GE9rP8Y64D_WTdrFunfTMUXD2mw8P4gMsNrTQ@mail.gmail.com>
 <CAP01uRkYM7CMZ2eJGLQmeybdAnsV9AGDtwROMnGB2toukG15SQ@mail.gmail.com>
Message-ID: <CAARY7kgv79L9R64x+Nds9DzyLdbw9uTGTaQcmsqK3MSzzT29=A@mail.gmail.com>

Interesting discussion. I'm not wholly convinced by Martin's and Emil's
arguments. The behaviour seems to violate an obvious expectation (fun is
called once per row) to satisfy a subtle one (result has a guaranteed
dimension and type).

In any case, here's a suggested chunk of rd to go at the end of the "Value":

If \code{dim(X)[MARGIN]} is zero, then \code{FUN} is called once, with an
argument of the appropriate dimensions. The argument's type is the same as
\code{typeof(m)}, and the argument values are those returned by
\code{vector(typeof(m))}. For example, if m is numeric, the argument will
be a vector (or matrix or array) of zeroes. The type and length of the
value returned by \code{FUN} is used to determine the type of the result.

And at the end of "Details":

\code{FUN} is always called at least once, see below.


David


On Mon, 30 Jul 2018 at 15:05, Gabor Grothendieck <ggrothendieck at gmail.com>
wrote:

> Try pmap and related functions in purrr:
>
>   pmap(as.data.frame(m), ~ { cat("Called...\n"); print(c(...)) })
>   ## list()
>
> On Mon, Jul 30, 2018 at 12:33 AM, David Hugh-Jones
> <davidhughjones at gmail.com> wrote:
> > Forgive me if this has been asked many times before, but I couldn't find
> > anything on the mailing lists.
> >
> > I'd expect apply(m, 1, foo) not to call `foo` if m is a matrix with zero
> > rows.
> > In fact:
> >
> > m <- matrix(NA, 0, 5)
> > apply(m, 1, function (x) {cat("Called...\n"); print(x)})
> > ## Called...
> > ## [1] FALSE FALSE FALSE FALSE FALSE
> >
> > Similarly for apply(m, 2,...) if m has no columns.
> > Is there a reason for this? Could it be documented?
> >
> > David
> > --
> > Sent from Gmail Mobile
> >
> >         [[alternative HTML version deleted]]
> >
> > ______________________________________________
> > R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
>
>
>
> --
> Statistics & Software Consulting
> GKX Group, GKX Associates Inc.
> tel: 1-877-GKX-GROUP
> email: ggrothendieck at gmail.com
>

	[[alternative HTML version deleted]]


From d@vidhughjone@ @ending from gm@il@com  Mon Jul 30 17:26:12 2018
From: d@vidhughjone@ @ending from gm@il@com (David Hugh-Jones)
Date: Mon, 30 Jul 2018 16:26:12 +0100
Subject: [Rd] Fwd: help building very old R
In-Reply-To: <23390.62983.467663.35227@rob.eddelbuettel.com>
References: <CAARY7kj8WtzzCjdkNgW_XZUwXzucqGv8c=MtYL7xDwhcvo4BYw@mail.gmail.com>
 <CAARY7kg8Drx9Fmv3id597VVN3MVipR6P=xuSJS9J69hQrm+wbA@mail.gmail.com>
 <23390.62983.467663.35227@rob.eddelbuettel.com>
Message-ID: <CAARY7khdVavWS0Qpum8VjcK5od9=dH7U32hvRsWw_b__eWR7Rg@mail.gmail.com>

Thanks for the tip. That could be a huge timesaver. But it lists only a
single package for versions 0.90.1-2 ... how does that work?
David


On Mon, 30 Jul 2018 at 12:27, Dirk Eddelbuettel <edd at debian.org> wrote:

>
> On 30 July 2018 at 05:35, David Hugh-Jones wrote:
> | Hi guys,
> |
> | Perhaps someone here can help.
> |
> | I am trying to build versions of R 1 for the rcheology package (just
> | arrived on CRAN).
> |
> | For R prior to 1.5.0, I cannot configure support for tcl-tk.
> |
> | I am building on Debian Woody (provided by Docker debian/eol) and have
> the
> | following packages installed:
> | r-base-dev tclx8.3-dev tk8.3-dev xvfb xbase-clients x-window-system-core
> |
> | I download R source from http://cran.r-project.org/src/base/R-1 and run
> |
> | ./configure --with-tcl-tk=yes
> | --with-tcl-config=/usr/lib/tcl8.3/tclConfig.sh
> |       --with-tk-config=/usr/lib/tk8.3/tkConfig.sh
> |
> | These are the locations for the relevant tkConfig.sh and tclConfig.sh
> files.
> | This gives output as follows:
> |
> | R is now configured for x86_64-unknown-linux-gnu
> |
> |   Source directory:          .
> |   Installation directory:    /usr/local
> |
> |   C compiler:                gcc  -g -O2
> |   C++ compiler:              c++  -g -O2
> |   FORTRAN compiler:          g77  -g -O2
> |   X11 support:               yes
> |   Gnome support:             no
> |   Tcl/Tk support:            no
> |   R profiling support:       yes
> |   R as a shared library:     no
> |
> | And config.log reveals:
> | configure:13099: checking for /usr/lib/tcl8.3/tclConfig.sh
> | configure:13134: checking for /usr/lib/tk8.3/tkConfig.sh
> | configure:13204: checking for /usr/include/tcl8.3/tcl.h
> | configure:13214: gcc -E -I/usr/local/include conftest.c >/dev/null
> | 2>conftest.out
> | configure:13313: checking for /usr/include/tk8.3/tk.h
> | configure:13323: gcc -E -I/usr/local/include -I/usr/X11R6/include
> | -I/usr/include
> | /tcl8.3 conftest.c >/dev/null 2>conftest.out
> | configure:13319: /usr/include/tk8.3/tk.h: No such file or directory
> | configure: failed program was:
> | #line 13318 "configure"
> | #include "confdefs.h"
> | #include </usr/include/tk8.3/tk.h>
> | configure:13348: checking for /usr/include/tk.h
> | configure:13358: gcc -E -I/usr/local/include -I/usr/X11R6/include
> | -I/usr/include
> | /tcl8.3 conftest.c >/dev/null 2>conftest.out
> | configure:13354: /usr/include/tk.h: No such file or directory
> | configure: failed program was:
> | #line 13353 "configure"
> | #include "confdefs.h"
> | #include </usr/include/tk.h>
> | configure:13385: checking for tk.h
> | configure:13389: tk.h: No such file or directory
> |
> | In fact, tk.h is in  /usr/include/tcl8.3/ , despite the failed program
> | compilation report.
> |
> | R 1.5.0 and above work fine. Can anyone remember far back, if something
> | changed in the configure script?
> |
> | Alternatively, those who are feeling brave can download the Docker image
> | creation scripts from github.com/hughjonesd/rcheology .
>
> Have you considered the actual Debian packages from "way back then" ?
> Debian has this nifty snapshot archive where you can get old binaries:
>
>   http://snapshot.debian.org/
>
> For (source package) r-base we see 3.5.1 all the way down to 0.61.2
>
>   http://snapshot.debian.org/package/r-base/
>
> Alternatively, the package itself is now (finally, my bad) in a git repo
> which goes back to 0.61.2 as well (using snapshot as the feeder)
>
>   https://salsa.debian.org/edd/r-base/commits/master
>
> Hth,  Dirk
>
> --
> http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org
>

	[[alternative HTML version deleted]]


From edd @ending from debi@n@org  Mon Jul 30 17:35:10 2018
From: edd @ending from debi@n@org (Dirk Eddelbuettel)
Date: Mon, 30 Jul 2018 10:35:10 -0500
Subject: [Rd] Fwd: help building very old R
In-Reply-To: <CAARY7khdVavWS0Qpum8VjcK5od9=dH7U32hvRsWw_b__eWR7Rg@mail.gmail.com>
References: <CAARY7kj8WtzzCjdkNgW_XZUwXzucqGv8c=MtYL7xDwhcvo4BYw@mail.gmail.com>
 <CAARY7kg8Drx9Fmv3id597VVN3MVipR6P=xuSJS9J69hQrm+wbA@mail.gmail.com>
 <23390.62983.467663.35227@rob.eddelbuettel.com>
 <CAARY7khdVavWS0Qpum8VjcK5od9=dH7U32hvRsWw_b__eWR7Rg@mail.gmail.com>
Message-ID: <23391.12334.172883.341120@rob.eddelbuettel.com>


On 30 July 2018 at 16:26, David Hugh-Jones wrote:
| Thanks for the tip. That could be a huge timesaver. But it lists only a
| single package for versions 0.90.1-2 ... how does that work?

The lookip is source or binary-package based. Eg here are three binaries
built from source 'r-base':

  http://snapshot.debian.org/binary/r-base-core/
  http://snapshot.debian.org/binary/r-base-dev/
  http://snapshot.debian.org/binary/r-mathlib/

etc pp

Dirk

-- 
http://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From blerner @ending from mtholyoke@edu  Mon Jul 30 17:35:10 2018
From: blerner @ending from mtholyoke@edu (Barbara Lerner)
Date: Mon, 30 Jul 2018 11:35:10 -0400
Subject: [Rd] Problem with parseData
Message-ID: <fda485ef-3ca1-6507-f227-51a5cb8af4a3@mtholyoke.edu>

Hi,

I have run into a problem with parseData from the utils package.? When 
an assignment is done with = instead of <-, the information provided by 
parseData does not include an entry for the assignment.

For this input, stored in file "BadPosition.R":

y <- 5
foo = 7

And running this code:

parsed <- parse("BadPosition.R", keep.source=TRUE)
parsedData <- utils::getParseData (parsed, includeText=TRUE)
print(paste("parseData =", parsedData))

I get the following output:

[1] "parseData = c(1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2)"
[2] "parseData = c(1, 1, 1, 3, 6, 6, 1, 1, 5, 7, 7)"
[3] "parseData = c(1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2)"
[4] "parseData = c(6, 1, 1, 4, 6, 6, 3, 3, 5, 7, 7)"
[5] "parseData = c(7, 1, 3, 2, 4, 5, 10, 12, 11, 13, 14)"
[6] "parseData = c(0, 3, 7, 7, 5, 7, 12, 0, 0, 14, 0)"
[7] "parseData = c(\"expr\", \"SYMBOL\", \"expr\", \"LEFT_ASSIGN\", 
\"NUM_CONST\", \"expr\", \"SYMBOL\", \"expr\", \"EQ_ASSIGN\", 
\"NUM_CONST\", \"expr\")"
[8] "parseData = c(FALSE, TRUE, FALSE, TRUE, TRUE, FALSE, TRUE, FALSE, 
TRUE, TRUE, FALSE)"
[9] "parseData = c(\"y <- 5\", \"y\", \"y\", \"<-\", \"5\", \"5\", 
\"foo\", \"foo\", \"=\", \"7\", \"7\")"

Notice how there is an entry for "y <- 5" beginning on line 1, column 1, 
ending at line 1, column 6, but there is no analogous entry for "foo = 7".

I am running R 3.5.0 on a Mac running 10.12.6.

Thanks for your help and please let me know if you need any further 
information.

Barbara

-- 
<http://www.getpostbox.com>Barbara Lerner
Associate Professor
Computer Science Department
Mount Holyoke College

<http://www.getpostbox.com>

	[[alternative HTML version deleted]]


From profjcn@@h @ending from gm@il@com  Mon Jul 30 20:35:49 2018
From: profjcn@@h @ending from gm@il@com (J C Nash)
Date: Mon, 30 Jul 2018 14:35:49 -0400
Subject: [Rd] trace in uniroot() ?
Message-ID: <941b7615-6075-6c74-537e-70ad0bc16652@gmail.com>

In looking at rootfinding for the histoRicalg project (see gitlab.com/nashjc/histoRicalg),
I thought I would check how uniroot() solves some problems. The following short example

ff <- function(x){ exp(0.5*x) - 2 }
ff(2)
ff(1)
uniroot(ff, 0, 10)
uniroot(ff, c(0, 10), trace=1)
uniroot(ff, c(0, 10), trace=TRUE)


shows that the trace parameter, as described in the Rd file, does not seem to
be functional except in limited situations (and it suggests an
integer, then uses a logical for the example, e.g.,
 ## numerically, f(-|M|) becomes zero :
     u3 <- uniroot(exp, c(0,2), extendInt="yes", trace=TRUE)
)

When extendInt is set, then there is some information output, but trace alone
produces nothing.

I looked at the source code -- it is in R-3.5.1/src/library/stats/R/nlm.R and
calls zeroin2 code from R-3.5.1/src/library/stats/src/optimize.c as far as I
can determing. My code inspection suggests trace does not show the iterations
of the rootfinding, and only has effect when the search interval is allowed
to be extended. It does not appear that there is any mechanism to ask
the zeroin2 C code to display intermediate work.

This isn't desperately important for me as I wrote an R version of the code in
package rootoned on R-forge (which Martin Maechler adapted as unirootR.R in
Rmpfr so multi-precision roots can be found). My zeroin.R has 'trace' to get
the pattern of different steps. In fact it is a bit excessive. Note
unirootR.R uses 'verbose' rather than 'trace'. However, it would be nice to be
able to see what is going on with uniroot() to verify equivalent operation at
the same precision level. It is very easy for codes to be very slightly
different and give quite widely different output.

Indeed, even without the trace, we see (zeroin from rootoned here)

> zeroin(ff, c(0, 10), trace=FALSE)
$root
[1] 1.386294

$froot
[1] -5.658169e-10

$rtol
[1] 7.450581e-09

$maxit
[1] 9

> uniroot(ff, c(0, 10), trace=FALSE)
$root
[1] 1.38629

$f.root
[1] -4.66072e-06

$iter
[1] 10

$init.it
[1] NA

$estim.prec
[1] 6.103516e-05

>

Is the lack of trace a bug, or at least an oversight? Being able to follow iterations is a
classic approach to checking that computations are proceeding as they should.

Best, JN


From jtelleri@@rproject @ending from gm@il@com  Mon Jul 30 21:27:57 2018
From: jtelleri@@rproject @ending from gm@il@com (Juan Telleria Ruiz de Aguirre)
Date: Mon, 30 Jul 2018 21:27:57 +0200
Subject: [Rd] Code Optimization: print.data.frame + as.data.frame(head(x,
 n = options("max.print")))
Message-ID: <CAJXDcw3T8MCv1MW7pAT8PHot2kYbwV1mch7-BpvViZ2UTPc_fg@mail.gmail.com>

Dear R Developers,

I would like to propose a simple optimization for print.data.frame
base function:

To add: x <- as.data.frame(head(x, n = options("max.print")))

This would prevent that, if for example, we have a 10GB data.frame
(e.g.: Instead of a data.table), and we accidentally print it, the R
Session does not "collapse", forcing us to press ESC or kill the
RSession.

function (x, ..., digits = NULL, quote = FALSE, right = TRUE,
          row.names = TRUE)
{
  n <- length(row.names(x))
  if (length(x) == 0L) {
    cat(sprintf(ngettext(n, "data frame with 0 columns and %d row",
                         "data frame with 0 columns and %d rows"), n), "\n",
        sep = "")
  }
  else if (n == 0L) {
    print.default(names(x), quote = FALSE)
    cat(gettext("<0 rows> (or 0-length row.names)\n"))
  }
  else {

    x <- as.data.frame(head(x, n = options("max.print")))

    m <- as.matrix(format.data.frame(x, digits = digits,
                                     na.encode = FALSE))
    if (!isTRUE(row.names))
      dimnames(m)[[1L]] <- if (isFALSE(row.names))
        rep.int("", n)
    else row.names
    print(m, ..., quote = quote, right = right)
  }
  invisible(x)
}

Thank you.

Best,
Juan


From jtelleri@@rproject @ending from gm@il@com  Tue Jul 31 08:19:33 2018
From: jtelleri@@rproject @ending from gm@il@com (Juan Telleria Ruiz de Aguirre)
Date: Tue, 31 Jul 2018 08:19:33 +0200
Subject: [Rd] 
 Code Optimization: print.data.frame + as.data.frame(head(x,
 n = options("max.print")))
In-Reply-To: <CAJXDcw3T8MCv1MW7pAT8PHot2kYbwV1mch7-BpvViZ2UTPc_fg@mail.gmail.com>
References: <CAJXDcw3T8MCv1MW7pAT8PHot2kYbwV1mch7-BpvViZ2UTPc_fg@mail.gmail.com>
Message-ID: <CAJXDcw3J3-WZzTCvAcsDtvNKsGM3ain5WSn0r=HmuQ8Nzd_jWg@mail.gmail.com>

I polished a little bit more the function:

* Used:  getOption("max.print")
* Added comment at the end:  cat('[ reached getOption("max.print") --
omitted ', omitted,' rows ]')

function (x, ..., digits = NULL, quote = FALSE, right = TRUE,
          row.names = TRUE)
{
  n <- length(row.names(x))
  if (length(x) == 0L) {
    cat(sprintf(ngettext(n, "data frame with 0 columns and %d row",
                         "data frame with 0 columns and %d rows"), n), "\n",
        sep = "")
  }
  else if (n == 0L) {
    print.default(names(x), quote = FALSE)
    cat(gettext("<0 rows> (or 0-length row.names)\n"))
  }
  else {

    omitted <- nrow(x)-getOption("max.print")

    x <- as.data.frame(head(x, n = getOption("max.print")))

    m <- as.matrix(format.data.frame(x, digits = digits,
                                     na.encode = FALSE))
    if (!isTRUE(row.names))
      dimnames(m)[[1L]] <- if (isFALSE(row.names))
        rep.int("", n)
    else row.names
    print(m, ..., quote = quote, right = right)

    if((nrow(x)-getOption("max.print"))>0){

      cat('[ reached getOption("max.print") -- omitted ', omitted,' rows ]')

    }

  }
  invisible(x)
}

	[[alternative HTML version deleted]]


From deep@y@n@@@rk@r @ending from gm@il@com  Tue Jul 31 08:45:19 2018
From: deep@y@n@@@rk@r @ending from gm@il@com (Deepayan Sarkar)
Date: Tue, 31 Jul 2018 12:15:19 +0530
Subject: [Rd] apply with zero-row matrix
In-Reply-To: <23391.1740.722692.223110@stat.math.ethz.ch>
References: <CAARY7khVXzxutThhKcq+ZftTE8-66eH-B-82xs-8TFyTTmGrkw@mail.gmail.com>
 <CAARY7kjL=buR9GE9rP8Y64D_WTdrFunfTMUXD2mw8P4gMsNrTQ@mail.gmail.com>
 <23390.49459.112386.395212@stat.math.ethz.ch>
 <CAARY7kgmMCbMtigw4i6NZMVMfv-VFdg0VQY1qKECPyAaJ=kbYA@mail.gmail.com>
 <23391.1740.722692.223110@stat.math.ethz.ch>
Message-ID: <CADfFDC73=N7W3Cuw5OQByhHrkpN0UuRezkyuYDrDj3ZFqApaxA@mail.gmail.com>

On Mon, Jul 30, 2018 at 6:08 PM, Martin Maechler
<maechler at stat.math.ethz.ch> wrote:
>>>>>> David Hugh-Jones
>>>>>>     on Mon, 30 Jul 2018 10:12:24 +0100 writes:
>
>     > Hi Martin, Fair enough for R functions in general. But the
>     > behaviour of apply violates the expectation that apply(m,
>     > 1, fun) calls fun n times when m has n rows.  That seems
>     > pretty basic.
>
> Well, that expectation is obviously wrong ;-)  see below
>
>     > Also, I understand from your argument why it makes sense
>     > to call apply and return a special result (presumably
>     > NULL) for an empty argument; but why should apply call fun?
>
>     > Cheers David
>
> The reason is seen e.g. in
>
>     > apply(matrix(,0,3), 2, quantile)
>          [,1] [,2] [,3]
>     0%     NA   NA   NA
>     25%    NA   NA   NA
>     50%    NA   NA   NA
>     75%    NA   NA   NA
>     100%   NA   NA   NA
>     >

I don't think this example is relevant to what David is saying:
matrix(,0,3) has three columns, so he would expect quantile() to be
called 3 times, as it is.

I think his question is why quantile() is called at all when the input
has 0 rows, as in

apply(matrix(,0,3), 1, quantile)
# named numeric(0)

> and that is documented (+/-) in the first paragraph of the
> 'Value:' section of help(apply) :
>
>  > Value:
>  >
>  >      If each call to ?FUN? returns a vector of length ?n?, then ?apply?
>  >      returns an array of dimension ?c(n, dim(X)[MARGIN])? if ?n > 1?.
>  >      If ?n? equals ?1?, ?apply? returns a vector if ?MARGIN? has length
>  >      1 and an array of dimension ?dim(X)[MARGIN]? otherwise.  If ?n? is
>  >      ?0?, the result has length 0 but not necessarily the ?correct?
>  >      dimension.
>
>
> To determine 'n', the function *is* called once even when
> length(X) ==  0

This part of the docs also doesn't seem applicable, and in fact seems
incorrect: here we should have (according to the docs)

n = length(quantile(logical(0))) # 5

but the result does not have dim == c(5, 0) as the docs suggest:

dim(apply(matrix(,0,3), 1, quantile))
# NULL

So the length of the result of calling FUN() seems to be ignored in
this case, and as Emil points out, is only used to determine the mode
of the result.

I can't immediately think of an example where returning NULL instead
would make a difference, but there may well be some.

-Deepayan

> It may indeed be would helpful to add this explicitly to the
> help page  ( <R>/src/library/base/man/apply.Rd ).
> Can you propose a wording (in *.Rd if possible) ?
>
> With regards,
> Martin
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From m@echler @ending from @t@t@m@th@ethz@ch  Tue Jul 31 09:33:32 2018
From: m@echler @ending from @t@t@m@th@ethz@ch (Martin Maechler)
Date: Tue, 31 Jul 2018 09:33:32 +0200
Subject: [Rd] 
 Code Optimization: print.data.frame + as.data.frame(head(x,
 n = options("max.print")))
In-Reply-To: <CAJXDcw3J3-WZzTCvAcsDtvNKsGM3ain5WSn0r=HmuQ8Nzd_jWg@mail.gmail.com>
References: <CAJXDcw3T8MCv1MW7pAT8PHot2kYbwV1mch7-BpvViZ2UTPc_fg@mail.gmail.com>
 <CAJXDcw3J3-WZzTCvAcsDtvNKsGM3ain5WSn0r=HmuQ8Nzd_jWg@mail.gmail.com>
Message-ID: <23392.4300.430457.946504@stat.math.ethz.ch>

>>>>> Juan Telleria Ruiz de Aguirre 
>>>>>     on Tue, 31 Jul 2018 08:19:33 +0200 writes:

    > I polished a little bit more the function:
    > * Used:  getOption("max.print")
    > * Added comment at the end:  cat('[ reached getOption("max.print") --
    > omitted ', omitted,' rows ]')

    > I polished a little bit more the function:

    > * Used:  getOption("max.print")
    > * Added comment at the end:  cat('[ reached getOption("max.print") --
    > omitted ', omitted,' rows ]')

and before

     > I would like to propose a simple optimization for print.data.frame
     > base function:
     > 
     > To add: x <- as.data.frame(head(x, n = options("max.print")))
     > 
     > This would prevent that, if for example, we have a 10GB data.frame
     > (e.g.: Instead of a data.table), and we accidentally print it, the R
     > Session does not "collapse", forcing us to press ESC or kill the
     > RSession.

Thank you, Juan.
You are right: The whole idea of introducing the 'max.print'
option (and the corresponding 'max' argument in print.default()
       {and print.Date() currently })
was that print() ing should not use too much resources.

and you are also right to use 'max.print' .. but R should be as
functional a language as sensible, and hence print(<data.frame>)
should be getting an argument 'max' which by default is equal to
the "max.print" option.

Also, any good citizen print() method *must* return its argument invisibly.
==> you are not supposed to change 'x' here.

But I entirely agree with your basic intuition for the problem
resolution.  Very good, thank you, indeed!

I'm currently running 'make check-all'  with the following change
to the source code (aka "patch") :

===================================================================
--- src/library/base/R/dataframe.R	(revision 75016)
+++ src/library/base/R/dataframe.R	(working copy)
@@ -1477,7 +1477,7 @@
 
 print.data.frame <-
     function(x, ..., digits = NULL, quote = FALSE, right = TRUE,
-	     row.names = TRUE)
+	     row.names = TRUE, max = NULL)
 {
     n <- length(row.names(x))
     if(length(x) == 0L) {
@@ -1489,12 +1489,19 @@
 	print.default(names(x), quote = FALSE)
 	cat(gettext("<0 rows> (or 0-length row.names)\n"))
     } else {
+	if(is.null(max)) max <- getOption("max.print", 99999L)
 	## format.<*>() : avoiding picking up e.g. format.AsIs
-	m <- as.matrix(format.data.frame(x, digits = digits, na.encode = FALSE))
+	omit <- (n0 <- max %/% length(x)) < n
+	m <- as.matrix(
+	    format.data.frame(if(omit) x[seq_len(n0), , drop=FALSE] else x,
+			      digits = digits, na.encode = FALSE))
 	if(!isTRUE(row.names))
 	    dimnames(m)[[1L]] <-
 		if(isFALSE(row.names)) rep.int("", n) else row.names
 	print(m, ..., quote = quote, right = right)
+	if(omit)
+	    cat(" [ reached 'max' / getOption(\"max.print\") -- omitted",
+		n - n0, "rows ]\n")
     }
     invisible(x)
 }


From dietm@r@schi@dler m@ili@g off m@@rol@@d-web@com  Tue Jul 31 13:09:58 2018
From: dietm@r@schi@dler m@ili@g off m@@rol@@d-web@com (dietm@r@schi@dler m@ili@g off m@@rol@@d-web@com)
Date: Tue, 31 Jul 2018 11:09:58 +0000
Subject: [Rd] RFC: make as.difftime more consistent or convenient
Message-ID: <5fdb1151361a4e7c9677ca4e3bc4f338@AUSMXMBX04.mrws.biz>

Hello!

I notice I can convert strings containing hour, minute or second specifications to a 'difftime':

> as.difftime("12 h", "%H")
Time difference of 12 hours
> as.difftime("12 m", "%M")
Time difference of 12 mins
> as.difftime("12 s", "%S")
Time difference of 12 secs

But I can't do so with a week specification, because there is no appropriate format ..., although "weeks" is a legitimate unit of 'difftime':

> as.difftime("12 w", "%...")

1. What do you think about making the behavior of 'as.difftime' more consistent by accepting also formats for "days" and "weeks"?

2. Even more convenient it could be if 'as.difftime' accepted strings containing magnitude and unit; how about:

> as.difftime("12 weeks")
Time difference of 12 weeks

--
Regards,
Dietmar Schindler
________________________________
manroland web systems NewCo GmbH | Managing Director: Alexander Wassermann
Registered Office: Augsburg | Trade Register: AG Augsburg | HRB-No.: 32609 | VAT: DE815764857

Confidentiality note:
This eMail and any files transmitted with it are confidential and intended solely for the use of the individual or entity to whom they are addressed. If you are not the intended recipient, you are hereby notified that any use or dissemination of this communication is strictly prohibited. If you have received this eMail in error, then please delete this eMail.


From pd@lgd @ending from gm@il@com  Tue Jul 31 15:55:25 2018
From: pd@lgd @ending from gm@il@com (peter dalgaard)
Date: Tue, 31 Jul 2018 15:55:25 +0200
Subject: [Rd] help building very old R
In-Reply-To: <CAARY7kg8Drx9Fmv3id597VVN3MVipR6P=xuSJS9J69hQrm+wbA@mail.gmail.com>
References: <CAARY7kj8WtzzCjdkNgW_XZUwXzucqGv8c=MtYL7xDwhcvo4BYw@mail.gmail.com>
 <CAARY7kg8Drx9Fmv3id597VVN3MVipR6P=xuSJS9J69hQrm+wbA@mail.gmail.com>
Message-ID: <0D046FDF-7A3D-4FF8-85D1-48910F10569D@gmail.com>

[Oops, I seem to have managed not to send this yesterday...]

Not sure how to fix, but note that configure is not lying to you:

> configure:13319: /usr/include/tk8.3/tk.h: No such file or directory

tk8.3, not tcl8.3

-pd

> On 30 Jul 2018, at 06:35 , David Hugh-Jones <davidhughjones at gmail.com> wrote:
> 
> Hi guys,
> 
> Perhaps someone here can help.
> 
> I am trying to build versions of R 1 for the rcheology package (just
> arrived on CRAN).
> 
> For R prior to 1.5.0, I cannot configure support for tcl-tk.
> 
> I am building on Debian Woody (provided by Docker debian/eol) and have the
> following packages installed:
> r-base-dev tclx8.3-dev tk8.3-dev xvfb xbase-clients x-window-system-core
> 
> I download R source from http://cran.r-project.org/src/base/R-1 and run
> 
> ./configure --with-tcl-tk=yes
> --with-tcl-config=/usr/lib/tcl8.3/tclConfig.sh
>      --with-tk-config=/usr/lib/tk8.3/tkConfig.sh
> 
> These are the locations for the relevant tkConfig.sh and tclConfig.sh files.
> This gives output as follows:
> 
> R is now configured for x86_64-unknown-linux-gnu
> 
>  Source directory:          .
>  Installation directory:    /usr/local
> 
>  C compiler:                gcc  -g -O2
>  C++ compiler:              c++  -g -O2
>  FORTRAN compiler:          g77  -g -O2
>  X11 support:               yes
>  Gnome support:             no
>  Tcl/Tk support:            no
>  R profiling support:       yes
>  R as a shared library:     no
> 
> And config.log reveals:
> configure:13099: checking for /usr/lib/tcl8.3/tclConfig.sh
> configure:13134: checking for /usr/lib/tk8.3/tkConfig.sh
> configure:13204: checking for /usr/include/tcl8.3/tcl.h
> configure:13214: gcc -E -I/usr/local/include conftest.c >/dev/null
> 2>conftest.out
> configure:13313: checking for /usr/include/tk8.3/tk.h
> configure:13323: gcc -E -I/usr/local/include -I/usr/X11R6/include
> -I/usr/include
> /tcl8.3 conftest.c >/dev/null 2>conftest.out
> configure:13319: /usr/include/tk8.3/tk.h: No such file or directory
> configure: failed program was:
> #line 13318 "configure"
> #include "confdefs.h"
> #include </usr/include/tk8.3/tk.h>
> configure:13348: checking for /usr/include/tk.h
> configure:13358: gcc -E -I/usr/local/include -I/usr/X11R6/include
> -I/usr/include
> /tcl8.3 conftest.c >/dev/null 2>conftest.out
> configure:13354: /usr/include/tk.h: No such file or directory
> configure: failed program was:
> #line 13353 "configure"
> #include "confdefs.h"
> #include </usr/include/tk.h>
> configure:13385: checking for tk.h
> configure:13389: tk.h: No such file or directory
> 
> In fact, tk.h is in  /usr/include/tcl8.3/ , despite the failed program
> compilation report.
> 
> R 1.5.0 and above work fine. Can anyone remember far back, if something
> changed in the configure script?
> 
> Alternatively, those who are feeling brave can download the Docker image
> creation scripts from github.com/hughjonesd/rcheology .
> 
> Cheers,
> 
> David
> -- 
> Sent from Gmail Mobile
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Peter Dalgaard, Professor,
Center for Statistics, Copenhagen Business School
Solbjerg Plads 3, 2000 Frederiksberg, Denmark
Phone: (+45)38153501
Office: A 4.23
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


