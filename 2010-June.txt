From michal2992 at gmail.com  Tue Jun  1 11:18:06 2010
From: michal2992 at gmail.com (=?ISO-8859-2?Q?Micha=B3_Bojanowski?=)
Date: Tue, 1 Jun 2010 11:18:06 +0200
Subject: [Rd] r-forge certificate expired?
Message-ID: <AANLkTikm4MDzjvp_bcyQV9o0kKcC5ATwC0qoWIY8_1Iz@mail.gmail.com>

Is anybody else getting the error that R-Forge's certificate has
expired on 2010-05-21?

I'm wondering if it is safe to proceed with adding a security exception...

~Michal


From bolker at ufl.edu  Tue Jun  1 14:40:10 2010
From: bolker at ufl.edu (Ben Bolker)
Date: Tue, 1 Jun 2010 12:40:10 +0000 (UTC)
Subject: [Rd] warning from install.packages()
References: <4BFC3228.9010400@ufl.edu> <C822177B.EBC1%jari.oksanen@oulu.fi>
Message-ID: <loom.20100601T142323-304@post.gmane.org>


> On 25/05/10 23:25 PM, "Ben Bolker" <bolker <at> ufl.edu> wrote:
>   Just curious: is there a particular reason why install.packages()
> gives a warning in normal use when 'lib' is not specified (e.g. argument
> 'lib' is missing: using '/usr/local/lib/R/site-library' )?  

  Bump.

  
>From install.packages in utils/R/packages2.R:

      if(missing(lib) || is.null(lib)) {
        lib <- .libPaths()[1L]
        if(length(.libPaths()) > 1L)
            warning(gettextf("argument 'lib' is missing: using '%s'", lib),
                    immediate. = TRUE, domain = NA)
    }


  If I were patching this I would simply comment out this whole test
(rather than making a message() ? la Jari Oksanen) -- it seems to
make the most sense to execute the documented behavior silently ...

  I will submit this as a wishlist item shortly if no-one complains.

   Ben Bolker


From kasperdanielhansen at gmail.com  Tue Jun  1 14:52:05 2010
From: kasperdanielhansen at gmail.com (Kasper Daniel Hansen)
Date: Tue, 1 Jun 2010 08:52:05 -0400
Subject: [Rd] 00LOCK and nfs
In-Reply-To: <AANLkTikhZwblSL_MyLTmqbsD5R61vhDa0l-o9lcw0caT@mail.gmail.com>
References: <s2le780c0971004260815we5156859v293d5b3a6ffd9890@mail.gmail.com>
	<l2kc0177e5a1004261054k3775628fyb6c1fd154707dd91@mail.gmail.com>
	<y2le780c0971004261205i39f069dt379690211f8f8a7f@mail.gmail.com>
	<4BD6F661.10409@acm.org>
	<AANLkTikhZwblSL_MyLTmqbsD5R61vhDa0l-o9lcw0caT@mail.gmail.com>
Message-ID: <AANLkTikE8kSXLI_dS3hGBFUlVk8A0f0gNULzZ9ZVitZk@mail.gmail.com>

Further experimentation using this patch to install.packages shows
that I sometimes have remaining 00LOCK-pkgname directories after doing
a massive update on a multi-user system with R installed on NFS.
However, I have never had install.packages/update.packages stop midway
because of an unremovable 00LOCK directory.  I therefore consider the
patch to be big improvement for people like me, having a multi-user R
installed on NFS.  Private followups to my original email shows that I
am not the only one with this problem.

I would very much like the patch (or some variant hereof) to be
considered for inclusion in R-devel.

Kasper

On Tue, May 18, 2010 at 11:59 AM, Kasper Daniel Hansen
<kasperdanielhansen at gmail.com> wrote:
> This is a follow-up to an old thread with kind of solution to the
> 00LOCK problem on NFS.
>
> I have made a patch to install.packages to accept a new argument
> ?locktype = c("lock", "no-lock", "pkglock")
> which is passed to R CMD INSTALL. ?This addition might have
> independent interest aside from the NFS problem, as it exposes
> functionality from R CMD INSTALL to install.packages and the very
> convenient update.packages. ?Patches are at
> ?http://www.biostat.jhsph.edu/~khansen/packages2.R-patch
> ?http://www.biostat.jhsph.edu/~khansen/install.packages.Rd-patch
> (patches to files in the utils package) and both
> ?R-devel (R version 2.12.0 Under development (unstable) (2010-05-17 r52025))
> and
> ?R-2.11 (R version 2.11.0 Patched (2010-05-17 r52025))
> passed make check-all with these two patches applied. ?I thought about
> adding a note describing my findings below to the details section, but
> decided against it.
>
> Regarding the 00LOCK problem. ?In my testing, using the patches above
> and setting locktype = "pkglock", makes it possible to deal with the
> NFS problem. ?Specifically, I have not been able to make
> update.packages() fail midway, due to a un-removable 00LOCK file
> (which is not too surprising, as I now have a per-package lock).
>
> However, sometimes (but far less frequently than before), a
> 00LOCK-pkgname directory remains after update/install.packages.
> Sometimes this 00LOCK-pkgname directory does not contain any .nfs*
> files (!?) and sometimes it does. For this reason, I still precede any
> install/update.packages with a check for the existence of a
> 00LOCK-pkgname directory and an attempt to remove it.
>
> The difference between using locktype = "pkglock" and not is
> specifically that without, it was possible for update.packages to fail
> midway even though there were no 00LOCK* files at the start of the
> update process.
>
> Originally I hypothesized that the presence of the .nfs* files in the
> 00LOCK directory had to do with synchronization issues between the
> file server and the compute node. ?In order to approach this I tried
> to insert a
> ?system("sleep 10")
> at the beginning of
> ?do_cleanup
> in
> ?tools/R/install.R
> but that did not work.
>
> Since the pkglock approach described above seems to solve this issue
> for me, I have not pursued the synchronization issue further.
>
> Kasper
>


From ligges at statistik.tu-dortmund.de  Tue Jun  1 15:35:56 2010
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Tue, 01 Jun 2010 15:35:56 +0200
Subject: [Rd] r-forge certificate expired?
In-Reply-To: <AANLkTikm4MDzjvp_bcyQV9o0kKcC5ATwC0qoWIY8_1Iz@mail.gmail.com>
References: <AANLkTikm4MDzjvp_bcyQV9o0kKcC5ATwC0qoWIY8_1Iz@mail.gmail.com>
Message-ID: <4C050CBC.4060402@statistik.tu-dortmund.de>



On 01.06.2010 11:18, Micha? Bojanowski wrote:
> Is anybody else getting the error that R-Forge's certificate has
> expired on 2010-05-21?
>
> I'm wondering if it is safe to proceed with adding a security exception...


Yes, I asked Stefan already and R-forge is trying to get a new one which 
takes more time than expected.

Uwe Ligges


> ~Michal
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From hb at stat.berkeley.edu  Tue Jun  1 20:41:38 2010
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Tue, 1 Jun 2010 20:41:38 +0200
Subject: [Rd] codetools: Suggestion to detect potentially unassigned
	variables
Message-ID: <AANLkTik_LV9G2cpHIyfcBq2RJrrtg3YUYyJ_jYEX5wUV@mail.gmail.com>

This is just a note/wishlist/for the record:

With

foo1 <- function() {
  res;
}

foo2 <- function() {
  for (i in c()) res <- 1;
  res;
}

foo3 <- function() {
  while (FALSE) res <- 1;
  res;
}

foo4 <- function() {
  if (FALSE) res <- 1;
  res;
}

we get:

> foo1()
Error in foo1() : object 'res' not found
> foo2()
Error in foo2() : object 'res' not found
> foo3()
Error in foo3() : object 'res' not found
> foo4()
Error in foo4() : object 'res' not found


Running R CMD check on R v2.11.1pat we get:

* checking R code for possible problems ... NOTE
foo1: no visible binding for global variable 'res'

An improvement would be to also report that:

foo2: variable 'res' may not be assigned
foo3: variable 'res' may not be assigned
foo4: variable 'res' may not be assigned

/Henrik


From ligges at statistik.tu-dortmund.de  Tue Jun  1 22:19:07 2010
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Tue, 01 Jun 2010 22:19:07 +0200
Subject: [Rd] Suggested tidying up
In-Reply-To: <4C4C31FF-4FAC-41F9-87ED-F09804FD2CCB@act.ulaval.ca>
References: <4C4C31FF-4FAC-41F9-87ED-F09804FD2CCB@act.ulaval.ca>
Message-ID: <4C056B3B.6040804@statistik.tu-dortmund.de>



On 31.05.2010 23:13, Vincent Goulet wrote:
> Package grDevices has a function cm() to convert from inches to centimeters. Its definition is:
>
> cm<- function(x) 2.54*x
>
> As far as I can tell, the function is not used anywhere in the R sources (I grepped for "cm(", "cm)" and ", cm".) I did not check for all packages on CRAN, though.

I found it easier to remember cm() rather than 2.54.

By the way, before deprecating (rather than at once removing) a 
function: have you also grepped through all CRAN and BioC packages?
And have you grepped for "\"cm\"", "'cm'" and other occurrences? cm may 
be called in a call(), do.call() or other construct, hence the real test 
is to remove the cm function, rebuild R and run the checks and run 
checks on all at least all 3000 packages from CRAN + BioC.

Best wishes,
Uwe Ligges



> May I propose to remove this apparently useless function from the sources?
>
> [I stubbled upon this function because my package actuar also has a cm() function that masks the one from grDevices.]
>
>
> Dr. Vincent Goulet
> Full Professor
> ?cole d'actuariat, Universit? Laval, Qu?bec
> vincent.goulet at act.ulaval.ca   http://vgoulet.act.ulaval.ca
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From abhibera at gmail.com  Wed Jun  2 10:30:52 2010
From: abhibera at gmail.com (Abhijit Bera)
Date: Wed, 2 Jun 2010 14:00:52 +0530
Subject: [Rd] Why does my RPy2 program run faster on Windows?
In-Reply-To: <AANLkTimJ13JJhKe7tfSnolJBE8mExDDi5aGXj-6povEX@mail.gmail.com>
References: <AANLkTilpKFsvkWRwpA91F5_9qPPUqfxS-zBDZbTm-z7T@mail.gmail.com>
	<AANLkTikz-B62AkrSGKjNez2EyZK-P6VA2vJr7w5GpEub@mail.gmail.com>
	<AANLkTimJ13JJhKe7tfSnolJBE8mExDDi5aGXj-6povEX@mail.gmail.com>
Message-ID: <AANLkTimm1T7n32PUTfGETmtPRM8EDeucb5d8qjGR6su2@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20100602/920108ba/attachment.pl>

From info at aghmed.fsnet.co.uk  Wed Jun  2 19:14:45 2010
From: info at aghmed.fsnet.co.uk (Michael Dewey)
Date: Wed, 02 Jun 2010 18:14:45 +0100
Subject: [Rd] warning from install.packages()
In-Reply-To: <loom.20100601T142323-304@post.gmane.org>
References: <4BFC3228.9010400@ufl.edu> <C822177B.EBC1%jari.oksanen@oulu.fi>
	<loom.20100601T142323-304@post.gmane.org>
Message-ID: <Zen-1OJrWm-0006gD-SM@smarthost02.mail.zen.net.uk>

At 13:40 01/06/2010, Ben Bolker wrote:

> > On 25/05/10 23:25 PM, "Ben Bolker" <bolker <at> ufl.edu> wrote:
> >   Just curious: is there a particular reason why install.packages()
> > gives a warning in normal use when 'lib' is not specified (e.g. argument
> > 'lib' is missing: using '/usr/local/lib/R/site-library' )?

As I see it R is saying 'I am doing what you told 
me, but just in case I am checking whether that 
was what you really wanted'. Note that you do not 
get a warning if there was only one place R could 
put it. I would certainly vote for a message if 
people are getting unnecessarily alarmed by the warning.


>   Bump.
>
>
> >From install.packages in utils/R/packages2.R:
>
>       if(missing(lib) || is.null(lib)) {
>         lib <- .libPaths()[1L]
>         if(length(.libPaths()) > 1L)
>             warning(gettextf("argument 'lib' is missing: using '%s'", lib),
>                     immediate. = TRUE, domain = NA)
>     }
>
>
>   If I were patching this I would simply comment out this whole test
>(rather than making a message() ?  la Jari Oksanen) -- it seems to
>make the most sense to execute the documented behavior silently ...
>
>   I will submit this as a wishlist item shortly if no-one complains.
>
>    Ben Bolker

Michael Dewey
http://www.aghmed.fsnet.co.uk


From bolker at ufl.edu  Wed Jun  2 19:45:18 2010
From: bolker at ufl.edu (Ben Bolker)
Date: Wed, 02 Jun 2010 13:45:18 -0400
Subject: [Rd] warning from install.packages()
In-Reply-To: <Zen-1OJrWm-0006gD-SM@smarthost02.mail.zen.net.uk>
References: <4BFC3228.9010400@ufl.edu> <C822177B.EBC1%jari.oksanen@oulu.fi>
	<loom.20100601T142323-304@post.gmane.org>
	<Zen-1OJrWm-0006gD-SM@smarthost02.mail.zen.net.uk>
Message-ID: <4C0698AE.7010304@ufl.edu>

Michael Dewey wrote:
> At 13:40 01/06/2010, Ben Bolker wrote:
> 
>>> On 25/05/10 23:25 PM, "Ben Bolker" <bolker <at> ufl.edu> wrote:
>>>   Just curious: is there a particular reason why install.packages()
>>> gives a warning in normal use when 'lib' is not specified (e.g. argument
>>> 'lib' is missing: using '/usr/local/lib/R/site-library' )?
> 
> As I see it R is saying 'I am doing what you told 
> me, but just in case I am checking whether that 
> was what you really wanted'. Note that you do not 
> get a warning if there was only one place R could 
> put it. I would certainly vote for a message if 
> people are getting unnecessarily alarmed by the warning.

  But this seems so different from R's general philosophy/behavior
(inherited from Unix?) that a function that gets correct input and
executes without error returns silently ...

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 261 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20100602/f72f3302/attachment.bin>

From emorway at engr.colostate.edu  Thu Jun  3 00:21:37 2010
From: emorway at engr.colostate.edu (emorway)
Date: Wed, 2 Jun 2010 15:21:37 -0700 (PDT)
Subject: [Rd] #Rscript error on Windows 7 operating system
Message-ID: <1275517297241-2240936.post@n4.nabble.com>


Forum, 

I've been running some parameter estimation software (UCODE which is
maintained by the USGS) that has the capability of running models in
parallel on a local network.  Each additional processor I can incorporate
into the parent-child network helps cut the overall runtime, which is
currently on the order of days.  When a signal is sent to a child (or slave)
processor a series of commands take place, among which some R kriging
commands are called from a batch file.  

I recently gained access to a new quad-core machine that is running windows
7 and for some reason when the R batch commands are invoked (or called) by
the parent (or master) machine the following error message results:

c:\...\>#Rscript KrigCommandsWithAnisotropy_US_Layer1.bat
Warning: This script has only been tested on Windows XP.
\R\R-2.11.0\library\JGR\jgr.exe was unexpected at this time.

Running the batch file on Windows XP or Windows Server 08 operating systems
works OK.  However, I did have to change a security setting like so:

Settings... Control Panel... Administrative tools... Microsoft .NET
Framework Configuration... Right Click Runtime Security Policy... Choose
Adjust Security... Next... Local Intranet and adjust to "Full Trust"...
Next... 

I've been unable to find this security setting in Windows 7, but I'm not
sure it is related to the error message quoted above.

I apologize if this is the wrong forum for this kind of request.  If I need
to repost on R-Help I'll delete it here.

Thanks,
Eric

-- 
View this message in context: http://r.789695.n4.nabble.com/Rscript-error-on-Windows-7-operating-system-tp2240936p2240936.html
Sent from the R devel mailing list archive at Nabble.com.


From ggrothendieck at gmail.com  Thu Jun  3 01:15:07 2010
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Wed, 2 Jun 2010 19:15:07 -0400
Subject: [Rd] #Rscript error on Windows 7 operating system
In-Reply-To: <1275517297241-2240936.post@n4.nabble.com>
References: <1275517297241-2240936.post@n4.nabble.com>
Message-ID: <AANLkTilBVf-CC6E7wx9DDuGuqzrsh9TqgfuYHH9P4WwZ@mail.gmail.com>

The message about XP you are referring to is a warning and not an
error.  Evidently,
you are running an old version of #Rscript.bat from the batchfiles distribution.
Try using the most recent version.  The batchfiles home page is at:
http://batchfiles.googlecode.com
That should at least eliminate the warning.

The message about jgr.exe is likely unrelated to the above.  I can't tell from
the information supplied what is wrong but you might try eliminating
jgr from your setup.

The security setting is likely related to your batch file and not to
#Rscript.bat .

On Wed, Jun 2, 2010 at 6:21 PM, emorway <emorway at engr.colostate.edu> wrote:
>
> Forum,
>
> I've been running some parameter estimation software (UCODE which is
> maintained by the USGS) that has the capability of running models in
> parallel on a local network. ?Each additional processor I can incorporate
> into the parent-child network helps cut the overall runtime, which is
> currently on the order of days. ?When a signal is sent to a child (or slave)
> processor a series of commands take place, among which some R kriging
> commands are called from a batch file.
>
> I recently gained access to a new quad-core machine that is running windows
> 7 and for some reason when the R batch commands are invoked (or called) by
> the parent (or master) machine the following error message results:
>
> c:\...\>#Rscript KrigCommandsWithAnisotropy_US_Layer1.bat
> Warning: This script has only been tested on Windows XP.
> \R\R-2.11.0\library\JGR\jgr.exe was unexpected at this time.
>
> Running the batch file on Windows XP or Windows Server 08 operating systems
> works OK. ?However, I did have to change a security setting like so:
>
> Settings... Control Panel... Administrative tools... Microsoft .NET
> Framework Configuration... Right Click Runtime Security Policy... Choose
> Adjust Security... Next... Local Intranet and adjust to "Full Trust"...
> Next...
>
> I've been unable to find this security setting in Windows 7, but I'm not
> sure it is related to the error message quoted above.
>
> I apologize if this is the wrong forum for this kind of request. ?If I need
> to repost on R-Help I'll delete it here.
>
> Thanks,
> Eric


From ripley at stats.ox.ac.uk  Thu Jun  3 10:05:11 2010
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 3 Jun 2010 09:05:11 +0100 (BST)
Subject: [Rd] #Rscript error on Windows 7 operating system
In-Reply-To: <1275517297241-2240936.post@n4.nabble.com>
References: <1275517297241-2240936.post@n4.nabble.com>
Message-ID: <alpine.LFD.2.00.1006030859030.23244@gannet.stats.ox.ac.uk>

This is not really about R, is it?  Few of us will have any idea what 
'#Rscript' is (it is not part of R), and the mention of JGR suggests 
that the third-party Java interface is involved (and that has its own 
mailing lists).

Nor would R-help be appropriate: please ask the authors of #Rscript 
for help (and see the R posting guide, which asked you to do that 
first).

On Wed, 2 Jun 2010, emorway wrote:

>
> Forum,
>
> I've been running some parameter estimation software (UCODE which is
> maintained by the USGS) that has the capability of running models in
> parallel on a local network.  Each additional processor I can incorporate
> into the parent-child network helps cut the overall runtime, which is
> currently on the order of days.  When a signal is sent to a child (or slave)
> processor a series of commands take place, among which some R kriging
> commands are called from a batch file.
>
> I recently gained access to a new quad-core machine that is running windows
> 7 and for some reason when the R batch commands are invoked (or called) by
> the parent (or master) machine the following error message results:
>
> c:\...\>#Rscript KrigCommandsWithAnisotropy_US_Layer1.bat
> Warning: This script has only been tested on Windows XP.
> \R\R-2.11.0\library\JGR\jgr.exe was unexpected at this time.
>
> Running the batch file on Windows XP or Windows Server 08 operating systems
> works OK.  However, I did have to change a security setting like so:
>
> Settings... Control Panel... Administrative tools... Microsoft .NET
> Framework Configuration... Right Click Runtime Security Policy... Choose
> Adjust Security... Next... Local Intranet and adjust to "Full Trust"...
> Next...
>
> I've been unable to find this security setting in Windows 7, but I'm not
> sure it is related to the error message quoted above.
>
> I apologize if this is the wrong forum for this kind of request.  If I need
> to repost on R-Help I'll delete it here.
>
> Thanks,
> Eric
>
> -- 
> View this message in context: http://r.789695.n4.nabble.com/Rscript-error-on-Windows-7-operating-system-tp2240936p2240936.html
> Sent from the R devel mailing list archive at Nabble.com.
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From maechler at stat.math.ethz.ch  Thu Jun  3 10:05:27 2010
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Thu, 3 Jun 2010 10:05:27 +0200
Subject: [Rd] warning from install.packages()
In-Reply-To: <4C0698AE.7010304@ufl.edu>
References: <4BFC3228.9010400@ufl.edu> <C822177B.EBC1%jari.oksanen@oulu.fi>
	<loom.20100601T142323-304@post.gmane.org>
	<Zen-1OJrWm-0006gD-SM@smarthost02.mail.zen.net.uk>
	<4C0698AE.7010304@ufl.edu>
Message-ID: <19463.25159.870742.187684@lynne.math.ethz.ch>

>>>>> "BB" == Ben Bolker <bolker at ufl.edu>
>>>>>     on Wed, 02 Jun 2010 13:45:18 -0400 writes:

    BB> Michael Dewey wrote:
    >> At 13:40 01/06/2010, Ben Bolker wrote:
    >> 
    >>>> On 25/05/10 23:25 PM, "Ben Bolker" <bolker <at> ufl.edu> wrote:
    >>>> Just curious: is there a particular reason why install.packages()
    >>>> gives a warning in normal use when 'lib' is not specified (e.g. argument
    >>>> 'lib' is missing: using '/usr/local/lib/R/site-library' )?
    >> 
    >> As I see it R is saying 'I am doing what you told 
    >> me, but just in case I am checking whether that 
    >> was what you really wanted'. Note that you do not 
    >> get a warning if there was only one place R could 
    >> put it. I would certainly vote for a message if 
    >> people are getting unnecessarily alarmed by the warning.

    BB> But this seems so different from R's general philosophy/behavior
    BB> (inherited from Unix?) that a function that gets correct input and
    BB> executes without error returns silently ...

That's correct.
Note however that installing a package is not just a thing
happening in your R session.
It will affect all your future R sessions, and possibly even
other users' who have the same  .libPaths()[1]
{e.g. the group here does share it}.

I'd agree to not put a warning but I'd definitely want a message
aka "note" to the user.
The *wording* of that note should not be alarming at all, I
agree, just a note to the user.

Martin Maechler, ETH Zurich


From bolker at ufl.edu  Thu Jun  3 15:27:30 2010
From: bolker at ufl.edu (Ben Bolker)
Date: Thu, 03 Jun 2010 09:27:30 -0400
Subject: [Rd] warning from install.packages()
In-Reply-To: <19463.25159.870742.187684@lynne.math.ethz.ch>
References: <4BFC3228.9010400@ufl.edu>	<C822177B.EBC1%jari.oksanen@oulu.fi>	<loom.20100601T142323-304@post.gmane.org>	<Zen-1OJrWm-0006gD-SM@smarthost02.mail.zen.net.uk>	<4C0698AE.7010304@ufl.edu>
	<19463.25159.870742.187684@lynne.math.ethz.ch>
Message-ID: <4C07ADC2.1010101@ufl.edu>

Martin Maechler wrote:
>>>>>> "BB" == Ben Bolker <bolker at ufl.edu>
>>>>>>     on Wed, 02 Jun 2010 13:45:18 -0400 writes:
> 
>     BB> Michael Dewey wrote:
>     >> At 13:40 01/06/2010, Ben Bolker wrote:
>     >> 
>     >>>> On 25/05/10 23:25 PM, "Ben Bolker" <bolker <at> ufl.edu> wrote:
>     >>>> Just curious: is there a particular reason why install.packages()
>     >>>> gives a warning in normal use when 'lib' is not specified (e.g. argument
>     >>>> 'lib' is missing: using '/usr/local/lib/R/site-library' )?
>     >> 
>     >> As I see it R is saying 'I am doing what you told 
>     >> me, but just in case I am checking whether that 
>     >> was what you really wanted'. Note that you do not 
>     >> get a warning if there was only one place R could 
>     >> put it. I would certainly vote for a message if 
>     >> people are getting unnecessarily alarmed by the warning.
> 
>     BB> But this seems so different from R's general philosophy/behavior
>     BB> (inherited from Unix?) that a function that gets correct input and
>     BB> executes without error returns silently ...
> 
> That's correct.
> Note however that installing a package is not just a thing
> happening in your R session.
> It will affect all your future R sessions, and possibly even
> other users' who have the same  .libPaths()[1]
> {e.g. the group here does share it}.
> 
> I'd agree to not put a warning but I'd definitely want a message
> aka "note" to the user.
> The *wording* of that note should not be alarming at all, I
> agree, just a note to the user.
> 
> Martin Maechler, ETH Zurich

  OK, then, how about this as a minimal change?

===================================================================
--- packages.R	(revision 52192)
+++ packages.R	(working copy)
@@ -534,8 +534,8 @@

     if(missing(lib) || is.null(lib)) {
         lib <- .libPaths()[1L]
-        warning(gettextf("argument 'lib' is missing: using %s", lib),
-                immediate. = TRUE, domain = NA)
+        message(gettextf("argument 'lib' is missing: using %s", lib),
+                domain = NA)
     }

     paths <- .find.package(pkgs, lib)
Index: packages2.R
===================================================================
--- packages2.R	(revision 52192)
+++ packages2.R	(working copy)
@@ -193,8 +193,8 @@
     if(missing(lib) || is.null(lib)) {
         lib <- .libPaths()[1L]
         if(length(.libPaths()) > 1L)
-            warning(gettextf("argument 'lib' is missing: using '%s'", lib),
-                    immediate. = TRUE, domain = NA)
+            message(gettextf("argument 'lib' is missing: using '%s'", lib),
+                    domain = NA)
     }

     ## check for writability by user


-- 
Ben Bolker
Associate professor, Biology Dep't, Univ. of Florida
*** NEW E-MAIL ADDRESSES:
***   bbolker at gmail.com , bolker at math.mcmaster.ca
bolker at ufl.edu / people.biology.ufl.edu/bolker
GPG key: people.biology.ufl.edu/bolker/benbolker-publickey.asc

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 261 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20100603/6be2bbfb/attachment.bin>

From emorway at engr.colostate.edu  Thu Jun  3 16:18:00 2010
From: emorway at engr.colostate.edu (emorway)
Date: Thu, 3 Jun 2010 07:18:00 -0700 (PDT)
Subject: [Rd] #Rscript error on Windows 7 operating system
In-Reply-To: <AANLkTilBVf-CC6E7wx9DDuGuqzrsh9TqgfuYHH9P4WwZ@mail.gmail.com>
References: <1275517297241-2240936.post@n4.nabble.com>
	<AANLkTilBVf-CC6E7wx9DDuGuqzrsh9TqgfuYHH9P4WwZ@mail.gmail.com>
Message-ID: <1275574680971-2241732.post@n4.nabble.com>


Gabor,

I would like to thank you for referring me to the new #Rscript file. 
Apparently that is all it took to get my simulation running remotely on a
Windows 7 machine.  It seemed to have cured the jgr.exe hiccup as well.  

Respectfully,
Eric


-- 
View this message in context: http://r.789695.n4.nabble.com/Rscript-error-on-Windows-7-operating-system-tp2240936p2241732.html
Sent from the R devel mailing list archive at Nabble.com.


From Vincent.Goulet at act.ulaval.ca  Thu Jun  3 16:24:21 2010
From: Vincent.Goulet at act.ulaval.ca (Vincent Goulet)
Date: Thu, 3 Jun 2010 10:24:21 -0400
Subject: [Rd] warning from install.packages()
In-Reply-To: <4C07ADC2.1010101@ufl.edu>
References: <4BFC3228.9010400@ufl.edu>	<C822177B.EBC1%jari.oksanen@oulu.fi>
	<loom.20100601T142323-304@post.gmane.org>
	<Zen-1OJrWm-0006gD-SM@smarthost02.mail.zen.net.uk>
	<4C0698AE.7010304@ufl.edu>	<19463.25159.870742.187684@lynne.math.ethz.ch>
	<4C07ADC2.1010101@ufl.edu>
Message-ID: <4A59132E-098B-4D93-8A7C-62E313EF717C@act.ulaval.ca>

Le jeu. 3 juin ? 09:27, Ben Bolker a ?crit :

> Martin Maechler wrote:
>>>>>>> "BB" == Ben Bolker <bolker at ufl.edu>
>>>>>>>    on Wed, 02 Jun 2010 13:45:18 -0400 writes:
>> 
>>    BB> Michael Dewey wrote:
>>>> At 13:40 01/06/2010, Ben Bolker wrote:
>>>> 
>>>>>> On 25/05/10 23:25 PM, "Ben Bolker" <bolker <at> ufl.edu> wrote:
>>>>>> Just curious: is there a particular reason why install.packages()
>>>>>> gives a warning in normal use when 'lib' is not specified (e.g. argument
>>>>>> 'lib' is missing: using '/usr/local/lib/R/site-library' )?
>>>> 
>>>> As I see it R is saying 'I am doing what you told 
>>>> me, but just in case I am checking whether that 
>>>> was what you really wanted'. Note that you do not 
>>>> get a warning if there was only one place R could 
>>>> put it. I would certainly vote for a message if 
>>>> people are getting unnecessarily alarmed by the warning.
>> 
>>    BB> But this seems so different from R's general philosophy/behavior
>>    BB> (inherited from Unix?) that a function that gets correct input and
>>    BB> executes without error returns silently ...
>> 
>> That's correct.
>> Note however that installing a package is not just a thing
>> happening in your R session.
>> It will affect all your future R sessions, and possibly even
>> other users' who have the same  .libPaths()[1]
>> {e.g. the group here does share it}.
>> 
>> I'd agree to not put a warning but I'd definitely want a message
>> aka "note" to the user.
>> The *wording* of that note should not be alarming at all, I
>> agree, just a note to the user.
>> 
>> Martin Maechler, ETH Zurich
> 
>  OK, then, how about this as a minimal change?
> 
> ===================================================================
> --- packages.R	(revision 52192)
> +++ packages.R	(working copy)
> @@ -534,8 +534,8 @@
> 
>     if(missing(lib) || is.null(lib)) {
>         lib <- .libPaths()[1L]
> -        warning(gettextf("argument 'lib' is missing: using %s", lib),
> -                immediate. = TRUE, domain = NA)
> +        message(gettextf("argument 'lib' is missing: using %s", lib),
> +                domain = NA)
>     }
> 
>     paths <- .find.package(pkgs, lib)
> Index: packages2.R
> ===================================================================
> --- packages2.R	(revision 52192)
> +++ packages2.R	(working copy)
> @@ -193,8 +193,8 @@
>     if(missing(lib) || is.null(lib)) {
>         lib <- .libPaths()[1L]
>         if(length(.libPaths()) > 1L)
> -            warning(gettextf("argument 'lib' is missing: using '%s'", lib),
> -                    immediate. = TRUE, domain = NA)
> +            message(gettextf("argument 'lib' is missing: using '%s'", lib),
> +                    domain = NA)
>     }
> 
>     ## check for writability by user

I wholeheartedly support the change discussed here since it is also something that has been worrying my students for some time.

However, I think saying "argument 'lib' not specified: using '%s'" would be even less alarming. "... is missing" sort of implies the user forgot something.

My 0.02 $


Dr. Vincent Goulet
Full Professor
?cole d'actuariat, Universit? Laval, Qu?bec 
vincent.goulet at act.ulaval.ca   http://vgoulet.act.ulaval.ca


> 
> 
> -- 
> Ben Bolker
> Associate professor, Biology Dep't, Univ. of Florida
> *** NEW E-MAIL ADDRESSES:
> ***   bbolker at gmail.com , bolker at math.mcmaster.ca
> bolker at ufl.edu / people.biology.ufl.edu/bolker
> GPG key: people.biology.ufl.edu/bolker/benbolker-publickey.asc
> 
> <signature.asc><ATT00001..txt>


From maechler at stat.math.ethz.ch  Thu Jun  3 16:59:01 2010
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Thu, 3 Jun 2010 16:59:01 +0200
Subject: [Rd] warning from install.packages()
In-Reply-To: <4A59132E-098B-4D93-8A7C-62E313EF717C@act.ulaval.ca>
References: <4BFC3228.9010400@ufl.edu> <C822177B.EBC1%jari.oksanen@oulu.fi>
	<loom.20100601T142323-304@post.gmane.org>
	<Zen-1OJrWm-0006gD-SM@smarthost02.mail.zen.net.uk>
	<4C0698AE.7010304@ufl.edu>
	<19463.25159.870742.187684@lynne.math.ethz.ch>
	<4C07ADC2.1010101@ufl.edu>
	<4A59132E-098B-4D93-8A7C-62E313EF717C@act.ulaval.ca>
Message-ID: <19463.49973.672967.733185@lynne.math.ethz.ch>

>>>>> "VG" == Vincent Goulet <Vincent.Goulet at act.ulaval.ca>
>>>>>     on Thu, 3 Jun 2010 10:24:21 -0400 writes:

    VG> Le jeu. 3 juin ? 09:27, Ben Bolker a ?crit :
    >> Martin Maechler wrote:
    >>>>>>>> "BB" == Ben Bolker <bolker at ufl.edu>
    >>>>>>>> on Wed, 02 Jun 2010 13:45:18 -0400 writes:
    >>> 
    BB> Michael Dewey wrote:
    >>>>> At 13:40 01/06/2010, Ben Bolker wrote:
    >>>>> 
    >>>>>>> On 25/05/10 23:25 PM, "Ben Bolker" <bolker <at> ufl.edu> wrote:
    >>>>>>> Just curious: is there a particular reason why install.packages()
    >>>>>>> gives a warning in normal use when 'lib' is not specified (e.g. argument
    >>>>>>> 'lib' is missing: using '/usr/local/lib/R/site-library' )?
    >>>>> 
    >>>>> As I see it R is saying 'I am doing what you told 
    >>>>> me, but just in case I am checking whether that 
    >>>>> was what you really wanted'. Note that you do not 
    >>>>> get a warning if there was only one place R could 
    >>>>> put it. I would certainly vote for a message if 
    >>>>> people are getting unnecessarily alarmed by the warning.
    >>> 
    BB> But this seems so different from R's general philosophy/behavior
    BB> (inherited from Unix?) that a function that gets correct input and
    BB> executes without error returns silently ...
    >>> 
    >>> That's correct.
    >>> Note however that installing a package is not just a thing
    >>> happening in your R session.
    >>> It will affect all your future R sessions, and possibly even
    >>> other users' who have the same  .libPaths()[1]
    >>> {e.g. the group here does share it}.
    >>> 
    >>> I'd agree to not put a warning but I'd definitely want a message
    >>> aka "note" to the user.
    >>> The *wording* of that note should not be alarming at all, I
    >>> agree, just a note to the user.
    >>> 
    >>> Martin Maechler, ETH Zurich
    >> 
    >> OK, then, how about this as a minimal change?
    >> 
    >> ===================================================================
    >> --- packages.R	(revision 52192)
    >> +++ packages.R	(working copy)
    >> @@ -534,8 +534,8 @@
    >> 
    >> if(missing(lib) || is.null(lib)) {
    >> lib <- .libPaths()[1L]
    >> -        warning(gettextf("argument 'lib' is missing: using %s", lib),
    >> -                immediate. = TRUE, domain = NA)
    >> +        message(gettextf("argument 'lib' is missing: using %s", lib),
    >> +                domain = NA)
    >> }
    >> 
    >> paths <- .find.package(pkgs, lib)
    >> Index: packages2.R
    >> ===================================================================
    >> --- packages2.R	(revision 52192)
    >> +++ packages2.R	(working copy)
    >> @@ -193,8 +193,8 @@
    >> if(missing(lib) || is.null(lib)) {
    >> lib <- .libPaths()[1L]
    >> if(length(.libPaths()) > 1L)
    >> -            warning(gettextf("argument 'lib' is missing: using '%s'", lib),
    >> -                    immediate. = TRUE, domain = NA)
    >> +            message(gettextf("argument 'lib' is missing: using '%s'", lib),
    >> +                    domain = NA)
    >> }
    >> 
    >> ## check for writability by user

    VG> I wholeheartedly support the change discussed here since it is also something that has been worrying my students for some time.

    VG> However, I think saying "argument 'lib' not specified: using '%s'" would be even less alarming. "... is missing" sort of implies the user forgot something.

Yes, thank you Vincent,
I meant some such change when I said

    >>> The *wording* of that note should not be alarming at all, I
    >>> agree, just a note to the user.

I'd even change it further, to something like
 "Installing package into '%s' (as 'lib' is not specified)"

Martin




    VG> Dr. Vincent Goulet
    VG> Full Professor
    VG> ?cole d'actuariat, Universit? Laval, Qu?bec 
    VG> vincent.goulet at act.ulaval.ca   http://vgoulet.act.ulaval.ca


    >> 
    >> 
    >> -- 
    >> Ben Bolker
    >> Associate professor, Biology Dep't, Univ. of Florida
    >> *** NEW E-MAIL ADDRESSES:
    >> ***   bbolker at gmail.com , bolker at math.mcmaster.ca
    >> bolker at ufl.edu / people.biology.ufl.edu/bolker
    >> GPG key: people.biology.ufl.edu/bolker/benbolker-publickey.asc
    >> 
    >> <signature.asc><ATT00001..txt>


From hpages at fhcrc.org  Thu Jun  3 22:25:10 2010
From: hpages at fhcrc.org (=?ISO-8859-1?Q?Herv=E9_Pag=E8s?=)
Date: Thu, 03 Jun 2010 13:25:10 -0700
Subject: [Rd] named empty list
Message-ID: <4C080FA6.9070400@fhcrc.org>

Hi,

I just realized that a named empty list is displayed the same
way as an empty list:

   > list(aa=2:5)[0]
   list()
   > list()
   list()

For empty atomic vectors, the print method makes the difference:

   > c(aa=3L)[0]
   named integer(0)
   > integer(0)
   integer(0)

Maybe lists could do that too?

Thanks,
H.


 > sessionInfo()
R version 2.12.0 Under development (unstable) (2010-04-20 r51787)
x86_64-unknown-linux-gnu

locale:
  [1] LC_CTYPE=en_CA.UTF-8       LC_NUMERIC=C
  [3] LC_TIME=en_CA.UTF-8        LC_COLLATE=en_CA.UTF-8
  [5] LC_MONETARY=C              LC_MESSAGES=en_CA.UTF-8
  [7] LC_PAPER=en_CA.UTF-8       LC_NAME=C
  [9] LC_ADDRESS=C               LC_TELEPHONE=C
[11] LC_MEASUREMENT=en_CA.UTF-8 LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base


-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M2-B876
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fhcrc.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From hpages at fhcrc.org  Fri Jun  4 02:53:33 2010
From: hpages at fhcrc.org (=?ISO-8859-1?Q?Herv=E9_Pag=E8s?=)
Date: Thu, 03 Jun 2010 17:53:33 -0700
Subject: [Rd] Argument recycling in substring()
Message-ID: <4C084E8D.4000002@fhcrc.org>

Hi,

According to its man page substring() "expands (its) arguments
cyclically to the length of the longest _provided_ none are of
zero length".

So, as expected, I get an error here:

   > substring("abcd", first=2L, last=integer(0))
   Error in substring("abcd", first = 2L, last = integer(0)) :
     invalid substring argument(s)

But I don't get one here:

   > substring(character(0), first=1:2, last=3L)
   character(0)

which is unexpected.

Otherwise, yes substring() will recycle its arguments to the
length of the longest:

   > substring("abcd", first=1:3, last=4:3)
   [1] "abcd" "bc"   "cd"

Cheers,
H.

-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M2-B876
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fhcrc.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From djsamperi at gmail.com  Fri Jun  4 07:00:08 2010
From: djsamperi at gmail.com (Dominick Samperi)
Date: Fri, 4 Jun 2010 01:00:08 -0400
Subject: [Rd] vignettes processed twice under Windows?
Message-ID: <AANLkTil_a8Of5Qya0KlEL8-NJZVyPYWR-iy9nqJF35Wq@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20100604/4247e318/attachment.pl>

From maechler at stat.math.ethz.ch  Fri Jun  4 11:43:38 2010
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Fri, 4 Jun 2010 11:43:38 +0200
Subject: [Rd] named empty list
In-Reply-To: <4C080FA6.9070400@fhcrc.org>
References: <4C080FA6.9070400@fhcrc.org>
Message-ID: <19464.51914.206199.975249@lynne.math.ethz.ch>

>>>>> "HP" == Herv? Pag?s <hpages at fhcrc.org>
>>>>>     on Thu, 03 Jun 2010 13:25:10 -0700 writes:

    HP> Hi,
    HP> I just realized that a named empty list is displayed the same
    HP> way as an empty list:

    >> list(aa=2:5)[0]
    HP> list()
    >> list()
    HP> list()

    HP> For empty atomic vectors, the print method makes the difference:

    >> c(aa=3L)[0]
    HP> named integer(0)
    >> integer(0)
    HP> integer(0)

    HP> Maybe lists could do that too?

Yes, I agree.  I have had at least one situation in the past
where I had even been confused for a few minutes by this.
I'm about to add it for R-devel [2.12.0] (only; considering it a
new feature).

Martin Maechler, ETH Zurich


From maechler at stat.math.ethz.ch  Fri Jun  4 11:46:29 2010
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Fri, 4 Jun 2010 11:46:29 +0200
Subject: [Rd] Argument recycling in substring()
In-Reply-To: <4C084E8D.4000002@fhcrc.org>
References: <4C084E8D.4000002@fhcrc.org>
Message-ID: <19464.52085.361753.726627@lynne.math.ethz.ch>

>>>>> "HP" == Herv? Pag?s <hpages at fhcrc.org>
>>>>>     on Thu, 03 Jun 2010 17:53:33 -0700 writes:

    HP> Hi,
    HP> According to its man page substring() "expands (its) arguments
    HP> cyclically to the length of the longest _provided_ none are of
    HP> zero length".

    HP> So, as expected, I get an error here:

    >> substring("abcd", first=2L, last=integer(0))
    HP> Error in substring("abcd", first = 2L, last = integer(0)) :
    HP> invalid substring argument(s)

    HP> But I don't get one here:

    >> substring(character(0), first=1:2, last=3L)
    HP> character(0)

    HP> which is unexpected.
according to the docu.

My gut feeling would say that the documentation should be
updated in this case, rather than the implementation.

RFC! other opinions?


    HP> Otherwise, yes substring() will recycle its arguments to the
    HP> length of the longest:

    >> substring("abcd", first=1:3, last=4:3)
    HP> [1] "abcd" "bc"   "cd"




    HP> Cheers,
    HP> H.

    HP> -- 
    HP> Herv? Pag?s

    HP> Program in Computational Biology
    HP> Division of Public Health Sciences
    HP> Fred Hutchinson Cancer Research Center
    HP> 1100 Fairview Ave. N, M2-B876
    HP> P.O. Box 19024
    HP> Seattle, WA 98109-1024

    HP> E-mail: hpages at fhcrc.org
    HP> Phone:  (206) 667-5791
    HP> Fax:    (206) 667-1319

    HP> ______________________________________________
    HP> R-devel at r-project.org mailing list
    HP> https://stat.ethz.ch/mailman/listinfo/r-devel


From deepayan.sarkar at gmail.com  Fri Jun  4 12:10:10 2010
From: deepayan.sarkar at gmail.com (Deepayan Sarkar)
Date: Fri, 4 Jun 2010 15:40:10 +0530
Subject: [Rd] Argument recycling in substring()
In-Reply-To: <19464.52085.361753.726627@lynne.math.ethz.ch>
References: <4C084E8D.4000002@fhcrc.org>
	<19464.52085.361753.726627@lynne.math.ethz.ch>
Message-ID: <AANLkTim3FDCsrgi3rMJ2WeQy_BbiWRDyLXFgjQFc3z7f@mail.gmail.com>

2010/6/4 Martin Maechler <maechler at stat.math.ethz.ch>:
>>>>>> "HP" == Herv? Pag?s <hpages at fhcrc.org>
>>>>>> ? ? on Thu, 03 Jun 2010 17:53:33 -0700 writes:
>
> ? ?HP> Hi,
> ? ?HP> According to its man page substring() "expands (its) arguments
> ? ?HP> cyclically to the length of the longest _provided_ none are of
> ? ?HP> zero length".
>
> ? ?HP> So, as expected, I get an error here:
>
> ? ?>> substring("abcd", first=2L, last=integer(0))
> ? ?HP> Error in substring("abcd", first = 2L, last = integer(0)) :
> ? ?HP> invalid substring argument(s)
>
> ? ?HP> But I don't get one here:
>
> ? ?>> substring(character(0), first=1:2, last=3L)
> ? ?HP> character(0)
>
> ? ?HP> which is unexpected.
> according to the docu.
>
> My gut feeling would say that the documentation should be
> updated in this case, rather than the implementation.
>
> RFC! other opinions?

I agree. The current behaviour is reasonable.

-Deepayan


From pdalgd at gmail.com  Fri Jun  4 13:06:47 2010
From: pdalgd at gmail.com (peter dalgaard)
Date: Fri, 4 Jun 2010 13:06:47 +0200
Subject: [Rd] Argument recycling in substring()
In-Reply-To: <AANLkTim3FDCsrgi3rMJ2WeQy_BbiWRDyLXFgjQFc3z7f@mail.gmail.com>
References: <4C084E8D.4000002@fhcrc.org>
	<19464.52085.361753.726627@lynne.math.ethz.ch>
	<AANLkTim3FDCsrgi3rMJ2WeQy_BbiWRDyLXFgjQFc3z7f@mail.gmail.com>
Message-ID: <2227612C-77EA-4223-BC6D-9CE7EA926E27@gmail.com>


On Jun 4, 2010, at 12:10 PM, Deepayan Sarkar wrote:

> 2010/6/4 Martin Maechler <maechler at stat.math.ethz.ch>:
>>>>>>> "HP" == Herv? Pag?s <hpages at fhcrc.org>
>>>>>>>     on Thu, 03 Jun 2010 17:53:33 -0700 writes:
>> 
>>    HP> Hi,
>>    HP> According to its man page substring() "expands (its) arguments
>>    HP> cyclically to the length of the longest _provided_ none are of
>>    HP> zero length".
>> 
>>    HP> So, as expected, I get an error here:
>> 
>>    >> substring("abcd", first=2L, last=integer(0))
>>    HP> Error in substring("abcd", first = 2L, last = integer(0)) :
>>    HP> invalid substring argument(s)
>> 
>>    HP> But I don't get one here:
>> 
>>    >> substring(character(0), first=1:2, last=3L)
>>    HP> character(0)
>> 
>>    HP> which is unexpected.
>> according to the docu.
>> 
>> My gut feeling would say that the documentation should be
>> updated in this case, rather than the implementation.
>> 
>> RFC! other opinions?
> 
> I agree. The current behaviour is reasonable.

Yes, but I don't see how it is inconsistent with the docs. It says that it won't recycle, and it doesn't. The fact that the combination of 0-length index and a positive-length x is nonsensical is an orthogonal issue. (Notice, BTW, that
x <- character(0); i <- integer(0); substr(x,i,i) does NOT give an error.)

Of course it is never harmful to be explicit about things....

> 
> -Deepayan
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel

-- 
Peter Dalgaard
Center for Statistics, Copenhagen Business School
Solbjerg Plads 3, 2000 Frederiksberg, Denmark
Phone: (+45)38153501
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From hadley at rice.edu  Fri Jun  4 13:15:16 2010
From: hadley at rice.edu (Hadley Wickham)
Date: Fri, 4 Jun 2010 06:15:16 -0500
Subject: [Rd] Argument recycling in substring()
In-Reply-To: <4C084E8D.4000002@fhcrc.org>
References: <4C084E8D.4000002@fhcrc.org>
Message-ID: <AANLkTimC2CL6cEZHdIUBjQY7b5Q3eXztoev0mM7QuF-d@mail.gmail.com>

> According to its man page substring() "expands (its) arguments
> cyclically to the length of the longest _provided_ none are of
> zero length".
>
> So, as expected, I get an error here:
>
> ?> substring("abcd", first=2L, last=integer(0))
> ?Error in substring("abcd", first = 2L, last = integer(0)) :
> ? ?invalid substring argument(s)
>
> But I don't get one here:
>
> ?> substring(character(0), first=1:2, last=3L)
> ?character(0)
>
> which is unexpected.

If you want a set of string functions that strive to be simple and
consistent you might want to look at the stringr package.  And since
it's a new package, I'm very keen to remove any inconsistencies.

Hadley

-- 
Assistant Professor / Dobelman Family Junior Chair
Department of Statistics / Rice University
http://had.co.nz/


From djsamperi at gmail.com  Fri Jun  4 17:11:11 2010
From: djsamperi at gmail.com (Dominick Samperi)
Date: Fri, 4 Jun 2010 11:11:11 -0400
Subject: [Rd] Suggested change to build.pl
Message-ID: <AANLkTim59zs7e6QV0CmCuM7SBUWfYAn7lBjywc9eP9OD@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20100604/7891841e/attachment.pl>

From wdunlap at tibco.com  Fri Jun  4 17:56:58 2010
From: wdunlap at tibco.com (William Dunlap)
Date: Fri, 4 Jun 2010 08:56:58 -0700
Subject: [Rd] Argument recycling in substring()
In-Reply-To: <19464.52085.361753.726627@lynne.math.ethz.ch>
References: <4C084E8D.4000002@fhcrc.org>
	<19464.52085.361753.726627@lynne.math.ethz.ch>
Message-ID: <77EB52C6DD32BA4D87471DCD70C8D70003083804@NA-PA-VBE03.na.tibco.com>

> -----Original Message-----
> From: r-devel-bounces at r-project.org 
> [mailto:r-devel-bounces at r-project.org] On Behalf Of Martin Maechler
> Sent: Friday, June 04, 2010 2:46 AM
> To: Herv? Pag?s
> Cc: r-devel at stat.math.ethz.ch
> Subject: Re: [Rd] Argument recycling in substring()
> 
> >>>>> "HP" == Herv? Pag?s <hpages at fhcrc.org>
> >>>>>     on Thu, 03 Jun 2010 17:53:33 -0700 writes:
> 
>     HP> Hi,
>     HP> According to its man page substring() "expands (its) arguments
>     HP> cyclically to the length of the longest _provided_ none are of
>     HP> zero length".
> 
>     HP> So, as expected, I get an error here:
> 
>     >> substring("abcd", first=2L, last=integer(0))
>     HP> Error in substring("abcd", first = 2L, last = integer(0)) :
>     HP> invalid substring argument(s)
> 
>     HP> But I don't get one here:
> 
>     >> substring(character(0), first=1:2, last=3L)
>     HP> character(0)
> 
>     HP> which is unexpected. according to the docu.
> 
> My gut feeling would say that the documentation should be
> updated in this case, rather than the implementation.
> 
> RFC! other opinions?

I think it would be nice if multiargument vectorized
functions in core R used the rules that are used by
the arithmetic functions (`+`, etc.):
   a) if any argument length is 0, then the output
      length is 0
   b) otherwise the output is the length of the longest
      input
The arithmetic functions also warn if the output length
is not a multiple of some input length.   (They actually
warn 'longer ... length is not a multiple of shorter ...'
and I'm extrapolating that to more than two arguments.)
Most other multi-vectorized functions (e.g., log, pnorm)
don't currently warn.

If they all followed the same rules then it would be easier
to write code involving unfamiliar functions.  The rule
could be stated in one help file and a help file for a
given function could say that arguments x, y, and z,
but not a or b, are 'vectorized', with a link to the one
help file describing vectorization.  Even better, the C
and C++ API's could be expanded to do the standard
multivectorization so not every function would do it
in its own way.

Some functions cannot be changed to follow that rule because
it would break too much code (e.g., paste() and cat()).
However, why shouldn't substring return character(0) if
any argument is 0 long?

By the way, the 'zero rule' is there so we don't have to
write so many if(length(x)>0) statements around things like
    which(x) + 1
or
    substring(x, 1, nchar(x)-1)
where the scalar 1 would otherwise cause NA's to arise.

[Perhaps I should not state my opinion so forcibly, since.
for legal reasons, I'm not in a position to change core R code.]

Bill Dunlap
Spotfire, TIBCO Software
wdunlap tibco.com 

> 
> 
>     HP> Otherwise, yes substring() will recycle its arguments to the
>     HP> length of the longest:
> 
>     >> substring("abcd", first=1:3, last=4:3)
>     HP> [1] "abcd" "bc"   "cd"
> 
> 
> 
> 
>     HP> Cheers,
>     HP> H.
> 
>     HP> -- 
>     HP> Herv? Pag?s
> 
>     HP> Program in Computational Biology
>     HP> Division of Public Health Sciences
>     HP> Fred Hutchinson Cancer Research Center
>     HP> 1100 Fairview Ave. N, M2-B876
>     HP> P.O. Box 19024
>     HP> Seattle, WA 98109-1024
> 
>     HP> E-mail: hpages at fhcrc.org
>     HP> Phone:  (206) 667-5791
>     HP> Fax:    (206) 667-1319
> 
>     HP> ______________________________________________
>     HP> R-devel at r-project.org mailing list
>     HP> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 


From ligges at statistik.tu-dortmund.de  Fri Jun  4 19:02:28 2010
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Fri, 04 Jun 2010 19:02:28 +0200
Subject: [Rd] Win-builder etc. offline
Message-ID: <4C0931A4.2020600@statistik.tu-dortmund.de>

Dear developers,

the Maths building at TU Dortmund university has a scheduled power 
outage during this weekend which means the win-builder service (usually 
available from http://win-builder.r-project.org/) as well as Windows 
binary package building for CRAN will be offline from roughly now until 
monday morning (CEST) ... and so (offline) is my mail server ...

Best wishes,
Uwe Ligges


From hpages at fhcrc.org  Fri Jun  4 22:58:15 2010
From: hpages at fhcrc.org (=?ISO-8859-1?Q?Herv=E9_Pag=E8s?=)
Date: Fri, 04 Jun 2010 13:58:15 -0700
Subject: [Rd] named empty list
In-Reply-To: <19464.51914.206199.975249@lynne.math.ethz.ch>
References: <4C080FA6.9070400@fhcrc.org>
	<19464.51914.206199.975249@lynne.math.ethz.ch>
Message-ID: <4C0968E7.4060402@fhcrc.org>

Thanks Martin.  H.

Martin Maechler wrote:
>>>>>> "HP" == Herv? Pag?s <hpages at fhcrc.org>
>>>>>>     on Thu, 03 Jun 2010 13:25:10 -0700 writes:
> 
>     HP> Hi,
>     HP> I just realized that a named empty list is displayed the same
>     HP> way as an empty list:
> 
>     >> list(aa=2:5)[0]
>     HP> list()
>     >> list()
>     HP> list()
> 
>     HP> For empty atomic vectors, the print method makes the difference:
> 
>     >> c(aa=3L)[0]
>     HP> named integer(0)
>     >> integer(0)
>     HP> integer(0)
> 
>     HP> Maybe lists could do that too?
> 
> Yes, I agree.  I have had at least one situation in the past
> where I had even been confused for a few minutes by this.
> I'm about to add it for R-devel [2.12.0] (only; considering it a
> new feature).
> 
> Martin Maechler, ETH Zurich

-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M2-B876
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fhcrc.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From pauljohn32 at gmail.com  Fri Jun  4 23:14:33 2010
From: pauljohn32 at gmail.com (Paul Johnson)
Date: Fri, 4 Jun 2010 16:14:33 -0500
Subject: [Rd] Renviron settings for Linux Distributions: please tell me R
	Core's advice
Message-ID: <AANLkTikjUmMHAxcRANv612xgwI9AkexYrTA8Eo3Efhwm@mail.gmail.com>

Dear R-devel:

i have noticed a little wrinkle in R packaging for RPM systems and
have communicated with the package maintainer at RedHat Tom Callaway
(see far below).

Here is the question:

Where does R Core Team want packagers to fiddle around with R library paths?

Currently, the RPM Spec file used for EPEL's R (For
Fedora/Redhat/Centos,etc) adds a line in R_HOME/etc/Renviron like
this:

R_LIBS=${R_LIBS-'"'%{_libdir}/R/library:%{_datadir}/R/library'"'}'

Setting R_LIBS has some bad effects. It seems to block R_LIBS_USER, so
users who try to install packages are not invited to install them in
~/R/i386... as they are invited to do on Ubuntu.

On Ubuntu, Renviron file has been modified thus:

R_LIBS_USER=${R_LIBS_USER-'~/R/x86_64-pc-linux-gnu-library/2.11'}
R_LIBS_SITE=${R_LIBS_SITE-'/usr/local/lib/R/site-library:/usr/lib/R/site-library:/usr/lib/R/library'}

That has a nice effect. They set the default install library to
/usr/local/lib/R/site-library, so things that local admin builds are
separate from the packaged stuff, which goes into /usr/lib/R/library.

I'm not the packager, but I'm in communication with him and this is a
good time to get it right, from your point of view. Tom  suggests that
the RPM packaging should manipulate R_LIBS_SITE, which I think is
better than R_LIBS.

However, in the documentation for the base Startup, the R docs say

"The file ?R_HOME/etc/Renviron? is always read very early in the
start-up processing. It contains environment variables set by R in the
configure process. Values in that file can be overridden in site or
user environment files: do not change ?R_HOME/etc/Renviron? itself.
Note that this is distinct from ?R_HOME/etc/Renviron.site?."

That's addressing post-install admin, not packagers, right? Is there
another recommended place to make the changes that we want to make?

pj

---------- Forwarded message ----------
From: Tom "spot" Callaway <tcallawa at redhat.com>
Date: Thu, Jun 3, 2010 at 12:03 PM
Subject: Re: How to go about getting a change in the SPEC file from
which R is 	built on EPEL?
To: Paul Johnson <pauljohn32 at gmail.com>
Cc: r-sig-fedora at r-project.org


On 06/03/2010 12:14 PM, Paul Johnson wrote:
> R_LIBS_SITE=${R_LIBS_SITE-'/usr/local/lib/R/site-library:/usr/lib/R/site-library:/usr/lib/R/library'}
>
> I wondered why the RedHat/Fedora install of the R RPM don't see
> same/similar options. On Fedora/RedHat using R from RPM as distributed
> on EPEL, all the packages go into /usr/lib/R and nonroot users are out
> of luck, pretty much, unless they make some special effort.
>
> There was some debate here about what the folder in the user home dir
> should be called, but none of us realized that R, as it comes from the
> "factory", will work pretty much the way I want.
>
> The problem is that the RPM is built from a SPEC file that inserts a
> line into R's Renviron that enforces a ?variable
> R_LIBS and it has some kind of super power to block the R_LIBS_SITE
> and R_LIBS_USER variables. ?Specifically, I mean this line in the SPEC
> file.
>
> %build
> Add PATHS to Renviron for R_LIBS
> echo 'R_LIBS=${R_LIBS-'"'%{_libdir}/R/library:%{_datadir}/R/library'"'}'
>>> >> etc/Renviron.in
> On my systems, I comment out those lines in the spec file and then R
> works the way the authors intended. ?Judging from the comments that
> Dirk Eddelbuettel inserted in the Debian packaging, sometime around
> 2007 the R LIBS framework changed.

So, a few corrections:

On Fedora:

* Architecture specific R modules go into %{_libdir}/R/library
* Architecture independent R modules go into %{_datadir}/R/library

I don't believe that without making some change, R will look in
%{_datadir}/R/library at all.

It looks like we should be overloading R_LIBS_SITE as opposed to R_LIBS.

Easy peasy. :)

Can you try changing that line in the spec file to this and confirm that
it resolves the issue:

echo
'R_LIBS_SITE=${R_LIBS_SITE-'"'/usr/local/lib/R/site-library:/usr/local/lib/R/library:%{_libdir}/R/library:%{_datadir}/R/library'"'}'
>> etc/Renviron.in

(Note: email client wrapped it, but it should be one long line)

~spot



-- 
Paul E. Johnson
Professor, Political Science
1541 Lilac Lane, Room 504
University of Kansas


From thomas.friedrichsmeier at ruhr-uni-bochum.de  Sat Jun  5 14:27:19 2010
From: thomas.friedrichsmeier at ruhr-uni-bochum.de (Thomas Friedrichsmeier)
Date: 5 Jun 2010 14:27:19 +0200
Subject: [Rd] R_ReplDLLdo1 and task callbacks
Message-ID: <201006051427.20044.thomas.friedrichsmeier@ruhr-uni-bochum.de>

Dear R developers,

in RKWard we use a custom main loop built around R_ReplDLLdo1(). Recently I 
found out that toplevel task callback are not called. Looking at the source of 
R_ReplDLLdo1() in main.c, the reason is easy to see: This simply does not 
include a call to Rf_callToplevelHandlers().

There may well be reasons for that. On the other hand, I could not find 
explicit documentation to this effect, and according to svn annotate, 
R_ReplDLLdo1() predates task callbacks. So perhaps this is an oversight after 
all. Using the google code search, the only other use case I could find 
(besides R test cases, and RKWard) is the Mac-GUI. I would assume that calling 
the task callback handlers would be the desired behavior, there, too.

I did not find any way to integrate the task callback handlers from the 
embedding application, when using R_ReplDLLdo1(). Is there any? Would it be 
possible to add a call to Rf_callToplevelHandlers in R_ReplDLLdo1() (*)? 
Alternatively, would it be possible to add an equivalent of
  R_ReplConsole(R_GlobalEnv, R_PPStackTop, 0);
to the API (importantly without calls to setup_Rmainloop() and 
end_Rmainloop())?

Thanks,
Thomas

--

(*): In fact, I wonder, why R_ReplDLLdo1() is not simply based on 
Rf_ReplIteration().
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 198 bytes
Desc: This is a digitally signed message part.
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20100605/ffab335d/attachment.bin>

From ligges at statistik.tu-dortmund.de  Mon Jun  7 12:15:30 2010
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Mon, 07 Jun 2010 12:15:30 +0200
Subject: [Rd] Suggested change to build.pl
In-Reply-To: <AANLkTim59zs7e6QV0CmCuM7SBUWfYAn7lBjywc9eP9OD@mail.gmail.com>
References: <AANLkTim59zs7e6QV0CmCuM7SBUWfYAn7lBjywc9eP9OD@mail.gmail.com>
Message-ID: <4C0CC6C2.8060303@statistik.tu-dortmund.de>



On 04.06.2010 17:11, Dominick Samperi wrote:
> Under Linux the cleanup script (if it exists) is run at the end, before
> the package archive is created, and this prevents intermediate files
> that are no longer needed from being written to the archive.
>
> Unfortunately, this does not happen under Windows when there
> is a cleanup.win. That is, cleanup.win is not run before the
> archive is created.
>
> Here is the code in build.pl that checks for cleanup and runs
> it before building the archive:
>
> if(!$WINDOWS&&  -x "./cleanup") {
>      $log->message("running cleanup");
>      R_system("./cleanup");
>   }
>
> But the case where $WINDOWS is true is never
> addressed.
>
> The problem can be resolved by adding:
>
> if($WINDOWS&&  -e "./cleanup.win") {
>       $log->message("running cleanup.win");
>       R_system("./cleanup.win")
> }
>
> Does this make sense?


Since changes can only happen for R-devel, I'd suggest to think about 
the *R* code in R-devel rather than a perl script that does not exists 
any more (just its backup copy obuild.pl exists) in the current R-devel 
sources.

Another point to be considered is why you need a cleanup script. I have 
rarely seen cases where this is required.

Best,
Uwe Ligges


> Thanks,
> Dominick
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From bolker at ufl.edu  Mon Jun  7 15:40:14 2010
From: bolker at ufl.edu (Ben Bolker)
Date: Mon, 07 Jun 2010 09:40:14 -0400
Subject: [Rd] [R] Wrong symbol rendering in plots (Ubuntu)
In-Reply-To: <4C0CE3FB.7050404@uhb.fr>
References: <4C0CE3FB.7050404@uhb.fr>
Message-ID: <4C0CF6BE.2060206@ufl.edu>

  [moving to r-devel]

  This PDF looks fine in all of the viewers I have (xpdf 3.02, okular
0.8.2, acroread 8.1.3, evince/poppler 0.8.7) ... I don't really know
enough about PDF/fonts/etc. to debug this ... if I were going to
continue with this I would probably make some kind of minimal plot:

> pdf("test.pdf")
> plot(0:1,0:1,type="n",axes=FALSE,ann=FALSE)
> text(0.5,0.5,expression(alpha %prop% beta))
> dev.off()

(this comes out to only 1397 bytes on my system), make the equivalent
plot with LaTeX

\documentclass{article}
\begin{document}
$$
\alpha \propto \beta
$$
\end{document}

(7514 bytes)

and try to figure out how the fonts are being treated differently ...

Yvonnick Noel wrote:
> Hello Ben,
>> Does the workaround pointed out later in the thread you're
>> responding to (from the last paragraph of a very long 'Note'
>> section of ?pdf) help?
>>    
> Well, I did not try to edit my fonts.conf but I feel this is not a PDF 
> issue. I have no problem to have greek letters correctly rendered in 
> Ubuntu 10.04 (with LaTeX, or OpenOffice Math for instance with a PDF 
> export). This only appears in R plots.
> 
> Note that other symbols do not render well too. I put a PDF output of 
> demo(plotmath) here:
> 
> http://yvonnick.noel.free.fr/wrongsymbolsinubuntu.pdf
> 
> Thank you.
> 
> Yvonnick
> 
>  > sessionInfo()
> R version 2.11.0 (2010-04-22)
> i486-pc-linux-gnu
> 
> locale:
>   [1] LC_CTYPE=fr_FR.utf8       LC_NUMERIC=C
>   [3] LC_TIME=fr_FR.utf8        LC_COLLATE=fr_FR.utf8
>   [5] LC_MONETARY=C             LC_MESSAGES=fr_FR.utf8
>   [7] LC_PAPER=fr_FR.utf8       LC_NAME=C
>   [9] LC_ADDRESS=C              LC_TELEPHONE=C
> [11] LC_MEASUREMENT=fr_FR.utf8 LC_IDENTIFICATION=C
> 
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
> 


-- 
Ben Bolker
Associate professor, Biology Dep't, Univ. of Florida
*** NEW E-MAIL ADDRESSES:
***   bbolker at gmail.com , bolker at math.mcmaster.ca
bolker at ufl.edu / people.biology.ufl.edu/bolker
GPG key: people.biology.ufl.edu/bolker/benbolker-publickey.asc

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 261 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20100607/6c5fb127/attachment.bin>

From jhibschman at gmail.com  Tue Jun  8 16:08:53 2010
From: jhibschman at gmail.com (Johann Hibschman)
Date: Tue, 08 Jun 2010 09:08:53 -0500
Subject: [Rd] Extract/format/show for S4 objects
Message-ID: <u1oljapmxai.fsf@lx-chrateresearch01.citadelgroup.com>

Hi all,

I'm trying to make an integer-backed quarter (as in fraction of year)
class, but I can't quite it to work.  I want integer-backed so I don't
have to worry about floating-point effects when doing math, and so that
I can use it as in data.table.

First of all, is there a good reference for this anywhere?  All of the
S4 tutorials that I've found have been too high-level, and I can't find
any examples of implementing extract.  In S3, I can use [.Date as my
example, but I can't find the equivalent for S4.

Second, is this misguided?

Now for the details.  Given this start:

  library(zoo) # borrowing yearqtr for output.
  setClass("iqtr", contains="integer")
  ## Create an iqtr object from a numeric date (e.g. 2000.5).
  iqtr <- function (x) {
    iq <- as.integer(floor((as.numeric(x) - 2000) * 4 + 0.0001))
    new("iqtr", iq)
  }
  setMethod("show", "iqtr4",
            function (object) {
              cat(format(yearqtr(as.numeric(x) * 0.25 + 2000)))
            })


I have two issues:

  1. Vectors of iqtrs do not display properly.
     They print, but they don't look like vectors.
       > iq <- iqtr(seq(2000, 2002, 0.25))
       > iq
       2000 Q2 2000 Q2 2000 Q3 2000 Q4 2001 Q2 2002 Q1> 

  2. Subsets do not stay in the class.
       > iq[1:2]
       > [1] 0 1

Clearly, I'm just not understanding what's going on.  Is there a guide
for how to make printing, format, subsetting, etc., all work for S4
classes?

Thanks,
Johann


From ggrothendieck at gmail.com  Tue Jun  8 16:30:47 2010
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Tue, 8 Jun 2010 10:30:47 -0400
Subject: [Rd] Extract/format/show for S4 objects
In-Reply-To: <u1oljapmxai.fsf@lx-chrateresearch01.citadelgroup.com>
References: <u1oljapmxai.fsf@lx-chrateresearch01.citadelgroup.com>
Message-ID: <AANLkTinv0WrHgXHiFfHUBO1s9EQvbdojApkTZAPYvo9j@mail.gmail.com>

The yearqtr class already rounds off automatically to avoid floating
point effects and handles #1 and #2.

On the other hand if you are just interested in playing around with S4
for its own sake review the source code of the mondate package as an
example of an S4 based date package.

On Tue, Jun 8, 2010 at 10:08 AM, Johann Hibschman <jhibschman at gmail.com> wrote:
> Hi all,
>
> I'm trying to make an integer-backed quarter (as in fraction of year)
> class, but I can't quite it to work. ?I want integer-backed so I don't
> have to worry about floating-point effects when doing math, and so that
> I can use it as in data.table.
>
> First of all, is there a good reference for this anywhere? ?All of the
> S4 tutorials that I've found have been too high-level, and I can't find
> any examples of implementing extract. ?In S3, I can use [.Date as my
> example, but I can't find the equivalent for S4.
>
> Second, is this misguided?
>
> Now for the details. ?Given this start:
>
> ?library(zoo) # borrowing yearqtr for output.
> ?setClass("iqtr", contains="integer")
> ?## Create an iqtr object from a numeric date (e.g. 2000.5).
> ?iqtr <- function (x) {
> ? ?iq <- as.integer(floor((as.numeric(x) - 2000) * 4 + 0.0001))
> ? ?new("iqtr", iq)
> ?}
> ?setMethod("show", "iqtr4",
> ? ? ? ? ? ?function (object) {
> ? ? ? ? ? ? ?cat(format(yearqtr(as.numeric(x) * 0.25 + 2000)))
> ? ? ? ? ? ?})
>
>
> I have two issues:
>
> ?1. Vectors of iqtrs do not display properly.
> ? ? They print, but they don't look like vectors.
> ? ? ? > iq <- iqtr(seq(2000, 2002, 0.25))
> ? ? ? > iq
> ? ? ? 2000 Q2 2000 Q2 2000 Q3 2000 Q4 2001 Q2 2002 Q1>
>
> ?2. Subsets do not stay in the class.
> ? ? ? > iq[1:2]
> ? ? ? > [1] 0 1
>
> Clearly, I'm just not understanding what's going on. ?Is there a guide
> for how to make printing, format, subsetting, etc., all work for S4
> classes?
>
> Thanks,
> Johann
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From Bill.Glessner at cwu.EDU  Tue Jun  8 19:48:21 2010
From: Bill.Glessner at cwu.EDU (Bill.Glessner at cwu.EDU)
Date: Tue, 08 Jun 2010 10:48:21 -0700 (PDT)
Subject: [Rd] Question on trying to build R 2.11.1 on Tru64(aka OSF1) system
Message-ID: <01NO2O3KE43O8WXU3K@cluster.cwu.edu>


Hello,

I am trying to build the R-2.11.1 software for university faculty to use in
research projects on a DEC/Compaq/HP AlphaServer model GS160 16CPU/64GB memory
running Tru64Unix aka OSF1 version 5.1B-5.
Is it known whether it is possible to build the R-2.11.1 software on the 
platform I am using? 
In my attempts to build the R-2.11.1 software, I first used the native C 
and Fortran 77/90/95 components and GNU make version 3.81:

# cc -V
Compaq C V6.5-011 on HP Tru64 UNIX V5.1B (Rev. 2650)
Compiler Driver V6.5-003 (sys) cc Driver
# f77 -version
 HP Fortran V5.6-104654
 HP Fortran Compiler V5.6-104654-48F7C
# f90 -version
 HP Fortran V5.6-104654
 HP Fortran Compiler V5.6-104654-48F7C
# f95 -version
 HP Fortran V5.6-104654
 HP Fortran Compiler V5.6-104654-48F7C

The build was configured with the command:

./configure "ac_cv_prog_cc_c99=" --prefix=/usr/local/R --disable-nls \
 --with-readline --with-libpng --with-jpeglib \
 --with-system-zlib --with-system-bzlib --with-system-pcre \
 --with-system-xz --with-recommended-packages

The configure executed successfully.
The build attempt exited with an error:

gnumake[1]: Entering directory `/usrX/JunqueYard/R-2.11.1/src/library/Recommende
d'
gnumake[2]: Entering directory `/usrX/JunqueYard/R-2.11.1/src/library/Recommende
d'
begin installing recommended package MASS
/usrX/JunqueYard/R-2.11.1/bin/Rcmd: @: not found
gnumake[2]: *** [MASS.ts] Error 1
gnumake[2]: Leaving directory `/usrX/JunqueYard/R-2.11.1/src/library/Recommended
'
gnumake[1]: *** [recommended-packages] Error 2
gnumake[1]: Leaving directory `/usrX/JunqueYard/R-2.11.1/src/library/Recommended
'
gnumake: *** [stamp-recommended] Error 2

With the configure command:

./configure "ac_cv_prog_cc_c99=" --prefix=/usr/local/R --disable-nls \
 --with-readline --with-libpng --with-jpeglib \
 --with-system-zlib --with-system-bzlib --with-system-pcre \
 --with-system-xz --with-recommended-packages=no

the build completes successfully, but the 'gnumake check' fails with the 
same error

"/usrX/JunqueYard/R-2.11.1/bin/Rcmd: @: not found"

The second attempt was made using gcc/gfortran:

# gcc --version
gcc (GCC) 4.0.2 (TWW)
Copyright (C) 2005 Free Software Foundation, Inc.
This is free software; see the source for copying conditions.  There is NO
warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.

# gfortran --version
GNU Fortran 95 (GCC 4.0.2 (TWW))
Copyright (C) 2005 Free Software Foundation, Inc.

GNU Fortran comes with NO WARRANTY, to the extent permitted by law.
You may redistribute copies of GNU Fortran
under the terms of the GNU General Public License.
For more information about these matters, see the file named COPYING

The build was configured with the command:

./configure --prefix=/usr/local/R --disable-nls \
 --with-readline --with-libpng --with-jpeglib \
 --with-system-zlib --with-system-bzlib --with-system-pcre \
 --with-system-xz --with-recommended-packages

The configure executed successfully.
The build attempt exited with the same error as attempt 1.
Running ./configure with "--with-recommended-packages=no" again allows the
build to complete successfully, but with the same error

"/usrX/JunqueYard/R-2.11.1/bin/Rcmd: @: not found"

as before when trying 'gnumake check'.
Although the 'gnumake check' didn't, I did a 'gnumake install'. The R
environment seems to work; however, anything involving packages fails
with the "/usrX/JunqueYard/R-2.11.1/bin/Rcmd: @: not found".

Can anyone suggest what I am doing incorrectly in configuring/building R?

The config.site file follows:
#! /bin/sh

### This file is part of R.
###
### R is free software; you can redistribute it and/or modify it under
### the terms of the GNU General Public License as published by the Free
### Software Foundation; either version 2 of the License, or (at your
### option) any later version.
###
### R is distributed in the hope that it will be useful, but WITHOUT ANY
### WARRANTY; without even the implied warranty of MERCHANTABILITY or
### FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public
### License for more details.
###
### You should have received a copy of the GNU General Public License
### along with R; if not, a copy is available at
### http://www.r-project.org/Licenses/

## By means of this file you can (also) provide default values for the
## configuration process.  To set variables, uncomment the VAR=DEFAULT
## lines and set DEFAULT according to your needs.
## See etc/Renviron.in for further variables you may wish to set.

## The command used to spool PostScript files to the printer.
## If unspecified, the system will look for either 'lpr' or 'lp'.
## R_PRINTCMD=lpr
R_PRINTCMD=lpr

## The paper size for the local (PostScript) printer.
## It must either be left blank or set to one of 'a4' or 'letter'.
## If left blank the system will use 'a4'.
## R_PAPERSIZE=a4
R_PAPERSIZE=letter

## Set the default behavior of R when ending a session
## Set this to one of '--save' or '--no-save' depending whether you
## want automatic saving of '.RData' or not.
## Note that this applies to interactive and batch use,
## but NOT to the utility R CMD BATCH
## (which defaults to --save irrespective of this setting)
## R_BATCHSAVE=

## The command which runs the C compiler.
## If unspecified, a search is made for gcc and cc (in that order).
## To override this choice, specify the name of the command which runs
## the compiler here, for example 'c89'.
## It is also convenient to set the architecture here, e.g. 'gcc -m32'.
## NB, as from R 2.5.0 configure will append flags for C99 compliance,
## e.g. CC=gcc -std=gnu99
## To avoid this, set contradictory flags (such as -ansi) as part of CFLAGS.
## CC=

## Debugging and optimization options for the C compiler.
## Use this to specify CFLAGS for the version of the C compiler
## specified above.
## If unspecified, defaults to '-g -O2' for gcc,
## and '-g' in all other cases except icc (for which see R-admin.html).
## CFLAGS=

## Defines for C compilation.
## Use this to specify defines to be used in the compilation of R,
## e.g. -DUSE_TYPE_CHECKING_STRICT
## DEFS=

## The following additional CFLAGS to be used only in the main
## compilation and only in building shared libraries respectively.
## For example, on some systems one needs 'MAIN_CFLAGS=-pg' when
## profiling.
## MAIN_CFLAGS=
## SHLIB_CFLAGS=

## Header file search directory ('-IDIR') and any other miscellaneous
## options (such as defines) for the C preprocessor and compiler.
## If unset defaults to '-I/usr/local/include', with '-I/sw/include'
## prepended on systems using Fink with root '/sw'.
## CPPFLAGS=

## The command which runs the FORTRAN 77 compiler.
## If this is not specified, a search is made for
## f95 fort xlf95 ifort ifc efc pgf95 lf95 gfortran ftn g95
## f90 xlf90 pgf90 pghpf epcf90
## g77 f77 xlf frt pgf77 cf77 fort77 fl32 af77
## On HPUX fort77 is the POSIX compliant FORTRAN compiler, and replaces
## f77 in the search list.
## If CC is gcc, first preference is given to the matching FORTRAN
## compiler (g77 or gfortran).
## If none of these is found, R cannot be compiled.
## F77=
F77=gfortran

## Options for the FORTRAN 77 compiler.
## Use this to specify FFLAGS for the version of the compiler specified
## above.  If unspecified, defaults to '-g -O2' for g77/gfortran,
## otherwise '-g' if this is accepted, otherwise ''.
## FFLAGS=
FFLAGS="-g -O2"

## Options for safe compilation under the FORTRAN 77 compiler.
## Use this to specify FFLAGS for the version of the compiler specified
## above, using as accurate a result as possible, e.g. no optimization
## or using -ffloat-store.
## SAFE_FFLAGS=
SAFE_FFLAGS="-g"

## The following additional FFLAGS to be used only in the main
## compilation and only in building shared libraries respectively.
## For example, on some systems one needs 'MAIN_FFLAGS=-pg' when
## profiling.
## MAIN_FFLAGS=
## SHLIB_FFLAGS=

## The command to be used to load the main R binary.
## This is usually the FORTRAN 77 or C compiler, but the automatic
## choice can be overriden by means of this variable.
## MAIN_LD=

## The flags which are necessary for loading main program which will
## load DLLs at runtime.  HP-UX and Linux-elf are examples of platforms
## which use this.  These platforms are already taken care of by
## configure, and anything set here will be in addition unless MAIN_LD
## is given.
## For example, one can set flags for profiling here.
## MAIN_LDFLAGS=

## Any special flags which must be used when compiling C code to be
## turned into a shared library.  This is typically something like
## '-fpic' or '-fPIC'.  If this variable is left unspecified an attempt
## is made to automatically detect the correct value by configure.
## CPICFLAGS=

## The following variable can be used to provide any PIC flags for the
## FORTRAN 77 compiler.  If this variable is left
## unspecified an attempt is made to automatically detect the correct
## value by configure.
## FPICFLAGS=

## The command to be used to create shared objects which contain object
## files from a C or FORTRAN 77 compiler only.  This is usually the C
## compiler or 'ld', but the automatic choice can be overridden by means
## of this variable.
## SHLIB_LD=

## Any special flags which are required by the linker when creating
## shared objects containing object files from a C or FORTRAN 77
## compiler only.  This is usually automatically detected by configure,
## and anything set here will be in addition unless SHLIB_LD is given.
## SHLIB_LDFLAGS=

## ditto for a dynamic library: DYLIB_LDFLAGS defaults to SHLIB_LDFLAGS
## DYLIB_LD=
## DYLIB_LDFLAGS=

## The appropriate 'lib' dir, normally 'lib', but 'lib64' on Linux on
## x86_64, mips64, ppc64, sparc64, s390x but not ia64.
## LIBnn=

## Stripping ('-s'), path ('-L'), and any other miscellaneous options
## for the linker.
## '-L' options set here will be prepended to LD_LIBRARY_PATH (or its
## system equivalent) at run time.
## If unset defaults to '-L/usr/local/lib', with '-L/sw/lib' prepended
## on systems using Fink with root '/sw'.
## On some Linux 64-bit systems its default is -L/usr/local/lib64.
## If LIBnn is set it defaults to -L/usr/local/$LIBnn.
## LDFLAGS=

## The command which runs the C++ compiler.  It not specified, configure
## uses the values of the environment variables 'CXX' or 'CCC' if set,
## and then looks under the names 'c++', 'g++', 'gcc', 'CC', 'cxx', and
## 'cc++' (in that order).
## CXX=
CXX=g++

## Options for the C++ compiler.
## CXXFLAGS=

## Any special flags which must be used when compiling C++ code to be
## turned into a shared library.  If this variable is left unspecified
## an attempt is made to automatically detect the correct value by
## configure.
## CXXPICFLAGS=

## The command to be used to load shared libraries which contain object
## files from a C++ compiler.  This is usually the C++ compiler/linker,
## but the automatic choice can be overridden by means of this
## variable.
## SHLIB_CXXLD=

## Any special flags which are required when creating shared libraries
## containing object files from a C++ compiler.  This is usually
## automatically detected by configure, and anything set here will be in
## addition unless SHLIB_CXXLD is given.
## SHLIB_CXXLDFLAGS=


## FORTRAN 95 compiler: optional for use in packages.
## Analogous to the F77 and CXX settings.
## FC=
## FCFLAGS=
## FCPICFLAGS=
## SHLIB_FCLD=${FC}
## Unlike SHLIB_CXXLDFLAGS, SHLIB_FCLDFLAGS is never additional
## SHLIB_FCLDFLAGS=${SHLIB_LDFLAGS}

## Tcl/Tk settings.
## Use TCLTK_LIBS for all '-L' and '-l' options needed for linking
## against the Tcl and Tk library.
## TCLTK_LIBS=
## Use TCLTK_CPPFLAGS for all '-I' options needed for finding the tcl.h
## and tk.h headers.
## TCLTK_CPPFLAGS=

## Browser default
## Default setting for the R_BROWSER env variable
## If unset configure searches in turn for (currently)
## firefox mozilla galeon kfmclient opera gnome-moz-remote open
## and uses the full path.
## R_BROWSER=

## BLAS and LAPACK settings
## Use BLAS_LIBS for all '-L' and '-l' options needed for linking
## against an external BLAS implementation.
## BLAS_LIBS=
## Use LAPACK_LIBS for all '-L' and '-l' options needed for linking
## against an external LAPACK implementation.
## Note that (see R-admin) that our main intention is to allow a
## LAPACK-containing BLAS to be used, so this is rarely needed, and
## it is not used if the BLAS already contains LAPACK.
## LAPACK_LIBS=

## Make name.
## Set this if you want to use a make by another name.
## For example, if your GNU make is called 'gmake', use 'MAKE=gmake'.
## MAKE=
MAKE=gnumake

## Tar name
## Set this to prefer a tar which has the capability to automagically
## read compressed archives.  The default is to choose 'gtar' (normally
## GNU tar) then 'tar', but other possibilities include 'bsdtar' from
## the libarchive project.
## TAR=
TAR=gnutar

In looking through the R documentation I didn't see any reference to "@"
as a function/variable/language element/etc.

Thanks for your help,
Bill


From ripley at stats.ox.ac.uk  Tue Jun  8 20:41:05 2010
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 8 Jun 2010 19:41:05 +0100 (BST)
Subject: [Rd] Question on trying to build R 2.11.1 on Tru64(aka OSF1)
 system
In-Reply-To: <01NO2O3KE43O8WXU3K@cluster.cwu.edu>
References: <01NO2O3KE43O8WXU3K@cluster.cwu.edu>
Message-ID: <alpine.LFD.2.00.1006081937120.9569@gannet.stats.ox.ac.uk>

On Tue, 8 Jun 2010, Bill.Glessner at cwu.EDU wrote:

>
> Hello,
>
> I am trying to build the R-2.11.1 software for university faculty to use in
> research projects on a DEC/Compaq/HP AlphaServer model GS160 16CPU/64GB memory
> running Tru64Unix aka OSF1 version 5.1B-5.
> Is it known whether it is possible to build the R-2.11.1 software on the
> platform I am using?

It is not known: it is years since we have a report on that system.

You seem to have a problem with Rcmd, that is R_HOME/bin/Rcmd. 
Perhaps you could send it to us to have a look at?

> In my attempts to build the R-2.11.1 software, I first used the native C
> and Fortran 77/90/95 components and GNU make version 3.81:
>
> # cc -V
> Compaq C V6.5-011 on HP Tru64 UNIX V5.1B (Rev. 2650)
> Compiler Driver V6.5-003 (sys) cc Driver
> # f77 -version
> HP Fortran V5.6-104654
> HP Fortran Compiler V5.6-104654-48F7C
> # f90 -version
> HP Fortran V5.6-104654
> HP Fortran Compiler V5.6-104654-48F7C
> # f95 -version
> HP Fortran V5.6-104654
> HP Fortran Compiler V5.6-104654-48F7C
>
> The build was configured with the command:
>
> ./configure "ac_cv_prog_cc_c99=" --prefix=/usr/local/R --disable-nls \
> --with-readline --with-libpng --with-jpeglib \
> --with-system-zlib --with-system-bzlib --with-system-pcre \
> --with-system-xz --with-recommended-packages
>
> The configure executed successfully.
> The build attempt exited with an error:
>
> gnumake[1]: Entering directory `/usrX/JunqueYard/R-2.11.1/src/library/Recommende
> d'
> gnumake[2]: Entering directory `/usrX/JunqueYard/R-2.11.1/src/library/Recommende
> d'
> begin installing recommended package MASS
> /usrX/JunqueYard/R-2.11.1/bin/Rcmd: @: not found
> gnumake[2]: *** [MASS.ts] Error 1
> gnumake[2]: Leaving directory `/usrX/JunqueYard/R-2.11.1/src/library/Recommended
> '
> gnumake[1]: *** [recommended-packages] Error 2
> gnumake[1]: Leaving directory `/usrX/JunqueYard/R-2.11.1/src/library/Recommended
> '
> gnumake: *** [stamp-recommended] Error 2
>
> With the configure command:
>
> ./configure "ac_cv_prog_cc_c99=" --prefix=/usr/local/R --disable-nls \
> --with-readline --with-libpng --with-jpeglib \
> --with-system-zlib --with-system-bzlib --with-system-pcre \
> --with-system-xz --with-recommended-packages=no
>
> the build completes successfully, but the 'gnumake check' fails with the
> same error
>
> "/usrX/JunqueYard/R-2.11.1/bin/Rcmd: @: not found"
>
> The second attempt was made using gcc/gfortran:
>
> # gcc --version
> gcc (GCC) 4.0.2 (TWW)
> Copyright (C) 2005 Free Software Foundation, Inc.
> This is free software; see the source for copying conditions.  There is NO
> warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
>
> # gfortran --version
> GNU Fortran 95 (GCC 4.0.2 (TWW))
> Copyright (C) 2005 Free Software Foundation, Inc.
>
> GNU Fortran comes with NO WARRANTY, to the extent permitted by law.
> You may redistribute copies of GNU Fortran
> under the terms of the GNU General Public License.
> For more information about these matters, see the file named COPYING
>
> The build was configured with the command:
>
> ./configure --prefix=/usr/local/R --disable-nls \
> --with-readline --with-libpng --with-jpeglib \
> --with-system-zlib --with-system-bzlib --with-system-pcre \
> --with-system-xz --with-recommended-packages
>
> The configure executed successfully.
> The build attempt exited with the same error as attempt 1.
> Running ./configure with "--with-recommended-packages=no" again allows the
> build to complete successfully, but with the same error
>
> "/usrX/JunqueYard/R-2.11.1/bin/Rcmd: @: not found"
>
> as before when trying 'gnumake check'.
> Although the 'gnumake check' didn't, I did a 'gnumake install'. The R
> environment seems to work; however, anything involving packages fails
> with the "/usrX/JunqueYard/R-2.11.1/bin/Rcmd: @: not found".
>
> Can anyone suggest what I am doing incorrectly in configuring/building R?
>
> The config.site file follows:
> #! /bin/sh
>
> ### This file is part of R.
> ###
> ### R is free software; you can redistribute it and/or modify it under
> ### the terms of the GNU General Public License as published by the Free
> ### Software Foundation; either version 2 of the License, or (at your
> ### option) any later version.
> ###
> ### R is distributed in the hope that it will be useful, but WITHOUT ANY
> ### WARRANTY; without even the implied warranty of MERCHANTABILITY or
> ### FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public
> ### License for more details.
> ###
> ### You should have received a copy of the GNU General Public License
> ### along with R; if not, a copy is available at
> ### http://www.r-project.org/Licenses/
>
> ## By means of this file you can (also) provide default values for the
> ## configuration process.  To set variables, uncomment the VAR=DEFAULT
> ## lines and set DEFAULT according to your needs.
> ## See etc/Renviron.in for further variables you may wish to set.
>
> ## The command used to spool PostScript files to the printer.
> ## If unspecified, the system will look for either 'lpr' or 'lp'.
> ## R_PRINTCMD=lpr
> R_PRINTCMD=lpr
>
> ## The paper size for the local (PostScript) printer.
> ## It must either be left blank or set to one of 'a4' or 'letter'.
> ## If left blank the system will use 'a4'.
> ## R_PAPERSIZE=a4
> R_PAPERSIZE=letter
>
> ## Set the default behavior of R when ending a session
> ## Set this to one of '--save' or '--no-save' depending whether you
> ## want automatic saving of '.RData' or not.
> ## Note that this applies to interactive and batch use,
> ## but NOT to the utility R CMD BATCH
> ## (which defaults to --save irrespective of this setting)
> ## R_BATCHSAVE=
>
> ## The command which runs the C compiler.
> ## If unspecified, a search is made for gcc and cc (in that order).
> ## To override this choice, specify the name of the command which runs
> ## the compiler here, for example 'c89'.
> ## It is also convenient to set the architecture here, e.g. 'gcc -m32'.
> ## NB, as from R 2.5.0 configure will append flags for C99 compliance,
> ## e.g. CC=gcc -std=gnu99
> ## To avoid this, set contradictory flags (such as -ansi) as part of CFLAGS.
> ## CC=
>
> ## Debugging and optimization options for the C compiler.
> ## Use this to specify CFLAGS for the version of the C compiler
> ## specified above.
> ## If unspecified, defaults to '-g -O2' for gcc,
> ## and '-g' in all other cases except icc (for which see R-admin.html).
> ## CFLAGS=
>
> ## Defines for C compilation.
> ## Use this to specify defines to be used in the compilation of R,
> ## e.g. -DUSE_TYPE_CHECKING_STRICT
> ## DEFS=
>
> ## The following additional CFLAGS to be used only in the main
> ## compilation and only in building shared libraries respectively.
> ## For example, on some systems one needs 'MAIN_CFLAGS=-pg' when
> ## profiling.
> ## MAIN_CFLAGS=
> ## SHLIB_CFLAGS=
>
> ## Header file search directory ('-IDIR') and any other miscellaneous
> ## options (such as defines) for the C preprocessor and compiler.
> ## If unset defaults to '-I/usr/local/include', with '-I/sw/include'
> ## prepended on systems using Fink with root '/sw'.
> ## CPPFLAGS=
>
> ## The command which runs the FORTRAN 77 compiler.
> ## If this is not specified, a search is made for
> ## f95 fort xlf95 ifort ifc efc pgf95 lf95 gfortran ftn g95
> ## f90 xlf90 pgf90 pghpf epcf90
> ## g77 f77 xlf frt pgf77 cf77 fort77 fl32 af77
> ## On HPUX fort77 is the POSIX compliant FORTRAN compiler, and replaces
> ## f77 in the search list.
> ## If CC is gcc, first preference is given to the matching FORTRAN
> ## compiler (g77 or gfortran).
> ## If none of these is found, R cannot be compiled.
> ## F77=
> F77=gfortran
>
> ## Options for the FORTRAN 77 compiler.
> ## Use this to specify FFLAGS for the version of the compiler specified
> ## above.  If unspecified, defaults to '-g -O2' for g77/gfortran,
> ## otherwise '-g' if this is accepted, otherwise ''.
> ## FFLAGS=
> FFLAGS="-g -O2"
>
> ## Options for safe compilation under the FORTRAN 77 compiler.
> ## Use this to specify FFLAGS for the version of the compiler specified
> ## above, using as accurate a result as possible, e.g. no optimization
> ## or using -ffloat-store.
> ## SAFE_FFLAGS=
> SAFE_FFLAGS="-g"
>
> ## The following additional FFLAGS to be used only in the main
> ## compilation and only in building shared libraries respectively.
> ## For example, on some systems one needs 'MAIN_FFLAGS=-pg' when
> ## profiling.
> ## MAIN_FFLAGS=
> ## SHLIB_FFLAGS=
>
> ## The command to be used to load the main R binary.
> ## This is usually the FORTRAN 77 or C compiler, but the automatic
> ## choice can be overriden by means of this variable.
> ## MAIN_LD=
>
> ## The flags which are necessary for loading main program which will
> ## load DLLs at runtime.  HP-UX and Linux-elf are examples of platforms
> ## which use this.  These platforms are already taken care of by
> ## configure, and anything set here will be in addition unless MAIN_LD
> ## is given.
> ## For example, one can set flags for profiling here.
> ## MAIN_LDFLAGS=
>
> ## Any special flags which must be used when compiling C code to be
> ## turned into a shared library.  This is typically something like
> ## '-fpic' or '-fPIC'.  If this variable is left unspecified an attempt
> ## is made to automatically detect the correct value by configure.
> ## CPICFLAGS=
>
> ## The following variable can be used to provide any PIC flags for the
> ## FORTRAN 77 compiler.  If this variable is left
> ## unspecified an attempt is made to automatically detect the correct
> ## value by configure.
> ## FPICFLAGS=
>
> ## The command to be used to create shared objects which contain object
> ## files from a C or FORTRAN 77 compiler only.  This is usually the C
> ## compiler or 'ld', but the automatic choice can be overridden by means
> ## of this variable.
> ## SHLIB_LD=
>
> ## Any special flags which are required by the linker when creating
> ## shared objects containing object files from a C or FORTRAN 77
> ## compiler only.  This is usually automatically detected by configure,
> ## and anything set here will be in addition unless SHLIB_LD is given.
> ## SHLIB_LDFLAGS=
>
> ## ditto for a dynamic library: DYLIB_LDFLAGS defaults to SHLIB_LDFLAGS
> ## DYLIB_LD=
> ## DYLIB_LDFLAGS=
>
> ## The appropriate 'lib' dir, normally 'lib', but 'lib64' on Linux on
> ## x86_64, mips64, ppc64, sparc64, s390x but not ia64.
> ## LIBnn=
>
> ## Stripping ('-s'), path ('-L'), and any other miscellaneous options
> ## for the linker.
> ## '-L' options set here will be prepended to LD_LIBRARY_PATH (or its
> ## system equivalent) at run time.
> ## If unset defaults to '-L/usr/local/lib', with '-L/sw/lib' prepended
> ## on systems using Fink with root '/sw'.
> ## On some Linux 64-bit systems its default is -L/usr/local/lib64.
> ## If LIBnn is set it defaults to -L/usr/local/$LIBnn.
> ## LDFLAGS=
>
> ## The command which runs the C++ compiler.  It not specified, configure
> ## uses the values of the environment variables 'CXX' or 'CCC' if set,
> ## and then looks under the names 'c++', 'g++', 'gcc', 'CC', 'cxx', and
> ## 'cc++' (in that order).
> ## CXX=
> CXX=g++
>
> ## Options for the C++ compiler.
> ## CXXFLAGS=
>
> ## Any special flags which must be used when compiling C++ code to be
> ## turned into a shared library.  If this variable is left unspecified
> ## an attempt is made to automatically detect the correct value by
> ## configure.
> ## CXXPICFLAGS=
>
> ## The command to be used to load shared libraries which contain object
> ## files from a C++ compiler.  This is usually the C++ compiler/linker,
> ## but the automatic choice can be overridden by means of this
> ## variable.
> ## SHLIB_CXXLD=
>
> ## Any special flags which are required when creating shared libraries
> ## containing object files from a C++ compiler.  This is usually
> ## automatically detected by configure, and anything set here will be in
> ## addition unless SHLIB_CXXLD is given.
> ## SHLIB_CXXLDFLAGS=
>
>
> ## FORTRAN 95 compiler: optional for use in packages.
> ## Analogous to the F77 and CXX settings.
> ## FC=
> ## FCFLAGS=
> ## FCPICFLAGS=
> ## SHLIB_FCLD=${FC}
> ## Unlike SHLIB_CXXLDFLAGS, SHLIB_FCLDFLAGS is never additional
> ## SHLIB_FCLDFLAGS=${SHLIB_LDFLAGS}
>
> ## Tcl/Tk settings.
> ## Use TCLTK_LIBS for all '-L' and '-l' options needed for linking
> ## against the Tcl and Tk library.
> ## TCLTK_LIBS=
> ## Use TCLTK_CPPFLAGS for all '-I' options needed for finding the tcl.h
> ## and tk.h headers.
> ## TCLTK_CPPFLAGS=
>
> ## Browser default
> ## Default setting for the R_BROWSER env variable
> ## If unset configure searches in turn for (currently)
> ## firefox mozilla galeon kfmclient opera gnome-moz-remote open
> ## and uses the full path.
> ## R_BROWSER=
>
> ## BLAS and LAPACK settings
> ## Use BLAS_LIBS for all '-L' and '-l' options needed for linking
> ## against an external BLAS implementation.
> ## BLAS_LIBS=
> ## Use LAPACK_LIBS for all '-L' and '-l' options needed for linking
> ## against an external LAPACK implementation.
> ## Note that (see R-admin) that our main intention is to allow a
> ## LAPACK-containing BLAS to be used, so this is rarely needed, and
> ## it is not used if the BLAS already contains LAPACK.
> ## LAPACK_LIBS=
>
> ## Make name.
> ## Set this if you want to use a make by another name.
> ## For example, if your GNU make is called 'gmake', use 'MAKE=gmake'.
> ## MAKE=
> MAKE=gnumake
>
> ## Tar name
> ## Set this to prefer a tar which has the capability to automagically
> ## read compressed archives.  The default is to choose 'gtar' (normally
> ## GNU tar) then 'tar', but other possibilities include 'bsdtar' from
> ## the libarchive project.
> ## TAR=
> TAR=gnutar
>
> In looking through the R documentation I didn't see any reference to "@"
> as a function/variable/language element/etc.
>
> Thanks for your help,
> Bill
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From Bill.Glessner at cwu.EDU  Tue Jun  8 22:20:29 2010
From: Bill.Glessner at cwu.EDU (Bill.Glessner at cwu.EDU)
Date: Tue, 08 Jun 2010 13:20:29 -0700 (PDT)
Subject: [Rd] Question on trying to build R 2.11.1 on Tru64(aka OSF1)
	system
Message-ID: <01NO2TESWBHE8WXU3K@cluster.cwu.edu>


Here is the Rcmd from the ./bin subdirectory of the build tree
/usrX/JunqueYard/R-2.11.1:

#!/bin/ksh
#
# ${R_HOME}/bin/Rcmd

## Shell script wrapper for all R CMD commands.
## For internal use only.

R_CMD="${R_HOME}/bin/Rcmd"
export R_CMD

R_VERSION=2.11.1
export R_VERSION

R_OSTYPE="unix"
export R_OSTYPE

## Add 'share/perl' to the perl library path.
if test -n "${PERL5LIB}"; then
  PERL5LIB="${R_SHARE_DIR}/perl:${PERL5LIB}"
  export PERL5LIB
else
  PERLLIB="${R_SHARE_DIR}/perl:${PERLLIB}"
  export PERLLIB
fi

## Append 'share/texmf' to TeX's input search path.
if test -z "$TEXINPUTS}"; then
  TEXINPUTS=".:${R_SHARE_DIR}/texmf:"
else
  TEXINPUTS=".:${TEXINPUTS}:${R_SHARE_DIR}/texmf:"
fi
export TEXINPUTS

. "${R_HOME}/etc${R_ARCH}/Renviron"
export `sed 's/^ *#.*//; s/^\(.*\)=.*/\1/' "${R_HOME}/etc${R_ARCH}/Renviron"`

extra=
case "${1}" in
  perl)
    cmd="${PERL}" ;;
  awk)
    cmd="${AWK}"  ;;
## this was a separate command prior to 2.10.0
  Rd2txt)
    cmd="${R_HOME}/bin/Rdconv"
    extra="-t txt"
    ;;
  Rd2pdf)
    cmd="${R_HOME}/bin/Rd2dvi"
    extra="--pdf"
    ;;
  *)
    if test -x "${R_HOME}/bin/${1}"; then
      cmd="${R_HOME}/bin/${1}"
    else
      cmd="${1}"
    fi
    ;;
esac
shift

exec "${cmd}" ${extra} "${@}"

### Local Variables: ***
### mode: sh ***
### sh-indentation: 2 ***
### End: ***

Bill

>Return-path: <ripley at stats.ox.ac.uk>
>Date: Tue, 08 Jun 2010 19:41:05 +0100 (BST)
>From: Prof Brian Ripley <ripley at stats.ox.ac.uk>
>Subject: Re: [Rd] Question on trying to build R 2.11.1 on Tru64(aka OSF1) system
>To: Bill.Glessner at cwu.edu
>Cc: r-devel at r-project.org
>
>On Tue, 8 Jun 2010, Bill.Glessner at cwu.EDU wrote:
>
>>
>> Hello,
>>
>> I am trying to build the R-2.11.1 software for university faculty to use in
>> research projects on a DEC/Compaq/HP AlphaServer model GS160 16CPU/64GB memory
>> running Tru64Unix aka OSF1 version 5.1B-5.
>> Is it known whether it is possible to build the R-2.11.1 software on the
>> platform I am using?
>
>It is not known: it is years since we have a report on that system.
>
>You seem to have a problem with Rcmd, that is R_HOME/bin/Rcmd. 
>Perhaps you could send it to us to have a look at?
>
>> ...snip...
>> ______________________________________________
>> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
>-- 
>Brian D. Ripley,                  ripley at stats.ox.ac.uk
>Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
>University of Oxford,             Tel:  +44 1865 272861 (self)
>1 South Parks Road,                     +44 1865 272866 (PA)
>Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From wdunlap at tibco.com  Tue Jun  8 22:56:15 2010
From: wdunlap at tibco.com (William Dunlap)
Date: Tue, 8 Jun 2010 13:56:15 -0700
Subject: [Rd] Question on trying to build R 2.11.1 on Tru64(aka
	OSF1)system
In-Reply-To: <01NO2TESWBHE8WXU3K@cluster.cwu.edu>
References: <01NO2TESWBHE8WXU3K@cluster.cwu.edu>
Message-ID: <77EB52C6DD32BA4D87471DCD70C8D70003083D83@NA-PA-VBE03.na.tibco.com>

Isn't the bash syntax
   "${@}"
equivalent to just
   "$@"
and older versions of sh may not understand
the former version.  If so, you might have
similar problems with
   "${1}"
instead of
   "$1" 

Bill Dunlap
Spotfire, TIBCO Software
wdunlap tibco.com  

> -----Original Message-----
> From: r-devel-bounces at r-project.org 
> [mailto:r-devel-bounces at r-project.org] On Behalf Of 
> Bill.Glessner at cwu.edu
> Sent: Tuesday, June 08, 2010 1:20 PM
> To: r-devel at r-project.org
> Subject: Re: [Rd] Question on trying to build R 2.11.1 on 
> Tru64(aka OSF1)system
> 
> 
> Here is the Rcmd from the ./bin subdirectory of the build tree
> /usrX/JunqueYard/R-2.11.1:
> 
> #!/bin/ksh
> #
> # ${R_HOME}/bin/Rcmd
> 
> ## Shell script wrapper for all R CMD commands.
> ## For internal use only.
> 
> R_CMD="${R_HOME}/bin/Rcmd"
> export R_CMD
> 
> R_VERSION=2.11.1
> export R_VERSION
> 
> R_OSTYPE="unix"
> export R_OSTYPE
> 
> ## Add 'share/perl' to the perl library path.
> if test -n "${PERL5LIB}"; then
>   PERL5LIB="${R_SHARE_DIR}/perl:${PERL5LIB}"
>   export PERL5LIB
> else
>   PERLLIB="${R_SHARE_DIR}/perl:${PERLLIB}"
>   export PERLLIB
> fi
> 
> ## Append 'share/texmf' to TeX's input search path.
> if test -z "$TEXINPUTS}"; then
>   TEXINPUTS=".:${R_SHARE_DIR}/texmf:"
> else
>   TEXINPUTS=".:${TEXINPUTS}:${R_SHARE_DIR}/texmf:"
> fi
> export TEXINPUTS
> 
> . "${R_HOME}/etc${R_ARCH}/Renviron"
> export `sed 's/^ *#.*//; s/^\(.*\)=.*/\1/' 
> "${R_HOME}/etc${R_ARCH}/Renviron"`
> 
> extra=
> case "${1}" in
>   perl)
>     cmd="${PERL}" ;;
>   awk)
>     cmd="${AWK}"  ;;
> ## this was a separate command prior to 2.10.0
>   Rd2txt)
>     cmd="${R_HOME}/bin/Rdconv"
>     extra="-t txt"
>     ;;
>   Rd2pdf)
>     cmd="${R_HOME}/bin/Rd2dvi"
>     extra="--pdf"
>     ;;
>   *)
>     if test -x "${R_HOME}/bin/${1}"; then
>       cmd="${R_HOME}/bin/${1}"
>     else
>       cmd="${1}"
>     fi
>     ;;
> esac
> shift
> 
> exec "${cmd}" ${extra} "${@}"
> 
> ### Local Variables: ***
> ### mode: sh ***
> ### sh-indentation: 2 ***
> ### End: ***
> 
> Bill
> 
> >Return-path: <ripley at stats.ox.ac.uk>
> >Date: Tue, 08 Jun 2010 19:41:05 +0100 (BST)
> >From: Prof Brian Ripley <ripley at stats.ox.ac.uk>
> >Subject: Re: [Rd] Question on trying to build R 2.11.1 on 
> Tru64(aka OSF1) system
> >To: Bill.Glessner at cwu.edu
> >Cc: r-devel at r-project.org
> >
> >On Tue, 8 Jun 2010, Bill.Glessner at cwu.EDU wrote:
> >
> >>
> >> Hello,
> >>
> >> I am trying to build the R-2.11.1 software for university 
> faculty to use in
> >> research projects on a DEC/Compaq/HP AlphaServer model 
> GS160 16CPU/64GB memory
> >> running Tru64Unix aka OSF1 version 5.1B-5.
> >> Is it known whether it is possible to build the R-2.11.1 
> software on the
> >> platform I am using?
> >
> >It is not known: it is years since we have a report on that system.
> >
> >You seem to have a problem with Rcmd, that is R_HOME/bin/Rcmd. 
> >Perhaps you could send it to us to have a look at?
> >
> >> ...snip...
> >> ______________________________________________
> >> R-devel at r-project.org mailing list
> > https://stat.ethz.ch/mailman/listinfo/r-devel
> >>
> >
> >-- 
> >Brian D. Ripley,                  ripley at stats.ox.ac.uk
> >Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> >University of Oxford,             Tel:  +44 1865 272861 (self)
> >1 South Parks Road,                     +44 1865 272866 (PA)
> >Oxford OX1 3TG, UK                Fax:  +44 1865 272595
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 


From ripley at stats.ox.ac.uk  Tue Jun  8 23:02:13 2010
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 8 Jun 2010 22:02:13 +0100 (BST)
Subject: [Rd] Question on trying to build R 2.11.1 on Tru64(aka OSF1)
 system
In-Reply-To: <01NO2TESWBHE8WXU3K@cluster.cwu.edu>
References: <01NO2TESWBHE8WXU3K@cluster.cwu.edu>
Message-ID: <alpine.LFD.2.00.1006082147050.13672@gannet.stats.ox.ac.uk>

Ah, so configure has chosen /bin/ksh as the shell, and that does not 
like this sh syntax on your system.  Try setting R_SHELL=/bin/sh when 
configuring (or the path to bash, if you have that).

Alternatively, use ${1+@} in Rcmd.in (we have that as a workaround in 
R.sh.in).

On Tue, 8 Jun 2010, Bill.Glessner at cwu.edu wrote:

>
> Here is the Rcmd from the ./bin subdirectory of the build tree
> /usrX/JunqueYard/R-2.11.1:
>
> #!/bin/ksh
> #
> # ${R_HOME}/bin/Rcmd
>
> ## Shell script wrapper for all R CMD commands.
> ## For internal use only.
>
> R_CMD="${R_HOME}/bin/Rcmd"
> export R_CMD
>
> R_VERSION=2.11.1
> export R_VERSION
>
> R_OSTYPE="unix"
> export R_OSTYPE
>
> ## Add 'share/perl' to the perl library path.
> if test -n "${PERL5LIB}"; then
>  PERL5LIB="${R_SHARE_DIR}/perl:${PERL5LIB}"
>  export PERL5LIB
> else
>  PERLLIB="${R_SHARE_DIR}/perl:${PERLLIB}"
>  export PERLLIB
> fi
>
> ## Append 'share/texmf' to TeX's input search path.
> if test -z "$TEXINPUTS}"; then
>  TEXINPUTS=".:${R_SHARE_DIR}/texmf:"
> else
>  TEXINPUTS=".:${TEXINPUTS}:${R_SHARE_DIR}/texmf:"
> fi
> export TEXINPUTS
>
> . "${R_HOME}/etc${R_ARCH}/Renviron"
> export `sed 's/^ *#.*//; s/^\(.*\)=.*/\1/' "${R_HOME}/etc${R_ARCH}/Renviron"`
>
> extra=
> case "${1}" in
>  perl)
>    cmd="${PERL}" ;;
>  awk)
>    cmd="${AWK}"  ;;
> ## this was a separate command prior to 2.10.0
>  Rd2txt)
>    cmd="${R_HOME}/bin/Rdconv"
>    extra="-t txt"
>    ;;
>  Rd2pdf)
>    cmd="${R_HOME}/bin/Rd2dvi"
>    extra="--pdf"
>    ;;
>  *)
>    if test -x "${R_HOME}/bin/${1}"; then
>      cmd="${R_HOME}/bin/${1}"
>    else
>      cmd="${1}"
>    fi
>    ;;
> esac
> shift
>
> exec "${cmd}" ${extra} "${@}"
>
> ### Local Variables: ***
> ### mode: sh ***
> ### sh-indentation: 2 ***
> ### End: ***
>
> Bill
>
>> Return-path: <ripley at stats.ox.ac.uk>
>> Date: Tue, 08 Jun 2010 19:41:05 +0100 (BST)
>> From: Prof Brian Ripley <ripley at stats.ox.ac.uk>
>> Subject: Re: [Rd] Question on trying to build R 2.11.1 on Tru64(aka OSF1) system
>> To: Bill.Glessner at cwu.edu
>> Cc: r-devel at r-project.org
>>
>> On Tue, 8 Jun 2010, Bill.Glessner at cwu.EDU wrote:
>>
>>>
>>> Hello,
>>>
>>> I am trying to build the R-2.11.1 software for university faculty to use in
>>> research projects on a DEC/Compaq/HP AlphaServer model GS160 16CPU/64GB memory
>>> running Tru64Unix aka OSF1 version 5.1B-5.
>>> Is it known whether it is possible to build the R-2.11.1 software on the
>>> platform I am using?
>>
>> It is not known: it is years since we have a report on that system.
>>
>> You seem to have a problem with Rcmd, that is R_HOME/bin/Rcmd.
>> Perhaps you could send it to us to have a look at?
>>
>>> ...snip...
>>> ______________________________________________
>>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>
>>
>> --
>> Brian D. Ripley,                  ripley at stats.ox.ac.uk
>> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
>> University of Oxford,             Tel:  +44 1865 272861 (self)
>> 1 South Parks Road,                     +44 1865 272866 (PA)
>> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From pdalgd at gmail.com  Wed Jun  9 00:30:03 2010
From: pdalgd at gmail.com (Peter Dalgaard)
Date: Wed, 09 Jun 2010 00:30:03 +0200
Subject: [Rd] Question on trying to build R 2.11.1 on Tru64(aka OSF1)
 system
In-Reply-To: <alpine.LFD.2.00.1006082147050.13672@gannet.stats.ox.ac.uk>
References: <01NO2TESWBHE8WXU3K@cluster.cwu.edu>
	<alpine.LFD.2.00.1006082147050.13672@gannet.stats.ox.ac.uk>
Message-ID: <4C0EC46B.6060308@gmail.com>

Prof Brian Ripley wrote:
> Ah, so configure has chosen /bin/ksh as the shell, and that does not 
> like this sh syntax on your system.  Try setting R_SHELL=/bin/sh when 
> configuring (or the path to bash, if you have that).
> 
> Alternatively, use ${1+@} in Rcmd.in (we have that as a workaround in 
> R.sh.in).
> 

We even do it using @OSF_SH_BUG@, which would probably be a good idea to
clone in Rcmd.in. On the other hand, the use of ${@} in Rcmd.in goes
back to at least 2002, which is a bit puzzling. Did OSF really not get
tested since then??

-- 
Peter Dalgaard
Center for Statistics, Copenhagen Business School
Phone: (+45)38153501
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From p.murrell at auckland.ac.nz  Wed Jun  9 03:41:53 2010
From: p.murrell at auckland.ac.nz (Paul Murrell)
Date: Wed, 09 Jun 2010 13:41:53 +1200
Subject: [Rd] [R] textbox in lattice
In-Reply-To: <AANLkTilBqkTawxTbLly5NmBptBlug0UwM4AV7LjYDc6D@mail.gmail.com>
References: <4C05454A.3040508@smartmediacorp.com>	<AANLkTik5SP9nnMIhcUltpvjD9J_2blBgdDDMr247ixSP@mail.gmail.com>	<4C0556DC.2000304@smartmediacorp.com>	<AANLkTinMan1_OSEouH9wvR97tyeJuvdp3yf-UH9jHnom@mail.gmail.com>	<AANLkTinaicABAVUxytuocd5nZHHKYKlkE4g5cHOG5wyY@mail.gmail.com>	<AANLkTin_J-kVmF8Wta9cPSh9bmtJflRoyWCnA-iz3bha@mail.gmail.com>	<4C0720C8.1070102@auckland.ac.nz>	<AANLkTile2Lx-PRzCtMSZMIlW_KUIR2g74dSmAeyV-Tsj@mail.gmail.com>
	<AANLkTilBqkTawxTbLly5NmBptBlug0UwM4AV7LjYDc6D@mail.gmail.com>
Message-ID: <4C0EF161.9080700@auckland.ac.nz>

Hi

On 6/6/2010 11:20 PM, baptiste auguie wrote:
> Hi,
>
> I've just added width/heightDetails methods following Paul's
> suggestion. I kept a duplicate of all on-the-fly grob size
> calculations; it is necessary to ensure that the table cells adjust to
> the content which can be subsequently edited (e.g changing the
> colnames to plotmath expressions). Drawing the full iris dataset (150
> x 5) takes 12 seconds when it was 8 seconds before. It is still
> reasonable; I don't think anyone would want to use it for huge tables
> anyway.
>
> Out of curiosity, could drawDetails and height/widthDetails be altered
> to share some information (thereby avoiding such duplication of
> calculations at drawing time), or do they have to be completely
> independent in the implementation?

In theory, you could cache information from drawing (such as where on 
the device you drew), but this would have to be updated if the device is 
resized (or output is copied between devices) and there is no general 
infrastructure to support that at the moment.

PLUS width/height calculations can be performed independently of 
drawing.  I might want to position some output based on where a grob 
WOULD be drawn, but without actually drawing the grob.  So it would not 
be safe, for example, for widthDetails() to assume that drawDetails() 
had previously been called.

These are not insurmountable problems;  they are just examples to show 
that the implementation would be non-trivial.

Paul

> Best,
>
> baptiste
>
> On 3 June 2010 07:58, baptiste auguie<baptiste.auguie at googlemail.com>  wrote:
>> Hi,
>>
>> On 3 June 2010 05:26, Paul Murrell<p.murrell at auckland.ac.nz>  wrote:
>>
>>> Or the same drawing calculations have to be repeated within
>>> width/heightDetails - those methods should get run within the same graphical
>>> context as the drawDetails method.
>>>
>>
>> Yes, the idea crossed my mind, but I did not find it very appealing
>> (already the function is slower than it could/should be). Something to
>> consider though, in a future version.
>>
>> Thanks,
>>
>> baptiste
>>
>>
>>
>>
>>
>>> Paul
>>>
>>>> Best,
>>>>
>>>> baptiste
>>>>
>>>> ______________________________________________
>>>> R-help at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-help
>>>> PLEASE do read the posting guide
>>>> http://www.R-project.org/posting-guide.html
>>>> and provide commented, minimal, self-contained, reproducible code.
>>>
>>> --
>>> Dr Paul Murrell
>>> Department of Statistics
>>> The University of Auckland
>>> Private Bag 92019
>>> Auckland
>>> New Zealand
>>> 64 9 3737599 x85392
>>> paul at stat.auckland.ac.nz
>>> http://www.stat.auckland.ac.nz/~paul/
>>>
>>

-- 
Dr Paul Murrell
Department of Statistics
The University of Auckland
Private Bag 92019
Auckland
New Zealand
64 9 3737599 x85392
paul at stat.auckland.ac.nz
http://www.stat.auckland.ac.nz/~paul/


From ripley at stats.ox.ac.uk  Wed Jun  9 07:44:18 2010
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 9 Jun 2010 06:44:18 +0100 (BST)
Subject: [Rd] Question on trying to build R 2.11.1 on Tru64(aka OSF1)
 system
In-Reply-To: <4C0EC46B.6060308@gmail.com>
References: <01NO2TESWBHE8WXU3K@cluster.cwu.edu>
	<alpine.LFD.2.00.1006082147050.13672@gannet.stats.ox.ac.uk>
	<4C0EC46B.6060308@gmail.com>
Message-ID: <alpine.LFD.2.00.1006090632420.23138@gannet.stats.ox.ac.uk>

On Wed, 9 Jun 2010, Peter Dalgaard wrote:

> Prof Brian Ripley wrote:
>> Ah, so configure has chosen /bin/ksh as the shell, and that does not
>> like this sh syntax on your system.  Try setting R_SHELL=/bin/sh when
>> configuring (or the path to bash, if you have that).
>>
>> Alternatively, use ${1+@} in Rcmd.in (we have that as a workaround in
>> R.sh.in).
>
> We even do it using @OSF_SH_BUG@, which would probably be a good idea to
> clone in Rcmd.in.

Already done in R-devel.  But the argument is whether we should 
complicate R (and risk breaking currently working setups) or expect 
people with broken tools to replace them.  Certainly for AIX (where sh 
is zsh and this workaround does not work) it is necessary to set 
R_SHELL to bash.

> On the other hand, the use of ${@} in Rcmd.in goes
> back to at least 2002, which is a bit puzzling. Did OSF really not get
> tested since then??

No: PR#9365 (which I fixed via @OSF_SH_BUG@) was in 2006 -- I think 
that was the last report and long after any other.

> -- 
> Peter Dalgaard
> Center for Statistics, Copenhagen Business School
> Phone: (+45)38153501
> Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From jhallman at frb.gov  Wed Jun  9 13:02:10 2010
From: jhallman at frb.gov (Jeffrey J. Hallman)
Date: Wed, 09 Jun 2010 07:02:10 -0400
Subject: [Rd] Extract/format/show for S4 objects
References: <u1oljapmxai.fsf@lx-chrateresearch01.citadelgroup.com>
Message-ID: <xmrljao4ggd.fsf@mralx1.rsma.frb.gov>

The tis package has the ti (TimeIndex) class that does what you want,
and I modestly think it's nicer than the zoo stuff.

As for S4 classes, there's a good reason many of us don't use them:
they're too inflexible and hard to program with.  I wouldn't go there
unless I really had to.


Johann Hibschman <jhibschman at gmail.com> writes:

> Hi all,
>
> I'm trying to make an integer-backed quarter (as in fraction of year)
> class, but I can't quite it to work.  I want integer-backed so I don't
> have to worry about floating-point effects when doing math, and so that
> I can use it as in data.table.
>
> First of all, is there a good reference for this anywhere?  All of the
> S4 tutorials that I've found have been too high-level, and I can't find
> any examples of implementing extract.  In S3, I can use [.Date as my
> example, but I can't find the equivalent for S4.
>
> Second, is this misguided?
>
> Now for the details.  Given this start:
>
>   library(zoo) # borrowing yearqtr for output.
>   setClass("iqtr", contains="integer")
>   ## Create an iqtr object from a numeric date (e.g. 2000.5).
>   iqtr <- function (x) {
>     iq <- as.integer(floor((as.numeric(x) - 2000) * 4 + 0.0001))
>     new("iqtr", iq)
>   }
>   setMethod("show", "iqtr4",
>             function (object) {
>               cat(format(yearqtr(as.numeric(x) * 0.25 + 2000)))
>             })
>
>
> I have two issues:
>
>   1. Vectors of iqtrs do not display properly.
>      They print, but they don't look like vectors.
>        > iq <- iqtr(seq(2000, 2002, 0.25))
>        > iq
>        2000 Q2 2000 Q2 2000 Q3 2000 Q4 2001 Q2 2002 Q1> 
>
>   2. Subsets do not stay in the class.
>        > iq[1:2]
>        > [1] 0 1
>
> Clearly, I'm just not understanding what's going on.  Is there a guide
> for how to make printing, format, subsetting, etc., all work for S4
> classes?
>
> Thanks,
> Johann
>

-- 
Jeff


From jhibschman at gmail.com  Wed Jun  9 16:09:19 2010
From: jhibschman at gmail.com (Johann Hibschman)
Date: Wed, 09 Jun 2010 09:09:19 -0500
Subject: [Rd] Extract/format/show for S4 objects
References: <u1oljapmxai.fsf@lx-chrateresearch01.citadelgroup.com>
	<AANLkTinv0WrHgXHiFfHUBO1s9EQvbdojApkTZAPYvo9j@mail.gmail.com>
Message-ID: <u1od3w0mh68.fsf@lx-chrateresearch01.citadelgroup.com>

Gabor Grothendieck <ggrothendieck at gmail.com> writes:

> The yearqtr class already rounds off automatically to avoid floating
> point effects and handles #1 and #2.

The main use for all this was so I could use quarters as index columns
with data.table, which demands integer storage mode.  (This is part of
my ongoing attempt to reinvent q/kdb+ in R.)

I've had some problems with yearmon's conversions in the past, so I'm
(probably unfairly) suspicious of the approach of storing dates as
floats.  To be fair, once I reported the bug, it was fixed almost
immediately; I was very impressed.

> On the other hand if you are just interested in playing around with S4
> for its own sake review the source code of the mondate package as an
> example of an S4 based date package.

Thanks, that's a very useful example.  I don't understand all of what's
going on in there, but I find it easier to understand the documentation
with an example in hand.

Cheers,
Johann


From ggrothendieck at gmail.com  Wed Jun  9 17:59:36 2010
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Wed, 9 Jun 2010 11:59:36 -0400
Subject: [Rd] Extract/format/show for S4 objects
In-Reply-To: <u1od3w0mh68.fsf@lx-chrateresearch01.citadelgroup.com>
References: <u1oljapmxai.fsf@lx-chrateresearch01.citadelgroup.com> 
	<AANLkTinv0WrHgXHiFfHUBO1s9EQvbdojApkTZAPYvo9j@mail.gmail.com> 
	<u1od3w0mh68.fsf@lx-chrateresearch01.citadelgroup.com>
Message-ID: <AANLkTikhrvin3odfe4dljo5d5mnKVEFMjPn5gZ_FOKyv@mail.gmail.com>

Note that zoo's merge can handle that:

>> library(zoo)
> z <- zooreg(1:6, as.yearqtr("2000 Q1"))
> merge(z, zlag = lag(z1, -1))
        z  zlag
2000 Q1  1   NA
2000 Q2  2    1
2000 Q3  3    2
2000 Q4  4    3
2001 Q1  5    4
2001 Q2  6    5
2001 Q3 NA    6



On Wed, Jun 9, 2010 at 10:09 AM, Johann Hibschman <jhibschman at gmail.com> wrote:
> Gabor Grothendieck <ggrothendieck at gmail.com> writes:
>
>> The yearqtr class already rounds off automatically to avoid floating
>> point effects and handles #1 and #2.
>
> The main use for all this was so I could use quarters as index columns
> with data.table, which demands integer storage mode. ?(This is part of
> my ongoing attempt to reinvent q/kdb+ in R.)
>
> I've had some problems with yearmon's conversions in the past, so I'm
> (probably unfairly) suspicious of the approach of storing dates as
> floats. ?To be fair, once I reported the bug, it was fixed almost
> immediately; I was very impressed.
>
>> On the other hand if you are just interested in playing around with S4
>> for its own sake review the source code of the mondate package as an
>> example of an S4 based date package.
>
> Thanks, that's a very useful example. ?I don't understand all of what's
> going on in there, but I find it easier to understand the documentation
> with an example in hand.
>
> Cheers,
> Johann
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From chiefmurphy at gmail.com  Wed Jun  9 18:21:33 2010
From: chiefmurphy at gmail.com (Daniel Murphy)
Date: Wed, 9 Jun 2010 09:21:33 -0700
Subject: [Rd] Extract/format/show for S4 objects (Johann Hibschman)
Message-ID: <AANLkTil41xTPNc2qPH9iV9AvfsSvAxDWwmrpbaMmJ_df@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20100609/b18c570a/attachment.pl>

From thomas.k.roth at googlemail.com  Wed Jun  9 18:33:59 2010
From: thomas.k.roth at googlemail.com (Thomas Roth)
Date: Wed, 9 Jun 2010 18:33:59 +0200
Subject: [Rd] Documenting generic S4 replacement method for package building
Message-ID: <4c0fc27c.0eafcc0a.7ab2.ffffbeeb@mx.google.com>

Dear List Members,

I'm struggling with the documentation of a generic S4 replacement method.

I've created a S4 method "lows" via 

setGeneric("lows", function(object) standardGeneric("lows"))
setGeneric("lows<-", function(object, value) standardGeneric("lows<-"))
setMethod("lows", "myClass", function(object)
{
  listOut = vector(mode = "list")
  for(i in names(factors(object)))
  {
    listOut[i] = low(object at factors[[i]])
  }

  return(listOut)
}
)

setReplaceMethod("lows", "myclass", function(object,value)
{
  for(i in seq(along = object at factors))
  {
    low(object at factors[[i]]) = value[i]
  }

  return(object)
}
)

As far as I understand "2.1.3 Documenting S4 classes and methods (Writing
R-exts)"
http://cran.r-project.org/doc/manuals/R-exts.html#Documenting-S4-classes-and
-methods

 I need to call 

promptMethods(lows)

After that an S4 replacement method is documented in the same way as an S3
one: see the description of \method in Documenting functions.

That's where I get lost. The example gives me

\usage{
\method{print}{ts}(x, calendar, \dots)
}

If I do (see below for the whole file)

\usage{
\method{lows}{myClass}(object)
}


R CMD check myPackage gives me

Undocumented code objects
... lows lows<-

And

Objects in \usage without \alias in documentation object "lows-methods": 
	lows.myClass

which is S3 syntax?


The problem is probably trivial to somebody who has written a documentation
file for an S4 replacement method but I'm stuck and tried many things, none
of them working. Does somebody what needs to be added to the file?

Thank you in advance

Thomas Roth


-------------------------

\name{lows-methods}
\docType{methods}
\alias{lows-methods}
\alias{lows,facDesign-method}
\title{Methods for Function lows in Package `myPackage'}
\description{
Methods for function \code{lows} in Package `myPackage'
}
\section{Methods}{
\describe{

\item{\code{signature(object = "facDesign")}}{
%%  ~~describe this method here~~
}
}}
\keyword{methods}
\keyword{ ~~ other possible keyword(s) ~~ }


From djsamperi at gmail.com  Wed Jun  9 18:47:31 2010
From: djsamperi at gmail.com (Dominick Samperi)
Date: Wed, 9 Jun 2010 12:47:31 -0400
Subject: [Rd] Solaris / CC builds
Message-ID: <AANLkTikt7DKBeWCcRM3-rB3J_v80N9wyl99EEAAJ3pEI@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20100609/31696532/attachment.pl>

From simon.urbanek at r-project.org  Wed Jun  9 19:01:54 2010
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Wed, 9 Jun 2010 13:01:54 -0400
Subject: [Rd] Solaris / CC builds
In-Reply-To: <AANLkTikt7DKBeWCcRM3-rB3J_v80N9wyl99EEAAJ3pEI@mail.gmail.com>
References: <AANLkTikt7DKBeWCcRM3-rB3J_v80N9wyl99EEAAJ3pEI@mail.gmail.com>
Message-ID: <1472F73A-4F32-4EB9-B28D-2335820F7D63@r-project.org>


On Jun 9, 2010, at 12:47 PM, Dominick Samperi wrote:

> Hello,
> 
> I'm trying to figure our why my package (cxxPack) fails to build under Solaris using CC on CRAN, and I wonder if somebody can comment?
> 
> If I try to build R on a Solaris SPARC box that has CC the R configure script uses gcc/g++ instead of CC, yet CC seems to be used for the CRAN builds.
> 
> How does one tall configure to setup for using CC?
> 

See R-admin C.5:
http://r.research.att.com/man/R-admin.html#Solaris

Cheers,
Simon


From wdunlap at tibco.com  Wed Jun  9 20:03:12 2010
From: wdunlap at tibco.com (William Dunlap)
Date: Wed, 9 Jun 2010 11:03:12 -0700
Subject: [Rd] Argument mismatches in S3 generic and method
Message-ID: <77EB52C6DD32BA4D87471DCD70C8D70003083EEB@NA-PA-VBE03.na.tibco.com>

The way R treats the first argument to an S3 method
which uses a different name for the argument than
the generic depends on whether there is a ... in the
argument list.  If there is is no ellipsis then
the call cannot tag the argument with either name
but an untagged first argument works:

  > zNoDots <- function(x) UseMethod("zNoDots")
  > zNoDots.foo <- function(fooObject) { cat("zNoDots.foo: fooObject=")
; dput(fooObject) }
  > foo <- structure(1:4, class="foo")
  > x <- "x in .GlobalEnv"
  > zNoDots(foo)
  zNoDots.foo: fooObject=structure(1:4, class = "foo")
  > zNoDots(x=foo)
  zNoDots.foo: fooObject=Error in .Call("R_isS4Object", object, PACKAGE
= "base") : 
    'object' is missing
  > zNoDots(fooObject=foo)
  Error in zNoDots(fooObject = foo) : unused argument(s) (fooObject =
foo) 

If there is an ellipsis in the function definition
the call can tag the argument by the name given in
the method, but not by the generic's name for the
argument (and an untagged argument works here also):
  > zDots <- function(x,...) UseMethod("zDots")
  > zDots.foo <- function(fooObject,...) { cat("zDots.foo: fooObject=")
; dput(fooObject) }
  > zDots(foo)
  zDots.foo: fooObject=structure(1:4, class = "foo")
  > zDots(x=foo)
  zDots.foo: fooObject=Error in .Call("R_isS4Object", object, PACKAGE =
"base") : 
     'object' is missing
  > zDots(fooObject=foo)
  zDots.foo: fooObject=structure(1:4, class = "foo")

Is there a deep reason for this difference or is it just
an accident of implementation?

The question came up when someone asked me why
  var.test(x=y~group,
data=data.frame(y=1:5,group=letters[c(1,1,1,2,2)]))
failed but leaving off the x= allowed it to work.  var.test's
first argument is called "x" but var.test.formula's is "formula".

Bill Dunlap
Spotfire, TIBCO Software
wdunlap tibco.com 


From Bill.Glessner at cwu.EDU  Wed Jun  9 20:51:59 2010
From: Bill.Glessner at cwu.EDU (Bill.Glessner at cwu.EDU)
Date: Wed, 09 Jun 2010 11:51:59 -0700 (PDT)
Subject: [Rd] Question on trying to build R 2.11.1 on Tru64(aka OSF1)
Message-ID: <01NO44MU9HKY8WXUUA@cluster.cwu.edu>


First I tried 'setenv R_SHELL /usr/local/bin/bash', as bash is the weapon
of choice for the faculty wishing to use R, then ran ./configure as before.
The ./configure output line 

using as R_SHELL for scripts ... /usr/local/bin/bash

would seem to indicate that the R_SHELL environment variable was recognized
and acknowledged. However, I got the same build error:

gnumake[2]: Entering directory `/usrX/JunqueYard/R-2.11.1/src/library/Recommended'
begin installing recommended package MASS
/usrX/JunqueYard/R-2.11.1/bin/Rcmd: @: not found
gnumake[2]: *** [MASS.ts] Error 1
gnumake[2]: Leaving directory `/usrX/JunqueYard/R-2.11.1/src/library/Recommended'

Rcmd for this build:

#!/usr/local/bin/bash
#
# ${R_HOME}/bin/Rcmd

## Shell script wrapper for all R CMD commands.
## For internal use only.

R_CMD="${R_HOME}/bin/Rcmd"
export R_CMD

R_VERSION=2.11.1
export R_VERSION

R_OSTYPE="unix"
export R_OSTYPE

## Add 'share/perl' to the perl library path.
if test -n "${PERL5LIB}"; then
  PERL5LIB="${R_SHARE_DIR}/perl:${PERL5LIB}"
  export PERL5LIB
else
  PERLLIB="${R_SHARE_DIR}/perl:${PERLLIB}"
  export PERLLIB
fi

## Append 'share/texmf' to TeX's input search path.
if test -z "$TEXINPUTS}"; then
  TEXINPUTS=".:${R_SHARE_DIR}/texmf:"
else
  TEXINPUTS=".:${TEXINPUTS}:${R_SHARE_DIR}/texmf:"
fi
export TEXINPUTS

. "${R_HOME}/etc${R_ARCH}/Renviron"
export `sed 's/^ *#.*//; s/^\(.*\)=.*/\1/' "${R_HOME}/etc${R_ARCH}/Renviron"`

extra=
case "${1}" in
  perl)
    cmd="${PERL}" ;;
  awk)
    cmd="${AWK}"  ;;
## this was a separate command prior to 2.10.0
  Rd2txt)
    cmd="${R_HOME}/bin/Rdconv"
    extra="-t txt"
    ;;
  Rd2pdf)
    cmd="${R_HOME}/bin/Rd2dvi"
    extra="--pdf"
    ;;
  *)
    if test -x "${R_HOME}/bin/${1}"; then
      cmd="${R_HOME}/bin/${1}"
    else
      cmd="${1}"
    fi
    ;;
esac
shift

exec "${cmd}" ${extra} "${@}"

### Local Variables: ***
### mode: sh ***
### sh-indentation: 2 ***
### End: ***


I tried removing the R_SHELL environment variable and editing the 
./src/scripts/Rcmd.in, changing the {1}'s to {1+@}'s. ./configure
produced the following line showing that R_SHELL was back to ksh:

using as R_SHELL for scripts ... /bin/ksh

But that also produced the same build error

gnumake[2]: Entering directory `/usrX/JunqueYard/R-2.11.1/src/library/Recommended'
begin installing recommended package MASS
/usrX/JunqueYard/R-2.11.1/bin/Rcmd: @: not found
gnumake[2]: *** [MASS.ts] Error 1
gnumake[2]: Leaving directory `/usrX/JunqueYard/R-2.11.1/src/library/Recommended'
Rcmd for this build:

Rcmd for this build:

#!/bin/ksh
#
# ${R_HOME}/bin/Rcmd

## Shell script wrapper for all R CMD commands.
## For internal use only.

R_CMD="${R_HOME}/bin/Rcmd"
export R_CMD

R_VERSION=2.11.1
export R_VERSION

R_OSTYPE="unix"
export R_OSTYPE

## Add 'share/perl' to the perl library path.
if test -n "${PERL5LIB}"; then
  PERL5LIB="${R_SHARE_DIR}/perl:${PERL5LIB}"
  export PERL5LIB
else
  PERLLIB="${R_SHARE_DIR}/perl:${PERLLIB}"
  export PERLLIB
fi

## Append 'share/texmf' to TeX's input search path.
if test -z "$TEXINPUTS}"; then
  TEXINPUTS=".:${R_SHARE_DIR}/texmf:"
else
  TEXINPUTS=".:${TEXINPUTS}:${R_SHARE_DIR}/texmf:"
fi
export TEXINPUTS

. "${R_HOME}/etc${R_ARCH}/Renviron"
export `sed 's/^ *#.*//; s/^\(.*\)=.*/\1/' "${R_HOME}/etc${R_ARCH}/Renviron"`

extra=
case "${1+@}" in
  perl)
    cmd="${PERL}" ;;
  awk)
    cmd="${AWK}"  ;;
## this was a separate command prior to 2.10.0
  Rd2txt)
    cmd="${R_HOME}/bin/Rdconv"
    extra="-t txt"
    ;;
  Rd2pdf)
    cmd="${R_HOME}/bin/Rd2dvi"
    extra="--pdf"
    ;;
  *)
    if test -x "${R_HOME}/bin/${1+@}"; then
      cmd="${R_HOME}/bin/${1+@}"
    else
      cmd="${1+@}"
    fi
    ;;
esac
shift

exec "${cmd}" ${extra} "${@}"

### Local Variables: ***
### mode: sh ***
### sh-indentation: 2 ***
### End: ***

I also tried 'setenv R_SHELL /bin/sh' with the same results.

Bill

>Return-path: <ripley at stats.ox.ac.uk>
>Date: Tue, 08 Jun 2010 22:02:13 +0100 (BST)
>From: Prof Brian Ripley <ripley at stats.ox.ac.uk>
>Subject: Re: [Rd] Question on trying to build R 2.11.1 on Tru64(aka OSF1) system
>To: Bill.Glessner at cwu.edu
>Cc: r-devel at r-project.org
>
>Ah, so configure has chosen /bin/ksh as the shell, and that does not 
>like this sh syntax on your system.  Try setting R_SHELL=/bin/sh when 
>configuring (or the path to bash, if you have that).
>
>Alternatively, use ${1+@} in Rcmd.in (we have that as a workaround in 
>R.sh.in).
>
>On Tue, 8 Jun 2010, Bill.Glessner at cwu.edu wrote:
>
>>
>> Here is the Rcmd from the ./bin subdirectory of the build tree
>> /usrX/JunqueYard/R-2.11.1:
>>
>> ...snip...
>>>> R-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>>>
>>>
>>> --
>>> Brian D. Ripley,                  ripley at stats.ox.ac.uk
>>> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
>>> University of Oxford,             Tel:  +44 1865 272861 (self)
>>> 1 South Parks Road,                     +44 1865 272866 (PA)
>>> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
>-- 
>Brian D. Ripley,                  ripley at stats.ox.ac.uk
>Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
>University of Oxford,             Tel:  +44 1865 272861 (self)
>1 South Parks Road,                     +44 1865 272866 (PA)
>Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From hpages at fhcrc.org  Wed Jun  9 22:46:06 2010
From: hpages at fhcrc.org (=?ISO-8859-1?Q?Herv=E9_Pag=E8s?=)
Date: Wed, 09 Jun 2010 13:46:06 -0700
Subject: [Rd] Broken link in HTML version of "R Installation and
 Administration" manual
Message-ID: <4C0FFD8E.8060604@fhcrc.org>

Hi,

I just updated my R-devel today using the tarball from 2010-06-07
(r52225). The link to "3.1.10 64-bit Windows builds" in the table
of content at the top of <R_HOME>/doc/manual/R-admin.html is broken.
The table of content has:

   <a href="#64_002dbit-Windows-builds">3.1.10 64-bit Windows builds</a>

but latter in the file, the referred section is tagged with:

   <a name="g_t64_002dbit-Windows-builds"></a>

Thanks,
H.

-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M2-B876
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fhcrc.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From pdalgd at gmail.com  Wed Jun  9 23:10:12 2010
From: pdalgd at gmail.com (Peter Dalgaard)
Date: Wed, 09 Jun 2010 23:10:12 +0200
Subject: [Rd] Question on trying to build R 2.11.1 on Tru64(aka OSF1)
In-Reply-To: <01NO44MU9HKY8WXUUA@cluster.cwu.edu>
References: <01NO44MU9HKY8WXUUA@cluster.cwu.edu>
Message-ID: <4C100334.3030707@gmail.com>

Bill.Glessner at cwu.edu wrote:
> First I tried 'setenv R_SHELL /usr/local/bin/bash', as bash is the weapon
> of choice for the faculty wishing to use R, then ran ./configure as before.
> The ./configure output line 
> 
> using as R_SHELL for scripts ... /usr/local/bin/bash
> 
> would seem to indicate that the R_SHELL environment variable was recognized
> and acknowledged. However, I got the same build error:

Two ideas (longshots...)

(a) You're building in the source directory. Try not doing that an start
with clean sources.

(b) insert "set -v" at the top of Rcmd so that you see the script as it
is executed.

-- 
Peter Dalgaard
Center for Statistics, Copenhagen Business School
Phone: (+45)38153501
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From ripley at stats.ox.ac.uk  Thu Jun 10 13:54:03 2010
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 10 Jun 2010 12:54:03 +0100 (BST)
Subject: [Rd] 00LOCK and nfs
In-Reply-To: <AANLkTikE8kSXLI_dS3hGBFUlVk8A0f0gNULzZ9ZVitZk@mail.gmail.com>
References: <s2le780c0971004260815we5156859v293d5b3a6ffd9890@mail.gmail.com>
	<l2kc0177e5a1004261054k3775628fyb6c1fd154707dd91@mail.gmail.com>
	<y2le780c0971004261205i39f069dt379690211f8f8a7f@mail.gmail.com>
	<4BD6F661.10409@acm.org>
	<AANLkTikhZwblSL_MyLTmqbsD5R61vhDa0l-o9lcw0caT@mail.gmail.com>
	<AANLkTikE8kSXLI_dS3hGBFUlVk8A0f0gNULzZ9ZVitZk@mail.gmail.com>
Message-ID: <alpine.LFD.2.00.1006091222350.18833@gannet.stats.ox.ac.uk>

Note that this patch is incomplete: there are three separate branches 
in install.packages() where R CMD INSTALL is used, and one already 
uses --pkglock.  (So a short-term solution for you is to set Ncpus > 
1.)

However, I think this request has been subsumed by a more general need 
to be able to pass options to INSTALL, and R-devel now has an 
INSTALL_opts argument to install.packages().  So I believe you could 
just use install.packages( ... , INSTALL_opts = "--pkglock") .

On Tue, 1 Jun 2010, Kasper Daniel Hansen wrote:

> Further experimentation using this patch to install.packages shows
> that I sometimes have remaining 00LOCK-pkgname directories after doing
> a massive update on a multi-user system with R installed on NFS.
> However, I have never had install.packages/update.packages stop midway
> because of an unremovable 00LOCK directory.  I therefore consider the
> patch to be big improvement for people like me, having a multi-user R
> installed on NFS.  Private followups to my original email shows that I
> am not the only one with this problem.

But I should point out that others with well-tuned NFS do not have the 
problem -- my sysadmins say that it was common with NFSv3 but they've 
hardly seen it with NFSv4.


> I would very much like the patch (or some variant hereof) to be
> considered for inclusion in R-devel.
>
> Kasper
>
> On Tue, May 18, 2010 at 11:59 AM, Kasper Daniel Hansen
> <kasperdanielhansen at gmail.com> wrote:
>> This is a follow-up to an old thread with kind of solution to the
>> 00LOCK problem on NFS.
>>
>> I have made a patch to install.packages to accept a new argument
>> ?locktype = c("lock", "no-lock", "pkglock")
>> which is passed to R CMD INSTALL. ?This addition might have
>> independent interest aside from the NFS problem, as it exposes
>> functionality from R CMD INSTALL to install.packages and the very
>> convenient update.packages. ?Patches are at
>> ?http://www.biostat.jhsph.edu/~khansen/packages2.R-patch
>> ?http://www.biostat.jhsph.edu/~khansen/install.packages.Rd-patch
>> (patches to files in the utils package) and both
>> ?R-devel (R version 2.12.0 Under development (unstable) (2010-05-17 r52025))
>> and
>> ?R-2.11 (R version 2.11.0 Patched (2010-05-17 r52025))
>> passed make check-all with these two patches applied. ?I thought about
>> adding a note describing my findings below to the details section, but
>> decided against it.
>>
>> Regarding the 00LOCK problem. ?In my testing, using the patches above
>> and setting locktype = "pkglock", makes it possible to deal with the
>> NFS problem. ?Specifically, I have not been able to make
>> update.packages() fail midway, due to a un-removable 00LOCK file
>> (which is not too surprising, as I now have a per-package lock).
>>
>> However, sometimes (but far less frequently than before), a
>> 00LOCK-pkgname directory remains after update/install.packages.
>> Sometimes this 00LOCK-pkgname directory does not contain any .nfs*
>> files (!?) and sometimes it does. For this reason, I still precede any
>> install/update.packages with a check for the existence of a
>> 00LOCK-pkgname directory and an attempt to remove it.
>>
>> The difference between using locktype = "pkglock" and not is
>> specifically that without, it was possible for update.packages to fail
>> midway even though there were no 00LOCK* files at the start of the
>> update process.
>>
>> Originally I hypothesized that the presence of the .nfs* files in the
>> 00LOCK directory had to do with synchronization issues between the
>> file server and the compute node. ?In order to approach this I tried
>> to insert a
>> ?system("sleep 10")
>> at the beginning of
>> ?do_cleanup
>> in
>> ?tools/R/install.R
>> but that did not work.
>>
>> Since the pkglock approach described above seems to solve this issue
>> for me, I have not pursued the synchronization issue further.
>>
>> Kasper
>>
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From gustaf.rydevik at gmail.com  Thu Jun 10 15:39:05 2010
From: gustaf.rydevik at gmail.com (Gustaf Rydevik)
Date: Thu, 10 Jun 2010 15:39:05 +0200
Subject: [Rd] Request: difftime method for cut()
In-Reply-To: <AANLkTinJIbhWTP3GYLzr8pMrDJ_ckUzK9USigmFy2mDm@mail.gmail.com>
References: <AANLkTinJIbhWTP3GYLzr8pMrDJ_ckUzK9USigmFy2mDm@mail.gmail.com>
Message-ID: <AANLkTilevxQ4bCQ1GPZK0HbIMOVXTVV2ewteDi4hK7Rm@mail.gmail.com>

Hi all,

The recent change in 2.11 that made as.numeric() return false on
difftime-objects broke some of my code that calculated age classes of
individuals using cut(). While this was no big thing to fix for me, it
might be wise
to provide a cut.difftime method to ?stop other old code from breaking.
I'm guessing something as simple as

cut.difftime<-function(x,...){
x<-as.numeric(x)
cut(x,...)
}

would suffice.

best regards,
Gustaf

--
Gustaf Rydevik, M.Sci.
tel: +46(0)703 051 451
address:Essingetorget 40,112 66 Stockholm, SE
skype:gustaf_rydevik


From Bill.Glessner at cwu.EDU  Thu Jun 10 19:52:42 2010
From: Bill.Glessner at cwu.EDU (Bill.Glessner at cwu.EDU)
Date: Thu, 10 Jun 2010 10:52:42 -0700 (PDT)
Subject: [Rd] Question on trying to build R 2.11.1 on Tru64(aka OSF1)
Message-ID: <01NO5GTY83R68WXVJ4@cluster.cwu.edu>


I created a separate build directory, started with a fresh source directory,
changed directory into the build directory, ran configure from the source
directory. 
Then put 'set -v' at the top of <build-directory>/src/scripts/Rcmd before
issuing the gnumake.
The build had the same problem with the packages and provided the following
output at that stage:

gnumake[1]: Leaving directory `/usrX/JunqueYard/R-2.11.1_build/src/library'
gnumake[1]: Entering directory `/usrX/JunqueYard/R-2.11.1_build/src/library/Reco
mmended'
gnumake[2]: Entering directory `/usrX/JunqueYard/R-2.11.1_build/src/library/Reco
mmended'
begin installing recommended package MASS

# ${R_HOME}/bin/Rcmd

## Shell script wrapper for all R CMD commands.
## For internal use only.

R_CMD="${R_HOME}/bin/Rcmd"
export R_CMD

R_VERSION=2.11.1
export R_VERSION

R_OSTYPE="unix"
export R_OSTYPE

## Add 'share/perl' to the perl library path.
if test -n "${PERL5LIB}"; then
  PERL5LIB="${R_SHARE_DIR}/perl:${PERL5LIB}"
  export PERL5LIB
else
  PERLLIB="${R_SHARE_DIR}/perl:${PERLLIB}"
  export PERLLIB
fi

## Append 'share/texmf' to TeX's input search path.
if test -z "$TEXINPUTS}"; then
  TEXINPUTS=".:${R_SHARE_DIR}/texmf:"
else
  TEXINPUTS=".:${TEXINPUTS}:${R_SHARE_DIR}/texmf:"
fi
export TEXINPUTS

. "${R_HOME}/etc${R_ARCH}/Renviron"
export `sed 's/^ *#.*//; s/^\(.*\)=.*/\1/' "${R_HOME}/etc${R_ARCH}/Renviron"`

extra=
case "${1}" in
  perl)
    cmd="${PERL}" ;;
  awk)
    cmd="${AWK}"  ;;
## this was a separate command prior to 2.10.0
  Rd2txt)
    cmd="${R_HOME}/bin/Rdconv"
    extra="-t txt"
    ;;
  Rd2pdf)
    cmd="${R_HOME}/bin/Rd2dvi"
    extra="--pdf"
    ;;
  *)
    if test -x "${R_HOME}/bin/${1}"; then
      cmd="${R_HOME}/bin/${1}"
    else
      cmd="${1}"
    fi
    ;;
esac
shift

exec "${cmd}" ${extra} "${@}"
/usr/local/JunqueYard/R-2.11.1_build/bin/Rcmd: @: not found
gnumake[2]: *** [MASS.ts] Error 1
gnumake[2]: Leaving directory `/usrX/JunqueYard/R-2.11.1_build/src/library/Recom
mended'
gnumake[1]: *** [recommended-packages] Error 2
gnumake[1]: Leaving directory `/usrX/JunqueYard/R-2.11.1_build/src/library/Recom
mended'
gnumake: *** [stamp-recommended] Error 2

I think that I am following the instructions in the "R Installation and 
Administration" manual, but results would suggest otherwise. I greatly
appreciate any suggestions.

Regards,
Bill

>Return-path: <pdalgd at gmail.com>
>Date: Wed, 09 Jun 2010 23:10:12 +0200
>From: Peter Dalgaard <pdalgd at gmail.com>
>Subject: Re: [Rd] Question on trying to build R 2.11.1 on Tru64(aka OSF1)
>To: Bill.Glessner at cwu.edu
>Cc: r-devel at r-project.org
>
>Bill.Glessner at cwu.edu wrote:
>> First I tried 'setenv R_SHELL /usr/local/bin/bash', as bash is the weapon
>> of choice for the faculty wishing to use R, then ran ./configure as before.
>> The ./configure output line 
>> 
>> using as R_SHELL for scripts ... /usr/local/bin/bash
>> 
>> would seem to indicate that the R_SHELL environment variable was recognized
>> and acknowledged. However, I got the same build error:
>
>Two ideas (longshots...)
>
>(a) You're building in the source directory. Try not doing that an start
>with clean sources.
>
>(b) insert "set -v" at the top of Rcmd so that you see the script as it
>is executed.
>
>-- 
>Peter Dalgaard
>Center for Statistics, Copenhagen Business School
>Phone: (+45)38153501
>Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From macrakis at alum.mit.edu  Thu Jun 10 21:45:22 2010
From: macrakis at alum.mit.edu (Stavros Macrakis)
Date: Thu, 10 Jun 2010 15:45:22 -0400
Subject: [Rd] OWL ontologies in R?
Message-ID: <AANLkTilSTkPkJt2rjOzfrXwjM9Q9ssvsd70TE85mg9VY@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20100610/7486b0a5/attachment.pl>

From hpages at fhcrc.org  Thu Jun 10 23:16:04 2010
From: hpages at fhcrc.org (=?ISO-8859-1?Q?Herv=E9_Pag=E8s?=)
Date: Thu, 10 Jun 2010 14:16:04 -0700
Subject: [Rd] R-based version of R CMD build broken on Windows
Message-ID: <4C115614.9080803@fhcrc.org>

Hi,

The R-based version of R CMD build doesn't work for me on Windows:

   E:\biocbld\bbs-2.7-bioc>R\bin\R CMD build meat\Biobase
   * checking for file 'meat\Biobase/DESCRIPTION' ... OK
   * preparing 'Biobase':
   * checking DESCRIPTION meta-information ... OK
   * cleaning src
   * installing the package to re-build vignettes
   Warning in shell(sprintf("%s > %s 2>&1", command, outfile), shell = 
"cmd.exe") :
     '"E:\biocbld\bbs-2.7-bioc\R/bin/i386/Rcmd.exe" INSTALL -l 
"C:\DOCUME~1\BIOCBU~1\LOCALS~1\tmpdir\RtmpfEAMUM\Rinst4488262f" 
"E:/biocbld/bbs-2.7-bioc/meat/Biobase" > 
C:\DOCUME~1\BIOCBU~1\LOCALS~1\tmpdir\RtmpfEAMUM\xshell2bc3cf 2>&1' 
execution failed with error code 1
         -----------------------------------
   The filename, directory name, or volume label syntax is incorrect.
         -----------------------------------
   ERROR: Installation failed
   Removing installation dir

The old Perl-based version (R\bin\R CMD obuild) does work with no problem.

My R version is:

   E:\biocbld\bbs-2.7-bioc>R\bin\R --version
   R version 2.12.0 Under development (unstable) (2010-06-07 r52225)
   Copyright (C) 2010 The R Foundation for Statistical Computing
   ISBN 3-900051-07-0

   R is free software and comes with ABSOLUTELY NO WARRANTY.
   You are welcome to redistribute it under the terms of the
   GNU General Public License version 2.
   For more information about these matters see
   http://www.gnu.org/licenses/.

I'm on Windows Server 2003 R2 (32-bit). I have the same problem on
Windows Server 2008 R2 Enterprise (64-bit) (using the same revision
of R 2.12.0). I don't have any problem on Linux or Mac OS X.

FYI, this problem is causing most of the Bioconductor packages to
be red on Windows on our daily build/check report:

   http://bioconductor.org/checkResults/2.7/bioc-LATEST/

OTOH I don't see anything like that on the check summaries for
CRAN packages:

   http://cran.r-project.org/web/checks/check_summary.html

Maybe because CRAN only runs R CMD check which is still Perl-based?

Thanks,
H.

-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M2-B876
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fhcrc.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From ligges at statistik.tu-dortmund.de  Fri Jun 11 10:48:41 2010
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Fri, 11 Jun 2010 10:48:41 +0200
Subject: [Rd] R-based version of R CMD build broken on Windows
In-Reply-To: <4C115614.9080803@fhcrc.org>
References: <4C115614.9080803@fhcrc.org>
Message-ID: <4C11F869.1070806@statistik.tu-dortmund.de>



On 10.06.2010 23:16, Herv? Pag?s wrote:
> Hi,
>
> The R-based version of R CMD build doesn't work for me on Windows:
>
> E:\biocbld\bbs-2.7-bioc>R\bin\R CMD build meat\Biobase
> * checking for file 'meat\Biobase/DESCRIPTION' ... OK
> * preparing 'Biobase':
> * checking DESCRIPTION meta-information ... OK
> * cleaning src
> * installing the package to re-build vignettes
> Warning in shell(sprintf("%s > %s 2>&1", command, outfile), shell =
> "cmd.exe") :
> '"E:\biocbld\bbs-2.7-bioc\R/bin/i386/Rcmd.exe" INSTALL -l
> "C:\DOCUME~1\BIOCBU~1\LOCALS~1\tmpdir\RtmpfEAMUM\Rinst4488262f"
> "E:/biocbld/bbs-2.7-bioc/meat/Biobase" >
> C:\DOCUME~1\BIOCBU~1\LOCALS~1\tmpdir\RtmpfEAMUM\xshell2bc3cf 2>&1'
> execution failed with error code 1
> -----------------------------------
> The filename, directory name, or volume label syntax is incorrect.
> -----------------------------------
> ERROR: Installation failed
> Removing installation dir
>
> The old Perl-based version (R\bin\R CMD obuild) does work with no problem.
>
> My R version is:
>
> E:\biocbld\bbs-2.7-bioc>R\bin\R --version
> R version 2.12.0 Under development (unstable) (2010-06-07 r52225)
> Copyright (C) 2010 The R Foundation for Statistical Computing
> ISBN 3-900051-07-0
>
> R is free software and comes with ABSOLUTELY NO WARRANTY.
> You are welcome to redistribute it under the terms of the
> GNU General Public License version 2.
> For more information about these matters see
> http://www.gnu.org/licenses/.
>
> I'm on Windows Server 2003 R2 (32-bit). I have the same problem on
> Windows Server 2008 R2 Enterprise (64-bit) (using the same revision
> of R 2.12.0). I don't have any problem on Linux or Mac OS X.
>
> FYI, this problem is causing most of the Bioconductor packages to
> be red on Windows on our daily build/check report:
>
> http://bioconductor.org/checkResults/2.7/bioc-LATEST/
>
> OTOH I don't see anything like that on the check summaries for
> CRAN packages:
>
> http://cran.r-project.org/web/checks/check_summary.html
>
> Maybe because CRAN only runs R CMD check which is still Perl-based?


No, but because the Windows checks on that page are not yet available 
for R-devel.

Best,
Uwe Ligges


> Thanks,
> H.
>


From Thorn.Thaler at rdls.nestle.com  Fri Jun 11 12:06:46 2010
From: Thorn.Thaler at rdls.nestle.com (Thaler, Thorn, LAUSANNE,
	Applied Mathematics)
Date: Fri, 11 Jun 2010 12:06:46 +0200
Subject: [Rd] CHM help does not find help docs in package stats
Message-ID: <F54EF8F1B477CF448729593FE421F646360469@HQVEVE0032.nestle.com>

Hi all,

currently I'm working on an R package bundling some frequently used
functions. When I load my package and type

?one_of_my_functions

I get the particular help file. If I try to get help on another
function, which is part of package stats (prcomp say), I get "This
program cannot display the webpage". A help on ?mean does, however, work
as it opens a new window showing the help on mean.

There is another peculiarity, if it happens that I requested a help file
for a function in the package stats before I used the help on one of my
functions, everything works out fine.

Does anybody know how I can get rid of this annoying behavior? It has to
have something to do with my particular package, since everything works
as expected with another package of mine. 

I override one of the functions of stats (biplot.default), which is,
however, not exported and resides within my namespace. Could that be the
reason?

Any help highly appreciated. Thanks + BR,

Thorn


From carey.vj at gmail.com  Fri Jun 11 16:09:19 2010
From: carey.vj at gmail.com (Vincenzo Carey)
Date: Fri, 11 Jun 2010 10:09:19 -0400
Subject: [Rd] OWL ontologies in R?
In-Reply-To: <AANLkTilSTkPkJt2rjOzfrXwjM9Q9ssvsd70TE85mg9VY@mail.gmail.com>
References: <AANLkTilSTkPkJt2rjOzfrXwjM9Q9ssvsd70TE85mg9VY@mail.gmail.com>
Message-ID: <AANLkTilfu83dsjO0G2gwpZLOIv-qdXDyLo11PLRuEJ5l@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20100611/f7cc5994/attachment.pl>

From hpages at fhcrc.org  Fri Jun 11 19:20:21 2010
From: hpages at fhcrc.org (=?ISO-8859-1?Q?Herv=E9_Pag=E8s?=)
Date: Fri, 11 Jun 2010 10:20:21 -0700
Subject: [Rd] R-based version of R CMD build broken on Windows
In-Reply-To: <4C11F869.1070806@statistik.tu-dortmund.de>
References: <4C115614.9080803@fhcrc.org>
	<4C11F869.1070806@statistik.tu-dortmund.de>
Message-ID: <4C127055.6040108@fhcrc.org>



Uwe Ligges wrote:
> 
> 
> On 10.06.2010 23:16, Herv? Pag?s wrote:
>> Hi,
>>
>> The R-based version of R CMD build doesn't work for me on Windows:
>>
>> E:\biocbld\bbs-2.7-bioc>R\bin\R CMD build meat\Biobase
>> * checking for file 'meat\Biobase/DESCRIPTION' ... OK
>> * preparing 'Biobase':
>> * checking DESCRIPTION meta-information ... OK
>> * cleaning src
>> * installing the package to re-build vignettes
>> Warning in shell(sprintf("%s > %s 2>&1", command, outfile), shell =
>> "cmd.exe") :
>> '"E:\biocbld\bbs-2.7-bioc\R/bin/i386/Rcmd.exe" INSTALL -l
>> "C:\DOCUME~1\BIOCBU~1\LOCALS~1\tmpdir\RtmpfEAMUM\Rinst4488262f"
>> "E:/biocbld/bbs-2.7-bioc/meat/Biobase" >
>> C:\DOCUME~1\BIOCBU~1\LOCALS~1\tmpdir\RtmpfEAMUM\xshell2bc3cf 2>&1'
>> execution failed with error code 1
>> -----------------------------------
>> The filename, directory name, or volume label syntax is incorrect.
>> -----------------------------------
>> ERROR: Installation failed
>> Removing installation dir
>>
>> The old Perl-based version (R\bin\R CMD obuild) does work with no 
>> problem.
>>
>> My R version is:
>>
>> E:\biocbld\bbs-2.7-bioc>R\bin\R --version
>> R version 2.12.0 Under development (unstable) (2010-06-07 r52225)
>> Copyright (C) 2010 The R Foundation for Statistical Computing
>> ISBN 3-900051-07-0
>>
>> R is free software and comes with ABSOLUTELY NO WARRANTY.
>> You are welcome to redistribute it under the terms of the
>> GNU General Public License version 2.
>> For more information about these matters see
>> http://www.gnu.org/licenses/.
>>
>> I'm on Windows Server 2003 R2 (32-bit). I have the same problem on
>> Windows Server 2008 R2 Enterprise (64-bit) (using the same revision
>> of R 2.12.0). I don't have any problem on Linux or Mac OS X.
>>
>> FYI, this problem is causing most of the Bioconductor packages to
>> be red on Windows on our daily build/check report:
>>
>> http://bioconductor.org/checkResults/2.7/bioc-LATEST/
>>
>> OTOH I don't see anything like that on the check summaries for
>> CRAN packages:
>>
>> http://cran.r-project.org/web/checks/check_summary.html
>>
>> Maybe because CRAN only runs R CMD check which is still Perl-based?
> 
> 
> No, but because the Windows checks on that page are not yet available 
> for R-devel.

Ah right (oops).  Thx,

H.

> 
> Best,
> Uwe Ligges
> 
> 
>> Thanks,
>> H.
>>

-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M2-B876
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fhcrc.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From lawrence.michael at gene.com  Fri Jun 11 21:51:02 2010
From: lawrence.michael at gene.com (Michael Lawrence)
Date: Fri, 11 Jun 2010 12:51:02 -0700
Subject: [Rd] support for radix order() over entire range of integers
Message-ID: <AANLkTikOwah7qZJX5dw8IjpAEIXrSaYaEuiQ5YyYS8S7@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20100611/760d8ec8/attachment.pl>

From ripley at stats.ox.ac.uk  Sat Jun 12 09:01:47 2010
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Sat, 12 Jun 2010 08:01:47 +0100 (BST)
Subject: [Rd] support for radix order() over entire range of integers
In-Reply-To: <AANLkTikOwah7qZJX5dw8IjpAEIXrSaYaEuiQ5YyYS8S7@mail.gmail.com>
References: <AANLkTikOwah7qZJX5dw8IjpAEIXrSaYaEuiQ5YyYS8S7@mail.gmail.com>
Message-ID: <alpine.LFD.2.00.1006120741150.6580@gannet.stats.ox.ac.uk>

On Fri, 11 Jun 2010, Michael Lawrence wrote:

> Hi,
>
> Is there any good reason not to allow radix sorting via order() over the
> entire range of R (32bit) integers, instead of setting a hard limit at
> 100,000? Many machines have plenty of memory to support this. Seems like it

Really?  That's 16Gb on my understanding of your proposal (2^32-1 
4-byte uints). Not 'many machines' in my experience, but some.  But 
the limit was set in 2003 when that code was written, and it was added 
for speed with factors, where 100,000 was plenty.

> is just a matter of dynamic allocating the bucket array instead of the
> current static allocation.

Hmm, it is currently automatically allocated: it would need to be 
malloc-ed.  Might be worth keeping automatic allocation for smaller 
ranges.

> This would really help with e.g. sorting positions in the genome.
>
> I'm happy to submit a patch if this sounds sensible.

Yes please.

> Thanks,
> Michael
>
> 	[[alternative HTML version deleted]]

Please don't send HTML.

>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ligges at statistik.tu-dortmund.de  Sat Jun 12 18:20:43 2010
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Sat, 12 Jun 2010 18:20:43 +0200
Subject: [Rd] CHM help does not find help docs in package stats
In-Reply-To: <F54EF8F1B477CF448729593FE421F646360469@HQVEVE0032.nestle.com>
References: <F54EF8F1B477CF448729593FE421F646360469@HQVEVE0032.nestle.com>
Message-ID: <4C13B3DB.7010908@statistik.tu-dortmund.de>

Which version of R is this?
CHM help is R < 2.10.0. All versions thereafter do not support compiled 
html help anymore.

Please upgrade your version of R and try one of the currently supported 
help formats.

Best wishes,
Uwe Ligges



On 11.06.2010 12:06, Thaler, Thorn, LAUSANNE, Applied Mathematics wrote:
> Hi all,
>
> currently I'm working on an R package bundling some frequently used
> functions. When I load my package and type
>
> ?one_of_my_functions
>
> I get the particular help file. If I try to get help on another
> function, which is part of package stats (prcomp say), I get "This
> program cannot display the webpage". A help on ?mean does, however, work
> as it opens a new window showing the help on mean.
>
> There is another peculiarity, if it happens that I requested a help file
> for a function in the package stats before I used the help on one of my
> functions, everything works out fine.
>
> Does anybody know how I can get rid of this annoying behavior? It has to
> have something to do with my particular package, since everything works
> as expected with another package of mine.
>
> I override one of the functions of stats (biplot.default), which is,
> however, not exported and resides within my namespace. Could that be the
> reason?
>
> Any help highly appreciated. Thanks + BR,
>
> Thorn
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From bates at stat.wisc.edu  Sun Jun 13 19:00:54 2010
From: bates at stat.wisc.edu (Douglas Bates)
Date: Sun, 13 Jun 2010 12:00:54 -0500
Subject: [Rd] Failure to load the recommended package Matrix (Was: [R] Can
	one get a list of recommended packages?)
Message-ID: <AANLkTimYWiboiAqahS3BUjKRXr2Otcfsf-8uqfKy0c72@mail.gmail.com>

On Sun, Jun 13, 2010 at 8:28 AM, Uwe Ligges
<ligges at statistik.tu-dortmund.de> wrote:
>
>
> On 13.06.2010 01:09, Dr. David Kirkby wrote:
>>
>> On 06/12/10 05:27 PM, Douglas Bates wrote:
>>>
>>> On Sat, Jun 12, 2010 at 8:37 AM, Dr. David Kirkby
>>> <david.kirkby at onetel.net> wrote:
>>>>
>>>> R 2.10.1 is used in the Sage maths project. Several recommended packages
>>>> (Matrix, class, mgcv, nnet, rpart, spatial, and survival) are failing to
>>>> build on Solaris 10 (SPARC).
>>>
>>> Have you checked the dependencies for those packages? Some require GNU
>>> make.
>>
>> We used GNU make.
>>
>>>> We would like to be able to get a list of the recommended packages for R
>>>> 2.10.1, but ideally via a call to R, so it is not necessary to update
>>>> that
>>>> list every time a new version of R is released. We do not want to
>>>> access the
>>>> Internet to get this information.
>>>
>>>> Is there a way in R to list the recommended packages?
>>>
>>> I'm not sure I understand the logic of this. If you are going to
>>> build R then presumably you have the tar.gz file which contains the
>>> sources for the recommended packages in the subdirectory
>>> src/library/Recommended/. Why not get the list from there?
>>
>> The reason is when the version of R gets updated in Sage, then someone
>> will have to check that list again, and more than likely fail to do so,
>> with the result tests will fail since packages do not exist, or worst
>> still we will be unaware they have failed to build properly.
>>
>> Therefore, being able to get them from a command would be useful, but
>> can understand if that is not possible.
>>
>>> $ cd ~/src/R-devel/src/library/Recommended/
>>> $ ls *.tgz
>>> boot.tgz codetools.tgz lattice.tgz mgcv.tgz rpart.tgz
>>> class.tgz foreign.tgz MASS.tgz nlme.tgz spatial.tgz
>>> cluster.tgz KernSmooth.tgz Matrix.tgz nnet.tgz survival.tgz
>>
>> OK, thank you for that list.
>>
>>>> Better still, is there a way to list the recommended packages which
>>>> have not
>>>> been installed, so getting a list of any failures?
>>>
>>> Again, this seems to be a rather convoluted approach. Why not check
>>> why the packages don't install properly?
>>
>> R had built, and the failure of the packages to build was not very
>> obvious, since it did not cause make to exit with a non-zero exit code.
>> Nobody had noticed until very recently that there was a problem.
>>
>> Therefore I proposed to make a test of the packages that should have
>> been installed, and ensure they actually all had.
>>
>> You need to be aware that R is just one part of Sage. Building the whole
>> of Sage takes a long time (>24 hours on some computers) so needless to
>> say, people will not view every line of error messages. The fact that
>> 'make' succeeded left us a false sense of security, when later it was
>> realsed there were problems when R run its self-tests.
>>
>> Dave
>
>
> But if you really want to sense some security, you should really run
> make check-all
> after the installation, particularly since you are on a platform that is not
> really mainstream any more.
>
> Uwe Ligges

And if you look at the other R-help message posted by David Kirby you
will find a link to the trouble ticket report in Sage as
http://trac.sagemath.org/sage_trac/ticket/9201
which, fortunately, contains a link to the compilation log file
http://sage.math.washington.edu/home/mpatel/trac/8306/r-2.10.1.p2.log

The log file correctly points out the problem, which is that the
compiled shared object for the Matrix package can't be loaded because
it contains references to objects in another library from the compiler
and that library is not on the LD_LIBRARY_PATH during the dyn.load
from within R.  So the original poster needs to look at how the
DLLpath is being configured.

Exactly how this ended up as a request to somehow determine a list of
recommended packages on the fly from within R is a wonderful example
of misguided speculation but has nothing whatsoever to do with the
problem.  Even the idea that there are a host of other recommended
packages that failed to compile because they depend on the Matrix
package is pure speculation and, of course, hopelessly wrong.  The
installation of the Matrix package failed because the check on whether
the package could be loaded failed.  The compilation of the
recommended packages stopped at that point.  The other packages
weren't compiled because they came after the Matrix package in the
compilation sequence.

Problems in compilation of R or its recommended packages should be
reported on the R-devel mailing list and I have moved this thread from
R-help to R-devel.

Admittedly it was the original poster of the Sage trouble ticket who
decided that the issue to focus on was missing recommended packages.
That's a red herring.  The issue is the visibility of the some of the
libraries from the gcc toolchain when R is loading a package.


From jmc at r-project.org  Mon Jun 14 00:58:16 2010
From: jmc at r-project.org (John Chambers)
Date: Sun, 13 Jun 2010 15:58:16 -0700
Subject: [Rd] S4 classes and S3 generic functions
Message-ID: <4C156288.2030207@r-project.org>

A general goal for the next version of R is to make S4 and S3 play 
better together.

As mentioned in a previous thread, one limitation has been that S3 
generic functions, specifically the UseMethod() call, did not make use 
of S4 inheritance when dispatching on general S4 objects.

This has been fixed in a version committed today (updated to rev 52267). 
  The code change is not large, but it has some general implications. 
Mainly, in applying S3 generic functions to objects from S4 classes, the 
default recommendation is to define an S3 method for the class, when 
possible, and then set that definition to be the S4 method as well.

The section "Methods for S3 Generic Functions" of the ?Methods 
documentation in the (new) version has details and points to examples. 
The text of that section is appended below.

John

======================
Methods for S3 Generic Functions:

      S4 methods may be wanted for functions that also have S3 methods,
      corresponding to classes for the first formal argument of an S3
      generic function-either a regular R function in which there is a
      call to the S3 dispatch function, 'UseMethod', or one of a fixed
      set of primitive functions, which are not true functions but go
      directly to C code. In either case S3 method dispatch looks at the
      class of the first argument or the class of either argument in a
      call to one of the primitive binary operators. S3 methods are
      ordinary functions with the same arguments as the generic function
      (for primitives the formal arguments are not actually part of the
      object, but are simulated when the object is printed or viewed by
      'args()'). The "signature" of an S3 method is identified by the
      name to which the method is assigned, composed of the name of the
      generic function, followed by '"."', followed by the name of the
      class. For details, see S3Methods.

      To implement a method for one of these functions corresponding to
      S4 classes, there are two possibilities: either an S4 method or an
      S3 method with the S4 class name. The S3 method is only possible
      if the intended signature has the first argument and nothing else.
      In this case, the recommended approach is to define the S3 method
      and also supply the identical function as the definition of the S4
      method. If the S3 generic function was 'f3(x, ...)' and the S4
      class for the new method was '"myClass"':

      f3.myClass <- function(x, ...) { ..... }
      setMethod("f3", "myClass", f3.myClass)

      The reasons for defining both S3 and S4 methods are as follows:

        1. An S4 method alone will not be seen if the S3 generic
           function is called directly.  However, primitive functions
           and operators are exceptions: The internal C code will look
           for S4 methods if and only if the object is an S4 object.  In
           the examples, the method for '`[`' for class '"myFrame"' will
           always be called for objects of this class.

           For the same reason, an S4 method defined for an S3 class
           will not be called from internal code for a non-S4 object.
           (See the example for function 'Math' and class '"data.frame"'
           in the examples.)

        2. An S3 method alone will not be called if there is _any_
           eligible non-default S4 method. (See the example for function
           'f3' and class '"classA"' in the examples.)

      Details of the selection computations are given below.

      When an S4 method is defined for an existing function that is not
      an S4 generic function (whether or not the existing function is an
      S3 generic), an S4 generic function will be created corresponding
      to the existing function and the package in which it is found
      (more precisely, according to the implicit generic function either
      specified or inferred from the ordinary function; see
      'implicitGeneric'). A message is printed after the initial call to
      'setMethod'; this is not an error, just a reminder that you have
      created the generic. Creating the generic explicitly by the call

      'setGeneric("f3")'

      avoids the message, but has the same effect. The existing function
      becomes the default method for the S4 generic function. Primitive
      functions work the same way, but the S4 generic function is not
      explicitly created (as discussed below).

      S4 and S3 method selection are designed to follow compatible rules
      of inheritance, as far as possible. S3 classes can be used for any
      S4 method selection, provided that the S3 classes have been
      registered by a call to 'setOldClass', with that call specifying
      the correct S3 inheritance pattern. S4 classes can be used for any
      S3 method selection; when an S4 object is detected, S3 method
      selection uses the contents of 'extends(class(x))' as the
      equivalent of the S3 inheritance (the inheritance is cached after
      the first call).

      An existing S3 method may not behave as desired for an S4
      subclass, in which case utilities such as 'asS3' and 'S3Part' may
      be useful.  If the S3 method fails on the S4 object, 'asS3(x)' may
      be passed instead; if the object returned by the S3 method needs
      to be incorporated in the S4 object, the replacement function for
      'S3Part' may be useful, as in the method for class '"myFrame"' in
      the examples.

      Here are details explaining the reasons for defining both S3 and
      S4 methods. Calls still accessing the S3 generic function directly
      will not see S4 methods, except in the case of primitive
      functions. This means that calls to the generic function from
      namespaces that import the S3 generic but not the S4 version will
      only see S3 methods. On the other hand, S3 methods will only be
      selected from the S4 generic function as part of its default
      ('"ANY"') method. If there are inherited S4 non-default methods,
      these will be chosen in preference to _any_ S3 method.

      S3 generic functions implemented as primitive functions (including
      binary operators) are an exception to recognizing only S3 methods.
      These functions dispatch both S4 and S3 methods from the internal
      C code. There is no explicit generic function, either S3 or S4.
      The internal code looks for S4 methods if the first argument, or
      either of the arguments in the case of a binary operator, is an S4
      object. If no S4 method is found, a search is made for an S3
      method.

      S4 methods can be defined for an S3 generic function and an S3
      class, but if the function is a primitive, such methods will not
      be selected if the object in question is not an S4 object. In the
      examples below, for instance, an S4 method for signature
      '"data.frame"' for function 'f3()' would be called for the S3
      object 'df1'. A similar S4 method for primitive function '`[`'
      would be ignored for that object, but would be called for the S4
      object 'mydf1' that inherits from '"data.frame"'. Defining both an
      S3 and S4 method removes this inconsistency.


From ggrothendieck at gmail.com  Mon Jun 14 01:35:23 2010
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Sun, 13 Jun 2010 19:35:23 -0400
Subject: [Rd] S4 classes and S3 generic functions
In-Reply-To: <4C156288.2030207@r-project.org>
References: <4C156288.2030207@r-project.org>
Message-ID: <AANLkTimsC1z7stkwRR4TcEflZ8mOp_27sTXeT_WJwusp@mail.gmail.com>

On Sun, Jun 13, 2010 at 6:58 PM, John Chambers <jmc at r-project.org> wrote:
> A general goal for the next version of R is to make S4 and S3 play better
> together.
>
> As mentioned in a previous thread, one limitation has been that S3 generic
> functions, specifically the UseMethod() call, did not make use of S4
> inheritance when dispatching on general S4 objects.
>
> This has been fixed in a version committed today (updated to rev 52267).
> ?The code change is not large, but it has some general implications. Mainly,
> in applying S3 generic functions to objects from S4 classes, the default
> recommendation is to define an S3 method for the class, when possible, and
> then set that definition to be the S4 method as well.
>
> The section "Methods for S3 Generic Functions" of the ?Methods documentation
> in the (new) version has details and points to examples. The text of that
> section is appended below.
>
> John
>
> ======================
> Methods for S3 Generic Functions:
>
> ? ? S4 methods may be wanted for functions that also have S3 methods,
> ? ? corresponding to classes for the first formal argument of an S3
> ? ? generic function-either a regular R function in which there is a
> ? ? call to the S3 dispatch function, 'UseMethod', or one of a fixed
> ? ? set of primitive functions, which are not true functions but go
> ? ? directly to C code. In either case S3 method dispatch looks at the
> ? ? class of the first argument or the class of either argument in a
> ? ? call to one of the primitive binary operators. S3 methods are
> ? ? ordinary functions with the same arguments as the generic function
> ? ? (for primitives the formal arguments are not actually part of the
> ? ? object, but are simulated when the object is printed or viewed by
> ? ? 'args()'). The "signature" of an S3 method is identified by the
> ? ? name to which the method is assigned, composed of the name of the
> ? ? generic function, followed by '"."', followed by the name of the
> ? ? class. For details, see S3Methods.
>
> ? ? To implement a method for one of these functions corresponding to
> ? ? S4 classes, there are two possibilities: either an S4 method or an
> ? ? S3 method with the S4 class name. The S3 method is only possible
> ? ? if the intended signature has the first argument and nothing else.
> ? ? In this case, the recommended approach is to define the S3 method
> ? ? and also supply the identical function as the definition of the S4
> ? ? method. If the S3 generic function was 'f3(x, ...)' and the S4
> ? ? class for the new method was '"myClass"':
>
> ? ? f3.myClass <- function(x, ...) { ..... }
> ? ? setMethod("f3", "myClass", f3.myClass)
>
> ? ? The reasons for defining both S3 and S4 methods are as follows:
>
> ? ? ? 1. An S4 method alone will not be seen if the S3 generic
> ? ? ? ? ?function is called directly. ?However, primitive functions
> ? ? ? ? ?and operators are exceptions: The internal C code will look
> ? ? ? ? ?for S4 methods if and only if the object is an S4 object. ?In
> ? ? ? ? ?the examples, the method for '`[`' for class '"myFrame"' will
> ? ? ? ? ?always be called for objects of this class.
>
> ? ? ? ? ?For the same reason, an S4 method defined for an S3 class
> ? ? ? ? ?will not be called from internal code for a non-S4 object.
> ? ? ? ? ?(See the example for function 'Math' and class '"data.frame"'
> ? ? ? ? ?in the examples.)
>
> ? ? ? 2. An S3 method alone will not be called if there is _any_
> ? ? ? ? ?eligible non-default S4 method. (See the example for function
> ? ? ? ? ?'f3' and class '"classA"' in the examples.)
>
> ? ? Details of the selection computations are given below.
>
> ? ? When an S4 method is defined for an existing function that is not
> ? ? an S4 generic function (whether or not the existing function is an
> ? ? S3 generic), an S4 generic function will be created corresponding
> ? ? to the existing function and the package in which it is found
> ? ? (more precisely, according to the implicit generic function either
> ? ? specified or inferred from the ordinary function; see
> ? ? 'implicitGeneric'). A message is printed after the initial call to
> ? ? 'setMethod'; this is not an error, just a reminder that you have
> ? ? created the generic. Creating the generic explicitly by the call
>
> ? ? 'setGeneric("f3")'
>
> ? ? avoids the message, but has the same effect. The existing function
> ? ? becomes the default method for the S4 generic function. Primitive
> ? ? functions work the same way, but the S4 generic function is not
> ? ? explicitly created (as discussed below).
>
> ? ? S4 and S3 method selection are designed to follow compatible rules
> ? ? of inheritance, as far as possible. S3 classes can be used for any
> ? ? S4 method selection, provided that the S3 classes have been
> ? ? registered by a call to 'setOldClass', with that call specifying
> ? ? the correct S3 inheritance pattern. S4 classes can be used for any
> ? ? S3 method selection; when an S4 object is detected, S3 method
> ? ? selection uses the contents of 'extends(class(x))' as the
> ? ? equivalent of the S3 inheritance (the inheritance is cached after
> ? ? the first call).
>
> ? ? An existing S3 method may not behave as desired for an S4
> ? ? subclass, in which case utilities such as 'asS3' and 'S3Part' may
> ? ? be useful. ?If the S3 method fails on the S4 object, 'asS3(x)' may
> ? ? be passed instead; if the object returned by the S3 method needs
> ? ? to be incorporated in the S4 object, the replacement function for
> ? ? 'S3Part' may be useful, as in the method for class '"myFrame"' in
> ? ? the examples.
>
> ? ? Here are details explaining the reasons for defining both S3 and
> ? ? S4 methods. Calls still accessing the S3 generic function directly
> ? ? will not see S4 methods, except in the case of primitive
> ? ? functions. This means that calls to the generic function from
> ? ? namespaces that import the S3 generic but not the S4 version will
> ? ? only see S3 methods. On the other hand, S3 methods will only be
> ? ? selected from the S4 generic function as part of its default
> ? ? ('"ANY"') method. If there are inherited S4 non-default methods,
> ? ? these will be chosen in preference to _any_ S3 method.
>
> ? ? S3 generic functions implemented as primitive functions (including
> ? ? binary operators) are an exception to recognizing only S3 methods.
> ? ? These functions dispatch both S4 and S3 methods from the internal
> ? ? C code. There is no explicit generic function, either S3 or S4.
> ? ? The internal code looks for S4 methods if the first argument, or
> ? ? either of the arguments in the case of a binary operator, is an S4
> ? ? object. If no S4 method is found, a search is made for an S3
> ? ? method.
>
> ? ? S4 methods can be defined for an S3 generic function and an S3
> ? ? class, but if the function is a primitive, such methods will not
> ? ? be selected if the object in question is not an S4 object. In the
> ? ? examples below, for instance, an S4 method for signature
> ? ? '"data.frame"' for function 'f3()' would be called for the S3
> ? ? object 'df1'. A similar S4 method for primitive function '`[`'
> ? ? would be ignored for that object, but would be called for the S4
> ? ? object 'mydf1' that inherits from '"data.frame"'. Defining both an
> ? ? S3 and S4 method removes this inconsistency.

Would like to see one or more examples of this that one can enter into
R and run.


From jmc at r-project.org  Mon Jun 14 02:47:10 2010
From: jmc at r-project.org (John Chambers)
Date: Sun, 13 Jun 2010 17:47:10 -0700
Subject: [Rd] S4 classes and S3 generic functions
In-Reply-To: <AANLkTimsC1z7stkwRR4TcEflZ8mOp_27sTXeT_WJwusp@mail.gmail.com>
References: <4C156288.2030207@r-project.org>
	<AANLkTimsC1z7stkwRR4TcEflZ8mOp_27sTXeT_WJwusp@mail.gmail.com>
Message-ID: <4C157C0E.2090907@r-project.org>

There are  number of examples in the documentation, as noted, 
illustrating different situations.

Here is one of them.  Of course, to "enter and run" it you need rev 52267.

-------
setClass("classA", contains = "numeric",
    representation(realData = "numeric"))

Math.classA <- function(x) {(getFunction(.Generic))(x at realData)}
setMethod("Math", "classA", Math.classA)


x <- new("classA", log(1:10), realData = 1:10)

stopifnot(identical(abs(x), 1:10))

setClass("classB", contains = "classA")

y <- new("classB", x)

stopifnot(identical(abs(y), 1:10)) # (version 2.9.0 or earlier fails here)

## an S3 generic: just for demonstration purposes
f3 <- function(x, ...) UseMethod("f3")

f3.default <- function(x, ...) "Default f3"

## S3 method (only) for classA
f3.classA <- function(x, ...) "Class classA for f3"

## S3 and S4 method for numeric
f3.numeric <- function(x, ...) "Class numeric for f3"
setMethod("f3", "numeric", f3.numeric)

## The S3 method for classA and the closest inherited S3 method for classB
## are not found.

f3(x); f3(y) # both choose "numeric" method

## to obtain the natural inheritance, set identical S3 and S4 methods
setMethod("f3", "classA", f3.classA)

f3(x); f3(y) # now both choose "classA" method

-----


On 6/13/10 4:35 PM, Gabor Grothendieck wrote:
> On Sun, Jun 13, 2010 at 6:58 PM, John Chambers<jmc at r-project.org>  wrote:
>> A general goal for the next version of R is to make S4 and S3 play better
>> together.
>>
>> As mentioned in a previous thread, one limitation has been that S3 generic
>> functions, specifically the UseMethod() call, did not make use of S4
>> inheritance when dispatching on general S4 objects.
>>
>> This has been fixed in a version committed today (updated to rev 52267).
>>   The code change is not large, but it has some general implications. Mainly,
>> in applying S3 generic functions to objects from S4 classes, the default
>> recommendation is to define an S3 method for the class, when possible, and
>> then set that definition to be the S4 method as well.
>>
>> The section "Methods for S3 Generic Functions" of the ?Methods documentation
>> in the (new) version has details and points to examples. The text of that
>> section is appended below.
>>
>> John
>>
>> ======================
>> Methods for S3 Generic Functions:
>>
>>      S4 methods may be wanted for functions that also have S3 methods,
>>      corresponding to classes for the first formal argument of an S3
>>      generic function-either a regular R function in which there is a
>>      call to the S3 dispatch function, 'UseMethod', or one of a fixed
>>      set of primitive functions, which are not true functions but go
>>      directly to C code. In either case S3 method dispatch looks at the
>>      class of the first argument or the class of either argument in a
>>      call to one of the primitive binary operators. S3 methods are
>>      ordinary functions with the same arguments as the generic function
>>      (for primitives the formal arguments are not actually part of the
>>      object, but are simulated when the object is printed or viewed by
>>      'args()'). The "signature" of an S3 method is identified by the
>>      name to which the method is assigned, composed of the name of the
>>      generic function, followed by '"."', followed by the name of the
>>      class. For details, see S3Methods.
>>
>>      To implement a method for one of these functions corresponding to
>>      S4 classes, there are two possibilities: either an S4 method or an
>>      S3 method with the S4 class name. The S3 method is only possible
>>      if the intended signature has the first argument and nothing else..
>>      In this case, the recommended approach is to define the S3 method
>>      and also supply the identical function as the definition of the S4
>>      method. If the S3 generic function was 'f3(x, ...)' and the S4
>>      class for the new method was '"myClass"':
>>
>>      f3.myClass<- function(x, ...) { ..... }
>>      setMethod("f3", "myClass", f3.myClass)
>>
>>      The reasons for defining both S3 and S4 methods are as follows:
>>
>>        1. An S4 method alone will not be seen if the S3 generic
>>           function is called directly.  However, primitive functions
>>           and operators are exceptions: The internal C code will look
>>           for S4 methods if and only if the object is an S4 object.  In
>>           the examples, the method for '`[`' for class '"myFrame"' will
>>           always be called for objects of this class.
>>
>>           For the same reason, an S4 method defined for an S3 class
>>           will not be called from internal code for a non-S4 object.
>>           (See the example for function 'Math' and class '"data.frame"'
>>           in the examples.)
>>
>>        2. An S3 method alone will not be called if there is _any_
>>           eligible non-default S4 method. (See the example for function
>>           'f3' and class '"classA"' in the examples.)
>>
>>      Details of the selection computations are given below.
>>
>>      When an S4 method is defined for an existing function that is not
>>      an S4 generic function (whether or not the existing function is an
>>      S3 generic), an S4 generic function will be created corresponding
>>      to the existing function and the package in which it is found
>>      (more precisely, according to the implicit generic function either
>>      specified or inferred from the ordinary function; see
>>      'implicitGeneric'). A message is printed after the initial call to
>>      'setMethod'; this is not an error, just a reminder that you have
>>      created the generic. Creating the generic explicitly by the call
>>
>>      'setGeneric("f3")'
>>
>>      avoids the message, but has the same effect. The existing function
>>      becomes the default method for the S4 generic function. Primitive
>>      functions work the same way, but the S4 generic function is not
>>      explicitly created (as discussed below).
>>
>>      S4 and S3 method selection are designed to follow compatible rules
>>      of inheritance, as far as possible. S3 classes can be used for any
>>      S4 method selection, provided that the S3 classes have been
>>      registered by a call to 'setOldClass', with that call specifying
>>      the correct S3 inheritance pattern. S4 classes can be used for any
>>      S3 method selection; when an S4 object is detected, S3 method
>>      selection uses the contents of 'extends(class(x))' as the
>>      equivalent of the S3 inheritance (the inheritance is cached after
>>      the first call).
>>
>>      An existing S3 method may not behave as desired for an S4
>>      subclass, in which case utilities such as 'asS3' and 'S3Part' may
>>      be useful.  If the S3 method fails on the S4 object, 'asS3(x)' may
>>      be passed instead; if the object returned by the S3 method needs
>>      to be incorporated in the S4 object, the replacement function for
>>      'S3Part' may be useful, as in the method for class '"myFrame"' in
>>      the examples.
>>
>>      Here are details explaining the reasons for defining both S3 and
>>      S4 methods. Calls still accessing the S3 generic function directly
>>      will not see S4 methods, except in the case of primitive
>>      functions. This means that calls to the generic function from
>>      namespaces that import the S3 generic but not the S4 version will
>>      only see S3 methods. On the other hand, S3 methods will only be
>>      selected from the S4 generic function as part of its default
>>      ('"ANY"') method. If there are inherited S4 non-default methods,
>>      these will be chosen in preference to _any_ S3 method.
>>
>>      S3 generic functions implemented as primitive functions (including
>>      binary operators) are an exception to recognizing only S3 methods..
>>      These functions dispatch both S4 and S3 methods from the internal
>>      C code. There is no explicit generic function, either S3 or S4.
>>      The internal code looks for S4 methods if the first argument, or
>>      either of the arguments in the case of a binary operator, is an S4
>>      object. If no S4 method is found, a search is made for an S3
>>      method.
>>
>>      S4 methods can be defined for an S3 generic function and an S3
>>      class, but if the function is a primitive, such methods will not
>>      be selected if the object in question is not an S4 object. In the
>>      examples below, for instance, an S4 method for signature
>>      '"data.frame"' for function 'f3()' would be called for the S3
>>      object 'df1'. A similar S4 method for primitive function '`[`'
>>      would be ignored for that object, but would be called for the S4
>>      object 'mydf1' that inherits from '"data.frame"'. Defining both an
>>      S3 and S4 method removes this inconsistency.
>
> Would like to see one or more examples of this that one can enter into
> R and run.
>


From nakama at ki.rim.or.jp  Mon Jun 14 11:05:33 2010
From: nakama at ki.rim.or.jp (Ei-ji Nakama)
Date: Mon, 14 Jun 2010 18:05:33 +0900
Subject: [Rd] Failure to load the recommended package Matrix (Was: [R]
	Can one get a list of recommended packages?)
In-Reply-To: <AANLkTimYWiboiAqahS3BUjKRXr2Otcfsf-8uqfKy0c72@mail.gmail.com>
References: <AANLkTimYWiboiAqahS3BUjKRXr2Otcfsf-8uqfKy0c72@mail.gmail.com>
Message-ID: <AANLkTin3reywLYQtLVWLkPNNFn6hoxKusCJJ6zs6TL5E@mail.gmail.com>

> And if you look at the other R-help message posted by David Kirby you
> will find a link to the trouble ticket report in Sage as
> http://trac.sagemath.org/sage_trac/ticket/9201

>From the link,...
|  kirkby at t2:[~] $ echo $LD_LIBRARY_PATH
| /usr/local/gcc-4.4.1-sun-linker/lib:/usr/local/gcc-4.4.1-sun-linker/lib/sparcv9:/usr/local/lib

`/usr/local/gcc-4.4.1-sun-linker/lib/sparcv9' is 64bit, it is unnecessary.
I think that this obstructs it.
-- 
EI-JI Nakama  <nakama (a) ki.rim.or.jp>
"\u4e2d\u9593\u6804\u6cbb"  <nakama (a) ki.rim.or.jp>


From djsamperi at gmail.com  Mon Jun 14 15:03:19 2010
From: djsamperi at gmail.com (Dominick Samperi)
Date: Mon, 14 Jun 2010 09:03:19 -0400
Subject: [Rd] Solaris build problem
Message-ID: <AANLkTimNqAaT6xNep_oFb3Q6UXw4y-AwYKRsaz0AiHoL@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20100614/9fec2166/attachment.pl>

From ripley at stats.ox.ac.uk  Mon Jun 14 15:24:21 2010
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 14 Jun 2010 14:24:21 +0100 (BST)
Subject: [Rd] Solaris build problem
In-Reply-To: <AANLkTimNqAaT6xNep_oFb3Q6UXw4y-AwYKRsaz0AiHoL@mail.gmail.com>
References: <AANLkTimNqAaT6xNep_oFb3Q6UXw4y-AwYKRsaz0AiHoL@mail.gmail.com>
Message-ID: <alpine.LFD.2.00.1006141423540.31984@localhost>

On Mon, 14 Jun 2010, Dominick Samperi wrote:

> Hello,
> 
> I have package that builds fine under all OS's at CRAN except Solaris, and
> the Solaris problem occurs at vignette processing time: the library
> command fails. So, if a package Foo has a vignette is there a problem
> if an R code chunk runs library(Foo) from within a code chunk in
> the vignette under Solaris?

Many other packages do it ...

> 
> Thanks,
> Dominick
> 
> 
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From djsamperi at gmail.com  Mon Jun 14 15:53:18 2010
From: djsamperi at gmail.com (Dominick Samperi)
Date: Mon, 14 Jun 2010 09:53:18 -0400
Subject: [Rd] Solaris build problem
In-Reply-To: <alpine.LFD.2.00.1006141423540.31984@localhost>
References: <AANLkTimNqAaT6xNep_oFb3Q6UXw4y-AwYKRsaz0AiHoL@mail.gmail.com>
	<alpine.LFD.2.00.1006141423540.31984@localhost>
Message-ID: <AANLkTilMkiVO1t1hBitktCJcZRWILeXkT08ERIUgmMZw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20100614/630d2aa7/attachment.pl>

From nakama at ki.rim.or.jp  Mon Jun 14 15:56:36 2010
From: nakama at ki.rim.or.jp (Ei-ji Nakama)
Date: Mon, 14 Jun 2010 22:56:36 +0900
Subject: [Rd] Failure to load the recommended package Matrix (Was: [R]
	Can one get a list of recommended packages?)
In-Reply-To: <AANLkTin3reywLYQtLVWLkPNNFn6hoxKusCJJ6zs6TL5E@mail.gmail.com>
References: <AANLkTimYWiboiAqahS3BUjKRXr2Otcfsf-8uqfKy0c72@mail.gmail.com>
	<AANLkTin3reywLYQtLVWLkPNNFn6hoxKusCJJ6zs6TL5E@mail.gmail.com>
Message-ID: <AANLkTiltywWRnjTV4Zwyew_wv86H_ERsp5AxHkuBq_JG@mail.gmail.com>

Sorry, my  bark up the wrong tree...

When LD_LIBRARY_PATH_32 is set, I think that I become it in such a state.

http://docs.sun.com/app/docs/doc/819-0690/chapter1-11192?a=view#chapter1-9

It is better when there is the following.
crle ; crle -64 ; env|grep "LD_"

2010/6/14 Ei-ji Nakama <nakama at ki.rim.or.jp>:
>> And if you look at the other R-help message posted by David Kirby you
>> will find a link to the trouble ticket report in Sage as
>> http://trac.sagemath.org/sage_trac/ticket/9201
>
> From the link,...
> | ?kirkby at t2:[~] $ echo $LD_
> | /usr/local/gcc-4.4.1-sun-linker/lib:/usr/local/gcc-4.4.1-sun-linker/lib/sparcv9:/usr/local/lib
>
> `/usr/local/gcc-4.4.1-sun-linker/lib/sparcv9' is 64bit, it is unnecessary.
> I think that this obstructs it.
> --
> EI-JI Nakama ?<nakama (a) ki.rim.or.jp>
> "\u4e2d\u9593\u6804\u6cbb" ?<nakama (a) ki.rim.or.jp>
>



-- 
EI-JI Nakama  <nakama (a) ki.rim.or.jp>
"\u4e2d\u9593\u6804\u6cbb"  <nakama (a) ki.rim.or.jp>


From ligges at statistik.tu-dortmund.de  Mon Jun 14 16:02:51 2010
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Mon, 14 Jun 2010 16:02:51 +0200
Subject: [Rd] Solaris build problem
In-Reply-To: <AANLkTilMkiVO1t1hBitktCJcZRWILeXkT08ERIUgmMZw@mail.gmail.com>
References: <AANLkTimNqAaT6xNep_oFb3Q6UXw4y-AwYKRsaz0AiHoL@mail.gmail.com>	<alpine.LFD.2.00.1006141423540.31984@localhost>
	<AANLkTilMkiVO1t1hBitktCJcZRWILeXkT08ERIUgmMZw@mail.gmail.com>
Message-ID: <4C16368B.7030109@statistik.tu-dortmund.de>



On 14.06.2010 15:53, Dominick Samperi wrote:
> I guess I should have been more explicit, here is the error as it appears
> in CRAN logs for package cxxPack:
>
> checking package vignettes in 'inst/doc' ... WARNING
> Error in loadNamespace(name) : there is no package called 'cxxPack'
> Calls: ::: ... tryCatch ->  tryCatchList ->  tryCatchOne ->  <Anonymous>
> Execution halted
> Error in loadNamespace(name) : there is no package called 'cxxPack'
> Calls: ::: ... tryCatch ->  tryCatchList ->  tryCatchOne ->  <Anonymous>
> Execution halted
> "testDotproduct.cpp", line 1: Error: Could not open include
> file<cxxPack.hpp>.
> "testDotproduct.cpp", line 2: Error: RcppExport is not defined.
> [clip]
>
> It appears that the failure occurs at the very beginning of the vignette
> where library(cxxPack) is called, since the other errors (not able to find
> header files) would be expected after this error.
>
> Could this be related to the parallel make problem that sometimes
> occurs under Windows? There a bug in GNU make causes one package
> to corrupt the environment of another.

Ha, that just by chance your package got hit under Windows by a rare bug 
of make does not mean it is not your fault if it fails on Solaris.

Uwe





> Thanks,
> Dominick
>
> On Mon, Jun 14, 2010 at 9:24 AM, Prof Brian Ripley<ripley at stats.ox.ac.uk>wrote:
>
>> On Mon, 14 Jun 2010, Dominick Samperi wrote:
>>
>>   Hello,
>>>
>>> I have package that builds fine under all OS's at CRAN except Solaris, and
>>> the Solaris problem occurs at vignette processing time: the library
>>> command fails. So, if a package Foo has a vignette is there a problem
>>> if an R code chunk runs library(Foo) from within a code chunk in
>>> the vignette under Solaris?
>>>
>>
>> Many other packages do it ...
>>
>>
>>> Thanks,
>>> Dominick
>>>
>>>
>>>
>>>
>> --
>> Brian D. Ripley,                  ripley at stats.ox.ac.uk
>> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/<http://www.stats.ox.ac.uk/%7Eripley/>
>> University of Oxford,             Tel:  +44 1865 272861 (self)
>> 1 South Parks Road,                     +44 1865 272866 (PA)
>> Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>>
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From kasperdanielhansen at gmail.com  Mon Jun 14 16:34:34 2010
From: kasperdanielhansen at gmail.com (Kasper Daniel Hansen)
Date: Mon, 14 Jun 2010 10:34:34 -0400
Subject: [Rd] 00LOCK and nfs
In-Reply-To: <alpine.LFD.2.00.1006091222350.18833@gannet.stats.ox.ac.uk>
References: <s2le780c0971004260815we5156859v293d5b3a6ffd9890@mail.gmail.com>
	<l2kc0177e5a1004261054k3775628fyb6c1fd154707dd91@mail.gmail.com>
	<y2le780c0971004261205i39f069dt379690211f8f8a7f@mail.gmail.com>
	<4BD6F661.10409@acm.org>
	<AANLkTikhZwblSL_MyLTmqbsD5R61vhDa0l-o9lcw0caT@mail.gmail.com>
	<AANLkTikE8kSXLI_dS3hGBFUlVk8A0f0gNULzZ9ZVitZk@mail.gmail.com>
	<alpine.LFD.2.00.1006091222350.18833@gannet.stats.ox.ac.uk>
Message-ID: <AANLkTikupwbBPMIZbbkVldNU6vAWspKnoJnQ-I8Nx8Px@mail.gmail.com>

Thank you very much for including this additional capability.

Our cluster is still running NFS 3 and I doubt I will be able to get
the file system upgraded.  It is nice to know that the problem is
mostly solved under NFS 4.

Kasper

On Thu, Jun 10, 2010 at 7:54 AM, Prof Brian Ripley
<ripley at stats.ox.ac.uk> wrote:
> Note that this patch is incomplete: there are three separate branches in
> install.packages() where R CMD INSTALL is used, and one already uses
> --pkglock. ?(So a short-term solution for you is to set Ncpus > 1.)
>
> However, I think this request has been subsumed by a more general need to be
> able to pass options to INSTALL, and R-devel now has an INSTALL_opts
> argument to install.packages(). ?So I believe you could just use
> install.packages( ... , INSTALL_opts = "--pkglock") .
>
> On Tue, 1 Jun 2010, Kasper Daniel Hansen wrote:
>
>> Further experimentation using this patch to install.packages shows
>> that I sometimes have remaining 00LOCK-pkgname directories after doing
>> a massive update on a multi-user system with R installed on NFS.
>> However, I have never had install.packages/update.packages stop midway
>> because of an unremovable 00LOCK directory. ?I therefore consider the
>> patch to be big improvement for people like me, having a multi-user R
>> installed on NFS. ?Private followups to my original email shows that I
>> am not the only one with this problem.
>
> But I should point out that others with well-tuned NFS do not have the
> problem -- my sysadmins say that it was common with NFSv3 but they've hardly
> seen it with NFSv4.
>
>
>> I would very much like the patch (or some variant hereof) to be
>> considered for inclusion in R-devel.
>>
>> Kasper
>>
>> On Tue, May 18, 2010 at 11:59 AM, Kasper Daniel Hansen
>> <kasperdanielhansen at gmail.com> wrote:
>>>
>>> This is a follow-up to an old thread with kind of solution to the
>>> 00LOCK problem on NFS.
>>>
>>> I have made a patch to install.packages to accept a new argument
>>> ?locktype = c("lock", "no-lock", "pkglock")
>>> which is passed to R CMD INSTALL. ?This addition might have
>>> independent interest aside from the NFS problem, as it exposes
>>> functionality from R CMD INSTALL to install.packages and the very
>>> convenient update.packages. ?Patches are at
>>> ?http://www.biostat.jhsph.edu/~khansen/packages2.R-patch
>>> ?http://www.biostat.jhsph.edu/~khansen/install.packages.Rd-patch
>>> (patches to files in the utils package) and both
>>> ?R-devel (R version 2.12.0 Under development (unstable) (2010-05-17
>>> r52025))
>>> and
>>> ?R-2.11 (R version 2.11.0 Patched (2010-05-17 r52025))
>>> passed make check-all with these two patches applied. ?I thought about
>>> adding a note describing my findings below to the details section, but
>>> decided against it.
>>>
>>> Regarding the 00LOCK problem. ?In my testing, using the patches above
>>> and setting locktype = "pkglock", makes it possible to deal with the
>>> NFS problem. ?Specifically, I have not been able to make
>>> update.packages() fail midway, due to a un-removable 00LOCK file
>>> (which is not too surprising, as I now have a per-package lock).
>>>
>>> However, sometimes (but far less frequently than before), a
>>> 00LOCK-pkgname directory remains after update/install.packages.
>>> Sometimes this 00LOCK-pkgname directory does not contain any .nfs*
>>> files (!?) and sometimes it does. For this reason, I still precede any
>>> install/update.packages with a check for the existence of a
>>> 00LOCK-pkgname directory and an attempt to remove it.
>>>
>>> The difference between using locktype = "pkglock" and not is
>>> specifically that without, it was possible for update.packages to fail
>>> midway even though there were no 00LOCK* files at the start of the
>>> update process.
>>>
>>> Originally I hypothesized that the presence of the .nfs* files in the
>>> 00LOCK directory had to do with synchronization issues between the
>>> file server and the compute node. ?In order to approach this I tried
>>> to insert a
>>> ?system("sleep 10")
>>> at the beginning of
>>> ?do_cleanup
>>> in
>>> ?tools/R/install.R
>>> but that did not work.
>>>
>>> Since the pkglock approach described above seems to solve this issue
>>> for me, I have not pursued the synchronization issue further.
>>>
>>> Kasper
>>>
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
> --
> Brian D. Ripley, ? ? ? ? ? ? ? ? ?ripley at stats.ox.ac.uk
> Professor of Applied Statistics, ?http://www.stats.ox.ac.uk/~ripley/
> University of Oxford, ? ? ? ? ? ? Tel: ?+44 1865 272861 (self)
> 1 South Parks Road, ? ? ? ? ? ? ? ? ? ? +44 1865 272866 (PA)
> Oxford OX1 3TG, UK ? ? ? ? ? ? ? ?Fax: ?+44 1865 272595


From ripley at stats.ox.ac.uk  Mon Jun 14 16:53:47 2010
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 14 Jun 2010 15:53:47 +0100 (BST)
Subject: [Rd] Solaris build problem
In-Reply-To: <AANLkTilMkiVO1t1hBitktCJcZRWILeXkT08ERIUgmMZw@mail.gmail.com>
References: <AANLkTimNqAaT6xNep_oFb3Q6UXw4y-AwYKRsaz0AiHoL@mail.gmail.com>
	<alpine.LFD.2.00.1006141423540.31984@localhost>
	<AANLkTilMkiVO1t1hBitktCJcZRWILeXkT08ERIUgmMZw@mail.gmail.com>
Message-ID: <alpine.LFD.2.00.1006141542300.21982@gannet.stats.ox.ac.uk>

At one level the answer is easy: cxxPack was not installed at system 
level when that check was run, and I presume it was installed on the 
other build systems.

However, the vignette checker should be able to find the package from 
the copy installed for checking, soI need to dig deeper to find out 
why that did not happen.

On Mon, 14 Jun 2010, Dominick Samperi wrote:

> I guess I should have been more explicit, here is the error as it appears
> in CRAN logs for package cxxPack:
> 
> checking package vignettes in 'inst/doc' ... WARNING
> Error in loadNamespace(name) : there is no package called 'cxxPack'
> Calls: ::: ... tryCatch -> tryCatchList -> tryCatchOne -> <Anonymous>
> Execution halted
> Error in loadNamespace(name) : there is no package called 'cxxPack'
> Calls: ::: ... tryCatch -> tryCatchList -> tryCatchOne -> <Anonymous>
> Execution halted
> "testDotproduct.cpp", line 1: Error: Could not open include
> file<cxxPack.hpp>.
> "testDotproduct.cpp", line 2: Error: RcppExport is not defined.
> [clip]
> 
> It appears that the failure occurs at the very beginning of the vignette
> where library(cxxPack) is called, since the other errors (not able to find
> header files) would be expected after this error.
> 
> Could this be related to the parallel make problem that sometimes
> occurs under Windows? There a bug in GNU make causes one package
> to corrupt the environment of another.
> 
> Thanks,
> Dominick
> 
> On Mon, Jun 14, 2010 at 9:24 AM, Prof Brian Ripley <ripley at stats.ox.ac.uk>
> wrote:
> On Mon, 14 Jun 2010, Dominick Samperi wrote:
>
>       Hello,
>
>       I have package that builds fine under all OS's at CRAN
>       except Solaris, and
>       the Solaris problem occurs at vignette processing time:
>       the library
>       command fails. So, if a package Foo has a vignette is
>       there a problem
>       if an R code chunk runs library(Foo) from within a code
>       chunk in
>       the vignette under Solaris?
> 
> 
> Many other packages do it ...
> 
>
>       Thanks,
>       Dominick
> 
> 
> 
> 
> --
> Brian D. Ripley, ? ? ? ? ? ? ? ? ?ripley at stats.ox.ac.uk
> Professor of Applied Statistics, ?http://www.stats.ox.ac.uk/~ripley/
> University of Oxford, ? ? ? ? ? ? Tel: ?+44 1865 272861 (self)
> 1 South Parks Road, ? ? ? ? ? ? ? ? ? ? +44 1865 272866 (PA)
> Oxford OX1 3TG, UK ? ? ? ? ? ? ? ?Fax: ?+44 1865 272595
> 
> 
> 
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From gavin.simpson at ucl.ac.uk  Mon Jun 14 17:25:13 2010
From: gavin.simpson at ucl.ac.uk (Gavin Simpson)
Date: Mon, 14 Jun 2010 16:25:13 +0100
Subject: [Rd] [R] Prime Numbers Pkgs - Schoolmath is broken
In-Reply-To: <663785.75465.qm@web34503.mail.mud.yahoo.com>
References: <663785.75465.qm@web34503.mail.mud.yahoo.com>
Message-ID: <1276529113.19297.61.camel@localhost>

On Mon, 2010-06-14 at 07:16 -0700, Red Roo wrote:
> Looking for a recommended package that handles prime number computations.
> 
> Tried the following unsuccessfully:
> primeFactors() in the R.basic package failed to install.
> 
> primes() and primlist are broken in Schoolmath pkg on CRAN.
> My analysis can be found here http://j.mp/9BNI9q
> Not sure what the procedure is for getting things fixed, so I've
> cross-posted to r-dev as well.

Neither place is correct. This has *nothing* to do with R. Address bug
reports directly to the package maintainer, details of which can be
found here:

http://cran.r-project.org/web/packages/schoolmath/index.html

which is what is requested in the posting guide...

HTH

G

> --njg
> ________________________________________________________________________
> TAKING THE PITH OUT OF PERFORMANCE http://perfdynamics.blogspot.com/
> Follow me on Twitter http://twitter.com/DrQz
> PERFORMANCE DYNAMICS COMPANY http://www.perfdynamics.com/
> 
> ______________________________________________
> R-help at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.

-- 
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
 Dr. Gavin Simpson             [t] +44 (0)20 7679 0522
 ECRC, UCL Geography,          [f] +44 (0)20 7679 0565
 Pearson Building,             [e] gavin.simpsonATNOSPAMucl.ac.uk
 Gower Street, London          [w] http://www.ucl.ac.uk/~ucfagls/
 UK. WC1E 6BT.                 [w] http://www.freshwaters.org.uk
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%


From ripley at stats.ox.ac.uk  Mon Jun 14 17:23:47 2010
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Mon, 14 Jun 2010 16:23:47 +0100 (BST)
Subject: [Rd] Solaris build problem
In-Reply-To: <alpine.LFD.2.00.1006141542300.21982@gannet.stats.ox.ac.uk>
References: <AANLkTimNqAaT6xNep_oFb3Q6UXw4y-AwYKRsaz0AiHoL@mail.gmail.com>
	<alpine.LFD.2.00.1006141423540.31984@localhost>
	<AANLkTilMkiVO1t1hBitktCJcZRWILeXkT08ERIUgmMZw@mail.gmail.com>
	<alpine.LFD.2.00.1006141542300.21982@gannet.stats.ox.ac.uk>
Message-ID: <alpine.LFD.2.00.1006141619590.23482@gannet.stats.ox.ac.uk>

On Mon, 14 Jun 2010, Prof Brian Ripley wrote:

> At one level the answer is easy: cxxPack was not installed at system level 
> when that check was run, and I presume it was installed on the other build 
> systems.
>
> However, the vignette checker should be able to find the package from the 
> copy installed for checking, so I need to dig deeper to find out why 
> that did not happen.

And it because you have an inst/doc/Makefile that does not arrange to 
do so.  R_LIBS should be set appropriately at that point, but since 
you are not using --vanilla to run R (unlike R CMD check), it is 
overridden by other settings.

>
> On Mon, 14 Jun 2010, Dominick Samperi wrote:
>
>> I guess I should have been more explicit, here is the error as it appears
>> in CRAN logs for package cxxPack:
>> 
>> checking package vignettes in 'inst/doc' ... WARNING
>> Error in loadNamespace(name) : there is no package called 'cxxPack'
>> Calls: ::: ... tryCatch -> tryCatchList -> tryCatchOne -> <Anonymous>
>> Execution halted
>> Error in loadNamespace(name) : there is no package called 'cxxPack'
>> Calls: ::: ... tryCatch -> tryCatchList -> tryCatchOne -> <Anonymous>
>> Execution halted
>> "testDotproduct.cpp", line 1: Error: Could not open include
>> file<cxxPack.hpp>.
>> "testDotproduct.cpp", line 2: Error: RcppExport is not defined.
>> [clip]
>> 
>> It appears that the failure occurs at the very beginning of the vignette
>> where library(cxxPack) is called, since the other errors (not able to find
>> header files) would be expected after this error.
>> 
>> Could this be related to the parallel make problem that sometimes
>> occurs under Windows? There a bug in GNU make causes one package
>> to corrupt the environment of another.
>> 
>> Thanks,
>> Dominick
>> 
>> On Mon, Jun 14, 2010 at 9:24 AM, Prof Brian Ripley <ripley at stats.ox.ac.uk>
>> wrote:
>> On Mon, 14 Jun 2010, Dominick Samperi wrote:
>>
>>       Hello,
>>
>>       I have package that builds fine under all OS's at CRAN
>>       except Solaris, and
>>       the Solaris problem occurs at vignette processing time:
>>       the library
>>       command fails. So, if a package Foo has a vignette is
>>       there a problem
>>       if an R code chunk runs library(Foo) from within a code
>>       chunk in
>>       the vignette under Solaris?
>> 
>> 
>> Many other packages do it ...
>> 
>>
>>       Thanks,
>>       Dominick
>> 
>> 
>> 
>> 
>> --
>> Brian D. Ripley, ? ? ? ? ? ? ? ? ?ripley at stats.ox.ac.uk
>> Professor of Applied Statistics, ?http://www.stats.ox.ac.uk/~ripley/
>> University of Oxford, ? ? ? ? ? ? Tel: ?+44 1865 272861 (self)
>> 1 South Parks Road, ? ? ? ? ? ? ? ? ? ? +44 1865 272866 (PA)
>> Oxford OX1 3TG, UK ? ? ? ? ? ? ? ?Fax: ?+44 1865 272595
>> 
>> 
>> 
>> 
>
> -- 
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595

From david.kirkby at onetel.net  Mon Jun 14 17:23:28 2010
From: david.kirkby at onetel.net (Dr. David Kirkby)
Date: Mon, 14 Jun 2010 16:23:28 +0100
Subject: [Rd] Failure to load the recommended package Matrix (Was: [R]
 Can one get a list of recommended packages?)
In-Reply-To: <AANLkTin3reywLYQtLVWLkPNNFn6hoxKusCJJ6zs6TL5E@mail.gmail.com>
References: <AANLkTimYWiboiAqahS3BUjKRXr2Otcfsf-8uqfKy0c72@mail.gmail.com>
	<AANLkTin3reywLYQtLVWLkPNNFn6hoxKusCJJ6zs6TL5E@mail.gmail.com>
Message-ID: <4C164970.1030803@onetel.net>

On 06/14/10 10:05 AM, Ei-ji Nakama wrote:
>> And if you look at the other R-help message posted by David Kirby you
>> will find a link to the trouble ticket report in Sage as
>> http://trac.sagemath.org/sage_trac/ticket/9201
>
>> From the link,...
> |  kirkby at t2:[~] $ echo $LD_LIBRARY_PATH
> | /usr/local/gcc-4.4.1-sun-linker/lib:/usr/local/gcc-4.4.1-sun-linker/lib/sparcv9:/usr/local/lib
>
> `/usr/local/gcc-4.4.1-sun-linker/lib/sparcv9' is 64bit, it is unnecessary.
> I think that this obstructs it.

This is not the reason. If it picked up the wrong library, then there would be a 
message that there was the wrong ELF class, but no library whatever is being found.

I've tried without the 'sparcv9' in LD_LIBRARY_PATH and it makes no difference 
whatsoever. I've tried on two SPARCs too, running different releases of Solaris 10.

Using 'crle' might work, but that is not really a good answer, as it needs root 
access. It should be possible to install an application like R without being 
root. There is something wrong if LD_LIBRARY_PATH can't be used to locate 
libraries.

I can build the whole of the Sage source code (around 300 MB) and don't see this 
failure elsewhere. Instead, there are a number of programs which link to 
libgcc_s.so.1.

I stuck some further information at

http://trac.sagemath.org/sage_trac/ticket/9201

but it basically just confirms what I've written above.


From djsamperi at gmail.com  Mon Jun 14 17:37:32 2010
From: djsamperi at gmail.com (Dominick Samperi)
Date: Mon, 14 Jun 2010 11:37:32 -0400
Subject: [Rd] Solaris build problem
In-Reply-To: <alpine.LFD.2.00.1006141619590.23482@gannet.stats.ox.ac.uk>
References: <AANLkTimNqAaT6xNep_oFb3Q6UXw4y-AwYKRsaz0AiHoL@mail.gmail.com>
	<alpine.LFD.2.00.1006141423540.31984@localhost>
	<AANLkTilMkiVO1t1hBitktCJcZRWILeXkT08ERIUgmMZw@mail.gmail.com>
	<alpine.LFD.2.00.1006141542300.21982@gannet.stats.ox.ac.uk>
	<alpine.LFD.2.00.1006141619590.23482@gannet.stats.ox.ac.uk>
Message-ID: <AANLkTimZIzgy_9EDnFpXkNHyCimWW1z-tTOwVJqK8cNw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20100614/16e030b8/attachment.pl>

From arnima at hafro.is  Mon Jun 14 23:50:11 2010
From: arnima at hafro.is (Arni Magnusson)
Date: Mon, 14 Jun 2010 21:50:11 +0000 (UTC)
Subject: [Rd] areaplot
Message-ID: <alpine.LFD.2.00.1006142141360.32714@hafstormur.hafro.is>

I would like to propose adding a new plot function to the 'graphics' 
package. The new function is called areaplot() and I have implemented it 
as a generic function that supports a variety of data classes.

An area plot consists of a simple line, like plot(x, y, type="l"), except 
the area between 0 and the line is a filled polygon. Areas can be stacked 
on top of each other, like barplot(matrix(3:1)), and the data can be 
plotted as proportions, so stacked areas equal 1.

Area plots are commonly found in the scientific literature. Currently, 
drawing an area plot in R using polygon() is a hassle at best, and drawing 
a stacked area plot can be a major task for beginning users.

If you source the attached areaplot.R file, and read the help page and 
examples, you will see that I made an effort to implement the following 
features:

- the same look as standard R plots, including default xlab and ylab

- the same graphical args as standard R plots, including add=TRUE

- the same robustness to NA values as standard R plots

- a generic function that supports vectors, tables, matrices, data frames, 
lists, time-series objects, and formulas

On a technical note, I included the support for different data classes 
inside areaplot.default(), instead of implementing separate areaplot.foo() 
functions. It would be trivial to do move the if-clauses to separate 
functions, but I wasn't sure if that would improve the code or not, since 
the necessary data manipulations are minimal. It was only areaplot.formula 
that should obviously be a separate function.

Comparable functions are found in some user packages, highlighting the 
general need of an area plot function, but the existing functions do not 
follow the R plotting standards, nor do they support such a variety of 
data classes, or provide stacked and proportional area plots.

I'm looking forward to your feedback,

Arni
-------------- next part --------------
areaplot <-

function(x, ...)

{

  UseMethod("areaplot")

}



areaplot.default <-

function(x, y=NULL, prop=FALSE, add=FALSE, xlab=NULL, ylab=NULL, col=NULL, ...)

{

  if(is.ts(x)) # ts/mts

  {

    if(is.null(ylab))

      ylab <- deparse(substitute(x))

    x <- data.frame(Time=time(x), x)

  }

  if(is.table(x))  # table

  {

    if(is.null(ylab))

      ylab <- deparse(substitute(x))

    if(length(dim(x)) == 1)

      x <- t(t(unclass(x)))

    else

      x <- unclass(x)

  }

  if(is.matrix(x))  # matrix

  {

    if(!is.null(rownames(x)) && !any(is.na(suppressWarnings(as.numeric(rownames(x))))))

    {

      x <- data.frame(as.numeric(rownames(x)), x)

      names(x)[1] <- ""

    }

    else

    {

      x <- data.frame(Index=seq_len(nrow(x)), x)

    }

  }

  if(is.list(x))  # data.frame or list

  {

    if(is.null(xlab))

      xlab <- names(x)[1]

    if(is.null(ylab))

    {

      if(length(x) == 2)

        ylab <- names(x)[2]

      else

        ylab <- ""

    }

    y <- x[-1]

    x <- x[[1]]

  }

  if(is.null(y))  # one numeric vector passed, plot it on 1:n

  {

    if(is.null(xlab))

      xlab <- "Index"

    if(is.null(ylab))

      ylab <- deparse(substitute(x))

    y <- x

    x <- seq_along(x)

  }

  if(is.null(xlab))

    xlab <- deparse(substitute(x))

  if(is.null(ylab))

    ylab <- deparse(substitute(y))



  y <- as.matrix(y)

  if(is.null(col))

    col <- gray.colors(ncol(y))

  col <- rep(col, length.out=ncol(y))

  if(prop)

    y <- prop.table(y, 1)

  y <- t(rbind(0, apply(y, 1, cumsum)))

  na <- is.na(x) | apply(is.na(y),1,any)

  x <- x[!na][order(x[!na])]

  y <- y[!na,][order(x[!na]),]



  if(!add)

    suppressWarnings(matplot(x, y, type="n", xlab=xlab, ylab=ylab, ...))

  xx <- c(x, rev(x))

  for(i in 1:(ncol(y)-1))

  {

    yy <- c(y[,i+1], rev(y[,i]))

    suppressWarnings(polygon(xx, yy, col=col[i], ...))

  }



  invisible(y[,-1])

}



areaplot.formula <-

function (formula, data, subset, na.action=NULL, ...)

{

  m <- match.call(expand.dots=FALSE)

  if(is.matrix(eval(m$data,parent.frame())))

    m$data <- as.data.frame(data)

  m$... <- NULL

  m[[1]] <- as.name("model.frame")

  if(as.character(formula[[2]]=="."))

  {

    rhs <- unlist(strsplit(deparse(formula[[3]])," *[:+] *"))

    lhs <- sprintf("cbind(%s)", paste(setdiff(names(data),rhs),collapse=","))

    m[[2]][[2]] <- parse(text=lhs)[[1]]

  }



  mf <- eval(m, parent.frame())

  if(is.matrix(mf[[1]]))

  {

    lhs <- as.data.frame(mf[[1]])

    names(lhs) <- as.character(m[[2]][[2]])[-1]

    areaplot.default(cbind(mf[-1],lhs), ...)

  }

  else

  {

    areaplot.default(mf[2:1], ...)

  }

}



-------------- next part --------------
\name{areaplot}

\alias{areaplot}

\alias{areaplot.default}

\alias{areaplot.formula}

\title{Area Plots}

\description{

  Produce a stacked area plot, or add polygons to an existing plot.

}

\usage{

areaplot(x, \dots)



\method{areaplot}{default}(x, y = NULL, prop = FALSE, add = FALSE, xlab = NULL,

         ylab = NULL, col = NULL, \dots)



\method{areaplot}{formula}(formula, data, subset, na.action = NULL, \dots)

}

\arguments{

  \item{x}{numeric vector of x values, or if \code{y=NULL} a numeric

    vector of y values. Can also be a 1-dimensional table (x values in

    names, y values in array), matrix or 2-dimensional table (x values

    in row names and y values in columns), a data frame (x values in

    first column and y values in subsequent columns), or a time-series

    object of class \code{ts/mts}.}

  \item{y}{numeric vector of y values, or a matrix containing y values

    in columns.}

  \item{prop}{whether data should be plotted as proportions, so stacked

    areas equal 1.}

  \item{add}{whether polygons should be added to an existing plot.}

  \item{xlab}{label for x axis.}

  \item{ylab}{label for y axis.}

  \item{col}{fill color of polygon(s). The default is a vector of gray

    colors.}

  \item{formula}{a \code{\link{formula}}, such as \code{y ~ x} or

    \code{cbind(y1, y2) ~ x}, specifying x and y values. A dot on the

    left-hand side, \code{formula = . ~ x}, means all variables except

    the one specified on the right-hand side.}

  \item{data}{a data frame (or list) from which the variables in

    \code{formula} should be taken.}

  \item{subset}{an optional vector specifying a subset of observations

    to be used.}

  \item{na.action}{a function which indicates what should happen when

    the data contain \code{NA} values. The default is to ignore missing

    values in the given variables.}

  \item{\dots}{further arguments passed to \code{matplot} and

    \code{polygon}.}

}

\value{

  Matrix of cumulative sums that was used for plotting.

}

\author{

  Arni Magnusson.

}

\seealso{

  \code{\link{barplot}}, \code{\link{polygon}}.

}

\examples{

areaplot(rpois(10,40))

areaplot(rnorm(10))



# formula

areaplot(Armed.Forces~Year, data=longley)

areaplot(cbind(Armed.Forces,Unemployed)~Year, data=longley)



# add=TRUE

plot(1940:1970, 500*runif(31), ylim=c(0,500))

areaplot(Armed.Forces~Year, data=longley, add=TRUE)



# matrix

areaplot(WorldPhones)

areaplot(WorldPhones, prop=TRUE)



# table

require(MASS)

areaplot(table(Aids2$age))

areaplot(table(Aids2$age, Aids2$sex))



# ts/mts

areaplot(austres)

areaplot(Seatbelts[,c("drivers","front","rear")],

         ylab="Killed or seriously injured")

abline(v=1983+1/12, lty=3)

}

\keyword{kwd1}

\keyword{kwd2}


From nakama at ki.rim.or.jp  Tue Jun 15 10:52:52 2010
From: nakama at ki.rim.or.jp (Ei-ji Nakama)
Date: Tue, 15 Jun 2010 17:52:52 +0900
Subject: [Rd] Failure to load the recommended package Matrix (Was: [R]
	Can one get a list of recommended packages?)
In-Reply-To: <4C164970.1030803@onetel.net>
References: <AANLkTimYWiboiAqahS3BUjKRXr2Otcfsf-8uqfKy0c72@mail.gmail.com>
	<AANLkTin3reywLYQtLVWLkPNNFn6hoxKusCJJ6zs6TL5E@mail.gmail.com>
	<4C164970.1030803@onetel.net>
Message-ID: <AANLkTikKhOWOEgrOiB5N5U4__gF2lSkN_df-nGSgZXXp@mail.gmail.com>

I'm suffering from hay fever now...

from http://sage.math.washington.edu/home/mpatel/trac/8306/r-2.10.1.p2.log
| gcc -v
| Using built-in specs.
| Target: sparc-sun-solaris2.10
| Configured with: ../gcc-4.4.1/configure
--prefix=/usr/local/gcc-4.4.1-sun-linker/ --with-as=/usr/ccs/bin/as
| --without-gnu-as --with-ld=/usr/ccs/bin/ld --without-gnu-ld
--enable-languages=c,c++,fortran --with-
| mpfr-include=/usr/local/include --with-mpfr-lib=/usr/local/lib
--with-gmp-include=/usr/local/include --with-
| gmp-lib=/usr/local/lib CC=/usr/sfw/bin/gcc CXX=/usr/sfw/bin/g++
| Thread model: posix
| gcc version 4.4.1 (GCC)

I think that this gcc is `/usr/local/gcc-4.4.1-sun-linker/bin/gcc'.
library when gcc compiled it is
`/usr/local/gcc-4.4.1-sun-linker/lib/libgcc_s.so'.

if it follows the instruction of FAQ(gcc).
http://gcc.gnu.org/faq.html#rpath

The build is done by using  run time directory in LD_RUN_PATH.
  LD_RUN_PATH=/usr/local/gcc-4.4.1-sun-linker/lib make
      or
You should enumerate the run time directory of gcc in LD_LIBRARY_PATH.
  LD_LIBRARY_PATH=/usr/local/gcc-4.4.1-sun-linker/lib:$LD_LIBRARY_PATH

I think that it is a policy of system administration. It is not a problem of R.
There is not the problem in R on Solaris10 which I use.

Sorry in advance if I'm wrong.

2010/6/15 Dr. David Kirkby <david.kirkby at onetel.net>:
> On 06/14/10 10:05 AM, Ei-ji Nakama wrote:
>>>
>>> And if you look at the other R-help message posted by David Kirby you
>>> will find a link to the trouble ticket report in Sage as
>>> http://trac.sagemath.org/sage_trac/ticket/9201
>>
>>> From the link,...
>>
>> | ?kirkby at t2:[~] $ echo $LD_LIBRARY_PATH
>> |
>> /usr/local/gcc-4.4.1-sun-linker/lib:/usr/local/gcc-4.4.1-sun-linker/lib/sparcv9:/usr/local/lib
>>
>> `/usr/local/gcc-4.4.1-sun-linker/lib/sparcv9' is 64bit, it is unnecessary.
>> I think that this obstructs it.
>
> This is not the reason. If it picked up the wrong library, then there would
> be a message that there was the wrong ELF class, but no library whatever is
> being found.
>
> I've tried without the 'sparcv9' in LD_LIBRARY_PATH and it makes no
> difference whatsoever. I've tried on two SPARCs too, running different
> releases of Solaris 10.
>
> Using 'crle' might work, but that is not really a good answer, as it needs
> root access. It should be possible to install an application like R without
> being root. There is something wrong if LD_LIBRARY_PATH can't be used to
> locate libraries.
>
> I can build the whole of the Sage source code (around 300 MB) and don't see
> this failure elsewhere. Instead, there are a number of programs which link
> to libgcc_s.so.1.
>
> I stuck some further information at
>
> http://trac.sagemath.org/sage_trac/ticket/9201
>
> but it basically just confirms what I've written above.
>
>
>
>



-- 
EI-JI Nakama  <nakama (a) ki.rim.or.jp>
"\u4e2d\u9593\u6804\u6cbb"  <nakama (a) ki.rim.or.jp>


From pdalgd at gmail.com  Tue Jun 15 13:54:43 2010
From: pdalgd at gmail.com (Peter Dalgaard)
Date: Tue, 15 Jun 2010 13:54:43 +0200
Subject: [Rd] [R] Prime Numbers Pkgs - Schoolmath is broken
In-Reply-To: <1276529113.19297.61.camel@localhost>
References: <663785.75465.qm@web34503.mail.mud.yahoo.com>
	<1276529113.19297.61.camel@localhost>
Message-ID: <4C176A03.2050705@gmail.com>

Gavin Simpson wrote:
> On Mon, 2010-06-14 at 07:16 -0700, Red Roo wrote:
....
>> primes() and primlist are broken in Schoolmath pkg on CRAN.
>> My analysis can be found here http://j.mp/9BNI9q
>> Not sure what the procedure is for getting things fixed, so I've
>> cross-posted to r-dev as well.
> 
> Neither place is correct. This has *nothing* to do with R. Address bug
> reports directly to the package maintainer, details of which can be
> found here:
> 
> http://cran.r-project.org/web/packages/schoolmath/index.html
> 
> which is what is requested in the posting guide...

Hmm, well... yes, but:

It could be argued that we are a little too closed to discussing items
outside of base R. There is something to be said for allowing people to
point out to us that we do have a package on CRAN that claims that 133
is a prime! Of course it might be considered more polite first to tell
the package maintainder that he has egg on his face...

-pd



-- 
Peter Dalgaard
Center for Statistics, Copenhagen Business School
Phone: (+45)38153501
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From gavin.simpson at ucl.ac.uk  Tue Jun 15 14:31:49 2010
From: gavin.simpson at ucl.ac.uk (Gavin Simpson)
Date: Tue, 15 Jun 2010 13:31:49 +0100
Subject: [Rd] [R] Prime Numbers Pkgs - Schoolmath is broken
In-Reply-To: <4C176A03.2050705@gmail.com>
References: <663785.75465.qm@web34503.mail.mud.yahoo.com>
	<1276529113.19297.61.camel@localhost>  <4C176A03.2050705@gmail.com>
Message-ID: <1276605109.12203.31.camel@localhost>

On Tue, 2010-06-15 at 13:54 +0200, Peter Dalgaard wrote:
> Gavin Simpson wrote:
> > On Mon, 2010-06-14 at 07:16 -0700, Red Roo wrote:
> ....
> >> primes() and primlist are broken in Schoolmath pkg on CRAN.
> >> My analysis can be found here http://j.mp/9BNI9q
> >> Not sure what the procedure is for getting things fixed, so I've
> >> cross-posted to r-dev as well.
> > 
> > Neither place is correct. This has *nothing* to do with R. Address bug
> > reports directly to the package maintainer, details of which can be
> > found here:
> > 
> > http://cran.r-project.org/web/packages/schoolmath/index.html
> > 
> > which is what is requested in the posting guide...
> 
> Hmm, well... yes, but:
> 
> It could be argued that we are a little too closed to discussing items
> outside of base R. There is something to be said for allowing people to
> point out to us that we do have a package on CRAN that claims that 133
> is a prime! Of course it might be considered more polite first to tell
> the package maintainder that he has egg on his face...
> 
> -pd

Hi Peter,

I agree with what you say; on the main R-Help list people are free to
answer/ignore questions on contributed packages as they wish so there
shouldn't be discouragement of such communications.

There was an interesting discussion on R-Help or R-Devel (I forget
which) recently where a question was asked about when it was appropriate
to send a public email to R-Help/R-Devel notifying the community of
problems with a package on CRAN that had gone unacknowledged despite the
OP having contacted the package maintainers. That post solicited several
interesting and consider replies, and I too would like to be made aware
if a package was providing incorrect/erroneous results.

As you say, it is good form to give the maintainer an opportunity to fix
the problem and/or respond. However, the tone of Neil Gunther's analysis
left a sour taste in the mouth and didn't indicate the maintainer had
been contacted to correct the problems.

G
-- 
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
 Dr. Gavin Simpson             [t] +44 (0)20 7679 0522
 ECRC, UCL Geography,          [f] +44 (0)20 7679 0565
 Pearson Building,             [e] gavin.simpsonATNOSPAMucl.ac.uk
 Gower Street, London          [w] http://www.ucl.ac.uk/~ucfagls/
 UK. WC1E 6BT.                 [w] http://www.freshwaters.org.uk
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%


From ag at idesignsoftware.com  Tue Jun 15 17:39:01 2010
From: ag at idesignsoftware.com (Anne George)
Date: Tue, 15 Jun 2010 15:39:01 +0000
Subject: [Rd] GUI's and R background processes
Message-ID: <W159322157064711276616341@webmail11>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20100615/bd32149c/attachment.pl>

From murdoch.duncan at gmail.com  Tue Jun 15 18:04:29 2010
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Tue, 15 Jun 2010 12:04:29 -0400
Subject: [Rd] GUI's and R background processes
In-Reply-To: <W159322157064711276616341@webmail11>
References: <W159322157064711276616341@webmail11>
Message-ID: <4C17A48D.4030100@gmail.com>

Anne George wrote:
> Hello,
>
> I am new to R and have created an application using R 2.10, with a graphical UI using TclTk 8.5, running on windows 7, quad core machine.
> The intention of the application is to launch calculations and display results on a graphical dashboard.
>
> I've reached a roadblock, and I need to confirm that the following CANNOT be done. I've been trying to find a mechanism for doing the following:
>
> 1. From the dashboard, start a huge calculation (i.e. call a function) that take at least 30 seconds to run, but without tying up the other dashboard features
> 2. Dashboard can detect when the calculation is finished
> 3. Dashboard can display incremental results as the calculation runs (i.e. status/progress)
>
> The requirement is to kickoff 4 calculations (#1), but I don't want the user to wait for the others to finish.
> The calculations are not dependent. I just need to display results.
>
> I've been reading that threading in R is not an option. I tried using the multicore package, but that is still synchronous. I looked at multicore, fork(), addTaskCallback(), and TclTk threading, and none of these seem like an option.
>
> Is there a way to launch multiple R scripts from controller that can communicate back and forth? I believe this means that the separate processes are able to communicate.
>
> I certainly appreciate any direction you can provide. I really want to find some good news to tell the boss, though, since we went down this path before realizing the limitations.

This is possible, but not easy.  You need to work at the C level.

The key is that the long running processes need to periodically tell R 
to check for user events by calling

R_ProcessEvents();
R_CheckUserInterrupt();

at the C level.  This works in Windows in current versions, and I 
believe on all platforms in R-devel.

The code should be prepared for R to call it again during 
R_ProcessEvents, so if it is not re-entrant, it should arrange to signal 
an error.  It should be prepared for the R_CheckUserInterrupt call to 
never return if the user happened to interrupt the calculation.

You probably only want one processor to do this, and let it check on the 
other cores to see if there are any results ready.


Duncan Murdoch


From charlie at stat.umn.edu  Tue Jun 15 22:55:07 2010
From: charlie at stat.umn.edu (Charles Geyer)
Date: Tue, 15 Jun 2010 15:55:07 -0500
Subject: [Rd] location of Sweave.sty in R devel (2010-06-15 r52280)
In-Reply-To: <mailman.21.1276596007.19267.r-devel@r-project.org>
References: <mailman.21.1276596007.19267.r-devel@r-project.org>
Message-ID: <20100615205507.GA20809@stat.umn.edu>

Sorry if I was supposed to file a bug report, but I don't know whether
we're supposed to do that on R devel.  I just built R devel from source
(2010-06-15 r52280) and tried to check a package with it and Sweave
failed on the vignette.  It puts the line

\usepackage{/HOME/faculty/charlie/local/devel/lib64/R/share/texmf/Sweave}

in the *.tex file but, that's not where Sweave.sty is

oak$ find ~/local/devel -name Sweave.sty
/HOME/faculty/charlie/local/devel/lib64/R/share/texmf/tex/latex/Sweave.sty

All I did was configure; make; make install and the only configure
flags were --prefix=/HOME/faculty/charlie/local/devel
and --with-valgrind-instrumentation=2   Don't see why either would mess
up Sweave.

On a linux box (openSUSE 11.1 (x86_64)).

The day before I built R-2.11.1 the same way and it works fine.

-- 
Charles Geyer
Professor, School of Statistics
University of Minnesota
charlie at stat.umn.edu


From ripley at stats.ox.ac.uk  Wed Jun 16 00:23:09 2010
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Tue, 15 Jun 2010 23:23:09 +0100 (BST)
Subject: [Rd] location of Sweave.sty in R devel (2010-06-15 r52280)
In-Reply-To: <20100615205507.GA20809@stat.umn.edu>
References: <mailman.21.1276596007.19267.r-devel@r-project.org>
	<20100615205507.GA20809@stat.umn.edu>
Message-ID: <alpine.LFD.2.00.1006152316240.11720@gannet.stats.ox.ac.uk>

That is not the default behaviour of Sweave, which is to use 
\usepackage{Sweave}.  Do you have SWEAVE_STYLEPATH_DEFAULT set, or 
some other non-standard setting that would cause this?  (That is even 
less needed than before, and it may be removed before 2.12.0 is 
released.)

All of CRAN and BioC have been checked in the last 24 hours with 
standard settings, so this does look like a problem with some 
non-standard setup.

If we can reproduce it we can address the problem, but there is 
nothing here that I can do more than guess at.

On Tue, 15 Jun 2010, Charles Geyer wrote:

> Sorry if I was supposed to file a bug report, but I don't know whether
> we're supposed to do that on R devel.  I just built R devel from source
> (2010-06-15 r52280) and tried to check a package with it and Sweave
> failed on the vignette.  It puts the line
>
> \usepackage{/HOME/faculty/charlie/local/devel/lib64/R/share/texmf/Sweave}
>
> in the *.tex file but, that's not where Sweave.sty is
>
> oak$ find ~/local/devel -name Sweave.sty
> /HOME/faculty/charlie/local/devel/lib64/R/share/texmf/tex/latex/Sweave.sty
>
> All I did was configure; make; make install and the only configure
> flags were --prefix=/HOME/faculty/charlie/local/devel
> and --with-valgrind-instrumentation=2   Don't see why either would mess
> up Sweave.
>
> On a linux box (openSUSE 11.1 (x86_64)).
>
> The day before I built R-2.11.1 the same way and it works fine.
>
> -- 
> Charles Geyer
> Professor, School of Statistics
> University of Minnesota
> charlie at stat.umn.edu
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From pgilbert at bank-banque-canada.ca  Wed Jun 16 03:35:33 2010
From: pgilbert at bank-banque-canada.ca (Paul Gilbert)
Date: Tue, 15 Jun 2010 21:35:33 -0400
Subject: [Rd] location of Sweave.sty in R devel (2010-06-15 r52280)
In-Reply-To: <alpine.LFD.2.00.1006152316240.11720@gannet.stats.ox.ac.uk>
References: <mailman.21.1276596007.19267.r-devel@r-project.org><20100615205507.GA20809@stat.umn.edu>
	<alpine.LFD.2.00.1006152316240.11720@gannet.stats.ox.ac.uk>
Message-ID: <D611103AA7EE3B4DAE7F7D49C72B291A029F3951@EXMAIL2.bocad.bank-banque-canada.ca>

Charles

For some time I have had to add R to the tex paths:

export TEXINPUTS="~/texmf/tex/latex:$RHOME/share/texmf:"
export BSTINPUTS="~/texmf/bibtex/bst:$RHOME/share/texmf:"   

to get vignettes to build.  Not sure if I am still suppose to need to do
that, but the symptom looks the same.

Paul

>-----Original Message-----
>From: r-devel-bounces at r-project.org [mailto:r-devel-bounces at r-
>project.org] On Behalf Of Prof Brian Ripley
>Sent: June 15, 2010 6:23 PM
>To: Charles Geyer
>Cc: r-devel at r-project.org
>Subject: Re: [Rd] location of Sweave.sty in R devel (2010-06-15 r52280)
>
>That is not the default behaviour of Sweave, which is to use
>\usepackage{Sweave}.  Do you have SWEAVE_STYLEPATH_DEFAULT set, or
>some other non-standard setting that would cause this?  (That is even
>less needed than before, and it may be removed before 2.12.0 is
>released.)
>
>All of CRAN and BioC have been checked in the last 24 hours with
>standard settings, so this does look like a problem with some
>non-standard setup.
>
>If we can reproduce it we can address the problem, but there is
>nothing here that I can do more than guess at.
>
>On Tue, 15 Jun 2010, Charles Geyer wrote:
>
>> Sorry if I was supposed to file a bug report, but I don't know
whether
>> we're supposed to do that on R devel.  I just built R devel from
>source
>> (2010-06-15 r52280) and tried to check a package with it and Sweave
>> failed on the vignette.  It puts the line
>>
>>
>\usepackage{/HOME/faculty/charlie/local/devel/lib64/R/share/texmf/Sweav
e
>}
>>
>> in the *.tex file but, that's not where Sweave.sty is
>>
>> oak$ find ~/local/devel -name Sweave.sty
>>
>/HOME/faculty/charlie/local/devel/lib64/R/share/texmf/tex/latex/Sweave.
s
>ty
>>
>> All I did was configure; make; make install and the only configure
>> flags were --prefix=/HOME/faculty/charlie/local/devel
>> and --with-valgrind-instrumentation=2   Don't see why either would
>mess
>> up Sweave.
>>
>> On a linux box (openSUSE 11.1 (x86_64)).
>>
>> The day before I built R-2.11.1 the same way and it works fine.
>>
>> --
>> Charles Geyer
>> Professor, School of Statistics
>> University of Minnesota
>> charlie at stat.umn.edu
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel
>>
>
>--
>Brian D. Ripley,                  ripley at stats.ox.ac.uk
>Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
>University of Oxford,             Tel:  +44 1865 272861 (self)
>1 South Parks Road,                     +44 1865 272866 (PA)
>Oxford OX1 3TG, UK                Fax:  +44 1865 272595
>
>______________________________________________
>R-devel at r-project.org mailing list
>https://stat.ethz.ch/mailman/listinfo/r-devel
====================================================================================

La version fran?aise suit le texte anglais.

------------------------------------------------------------------------------------

This email may contain privileged and/or confidential information, and the Bank of
Canada does not waive any related rights. Any distribution, use, or copying of this
email or the information it contains by other than the intended recipient is
unauthorized. If you received this email in error please delete it immediately from
your system and notify the sender promptly by email that you have done so. 

------------------------------------------------------------------------------------

Le pr?sent courriel peut contenir de l'information privil?gi?e ou confidentielle.
La Banque du Canada ne renonce pas aux droits qui s'y rapportent. Toute diffusion,
utilisation ou copie de ce courriel ou des renseignements qu'il contient par une
personne autre que le ou les destinataires d?sign?s est interdite. Si vous recevez
ce courriel par erreur, veuillez le supprimer imm?diatement et envoyer sans d?lai ?
l'exp?diteur un message ?lectronique pour l'aviser que vous avez ?limin? de votre
ordinateur toute copie du courriel re?u.

From spencer.graves at structuremonitoring.com  Wed Jun 16 03:45:02 2010
From: spencer.graves at structuremonitoring.com (Spencer Graves)
Date: Tue, 15 Jun 2010 18:45:02 -0700
Subject: [Rd] Package development process?
Message-ID: <4C182C9E.2080604@structuremonitoring.com>

Hello, All:


       What thoughts might you have on "The R Software Package 
Development Process"?


       I'm looking for ideas, materials, references, and / or 
collaborators for an article on this topic to be submitted to the 
Communications of the ACM.  My limited experience with other languages 
such as Matlab and Python suggests that R may be fairly unique with CRAN 
and this accompanying package development process -- and users of other 
languages might benefit from emulating R in this regard.  We have an 
immediate deadline of Sept. 15, when Sundar and I are scheduled to speak 
on this topic for the San Francisco Bay Chapter of the Association for 
Computing Machinery.


       So far my literature search for comparable capabilities for other 
languages have produced essentially nothing comparable.(a)  Sundar and I 
added a section on "Selected Repositories" to the Wikipedia "Software 
repository" entry (http://en.wikipedia.org/wiki/Software_repository).


       Thanks,
       Spencer Graves

##################
(a) I have material discussed by Merijn de Jonge, Eindhoven University 
of Technology on "Package-Based Software Development" at the 29th 
Euromicro Conference (EUROMICRO'03),
Belek-Antalya, Turkey, September 01-September 06 
(http://www.computer.org/portal/web/csdl/doi/10.1109/EURMIC.2003.1231570).  
I'm also familiar with material by Friedrich Leisch, Sundar and I on 
"Creating R Packages" available as contributed documentation from CRAN.

-- 
Spencer Graves, PE, PhD
President and Chief Operating Officer
Structure Inspection and Monitoring, Inc.
751 Emerson Ct.
San Jos?, CA 95126
ph:  408-655-4567


From ggrothendieck at gmail.com  Wed Jun 16 03:52:10 2010
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Tue, 15 Jun 2010 21:52:10 -0400
Subject: [Rd] Package development process?
In-Reply-To: <4C182C9E.2080604@structuremonitoring.com>
References: <4C182C9E.2080604@structuremonitoring.com>
Message-ID: <AANLkTinFwYaHUjTMhFoPuZ1yS8TUwReFjQHbL6CVQOZP@mail.gmail.com>

On Tue, Jun 15, 2010 at 9:45 PM, Spencer Graves
<spencer.graves at structuremonitoring.com> wrote:
> Hello, All:
>
>
> ? ? ?What thoughts might you have on "The R Software Package Development
> Process"?
>
>
> ? ? ?I'm looking for ideas, materials, references, and / or collaborators
> for an article on this topic to be submitted to the Communications of the
> ACM. ?My limited experience with other languages such as Matlab and Python
> suggests that R may be fairly unique with CRAN and this accompanying package

Perl has CPAN and TeX has CTAN.  Ruby has RubyGems.


From charlie at stat.umn.edu  Wed Jun 16 04:51:50 2010
From: charlie at stat.umn.edu (Charles Geyer)
Date: Tue, 15 Jun 2010 21:51:50 -0500
Subject: [Rd] location of Sweave.sty in R devel (2010-06-15 r52280)
In-Reply-To: <alpine.LFD.2.00.1006152316240.11720@gannet.stats.ox.ac.uk>
References: <mailman.21.1276596007.19267.r-devel@r-project.org>
	<20100615205507.GA20809@stat.umn.edu>
	<alpine.LFD.2.00.1006152316240.11720@gannet.stats.ox.ac.uk>
Message-ID: <20100616025150.GA21762@stat.umn.edu>

On Tue, Jun 15, 2010 at 11:23:09PM +0100, Prof Brian Ripley wrote:
> That is not the default behaviour of Sweave, which is to use 
> \usepackage{Sweave}.  Do you have SWEAVE_STYLEPATH_DEFAULT set, or 
> some other non-standard setting that would cause this?  (That is even 
> less needed than before, and it may be removed before 2.12.0 is 
> released.)

oak$ ~/local/devel/bin/R --vanilla --quiet
> Sys.getenv()["SWEAVE_STYLEPATH_DEFAULT"]
SWEAVE_STYLEPATH_DEFAULT
                  "TRUE"

Sorry.  I forgot about that.

I should take that out of my .bashrc I suppose?  Done.

I apologize for bothering the list about a stupid luser problem.

> 
> All of CRAN and BioC have been checked in the last 24 hours with 
> standard settings, so this does look like a problem with some 
> non-standard setup.
> 
> If we can reproduce it we can address the problem, but there is 
> nothing here that I can do more than guess at.
> 
> On Tue, 15 Jun 2010, Charles Geyer wrote:
> 
> >Sorry if I was supposed to file a bug report, but I don't know whether
> >we're supposed to do that on R devel.  I just built R devel from source
> >(2010-06-15 r52280) and tried to check a package with it and Sweave
> >failed on the vignette.  It puts the line
> >
> >\usepackage{/HOME/faculty/charlie/local/devel/lib64/R/share/texmf/Sweave}
> >
> >in the *.tex file but, that's not where Sweave.sty is
> >
> >oak$ find ~/local/devel -name Sweave.sty
> >/HOME/faculty/charlie/local/devel/lib64/R/share/texmf/tex/latex/Sweave.sty
> >
> >All I did was configure; make; make install and the only configure
> >flags were --prefix=/HOME/faculty/charlie/local/devel
> >and --with-valgrind-instrumentation=2   Don't see why either would mess
> >up Sweave.
> >
> >On a linux box (openSUSE 11.1 (x86_64)).
> >
> >The day before I built R-2.11.1 the same way and it works fine.
> >
> >-- 
> >Charles Geyer
> >Professor, School of Statistics
> >University of Minnesota
> >charlie at stat.umn.edu
> >
> >______________________________________________
> >R-devel at r-project.org mailing list
> >https://stat.ethz.ch/mailman/listinfo/r-devel
> >
> 
> -- 
> Brian D. Ripley,                  ripley at stats.ox.ac.uk
> Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
> University of Oxford,             Tel:  +44 1865 272861 (self)
> 1 South Parks Road,                     +44 1865 272866 (PA)
> Oxford OX1 3TG, UK                Fax:  +44 1865 272595

-- 
Charles Geyer
Professor, School of Statistics
University of Minnesota
charlie at stat.umn.edu


From spencer.graves at structuremonitoring.com  Wed Jun 16 06:20:33 2010
From: spencer.graves at structuremonitoring.com (Spencer Graves)
Date: Tue, 15 Jun 2010 21:20:33 -0700
Subject: [Rd] Package development process?
In-Reply-To: <AANLkTinFwYaHUjTMhFoPuZ1yS8TUwReFjQHbL6CVQOZP@mail.gmail.com>
References: <4C182C9E.2080604@structuremonitoring.com>
	<AANLkTinFwYaHUjTMhFoPuZ1yS8TUwReFjQHbL6CVQOZP@mail.gmail.com>
Message-ID: <4C185111.3020905@structuremonitoring.com>

Hi, Gabor:


       Thanks.  I added a row for Ruby and columns for "Package manager" 
and "Collaborative development platform" to the table of "Selected 
Repositories" in the Wikipedia entry for "Software repository".  Please 
correct me if I'm wrong, but the Wiki page for Ruby suggested to me that 
RubyGems is a package manager, crudely comparable to the "R CMD check 
process", while the Ruby counterpart for CRAN is the "Ruby Application 
Archive (RAA)".  In addition, there is "RubyForge", which sounds like 
analogous to R-Forge.  If this is incorrect or can otherwise be 
improved, please either let me know or change the Wiki yourself.


       Any other suggestions?
       Thanks again,
       Spencer


On 6/15/2010 6:52 PM, Gabor Grothendieck wrote:
> On Tue, Jun 15, 2010 at 9:45 PM, Spencer Graves
> <spencer.graves at structuremonitoring.com>  wrote:
>    
>> Hello, All:
>>
>>
>>       What thoughts might you have on "The R Software Package Development
>> Process"?
>>
>>
>>       I'm looking for ideas, materials, references, and / or collaborators
>> for an article on this topic to be submitted to the Communications of the
>> ACM.  My limited experience with other languages such as Matlab and Python
>> suggests that R may be fairly unique with CRAN and this accompanying package
>>      
> Perl has CPAN and TeX has CTAN.  Ruby has RubyGems.
>
>    


-- 
Spencer Graves, PE, PhD
President and Chief Operating Officer
Structure Inspection and Monitoring, Inc.
751 Emerson Ct.
San Jos?, CA 95126
ph:  408-655-4567


From rainer.stuetz at gmail.com  Wed Jun 16 08:24:46 2010
From: rainer.stuetz at gmail.com (Rainer Stuetz)
Date: Wed, 16 Jun 2010 08:24:46 +0200
Subject: [Rd] Package development process?
In-Reply-To: <4C185111.3020905@structuremonitoring.com>
References: <4C182C9E.2080604@structuremonitoring.com>
	<AANLkTinFwYaHUjTMhFoPuZ1yS8TUwReFjQHbL6CVQOZP@mail.gmail.com>
	<4C185111.3020905@structuremonitoring.com>
Message-ID: <AANLkTikFOptlcmRaRyy1LnUgV2v7IpyAbLXD9m2485Q-@mail.gmail.com>

On Wed, Jun 16, 2010 at 6:20 AM, Spencer Graves
<spencer.graves at structuremonitoring.com> wrote:
>      Thanks.  I added a row for Ruby and columns for "Package manager" and
> "Collaborative development platform" to the table of "Selected Repositories"
> in the Wikipedia entry for "Software repository".  Please correct me if I'm
> wrong, but the Wiki page for Ruby suggested to me that RubyGems is a package
> manager, crudely comparable to the "R CMD check process", while the Ruby
> counterpart for CRAN is the "Ruby Application Archive (RAA)".  In addition,
> there is "RubyForge", which sounds like analogous to R-Forge.  If this is
> incorrect or can otherwise be improved, please either let me know or change
> the Wiki yourself.
>
>      Any other suggestions?
>      Thanks again,
>      Spencer

See this thread on stackoverflow.com:
List of Top Repositories by Programming Language
http://stackoverflow.com/questions/1693529/

Rainer


From spencer.graves at structuremonitoring.com  Wed Jun 16 11:03:50 2010
From: spencer.graves at structuremonitoring.com (Spencer Graves)
Date: Wed, 16 Jun 2010 02:03:50 -0700
Subject: [Rd] Package development process?
In-Reply-To: <AANLkTikFOptlcmRaRyy1LnUgV2v7IpyAbLXD9m2485Q-@mail.gmail.com>
References: <4C182C9E.2080604@structuremonitoring.com>	<AANLkTinFwYaHUjTMhFoPuZ1yS8TUwReFjQHbL6CVQOZP@mail.gmail.com>	<4C185111.3020905@structuremonitoring.com>
	<AANLkTikFOptlcmRaRyy1LnUgV2v7IpyAbLXD9m2485Q-@mail.gmail.com>
Message-ID: <4C189376.9010404@structuremonitoring.com>

Thanks.  I added rows for C++, Haskell, and PHP from your 
stackoverflow.com reference.  I skipped the rest because I wasn't sure 
if they really fit and because I ran out of time for this right now.


More suggestions (including encouragement to study the stackoverflow.com 
reference more) will be welcomed.


Thanks again,
Spencer

On 6/15/2010 11:24 PM, Rainer Stuetz wrote:
> On Wed, Jun 16, 2010 at 6:20 AM, Spencer Graves
> <spencer.graves at structuremonitoring.com>  wrote:
>    
>>       Thanks.  I added a row for Ruby and columns for "Package manager" and
>> "Collaborative development platform" to the table of "Selected Repositories"
>> in the Wikipedia entry for "Software repository".  Please correct me if I'm
>> wrong, but the Wiki page for Ruby suggested to me that RubyGems is a package
>> manager, crudely comparable to the "R CMD check process", while the Ruby
>> counterpart for CRAN is the "Ruby Application Archive (RAA)".  In addition,
>> there is "RubyForge", which sounds like analogous to R-Forge.  If this is
>> incorrect or can otherwise be improved, please either let me know or change
>> the Wiki yourself.
>>
>>       Any other suggestions?
>>       Thanks again,
>>       Spencer
>>      
> See this thread on stackoverflow.com:
> List of Top Repositories by Programming Language
> http://stackoverflow.com/questions/1693529/
>
> Rainer
>
>    


-- 
Spencer Graves, PE, PhD
President and Chief Operating Officer
Structure Inspection and Monitoring, Inc.
751 Emerson Ct.
San Jos?, CA 95126
ph:  408-655-4567


From romain.francois at dbmail.com  Wed Jun 16 12:27:59 2010
From: romain.francois at dbmail.com (Romain Francois)
Date: Wed, 16 Jun 2010 12:27:59 +0200
Subject: [Rd] using C++ finalizers for external pointers
Message-ID: <4C18A72F.7010608@dbmail.com>


Hello,

In Rcpp, we use a C++ template to finalizers for external pointers:

template <typename T>
void delete_finalizer(SEXP p){
     if( TYPEOF(p) == EXTPTRSXP ){
	T* ptr = (T*) EXTPTR_PTR(p) ;
	delete ptr ;
     }
}

This works fine. Or at least it has appeared to work fine for some time.


However, when compiled with suncc, this generates warnings [1] because 
the generated function is of C++ linkage and the finalizer type is 
declared to have C linkage in Rinternals.h

extern "C" {
  	...
	typedef void (*R_CFinalizer_t)(SEXP);
	void R_RegisterFinalizer(SEXP s, SEXP fun);
	void R_RegisterCFinalizer(SEXP s, R_CFinalizer_t fun);
	void R_RegisterFinalizerEx(SEXP s, SEXP fun, Rboolean onexit);
	void R_RegisterCFinalizerEx(SEXP s, R_CFinalizer_t fun, Rboolean onexit);
	...
}

Does anyone know a workaround ?

Would using an R finalizer (with R_RegisterFinalizer) using another 
external pointer to some class be appropriate ?

Romain

[1] : http://article.gmane.org/gmane.comp.lang.r.rcpp/433

-- 
Romain Francois
Professional R Enthusiast
+33(0) 6 28 91 30 30
http://romainfrancois.blog.free.fr
|- http://bit.ly/98Uf7u : Rcpp 0.8.1
|- http://bit.ly/c6YnCi : graph gallery collage
`- http://bit.ly/bZ7ltC : inline 0.3.5


From ggrothendieck at gmail.com  Wed Jun 16 12:45:23 2010
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Wed, 16 Jun 2010 06:45:23 -0400
Subject: [Rd] Package development process?
In-Reply-To: <4C185111.3020905@structuremonitoring.com>
References: <4C182C9E.2080604@structuremonitoring.com>
	<AANLkTinFwYaHUjTMhFoPuZ1yS8TUwReFjQHbL6CVQOZP@mail.gmail.com> 
	<4C185111.3020905@structuremonitoring.com>
Message-ID: <AANLkTinVe1h3-fI88zwdhxqkhw4pnKfkfPUXiElAvqoP@mail.gmail.com>

On Wed, Jun 16, 2010 at 12:20 AM, Spencer Graves
<spencer.graves at structuremonitoring.com> wrote:
> Hi, Gabor:
>
>
> ? ? ?Thanks. ?I added a row for Ruby and columns for "Package manager" and
> "Collaborative development platform" to the table of "Selected Repositories"
> in the Wikipedia entry for "Software repository". ?Please correct me if I'm
> wrong, but the Wiki page for Ruby suggested to me that RubyGems is a package
> manager, crudely comparable to the "R CMD check process", while the Ruby
> counterpart for CRAN is the "Ruby Application Archive (RAA)". ?In addition,
> there is "RubyForge", which sounds like analogous to R-Forge. ?If this is
> incorrect or can otherwise be improved, please either let me know or change
> the Wiki yourself.
>
>
> ? ? ?Any other suggestions?
> ? ? ?Thanks again,
> ? ? ?Spencer

There is also a package repository at http://rubygems.org


From bwhitcher at gmail.com  Wed Jun 16 16:08:06 2010
From: bwhitcher at gmail.com (Brandon Whitcher)
Date: Wed, 16 Jun 2010 15:08:06 +0100
Subject: [Rd] R CMD check error in v2.12.0
Message-ID: <AANLkTilutwQnaufqV8-x9C_BM0ls13cYsd1QmL9T0J9r@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20100616/1cd165a8/attachment.pl>

From hadley at rice.edu  Wed Jun 16 16:19:35 2010
From: hadley at rice.edu (Hadley Wickham)
Date: Wed, 16 Jun 2010 09:19:35 -0500
Subject: [Rd] Package development process?
In-Reply-To: <4C182C9E.2080604@structuremonitoring.com>
References: <4C182C9E.2080604@structuremonitoring.com>
Message-ID: <AANLkTinvljHoZC-XA5UgJkMoSmft9z9SjsUPwt_9W2F6@mail.gmail.com>

Hi Spencer,

I think it is the emphasis on documentation that makes the R
development process unique.  Many other languages have equivalents to
CRAN and R-forge - few others require the attention to documentation
that R does.

Hadley

On Tue, Jun 15, 2010 at 8:45 PM, Spencer Graves
<spencer.graves at structuremonitoring.com> wrote:
> Hello, All:
>
>
> ? ? ?What thoughts might you have on "The R Software Package Development
> Process"?
>
>
> ? ? ?I'm looking for ideas, materials, references, and / or collaborators
> for an article on this topic to be submitted to the Communications of the
> ACM. ?My limited experience with other languages such as Matlab and Python
> suggests that R may be fairly unique with CRAN and this accompanying package
> development process -- and users of other languages might benefit from
> emulating R in this regard. ?We have an immediate deadline of Sept. 15, when
> Sundar and I are scheduled to speak on this topic for the San Francisco Bay
> Chapter of the Association for Computing Machinery.
>
>
> ? ? ?So far my literature search for comparable capabilities for other
> languages have produced essentially nothing comparable.(a) ?Sundar and I
> added a section on "Selected Repositories" to the Wikipedia "Software
> repository" entry (http://en.wikipedia.org/wiki/Software_repository).
>
>
> ? ? ?Thanks,
> ? ? ?Spencer Graves
>
> ##################
> (a) I have material discussed by Merijn de Jonge, Eindhoven University of
> Technology on "Package-Based Software Development" at the 29th Euromicro
> Conference (EUROMICRO'03),
> Belek-Antalya, Turkey, September 01-September 06
> (http://www.computer.org/portal/web/csdl/doi/10.1109/EURMIC.2003.1231570).
> ?I'm also familiar with material by Friedrich Leisch, Sundar and I on
> "Creating R Packages" available as contributed documentation from CRAN.
>
> --
> Spencer Graves, PE, PhD
> President and Chief Operating Officer
> Structure Inspection and Monitoring, Inc.
> 751 Emerson Ct.
> San Jos?, CA 95126
> ph: ?408-655-4567
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>



-- 
Assistant Professor / Dobelman Family Junior Chair
Department of Statistics / Rice University
http://had.co.nz/


From spencer.graves at structuremonitoring.com  Wed Jun 16 16:41:27 2010
From: spencer.graves at structuremonitoring.com (Spencer Graves)
Date: Wed, 16 Jun 2010 07:41:27 -0700
Subject: [Rd] Package development process?
In-Reply-To: <AANLkTinvljHoZC-XA5UgJkMoSmft9z9SjsUPwt_9W2F6@mail.gmail.com>
References: <4C182C9E.2080604@structuremonitoring.com>
	<AANLkTinvljHoZC-XA5UgJkMoSmft9z9SjsUPwt_9W2F6@mail.gmail.com>
Message-ID: <4C18E297.7020805@structuremonitoring.com>

Hi, Hadley:


       What about the encouragement to add unit tests, if only disguised 
as examples?


       I've found the unit tests to be a powerful tool to help improve 
and maintain the quality of packages to which I contribute.  To this 
end, Sundar and I added a column "Autochecks" to the table of "Selected 
Repositories" in the Wikipedia article on "Software repository" 
(http://en.wikipedia.org/wiki/Software_repository), and we describe it 
briefly in the text introducing that table.  I may expand that 
discussion based on the reply from you and others, then try to contact 
leaders for the different languages / repositories, asking them to 
improve this discussion -- or send me comments to incorporate.


       Best Wishes,
       Spencer


On 6/16/2010 7:19 AM, Hadley Wickham wrote:
> Hi Spencer,
>
> I think it is the emphasis on documentation that makes the R
> development process unique.  Many other languages have equivalents to
> CRAN and R-forge - few others require the attention to documentation
> that R does.
>
> Hadley
>
> On Tue, Jun 15, 2010 at 8:45 PM, Spencer Graves
> <spencer.graves at structuremonitoring.com>  wrote:
>    
>> Hello, All:
>>
>>
>>       What thoughts might you have on "The R Software Package Development
>> Process"?
>>
>>
>>       I'm looking for ideas, materials, references, and / or collaborators
>> for an article on this topic to be submitted to the Communications of the
>> ACM.  My limited experience with other languages such as Matlab and Python
>> suggests that R may be fairly unique with CRAN and this accompanying package
>> development process -- and users of other languages might benefit from
>> emulating R in this regard.  We have an immediate deadline of Sept. 15, when
>> Sundar and I are scheduled to speak on this topic for the San Francisco Bay
>> Chapter of the Association for Computing Machinery.
>>
>>
>>       So far my literature search for comparable capabilities for other
>> languages have produced essentially nothing comparable.(a)  Sundar and I
>> added a section on "Selected Repositories" to the Wikipedia "Software
>> repository" entry (http://en.wikipedia.org/wiki/Software_repository).
>>
>>
>>       Thanks,
>>       Spencer Graves
>>
>> ##################
>> (a) I have material discussed by Merijn de Jonge, Eindhoven University of
>> Technology on "Package-Based Software Development" at the 29th Euromicro
>> Conference (EUROMICRO'03),
>> Belek-Antalya, Turkey, September 01-September 06
>> (http://www.computer.org/portal/web/csdl/doi/10.1109/EURMIC.2003.1231570).
>>   I'm also familiar with material by Friedrich Leisch, Sundar and I on
>> "Creating R Packages" available as contributed documentation from CRAN.
>>
>>      
-- 
Spencer Graves, PE, PhD
President and Chief Operating Officer
Structure Inspection and Monitoring, Inc.
751 Emerson Ct.
San Jos?, CA 95126
ph:  408-655-4567


From hadley at rice.edu  Wed Jun 16 16:53:19 2010
From: hadley at rice.edu (Hadley Wickham)
Date: Wed, 16 Jun 2010 09:53:19 -0500
Subject: [Rd] Package development process?
In-Reply-To: <4C18E297.7020805@structuremonitoring.com>
References: <4C182C9E.2080604@structuremonitoring.com>
	<AANLkTinvljHoZC-XA5UgJkMoSmft9z9SjsUPwt_9W2F6@mail.gmail.com> 
	<4C18E297.7020805@structuremonitoring.com>
Message-ID: <AANLkTimtGcfzKshfvQsRBNGAqfxfiZkrabf0loOVtc1V@mail.gmail.com>

> ? ? ?What about the encouragement to add unit tests, if only disguised as
> examples?

Examples are not unit tests. Examples are a convenient way of testing
some aspects of the package, but serve a rather different purpose to
tests. The R community does not emphase testing nearly as much as
other communities.  For example,  Ruby has a very strong testing
culture including at least 10 different unit testing frameworks.

> ? ? ?I've found the unit tests to be a powerful tool to help improve and
> maintain the quality of packages to which I contribute. ?To this end, Sundar
> and I added a column "Autochecks" to the table of "Selected Repositories" in
> the Wikipedia article on "Software repository"
> (http://en.wikipedia.org/wiki/Software_repository), and we describe it
> briefly in the text introducing that table.

Unfortunately your description highlights a inadequacy of R and poor
software development procedures on the part of many R package
developers (including me!). For exactly the reason you discuss, it's
never a good idea for your package to depend on the most current
version of another package.  If you do, changes to that package might
break yours.  Most other package management systems allow you to
specify the version of a dependency so that this doesn't happen.  You
can do this with R, but because it's hard to have multiple versions of
the same package installed at the same time, it's not as useful.

Hadley

-- 
Assistant Professor / Dobelman Family Junior Chair
Department of Statistics / Rice University
http://had.co.nz/


From lbajuk at tibco.com  Wed Jun 16 20:56:35 2010
From: lbajuk at tibco.com (Louis Bajuk-Yorgan)
Date: Wed, 16 Jun 2010 11:56:35 -0700
Subject: [Rd] GUI's and R background processes
Message-ID: <77EB52C6DD32BA4D87471DCD70C8D7000312F133@NA-PA-VBE03.na.tibco.com>

> I am new to R and have created an application using R 2.10, with a graphical UI using TclTk 8.5, running on windows 7, quad core machine. 
> The intention of the application is to launch calculations and display results on a graphical dashboard. 
> 
> I've reached a roadblock, and I need to confirm that the following CANNOT be done. I've been trying to find a mechanism for doing the following: 
> 
> 1. From the dashboard, start a huge calculation (i.e. call a function) that take at least 30 seconds to run, but without tying up the other dashboard features 
> 2. Dashboard can detect when the calculation is finished 
> 3. Dashboard can display incremental results as the calculation runs (i.e. status/progress) 
> 
> The requirement is to kickoff 4 calculations (#1), but I don't want the user to wait for the others to finish. 
> The calculations are not dependent. I just need to display results. 
> 
> I've been reading that threading in R is not an option. I tried using the multicore package, but that is still synchronous. I looked at multicore, fork(), addTaskCallback(), and TclTk threading, and none of these seem like an option. 
> 
> Is there a way to launch multiple R scripts from controller that can communicate back and forth? I believe this means that the separate processes are able to communicate. 
> 
> I certainly appreciate any direction you can provide. I really want to find some good news to tell the boss, though, since we went down this path before realizing the limitations.

Another option to consider is moving to a client/server architecture. Even if the dashboard and the R engine are on the same machine now, in the future you might want to deploy the dashboard to the web (or other client) to make it available to a wider audience. This also might make the asynchronous communication easier to manage, and offload computations from the client machine.

There are several options out there, including:
- Rserve, open source project maintained by Simon Urbanek. http://rosuda.org/Rserve/
- Biocep-R. http://biocep-distrib.r-forge.r-project.org/. Also open source.
- Spotfire Statistics Services: commercial solution from TIBCO (my company), that providers server access to a cluster of R and S+ engines via Java and C# APIs. http://spotfire.tibco.com/products/statistics-services/predictive-analytics.aspx

Good luck,
Lou

--------------------------
Lou Bajuk-Yorgan
Sr. Director, Product Management
Spotfire, TIBCO Software
206-802-2328
lbajuk at tibco.com
http://spotfire.tibco.com

TIBCO Spotfire Analytics
Better than BI.? Smarter than Spreadsheets.
(click here for the Top 5 reasons why...)


From ggrothendieck at gmail.com  Thu Jun 17 00:56:38 2010
From: ggrothendieck at gmail.com (Gabor Grothendieck)
Date: Wed, 16 Jun 2010 18:56:38 -0400
Subject: [Rd] cut takes long time
Message-ID: <AANLkTil-9A0aiVygtypBneVPEVuABLPf4PgdW1ON80IL@mail.gmail.com>

The following cut command takes nearly 10 seconds on my machine even
though the length of input vector is only 6.  I am running on Windows
Vista with C2D BLAS using R 2.11.1.  Using the default BLAS and either
R 2.10.1 or "R version 2.12.0 Under development (unstable) (2010-05-31
r52164)" also gives me results in the 9-11 second range.
I would have expected it to take much less time.


tt <- structure(c(631206000, 631206060, 631206180, 631206240, 631206300,
978224400), class = c("POSIXt", "POSIXct"), tzone = "")

system.time(cut(tt, "2 hours", include = TRUE)) # 9.45  0.01  9.58


R.version.string # "R version 2.11.1 Patched (2010-05-31 r52167)"
win.version() #  "Windows Vista (build 6002) Service Pack 2"


From jpnolan at american.edu  Thu Jun 17 04:47:59 2010
From: jpnolan at american.edu (John Nolan)
Date: Wed, 16 Jun 2010 22:47:59 -0400
Subject: [Rd] constrOptim( ): conflict between help page and code
Message-ID: <OF083E2493.C6D8101F-ON85257745.000F613F-85257745.000F6140@american.edu>

There is a contradiction between what the help page says and what constrOptim actually
does with the constraints.  The issue is what happens on the boundary.
The help page says 
    The feasible region is defined by ?ui %*% theta - ci >= 0?,
but the R code for constrOptim reads
    if (any(ui %*% theta - ci <= 0)) 
        stop("initial value not feasible")
The following example shows that when the initial point is on the boundary of the
feasibility region, you get the above error message and execution stops.  

> fn <- function(x) { return(sum(x)) }
> 
> ui <- diag(rep(1,2))
> ci <- matrix(0,nrow=2,ncol=1)
> constrOptim( c(0,0), fn, NULL, ui, ci )
Error in optim(theta.old, fun, gradient, control = control, method = method,  : 
  function cannot be evaluated at initial parameters
> 
> version                           
platform       i386-pc-mingw32              
arch           i386                         
os             mingw32                      
system         i386, mingw32                
status                                      
major          2                            
minor          10.0                         
year           2009                         
month          10                           
day            26                           
svn rev        50208                        
language       R                            
version.string R version 2.10.0 (2009-10-26)

In contrast, at a different place in constrOptim - the internal function R -
the boundary of the feasibility region is allowed:  if (any(gi < 0)) return(NaN),
and it seems to explicitly allow boundaries at another place: 
allowing gi==0 and interpreting log(gi) as -Inf. 


John 

 ...........................................................................

 John P. Nolan
 Math/Stat Department
 227 Gray Hall
 American University
 4400 Massachusetts Avenue, NW
 Washington, DC 20016-8050

 jpnolan at american.edu
 202.885.3140 voice
 202.885.3155 fax
 http://academic2.american.edu/~jpnolan
 ...........................................................................

From deepayan.sarkar at gmail.com  Thu Jun 17 07:50:02 2010
From: deepayan.sarkar at gmail.com (Deepayan Sarkar)
Date: Wed, 16 Jun 2010 22:50:02 -0700
Subject: [Rd] cut takes long time
In-Reply-To: <AANLkTil-9A0aiVygtypBneVPEVuABLPf4PgdW1ON80IL@mail.gmail.com>
References: <AANLkTil-9A0aiVygtypBneVPEVuABLPf4PgdW1ON80IL@mail.gmail.com>
Message-ID: <AANLkTila2OTFB9g4E0i5VAEQXhOlsyUK2ppkfvcE8pFD@mail.gmail.com>

On Wed, Jun 16, 2010 at 3:56 PM, Gabor Grothendieck
<ggrothendieck at gmail.com> wrote:
> The following cut command takes nearly 10 seconds on my machine even
> though the length of input vector is only 6. ?I am running on Windows
> Vista with C2D BLAS using R 2.11.1. ?Using the default BLAS and either
> R 2.10.1 or "R version 2.12.0 Under development (unstable) (2010-05-31
> r52164)" also gives me results in the 9-11 second range.
> I would have expected it to take much less time.
>
>
> tt <- structure(c(631206000, 631206060, 631206180, 631206240, 631206300,
> 978224400), class = c("POSIXt", "POSIXct"), tzone = "")
>
> system.time(cut(tt, "2 hours", include = TRUE)) # 9.45 ?0.01 ?9.58

The POSIXt aspect is not relevant to this, it's the number of breakpoints.

> system.time(cut(tt, "2 hours", include = TRUE))
   user  system elapsed
  5.884   0.108   6.033
> system.time(cut(rnorm(6), breaks = 50000))
   user  system elapsed
  5.200   0.000   5.558

And the time seems linear in the number of breakpoints, which is not
surprising. The "Note" section in ?cut does mention more efficient
alternatives.

Note that

> system.time(cut(tt, "2 hours", include = TRUE, labels = FALSE))
   user  system elapsed
   0.02    0.00    0.02

so it's the conversion to factors that seems to take most of the time.

-Deepayan


From Thorn.Thaler at rdls.nestle.com  Thu Jun 17 09:19:07 2010
From: Thorn.Thaler at rdls.nestle.com (Thaler, Thorn, LAUSANNE,
	Applied Mathematics)
Date: Thu, 17 Jun 2010 09:19:07 +0200
Subject: [Rd] CHM help does not find help docs in package stats
In-Reply-To: <4C13B3DB.7010908@statistik.tu-dortmund.de>
References: <F54EF8F1B477CF448729593FE421F646360469@HQVEVE0032.nestle.com>
	<4C13B3DB.7010908@statistik.tu-dortmund.de>
Message-ID: <F54EF8F1B477CF448729593FE421F646360CA2@HQVEVE0032.nestle.com>

Indeed, the R version is 2.9.2. But the package was built on the very
same system. Besides, another package built with the same version of R
but on another machine does not show this nasty behavior. Upgrading,
however, could pose more problems as it solves, since even if I could
upgrade locally, it would be a mess to assure that all colleagues
upgrade as well. 

Anyways, even if the chm format is not supported any more by current
versions of R, it should work with older ones, right? So, what can I do
additionally to get to the bottom of this problem?

Thanks + BR,

Thorn 

-----Original Message-----
From: Uwe Ligges [mailto:ligges at statistik.tu-dortmund.de] 
Sent: samedi 12 juin 2010 18:21
To: Thaler,Thorn,LAUSANNE,Applied Mathematics
Cc: r-devel at r-project.org
Subject: Re: [Rd] CHM help does not find help docs in package stats

Which version of R is this?
CHM help is R < 2.10.0. All versions thereafter do not support compiled 
html help anymore.

Please upgrade your version of R and try one of the currently supported 
help formats.

Best wishes,
Uwe Ligges



On 11.06.2010 12:06, Thaler, Thorn, LAUSANNE, Applied Mathematics wrote:
> Hi all,
>
> currently I'm working on an R package bundling some frequently used
> functions. When I load my package and type
>
> ?one_of_my_functions
>
> I get the particular help file. If I try to get help on another
> function, which is part of package stats (prcomp say), I get "This
> program cannot display the webpage". A help on ?mean does, however,
work
> as it opens a new window showing the help on mean.
>
> There is another peculiarity, if it happens that I requested a help
file
> for a function in the package stats before I used the help on one of
my
> functions, everything works out fine.
>
> Does anybody know how I can get rid of this annoying behavior? It has
to
> have something to do with my particular package, since everything
works
> as expected with another package of mine.
>
> I override one of the functions of stats (biplot.default), which is,
> however, not exported and resides within my namespace. Could that be
the
> reason?
>
> Any help highly appreciated. Thanks + BR,
>
> Thorn
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From murdoch.duncan at gmail.com  Thu Jun 17 10:37:33 2010
From: murdoch.duncan at gmail.com (Duncan Murdoch)
Date: Thu, 17 Jun 2010 04:37:33 -0400
Subject: [Rd] constrOptim( ): conflict between help page and code
In-Reply-To: <OF083E2493.C6D8101F-ON85257745.000F613F-85257745.000F6140@american.edu>
References: <OF083E2493.C6D8101F-ON85257745.000F613F-85257745.000F6140@american.edu>
Message-ID: <4C19DECD.1000706@gmail.com>

John Nolan wrote:
> There is a contradiction between what the help page says and what constrOptim actually
> does with the constraints.  The issue is what happens on the boundary.
>   

I don't know if this was a recent change, but the current help says:

"The starting value must be in the interior of the feasible region, but 
the minimum may be on the boundary."

The boundary is not in the interior.

Duncan Murdoch
> The help page says 
>     The feasible region is defined by ?ui %*% theta - ci >= 0?,
> but the R code for constrOptim reads
>     if (any(ui %*% theta - ci <= 0)) 
>         stop("initial value not feasible")
> The following example shows that when the initial point is on the boundary of the
> feasibility region, you get the above error message and execution stops.  
>
>   
>> fn <- function(x) { return(sum(x)) }
>>
>> ui <- diag(rep(1,2))
>> ci <- matrix(0,nrow=2,ncol=1)
>> constrOptim( c(0,0), fn, NULL, ui, ci )
>>     
> Error in optim(theta.old, fun, gradient, control = control, method = method,  : 
>   function cannot be evaluated at initial parameters
>   
>> version                           
>>     
> platform       i386-pc-mingw32              
> arch           i386                         
> os             mingw32                      
> system         i386, mingw32                
> status                                      
> major          2                            
> minor          10.0                         
> year           2009                         
> month          10                           
> day            26                           
> svn rev        50208                        
> language       R                            
> version.string R version 2.10.0 (2009-10-26)
>
> In contrast, at a different place in constrOptim - the internal function R -
> the boundary of the feasibility region is allowed:  if (any(gi < 0)) return(NaN),
> and it seems to explicitly allow boundaries at another place: 
> allowing gi==0 and interpreting log(gi) as -Inf. 
>
>
> John 
>
>  ...........................................................................
>
>  John P. Nolan
>  Math/Stat Department
>  227 Gray Hall
>  American University
>  4400 Massachusetts Avenue, NW
>  Washington, DC 20016-8050
>
>  jpnolan at american.edu
>  202.885.3140 voice
>  202.885.3155 fax
>  http://academic2.american.edu/~jpnolan
>  ...........................................................................
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From pburns at pburns.seanet.com  Thu Jun 17 11:22:57 2010
From: pburns at pburns.seanet.com (Patrick Burns)
Date: Thu, 17 Jun 2010 10:22:57 +0100
Subject: [Rd] Package development process?
In-Reply-To: <AANLkTimtGcfzKshfvQsRBNGAqfxfiZkrabf0loOVtc1V@mail.gmail.com>
References: <4C182C9E.2080604@structuremonitoring.com>	<AANLkTinvljHoZC-XA5UgJkMoSmft9z9SjsUPwt_9W2F6@mail.gmail.com>
	<4C18E297.7020805@structuremonitoring.com>
	<AANLkTimtGcfzKshfvQsRBNGAqfxfiZkrabf0loOVtc1V@mail.gmail.com>
Message-ID: <4C19E971.7000807@pburns.seanet.com>

I agree with Hadley, and add that trying
to have an example be both an example and
a test may not be good for the example
aspect either.

Examples should make people who are ignorant
of the function twig as to how the function
works.  Creating good examples is hard.

Problems that really test the software are
unlikely to serve as a good example.  Good
examples are unlikely to seriously test the
code.  (But you do want the examples to run,
it is seriously bad advertising when they
don't.)

Pat


On 16/06/2010 15:53, Hadley Wickham wrote:
>>       What about the encouragement to add unit tests, if only disguised as
>> examples?
>
> Examples are not unit tests. Examples are a convenient way of testing
> some aspects of the package, but serve a rather different purpose to
> tests. The R community does not emphase testing nearly as much as
> other communities.  For example,  Ruby has a very strong testing
> culture including at least 10 different unit testing frameworks.
>
>>       I've found the unit tests to be a powerful tool to help improve and
>> maintain the quality of packages to which I contribute.  To this end, Sundar
>> and I added a column "Autochecks" to the table of "Selected Repositories" in
>> the Wikipedia article on "Software repository"
>> (http://en.wikipedia.org/wiki/Software_repository), and we describe it
>> briefly in the text introducing that table.
>
> Unfortunately your description highlights a inadequacy of R and poor
> software development procedures on the part of many R package
> developers (including me!). For exactly the reason you discuss, it's
> never a good idea for your package to depend on the most current
> version of another package.  If you do, changes to that package might
> break yours.  Most other package management systems allow you to
> specify the version of a dependency so that this doesn't happen.  You
> can do this with R, but because it's hard to have multiple versions of
> the same package installed at the same time, it's not as useful.
>
> Hadley
>

-- 
Patrick Burns
pburns at pburns.seanet.com
http://www.burns-stat.com
(home of 'Some hints for the R beginner'
and 'The R Inferno')


From djsamperi at gmail.com  Thu Jun 17 13:45:57 2010
From: djsamperi at gmail.com (Dominick Samperi)
Date: Thu, 17 Jun 2010 07:45:57 -0400
Subject: [Rd] Package development process?
In-Reply-To: <4C19E971.7000807@pburns.seanet.com>
References: <4C182C9E.2080604@structuremonitoring.com>
	<AANLkTinvljHoZC-XA5UgJkMoSmft9z9SjsUPwt_9W2F6@mail.gmail.com>
	<4C18E297.7020805@structuremonitoring.com>
	<AANLkTimtGcfzKshfvQsRBNGAqfxfiZkrabf0loOVtc1V@mail.gmail.com>
	<4C19E971.7000807@pburns.seanet.com>
Message-ID: <AANLkTimzwzW_k58juurZ11GszYxsnV_fW32prr9K4oHa@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20100617/b6294c77/attachment.pl>

From david.kirkby at onetel.net  Thu Jun 17 13:53:52 2010
From: david.kirkby at onetel.net (Dr. David Kirkby)
Date: Thu, 17 Jun 2010 12:53:52 +0100
Subject: [Rd] Corrections for the R manual on Solaris
Message-ID: <4C1A0CD0.8010905@onetel.net>

There are a few errors in the R manual about Solaris.

1) Firstly you may know that Sun is now owned by Oracle.

2) "(Recent Sun machines are Opterons (?amd64?) rather than ?x86?, but 32-bit 
?x86? executables are the default.) "

It's not true to say that recent machines are Opterons rather than x86.

Many new Sun machines are based on 64-bit Intel CPUs (often called x64). The 
machine I'm using, a Sun Ultra 27

http://www.sun.com/desktop/workstation/ultra27/index.xml

is less than 6 months old and has a quad core 3.33 GHz Intel Xeon in it.

It is certainly true that some recent machine are Opterons.

Note, 64-bit libraries for 64-bit systems, even those based on Intel CPUs, go in 
/usr/lib/amd64. Likewise many open-source software will install the 64-bit 
libraries in /usr/local/lib/amd64. There's no "intel64" or anything like that.

3) "Modern Solaris systems allow a large selection of Open Source software to be 
installed from http://www.opencsw.org (formerly http://www.blastwave.org) via 
pkg-get, "

It should be noted that OpenCSW and Blastwave are both still in existence. 
There's a lot of animosity between the two camps, but both do exist. So one is 
not formally the other.

Unfortunately, they both install software in /opt/csw, so I would be very weary 
of using both sites, as there is no coordination between them.


Dave


From hadley at rice.edu  Thu Jun 17 15:23:23 2010
From: hadley at rice.edu (Hadley Wickham)
Date: Thu, 17 Jun 2010 06:23:23 -0700
Subject: [Rd] Package development process?
In-Reply-To: <AANLkTimzwzW_k58juurZ11GszYxsnV_fW32prr9K4oHa@mail.gmail.com>
References: <4C182C9E.2080604@structuremonitoring.com>
	<AANLkTinvljHoZC-XA5UgJkMoSmft9z9SjsUPwt_9W2F6@mail.gmail.com> 
	<4C18E297.7020805@structuremonitoring.com>
	<AANLkTimtGcfzKshfvQsRBNGAqfxfiZkrabf0loOVtc1V@mail.gmail.com> 
	<4C19E971.7000807@pburns.seanet.com>
	<AANLkTimzwzW_k58juurZ11GszYxsnV_fW32prr9K4oHa@mail.gmail.com>
Message-ID: <AANLkTinkQrmlJrKAsmX9UFmSFPZtOZHi7V_eFKMautge@mail.gmail.com>

> The creation of a research compendium can be viewed as
> a form of unit testing, and the fact that R has powerful tools
> that support this process (Sweave) could be viewed as one of
> its outstanding features (relating these comments back to
> the topic of this thread).

If anything, a research compendium would be an integration test, not a
compendium.  And many programming languages have something similar to
sweave.

Hadley

-- 
Assistant Professor / Dobelman Family Junior Chair
Department of Statistics / Rice University
http://had.co.nz/


From rvaradhan at jhmi.edu  Thu Jun 17 15:52:31 2010
From: rvaradhan at jhmi.edu (Ravi Varadhan)
Date: Thu, 17 Jun 2010 09:52:31 -0400
Subject: [Rd] constrOptim( ): conflict between help page and code
In-Reply-To: <4C19DECD.1000706@gmail.com>
References: <OF083E2493.C6D8101F-ON85257745.000F613F-85257745.000F6140@american.edu>
	<4C19DECD.1000706@gmail.com>
Message-ID: <001101cb0e24$54e50da0$feaf28e0$@edu>

Nolan,

You are correct that there is inconsistency.  The feasible region should be ui %*% theta - ci > 0, so that log(ui %*% theta - ci) is defined.

There is a more serious problem in termination criterion for iterations:

        if (is.finite(r) && is.finite(r.old) && abs(r - r.old)/(outer.eps + 
            abs(r - r.old)) < outer.eps) 
            break

Ideally convergence is achieved when |r - r.old| is small.  But according to the above code, the logical condition inside the if(.) will be TRUE only when abs(r - r.old) < (outer.eps)^2 (for small outer.eps).  For example, let |r - r.old| = outer.eps.  The above condition becomes:  if (0.5 < outer.eps) break, which will obviously never happen for values of outer.eps < 1/2.  Now, if outer.eps = 1.e-05 (default) and we let |r - r.old| <= 1.e-10, then the above condition will be satisfied.

In short, the termination criterion used is too stringent.  Better termination criteria are:

	if (is.finite(r) && is.finite(r.old) && abs(r - r.old) < outer.eps) break        

or 

	if (is.finite(r) && is.finite(r.old) && abs(r - r.old)/(1 + abs(r + r.old)/2) < outer.eps) break

Best,
Ravi.

-----Original Message-----
From: r-devel-bounces at r-project.org [mailto:r-devel-bounces at r-project.org] On Behalf Of Duncan Murdoch
Sent: Thursday, June 17, 2010 4:38 AM
To: John Nolan
Cc: r-devel at r-project.org
Subject: Re: [Rd] constrOptim( ): conflict between help page and code

John Nolan wrote:
> There is a contradiction between what the help page says and what constrOptim actually
> does with the constraints.  The issue is what happens on the boundary.
>   

I don't know if this was a recent change, but the current help says:

"The starting value must be in the interior of the feasible region, but 
the minimum may be on the boundary."

The boundary is not in the interior.

Duncan Murdoch
> The help page says 
>     The feasible region is defined by ?ui %*% theta - ci >= 0?,
> but the R code for constrOptim reads
>     if (any(ui %*% theta - ci <= 0)) 
>         stop("initial value not feasible")
> The following example shows that when the initial point is on the boundary of the
> feasibility region, you get the above error message and execution stops.  
>
>   
>> fn <- function(x) { return(sum(x)) }
>>
>> ui <- diag(rep(1,2))
>> ci <- matrix(0,nrow=2,ncol=1)
>> constrOptim( c(0,0), fn, NULL, ui, ci )
>>     
> Error in optim(theta.old, fun, gradient, control = control, method = method,  : 
>   function cannot be evaluated at initial parameters
>   
>> version                           
>>     
> platform       i386-pc-mingw32              
> arch           i386                         
> os             mingw32                      
> system         i386, mingw32                
> status                                      
> major          2                            
> minor          10.0                         
> year           2009                         
> month          10                           
> day            26                           
> svn rev        50208                        
> language       R                            
> version.string R version 2.10.0 (2009-10-26)
>
> In contrast, at a different place in constrOptim - the internal function R -
> the boundary of the feasibility region is allowed:  if (any(gi < 0)) return(NaN),
> and it seems to explicitly allow boundaries at another place: 
> allowing gi==0 and interpreting log(gi) as -Inf. 
>
>
> John 
>
>  ...........................................................................
>
>  John P. Nolan
>  Math/Stat Department
>  227 Gray Hall
>  American University
>  4400 Massachusetts Avenue, NW
>  Washington, DC 20016-8050
>
>  jpnolan at american.edu
>  202.885.3140 voice
>  202.885.3155 fax
>  http://academic2.american.edu/~jpnolan
>  ...........................................................................
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

______________________________________________
R-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-devel


From rvaradhan at jhmi.edu  Thu Jun 17 16:54:56 2010
From: rvaradhan at jhmi.edu (Ravi Varadhan)
Date: Thu, 17 Jun 2010 10:54:56 -0400
Subject: [Rd] constrOptim( ): conflict between help page and code
In-Reply-To: <001101cb0e24$54e50da0$feaf28e0$@edu>
References: <OF083E2493.C6D8101F-ON85257745.000F613F-85257745.000F6140@american.edu>
	<4C19DECD.1000706@gmail.com> <001101cb0e24$54e50da0$feaf28e0$@edu>
Message-ID: <003801cb0e2d$0d27f230$2777d690$@edu>

In `constrOptim', there is also a mistake in the reporting of function and gradient counts.  These counts, as reported, correspond to that of the vary last "inner" iteration.  However, they should be cumulatively summed up over each outer iteration.

I have fixed this and the convergence criterion issue that I mentioned before.  

Currently, constrOptim can only use the Nelder-Mead when the analytic gradient is not specified.  I have added a numerical gradient option so that it can use BFGS or other optimization functions even when the analytic gradient is not specified.

It would be desirable if Tom Lumley can commit these changes to constrOptim.  In the meanwhile, I can send the function with these upgrades to anyone who is interested.

Best,
Ravi.

-----Original Message-----
From: r-devel-bounces at r-project.org [mailto:r-devel-bounces at r-project.org] On Behalf Of Ravi Varadhan
Sent: Thursday, June 17, 2010 9:53 AM
To: 'Duncan Murdoch'; 'John Nolan'
Cc: r-devel at r-project.org
Subject: Re: [Rd] constrOptim( ): conflict between help page and code

Nolan,

You are correct that there is inconsistency.  The feasible region should be ui %*% theta - ci > 0, so that log(ui %*% theta - ci) is defined.

There is a more serious problem in termination criterion for iterations:

        if (is.finite(r) && is.finite(r.old) && abs(r - r.old)/(outer.eps + 
            abs(r - r.old)) < outer.eps) 
            break

Ideally convergence is achieved when |r - r.old| is small.  But according to the above code, the logical condition inside the if(.) will be TRUE only when abs(r - r.old) < (outer.eps)^2 (for small outer.eps).  For example, let |r - r.old| = outer.eps.  The above condition becomes:  if (0.5 < outer.eps) break, which will obviously never happen for values of outer.eps < 1/2.  Now, if outer.eps = 1.e-05 (default) and we let |r - r.old| <= 1.e-10, then the above condition will be satisfied.

In short, the termination criterion used is too stringent.  Better termination criteria are:

	if (is.finite(r) && is.finite(r.old) && abs(r - r.old) < outer.eps) break        

or 

	if (is.finite(r) && is.finite(r.old) && abs(r - r.old)/(1 + abs(r + r.old)/2) < outer.eps) break

Best,
Ravi.

-----Original Message-----
From: r-devel-bounces at r-project.org [mailto:r-devel-bounces at r-project.org] On Behalf Of Duncan Murdoch
Sent: Thursday, June 17, 2010 4:38 AM
To: John Nolan
Cc: r-devel at r-project.org
Subject: Re: [Rd] constrOptim( ): conflict between help page and code

John Nolan wrote:
> There is a contradiction between what the help page says and what constrOptim actually
> does with the constraints.  The issue is what happens on the boundary.
>   

I don't know if this was a recent change, but the current help says:

"The starting value must be in the interior of the feasible region, but 
the minimum may be on the boundary."

The boundary is not in the interior.

Duncan Murdoch
> The help page says 
>     The feasible region is defined by ?ui %*% theta - ci >= 0?,
> but the R code for constrOptim reads
>     if (any(ui %*% theta - ci <= 0)) 
>         stop("initial value not feasible")
> The following example shows that when the initial point is on the boundary of the
> feasibility region, you get the above error message and execution stops.  
>
>   
>> fn <- function(x) { return(sum(x)) }
>>
>> ui <- diag(rep(1,2))
>> ci <- matrix(0,nrow=2,ncol=1)
>> constrOptim( c(0,0), fn, NULL, ui, ci )
>>     
> Error in optim(theta.old, fun, gradient, control = control, method = method,  : 
>   function cannot be evaluated at initial parameters
>   
>> version                           
>>     
> platform       i386-pc-mingw32              
> arch           i386                         
> os             mingw32                      
> system         i386, mingw32                
> status                                      
> major          2                            
> minor          10.0                         
> year           2009                         
> month          10                           
> day            26                           
> svn rev        50208                        
> language       R                            
> version.string R version 2.10.0 (2009-10-26)
>
> In contrast, at a different place in constrOptim - the internal function R -
> the boundary of the feasibility region is allowed:  if (any(gi < 0)) return(NaN),
> and it seems to explicitly allow boundaries at another place: 
> allowing gi==0 and interpreting log(gi) as -Inf. 
>
>
> John 
>
>  ...........................................................................
>
>  John P. Nolan
>  Math/Stat Department
>  227 Gray Hall
>  American University
>  4400 Massachusetts Avenue, NW
>  Washington, DC 20016-8050
>
>  jpnolan at american.edu
>  202.885.3140 voice
>  202.885.3155 fax
>  http://academic2.american.edu/~jpnolan
>  ...........................................................................
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

______________________________________________
R-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-devel

______________________________________________
R-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-devel


From djsamperi at gmail.com  Thu Jun 17 17:51:32 2010
From: djsamperi at gmail.com (Dominick Samperi)
Date: Thu, 17 Jun 2010 11:51:32 -0400
Subject: [Rd] Package development process?
In-Reply-To: <AANLkTinkQrmlJrKAsmX9UFmSFPZtOZHi7V_eFKMautge@mail.gmail.com>
References: <4C182C9E.2080604@structuremonitoring.com>
	<AANLkTinvljHoZC-XA5UgJkMoSmft9z9SjsUPwt_9W2F6@mail.gmail.com>
	<4C18E297.7020805@structuremonitoring.com>
	<AANLkTimtGcfzKshfvQsRBNGAqfxfiZkrabf0loOVtc1V@mail.gmail.com>
	<4C19E971.7000807@pburns.seanet.com>
	<AANLkTimzwzW_k58juurZ11GszYxsnV_fW32prr9K4oHa@mail.gmail.com>
	<AANLkTinkQrmlJrKAsmX9UFmSFPZtOZHi7V_eFKMautge@mail.gmail.com>
Message-ID: <AANLkTiln1qWxbBp1FCzEeRsiI7JVXHykFBJEcO2e0Re0@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20100617/539ecce3/attachment.pl>

From rvaradhan at jhmi.edu  Thu Jun 17 19:22:55 2010
From: rvaradhan at jhmi.edu (Ravi Varadhan)
Date: Thu, 17 Jun 2010 13:22:55 -0400
Subject: [Rd] constrOptim( ): conflict between help page and code
References: <OF083E2493.C6D8101F-ON85257745.000F613F-85257745.000F6140@american.edu>
	<4C19DECD.1000706@gmail.com> <001101cb0e24$54e50da0$feaf28e0$@edu> 
Message-ID: <005f01cb0e41$b9463400$2bd29c00$@edu>

One more bug in `constrOptim' that I have reported before and have also suggested a fix, but this has also not been corrected:

if (obj > obj.old) break

This is obviously wrong when the user is trying to maximize by specifying control$fnscale = -1.

The correct statement is the following:

if (obj > obj.old * sign(mu)) break


Ravi.

-----Original Message-----
From: Ravi Varadhan [mailto:rvaradhan at jhmi.edu] 
Sent: Thursday, June 17, 2010 10:55 AM
To: 'Ravi Varadhan'; 'Duncan Murdoch'; 'John Nolan'
Cc: 'r-devel at r-project.org'
Subject: RE: [Rd] constrOptim( ): conflict between help page and code

In `constrOptim', there is also a mistake in the reporting of function and gradient counts.  These counts, as reported, correspond to that of the vary last "inner" iteration.  However, they should be cumulatively summed up over each outer iteration.

I have fixed this and the convergence criterion issue that I mentioned before.  

Currently, constrOptim can only use the Nelder-Mead when the analytic gradient is not specified.  I have added a numerical gradient option so that it can use BFGS or other optimization functions even when the analytic gradient is not specified.

It would be desirable if Tom Lumley can commit these changes to constrOptim.  In the meanwhile, I can send the function with these upgrades to anyone who is interested.

Best,
Ravi.

-----Original Message-----
From: r-devel-bounces at r-project.org [mailto:r-devel-bounces at r-project.org] On Behalf Of Ravi Varadhan
Sent: Thursday, June 17, 2010 9:53 AM
To: 'Duncan Murdoch'; 'John Nolan'
Cc: r-devel at r-project.org
Subject: Re: [Rd] constrOptim( ): conflict between help page and code

Nolan,

You are correct that there is inconsistency.  The feasible region should be ui %*% theta - ci > 0, so that log(ui %*% theta - ci) is defined.

There is a more serious problem in termination criterion for iterations:

        if (is.finite(r) && is.finite(r.old) && abs(r - r.old)/(outer.eps + 
            abs(r - r.old)) < outer.eps) 
            break

Ideally convergence is achieved when |r - r.old| is small.  But according to the above code, the logical condition inside the if(.) will be TRUE only when abs(r - r.old) < (outer.eps)^2 (for small outer.eps).  For example, let |r - r.old| = outer.eps.  The above condition becomes:  if (0.5 < outer.eps) break, which will obviously never happen for values of outer.eps < 1/2.  Now, if outer.eps = 1.e-05 (default) and we let |r - r.old| <= 1.e-10, then the above condition will be satisfied.

In short, the termination criterion used is too stringent.  Better termination criteria are:

	if (is.finite(r) && is.finite(r.old) && abs(r - r.old) < outer.eps) break        

or 

	if (is.finite(r) && is.finite(r.old) && abs(r - r.old)/(1 + abs(r + r.old)/2) < outer.eps) break

Best,
Ravi.

-----Original Message-----
From: r-devel-bounces at r-project.org [mailto:r-devel-bounces at r-project.org] On Behalf Of Duncan Murdoch
Sent: Thursday, June 17, 2010 4:38 AM
To: John Nolan
Cc: r-devel at r-project.org
Subject: Re: [Rd] constrOptim( ): conflict between help page and code

John Nolan wrote:
> There is a contradiction between what the help page says and what constrOptim actually
> does with the constraints.  The issue is what happens on the boundary.
>   

I don't know if this was a recent change, but the current help says:

"The starting value must be in the interior of the feasible region, but 
the minimum may be on the boundary."

The boundary is not in the interior.

Duncan Murdoch
> The help page says 
>     The feasible region is defined by ?ui %*% theta - ci >= 0?,
> but the R code for constrOptim reads
>     if (any(ui %*% theta - ci <= 0)) 
>         stop("initial value not feasible")
> The following example shows that when the initial point is on the boundary of the
> feasibility region, you get the above error message and execution stops.  
>
>   
>> fn <- function(x) { return(sum(x)) }
>>
>> ui <- diag(rep(1,2))
>> ci <- matrix(0,nrow=2,ncol=1)
>> constrOptim( c(0,0), fn, NULL, ui, ci )
>>     
> Error in optim(theta.old, fun, gradient, control = control, method = method,  : 
>   function cannot be evaluated at initial parameters
>   
>> version                           
>>     
> platform       i386-pc-mingw32              
> arch           i386                         
> os             mingw32                      
> system         i386, mingw32                
> status                                      
> major          2                            
> minor          10.0                         
> year           2009                         
> month          10                           
> day            26                           
> svn rev        50208                        
> language       R                            
> version.string R version 2.10.0 (2009-10-26)
>
> In contrast, at a different place in constrOptim - the internal function R -
> the boundary of the feasibility region is allowed:  if (any(gi < 0)) return(NaN),
> and it seems to explicitly allow boundaries at another place: 
> allowing gi==0 and interpreting log(gi) as -Inf. 
>
>
> John 
>
>  ...........................................................................
>
>  John P. Nolan
>  Math/Stat Department
>  227 Gray Hall
>  American University
>  4400 Massachusetts Avenue, NW
>  Washington, DC 20016-8050
>
>  jpnolan at american.edu
>  202.885.3140 voice
>  202.885.3155 fax
>  http://academic2.american.edu/~jpnolan
>  ...........................................................................
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

______________________________________________
R-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-devel

______________________________________________
R-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-devel


From carey.vj at gmail.com  Thu Jun 17 23:01:30 2010
From: carey.vj at gmail.com (Vincenzo Carey)
Date: Thu, 17 Jun 2010 17:01:30 -0400
Subject: [Rd] Package development process?
In-Reply-To: <AANLkTimzwzW_k58juurZ11GszYxsnV_fW32prr9K4oHa@mail.gmail.com>
References: <4C182C9E.2080604@structuremonitoring.com>
	<AANLkTinvljHoZC-XA5UgJkMoSmft9z9SjsUPwt_9W2F6@mail.gmail.com>
	<4C18E297.7020805@structuremonitoring.com>
	<AANLkTimtGcfzKshfvQsRBNGAqfxfiZkrabf0loOVtc1V@mail.gmail.com>
	<4C19E971.7000807@pburns.seanet.com>
	<AANLkTimzwzW_k58juurZ11GszYxsnV_fW32prr9K4oHa@mail.gmail.com>
Message-ID: <AANLkTilEVr2gPM4gKBp5pkYDISnAI9OwvAnjar1-HYdN@mail.gmail.com>

On Thu, Jun 17, 2010 at 7:45 AM, Dominick Samperi <djsamperi at gmail.com> wrote:
>
> On Thu, Jun 17, 2010 at 5:22 AM, Patrick Burns <pburns at pburns.seanet.com>wrote:
>
> > I agree with Hadley, and add that trying
> > to have an example be both an example and
> > a test may not be good for the example
> > aspect either.
> >
> > Examples should make people who are ignorant
> > of the function twig as to how the function
> > works. ?Creating good examples is hard.
> >
> > Problems that really test the software are
> > unlikely to serve as a good example. ?Good
> > examples are unlikely to seriously test the
> > code. ?(But you do want the examples to run,
> > it is seriously bad advertising when they
> > don't.)
> >
> > Pat
>
>
> Creating good examples is hard, but so is creating a research
> compendium following the ideas of Reproducible Research of
> Donoho and others at Stanford, called Literate Statistical
> Practice in the statistical community. The tools are there in
> R for this purpose (vignettes, etc.) but they seem to be rarely
> used for this purpose.
>

"Rare" is vague.? Almost every software package in the Bioconductor
repository has a vignette; the informal advice to contributors is that
the vignette should take the reader through all the steps of a
substantively interesting analysis with motivating/explanatory prose
and executable code.? Many analysis processes rely on effective
interoperability with independently maintained packages; thus the
nightly building of all vignettes in Bioconductor serves to not only
to provide some evidence of package soundness but also some degree of
notification of decays of interoperability.? The main Bioconductor
monograph, and the case studies book are both executable documents,
written with Sweave.? I would imagine that a number of other UseR
titles were composed in this way.

A recent NSF workshop addressed frameworks for creating replayable
experiments in various fields:
https://www.protogeni.net/trac/archive10/

>
> One reason examples are hard is that they are often isolated
> from the research itself, and hard to understand out of context.
> The notion of a Research Compendium that includes this
> context might help.
>
> But this requires a fair amount of work, and I don't think it is
> currently rewarded in the publication process (Journals do not
> require it).
>
> The creation of a research compendium can be viewed as
> a form of unit testing, and the fact that R has powerful tools
> that support this process (Sweave) could be viewed as one of
> its outstanding features (relating these comments back to
> the topic of this thread).
>
> A list of references on Reproducible Research and LSP
> can be found in the package cxxPack. A template for creating
> a compendium can also be found there.
>
> Dominick
>
> ? ? ? ?[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From djsamperi at gmail.com  Thu Jun 17 23:29:34 2010
From: djsamperi at gmail.com (Dominick Samperi)
Date: Thu, 17 Jun 2010 17:29:34 -0400
Subject: [Rd] Package development process?
In-Reply-To: <AANLkTilEVr2gPM4gKBp5pkYDISnAI9OwvAnjar1-HYdN@mail.gmail.com>
References: <4C182C9E.2080604@structuremonitoring.com>
	<AANLkTinvljHoZC-XA5UgJkMoSmft9z9SjsUPwt_9W2F6@mail.gmail.com>
	<4C18E297.7020805@structuremonitoring.com>
	<AANLkTimtGcfzKshfvQsRBNGAqfxfiZkrabf0loOVtc1V@mail.gmail.com>
	<4C19E971.7000807@pburns.seanet.com>
	<AANLkTimzwzW_k58juurZ11GszYxsnV_fW32prr9K4oHa@mail.gmail.com>
	<AANLkTilEVr2gPM4gKBp5pkYDISnAI9OwvAnjar1-HYdN@mail.gmail.com>
Message-ID: <AANLkTinp1pMtk4Hcw5xS830nNUYMZIK6N_WVhwVruvaE@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20100617/33873f2a/attachment.pl>

From ripley at stats.ox.ac.uk  Fri Jun 18 17:06:20 2010
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Fri, 18 Jun 2010 16:06:20 +0100 (BST)
Subject: [Rd] [R] Use of .Fortran
In-Reply-To: <4C1B7BCB.6070605@auckland.ac.nz>
References: <4C1B7BCB.6070605@auckland.ac.nz>
Message-ID: <alpine.LFD.2.00.1006181551410.17082@gannet.stats.ox.ac.uk>

On Sat, 19 Jun 2010, David Scott wrote:

> I have no experience with incorporating Fortran code and am probably doing 
> something pretty stupid.

Surely you saw in the posting guide that R-help is not the place for 
questions about C, C++, Fortran code?  Diverting to R-devel.

> I want to use the following Fortran subroutine (not written by me) in the

Well, it is not Fortran 77 but Fortran 95, and so needs to be given a 
.f95 extension to be sure to work.

> file SSFcoef.f
>
>      subroutine SSFcoef(nmax,nu,A,nrowA,ncolA)
>      implicit double precision(a-h,o-z)
>      implicit integer (i-n)
>      integer l,i,nmax
>      double precision nu,A(0:nmax,0:nmax)
>      A(0,0) = 1D0
>      do l=1,nmax
>      	do i=1,l-1
>      		A(l,i) = (-nu+i+l-1D0)*A(l-1,i)+A(l-1,i-1)
>      	end do
>      	A(l,0) = (-nu+l-1D0)*A(l-1,0)
>      	A(l,l) = 1D0
>      end do
>      return
>      end
>
>
> I created a dll (this is windows) using R CMD SHLIB SSFcoef.f
>
> Then my R code is:
>
> ### Load the compiled shared library in.
> dyn.load("SSFcoef.dll")
>
> ### Write a function that calls the Fortran subroutine
> SSFcoef <- function(nmax, nu){
>  .Fortran("SSFcoef",
>           as.integer(nmax),
>           as.integer(nu)
>           )$A
> }

That does not match.  nrowA and ncolA are unused, so you need
SSFcoef <- function(nmax, nu){
   .Fortran("SSFcoef",
            as.integer(nmax),
            as.integer(nu),
            A = matrix(0, nmax+1, nmax+1),
            0L, 0L)$A
}


>
> SSFcoef(10,2)
>
> which when run gives
>
>> SSFcoef(10,2)
> NULL
>
> I am pretty sure the problem is that I am not dealing with the matrix A 
> properly. I also tried this on linux and got a segfault.
>
> Can anyone supply the appropriate modification to my call (and possibly to 
> the subroutine) to make this work?
>
> David Scott
>
>
> -- 
> _________________________________________________________________
> David Scott	Department of Statistics
> 		The University of Auckland, PB 92019
> 		Auckland 1142,    NEW ZEALAND
> Phone: +64 9 923 5055, or +64 9 373 7599 ext 85055
> Email:	d.scott at auckland.ac.nz,  Fax: +64 9 373 7018
>
> Director of Consulting, Department of Statistics
>
> ______________________________________________
> R-help at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From ligges at statistik.tu-dortmund.de  Fri Jun 18 19:47:54 2010
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Fri, 18 Jun 2010 19:47:54 +0200
Subject: [Rd] CHM help does not find help docs in package stats
In-Reply-To: <F54EF8F1B477CF448729593FE421F646360CA2@HQVEVE0032.nestle.com>
References: <F54EF8F1B477CF448729593FE421F646360469@HQVEVE0032.nestle.com>
	<4C13B3DB.7010908@statistik.tu-dortmund.de>
	<F54EF8F1B477CF448729593FE421F646360CA2@HQVEVE0032.nestle.com>
Message-ID: <4C1BB14A.1080206@statistik.tu-dortmund.de>



On 17.06.2010 09:19, Thaler,Thorn,LAUSANNE,Applied Mathematics wrote:
> Indeed, the R version is 2.9.2. But the package was built on the very
> same system. Besides, another package built with the same version of R
> but on another machine does not show this nasty behavior. Upgrading,
> however, could pose more problems as it solves, since even if I could
> upgrade locally, it would be a mess to assure that all colleagues
> upgrade as well.
>
> Anyways, even if the chm format is not supported any more by current
> versions of R, it should work with older ones, right? So, what can I do
> additionally to get to the bottom of this problem?



During the last years, Mircosoft "patched" parts of the chm system by 
disallowing different features by default. It may see some result of 
these patches. Anyway, hard to say what is going on without seeing your 
binary package, your system setup, the libraries where you have 
installed you package and the otehrs, knowing if these are network paths 
or local storage, .....

Uwe Ligges


> Thanks + BR,
>
> Thorn
>
> -----Original Message-----
> From: Uwe Ligges [mailto:ligges at statistik.tu-dortmund.de]
> Sent: samedi 12 juin 2010 18:21
> To: Thaler,Thorn,LAUSANNE,Applied Mathematics
> Cc: r-devel at r-project.org
> Subject: Re: [Rd] CHM help does not find help docs in package stats
>
> Which version of R is this?
> CHM help is R<  2.10.0. All versions thereafter do not support compiled
> html help anymore.
>
> Please upgrade your version of R and try one of the currently supported
> help formats.
>
> Best wishes,
> Uwe Ligges
>
>
>
> On 11.06.2010 12:06, Thaler, Thorn, LAUSANNE, Applied Mathematics wrote:
>> Hi all,
>>
>> currently I'm working on an R package bundling some frequently used
>> functions. When I load my package and type
>>
>> ?one_of_my_functions
>>
>> I get the particular help file. If I try to get help on another
>> function, which is part of package stats (prcomp say), I get "This
>> program cannot display the webpage". A help on ?mean does, however,
> work
>> as it opens a new window showing the help on mean.
>>
>> There is another peculiarity, if it happens that I requested a help
> file
>> for a function in the package stats before I used the help on one of
> my
>> functions, everything works out fine.
>>
>> Does anybody know how I can get rid of this annoying behavior? It has
> to
>> have something to do with my particular package, since everything
> works
>> as expected with another package of mine.
>>
>> I override one of the functions of stats (biplot.default), which is,
>> however, not exported and resides within my namespace. Could that be
> the
>> reason?
>>
>> Any help highly appreciated. Thanks + BR,
>>
>> Thorn
>>
>> ______________________________________________
>> R-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-devel


From mjhmeyer at googlemail.com  Fri Jun 18 19:23:34 2010
From: mjhmeyer at googlemail.com (michael meyer)
Date: Fri, 18 Jun 2010 19:23:34 +0200
Subject: [Rd] C Interface
Message-ID: <AANLkTin_JKTaf034IqatbVWsHY2usT09dy1Iwi_K8fXJ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20100618/968272f5/attachment.pl>

From romain at r-enthusiasts.com  Fri Jun 18 22:52:25 2010
From: romain at r-enthusiasts.com (Romain Francois)
Date: Fri, 18 Jun 2010 22:52:25 +0200
Subject: [Rd] nchar( NA )
Message-ID: <4C1BDC89.50003@r-enthusiasts.com>

Hello,

Is this expected ?

 > nchar( c( "", NA ) )
[1] 0 2

Should not the second one be NA ?

Romain

-- 
Romain Francois
Professional R Enthusiast
+33(0) 6 28 91 30 30
http://romainfrancois.blog.free.fr
|- http://bit.ly/98Uf7u : Rcpp 0.8.1
|- http://bit.ly/c6YnCi : graph gallery collage
`- http://bit.ly/bZ7ltC : inline 0.3.5


From sarah.goslee at gmail.com  Fri Jun 18 22:58:43 2010
From: sarah.goslee at gmail.com (Sarah Goslee)
Date: Fri, 18 Jun 2010 16:58:43 -0400
Subject: [Rd] nchar( NA )
In-Reply-To: <4C1BDC89.50003@r-enthusiasts.com>
References: <4C1BDC89.50003@r-enthusiasts.com>
Message-ID: <AANLkTimV5wJTILsifdwPUv7ROY-WY9buNLE937IuqVAa@mail.gmail.com>

Hi Romain,

Did you read the help for nchar?

Value:

     For ?nchar?, an integer vector giving the sizes of each element,
     currently always ?2? for missing values (for ?NA?).

It may be unexpected behavior, but it's *well-documented* unexpected behavior.

Sarah

On Fri, Jun 18, 2010 at 4:52 PM, Romain Francois
<romain at r-enthusiasts.com> wrote:
> Hello,
>
> Is this expected ?
>
>> nchar( c( "", NA ) )
> [1] 0 2
>
> Should not the second one be NA ?
>
> Romain
>


-- 
Sarah Goslee
http://www.functionaldiversity.org


From wwwhsd at gmail.com  Fri Jun 18 23:03:07 2010
From: wwwhsd at gmail.com (Henrique Dallazuanna)
Date: Fri, 18 Jun 2010 18:03:07 -0300
Subject: [Rd] nchar( NA )
In-Reply-To: <4C1BDC89.50003@r-enthusiasts.com>
References: <4C1BDC89.50003@r-enthusiasts.com>
Message-ID: <AANLkTiky6jPbJGnMyaU2WTsoM9zYWs4-XKfAWu-y418D@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20100618/663a8909/attachment.pl>

From romain at r-enthusiasts.com  Fri Jun 18 23:05:24 2010
From: romain at r-enthusiasts.com (Romain Francois)
Date: Fri, 18 Jun 2010 23:05:24 +0200
Subject: [Rd] nchar( NA )
In-Reply-To: <AANLkTimV5wJTILsifdwPUv7ROY-WY9buNLE937IuqVAa@mail.gmail.com>
References: <4C1BDC89.50003@r-enthusiasts.com>
	<AANLkTimV5wJTILsifdwPUv7ROY-WY9buNLE937IuqVAa@mail.gmail.com>
Message-ID: <4C1BDF94.4030808@r-enthusiasts.com>

Le 18/06/10 22:58, Sarah Goslee a ?crit :
> Hi Romain,
>
> Did you read the help for nchar?
>
> Value:
>
>       For ?nchar?, an integer vector giving the sizes of each element,
>       currently always ?2? for missing values (for ?NA?).
>
> It may be unexpected behavior, but it's *well-documented* unexpected behavior.

Oops. My scan of the help page was too quick. I did not see it.

Sorry for the noise.

> Sarah
>
> On Fri, Jun 18, 2010 at 4:52 PM, Romain Francois
> <romain at r-enthusiasts.com>  wrote:
>> Hello,
>>
>> Is this expected ?
>>
>>> nchar( c( "", NA ) )
>> [1] 0 2
>>
>> Should not the second one be NA ?
>>
>> Romain

-- 
Romain Francois
Professional R Enthusiast
+33(0) 6 28 91 30 30
http://romainfrancois.blog.free.fr
|- http://bit.ly/98Uf7u : Rcpp 0.8.1
|- http://bit.ly/c6YnCi : graph gallery collage
`- http://bit.ly/bZ7ltC : inline 0.3.5


From simon.urbanek at r-project.org  Sat Jun 19 01:01:51 2010
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Fri, 18 Jun 2010 16:01:51 -0700
Subject: [Rd] C Interface
In-Reply-To: <AANLkTin_JKTaf034IqatbVWsHY2usT09dy1Iwi_K8fXJ@mail.gmail.com>
References: <AANLkTin_JKTaf034IqatbVWsHY2usT09dy1Iwi_K8fXJ@mail.gmail.com>
Message-ID: <143E0915-7E82-44BD-BBE4-2727ADF0C8BD@r-project.org>


On Jun 18, 2010, at 10:23 AM, michael meyer <mjhmeyer at googlemail.com> wrote:

> Greetings,
> 
> I am trying to call simple C-code from R.
> I am on Windows XP with RTools installed.
> 
> The C-function is
> 
> #include <R.h>
> #include <Rinternals.h>
> #include <Rmath.h>
> #include <Rdefines.h>
> 
> // prevent name mangling
> extern "C" {
> 
> SEXP __cdecl test(SEXP s){
> 
>  SEXP result;
>  PROTECT(result = NEW_NUMERIC(1));
>  double* ptr=NUMERIC_POINTER(result);
>  double t = *REAL(s);
>  double u = t-floor(t)-0.5;
>  if(u>0) *ptr=-1+4*u; else *ptr=-1-4*u;
>  Rprintf("The value is %f", *ptr);
>  UNPROTECT(1);
>  return result;
> }
> 
> };
> 
> It is compiled with
> 
> R CMD SHLIB OrthoFunctions.c
> 
> with flag
> 
> MAKEFLAGS="CC=g++"
> 

That is entirely wrong - g++ is not a C compiler.

Cheers,
Simon


> 
> However when I call this code from R with
> 
> test <- function(t){
>  .Call("test",t)
> }
> dyn.load("./OrthoFunctions.dll")
> test(0)
> dyn.unload("./OrthoFunctions.dll")
> 
> then R crashes.
> 
> If I compile with the default flags (no extern "C", no __cdecl) I get an
> error message about an undefined reference to "__gxx_personality_v0":
> 
> C:\...>R CMD SHLIB OrthoFunctions.c
> C:/Programme/R/R-2.10.1/etc/Makeconf:151: warning: overriding commands for
> target `.c.o'
> C:/Programme/R/R-2.10.1/etc/Makeconf:142: warning: ignoring old commands for
> target `.c.o'
> C:/Programme/R/R-2.10.1/etc/Makeconf:159: warning: overriding commands for
> target `.c.d'
> C:/Programme/R/R-2.10.1/etc/Makeconf:144: warning: ignoring old commands for
> target `.c.d'
> C:/Programme/R/R-2.10.1/etc/Makeconf:169: warning: overriding commands for
> target `.m.o'
> C:/Programme/R/R-2.10.1/etc/Makeconf:162: warning: ignoring old commands for
> target `.m.o'
> g++ -I"C:/Programme/R/R-2.10.1/include"        -O2 -Wall  -c
> OrthoFunctions.c -o OrthoFunctions.o
> gcc -shared -s -o OrthoFunctions.dll tmp.def OrthoFunctions.o
> -LC:/Programme/R/R-2.10.1/bin -lR
> OrthoFunctions.o:OrthoFunctions.c:(.eh_frame+0x11): undefined reference to
> `__gxx_personality_v0'
> collect2: ld returned 1 exit status
> 
> 
> 
> I have a vague idea of the issue of calling conventions and was hoping that
> the __cdecl
> specifier would force the appropriate convention.
> I also have Cygwin installed as part of the Python(x,y) distribution but I
> am assuming that
> R CMD SHLIB source.c
> calls the right compiler.
> 
> What could the problem be?
> 
> Many thanks,
> 
> 
> Michael
> 
>    [[alternative HTML version deleted]]
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 
> 


From hadley at rice.edu  Sat Jun 19 03:56:00 2010
From: hadley at rice.edu (Hadley Wickham)
Date: Fri, 18 Jun 2010 18:56:00 -0700
Subject: [Rd] nchar( NA )
In-Reply-To: <AANLkTimV5wJTILsifdwPUv7ROY-WY9buNLE937IuqVAa@mail.gmail.com>
References: <4C1BDC89.50003@r-enthusiasts.com>
	<AANLkTimV5wJTILsifdwPUv7ROY-WY9buNLE937IuqVAa@mail.gmail.com>
Message-ID: <AANLkTinB_ze518SW92t8xA8hnRbB32pixi5PrdbxeyRv@mail.gmail.com>

> Value:
>
> ? ? For ?nchar?, an integer vector giving the sizes of each element,
> ? ? currently always ?2? for missing values (for ?NA?).
>
> It may be unexpected behavior, but it's *well-documented* unexpected behavior.

Oh, that must make it ok then.

For a more sensible take:

> library(stringr)
> str_length(c("", NA))
[1]  0 NA


Hadley


-- 
Assistant Professor / Dobelman Family Junior Chair
Department of Statistics / Rice University
http://had.co.nz/


From edd at debian.org  Sat Jun 19 04:37:47 2010
From: edd at debian.org (Dirk Eddelbuettel)
Date: Fri, 18 Jun 2010 21:37:47 -0500
Subject: [Rd] C Interface
In-Reply-To: <AANLkTin_JKTaf034IqatbVWsHY2usT09dy1Iwi_K8fXJ@mail.gmail.com>
References: <AANLkTin_JKTaf034IqatbVWsHY2usT09dy1Iwi_K8fXJ@mail.gmail.com>
Message-ID: <19484.11643.837375.159299@ron.nulle.part>


Michael,

You are getting confused in compiler minutia when you could be concentrating
on your code.  The inline package can help here.  

Consider the snippet below which loads inline, defines your function body
sans headers etc and then uses the magic of inline to compile, link and load
your function:

-----------------------------------------------
library(inline)

code <- '
  SEXP result;
  PROTECT(result = NEW_NUMERIC(1));
  double* ptr=NUMERIC_POINTER(result);
  double t = *REAL(s);
  double u = t-floor(t)-0.5;
  if(u>0) *ptr=-1+4*u; else *ptr=-1-4*u;
  Rprintf("The value is %f\\n", *ptr);
  UNPROTECT(1);
  return result;
'

fun <- cfunction(signature(s="numeric"), code)

fun(0.0001)
-----------------------------------------------

Pasted in my R session I get:

> library(inline)
> 
> code <- '
+   SEXP result;
+   PROTECT(result = NEW_NUMERIC(1));
+   double* ptr=NUMERIC_POINTER(result);
+   double t = *REAL(s);
+   double u = t-floor(t)-0.5;
+   if(u>0) *ptr=-1+4*u; else *ptr=-1-4*u;
+   Rprintf("The value is %f\\n", *ptr);
+   UNPROTECT(1);
+   return result;
+ '
> 
> fun <- cfunction(signature(s="numeric"), code)
> 
> fun(0.0001)
The value is 0.999600
[1] 0.9996
> 

(I added a newline which, given that the code is character string, needed to
be escaped.)

If you like inline, you may like it even more in conjunction with Rcpp as the
program becomes shorter and simpler thanks to as<>() and wrap():

> code <- '
+   double t = as<double>(s);
+   double u = t-floor(t)-0.5;
+   if (u>0) t=-1+4*u; else t=-1-4*u;
+   std::cout << "The value is " << t << std::endl;
+   return wrap(t);
+ '
> fun <- cxxfunction(signature(s="numeric"), code, plugin="Rcpp")
> 
> fun(0.0001)
The value is 0.9996
[1] 0.9996
> 

Rcpp has a few vignettes that help getting started.  The rcpp-devel list can
help with questions.

-- 
  Regards, Dirk


From daniel.cegielka at gmail.com  Sat Jun 19 12:06:15 2010
From: daniel.cegielka at gmail.com (=?ISO-8859-2?Q?Daniel_Cegie=B3ka?=)
Date: Sat, 19 Jun 2010 12:06:15 +0200
Subject: [Rd] C Interface
In-Reply-To: <AANLkTin_JKTaf034IqatbVWsHY2usT09dy1Iwi_K8fXJ@mail.gmail.com>
References: <AANLkTin_JKTaf034IqatbVWsHY2usT09dy1Iwi_K8fXJ@mail.gmail.com>
Message-ID: <AANLkTimzsxOYtFp5rrahn6rgxPDXaB7D_VTihvkkfAzJ@mail.gmail.com>

I'm not a windows expert. You have C code file (not cc or cpp):

> R CMD SHLIB OrthoFunctions.c

and you use g++ compiler... ok, we can use c++ compiler for c.. but
it's looks like c++ code with c code inside:

> extern "C" {

Try it without  "extern "C" and with gcc compiler instead g++.

regards,
daniel



2010/6/18 michael meyer <mjhmeyer at googlemail.com>:
> Greetings,
>
> I am trying to call simple C-code from R.
> I am on Windows XP with RTools installed.
>
> The C-function is
>
> #include <R.h>
> #include <Rinternals.h>
> #include <Rmath.h>
> #include <Rdefines.h>
>
> // prevent name mangling
> extern "C" {
>
> SEXP __cdecl test(SEXP s){
>
> ?SEXP result;
> ?PROTECT(result = NEW_NUMERIC(1));
> ?double* ptr=NUMERIC_POINTER(result);
> ?double t = *REAL(s);
> ?double u = t-floor(t)-0.5;
> ?if(u>0) *ptr=-1+4*u; else *ptr=-1-4*u;
> ?Rprintf("The value is %f", *ptr);
> ?UNPROTECT(1);
> ?return result;
> }
>
> };
>
> It is compiled with
>
> R CMD SHLIB OrthoFunctions.c
>
> with flag
>
> MAKEFLAGS="CC=g++"
>
>
> However when I call this code from R with
>
> test <- function(t){
> ?.Call("test",t)
> }
> dyn.load("./OrthoFunctions.dll")
> test(0)
> dyn.unload("./OrthoFunctions.dll")
>
> then R crashes.
>
> If I compile with the default flags (no extern "C", no __cdecl) I get an
> error message about an undefined reference to "__gxx_personality_v0":
>
> C:\...>R CMD SHLIB OrthoFunctions.c
> C:/Programme/R/R-2.10.1/etc/Makeconf:151: warning: overriding commands for
> target `.c.o'
> C:/Programme/R/R-2.10.1/etc/Makeconf:142: warning: ignoring old commands for
> target `.c.o'
> C:/Programme/R/R-2.10.1/etc/Makeconf:159: warning: overriding commands for
> target `.c.d'
> C:/Programme/R/R-2.10.1/etc/Makeconf:144: warning: ignoring old commands for
> target `.c.d'
> C:/Programme/R/R-2.10.1/etc/Makeconf:169: warning: overriding commands for
> target `.m.o'
> C:/Programme/R/R-2.10.1/etc/Makeconf:162: warning: ignoring old commands for
> target `.m.o'
> g++ -I"C:/Programme/R/R-2.10.1/include" ? ? ? ?-O2 -Wall ?-c
> OrthoFunctions.c -o OrthoFunctions.o
> gcc -shared -s -o OrthoFunctions.dll tmp.def OrthoFunctions.o
> -LC:/Programme/R/R-2.10.1/bin -lR
> OrthoFunctions.o:OrthoFunctions.c:(.eh_frame+0x11): undefined reference to
> `__gxx_personality_v0'
> collect2: ld returned 1 exit status
>
>
>
> I have a vague idea of the issue of calling conventions and was hoping that
> the __cdecl
> specifier would force the appropriate convention.
> I also have Cygwin installed as part of the Python(x,y) distribution but I
> am assuming that
> R CMD SHLIB source.c
> calls the right compiler.
>
> What could the problem be?
>
> Many thanks,
>
>
> Michael
>
> ? ? ? ?[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From chuck at sharpsteen.net  Sat Jun 19 18:47:50 2010
From: chuck at sharpsteen.net (Sharpie)
Date: Sat, 19 Jun 2010 09:47:50 -0700 (PDT)
Subject: [Rd] [R] Use of .Fortran
In-Reply-To: <alpine.LFD.2.00.1006181551410.17082@gannet.stats.ox.ac.uk>
References: <alpine.LFD.2.00.1006181551410.17082@gannet.stats.ox.ac.uk>
Message-ID: <1276966070866-2261266.post@n4.nabble.com>



Prof Brian Ripley wrote:
> 
> Well, it is not Fortran 77 but Fortran 95, and so needs to be given a 
> .f95 extension to be sure to work.
> 

I think most compilers only distinguish two fortran file extensions: .f or
.f90.  .f denotes fixed-form source code while .f90 denotes free-form.  Some
compilers also take the capitalized versions, .F and .F90, to indicate
source code that must be run through a preprocessor.

It is a little weird, but Fortran file extensions have nothing to do with
the year of the language standard the code is to be compiled against.



David Scott wrote:
> 
> file SSFcoef.f
>      subroutine SSFcoef(nmax,nu,A,nrowA,ncolA)
>      implicit double precision(a-h,o-z)
>      implicit integer (i-n)
>      integer l,i,nmax
>      double precision nu,A(0:nmax,0:nmax)
>      A(0,0) = 1D0
>      do l=1,nmax
>       do i=1,l-1
>         A(l,i) = (-nu+i+l-1D0)*A(l-1,i)+A(l-1,i-1)
>       end do
>       A(l,0) = (-nu+l-1D0)*A(l-1,0)
>       A(l,l) = 1D0
>      end do
>      return
>      end
> I created a dll (this is windows) using R CMD SHLIB SSFcoef.f
> Then my R code is:
> 
>  ### Load the compiled shared library in.
>  dyn.load("SSFcoef.dll")
> 
>  ### Write a function that calls the Fortran subroutine
>  SSFcoef <- function(nmax, nu){
>   .Fortran("SSFcoef",
>            as.integer(nmax),
>            as.integer(nu)
>            )$A
>  }
> 
>  SSFcoef(10,2)
> 
> which when run gives
> 
>> SSFcoef(10,2)
>  NULL
> 
> I am pretty sure the problem is that I am not dealing with the matrix A
> properly. I also tried this on linux and got a segfault.
> 
> Can anyone supply the appropriate modification to my call (and possibly to
> the subroutine) to make this work?
> 

When calling a Fortran function for R, for each argument that appears in the
subroutine declaration:

  subroutine subName(...arg list...)

You *must* provide a matching input to the .Fortran() call:

  .Fortran("subName", ...arg list...)

In the case of arrays that are filled by the Fortran subroutine, just pass
an empty vector of the appropriate length- perhaps created using the
double() function.

-Charlie

-----
Charlie Sharpsteen
Undergraduate-- Environmental Resources Engineering
Humboldt State University
-- 
View this message in context: http://r.789695.n4.nabble.com/Re-R-Use-of-Fortran-tp2260362p2261266.html
Sent from the R devel mailing list archive at Nabble.com.


From shotwelm at musc.edu  Sat Jun 19 22:53:00 2010
From: shotwelm at musc.edu (Matt Shotwell)
Date: Sat, 19 Jun 2010 16:53:00 -0400
Subject: [Rd] more powerful iconv
Message-ID: <1276980780.20054.12.camel@deacon>

R community,

As you may know, R's iconv doesn't work well converting to and from
encodings that allow embedded nulls. For example

> iconv("foo", to="UTF-16")
Error in iconv("foo", to = "UTF-16") : 
  embedded nul in string: '\xff\xfef\0o\0o\0'

However, I don't believe embedded nulls are at issue here, but rather
that R's iconv doesn't accept objects of type RAWSXP. The iconv
mechanism, after all, operates on encoded binary data, and not
necessarily null terminated C strings. I'd like to submit a very small
patch (12 lines w/o documentation) that allows R's iconv to operate on
raw objects, while not interfering or affecting the behavior of iconv on
character vectors. To keep this message terse, I've put additional
discussion, description of what the patch does, and examples here:
http://biostatmatt.com/archives/456

Also, here is a link to the patch file:
http://biostatmatt.com/R/R-devel-iconv-0.0.patch

If this change is adopted, I'd be happy to submit a documentation patch
also.

-Matt

Index: src/library/base/R/New-Internal.R
===================================================================
--- src/library/base/R/New-Internal.R	(revision 52328)
+++ src/library/base/R/New-Internal.R	(working copy)
@@ -239,7 +239,7 @@
 
 iconv <- function(x, from = "", to = "", sub = NA, mark = TRUE)
 {
-    if(!is.character(x)) x <- as.character(x)
+    if(!is.character(x) && !is.raw(x)) x <- as.character(x)
     .Internal(iconv(x, from, to, as.character(sub), mark))
 }
 
Index: src/main/sysutils.c
===================================================================
--- src/main/sysutils.c	(revision 52328)
+++ src/main/sysutils.c	(working copy)
@@ -548,16 +548,17 @@
 	int mark;
 	const char *from, *to;
 	Rboolean isLatin1 = FALSE, isUTF8 = FALSE;
+	Rboolean isRawx = (TYPEOF(x) == RAWSXP);
 
-	if(TYPEOF(x) != STRSXP)
-	    error(_("'x' must be a character vector"));
+	if(TYPEOF(x) != STRSXP && !isRawx)
+	    error(_("'x' must be a character vector or raw"));
 	if(!isString(CADR(args)) || length(CADR(args)) != 1)
 	    error(_("invalid '%s' argument"), "from");
 	if(!isString(CADDR(args)) || length(CADDR(args)) != 1)
 	    error(_("invalid '%s' argument"), "to");
 	if(!isString(CADDDR(args)) || length(CADDDR(args)) != 1)
 	    error(_("invalid '%s' argument"), "sub");
-	if(STRING_ELT(CADDDR(args), 0) == NA_STRING) sub = NULL;
+	if(STRING_ELT(CADDDR(args), 0) == NA_STRING || isRawx) sub = NULL;
 	else sub = translateChar(STRING_ELT(CADDDR(args), 0));
 	mark = asLogical(CAD4R(args));
 	if(mark == NA_LOGICAL)
@@ -584,7 +585,7 @@
 	PROTECT(ans = duplicate(x));
 	R_AllocStringBuffer(0, &cbuff);  /* 0 -> default */
 	for(i = 0; i < LENGTH(x); i++) {
-	    si = STRING_ELT(x, i);
+	    si = isRawx ? x : STRING_ELT(x, i);
 	top_of_loop:
 	    inbuf = CHAR(si); inb = LENGTH(si);
 	    outbuf = cbuff.data; outb = cbuff.bufsize - 1;
@@ -622,7 +623,7 @@
 		goto next_char;
 	    }
 
-	    if(res != -1 && inb == 0) {
+	    if(res != -1 && inb == 0 && !isRawx) {
 		cetype_t ienc = CE_NATIVE;
 
 		nout = cbuff.bufsize - 1 - outb;
@@ -632,7 +633,12 @@
 		}
 		SET_STRING_ELT(ans, i, mkCharLenCE(cbuff.data, nout, ienc));
 	    }
-	    else SET_STRING_ELT(ans, i, NA_STRING);
+	    else if(!isRawx) SET_STRING_ELT(ans, i, NA_STRING);
+	    else {
+		nout = cbuff.bufsize - 1 - outb;
+		ans = allocVector(RAWSXP, nout);
+		memcpy(RAW(ans), cbuff.data, nout);
+	    }
 	}
 	Riconv_close(obj);
 	R_FreeStringBuffer(&cbuff);

-- 
Matthew S. Shotwell
Graduate Student
Division of Biostatistics and Epidemiology
Medical University of South Carolina
http://biostatmatt.com


From d.scott at auckland.ac.nz  Sun Jun 20 04:02:56 2010
From: d.scott at auckland.ac.nz (David Scott)
Date: Sun, 20 Jun 2010 14:02:56 +1200
Subject: [Rd] [R] Use of .Fortran
In-Reply-To: <alpine.LFD.2.00.1006181551410.17082@gannet.stats.ox.ac.uk>
References: <4C1B7BCB.6070605@auckland.ac.nz>
	<alpine.LFD.2.00.1006181551410.17082@gannet.stats.ox.ac.uk>
Message-ID: <4C1D76D0.8070506@auckland.ac.nz>

Thanks very much to all who replied. I went with Brian's approach, and 
eventually, despite all my attempts to foul it up, I did get it to work 
successfully. For the record here are the details.

The subroutine is:

       subroutine SSFcoef(nmax,nu,A)
       implicit double precision(a-h,o-z)
       implicit integer (i-n)
       integer k,i,nmax
       double precision nu,A(0:nmax,0:nmax)
       A(0,0) = 1D0
       do k=1,nmax
       	do i=1,k-1
       		A(k,i) = (-nu+i+k-1D0)*A(k-1,i)+A(k-1,i-1)
       	end do
       	A(k,0) = (-nu+k-1D0)*A(k-1,0)
       	A(k,k) = 1D0
       end do
       return
       end

This was in the file SSFcoef.f95 and was made into a dll with

R CMD SHLIB SSFcoef.f95

Then calling it in R went like this:

### Load the compiled shared library in.
dyn.load("SSFcoef.dll")

### Write a function that calls the Fortran subroutine
SSFcoef <- function(nmax, nu){
    .Fortran("SSFcoef",
             as.integer(nmax),
             as.double(nu),
	    A = matrix(0, nmax+1, nmax+1)
             )$A
}

SSFcoef(10,2)


There are a number of comments I should make.

Yes, Brian, should have gone to R-devel. I had forgotten about that.

I recognised from my faintly recalled past Fortran experience that the 
code was different and suspected a later Fortran, so good to be advised 
it was 95.

I actually gave a wrong version of the Fortran subroutine, one I had 
been messing around with and had added some extra arguments (nrowA and 
ncolA). As pointed out these were unnecessary.

Something which then caused me a bit of grief before I noticed it. 
Despite the 'implicit integer (i-n)' declaration in the subroutine, nu 
is later declared to be double so has to be specified as double in the R 
code.

Many thanks again, I at least learnt something about calling other 
language code from R.

David

Prof Brian Ripley wrote:
> On Sat, 19 Jun 2010, David Scott wrote:
> 
>> I have no experience with incorporating Fortran code and am probably doing 
>> something pretty stupid.
> 
> Surely you saw in the posting guide that R-help is not the place for 
> questions about C, C++, Fortran code?  Diverting to R-devel.
> 
>> I want to use the following Fortran subroutine (not written by me) in the
> 
> Well, it is not Fortran 77 but Fortran 95, and so needs to be given a 
> .f95 extension to be sure to work.
> 
>> file SSFcoef.f
>>
>>      subroutine SSFcoef(nmax,nu,A,nrowA,ncolA)
>>      implicit double precision(a-h,o-z)
>>      implicit integer (i-n)
>>      integer l,i,nmax
>>      double precision nu,A(0:nmax,0:nmax)
>>      A(0,0) = 1D0
>>      do l=1,nmax
>>      	do i=1,l-1
>>      		A(l,i) = (-nu+i+l-1D0)*A(l-1,i)+A(l-1,i-1)
>>      	end do
>>      	A(l,0) = (-nu+l-1D0)*A(l-1,0)
>>      	A(l,l) = 1D0
>>      end do
>>      return
>>      end
>>
>>
>> I created a dll (this is windows) using R CMD SHLIB SSFcoef.f
>>
>> Then my R code is:
>>
>> ### Load the compiled shared library in.
>> dyn.load("SSFcoef.dll")
>>
>> ### Write a function that calls the Fortran subroutine
>> SSFcoef <- function(nmax, nu){
>>  .Fortran("SSFcoef",
>>           as.integer(nmax),
>>           as.integer(nu)
>>           )$A
>> }
> 
> That does not match.  nrowA and ncolA are unused, so you need
> SSFcoef <- function(nmax, nu){
>    .Fortran("SSFcoef",
>             as.integer(nmax),
>             as.integer(nu),
>             A = matrix(0, nmax+1, nmax+1),
>             0L, 0L)$A
> }
> 
> 
>> SSFcoef(10,2)
>>
>> which when run gives
>>
>>> SSFcoef(10,2)
>> NULL
>>
>> I am pretty sure the problem is that I am not dealing with the matrix A 
>> properly. I also tried this on linux and got a segfault.
>>
>> Can anyone supply the appropriate modification to my call (and possibly to 
>> the subroutine) to make this work?
>>
>> David Scott
>>


-- 
_________________________________________________________________
David Scott	Department of Statistics
		The University of Auckland, PB 92019
		Auckland 1142,    NEW ZEALAND
Phone: +64 9 923 5055, or +64 9 373 7599 ext 85055
Email:	d.scott at auckland.ac.nz,  Fax: +64 9 373 7018

Director of Consulting, Department of Statistics


From pburns at pburns.seanet.com  Sun Jun 20 12:07:53 2010
From: pburns at pburns.seanet.com (Patrick Burns)
Date: Sun, 20 Jun 2010 11:07:53 +0100
Subject: [Rd] proposed change to 'sample'
Message-ID: <4C1DE879.6040303@pburns.seanet.com>

There is a weakness in the 'sample'
function that is highlighted in the
help file.  The 'x' argument can be
either the vector from which to sample,
or the maximum value of the sequence
from which to sample.

This can be ambiguous if the length of
'x' is one.

I propose adding an argument that allows
the user (programmer) to avoid that
ambiguity:

function (x, size, replace = FALSE, prob = NULL,
     max = length(x) == 1L && is.numeric(x) && x >= 1)
{
     if (max) {
         if (missing(size))
             size <- x
         .Internal(sample(x, size, replace, prob))
     }
     else {
         if (missing(size))
             size <- length(x)
         x[.Internal(sample(length(x), size, replace, prob))]
     }
}
<environment: namespace:base>


This just takes the condition of the first
'if' to be the default value of the new 'max'
argument.

So in the "surprise" section of the examples
in the 'sample' help file

sample(x[x > 9])

and

sample(x[x > 9], max=FALSE)

have different behaviours.

By the way, I'm certainly not convinced that
'max' is the best name for the argument.

-- 
Patrick Burns
pburns at pburns.seanet.com
http://www.burns-stat.com
(home of 'Some hints for the R beginner'
and 'The R Inferno')


From gb at stat.umu.se  Sun Jun 20 13:04:36 2010
From: gb at stat.umu.se (=?ISO-8859-1?Q?G=F6ran_Brostr=F6m?=)
Date: Sun, 20 Jun 2010 13:04:36 +0200
Subject: [Rd] [R] Use of .Fortran
In-Reply-To: <4C1D76D0.8070506@auckland.ac.nz>
References: <4C1B7BCB.6070605@auckland.ac.nz>	<alpine.LFD.2.00.1006181551410.17082@gannet.stats.ox.ac.uk>
	<4C1D76D0.8070506@auckland.ac.nz>
Message-ID: <4C1DF5C4.9050105@stat.umu.se>



On 06/20/2010 04:02 AM, David Scott wrote:
> Thanks very much to all who replied. I went with Brian's approach, and
> eventually, despite all my attempts to foul it up, I did get it to work
> successfully. For the record here are the details.
>
> The subroutine is:
>
>         subroutine SSFcoef(nmax,nu,A)
>         implicit double precision(a-h,o-z)
>         implicit integer (i-n)

These 'implicit' declarations are dangerous. Use 'implicit none' instead 
and declare explicitly every variable (like you already are doing). You 
get much better error checks (eg, misspelled variable names are caught).

G?ran

>         integer k,i,nmax
>         double precision nu,A(0:nmax,0:nmax)
>         A(0,0) = 1D0
>         do k=1,nmax
>         	do i=1,k-1
>         		A(k,i) = (-nu+i+k-1D0)*A(k-1,i)+A(k-1,i-1)
>         	end do
>         	A(k,0) = (-nu+k-1D0)*A(k-1,0)
>         	A(k,k) = 1D0
>         end do
>         return
>         end
>
> This was in the file SSFcoef.f95 and was made into a dll with
>
> R CMD SHLIB SSFcoef.f95
>
> Then calling it in R went like this:
>
> ### Load the compiled shared library in.
> dyn.load("SSFcoef.dll")
>
> ### Write a function that calls the Fortran subroutine
> SSFcoef<- function(nmax, nu){
>      .Fortran("SSFcoef",
>               as.integer(nmax),
>               as.double(nu),
> 	    A = matrix(0, nmax+1, nmax+1)
>               )$A
> }
>
> SSFcoef(10,2)
>
>
> There are a number of comments I should make.
>
> Yes, Brian, should have gone to R-devel. I had forgotten about that.
>
> I recognised from my faintly recalled past Fortran experience that the
> code was different and suspected a later Fortran, so good to be advised
> it was 95.
>
> I actually gave a wrong version of the Fortran subroutine, one I had
> been messing around with and had added some extra arguments (nrowA and
> ncolA). As pointed out these were unnecessary.
>
> Something which then caused me a bit of grief before I noticed it.
> Despite the 'implicit integer (i-n)' declaration in the subroutine, nu
> is later declared to be double so has to be specified as double in the R
> code.
>
> Many thanks again, I at least learnt something about calling other
> language code from R.
>
> David
>
> Prof Brian Ripley wrote:
>> On Sat, 19 Jun 2010, David Scott wrote:
>>
>>> I have no experience with incorporating Fortran code and am probably doing
>>> something pretty stupid.
>>
>> Surely you saw in the posting guide that R-help is not the place for
>> questions about C, C++, Fortran code?  Diverting to R-devel.
>>
>>> I want to use the following Fortran subroutine (not written by me) in the
>>
>> Well, it is not Fortran 77 but Fortran 95, and so needs to be given a
>> .f95 extension to be sure to work.
>>
>>> file SSFcoef.f
>>>
>>>       subroutine SSFcoef(nmax,nu,A,nrowA,ncolA)
>>>       implicit double precision(a-h,o-z)
>>>       implicit integer (i-n)
>>>       integer l,i,nmax
>>>       double precision nu,A(0:nmax,0:nmax)
>>>       A(0,0) = 1D0
>>>       do l=1,nmax
>>>       	do i=1,l-1
>>>       		A(l,i) = (-nu+i+l-1D0)*A(l-1,i)+A(l-1,i-1)
>>>       	end do
>>>       	A(l,0) = (-nu+l-1D0)*A(l-1,0)
>>>       	A(l,l) = 1D0
>>>       end do
>>>       return
>>>       end
>>>
>>>
>>> I created a dll (this is windows) using R CMD SHLIB SSFcoef.f
>>>
>>> Then my R code is:
>>>
>>> ### Load the compiled shared library in.
>>> dyn.load("SSFcoef.dll")
>>>
>>> ### Write a function that calls the Fortran subroutine
>>> SSFcoef<- function(nmax, nu){
>>>   .Fortran("SSFcoef",
>>>            as.integer(nmax),
>>>            as.integer(nu)
>>>            )$A
>>> }
>>
>> That does not match.  nrowA and ncolA are unused, so you need
>> SSFcoef<- function(nmax, nu){
>>     .Fortran("SSFcoef",
>>              as.integer(nmax),
>>              as.integer(nu),
>>              A = matrix(0, nmax+1, nmax+1),
>>              0L, 0L)$A
>> }
>>
>>
>>> SSFcoef(10,2)
>>>
>>> which when run gives
>>>
>>>> SSFcoef(10,2)
>>> NULL
>>>
>>> I am pretty sure the problem is that I am not dealing with the matrix A
>>> properly. I also tried this on linux and got a segfault.
>>>
>>> Can anyone supply the appropriate modification to my call (and possibly to
>>> the subroutine) to make this work?
>>>
>>> David Scott
>>>
>
>

-- 
G?ran Brostr?m               phone: 46 90 786 5223
Department of Statistics     fax: 46 90 786 6614
Ume? University              email: gb at stat.umu.se
SE-90187 Ume?, Sweden        http://www.stat.umu.se


From mjhmeyer at googlemail.com  Sat Jun 19 16:50:19 2010
From: mjhmeyer at googlemail.com (michael meyer)
Date: Sat, 19 Jun 2010 16:50:19 +0200
Subject: [Rd] C Interface
Message-ID: <AANLkTik9nBihn9poZcV8OjFmx2Q-p98FjZfwjQSEbvHr@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20100619/b1cdabcc/attachment.pl>

From saptarshi.guha at gmail.com  Sun Jun 20 17:15:45 2010
From: saptarshi.guha at gmail.com (Saptarshi Guha)
Date: Sun, 20 Jun 2010 11:15:45 -0400
Subject: [Rd] How to debug: Cons memory exhausted
Message-ID: <AANLkTik4abuGDhcDZAU42IBOeLS06VjrvnfZiN5MDWb_@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20100620/d8c5dbce/attachment.pl>

From wdunlap at tibco.com  Sun Jun 20 19:49:43 2010
From: wdunlap at tibco.com (William Dunlap)
Date: Sun, 20 Jun 2010 10:49:43 -0700
Subject: [Rd] proposed change to 'sample'
In-Reply-To: <4C1DE879.6040303@pburns.seanet.com>
References: <4C1DE879.6040303@pburns.seanet.com>
Message-ID: <77EB52C6DD32BA4D87471DCD70C8D700031C9A21@NA-PA-VBE03.na.tibco.com>

> -----Original Message-----
> From: r-devel-bounces at r-project.org 
> [mailto:r-devel-bounces at r-project.org] On Behalf Of Patrick Burns
> Sent: Sunday, June 20, 2010 3:08 AM
> To: r-devel at r-project.org
> Subject: [Rd] proposed change to 'sample'
> 
> There is a weakness in the 'sample'
> function that is highlighted in the
> help file.  The 'x' argument can be
> either the vector from which to sample,
> or the maximum value of the sequence
> from which to sample.
> 
> This can be ambiguous if the length of
> 'x' is one.
> 
> I propose adding an argument that allows
> the user (programmer) to avoid that
> ambiguity:
> 
> function (x, size, replace = FALSE, prob = NULL,
>      max = length(x) == 1L && is.numeric(x) && x >= 1)

S+'s sample() has an argument 'n' to achieve
the same result.  It has been there since at
least 2005 (S+ 7.0.6).  sample(n=n) means to
return a sample from seq_along(n), where n must
be a scalar nonnegative integer.  sample(x=x)
retains it old ambiguous meaning.
  sample(x, size = n, replace = F, prob = NULL, n = NULL, ...)

S+ also has an rsample function where n (with
the same meaning) is the only way to specify the
population.  It also has an order=TRUE/FALSE argument
where order=TRUE means to randomly order the output.
order=FALSE means that the ordering of the output is
unspecified, but it allows the person writing rsample
methods to use the quickest way to get a random sample
(for big data it can be fastest to return the sample
from 1:n in increasing order). 
  rsample(n, size = n, replace = F, prob = NULL,
        bigdata = F, minimal = NULL, ..., order = T)
I like the idea of separating the concepts of sampling
and permuting data.  Many statistics are invariant to
ordering of the data and it can be a waste of time
to randomly order a sample to feed to such functions.

Bill Dunlap
Spotfire, TIBCO Software
wdunlap tibco.com 

> {
>      if (max) {
>          if (missing(size))
>              size <- x
>          .Internal(sample(x, size, replace, prob))
>      }
>      else {
>          if (missing(size))
>              size <- length(x)
>          x[.Internal(sample(length(x), size, replace, prob))]
>      }
> }
> <environment: namespace:base>
> 
> 
> This just takes the condition of the first
> 'if' to be the default value of the new 'max'
> argument.
> 
> So in the "surprise" section of the examples
> in the 'sample' help file
> 
> sample(x[x > 9])
> 
> and
> 
> sample(x[x > 9], max=FALSE)
> 
> have different behaviours.
> 
> By the way, I'm certainly not convinced that
> 'max' is the best name for the argument.
> 
> -- 
> Patrick Burns
> pburns at pburns.seanet.com
> http://www.burns-stat.com
> (home of 'Some hints for the R beginner'
> and 'The R Inferno')
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
> 


From pdalgd at gmail.com  Sun Jun 20 23:11:36 2010
From: pdalgd at gmail.com (Peter Dalgaard)
Date: Mon, 21 Jun 2010 00:11:36 +0300
Subject: [Rd] proposed change to 'sample'
In-Reply-To: <77EB52C6DD32BA4D87471DCD70C8D700031C9A21@NA-PA-VBE03.na.tibco.com>
References: <4C1DE879.6040303@pburns.seanet.com>
	<77EB52C6DD32BA4D87471DCD70C8D700031C9A21@NA-PA-VBE03.na.tibco.com>
Message-ID: <4C1E8408.1010609@gmail.com>

William Dunlap wrote:
>> -----Original Message-----
>> From: r-devel-bounces at r-project.org 
>> [mailto:r-devel-bounces at r-project.org] On Behalf Of Patrick Burns
....
>>
>> I propose adding an argument that allows
>> the user (programmer) to avoid that
>> ambiguity:
>>
>> function (x, size, replace = FALSE, prob = NULL,
>>      max = length(x) == 1L && is.numeric(x) && x >= 1)
> 
> S+'s sample() has an argument 'n' to achieve
> the same result.  It has been there since at
> least 2005 (S+ 7.0.6).  sample(n=n) means to
> return a sample from seq_along(n), where n must
> be a scalar nonnegative integer.  sample(x=x)
> retains it old ambiguous meaning.
>   sample(x, size = n, replace = F, prob = NULL, n = NULL, ...)

Hmm, that doesn't really solve the issue does it? I.e., you still cannot
conveniently sample from a vector that is possibly of size 1.

I would be more inclined to make sampling from a vector the normal case,
and default x to say 1:max(n, size), forcing users to say sample(n=5) if
sampling from x=1:5 is desired. This could be a manageable change; the
deprecation sequence is a bit painful to think through, though.

-- 
Peter Dalgaard
Center for Statistics, Copenhagen Business School
Phone: (+45)38153501
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From shotwelm at musc.edu  Mon Jun 21 00:46:04 2010
From: shotwelm at musc.edu (Matt Shotwell)
Date: Sun, 20 Jun 2010 18:46:04 -0400
Subject: [Rd] more powerful iconv
In-Reply-To: <1276980780.20054.12.camel@deacon>
References: <1276980780.20054.12.camel@deacon>
Message-ID: <1277073964.4677.18.camel@deacon>

Couple more thoughts about iconv, 

(1) The 'embedded nul' error is thrown by mkCharLenCE, after the real
conversion is complete. The converted string exists in memory, though
not in a form that R can currently represent as a STRSXP. Hence the
error when passed to mkCharLenCE.

(2) The patch I submitted needed some PROTECTion, it's fixed in the
patch below. Also, in one place I did not alter CHAR(x) where x may be a
RAWSXP, because that's the pointer type required, the alternative is
(const char*) RAW(x). Should this alternative be used?

(3) I don't see why the iconv 'sub' argument shouldn't work with raw
objects also, but I think this means the 'sub' argument should also
accept raw objects.

(4) Suppose iconv fails. If x were a STRSXP, the result is NA_STRING.
Should failure of iconv on a RAWSXP return R_NilValue?

-Matt

Index: src/library/base/R/New-Internal.R
===================================================================
--- src/library/base/R/New-Internal.R	(revision 52328)
+++ src/library/base/R/New-Internal.R	(working copy)
@@ -239,7 +239,7 @@
 
 iconv <- function(x, from = "", to = "", sub = NA, mark = TRUE)
 {
-    if(!is.character(x)) x <- as.character(x)
+    if(!is.character(x) && !is.raw(x)) x <- as.character(x)
     .Internal(iconv(x, from, to, as.character(sub), mark))
 }
 
Index: src/main/sysutils.c
===================================================================
--- src/main/sysutils.c	(revision 52328)
+++ src/main/sysutils.c	(working copy)
@@ -548,16 +548,17 @@
 	int mark;
 	const char *from, *to;
 	Rboolean isLatin1 = FALSE, isUTF8 = FALSE;
+	Rboolean isRawx = (TYPEOF(x) == RAWSXP);
 
-	if(TYPEOF(x) != STRSXP)
-	    error(_("'x' must be a character vector"));
+	if(TYPEOF(x) != STRSXP && !isRawx)
+	    error(_("'x' must be a character vector or raw"));
 	if(!isString(CADR(args)) || length(CADR(args)) != 1)
 	    error(_("invalid '%s' argument"), "from");
 	if(!isString(CADDR(args)) || length(CADDR(args)) != 1)
 	    error(_("invalid '%s' argument"), "to");
 	if(!isString(CADDDR(args)) || length(CADDDR(args)) != 1)
 	    error(_("invalid '%s' argument"), "sub");
-	if(STRING_ELT(CADDDR(args), 0) == NA_STRING) sub = NULL;
+	if(STRING_ELT(CADDDR(args), 0) == NA_STRING || isRawx) sub = NULL;
 	else sub = translateChar(STRING_ELT(CADDDR(args), 0));
 	mark = asLogical(CAD4R(args));
 	if(mark == NA_LOGICAL)
@@ -584,7 +585,7 @@
 	PROTECT(ans = duplicate(x));
 	R_AllocStringBuffer(0, &cbuff);  /* 0 -> default */
 	for(i = 0; i < LENGTH(x); i++) {
-	    si = STRING_ELT(x, i);
+	    si = isRawx ? x : STRING_ELT(x, i);
 	top_of_loop:
 	    inbuf = CHAR(si); inb = LENGTH(si);
 	    outbuf = cbuff.data; outb = cbuff.bufsize - 1;
@@ -622,7 +623,7 @@
 		goto next_char;
 	    }
 
-	    if(res != -1 && inb == 0) {
+	    if(res != -1 && inb == 0 && !isRawx) {
 		cetype_t ienc = CE_NATIVE;
 
 		nout = cbuff.bufsize - 1 - outb;
@@ -632,7 +633,13 @@
 		}
 		SET_STRING_ELT(ans, i, mkCharLenCE(cbuff.data, nout, ienc));
 	    }
-	    else SET_STRING_ELT(ans, i, NA_STRING);
+	    else if(!isRawx) SET_STRING_ELT(ans, i, NA_STRING);
+	    else {
+		nout = cbuff.bufsize - 1 - outb;
+		UNPROTECT(1);
+		PROTECT(ans = allocVector(RAWSXP, nout));
+		memcpy(RAW(ans), cbuff.data, nout);
+	    }
 	}
 	Riconv_close(obj);
 	R_FreeStringBuffer(&cbuff);

On Sat, 2010-06-19 at 16:53 -0400, Matt Shotwell wrote:
> R community,
> 
> As you may know, R's iconv doesn't work well converting to and from
> encodings that allow embedded nulls. For example
> 
> > iconv("foo", to="UTF-16")
> Error in iconv("foo", to = "UTF-16") : 
>   embedded nul in string: '\xff\xfef\0o\0o\0'
> 
> However, I don't believe embedded nulls are at issue here, but rather
> that R's iconv doesn't accept objects of type RAWSXP. The iconv
> mechanism, after all, operates on encoded binary data, and not
> necessarily null terminated C strings. I'd like to submit a very small
> patch (12 lines w/o documentation) that allows R's iconv to operate on
> raw objects, while not interfering or affecting the behavior of iconv on
> character vectors. To keep this message terse, I've put additional
> discussion, description of what the patch does, and examples here:
> http://biostatmatt.com/archives/456
> 
> Also, here is a link to the patch file:
> http://biostatmatt.com/R/R-devel-iconv-0.0.patch
> 
> If this change is adopted, I'd be happy to submit a documentation patch
> also.
> 
> -Matt
> 
> Index: src/library/base/R/New-Internal.R
> ===================================================================
> --- src/library/base/R/New-Internal.R	(revision 52328)
> +++ src/library/base/R/New-Internal.R	(working copy)
> @@ -239,7 +239,7 @@
>  
>  iconv <- function(x, from = "", to = "", sub = NA, mark = TRUE)
>  {
> -    if(!is.character(x)) x <- as.character(x)
> +    if(!is.character(x) && !is.raw(x)) x <- as.character(x)
>      .Internal(iconv(x, from, to, as.character(sub), mark))
>  }
>  
> Index: src/main/sysutils.c
> ===================================================================
> --- src/main/sysutils.c	(revision 52328)
> +++ src/main/sysutils.c	(working copy)
> @@ -548,16 +548,17 @@
>  	int mark;
>  	const char *from, *to;
>  	Rboolean isLatin1 = FALSE, isUTF8 = FALSE;
> +	Rboolean isRawx = (TYPEOF(x) == RAWSXP);
>  
> -	if(TYPEOF(x) != STRSXP)
> -	    error(_("'x' must be a character vector"));
> +	if(TYPEOF(x) != STRSXP && !isRawx)
> +	    error(_("'x' must be a character vector or raw"));
>  	if(!isString(CADR(args)) || length(CADR(args)) != 1)
>  	    error(_("invalid '%s' argument"), "from");
>  	if(!isString(CADDR(args)) || length(CADDR(args)) != 1)
>  	    error(_("invalid '%s' argument"), "to");
>  	if(!isString(CADDDR(args)) || length(CADDDR(args)) != 1)
>  	    error(_("invalid '%s' argument"), "sub");
> -	if(STRING_ELT(CADDDR(args), 0) == NA_STRING) sub = NULL;
> +	if(STRING_ELT(CADDDR(args), 0) == NA_STRING || isRawx) sub = NULL;
>  	else sub = translateChar(STRING_ELT(CADDDR(args), 0));
>  	mark = asLogical(CAD4R(args));
>  	if(mark == NA_LOGICAL)
> @@ -584,7 +585,7 @@
>  	PROTECT(ans = duplicate(x));
>  	R_AllocStringBuffer(0, &cbuff);  /* 0 -> default */
>  	for(i = 0; i < LENGTH(x); i++) {
> -	    si = STRING_ELT(x, i);
> +	    si = isRawx ? x : STRING_ELT(x, i);
>  	top_of_loop:
>  	    inbuf = CHAR(si); inb = LENGTH(si);
>  	    outbuf = cbuff.data; outb = cbuff.bufsize - 1;
> @@ -622,7 +623,7 @@
>  		goto next_char;
>  	    }
>  
> -	    if(res != -1 && inb == 0) {
> +	    if(res != -1 && inb == 0 && !isRawx) {
>  		cetype_t ienc = CE_NATIVE;
>  
>  		nout = cbuff.bufsize - 1 - outb;
> @@ -632,7 +633,12 @@
>  		}
>  		SET_STRING_ELT(ans, i, mkCharLenCE(cbuff.data, nout, ienc));
>  	    }
> -	    else SET_STRING_ELT(ans, i, NA_STRING);
> +	    else if(!isRawx) SET_STRING_ELT(ans, i, NA_STRING);
> +	    else {
> +		nout = cbuff.bufsize - 1 - outb;
> +		ans = allocVector(RAWSXP, nout);
> +		memcpy(RAW(ans), cbuff.data, nout);
> +	    }
>  	}
>  	Riconv_close(obj);
>  	R_FreeStringBuffer(&cbuff);
> 
-- 
Matthew S. Shotwell
Graduate Student
Division of Biostatistics and Epidemiology
Medical University of South Carolina
http://biostatmatt.com


From hadley at rice.edu  Mon Jun 21 05:42:31 2010
From: hadley at rice.edu (Hadley Wickham)
Date: Sun, 20 Jun 2010 22:42:31 -0500
Subject: [Rd] proposed change to 'sample'
In-Reply-To: <4C1E8408.1010609@gmail.com>
References: <4C1DE879.6040303@pburns.seanet.com>
	<77EB52C6DD32BA4D87471DCD70C8D700031C9A21@NA-PA-VBE03.na.tibco.com>
	<4C1E8408.1010609@gmail.com>
Message-ID: <AANLkTilJm651mXnqOUFWhipqV11QOldSyjCyUD6IHric@mail.gmail.com>

> I would be more inclined to make sampling from a vector the normal case,
> and default x to say 1:max(n, size), forcing users to say sample(n=5) if
> sampling from x=1:5 is desired. This could be a manageable change; the
> deprecation sequence is a bit painful to think through, though.

Don't we already have sample.int for that case?

Hadley

-- 
Assistant Professor / Dobelman Family Junior Chair
Department of Statistics / Rice University
http://had.co.nz/


From wdunlap at tibco.com  Mon Jun 21 06:04:13 2010
From: wdunlap at tibco.com (William Dunlap)
Date: Sun, 20 Jun 2010 21:04:13 -0700
Subject: [Rd] proposed change to 'sample'
In-Reply-To: <4C1E8408.1010609@gmail.com>
References: <4C1DE879.6040303@pburns.seanet.com>
	<77EB52C6DD32BA4D87471DCD70C8D700031C9A21@NA-PA-VBE03.na.tibco.com>
	<4C1E8408.1010609@gmail.com>
Message-ID: <77EB52C6DD32BA4D87471DCD70C8D700031C9A49@NA-PA-VBE03.na.tibco.com>

> -----Original Message-----
> From: Peter Dalgaard [mailto:pdalgd at gmail.com] 
> Sent: Sunday, June 20, 2010 2:12 PM
> To: William Dunlap
> Cc: Patrick Burns; r-devel at r-project.org
> Subject: Re: [Rd] proposed change to 'sample'
> 
> William Dunlap wrote:
> >> -----Original Message-----
> >> From: r-devel-bounces at r-project.org 
> >> [mailto:r-devel-bounces at r-project.org] On Behalf Of Patrick Burns
> ....
> >>
> >> I propose adding an argument that allows
> >> the user (programmer) to avoid that
> >> ambiguity:
> >>
> >> function (x, size, replace = FALSE, prob = NULL,
> >>      max = length(x) == 1L && is.numeric(x) && x >= 1)
> > 
> > S+'s sample() has an argument 'n' to achieve
> > the same result.  It has been there since at
> > least 2005 (S+ 7.0.6).  sample(n=n) means to
> > return a sample from seq_along(n), where n must
> > be a scalar nonnegative integer.  sample(x=x)
> > retains it old ambiguous meaning.
> >   sample(x, size = n, replace = F, prob = NULL, n = NULL, ...)
> 
> Hmm, that doesn't really solve the issue does it? I.e., you 
> still cannot
> conveniently sample from a vector that is possibly of size 1.
> 
> I would be more inclined to make sampling from a vector the 
> normal case,
> and default x to say 1:max(n, size), forcing users to say 
> sample(n=5) if
> sampling from x=1:5 is desired. This could be a manageable change; the
> deprecation sequence is a bit painful to think through, though.

I think that the breaking of old code was why we
allowed the user to use an unambiguous sample(n=n),
but didn't change how sample(x=scalar) worked.
Internally, we had long discouraged using sample(x=vector)
because of the ambiguity problem, preferring
x[sample(length(x),...)].

I notice that S+'s rsample() does not allow sampling
from a vector, only from seq_len(n).  I think that
is because it was felt that sampling rows from a data.frame
(or the bigdata equivalent, bdframe) was a more common
operation and the code was simpler/faster if rsample didn't
have to call out to possible subscripting methods.  Relaxing
the requirement that the output be a randomly permuted
sample was a bigger requirement when dealing with long
datasets.

In any case, I was just stating that if sample were
changed to allow disambiguation of its first argument,
using 'n' instead of 'max' would be compatible with S+.

Bill Dunlap
Spotfire, TIBCO Software
wdunlap tibco.com 

> 
> -- 
> Peter Dalgaard
> Center for Statistics, Copenhagen Business School
> Phone: (+45)38153501
> Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com
> 


From pdalgd at gmail.com  Mon Jun 21 07:57:33 2010
From: pdalgd at gmail.com (Peter Dalgaard)
Date: Mon, 21 Jun 2010 08:57:33 +0300
Subject: [Rd] proposed change to 'sample'
In-Reply-To: <AANLkTilJm651mXnqOUFWhipqV11QOldSyjCyUD6IHric@mail.gmail.com>
References: <4C1DE879.6040303@pburns.seanet.com>
	<77EB52C6DD32BA4D87471DCD70C8D700031C9A21@NA-PA-VBE03.na.tibco.com>
	<4C1E8408.1010609@gmail.com>
	<AANLkTilJm651mXnqOUFWhipqV11QOldSyjCyUD6IHric@mail.gmail.com>
Message-ID: <4C1EFF4D.4090206@gmail.com>

Hadley Wickham wrote:
>> I would be more inclined to make sampling from a vector the normal case,
>> and default x to say 1:max(n, size), forcing users to say sample(n=5) if
>> sampling from x=1:5 is desired. This could be a manageable change; the
>> deprecation sequence is a bit painful to think through, though.
> 
> Don't we already have sample.int for that case?
> 
> Hadley
> 

For the 2nd case, yes, but I was aiming at getting sample(x) ==
x[sample.int(length(x))] also in the length 1 case, removing the
ambiguity. This would obviously break some code, but I'd expect not all
that much. However, it cannot be changed in one go, we'd need to go
through a sequence where we (e.g.)

1. warn about length(x)==1
2. say that length(x)==1 is deprecated
3. have length(x)==1 throw an error
4. wait....
5. give length(x)==1 a new meaning

-- 
Peter Dalgaard
Center for Statistics, Copenhagen Business School
Phone: (+45)38153501
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From hpages at fhcrc.org  Mon Jun 21 21:20:37 2010
From: hpages at fhcrc.org (=?ISO-8859-1?Q?Herv=E9_Pag=E8s?=)
Date: Mon, 21 Jun 2010 12:20:37 -0700
Subject: [Rd] No output/no source tarball produced by 'R CMD build' on
 Windows (but ret code is 0)
Message-ID: <4C1FBB85.5010405@fhcrc.org>

Hi,

After updating R-2.12 on the Bioconductor build system about 1 week ago
(we update R every 4-6 weeks for our devel builds), we've started to see
something never seen before on Windows: for some BioC packages,
'R CMD build' would produce no output at all (0 byte) and, of course,
no source tarball. Even though, the code returned by the command is 0!

See an example of this is here:

 
http://bioconductor.org/checkResults/2.7/bioc-LATEST/MotIV/liverpool-buildsrc.html
   (the content of this page is updated every day)

Note the:
   RetCode: 0
   PackageFile: None
and the lack of output!

This seems to happen randomly for a couple of packages every day. Today
it's for MotIV only. Last time I checked, it was charm and genefilter.
Before that, they were 2 other packages.

Note that the only thing that changed on our Windows build machine
liverpool (Windows Server 2003 R2 (32-bit)) is that R-2.12.0 was
updated to 2010-06-11 r52254.

Let me know if I can help in any way.

Thanks,
H.

-- 
Herv? Pag?s

Program in Computational Biology
Division of Public Health Sciences
Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N, M2-B876
P.O. Box 19024
Seattle, WA 98109-1024

E-mail: hpages at fhcrc.org
Phone:  (206) 667-5791
Fax:    (206) 667-1319


From kjetilbrinchmannhalvorsen at gmail.com  Tue Jun 22 03:15:47 2010
From: kjetilbrinchmannhalvorsen at gmail.com (Kjetil Halvorsen)
Date: Mon, 21 Jun 2010 21:15:47 -0400
Subject: [Rd] proposed change to 'sample'
In-Reply-To: <4C1EFF4D.4090206@gmail.com>
References: <4C1DE879.6040303@pburns.seanet.com>
	<77EB52C6DD32BA4D87471DCD70C8D700031C9A21@NA-PA-VBE03.na.tibco.com>
	<4C1E8408.1010609@gmail.com>
	<AANLkTilJm651mXnqOUFWhipqV11QOldSyjCyUD6IHric@mail.gmail.com>
	<4C1EFF4D.4090206@gmail.com>
Message-ID: <AANLkTinxWeL7gA5VshALNRIOl-SCbKX_43FXbaA72I-k@mail.gmail.com>

On Mon, Jun 21, 2010 at 1:57 AM, Peter Dalgaard <pdalgd at gmail.com> wrote:
> Hadley Wickham wrote:
>>> I would be more inclined to make sampling from a vector the normal case,
>>> and default x to say 1:max(n, size), forcing users to say sample(n=5) if
>>> sampling from x=1:5 is desired. This could be a manageable change; the
>>> deprecation sequence is a bit painful to think through, though.
>>
>> Don't we already have sample.int for that case?
>>
>> Hadley
>>
>
> For the 2nd case, yes, but I was aiming at getting sample(x) ==
> x[sample.int(length(x))] also in the length 1 case, removing the
> ambiguity. This would obviously break some code, but I'd expect not all
> that much. However, it cannot be changed in one go, we'd need to go
> through a sequence where we (e.g.)
>
> 1. warn about length(x)==1
> 2. say that length(x)==1 is deprecated
> 3. have length(x)==1 throw an error
> 4. wait....
> 5. give length(x)==1 a new meaning
>

Please implement this sequence!

Kjetil

> --
> Peter Dalgaard
> Center for Statistics, Copenhagen Business School
> Phone: (+45)38153501
> Email: pd.mes at cbs.dk ?Priv: PDalgd at gmail.com
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From david.kirkby at onetel.net  Tue Jun 22 12:09:31 2010
From: david.kirkby at onetel.net (Dr. David Kirkby)
Date: Tue, 22 Jun 2010 11:09:31 +0100
Subject: [Rd] Corrections for the R manual on Solaris
In-Reply-To: <4C1A0CD0.8010905@onetel.net>
References: <4C1A0CD0.8010905@onetel.net>
Message-ID: <4C208BDB.70002@onetel.net>

On 06/17/10 12:53 PM, Dr. David Kirkby wrote:
> There are a few errors in the R manual about Solaris.
>
> 1) Firstly you may know that Sun is now owned by Oracle.
>
> 2) "(Recent Sun machines are Opterons (?amd64?) rather than ?x86?, but
> 32-bit ?x86? executables are the default.) "
>
> It's not true to say that recent machines are Opterons rather than x86.
>
> Many new Sun machines are based on 64-bit Intel CPUs (often called x64).
> The machine I'm using, a Sun Ultra 27
>
> http://www.sun.com/desktop/workstation/ultra27/index.xml
>
> is less than 6 months old and has a quad core 3.33 GHz Intel Xeon in it.
>
> It is certainly true that some recent machine are Opterons.
>
> Note, 64-bit libraries for 64-bit systems, even those based on Intel
> CPUs, go in /usr/lib/amd64. Likewise many open-source software will
> install the 64-bit libraries in /usr/local/lib/amd64. There's no
> "intel64" or anything like that.
>
> 3) "Modern Solaris systems allow a large selection of Open Source
> software to be installed from http://www.opencsw.org (formerly
> http://www.blastwave.org) via pkg-get, "
>
> It should be noted that OpenCSW and Blastwave are both still in
> existence. There's a lot of animosity between the two camps, but both do
> exist. So one is not formally the other.
>
> Unfortunately, they both install software in /opt/csw, so I would be
> very weary of using both sites, as there is no coordination between them.
>
>
> Dave

Did nobody have any comments on this? Should I report this as a bug? I first 
posted this on r-help, where I was told r-devel would be more appropriate. But 
I've yet to get any response.

Dave


From ag at idesignsoftware.com  Tue Jun 22 16:57:46 2010
From: ag at idesignsoftware.com (Anne George)
Date: Tue, 22 Jun 2010 14:57:46 +0000
Subject: [Rd] Scrolling a tkcanvas non-starter
Message-ID: <W185611830227291277218666@webmail43>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20100622/016fd9c6/attachment.pl>

From bwhitcher at gmail.com  Tue Jun 22 19:04:32 2010
From: bwhitcher at gmail.com (Brandon Whitcher)
Date: Tue, 22 Jun 2010 18:04:32 +0100
Subject: [Rd] seek() and gzfile() on 32-bit R2.12.0 in linux
Message-ID: <AANLkTimhVNStzd1Dn1zAxJqBQcWigRiEFO6anq9_Av-m@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20100622/9ad3e3f3/attachment.pl>

From gustaf.rydevik at gmail.com  Tue Jun 22 19:33:57 2010
From: gustaf.rydevik at gmail.com (Gustaf Rydevik)
Date: Tue, 22 Jun 2010 19:33:57 +0200
Subject: [Rd] New errors with difftime()-objects in 2.11.1 (was Re: Request:
	difftime method for cut())
Message-ID: <AANLkTimQdhAQLFBa3zKzC4ry_3x3w3r4S0ew5uLxPapx@mail.gmail.com>

On Thu, Jun 10, 2010 at 3:39 PM, Gustaf Rydevik
<gustaf.rydevik at gmail.com> wrote:
> Hi all,
>
> The recent change in 2.11 that made as.numeric() return false on
> difftime-objects broke some of my code that calculated age classes of
> individuals using cut(). While this was no big thing to fix for me, it
> might be wise
> to provide a cut.difftime method to ?stop other old code from breaking.
> I'm guessing something as simple as
>
> cut.difftime<-function(x,...){
> x<-as.numeric(x)
> cut(x,...)
> }
>
> would suffice.
>
> best regards,
> Gustaf



As a followup, the change in how to treat difftime objects break even
more of my old code in a different project, since I'm used to treating
difftime as numeric in regressions and other analysis.
 And the error messages  become *very* obscure, I.e "Error: NA/NaN/Inf
in foreign function call (arg 2)" when applying loess to a difftime
object. Tracking down the source of those errors become quite a
nuisance.
I suppose there's no chance of reversing the change, but I'd
appreciate if someone could tell me the reason for introducing it so
abrubtly.

I'm cc'ing this to R-help, since there's probably more people than me
that will be bitten by this in the future when looking into old
projects.

Regards,
Gustaf Rydevik.




-- 
Gustaf Rydevik, M.Sci.
tel: +46(0)703 051 451
address:Essingetorget 40,112 66 Stockholm, SE
skype:gustaf_rydevik


From gustaf.rydevik at gmail.com  Tue Jun 22 20:01:52 2010
From: gustaf.rydevik at gmail.com (Gustaf Rydevik)
Date: Tue, 22 Jun 2010 20:01:52 +0200
Subject: [Rd] [R] New errors with difftime()-objects in 2.11.1 (was Re:
	Request: difftime method for cut())
In-Reply-To: <95B55055-CC4E-4D1C-9005-97E9C2E2DDAF@comcast.net>
References: <AANLkTimQdhAQLFBa3zKzC4ry_3x3w3r4S0ew5uLxPapx@mail.gmail.com> 
	<95B55055-CC4E-4D1C-9005-97E9C2E2DDAF@comcast.net>
Message-ID: <AANLkTilTYTbSqtBeMKqHCeZ-iMXh9Sxt4ApC-Ze-cHkp@mail.gmail.com>

On Tue, Jun 22, 2010 at 7:50 PM, David Winsemius <dwinsemius at comcast.net> wrote:
>
> On Jun 22, 2010, at 1:33 PM, Gustaf Rydevik wrote:

> Cannot help you there, but have you looked at the help page for difftime?
>
> "The as.double method returns the numeric value expressed in the specified
> units. Using units = "auto" means the units of the object."
>
>
> David Winsemius, MD
> West Hartford, CT
>
>

Oh, I forgot to mention that the workaround of using as.double (or
as.numeric) works fine, and I've done that.
It's just that it can take quite a while (as in several hours) to
figure out that the reason for the error is that you have to force
difftime objects to be numeric in 2.11.1, when the code's been working
fine before and the error messages are obscure.

Regards,
Gustaf




-- 
Gustaf Rydevik, M.Sci.
tel: +46(0)703 051 451
address:Essingetorget 40,112 66 Stockholm, SE
skype:gustaf_rydevik


From shotwelm at musc.edu  Tue Jun 22 20:44:51 2010
From: shotwelm at musc.edu (Matt Shotwell)
Date: Tue, 22 Jun 2010 14:44:51 -0400
Subject: [Rd] seek() and gzfile() on 32-bit R2.12.0 in linux
In-Reply-To: <AANLkTimhVNStzd1Dn1zAxJqBQcWigRiEFO6anq9_Av-m@mail.gmail.com>
References: <AANLkTimhVNStzd1Dn1zAxJqBQcWigRiEFO6anq9_Av-m@mail.gmail.com>
Message-ID: <1277232291.9622.83.camel@deacon>

You used file to open "ex.gz", which ought to work, but relies on do_url
to automatically detect that the file is a gzip file. It's a long shot,
but you could try to verify that the file is a valid gzip file (R checks
that the first two bytes == "\x1f\x8b") and try the gzfile function on
the 32 bit machine and see what happens. Also, it would be nice to see
the output of your sessionInfo(), in order to reproduce your finding.

This might be a bug in the R source:
(1 - unlikely) The C function do_url (src/main/connections.c) fails to
detect the gzip file on the 32 bit machine. Unfortunately, even if
do_url does detect a gzip file, the class of the returned connection
object is still marked c("file", "connection") rather than c("gzfile",
"connection"), so there's no easy check for this. Even so, this doesn't
explain why you get 7.80707e+17.

(2 - more likely) The zlib function gztell (declared:
src/extra/zlib/zlib.h defined: src/extra/zlib/gzlib.c) returns z_off_t.
The bug may relate to the size of z_off_t on the two different machines
and/or casting z_off_t to double (which is done just before the value is
returned by gzfile_seek, defined in src/main/connections.c). What a
headache. Need to reproduce the bug to investigate this further.

I have been wondering why double was used in the prototype for the seek
member of (struct Rconn), rather than an integer type. Presumably to
solve problems such as this. I'll be very interested to see what the
core team has to say here.

-Matt

On Tue, 2010-06-22 at 13:04 -0400, Brandon Whitcher wrote:
> I have installed both 32-bit and 64-bit versions of R2.12.0 (2010-06-15
> r52300) on my Ubuntu 10.04 64-bit system.  I observe the following behavior
> when running the examples from base::connections.  There appears to be a
> problem with seek() on a .gz file when using a 32-bit installation of
> R2.12.0, but the problem doesn't appear in the 64-bit installation.  I
> realize that seek() has been difficult in the past, and I don't want to open
> old wounds, but is this a known problem?  Is this easily fixable?  I have a
> package that relies on seek() when accessing gzipped files.
> 
> Using the 32-bit installation...
> 
> *> zz <- file("ex.data", "w")  # open an output file connection
> >      cat("TITLE extra line", "2 3 5 7", "", "11 13 17", file = zz, sep =
> "\n")
> >      cat("One more line\n", file = zz)
> >      close(zz)
> > blah = file("ex.data", "r")
> > seek(blah)
> [1] 0
> >
> > zz <- gzfile("ex.gz", "w")  # compressed file
> >      cat("TITLE extra line", "2 3 5 7", "", "11 13 17", file = zz, sep =
> "\n")
> >      close(zz)
> > blah = file("ex.gz", "r")
> > seek(blah)
> [1] 7.80707e+17
> >
> > zz <- bzfile("ex.bz2", "w")  # bzip2-ed file
> >      cat("TITLE extra line", "2 3 5 7", "", "11 13 17", file = zz, sep =
> "\n")
> >      close(zz)
> > blah = file("ex.bz2", "r")
> > seek(blah)
> Error in seek.connection(blah) : 'seek' not enabled for this connection
> >*
> 
> Using the 64-bit installation...
> 
> *> zz <- file("ex.data", "w")  # open an output file connection
> > cat("TITLE extra line", "2 3 5 7", "", "11 13 17", file = zz, sep = "\n")
> > cat("One more line\n", file = zz)
> > close(zz)
> > blah = file("ex.data", "r")
> > seek(blah)
> [1] 0
> >
> > zz <- gzfile("ex.gz", "w")  # compressed file
> > cat("TITLE extra line", "2 3 5 7", "", "11 13 17", file = zz, sep = "\n")
> > close(zz)
> > blah = file("ex.gz", "r")
> > seek(blah)
> [1] 0
> >
> > zz <- bzfile("ex.bz2", "w")  # bzip2-ed file
> > cat("TITLE extra line", "2 3 5 7", "", "11 13 17", file = zz, sep = "\n")
> > close(zz)
> > blah = file("ex.bz2", "r")
> > seek(blah)
> Error in seek.connection(blah) : 'seek' not enabled for this connection
> > *
> 
> thanks,
> 
> Brandon
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
-- 
Matthew S. Shotwell
Graduate Student
Division of Biostatistics and Epidemiology
Medical University of South Carolina
http://biostatmatt.com


From rvaradhan at jhmi.edu  Wed Jun 23 00:18:56 2010
From: rvaradhan at jhmi.edu (Ravi Varadhan)
Date: Tue, 22 Jun 2010 18:18:56 -0400
Subject: [Rd] constrOptim( ): conflict between help page and code
In-Reply-To: <19488.26410.3990.331503@stat.math.ethz.ch>
References: <OF083E2493.C6D8101F-ON85257745.000F613F-85257745.000F6140@american.edu>
	<4C19DECD.1000706@gmail.com> <001101cb0e24$54e50da0$feaf28e0$@edu>
	<005f01cb0e41$b9463400$2bd29c00$@edu>
	<19488.26410.3990.331503@stat.math.ethz.ch>
Message-ID: <7210a23a1b6c6.4c20fe90@johnshopkins.edu>

Dear R-devel,

I have re-worked the `constrOptim' function extensively to fix some bugs, and also to provide some extended functionality.  Please find attached the patch (with comments on the bug fixes and improvements).  

I am also attaching a "test" file that shows the difference between the "old" and "new" versions of `constrOptim'.

Best,
Ravi. 

____________________________________________________________________

Ravi Varadhan, Ph.D.
Assistant Professor,
Division of Geriatric Medicine and Gerontology
School of Medicine
Johns Hopkins University

Ph. (410) 502-2619
email: rvaradhan at jhmi.edu


----- Original Message -----
From: Martin Maechler <maechler at stat.math.ethz.ch>
Date: Tuesday, June 22, 2010 3:33 am
Subject: Re: [Rd] constrOptim( ): conflict between help page and code
To: Ravi Varadhan <rvaradhan at jhmi.edu>
Cc: maechler at stat.math.ethz.ch


> Dear Ravi,
>  What we (R-core) really want with such postings is a "diff" aka "patch"
>  against the R-devel (!) sources,
>  which you can get from 
>  
>    
>  
>  You produce a patch with e.g.
>  
>  diff -ubBw  <previousversion>constrOptim.R <myversion>constrOptim.R
>  
>  send that (possibly as attached file  e.g.  constrOptim.patch)
>  to R-devel 
>  
>  Best regards,
>  Martin 
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: constrOptim_PATCH_no_comments.txt
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20100622/f86e10af/attachment.txt>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: constrOptim_test.txt
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20100622/f86e10af/attachment-0001.txt>

From shotwelm at musc.edu  Wed Jun 23 05:41:24 2010
From: shotwelm at musc.edu (Matt Shotwell)
Date: Tue, 22 Jun 2010 23:41:24 -0400
Subject: [Rd] seek() and gzfile() on 32-bit R2.12.0 in linux
In-Reply-To: <AANLkTimhVNStzd1Dn1zAxJqBQcWigRiEFO6anq9_Av-m@mail.gmail.com>
References: <AANLkTimhVNStzd1Dn1zAxJqBQcWigRiEFO6anq9_Av-m@mail.gmail.com>
Message-ID: <1277264484.6311.85.camel@deacon>

I was able to reproduce this bug. After some investigating, it's clearly
localized to gztell (a zlib function), and the z_off_t type. However,
there may be a broader cross-compiling problem. I don't know what
procedure Brandon used to compile the 32 bit version (I used the gcc
-m32 flag), but we should be sure that we're doing this correctly (and
document it!) before going on a goose chase. The real issue may or may
not be related to zlib, but only manifested there. Discussion of my
findings are below.

-Matt

I checked to ensure that R's file function was recognizing the gzip file
as such. So that's not the problem. I next modified some code in
gzfile_seek, just above and below the call to gztell (line 1230 of
connections.c), and defined a small function z_off_t_print, to print the
bits of the z_off_t offset in least significant order (assuming little
endian):

static void z_off_t_print(z_off_t)
{
    z_off_t mask = 1; 
    while( mask > 0 ) {
        printf("%u", (mask & u) > 0 ); 
        mask <<= 1;
    }
    printf("\n");
}

static double gzfile_seek(Rconnection con, double where, int origin, int rw)
{
    gzFile  fp = ((Rgzfileconn)(con->private))->fp;

    /** begin modified code **/
    z_off_t pos;
    printf("sizeof(z_off_t): %u\n", sizeof(z_off_t));
    printf("sizeof(double): %u\n", sizeof(double));
    printf("before gztell():\n");
    z_off_t_print(pos);
    pos = gztell(fp);
    printf("after gztell():\n");
    z_off_t_print(pos);
    printf("(double) pos: %f\n", (double) pos);

    /** end modified code **/
    ...

Here's what happens running code similar to yours in the 32 bit build:

> zz <- gzfile("ex.gz", "w")  # compressed file
> cat("TITLE extra line", "2 3 5 7", 
+     "", "11 13 17", file = zz, sep = "\n")
> close(zz)
> blah = file("ex.gz", "r")
> seek(blah, 5)
sizeof(z_off_t): 8
sizeof(double): 8
before gztell():
000000000000000000000000000000000000000000000000000000000000000
after gztell():
000000000000000000000000000000000000110000111011110111001001000
(double) pos: 665367468683821056.000000
[1] 6.653675e+17
> seek(blah)
before gztell():
000000000000000000000000000000000000000000000000000000000000000
after gztell():
101000000000000000000000000000000000110000111011110111001001000
(double) pos: 665367468683821056.000000
[1] 6.653675e+17

Hence, gztell is doing what we expect in the least significant 32 bits
(which is binary for decimal 5), but returns junk in the most
significant 32 bits. Here are the results for the 64 bit build: 

> zz <- gzfile("ex.gz", "w")  # compressed file
> cat("TITLE extra line", "2 3 5 7", "", "11 13 17", file = zz, sep = "\n")
> close(zz)
> blah = file("ex.gz", "r")
> seek(blah, 5)
sizeof(z_off_t): 8
sizeof(double): 8
before gztell():
000000000000000000000000000000000000000000000000000000000000000
after gztell():
000000000000000000000000000000000000000000000000000000000000000
(double) pos: 0.000000
[1] 0
> seek(blah)
before gztell():
000000000000000000000000000000000000000000000000000000000000000
after gztell():
101000000000000000000000000000000000000000000000000000000000000
(double) pos: 5.000000
[1] 5

No problems with the 64 bit build.

On Tue, 2010-06-22 at 13:04 -0400, Brandon Whitcher wrote:
> I have installed both 32-bit and 64-bit versions of R2.12.0 (2010-06-15
> r52300) on my Ubuntu 10.04 64-bit system.  I observe the following behavior
> when running the examples from base::connections.  There appears to be a
> problem with seek() on a .gz file when using a 32-bit installation of
> R2.12.0, but the problem doesn't appear in the 64-bit installation.  I
> realize that seek() has been difficult in the past, and I don't want to open
> old wounds, but is this a known problem?  Is this easily fixable?  I have a
> package that relies on seek() when accessing gzipped files.
> 
> Using the 32-bit installation...
> 
> *> zz <- file("ex.data", "w")  # open an output file connection
> >      cat("TITLE extra line", "2 3 5 7", "", "11 13 17", file = zz, sep =
> "\n")
> >      cat("One more line\n", file = zz)
> >      close(zz)
> > blah = file("ex.data", "r")
> > seek(blah)
> [1] 0
> >
> > zz <- gzfile("ex.gz", "w")  # compressed file
> >      cat("TITLE extra line", "2 3 5 7", "", "11 13 17", file = zz, sep =
> "\n")
> >      close(zz)
> > blah = file("ex.gz", "r")
> > seek(blah)
> [1] 7.80707e+17
> >
> > zz <- bzfile("ex.bz2", "w")  # bzip2-ed file
> >      cat("TITLE extra line", "2 3 5 7", "", "11 13 17", file = zz, sep =
> "\n")
> >      close(zz)
> > blah = file("ex.bz2", "r")
> > seek(blah)
> Error in seek.connection(blah) : 'seek' not enabled for this connection
> >*
> 
> Using the 64-bit installation...
> 
> *> zz <- file("ex.data", "w")  # open an output file connection
> > cat("TITLE extra line", "2 3 5 7", "", "11 13 17", file = zz, sep = "\n")
> > cat("One more line\n", file = zz)
> > close(zz)
> > blah = file("ex.data", "r")
> > seek(blah)
> [1] 0
> >
> > zz <- gzfile("ex.gz", "w")  # compressed file
> > cat("TITLE extra line", "2 3 5 7", "", "11 13 17", file = zz, sep = "\n")
> > close(zz)
> > blah = file("ex.gz", "r")
> > seek(blah)
> [1] 0
> >
> > zz <- bzfile("ex.bz2", "w")  # bzip2-ed file
> > cat("TITLE extra line", "2 3 5 7", "", "11 13 17", file = zz, sep = "\n")
> > close(zz)
> > blah = file("ex.bz2", "r")
> > seek(blah)
> Error in seek.connection(blah) : 'seek' not enabled for this connection
> > *
> 
> thanks,
> 
> Brandon
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
-- 
Matthew S. Shotwell
Graduate Student
Division of Biostatistics and Epidemiology
Medical University of South Carolina
http://biostatmatt.com


From pdalgd at gmail.com  Wed Jun 23 07:13:58 2010
From: pdalgd at gmail.com (Peter Dalgaard)
Date: Wed, 23 Jun 2010 08:13:58 +0300
Subject: [Rd] [R] New errors with difftime()-objects in 2.11.1 (was Re:
 Request: difftime method for cut())
In-Reply-To: <AANLkTilTYTbSqtBeMKqHCeZ-iMXh9Sxt4ApC-Ze-cHkp@mail.gmail.com>
References: <AANLkTimQdhAQLFBa3zKzC4ry_3x3w3r4S0ew5uLxPapx@mail.gmail.com>
	<95B55055-CC4E-4D1C-9005-97E9C2E2DDAF@comcast.net>
	<AANLkTilTYTbSqtBeMKqHCeZ-iMXh9Sxt4ApC-Ze-cHkp@mail.gmail.com>
Message-ID: <4C219816.5010707@gmail.com>

Gustaf Rydevik wrote:

> Oh, I forgot to mention that the workaround of using as.double (or
> as.numeric) works fine, and I've done that.
> It's just that it can take quite a while (as in several hours) to
> figure out that the reason for the error is that you have to force
> difftime objects to be numeric in 2.11.1, when the code's been working
> fine before and the error messages are obscure.

I don't think you realize the problems that could occur by assuming that
difftime objects are numerics ON ANY PARTICULAR SCALE!

-- 
Peter Dalgaard
Center for Statistics, Copenhagen Business School
Phone: (+45)38153501
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From chiefmurphy at gmail.com  Wed Jun 23 09:16:41 2010
From: chiefmurphy at gmail.com (Daniel Murphy)
Date: Wed, 23 Jun 2010 00:16:41 -0700
Subject: [Rd] format: different S4 behavior in a package
Message-ID: <AANLkTinVWv3MMb1KcHkNTuEA_W8utTYkItRw3whz1Lkc@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20100623/9038724f/attachment.pl>

From ligges at statistik.tu-dortmund.de  Wed Jun 23 09:33:39 2010
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Wed, 23 Jun 2010 09:33:39 +0200
Subject: [Rd] format: different S4 behavior in a package
In-Reply-To: <AANLkTinVWv3MMb1KcHkNTuEA_W8utTYkItRw3whz1Lkc@mail.gmail.com>
References: <AANLkTinVWv3MMb1KcHkNTuEA_W8utTYkItRw3whz1Lkc@mail.gmail.com>
Message-ID: <4C21B8D3.3010508@statistik.tu-dortmund.de>

There is not a single definition of
formatMe()
in your message, therefore nothing works for me, not even the very first 
version...

Best,
Uwe Ligges


On 23.06.2010 09:16, Daniel Murphy wrote:
> R-Devel-ers:
>
> I have an S4 method that simply formats an object:
>
> setGeneric("formatMe", function(x) standardGeneric("formatMe"))
> setMethod("formatMe", "ANY", function(x) format(x))
>
> If I issue the above in an R session, then define an S4 class with its own
> format method, I get the desired result:
>
>> setClass("A",contains="numeric")
> [1] "A"
>> setMethod("format","A", function(x, ...) "Hey Jude")
> Creating a new generic function for "format" in ".GlobalEnv"
> [1] "format"
>> a<-new("A",1968)
>> formatMe(a)
> [1] "Hey Jude"
>
>
> However, if I put the two "formatMe" definitions into a package ("Test"), I
> do not get the desired result.
> <start new R session>
>
>> library(Test)
>> setClass("A",contains="numeric")
> [1] "A"
>> setMethod("format","A", function(x, ...) "Hey Jude")
> Creating a new generic function for "format" in ".GlobalEnv"
> [1] "format"
>> a<-new("A",1968)
>> formatMe(a)
> [1] "1968"
>
>
> The "disconnect" does not occur, however, if the S4 format method is an S3
> incarnation:
>
>> setClass("B",contains="numeric",S3methods=TRUE)
> [1] "B"
>> format.B<- function(x, ...) "Don't make it bad"
>> b<-new("B",1968)
>> formatMe(b)
> [1] "Don't make it bad"
>
> Could the problem be in Test's NAMESPACE file? There is only one line:
> exportMethods(formatMe)
>
> Here is Test's DESCRIPTION file:
> Package: Test
> Type: Package
> Title: Testing format
> Version: 1.0
> Date: 2010-06-22
> Author: Dan Murphy
> Maintainer: Dan Murphy<snipped>
> Depends: methods
> Description: Does format in a package work with S4 format method?
> License: GPL (>= 2)
> LazyLoad: yes
>
> (I would send the Help file, but I don't think that is the problem.)
>
> I am using version 2.11.1 on a Windows Vista machine.
>
> Any guidance would be appreciated. Thank you
>
> Dan Murphy
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


From pdalgd at gmail.com  Wed Jun 23 10:20:01 2010
From: pdalgd at gmail.com (Peter Dalgaard)
Date: Wed, 23 Jun 2010 11:20:01 +0300
Subject: [Rd] seek() and gzfile() on 32-bit R2.12.0 in linux
In-Reply-To: <AANLkTimhVNStzd1Dn1zAxJqBQcWigRiEFO6anq9_Av-m@mail.gmail.com>
References: <AANLkTimhVNStzd1Dn1zAxJqBQcWigRiEFO6anq9_Av-m@mail.gmail.com>
Message-ID: <4C21C3B1.1030406@gmail.com>

Brandon Whitcher wrote:
> I have installed both 32-bit and 64-bit versions of R2.12.0 (2010-06-15
> r52300) on my Ubuntu 10.04 64-bit system. 

Please notice that there is NO release of R 2.12.0 until some time
around October. You are using a build from the UNSTABLE development
branch. The stable branch is 2.11.1 with a release date of May 31. If
Ubuntu is claiming that there is such a thing as a R 2.12.0 release, I'd
say that they  have a problem.

Not that we don't welcome reports on problems in the development branch,
but do notice that it is by definition UNSTABLE, and that bugs can come
and go without notice.

-pd

 I observe the following behavior
> when running the examples from base::connections.  There appears to be a
> problem with seek() on a .gz file when using a 32-bit installation of
> R2.12.0, but the problem doesn't appear in the 64-bit installation.  I
> realize that seek() has been difficult in the past, and I don't want to open
> old wounds, but is this a known problem?  Is this easily fixable?  I have a
> package that relies on seek() when accessing gzipped files.
> 
> Using the 32-bit installation...
> 
> *> zz <- file("ex.data", "w")  # open an output file connection
>>      cat("TITLE extra line", "2 3 5 7", "", "11 13 17", file = zz, sep =
> "\n")
>>      cat("One more line\n", file = zz)
>>      close(zz)
>> blah = file("ex.data", "r")
>> seek(blah)
> [1] 0
>> zz <- gzfile("ex.gz", "w")  # compressed file
>>      cat("TITLE extra line", "2 3 5 7", "", "11 13 17", file = zz, sep =
> "\n")
>>      close(zz)
>> blah = file("ex.gz", "r")
>> seek(blah)
> [1] 7.80707e+17
>> zz <- bzfile("ex.bz2", "w")  # bzip2-ed file
>>      cat("TITLE extra line", "2 3 5 7", "", "11 13 17", file = zz, sep =
> "\n")
>>      close(zz)
>> blah = file("ex.bz2", "r")
>> seek(blah)
> Error in seek.connection(blah) : 'seek' not enabled for this connection
>> *
> 
> Using the 64-bit installation...
> 
> *> zz <- file("ex.data", "w")  # open an output file connection
>> cat("TITLE extra line", "2 3 5 7", "", "11 13 17", file = zz, sep = "\n")
>> cat("One more line\n", file = zz)
>> close(zz)
>> blah = file("ex.data", "r")
>> seek(blah)
> [1] 0
>> zz <- gzfile("ex.gz", "w")  # compressed file
>> cat("TITLE extra line", "2 3 5 7", "", "11 13 17", file = zz, sep = "\n")
>> close(zz)
>> blah = file("ex.gz", "r")
>> seek(blah)
> [1] 0
>> zz <- bzfile("ex.bz2", "w")  # bzip2-ed file
>> cat("TITLE extra line", "2 3 5 7", "", "11 13 17", file = zz, sep = "\n")
>> close(zz)
>> blah = file("ex.bz2", "r")
>> seek(blah)
> Error in seek.connection(blah) : 'seek' not enabled for this connection
>> *
> 
> thanks,
> 
> Brandon
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


-- 
Peter Dalgaard
Center for Statistics, Copenhagen Business School
Phone: (+45)38153501
Email: pd.mes at cbs.dk  Priv: PDalgd at gmail.com


From gustaf.rydevik at gmail.com  Wed Jun 23 10:57:56 2010
From: gustaf.rydevik at gmail.com (Gustaf Rydevik)
Date: Wed, 23 Jun 2010 10:57:56 +0200
Subject: [Rd] [R] New errors with difftime()-objects in 2.11.1 (was Re:
	Request: difftime method for cut())
In-Reply-To: <4C219816.5010707@gmail.com>
References: <AANLkTimQdhAQLFBa3zKzC4ry_3x3w3r4S0ew5uLxPapx@mail.gmail.com> 
	<95B55055-CC4E-4D1C-9005-97E9C2E2DDAF@comcast.net>
	<AANLkTilTYTbSqtBeMKqHCeZ-iMXh9Sxt4ApC-Ze-cHkp@mail.gmail.com> 
	<4C219816.5010707@gmail.com>
Message-ID: <AANLkTimGgwfmVoYgtaQTQc-2-XQy1YFils_LJC_5jfA_@mail.gmail.com>

On Wed, Jun 23, 2010 at 7:13 AM, Peter Dalgaard <pdalgd at gmail.com> wrote:
> Gustaf Rydevik wrote:
>
>> Oh, I forgot to mention that the workaround of using as.double (or
>> as.numeric) works fine, and I've done that.
>> It's just that it can take quite a while (as in several hours) to
>> figure out that the reason for the error is that you have to force
>> difftime objects to be numeric in 2.11.1, when the code's been working
>> fine before and the error messages are obscure.
>
> I don't think you realize the problems that could occur by assuming that
> difftime objects are numerics ON ANY PARTICULAR SCALE!
>
> --
> Peter Dalgaard
> Center for Statistics, Copenhagen Business School
> Phone: (+45)38153501
> Email: pd.mes at cbs.dk ?Priv: PDalgd at gmail.com
>


Ah. Yes, you're right that it would be problematic to say the least to
assume that the difftime object is measured in days and not in, say,
seconds. And I suppose that it makes sense to prioritize avoiding
calculations that give misleading results over forcing changes in old
code.  I was just caught somewhat unprepared, and I know that my
colleagues  who is not quite as R-literate will be even more
unprepared for old stuff no longer working.
Usually, R prepares the user for these kind of things by throwing
warnings a version or two before the change is actually implemented.
But I guess that's not always practical.

I take it that your argument would also work agains implementing
simple difftime-methods of functions as well, where you force difftime
objectws to be numeric? In that case, people can disregard my
suggestion of adding a difftime-method to cut().

Anyhow, I'll stop whining now. Thanks for the good work you're doing
in the R Core team.

Regards,
Gustaf

-- 
Gustaf Rydevik, M.Sci.
tel: +46(0)703 051 451
address:Essingetorget 40,112 66 Stockholm, SE
skype:gustaf_rydevik


From bwhitcher at gmail.com  Wed Jun 23 13:14:35 2010
From: bwhitcher at gmail.com (Brandon Whitcher)
Date: Wed, 23 Jun 2010 12:14:35 +0100
Subject: [Rd]  seek() and gzfile() on 32-bit R2.12.0 in linux
Message-ID: <AANLkTimFGwGqMQsTGMJ3Msi_JhbfllK5CED70Pf3Av4D@mail.gmail.com>

Peter, thanks for your comments.  The reason I have taken this issue
to R-devel is from the advice of Kurt Hornik.  An update to my package
oro.nifti is being refused by CRAN because it fails on the
_development_ version of R on 32-bit linux.  As we have just discussed
(and thanks to Matt's input), the problem is not with my package but
with the development version of R.  Hence, I wanted to alert to the R
Core Development Team that the _unstable_ version of R appears to have
a problem.

Obviously, I would prefer to have my new version of oro.nifti accepted
by CRAN... but at the moment I am in between a rock and a hard place.
I agree that the 2.12.0 release of R is quite far in the future.  Is
there a possibility of relaxing the exclusion criteria for CRAN?

cheers...

Brandon


Please notice that there is NO release of R 2.12.0 until some time
around October. You are using a build from the UNSTABLE development
branch. The stable branch is 2.11.1 with a release date of May 31. If
Ubuntu is claiming that there is such a thing as a R 2.12.0 release, I'd
say that they  have a problem.

Not that we don't welcome reports on problems in the development branch,
but do notice that it is by definition UNSTABLE, and that bugs can come
and go without notice.

-pd


From mtmorgan at fhcrc.org  Wed Jun 23 14:15:17 2010
From: mtmorgan at fhcrc.org (Martin Morgan)
Date: Wed, 23 Jun 2010 05:15:17 -0700
Subject: [Rd] format: different S4 behavior in a package
In-Reply-To: <AANLkTinVWv3MMb1KcHkNTuEA_W8utTYkItRw3whz1Lkc@mail.gmail.com>
References: <AANLkTinVWv3MMb1KcHkNTuEA_W8utTYkItRw3whz1Lkc@mail.gmail.com>
Message-ID: <4C21FAD5.6050806@fhcrc.org>

On 06/23/2010 12:16 AM, Daniel Murphy wrote:
> R-Devel-ers:
> 
> I have an S4 method that simply formats an object:
> 
> setGeneric("formatMe", function(x) standardGeneric("formatMe"))
> setMethod("formatMe", "ANY", function(x) format(x))
> 
> If I issue the above in an R session, then define an S4 class with its own
> format method, I get the desired result:
> 
>> setClass("A",contains="numeric")
> [1] "A"
>> setMethod("format","A", function(x, ...) "Hey Jude")
> Creating a new generic function for "format" in ".GlobalEnv"
> [1] "format"
>> a<-new("A",1968)
>> formatMe(a)
> [1] "Hey Jude"
> 
> 
> However, if I put the two "formatMe" definitions into a package ("Test"), I
> do not get the desired result.
> <start new R session>
> 
>> library(Test)
>> setClass("A",contains="numeric")
> [1] "A"
>> setMethod("format","A", function(x, ...) "Hey Jude")
> Creating a new generic function for "format" in ".GlobalEnv"

This is the clue -- you're creating a new S4 generic, so there's a
base::format, and a .GlobalEnv::format. Test::formatMe respects its name
space, and sees base::format.

In the S3 case, base::format is already an S3 generic, and you're just
adding a method, so there's only base::format for everyone to find.

In Test, you could setGeneric(format) and then export(format). It might
also be enough to just export(format); I'm not sure.

Martin

> [1] "format"
>> a<-new("A",1968)
>> formatMe(a)
> [1] "1968"
> 
> 
> The "disconnect" does not occur, however, if the S4 format method is an S3
> incarnation:
> 
>> setClass("B",contains="numeric",S3methods=TRUE)
> [1] "B"
>> format.B <- function(x, ...) "Don't make it bad"
>> b<-new("B",1968)
>> formatMe(b)
> [1] "Don't make it bad"
> 
> Could the problem be in Test's NAMESPACE file? There is only one line:
> exportMethods(formatMe)
> 
> Here is Test's DESCRIPTION file:
> Package: Test
> Type: Package
> Title: Testing format
> Version: 1.0
> Date: 2010-06-22
> Author: Dan Murphy
> Maintainer: Dan Murphy <snipped>
> Depends: methods
> Description: Does format in a package work with S4 format method?
> License: GPL (>= 2)
> LazyLoad: yes
> 
> (I would send the Help file, but I don't think that is the problem.)
> 
> I am using version 2.11.1 on a Windows Vista machine.
> 
> Any guidance would be appreciated. Thank you
> 
> Dan Murphy
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


-- 
Martin Morgan
Computational Biology / Fred Hutchinson Cancer Research Center
1100 Fairview Ave. N.
PO Box 19024 Seattle, WA 98109

Location: Arnold Building M1 B861
Phone: (206) 667-2793


From chiefmurphy at gmail.com  Wed Jun 23 17:03:34 2010
From: chiefmurphy at gmail.com (Daniel Murphy)
Date: Wed, 23 Jun 2010 08:03:34 -0700
Subject: [Rd] format: different S4 behavior in a package
In-Reply-To: <4C21FAD5.6050806@fhcrc.org>
References: <AANLkTinVWv3MMb1KcHkNTuEA_W8utTYkItRw3whz1Lkc@mail.gmail.com>
	<4C21FAD5.6050806@fhcrc.org>
Message-ID: <AANLkTikpEi5DlSV5qbUlv8FHRsMtnqRqnM1ERlMhVmgd@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20100623/bfbae7f6/attachment.pl>

From Robert.McGehee at geodecapital.com  Thu Jun 24 01:38:44 2010
From: Robert.McGehee at geodecapital.com (McGehee, Robert)
Date: Wed, 23 Jun 2010 19:38:44 -0400
Subject: [Rd] NAs and weighted.mean
Message-ID: <EEBC169715EB8C438D3C9283AF0F201C086C9061@MSGBOSCLM2WIN.DMN1.FMR.COM>

R-developers,
In version R 2.11.0, weighted.mean was changed such that:
> weighted.mean(NA, na.rm=TRUE)
[1] 0

rather than NaN as in previous versions of R. I see a note in the NEWS
file indicates that weighted.mean was changed "so an infinite value with
zero weight does not force an NaN result." 

In case the side effect of returning 0 rather than NaN in this case was
unintentional, I'd like to propose that this case be reverted such that
weighted.mean(NA, na.rm=TRUE) returns a NaN to be consistent with the
mean function. Otherwise perhaps a note should be added in the
documentation explaining this inconsistent behavior.

I believe this patch should fix the problem while preserving the
behavior in the NEWS file:
-    w <- w/sum(w)
-    sum((x*w)[w != 0])
+    sum((x*w)[w != 0])/sum(w)

Here's the full note from the NEWS file.
    o	The default method of weighted.mean(x, w) coerces 'w' to be
	numeric (aka double); previously only integer weights were
	coerced.  Zero weights are handled specially so an infinite
	value with zero weight does not force an NaN result.


Thanks, Robert


Robert McGehee, CFA
Geode Capital Management, LLC
One Post Office Square, 28th Floor | Boston, MA | 02109
Tel: 617/392-8396    Fax:617/476-6389
mailto:robert.mcgehee at geodecapital.com


>This e-mail, and any attachments hereto, are intended for use by the
addressee(s) only and may contain information that is (i) confidential
information of Geode Capital Management, LLC and/or its affiliates,
and/or (ii) proprietary information of Geode Capital Management, LLC
and/or its affiliates. If you are not the intended recipient of this
e-mail, or if you have otherwise received this e-mail in error, please
immediately notify me by telephone (you may call collect), or by e-mail,
and please permanently delete the original, any print outs and any
copies of the foregoing. Any dissemination, distribution or copying of
this e-mail is strictly prohibited. 


From maechler at stat.math.ethz.ch  Thu Jun 24 09:48:01 2010
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Thu, 24 Jun 2010 09:48:01 +0200
Subject: [Rd] seek() and gzfile() on 32-bit R2.12.0 in linux
In-Reply-To: <AANLkTimFGwGqMQsTGMJ3Msi_JhbfllK5CED70Pf3Av4D@mail.gmail.com>
References: <AANLkTimFGwGqMQsTGMJ3Msi_JhbfllK5CED70Pf3Av4D@mail.gmail.com>
Message-ID: <19491.3505.886799.72937@stat.math.ethz.ch>

>>>>> "BW" == Brandon Whitcher <bwhitcher at gmail.com>
>>>>>     on Wed, 23 Jun 2010 12:14:35 +0100 writes:

    BW> Peter, thanks for your comments.  The reason I have taken this issue
    BW> to R-devel is from the advice of Kurt Hornik.  An update to my package
    BW> oro.nifti is being refused by CRAN because it fails on the
    BW> _development_ version of R on 32-bit linux.  As we have just discussed
    BW> (and thanks to Matt's input), the problem is not with my package but
    BW> with the development version of R.  Hence, I wanted to alert to the R
    BW> Core Development Team that the _unstable_ version of R appears to have
    BW> a problem.

    BW> Obviously, I would prefer to have my new version of oro.nifti accepted
    BW> by CRAN... but at the moment I am in between a rock and a hard place.
    BW> I agree that the 2.12.0 release of R is quite far in the future.  Is
    BW> there a possibility of relaxing the exclusion criteria
    BW> for CRAN?

Well, the criteria are very  good as a general rule,
but in the case where a new/changed package reveals a *bug* in
R-devel (only), the package of course should still be released
to CRAN.
So the only remaining problem for you ;-)
is to convince the CRAN maintainers that indeed this is a bug in
R-devel, or probably in  zlib 1.2.4 (R 2.11.x uses zlib 1.2.3).

Within R-core, Brian Ripley has been the zlib "principal
investigator", and I'd wait a bit for his comment on this issue.

Martin Maechler, ETH Zurich and R-Core Team

    BW> cheers...
    BW> Brandon

      PD> Please notice that there is NO release of R 2.12.0 until some time
      PD> around October. You are using a build from the UNSTABLE development
      PD> branch. The stable branch is 2.11.1 with a release date of May 31. If
      PD> Ubuntu is claiming that there is such a thing as a R 2.12.0 release, I'd
      PD> say that they  have a problem.

      PD> Not that we don't welcome reports on problems in the development branch,
      PD> but do notice that it is by definition UNSTABLE, and that bugs can come
      PD> and go without notice.

      PD> -pd


From maechler at stat.math.ethz.ch  Thu Jun 24 10:18:32 2010
From: maechler at stat.math.ethz.ch (Martin Maechler)
Date: Thu, 24 Jun 2010 10:18:32 +0200
Subject: [Rd] NAs and weighted.mean
In-Reply-To: <EEBC169715EB8C438D3C9283AF0F201C086C9061@MSGBOSCLM2WIN.DMN1.FMR.COM>
References: <EEBC169715EB8C438D3C9283AF0F201C086C9061@MSGBOSCLM2WIN.DMN1.FMR.COM>
Message-ID: <19491.5336.6203.306663@stat.math.ethz.ch>

>>>>> "RobMcG" == McGehee, Robert <Robert.McGehee at geodecapital.com>
>>>>>     on Wed, 23 Jun 2010 19:38:44 -0400 writes:

    RobMcG> R-developers,
    RobMcG> In version R 2.11.0, weighted.mean was changed such that:
    >> weighted.mean(NA, na.rm=TRUE)
    RobMcG> [1] 0

    RobMcG> rather than NaN as in previous versions of R. 

which versions? 
Even in 2.10.0  it gave 0.

    RobMcG> rather than NaN as in previous versions of R. I see a note in the NEWS
    RobMcG> file indicates that weighted.mean was changed "so an infinite value with
    RobMcG> zero weight does not force an NaN result." 

    RobMcG> In case the side effect of returning 0 rather than NaN in this case was
    RobMcG> unintentional, I'd like to propose that this case be reverted such that
    RobMcG> weighted.mean(NA, na.rm=TRUE) returns a NaN to be consistent with the
    RobMcG> mean function.

I tend to agree with you.
Note that also, for such functions FUN
       
        FUN(NA, na.rm=TRUE)
identical to
        FUN( numeric(0) )

and for "mean-like" functions I agree it should return NaN (or NA, perhaps).


    RobMcG>  Otherwise perhaps a note should be added in the
    RobMcG>  documentation explaining this inconsistent
    RobMcG>  behavior.

    RobMcG> I believe this patch should fix the problem while preserving the
    RobMcG> behavior in the NEWS file:
    RobMcG> -    w <- w/sum(w)
    RobMcG> -    sum((x*w)[w != 0])
    RobMcG> +    sum((x*w)[w != 0])/sum(w)d

Yes, it seems so, and I will probably commit it,  for R-devel
at first, and R-patched later after a while.

Martin Maechler, ETH Zurich

    RobMcG> Here's the full note from the NEWS file.
    RobMcG> o	The default method of weighted.mean(x, w) coerces 'w' to be
    RobMcG> numeric (aka double); previously only integer weights were
    RobMcG> coerced.  Zero weights are handled specially so an infinite
    RobMcG> value with zero weight does not force an NaN result.


    RobMcG> Thanks, Robert

     ............


From ripley at stats.ox.ac.uk  Thu Jun 24 14:37:09 2010
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Thu, 24 Jun 2010 13:37:09 +0100 (BST)
Subject: [Rd] seek() and gzfile() on 32-bit R2.12.0 in linux
In-Reply-To: <19491.3505.886799.72937@stat.math.ethz.ch>
References: <AANLkTimFGwGqMQsTGMJ3Msi_JhbfllK5CED70Pf3Av4D@mail.gmail.com>
	<19491.3505.886799.72937@stat.math.ethz.ch>
Message-ID: <alpine.LFD.2.00.1006241332180.28109@localhost>

On Thu, 24 Jun 2010, Martin Maechler wrote:

>>>>>> "BW" == Brandon Whitcher <bwhitcher at gmail.com>
>>>>>>     on Wed, 23 Jun 2010 12:14:35 +0100 writes:
>
>    BW> Peter, thanks for your comments.  The reason I have taken this issue
>    BW> to R-devel is from the advice of Kurt Hornik.  An update to my package
>    BW> oro.nifti is being refused by CRAN because it fails on the
>    BW> _development_ version of R on 32-bit linux.  As we have just discussed
>    BW> (and thanks to Matt's input), the problem is not with my package but
>    BW> with the development version of R.  Hence, I wanted to alert to the R
>    BW> Core Development Team that the _unstable_ version of R appears to have
>    BW> a problem.
>
>    BW> Obviously, I would prefer to have my new version of oro.nifti accepted
>    BW> by CRAN... but at the moment I am in between a rock and a hard place.
>    BW> I agree that the 2.12.0 release of R is quite far in the future.  Is
>    BW> there a possibility of relaxing the exclusion criteria
>    BW> for CRAN?
>
> Well, the criteria are very  good as a general rule,
> but in the case where a new/changed package reveals a *bug* in
> R-devel (only), the package of course should still be released
> to CRAN.
> So the only remaining problem for you ;-)
> is to convince the CRAN maintainers that indeed this is a bug in
> R-devel, or probably in  zlib 1.2.4 (R 2.11.x uses zlib 1.2.3).
>
> Within R-core, Brian Ripley has been the zlib "principal
> investigator", and I'd wait a bit for his comment on this issue.

I've no time at present, or more precisely what very little time I 
have has other priorities.  Back to more normal July 12.

Brian

>
> Martin Maechler, ETH Zurich and R-Core Team
>
>    BW> cheers...
>    BW> Brandon
>
>      PD> Please notice that there is NO release of R 2.12.0 until some time
>      PD> around October. You are using a build from the UNSTABLE development
>      PD> branch. The stable branch is 2.11.1 with a release date of May 31. If
>      PD> Ubuntu is claiming that there is such a thing as a R 2.12.0 release, I'd
>      PD> say that they  have a problem.
>
>      PD> Not that we don't welcome reports on problems in the development branch,
>      PD> but do notice that it is by definition UNSTABLE, and that bugs can come
>      PD> and go without notice.
>
>      PD> -pd
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From simon.urbanek at r-project.org  Thu Jun 24 18:53:54 2010
From: simon.urbanek at r-project.org (Simon Urbanek)
Date: Thu, 24 Jun 2010 12:53:54 -0400
Subject: [Rd] How to debug: Cons memory exhausted
In-Reply-To: <AANLkTik4abuGDhcDZAU42IBOeLS06VjrvnfZiN5MDWb_@mail.gmail.com>
References: <AANLkTik4abuGDhcDZAU42IBOeLS06VjrvnfZiN5MDWb_@mail.gmail.com>
Message-ID: <E1191971-B855-4717-8CB3-C042DFA5E708@r-project.org>


On Jun 20, 2010, at 11:15 AM, Saptarshi Guha wrote:

> Hello,
> I get an error when binary structures from a pipe
> 
> 'Error: cons memory exhausted (limit reached?)' (but R does not crash)
> 
> This is probably due to some bug in my code, but occurs after reading
> about 85K pairs of RAWSXP objects (each < 20 bytes).
> 
> I do not have any explicit calls to malloc/calloc
> 

It has nothing to do with malloc/calloc - it means that the number of nodes (=R objects) has reached the limit. Normally the limit is soft so it will adjust up to SIZE_MAX (for all practical purposes unlimited on 64-bit machines). However, in low-memory conditions it may not be possible to allocate more heap space so that is more likely your limit.


> I'm going through my code and have inserted the (brute force) printf
> statements
> my question is: Does anybody have an advice on debugging this particular
> error?
> 

You can set a breakpoint on mem_err_cons. In general it means that you are simply running out of memory.

Cheers,
Simon


From hpages at fhcrc.org  Fri Jun 25 00:11:18 2010
From: hpages at fhcrc.org (=?ISO-8859-1?Q?Herv=E9_Pag=E8s?=)
Date: Thu, 24 Jun 2010 15:11:18 -0700
Subject: [Rd] No output/no source tarball produced by 'R CMD build' on
 Windows (but ret code is 0)
In-Reply-To: <4C1FBB85.5010405@fhcrc.org>
References: <4C1FBB85.5010405@fhcrc.org>
Message-ID: <4C23D806.2050107@fhcrc.org>

Hi,

Just to note that, after updating to R-2.12.0 2010-06-22 r52364, the
problem is still here. Today's victim are altcdfenvs and CALIB:

http://bioconductor.org/checkResults/2.7/bioc-LATEST/altcdfenvs/liverpool-buildsrc.html
http://bioconductor.org/checkResults/2.7/bioc-LATEST/CALIB/liverpool-buildsrc.html

Cheers,
H.

On 06/21/2010 12:20 PM, Herv? Pag?s wrote:
> Hi,
>
> After updating R-2.12 on the Bioconductor build system about 1 week ago
> (we update R every 4-6 weeks for our devel builds), we've started to see
> something never seen before on Windows: for some BioC packages,
> 'R CMD build' would produce no output at all (0 byte) and, of course,
> no source tarball. Even though, the code returned by the command is 0!
>
> See an example of this is here:
>
>
> http://bioconductor.org/checkResults/2.7/bioc-LATEST/MotIV/liverpool-buildsrc.html 
>
>   (the content of this page is updated every day)
>
> Note the:
>   RetCode: 0
>   PackageFile: None
> and the lack of output!
>
> This seems to happen randomly for a couple of packages every day. Today
> it's for MotIV only. Last time I checked, it was charm and genefilter.
> Before that, they were 2 other packages.
>
> Note that the only thing that changed on our Windows build machine
> liverpool (Windows Server 2003 R2 (32-bit)) is that R-2.12.0 was
> updated to 2010-06-11 r52254.
>
> Let me know if I can help in any way.
>
> Thanks,
> H.
>


From shotwelm at musc.edu  Fri Jun 25 15:10:38 2010
From: shotwelm at musc.edu (Matt Shotwell)
Date: Fri, 25 Jun 2010 09:10:38 -0400
Subject: [Rd] seek() and gzfile() on 32-bit R2.12.0 in linux
In-Reply-To: <19491.3505.886799.72937@stat.math.ethz.ch>
References: <AANLkTimFGwGqMQsTGMJ3Msi_JhbfllK5CED70Pf3Av4D@mail.gmail.com>
	<19491.3505.886799.72937@stat.math.ethz.ch>
Message-ID: <1277471438.4035.36.camel@deacon>

On Thu, 2010-06-24 at 03:48 -0400, Martin Maechler wrote: 
> >>>>> "BW" == Brandon Whitcher <bwhitcher at gmail.com>
> >>>>>     on Wed, 23 Jun 2010 12:14:35 +0100 writes:
> 
>     BW> Peter, thanks for your comments.  The reason I have taken this issue
>     BW> to R-devel is from the advice of Kurt Hornik.  An update to my package
>     BW> oro.nifti is being refused by CRAN because it fails on the
>     BW> _development_ version of R on 32-bit linux.  As we have just discussed
>     BW> (and thanks to Matt's input), the problem is not with my package but
>     BW> with the development version of R.  Hence, I wanted to alert to the R
>     BW> Core Development Team that the _unstable_ version of R appears to have
>     BW> a problem.
> 
>     BW> Obviously, I would prefer to have my new version of oro.nifti accepted
>     BW> by CRAN... but at the moment I am in between a rock and a hard place.
>     BW> I agree that the 2.12.0 release of R is quite far in the future.  Is
>     BW> there a possibility of relaxing the exclusion criteria
>     BW> for CRAN?
> 
> Well, the criteria are very  good as a general rule,
> but in the case where a new/changed package reveals a *bug* in
> R-devel (only), the package of course should still be released
> to CRAN.
> So the only remaining problem for you ;-)
> is to convince the CRAN maintainers that indeed this is a bug in
> R-devel, or probably in  zlib 1.2.4 (R 2.11.x uses zlib 1.2.3).

Indeed, according to the zlib website, there were significant changes to
the gzip internals in version 1.2.4. In fact, they have already fixed a
"big fat stinking bug in gzseek()", and recommend immediate upgrade to
version 1.2.5. I compiled zlib version 1.2.5 into R, but Brandon's bug
persists.

However, I believe this may not be a code bug, but a configuration bug
related to Large File Support and cross-compiling from 64 to 32 bits.
The zlib made changes to their LFS support in the 1.2.4 series. When I
cross-compile R-devel using a custom configuration (adding
-D_LARGEFILE64_SOURCE -m32 to compiler flags), Brandon's code appears to
work correctly. I have more details, and would be happy to discuss this
with whoever maintains the 64/32 bit R-devel build for CRAN.

> 
> Within R-core, Brian Ripley has been the zlib "principal
> investigator", and I'd wait a bit for his comment on this issue.
> 
> Martin Maechler, ETH Zurich and R-Core Team
> 
>     BW> cheers...
>     BW> Brandon
> 
>       PD> Please notice that there is NO release of R 2.12.0 until some time
>       PD> around October. You are using a build from the UNSTABLE development
>       PD> branch. The stable branch is 2.11.1 with a release date of May 31. If
>       PD> Ubuntu is claiming that there is such a thing as a R 2.12.0 release, I'd
>       PD> say that they  have a problem.
> 
>       PD> Not that we don't welcome reports on problems in the development branch,
>       PD> but do notice that it is by definition UNSTABLE, and that bugs can come
>       PD> and go without notice.
> 
>       PD> -pd
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
-- 
Matthew S. Shotwell
Graduate Student
Division of Biostatistics and Epidemiology
Medical University of South Carolina
http://biostatmatt.com


From vogranovich at jumptrading.com  Sun Jun 27 02:14:06 2010
From: vogranovich at jumptrading.com (Vadim Ogranovich)
Date: Sat, 26 Jun 2010 19:14:06 -0500
Subject: [Rd] [R] converting result of substitute to 'ordidnary'
	expression
In-Reply-To: <Pine.LNX.4.64.1006251903110.30119@tajo.ucsd.edu>
References: <22D850BC39A25742977325ADDE208E7702CB5CC19D@chiexchange02.w2k.jumptrading.com>
	<Pine.LNX.4.64.1006251903110.30119@tajo.ucsd.edu>
Message-ID: <22D850BC39A25742977325ADDE208E7702CB5CC1A0@chiexchange02.w2k.jumptrading.com>

I switched the thread to r-devel because here I am proposing a patch for subset.data.frame().


Thank you Chuck, it was inspiring. It turns out that a simple modification to subset.data.frame makes my example work:

subset.data.frame <-
  function (x, subset, select, drop = FALSE, ...)
{
  if (missing(subset))
    r <- TRUE
  else {
    r <- eval(substitute(subset), x, parent.frame())

    if (!is.logical(r)) {
      ## try w/o substitute
      r <- eval(subset, x, parent.frame())
    }

    if (!is.logical(r))
      stop("'subset' must evaluate to logical")

    r <- r & !is.na(r)
  }
  if (missing(select))
    vars <- TRUE
  else {
    nl <- as.list(1L:ncol(x))
    names(nl) <- names(x)
    vars <- eval(substitute(select), nl, parent.frame())
  }
  x[r, vars, drop = drop]
}


And now:
> dat <- data.frame(x=1:10, y=1:10)

> subset(dat, 5<x)
    x  y
6   6  6
7   7  7
8   8  8
9   9  9
10 10 10

> subsetexp <- expression(5<x)

> subset(dat, subsetexp)
    x  y
6   6  6
7   7  7
8   8  8
9   9  9
10 10 10


> do.call(subset, list(dat, subsetexp))
    x  y
6   6  6
7   7  7
8   8  8
9   9  9
10 10 10

> version
               _
platform       i386-pc-mingw32
arch           i386
os             mingw32
system         i386, mingw32
status
major          2
minor          9.1
year           2009
month          06
day            26
svn rev        48839
language       R
version.string R version 2.9.1 (2009-06-26)


Thank you,
Vadim



-----Original Message-----
From: Charles C. Berry [mailto:cberry at tajo.ucsd.edu]
Sent: Friday, June 25, 2010 9:16 PM
To: Vadim Ogranovich
Cc: 'r-help at r-project.org'
Subject: Re: [R] converting result of substitute to 'ordidnary' expression

On Fri, 25 Jun 2010, Vadim Ogranovich wrote:

> Dear R users,
>
>
> As substitute() help page points out:
>     Substituting and quoting often causes confusion when the argument
>     is 'expression(...)'. The result is a call to the 'expression'
>     constructor function and needs to be evaluated with 'eval' to give
>     the actual expression object.
>
> And indeed I am confused. Consider:
>
>> dat <- data.frame(x=1:10, y=1:10)
>
>> subsetexp <- substitute(a<x, list(a=5))
>
> ## this doesn't work
>> subset(dat, subsetexp)
> Error in subset.data.frame(dat, subsetexp) :
>  'subset' must evaluate to logical
>
> ## this does work (thanks to the help page), but one needs to remember to call eval
>> subset(dat, eval(subsetexp))
>
>
> Is there a way to create subsetexp that needs no eval inside the call to subset()?

I do not think so. See

        page(subset.data.frame,'print')

Then think about this:

> eval(substitute(subsetexp))
5 < x
> eval(substitute(subsetexp),list(x=2))
5 < x
> eval(substitute(eval(subsetexp)),list(x=2))
[1] FALSE
>

The added layer of substitution is making things a bit tricky.

One alternative is to build up your own call like this:

> sss <- expression(subset(dat,sbst))
> sss[[1]][[3]] <- subsetexp
> sss
expression(subset(dat, 5 < x))
> eval(sss)
     x  y
6   6  6
7   7  7
8   8  8
9   9  9
10 10 10
>

HTH,

Chuck


>
> I experimented with the following, but it didn't work:
>> subsetexp <- eval(substitute(a<x, list(a=5)))
> Error in eval(expr, envir, enclos) : object 'x' not found
>
> Thank you very much for your help,
> Vadim
>
> Note: This email is for the confidential use of the named addressee(s) only and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you are hereby notified that any review, dissemination or copying of this email is strictly prohibited, and to please notify the sender immediately and destroy this email and any attachments.  Email transmission cannot be guaranteed to be secure or error-free.  Jump Trading, therefore, does not make any guarantees as to the completeness or accuracy of this email or any attachments.  This email is for informational purposes only and does not constitute a recommendation, offer, request or solicitation of any kind to buy, sell, subscribe, redeem or perform any type of transaction of a financial product.
>
> ______________________________________________
> R-help at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.
>

Charles C. Berry                            (858) 534-2098
                                             Dept of Family/Preventive Medicine
E mailto:cberry at tajo.ucsd.edu               UC San Diego
http://famprevmed.ucsd.edu/faculty/cberry/  La Jolla, San Diego 92093-0901



Note: This email is for the confidential use of the named addressee(s) only and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you are hereby notified that any review, dissemination or copying of this email is strictly prohibited, and to please notify the sender immediately and destroy this email and any attachments.  Email transmission cannot be guaranteed to be secure or error-free.  Jump Trading, therefore, does not make any guarantees as to the completeness or accuracy of this email or any attachments.  This email is for informational purposes only and does not constitute a recommendation, offer, request or solicitation of any kind to buy, sell, subscribe, redeem or perform any type of transaction of a financial product.


From p.murrell at auckland.ac.nz  Sun Jun 27 23:42:40 2010
From: p.murrell at auckland.ac.nz (Paul Murrell)
Date: Mon, 28 Jun 2010 09:42:40 +1200
Subject: [Rd] support for polygons with holes
Message-ID: <4C27C5D0.5010801@auckland.ac.nz>

Hi

This is for developers of extension packages that provide extra
*graphics devices* for R.

In the *development* version of R, support has been added to the
graphics engine for rendering polygons with holes (e.g., maps with lakes 
with islands ...).

The API change is a new dev_Path() function for graphics devices.

The R_GE_version constant (in GraphicsEngine.h) has been bumped up to 8
as a marker of this change.

This means that, at a minimum, all graphics devices should be updated to 
provide dummy implementations of the new functions to just say that the 
feature is not yet implemented (see for example the PicTeX and XFig
devices in the 'grDevices' package).

A full implementation of dev_Path() should be able to render paths that 
consist of multiple sub-paths which can be filled using either the 
even-odd rule or the non-zero winding rule (see the examples in 
polypath() from 'graphics' or grid.path() from 'grid').

Paul
-- 
Dr Paul Murrell
Department of Statistics
The University of Auckland
Private Bag 92019
Auckland
New Zealand
64 9 3737599 x85392
paul at stat.auckland.ac.nz
http://www.stat.auckland.ac.nz/~paul/


From mdowle at mdowle.plus.com  Mon Jun 28 16:36:29 2010
From: mdowle at mdowle.plus.com (Matthew Dowle)
Date: Mon, 28 Jun 2010 15:36:29 +0100
Subject: [Rd] [R] converting result of substitute to
	'ordidnary'expression
References: <22D850BC39A25742977325ADDE208E7702CB5CC19D@chiexchange02.w2k.jumptrading.com><Pine.LNX.4.64.1006251903110.30119@tajo.ucsd.edu>
	<22D850BC39A25742977325ADDE208E7702CB5CC1A0@chiexchange02.w2k.jumptrading.com>
Message-ID: <i0ac1f$ldc$1@dough.gmane.org>


> ## this does work (thanks to the help page), but one needs to remember to 
> call eval
> subset(dat, eval(subsetexp))
> Is there a way to create subsetexp that needs no eval inside the call to 
> subset()?

Whats wrong with needing to call eval ?  If I'm reading that code, and 
someone else wrote it, or I wrote it a long time
ago, then I immediately know to look above that line for where subsetexp 
gets its expression. I like seeing eval() as
it makes it clearer what the programmer intended.

Matthew


"Vadim Ogranovich" <vogranovich at jumptrading.com> wrote in message 
news:22D850BC39A25742977325ADDE208E7702CB5CC1A0 at chiexchange02.w2k.jumptrading.com...
>I switched the thread to r-devel because here I am proposing a patch for 
>subset.data.frame().
>
>
> Thank you Chuck, it was inspiring. It turns out that a simple modification 
> to subset.data.frame makes my example work:
>
> subset.data.frame <-
>  function (x, subset, select, drop = FALSE, ...)
> {
>  if (missing(subset))
>    r <- TRUE
>  else {
>    r <- eval(substitute(subset), x, parent.frame())
>
>    if (!is.logical(r)) {
>      ## try w/o substitute
>      r <- eval(subset, x, parent.frame())
>    }
>
>    if (!is.logical(r))
>      stop("'subset' must evaluate to logical")
>
>    r <- r & !is.na(r)
>  }
>  if (missing(select))
>    vars <- TRUE
>  else {
>    nl <- as.list(1L:ncol(x))
>    names(nl) <- names(x)
>    vars <- eval(substitute(select), nl, parent.frame())
>  }
>  x[r, vars, drop = drop]
> }
>
>
> And now:
>> dat <- data.frame(x=1:10, y=1:10)
>
>> subset(dat, 5<x)
>    x  y
> 6   6  6
> 7   7  7
> 8   8  8
> 9   9  9
> 10 10 10
>
>> subsetexp <- expression(5<x)
>
>> subset(dat, subsetexp)
>    x  y
> 6   6  6
> 7   7  7
> 8   8  8
> 9   9  9
> 10 10 10
>
>
>> do.call(subset, list(dat, subsetexp))
>    x  y
> 6   6  6
> 7   7  7
> 8   8  8
> 9   9  9
> 10 10 10
>
>> version
>               _
> platform       i386-pc-mingw32
> arch           i386
> os             mingw32
> system         i386, mingw32
> status
> major          2
> minor          9.1
> year           2009
> month          06
> day            26
> svn rev        48839
> language       R
> version.string R version 2.9.1 (2009-06-26)
>
>
> Thank you,
> Vadim
>
>
>
> -----Original Message-----
> From: Charles C. Berry [mailto:cberry at tajo.ucsd.edu]
> Sent: Friday, June 25, 2010 9:16 PM
> To: Vadim Ogranovich
> Cc: 'r-help at r-project.org'
> Subject: Re: [R] converting result of substitute to 'ordidnary' expression
>
> On Fri, 25 Jun 2010, Vadim Ogranovich wrote:
>
>> Dear R users,
>>
>>
>> As substitute() help page points out:
>>     Substituting and quoting often causes confusion when the argument
>>     is 'expression(...)'. The result is a call to the 'expression'
>>     constructor function and needs to be evaluated with 'eval' to give
>>     the actual expression object.
>>
>> And indeed I am confused. Consider:
>>
>>> dat <- data.frame(x=1:10, y=1:10)
>>
>>> subsetexp <- substitute(a<x, list(a=5))
>>
>> ## this doesn't work
>>> subset(dat, subsetexp)
>> Error in subset.data.frame(dat, subsetexp) :
>>  'subset' must evaluate to logical
>>
>> ## this does work (thanks to the help page), but one needs to remember to 
>> call eval
>>> subset(dat, eval(subsetexp))
>>
>>
>> Is there a way to create subsetexp that needs no eval inside the call to 
>> subset()?
>
> I do not think so. See
>
>        page(subset.data.frame,'print')
>
> Then think about this:
>
>> eval(substitute(subsetexp))
> 5 < x
>> eval(substitute(subsetexp),list(x=2))
> 5 < x
>> eval(substitute(eval(subsetexp)),list(x=2))
> [1] FALSE
>>
>
> The added layer of substitution is making things a bit tricky.
>
> One alternative is to build up your own call like this:
>
>> sss <- expression(subset(dat,sbst))
>> sss[[1]][[3]] <- subsetexp
>> sss
> expression(subset(dat, 5 < x))
>> eval(sss)
>     x  y
> 6   6  6
> 7   7  7
> 8   8  8
> 9   9  9
> 10 10 10
>>
>
> HTH,
>
> Chuck
>
>
>>
>> I experimented with the following, but it didn't work:
>>> subsetexp <- eval(substitute(a<x, list(a=5)))
>> Error in eval(expr, envir, enclos) : object 'x' not found
>>
>> Thank you very much for your help,
>> Vadim
>>
>> Note: This email is for the confidential use of the named addressee(s) 
>> only and may contain proprietary, confidential or privileged information. 
>> If you are not the intended recipient, you are hereby notified that any 
>> review, dissemination or copying of this email is strictly prohibited, 
>> and to please notify the sender immediately and destroy this email and 
>> any attachments.  Email transmission cannot be guaranteed to be secure or 
>> error-free.  Jump Trading, therefore, does not make any guarantees as to 
>> the completeness or accuracy of this email or any attachments.  This 
>> email is for informational purposes only and does not constitute a 
>> recommendation, offer, request or solicitation of any kind to buy, sell, 
>> subscribe, redeem or perform any type of transaction of a financial 
>> product.
>>
>> ______________________________________________
>> R-help at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-help
>> PLEASE do read the posting guide 
>> http://www.R-project.org/posting-guide.html
>> and provide commented, minimal, self-contained, reproducible code.
>>
>
> Charles C. Berry                            (858) 534-2098
>                                             Dept of Family/Preventive 
> Medicine
> E mailto:cberry at tajo.ucsd.edu               UC San Diego
> http://famprevmed.ucsd.edu/faculty/cberry/  La Jolla, San Diego 92093-0901
>
>
>
> Note: This email is for the confidential use of the named addressee(s) 
> only and may contain proprietary, confidential or privileged information. 
> If you are not the intended recipient, you are hereby notified that any 
> review, dissemination or copying of this email is strictly prohibited, and 
> to please notify the sender immediately and destroy this email and any 
> attachments.  Email transmission cannot be guaranteed to be secure or 
> error-free.  Jump Trading, therefore, does not make any guarantees as to 
> the completeness or accuracy of this email or any attachments.  This email 
> is for informational purposes only and does not constitute a 
> recommendation, offer, request or solicitation of any kind to buy, sell, 
> subscribe, redeem or perform any type of transaction of a financial 
> product.
>


From Robert.McGehee at geodecapital.com  Tue Jun 29 16:46:06 2010
From: Robert.McGehee at geodecapital.com (McGehee, Robert)
Date: Tue, 29 Jun 2010 10:46:06 -0400
Subject: [Rd] POSIXlt matching bug
Message-ID: <EEBC169715EB8C438D3C9283AF0F201C08A7C74E@MSGBOSCLM2WIN.DMN1.FMR.COM>

I came across the below mis-feature/bug using match with POSIXlt objects
(from strptime) in R 2.11.1 (though this appears to be an old issue).

> x <- as.POSIXlt(Sys.Date())
> table <- as.POSIXlt(Sys.Date()+0:5)
> length(x)
[1] 1
> x %in% table  # I expect TRUE
[1] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
> match(x, table) # I expect 1
[1] NA NA NA NA NA NA NA NA NA

This behavior seemed more plausible when the length of a POSIXlt object
was 9 (back in the day), however since the length was redefined, the
length of x no longer matches the length of the match function output,
as specified by the ?match documentation: "A vector of the same length
as 'x'".

I would normally suggest that we add a POSIXlt method for match that
converts x into POSIXct or character first. However, match does not
appear to be generic. Below is a possible rewrite of match that appears
to work as desired.

match <- function(x, table, nomatch = NA_integer_, incomparables = NULL)

    .Internal(match(if(is.factor(x)||inherits(x, "POSIXlt"))
as.character(x) else x,
                    if(is.factor(table)||inherits(table, "POSIXlt"))
as.character(table) else table,
                    nomatch, incomparables))

That said, I understand some people may be very sensitive to the speed
of the match function, and may prefer a simple change to the ?match
documentation noting this (odd) behavior for POSIXlt. 

Thanks, Robert

R.version
               _                            
platform       x86_64-unknown-linux-gnu     
arch           x86_64                       
os             linux-gnu                    
system         x86_64, linux-gnu            
status                                      
major          2                            
minor          11.1                         
year           2010                         
month          05                           
day            31                           
svn rev        52157                        
language       R                            
version.string R version 2.11.1 (2010-05-31)

Robert McGehee, CFA
Geode Capital Management, LLC
One Post Office Square, 28th Floor | Boston, MA | 02109
Tel: 617/392-8396    Fax:617/476-6389
mailto:robert.mcgehee at geodecapital.com


>This e-mail, and any attachments hereto, are intended for use by the
addressee(s) only and may contain information that is (i) confidential
information of Geode Capital Management, LLC and/or its affiliates,
and/or (ii) proprietary information of Geode Capital Management, LLC
and/or its affiliates. If you are not the intended recipient of this
e-mail, or if you have otherwise received this e-mail in error, please
immediately notify me by telephone (you may call collect), or by e-mail,
and please permanently delete the original, any print outs and any
copies of the foregoing. Any dissemination, distribution or copying of
this e-mail is strictly prohibited. 


From hadley at rice.edu  Tue Jun 29 17:46:36 2010
From: hadley at rice.edu (Hadley Wickham)
Date: Tue, 29 Jun 2010 10:46:36 -0500
Subject: [Rd] Catching Ctrl-C/Esc at R-level
Message-ID: <AANLkTimZ5Rz-7MQB93oyGYTNclgbryeVtejkMEpF3PhX@mail.gmail.com>

Hi all,

Is it possible to catch when the user presses Ctrl+C/Esc and deal with
it at the R level?

Hadley

-- 
Assistant Professor / Dobelman Family Junior Chair
Department of Statistics / Rice University
http://had.co.nz/


From hb at stat.berkeley.edu  Tue Jun 29 18:04:20 2010
From: hb at stat.berkeley.edu (Henrik Bengtsson)
Date: Tue, 29 Jun 2010 18:04:20 +0200
Subject: [Rd] Catching Ctrl-C/Esc at R-level
In-Reply-To: <AANLkTimZ5Rz-7MQB93oyGYTNclgbryeVtejkMEpF3PhX@mail.gmail.com>
References: <AANLkTimZ5Rz-7MQB93oyGYTNclgbryeVtejkMEpF3PhX@mail.gmail.com>
Message-ID: <AANLkTikIrth6F6XG5V-X6SPb4eeq3nj5FqAB39fvMac-@mail.gmail.com>

Yes, you catch user interrupts (Ctrl-C) with tryCatch(...,
interrupt=function(cond) { ...}), cf.

http://www1.maths.lth.se/help/R/ExceptionHandlingInR/

/Henrik

On Tue, Jun 29, 2010 at 5:46 PM, Hadley Wickham <hadley at rice.edu> wrote:
> Hi all,
>
> Is it possible to catch when the user presses Ctrl+C/Esc and deal with
> it at the R level?
>
> Hadley
>
> --
> Assistant Professor / Dobelman Family Junior Chair
> Department of Statistics / Rice University
> http://had.co.nz/
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>


From eriki at ccbr.umn.edu  Tue Jun 29 22:41:57 2010
From: eriki at ccbr.umn.edu (Erik Iverson)
Date: Tue, 29 Jun 2010 15:41:57 -0500
Subject: [Rd] read.table / type.convert with NA values
Message-ID: <4C2A5A95.6060104@ccbr.umn.edu>

Hello,

While assisting a fellow R-helper off list, I narrowed down an issue he 
was having to the following behavior of type.convert, called through 
read.table.  This is using R 2.10.1, if newer versions don't exhibit 
this behavior, apologies.

# generates numeric vector
 > type.convert(c("123.42", "NA"))
[1] 123.42     NA

# generates a numeric vector, notice the space before 123.42
 > type.convert(c(" 123.42 ", "NA"))
[1] 123.42     NA

# generates factor, notice the space before NA
# note that the 2nd element is actually " NA", not a true NA value
 > type.convert(c("123.42", " NA"))
[1] 123.42  NA
Levels: 123.42  NA


How can this affect read.table/read.csv use 'in the wild'?

This gentleman had a data file that was

1) delimited by something other than white space, CSV in his case
2) contained missing values, designated by NA in his case
3) contained white space between delimiters and data values, e.g.,

NA,     NA,    4.5,    NA

as opposed to

NA,NA,4.5,NA


With these 3 conditions met, read.table gives type.convert a character 
vector like my third example above, and ultimately he got a data.frame 
consisting of only factors when we were expecting numeric columns.  This 
was easily fixed either by modifying the read.csv function call to 
specify colClasses directly, or in his case, strip.white = TRUE did the 
job just fine.

I believe the confusion stems from the fact that with no NA values in 
our data file, this would work as we would expect.  The introduction of 
what we thought were NA values changed the behavior.  In reality, these 
were not being treated as NA values by read.table/type.convert.  The 
question is, should they be in this case?

This behavior of read.table/type.convert may very well be what is 
expected/needed.  If so, this note could still be of use to someone in 
the future if they stumble upon similar behavior.  The fact I wasn't 
able to uncover anyone who asked about it on list before probably means 
the situation is rare.

Best Regards,
Erik Iverson


From hadley at rice.edu  Tue Jun 29 23:17:37 2010
From: hadley at rice.edu (Hadley Wickham)
Date: Tue, 29 Jun 2010 16:17:37 -0500
Subject: [Rd] Documenting non-exported objects
Message-ID: <AANLkTilubR2RpSklx8k0ZXd1rWQltEV40crqHCq3BvDO@mail.gmail.com>

If I don't export an object saved in data/, do I still need to document it?

Currently it seems like I do.  My namespace file looks like this:

export(evaluate)
export(parse_all)
export(replay)

But when I run R CMD check I get:

* checking for missing documentation entries ... WARNING
Undocumented code objects:
  empty_plot

Hadley

-- 
Assistant Professor / Dobelman Family Junior Chair
Department of Statistics / Rice University
http://had.co.nz/


From hadley at rice.edu  Tue Jun 29 23:56:56 2010
From: hadley at rice.edu (Hadley Wickham)
Date: Tue, 29 Jun 2010 16:56:56 -0500
Subject: [Rd] Tips for debugging: R CMD check examples
Message-ID: <AANLkTilQ9vYlaqXLQTeFjVfvzuQRsZ1uEX5x9_3EtI5D@mail.gmail.com>

Hi all,

Does anyone have any suggestions for debugging the execution of
examples by R CMD check?  The examples work fine when I run them from
a live R prompt, but I get errors when they are run by R CMD check.

Thanks,

Hadley

-- 
Assistant Professor / Dobelman Family Junior Chair
Department of Statistics / Rice University
http://had.co.nz/


From shotwelm at musc.edu  Wed Jun 30 01:14:17 2010
From: shotwelm at musc.edu (Matt Shotwell)
Date: Tue, 29 Jun 2010 19:14:17 -0400
Subject: [Rd] read.table / type.convert with NA values
In-Reply-To: <4C2A5A95.6060104@ccbr.umn.edu>
References: <4C2A5A95.6060104@ccbr.umn.edu>
Message-ID: <1277853257.4145.27.camel@deacon>

The document RFC 4180 (which appears to be the CSV standard used by R,
see ?read.table) considers spaces to be part of the fielded value. Some
have taken this to mean that all white space characters should be
considered part of the fielded value, though the RFC is not explicit
here. Hence, this behavior is in compliance with the "standard" for CSV
files. It seems that R treats '\t' (and perhaps all?) separated value
files the same way by default.

The RFC is very short and easy to read if you're interested.
http://tools.ietf.org/html/rfc4180

-Matt

On Tue, 2010-06-29 at 16:41 -0400, Erik Iverson wrote:
> Hello,
> 
> While assisting a fellow R-helper off list, I narrowed down an issue he 
> was having to the following behavior of type.convert, called through 
> read.table.  This is using R 2.10.1, if newer versions don't exhibit 
> this behavior, apologies.
> 
> # generates numeric vector
>  > type.convert(c("123.42", "NA"))
> [1] 123.42     NA
> 
> # generates a numeric vector, notice the space before 123.42
>  > type.convert(c(" 123.42 ", "NA"))
> [1] 123.42     NA
> 
> # generates factor, notice the space before NA
> # note that the 2nd element is actually " NA", not a true NA value
>  > type.convert(c("123.42", " NA"))
> [1] 123.42  NA
> Levels: 123.42  NA
> 
> 
> How can this affect read.table/read.csv use 'in the wild'?
> 
> This gentleman had a data file that was
> 
> 1) delimited by something other than white space, CSV in his case
> 2) contained missing values, designated by NA in his case
> 3) contained white space between delimiters and data values, e.g.,
> 
> NA,     NA,    4.5,    NA
> 
> as opposed to
> 
> NA,NA,4.5,NA
> 
> 
> With these 3 conditions met, read.table gives type.convert a character 
> vector like my third example above, and ultimately he got a data.frame 
> consisting of only factors when we were expecting numeric columns.  This 
> was easily fixed either by modifying the read.csv function call to 
> specify colClasses directly, or in his case, strip.white = TRUE did the 
> job just fine.
> 
> I believe the confusion stems from the fact that with no NA values in 
> our data file, this would work as we would expect.  The introduction of 
> what we thought were NA values changed the behavior.  In reality, these 
> were not being treated as NA values by read.table/type.convert.  The 
> question is, should they be in this case?
> 
> This behavior of read.table/type.convert may very well be what is 
> expected/needed.  If so, this note could still be of use to someone in 
> the future if they stumble upon similar behavior.  The fact I wasn't 
> able to uncover anyone who asked about it on list before probably means 
> the situation is rare.
> 
> Best Regards,
> Erik Iverson
> 
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
-- 
Matthew S. Shotwell
Graduate Student
Division of Biostatistics and Epidemiology
Medical University of South Carolina
http://biostatmatt.com


From ehlers at ucalgary.ca  Wed Jun 30 03:45:35 2010
From: ehlers at ucalgary.ca (Peter Ehlers)
Date: Tue, 29 Jun 2010 19:45:35 -0600
Subject: [Rd] read.table / type.convert with NA values
In-Reply-To: <1277853257.4145.27.camel@deacon>
References: <4C2A5A95.6060104@ccbr.umn.edu> <1277853257.4145.27.camel@deacon>
Message-ID: <4C2AA1BF.9050003@ucalgary.ca>

Is there a compelling reason to have strip.white default
to FALSE? It seems to me that it would be more common to
want the TRUE case.
Having said that, I must confess that I've never had the
problem Erik describes.

   -Peter Ehlers

On 2010-06-29 17:14, Matt Shotwell wrote:
> The document RFC 4180 (which appears to be the CSV standard used by R,
> see ?read.table) considers spaces to be part of the fielded value. Some
> have taken this to mean that all white space characters should be
> considered part of the fielded value, though the RFC is not explicit
> here. Hence, this behavior is in compliance with the "standard" for CSV
> files. It seems that R treats '\t' (and perhaps all?) separated value
> files the same way by default.
>
> The RFC is very short and easy to read if you're interested.
> http://tools.ietf.org/html/rfc4180
>
> -Matt
>
> On Tue, 2010-06-29 at 16:41 -0400, Erik Iverson wrote:
>> Hello,
>>
>> While assisting a fellow R-helper off list, I narrowed down an issue he
>> was having to the following behavior of type.convert, called through
>> read.table.  This is using R 2.10.1, if newer versions don't exhibit
>> this behavior, apologies.
>>
>> # generates numeric vector
>>   >  type.convert(c("123.42", "NA"))
>> [1] 123.42     NA
>>
>> # generates a numeric vector, notice the space before 123.42
>>   >  type.convert(c(" 123.42 ", "NA"))
>> [1] 123.42     NA
>>
>> # generates factor, notice the space before NA
>> # note that the 2nd element is actually " NA", not a true NA value
>>   >  type.convert(c("123.42", " NA"))
>> [1] 123.42  NA
>> Levels: 123.42  NA
>>
>>
>> How can this affect read.table/read.csv use 'in the wild'?
>>
>> This gentleman had a data file that was
>>
>> 1) delimited by something other than white space, CSV in his case
>> 2) contained missing values, designated by NA in his case
>> 3) contained white space between delimiters and data values, e.g.,
>>
>> NA,     NA,    4.5,    NA
>>
>> as opposed to
>>
>> NA,NA,4.5,NA
>>
>>
>> With these 3 conditions met, read.table gives type.convert a character
>> vector like my third example above, and ultimately he got a data.frame
>> consisting of only factors when we were expecting numeric columns.  This
>> was easily fixed either by modifying the read.csv function call to
>> specify colClasses directly, or in his case, strip.white = TRUE did the
>> job just fine.
>>
>> I believe the confusion stems from the fact that with no NA values in
>> our data file, this would work as we would expect.  The introduction of
>> what we thought were NA values changed the behavior.  In reality, these
>> were not being treated as NA values by read.table/type.convert.  The
>> question is, should they be in this case?
>>
>> This behavior of read.table/type.convert may very well be what is
>> expected/needed.  If so, this note could still be of use to someone in
>> the future if they stumble upon similar behavior.  The fact I wasn't
>> able to uncover anyone who asked about it on list before probably means
>> the situation is rare.
>>
>> Best Regards,
>> Erik Iverson
>>


From tobias.verbeke at openanalytics.eu  Wed Jun 30 09:34:00 2010
From: tobias.verbeke at openanalytics.eu (Tobias Verbeke)
Date: Wed, 30 Jun 2010 09:34:00 +0200
Subject: [Rd] Tips for debugging: R CMD check examples
In-Reply-To: <AANLkTilQ9vYlaqXLQTeFjVfvzuQRsZ1uEX5x9_3EtI5D@mail.gmail.com>
References: <AANLkTilQ9vYlaqXLQTeFjVfvzuQRsZ1uEX5x9_3EtI5D@mail.gmail.com>
Message-ID: <4C2AF368.8090803@openanalytics.eu>

On 06/29/2010 11:56 PM, Hadley Wickham wrote:

> Does anyone have any suggestions for debugging the execution of
> examples by R CMD check?  The examples work fine when I run them from
> a live R prompt, but I get errors when they are run by R CMD check.

Not a real tip, but when it occurs I immediately
check for namespace issues (which often turn out
to be the origin). Things I do are

- verify all packages involved have namespaces;
- load all packages (i.e. put explicitly on the
   search path) to detect masking issues;
- check all imports and exports and if relevant
   turn package imports into individual function
   imports to have a more fine-grained view.

Agreed this is a very indirect way, but at times
faster than trying to interpret the error message.

Best,
Tobias


From gavin.simpson at ucl.ac.uk  Wed Jun 30 09:58:50 2010
From: gavin.simpson at ucl.ac.uk (Gavin Simpson)
Date: Wed, 30 Jun 2010 08:58:50 +0100
Subject: [Rd] Tips for debugging: R CMD check examples
Message-ID: <1277884730.7384.4.camel@desktop.localdomain>

[Apologies for breaking the thread, I deleted the message before
starting this reply]

Dear Hadley,

R CMD check produces a foo-Ex.R file where foo is the package name. You
could start by sourcing that file in R --vanilla and see where it fails
and also use standard debugging tools in R from there (i.e. drop into a
debugger on error).

HTH

G
-- 
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%
 Dr. Gavin Simpson             [t] +44 (0)20 7679 0522
 ECRC, UCL Geography,          [f] +44 (0)20 7679 0565
 Pearson Building,             [e] gavin.simpsonATNOSPAMucl.ac.uk
 Gower Street, London          [w] http://www.ucl.ac.uk/~ucfagls/
 UK. WC1E 6BT.                 [w] http://www.freshwaters.org.uk
%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%


From deepayan.sarkar at gmail.com  Wed Jun 30 10:05:07 2010
From: deepayan.sarkar at gmail.com (Deepayan Sarkar)
Date: Wed, 30 Jun 2010 13:35:07 +0530
Subject: [Rd] Tips for debugging: R CMD check examples
In-Reply-To: <AANLkTilQ9vYlaqXLQTeFjVfvzuQRsZ1uEX5x9_3EtI5D@mail.gmail.com>
References: <AANLkTilQ9vYlaqXLQTeFjVfvzuQRsZ1uEX5x9_3EtI5D@mail.gmail.com>
Message-ID: <AANLkTimtoYO3ADZJkLZQ4YxEho8ucWQ9wwZI_7b77B9T@mail.gmail.com>

On Wed, Jun 30, 2010 at 3:26 AM, Hadley Wickham <hadley at rice.edu> wrote:
> Hi all,
>
> Does anyone have any suggestions for debugging the execution of
> examples by R CMD check? ?The examples work fine when I run them from
> a live R prompt, but I get errors when they are run by R CMD check.

'R CMD check pkg' will produce a pkg.Rcheck/pkg-Ex.R file that
collects the examples into a single file (and also does other things).
You could try running that file interactively to see if the error is
reproduced.

-Deepayan


From spencer.graves at structuremonitoring.com  Wed Jun 30 15:29:58 2010
From: spencer.graves at structuremonitoring.com (Spencer Graves)
Date: Wed, 30 Jun 2010 06:29:58 -0700
Subject: [Rd] Tips for debugging: R CMD check examples
In-Reply-To: <AANLkTimtoYO3ADZJkLZQ4YxEho8ucWQ9wwZI_7b77B9T@mail.gmail.com>
References: <AANLkTilQ9vYlaqXLQTeFjVfvzuQRsZ1uEX5x9_3EtI5D@mail.gmail.com>
	<AANLkTimtoYO3ADZJkLZQ4YxEho8ucWQ9wwZI_7b77B9T@mail.gmail.com>
Message-ID: <4C2B46D6.9070107@structuremonitoring.com>

Hi, Hadley:


       1.  Is your memory clear when you run the examples successfully?  
I.e., start with "rm(list=objects())", then try the examples that work 
interactively but fail in "R CMD check".


       2.  Also, does "R CMD check" give any warnings, e.g., undefined 
global, in addition to the error message?  If yes, fixing those might 
also fix the error message.


       The suggestions of Deepayan and Sarker are excellent, but the two 
things I suggests are more targeted and might work, so I'd try them first.


       Hope this helps.
       Spencer


On 6/30/2010 1:05 AM, Deepayan Sarkar wrote:
> On Wed, Jun 30, 2010 at 3:26 AM, Hadley Wickham<hadley at rice.edu>  wrote:
>    
>> Hi all,
>>
>> Does anyone have any suggestions for debugging the execution of
>> examples by R CMD check?  The examples work fine when I run them from
>> a live R prompt, but I get errors when they are run by R CMD check.
>>      
> 'R CMD check pkg' will produce a pkg.Rcheck/pkg-Ex.R file that
> collects the examples into a single file (and also does other things).
> You could try running that file interactively to see if the error is
> reproduced.
>
> -Deepayan
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel
>    


-- 
Spencer Graves, PE, PhD
President and Chief Operating Officer
Structure Inspection and Monitoring, Inc.
751 Emerson Ct.
San Jos?, CA 95126
ph:  408-655-4567


From h.wickham at gmail.com  Wed Jun 30 15:32:58 2010
From: h.wickham at gmail.com (hadley wickham)
Date: Wed, 30 Jun 2010 08:32:58 -0500
Subject: [Rd] Tips for debugging: R CMD check examples
In-Reply-To: <1277884730.7384.4.camel@desktop.localdomain>
References: <1277884730.7384.4.camel@desktop.localdomain>
Message-ID: <AANLkTil6N-jeo4geAOPdjKPHWD0FIshNH5V5vkwiDA8s@mail.gmail.com>

> R CMD check produces a foo-Ex.R file where foo is the package name. You
> could start by sourcing that file in R --vanilla and see where it fails
> and also use standard debugging tools in R from there (i.e. drop into a
> debugger on error).

I knew about the foo-Ex.R file, but unfortunately running that
produced no errors. I ended up resorting to inserting print statements
every few lines to narrow down the exact location of the problem,
which revealed that my code assumed options(keep.source = TRUE) but
during R CMD check, options(keep.source = FALSE).

Hopefully this type of problem will be easier to sort out with the new
pure R R CMD check in 2.11.

Hadley


-- 
Assistant Professor / Dobelman Family Junior Chair
Department of Statistics / Rice University
http://had.co.nz/


From hadley at rice.edu  Wed Jun 30 15:34:29 2010
From: hadley at rice.edu (Hadley Wickham)
Date: Wed, 30 Jun 2010 08:34:29 -0500
Subject: [Rd] Tips for debugging: R CMD check examples
In-Reply-To: <4C2AF368.8090803@openanalytics.eu>
References: <AANLkTilQ9vYlaqXLQTeFjVfvzuQRsZ1uEX5x9_3EtI5D@mail.gmail.com> 
	<4C2AF368.8090803@openanalytics.eu>
Message-ID: <AANLkTimki5vqzNT5aYFUIrLIC3-LehFw6KrguCLfKDq_@mail.gmail.com>

> Not a real tip, but when it occurs I immediately
> check for namespace issues (which often turn out
> to be the origin). Things I do are

I agree that namespace issues are often a problem, and are never easy
to diagnose - I often find that I've forgotten to export a method
definition so other code silently falls back on the default method and
leads to head scratching bugs.

Hadley


-- 
Assistant Professor / Dobelman Family Junior Chair
Department of Statistics / Rice University
http://had.co.nz/


From djsamperi at gmail.com  Wed Jun 30 15:44:42 2010
From: djsamperi at gmail.com (Dominick Samperi)
Date: Wed, 30 Jun 2010 09:44:42 -0400
Subject: [Rd] Problem with dyn.load() under Windows 64bit at CRAN
Message-ID: <AANLkTilnLDq_LYijOwaRoO-O2Jxd0QlNNr8oN8_65lgs@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-devel/attachments/20100630/8c036ff0/attachment.pl>

From ripley at stats.ox.ac.uk  Wed Jun 30 17:19:24 2010
From: ripley at stats.ox.ac.uk (Prof Brian Ripley)
Date: Wed, 30 Jun 2010 16:19:24 +0100 (BST)
Subject: [Rd] Tips for debugging: R CMD check examples
In-Reply-To: <AANLkTil6N-jeo4geAOPdjKPHWD0FIshNH5V5vkwiDA8s@mail.gmail.com>
References: <1277884730.7384.4.camel@desktop.localdomain>
	<AANLkTil6N-jeo4geAOPdjKPHWD0FIshNH5V5vkwiDA8s@mail.gmail.com>
Message-ID: <alpine.LFD.2.00.1006301544250.20658@gannet.stats.ox.ac.uk>

On Wed, 30 Jun 2010, hadley wickham wrote:

>> R CMD check produces a foo-Ex.R file where foo is the package name. You
>> could start by sourcing that file in R --vanilla and see where it fails
>> and also use standard debugging tools in R from there (i.e. drop into a
>> debugger on error).
>
> I knew about the foo-Ex.R file, but unfortunately running that
> produced no errors.

How did you 'run' it?   I suspect you source()d it, not at all the 
same thing.  I have yet to encounter a problem which

R --vanilla < foo-Ex.R

or perhaps

env LANGUAGE=en R --vanilla --encoding=latin1 < foo-Ex.R

did not reproduce.

> I ended up resorting to inserting print statements
> every few lines to narrow down the exact location of the problem,
> which revealed that my code assumed options(keep.source = TRUE) but
> during R CMD check, options(keep.source = FALSE).

Rather, the default (along with many others) differs in interactive 
use and batch running.   If you had used a command like those a few 
lines about you would have had 'keep.source = FALSE' set.

> Hopefully this type of problem will be easier to sort out with the new
> pure R R CMD check in 2.11.

Maybe (if you meant the one in R-devel, 2.12.0-to-be). But the 
examples are run in a sub-process just as before, so your very rare 
mis-assumption still needs an understanding of how R code is run.

>
> Hadley
>
>
> -- 
> Assistant Professor / Dobelman Family Junior Chair
> Department of Statistics / Rice University
> http://had.co.nz/

-- 
Brian D. Ripley,                  ripley at stats.ox.ac.uk
Professor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/
University of Oxford,             Tel:  +44 1865 272861 (self)
1 South Parks Road,                     +44 1865 272866 (PA)
Oxford OX1 3TG, UK                Fax:  +44 1865 272595


From h.wickham at gmail.com  Wed Jun 30 17:32:03 2010
From: h.wickham at gmail.com (hadley wickham)
Date: Wed, 30 Jun 2010 10:32:03 -0500
Subject: [Rd] Tips for debugging: R CMD check examples
In-Reply-To: <alpine.LFD.2.00.1006301544250.20658@gannet.stats.ox.ac.uk>
References: <1277884730.7384.4.camel@desktop.localdomain>
	<AANLkTil6N-jeo4geAOPdjKPHWD0FIshNH5V5vkwiDA8s@mail.gmail.com> 
	<alpine.LFD.2.00.1006301544250.20658@gannet.stats.ox.ac.uk>
Message-ID: <AANLkTilYdMSAplzib-NBdGhh8kgH-vLnNMC4KJlBuNiV@mail.gmail.com>

> How did you 'run' it? ? I suspect you source()d it, not at all the same
> thing. ?I have yet to encounter a problem which
>
> R --vanilla < foo-Ex.R
>
> or perhaps
>
> env LANGUAGE=en R --vanilla --encoding=latin1 < foo-Ex.R
>
> did not reproduce.

Thanks, that was exactly what I was looking for.  I hadn't tried
running it in batch mode.

> Rather, the default (along with many others) differs in interactive use and
> batch running. ? If you had used a command like those a few lines about you
> would have had 'keep.source = FALSE' set.

I think the root of the problem is the way that source is written - it
uses a global option in an internal branch, which is difficult to
notice unless you read the source code. It seems like a good principle
that global options should only affect program behaviour by modifying
the function arguments.

>> Hopefully this type of problem will be easier to sort out with the new
>> pure R R CMD check in 2.11.
>
> Maybe (if you meant the one in R-devel, 2.12.0-to-be). But the examples are
> run in a sub-process just as before, so your very rare mis-assumption still
> needs an understanding of how R code is run.

Ooops, yes, I meant 2.12.0-to-be.  I was thinking it would make the
problem easier for me to understand because I'm more inclined to read
R code rather than perl code.

Hadley

-- 
Assistant Professor / Dobelman Family Junior Chair
Department of Statistics / Rice University
http://had.co.nz/


From ligges at statistik.tu-dortmund.de  Wed Jun 30 19:36:47 2010
From: ligges at statistik.tu-dortmund.de (Uwe Ligges)
Date: Wed, 30 Jun 2010 19:36:47 +0200
Subject: [Rd] Problem with dyn.load() under Windows 64bit at CRAN
In-Reply-To: <AANLkTilnLDq_LYijOwaRoO-O2Jxd0QlNNr8oN8_65lgs@mail.gmail.com>
References: <AANLkTilnLDq_LYijOwaRoO-O2Jxd0QlNNr8oN8_65lgs@mail.gmail.com>
Message-ID: <4C2B80AF.2040503@statistik.tu-dortmund.de>

Dominick,

your messages are all in my Inbox, I just have not yet found the time to 
look in more detail.

On 30.06.2010 15:44, Dominick Samperi wrote:
> The package cxxPack builds without problems at CRAN under all OS's except
> Windows 64bit, and in the case of Windows 64bit there is a problem in a
> call to dyn.load(). This call happens while processing the package vignette,
> and the odd thing about this is that there are several calls to dyn.load()
> that
> work fine before the one that fails.


That highly improbable.

> This seems to suggest that Windows 64bit is imposing some kind of
> resource constraint that limits the number of shared libs that can be
> loaded at one time.
>
> Another odd thing about this is that everything worked under Windows 64bit
> before the changes were made to serialize the build of packages that
> depend on each other.

That's untrue. I try to serialize some things on winbuilder.

> Any ideas?

No yet.

It is not very helpful to speculate and post a modification of some of 
your and my modified guesses.

Best,
Uwe



>
> Thanks,
> Dominick
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-devel


